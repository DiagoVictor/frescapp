(self.webpackChunkapp_admin=self.webpackChunkapp_admin||[]).push([[792],{504:(Ed,Ru,Ja)=>{"use strict";var Ic={};function kc(e,n){return Object.is(e,n)}Ja.r(Ic),Ja.d(Ic,{afterMain:()=>LH,afterRead:()=>RH,afterWrite:()=>UH,applyStyles:()=>dL,arrow:()=>aL,auto:()=>NO,basePlacements:()=>F2,beforeMain:()=>NH,beforeRead:()=>OH,beforeWrite:()=>BH,bottom:()=>xd,clippingParents:()=>IH,computeStyles:()=>uL,createPopper:()=>kL,createPopperBase:()=>Hve,createPopperLite:()=>eG,detectOverflow:()=>j2,end:()=>L2,eventListeners:()=>lL,flip:()=>iL,hide:()=>fW,left:()=>nu,main:()=>FH,modifierPhases:()=>VH,offset:()=>hL,placements:()=>Y4,popper:()=>B2,popperGenerator:()=>BO,popperOffsets:()=>cL,preventOverflow:()=>oL,read:()=>PH,reference:()=>kH,right:()=>bd,start:()=>Kv,top:()=>tu,variationPlacements:()=>X4,viewport:()=>Z4,write:()=>zH});let ao=null,f=!1,xo=1;const ss=Symbol("SIGNAL");function cn(e){const n=ao;return ao=e,n}const ii={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Es(e){if(f)throw new Error("");if(null===ao)return;ao.consumerOnSignalRead(e);const n=ao.nextProducerIndex++;Da(ao),n<ao.producerNode.length&&ao.producerNode[n]!==e&&Zr(ao)&&xi(ao.producerNode[n],ao.producerIndexOfThis[n]),ao.producerNode[n]!==e&&(ao.producerNode[n]=e,ao.producerIndexOfThis[n]=Zr(ao)?$h(e,ao,n):0),ao.producerLastReadVersion[n]=e.version}function eo(e){if((!Zr(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==xo)){if(!e.producerMustRecompute(e)&&!Sa(e))return e.dirty=!1,void(e.lastCleanEpoch=xo);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=xo}}function Oc(e){if(void 0===e.liveConsumerNode)return;const n=f;f=!0;try{for(const t of e.liveConsumerNode)t.dirty||Ni(t)}finally{f=n}}function sa(){return!1!==ao?.consumerAllowSignalWrites}function Ni(e){e.dirty=!0,Oc(e),e.consumerMarkedDirty?.(e)}function Oi(e){return e&&(e.nextProducerIndex=0),cn(e)}function lo(e,n){if(cn(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Zr(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)xi(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Sa(e){Da(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],r=e.producerLastReadVersion[n];if(r!==t.version||(eo(t),r!==t.version))return!0}return!1}function Nu(e){if(Da(e),Zr(e))for(let n=0;n<e.producerNode.length;n++)xi(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function $h(e,n,t){if(Fu(e),0===e.liveConsumerNode.length&&Hh(e))for(let r=0;r<e.producerNode.length;r++)e.producerIndexOfThis[r]=$h(e.producerNode[r],e,r);return e.liveConsumerIndexOfThis.push(t),e.liveConsumerNode.push(n)-1}function xi(e,n){if(Fu(e),1===e.liveConsumerNode.length&&Hh(e))for(let r=0;r<e.producerNode.length;r++)xi(e.producerNode[r],e.producerIndexOfThis[r]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const r=e.liveConsumerIndexOfThis[n],i=e.liveConsumerNode[n];Da(i),i.producerIndexOfThis[r]=n}}function Zr(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Da(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function Fu(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function Hh(e){return void 0!==e.producerNode}const mi=Symbol("UNSET"),ru=Symbol("COMPUTING"),oa=Symbol("ERRORED"),hm={...ii,value:mi,dirty:!0,error:null,equal:kc,producerMustRecompute:e=>e.value===mi||e.value===ru,producerRecomputeValue(e){if(e.value===ru)throw new Error("Detected cycle in computations.");const n=e.value;e.value=ru;const t=Oi(e);let r;try{r=e.computation()}catch(i){r=oa,e.error=i}finally{lo(e,t)}n!==mi&&n!==oa&&r!==oa&&e.equal(n,r)?e.value=n:(e.value=r,e.version++)}};let iu=function Wh(){throw new Error};function ai(){iu()}let Gs=null;function er(e,n){sa()||ai(),e.equal(e.value,n)||(e.value=n,function Ht(e){e.version++,function ki(){xo++}(),Oc(e),Gs?.()}(e))}const At={...ii,equal:kc,value:void 0};function xr(e){return"function"==typeof e}function Gi(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Cn=Gi(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Ln(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class os{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const l of t)l.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(xr(r))try{r()}catch(l){n=l instanceof Cn?l.errors:[l]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const l of i)try{Bu(l)}catch(u){n=n??[],u instanceof Cn?n=[...n,...u.errors]:n.push(u)}}if(n)throw new Cn(n)}}add(n){var t;if(n&&n!==this)if(this.closed)Bu(n);else{if(n instanceof os){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&Ln(t,n)}remove(n){const{_finalizers:t}=this;t&&Ln(t,n),n instanceof os&&n._removeParent(this)}}os.EMPTY=(()=>{const e=new os;return e.closed=!0,e})();const co=os.EMPTY;function Qa(e){return e instanceof os||e&&"closed"in e&&xr(e.remove)&&xr(e.add)&&xr(e.unsubscribe)}function Bu(e){xr(e)?e():e.unsubscribe()}const As={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},sc={setTimeout(e,n,...t){const{delegate:r}=sc;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=sc;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function cs(e){sc.setTimeout(()=>{const{onUnhandledError:n}=As;if(!n)throw e;n(e)})}function Uo(){}const Sd=Md("C",void 0,void 0);function Md(e,n,t){return{kind:e,value:n,error:t}}let Vo=null;function jo(e){if(As.useDeprecatedSynchronousErrorHandling){const n=!Vo;if(n&&(Vo={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=Vo;if(Vo=null,t)throw r}}else e()}class Ad extends os{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Qa(n)&&n.add(this)):this.destination=Xh}static create(n,t,r){return new ul(n,t,r)}next(n){this.isStopped?Id(function Dd(e){return Md("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Id(function qh(e){return Md("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Id(Sd,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Ma=Function.prototype.bind;function zl(e,n){return Ma.call(e,n)}class Zh{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){zu(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){zu(r)}else zu(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){zu(t)}}}class ul extends Ad{constructor(n,t,r){let i;if(super(),xr(n)||!n)i={next:n??void 0,error:t??void 0,complete:r??void 0};else{let l;this&&As.useDeprecatedNextContext?(l=Object.create(n),l.unsubscribe=()=>this.unsubscribe(),i={next:n.next&&zl(n.next,l),error:n.error&&zl(n.error,l),complete:n.complete&&zl(n.complete,l)}):i=n}this.destination=new Zh(i)}}function zu(e){As.useDeprecatedSynchronousErrorHandling?function cr(e){As.useDeprecatedSynchronousErrorHandling&&Vo&&(Vo.errorThrown=!0,Vo.error=e)}(e):cs(e)}function Id(e,n){const{onStoppedNotification:t}=As;t&&sc.setTimeout(()=>t(e,n))}const Xh={closed:!0,next:Uo,error:function mm(e){throw e},complete:Uo},kd="function"==typeof Symbol&&Symbol.observable||"@@observable";function dl(e){return e}function Yh(e){return 0===e.length?dl:1===e.length?e[0]:function(t){return e.reduce((r,i)=>i(r),t)}}let Di=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,i){const l=function $o(e){return e&&e instanceof Ad||function oc(e){return e&&xr(e.next)&&xr(e.error)&&xr(e.complete)}(e)&&Qa(e)}(t)?t:new ul(t,r,i);return jo(()=>{const{operator:u,source:g}=this;l.add(u?u.call(l,g):g?this._subscribe(l):this._trySubscribe(l))}),l}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=Kg(r))((i,l)=>{const u=new ul({next:g=>{try{t(g)}catch(x){l(x),u.unsubscribe()}},error:l,complete:i});this.subscribe(u)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[kd](){return this}pipe(...t){return Yh(t)(this)}toPromise(t){return new(t=Kg(t))((r,i)=>{let l;this.subscribe(u=>l=u,u=>i(u),()=>r(l))})}}return e.create=n=>new e(n),e})();function Kg(e){var n;return null!==(n=e??As.Promise)&&void 0!==n?n:Promise}const gm=Gi(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Mi=(()=>{class e extends Di{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new Kh(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new gm}next(t){jo(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){jo(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){jo(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:i,observers:l}=this;return r||i?co:(this.currentObservers=null,l.push(t),new os(()=>{this.currentObservers=null,Ln(l,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:i,isStopped:l}=this;r?t.error(i):l&&t.complete()}asObservable(){const t=new Di;return t.source=this,t}}return e.create=(n,t)=>new Kh(n,t),e})();class Kh extends Mi{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,n)}error(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==r?r:co}}class Hi extends Mi{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:r}=this;if(n)throw t;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function Kf(e){return xr(e?.lift)}function Ie(e){return n=>{if(Kf(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function te(e,n,t,r,i){return new oe(e,n,t,r,i)}class oe extends Ad{constructor(n,t,r,i,l,u){super(n),this.onFinalize=l,this.shouldUnsubscribe=u,this._next=t?function(g){try{t(g)}catch(x){n.error(x)}}:super._next,this._error=i?function(g){try{i(g)}catch(x){n.error(x)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(g){n.error(g)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function pe(e,n){return Ie((t,r)=>{let i=0;t.subscribe(te(r,l=>{r.next(e.call(n,l,i++))}))})}typeof navigator<"u"&&navigator,typeof navigator<"u"&&!/Opera/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||navigator),typeof navigator<"u"&&!/Opera|WebKit/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&navigator;const P1="https://g.co/ng/security#xss";class ln extends Error{constructor(n,t){super(function Fd(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function Hu(e){return{toString:e}.toString()}const su="__parameters__";function zd(e,n,t){return Hu(()=>{const r=function Om(e){return function(...t){if(e){const r=e(...t);for(const i in r)this[i]=r[i]}}}(n);function i(...l){if(this instanceof i)return r.apply(this,l),this;const u=new i(...l);return g.annotation=u,g;function g(x,E,D){const R=x.hasOwnProperty(su)?x[su]:Object.defineProperty(x,su,{value:[]})[su];for(;R.length<=D;)R.push(null);return(R[D]=R[D]||[]).push(u),x}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}const bi=globalThis;function ts(e){for(let n in e)if(e[n]===ts)return n;throw Error("Could not find renamed property on target object.")}function sf(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function wo(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(wo).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function Pm(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const kx=ts({__forward_ref__:ts});function Fi(e){return e.__forward_ref__=Fi,e.toString=function(){return wo(this())},e}function Pr(e){return Nm(e)?e():e}function Nm(e){return"function"==typeof e&&e.hasOwnProperty(kx)&&e.__forward_ref__===Fi}function It(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function dn(e){return{providers:e.providers||[],imports:e.imports||[]}}function op(e){return af(e,Pa)||af(e,Fr)}function af(e,n){return e.hasOwnProperty(n)?e[n]:null}function ap(e){return e&&(e.hasOwnProperty(_n)||e.hasOwnProperty(si))?e[_n]:null}const Pa=ts({\u0275prov:ts}),_n=ts({\u0275inj:ts}),Fr=ts({ngInjectableDef:ts}),si=ts({ngInjectorDef:ts});class vn{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=It({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function cf(e){return e&&!!e.\u0275providers}const jd=ts({\u0275cmp:ts}),lp=ts({\u0275dir:ts}),Ho=ts({\u0275pipe:ts}),fl=ts({\u0275mod:ts}),au=ts({\u0275fac:ts}),lu=ts({__NG_ELEMENT_ID__:ts}),qs=ts({__NG_ENV_ID__:ts});function Er(e){return"string"==typeof e?e:null==e?"":String(e)}function cu(e,n){throw new ln(-201,!1)}var wi=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(wi||{});let Lc;function Nx(){return Lc}function Ra(e){const n=Lc;return Lc=e,n}function tl(e,n,t){const r=op(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&wi.Optional?null:void 0!==n?n:void cu()}const Vr={},$d="__NG_DI_FLAG__",Um="ngTempTokenPath",Vm=/\n/gm,jm="__source";let pl;function ac(e){const n=pl;return pl=e,n}function ua(e,n=wi.Default){if(void 0===pl)throw new ln(-203,!1);return null===pl?tl(e,void 0,n):pl.get(e,n&wi.Optional?null:void 0,n)}function $n(e,n=wi.Default){return(Nx()||ua)(Pr(e),n)}function Qe(e,n=wi.Default){return $n(e,uf(n))}function uf(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function U1(e){const n=[];for(let t=0;t<e.length;t++){const r=Pr(e[t]);if(Array.isArray(r)){if(0===r.length)throw new ln(900,!1);let i,l=wi.Default;for(let u=0;u<r.length;u++){const g=r[u],x=Lx(g);"number"==typeof x?-1===x?i=g.token:l|=x:i=g}n.push($n(i,l))}else n.push($n(r))}return n}function df(e,n){return e[$d]=n,e.prototype[$d]=n,e}function Lx(e){return e[$d]}const Hl=df(zd("Optional"),8),$m=df(zd("SkipSelf"),4);function Bc(e,n){return e.hasOwnProperty(au)?e[au]:null}function Gd(e,n){e.forEach(t=>Array.isArray(t)?Gd(t,n):n(t))}function ml(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function zc(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function Na(e,n,t){let r=Wd(e,n);return r>=0?e[1|r]=t:(r=~r,function w_(e,n,t,r){let i=e.length;if(i==n)e.push(t,r);else if(1===i)e.push(r,e[0]),e[0]=t;else{for(i--,e.push(e[i-1],e[i]);i>n;)e[i]=e[i-2],i--;e[n]=t,e[n+1]=r}}(e,r,n,t)),r}function Uc(e,n){const t=Wd(e,n);if(t>=0)return e[1|t]}function Wd(e,n){return function Gm(e,n,t){let r=0,i=e.length>>t;for(;i!==r;){const l=r+(i-r>>1),u=e[l<<t];if(n===u)return l<<t;u>n?i=l:r=l+1}return~(i<<t)}(e,n,1)}const rl={},Ui=[],cc=new vn(""),gl=new vn("",-1),T_=new vn("");class Wm{get(n,t=Vr){if(t===Vr){const r=new Error(`NullInjectorError: No provider for ${wo(n)}!`);throw r.name="NullInjectorError",r}return t}}var up=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(up||{}),Fa=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Fa||{}),qd=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(qd||{});function dT(e,n,t){let r=e.length;for(;;){const i=e.indexOf(n,t);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const l=n.length;if(i+l===r||e.charCodeAt(i+l)<=32)return i}t=i+1}}function j1(e,n,t){let r=0;for(;r<t.length;){const i=t[r];if("number"==typeof i){if(0!==i)break;r++;const l=t[r++],u=t[r++],g=t[r++];e.setAttribute(n,u,g,l)}else{const l=i,u=t[++r];$1(l)?e.setProperty(n,l,u):e.setAttribute(n,l,u),r++}}return r}function Ux(e){return 3===e||4===e||6===e}function $1(e){return 64===e.charCodeAt(0)}function Zd(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let r=0;r<n.length;r++){const i=n[r];"number"==typeof i?t=i:0===t||Xd(e,t,i,null,-1===t||2===t?n[++r]:null)}}return e}function Xd(e,n,t,r,i){let l=0,u=e.length;if(-1===n)u=-1;else for(;l<e.length;){const g=e[l++];if("number"==typeof g){if(g===n){u=-1;break}if(g>n){u=l-1;break}}}for(;l<e.length;){const g=e[l];if("number"==typeof g)break;if(g===t){if(null===r)return void(null!==i&&(e[l+1]=i));if(r===e[l+1])return void(e[l+2]=i)}l++,null!==r&&l++,null!==i&&l++}-1!==u&&(e.splice(u,0,n),l=u+1),e.splice(l++,0,t),null!==r&&e.splice(l++,0,r),null!==i&&e.splice(l++,0,i)}const _l="ng-template";function qm(e,n,t,r){let i=0;if(r){for(;i<n.length&&"string"==typeof n[i];i+=2)if("class"===n[i]&&-1!==dT(n[i+1].toLowerCase(),t,0))return!0}else if(Zm(e))return!1;if(i=n.indexOf(1,i),i>-1){let l;for(;++i<n.length&&"string"==typeof(l=n[i]);)if(l.toLowerCase()===t)return!0}return!1}function Zm(e){return 4===e.type&&e.value!==_l}function E_(e,n,t){return n===(4!==e.type||t?e.value:_l)}function H1(e,n,t){let r=4;const i=e.attrs,l=null!==i?function Ym(e){for(let n=0;n<e.length;n++)if(Ux(e[n]))return n;return e.length}(i):0;let u=!1;for(let g=0;g<n.length;g++){const x=n[g];if("number"!=typeof x){if(!u)if(4&r){if(r=2|1&r,""!==x&&!E_(e,x,t)||""===x&&1===n.length){if(da(r))return!1;u=!0}}else if(8&r){if(null===i||!qm(e,i,x,t)){if(da(r))return!1;u=!0}}else{const E=n[++g],D=Xm(x,i,Zm(e),t);if(-1===D){if(da(r))return!1;u=!0;continue}if(""!==E){let R;if(R=D>l?"":i[D+1].toLowerCase(),2&r&&E!==R){if(da(r))return!1;u=!0}}}}else{if(!u&&!da(r)&&!da(x))return!1;if(u&&da(x))continue;u=!1,r=x|1&r}}return da(r)||u}function da(e){return!(1&e)}function Xm(e,n,t,r){if(null===n)return-1;let i=0;if(r||!t){let l=!1;for(;i<n.length;){const u=n[i];if(u===e)return i;if(3===u||6===u)l=!0;else{if(1===u||2===u){let g=n[++i];for(;"string"==typeof g;)g=n[++i];continue}if(4===u)break;if(0===u){i+=4;continue}}i+=l?1:2}return-1}return function C_(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const r=e[t];if("number"==typeof r)return-1;if(r===n)return t;t++}return-1}(n,e)}function G1(e,n,t=!1){for(let r=0;r<n.length;r++)if(H1(e,n[r],t))return!0;return!1}function Km(e,n){e:for(let t=0;t<n.length;t++){const r=n[t];if(e.length===r.length){for(let i=0;i<e.length;i++)if(e[i]!==r[i])continue e;return!0}}return!1}function dp(e,n){return e?":not("+n.trim()+")":n}function Jm(e){let n=e[0],t=1,r=2,i="",l=!1;for(;t<e.length;){let u=e[t];if("string"==typeof u)if(2&r){const g=e[++t];i+="["+u+(g.length>0?'="'+g+'"':"")+"]"}else 8&r?i+="."+u:4&r&&(i+=" "+u);else""!==i&&!da(u)&&(n+=dp(l,i),i=""),r=u,l=l||!da(r);t++}return""!==i&&(n+=dp(l,i)),n}function Lr(e){return Hu(()=>{const n=M_(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===up.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Fa.Emulated,styles:e.styles||Ui,_:null,schemas:e.schemas||null,tView:null,id:""};A_(t);const r=e.dependencies;return t.directiveDefs=fp(r,!1),t.pipeDefs=fp(r,!0),t.id=function $x(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const i of t)n=Math.imul(31,n)+i.charCodeAt(0)|0;return n+=2147483648,"c"+n}(t),t})}function hf(e){return di(e)||ko(e)}function hp(e){return null!==e}function Wi(e){return Hu(()=>({type:e.type,bootstrap:e.bootstrap||Ui,declarations:e.declarations||Ui,imports:e.imports||Ui,exports:e.exports||Ui,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function D_(e,n){if(null==e)return rl;const t={};for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];let l,u,g=qd.None;Array.isArray(i)?(g=i[0],l=i[1],u=i[2]??l):(l=i,u=i),n?(t[l]=g!==qd.None?[r,g]:r,n[l]=u):t[l]=r}return t}function Sn(e){return Hu(()=>{const n=M_(e);return A_(n),n})}function uo(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function di(e){return e[jd]||null}function ko(e){return e[lp]||null}function ha(e){return e[Ho]||null}function Oo(e,n){const t=e[fl]||null;if(!t&&!0===n)throw new Error(`Type ${wo(e)} does not have '\u0275mod' property.`);return t}function M_(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||rl,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Ui,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:D_(e.inputs,n),outputs:D_(e.outputs),debugInfo:null}}function A_(e){e.features?.forEach(n=>n(e))}function fp(e,n){if(!e)return null;const t=n?ha:hf;return()=>("function"==typeof e?e():e).map(r=>t(r)).filter(hp)}function eg(...e){return{\u0275providers:ff(0,e),\u0275fromNgModule:!0}}function ff(e,...n){const t=[],r=new Set;let i;const l=u=>{t.push(u)};return Gd(n,u=>{const g=u;La(g,l,[],r)&&(i||=[],i.push(g))}),void 0!==i&&pp(i,l),t}function pp(e,n){for(let t=0;t<e.length;t++){const{ngModule:r,providers:i}=e[t];qu(i,l=>{n(l,r)})}}function La(e,n,t,r){if(!(e=Pr(e)))return!1;let i=null,l=ap(e);const u=!l&&di(e);if(l||u){if(u&&!u.standalone)return!1;i=e}else{const x=e.ngModule;if(l=ap(x),!l)return!1;i=x}const g=r.has(i);if(u){if(g)return!1;if(r.add(i),u.dependencies){const x="function"==typeof u.dependencies?u.dependencies():u.dependencies;for(const E of x)La(E,n,t,r)}}else{if(!l)return!1;{if(null!=l.imports&&!g){let E;r.add(i);try{Gd(l.imports,D=>{La(D,n,t,r)&&(E||=[],E.push(D))})}finally{}void 0!==E&&pp(E,n)}if(!g){const E=Bc(i)||(()=>new i);n({provide:i,useFactory:E,deps:Ui},i),n({provide:T_,useValue:i,multi:!0},i),n({provide:cc,useValue:()=>$n(i),multi:!0},i)}const x=l.providers;if(null!=x&&!g){const E=e;qu(x,D=>{n(D,E)})}}}return i!==e&&void 0!==e.providers}function qu(e,n){for(let t of e)cf(t)&&(t=t.\u0275providers),Array.isArray(t)?qu(t,n):n(t)}const I_=ts({provide:String,useValue:ts});function mp(e){return null!==e&&"object"==typeof e&&I_ in e}function uu(e){return"function"==typeof e}const pf=new vn(""),mf={},P_={};let Jd;function R_(){return void 0===Jd&&(Jd=new Wm),Jd}class Go{}class _p extends Go{get destroyed(){return this._destroyed}constructor(n,t,r,i){super(),this.parent=t,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,q1(n,u=>this.processProvider(u)),this.records.set(gl,Qd(void 0,this)),i.has("environment")&&this.records.set(Go,Qd(void 0,this));const l=this.records.get(pf);null!=l&&"string"==typeof l.value&&this.scopes.add(l.value),this.injectorDefTypes=new Set(this.get(T_,Ui,wi.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const n=cn(null);try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),cn(n)}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=ac(this),r=Ra(void 0);try{return n()}finally{ac(t),Ra(r)}}get(n,t=Vr,r=wi.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(qs))return n[qs](this);r=uf(r);const l=ac(this),u=Ra(void 0);try{if(!(r&wi.SkipSelf)){let x=this.records.get(n);if(void 0===x){const E=function Wx(e){return"function"==typeof e||"object"==typeof e&&e instanceof vn}(n)&&op(n);x=E&&this.injectableDefInScope(E)?Qd(W1(n),mf):null,this.records.set(n,x)}if(null!=x)return this.hydrate(n,x)}return(r&wi.Self?R_():this.parent).get(n,t=r&wi.Optional&&t===Vr?null:t)}catch(g){if("NullInjectorError"===g.name){if((g[Um]=g[Um]||[]).unshift(wo(n)),l)throw g;return function V1(e,n,t,r){const i=e[Um];throw n[jm]&&i.unshift(n[jm]),e.message=function y_(e,n,t,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let i=wo(n);if(Array.isArray(n))i=n.map(wo).join(" -> ");else if("object"==typeof n){let l=[];for(let u in n)if(n.hasOwnProperty(u)){let g=n[u];l.push(u+":"+("string"==typeof g?JSON.stringify(g):wo(g)))}i=`{${l.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${e.replace(Vm,"\n  ")}`}("\n"+e.message,i,t,r),e.ngTokenPath=i,e[Um]=null,e}(g,n,"R3InjectorError",this.source)}throw g}finally{Ra(u),ac(l)}}resolveInjectorInitializers(){const n=cn(null),t=ac(this),r=Ra(void 0);try{const l=this.get(cc,Ui,wi.Self);for(const u of l)u()}finally{ac(t),Ra(r),cn(n)}}toString(){const n=[],t=this.records;for(const r of t.keys())n.push(wo(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ln(205,!1)}processProvider(n){let t=uu(n=Pr(n))?n:Pr(n&&n.provide);const r=function fT(e){return mp(e)?Qd(void 0,e.useValue):Qd(N_(e),mf)}(n);if(!uu(n)&&!0===n.multi){let i=this.records.get(t);i||(i=Qd(void 0,mf,!0),i.factory=()=>U1(i.multi),this.records.set(t,i)),t=n,i.multi.push(n)}this.records.set(t,r)}hydrate(n,t){const r=cn(null);try{return t.value===mf&&(t.value=P_,t.value=t.factory()),"object"==typeof t.value&&t.value&&function yp(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{cn(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;const t=Pr(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function W1(e){const n=op(e),t=null!==n?n.factory:Bc(e);if(null!==t)return t;if(e instanceof vn)throw new ln(204,!1);if(e instanceof Function)return function hT(e){if(e.length>0)throw new ln(204,!1);const t=function ou(e){return e&&(e[Pa]||e[Fr])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new ln(204,!1)}function N_(e,n,t){let r;if(uu(e)){const i=Pr(e);return Bc(i)||W1(i)}if(mp(e))r=()=>Pr(e.useValue);else if(function gp(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...U1(e.deps||[]));else if(function k_(e){return!(!e||!e.useExisting)}(e))r=()=>$n(Pr(e.useExisting));else{const i=Pr(e&&(e.useClass||e.provide));if(!function Gx(e){return!!e.deps}(e))return Bc(i)||W1(i);r=()=>new i(...U1(e.deps))}return r}function Qd(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function q1(e,n){for(const t of e)Array.isArray(t)?q1(t,n):t&&cf(t)?q1(t.\u0275providers,n):n(t)}function y(e,n){e instanceof _p&&e.assertNotDestroyed();const r=ac(e),i=Ra(void 0);try{return n()}finally{ac(r),Ra(i)}}function c(){return void 0!==Nx()||null!=function Fx(){return pl}()}const ge=0,ae=1,ce=2,xe=3,ve=4,ye=5,Ce=6,Me=7,Le=8,Se=9,we=10,Ue=11,et=12,Fe=13,Mt=14,pt=15,qe=16,at=17,Pe=18,wt=19,Et=20,Qt=21,sn=22,fn=23,xt=25,Bn=1,Pn=7,Cr=9,Ar=10;var ci=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(ci||{});function nr(e){return Array.isArray(e)&&"object"==typeof e[Bn]}function Mr(e){return Array.isArray(e)&&!0===e[Bn]}function yr(e){return!!(4&e.flags)}function mr(e){return e.componentOffset>-1}function sr(e){return!(1&~e.flags)}function Sr(e){return!!e.template}function Tr(e){return!!(512&e[ce])}class xp{constructor(n,t,r){this.previousValue=n,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Zx(e,n,t,r){null!==n?n.applyValueToInputSignal(n,r):e[t]=r}function Co(){return pT}function pT(e){return e.type.prototype.ngOnChanges&&(e.setInput=Yx),Xx}function Xx(){const e=gT(this),n=e?.current;if(n){const t=e.previous;if(t===rl)e.previous=n;else for(let r in n)t[r]=n[r];e.current=null,this.ngOnChanges(n)}}function Yx(e,n,t,r,i){const l=this.declaredInputs[r],u=gT(e)||function gP(e,n){return e[mT]=n}(e,{previous:rl,current:null}),g=u.current||(u.current={}),x=u.previous,E=x[l];g[l]=new xp(E&&E.currentValue,t,x===rl),Zx(e,n,i,t)}Co.ngInherit=!0;const mT="__ngSimpleChanges__";function gT(e){return e[mT]||null}const uc=function(e,n,t){};function qi(e){for(;Array.isArray(e);)e=e[ge];return e}function bp(e,n){return qi(n[e])}function ho(e,n){return qi(n[e.index])}function rg(e,n){return e.data[n]}function dc(e,n){return e[n]}function Zo(e,n){const t=n[e];return nr(t)?t:t[ge]}function F_(e){return!(128&~e[ce])}function hc(e,n){return null==n?null:e[n]}function Jx(e){e[at]=0}function Qx(e){1024&e[ce]||(e[ce]|=1024,F_(e)&&B_(e))}function ig(e){return!!(9216&e[ce]||e[fn]?.dirty)}function L_(e){e[we].changeDetectionScheduler?.notify(7),64&e[ce]&&(e[ce]|=1024),ig(e)&&B_(e)}function B_(e){e[we].changeDetectionScheduler?.notify(0);let n=Zu(e);for(;null!==n&&!(8192&n[ce])&&(n[ce]|=8192,F_(n));)n=Zu(n)}function z_(e,n){if(!(256&~e[ce]))throw new ln(911,!1);null===e[Qt]&&(e[Qt]=[]),e[Qt].push(n)}function Zu(e){const n=e[xe];return Mr(n)?n[xe]:n}const Br={lFrame:og(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let eb=!1;function K1(){return Br.bindingsEnabled}function xf(){return null!==Br.skipHydrationRootTNode}function en(){return Br.lFrame.lView}function gi(){return Br.lFrame.tView}function Bt(e){return Br.lFrame.contextLView=e,e[Le]}function zt(e){return Br.lFrame.contextLView=null,e}function us(){let e=bT();for(;null!==e&&64===e.type;)e=e.parent;return e}function bT(){return Br.lFrame.currentTNode}function hu(e,n){const t=Br.lFrame;t.currentTNode=e,t.isParent=n}function tb(){return Br.lFrame.isParent}function wT(){Br.lFrame.isParent=!1}function $D(){return eb}function V_(e){eb=e}function yl(){const e=Br.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function Xu(){return Br.lFrame.bindingIndex}function ma(){return Br.lFrame.bindingIndex++}function fu(e){const n=Br.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function TT(e,n){const t=Br.lFrame;t.bindingIndex=t.bindingRootIndex=e,nb(n)}function nb(e){Br.lFrame.currentDirectiveIndex=e}function sg(){return Br.lFrame.currentQueryIndex}function rb(e){Br.lFrame.currentQueryIndex=e}function vP(e){const n=e[ae];return 2===n.type?n.declTNode:1===n.type?e[ye]:null}function ib(e,n,t){if(t&wi.SkipSelf){let i=n,l=e;for(;!(i=i.parent,null!==i||t&wi.Host||(i=vP(l),null===i||(l=l[Mt],10&i.type))););if(null===i)return!1;n=i,e=l}const r=Br.lFrame=j_();return r.currentTNode=n,r.lView=e,!0}function Q1(e){const n=j_(),t=e[ae];Br.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function j_(){const e=Br.lFrame,n=null===e?null:e.child;return null===n?og(e):n}function og(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function ih(){const e=Br.lFrame;return Br.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const pu=ih;function sh(){const e=ih();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function to(){return Br.lFrame.selectedIndex}function lg(e){Br.lFrame.selectedIndex=e}function Bs(){const e=Br.lFrame;return rg(e.tView,e.selectedIndex)}let ST=!0;function ey(){return ST}function Gl(e){ST=e}function Wl(e,n){for(let t=n.directiveStart,r=n.directiveEnd;t<r;t++){const l=e.data[t].type.prototype,{ngAfterContentInit:u,ngAfterContentChecked:g,ngAfterViewInit:x,ngAfterViewChecked:E,ngOnDestroy:D}=l;u&&(e.contentHooks??=[]).push(-t,u),g&&((e.contentHooks??=[]).push(t,g),(e.contentCheckHooks??=[]).push(t,g)),x&&(e.viewHooks??=[]).push(-t,x),E&&((e.viewHooks??=[]).push(t,E),(e.viewCheckHooks??=[]).push(t,E)),null!=D&&(e.destroyHooks??=[]).push(t,D)}}function ql(e,n,t){cg(e,n,3,t)}function bf(e,n,t,r){(3&e[ce])===t&&cg(e,n,t,r)}function wf(e,n){let t=e[ce];(3&t)===n&&(t&=16383,t+=1,e[ce]=t)}function cg(e,n,t,r){const l=r??-1,u=n.length-1;let g=0;for(let x=void 0!==r?65535&e[at]:0;x<u;x++)if("number"==typeof n[x+1]){if(g=n[x],null!=r&&g>=r)break}else n[x]<0&&(e[at]+=65536),(g<l||-1==l)&&(Yr(e,t,n,x),e[at]=(4294901760&e[at])+x+2),x++}function ob(e,n){uc(4,e,n);const t=cn(null);try{n.call(e)}finally{cn(t),uc(5,e,n)}}function Yr(e,n,t,r){const i=t[r]<0,l=t[r+1],g=e[i?-t[r]:t[r]];i?e[ce]>>14<e[at]>>16&&(3&e[ce])===n&&(e[ce]+=16384,ob(g,l)):ob(g,l)}const jc=-1;class $_{constructor(n,t,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}const AT={};class Ef{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,r){r=uf(r);const i=this.injector.get(n,AT,r);return i!==AT||t===AT?i:this.parentInjector.get(n,t,r)}}function mu(e){return e!==jc}function fc(e){return 32767&e}function ga(e,n){let t=function bl(e){return e>>16}(e),r=n;for(;t>0;)r=r[Mt],t--;return r}let ab=!0;function ys(e){const n=ab;return ab=e,n}const Tp=255,IT=5;let lb=0;const Is={};function ty(e,n){const t=GD(e,n);if(-1!==t)return t;const r=n[ae];r.firstCreatePass&&(e.injectorIndex=n.length,ny(r.data,e),ny(n,null),ny(r.blueprint,null));const i=G_(e,n),l=e.injectorIndex;if(mu(i)){const u=fc(i),g=ga(i,n),x=g[ae].data;for(let E=0;E<8;E++)n[l+E]=g[u+E]|x[u+E]}return n[l+8]=i,l}function ny(e,n){e.push(0,0,0,0,0,0,0,0,n)}function GD(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function G_(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,r=null,i=n;for(;null!==i;){if(r=dg(i),null===r)return jc;if(t++,i=i[Mt],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return jc}function cb(e,n,t){!function kT(e,n,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(lu)&&(r=t[lu]),null==r&&(r=t[lu]=lb++);const i=r&Tp;n.data[e+(i>>IT)]|=1<<i}(e,n,t)}function gu(e,n,t){if(t&wi.Optional||void 0!==e)return e;cu()}function oh(e,n,t,r){if(t&wi.Optional&&void 0===r&&(r=null),!(t&(wi.Self|wi.Host))){const i=e[Se],l=Ra(void 0);try{return i?i.get(n,r,t&wi.Optional):tl(n,r,t&wi.Optional)}finally{Ra(l)}}return gu(r,0,t)}function ry(e,n,t,r=wi.Default,i){if(null!==e){if(2048&n[ce]&&!(r&wi.Self)){const u=function CP(e,n,t,r,i){let l=e,u=n;for(;null!==l&&null!==u&&2048&u[ce]&&!(512&u[ce]);){const g=iy(l,u,t,r|wi.Self,Is);if(g!==Is)return g;let x=l.parent;if(!x){const E=u[Et];if(E){const D=E.get(t,Is,r);if(D!==Is)return D}x=dg(u),u=u[Mt]}l=x}return i}(e,n,t,r,Is);if(u!==Is)return u}const l=iy(e,n,t,r,Is);if(l!==Is)return l}return oh(n,t,r,i)}function iy(e,n,t,r,i){const l=function WD(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(lu)?e[lu]:void 0;return"number"==typeof n?n>=0?n&Tp:ZD:n}(t);if("function"==typeof l){if(!ib(n,e,r))return r&wi.Host?gu(i,0,r):oh(n,t,r,i);try{let u;if(u=l(r),null!=u||r&wi.Optional)return u;cu()}finally{pu()}}else if("number"==typeof l){let u=null,g=GD(e,n),x=jc,E=r&wi.Host?n[pt][ye]:null;for((-1===g||r&wi.SkipSelf)&&(x=-1===g?G_(e,n):n[g+8],x!==jc&&ub(r,!1)?(u=n[ae],g=fc(x),n=ga(x,n)):g=-1);-1!==g;){const D=n[ae];if(qD(l,g,D.data)){const R=OT(g,n,t,u,r,E);if(R!==Is)return R}x=n[g+8],x!==jc&&ub(r,n[ae].data[g+8]===E)&&qD(l,g,n)?(u=D,g=fc(x),n=ga(x,n)):g=-1}}return i}function OT(e,n,t,r,i,l){const u=n[ae],g=u.data[e+8],D=W_(g,u,t,null==r?mr(g)&&ab:r!=u&&!!(3&g.type),i&wi.Host&&l===g);return null!==D?ug(n,u,D,g):Is}function W_(e,n,t,r,i){const l=e.providerIndexes,u=n.data,g=1048575&l,x=e.directiveStart,D=l>>20,L=i?g+D:e.directiveEnd;for(let V=r?g:g+D;V<L;V++){const Y=u[V];if(V<x&&t===Y||V>=x&&Y.type===t)return V}if(i){const V=u[x];if(V&&Sr(V)&&V.type===t)return x}return null}function ug(e,n,t,r){let i=e[t];const l=n.data;if(function wP(e){return e instanceof $_}(i)){const u=i;u.resolving&&function $l(e,n){throw n&&n.join(" > "),new ln(-200,e)}(function li(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Er(e)}(l[t]));const g=ys(u.canSeeViewProviders);u.resolving=!0;const E=u.injectImpl?Ra(u.injectImpl):null;ib(e,r,wi.Default);try{i=e[t]=u.factory(void 0,l,e,r),n.firstCreatePass&&t>=r.directiveStart&&function DT(e,n,t){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:l}=n.type.prototype;if(r){const u=pT(n);(t.preOrderHooks??=[]).push(e,u),(t.preOrderCheckHooks??=[]).push(e,u)}i&&(t.preOrderHooks??=[]).push(0-e,i),l&&((t.preOrderHooks??=[]).push(e,l),(t.preOrderCheckHooks??=[]).push(e,l))}(t,l[t],n)}finally{null!==E&&Ra(E),ys(g),u.resolving=!1,pu()}}return i}function qD(e,n,t){return!!(t[n+(e>>IT)]&1<<e)}function ub(e,n){return!(e&wi.Self||e&wi.Host&&n)}class Yo{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,r){return ry(this._tNode,this._lView,n,uf(r),t)}}function ZD(){return new Yo(us(),en())}function Ki(e){return Hu(()=>{const n=e.prototype.constructor,t=n[au]||db(n),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const l=i[au]||db(i);if(l&&l!==t)return l;i=Object.getPrototypeOf(i)}return l=>new l})}function db(e){return Nm(e)?()=>{const n=db(Pr(e));return n&&n()}:Bc(e)}function dg(e){const n=e[ae],t=n.type;return 2===t?n.declTNode:1===t?e[ye]:null}function _u(e){return function EP(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const r=t.length;let i=0;for(;i<r;){const l=t[i];if(Ux(l))break;if(0===l)i+=2;else if("number"==typeof l)for(i++;i<r&&"string"==typeof t[i];)i++;else{if(l===n)return t[i+1];i+=2}}}return null}(us(),e)}function JD(e,n=null,t=null,r){const i=ay(e,n,t,r);return i.resolveInjectorInitializers(),i}function ay(e,n=null,t=null,r,i=new Set){const l=[t||Ui,eg(e)];return r=r||("object"==typeof e?void 0:wo(e)),new _p(l,n||R_(),r||null,i)}class zs{static#e=this.THROW_IF_NOT_FOUND=Vr;static#t=this.NULL=new Wm;static create(n,t){if(Array.isArray(n))return JD({name:""},t,n,"");{const r=n.name??"";return JD({name:r},n.parent,n.providers,r)}}static#n=this.\u0275prov=It({token:zs,providedIn:"any",factory:()=>$n(gl)});static#r=this.__NG_ELEMENT_ID__=-1}new vn("").__NG_ELEMENT_ID__=e=>{const n=us();if(null===n)throw new ln(204,!1);if(2&n.type)return n.value;if(e&wi.Optional)return null;throw new ln(204,!1)};function ly(e){return e.ngOriginalError}class Po{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&ly(n);for(;t&&ly(t);)t=ly(t);return t||null}}const ah=new vn("",{providedIn:"root",factory:()=>Qe(Po).handleError.bind(void 0)});let lh=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=eM;static#t=this.__NG_ENV_ID__=t=>t}return e})();class QD extends lh{constructor(n){super(),this._lView=n}onDestroy(n){return z_(this._lView,n),()=>function fo(e,n){if(null===e[Qt])return;const t=e[Qt].indexOf(n);-1!==t&&e[Qt].splice(t,1)}(this._lView,n)}}function eM(){return new QD(en())}function UT(){return Cp(us(),en())}function Cp(e,n){return new Li(ho(e,n))}let Li=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=UT}return e})();function VT(e){return e instanceof Li?e.nativeElement:e}let ol=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Hi(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275prov=It({token:e,providedIn:"root",factory:()=>new e})}return e})();const rr=class jT extends Mi{constructor(n=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=n,c()&&(this.destroyRef=Qe(lh,{optional:!0})??void 0,this.pendingTasks=Qe(ol,{optional:!0})??void 0)}emit(n){const t=cn(null);try{super.next(n)}finally{cn(t)}}subscribe(n,t,r){let i=n,l=t||(()=>null),u=r;if(n&&"object"==typeof n){const x=n;i=x.next?.bind(x),l=x.error?.bind(x),u=x.complete?.bind(x)}this.__isAsync&&(l=this.wrapInTimeout(l),i&&(i=this.wrapInTimeout(i)),u&&(u=this.wrapInTimeout(u)));const g=super.subscribe({next:i,error:l,complete:u});return n instanceof os&&n.add(g),g}wrapInTimeout(n){return t=>{const r=this.pendingTasks?.add();setTimeout(()=>{n(t),void 0!==r&&this.pendingTasks?.remove(r)})}}};function MP(){return this._results[Symbol.iterator]()}class $T{static#e=Symbol.iterator;get changes(){return this._changes??=new rr}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const t=$T.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=MP)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){this.dirty=!1;const r=function nl(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function Hm(e,n,t){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],l=n[r];if(t&&(i=t(i),l=t(l)),l!==i)return!1}return!0}(this._results,r,t))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function dy(e){return!(128&~e.flags)}const GT=new Map;let iM=0;const hy="__ngContext__";function wl(e,n){nr(n)?(e[hy]=n[wt],function oM(e){GT.set(e[wt],e)}(n)):e[hy]=n}function cM(e){return uM(e[et])}function fg(e){return uM(e[ve])}function uM(e){for(;null!==e&&!Mr(e);)e=e[ve];return e}let wb;const Xl=new vn("",{providedIn:"root",factory:()=>gM}),gM="ng",_M=new vn(""),Dp=new vn("",{providedIn:"platform",factory:()=>"unknown"}),yM=new vn("",{providedIn:"root",factory:()=>function ch(){if(void 0!==wb)return wb;if(typeof document<"u")return document;throw new ln(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let sE=()=>null;function wy(e,n,t=!1){return sE(e,n,t)}const SM=new vn("",{providedIn:"root",factory:()=>!1});let Ku,Sy;function gg(){if(void 0===Ku&&(Ku=null,bi.trustedTypes))try{Ku=bi.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Ku}function uh(e){return gg()?.createHTML(e)||e}function AM(e){return function Rb(){if(void 0===Sy&&(Sy=null,bi.trustedTypes))try{Sy=bi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Sy}()?.createScriptURL(e)||e}class Ip{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${P1})`}}class Nb extends Ip{getTypeName(){return"HTML"}}class IM extends Ip{getTypeName(){return"Style"}}class VP extends Ip{getTypeName(){return"Script"}}class kM extends Ip{getTypeName(){return"URL"}}class hE extends Ip{getTypeName(){return"ResourceURL"}}function pc(e){return e instanceof Ip?e.changingThisBreaksApplicationSecurity:e}function Ju(e,n){const t=function OM(e){return e instanceof Ip&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${P1})`)}return t===n}class LM{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const t=(new window.DOMParser).parseFromString(uh(n),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(n):(t.removeChild(t.firstChild),t)}catch{return null}}}class BM{constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){const t=this.inertDocument.createElement("template");return t.innerHTML=uh(n),t}}const HP=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Fb(e){return(e=String(e)).match(HP)?e:"unsafe:"+e}function Cf(e){const n={};for(const t of e.split(","))n[t]=!0;return n}function Dy(...e){const n={};for(const t of e)for(const r in t)t.hasOwnProperty(r)&&(n[r]=!0);return n}const zM=Cf("area,br,col,hr,img,wbr"),UM=Cf("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),VM=Cf("rp,rt"),fE=Dy(zM,Dy(UM,Cf("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Dy(VM,Cf("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Dy(VM,UM)),pE=Cf("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),mE=Dy(pE,Cf("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Cf("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),qP=Cf("script,style,template");class ZP{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let t=n.firstChild,r=!0,i=[];for(;t;)if(t.nodeType===Node.ELEMENT_NODE?r=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,r&&t.firstChild)i.push(t),t=jM(t);else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let l=Lb(t);if(l){t=l;break}t=i.pop()}return this.buf.join("")}startElement(n){const t=gE(n).toLowerCase();if(!fE.hasOwnProperty(t))return this.sanitizedSomething=!0,!qP.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const r=n.attributes;for(let i=0;i<r.length;i++){const l=r.item(i),u=l.name,g=u.toLowerCase();if(!mE.hasOwnProperty(g)){this.sanitizedSomething=!0;continue}let x=l.value;pE[g]&&(x=Fb(x)),this.buf.push(" ",u,'="',yE(x),'"')}return this.buf.push(">"),!0}endElement(n){const t=gE(n).toLowerCase();fE.hasOwnProperty(t)&&!zM.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(n){this.buf.push(yE(n))}}function Lb(e){const n=e.nextSibling;if(n&&e!==n.previousSibling)throw _E(n);return n}function jM(e){const n=e.firstChild;if(n&&function XP(e,n){return(e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}(e,n))throw _E(n);return n}function gE(e){const n=e.nodeName;return"string"==typeof n?n:"FORM"}function _E(e){return new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`)}const $M=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,HM=/([^\#-~ |!])/g;function yE(e){return e.replace(/&/g,"&amp;").replace($M,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(HM,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let My;function vE(e,n){let t=null;try{My=My||function o0(e){const n=new BM(e);return function $P(){try{return!!(new window.DOMParser).parseFromString(uh(""),"text/html")}catch{return!1}}()?new LM(n):n}(e);let r=n?String(n):"";t=My.getInertBodyElement(r);let i=5,l=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=l,l=t.innerHTML,t=My.getInertBodyElement(r)}while(r!==l);return uh((new ZP).sanitizeChildren(Bb(t)||t))}finally{if(t){const r=Bb(t)||t;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function Bb(e){return"content"in e&&function YP(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var Hc=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Hc||{});function _g(e){const n=Ay();return n?n.sanitize(Hc.URL,e)||"":Ju(e,"URL")?pc(e):Fb(Er(e))}function Sf(e){const n=Ay();if(n)return AM(n.sanitize(Hc.RESOURCE_URL,e)||"");if(Ju(e,"ResourceURL"))return AM(pc(e));throw new ln(904,!1)}function Mf(e){return function Cy(e){return gg()?.createScriptURL(e)||e}(e[0])}function Ay(){const e=en();return e&&e[we].sanitizer}const KP=/^>|^->|<!--|-->|--!>|<!-$/g,JP=/(<|>)/g,QP="\u200b$1\u200b";function mc(e){return e instanceof Function?e():e}var Af=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Af||{});let Gb;function Oy(e,n){return Gb(e,n)}function h0(e,n,t,r,i){if(null!=r){let l,u=!1;Mr(r)?l=r:nr(r)&&(u=!0,r=r[ge]);const g=qi(r);0===e&&null!==t?null==i?yg(n,t,g):If(n,t,g,i||null,!0):1===e&&null!==t?If(n,t,g,i||null,!0):2===e?function By(e,n,t){const r=Ny(e,n);r&&function oA(e,n,t,r){e.removeChild(n,t,r)}(e,r,n,t)}(n,g,u):3===e&&n.destroyNode(g),null!=l&&function IE(e,n,t,r,i){const l=t[Pn];l!==qi(t)&&h0(n,e,r,l,i);for(let g=Ar;g<t.length;g++){const x=t[g];zy(x[ae],x,e,n,r,l)}}(n,e,l,t,i)}}function qb(e,n){return e.createComment(function ZM(e){return e.replace(KP,n=>n.replace(JP,QP))}(n))}function Py(e,n,t){return e.createElement(n,t)}function rA(e,n){n[we].changeDetectionScheduler?.notify(8),zy(e,n,n[Ue],2,null,null)}function SE(e,n){const t=e[Cr],r=n[xe];(nr(r)||n[pt]!==r[xe][pt])&&(e[ce]|=ci.HasTransplantedViews),null===t?e[Cr]=[n]:t.push(n)}function Zb(e,n){const t=e[Cr],r=t.indexOf(n);t.splice(r,1)}function Ua(e,n){if(e.length<=Ar)return;const t=Ar+n,r=e[t];if(r){const i=r[qe];null!==i&&i!==e&&Zb(i,r),n>0&&(e[t-1][ve]=r[ve]);const l=zc(e,Ar+n);!function tA(e,n){rA(e,n),n[ge]=null,n[ye]=null}(r[ae],r);const u=l[Pe];null!==u&&u.detachView(l[ae]),r[xe]=null,r[ve]=null,r[ce]&=-129}return r}function f0(e,n){if(!(256&n[ce])){const t=n[Ue];t.destroyNode&&zy(e,n,t,3,null,null),function iR(e){let n=e[et];if(!n)return Xb(e[ae],e);for(;n;){let t=null;if(nr(n))t=n[et];else{const r=n[Ar];r&&(t=r)}if(!t){for(;n&&!n[ve]&&n!==e;)nr(n)&&Xb(n[ae],n),n=n[xe];null===n&&(n=e),nr(n)&&Xb(n[ae],n),t=n&&n[ve]}n=t}}(n)}}function Xb(e,n){if(256&n[ce])return;const t=cn(null);try{n[ce]&=-129,n[ce]|=256,n[fn]&&Nu(n[fn]),function sA(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let r=0;r<t.length;r+=2){const i=n[t[r]];if(!(i instanceof $_)){const l=t[r+1];if(Array.isArray(l))for(let u=0;u<l.length;u+=2){const g=i[l[u]],x=l[u+1];uc(4,g,x);try{x.call(g)}finally{uc(5,g,x)}}else{uc(4,i,l);try{l.call(i)}finally{uc(5,i,l)}}}}}(e,n),function Ry(e,n){const t=e.cleanup,r=n[Me];if(null!==t)for(let l=0;l<t.length-1;l+=2)if("string"==typeof t[l]){const u=t[l+3];u>=0?r[u]():r[-u].unsubscribe(),l+=2}else t[l].call(r[t[l+1]]);null!==r&&(n[Me]=null);const i=n[Qt];if(null!==i){n[Qt]=null;for(let l=0;l<i.length;l++)(0,i[l])()}}(e,n),1===n[ae].type&&n[Ue].destroy();const r=n[qe];if(null!==r&&Mr(n[xe])){r!==n[xe]&&Zb(r,n);const i=n[Pe];null!==i&&i.detachView(e)}!function Sp(e){GT.delete(e[wt])}(n)}finally{cn(t)}}function Yb(e,n,t){return function yu(e,n,t){let r=n;for(;null!==r&&168&r.type;)r=(n=r).parent;if(null===r)return t[ge];{const{componentOffset:i}=r;if(i>-1){const{encapsulation:l}=e.data[r.directiveStart+i];if(l===Fa.None||l===Fa.Emulated)return null}return ho(r,t)}}(e,n.parent,t)}function If(e,n,t,r,i){e.insertBefore(n,t,r,i)}function yg(e,n,t){e.appendChild(n,t)}function kf(e,n,t,r,i){null!==r?If(e,n,t,r,i):yg(e,n,t)}function Ny(e,n){return e.parentNode(n)}function Fy(e,n,t){return lA(e,n,t)}let ME,lA=function aA(e,n,t){return 40&e.type?ho(e,t):null};function p0(e,n,t,r){const i=Yb(e,r,n),l=n[Ue],g=Fy(r.parent||n[ye],r,n);if(null!=i)if(Array.isArray(t))for(let x=0;x<t.length;x++)kf(l,i,t[x],g,!1);else kf(l,i,t,g,!1);void 0!==ME&&ME(l,r,n,t,i)}function m0(e,n){if(null!==n){const t=n.type;if(3&t)return ho(n,e);if(4&t)return Ly(-1,e[n.index]);if(8&t){const r=n.child;if(null!==r)return m0(e,r);{const i=e[n.index];return Mr(i)?Ly(-1,i):qi(i)}}if(32&t)return Oy(n,e)()||qi(e[n.index]);{const r=AE(e,n);return null!==r?Array.isArray(r)?r[0]:m0(Zu(e[pt]),r):m0(e,n.next)}}return null}function AE(e,n){return null!==n?e[pt][ye].projection[n.projection]:null}function Ly(e,n){const t=Ar+e+1;if(t<n.length){const r=n[t],i=r[ae].firstChild;if(null!==i)return m0(r,i)}return n[Pn]}function fh(e,n,t,r,i,l,u){for(;null!=t;){if(128===t.type){t=t.next;continue}const g=r[t.index],x=t.type;if(u&&0===n&&(g&&wl(qi(g),r),t.flags|=2),32&~t.flags)if(8&x)fh(e,n,t.child,r,i,l,!1),h0(n,e,i,g,l);else if(32&x){const E=Oy(t,r);let D;for(;D=E();)h0(n,e,i,D,l);h0(n,e,i,g,l)}else 16&x?Uy(e,n,r,t,i,l):h0(n,e,i,g,l);t=u?t.projectionNext:t.next}}function zy(e,n,t,r,i,l){fh(t,r,e.firstChild,n,i,l,!1)}function Uy(e,n,t,r,i,l){const u=t[pt],x=u[ye].projection[r.projection];if(Array.isArray(x))for(let E=0;E<x.length;E++)h0(n,e,i,x[E],l);else{let E=x;const D=u[xe];dy(r)&&(E.flags|=128),fh(e,n,E,D,i,l,!0)}}function kp(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function kE(e,n,t){const{mergedAttrs:r,classes:i,styles:l}=t;null!==r&&j1(e,n,r),null!==i&&kp(e,n,i),null!==l&&function uA(e,n,t){e.setAttribute(n,"style",t)}(e,n,l)}const ti={};function W(e=1){dA(gi(),en(),to()+e,!1)}function dA(e,n,t,r){if(!r)if(3&~n[ce]){const l=e.preOrderHooks;null!==l&&bf(n,l,0,t)}else{const l=e.preOrderCheckHooks;null!==l&&ql(n,l,t)}lg(t)}function ut(e,n=wi.Default){const t=en();return null===t?$n(e,n):ry(us(),t,Pr(e),n)}function y0(e,n,t,r,i,l){const u=cn(null);try{let g=null;i&qd.SignalBased&&(g=n[r][ss]),null!==g&&void 0!==g.transformFn&&(l=g.transformFn(l)),i&qd.HasDecoratorInputTransform&&(l=e.inputTransforms[r].call(n,l)),null!==e.setInput?e.setInput(n,g,l,t,r):Zx(n,g,r,l)}finally{cn(u)}}function xg(e,n,t,r,i,l,u,g,x,E,D){const R=n.blueprint.slice();return R[ge]=i,R[ce]=204|r,(null!==E||e&&2048&e[ce])&&(R[ce]|=2048),Jx(R),R[xe]=R[Mt]=e,R[Le]=t,R[we]=u||e&&e[we],R[Ue]=g||e&&e[Ue],R[Se]=x||e&&e[Se]||null,R[ye]=l,R[wt]=function sM(){return iM++}(),R[Ce]=D,R[Et]=E,R[pt]=2==n.type?e[pt]:R,R}function bg(e,n,t,r,i){let l=e.data[n];if(null===l)l=function OE(e,n,t,r,i){const l=bT(),u=tb(),x=e.data[n]=function nw(e,n,t,r,i,l){let u=n?n.injectorIndex:-1,g=0;return xf()&&(g|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:u,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:g,providerIndexes:0,value:i,attrs:l,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,u?l:l&&l.parent,t,n,r,i);return null===e.firstChild&&(e.firstChild=x),null!==l&&(u?null==l.child&&null!==x.parent&&(l.child=x):null===l.next&&(l.next=x,x.prev=l)),x}(e,n,t,r,i),function vl(){return Br.lFrame.inI18n}()&&(l.flags|=32);else if(64&l.type){l.type=t,l.value=r,l.attrs=i;const u=function U_(){const e=Br.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();l.injectorIndex=null===u?-1:u.injectorIndex}return hu(l,!0),l}function ph(e,n,t,r){if(0===t)return-1;const i=n.length;for(let l=0;l<t;l++)n.push(r),e.blueprint.push(r),e.data.push(null);return i}function jy(e,n,t,r,i){const l=to(),u=2&r;try{lg(-1),u&&n.length>xt&&dA(e,n,xt,!1),uc(u?2:0,i),t(r,i)}finally{lg(l),uc(u?3:1,i)}}function PE(e,n,t){if(yr(n)){const r=cn(null);try{const l=n.directiveEnd;for(let u=n.directiveStart;u<l;u++){const g=e.data[u];g.contentQueries&&g.contentQueries(1,t[u],u)}}finally{cn(r)}}}function Jb(e,n,t){K1()&&(function Pp(e,n,t,r){const i=t.directiveStart,l=t.directiveEnd;mr(t)&&function _c(e,n,t){const r=ho(n,e),i=hA(t);let u=16;t.signals?u=4096:t.onPush&&(u=64);const g=iw(e,xg(e,i,null,u,r,n,null,e[we].rendererFactory.createRenderer(r,t),null,null,null));e[n.index]=g}(n,t,e.data[i+t.componentOffset]),e.firstCreatePass||ty(t,n),wl(r,n);const u=t.initialInputs;for(let g=i;g<l;g++){const x=e.data[g],E=ug(n,e,g,t);wl(E,n),null!==u&&ed(0,g-i,E,x,0,u),Sr(x)&&(Zo(t.index,n)[Le]=ug(n,e,g,t))}}(e,n,t,ho(t,n)),!(64&~t.flags)&&Gy(e,n,t))}function Qb(e,n,t=ho){const r=n.localNames;if(null!==r){let i=n.index+1;for(let l=0;l<r.length;l+=2){const u=r[l+1],g=-1===u?t(n,e):e[u];e[i++]=g}}}function hA(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=ew(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function ew(e,n,t,r,i,l,u,g,x,E,D){const R=xt+r,L=R+i,V=function oR(e,n){const t=[];for(let r=0;r<n;r++)t.push(r<e?null:ti);return t}(R,L),Y="function"==typeof E?E():E;return V[ae]={type:e,blueprint:V,template:t,queries:null,viewQuery:g,declTNode:n,data:V.slice().fill(null,R),bindingStartIndex:R,expandoStartIndex:L,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof l?l():l,pipeRegistry:"function"==typeof u?u():u,firstChild:null,schemas:x,consts:Y,incompleteFirstPass:!1,ssrId:D}}let RE=()=>null;function $y(e,n,t,r,i){for(let l in n){if(!n.hasOwnProperty(l))continue;const u=n[l];if(void 0===u)continue;r??={};let g,x=qd.None;Array.isArray(u)?(g=u[0],x=u[1]):g=u;let E=l;if(null!==i){if(!i.hasOwnProperty(l))continue;E=i[l]}0===e?Hy(r,t,E,g,x):Hy(r,t,E,g)}return r}function Hy(e,n,t,r,i){let l;e.hasOwnProperty(t)?(l=e[t]).push(n,r):l=e[t]=[n,r],void 0!==i&&l.push(i)}function Tl(e,n,t,r,i,l,u,g){const x=ho(n,t);let D,E=n.inputs;!g&&null!=E&&(D=E[r])?(jE(e,t,D,r,i),mr(n)&&function v0(e,n){const t=Zo(n,e);16&t[ce]||(t[ce]|=64)}(t,n.index)):3&n.type&&(r=function NE(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=u?u(i,n.value||"",r):i,l.setProperty(x,r,i))}function gc(e,n,t,r){if(K1()){const i=null===r?null:{"":-1},l=function rw(e,n){const t=e.directiveRegistry;let r=null,i=null;if(t)for(let l=0;l<t.length;l++){const u=t[l];if(G1(n,u.selectors,!1))if(r||(r=[]),Sr(u))if(null!==u.findHostDirectiveDefs){const g=[];i=i||new Map,u.findHostDirectiveDefs(u,g,i),r.unshift(...g,u),LE(e,n,g.length)}else r.unshift(u),LE(e,n,0);else i=i||new Map,u.findHostDirectiveDefs?.(u,r,i),r.push(u)}return null===r?null:[r,i]}(e,t);let u,g;null===l?u=g=null:[u,g]=l,null!==u&&Qu(e,n,t,u,i,g),i&&function x0(e,n,t){if(n){const r=e.localNames=[];for(let i=0;i<n.length;i+=2){const l=t[n[i+1]];if(null==l)throw new ln(-301,!1);r.push(n[i],l)}}}(t,r,i)}t.mergedAttrs=Zd(t.mergedAttrs,t.attrs)}function Qu(e,n,t,r,i,l){for(let E=0;E<r.length;E++)cb(ty(t,n),e,r[E].type);!function zE(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,r.length);for(let E=0;E<r.length;E++){const D=r[E];D.providersResolver&&D.providersResolver(D)}let u=!1,g=!1,x=ph(e,n,r.length,null);for(let E=0;E<r.length;E++){const D=r[E];t.mergedAttrs=Zd(t.mergedAttrs,D.hostAttrs),Wy(e,t,n,x,D),BE(x,D,i),null!==D.contentQueries&&(t.flags|=4),(null!==D.hostBindings||null!==D.hostAttrs||0!==D.hostVars)&&(t.flags|=64);const R=D.type.prototype;!u&&(R.ngOnChanges||R.ngOnInit||R.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),u=!0),!g&&(R.ngOnChanges||R.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),g=!0),x++}!function uR(e,n,t){const i=n.directiveEnd,l=e.data,u=n.attrs,g=[];let x=null,E=null;for(let D=n.directiveStart;D<i;D++){const R=l[D],L=t?t.get(R):null,Y=L?L.outputs:null;x=$y(0,R.inputs,D,x,L?L.inputs:null),E=$y(1,R.outputs,D,E,Y);const G=null===x||null===u||Zm(n)?null:dR(x,D,u);g.push(G)}null!==x&&(x.hasOwnProperty("class")&&(n.flags|=8),x.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=g,n.inputs=x,n.outputs=E}(e,t,l)}function Gy(e,n,t){const r=t.directiveStart,i=t.directiveEnd,l=t.index,u=function ET(){return Br.lFrame.currentDirectiveIndex}();try{lg(l);for(let g=r;g<i;g++){const x=e.data[g],E=n[g];nb(g),(null!==x.hostBindings||0!==x.hostVars||null!==x.hostAttrs)&&pA(x,E)}}finally{lg(-1),nb(u)}}function pA(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function LE(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function BE(e,n,t){if(t){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)t[n.exportAs[r]]=e;Sr(n)&&(t[""]=e)}}function Wy(e,n,t,r,i){e.data[r]=i;const l=i.factory||(i.factory=Bc(i.type)),u=new $_(l,Sr(i),ut);e.blueprint[r]=u,t[r]=u,function Op(e,n,t,r,i){const l=i.hostBindings;if(l){let u=e.hostBindingOpCodes;null===u&&(u=e.hostBindingOpCodes=[]);const g=~n.index;(function mh(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(u)!=g&&u.push(g),u.push(t,r,l)}}(e,n,r,ph(e,t,i.hostVars,ti),i)}function xu(e,n,t,r,i,l){const u=ho(e,n);!function qy(e,n,t,r,i,l,u){if(null==l)e.removeAttribute(n,i,t);else{const g=null==u?Er(l):u(l,r||"",i);e.setAttribute(n,i,g,t)}}(n[Ue],u,l,e.value,t,r,i)}function ed(e,n,t,r,i,l){const u=l[n];if(null!==u)for(let g=0;g<u.length;)y0(r,t,u[g++],u[g++],u[g++],u[g++])}function dR(e,n,t){let r=null,i=0;for(;i<t.length;){const l=t[i];if(0!==l)if(5!==l){if("number"==typeof l)break;if(e.hasOwnProperty(l)){null===r&&(r=[]);const u=e[l];for(let g=0;g<u.length;g+=3)if(u[g]===n){r.push(l,u[g+1],u[g+2],t[i+1]);break}}i+=2}else i+=2;else i+=4}return r}function UE(e,n,t,r){return[e,!0,0,n,null,r,null,t,null,null]}function Zy(e,n){const t=e.contentQueries;if(null!==t){const r=cn(null);try{for(let i=0;i<t.length;i+=2){const u=t[i+1];if(-1!==u){const g=e.data[u];rb(t[i]),g.contentQueries(2,n[u],u)}}}finally{cn(r)}}}function iw(e,n){return e[et]?e[Fe][ve]=n:e[et]=n,e[Fe]=n,n}function VE(e,n,t){rb(0);const r=cn(null);try{n(e,t)}finally{cn(r)}}function mA(e){return e[Me]??=[]}function gA(e){return e.cleanup??=[]}function sw(e,n){const t=e[Se],r=t?t.get(Po,null):null;r&&r.handleError(n)}function jE(e,n,t,r,i){for(let l=0;l<t.length;){const u=t[l++],g=t[l++],x=t[l++];y0(e.data[u],n[u],r,g,x,i)}}function Of(e,n,t){const r=bp(n,e);!function hh(e,n,t){e.setValue(n,t)}(e[Ue],r,t)}function hR(e,n){const t=Zo(n,e),r=t[ae];!function fR(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(r,t);const i=t[ge];null!==i&&null===t[Ce]&&(t[Ce]=wy(i,t[Se])),$E(r,t,t[Le])}function $E(e,n,t){Q1(n);try{const r=e.viewQuery;null!==r&&VE(1,r,t);const i=e.template;null!==i&&jy(e,n,i,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),n[Pe]?.finishViewCreation(e),e.staticContentQueries&&Zy(e,n),e.staticViewQueries&&VE(2,e.viewQuery,t);const l=e.components;null!==l&&function Gc(e,n){for(let t=0;t<n.length;t++)hR(e,n[t])}(n,l)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{n[ce]&=-5,sh()}}function gh(e,n,t,r){const i=cn(null);try{const l=n.tView,x=xg(e,l,t,4096&e[ce]?4096:16,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null);x[qe]=e[n.index];const D=e[Pe];return null!==D&&(x[Pe]=D.createEmbeddedView(l)),$E(l,x,t),x}finally{cn(i)}}function yA(e,n){const t=Ar+n;if(t<e.length)return e[t]}function Rp(e,n){return!n||null===n.firstChild||dy(e)}function wg(e,n,t,r=!0){const i=n[ae];if(function iA(e,n,t,r){const i=Ar+r,l=t.length;r>0&&(t[i-1][ve]=n),r<l-Ar?(n[ve]=t[i],ml(t,Ar+r,n)):(t.push(n),n[ve]=null),n[xe]=t;const u=n[qe];null!==u&&t!==u&&SE(u,n);const g=n[Pe];null!==g&&g.insertView(e),L_(n),n[ce]|=128}(i,n,e,t),r){const u=Ly(t,e),g=n[Ue],x=Ny(g,e[Pn]);null!==x&&function nA(e,n,t,r,i,l){r[ge]=i,r[ye]=n,zy(e,r,t,1,i,l)}(i,e[ye],g,n,x,u)}const l=n[Ce];null!==l&&null!==l.firstChild&&(l.firstChild=null)}function HE(e,n){const t=Ua(e,n);return void 0!==t&&f0(t[ae],t),t}function b0(e,n,t,r,i=!1){for(;null!==t;){if(128===t.type){t=i?t.projectionNext:t.next;continue}const l=n[t.index];null!==l&&r.push(qi(l)),Mr(l)&&GE(l,r);const u=t.type;if(8&u)b0(e,n,t.child,r);else if(32&u){const g=Oy(t,n);let x;for(;x=g();)r.push(x)}else if(16&u){const g=AE(n,t);if(Array.isArray(g))r.push(...g);else{const x=Zu(n[pt]);b0(x[ae],x,g,r,!0)}}t=i?t.projectionNext:t.next}return r}function GE(e,n){for(let t=Ar;t<e.length;t++){const r=e[t],i=r[ae].firstChild;null!==i&&b0(r[ae],r,i,n)}e[Pn]!==e[ge]&&n.push(e[Pn])}let WE=[];const Zs={...ii,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{B_(e.lView)},consumerOnSignalRead(){this.lView[fn]=this}},Xy={...ii,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{let n=Zu(e.lView);for(;n&&!T0(n[ae]);)n=Zu(n);n&&Qx(n)},consumerOnSignalRead(){this.lView[fn]=this}};function T0(e){return 2!==e.type}const xA=100;function ow(e,n=!0,t=0){const r=e[we],i=r.rendererFactory;i.begin?.();try{!function gR(e,n){const t=$D();try{V_(!0),qE(e,n);let r=0;for(;ig(e);){if(r===xA)throw new ln(103,!1);r++,qE(e,1)}}finally{V_(t)}}(e,t)}catch(u){throw n&&sw(e,u),u}finally{i.end?.(),r.inlineEffectRunner?.flush()}}function td(e,n,t,r){const i=n[ce];if(!(256&~i))return;n[we].inlineEffectRunner?.flush(),Q1(n);let g=!0,x=null,E=null;T0(e)?(E=function pR(e){return e[fn]??function mR(e){const n=WE.pop()??Object.create(Zs);return n.lView=e,n}(e)}(n),x=Oi(E)):null===function Hr(){return ao}()?(g=!1,E=function w0(e){const n=e[fn]??Object.create(Xy);return n.lView=e,n}(n),x=Oi(E)):n[fn]&&(Nu(n[fn]),n[fn]=null);try{Jx(n),function J1(e){return Br.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&jy(e,n,t,2,r);const D=!(3&~i);if(D){const V=e.preOrderCheckHooks;null!==V&&ql(n,V,null)}else{const V=e.preOrderHooks;null!==V&&bf(n,V,0,null),wf(n,0)}if(function _R(e){for(let n=cM(e);null!==n;n=fg(n)){if(!(n[ce]&ci.HasTransplantedViews))continue;const t=n[Cr];for(let r=0;r<t.length;r++)Qx(t[r])}}(n),lw(n,0),null!==e.contentQueries&&Zy(e,n),D){const V=e.contentCheckHooks;null!==V&&ql(n,V)}else{const V=e.contentHooks;null!==V&&bf(n,V,1),wf(n,1)}!function Vy(e,n){const t=e.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const i=t[r];if(i<0)lg(~i);else{const l=i,u=t[++r],g=t[++r];TT(u,l),g(2,n[l])}}}finally{lg(-1)}}(e,n);const R=e.components;null!==R&&wA(n,R,0);const L=e.viewQuery;if(null!==L&&VE(2,L,r),D){const V=e.viewCheckHooks;null!==V&&ql(n,V)}else{const V=e.viewHooks;null!==V&&bf(n,V,2),wf(n,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[sn]){for(const V of n[sn])V();n[sn]=null}n[ce]&=-73}catch(D){throw B_(n),D}finally{null!==E&&(lo(E,x),g&&function vA(e){e.lView[fn]!==e&&(e.lView=null,WE.push(e))}(E)),sh()}}function lw(e,n){for(let t=cM(e);null!==t;t=fg(t))for(let r=Ar;r<t.length;r++)bA(t[r],n)}function nd(e,n,t){bA(Zo(n,e),t)}function bA(e,n){F_(e)&&qE(e,n)}function qE(e,n){const r=e[ae],i=e[ce],l=e[fn];let u=!!(0===n&&16&i);if(u||=!!(64&i&&0===n),u||=!!(1024&i),u||=!(!l?.dirty||!Sa(l)),u||=!1,l&&(l.dirty=!1),e[ce]&=-9217,u)td(r,e,r.template,e[Le]);else if(8192&i){lw(e,1);const g=r.components;null!==g&&wA(e,g,1)}}function wA(e,n,t){for(let r=0;r<n.length;r++)nd(e,n[r],t)}function El(e,n){const t=$D()?64:1088;for(e[we].changeDetectionScheduler?.notify(n);e;){e[ce]|=t;const r=Zu(e);if(Tr(e)&&!r)return e;e=r}return null}class Yy{get rootNodes(){const n=this._lView,t=n[ae];return b0(t,n,t.firstChild,[])}constructor(n,t,r=!0){this._lView=n,this._cdRefInjectingView=t,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Le]}set context(n){this._lView[Le]=n}get destroyed(){return!(256&~this._lView[ce])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[xe];if(Mr(n)){const t=n[8],r=t?t.indexOf(this):-1;r>-1&&(Ua(n,r),zc(t,r))}this._attachedToViewContainer=!1}f0(this._lView[ae],this._lView)}onDestroy(n){z_(this._lView,n)}markForCheck(){El(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[ce]&=-129}reattach(){L_(this._lView),this._lView[ce]|=128}detectChanges(){this._lView[ce]|=1024,ow(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ln(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const n=Tr(this._lView),t=this._lView[qe];null!==t&&!n&&Zb(t,this._lView),rA(this._lView[ae],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new ln(902,!1);this._appRef=n;const t=Tr(this._lView),r=this._lView[qe];null!==r&&!t&&SE(r,this._lView),L_(this._lView)}}let ui=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=XE}return e})();const yR=ui,ZE=class extends yR{constructor(n,t,r){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,r){const i=gh(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:t,dehydratedView:r});return new Yy(i)}};function XE(){return Np(us(),en())}function Np(e,n){return 4&e.type?new ZE(n,e,Cp(e,n)):null}let lv=()=>null;function zp(e,n){return lv(e,n)}class Mg{}const cv=new vn("",{providedIn:"root",factory:()=>!1}),WA=new vn("");class qA{}class Up{}class PR{resolveComponentFactory(n){throw function pC(e){const n=Error(`No component factory found for ${wo(e)}.`);return n.ngComponent=e,n}(n)}}class vw{static#e=this.NULL=new PR}class mC{}let id=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function RR(){const e=en(),t=Zo(us().index,e);return(nr(t)?t:e)[Ue]}()}return e})(),NR=(()=>{class e{static#e=this.\u0275prov=It({token:e,providedIn:"root",factory:()=>null})}return e})();const Vp=new Set;function Cl(e){Vp.has(e)||(Vp.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function gC(e){let n=!0;return setTimeout(()=>{n&&(n=!1,e())}),"function"==typeof bi.requestAnimationFrame&&bi.requestAnimationFrame(()=>{n&&(n=!1,e())}),()=>{n=!1}}function _C(e){let n=!0;return queueMicrotask(()=>{n&&e()}),()=>{n=!1}}function yC(...e){}class ni{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new rr(!1),this.onMicrotaskEmpty=new rr(!1),this.onStable=new rr(!1),this.onError=new rr(!1),typeof Zone>"u")throw new ln(908,!1);Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.callbackScheduled=!1,function LR(e){const n=()=>{!function YA(e){e.isCheckStableRunning||e.callbackScheduled||(e.callbackScheduled=!0,Zone.root.run(()=>{gC(()=>{e.callbackScheduled=!1,xw(e),e.isCheckStableRunning=!0,xC(e),e.isCheckStableRunning=!1})}),xw(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,l,u,g)=>{if(function uv(e){return wC(e,"__ignore_ng_zone__")}(g))return t.invokeTask(i,l,u,g);try{return bw(e),t.invokeTask(i,l,u,g)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===l.type||e.shouldCoalesceRunChangeDetection)&&n(),ww(e)}},onInvoke:(t,r,i,l,u,g,x)=>{try{return bw(e),t.invoke(i,l,u,g,x)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!function bC(e){return wC(e,"__scheduler_tick__")}(g)&&n(),ww(e)}},onHasTask:(t,r,i,l)=>{t.hasTask(i,l),r===i&&("microTask"==l.change?(e._hasPendingMicrotasks=l.microTask,xw(e),xC(e)):"macroTask"==l.change&&(e.hasPendingMacrotasks=l.macroTask))},onHandleError:(t,r,i,l)=>(t.handleError(i,l),e.runOutsideAngular(()=>e.onError.emit(l)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ni.isInAngularZone())throw new ln(909,!1)}static assertNotInAngularZone(){if(ni.isInAngularZone())throw new ln(909,!1)}run(n,t,r){return this._inner.run(n,t,r)}runTask(n,t,r,i){const l=this._inner,u=l.scheduleEventTask("NgZoneEvent: "+i,n,FR,yC,yC);try{return l.runTask(u,t,r)}finally{l.cancelTask(u)}}runGuarded(n,t,r){return this._inner.runGuarded(n,t,r)}runOutsideAngular(n){return this._outer.run(n)}}const FR={};function xC(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function xw(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&!0===e.callbackScheduled)}function bw(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ww(e){e._nesting--,xC(e)}class Tw{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new rr,this.onMicrotaskEmpty=new rr,this.onStable=new rr,this.onError=new rr}run(n,t,r){return n.apply(t,r)}runGuarded(n,t,r){return n.apply(t,r)}runOutsideAngular(n){return n()}runTask(n,t,r,i){return n.apply(t,r)}}function wC(e,n){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0]?.data?.[n]}var s=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(s||{});const a={destroy(){}};function m(e,n){!n&&function p(e){if(!c())throw new ln(-203,!1)}();const t=n?.injector??Qe(zs);return function Vs(e){return"browser"===(e??Qe(zs)).get(Dp)}(t)?(Cl("NgAfterNextRender"),function b(e,n,t,r){const i=function _(e,n){if(e instanceof Function)switch(n){case s.EarlyRead:return{earlyRead:e};case s.Write:return{write:e};case s.MixedReadWrite:return{mixedReadWrite:e};case s.Read:return{read:e}}return e}(e,r),l=n.get(A),u=l.handler??=new S,g=[],x=[],E=()=>{for(const V of x)u.unregister(V);D()},D=n.get(lh).onDestroy(E);let R=0;const L=(V,Y)=>{if(!Y)return;const G=t?(...he)=>(R--,R<1&&E(),Y(...he)):Y,Q=y(n,()=>new T(V,g,G));u.register(Q),x.push(Q),R++};return L(s.EarlyRead,i.earlyRead),L(s.Write,i.write),L(s.MixedReadWrite,i.mixedReadWrite),L(s.Read,i.read),{destroy:E}}(e,t,!0,n?.phase??s.MixedReadWrite)):a}class T{constructor(n,t,r){this.phase=n,this.pipelinedArgs=t,this.callbackFn=r,this.zone=Qe(ni),this.errorHandler=Qe(Po,{optional:!0}),Qe(Mg,{optional:!0})?.notify(6)}invoke(){try{const n=this.zone.runOutsideAngular(()=>this.callbackFn.apply(null,this.pipelinedArgs));this.pipelinedArgs.splice(0,this.pipelinedArgs.length,n)}catch(n){this.errorHandler?.handleError(n)}}}class S{constructor(){this.executingCallbacks=!1,this.buckets={[s.EarlyRead]:new Set,[s.Write]:new Set,[s.MixedReadWrite]:new Set,[s.Read]:new Set},this.deferredCallbacks=new Set}register(n){(this.executingCallbacks?this.deferredCallbacks:this.buckets[n.phase]).add(n)}unregister(n){this.buckets[n.phase].delete(n),this.deferredCallbacks.delete(n)}execute(){this.executingCallbacks=!0;for(const n of Object.values(this.buckets))for(const t of n)t.invoke();this.executingCallbacks=!1;for(const n of this.deferredCallbacks)this.buckets[n.phase].add(n);this.deferredCallbacks.clear()}destroy(){for(const n of Object.values(this.buckets))n.clear();this.deferredCallbacks.clear()}}let A=(()=>{class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){const t=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const r of t)r()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=It({token:e,providedIn:"root",factory:()=>new e})}return e})();function De(e,n,t){let r=t?e.styles:null,i=t?e.classes:null,l=0;if(null!==n)for(let u=0;u<n.length;u++){const g=n[u];"number"==typeof g?l=g:1==l?i=Pm(i,g):2==l&&(r=Pm(r,g+": "+n[++u]+";"))}t?e.styles=r:e.stylesWithoutHost=r,t?e.classes=i:e.classesWithoutHost=i}class Be extends vw{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=di(n);return new Ke(t,this.ngModule)}}function Ze(e,n){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const i=e[r];if(void 0===i)continue;const l=Array.isArray(i),u=l?i[0]:i;t.push(n?{propName:u,templateName:r,isSignal:!!((l?i[1]:qd.None)&qd.SignalBased)}:{propName:u,templateName:r})}return t}class Ke extends Up{get inputs(){const n=this.componentDef,t=n.inputTransforms,r=Ze(n.inputs,!0);if(null!==t)for(const i of r)t.hasOwnProperty(i.propName)&&(i.transform=t[i.propName]);return r}get outputs(){return Ze(this.componentDef.outputs,!1)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function S_(e){return e.map(Jm).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,r,i){const l=cn(null);try{let u=(i=i||this.ngModule)instanceof Go?i:i?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const g=u?new Ef(n,u):n,x=g.get(mC,null);if(null===x)throw new ln(407,!1);const E=g.get(NR,null),L={rendererFactory:x,sanitizer:E,inlineEffectRunner:null,afterRenderEventManager:g.get(A,null),changeDetectionScheduler:g.get(Mg,null)},V=x.createRenderer(null,this.componentDef),Y=this.componentDef.selectors[0][0]||"div",G=r?function fA(e,n,t,r){const l=r.get(SM,!1)||t===Fa.ShadowDom,u=e.selectRootElement(n,l);return function aR(e){RE(e)}(u),u}(V,r,this.componentDef.encapsulation,g):Py(V,Y,function ot(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(Y));let Q=512;this.componentDef.signals?Q|=4096:this.componentDef.onPush||(Q|=16);let he=null;null!==G&&(he=wy(G,g,!0));const le=ew(0,null,null,1,0,null,null,null,null,null,null),me=xg(null,le,null,Q,null,null,L,V,g,null,he);let ze,Je;Q1(me);try{const ht=this.componentDef;let Ne,dt=null;ht.findHostDirectiveDefs?(Ne=[],dt=new Map,ht.findHostDirectiveDefs(ht,Ne,dt),Ne.push(ht)):Ne=[ht];const ft=function Ft(e,n){const t=e[ae],r=xt;return e[r]=n,bg(t,r,2,"#host",null)}(me,G),kt=function yt(e,n,t,r,i,l,u){const g=i[ae];!function Wt(e,n,t,r){for(const i of e)n.mergedAttrs=Zd(n.mergedAttrs,i.hostAttrs);null!==n.mergedAttrs&&(De(n,n.mergedAttrs,!0),null!==t&&kE(r,t,n))}(r,e,n,u);let x=null;null!==n&&(x=wy(n,i[Se]));const E=l.rendererFactory.createRenderer(n,t);let D=16;t.signals?D=4096:t.onPush&&(D=64);const R=xg(i,hA(t),null,D,i[e.index],e,l,E,null,null,x);return g.firstCreatePass&&LE(g,e,r.length-1),iw(i,R),i[e.index]=R}(ft,G,ht,Ne,me,L,V);Je=rg(le,xt),G&&function Tt(e,n,t,r){if(r)j1(e,t,["ng-version","18.1.2"]);else{const{attrs:i,classes:l}=function Vx(e){const n=[],t=[];let r=1,i=2;for(;r<e.length;){let l=e[r];if("string"==typeof l)2===i?""!==l&&n.push(l,e[++r]):8===i&&t.push(l);else{if(!da(i))break;i=l}r++}return{attrs:n,classes:t}}(n.selectors[0]);i&&j1(e,t,i),l&&l.length>0&&kp(e,t,l.join(" "))}}(V,ht,G,r),void 0!==t&&function Kt(e,n,t){const r=e.projection=[];for(let i=0;i<n.length;i++){const l=t[i];r.push(null!=l?Array.from(l):null)}}(Je,this.ngContentSelectors,t),ze=function mt(e,n,t,r,i,l){const u=us(),g=i[ae],x=ho(u,i);Qu(g,i,u,t,null,r);for(let D=0;D<t.length;D++)wl(ug(i,g,u.directiveStart+D,u),i);Gy(g,i,u),x&&wl(x,i);const E=ug(i,g,u.directiveStart+u.componentOffset,u);if(e[Le]=i[Le]=E,null!==l)for(const D of l)D(E,n);return PE(g,u,i),E}(kt,ht,Ne,dt,me,[bt]),$E(le,me,null)}finally{sh()}return new _t(this.componentType,ze,Cp(Je,me),me,Je)}finally{cn(l)}}}class _t extends qA{constructor(n,t,r,i,l){super(),this.location=r,this._rootLView=i,this._tNode=l,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new Yy(i,void 0,!1),this.componentType=n}setInput(n,t){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const l=this._rootLView;jE(l[ae],l,i,n,t),this.previousInputValues.set(n,t),El(Zo(this._tNode.index,l),1)}}get injector(){return new Yo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function bt(){const e=us();Wl(en()[ae],e)}let Zt=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Xt}return e})();function Xt(){return tn(us(),en())}const Ut=Zt,Rn=class extends Ut{constructor(n,t,r){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=r}get element(){return Cp(this._hostTNode,this._hostLView)}get injector(){return new Yo(this._hostTNode,this._hostLView)}get parentInjector(){const n=G_(this._hostTNode,this._hostLView);if(mu(n)){const t=ga(n,this._hostLView),r=fc(n);return new Yo(t[ae].data[r+8],t)}return new Yo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=Mn(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-Ar}createEmbeddedView(n,t,r){let i,l;"number"==typeof r?i=r:null!=r&&(i=r.index,l=r.injector);const u=zp(this._lContainer,n.ssrId),g=n.createEmbeddedViewImpl(t||{},l,u);return this.insertImpl(g,i,Rp(this._hostTNode,u)),g}createComponent(n,t,r,i,l){const u=n&&!function B(e){return"function"==typeof e}(n);let g;if(u)g=t;else{const Y=t||{};g=Y.index,r=Y.injector,i=Y.projectableNodes,l=Y.environmentInjector||Y.ngModuleRef}const x=u?n:new Ke(di(n)),E=r||this.parentInjector;if(!l&&null==x.ngModule){const G=(u?E:this.parentInjector).get(Go,null);G&&(l=G)}const D=di(x.componentType??{}),R=zp(this._lContainer,D?.id??null),V=x.create(E,i,R?.firstChild??null,l);return this.insertImpl(V.hostView,g,Rp(this._hostTNode,R)),V}insert(n,t){return this.insertImpl(n,t,!0)}insertImpl(n,t,r){const i=n._lView;if(function Kx(e){return Mr(e[xe])}(i)){const g=this.indexOf(n);if(-1!==g)this.detach(g);else{const x=i[xe],E=new Rn(x,x[ye],x[xe]);E.detach(E.indexOf(n))}}const l=this._adjustIndex(t),u=this._lContainer;return wg(u,i,l,r),n.attachToViewContainerRef(),ml(hn(u),l,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=Mn(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),r=Ua(this._lContainer,t);r&&(zc(hn(this._lContainer),t),f0(r[ae],r))}detach(n){const t=this._adjustIndex(n,-1),r=Ua(this._lContainer,t);return r&&null!=zc(hn(this._lContainer),t)?new Yy(r):null}_adjustIndex(n,t=0){return n??this.length+t}};function Mn(e){return e[8]}function hn(e){return e[8]||(e[8]=[])}function tn(e,n){let t;const r=n[e.index];return Mr(r)?t=r:(t=UE(r,n,null,e),n[e.index]=t,iw(n,t)),kn(t,n,e,r),new Rn(t,e,n)}let kn=function ur(e,n,t,r){if(e[Pn])return;let i;i=8&t.type?qi(r):function Yn(e,n){const t=e[Ue],r=t.createComment(""),i=ho(n,e);return If(t,Ny(t,i),r,function Kb(e,n){return e.nextSibling(n)}(t,i),!1),r}(n,t),e[Pn]=i},xn=()=>!1;class Ir{constructor(n){this.queryList=n,this.matches=null}clone(){return new Ir(this.queryList)}setDirty(){this.queryList.setDirty()}}class Ti{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const r=null!==n.contentQueries?n.contentQueries[0]:t.length,i=[];for(let l=0;l<r;l++){const u=t.getByIndex(l);i.push(this.queries[u.indexInDeclarationView].clone())}return new Ti(i)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==yc(n,t).matches&&this.queries[t].setDirty()}}class Pi{constructor(n,t,r=null){this.flags=t,this.read=r,this.predicate="string"==typeof n?function Yl(e){return e.split(",").map(n=>n.trim())}(n):n}}class ar{constructor(n=[]){this.queries=n}elementStart(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let r=0;r<this.length;r++){const i=null!==t?t.length:0,l=this.getByIndex(r).embeddedTView(n,i);l&&(l.indexInDeclarationView=r,null!==t?t.push(l):t=[l])}return null!==t?new ar(t):null}template(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class ri{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new ri(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1&~this.metadata.flags){const t=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const l=r[i];this.matchTNodeWithReadOption(n,t,hi(t,l)),this.matchTNodeWithReadOption(n,t,W_(t,n,l,!1,!1))}else r===ui?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,W_(t,n,r,!1,!1))}matchTNodeWithReadOption(n,t,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===Li||i===Zt||i===ui&&4&t.type)this.addMatch(t.index,-2);else{const l=W_(t,n,i,!1,!1);null!==l&&this.addMatch(t.index,l)}else this.addMatch(t.index,r)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function hi(e,n){const t=e.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===n)return t[r+1];return null}function ks(e,n,t,r){return-1===t?function Zi(e,n){return 11&e.type?Cp(e,n):4&e.type?Np(e,n):null}(n,e):-2===t?function Xs(e,n,t){return t===Li?Cp(n,e):t===ui?Np(n,e):t===Zt?tn(n,e):void 0}(e,n,r):ug(e,e[ae],t,n)}function Ss(e,n,t,r){const i=n[Pe].queries[r];if(null===i.matches){const l=e.data,u=t.matches,g=[];for(let x=0;null!==u&&x<u.length;x+=2){const E=u[x];g.push(E<0?null:ks(n,l[E],u[x+1],t.metadata.read))}i.matches=g}return i.matches}function ls(e,n,t,r){const i=e.queries.getByIndex(t),l=i.matches;if(null!==l){const u=Ss(e,n,i,t);for(let g=0;g<l.length;g+=2){const x=l[g];if(x>0)r.push(u[g/2]);else{const E=l[g+1],D=n[-x];for(let R=Ar;R<D.length;R++){const L=D[R];L[qe]===L[xe]&&ls(L[ae],L,E,r)}if(null!==D[Cr]){const R=D[Cr];for(let L=0;L<R.length;L++){const V=R[L];ls(V[ae],V,E,r)}}}}}return r}function Ys(e,n,t){const r=new $T(!(4&~t));return function tw(e,n,t,r){const i=mA(n);i.push(t),e.firstCreatePass&&gA(e).push(r,i.length-1)}(e,n,r,r.destroy),(n[Pe]??=new Ti).queries.push(new Ir(r))-1}function wu(e,n,t){null===e.queries&&(e.queries=new ar),e.queries.track(new ri(n,t))}function yc(e,n){return e.queries.getByIndex(n)}function jp(e,n){const t=e[ae],r=yc(t,n);return r.crossesNgTemplate?ls(t,e,n,[]):Ss(t,e,r,n)}function Ag(e,n){Cl("NgSignals");const t=function fm(e){const n=Object.create(At);n.value=e;const t=()=>(Es(n),n.value);return t[ss]=n,t}(e),r=t[ss];return n?.equal&&(r.equal=n.equal),t.set=i=>er(r,i),t.update=i=>function Cd(e,n){sa()||ai(),er(e,n(e.value))}(r,i),t.asReadonly=TC.bind(t),t}function TC(){const e=this[ss];if(void 0===e.readonlyFn){const n=()=>this();n[ss]=e,e.readonlyFn=n}return e.readonlyFn}function EC(e){return function Nf(e){return"function"==typeof e&&void 0!==e[ss]}(e)&&"function"==typeof e.set}function hs(e){let n=function D5(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const r=[e];for(;n;){let i;if(Sr(e))i=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new ln(903,!1);i=n.\u0275dir}if(i){if(t){r.push(i);const u=e;u.inputs=nI(e.inputs),u.inputTransforms=nI(e.inputTransforms),u.declaredInputs=nI(e.declaredInputs),u.outputs=nI(e.outputs);const g=i.hostBindings;g&&zq(e,g);const x=i.viewQuery,E=i.contentQueries;if(x&&Lq(e,x),E&&Bq(e,E),Nq(e,i),sf(e.outputs,i.outputs),Sr(i)&&i.data.animation){const D=e.data;D.animation=(D.animation||[]).concat(i.data.animation)}}const l=i.features;if(l)for(let u=0;u<l.length;u++){const g=l[u];g&&g.ngInherit&&g(e),g===hs&&(t=!1)}}n=Object.getPrototypeOf(n)}!function Fq(e){let n=0,t=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=n+=i.hostVars,i.hostAttrs=Zd(i.hostAttrs,t=Zd(t,i.hostAttrs))}}(r)}function Nq(e,n){for(const t in n.inputs){if(!n.inputs.hasOwnProperty(t)||e.inputs.hasOwnProperty(t))continue;const r=n.inputs[t];if(void 0!==r&&(e.inputs[t]=r,e.declaredInputs[t]=n.declaredInputs[t],null!==n.inputTransforms)){const i=Array.isArray(r)?r[0]:r;if(!n.inputTransforms.hasOwnProperty(i))continue;e.inputTransforms??={},e.inputTransforms[i]=n.inputTransforms[i]}}}function nI(e){return e===rl?{}:e===Ui?[]:e}function Lq(e,n){const t=e.viewQuery;e.viewQuery=t?(r,i)=>{n(r,i),t(r,i)}:n}function Bq(e,n){const t=e.contentQueries;e.contentQueries=t?(r,i,l)=>{n(r,i,l),t(r,i,l)}:n}function zq(e,n){const t=e.hostBindings;e.hostBindings=t?(r,i)=>{n(r,i),t(r,i)}:n}function MC(e){const n=e.inputConfig,t={};for(const r in n)if(n.hasOwnProperty(r)){const i=n[r];Array.isArray(i)&&i[3]&&(t[r]=i[3])}e.inputTransforms=t}class hv{}class k5{}class VR extends hv{constructor(n,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Be(this);const i=Oo(n);this._bootstrapComponents=mc(i.bootstrap),this._r3Injector=ay(n,t,[{provide:hv,useValue:this},{provide:vw,useValue:this.componentFactoryResolver},...r],wo(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class jR extends k5{constructor(n){super(),this.moduleType=n}create(n){return new VR(this.moduleType,n,[])}}class O5 extends hv{constructor(n){super(),this.componentFactoryResolver=new Be(this),this.instance=null;const t=new _p([...n.providers,{provide:hv,useValue:this},{provide:vw,useValue:this.componentFactoryResolver}],n.parent||R_(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function rI(e,n,t=null){return new O5({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}function iI(e){return!!$R(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function $R(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function $p(e,n,t){return e[n]=t}function _a(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function fv(e,n,t,r){const i=_a(e,n,t);return _a(e,n+1,r)||i}function sI(e,n,t,r,i){const l=fv(e,n,t,r);return _a(e,n+2,i)||l}function yh(e,n,t,r,i,l){const u=fv(e,n,t,r);return fv(e,n+2,i,l)||u}function IC(e,n,t,r,i,l,u,g,x,E){const D=t+xt,R=n.firstCreatePass?function Yq(e,n,t,r,i,l,u,g,x){const E=n.consts,D=bg(n,e,4,u||null,g||null);gc(n,t,D,hc(E,x)),Wl(n,D);const R=D.tView=ew(2,D,r,i,l,n.directiveRegistry,n.pipeRegistry,null,n.schemas,E,null);return null!==n.queries&&(n.queries.template(n,D),R.queries=n.queries.embeddedTView(D)),D}(D,n,e,r,i,l,u,g,x):n.data[D];hu(R,!1);const L=P5(n,e,R,t);ey()&&p0(n,e,L,R),wl(L,e);const V=UE(L,e,L,R);return e[D]=V,iw(e,V),function or(e,n,t){return xn(e,n,t)}(V,R,e),sr(R)&&Jb(n,e,R),null!=x&&Qb(e,R,E),R}function gt(e,n,t,r,i,l,u,g){const x=en(),E=gi();return IC(x,E,e,n,t,r,i,hc(E.consts,l),u,g),gt}let P5=function R5(e,n,t,r){return Gl(!0),n[Ue].createComment("")};function rs(e,n,t,r){const i=en();return _a(i,ma(),n)&&(gi(),xu(Bs(),i,e,n,t,r)),rs}function Lw(e,n,t,r){return _a(e,ma(),t)?n+Er(t)+r:ti}function dI(e,n){return e<<17|n<<2}function N0(e){return e>>17&32767}function e3(e){return 2|e}function mv(e){return(131068&e)>>2}function t3(e,n){return-131069&e|n<<2}function n3(e){return 1|e}function dB(e,n,t,r){const i=e[t+1],l=null===n;let u=r?N0(i):mv(i),g=!1;for(;0!==u&&(!1===g||l);){const E=e[u+1];NZ(e[u],n)&&(g=!0,e[u+1]=r?n3(E):e3(E)),u=r?N0(E):mv(E)}g&&(e[t+1]=r?e3(i):n3(i))}function NZ(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&Wd(e,n)>=0}const al={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function hB(e){return e.substring(al.key,al.keyEnd)}function fB(e,n){const t=al.textEnd;return t===n?-1:(n=al.keyEnd=function zZ(e,n,t){for(;n<t&&e.charCodeAt(n)>32;)n++;return n}(e,al.key=n,t),Gw(e,n,t))}function Gw(e,n,t){for(;n<t&&e.charCodeAt(n)<=32;)n++;return n}function Oe(e,n,t){const r=en();return _a(r,ma(),n)&&Tl(gi(),Bs(),r,e,n,r[Ue],t,!1),Oe}function r3(e,n,t,r,i){const u=i?"class":"style";jE(e,t,n.inputs[u],u,r)}function Xi(e,n){return function Ff(e,n,t,r){const i=en(),l=gi(),u=fu(2);l.firstUpdatePass&&xB(l,e,u,r),n!==ti&&_a(i,u,n)&&wB(l,l.data[to()],i,i[Ue],e,i[u+1]=function YZ(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=wo(pc(e)))),e}(n,t),r,u)}(e,n,null,!0),Xi}function RC(e){!function Lf(e,n,t,r){const i=gi(),l=fu(2);i.firstUpdatePass&&xB(i,null,l,r);const u=en();if(t!==ti&&_a(u,l,t)){const g=i.data[to()];if(EB(g,r)&&!vB(i,l)){let x=r?g.classesWithoutHost:g.stylesWithoutHost;null!==x&&(t=Pm(x,t||"")),r3(i,g,u,t,r)}else!function XZ(e,n,t,r,i,l,u,g){i===ti&&(i=Ui);let x=0,E=0,D=0<i.length?i[0]:null,R=0<l.length?l[0]:null;for(;null!==D||null!==R;){const L=x<i.length?i[x+1]:void 0,V=E<l.length?l[E+1]:void 0;let G,Y=null;D===R?(x+=2,E+=2,L!==V&&(Y=R,G=V)):null===R||null!==D&&D<R?(x+=2,Y=D):(E+=2,Y=R,G=V),null!==Y&&wB(e,n,t,r,Y,G,u,g),D=x<i.length?i[x]:null,R=E<l.length?l[E]:null}}(i,g,u,u[Ue],u[l+1],u[l+1]=function qZ(e,n,t){if(null==t||""===t)return Ui;const r=[],i=pc(t);if(Array.isArray(i))for(let l=0;l<i.length;l++)e(r,i[l],!0);else if("object"==typeof i)for(const l in i)i.hasOwnProperty(l)&&e(r,l,i[l]);else"string"==typeof i&&n(r,i);return r}(e,n,t),r,l)}}(ZZ,Gp,e,!0)}function Gp(e,n){for(let t=function LZ(e){return function mB(e){al.key=0,al.keyEnd=0,al.value=0,al.valueEnd=0,al.textEnd=e.length}(e),fB(e,Gw(e,0,al.textEnd))}(n);t>=0;t=fB(n,t))Na(e,hB(n),!0)}function vB(e,n){return n>=e.expandoStartIndex}function xB(e,n,t,r){const i=e.data;if(null===i[t+1]){const l=i[to()],u=vB(e,t);EB(l,r)&&null===n&&!u&&(n=!1),n=function $Z(e,n,t,r){const i=function CT(e){const n=Br.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let l=r?n.residualClasses:n.residualStyles;if(null===i)0===(r?n.classBindings:n.styleBindings)&&(t=NC(t=i3(null,e,n,t,r),n.attrs,r),l=null);else{const u=n.directiveStylingLast;if(-1===u||e[u]!==i)if(t=i3(i,e,n,t,r),null===l){let x=function HZ(e,n,t){const r=t?n.classBindings:n.styleBindings;if(0!==mv(r))return e[N0(r)]}(e,n,r);void 0!==x&&Array.isArray(x)&&(x=i3(null,e,n,x[1],r),x=NC(x,n.attrs,r),function GZ(e,n,t,r){e[N0(t?n.classBindings:n.styleBindings)]=r}(e,n,r,x))}else l=function WZ(e,n,t){let r;const i=n.directiveEnd;for(let l=1+n.directiveStylingLast;l<i;l++)r=NC(r,e[l].hostAttrs,t);return NC(r,n.attrs,t)}(e,n,r)}return void 0!==l&&(r?n.residualClasses=l:n.residualStyles=l),t}(i,l,n,r),function PZ(e,n,t,r,i,l){let u=l?n.classBindings:n.styleBindings,g=N0(u),x=mv(u);e[r]=t;let D,E=!1;if(Array.isArray(t)?(D=t[1],(null===D||Wd(t,D)>0)&&(E=!0)):D=t,i)if(0!==x){const L=N0(e[g+1]);e[r+1]=dI(L,g),0!==L&&(e[L+1]=t3(e[L+1],r)),e[g+1]=function kZ(e,n){return 131071&e|n<<17}(e[g+1],r)}else e[r+1]=dI(g,0),0!==g&&(e[g+1]=t3(e[g+1],r)),g=r;else e[r+1]=dI(x,0),0===g?g=r:e[x+1]=t3(e[x+1],r),x=r;E&&(e[r+1]=e3(e[r+1])),dB(e,D,r,!0),dB(e,D,r,!1),function RZ(e,n,t,r,i){const l=i?e.residualClasses:e.residualStyles;null!=l&&"string"==typeof n&&Wd(l,n)>=0&&(t[r+1]=n3(t[r+1]))}(n,D,e,r,l),u=dI(g,x),l?n.classBindings=u:n.styleBindings=u}(i,l,n,t,u,r)}}function i3(e,n,t,r,i){let l=null;const u=t.directiveEnd;let g=t.directiveStylingLast;for(-1===g?g=t.directiveStart:g++;g<u&&(l=n[g],r=NC(r,l.hostAttrs,i),l!==e);)g++;return null!==e&&(t.directiveStylingLast=g),r}function NC(e,n,t){const r=t?1:2;let i=-1;if(null!==n)for(let l=0;l<n.length;l++){const u=n[l];"number"==typeof u?i=u:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Na(e,u,!!t||n[++l]))}return void 0===e?null:e}function ZZ(e,n,t){const r=String(n);""!==r&&!r.includes(" ")&&Na(e,r,t)}function wB(e,n,t,r,i,l,u,g){if(!(3&n.type))return;const x=e.data,E=x[g+1],D=function OZ(e){return!(1&~e)}(E)?TB(x,n,t,i,mv(E),u):void 0;hI(D)||(hI(l)||function IZ(e){return!(2&~e)}(E)&&(l=TB(x,null,t,i,g,u)),function sR(e,n,t,r,i){if(n)i?e.addClass(t,r):e.removeClass(t,r);else{let l=-1===r.indexOf("-")?void 0:Af.DashCase;null==i?e.removeStyle(t,r,l):("string"==typeof i&&i.endsWith("!important")&&(i=i.slice(0,-10),l|=Af.Important),e.setStyle(t,r,i,l))}}(r,u,bp(to(),t),i,l))}function TB(e,n,t,r,i,l){const u=null===n;let g;for(;i>0;){const x=e[i],E=Array.isArray(x),D=E?x[1]:x,R=null===D;let L=t[i+1];L===ti&&(L=R?Ui:void 0);let V=R?Uc(L,r):D===r?L:void 0;if(E&&!hI(V)&&(V=Uc(x,r)),hI(V)&&(g=V,u))return g;const Y=e[i+1];i=u?N0(Y):mv(Y)}if(null!==n){let x=l?n.residualClasses:n.residualStyles;null!=x&&(g=Uc(x,r))}return g}function hI(e){return void 0!==e}function EB(e,n){return!!(e.flags&(n?8:16))}function s3(){return en()[pt][Le]}class oX{destroy(n){}updateValue(n,t){}swap(n,t){const r=Math.min(n,t),i=Math.max(n,t),l=this.detach(i);if(i-r>1){const u=this.detach(r);this.attach(r,l),this.attach(i,u)}else this.attach(r,l)}move(n,t){this.attach(t,this.detach(n))}}function o3(e,n,t,r,i){return e===t&&Object.is(n,r)?1:Object.is(i(e,n),i(t,r))?-1:0}function a3(e,n,t,r){return!(void 0===n||!n.has(r)||(e.attach(t,n.get(r)),n.delete(r),0))}function CB(e,n,t,r,i){if(a3(e,n,r,t(r,i)))e.updateValue(r,i);else{const l=e.create(r,i);e.attach(r,l)}}function SB(e,n,t,r){const i=new Set;for(let l=n;l<=t;l++)i.add(r(l,e.at(l)));return i}class DB{constructor(){this.kvMap=new Map,this._vMap=void 0}has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;const t=this.kvMap.get(n);return void 0!==this._vMap&&this._vMap.has(t)?(this.kvMap.set(n,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,t){if(this.kvMap.has(n)){let r=this.kvMap.get(n);void 0===this._vMap&&(this._vMap=new Map);const i=this._vMap;for(;i.has(r);)r=i.get(r);i.set(r,t)}else this.kvMap.set(n,t)}forEach(n){for(let[t,r]of this.kvMap)if(n(r,t),void 0!==this._vMap){const i=this._vMap;for(;i.has(r);)r=i.get(r),n(r,t)}}}function Os(e,n){Cl("NgControlFlow");const t=en(),r=ma(),i=t[r]!==ti?t[r]:-1,l=-1!==i?fI(t,xt+i):void 0;if(_a(t,r,e)){const g=cn(null);try{if(void 0!==l&&HE(l,0),-1!==e){const x=xt+e,E=fI(t,x),D=c3(t[ae],x),R=zp(E,D.tView.ssrId);wg(E,gh(t,D,n,{dehydratedView:R}),0,Rp(D,R))}}finally{cn(g)}}else if(void 0!==l){const g=yA(l,0);void 0!==g&&(g[Le]=n)}}class lX{constructor(n,t,r){this.lContainer=n,this.$implicit=t,this.$index=r}get $count(){return this.lContainer.length-Ar}}class cX{constructor(n,t,r){this.hasEmptyBlock=n,this.trackByFn=t,this.liveCollection=r}}function vh(e,n,t,r,i,l,u,g,x,E,D,R,L){Cl("NgControlFlow");const V=en(),Y=gi(),G=void 0!==x,Q=en(),he=g?u.bind(Q[pt][Le]):u,le=new cX(G,he);Q[xt+e]=le,IC(V,Y,e+1,n,t,r,i,hc(Y.consts,l)),G&&IC(V,Y,e+2,x,E,D,R,hc(Y.consts,L))}class uX extends oX{constructor(n,t,r){super(),this.lContainer=n,this.hostLView=t,this.templateTNode=r,this.operationsCounter=void 0,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-Ar}at(n){return this.getLView(n)[Le].$implicit}attach(n,t){const r=t[Ce];this.needsIndexUpdate||=n!==this.length,wg(this.lContainer,t,n,Rp(this.templateTNode,r))}detach(n){return this.needsIndexUpdate||=n!==this.length-1,function dX(e,n){return Ua(e,n)}(this.lContainer,n)}create(n,t){const r=zp(this.lContainer,this.templateTNode.tView.ssrId),i=gh(this.hostLView,this.templateTNode,new lX(this.lContainer,t,n),{dehydratedView:r});return this.operationsCounter?.recordCreate(),i}destroy(n){f0(n[ae],n),this.operationsCounter?.recordDestroy()}updateValue(n,t){this.getLView(n)[Le].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[Le].$index=n}getLView(n){return function hX(e,n){return yA(e,n)}(this.lContainer,n)}}function xh(e){const n=cn(null),t=to();try{const r=en(),i=r[ae],l=r[t],u=t+1,g=fI(r,u);if(void 0===l.liveCollection){const E=c3(i,u);l.liveCollection=new uX(g,r,E)}else l.liveCollection.reset();const x=l.liveCollection;if(function aX(e,n,t){let r,i,l=0,u=e.length-1;if(Array.isArray(n)){let x=n.length-1;for(;l<=u&&l<=x;){const E=e.at(l),D=n[l],R=o3(l,E,l,D,t);if(0!==R){R<0&&e.updateValue(l,D),l++;continue}const L=e.at(u),V=n[x],Y=o3(u,L,x,V,t);if(0!==Y){Y<0&&e.updateValue(u,V),u--,x--;continue}const G=t(l,E),Q=t(u,L),he=t(l,D);if(Object.is(he,Q)){const le=t(x,V);Object.is(le,G)?(e.swap(l,u),e.updateValue(u,V),x--,u--):e.move(u,l),e.updateValue(l,D),l++}else if(r??=new DB,i??=SB(e,l,u,t),a3(e,r,l,he))e.updateValue(l,D),l++,u++;else if(i.has(he))r.set(G,e.detach(l)),u--;else{const le=e.create(l,n[l]);e.attach(l,le),l++,u++}}for(;l<=x;)CB(e,r,t,l,n[l]),l++}else if(null!=n){const x=n[Symbol.iterator]();let E=x.next();for(;!E.done&&l<=u;){const D=e.at(l),R=E.value,L=o3(l,D,l,R,t);if(0!==L)L<0&&e.updateValue(l,R),l++,E=x.next();else{r??=new DB,i??=SB(e,l,u,t);const V=t(l,R);if(a3(e,r,l,V))e.updateValue(l,R),l++,u++,E=x.next();else if(i.has(V)){const Y=t(l,D);r.set(Y,e.detach(l)),u--}else e.attach(l,e.create(l,R)),l++,u++,E=x.next()}}for(;!E.done;)CB(e,r,t,e.length,E.value),E=x.next()}for(;l<=u;)e.destroy(e.detach(u--));r?.forEach(x=>{e.destroy(x)})}(x,e,l.trackByFn),x.updateIndexes(),l.hasEmptyBlock){const E=ma(),D=0===x.length;if(_a(r,E,D)){const R=t+2,L=fI(r,R);if(D){const V=c3(i,R),Y=zp(L,V.tView.ssrId);wg(L,gh(r,V,void 0,{dehydratedView:Y}),0,Rp(V,Y))}else HE(L,0)}}}finally{cn(n)}}function fI(e,n){return e[n]}function c3(e,n){return rg(e,n)}function P(e,n,t,r){const i=en(),l=gi(),u=xt+e,g=i[Ue],x=l.firstCreatePass?function fX(e,n,t,r,i,l){const u=n.consts,x=bg(n,e,2,r,hc(u,i));return gc(n,t,x,hc(u,l)),null!==x.attrs&&De(x,x.attrs,!1),null!==x.mergedAttrs&&De(x,x.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,x),x}(u,l,i,n,t,r):l.data[u],E=MB(l,i,x,g,n,e);i[u]=E;const D=sr(x);return hu(x,!0),kE(g,E,x),!function Aw(e){return!(32&~e.flags)}(x)&&ey()&&p0(l,i,E,x),0===function X1(){return Br.lFrame.elementDepthCount}()&&wl(E,i),function Y1(){Br.lFrame.elementDepthCount++}(),D&&(Jb(l,i,x),PE(l,x,i)),null!==r&&Qb(i,x),P}function O(){let e=us();tb()?wT():(e=e.parent,hu(e,!1));const n=e;(function vT(e){return Br.skipHydrationRootTNode===e})(n)&&function UD(){Br.skipHydrationRootTNode=null}(),function yT(){Br.lFrame.elementDepthCount--}();const t=gi();return t.firstCreatePass&&(Wl(t,e),yr(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function po(e){return!!(8&e.flags)}(n)&&r3(t,n,en(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function H_(e){return!!(16&e.flags)}(n)&&r3(t,n,en(),n.stylesWithoutHost,!1),O}function Rt(e,n,t,r){return P(e,n,t,r),O(),Rt}let MB=(e,n,t,r,i,l)=>(Gl(!0),Py(r,i,function sb(){return Br.lFrame.currentNamespace}()));function FC(e,n,t){const r=en(),i=gi(),l=e+xt,u=i.firstCreatePass?function gX(e,n,t,r,i){const l=n.consts,u=hc(l,r),g=bg(n,e,8,"ng-container",u);return null!==u&&De(g,u,!0),gc(n,t,g,hc(l,i)),null!==n.queries&&n.queries.elementStart(n,g),g}(l,i,r,n,t):i.data[l];hu(u,!0);const g=AB(i,r,u,e);return r[l]=g,ey()&&p0(i,r,g,u),wl(g,r),sr(u)&&(Jb(i,r,u),PE(i,u,r)),null!=t&&Qb(r,u),FC}function LC(){let e=us();const n=gi();return tb()?wT():(e=e.parent,hu(e,!1)),n.firstCreatePass&&(Wl(n,e),yr(e)&&n.queries.elementEnd(e)),LC}function pI(e,n,t){return FC(e,n,t),LC(),pI}let AB=(e,n,t,r)=>(Gl(!0),qb(n[Ue],""));function lr(){return en()}const gv=void 0;var xX=["en",[["a","p"],["AM","PM"],gv],[["AM","PM"],gv,gv],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],gv,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],gv,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",gv,"{1} 'at' {0}",gv],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function vX(e){const t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}];let Ww={};function Wc(e){const n=function bX(e){return e.toLowerCase().replace(/_/g,"-")}(e);let t=OB(n);if(t)return t;const r=n.split("-")[0];if(t=OB(r),t)return t;if("en"===r)return xX;throw new ln(701,!1)}function OB(e){return e in Ww||(Ww[e]=bi.ng&&bi.ng.common&&bi.ng.common.locales&&bi.ng.common.locales[e]),Ww[e]}var no=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}(no||{});const qw="en-US";let PB=qw;let JB=(e,n,t)=>{};function ct(e,n,t,r){const i=en(),l=gi(),u=us();return h3(l,i,i[Ue],u,e,n,r),ct}function h3(e,n,t,r,i,l,u){const g=sr(r),E=e.firstCreatePass&&gA(e),D=n[Le],R=mA(n);let L=!0;if(3&r.type||u){const G=ho(r,n),Q=u?u(G):G,he=R.length,le=u?ze=>u(qi(ze[r.index])):r.index;let me=null;if(!u&&g&&(me=function aY(e,n,t,r){const i=e.cleanup;if(null!=i)for(let l=0;l<i.length-1;l+=2){const u=i[l];if(u===t&&i[l+1]===r){const g=n[Me],x=i[l+2];return g.length>x?g[x]:null}"string"==typeof u&&(l+=2)}return null}(e,n,i,r.index)),null!==me)(me.__ngLastListenerFn__||me).__ngNextListenerFn__=l,me.__ngLastListenerFn__=l,L=!1;else{l=n6(r,n,D,l),JB(G,i,l);const ze=t.listen(Q,i,l);R.push(l,ze),E&&E.push(i,le,he,he+1)}}else l=n6(r,n,D,l);const V=r.outputs;let Y;if(L&&null!==V&&(Y=V[i])){const G=Y.length;if(G)for(let Q=0;Q<G;Q+=2){const Je=n[Y[Q]][Y[Q+1]].subscribe(l),ht=R.length;R.push(l,Je),E&&E.push(i,r.index,ht,-(ht+1))}}}function t6(e,n,t,r){const i=cn(null);try{return uc(6,n,t),!1!==t(r)}catch(l){return sw(e,l),!1}finally{uc(7,n,t),cn(i)}}function n6(e,n,t,r){return function i(l){if(l===Function)return r;El(e.componentOffset>-1?Zo(e.index,n):n,5);let g=t6(n,t,r,l),x=i.__ngNextListenerFn__;for(;x;)g=t6(n,t,x,l)&&g,x=x.__ngNextListenerFn__;return g}}function Ge(e=1){return function ag(e){return(Br.lFrame.contextLView=function _f(e,n){for(;e>0;)n=n[Mt],e--;return n}(e,Br.lFrame.contextLView))[Le]}(e)}function lY(e,n){let t=null;const r=function Yd(e){const n=e.attrs;if(null!=n){const t=n.indexOf(5);if(!(1&t))return n[t+1]}return null}(e);for(let i=0;i<n.length;i++){const l=n[i];if("*"!==l){if(null===r?G1(e,l,!0):Km(r,l))return i}else t=i}return t}function yI(e){const n=en()[pt][ye];if(!n.projection){const r=n.projection=function Jt(e,n){const t=[];for(let r=0;r<e;r++)t.push(n);return t}(e?e.length:1,null),i=r.slice();let l=n.child;for(;null!==l;){if(128!==l.type){const u=e?lY(l,e):0;null!==u&&(i[u]?i[u].projectionNext=l:r[u]=l,i[u]=l)}l=l.next}}}function vI(e,n=0,t,r,i,l){const u=en(),g=gi(),x=r?e+1:null;null!==x&&IC(u,g,x,r,i,l,null,t);const E=bg(g,xt+e,16,null,t||null);null===E.projection&&(E.projection=n),wT();const R=!u[Ce]||xf();null===u[pt][ye].projection[E.projection]&&null!==x?function cY(e,n,t){const r=xt+t,i=n.data[r],l=e[r],u=zp(l,i.tView.ssrId);wg(l,gh(e,i,void 0,{dehydratedView:u}),0,Rp(i,u))}(u,g,x):R&&32&~E.flags&&function cA(e,n,t){Uy(n[Ue],0,n,t,Yb(e,t,n),Fy(t.parent||n[ye],t,n))}(g,u,E)}function xI(e,n,t){return _v(e,"",n,"",t),xI}function _v(e,n,t,r,i){const l=en(),u=Lw(l,n,t,r);return u!==ti&&Tl(gi(),Bs(),l,e,u,l[Ue],i,!1),_v}function vs(e,n,t,r){!function ji(e,n,t,r){const i=gi();if(i.firstCreatePass){const l=us();wu(i,new Pi(n,t,r),l.index),function Tu(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(i,e),!(2&~t)&&(i.staticContentQueries=!0)}return Ys(i,en(),t)}(e,n,t,r)}function od(e,n,t){!function Ko(e,n,t){const r=gi();return r.firstCreatePass&&(wu(r,new Pi(e,n,t),-1),!(2&~n)&&(r.staticViewQueries=!0)),Ys(r,en(),n)}(e,n,t)}function _i(e){const n=en(),t=gi(),r=sg();rb(r+1);const i=yc(t,r);if(e.dirty&&function wp(e){return!(4&~e[ce])}(n)===!(2&~i.metadata.flags)){if(null===i.matches)e.reset([]);else{const l=jp(n,r);e.reset(l,VT),e.notifyOnChanges()}return!0}return!1}function yi(){return function mo(e,n){return e[Pe].queries[n].queryList}(en(),sg())}function xa(e){return dc(function VD(){return Br.lFrame.contextLView}(),xt+e)}function U(e,n=""){const t=en(),r=gi(),i=e+xt,l=r.firstCreatePass?bg(r,i,1,n,null):r.data[i],u=x6(r,t,l,n,e);t[i]=u,ey()&&p0(r,t,u,l),hu(l,!1)}let x6=(e,n,t,r,i)=>(Gl(!0),function Wb(e,n){return e.createText(n)}(n[Ue],r));function tt(e){return Zn("",e,""),tt}function Zn(e,n,t){const r=en(),i=Lw(r,e,n,t);return i!==ti&&Of(r,to(),i),Zn}function Zw(e,n,t,r,i){const l=en(),u=function Bw(e,n,t,r,i,l){const g=fv(e,Xu(),t,i);return fu(2),g?n+Er(t)+r+Er(i)+l:ti}(l,e,n,t,r,i);return u!==ti&&Of(l,to(),u),Zw}function p3(e,n,t,r,i,l,u){const g=en(),x=function zw(e,n,t,r,i,l,u,g){const E=sI(e,Xu(),t,i,u);return fu(3),E?n+Er(t)+r+Er(i)+l+Er(u)+g:ti}(g,e,n,t,r,i,l,u);return x!==ti&&Of(g,to(),x),p3}function m3(e,n,t,r,i,l,u,g,x){const E=en(),D=function Uw(e,n,t,r,i,l,u,g,x,E){const R=yh(e,Xu(),t,i,u,x);return fu(4),R?n+Er(t)+r+Er(i)+l+Er(u)+g+Er(x)+E:ti}(E,e,n,t,r,i,l,u,g,x);return D!==ti&&Of(E,to(),D),m3}function Ct(e,n,t){EC(n)&&(n=n());const r=en();return _a(r,ma(),n)&&Tl(gi(),Bs(),r,e,n,r[Ue],t,!1),Ct}function Dt(e,n){const t=EC(e);return t&&e.set(n),t}function St(e,n){const t=en(),r=gi(),i=us();return h3(r,t,t[Ue],i,e,n),St}function g3(e,n,t,r,i){if(e=Pr(e),Array.isArray(e))for(let l=0;l<e.length;l++)g3(e[l],n,t,r,i);else{const l=gi(),u=en(),g=us();let x=uu(e)?e:Pr(e.provide);const E=N_(e),D=1048575&g.providerIndexes,R=g.directiveStart,L=g.providerIndexes>>20;if(uu(e)||!e.multi){const V=new $_(E,i,ut),Y=y3(x,n,i?D:D+L,R);-1===Y?(cb(ty(g,u),l,x),_3(l,e,n.length),n.push(x),g.directiveStart++,g.directiveEnd++,i&&(g.providerIndexes+=1048576),t.push(V),u.push(V)):(t[Y]=V,u[Y]=V)}else{const V=y3(x,n,D+L,R),Y=y3(x,n,D,D+L),Q=Y>=0&&t[Y];if(i&&!Q||!i&&!(V>=0&&t[V])){cb(ty(g,u),l,x);const he=function AY(e,n,t,r,i){const l=new $_(e,t,ut);return l.multi=[],l.index=n,l.componentProviders=0,M6(l,i,r&&!t),l}(i?MY:DY,t.length,i,r,E);!i&&Q&&(t[Y].providerFactory=he),_3(l,e,n.length,0),n.push(x),g.directiveStart++,g.directiveEnd++,i&&(g.providerIndexes+=1048576),t.push(he),u.push(he)}else _3(l,e,V>-1?V:Y,M6(t[i?Y:V],E,!i&&r));!i&&r&&Q&&t[Y].componentProviders++}}}function _3(e,n,t,r){const i=uu(n),l=function O_(e){return!!e.useClass}(n);if(i||l){const x=(l?Pr(n.useClass):n).prototype.ngOnDestroy;if(x){const E=e.destroyHooks||(e.destroyHooks=[]);if(!i&&n.multi){const D=E.indexOf(t);-1===D?E.push(t,[r,x]):E[D+1].push(r,x)}else E.push(t,x)}}}function M6(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function y3(e,n,t,r){for(let i=t;i<r;i++)if(n[i]===e)return i;return-1}function DY(e,n,t,r){return v3(this.multi,[])}function MY(e,n,t,r){const i=this.multi;let l;if(this.providerFactory){const u=this.providerFactory.componentProviders,g=ug(t,t[ae],this.providerFactory.index,r);l=g.slice(0,u),v3(i,l);for(let x=u;x<g.length;x++)l.push(g[x])}else l=[],v3(i,l);return l}function v3(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function js(e,n=[]){return t=>{t.providersResolver=(r,i)=>function SY(e,n,t){const r=gi();if(r.firstCreatePass){const i=Sr(e);g3(t,r.data,r.blueprint,i,!0),g3(n,r.data,r.blueprint,i,!1)}}(r,i?i(e):e,n)}}let IY=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=ff(0,t.type),i=r.length>0?rI([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,i)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=It({token:e,providedIn:"environment",factory:()=>new e($n(Go))})}return e})();function Bf(e){Cl("NgStandalone"),e.getStandaloneInjector=n=>n.get(IY).getOrCreateStandaloneInjector(e)}function Va(e,n,t){const r=yl()+e,i=en();return i[r]===ti?$p(i,r,t?n.call(t):n()):function AC(e,n){return e[n]}(i,r)}function ba(e,n,t,r){return k6(en(),yl(),e,n,t,r)}function yv(e,n,t,r,i){return O6(en(),yl(),e,n,t,r,i)}function vv(e,n,t,r,i,l){return P6(en(),yl(),e,n,t,r,i,l)}function x3(e,n,t,r,i,l,u){return R6(en(),yl(),e,n,t,r,i,l,u)}function HC(e,n){const t=e[n];return t===ti?void 0:t}function k6(e,n,t,r,i,l){const u=n+t;return _a(e,u,i)?$p(e,u+1,l?r.call(l,i):r(i)):HC(e,u+1)}function O6(e,n,t,r,i,l,u){const g=n+t;return fv(e,g,i,l)?$p(e,g+2,u?r.call(u,i,l):r(i,l)):HC(e,g+2)}function P6(e,n,t,r,i,l,u,g){const x=n+t;return sI(e,x,i,l,u)?$p(e,x+3,g?r.call(g,i,l,u):r(i,l,u)):HC(e,x+3)}function R6(e,n,t,r,i,l,u,g,x){const E=n+t;return yh(e,E,i,l,u,g)?$p(e,E+4,x?r.call(x,i,l,u,g):r(i,l,u,g)):HC(e,E+4)}function zn(e,n){const t=gi();let r;const i=e+xt;t.firstCreatePass?(r=function zY(e,n){if(n)for(let t=n.length-1;t>=0;t--){const r=n[t];if(e===r.name)return r}}(n,t.pipeRegistry),t.data[i]=r,r.onDestroy&&(t.destroyHooks??=[]).push(i,r.onDestroy)):r=t.data[i];const l=r.factory||(r.factory=Bc(r.type)),g=Ra(ut);try{const x=ys(!1),E=l();return ys(x),function f3(e,n,t,r){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=r}(t,en(),i,E),E}finally{Ra(g)}}function vc(e,n,t){const r=e+xt,i=en(),l=dc(i,r);return GC(i,r)?k6(i,yl(),n,l.transform,t,l):l.transform(t)}function fs(e,n,t,r){const i=e+xt,l=en(),u=dc(l,i);return GC(l,i)?O6(l,yl(),n,u.transform,t,r,u):u.transform(t,r)}function Ql(e,n,t,r,i){const l=e+xt,u=en(),g=dc(u,l);return GC(u,l)?P6(u,yl(),n,g.transform,t,r,i,g):g.transform(t,r,i)}function Jo(e,n,t,r,i,l){const u=e+xt,g=en(),x=dc(g,u);return GC(g,u)?R6(g,yl(),n,x.transform,t,r,i,l,x):x.transform(t,r,i,l)}function GC(e,n){return e[ae].data[n].pure}function Sl(e,n){return Np(e,n)}let K6=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const n8=new vn(""),CI=new vn("");let M3,S3=(()=>{class e{constructor(t,r,i){this._ngZone=t,this.registry=r,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,M3||(function PK(e){M3=e}(i),i.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ni.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb()}});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1))}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,i){let l=-1;r&&r>0&&(l=setTimeout(()=>{this._callbacks=this._callbacks.filter(u=>u.timeoutId!==l),t()},r)),this._callbacks.push({doneCb:t,timeoutId:l,updateCb:i})}whenStable(t,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,i),this._runCallbacksIfReady()}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,i){return[]}static#e=this.\u0275fac=function(r){return new(r||e)($n(ni),$n(D3),$n(CI))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})(),D3=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return M3?.findTestabilityInTree(this,t,r)??null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function XC(e){return!!e&&"function"==typeof e.then}function r8(e){return!!e&&"function"==typeof e.subscribe}const A3=new vn("");let I3=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=Qe(A3,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const i of this.appInits){const l=i();if(XC(l))t.push(l);else if(r8(l)){const u=new Promise((g,x)=>{l.subscribe({complete:g,error:x})});t.push(u)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),0===t.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const SI=new vn("");function o8(e,n){return Array.isArray(n)?n.reduce(o8,e):{...e,...n}}let wh=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Qe(ah),this.afterRenderEffectManager=Qe(A),this.zonelessEnabled=Qe(cv),this.externalTestViews=new Set,this.beforeRender=new Mi,this.afterTick=new Mi,this.componentTypes=[],this.components=[],this.isStable=Qe(ol).hasPendingTasks.pipe(pe(t=>!t)),this._injector=Qe(Go)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){const i=t instanceof Up;if(!this._injector.get(I3).done)throw!i&&function Kd(e){const n=di(e)||ko(e)||ha(e);return null!==n&&n.standalone}(t),new ln(405,!1);let u;u=i?t:this._injector.get(vw).resolveComponentFactory(t),this.componentTypes.push(u.componentType);const g=function RK(e){return e.isBoundToModule}(u)?void 0:this._injector.get(hv),E=u.create(zs.NULL,[],r||u.selector,g),D=E.location.nativeElement,R=E.injector.get(n8,null);return R?.registerApplication(D),E.onDestroy(()=>{this.detachView(E.hostView),DI(this.components,E),R?.unregisterApplication(D)}),this._loadComponent(E),E}tick(){this._tick(!0)}_tick(t){if(this._runningTick)throw new ln(101,!1);const r=cn(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(t)}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1,cn(r),this.afterTick.next()}}detectChangesInAttachedViews(t){let r=null;this._injector.destroyed||(r=this._injector.get(mC,null,{optional:!0}));let i=0;const l=this.afterRenderEffectManager;for(;i<10;){const u=0===i;if(t||!u){this.beforeRender.next(u);for(let{_lView:g,notifyErrorHandler:x}of this._views)FK(g,x,u,this.zonelessEnabled)}else r?.begin?.(),r?.end?.();if(i++,l.executeInternalCallbacks(),!this.allViews.some(({_lView:g})=>ig(g))&&(l.execute(),!this.allViews.some(({_lView:g})=>ig(g))))break}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;DI(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(SI,[]);[...this._bootstrapListeners,...r].forEach(i=>i(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>DI(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ln(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function DI(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function FK(e,n,t,r){(t||ig(e))&&ow(e,n,t&&!r?0:1)}class LK{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let l8=(()=>{class e{compileModuleSync(t){return new jR(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),l=mc(Oo(t).declarations).reduce((u,g)=>{const x=di(g);return x&&u.push(new Ke(x)),u},[]);return new LK(r,l)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),UK=(()=>{class e{constructor(){this.zone=Qe(ni),this.changeDetectionScheduler=Qe(Mg),this.applicationRef=Qe(wh)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function k3({ngZoneFactory:e,ignoreChangesOutsideZone:n}){return e??=()=>new ni(O3()),[{provide:ni,useFactory:e},{provide:cc,multi:!0,useFactory:()=>{const t=Qe(UK,{optional:!0});return()=>t.initialize()}},{provide:cc,multi:!0,useFactory:()=>{const t=Qe($K);return()=>{t.initialize()}}},{provide:ah,useFactory:jK},!0===n?{provide:WA,useValue:!0}:[]]}function jK(){const e=Qe(ni),n=Qe(Po);return t=>e.runOutsideAngular(()=>n.handleError(t))}function O3(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}let $K=(()=>{class e{constructor(){this.subscription=new os,this.initialized=!1,this.zone=Qe(ni),this.pendingTasks=Qe(ol)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ni.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ni.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),YC=(()=>{class e{constructor(){this.appRef=Qe(wh),this.taskService=Qe(ol),this.ngZone=Qe(ni),this.zonelessEnabled=Qe(cv),this.disableScheduling=Qe(WA,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new os,this.cancelScheduledCallback=null,this.shouldRefreshViews=!1,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Tw||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&5===t)return;switch(t){case 3:case 2:case 0:case 4:case 5:case 1:this.shouldRefreshViews=!0}if(!this.shouldScheduleTick())return;const r=this.useMicrotaskScheduler?_C:gC;this.pendingRenderTaskId=this.taskService.add(),this.zoneIsDefined?Zone.root.run(()=>{this.cancelScheduledCallback=r(()=>{this.tick(this.shouldRefreshViews)})}):this.cancelScheduledCallback=r(()=>{this.tick(this.shouldRefreshViews)})}shouldScheduleTick(){return!(this.disableScheduling||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&ni.isInAngularZone())}tick(t){if(this.runningTick||this.appRef.destroyed)return;const r=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick(t)},void 0,this.schedulerTickApplyArgs)}catch(i){throw this.taskService.remove(r),i}finally{this.cleanup()}this.useMicrotaskScheduler=!0,_C(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(r)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.shouldRefreshViews=!1,this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Wp=new vn("",{providedIn:"root",factory:()=>Qe(Wp,wi.Optional|wi.SkipSelf)||function HK(){return typeof $localize<"u"&&$localize.locale||qw}()}),GK=new vn("",{providedIn:"root",factory:()=>"USD"}),R3=new vn("");let h8=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const i=function o(e="zone.js",n){return"noop"===e?new Tw:"zone.js"===e?new ni(n):e}(r?.ngZone,O3({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return i.run(()=>{const l=r?.ignoreChangesOutsideZone,u=function Gq(e,n,t){return new VR(e,n,t)}(t.moduleType,this.injector,[...k3({ngZoneFactory:()=>i,ignoreChangesOutsideZone:l}),{provide:Mg,useExisting:YC}]),g=u.injector.get(Po,null);return i.runOutsideAngular(()=>{const x=i.onError.subscribe({next:E=>{g.handleError(E)}});u.onDestroy(()=>{DI(this._modules,u),x.unsubscribe()})}),function s8(e,n,t){try{const r=t();return XC(r)?r.catch(i=>{throw n.runOutsideAngular(()=>e.handleError(i)),i}):r}catch(r){throw n.runOutsideAngular(()=>e.handleError(r)),r}}(g,i,()=>{const x=u.injector.get(I3);return x.runInitializers(),x.donePromise.then(()=>(function RB(e){"string"==typeof e&&(PB=e.toLowerCase().replace(/_/g,"-"))}(u.injector.get(Wp,qw)||qw),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,r=[]){const i=o8({},r);return function zK(e,n,t){const r=new jR(t);return Promise.resolve(r)}(0,0,t).then(l=>this.bootstrapModuleFactory(l,i))}_moduleDoBootstrap(t){const r=t.injector.get(wh);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!t.instance.ngDoBootstrap)throw new ln(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ln(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(R3,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||e)($n(zs))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),L0=null;const f8=new vn("");function p8(e,n,t=[]){const r=`Platform: ${n}`,i=new vn(r);return(l=[])=>{let u=N3();if(!u||u.injector.get(f8,!1)){const g=[...t,...l,{provide:i,useValue:!0}];e?e(g):function qK(e){if(L0&&!L0.get(f8,!1))throw new ln(400,!1);(function i8(){!function Lu(e){iu=e}(()=>{throw new ln(600,!1)})})(),L0=e;const n=e.get(h8);(function g8(e){e.get(_M,null)?.forEach(t=>t())})(e)}(function m8(e=[],n){return zs.create({name:n,providers:[{provide:pf,useValue:"platform"},{provide:R3,useValue:new Set([()=>L0=null])},...e]})}(g,r))}return function ZK(e){const n=N3();if(!n)throw new ln(401,!1);return n}()}}function N3(){return L0?.get(h8)??null}let Th=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=YK}return e})();function YK(e){return function KK(e,n,t){if(mr(e)&&!t){const r=Zo(e.index,n);return new Yy(r,r)}return 175&e.type?new Yy(n[pt],n):null}(us(),en(),!(16&~e))}class b8{constructor(){}supports(n){return iI(n)}create(n){return new nJ(n)}}const tJ=(e,n)=>n;class nJ{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||tJ}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,r=this._removalsHead,i=0,l=null;for(;t||r;){const u=!r||t&&t.currentIndex<T8(r,i,l)?t:r,g=T8(u,i,l),x=u.currentIndex;if(u===r)i--,r=r._nextRemoved;else if(t=t._next,null==u.previousIndex)i++;else{l||(l=[]);const E=g-i,D=x-i;if(E!=D){for(let L=0;L<E;L++){const V=L<l.length?l[L]:l[L]=0,Y=V+L;D<=Y&&Y<E&&(l[L]=V+1)}l[u.previousIndex]=D-E}}g!==x&&n(u,g,x)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!iI(n))throw new ln(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let i,l,u,t=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let g=0;g<this.length;g++)l=n[g],u=this._trackByFn(g,l),null!==t&&Object.is(t.trackById,u)?(r&&(t=this._verifyReinsertion(t,l,u,g)),Object.is(t.item,l)||this._addIdentityChange(t,l)):(t=this._mismatch(t,l,u,g),r=!0),t=t._next}else i=0,function Zq(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let r;for(;!(r=t.next()).done;)n(r.value)}}(n,g=>{u=this._trackByFn(i,g),null!==t&&Object.is(t.trackById,u)?(r&&(t=this._verifyReinsertion(t,g,u,i)),Object.is(t.item,g)||this._addIdentityChange(t,g)):(t=this._mismatch(t,g,u,i),r=!0),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,r,i){let l;return null===n?l=this._itTail:(l=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,l,i)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,l,i)):n=this._addAfter(new rJ(t,r),l,i),n}_verifyReinsertion(n,t,r,i){let l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==l?n=this._reinsertAfter(l,n._prev,i):n.currentIndex!=i&&(n.currentIndex=i,this._addToMoves(n,i)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const i=n._prevRemoved,l=n._nextRemoved;return null===i?this._removalsHead=l:i._nextRemoved=l,null===l?this._removalsTail=i:l._prevRemoved=i,this._insertAfter(n,t,r),this._addToMoves(n,r),n}_moveAfter(n,t,r){return this._unlink(n),this._insertAfter(n,t,r),this._addToMoves(n,r),n}_addAfter(n,t,r){return this._insertAfter(n,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,r){const i=null===t?this._itHead:t._next;return n._next=i,n._prev=t,null===i?this._itTail=n:i._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new w8),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,r=n._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new w8),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class rJ{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class iJ{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const t=n._prevDup,r=n._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class w8{constructor(){this.map=new Map}put(n){const t=n.trackById;let r=this.map.get(t);r||(r=new iJ,this.map.set(t,r)),r.add(n)}get(n,t){const i=this.map.get(n);return i?i.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function T8(e,n,t){const r=e.previousIndex;if(null===r)return r;let i=0;return t&&r<t.length&&(i=t[r]),r+n+i}class E8{constructor(){}supports(n){return n instanceof Map||$R(n)}create(){return new sJ}}class sJ{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let t;for(t=this._mapHead;null!==t;t=t._next)n(t)}forEachPreviousItem(n){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)n(t)}forEachChangedItem(n){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}diff(n){if(n){if(!(n instanceof Map||$R(n)))throw new ln(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,i)=>{if(t&&t.key===i)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const l=this._getOrCreateRecordForKey(i,r);t=this._insertBeforeOrAppend(t,l)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,t){if(n){const r=n._prev;return t._next=n,t._prev=r,n._prev=t,r&&(r._next=t),n===this._mapHead&&(this._mapHead=t),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(n,t){if(this._records.has(n)){const i=this._records.get(n);this._maybeAddToChanges(i,t);const l=i._prev,u=i._next;return l&&(l._next=u),u&&(u._prev=l),i._next=null,i._prev=null,i}const r=new oJ(n);return this._records.set(n,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,t){Object.is(t,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=t,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,t){n instanceof Map?n.forEach(t):Object.keys(n).forEach(r=>t(n[r],r))}}class oJ{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function C8(){return new U3([new b8])}let U3=(()=>{class e{static#e=this.\u0275prov=It({token:e,providedIn:"root",factory:C8});constructor(t){this.factories=t}static create(t,r){if(null!=r){const i=r.factories.slice();t=t.concat(i)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||C8()),deps:[[e,new $m,new Hl]]}}find(t){const r=this.factories.find(i=>i.supports(t));if(null!=r)return r;throw new ln(901,!1)}}return e})();function S8(){return new kI([new E8])}let kI=(()=>{class e{static#e=this.\u0275prov=It({token:e,providedIn:"root",factory:S8});constructor(t){this.factories=t}static create(t,r){if(r){const i=r.factories.slice();t=t.concat(i)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||S8()),deps:[[e,new $m,new Hl]]}}find(t){const r=this.factories.find(i=>i.supports(t));if(r)return r;throw new ln(901,!1)}}return e})();const cJ=p8(null,"core",[]);let uJ=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(r){return new(r||e)($n(wh))};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})();const $8=new vn("");function go(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function BI(e,n=NaN){return isNaN(parseFloat(e))||isNaN(Number(e))?n:Number(e)}function eS(e,n){Cl("NgSignals");const t=function Gh(e){const n=Object.create(hm);n.computation=e;const t=()=>{if(eo(n),Es(n),n.value===oa)throw n.error;return n.value};return t[ss]=n,t}(e);return n?.equal&&(t[ss].equal=n.equal),t}function qp(e){const n=cn(null);try{return e()}finally{cn(n)}}function H3(e,n){const t=di(e),r=n.elementInjector||R_();return new Ke(t).create(r,n.projectableNodes,n.hostElement,n.environmentInjector)}let Q8=null;function B0(){return Q8}class QJ{}const Ro=new vn("");let G3=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:()=>Qe(tQ),providedIn:"platform"})}return e})();const eQ=new vn("");let tQ=(()=>{class e extends G3{constructor(){super(),this._doc=Qe(Ro),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return B0().getBaseHref(this._doc)}onPopState(t){const r=B0().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=B0().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,i){this._history.pushState(t,r,i)}replaceState(t,r,i){this._history.replaceState(t,r,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function W3(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function ez(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function kg(e){return e&&"?"!==e[0]?"?"+e:e}let z0=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:()=>Qe(nz),providedIn:"root"})}return e})();const tz=new vn("");let nz=(()=>{class e extends z0{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Qe(Ro).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return W3(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+kg(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,l){const u=this.prepareExternalUrl(i+kg(l));this._platformLocation.pushState(t,r,u)}replaceState(t,r,i,l){const u=this.prepareExternalUrl(i+kg(l));this._platformLocation.replaceState(t,r,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(G3),$n(tz,8))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),rz=(()=>{class e extends z0{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){const r=this._platformLocation.hash??"#";return r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=W3(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,i,l){let u=this.prepareExternalUrl(i+kg(l));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.pushState(t,r,u)}replaceState(t,r,i,l){let u=this.prepareExternalUrl(i+kg(l));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(G3),$n(tz,8))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})(),tS=(()=>{class e{constructor(t){this._subject=new rr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function iQ(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(ez(iz(r))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+kg(r))}normalize(t){return e.stripTrailingSlash(function rQ(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,iz(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._locationStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+kg(r)),i)}replaceState(t,r="",i=null){this._locationStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+kg(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r,complete:i})}static#e=this.normalizeQueryParams=kg;static#t=this.joinWithSlash=W3;static#n=this.stripTrailingSlash=ez;static#r=this.\u0275fac=function(r){return new(r||e)($n(z0))};static#i=this.\u0275prov=It({token:e,factory:()=>function nQ(){return new tS($n(z0))}(),providedIn:"root"})}return e})();function iz(e){return e.replace(/\/index.html$/,"")}const sz={ADP:[void 0,void 0,0],AFN:[void 0,"\u060b",0],ALL:[void 0,void 0,0],AMD:[void 0,"\u058f",2],AOA:[void 0,"Kz"],ARS:[void 0,"$"],AUD:["A$","$"],AZN:[void 0,"\u20bc"],BAM:[void 0,"KM"],BBD:[void 0,"$"],BDT:[void 0,"\u09f3"],BHD:[void 0,void 0,3],BIF:[void 0,void 0,0],BMD:[void 0,"$"],BND:[void 0,"$"],BOB:[void 0,"Bs"],BRL:["R$"],BSD:[void 0,"$"],BWP:[void 0,"P"],BYN:[void 0,void 0,2],BYR:[void 0,void 0,0],BZD:[void 0,"$"],CAD:["CA$","$",2],CHF:[void 0,void 0,2],CLF:[void 0,void 0,4],CLP:[void 0,"$",0],CNY:["CN\xa5","\xa5"],COP:[void 0,"$",2],CRC:[void 0,"\u20a1",2],CUC:[void 0,"$"],CUP:[void 0,"$"],CZK:[void 0,"K\u010d",2],DJF:[void 0,void 0,0],DKK:[void 0,"kr",2],DOP:[void 0,"$"],EGP:[void 0,"E\xa3"],ESP:[void 0,"\u20a7",0],EUR:["\u20ac"],FJD:[void 0,"$"],FKP:[void 0,"\xa3"],GBP:["\xa3"],GEL:[void 0,"\u20be"],GHS:[void 0,"GH\u20b5"],GIP:[void 0,"\xa3"],GNF:[void 0,"FG",0],GTQ:[void 0,"Q"],GYD:[void 0,"$",2],HKD:["HK$","$"],HNL:[void 0,"L"],HRK:[void 0,"kn"],HUF:[void 0,"Ft",2],IDR:[void 0,"Rp",2],ILS:["\u20aa"],INR:["\u20b9"],IQD:[void 0,void 0,0],IRR:[void 0,void 0,0],ISK:[void 0,"kr",0],ITL:[void 0,void 0,0],JMD:[void 0,"$"],JOD:[void 0,void 0,3],JPY:["\xa5",void 0,0],KHR:[void 0,"\u17db"],KMF:[void 0,"CF",0],KPW:[void 0,"\u20a9",0],KRW:["\u20a9",void 0,0],KWD:[void 0,void 0,3],KYD:[void 0,"$"],KZT:[void 0,"\u20b8"],LAK:[void 0,"\u20ad",0],LBP:[void 0,"L\xa3",0],LKR:[void 0,"Rs"],LRD:[void 0,"$"],LTL:[void 0,"Lt"],LUF:[void 0,void 0,0],LVL:[void 0,"Ls"],LYD:[void 0,void 0,3],MGA:[void 0,"Ar",0],MGF:[void 0,void 0,0],MMK:[void 0,"K",0],MNT:[void 0,"\u20ae",2],MRO:[void 0,void 0,0],MUR:[void 0,"Rs",2],MXN:["MX$","$"],MYR:[void 0,"RM"],NAD:[void 0,"$"],NGN:[void 0,"\u20a6"],NIO:[void 0,"C$"],NOK:[void 0,"kr",2],NPR:[void 0,"Rs"],NZD:["NZ$","$"],OMR:[void 0,void 0,3],PHP:["\u20b1"],PKR:[void 0,"Rs",2],PLN:[void 0,"z\u0142"],PYG:[void 0,"\u20b2",0],RON:[void 0,"lei"],RSD:[void 0,void 0,0],RUB:[void 0,"\u20bd"],RWF:[void 0,"RF",0],SBD:[void 0,"$"],SEK:[void 0,"kr",2],SGD:[void 0,"$"],SHP:[void 0,"\xa3"],SLE:[void 0,void 0,2],SLL:[void 0,void 0,0],SOS:[void 0,void 0,0],SRD:[void 0,"$"],SSP:[void 0,"\xa3"],STD:[void 0,void 0,0],STN:[void 0,"Db"],SYP:[void 0,"\xa3",0],THB:[void 0,"\u0e3f"],TMM:[void 0,void 0,0],TND:[void 0,void 0,3],TOP:[void 0,"T$"],TRL:[void 0,void 0,0],TRY:[void 0,"\u20ba"],TTD:[void 0,"$"],TWD:["NT$","$",2],TZS:[void 0,void 0,2],UAH:[void 0,"\u20b4"],UGX:[void 0,void 0,0],USD:["$"],UYI:[void 0,void 0,0],UYU:[void 0,"$"],UYW:[void 0,void 0,4],UZS:[void 0,void 0,2],VEF:[void 0,"Bs",2],VND:["\u20ab",void 0,0],VUV:[void 0,void 0,0],XAF:["FCFA",void 0,0],XCD:["EC$","$"],XOF:["F\u202fCFA",void 0,0],XPF:["CFPF",void 0,0],XXX:["\xa4"],YER:[void 0,void 0,0],ZAR:[void 0,"R"],ZMK:[void 0,void 0,0],ZMW:[void 0,"ZK"],ZWD:[void 0,void 0,0]};var zI=function(e){return e[e.Decimal=0]="Decimal",e[e.Percent=1]="Percent",e[e.Currency=2]="Currency",e[e.Scientific=3]="Scientific",e}(zI||{}),Zc=function(e){return e[e.Format=0]="Format",e[e.Standalone=1]="Standalone",e}(Zc||{}),Ks=function(e){return e[e.Narrow=0]="Narrow",e[e.Abbreviated=1]="Abbreviated",e[e.Wide=2]="Wide",e[e.Short=3]="Short",e}(Ks||{}),ad=function(e){return e[e.Short=0]="Short",e[e.Medium=1]="Medium",e[e.Long=2]="Long",e[e.Full=3]="Full",e}(ad||{});const ja={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function UI(e,n){return Ch(Wc(e)[no.DateFormat],n)}function VI(e,n){return Ch(Wc(e)[no.TimeFormat],n)}function jI(e,n){return Ch(Wc(e)[no.DateTimeFormat],n)}function Eh(e,n){const t=Wc(e),r=t[no.NumberSymbols][n];if(typeof r>"u"){if(n===ja.CurrencyDecimal)return t[no.NumberSymbols][ja.Decimal];if(n===ja.CurrencyGroup)return t[no.NumberSymbols][ja.Group]}return r}function q3(e,n){return Wc(e)[no.NumberFormats][n]}function oz(e){if(!e[no.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[no.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Ch(e,n){for(let t=n;t>-1;t--)if(typeof e[t]<"u")return e[t];throw new Error("Locale data API: locale data undefined")}function Z3(e){const[n,t]=e.split(":");return{hours:+n,minutes:+t}}const yQ=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,$I={},vQ=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Og=function(e){return e[e.Short=0]="Short",e[e.ShortGMT=1]="ShortGMT",e[e.Long=2]="Long",e[e.Extended=3]="Extended",e}(Og||{}),xs=function(e){return e[e.FullYear=0]="FullYear",e[e.Month=1]="Month",e[e.Date=2]="Date",e[e.Hours=3]="Hours",e[e.Minutes=4]="Minutes",e[e.Seconds=5]="Seconds",e[e.FractionalSeconds=6]="FractionalSeconds",e[e.Day=7]="Day",e}(xs||{}),bs=function(e){return e[e.DayPeriods=0]="DayPeriods",e[e.Days=1]="Days",e[e.Months=2]="Months",e[e.Eras=3]="Eras",e}(bs||{});function az(e,n,t,r){let i=function MQ(e){if(uz(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[i,l=1,u=1]=e.split("-").map(g=>+g);return HI(i,l-1,u)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let r;if(r=e.match(yQ))return function AQ(e){const n=new Date(0);let t=0,r=0;const i=e[8]?n.setUTCFullYear:n.setFullYear,l=e[8]?n.setUTCHours:n.setHours;e[9]&&(t=Number(e[9]+e[10]),r=Number(e[9]+e[11])),i.call(n,Number(e[1]),Number(e[2])-1,Number(e[3]));const u=Number(e[4]||0)-t,g=Number(e[5]||0)-r,x=Number(e[6]||0),E=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return l.call(n,u,g,x,E),n}(r)}const n=new Date(e);if(!uz(n))throw new Error(`Unable to convert "${e}" into a date`);return n}(e);n=Pg(t,n)||n;let g,u=[];for(;n;){if(g=vQ.exec(n),!g){u.push(n);break}{u=u.concat(g.slice(1));const D=u.pop();if(!D)break;n=D}}let x=i.getTimezoneOffset();r&&(x=cz(r,x),i=function DQ(e,n,t){const r=t?-1:1,i=e.getTimezoneOffset();return function SQ(e,n){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+n),e}(e,r*(cz(n,i)-i))}(i,r,!0));let E="";return u.forEach(D=>{const R=function CQ(e){if(Y3[e])return Y3[e];let n;switch(e){case"G":case"GG":case"GGG":n=ro(bs.Eras,Ks.Abbreviated);break;case"GGGG":n=ro(bs.Eras,Ks.Wide);break;case"GGGGG":n=ro(bs.Eras,Ks.Narrow);break;case"y":n=$a(xs.FullYear,1,0,!1,!0);break;case"yy":n=$a(xs.FullYear,2,0,!0,!0);break;case"yyy":n=$a(xs.FullYear,3,0,!1,!0);break;case"yyyy":n=$a(xs.FullYear,4,0,!1,!0);break;case"Y":n=ZI(1);break;case"YY":n=ZI(2,!0);break;case"YYY":n=ZI(3);break;case"YYYY":n=ZI(4);break;case"M":case"L":n=$a(xs.Month,1,1);break;case"MM":case"LL":n=$a(xs.Month,2,1);break;case"MMM":n=ro(bs.Months,Ks.Abbreviated);break;case"MMMM":n=ro(bs.Months,Ks.Wide);break;case"MMMMM":n=ro(bs.Months,Ks.Narrow);break;case"LLL":n=ro(bs.Months,Ks.Abbreviated,Zc.Standalone);break;case"LLLL":n=ro(bs.Months,Ks.Wide,Zc.Standalone);break;case"LLLLL":n=ro(bs.Months,Ks.Narrow,Zc.Standalone);break;case"w":n=X3(1);break;case"ww":n=X3(2);break;case"W":n=X3(1,!0);break;case"d":n=$a(xs.Date,1);break;case"dd":n=$a(xs.Date,2);break;case"c":case"cc":n=$a(xs.Day,1);break;case"ccc":n=ro(bs.Days,Ks.Abbreviated,Zc.Standalone);break;case"cccc":n=ro(bs.Days,Ks.Wide,Zc.Standalone);break;case"ccccc":n=ro(bs.Days,Ks.Narrow,Zc.Standalone);break;case"cccccc":n=ro(bs.Days,Ks.Short,Zc.Standalone);break;case"E":case"EE":case"EEE":n=ro(bs.Days,Ks.Abbreviated);break;case"EEEE":n=ro(bs.Days,Ks.Wide);break;case"EEEEE":n=ro(bs.Days,Ks.Narrow);break;case"EEEEEE":n=ro(bs.Days,Ks.Short);break;case"a":case"aa":case"aaa":n=ro(bs.DayPeriods,Ks.Abbreviated);break;case"aaaa":n=ro(bs.DayPeriods,Ks.Wide);break;case"aaaaa":n=ro(bs.DayPeriods,Ks.Narrow);break;case"b":case"bb":case"bbb":n=ro(bs.DayPeriods,Ks.Abbreviated,Zc.Standalone,!0);break;case"bbbb":n=ro(bs.DayPeriods,Ks.Wide,Zc.Standalone,!0);break;case"bbbbb":n=ro(bs.DayPeriods,Ks.Narrow,Zc.Standalone,!0);break;case"B":case"BB":case"BBB":n=ro(bs.DayPeriods,Ks.Abbreviated,Zc.Format,!0);break;case"BBBB":n=ro(bs.DayPeriods,Ks.Wide,Zc.Format,!0);break;case"BBBBB":n=ro(bs.DayPeriods,Ks.Narrow,Zc.Format,!0);break;case"h":n=$a(xs.Hours,1,-12);break;case"hh":n=$a(xs.Hours,2,-12);break;case"H":n=$a(xs.Hours,1);break;case"HH":n=$a(xs.Hours,2);break;case"m":n=$a(xs.Minutes,1);break;case"mm":n=$a(xs.Minutes,2);break;case"s":n=$a(xs.Seconds,1);break;case"ss":n=$a(xs.Seconds,2);break;case"S":n=$a(xs.FractionalSeconds,1);break;case"SS":n=$a(xs.FractionalSeconds,2);break;case"SSS":n=$a(xs.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":n=WI(Og.Short);break;case"ZZZZZ":n=WI(Og.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=WI(Og.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":n=WI(Og.Long);break;default:return null}return Y3[e]=n,n}(D);E+=R?R(i,t,x):"''"===D?"'":D.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),E}function HI(e,n,t){const r=new Date(0);return r.setFullYear(e,n,t),r.setHours(0,0,0),r}function Pg(e,n){const t=function oQ(e){return Wc(e)[no.LocaleId]}(e);if($I[t]??={},$I[t][n])return $I[t][n];let r="";switch(n){case"shortDate":r=UI(e,ad.Short);break;case"mediumDate":r=UI(e,ad.Medium);break;case"longDate":r=UI(e,ad.Long);break;case"fullDate":r=UI(e,ad.Full);break;case"shortTime":r=VI(e,ad.Short);break;case"mediumTime":r=VI(e,ad.Medium);break;case"longTime":r=VI(e,ad.Long);break;case"fullTime":r=VI(e,ad.Full);break;case"short":const i=Pg(e,"shortTime"),l=Pg(e,"shortDate");r=GI(jI(e,ad.Short),[i,l]);break;case"medium":const u=Pg(e,"mediumTime"),g=Pg(e,"mediumDate");r=GI(jI(e,ad.Medium),[u,g]);break;case"long":const x=Pg(e,"longTime"),E=Pg(e,"longDate");r=GI(jI(e,ad.Long),[x,E]);break;case"full":const D=Pg(e,"fullTime"),R=Pg(e,"fullDate");r=GI(jI(e,ad.Full),[D,R])}return r&&($I[t][n]=r),r}function GI(e,n){return n&&(e=e.replace(/\{([^}]+)}/g,function(t,r){return null!=n&&r in n?n[r]:t})),e}function zf(e,n,t="-",r,i){let l="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,l=t));let u=String(e);for(;u.length<n;)u="0"+u;return r&&(u=u.slice(u.length-n)),l+u}function $a(e,n,t=0,r=!1,i=!1){return function(l,u){let g=function bQ(e,n){switch(e){case xs.FullYear:return n.getFullYear();case xs.Month:return n.getMonth();case xs.Date:return n.getDate();case xs.Hours:return n.getHours();case xs.Minutes:return n.getMinutes();case xs.Seconds:return n.getSeconds();case xs.FractionalSeconds:return n.getMilliseconds();case xs.Day:return n.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,l);if((t>0||g>-t)&&(g+=t),e===xs.Hours)0===g&&-12===t&&(g=12);else if(e===xs.FractionalSeconds)return function xQ(e,n){return zf(e,3).substring(0,n)}(g,n);const x=Eh(u,ja.MinusSign);return zf(g,n,x,r,i)}}function ro(e,n,t=Zc.Format,r=!1){return function(i,l){return function wQ(e,n,t,r,i,l){switch(t){case bs.Months:return function cQ(e,n,t){const r=Wc(e),l=Ch([r[no.MonthsFormat],r[no.MonthsStandalone]],n);return Ch(l,t)}(n,i,r)[e.getMonth()];case bs.Days:return function lQ(e,n,t){const r=Wc(e),l=Ch([r[no.DaysFormat],r[no.DaysStandalone]],n);return Ch(l,t)}(n,i,r)[e.getDay()];case bs.DayPeriods:const u=e.getHours(),g=e.getMinutes();if(l){const E=function fQ(e){const n=Wc(e);return oz(n),(n[no.ExtraData][2]||[]).map(r=>"string"==typeof r?Z3(r):[Z3(r[0]),Z3(r[1])])}(n),D=function pQ(e,n,t){const r=Wc(e);oz(r);const l=Ch([r[no.ExtraData][0],r[no.ExtraData][1]],n)||[];return Ch(l,t)||[]}(n,i,r),R=E.findIndex(L=>{if(Array.isArray(L)){const[V,Y]=L,G=u>=V.hours&&g>=V.minutes,Q=u<Y.hours||u===Y.hours&&g<Y.minutes;if(V.hours<Y.hours){if(G&&Q)return!0}else if(G||Q)return!0}else if(L.hours===u&&L.minutes===g)return!0;return!1});if(-1!==R)return D[R]}return function aQ(e,n,t){const r=Wc(e),l=Ch([r[no.DayPeriodsFormat],r[no.DayPeriodsStandalone]],n);return Ch(l,t)}(n,i,r)[u<12?0:1];case bs.Eras:return function uQ(e,n){return Ch(Wc(e)[no.Eras],n)}(n,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${t}`)}}(i,l,e,n,t,r)}}function WI(e){return function(n,t,r){const i=-1*r,l=Eh(t,ja.MinusSign),u=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case Og.Short:return(i>=0?"+":"")+zf(u,2,l)+zf(Math.abs(i%60),2,l);case Og.ShortGMT:return"GMT"+(i>=0?"+":"")+zf(u,1,l);case Og.Long:return"GMT"+(i>=0?"+":"")+zf(u,2,l)+":"+zf(Math.abs(i%60),2,l);case Og.Extended:return 0===r?"Z":(i>=0?"+":"")+zf(u,2,l)+":"+zf(Math.abs(i%60),2,l);default:throw new Error(`Unknown zone width "${e}"`)}}}const TQ=0,qI=4;function lz(e){const n=e.getDay(),t=0===n?-3:qI-n;return HI(e.getFullYear(),e.getMonth(),e.getDate()+t)}function X3(e,n=!1){return function(t,r){let i;if(n){const l=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,u=t.getDate();i=1+Math.floor((u+l)/7)}else{const l=lz(t),u=function EQ(e){const n=HI(e,TQ,1).getDay();return HI(e,0,1+(n<=qI?qI:qI+7)-n)}(l.getFullYear()),g=l.getTime()-u.getTime();i=1+Math.round(g/6048e5)}return zf(i,e,Eh(r,ja.MinusSign))}}function ZI(e,n=!1){return function(t,r){return zf(lz(t).getFullYear(),e,Eh(r,ja.MinusSign),n)}}const Y3={};function cz(e,n){e=e.replace(/:/g,"");const t=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(t)?n:t}function uz(e){return e instanceof Date&&!isNaN(e.valueOf())}const IQ=/^(\d+)?\.((\d+)(-(\d+))?)?$/,dz=22,XI=".",nS="0",kQ=";",OQ=",",K3="#";function J3(e,n,t,r,i,l,u=!1){let g="",x=!1;if(isFinite(e)){let E=function BQ(e){let r,i,l,u,g,n=Math.abs(e)+"",t=0;for((i=n.indexOf(XI))>-1&&(n=n.replace(XI,"")),(l=n.search(/e/i))>0?(i<0&&(i=l),i+=+n.slice(l+1),n=n.substring(0,l)):i<0&&(i=n.length),l=0;n.charAt(l)===nS;l++);if(l===(g=n.length))r=[0],i=1;else{for(g--;n.charAt(g)===nS;)g--;for(i-=l,r=[],u=0;l<=g;l++,u++)r[u]=Number(n.charAt(l))}return i>dz&&(r=r.splice(0,dz-1),t=i-1,i=1),{digits:r,exponent:t,integerLen:i}}(e);u&&(E=function LQ(e){if(0===e.digits[0])return e;const n=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===n?e.digits.push(0,0):1===n&&e.digits.push(0),e.integerLen+=2),e}(E));let D=n.minInt,R=n.minFrac,L=n.maxFrac;if(l){const le=l.match(IQ);if(null===le)throw new Error(`${l} is not a valid digit info`);const me=le[1],ze=le[3],Je=le[5];null!=me&&(D=eN(me)),null!=ze&&(R=eN(ze)),null!=Je?L=eN(Je):null!=ze&&R>L&&(L=R)}!function zQ(e,n,t){if(n>t)throw new Error(`The minimum number of digits after fraction (${n}) is higher than the maximum (${t}).`);let r=e.digits,i=r.length-e.integerLen;const l=Math.min(Math.max(n,i),t);let u=l+e.integerLen,g=r[u];if(u>0){r.splice(Math.max(e.integerLen,u));for(let R=u;R<r.length;R++)r[R]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,u=l+1),r[0]=0;for(let R=1;R<u;R++)r[R]=0}if(g>=5)if(u-1<0){for(let R=0;R>u;R--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[u-1]++;for(;i<Math.max(0,l);i++)r.push(0);let x=0!==l;const E=n+e.integerLen,D=r.reduceRight(function(R,L,V,Y){return Y[V]=(L+=R)<10?L:L-10,x&&(0===Y[V]&&V>=E?Y.pop():x=!1),L>=10?1:0},0);D&&(r.unshift(D),e.integerLen++)}(E,R,L);let V=E.digits,Y=E.integerLen;const G=E.exponent;let Q=[];for(x=V.every(le=>!le);Y<D;Y++)V.unshift(0);for(;Y<0;Y++)V.unshift(0);Y>0?Q=V.splice(Y,V.length):(Q=V,V=[0]);const he=[];for(V.length>=n.lgSize&&he.unshift(V.splice(-n.lgSize,V.length).join(""));V.length>n.gSize;)he.unshift(V.splice(-n.gSize,V.length).join(""));V.length&&he.unshift(V.join("")),g=he.join(Eh(t,r)),Q.length&&(g+=Eh(t,i)+Q.join("")),G&&(g+=Eh(t,ja.Exponential)+"+"+G)}else g=Eh(t,ja.Infinity);return g=e<0&&!x?n.negPre+g+n.negSuf:n.posPre+g+n.posSuf,g}function Q3(e,n="-"){const t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(kQ),i=r[0],l=r[1],u=-1!==i.indexOf(XI)?i.split(XI):[i.substring(0,i.lastIndexOf(nS)+1),i.substring(i.lastIndexOf(nS)+1)],g=u[0],x=u[1]||"";t.posPre=g.substring(0,g.indexOf(K3));for(let D=0;D<x.length;D++){const R=x.charAt(D);R===nS?t.minFrac=t.maxFrac=D+1:R===K3?t.maxFrac=D+1:t.posSuf+=R}const E=g.split(OQ);if(t.gSize=E[1]?E[1].length:0,t.lgSize=E[2]||E[1]?(E[2]||E[1]).length:0,l){const D=i.length-t.posPre.length-t.posSuf.length,R=l.indexOf(K3);t.negPre=l.substring(0,R).replace(/'/g,""),t.negSuf=l.slice(R+D).replace(/'/g,"")}else t.negPre=n+t.posPre,t.negSuf=t.posSuf;return t}function eN(e){const n=parseInt(e);if(isNaN(n))throw new Error("Invalid integer literal when parsing "+e);return n}function pz(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const r=t.indexOf("="),[i,l]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===n)return decodeURIComponent(l)}return null}const nN=/\s+/,mz=[];let Zp=(()=>{class e{constructor(t,r){this._ngEl=t,this._renderer=r,this.initialClasses=mz,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(nN):mz}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(nN):t}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const r of t)this._updateState(r,!0);else if(null!=t)for(const r of Object.keys(t))this._updateState(r,!!t[r]);this._applyStateDiff()}_updateState(t,r){const i=this.stateMap.get(t);void 0!==i?(i.enabled!==r&&(i.changed=!0,i.enabled=r),i.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const r=t[0],i=t[1];i.changed?(this._toggleClass(r,i.enabled),i.changed=!1):i.touched||(i.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),i.touched=!1}}_toggleClass(t,r){(t=t.trim()).length>0&&t.split(nN).forEach(i=>{r?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Li),ut(id))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class jQ{constructor(n,t,r,i){this.$implicit=n,this.ngForOf=t,this.index=r,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let No=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,i){this._viewContainer=t,this._template=r,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((i,l,u)=>{if(null==i.previousIndex)r.createEmbeddedView(this._template,new jQ(i.item,this._ngForOf,-1,-1),null===u?void 0:u);else if(null==u)r.remove(null===l?void 0:l);else if(null!==l){const g=r.get(l);r.move(g,u),_z(g,i)}});for(let i=0,l=r.length;i<l;i++){const g=r.get(i).context;g.index=i,g.count=l,g.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{_z(r.get(i.currentIndex),i)})}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Zt),ut(ui),ut(U3))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function _z(e,n){e.context.$implicit=n.item}let So=(()=>{class e{constructor(t,r){this._viewContainer=t,this._context=new $Q,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){yz("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){yz("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Zt),ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class $Q{constructor(){this.$implicit=null,this.ngIf=null}}function yz(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${wo(n)}'.`)}let bv=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){const r=this._viewContainerRef;if(this._viewRef&&r.remove(r.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const i=this._createContextForwardProxy();this._viewRef=r.createEmbeddedView(this.ngTemplateOutlet,i,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,r,i)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,r,i),get:(t,r,i)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,r,i)}})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Zt))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Co]})}return e})();function Uf(e,n){return new ln(2100,!1)}const eee=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let xz=(()=>{class e{transform(t){if(null==t)return null;if("string"!=typeof t)throw Uf();return t.replace(eee,r=>r[0].toUpperCase()+r.slice(1).toLowerCase())}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275pipe=uo({name:"titlecase",type:e,pure:!0,standalone:!0})}return e})();const ree=new vn(""),iee=new vn("");let Jw=(()=>{class e{constructor(t,r,i){this.locale=t,this.defaultTimezone=r,this.defaultOptions=i}transform(t,r,i,l){if(null==t||""===t||t!=t)return null;try{return az(t,r??this.defaultOptions?.dateFormat??"mediumDate",l||this.locale,i??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(u){throw Uf()}}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Wp,16),ut(ree,24),ut(iee,24))};static#t=this.\u0275pipe=uo({name:"date",type:e,pure:!0,standalone:!0})}return e})(),bz=(()=>{class e{constructor(t){this.differs=t,this.keyValues=[],this.compareFn=wz}transform(t,r=wz){if(!t||!(t instanceof Map)&&"object"!=typeof t)return null;this.differ??=this.differs.find(t).create();const i=this.differ.diff(t),l=r!==this.compareFn;return i&&(this.keyValues=[],i.forEachItem(u=>{this.keyValues.push(function cee(e,n){return{key:e,value:n}}(u.key,u.currentValue))})),(i||l)&&(this.keyValues.sort(r),this.compareFn=r),this.keyValues}static#e=this.\u0275fac=function(r){return new(r||e)(ut(kI,16))};static#t=this.\u0275pipe=uo({name:"keyvalue",type:e,pure:!1,standalone:!0})}return e})();function wz(e,n){const t=e.key,r=n.key;if(t===r)return 0;if(void 0===t)return 1;if(void 0===r)return-1;if(null===t)return 1;if(null===r)return-1;if("string"==typeof t&&"string"==typeof r)return t<r?-1:1;if("number"==typeof t&&"number"==typeof r)return t-r;if("boolean"==typeof t&&"boolean"==typeof r)return t<r?-1:1;const i=String(t),l=String(r);return i==l?0:i<l?-1:1}let YI=(()=>{class e{constructor(t){this._locale=t}transform(t,r,i){if(!sN(t))return null;i||=this._locale;try{return function FQ(e,n,t){return J3(e,Q3(q3(n,zI.Decimal),Eh(n,ja.MinusSign)),n,ja.Group,ja.Decimal,t)}(oN(t),i,r)}catch(l){throw Uf()}}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Wp,16))};static#t=this.\u0275pipe=uo({name:"number",type:e,pure:!0,standalone:!0})}return e})(),ld=(()=>{class e{constructor(t,r="USD"){this._locale=t,this._defaultCurrencyCode=r}transform(t,r=this._defaultCurrencyCode,i="symbol",l,u){if(!sN(t))return null;u||=this._locale,"boolean"==typeof i&&(i=i?"symbol":"code");let g=r||this._defaultCurrencyCode;"code"!==i&&(g="symbol"===i||"symbol-narrow"===i?function mQ(e,n,t="en"){const r=function dQ(e){return Wc(e)[no.Currencies]}(t)[e]||sz[e]||[],i=r[1];return"narrow"===n&&"string"==typeof i?i:r[0]||e}(g,"symbol"===i?"wide":"narrow",u):i);try{return function RQ(e,n,t,r,i){const u=Q3(q3(n,zI.Currency),Eh(n,ja.MinusSign));return u.minFrac=function _Q(e){let n;const t=sz[e];return t&&(n=t[2]),"number"==typeof n?n:2}(r),u.maxFrac=u.minFrac,J3(e,u,n,ja.CurrencyGroup,ja.CurrencyDecimal,i).replace("\xa4",t).replace("\xa4","").trim()}(oN(t),u,g,r,l)}catch(x){throw Uf()}}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Wp,16),ut(GK,16))};static#t=this.\u0275pipe=uo({name:"currency",type:e,pure:!0,standalone:!0})}return e})();function sN(e){return!(null==e||""===e||e!=e)}function oN(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}let Tz=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})();const Ez="browser";function Cz(e){return"server"===e}let fee=(()=>{class e{static#e=this.\u0275prov=It({token:e,providedIn:"root",factory:()=>function hee(e){return e===Ez}(Qe(Dp))?new pee(Qe(Ro),window):new gee})}return e})();class pee{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n){this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){const t=function mee(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const l=i.shadowRoot;if(l){const u=l.getElementById(n)||l.querySelector(`[name="${n}"]`);if(u)return u}i=r.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.window.history.scrollRestoration=n}scrollToElement(n){const t=n.getBoundingClientRect(),r=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,l=this.offset();this.window.scrollTo(r-l[0],i-l[1])}}class gee{setOffset(n){}getScrollPosition(){return[0,0]}scrollToPosition(n){}scrollToAnchor(n){}setHistoryScrollRestoration(n){}}class Sz{}class Hee extends QJ{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class uN extends Hee{static makeCurrent(){!function JJ(e){Q8??=e}(new uN)}onAndCancel(n,t,r){return n.addEventListener(t,r),()=>{n.removeEventListener(t,r)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function Gee(){return sS=sS||document.querySelector("base"),sS?sS.getAttribute("href"):null}();return null==t?null:function Wee(e){return new URL(e,document.baseURI).pathname}(t)}resetBaseElement(){sS=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return pz(document.cookie,n)}}let sS=null,Zee=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();const ek=new vn("");let Fz=(()=>{class e{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(l=>l.supports(t)),!r)throw new ln(5101,!1);return this._eventNameToPlugin.set(t,r),r}static#e=this.\u0275fac=function(r){return new(r||e)($n(ek),$n(ni))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();class dN{constructor(n){this._doc=n}}const hN="ng-app-id";let Lz=(()=>{class e{constructor(t,r,i,l={}){this.doc=t,this.appId=r,this.nonce=i,this.platformId=l,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Cz(l),this.resetHostNodes()}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.elements?.forEach(i=>i.remove()),r.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${hN}="${this.appId}"]`);if(t?.length){const r=new Map;return t.forEach(i=>{null!=i.textContent&&r.set(i.textContent,i)}),r}return null}changeUsageCount(t,r){const i=this.styleRef;if(i.has(t)){const l=i.get(t);return l.usage+=r,l.usage}return i.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){const i=this.styleNodesInDOM,l=i?.get(r);if(l?.parentNode===t)return i.delete(r),l.removeAttribute(hN),l;{const u=this.doc.createElement("style");return this.nonce&&u.setAttribute("nonce",this.nonce),u.textContent=r,this.platformIsServer&&u.setAttribute(hN,this.appId),t.appendChild(u),u}}addStyleToHost(t,r){const i=this.getStyleElement(t,r),l=this.styleRef,u=l.get(r)?.elements;u?u.push(i):l.set(r,{elements:[i],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Ro),$n(Xl),$n(yM,8),$n(Dp))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();const fN={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},pN=/%COMP%/g,Jee=new vn("",{providedIn:"root",factory:()=>!0});function zz(e,n){return n.map(t=>t.replace(pN,e))}let Uz=(()=>{class e{constructor(t,r,i,l,u,g,x,E=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=l,this.doc=u,this.platformId=g,this.ngZone=x,this.nonce=E,this.rendererByCompId=new Map,this.platformIsServer=Cz(g),this.defaultRenderer=new mN(t,u,x,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Fa.ShadowDom&&(r={...r,encapsulation:Fa.Emulated});const i=this.getOrCreateRenderer(t,r);return i instanceof jz?i.applyToHost(t):i instanceof gN&&i.applyStyles(),i}getOrCreateRenderer(t,r){const i=this.rendererByCompId;let l=i.get(r.id);if(!l){const u=this.doc,g=this.ngZone,x=this.eventManager,E=this.sharedStylesHost,D=this.removeStylesOnCompDestroy,R=this.platformIsServer;switch(r.encapsulation){case Fa.Emulated:l=new jz(x,E,r,this.appId,D,u,g,R);break;case Fa.ShadowDom:return new nte(x,E,t,r,u,g,this.nonce,R);default:l=new gN(x,E,r,D,u,g,R)}i.set(r.id,l)}return l}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||e)($n(Fz),$n(Lz),$n(Xl),$n(Jee),$n(Ro),$n(Dp),$n(ni),$n(yM))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();class mN{constructor(n,t,r,i){this.eventManager=n,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(fN[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(Vz(n)?n.content:n).appendChild(t)}insertBefore(n,t,r){n&&(Vz(n)?n.content:n).insertBefore(t,r)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new ln(-5104,!1);return t||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,r,i){if(i){t=i+":"+t;const l=fN[i];l?n.setAttributeNS(l,t,r):n.setAttribute(t,r)}else n.setAttribute(t,r)}removeAttribute(n,t,r){if(r){const i=fN[r];i?n.removeAttributeNS(i,t):n.removeAttribute(`${r}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,r,i){i&(Af.DashCase|Af.Important)?n.style.setProperty(t,r,i&Af.Important?"important":""):n.style[t]=r}removeStyle(n,t,r){r&Af.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,r){null!=n&&(n[t]=r)}setValue(n,t){n.nodeValue=t}listen(n,t,r){if("string"==typeof n&&!(n=B0().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(r))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function Vz(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class nte extends mN{constructor(n,t,r,i,l,u,g,x){super(n,l,u,x),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const E=zz(i.id,i.styles);for(const D of E){const R=document.createElement("style");g&&R.setAttribute("nonce",g),R.textContent=D,this.shadowRoot.appendChild(R)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,r){return super.insertBefore(this.nodeOrShadowRoot(n),t,r)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class gN extends mN{constructor(n,t,r,i,l,u,g,x){super(n,l,u,g),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=x?zz(x,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class jz extends gN{constructor(n,t,r,i,l,u,g,x){const E=i+"-"+r.id;super(n,t,r,l,u,g,x,E),this.contentAttr=function Qee(e){return"_ngcontent-%COMP%".replace(pN,e)}(E),this.hostAttr=function ete(e){return"_nghost-%COMP%".replace(pN,e)}(E)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const r=super.createElement(n,t);return super.setAttribute(r,this.contentAttr,""),r}}let rte=(()=>{class e extends dN{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Ro))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})(),ite=(()=>{class e extends dN{constructor(t){super(t),this.delegate=Qe($8,{optional:!0})}supports(t){return!!this.delegate&&this.delegate.supports(t)}addEventListener(t,r,i){return this.delegate.addEventListener(t,r,i)}removeEventListener(t,r,i){return this.delegate.removeEventListener(t,r,i)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Ro))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();const $z=["alt","control","meta","shift"],ste={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ote={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let ate=(()=>{class e extends dN{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,i){const l=e.parseEventName(r),u=e.eventCallback(l.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>B0().onAndCancel(t,l.domEventName,u))}static parseEventName(t){const r=t.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const l=e._normalizeKey(r.pop());let u="",g=r.indexOf("code");if(g>-1&&(r.splice(g,1),u="code."),$z.forEach(E=>{const D=r.indexOf(E);D>-1&&(r.splice(D,1),u+=E+".")}),u+=l,0!=r.length||0===l.length)return null;const x={};return x.domEventName=i,x.fullKey=u,x}static matchEventFullKeyCode(t,r){let i=ste[t.key]||t.key,l="";return r.indexOf("code.")>-1&&(i=t.code,l="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),$z.forEach(u=>{u!==i&&(0,ote[u])(t)&&(l+=u+".")}),l+=i,l===r)}static eventCallback(t,r,i){return l=>{e.matchEventFullKeyCode(l,t)&&i.runGuarded(()=>r(l))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(r){return new(r||e)($n(Ro))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();const dte=p8(cJ,"browser",[{provide:Dp,useValue:Ez},{provide:_M,useValue:function lte(){uN.makeCurrent()},multi:!0},{provide:Ro,useFactory:function ute(){return function mM(e){wb=e}(document),document},deps:[]}]),hte=new vn(""),Wz=[{provide:CI,useClass:class qee{addToWindow(n){bi.getAngularTestability=(r,i=!0)=>{const l=n.findTestabilityInTree(r,i);if(null==l)throw new ln(5103,!1);return l},bi.getAllAngularTestabilities=()=>n.getAllTestabilities(),bi.getAllAngularRootElements=()=>n.getAllRootElements(),bi.frameworkStabilizers||(bi.frameworkStabilizers=[]),bi.frameworkStabilizers.push(r=>{const i=bi.getAllAngularTestabilities();let l=i.length;const u=function(){l--,0==l&&r()};i.forEach(g=>{g.whenStable(u)})})}findTestabilityInTree(n,t,r){return null==t?null:n.getTestability(t)??(r?B0().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:n8,useClass:S3,deps:[ni,D3,CI]},{provide:S3,useClass:S3,deps:[ni,D3,CI]}],qz=[{provide:pf,useValue:"root"},{provide:Po,useFactory:function cte(){return new Po},deps:[]},{provide:ek,useClass:rte,multi:!0,deps:[Ro,ni,Dp]},{provide:ek,useClass:ate,multi:!0,deps:[Ro]},{provide:ek,useClass:ite,multi:!0},Uz,Lz,Fz,{provide:mC,useExisting:Uz},{provide:Sz,useClass:Zee,deps:[]},[]];let fte=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Xl,useValue:t.appId}]}}static#e=this.\u0275fac=function(r){return new(r||e)($n(hte,12))};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({providers:[...qz,...Wz],imports:[Tz,uJ]})}return e})(),pte=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(r){return new(r||e)($n(Ro))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),tk=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:function(r){let i=null;return i=r?new(r||e):$n(yte),i},providedIn:"root"})}return e})(),yte=(()=>{class e extends tk{constructor(t){super(),this._doc=t}sanitize(t,r){if(null==r)return null;switch(t){case Hc.NONE:return r;case Hc.HTML:return Ju(r,"HTML")?pc(r):vE(this._doc,String(r)).toString();case Hc.STYLE:return Ju(r,"Style")?pc(r):r;case Hc.SCRIPT:if(Ju(r,"Script"))return pc(r);throw new ln(5200,!1);case Hc.URL:return Ju(r,"URL")?pc(r):Fb(String(r));case Hc.RESOURCE_URL:if(Ju(r,"ResourceURL"))return pc(r);throw new ln(5201,!1);default:throw new ln(5202,!1)}}bypassSecurityTrustHtml(t){return function PM(e){return new Nb(e)}(t)}bypassSecurityTrustStyle(t){return function RM(e){return new IM(e)}(t)}bypassSecurityTrustScript(t){return function jP(e){return new VP(e)}(t)}bypassSecurityTrustUrl(t){return function NM(e){return new kM(e)}(t)}bypassSecurityTrustResourceUrl(t){return function FM(e){return new hE(e)}(t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Ro))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Yz(e,n,t,r,i,l,u){try{var g=e[l](u),x=g.value}catch(E){return void t(E)}g.done?n(x):Promise.resolve(x).then(r,i)}function Kz(e){return function(){var n=this,t=arguments;return new Promise(function(r,i){var l=e.apply(n,t);function u(x){Yz(l,r,i,u,g,"next",x)}function g(x){Yz(l,r,i,u,g,"throw",x)}u(void 0)})}}function Jz(e){return e&&xr(e.schedule)}function _N(e){return e[e.length-1]}function rk(e){return xr(_N(e))?e.pop():void 0}function oS(e){return Jz(_N(e))?e.pop():void 0}function U0(e){return this instanceof U0?(this.v=e,this):new U0(e)}function nU(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function bN(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(l){t[l]=e[l]&&function(u){return new Promise(function(g,x){!function i(l,u,g,x){Promise.resolve(x).then(function(E){l({value:E,done:g})},u)}(g,x,(u=e[l](u)).done,u.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const wN=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function rU(e){return xr(e?.then)}function iU(e){return xr(e[kd])}function sU(e){return Symbol.asyncIterator&&xr(e?.[Symbol.asyncIterator])}function oU(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const aU=function Vte(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function lU(e){return xr(e?.[aU])}function cU(e){return function tU(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=t.apply(e,n||[]),l=[];return i={},g("next"),g("throw"),g("return",function u(V){return function(Y){return Promise.resolve(Y).then(V,R)}}),i[Symbol.asyncIterator]=function(){return this},i;function g(V,Y){r[V]&&(i[V]=function(G){return new Promise(function(Q,he){l.push([V,G,Q,he])>1||x(V,G)})},Y&&(i[V]=Y(i[V])))}function x(V,Y){try{!function E(V){V.value instanceof U0?Promise.resolve(V.value.v).then(D,R):L(l[0][2],V)}(r[V](Y))}catch(G){L(l[0][3],G)}}function D(V){x("next",V)}function R(V){x("throw",V)}function L(V,Y){V(Y),l.shift(),l.length&&x(l[0][0],l[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:i}=yield U0(t.read());if(i)return yield U0(void 0);yield yield U0(r)}}finally{t.releaseLock()}})}function uU(e){return xr(e?.getReader)}function Dl(e){if(e instanceof Di)return e;if(null!=e){if(iU(e))return function jte(e){return new Di(n=>{const t=e[kd]();if(xr(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(wN(e))return function $te(e){return new Di(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(rU(e))return function Hte(e){return new Di(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,cs)})}(e);if(sU(e))return dU(e);if(lU(e))return function Gte(e){return new Di(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(uU(e))return function Wte(e){return dU(cU(e))}(e)}throw oU(e)}function dU(e){return new Di(n=>{(function qte(e,n){var t,r,i,l;return function Qz(e,n,t,r){return new(t||(t=Promise))(function(l,u){function g(D){try{E(r.next(D))}catch(R){u(R)}}function x(D){try{E(r.throw(D))}catch(R){u(R)}}function E(D){D.done?l(D.value):function i(l){return l instanceof t?l:new t(function(u){u(l)})}(D.value).then(g,x)}E((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=nU(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(u){i={error:u}}finally{try{r&&!r.done&&(l=t.return)&&(yield l.call(t))}finally{if(i)throw i.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Rg(e,n,t,r=0,i=!1){const l=n.schedule(function(){t(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(l),!i)return l}function hU(e,n=0){return Ie((t,r)=>{t.subscribe(te(r,i=>Rg(r,e,()=>r.next(i),n),()=>Rg(r,e,()=>r.complete(),n),i=>Rg(r,e,()=>r.error(i),n)))})}function fU(e,n=0){return Ie((t,r)=>{r.add(e.schedule(()=>t.subscribe(r),n))})}function pU(e,n){if(!e)throw new Error("Iterable cannot be null");return new Di(t=>{Rg(t,n,()=>{const r=e[Symbol.asyncIterator]();Rg(t,n,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function Ha(e,n){return n?function Qte(e,n){if(null!=e){if(iU(e))return function Zte(e,n){return Dl(e).pipe(fU(n),hU(n))}(e,n);if(wN(e))return function Yte(e,n){return new Di(t=>{let r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}(e,n);if(rU(e))return function Xte(e,n){return Dl(e).pipe(fU(n),hU(n))}(e,n);if(sU(e))return pU(e,n);if(lU(e))return function Kte(e,n){return new Di(t=>{let r;return Rg(t,n,()=>{r=e[aU](),Rg(t,n,()=>{let i,l;try{({value:i,done:l}=r.next())}catch(u){return void t.error(u)}l?t.complete():t.next(i)},0,!0)}),()=>xr(r?.return)&&r.return()})}(e,n);if(uU(e))return function Jte(e,n){return pU(cU(e),n)}(e,n)}throw oU(e)}(e,n):Dl(e)}function jr(...e){return Ha(e,oS(e))}function Ml(e,n,t=1/0){return xr(n)?Ml((r,i)=>pe((l,u)=>n(r,l,i,u))(Dl(e(r,i))),t):("number"==typeof n&&(t=n),Ie((r,i)=>function ene(e,n,t,r,i,l,u,g){const x=[];let E=0,D=0,R=!1;const L=()=>{R&&!x.length&&!E&&n.complete()},V=G=>E<r?Y(G):x.push(G),Y=G=>{l&&n.next(G),E++;let Q=!1;Dl(t(G,D++)).subscribe(te(n,he=>{i?.(he),l?V(he):n.next(he)},()=>{Q=!0},void 0,()=>{if(Q)try{for(E--;x.length&&E<r;){const he=x.shift();u?Rg(n,u,()=>Y(he)):Y(he)}L()}catch(he){n.error(he)}}))};return e.subscribe(te(n,V,()=>{R=!0,L()})),()=>{g?.()}}(r,i,e,t)))}function e2(e,n){return xr(n)?Ml(e,n,1):Ml(e,1)}function Ga(e,n){return Ie((t,r)=>{let i=0;t.subscribe(te(r,l=>e.call(n,l,i++)&&r.next(l)))})}function aS(e){return Ie((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}function Sh(e,n){return Ie((t,r)=>{let i=null,l=0,u=!1;const g=()=>u&&!i&&r.complete();t.subscribe(te(r,x=>{i?.unsubscribe();let E=0;const D=l++;Dl(e(x,D)).subscribe(i=te(r,R=>r.next(n?n(x,R,D,E++):R),()=>{i=null,g()}))},()=>{u=!0,g()}))})}class ik{}class sk{}class Cu{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const i=t.slice(0,r),l=i.toLowerCase(),u=t.slice(r+1).trim();this.maybeSetNormalizedName(i,l),this.headers.has(l)?this.headers.get(l).push(u):this.headers.set(l,[u])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof Cu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){const t=new Cu;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Cu?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){const t=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,t);const i=("a"===n.op?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":const l=n.value;if(l){let u=this.headers.get(t);if(!u)return;u=u.filter(g=>-1===l.indexOf(g)),0===u.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,u)}else this.headers.delete(t),this.normalizedNames.delete(t)}}setHeaderEntries(n,t){const r=(Array.isArray(t)?t:[t]).map(l=>l.toString()),i=n.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(n,i)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}}class tne{encodeKey(n){return mU(n)}encodeValue(n){return mU(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const rne=/%(\d[a-f0-9])/gi,ine={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function mU(e){return encodeURIComponent(e).replace(rne,(n,t)=>ine[t]??n)}function ok(e){return`${e}`}class Xp{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new tne,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function nne(e,n){const t=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(i=>{const l=i.indexOf("="),[u,g]=-1==l?[n.decodeKey(i),""]:[n.decodeKey(i.slice(0,l)),n.decodeValue(i.slice(l+1))],x=t.get(u)||[];x.push(g),t.set(u,x)}),t}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{const r=n.fromObject[t],i=Array.isArray(r)?r.map(ok):[ok(r)];this.map.set(t,i)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){const t=[];return Object.keys(n).forEach(r=>{const i=n[r];Array.isArray(i)?i.forEach(l=>{t.push({param:r,value:l,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const t=this.encoder.encodeKey(n);return this.map.get(n).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const t=new Xp({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const t=("a"===n.op?this.map.get(n.param):void 0)||[];t.push(ok(n.value)),this.map.set(n.param,t);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const i=r.indexOf(ok(n.value));-1!==i&&r.splice(i,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class sne{constructor(){this.map=new Map}set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function gU(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function _U(e){return typeof Blob<"u"&&e instanceof Blob}function yU(e){return typeof FormData<"u"&&e instanceof FormData}class lS{constructor(n,t,r,i){let l;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function one(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==r?r:null,l=i):l=r,l&&(this.reportProgress=!!l.reportProgress,this.withCredentials=!!l.withCredentials,l.responseType&&(this.responseType=l.responseType),l.headers&&(this.headers=l.headers),l.context&&(this.context=l.context),l.params&&(this.params=l.params),this.transferCache=l.transferCache),this.headers??=new Cu,this.context??=new sne,this.params){const u=this.params.toString();if(0===u.length)this.urlWithParams=t;else{const g=t.indexOf("?");this.urlWithParams=t+(-1===g?"?":g<t.length-1?"&":"")+u}}else this.params=new Xp,this.urlWithParams=t}serializeBody(){return null===this.body?null:"string"==typeof this.body||gU(this.body)||_U(this.body)||yU(this.body)||function ane(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)?this.body:this.body instanceof Xp?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||yU(this.body)?null:_U(this.body)?this.body.type||null:gU(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Xp?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const t=n.method||this.method,r=n.url||this.url,i=n.responseType||this.responseType,l=n.transferCache??this.transferCache,u=void 0!==n.body?n.body:this.body,g=n.withCredentials??this.withCredentials,x=n.reportProgress??this.reportProgress;let E=n.headers||this.headers,D=n.params||this.params;const R=n.context??this.context;return void 0!==n.setHeaders&&(E=Object.keys(n.setHeaders).reduce((L,V)=>L.set(V,n.setHeaders[V]),E)),n.setParams&&(D=Object.keys(n.setParams).reduce((L,V)=>L.set(V,n.setParams[V]),D)),new lS(t,r,u,{params:D,headers:E,context:R,reportProgress:x,responseType:i,withCredentials:g,transferCache:l})}}var V0=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(V0||{});class TN{constructor(n,t=200,r="OK"){this.headers=n.headers||new Cu,this.status=void 0!==n.status?n.status:t,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class ak extends TN{constructor(n={}){super(n),this.type=V0.ResponseHeader}clone(n={}){return new ak({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class Tv extends TN{constructor(n={}){super(n),this.type=V0.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new Tv({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class t2 extends TN{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function EN(e,n){return{body:n,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache}}let Al=(()=>{class e{constructor(t){this.handler=t}request(t,r,i={}){let l;if(t instanceof lS)l=t;else{let x,E;x=i.headers instanceof Cu?i.headers:new Cu(i.headers),i.params&&(E=i.params instanceof Xp?i.params:new Xp({fromObject:i.params})),l=new lS(t,r,void 0!==i.body?i.body:null,{headers:x,context:i.context,params:E,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials,transferCache:i.transferCache})}const u=jr(l).pipe(e2(x=>this.handler.handle(x)));if(t instanceof lS||"events"===i.observe)return u;const g=u.pipe(Ga(x=>x instanceof Tv));switch(i.observe||"body"){case"body":switch(l.responseType){case"arraybuffer":return g.pipe(pe(x=>{if(null!==x.body&&!(x.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return x.body}));case"blob":return g.pipe(pe(x=>{if(null!==x.body&&!(x.body instanceof Blob))throw new Error("Response is not a Blob.");return x.body}));case"text":return g.pipe(pe(x=>{if(null!==x.body&&"string"!=typeof x.body)throw new Error("Response is not a string.");return x.body}));default:return g.pipe(pe(x=>x.body))}case"response":return g;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new Xp).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,i={}){return this.request("PATCH",t,EN(i,r))}post(t,r,i={}){return this.request("POST",t,EN(i,r))}put(t,r,i={}){return this.request("PUT",t,EN(i,r))}static#e=this.\u0275fac=function(r){return new(r||e)($n(ik))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();const une=/^\)\]\}',?\n/;function xU(e){if(e.url)return e.url;const n="X-Request-URL".toLocaleLowerCase();return e.headers.get(n)}let CN=(()=>{class e{constructor(){this.fetchImpl=Qe(hne,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Qe(ni)}handle(t){return new Di(r=>{const i=new AbortController;return this.doRequest(t,i.signal,r).then(SN,l=>r.error(new t2({error:l}))),()=>i.abort()})}doRequest(t,r,i){var l=this;return Kz(function*(){const u=l.createRequestInit(t);let g;try{const Y=l.ngZone.runOutsideAngular(()=>l.fetchImpl(t.urlWithParams,{signal:r,...u}));(function fne(e){e.then(SN,SN)})(Y),i.next({type:V0.Sent}),g=yield Y}catch(Y){return void i.error(new t2({error:Y,status:Y.status??0,statusText:Y.statusText,url:t.urlWithParams,headers:Y.headers}))}const x=new Cu(g.headers),E=g.statusText,D=xU(g)??t.urlWithParams;let R=g.status,L=null;if(t.reportProgress&&i.next(new ak({headers:x,status:R,statusText:E,url:D})),g.body){const Y=g.headers.get("content-length"),G=[],Q=g.body.getReader();let le,me,he=0;const ze=typeof Zone<"u"&&Zone.current;yield l.ngZone.runOutsideAngular(Kz(function*(){for(;;){const{done:ht,value:Ne}=yield Q.read();if(ht)break;if(G.push(Ne),he+=Ne.length,t.reportProgress){me="text"===t.responseType?(me??"")+(le??=new TextDecoder).decode(Ne,{stream:!0}):void 0;const dt=()=>i.next({type:V0.DownloadProgress,total:Y?+Y:void 0,loaded:he,partialText:me});ze?ze.run(dt):dt()}}}));const Je=l.concatChunks(G,he);try{const ht=g.headers.get("Content-Type")??"";L=l.parseBody(t,Je,ht)}catch(ht){return void i.error(new t2({error:ht,headers:new Cu(g.headers),status:g.status,statusText:g.statusText,url:xU(g)??t.urlWithParams}))}}0===R&&(R=L?200:0),R>=200&&R<300?(i.next(new Tv({body:L,headers:x,status:R,statusText:E,url:D})),i.complete()):i.error(new t2({error:L,headers:x,status:R,statusText:E,url:D}))})()}parseBody(t,r,i){switch(t.responseType){case"json":const l=(new TextDecoder).decode(r).replace(une,"");return""===l?null:JSON.parse(l);case"text":return(new TextDecoder).decode(r);case"blob":return new Blob([r],{type:i});case"arraybuffer":return r.buffer}}createRequestInit(t){const r={},i=t.withCredentials?"include":void 0;if(t.headers.forEach((l,u)=>r[l]=u.join(",")),t.headers.has("Accept")||(r.Accept="application/json, text/plain, */*"),!t.headers.has("Content-Type")){const l=t.detectContentTypeHeader();null!==l&&(r["Content-Type"]=l)}return{body:t.serializeBody(),method:t.method,headers:r,credentials:i}}concatChunks(t,r){const i=new Uint8Array(r);let l=0;for(const u of t)i.set(u,l),l+=u.length;return i}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();class hne{}function SN(){}function bU(e,n){return n(e)}function pne(e,n){return(t,r)=>n.intercept(t,{handle:i=>e(i,r)})}const gne=new vn(""),cS=new vn(""),wU=new vn(""),TU=new vn("",{providedIn:"root",factory:()=>!0});function _ne(){let e=null;return(n,t)=>{null===e&&(e=(Qe(gne,{optional:!0})??[]).reduceRight(pne,bU));const r=Qe(ol);if(Qe(TU)){const l=r.add();return e(n,t).pipe(aS(()=>r.remove(l)))}return e(n,t)}}let EU=(()=>{class e extends ik{constructor(t,r){super(),this.backend=t,this.injector=r,this.chain=null,this.pendingTasks=Qe(ol),this.contributeToStability=Qe(TU)}handle(t){if(null===this.chain){const r=Array.from(new Set([...this.injector.get(cS),...this.injector.get(wU,[])]));this.chain=r.reduceRight((i,l)=>function mne(e,n,t){return(r,i)=>y(t,()=>n(r,l=>e(l,i)))}(i,l,this.injector),bU)}if(this.contributeToStability){const r=this.pendingTasks.add();return this.chain(t,i=>this.backend.handle(i)).pipe(aS(()=>this.pendingTasks.remove(r)))}return this.chain(t,r=>this.backend.handle(r))}static#e=this.\u0275fac=function(r){return new(r||e)($n(sk),$n(Go))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();const wne=/^\)\]\}',?\n/;let SU=(()=>{class e{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new ln(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?Ha(r.\u0275loadImpl()):jr(null)).pipe(Sh(()=>new Di(l=>{const u=r.build();if(u.open(t.method,t.urlWithParams),t.withCredentials&&(u.withCredentials=!0),t.headers.forEach((G,Q)=>u.setRequestHeader(G,Q.join(","))),t.headers.has("Accept")||u.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const G=t.detectContentTypeHeader();null!==G&&u.setRequestHeader("Content-Type",G)}if(t.responseType){const G=t.responseType.toLowerCase();u.responseType="json"!==G?G:"text"}const g=t.serializeBody();let x=null;const E=()=>{if(null!==x)return x;const G=u.statusText||"OK",Q=new Cu(u.getAllResponseHeaders()),he=function Tne(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(u)||t.url;return x=new ak({headers:Q,status:u.status,statusText:G,url:he}),x},D=()=>{let{headers:G,status:Q,statusText:he,url:le}=E(),me=null;204!==Q&&(me=typeof u.response>"u"?u.responseText:u.response),0===Q&&(Q=me?200:0);let ze=Q>=200&&Q<300;if("json"===t.responseType&&"string"==typeof me){const Je=me;me=me.replace(wne,"");try{me=""!==me?JSON.parse(me):null}catch(ht){me=Je,ze&&(ze=!1,me={error:ht,text:me})}}ze?(l.next(new Tv({body:me,headers:G,status:Q,statusText:he,url:le||void 0})),l.complete()):l.error(new t2({error:me,headers:G,status:Q,statusText:he,url:le||void 0}))},R=G=>{const{url:Q}=E(),he=new t2({error:G,status:u.status||0,statusText:u.statusText||"Unknown Error",url:Q||void 0});l.error(he)};let L=!1;const V=G=>{L||(l.next(E()),L=!0);let Q={type:V0.DownloadProgress,loaded:G.loaded};G.lengthComputable&&(Q.total=G.total),"text"===t.responseType&&u.responseText&&(Q.partialText=u.responseText),l.next(Q)},Y=G=>{let Q={type:V0.UploadProgress,loaded:G.loaded};G.lengthComputable&&(Q.total=G.total),l.next(Q)};return u.addEventListener("load",D),u.addEventListener("error",R),u.addEventListener("timeout",R),u.addEventListener("abort",R),t.reportProgress&&(u.addEventListener("progress",V),null!==g&&u.upload&&u.upload.addEventListener("progress",Y)),u.send(g),l.next({type:V0.Sent}),()=>{u.removeEventListener("error",R),u.removeEventListener("abort",R),u.removeEventListener("load",D),u.removeEventListener("timeout",R),t.reportProgress&&(u.removeEventListener("progress",V),null!==g&&u.upload&&u.upload.removeEventListener("progress",Y)),u.readyState!==u.DONE&&u.abort()}})))}static#e=this.\u0275fac=function(r){return new(r||e)($n(Sz))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();const DN=new vn(""),DU=new vn("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),MU=new vn("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class AU{}let Sne=(()=>{class e{constructor(t,r,i){this.doc=t,this.platform=r,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=pz(t,this.cookieName),this.lastCookieString=t),this.lastToken}static#e=this.\u0275fac=function(r){return new(r||e)($n(Ro),$n(Dp),$n(DU))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();function Dne(e,n){const t=e.url.toLowerCase();if(!Qe(DN)||"GET"===e.method||"HEAD"===e.method||t.startsWith("http://")||t.startsWith("https://"))return n(e);const r=Qe(AU).getToken(),i=Qe(MU);return null!=r&&!e.headers.has(i)&&(e=e.clone({headers:e.headers.set(i,r)})),n(e)}var j0=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(j0||{});function Mne(...e){const n=[Al,SU,EU,{provide:ik,useExisting:EU},{provide:sk,useFactory:()=>Qe(CN,{optional:!0})??Qe(SU)},{provide:cS,useValue:Dne,multi:!0},{provide:DN,useValue:!0},{provide:AU,useClass:Sne}];for(const t of e)n.push(...t.\u0275providers);return function Qm(e){return{\u0275providers:e}}(n)}const IU=new vn("");function Ane(){return function Ev(e,n){return{\u0275kind:e,\u0275providers:n}}(j0.LegacyInterceptors,[{provide:IU,useFactory:_ne},{provide:cS,useExisting:IU,multi:!0}])}let Ine=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({providers:[Mne(Ane())]})}return e})();const{isArray:Une}=Array,{getPrototypeOf:Vne,prototype:jne,keys:$ne}=Object;function BU(e){if(1===e.length){const n=e[0];if(Une(n))return{args:n,keys:null};if(function Hne(e){return e&&"object"==typeof e&&Vne(e)===jne}(n)){const t=$ne(n);return{args:t.map(r=>n[r]),keys:t}}}return{args:e,keys:null}}const{isArray:Gne}=Array;function MN(e){return pe(n=>function Wne(e,n){return Gne(n)?e(...n):e(n)}(e,n))}function zU(e,n){return e.reduce((t,r,i)=>(t[r]=n[i],t),{})}function AN(...e){const n=oS(e),t=rk(e),{args:r,keys:i}=BU(e);if(0===r.length)return Ha([],n);const l=new Di(function qne(e,n,t=dl){return r=>{UU(n,()=>{const{length:i}=e,l=new Array(i);let u=i,g=i;for(let x=0;x<i;x++)UU(n,()=>{const E=Ha(e[x],n);let D=!1;E.subscribe(te(r,R=>{l[x]=R,D||(D=!0,g--),g||r.next(t(l.slice()))},()=>{--u||r.complete()}))},r)},r)}}(r,n,i?u=>zU(i,u):dl));return t?l.pipe(MN(t)):l}function UU(e,n,t){e?Rg(t,e,n):n()}const ck=Gi(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function n2(e=1/0){return Ml(dl,e)}function uS(...e){return function Zne(){return n2(1)}()(Ha(e,oS(e)))}function VU(e){return new Di(n=>{Dl(e()).subscribe(n)})}function uk(e,n){const t=xr(e)?e:()=>e,r=i=>i.error(t());return new Di(n?i=>n.schedule(r,0,i):r)}const cd=new Di(e=>e.complete());function IN(){return Ie((e,n)=>{let t=null;e._refCount++;const r=te(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const i=e._connection,l=t;t=null,i&&(!l||i===l)&&i.unsubscribe(),n.unsubscribe()});e.subscribe(r),r.closed||(t=e.connect())})}class jU extends Di{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Kf(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new os;const t=this.getSubject();n.add(this.source.subscribe(te(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=os.EMPTY)}return n}refCount(){return IN()(this)}}function xc(e){return e<=0?()=>cd:Ie((n,t)=>{let r=0;n.subscribe(te(t,i=>{++r<=e&&(t.next(i),e<=r&&t.complete())}))})}function kN(...e){const n=oS(e);return Ie((t,r)=>{(n?uS(e,t,n):uS(e,t)).subscribe(r)})}function dk(e){return Ie((n,t)=>{let r=!1;n.subscribe(te(t,i=>{r=!0,t.next(i)},()=>{r||t.next(e),t.complete()}))})}function $U(e=Yne){return Ie((n,t)=>{let r=!1;n.subscribe(te(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(e())))})}function Yne(){return new ck}function Cv(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Ga((i,l)=>e(i,l,r)):dl,xc(1),t?dk(n):$U(()=>new ck))}function Il(e,n,t){const r=xr(e)||n||t?{next:e,error:n,complete:t}:e;return r?Ie((i,l)=>{var u;null===(u=r.subscribe)||void 0===u||u.call(r);let g=!0;i.subscribe(te(l,x=>{var E;null===(E=r.next)||void 0===E||E.call(r,x),l.next(x)},()=>{var x;g=!1,null===(x=r.complete)||void 0===x||x.call(r),l.complete()},x=>{var E;g=!1,null===(E=r.error)||void 0===E||E.call(r,x),l.error(x)},()=>{var x,E;g&&(null===(x=r.unsubscribe)||void 0===x||x.call(r)),null===(E=r.finalize)||void 0===E||E.call(r)}))}):dl}function r2(e){return Ie((n,t)=>{let l,r=null,i=!1;r=n.subscribe(te(t,void 0,void 0,u=>{l=Dl(e(u,r2(e)(n))),r?(r.unsubscribe(),r=null,l.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,l.subscribe(t))})}function ON(e){return e<=0?()=>cd:Ie((n,t)=>{let r=[];n.subscribe(te(t,i=>{r.push(i),e<r.length&&r.shift()},()=>{for(const i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function Fo(e){return Ie((n,t)=>{Dl(e).subscribe(te(t,()=>t.complete(),Uo)),!t.closed&&n.subscribe(t)})}const Ai="primary",dS=Symbol("RouteTitle");class ere{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function i2(e){return new ere(e)}function tre(e,n,t){const r=t.path.split("/");if(r.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||r.length<e.length))return null;const i={};for(let l=0;l<r.length;l++){const u=r[l],g=e[l];if(":"===u[0])i[u.substring(1)]=g;else if(u!==g.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function Yp(e,n){const t=e?PN(e):void 0,r=n?PN(n):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let l=0;l<t.length;l++)if(i=t[l],!GU(e[i],n[i]))return!1;return!0}function PN(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function GU(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),r=[...n].sort();return t.every((i,l)=>r[l]===i)}return e===n}function WU(e){return e.length>0?e[e.length-1]:null}function $0(e){return function zne(e){return!!e&&(e instanceof Di||xr(e.lift)&&xr(e.subscribe))}(e)?e:XC(e)?Ha(Promise.resolve(e)):jr(e)}const rre={exact:function XU(e,n,t){if(!Dv(e.segments,n.segments)||!hk(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!XU(e.children[r],n.children[r],t))return!1;return!0},subset:YU},qU={exact:function ire(e,n){return Yp(e,n)},subset:function sre(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>GU(e[t],n[t]))},ignored:()=>!0};function ZU(e,n,t){return rre[t.paths](e.root,n.root,t.matrixParams)&&qU[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function YU(e,n,t){return KU(e,n,n.segments,t)}function KU(e,n,t,r){if(e.segments.length>t.length){const i=e.segments.slice(0,t.length);return!(!Dv(i,t)||n.hasChildren()||!hk(i,t,r))}if(e.segments.length===t.length){if(!Dv(e.segments,t)||!hk(e.segments,t,r))return!1;for(const i in n.children)if(!e.children[i]||!YU(e.children[i],n.children[i],r))return!1;return!0}{const i=t.slice(0,e.segments.length),l=t.slice(e.segments.length);return!!(Dv(e.segments,i)&&hk(e.segments,i,r)&&e.children[Ai])&&KU(e.children[Ai],n,l,r)}}function hk(e,n,t){return n.every((r,i)=>qU[t](e[i].parameters,r.parameters))}class Sv{constructor(n=new $s([],{}),t={},r=null){this.root=n,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=i2(this.queryParams),this._queryParamMap}toString(){return lre.serialize(this)}}class $s{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return pk(this)}}class hS{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap??=i2(this.parameters),this._parameterMap}toString(){return eV(this)}}function Dv(e,n){return e.length===n.length&&e.every((t,r)=>t.path===n[r].path)}let s2=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:()=>new fk,providedIn:"root"})}return e})();class fk{parse(n){const t=new vre(n);return new Sv(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${fS(n.root,!0)}`,r=function dre(e){const n=Object.entries(e).map(([t,r])=>Array.isArray(r)?r.map(i=>`${mk(t)}=${mk(i)}`).join("&"):`${mk(t)}=${mk(r)}`).filter(t=>t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${r}${"string"==typeof n.fragment?`#${function cre(e){return encodeURI(e)}(n.fragment)}`:""}`}}const lre=new fk;function pk(e){return e.segments.map(n=>eV(n)).join("/")}function fS(e,n){if(!e.hasChildren())return pk(e);if(n){const t=e.children[Ai]?fS(e.children[Ai],!1):"",r=[];return Object.entries(e.children).forEach(([i,l])=>{i!==Ai&&r.push(`${i}:${fS(l,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function are(e,n){let t=[];return Object.entries(e.children).forEach(([r,i])=>{r===Ai&&(t=t.concat(n(i,r)))}),Object.entries(e.children).forEach(([r,i])=>{r!==Ai&&(t=t.concat(n(i,r)))}),t}(e,(r,i)=>i===Ai?[fS(e.children[Ai],!1)]:[`${i}:${fS(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Ai]?`${pk(e)}/${t[0]}`:`${pk(e)}/(${t.join("//")})`}}function JU(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function mk(e){return JU(e).replace(/%3B/gi,";")}function RN(e){return JU(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function gk(e){return decodeURIComponent(e)}function QU(e){return gk(e.replace(/\+/g,"%20"))}function eV(e){return`${RN(e.path)}${function ure(e){return Object.entries(e).map(([n,t])=>`;${RN(n)}=${RN(t)}`).join("")}(e.parameters)}`}const hre=/^[^\/()?;#]+/;function NN(e){const n=e.match(hre);return n?n[0]:""}const fre=/^[^\/()?;=#]+/,mre=/^[^=?&#]+/,_re=/^[^&#]+/;class vre{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new $s([],{}):new $s([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(r[Ai]=new $s(n,t)),r}parseSegment(){const n=NN(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new ln(4009,!1);return this.capture(n),new hS(gk(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function pre(e){const n=e.match(fre);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const i=NN(this.remaining);i&&(r=i,this.capture(r))}n[gk(t)]=gk(r)}parseQueryParam(n){const t=function gre(e){const n=e.match(mre);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const u=function yre(e){const n=e.match(_re);return n?n[0]:""}(this.remaining);u&&(r=u,this.capture(r))}const i=QU(t),l=QU(r);if(n.hasOwnProperty(i)){let u=n[i];Array.isArray(u)||(u=[u],n[i]=u),u.push(l)}else n[i]=l}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=NN(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new ln(4010,!1);let l;r.indexOf(":")>-1?(l=r.slice(0,r.indexOf(":")),this.capture(l),this.capture(":")):n&&(l=Ai);const u=this.parseChildren();t[l]=1===Object.keys(u).length?u[Ai]:new $s([],u),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new ln(4011,!1)}}function tV(e){return e.segments.length>0?new $s([],{[Ai]:e}):e}function nV(e){const n={};for(const[r,i]of Object.entries(e.children)){const l=nV(i);if(r===Ai&&0===l.segments.length&&l.hasChildren())for(const[u,g]of Object.entries(l.children))n[u]=g;else(l.segments.length>0||l.hasChildren())&&(n[r]=l)}return function xre(e){if(1===e.numberOfChildren&&e.children[Ai]){const n=e.children[Ai];return new $s(e.segments.concat(n.segments),n.children)}return e}(new $s(e.segments,n))}function Mv(e){return e instanceof Sv}function rV(e){let n;const i=tV(function t(l){const u={};for(const x of l.children){const E=t(x);u[x.outlet]=E}const g=new $s(l.url,u);return l===e&&(n=g),g}(e.root));return n??i}function iV(e,n,t,r){let i=e;for(;i.parent;)i=i.parent;if(0===n.length)return FN(i,i,i,t,r);const l=function wre(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new oV(!0,0,e);let n=0,t=!1;const r=e.reduce((i,l,u)=>{if("object"==typeof l&&null!=l){if(l.outlets){const g={};return Object.entries(l.outlets).forEach(([x,E])=>{g[x]="string"==typeof E?E.split("/"):E}),[...i,{outlets:g}]}if(l.segmentPath)return[...i,l.segmentPath]}return"string"!=typeof l?[...i,l]:0===u?(l.split("/").forEach((g,x)=>{0==x&&"."===g||(0==x&&""===g?t=!0:".."===g?n++:""!=g&&i.push(g))}),i):[...i,l]},[]);return new oV(t,n,r)}(n);if(l.toRoot())return FN(i,i,new $s([],{}),t,r);const u=function Tre(e,n,t){if(e.isAbsolute)return new yk(n,!0,0);if(!t)return new yk(n,!1,NaN);if(null===t.parent)return new yk(t,!0,0);const r=_k(e.commands[0])?0:1;return function Ere(e,n,t){let r=e,i=n,l=t;for(;l>i;){if(l-=i,r=r.parent,!r)throw new ln(4005,!1);i=r.segments.length}return new yk(r,!1,i-l)}(t,t.segments.length-1+r,e.numberOfDoubleDots)}(l,i,e),g=u.processChildren?mS(u.segmentGroup,u.index,l.commands):aV(u.segmentGroup,u.index,l.commands);return FN(i,u.segmentGroup,g,t,r)}function _k(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function pS(e){return"object"==typeof e&&null!=e&&e.outlets}function FN(e,n,t,r,i){let u,l={};r&&Object.entries(r).forEach(([x,E])=>{l[x]=Array.isArray(E)?E.map(D=>`${D}`):`${E}`}),u=e===n?t:sV(e,n,t);const g=tV(nV(u));return new Sv(g,l,i)}function sV(e,n,t){const r={};return Object.entries(e.children).forEach(([i,l])=>{r[i]=l===n?t:sV(l,n,t)}),new $s(e.segments,r)}class oV{constructor(n,t,r){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=r,n&&r.length>0&&_k(r[0]))throw new ln(4003,!1);const i=r.find(pS);if(i&&i!==WU(r))throw new ln(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class yk{constructor(n,t,r){this.segmentGroup=n,this.processChildren=t,this.index=r}}function aV(e,n,t){if(e??=new $s([],{}),0===e.segments.length&&e.hasChildren())return mS(e,n,t);const r=function Sre(e,n,t){let r=0,i=n;const l={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=t.length)return l;const u=e.segments[i],g=t[r];if(pS(g))break;const x=`${g}`,E=r<t.length-1?t[r+1]:null;if(i>0&&void 0===x)break;if(x&&E&&"object"==typeof E&&void 0===E.outlets){if(!cV(x,E,u))return l;r+=2}else{if(!cV(x,{},u))return l;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,n,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const l=new $s(e.segments.slice(0,r.pathIndex),{});return l.children[Ai]=new $s(e.segments.slice(r.pathIndex),e.children),mS(l,0,i)}return r.match&&0===i.length?new $s(e.segments,{}):r.match&&!e.hasChildren()?LN(e,n,t):r.match?mS(e,0,i):LN(e,n,t)}function mS(e,n,t){if(0===t.length)return new $s(e.segments,{});{const r=function Cre(e){return pS(e[0])?e[0].outlets:{[Ai]:e}}(t),i={};if(Object.keys(r).some(l=>l!==Ai)&&e.children[Ai]&&1===e.numberOfChildren&&0===e.children[Ai].segments.length){const l=mS(e.children[Ai],n,t);return new $s(e.segments,l.children)}return Object.entries(r).forEach(([l,u])=>{"string"==typeof u&&(u=[u]),null!==u&&(i[l]=aV(e.children[l],n,u))}),Object.entries(e.children).forEach(([l,u])=>{void 0===r[l]&&(i[l]=u)}),new $s(e.segments,i)}}function LN(e,n,t){const r=e.segments.slice(0,n);let i=0;for(;i<t.length;){const l=t[i];if(pS(l)){const x=Dre(l.outlets);return new $s(r,x)}if(0===i&&_k(t[0])){r.push(new hS(e.segments[n].path,lV(t[0]))),i++;continue}const u=pS(l)?l.outlets[Ai]:`${l}`,g=i<t.length-1?t[i+1]:null;u&&g&&_k(g)?(r.push(new hS(u,lV(g))),i+=2):(r.push(new hS(u,{})),i++)}return new $s(r,{})}function Dre(e){const n={};return Object.entries(e).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[t]=LN(new $s([],{}),0,r))}),n}function lV(e){const n={};return Object.entries(e).forEach(([t,r])=>n[t]=`${r}`),n}function cV(e,n,t){return e==t.path&&Yp(n,t.parameters)}const gS="imperative";var Ji=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(Ji||{});class Kp{constructor(n,t){this.id=n,this.url=t}}class vk extends Kp{constructor(n,t,r="imperative",i=null){super(n,t),this.type=Ji.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ng extends Kp{constructor(n,t,r){super(n,t),this.urlAfterRedirects=r,this.type=Ji.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var ud=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(ud||{}),xk=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(xk||{});class Av extends Kp{constructor(n,t,r,i){super(n,t),this.reason=r,this.code=i,this.type=Ji.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class o2 extends Kp{constructor(n,t,r,i){super(n,t),this.reason=r,this.code=i,this.type=Ji.NavigationSkipped}}class BN extends Kp{constructor(n,t,r,i){super(n,t),this.error=r,this.target=i,this.type=Ji.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class uV extends Kp{constructor(n,t,r,i){super(n,t),this.urlAfterRedirects=r,this.state=i,this.type=Ji.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Mre extends Kp{constructor(n,t,r,i){super(n,t),this.urlAfterRedirects=r,this.state=i,this.type=Ji.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Are extends Kp{constructor(n,t,r,i,l){super(n,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=l,this.type=Ji.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Ire extends Kp{constructor(n,t,r,i){super(n,t),this.urlAfterRedirects=r,this.state=i,this.type=Ji.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class kre extends Kp{constructor(n,t,r,i){super(n,t),this.urlAfterRedirects=r,this.state=i,this.type=Ji.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ore{constructor(n){this.route=n,this.type=Ji.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Pre{constructor(n){this.route=n,this.type=Ji.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Rre{constructor(n){this.snapshot=n,this.type=Ji.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Nre{constructor(n){this.snapshot=n,this.type=Ji.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Fre{constructor(n){this.snapshot=n,this.type=Ji.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Lre{constructor(n){this.snapshot=n,this.type=Ji.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class dV{constructor(n,t,r){this.routerEvent=n,this.position=t,this.anchor=r,this.type=Ji.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class zN{}class bk{constructor(n,t){this.url=n,this.navigationBehaviorOptions=t}}function Vf(e){return e.outlet||Ai}function _S(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class $re{get injector(){return _S(this.route?.snapshot)??this.rootInjector}set injector(n){}constructor(n){this.rootInjector=n,this.outlet=null,this.route=null,this.children=new yS(this.rootInjector),this.attachRef=null}}let yS=(()=>{class e{constructor(t){this.rootInjector=t,this.contexts=new Map}onChildOutletCreated(t,r){const i=this.getOrCreateContext(t);i.outlet=r,this.contexts.set(t,i)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new $re(this.rootInjector),this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(r){return new(r||e)($n(Go))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class hV{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=UN(n,this._root);return t?t.children.map(r=>r.value):[]}firstChild(n){const t=UN(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=VN(n,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==n)}pathFromRoot(n){return VN(n,this._root).map(t=>t.value)}}function UN(e,n){if(e===n.value)return n;for(const t of n.children){const r=UN(e,t);if(r)return r}return null}function VN(e,n){if(e===n.value)return[n];for(const t of n.children){const r=VN(e,t);if(r.length)return r.unshift(n),r}return[]}class jf{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function a2(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class fV extends hV{constructor(n,t){super(n),this.snapshot=t,jN(this,n)}toString(){return this.snapshot.toString()}}function pV(e){const n=function Hre(e){const l=new Tk([],{},{},"",{},Ai,e,null,{});return new mV("",new jf(l,[]))}(e),t=new Hi([new hS("",{})]),r=new Hi({}),i=new Hi({}),l=new Hi({}),u=new Hi(""),g=new Su(t,r,l,u,i,Ai,e,n.root);return g.snapshot=n.root,new fV(new jf(g,[]),n)}class Su{constructor(n,t,r,i,l,u,g,x){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=l,this.outlet=u,this.component=g,this._futureSnapshot=x,this.title=this.dataSubject?.pipe(pe(E=>E[dS]))??jr(void 0),this.url=n,this.params=t,this.queryParams=r,this.fragment=i,this.data=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(pe(n=>i2(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(pe(n=>i2(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function wk(e,n,t="emptyOnly"){let r;const{routeConfig:i}=e;return r=null===n||"always"!==t&&""!==i?.path&&(n.component||n.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.data,...i?.data,...e._resolvedData}},i&&_V(i)&&(r.resolve[dS]=i.title),r}class Tk{get title(){return this.data?.[dS]}constructor(n,t,r,i,l,u,g,x,E){this.url=n,this.params=t,this.queryParams=r,this.fragment=i,this.data=l,this.outlet=u,this.component=g,this.routeConfig=x,this._resolve=E}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=i2(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=i2(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class mV extends hV{constructor(n,t){super(t),this.url=n,jN(this,t)}toString(){return gV(this._root)}}function jN(e,n){n.value._routerState=e,n.children.forEach(t=>jN(e,t))}function gV(e){const n=e.children.length>0?` { ${e.children.map(gV).join(", ")} } `:"";return`${e.value}${n}`}function $N(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Yp(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Yp(n.params,t.params)||e.paramsSubject.next(t.params),function nre(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!Yp(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),Yp(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function HN(e,n){const t=Yp(e.params,n.params)&&function ore(e,n){return Dv(e,n)&&e.every((t,r)=>Yp(t.parameters,n[r].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||HN(e.parent,n.parent))}function _V(e){return"string"==typeof e.title||null===e.title}let GN=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ai,this.activateEvents=new rr,this.deactivateEvents=new rr,this.attachEvents=new rr,this.detachEvents=new rr,this.parentContexts=Qe(yS),this.location=Qe(Zt),this.changeDetector=Qe(Th),this.inputBinder=Qe(Ek,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:i}=t.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ln(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ln(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ln(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new ln(4013,!1);this._activatedRoute=t;const i=this.location,u=t.snapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,x=new WN(t,g,i.injector);this.activated=i.createComponent(u,{index:i.length,injector:x,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Sn({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Co]})}return e})();class WN{__ngOutletInjector(n){return new WN(this.route,this.childContexts,n)}constructor(n,t,r){this.route=n,this.childContexts=t,this.parent=r}get(n,t){return n===Su?this.route:n===yS?this.childContexts:this.parent.get(n,t)}}const Ek=new vn("");let yV=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:r}=t,i=AN([r.queryParams,r.params,r.data]).pipe(Sh(([l,u,g],x)=>(g={...l,...u,...g},0===x?jr(g):Promise.resolve(g)))).subscribe(l=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(t);const u=function KJ(e){const n=di(e);if(!n)return null;const t=new Ke(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(u)for(const{templateName:g}of u.inputs)t.activatedComponentRef.setInput(g,l[g]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,i)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();function vS(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=n.value;const i=function Wre(e,n,t){return n.children.map(r=>{for(const i of t.children)if(e.shouldReuseRoute(r.value,i.value.snapshot))return vS(e,r,i);return vS(e,r)})}(e,n,t);return new jf(r,i)}{if(e.shouldAttach(n.value)){const l=e.retrieve(n.value);if(null!==l){const u=l.route;return u.value._futureSnapshot=n.value,u.children=n.children.map(g=>vS(e,g)),u}}const r=function qre(e){return new Su(new Hi(e.url),new Hi(e.params),new Hi(e.queryParams),new Hi(e.fragment),new Hi(e.data),e.outlet,e.component,e)}(n.value),i=n.children.map(l=>vS(e,l));return new jf(r,i)}}class qN{constructor(n,t){this.redirectTo=n,this.navigationBehaviorOptions=t}}const vV="ngNavigationCancelingError";function Ck(e,n){const{redirectTo:t,navigationBehaviorOptions:r}=Mv(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,i=xV(!1,ud.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function xV(e,n){const t=new Error(`NavigationCancelingError: ${e||""}`);return t[vV]=!0,t.cancellationCode=n,t}function bV(e){return!!e&&e[vV]}class Yre{constructor(n,t,r,i,l){this.routeReuseStrategy=n,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=l}activate(n){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,n),$N(this.futureState.root),this.activateChildRoutes(t,r,n)}deactivateChildRoutes(n,t,r){const i=a2(t);n.children.forEach(l=>{const u=l.value.outlet;this.deactivateRoutes(l,i[u],r),delete i[u]}),Object.values(i).forEach(l=>{this.deactivateRouteAndItsChildren(l,r)})}deactivateRoutes(n,t,r){const i=n.value,l=t?t.value:null;if(i===l)if(i.component){const u=r.getContext(i.outlet);u&&this.deactivateChildRoutes(n,t,u.children)}else this.deactivateChildRoutes(n,t,r);else l&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const r=t.getContext(n.value.outlet),i=r&&n.value.component?r.children:t,l=a2(n);for(const u of Object.values(l))this.deactivateRouteAndItsChildren(u,i);if(r&&r.outlet){const u=r.outlet.detach(),g=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:u,route:n,contexts:g})}}deactivateRouteAndOutlet(n,t){const r=t.getContext(n.value.outlet),i=r&&n.value.component?r.children:t,l=a2(n);for(const u of Object.values(l))this.deactivateRouteAndItsChildren(u,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,t,r){const i=a2(t);n.children.forEach(l=>{this.activateRoutes(l,i[l.value.outlet],r),this.forwardEvent(new Lre(l.value.snapshot))}),n.children.length&&this.forwardEvent(new Nre(n.value.snapshot))}activateRoutes(n,t,r){const i=n.value,l=t?t.value:null;if($N(i),i===l)if(i.component){const u=r.getOrCreateContext(i.outlet);this.activateChildRoutes(n,t,u.children)}else this.activateChildRoutes(n,t,r);else if(i.component){const u=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const g=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),u.children.onOutletReAttached(g.contexts),u.attachRef=g.componentRef,u.route=g.route.value,u.outlet&&u.outlet.attach(g.componentRef,g.route.value),$N(g.route.value),this.activateChildRoutes(n,null,u.children)}else u.attachRef=null,u.route=i,u.outlet&&u.outlet.activateWith(i,u.injector),this.activateChildRoutes(n,null,u.children)}else this.activateChildRoutes(n,null,r)}}class wV{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class Sk{constructor(n,t){this.component=n,this.route=t}}function Kre(e,n,t){const r=e._root;return xS(r,n?n._root:null,t,[r.value])}function l2(e,n){const t=Symbol(),r=n.get(e,t);return r===t?"function"!=typeof e||function Bm(e){return null!==op(e)}(e)?n.get(e):e:r}function xS(e,n,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const l=a2(n);return e.children.forEach(u=>{(function Qre(e,n,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const l=e.value,u=n?n.value:null,g=t?t.getContext(e.value.outlet):null;if(u&&l.routeConfig===u.routeConfig){const x=function eie(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!Dv(e.url,n.url);case"pathParamsOrQueryParamsChange":return!Dv(e.url,n.url)||!Yp(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!HN(e,n)||!Yp(e.queryParams,n.queryParams);default:return!HN(e,n)}}(u,l,l.routeConfig.runGuardsAndResolvers);x?i.canActivateChecks.push(new wV(r)):(l.data=u.data,l._resolvedData=u._resolvedData),xS(e,n,l.component?g?g.children:null:t,r,i),x&&g&&g.outlet&&g.outlet.isActivated&&i.canDeactivateChecks.push(new Sk(g.outlet.component,u))}else u&&bS(n,g,i),i.canActivateChecks.push(new wV(r)),xS(e,null,l.component?g?g.children:null:t,r,i)})(u,l[u.value.outlet],t,r.concat([u.value]),i),delete l[u.value.outlet]}),Object.entries(l).forEach(([u,g])=>bS(g,t.getContext(u),i)),i}function bS(e,n,t){const r=a2(e),i=e.value;Object.entries(r).forEach(([l,u])=>{bS(u,i.component?n?n.children.getContext(l):null:n,t)}),t.canDeactivateChecks.push(new Sk(i.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,i))}function wS(e){return"function"==typeof e}function TV(e){return e instanceof ck||"EmptyError"===e?.name}const Dk=Symbol("INITIAL_VALUE");function c2(){return Sh(e=>AN(e.map(n=>n.pipe(xc(1),kN(Dk)))).pipe(pe(n=>{for(const t of n)if(!0!==t){if(t===Dk)return Dk;if(!1===t||aie(t))return t}return!0}),Ga(n=>n!==Dk),xc(1)))}function aie(e){return Mv(e)||e instanceof qN}function EV(e){return function Od(...e){return Yh(e)}(Il(n=>{if("boolean"!=typeof n)throw Ck(0,n)}),pe(n=>!0===n))}class ZN{constructor(n){this.segmentGroup=n||null}}class Mk extends Error{constructor(n){super(),this.urlTree=n}}function u2(e){return uk(new ZN(e))}class xie{constructor(n,t){this.urlSerializer=n,this.urlTree=t}lineralizeSegments(n,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return jr(r);if(i.numberOfChildren>1||!i.children[Ai])return uk(new ln(4e3,!1));i=i.children[Ai]}}applyRedirectCommands(n,t,r,i,l){if("string"!=typeof t){const g=t,{queryParams:x,fragment:E,routeConfig:D,url:R,outlet:L,params:V,data:Y,title:G}=i,Q=y(l,()=>g({params:V,data:Y,queryParams:x,fragment:E,routeConfig:D,url:R,outlet:L,title:G}));if(Q instanceof Sv)throw new Mk(Q);t=Q}const u=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,r);if("/"===t[0])throw new Mk(u);return u}applyRedirectCreateUrlTree(n,t,r,i){const l=this.createSegmentGroup(n,t.root,r,i);return new Sv(l,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const r={};return Object.entries(n).forEach(([i,l])=>{if("string"==typeof l&&":"===l[0]){const g=l.substring(1);r[i]=t[g]}else r[i]=l}),r}createSegmentGroup(n,t,r,i){const l=this.createSegments(n,t.segments,r,i);let u={};return Object.entries(t.children).forEach(([g,x])=>{u[g]=this.createSegmentGroup(n,x,r,i)}),new $s(l,u)}createSegments(n,t,r,i){return t.map(l=>":"===l.path[0]?this.findPosParam(n,l,i):this.findOrReturn(l,r))}findPosParam(n,t,r){const i=r[t.path.substring(1)];if(!i)throw new ln(4001,!1);return i}findOrReturn(n,t){let r=0;for(const i of t){if(i.path===n.path)return t.splice(r),i;r++}return n}}const XN={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function bie(e,n,t,r,i){const l=YN(e,n,t);return l.matched?(r=function Bre(e,n){return e.providers&&!e._injector&&(e._injector=rI(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,r),function _ie(e,n,t,r){const i=n.canMatch;return i&&0!==i.length?jr(i.map(u=>{const g=l2(u,e);return $0(function oie(e){return e&&wS(e.canMatch)}(g)?g.canMatch(n,t):y(e,()=>g(n,t)))})).pipe(c2(),EV()):jr(!0)}(r,n,t).pipe(pe(u=>!0===u?l:{...XN}))):jr(l)}function YN(e,n,t){if("**"===n.path)return function wie(e){return{matched:!0,parameters:e.length>0?WU(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...XN}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const i=(n.matcher||tre)(t,e,n);if(!i)return{...XN};const l={};Object.entries(i.posParams??{}).forEach(([g,x])=>{l[g]=x.path});const u=i.consumed.length>0?{...l,...i.consumed[i.consumed.length-1].parameters}:l;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:u,positionalParamSegments:i.posParams??{}}}function CV(e,n,t,r){return t.length>0&&function Cie(e,n,t){return t.some(r=>Ak(e,n,r)&&Vf(r)!==Ai)}(e,t,r)?{segmentGroup:new $s(n,Eie(r,new $s(t,e.children))),slicedSegments:[]}:0===t.length&&function Sie(e,n,t){return t.some(r=>Ak(e,n,r))}(e,t,r)?{segmentGroup:new $s(e.segments,Tie(e,t,r,e.children)),slicedSegments:t}:{segmentGroup:new $s(e.segments,e.children),slicedSegments:t}}function Tie(e,n,t,r){const i={};for(const l of t)if(Ak(e,n,l)&&!r[Vf(l)]){const u=new $s([],{});i[Vf(l)]=u}return{...r,...i}}function Eie(e,n){const t={};t[Ai]=n;for(const r of e)if(""===r.path&&Vf(r)!==Ai){const i=new $s([],{});t[Vf(r)]=i}return t}function Ak(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class Aie{}class Oie{constructor(n,t,r,i,l,u,g){this.injector=n,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=l,this.paramsInheritanceStrategy=u,this.urlSerializer=g,this.applyRedirects=new xie(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new ln(4002,`'${n.segmentGroup}'`)}recognize(){const n=CV(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(pe(({children:t,rootSnapshot:r})=>{const i=new jf(r,t),l=new mV("",i),u=function bre(e,n,t=null,r=null){return iV(rV(e),n,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return u.queryParams=this.urlTree.queryParams,l.url=this.urlSerializer.serialize(u),{state:l,tree:u}}))}match(n){const t=new Tk([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),Ai,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,Ai,t).pipe(pe(r=>({children:r,rootSnapshot:t})),r2(r=>{if(r instanceof Mk)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof ZN?this.noMatchError(r):r}))}processSegmentGroup(n,t,r,i,l){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,t,r,l):this.processSegment(n,t,r,r.segments,i,!0,l).pipe(pe(u=>u instanceof jf?[u]:[]))}processChildren(n,t,r,i){const l=[];for(const u of Object.keys(r.children))"primary"===u?l.unshift(u):l.push(u);return Ha(l).pipe(e2(u=>{const g=r.children[u],x=function jre(e,n){const t=e.filter(r=>Vf(r)===n);return t.push(...e.filter(r=>Vf(r)!==n)),t}(t,u);return this.processSegmentGroup(n,x,g,u,i)}),function Jne(e,n){return Ie(function Kne(e,n,t,r,i){return(l,u)=>{let g=t,x=n,E=0;l.subscribe(te(u,D=>{const R=E++;x=g?e(x,D,R):(g=!0,D),r&&u.next(x)},i&&(()=>{g&&u.next(x),u.complete()})))}}(e,n,arguments.length>=2,!0))}((u,g)=>(u.push(...g),u)),dk(null),function Qne(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Ga((i,l)=>e(i,l,r)):dl,ON(1),t?dk(n):$U(()=>new ck))}(),Ml(u=>{if(null===u)return u2(r);const g=SV(u);return function Pie(e){e.sort((n,t)=>n.value.outlet===Ai?-1:t.value.outlet===Ai?1:n.value.outlet.localeCompare(t.value.outlet))}(g),jr(g)}))}processSegment(n,t,r,i,l,u,g){return Ha(t).pipe(e2(x=>this.processSegmentAgainstRoute(x._injector??n,t,x,r,i,l,u,g).pipe(r2(E=>{if(E instanceof ZN)return jr(null);throw E}))),Cv(x=>!!x),r2(x=>{if(TV(x))return function Mie(e,n,t){return 0===n.length&&!e.children[t]}(r,i,l)?jr(new Aie):u2(r);throw x}))}processSegmentAgainstRoute(n,t,r,i,l,u,g,x){return function Die(e,n,t,r){return!!(Vf(e)===r||r!==Ai&&Ak(n,t,e))&&YN(n,e,t).matched}(r,i,l,u)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,i,r,l,u,x):this.allowRedirects&&g?this.expandSegmentAgainstRouteUsingRedirect(n,i,t,r,l,u,x):u2(i):u2(i)}expandSegmentAgainstRouteUsingRedirect(n,t,r,i,l,u,g){const{matched:x,parameters:E,consumedSegments:D,positionalParamSegments:R,remainingSegments:L}=YN(t,i,l);if(!x)return u2(t);"string"==typeof i.redirectTo&&"/"===i.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const V=new Tk(l,E,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,DV(i),Vf(i),i.component??i._loadedComponent??null,i,MV(i)),Y=wk(V,g,this.paramsInheritanceStrategy);V.params=Object.freeze(Y.params),V.data=Object.freeze(Y.data);const G=this.applyRedirects.applyRedirectCommands(D,i.redirectTo,R,V,n);return this.applyRedirects.lineralizeSegments(i,G).pipe(Ml(Q=>this.processSegment(n,r,t,Q.concat(L),u,!1,g)))}matchSegmentAgainstRoute(n,t,r,i,l,u){const g=bie(t,r,i,n);return"**"===r.path&&(t.children={}),g.pipe(Sh(x=>x.matched?this.getChildConfig(n=r._injector??n,r,i).pipe(Sh(({routes:E})=>{const D=r._loadedInjector??n,{parameters:R,consumedSegments:L,remainingSegments:V}=x,Y=new Tk(L,R,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,DV(r),Vf(r),r.component??r._loadedComponent??null,r,MV(r)),G=wk(Y,u,this.paramsInheritanceStrategy);Y.params=Object.freeze(G.params),Y.data=Object.freeze(G.data);const{segmentGroup:Q,slicedSegments:he}=CV(t,L,V,E);if(0===he.length&&Q.hasChildren())return this.processChildren(D,E,Q,Y).pipe(pe(me=>new jf(Y,me)));if(0===E.length&&0===he.length)return jr(new jf(Y,[]));const le=Vf(r)===l;return this.processSegment(D,E,Q,he,le?Ai:l,!0,Y).pipe(pe(me=>new jf(Y,me instanceof jf?[me]:[])))})):u2(t)))}getChildConfig(n,t,r){return t.children?jr({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?jr({routes:t._loadedRoutes,injector:t._loadedInjector}):function gie(e,n,t,r){const i=n.canLoad;return void 0===i||0===i.length?jr(!0):jr(i.map(u=>{const g=l2(u,e);return $0(function nie(e){return e&&wS(e.canLoad)}(g)?g.canLoad(n,t):y(e,()=>g(n,t)))})).pipe(c2(),EV())}(n,t,r).pipe(Ml(i=>i?this.configLoader.loadChildren(n,t).pipe(Il(l=>{t._loadedRoutes=l.routes,t._loadedInjector=l.injector})):function vie(e){return uk(xV(!1,ud.GuardRejected))}())):jr({routes:[],injector:n})}}function Rie(e){const n=e.value.routeConfig;return n&&""===n.path}function SV(e){const n=[],t=new Set;for(const r of e){if(!Rie(r)){n.push(r);continue}const i=n.find(l=>r.value.routeConfig===l.value.routeConfig);void 0!==i?(i.children.push(...r.children),t.add(i)):n.push(r)}for(const r of t){const i=SV(r.children);n.push(new jf(r.value,i))}return n.filter(r=>!t.has(r))}function DV(e){return e.data||{}}function MV(e){return e.resolve||{}}function Fie(e,n){return Ml(t=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return jr(t);const l=new Set(i.map(x=>x.route)),u=new Set;for(const x of l)if(!u.has(x))for(const E of AV(x))u.add(E);let g=0;return Ha(u).pipe(e2(x=>l.has(x)?function Lie(e,n,t,r){const i=e.routeConfig,l=e._resolve;return void 0!==i?.title&&!_V(i)&&(l[dS]=i.title),function Bie(e,n,t,r){const i=PN(e);if(0===i.length)return jr({});const l={};return Ha(i).pipe(Ml(u=>function zie(e,n,t,r){const i=_S(n)??r,l=l2(e,i);return $0(l.resolve?l.resolve(n,t):y(i,()=>l(n,t)))}(e[u],n,t,r).pipe(Cv(),Il(g=>{if(g instanceof qN)throw Ck(new fk,g);l[u]=g}))),ON(1),function HU(e){return pe(()=>e)}(l),r2(u=>TV(u)?cd:uk(u)))}(l,e,n,r).pipe(pe(u=>(e._resolvedData=u,e.data=wk(e,e.parent,t).resolve,null)))}(x,r,e,n):(x.data=wk(x,x.parent,e).resolve,jr(void 0))),Il(()=>g++),ON(1),Ml(x=>g===u.size?jr(t):cd))})}function AV(e){const n=e.children.map(t=>AV(t)).flat();return[e,...n]}function KN(e){return Sh(n=>{const t=e(n);return t?Ha(t).pipe(pe(()=>n)):jr(n)})}let IV=(()=>{class e{buildTitle(t){let r,i=t.root;for(;void 0!==i;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(l=>l.outlet===Ai);return r}getResolvedTitleForRoute(t){return t.data[dS]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:()=>Qe(Uie),providedIn:"root"})}return e})(),Uie=(()=>{class e extends IV{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||e)($n(pte))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const d2=new vn("",{providedIn:"root",factory:()=>({})});let kV=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Lr({type:e,selectors:[["ng-component"]],standalone:!0,features:[Bf],decls:1,vars:0,template:function(r,i){1&r&&Rt(0,"router-outlet")},dependencies:[GN],encapsulation:2})}return e})();function JN(e){const n=e.children&&e.children.map(JN),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==Ai&&(t.component=kV),t}const h2=new vn("");let QN=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Qe(l8)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return jr(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=$0(t.loadComponent()).pipe(pe(OV),Il(l=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=l}),aS(()=>{this.componentLoaders.delete(t)})),i=new jU(r,()=>new Mi).pipe(IN());return this.componentLoaders.set(t,i),i}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return jr({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const l=function Vie(e,n,t,r){return $0(e.loadChildren()).pipe(pe(OV),Ml(i=>i instanceof k5||Array.isArray(i)?jr(i):Ha(n.compileModuleAsync(i))),pe(i=>{r&&r(e);let l,u,g=!1;return Array.isArray(i)?(u=i,!0):(l=i.create(t).injector,u=l.get(h2,[],{optional:!0,self:!0}).flat()),{routes:u.map(JN),injector:l}}))}(r,this.compiler,t,this.onLoadEndListener).pipe(aS(()=>{this.childrenLoaders.delete(r)})),u=new jU(l,()=>new Mi).pipe(IN());return this.childrenLoaders.set(r,u),u}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function OV(e){return function jie(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let eF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:()=>Qe($ie),providedIn:"root"})}return e})(),$ie=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const PV=new vn(""),RV=new vn("");function Hie(e,n,t){const r=e.get(RV),i=e.get(Ro);return e.get(ni).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(E=>setTimeout(E));let l;const u=new Promise(E=>{l=E}),g=i.startViewTransition(()=>(l(),function Gie(e){return new Promise(n=>{m({read:()=>setTimeout(n)},{injector:e})})}(e))),{onViewTransitionCreated:x}=r;return x&&y(e,()=>x({transition:g,from:n,to:t})),u})}const NV=new vn("");let Ik=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Mi,this.transitionAbortSubject=new Mi,this.configLoader=Qe(QN),this.environmentInjector=Qe(Go),this.urlSerializer=Qe(s2),this.rootContexts=Qe(yS),this.location=Qe(tS),this.inputBindingEnabled=null!==Qe(Ek,{optional:!0}),this.titleStrategy=Qe(IV),this.options=Qe(d2,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Qe(eF),this.createViewTransition=Qe(PV,{optional:!0}),this.navigationErrorHandler=Qe(NV,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>jr(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=i=>this.events.next(new Pre(i)),this.configLoader.onLoadStartListener=i=>this.events.next(new Ore(i))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t,r,i){return this.transitions=new Hi({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:gS,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ga(l=>0!==l.id),pe(l=>({...l,extractedUrl:this.urlHandlingStrategy.extract(l.rawUrl)})),Sh(l=>{let u=!1,g=!1;return jr(l).pipe(Sh(x=>{if(this.navigationId>l.id)return this.cancelNavigationTransition(l,"",ud.SupersededByNewNavigation),cd;this.currentTransition=l,this.currentNavigation={id:x.id,initialUrl:x.rawUrl,extractedUrl:x.extractedUrl,targetBrowserUrl:"string"==typeof x.extras.browserUrl?this.urlSerializer.parse(x.extras.browserUrl):x.extras.browserUrl,trigger:x.source,extras:x.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const E=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!E&&"reload"!==(x.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const R="";return this.events.next(new o2(x.id,this.urlSerializer.serialize(x.rawUrl),R,xk.IgnoredSameUrlNavigation)),x.resolve(!1),cd}if(this.urlHandlingStrategy.shouldProcessUrl(x.rawUrl))return jr(x).pipe(Sh(R=>{const L=this.transitions?.getValue();return this.events.next(new vk(R.id,this.urlSerializer.serialize(R.extractedUrl),R.source,R.restoredState)),L!==this.transitions?.getValue()?cd:Promise.resolve(R)}),function Nie(e,n,t,r,i,l){return Ml(u=>function Iie(e,n,t,r,i,l,u="emptyOnly"){return new Oie(e,n,t,r,i,u,l).recognize()}(e,n,t,r,u.extractedUrl,i,l).pipe(pe(({state:g,tree:x})=>({...u,targetSnapshot:g,urlAfterRedirects:x}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),Il(R=>{l.targetSnapshot=R.targetSnapshot,l.urlAfterRedirects=R.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:R.urlAfterRedirects};const L=new uV(R.id,this.urlSerializer.serialize(R.extractedUrl),this.urlSerializer.serialize(R.urlAfterRedirects),R.targetSnapshot);this.events.next(L)}));if(E&&this.urlHandlingStrategy.shouldProcessUrl(x.currentRawUrl)){const{id:R,extractedUrl:L,source:V,restoredState:Y,extras:G}=x,Q=new vk(R,this.urlSerializer.serialize(L),V,Y);this.events.next(Q);const he=pV(this.rootComponentType).snapshot;return this.currentTransition=l={...x,targetSnapshot:he,urlAfterRedirects:L,extras:{...G,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=L,jr(l)}{const R="";return this.events.next(new o2(x.id,this.urlSerializer.serialize(x.extractedUrl),R,xk.IgnoredByUrlHandlingStrategy)),x.resolve(!1),cd}}),Il(x=>{const E=new Mre(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects),x.targetSnapshot);this.events.next(E)}),pe(x=>(this.currentTransition=l={...x,guards:Kre(x.targetSnapshot,x.currentSnapshot,this.rootContexts)},l)),function lie(e,n){return Ml(t=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:l,canDeactivateChecks:u}}=t;return 0===u.length&&0===l.length?jr({...t,guardsResult:!0}):function cie(e,n,t,r){return Ha(e).pipe(Ml(i=>function mie(e,n,t,r,i){const l=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return l&&0!==l.length?jr(l.map(g=>{const x=_S(n)??i,E=l2(g,x);return $0(function sie(e){return e&&wS(e.canDeactivate)}(E)?E.canDeactivate(e,n,t,r):y(x,()=>E(e,n,t,r))).pipe(Cv())})).pipe(c2()):jr(!0)}(i.component,i.route,t,n,r)),Cv(i=>!0!==i,!0))}(u,r,i,e).pipe(Ml(g=>g&&function tie(e){return"boolean"==typeof e}(g)?function uie(e,n,t,r){return Ha(n).pipe(e2(i=>uS(function hie(e,n){return null!==e&&n&&n(new Rre(e)),jr(!0)}(i.route.parent,r),function die(e,n){return null!==e&&n&&n(new Fre(e)),jr(!0)}(i.route,r),function pie(e,n,t){const r=n[n.length-1],l=n.slice(0,n.length-1).reverse().map(u=>function Jre(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(u)).filter(u=>null!==u).map(u=>VU(()=>jr(u.guards.map(x=>{const E=_S(u.node)??t,D=l2(x,E);return $0(function iie(e){return e&&wS(e.canActivateChild)}(D)?D.canActivateChild(r,e):y(E,()=>D(r,e))).pipe(Cv())})).pipe(c2())));return jr(l).pipe(c2())}(e,i.path,t),function fie(e,n,t){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return jr(!0);const i=r.map(l=>VU(()=>{const u=_S(n)??t,g=l2(l,u);return $0(function rie(e){return e&&wS(e.canActivate)}(g)?g.canActivate(n,e):y(u,()=>g(n,e))).pipe(Cv())}));return jr(i).pipe(c2())}(e,i.route,t))),Cv(i=>!0!==i,!0))}(r,l,e,n):jr(g)),pe(g=>({...t,guardsResult:g})))})}(this.environmentInjector,x=>this.events.next(x)),Il(x=>{if(l.guardsResult=x.guardsResult,x.guardsResult&&"boolean"!=typeof x.guardsResult)throw Ck(0,x.guardsResult);const E=new Are(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects),x.targetSnapshot,!!x.guardsResult);this.events.next(E)}),Ga(x=>!!x.guardsResult||(this.cancelNavigationTransition(x,"",ud.GuardRejected),!1)),KN(x=>{if(x.guards.canActivateChecks.length)return jr(x).pipe(Il(E=>{const D=new Ire(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(D)}),Sh(E=>{let D=!1;return jr(E).pipe(Fie(this.paramsInheritanceStrategy,this.environmentInjector),Il({next:()=>D=!0,complete:()=>{D||this.cancelNavigationTransition(E,"",ud.NoDataFromResolver)}}))}),Il(E=>{const D=new kre(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(D)}))}),KN(x=>{const E=D=>{const R=[];D.routeConfig?.loadComponent&&!D.routeConfig._loadedComponent&&R.push(this.configLoader.loadComponent(D.routeConfig).pipe(Il(L=>{D.component=L}),pe(()=>{})));for(const L of D.children)R.push(...E(L));return R};return AN(E(x.targetSnapshot.root)).pipe(dk(null),xc(1))}),KN(()=>this.afterPreactivation()),Sh(()=>{const{currentSnapshot:x,targetSnapshot:E}=l,D=this.createViewTransition?.(this.environmentInjector,x.root,E.root);return D?Ha(D).pipe(pe(()=>l)):jr(l)}),pe(x=>{const E=function Gre(e,n,t){const r=vS(e,n._root,t?t._root:void 0);return new fV(r,n)}(t.routeReuseStrategy,x.targetSnapshot,x.currentRouterState);return this.currentTransition=l={...x,targetRouterState:E},this.currentNavigation.targetRouterState=E,l}),Il(()=>{this.events.next(new zN)}),((e,n,t,r)=>pe(i=>(new Yre(n,i.targetRouterState,i.currentRouterState,t,r).activate(e),i)))(this.rootContexts,t.routeReuseStrategy,x=>this.events.next(x),this.inputBindingEnabled),xc(1),Il({next:x=>{u=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ng(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects))),this.titleStrategy?.updateTitle(x.targetRouterState.snapshot),x.resolve(!0)},complete:()=>{u=!0}}),Fo(this.transitionAbortSubject.pipe(Il(x=>{throw x}))),aS(()=>{!u&&!g&&this.cancelNavigationTransition(l,"",ud.SupersededByNewNavigation),this.currentTransition?.id===l.id&&(this.currentNavigation=null,this.currentTransition=null)}),r2(x=>{if(g=!0,bV(x))this.events.next(new Av(l.id,this.urlSerializer.serialize(l.extractedUrl),x.message,x.cancellationCode)),function Zre(e){return bV(e)&&Mv(e.url)}(x)?this.events.next(new bk(x.url,x.navigationBehaviorOptions)):l.resolve(!1);else{const E=new BN(l.id,this.urlSerializer.serialize(l.extractedUrl),x,l.targetSnapshot??void 0);try{const D=y(this.environmentInjector,()=>this.navigationErrorHandler?.(E));if(D instanceof qN){const{message:R,cancellationCode:L}=Ck(0,D);this.events.next(new Av(l.id,this.urlSerializer.serialize(l.extractedUrl),R,L)),this.events.next(new bk(D.redirectTo,D.navigationBehaviorOptions))}else{this.events.next(E);const R=t.errorHandler(x);l.resolve(!!R)}}catch(D){this.options.resolveNavigationPromiseOnError?l.resolve(!1):l.reject(D)}}return cd}))}))}cancelNavigationTransition(t,r,i){const l=new Av(t.id,this.urlSerializer.serialize(t.extractedUrl),r,i);this.events.next(l),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Wie(e){return e!==gS}let qie=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:()=>Qe(Xie),providedIn:"root"})}return e})();class Zie{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let Xie=(()=>{class e extends Zie{static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),FV=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:()=>Qe(Yie),providedIn:"root"})}return e})(),Yie=(()=>{class e extends FV{constructor(){super(...arguments),this.location=Qe(tS),this.urlSerializer=Qe(s2),this.options=Qe(d2,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Qe(eF),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Sv,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=pV(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(r=>{"popstate"===r.type&&t(r.url,r.state)})}handleRouterEvent(t,r){if(t instanceof vk)this.stateMemento=this.createStateMemento();else if(t instanceof o2)this.rawUrlTree=r.initialUrl;else if(t instanceof uV){if("eager"===this.urlUpdateStrategy&&!r.extras.skipLocationChange){const i=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??i,r)}}else t instanceof zN?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):t instanceof Av&&(t.code===ud.GuardRejected||t.code===ud.NoDataFromResolver)?this.restoreHistory(r):t instanceof BN?this.restoreHistory(r,!0):t instanceof Ng&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,r){const i=t instanceof Sv?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){const u={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(i,"",u)}else{const l={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(i,"",l)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-this.browserPageId;0!==l?this.location.historyGo(l):this.currentUrlTree===t.finalUrl&&0===l&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var TS=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(TS||{});function LV(e,n){e.events.pipe(Ga(t=>t instanceof Ng||t instanceof Av||t instanceof BN||t instanceof o2),pe(t=>t instanceof Ng||t instanceof o2?TS.COMPLETE:t instanceof Av&&(t.code===ud.Redirect||t.code===ud.SupersededByNewNavigation)?TS.REDIRECTING:TS.FAILED),Ga(t=>t!==TS.REDIRECTING),xc(1)).subscribe(()=>{n()})}function Kie(e){throw e}const Jie={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Qie={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ws=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=Qe(K6),this.stateManager=Qe(FV),this.options=Qe(d2,{optional:!0})||{},this.pendingTasks=Qe(ol),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Qe(Ik),this.urlSerializer=Qe(s2),this.location=Qe(tS),this.urlHandlingStrategy=Qe(eF),this._events=new Mi,this.errorHandler=this.options.errorHandler||Kie,this.navigated=!1,this.routeReuseStrategy=Qe(qie),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Qe(h2,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Qe(Ek,{optional:!0}),this.eventsSubscription=new os,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(r=>{try{const i=this.navigationTransitions.currentTransition,l=this.navigationTransitions.currentNavigation;if(null!==i&&null!==l)if(this.stateManager.handleRouterEvent(r,l),r instanceof Av&&r.code!==ud.Redirect&&r.code!==ud.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Ng)this.navigated=!0;else if(r instanceof bk){const u=r.navigationBehaviorOptions,g=this.urlHandlingStrategy.merge(r.url,i.currentRawUrl),x={browserUrl:i.extras.browserUrl,info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:i.extras.replaceUrl||"eager"===this.urlUpdateStrategy||Wie(i.source),...u};this.scheduleNavigation(g,gS,null,x,{resolve:i.resolve,reject:i.reject,promise:i.promise})}(function tse(e){return!(e instanceof zN||e instanceof bk)})(r)&&this._events.next(r)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),gS,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",r)},0)})}navigateToSyncWithBrowser(t,r,i){const l={replaceUrl:!0},u=i?.navigationId?i:null;if(i){const x={...i};delete x.navigationId,delete x.\u0275routerPageId,0!==Object.keys(x).length&&(l.state=x)}const g=this.parseUrl(t);this.scheduleNavigation(g,r,u,l)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(JN),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){const{relativeTo:i,queryParams:l,fragment:u,queryParamsHandling:g,preserveFragment:x}=r,E=x?this.currentUrlTree.fragment:u;let R,D=null;switch(g){case"merge":D={...this.currentUrlTree.queryParams,...l};break;case"preserve":D=this.currentUrlTree.queryParams;break;default:D=l||null}null!==D&&(D=this.removeEmptyProps(D));try{R=rV(i?i.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||"/"!==t[0][0])&&(t=[]),R=this.currentUrlTree.root}return iV(R,t,D,E??null)}navigateByUrl(t,r={skipLocationChange:!1}){const i=Mv(t)?t:this.parseUrl(t),l=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(l,gS,null,r)}navigate(t,r={skipLocationChange:!1}){return function ese(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new ln(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,r){let i;if(i=!0===r?{...Jie}:!1===r?{...Qie}:r,Mv(t))return ZU(this.currentUrlTree,t,i);const l=this.parseUrl(t);return ZU(this.currentUrlTree,l,i)}removeEmptyProps(t){return Object.entries(t).reduce((r,[i,l])=>(null!=l&&(r[i]=l),r),{})}scheduleNavigation(t,r,i,l,u){if(this.disposed)return Promise.resolve(!1);let g,x,E;u?(g=u.resolve,x=u.reject,E=u.promise):E=new Promise((R,L)=>{g=R,x=L});const D=this.pendingTasks.add();return LV(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(D))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:l,resolve:g,reject:x,promise:E,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),E.catch(R=>Promise.reject(R))}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),H0=(()=>{class e{constructor(t,r,i,l,u,g){this.router=t,this.route=r,this.tabIndexAttribute=i,this.renderer=l,this.el=u,this.locationStrategy=g,this.href=null,this.onChanges=new Mi,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;const x=u.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===x||"area"===x,this.isAnchorElement?this.subscription=t.events.subscribe(E=>{E instanceof Ng&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null==t?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(this.routerLinkInput=Mv(t)||Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,r,i,l,u){const g=this.urlTree;return!!(null===g||this.isAnchorElement&&(0!==t||r||i||l||u||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(g,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const t=this.urlTree;this.href=null!==t&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t)):null;const r=null===this.href?null:function qM(e,n,t){return function WM(e,n){return"src"===n&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===n&&("base"===e||"link"===e)?Sf:_g}(n,t)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(t,r){const i=this.renderer,l=this.el.nativeElement;null!==r?i.setAttribute(l,t,r):i.removeAttribute(l,t)}get urlTree(){return null===this.routerLinkInput?null:Mv(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ws),ut(Su),_u("tabindex"),ut(id),ut(Li),ut(z0))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,i){1&r&&ct("click",function(u){return i.onClick(u.button,u.ctrlKey,u.shiftKey,u.altKey,u.metaKey)}),2&r&&rs("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",go],skipLocationChange:[2,"skipLocationChange","skipLocationChange",go],replaceUrl:[2,"replaceUrl","replaceUrl",go],routerLink:"routerLink"},standalone:!0,features:[MC,Co]})}return e})(),BV=(()=>{class e{get isActive(){return this._isActive}constructor(t,r,i,l,u){this.router=t,this.element=r,this.renderer=i,this.cdr=l,this.link=u,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new rr,this.routerEventsSubscription=t.events.subscribe(g=>{g instanceof Ng&&this.update()})}ngAfterContentInit(){jr(this.links.changes,jr(null)).pipe(n2()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const t=[...this.links.toArray(),this.link].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=Ha(t).pipe(n2()).subscribe(r=>{this._isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(t){const r=Array.isArray(t)?t:t.split(" ");this.classes=r.filter(i=>!!i)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const t=this.hasActiveLinks();this.classes.forEach(r=>{t?this.renderer.addClass(this.element.nativeElement,r):this.renderer.removeClass(this.element.nativeElement,r)}),t&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.isActiveChange.emit(t))})}isLinkActive(t){const r=function nse(e){return!!e.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return i=>{const l=i.urlTree;return!!l&&t.isActive(l,r)}}hasActiveLinks(){const t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ws),ut(Li),ut(id),ut(Th),ut(H0,8))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(r,i,l){if(1&r&&vs(l,H0,5),2&r){let u;_i(u=yi())&&(i.links=u)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[Co]})}return e})();class zV{}let rse=(()=>{class e{constructor(t,r,i,l,u){this.router=t,this.injector=i,this.preloadingStrategy=l,this.loader=u}setUpPreloading(){this.subscription=this.router.events.pipe(Ga(t=>t instanceof Ng),e2(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const i=[];for(const l of r){l.providers&&!l._injector&&(l._injector=rI(l.providers,t,`Route: ${l.path}`));const u=l._injector??t,g=l._loadedInjector??u;(l.loadChildren&&!l._loadedRoutes&&void 0===l.canLoad||l.loadComponent&&!l._loadedComponent)&&i.push(this.preloadConfig(u,l)),(l.children||l._loadedRoutes)&&i.push(this.processRoutes(g,l.children??l._loadedRoutes))}return Ha(i).pipe(n2())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let i;i=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):jr(null);const l=i.pipe(Ml(u=>null===u?jr(void 0):(r._loadedRoutes=u.routes,r._loadedInjector=u.injector,this.processRoutes(u.injector??t,u.routes))));return r.loadComponent&&!r._loadedComponent?Ha([l,this.loader.loadComponent(r)]).pipe(n2()):l})}static#e=this.\u0275fac=function(r){return new(r||e)($n(ws),$n(l8),$n(Go),$n(zV),$n(QN))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const tF=new vn("");let UV=(()=>{class e{constructor(t,r,i,l,u={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=i,this.zone=l,this.options=u,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},u.scrollPositionRestoration||="disabled",u.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof vk?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Ng?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof o2&&t.code===xk.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof dV&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new dV(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function _0(){throw new Error("invalid")}()};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();function Jp(e,n){return{\u0275kind:e,\u0275providers:n}}function jV(){const e=Qe(zs);return n=>{const t=e.get(wh);if(n!==t.components[0])return;const r=e.get(ws),i=e.get($V);1===e.get(nF)&&r.initialNavigation(),e.get(HV,null,wi.Optional)?.setUpPreloading(),e.get(tF,null,wi.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const $V=new vn("",{factory:()=>new Mi}),nF=new vn("",{providedIn:"root",factory:()=>1}),HV=new vn("");function ase(e){return Jp(0,[{provide:HV,useExisting:rse},{provide:zV,useExisting:e}])}function cse(e){return Jp(9,[{provide:PV,useValue:Hie},{provide:RV,useValue:{skipNextTransition:!!e?.skipInitialTransition,...e}}])}const GV=new vn("ROUTER_FORROOT_GUARD"),use=[tS,{provide:s2,useClass:fk},ws,yS,{provide:Su,useFactory:function VV(e){return e.routerState.root},deps:[ws]},QN,[]];let WV=(()=>{class e{constructor(t){}static forRoot(t,r){return{ngModule:e,providers:[use,[],{provide:h2,multi:!0,useValue:t},{provide:GV,useFactory:pse,deps:[[ws,new Hl,new $m]]},{provide:d2,useValue:r||{}},r?.useHash?{provide:z0,useClass:rz}:{provide:z0,useClass:nz},{provide:tF,useFactory:()=>{const e=Qe(fee),n=Qe(ni),t=Qe(d2),r=Qe(Ik),i=Qe(s2);return t.scrollOffset&&e.setOffset(t.scrollOffset),new UV(i,r,e,n,t)}},r?.preloadingStrategy?ase(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?mse(r):[],r?.bindToComponentInputs?Jp(8,[yV,{provide:Ek,useExisting:yV}]).\u0275providers:[],r?.enableViewTransitions?cse().\u0275providers:[],[{provide:qV,useFactory:jV},{provide:SI,multi:!0,useExisting:qV}]]}}static forChild(t){return{ngModule:e,providers:[{provide:h2,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(r){return new(r||e)($n(GV,8))};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})();function pse(e){return"guarded"}function mse(e){return["disabled"===e.initialNavigation?Jp(3,[{provide:A3,multi:!0,useFactory:()=>{const n=Qe(ws);return()=>{n.setUpLocationChangeListener()}}},{provide:nF,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Jp(2,[{provide:nF,useValue:0},{provide:A3,multi:!0,deps:[zs],useFactory:n=>{const t=n.get(eQ,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const i=n.get(ws),l=n.get($V);LV(i,()=>{r(!0)}),n.get(Ik).afterPreactivation=()=>(r(!0),l.closed?jr(void 0):l),i.initialNavigation()}))}}]).\u0275providers:[]]}const qV=new vn("");let io=(()=>{class e{constructor(t){this.router=t}canActivate(t){const r=localStorage.getItem("token"),i=localStorage.getItem("role"),l=t.data.role;return r?!l||i===l||(this.router.navigate(["/home"]),!1):(this.router.navigate(["/login"]),!1)}static#e=this.\u0275fac=function(r){return new(r||e)($n(ws))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var ES={version:"0.18.5"},dd=1200,Iv=1252,_se=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],rF={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},kk=function(e){-1!=_se.indexOf(e)&&(Iv=rF[0]=e)},Dh=function(e){dd=e,kk(e)};var is,CS=function(n){return String.fromCharCode(n)},iF=function(n){return String.fromCharCode(n)},Qo=null,G0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function DS(e){for(var n="",t=0,r=0,i=0,l=0,u=0,g=0,x=0,E=0;E<e.length;)l=(t=e.charCodeAt(E++))>>2,u=(3&t)<<4|(r=e.charCodeAt(E++))>>4,g=(15&r)<<2|(i=e.charCodeAt(E++))>>6,x=63&i,isNaN(r)?g=x=64:isNaN(i)&&(x=64),n+=G0.charAt(l)+G0.charAt(u)+G0.charAt(g)+G0.charAt(x);return n}function hd(e){var n="",l=0,u=0,g=0,x=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var E=0;E<e.length;)l=G0.indexOf(e.charAt(E++)),u=G0.indexOf(e.charAt(E++)),n+=String.fromCharCode(l<<2|u>>4),64!==(g=G0.indexOf(e.charAt(E++)))&&(n+=String.fromCharCode((15&u)<<4|g>>2)),64!==(x=G0.indexOf(e.charAt(E++)))&&(n+=String.fromCharCode((3&g)<<6|x));return n}var Bi=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Fg=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(n,t){return t?new Buffer(n,t):new Buffer(n)}:Buffer.from.bind(Buffer)}return function(){}}();function W0(e){return Bi?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function XV(e){return Bi?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var fd=function(n){return Bi?Fg(n,"binary"):n.split("").map(function(t){return 255&t.charCodeAt(0)})};function MS(e){if(typeof ArrayBuffer>"u")return fd(e);for(var n=new ArrayBuffer(e.length),t=new Uint8Array(n),r=0;r!=e.length;++r)t[r]=255&e.charCodeAt(r);return n}function q0(e){if(Array.isArray(e))return e.map(function(r){return String.fromCharCode(r)}).join("");for(var n=[],t=0;t<e.length;++t)n[t]=String.fromCharCode(e[t]);return n.join("")}var kl=Bi?function(e){return Buffer.concat(e.map(function(n){return Buffer.isBuffer(n)?n:Fg(n)}))}:function(e){if(typeof Uint8Array<"u"){var n=0,t=0;for(n=0;n<e.length;++n)t+=e[n].length;var r=new Uint8Array(t),i=0;for(n=0,t=0;n<e.length;t+=i,++n)if(i=e[n].length,e[n]instanceof Uint8Array)r.set(e[n],t);else{if("string"==typeof e[n])throw"wtf";r.set(new Uint8Array(e[n]),t)}return r}return[].concat.apply([],e.map(function(l){return Array.isArray(l)?l:[].slice.call(l)}))},bc=/\u0000/g,AS=/[\u0001-\u0006]/g;function p2(e){for(var n="",t=e.length-1;t>=0;)n+=e.charAt(t--);return n}function $f(e,n){var t=""+e;return t.length>=n?t:ta("0",n-t.length)+t}function oF(e,n){var t=""+e;return t.length>=n?t:ta(" ",n-t.length)+t}function Rk(e,n){var t=""+e;return t.length>=n?t:t+ta(" ",n-t.length)}var YV=Math.pow(2,32);function m2(e,n){return e>YV||e<-YV?function wse(e,n){var t=""+Math.round(e);return t.length>=n?t:ta("0",n-t.length)+t}(e,n):function Tse(e,n){var t=""+e;return t.length>=n?t:ta("0",n-t.length)+t}(Math.round(e),n)}function Nk(e,n){return e.length>=7+(n=n||0)&&103==(32|e.charCodeAt(n))&&101==(32|e.charCodeAt(n+1))&&110==(32|e.charCodeAt(n+2))&&101==(32|e.charCodeAt(n+3))&&114==(32|e.charCodeAt(n+4))&&97==(32|e.charCodeAt(n+5))&&108==(32|e.charCodeAt(n+6))}var KV=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],aF=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]],$r={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "'},JV={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Cse={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Fk(e,n,t){for(var r=e<0?-1:1,i=e*r,l=0,u=1,g=0,x=1,E=0,D=0,R=Math.floor(i);E<n&&(g=(R=Math.floor(i))*u+l,D=R*E+x,!(i-R<5e-8));)i=1/(i-R),l=u,u=g,x=E,E=D;if(D>n&&(E>n?(D=x,g=l):(D=E,g=u)),!t)return[0,r*g,D];var L=Math.floor(r*g/D);return[L,r*g-L*D,D]}function Z0(e,n,t){if(e>2958465||e<0)return null;var r=0|e,i=Math.floor(86400*(e-r)),l=0,u=[],g={D:r,T:i,u:86400*(e-r)-i,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(g.u)<1e-6&&(g.u=0),n&&n.date1904&&(r+=1462),g.u>.9999&&(g.u=0,86400==++i&&(g.T=i=0,++r,++g.D)),60===r)u=t?[1317,10,29]:[1900,2,29],l=3;else if(0===r)u=t?[1317,8,29]:[1900,1,0],l=6;else{r>60&&--r;var x=new Date(1900,0,1);x.setDate(x.getDate()+r-1),u=[x.getFullYear(),x.getMonth()+1,x.getDate()],l=x.getDay(),r<60&&(l=(l+6)%7),t&&(l=function kse(e,n){n[0]-=581;var t=e.getDay();return e<60&&(t=(t+6)%7),t}(x,u))}return g.y=u[0],g.m=u[1],g.d=u[2],g.S=i%60,i=Math.floor(i/60),g.M=i%60,i=Math.floor(i/60),g.H=i,g.q=l,g}var QV=new Date(1899,11,31,0,0,0),Sse=QV.getTime(),Dse=new Date(1900,2,1,0,0,0);function ej(e,n){var t=e.getTime();return n?t-=1262304e5:e>=Dse&&(t+=864e5),(t-(Sse+6e4*(e.getTimezoneOffset()-QV.getTimezoneOffset())))/864e5}function lF(e){return-1==e.indexOf(".")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function kv(e,n){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(0|e)===e?e.toString(10):function IS(e){var t,n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E);return t=n>=-4&&n<=-1?e.toPrecision(10+n):Math.abs(n)<=9?function Ase(e){var n=e<0?12:11,t=lF(e.toFixed(12));return t.length<=n||(t=e.toPrecision(10)).length<=n?t:e.toExponential(5)}(e):10===n?e.toFixed(10).substr(0,12):function Ise(e){var n=lF(e.toFixed(11));return n.length>(e<0?12:11)||"0"===n||"-0"===n?e.toPrecision(6):n}(e),lF(function Mse(e){return-1==e.indexOf("E")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}(t.toUpperCase()))}(e);case"undefined":return"";case"object":if(null==e)return"";if(e instanceof Date)return pd(14,ej(e,n&&n.date1904),n)}throw new Error("unsupported value in General format: "+e)}function Ose(e,n,t,r){var x,i="",l=0,u=0,g=t.y,E=0;switch(e){case 98:g=t.y+543;case 121:switch(n.length){case 1:case 2:x=g%100,E=2;break;default:x=g%1e4,E=4}break;case 109:switch(n.length){case 1:case 2:x=t.m,E=n.length;break;case 3:return aF[t.m-1][1];case 5:return aF[t.m-1][0];default:return aF[t.m-1][2]}break;case 100:switch(n.length){case 1:case 2:x=t.d,E=n.length;break;case 3:return KV[t.q][0];default:return KV[t.q][1]}break;case 104:switch(n.length){case 1:case 2:x=1+(t.H+11)%12,E=n.length;break;default:throw"bad hour format: "+n}break;case 72:switch(n.length){case 1:case 2:x=t.H,E=n.length;break;default:throw"bad hour format: "+n}break;case 77:switch(n.length){case 1:case 2:x=t.M,E=n.length;break;default:throw"bad minute format: "+n}break;case 115:if("s"!=n&&"ss"!=n&&".0"!=n&&".00"!=n&&".000"!=n)throw"bad second format: "+n;return 0!==t.u||"s"!=n&&"ss"!=n?(u=r>=2?3===r?1e3:100:1===r?10:1,(l=Math.round(u*(t.S+t.u)))>=60*u&&(l=0),"s"===n?0===l?"0":""+l/u:(i=$f(l,2+r),"ss"===n?i.substr(0,2):"."+i.substr(2,n.length-1))):$f(t.S,n.length);case 90:switch(n){case"[h]":case"[hh]":x=24*t.D+t.H;break;case"[m]":case"[mm]":x=60*(24*t.D+t.H)+t.M;break;case"[s]":case"[ss]":x=60*(60*(24*t.D+t.H)+t.M)+Math.round(t.S+t.u);break;default:throw"bad abstime format: "+n}E=3===n.length?1:2;break;case 101:x=g,E=1}return E>0?$f(x,E):""}function X0(e){if(e.length<=3)return e;for(var t=e.length%3,r=e.substr(0,t);t!=e.length;t+=3)r+=(r.length>0?",":"")+e.substr(t,3);return r}var tj=/%/g;function nj(e,n){var t,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==n)return"0.0E+0";if(n<0)return"-"+nj(e,-n);var i=e.indexOf(".");-1===i&&(i=e.indexOf("E"));var l=Math.floor(Math.log(n)*Math.LOG10E)%i;if(l<0&&(l+=i),-1===(t=(n/Math.pow(10,l)).toPrecision(r+1+(i+l)%i)).indexOf("e")){var u=Math.floor(Math.log(n)*Math.LOG10E);for(-1===t.indexOf(".")?t=t.charAt(0)+"."+t.substr(1)+"E+"+(u-t.length+l):t+="E+"+(u-l);"0."===t.substr(0,2);)t=(t=t.charAt(0)+t.substr(2,i)+"."+t.substr(2+i)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(g,x,E,D){return x+E+D.substr(0,(i+l)%i)+"."+D.substr(l)+"E"})}else t=n.toExponential(r);return e.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),e.match(/E\-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}var rj=/# (\?+)( ?)\/( ?)(\d+)/,ij=/^#*0*\.([0#]+)/,sj=/\).*[0#]/,oj=/\(###\) ###\\?-####/;function Xc(e){for(var t,n="",r=0;r!=e.length;++r)switch(t=e.charCodeAt(r)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(t)}return n}function aj(e,n){var t=Math.pow(10,n);return""+Math.round(e*t)/t}function lj(e,n){var t=e-Math.floor(e),r=Math.pow(10,n);return n<(""+Math.round(t*r)).length?0:Math.round(t*r)}function Mh(e,n,t){if(40===e.charCodeAt(0)&&!n.match(sj)){var r=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?Mh("n",r,t):"("+Mh("n",r,-t)+")"}if(44===n.charCodeAt(n.length-1))return function Rse(e,n,t){for(var r=n.length-1;44===n.charCodeAt(r-1);)--r;return Lg(e,n.substr(0,r),t/Math.pow(10,3*(n.length-r)))}(e,n,t);if(-1!==n.indexOf("%"))return function Pse(e,n,t){var r=n.replace(tj,""),i=n.length-r.length;return Lg(e,r,t*Math.pow(10,2*i))+ta("%",i)}(e,n,t);if(-1!==n.indexOf("E"))return nj(n,t);if(36===n.charCodeAt(0))return"$"+Mh(e,n.substr(" "==n.charAt(1)?2:1),t);var i,l,u,g,x=Math.abs(t),E=t<0?"-":"";if(n.match(/^00+$/))return E+m2(x,n.length);if(n.match(/^[#?]+$/))return"0"===(i=m2(t,0))&&(i=""),i.length>n.length?i:Xc(n.substr(0,n.length-i.length))+i;if(l=n.match(rj))return function Nse(e,n,t){var r=parseInt(e[4],10),i=Math.round(n*r),l=Math.floor(i/r),u=i-l*r,g=r;return t+(0===l?"":""+l)+" "+(0===u?ta(" ",e[1].length+1+e[4].length):oF(u,e[1].length)+e[2]+"/"+e[3]+$f(g,e[4].length))}(l,x,E);if(n.match(/^#+0+$/))return E+m2(x,n.length-n.indexOf("0"));if(l=n.match(ij))return i=aj(t,l[1].length).replace(/^([^\.]+)$/,"$1."+Xc(l[1])).replace(/\.$/,"."+Xc(l[1])).replace(/\.(\d*)$/,function(Y,G){return"."+G+ta("0",Xc(l[1]).length-G.length)}),-1!==n.indexOf("0.")?i:i.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),l=n.match(/^(0*)\.(#*)$/))return E+aj(x,l[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,l[1].length?"0.":".");if(l=n.match(/^#{1,3},##0(\.?)$/))return E+X0(m2(x,0));if(l=n.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+Mh(e,n,-t):X0(""+(Math.floor(t)+function Lse(e,n){return n<(""+Math.round((e-Math.floor(e))*Math.pow(10,n))).length?1:0}(t,l[1].length)))+"."+$f(lj(t,l[1].length),l[1].length);if(l=n.match(/^#,#*,#0/))return Mh(e,n.replace(/^#,#*,/,""),t);if(l=n.match(/^([0#]+)(\\?-([0#]+))+$/))return i=p2(Mh(e,n.replace(/[\\-]/g,""),t)),u=0,p2(p2(n.replace(/\\/g,"")).replace(/[0#]/g,function(Y){return u<i.length?i.charAt(u++):"0"===Y?"0":""}));if(n.match(oj))return"("+(i=Mh(e,"##########",t)).substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var D="";if(l=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return u=Math.min(l[4].length,7),g=Fk(x,Math.pow(10,u)-1,!1),i=""+E," "==(D=Lg("n",l[1],g[1])).charAt(D.length-1)&&(D=D.substr(0,D.length-1)+"0"),i+=D+l[2]+"/"+l[3],(D=Rk(g[2],u)).length<l[4].length&&(D=Xc(l[4].substr(l[4].length-D.length))+D),i+=D;if(l=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return u=Math.min(Math.max(l[1].length,l[4].length),7),E+((g=Fk(x,Math.pow(10,u)-1,!0))[0]||(g[1]?"":"0"))+" "+(g[1]?oF(g[1],u)+l[2]+"/"+l[3]+Rk(g[2],u):ta(" ",2*u+1+l[2].length+l[3].length));if(l=n.match(/^[#0?]+$/))return i=m2(t,0),n.length<=i.length?i:Xc(n.substr(0,n.length-i.length))+i;if(l=n.match(/^([#0?]+)\.([#0]+)$/)){i=""+t.toFixed(Math.min(l[2].length,10)).replace(/([^0])0+$/,"$1"),u=i.indexOf(".");var R=n.indexOf(".")-u,L=n.length-i.length-R;return Xc(n.substr(0,R)+i+n.substr(n.length-L))}if(l=n.match(/^00,000\.([#0]*0)$/))return u=lj(t,l[1].length),t<0?"-"+Mh(e,n,-t):X0(function Bse(e){return e<2147483647&&e>-2147483648?""+(e>=0?0|e:e-1|0):""+Math.floor(e)}(t)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(Y){return"00,"+(Y.length<3?$f(0,3-Y.length):"")+Y})+"."+$f(u,l[1].length);switch(n){case"###,##0.00":return Mh(e,"#,##0.00",t);case"###,###":case"##,###":case"#,###":var V=X0(m2(x,0));return"0"!==V?E+V:"";case"###,###.00":return Mh(e,"###,##0.00",t).replace(/^0\./,".");case"#,###.00":return Mh(e,"#,##0.00",t).replace(/^0\./,".")}throw new Error("unsupported format |"+n+"|")}function cj(e,n){var t,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==n)return"0.0E+0";if(n<0)return"-"+cj(e,-n);var i=e.indexOf(".");-1===i&&(i=e.indexOf("E"));var l=Math.floor(Math.log(n)*Math.LOG10E)%i;if(l<0&&(l+=i),!(t=(n/Math.pow(10,l)).toPrecision(r+1+(i+l)%i)).match(/[Ee]/)){var u=Math.floor(Math.log(n)*Math.LOG10E);-1===t.indexOf(".")?t=t.charAt(0)+"."+t.substr(1)+"E+"+(u-t.length+l):t+="E+"+(u-l),t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(g,x,E,D){return x+E+D.substr(0,(i+l)%i)+"."+D.substr(l)+"E"})}else t=n.toExponential(r);return e.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),e.match(/E\-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}function Qp(e,n,t){if(40===e.charCodeAt(0)&&!n.match(sj)){var r=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?Qp("n",r,t):"("+Qp("n",r,-t)+")"}if(44===n.charCodeAt(n.length-1))return function zse(e,n,t){for(var r=n.length-1;44===n.charCodeAt(r-1);)--r;return Lg(e,n.substr(0,r),t/Math.pow(10,3*(n.length-r)))}(e,n,t);if(-1!==n.indexOf("%"))return function Use(e,n,t){var r=n.replace(tj,""),i=n.length-r.length;return Lg(e,r,t*Math.pow(10,2*i))+ta("%",i)}(e,n,t);if(-1!==n.indexOf("E"))return cj(n,t);if(36===n.charCodeAt(0))return"$"+Qp(e,n.substr(" "==n.charAt(1)?2:1),t);var i,l,u,g,x=Math.abs(t),E=t<0?"-":"";if(n.match(/^00+$/))return E+$f(x,n.length);if(n.match(/^[#?]+$/))return i=""+t,0===t&&(i=""),i.length>n.length?i:Xc(n.substr(0,n.length-i.length))+i;if(l=n.match(rj))return function Fse(e,n,t){return t+(0===n?"":""+n)+ta(" ",e[1].length+2+e[4].length)}(l,x,E);if(n.match(/^#+0+$/))return E+$f(x,n.length-n.indexOf("0"));if(l=n.match(ij))return i=(i=(""+t).replace(/^([^\.]+)$/,"$1."+Xc(l[1])).replace(/\.$/,"."+Xc(l[1]))).replace(/\.(\d*)$/,function(Y,G){return"."+G+ta("0",Xc(l[1]).length-G.length)}),-1!==n.indexOf("0.")?i:i.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),l=n.match(/^(0*)\.(#*)$/))return E+(""+x).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,l[1].length?"0.":".");if(l=n.match(/^#{1,3},##0(\.?)$/))return E+X0(""+x);if(l=n.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+Qp(e,n,-t):X0(""+t)+"."+ta("0",l[1].length);if(l=n.match(/^#,#*,#0/))return Qp(e,n.replace(/^#,#*,/,""),t);if(l=n.match(/^([0#]+)(\\?-([0#]+))+$/))return i=p2(Qp(e,n.replace(/[\\-]/g,""),t)),u=0,p2(p2(n.replace(/\\/g,"")).replace(/[0#]/g,function(Y){return u<i.length?i.charAt(u++):"0"===Y?"0":""}));if(n.match(oj))return"("+(i=Qp(e,"##########",t)).substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var D="";if(l=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return u=Math.min(l[4].length,7),g=Fk(x,Math.pow(10,u)-1,!1),i=""+E," "==(D=Lg("n",l[1],g[1])).charAt(D.length-1)&&(D=D.substr(0,D.length-1)+"0"),i+=D+l[2]+"/"+l[3],(D=Rk(g[2],u)).length<l[4].length&&(D=Xc(l[4].substr(l[4].length-D.length))+D),i+=D;if(l=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return u=Math.min(Math.max(l[1].length,l[4].length),7),E+((g=Fk(x,Math.pow(10,u)-1,!0))[0]||(g[1]?"":"0"))+" "+(g[1]?oF(g[1],u)+l[2]+"/"+l[3]+Rk(g[2],u):ta(" ",2*u+1+l[2].length+l[3].length));if(l=n.match(/^[#0?]+$/))return n.length<=(i=""+t).length?i:Xc(n.substr(0,n.length-i.length))+i;if(l=n.match(/^([#0]+)\.([#0]+)$/)){i=""+t.toFixed(Math.min(l[2].length,10)).replace(/([^0])0+$/,"$1"),u=i.indexOf(".");var R=n.indexOf(".")-u,L=n.length-i.length-R;return Xc(n.substr(0,R)+i+n.substr(n.length-L))}if(l=n.match(/^00,000\.([#0]*0)$/))return t<0?"-"+Qp(e,n,-t):X0(""+t).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(Y){return"00,"+(Y.length<3?$f(0,3-Y.length):"")+Y})+"."+$f(0,l[1].length);switch(n){case"###,###":case"##,###":case"#,###":var V=X0(""+x);return"0"!==V?E+V:"";default:if(n.match(/\.[0#?]*$/))return Qp(e,n.slice(0,n.lastIndexOf(".")),t)+Xc(n.slice(n.lastIndexOf(".")))}throw new Error("unsupported format |"+n+"|")}function Lg(e,n,t){return(0|t)===t?Qp(e,n,t):Mh(e,n,t)}var uj=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function g2(e){for(var n=0,t="",r="";n<e.length;)switch(t=e.charAt(n)){case"G":Nk(e,n)&&(n+=6),n++;break;case'"':for(;34!==e.charCodeAt(++n)&&n<e.length;);++n;break;case"\\":case"_":n+=2;break;case"@":++n;break;case"B":case"b":if("1"===e.charAt(n+1)||"2"===e.charAt(n+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4e0a":if("A/P"===e.substr(n,3).toUpperCase()||"AM/PM"===e.substr(n,5).toUpperCase()||"\u4e0a\u5348/\u4e0b\u5348"===e.substr(n,5).toUpperCase())return!0;++n;break;case"[":for(r=t;"]"!==e.charAt(n++)&&n<e.length;)r+=e.charAt(n);if(r.match(uj))return!0;break;case".":case"0":case"#":for(;n<e.length&&("0#?.,E+-%".indexOf(t=e.charAt(++n))>-1||"\\"==t&&"-"==e.charAt(n+1)&&"0#".indexOf(e.charAt(n+2))>-1););break;case"?":for(;e.charAt(++n)===t;);break;case"*":++n,(" "==e.charAt(n)||"*"==e.charAt(n))&&++n;break;case"(":case")":++n;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;n<e.length&&"0123456789".indexOf(e.charAt(++n))>-1;);break;default:++n}return!1}var dj=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function hj(e,n){if(null==n)return!1;var t=parseFloat(n[2]);switch(n[1]){case"=":if(e==t)return!0;break;case">":if(e>t)return!0;break;case"<":if(e<t)return!0;break;case"<>":if(e!=t)return!0;break;case">=":if(e>=t)return!0;break;case"<=":if(e<=t)return!0}return!1}function pd(e,n,t){null==t&&(t={});var r="";switch(typeof e){case"string":r="m/d/yy"==e&&t.dateNF?t.dateNF:e;break;case"number":null==(r=14==e&&t.dateNF?t.dateNF:(null!=t.table?t.table:$r)[e])&&(r=t.table&&t.table[JV[e]]||$r[JV[e]]),null==r&&(r=Cse[e]||"General")}if(Nk(r,0))return kv(n,t);n instanceof Date&&(n=ej(n,t.date1904));var i=function $se(e,n){var t=function Vse(e){for(var n=[],t=!1,r=0,i=0;r<e.length;++r)switch(e.charCodeAt(r)){case 34:t=!t;break;case 95:case 42:case 92:++r;break;case 59:n[n.length]=e.substr(i,r-i),i=r+1}if(n[n.length]=e.substr(i),!0===t)throw new Error("Format |"+e+"| unterminated string ");return n}(e),r=t.length,i=t[r-1].indexOf("@");if(r<4&&i>-1&&--r,t.length>4)throw new Error("cannot find right format for |"+t.join("|")+"|");if("number"!=typeof n)return[4,4===t.length||i>-1?t[t.length-1]:"@"];switch(t.length){case 1:t=i>-1?["General","General","General",t[0]]:[t[0],t[0],t[0],"@"];break;case 2:t=i>-1?[t[0],t[0],t[0],t[1]]:[t[0],t[1],t[0],"@"];break;case 3:t=i>-1?[t[0],t[1],t[0],t[2]]:[t[0],t[1],t[2],"@"]}var l=n>0?t[0]:n<0?t[1]:t[2];if(-1===t[0].indexOf("[")&&-1===t[1].indexOf("["))return[r,l];if(null!=t[0].match(/\[[=<>]/)||null!=t[1].match(/\[[=<>]/)){var u=t[0].match(dj),g=t[1].match(dj);return hj(n,u)?[r,t[0]]:hj(n,g)?[r,t[1]]:[r,t[null!=u&&null!=g?2:1]]}return[r,l]}(r,n);if(Nk(i[1]))return kv(n,t);if(!0===n)n="TRUE";else if(!1===n)n="FALSE";else if(""===n||null==n)return"";return function jse(e,n,t,r){for(var E,D,R,i=[],l="",u=0,g="",x="t",L="H";u<e.length;)switch(g=e.charAt(u)){case"G":if(!Nk(e,u))throw new Error("unrecognized character "+g+" in "+e);i[i.length]={t:"G",v:"General"},u+=7;break;case'"':for(l="";34!==(R=e.charCodeAt(++u))&&u<e.length;)l+=String.fromCharCode(R);i[i.length]={t:"t",v:l},++u;break;case"\\":var V=e.charAt(++u);i[i.length]={t:"("===V||")"===V?V:"t",v:V},++u;break;case"_":i[i.length]={t:"t",v:" "},u+=2;break;case"@":i[i.length]={t:"T",v:n},++u;break;case"B":case"b":if("1"===e.charAt(u+1)||"2"===e.charAt(u+1)){if(null==E&&null==(E=Z0(n,t,"2"===e.charAt(u+1))))return"";i[i.length]={t:"X",v:e.substr(u,2)},x=g,u+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":g=g.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(n<0||null==E&&null==(E=Z0(n,t)))return"";for(l=g;++u<e.length&&e.charAt(u).toLowerCase()===g;)l+=g;"m"===g&&"h"===x.toLowerCase()&&(g="M"),"h"===g&&(g=L),i[i.length]={t:g,v:l},x=g;break;case"A":case"a":case"\u4e0a":var G={t:g,v:g};if(null==E&&(E=Z0(n,t)),"A/P"===e.substr(u,3).toUpperCase()?(null!=E&&(G.v=E.H>=12?"P":"A"),G.t="T",L="h",u+=3):"AM/PM"===e.substr(u,5).toUpperCase()?(null!=E&&(G.v=E.H>=12?"PM":"AM"),G.t="T",u+=5,L="h"):"\u4e0a\u5348/\u4e0b\u5348"===e.substr(u,5).toUpperCase()?(null!=E&&(G.v=E.H>=12?"\u4e0b\u5348":"\u4e0a\u5348"),G.t="T",u+=5,L="h"):(G.t="t",++u),null==E&&"T"===G.t)return"";i[i.length]=G,x=g;break;case"[":for(l=g;"]"!==e.charAt(u++)&&u<e.length;)l+=e.charAt(u);if("]"!==l.slice(-1))throw'unterminated "[" block: |'+l+"|";if(l.match(uj)){if(null==E&&null==(E=Z0(n,t)))return"";i[i.length]={t:"Z",v:l.toLowerCase()},x=l.charAt(1)}else l.indexOf("$")>-1&&(l=(l.match(/\$([^-\[\]]*)/)||[])[1]||"$",g2(e)||(i[i.length]={t:"t",v:l}));break;case".":if(null!=E){for(l=g;++u<e.length&&"0"===(g=e.charAt(u));)l+=g;i[i.length]={t:"s",v:l};break}case"0":case"#":for(l=g;++u<e.length&&"0#?.,E+-%".indexOf(g=e.charAt(u))>-1;)l+=g;i[i.length]={t:"n",v:l};break;case"?":for(l=g;e.charAt(++u)===g;)l+=g;i[i.length]={t:g,v:l},x=g;break;case"*":++u,(" "==e.charAt(u)||"*"==e.charAt(u))&&++u;break;case"(":case")":i[i.length]={t:1===r?"t":g,v:g},++u;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(l=g;u<e.length&&"0123456789".indexOf(e.charAt(++u))>-1;)l+=e.charAt(u);i[i.length]={t:"D",v:l};break;case" ":i[i.length]={t:g,v:g},++u;break;case"$":i[i.length]={t:"t",v:"$"},++u;break;default:if(-1===",$-+/():!^&'~{}<>=\u20acacfijklopqrtuvwxzP".indexOf(g))throw new Error("unrecognized character "+g+" in "+e);i[i.length]={t:"t",v:g},++u}var le,Q=0,he=0;for(u=i.length-1,x="t";u>=0;--u)switch(i[u].t){case"h":case"H":i[u].t=L,x="h",Q<1&&(Q=1);break;case"s":(le=i[u].v.match(/\.0+$/))&&(he=Math.max(he,le[0].length-1)),Q<3&&(Q=3);case"d":case"y":case"M":case"e":x=i[u].t;break;case"m":"s"===x&&(i[u].t="M",Q<2&&(Q=2));break;case"X":break;case"Z":Q<1&&i[u].v.match(/[Hh]/)&&(Q=1),Q<2&&i[u].v.match(/[Mm]/)&&(Q=2),Q<3&&i[u].v.match(/[Ss]/)&&(Q=3)}switch(Q){case 0:break;case 1:E.u>=.5&&(E.u=0,++E.S),E.S>=60&&(E.S=0,++E.M),E.M>=60&&(E.M=0,++E.H);break;case 2:E.u>=.5&&(E.u=0,++E.S),E.S>=60&&(E.S=0,++E.M)}var ze,me="";for(u=0;u<i.length;++u)switch(i[u].t){case"t":case"T":case" ":case"D":break;case"X":i[u].v="",i[u].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":i[u].v=Ose(i[u].t.charCodeAt(0),i[u].v,E,he),i[u].t="t";break;case"n":case"?":for(ze=u+1;null!=i[ze]&&("?"===(g=i[ze].t)||"D"===g||(" "===g||"t"===g)&&null!=i[ze+1]&&("?"===i[ze+1].t||"t"===i[ze+1].t&&"/"===i[ze+1].v)||"("===i[u].t&&(" "===g||"n"===g||")"===g)||"t"===g&&("/"===i[ze].v||" "===i[ze].v&&null!=i[ze+1]&&"?"==i[ze+1].t));)i[u].v+=i[ze].v,i[ze]={v:"",t:";"},++ze;me+=i[u].v,u=ze-1;break;case"G":i[u].t="t",i[u].v=kv(n,t)}var ht,Ne,Je="";if(me.length>0){40==me.charCodeAt(0)?(ht=n<0&&45===me.charCodeAt(0)?-n:n,Ne=Lg("n",me,ht)):(Ne=Lg("n",me,ht=n<0&&r>1?-n:n),ht<0&&i[0]&&"t"==i[0].t&&(Ne=Ne.substr(1),i[0].v="-"+i[0].v)),ze=Ne.length-1;var dt=i.length;for(u=0;u<i.length;++u)if(null!=i[u]&&"t"!=i[u].t&&i[u].v.indexOf(".")>-1){dt=u;break}var ft=i.length;if(dt===i.length&&-1===Ne.indexOf("E")){for(u=i.length-1;u>=0;--u)null==i[u]||-1==="n?".indexOf(i[u].t)||(ze>=i[u].v.length-1?i[u].v=Ne.substr(1+(ze-=i[u].v.length),i[u].v.length):ze<0?i[u].v="":(i[u].v=Ne.substr(0,ze+1),ze=-1),i[u].t="t",ft=u);ze>=0&&ft<i.length&&(i[ft].v=Ne.substr(0,ze+1)+i[ft].v)}else if(dt!==i.length&&-1===Ne.indexOf("E")){for(ze=Ne.indexOf(".")-1,u=dt;u>=0;--u)if(null!=i[u]&&-1!=="n?".indexOf(i[u].t)){for(D=i[u].v.indexOf(".")>-1&&u===dt?i[u].v.indexOf(".")-1:i[u].v.length-1,Je=i[u].v.substr(D+1);D>=0;--D)ze>=0&&("0"===i[u].v.charAt(D)||"#"===i[u].v.charAt(D))&&(Je=Ne.charAt(ze--)+Je);i[u].v=Je,i[u].t="t",ft=u}for(ze>=0&&ft<i.length&&(i[ft].v=Ne.substr(0,ze+1)+i[ft].v),ze=Ne.indexOf(".")+1,u=dt;u<i.length;++u)if(null!=i[u]&&(-1!=="n?(".indexOf(i[u].t)||u===dt)){for(D=i[u].v.indexOf(".")>-1&&u===dt?i[u].v.indexOf(".")+1:0,Je=i[u].v.substr(0,D);D<i[u].v.length;++D)ze<Ne.length&&(Je+=Ne.charAt(ze++));i[u].v=Je,i[u].t="t",ft=u}}}for(u=0;u<i.length;++u)null!=i[u]&&"n?".indexOf(i[u].t)>-1&&(i[u].v=Lg(i[u].t,i[u].v,ht=r>1&&n<0&&u>0&&"-"===i[u-1].v?-n:n),i[u].t="t");var kt="";for(u=0;u!==i.length;++u)null!=i[u]&&(kt+=i[u].v);return kt}(i[1],n,t,i[0])}function em(e,n){if("number"!=typeof n){n=+n||-1;for(var t=0;t<392;++t)if(null!=$r[t]){if($r[t]==e){n=t;break}}else n<0&&(n=t);n<0&&(n=391)}return $r[n]=e,n}function kS(e){for(var n=0;392!=n;++n)void 0!==e[n]&&em(e[n],n)}function _2(){$r=function Ese(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "',e}()}var fj=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g,Zse=function(){var e={version:"1.2.0"},t=function n(){for(var Ne=0,dt=new Array(256),ft=0;256!=ft;++ft)dt[ft]=Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=ft)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1;return typeof Int32Array<"u"?new Int32Array(dt):dt}(),i=function r(Ne){var dt=0,ft=0,kt=0,$t=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(kt=0;256!=kt;++kt)$t[kt]=Ne[kt];for(kt=0;256!=kt;++kt)for(ft=Ne[kt],dt=256+kt;dt<4096;dt+=256)ft=$t[dt]=ft>>>8^Ne[255&ft];var vt=[];for(kt=1;16!=kt;++kt)vt[kt-1]=typeof Int32Array<"u"?$t.subarray(256*kt,256*kt+256):$t.slice(256*kt,256*kt+256);return vt}(t),l=i[0],u=i[1],g=i[2],x=i[3],E=i[4],D=i[5],R=i[6],L=i[7],V=i[8],Y=i[9],G=i[10],Q=i[11],he=i[12],le=i[13],me=i[14];return e.table=t,e.bstr=function ze(Ne,dt){for(var ft=~dt,kt=0,$t=Ne.length;kt<$t;)ft=ft>>>8^t[255&(ft^Ne.charCodeAt(kt++))];return~ft},e.buf=function Je(Ne,dt){for(var ft=~dt,kt=Ne.length-15,$t=0;$t<kt;)ft=me[Ne[$t++]^255&ft]^le[Ne[$t++]^ft>>8&255]^he[Ne[$t++]^ft>>16&255]^Q[Ne[$t++]^ft>>>24]^G[Ne[$t++]]^Y[Ne[$t++]]^V[Ne[$t++]]^L[Ne[$t++]]^R[Ne[$t++]]^D[Ne[$t++]]^E[Ne[$t++]]^x[Ne[$t++]]^g[Ne[$t++]]^u[Ne[$t++]]^l[Ne[$t++]]^t[Ne[$t++]];for(kt+=15;$t<kt;)ft=ft>>>8^t[255&(ft^Ne[$t++])];return~ft},e.str=function ht(Ne,dt){for(var ft=~dt,kt=0,$t=Ne.length,vt=0,wn=0;kt<$t;)(vt=Ne.charCodeAt(kt++))<128?ft=ft>>>8^t[255&(ft^vt)]:vt<2048?ft=(ft=ft>>>8^t[255&(ft^(192|vt>>6&31))])>>>8^t[255&(ft^(128|63&vt))]:vt>=55296&&vt<57344?(vt=64+(1023&vt),wn=1023&Ne.charCodeAt(kt++),ft=(ft=(ft=(ft=ft>>>8^t[255&(ft^(240|vt>>8&7))])>>>8^t[255&(ft^(128|vt>>2&63))])>>>8^t[255&(ft^(128|wn>>6&15|(3&vt)<<4))])>>>8^t[255&(ft^(128|63&wn))]):ft=(ft=(ft=ft>>>8^t[255&(ft^(224|vt>>12&15))])>>>8^t[255&(ft^(128|vt>>6&63))])>>>8^t[255&(ft^(128|63&vt))];return~ft},e}(),Or=function(){var x,n={};function r(_e){if("/"==_e.charAt(_e.length-1))return-1===_e.slice(0,-1).indexOf("/")?_e:r(_e.slice(0,-1));var Ve=_e.lastIndexOf("/");return-1===Ve?_e:_e.slice(0,Ve+1)}function i(_e){if("/"==_e.charAt(_e.length-1))return i(_e.slice(0,-1));var Ve=_e.lastIndexOf("/");return-1===Ve?_e:_e.slice(Ve+1)}function l(_e,Ve){"string"==typeof Ve&&(Ve=new Date(Ve));var Ae=Ve.getHours();Ae=(Ae=Ae<<6|Ve.getMinutes())<<5|Ve.getSeconds()>>>1,_e.write_shift(2,Ae);var Re=Ve.getFullYear()-1980;Re=(Re=Re<<4|Ve.getMonth()+1)<<5|Ve.getDate(),_e.write_shift(2,Re)}function g(_e){tc(_e,0);for(var Ve={},Ae=0;_e.l<=_e.length-4;){var Re=_e.read_shift(2),je=_e.read_shift(2),He=_e.l+je,Lt={};21589===Re&&(1&(Ae=_e.read_shift(1))&&(Lt.mtime=_e.read_shift(4)),je>5&&(2&Ae&&(Lt.atime=_e.read_shift(4)),4&Ae&&(Lt.ctime=_e.read_shift(4))),Lt.mtime&&(Lt.mt=new Date(1e3*Lt.mtime))),_e.l=He,Ve[Re]=Lt}return Ve}function E(){return x||(x={})}function D(_e,Ve){if(80==_e[0]&&75==_e[1])return Cq(_e,Ve);if(109==(32|_e[0])&&105==(32|_e[1]))return function iAe(_e,Ve){if("mime-version:"!=Hn(_e.slice(0,13)).toLowerCase())throw new Error("Unsupported MAD header");var Ae=Ve&&Ve.root||"",Re=(Bi&&Buffer.isBuffer(_e)?_e.toString("binary"):Hn(_e)).split("\r\n"),je=0,He="";for(je=0;je<Re.length;++je)if(/^Content-Location:/i.test(He=Re[je])&&(He=He.slice(He.indexOf("file")),Ae||(Ae=He.slice(0,He.lastIndexOf("/")+1)),He.slice(0,Ae.length)!=Ae))for(;Ae.length>0&&(Ae=(Ae=Ae.slice(0,Ae.length-1)).slice(0,Ae.lastIndexOf("/")+1),He.slice(0,Ae.length)!=Ae););var Lt=(Re[1]||"").match(/boundary="(.*?)"/);if(!Lt)throw new Error("MAD cannot find boundary");var an="--"+(Lt[1]||""),qt={FileIndex:[],FullPaths:[]};Ne(qt);var In,Vn=0;for(je=0;je<Re.length;++je){var _r=Re[je];_r!==an&&_r!==an+"--"||(Vn++&&rAe(qt,Re.slice(In,je),Ae),In=je)}return qt}(_e,Ve);if(_e.length<512)throw new Error("CFB file size "+_e.length+" < 512");var Ae,je,He,Lt,an,jt,Re=512,Vt=[],qt=_e.slice(0,512);tc(qt,0);var In=function R(_e){if(80==_e[_e.l]&&75==_e[_e.l+1])return[0,0];_e.chk(Xn,"Header Signature: "),_e.l+=16;var Ve=_e.read_shift(2,"u");return[_e.read_shift(2,"u"),Ve]}(qt);switch(Ae=In[0]){case 3:Re=512;break;case 4:Re=4096;break;case 0:if(0==In[1])return Cq(_e,Ve);default:throw new Error("Major Version: Expected 3 or 4 saw "+Ae)}512!==Re&&tc(qt=_e.slice(0,Re),28);var Vn=_e.slice(0,Re);!function L(_e,Ve){var Ae;switch(_e.l+=2,Ae=_e.read_shift(2)){case 9:if(3!=Ve)throw new Error("Sector Shift: Expected 9 saw "+Ae);break;case 12:if(4!=Ve)throw new Error("Sector Shift: Expected 12 saw "+Ae);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Ae)}_e.chk("0600","Mini Sector Shift: "),_e.chk("000000000000","Reserved: ")}(qt,Ae);var _r=qt.read_shift(4,"i");if(3===Ae&&0!==_r)throw new Error("# Directory Sectors: Expected 0 saw "+_r);qt.l+=4,Lt=qt.read_shift(4,"i"),qt.l+=4,qt.chk("00100000","Mini Stream Cutoff Size: "),an=qt.read_shift(4,"i"),je=qt.read_shift(4,"i"),jt=qt.read_shift(4,"i"),He=qt.read_shift(4,"i");for(var jn=-1,Wn=0;Wn<109&&!((jn=qt.read_shift(4,"i"))<0);++Wn)Vt[Wn]=jn;var pi=function V(_e,Ve){for(var Ae=Math.ceil(_e.length/Ve)-1,Re=[],je=1;je<Ae;++je)Re[je-1]=_e.slice(je*Ve,(je+1)*Ve);return Re[Ae-1]=_e.slice(Ae*Ve),Re}(_e,Re);Q(jt,He,pi,Re,Vt);var vo=function le(_e,Ve,Ae,Re){var je=_e.length,He=[],Lt=[],an=[],jt=[],Vt=Re-1,qt=0,In=0,Vn=0,_r=0;for(qt=0;qt<je;++qt)if(an=[],(Vn=qt+Ve)>=je&&(Vn-=je),!Lt[Vn]){jt=[];var jn=[];for(In=Vn;In>=0;){jn[In]=!0,Lt[In]=!0,an[an.length]=In,jt.push(_e[In]);var Wn=Ae[Math.floor(4*In/Re)];if(Re<4+(_r=4*In&Vt))throw new Error("FAT boundary crossed: "+In+" 4 "+Re);if(!_e[Wn]||jn[In=Pv(_e[Wn],_r)])break}He[Vn]={nodes:an,data:Nj([jt])}}return He}(pi,Lt,Vt,Re);vo[Lt].name="!Directory",je>0&&an!==wn&&(vo[an].name="!MiniFAT"),vo[Vt[0]].name="!FAT",vo.fat_addrs=Vt,vo.ssz=Re;var Ka=[],Td=[],ID=[];(function me(_e,Ve,Ae,Re,je,He,Lt,an){for(var _r,jt=0,Vt=Re.length?2:0,qt=Ve[_e].data,In=0,Vn=0;In<qt.length;In+=128){var jn=qt.slice(In,In+128);tc(jn,64),Vn=jn.read_shift(2),_r=Vk(jn,0,Vn-Vt),Re.push(_r);var Wn={name:_r,type:jn.read_shift(1),color:jn.read_shift(1),L:jn.read_shift(4,"i"),R:jn.read_shift(4,"i"),C:jn.read_shift(4,"i"),clsid:jn.read_shift(16),state:jn.read_shift(4,"i"),start:0,size:0};0!==jn.read_shift(2)+jn.read_shift(2)+jn.read_shift(2)+jn.read_shift(2)&&(Wn.ct=ze(jn,jn.l-8)),0!==jn.read_shift(2)+jn.read_shift(2)+jn.read_shift(2)+jn.read_shift(2)&&(Wn.mt=ze(jn,jn.l-8)),Wn.start=jn.read_shift(4,"i"),Wn.size=jn.read_shift(4,"i"),Wn.size<0&&Wn.start<0&&(Wn.size=Wn.type=0,Wn.start=wn,Wn.name=""),5===Wn.type?(jt=Wn.start,je>0&&jt!==wn&&(Ve[jt].name="!StreamData")):Wn.size>=4096?(Wn.storage="fat",void 0===Ve[Wn.start]&&(Ve[Wn.start]=he(Ae,Wn.start,Ve.fat_addrs,Ve.ssz)),Ve[Wn.start].name=Wn.name,Wn.content=Ve[Wn.start].data.slice(0,Wn.size)):(Wn.storage="minifat",Wn.size<0?Wn.size=0:jt!==wn&&Wn.start!==wn&&Ve[jt]&&(Wn.content=G(Wn,Ve[jt].data,(Ve[an]||{}).data))),Wn.content&&tc(Wn.content,0),He[_r]=Wn,Lt.push(Wn)}})(Lt,vo,pi,Ka,je,{},Td,an),function Y(_e,Ve,Ae){for(var Re=0,je=0,He=0,Lt=0,an=0,jt=Ae.length,Vt=[],qt=[];Re<jt;++Re)Vt[Re]=qt[Re]=Re,Ve[Re]=Ae[Re];for(;an<qt.length;++an)je=_e[Re=qt[an]].L,He=_e[Re].R,Lt=_e[Re].C,Vt[Re]===Re&&(-1!==je&&Vt[je]!==je&&(Vt[Re]=Vt[je]),-1!==He&&Vt[He]!==He&&(Vt[Re]=Vt[He])),-1!==Lt&&(Vt[Lt]=Re),-1!==je&&Re!=Vt[Re]&&(Vt[je]=Vt[Re],qt.lastIndexOf(je)<an&&qt.push(je)),-1!==He&&Re!=Vt[Re]&&(Vt[He]=Vt[Re],qt.lastIndexOf(He)<an&&qt.push(He));for(Re=1;Re<jt;++Re)Vt[Re]===Re&&(-1!==He&&Vt[He]!==He?Vt[Re]=Vt[He]:-1!==je&&Vt[je]!==je&&(Vt[Re]=Vt[je]));for(Re=1;Re<jt;++Re)if(0!==_e[Re].type){if((an=Re)!=Vt[an])do{Ve[Re]=Ve[an=Vt[an]]+"/"+Ve[Re]}while(0!==an&&-1!==Vt[an]&&an!=Vt[an]);Vt[Re]=-1}for(Ve[0]+="/",Re=1;Re<jt;++Re)2!==_e[Re].type&&(Ve[Re]+="/")}(Td,ID,Ka),Ka.shift();var kD={FileIndex:Td,FullPaths:ID};return Ve&&Ve.raw&&(kD.raw={header:Vn,sectors:pi}),kD}function G(_e,Ve,Ae){for(var je=_e.size,He=[],Lt=_e.start;Ae&&je>0&&Lt>=0;)He.push(Ve.slice(Lt*vt,Lt*vt+vt)),je-=vt,Lt=Pv(Ae,4*Lt);return 0===He.length?nn(0):kl(He).slice(0,_e.size)}function Q(_e,Ve,Ae,Re,je){var He=wn;if(_e===wn){if(0!==Ve)throw new Error("DIFAT chain shorter than expected")}else if(-1!==_e){var Lt=Ae[_e],an=(Re>>>2)-1;if(!Lt)return;for(var jt=0;jt<an&&(He=Pv(Lt,4*jt))!==wn;++jt)je.push(He);Q(Pv(Lt,Re-4),Ve-1,Ae,Re,je)}}function he(_e,Ve,Ae,Re,je){var He=[],Lt=[];je||(je=[]);var an=Re-1,jt=0,Vt=0;for(jt=Ve;jt>=0;){je[jt]=!0,He[He.length]=jt,Lt.push(_e[jt]);var qt=Ae[Math.floor(4*jt/Re)];if(Re<4+(Vt=4*jt&an))throw new Error("FAT boundary crossed: "+jt+" 4 "+Re);if(!_e[qt])break;jt=Pv(_e[qt],Vt)}return{nodes:He,data:Nj([Lt])}}function ze(_e,Ve){return new Date(1e3*(Pl(_e,Ve+4)/1e7*Math.pow(2,32)+Pl(_e,Ve)/1e7-11644473600))}function Ne(_e,Ve){var Ae=Ve||{},Re=Ae.root||"Root Entry";if(_e.FullPaths||(_e.FullPaths=[]),_e.FileIndex||(_e.FileIndex=[]),_e.FullPaths.length!==_e.FileIndex.length)throw new Error("inconsistent CFB structure");0===_e.FullPaths.length&&(_e.FullPaths[0]=Re+"/",_e.FileIndex[0]={name:Re,type:5}),Ae.CLSID&&(_e.FileIndex[0].clsid=Ae.CLSID),function dt(_e){var Ve="\x01Sh33tJ5";if(!Or.find(_e,"/"+Ve)){var Ae=nn(4);Ae[0]=55,Ae[1]=Ae[3]=50,Ae[2]=54,_e.FileIndex.push({name:Ve,type:2,content:Ae,size:4,L:69,R:69,C:69}),_e.FullPaths.push(_e.FullPaths[0]+Ve),ft(_e)}}(_e)}function ft(_e,Ve){Ne(_e);for(var Ae=!1,Re=!1,je=_e.FullPaths.length-1;je>=0;--je){var He=_e.FileIndex[je];switch(He.type){case 0:Re?Ae=!0:(_e.FileIndex.pop(),_e.FullPaths.pop());break;case 1:case 2:case 5:Re=!0,isNaN(He.R*He.L*He.C)&&(Ae=!0),He.R>-1&&He.L>-1&&He.R==He.L&&(Ae=!0);break;default:Ae=!0}}if(Ae||Ve){var Lt=new Date(1987,1,19),an=0,jt=Object.create?Object.create(null):{},Vt=[];for(je=0;je<_e.FullPaths.length;++je)jt[_e.FullPaths[je]]=!0,0!==_e.FileIndex[je].type&&Vt.push([_e.FullPaths[je],_e.FileIndex[je]]);for(je=0;je<Vt.length;++je){var qt=r(Vt[je][0]);(Re=jt[qt])||(Vt.push([qt,{name:i(qt).replace("/",""),type:1,clsid:gr,ct:Lt,mt:Lt,content:null}]),jt[qt]=!0)}for(Vt.sort(function(_r,jn){return function t(_e,Ve){for(var Ae=_e.split("/"),Re=Ve.split("/"),je=0,He=0,Lt=Math.min(Ae.length,Re.length);je<Lt;++je){if(He=Ae[je].length-Re[je].length)return He;if(Ae[je]!=Re[je])return Ae[je]<Re[je]?-1:1}return Ae.length-Re.length}(_r[0],jn[0])}),_e.FullPaths=[],_e.FileIndex=[],je=0;je<Vt.length;++je)_e.FullPaths[je]=Vt[je][0],_e.FileIndex[je]=Vt[je][1];for(je=0;je<Vt.length;++je){var In=_e.FileIndex[je],Vn=_e.FullPaths[je];if(In.name=i(Vn).replace("/",""),In.L=In.R=In.C=-(In.color=1),In.size=In.content?In.content.length:0,In.start=0,In.clsid=In.clsid||gr,0===je)In.C=Vt.length>1?1:-1,In.size=0,In.type=5;else if("/"==Vn.slice(-1)){for(an=je+1;an<Vt.length&&r(_e.FullPaths[an])!=Vn;++an);for(In.C=an>=Vt.length?-1:an,an=je+1;an<Vt.length&&r(_e.FullPaths[an])!=r(Vn);++an);In.R=an>=Vt.length?-1:an,In.type=1}else r(_e.FullPaths[je+1]||"")==r(Vn)&&(In.R=je+1),In.type=2}}}function kt(_e,Ve){var Ae=Ve||{};if("mad"==Ae.fileType)return function sAe(_e,Ve){for(var Ae=Ve||{},Re=Ae.boundary||"SheetJS",je=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+(Re="------="+Re).slice(2)+'"',"","",""],He=_e.FullPaths[0],Lt=He,an=_e.FileIndex[0],jt=1;jt<_e.FullPaths.length;++jt)if(Lt=_e.FullPaths[jt].slice(He.length),(an=_e.FileIndex[jt]).size&&an.content&&"\x01Sh33tJ5"!=Lt){Lt=Lt.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(pi){return"_x"+pi.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(pi){return"_u"+pi.charCodeAt(0).toString(16)+"_"});for(var Vt=an.content,qt=Bi&&Buffer.isBuffer(Vt)?Vt.toString("binary"):Hn(Vt),In=0,Vn=Math.min(1024,qt.length),_r=0,jn=0;jn<=Vn;++jn)(_r=qt.charCodeAt(jn))>=32&&_r<128&&++In;var Wn=In>=4*Vn/5;je.push(Re),je.push("Content-Location: "+(Ae.root||"file:///C:/SheetJS/")+Lt),je.push("Content-Transfer-Encoding: "+(Wn?"quoted-printable":"base64")),je.push("Content-Type: "+QMe(an,Lt)),je.push(""),je.push(Wn?tAe(qt):eAe(qt))}return je.push(Re+"--\r\n"),je.join("\r\n")}(_e,Ae);if("zip"===(ft(_e),Ae.fileType))return function JMe(_e,Ve){var Ae=Ve||{},Re=[],je=[],He=nn(1),Lt=Ae.compression?8:0,an=0,Vt=0,qt=0,In=0,Vn=0,_r=_e.FullPaths[0],jn=_r,Wn=_e.FileIndex[0],pi=[],vo=0;for(Vt=1;Vt<_e.FullPaths.length;++Vt)if(jn=_e.FullPaths[Vt].slice(_r.length),(Wn=_e.FileIndex[Vt]).size&&Wn.content&&"\x01Sh33tJ5"!=jn){var Pu=In,Ka=nn(jn.length);for(qt=0;qt<jn.length;++qt)Ka.write_shift(1,127&jn.charCodeAt(qt));Ka=Ka.slice(0,Ka.l),pi[Vn]=Zse.buf(Wn.content,0);var Td=Wn.content;8==Lt&&(Td=st(Td)),(He=nn(30)).write_shift(4,67324752),He.write_shift(2,20),He.write_shift(2,an),He.write_shift(2,Lt),Wn.mt?l(He,Wn.mt):He.write_shift(4,0),He.write_shift(-4,8&an?0:pi[Vn]),He.write_shift(4,8&an?0:Td.length),He.write_shift(4,8&an?0:Wn.content.length),He.write_shift(2,Ka.length),He.write_shift(2,0),In+=He.length,Re.push(He),In+=Ka.length,Re.push(Ka),In+=Td.length,Re.push(Td),8&an&&((He=nn(12)).write_shift(-4,pi[Vn]),He.write_shift(4,Td.length),He.write_shift(4,Wn.content.length),In+=He.l,Re.push(He)),(He=nn(46)).write_shift(4,33639248),He.write_shift(2,0),He.write_shift(2,20),He.write_shift(2,an),He.write_shift(2,Lt),He.write_shift(4,0),He.write_shift(-4,pi[Vn]),He.write_shift(4,Td.length),He.write_shift(4,Wn.content.length),He.write_shift(2,Ka.length),He.write_shift(2,0),He.write_shift(2,0),He.write_shift(2,0),He.write_shift(2,0),He.write_shift(4,0),He.write_shift(4,Pu),vo+=He.l,je.push(He),vo+=Ka.length,je.push(Ka),++Vn}return(He=nn(22)).write_shift(4,101010256),He.write_shift(2,0),He.write_shift(2,0),He.write_shift(2,Vn),He.write_shift(2,Vn),He.write_shift(4,vo),He.write_shift(4,In),He.write_shift(2,0),kl([kl(Re),kl(je),He])}(_e,Ae);var Re=function(_r){for(var jn=0,Wn=0,pi=0;pi<_r.FileIndex.length;++pi){var vo=_r.FileIndex[pi];if(vo.content){var Pu=vo.content.length;Pu>0&&(Pu<4096?jn+=Pu+63>>6:Wn+=Pu+511>>9)}}for(var Ka=_r.FullPaths.length+3>>2,ID=jn+127>>7,kD=(jn+7>>3)+Wn+Ka+ID,hx=kD+127>>7,r5=hx<=109?0:Math.ceil((hx-109)/127);kD+hx+r5+127>>7>hx;)r5=++hx<=109?0:Math.ceil((hx-109)/127);var Xg=[1,r5,hx,ID,Ka,Wn,jn,0];return _r.FileIndex[0].size=jn<<6,Xg[7]=(_r.FileIndex[0].start=Xg[0]+Xg[1]+Xg[2]+Xg[3]+Xg[4]+Xg[5])+(Xg[6]+7>>3),Xg}(_e),je=nn(Re[7]<<9),He=0,Lt=0;for(He=0;He<8;++He)je.write_shift(1,Nn[He]);for(He=0;He<8;++He)je.write_shift(2,0);for(je.write_shift(2,62),je.write_shift(2,3),je.write_shift(2,65534),je.write_shift(2,9),je.write_shift(2,6),He=0;He<3;++He)je.write_shift(2,0);for(je.write_shift(4,0),je.write_shift(4,Re[2]),je.write_shift(4,Re[0]+Re[1]+Re[2]+Re[3]-1),je.write_shift(4,0),je.write_shift(4,4096),je.write_shift(4,Re[3]?Re[0]+Re[1]+Re[2]-1:wn),je.write_shift(4,Re[3]),je.write_shift(-4,Re[1]?Re[0]-1:wn),je.write_shift(4,Re[1]),He=0;He<109;++He)je.write_shift(-4,He<Re[2]?Re[1]+He:-1);if(Re[1])for(Lt=0;Lt<Re[1];++Lt){for(;He<236+127*Lt;++He)je.write_shift(-4,He<Re[2]?Re[1]+He:-1);je.write_shift(-4,Lt===Re[1]-1?wn:Lt+1)}var an=function(_r){for(Lt+=_r;He<Lt-1;++He)je.write_shift(-4,He+1);_r&&(++He,je.write_shift(-4,wn))};for(Lt=He=0,Lt+=Re[1];He<Lt;++He)je.write_shift(-4,Kn.DIFSECT);for(Lt+=Re[2];He<Lt;++He)je.write_shift(-4,Kn.FATSECT);an(Re[3]),an(Re[4]);for(var jt=0,Vt=0,qt=_e.FileIndex[0];jt<_e.FileIndex.length;++jt)(qt=_e.FileIndex[jt]).content&&!((Vt=qt.content.length)<4096)&&(qt.start=Lt,an(Vt+511>>9));for(an(Re[6]+7>>3);511&je.l;)je.write_shift(-4,Kn.ENDOFCHAIN);for(Lt=He=0,jt=0;jt<_e.FileIndex.length;++jt)(qt=_e.FileIndex[jt]).content&&(Vt=qt.content.length)&&!(Vt>=4096)&&(qt.start=Lt,an(Vt+63>>6));for(;511&je.l;)je.write_shift(-4,Kn.ENDOFCHAIN);for(He=0;He<Re[4]<<2;++He){var In=_e.FullPaths[He];if(In&&0!==In.length){qt=_e.FileIndex[He],0===He&&(qt.start=qt.size?qt.start-1:wn);var Vn=0===He&&Ae.root||qt.name;if(Vt=2*(Vn.length+1),je.write_shift(64,Vn,"utf16le"),je.write_shift(2,Vt),je.write_shift(1,qt.type),je.write_shift(1,qt.color),je.write_shift(-4,qt.L),je.write_shift(-4,qt.R),je.write_shift(-4,qt.C),qt.clsid)je.write_shift(16,qt.clsid,"hex");else for(jt=0;jt<4;++jt)je.write_shift(4,0);je.write_shift(4,qt.state||0),je.write_shift(4,0),je.write_shift(4,0),je.write_shift(4,0),je.write_shift(4,0),je.write_shift(4,qt.start),je.write_shift(4,qt.size),je.write_shift(4,0)}else{for(jt=0;jt<17;++jt)je.write_shift(4,0);for(jt=0;jt<3;++jt)je.write_shift(4,-1);for(jt=0;jt<12;++jt)je.write_shift(4,0)}}for(He=1;He<_e.FileIndex.length;++He)if((qt=_e.FileIndex[He]).size>=4096)if(je.l=qt.start+1<<9,Bi&&Buffer.isBuffer(qt.content))qt.content.copy(je,je.l,0,qt.size),je.l+=qt.size+511&-512;else{for(jt=0;jt<qt.size;++jt)je.write_shift(1,qt.content[jt]);for(;511&jt;++jt)je.write_shift(1,0)}for(He=1;He<_e.FileIndex.length;++He)if((qt=_e.FileIndex[He]).size>0&&qt.size<4096)if(Bi&&Buffer.isBuffer(qt.content))qt.content.copy(je,je.l,0,qt.size),je.l+=qt.size+63&-64;else{for(jt=0;jt<qt.size;++jt)je.write_shift(1,qt.content[jt]);for(;63&jt;++jt)je.write_shift(1,0)}if(Bi)je.l=je.length;else for(;je.l<je.length;)je.write_shift(1,0);return je}n.version="1.2.1";var mn,vt=64,wn=-2,Xn="d0cf11e0a1b11ae1",Nn=[208,207,17,224,161,177,26,225],gr="00000000000000000000000000000000",Kn={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:wn,FREESECT:-1,HEADER_SIGNATURE:Xn,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:gr,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Hn(_e){for(var Ve=new Array(_e.length),Ae=0;Ae<_e.length;++Ae)Ve[Ae]=String.fromCharCode(_e[Ae]);return Ve.join("")}function st(_e){return mn?mn.deflateRawSync(_e):$i(_e)}for(var _e,Ve,rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],on=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Gn=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],On=typeof Uint8Array<"u",gn=On?new Uint8Array(256):[],fi=0;fi<256;++fi)gn[fi]=(void 0,255&((Ve=139536&((_e=fi)<<1|_e<<11)|558144&(_e<<5|_e<<15))>>16|Ve>>8|Ve));function Xe(_e,Ve){var Ae=gn[255&_e];return Ve<=8?Ae>>>8-Ve:(Ae=Ae<<8|gn[_e>>8&255],Ve<=16?Ae>>>16-Ve:(Ae=Ae<<8|gn[_e>>16&255])>>>24-Ve)}function ms(_e,Ve){var Ae=7&Ve,Re=Ve>>>3;return(_e[Re]|(Ae<=6?0:_e[Re+1]<<8))>>>Ae&3}function zi(_e,Ve){var Ae=7&Ve,Re=Ve>>>3;return(_e[Re]|(Ae<=5?0:_e[Re+1]<<8))>>>Ae&7}function Ri(_e,Ve){var Ae=7&Ve,Re=Ve>>>3;return(_e[Re]|(Ae<=3?0:_e[Re+1]<<8))>>>Ae&31}function qn(_e,Ve){var Ae=7&Ve,Re=Ve>>>3;return(_e[Re]|(Ae<=1?0:_e[Re+1]<<8))>>>Ae&127}function zo(_e,Ve,Ae){var Re=7&Ve,je=Ve>>>3,Lt=_e[je]>>>Re;return Ae<8-Re||(Lt|=_e[je+1]<<8-Re,Ae<16-Re)||(Lt|=_e[je+2]<<16-Re,Ae<24-Re)||(Lt|=_e[je+3]<<24-Re),Lt&(1<<Ae)-1}function ku(_e,Ve,Ae){var Re=7&Ve,je=Ve>>>3;return Re<=5?_e[je]|=(7&Ae)<<Re:(_e[je]|=Ae<<Re&255,_e[je+1]=(7&Ae)>>8-Re),Ve+3}function Ll(_e,Ve,Ae){return _e[Ve>>>3]|=Ae=(1&Ae)<<(7&Ve),Ve+1}function Ou(_e,Ve,Ae){var je=Ve>>>3;return _e[je]|=255&(Ae<<=7&Ve),_e[je+1]=Ae>>>=8,Ve+8}function g1(_e,Ve,Ae){var je=Ve>>>3;return _e[je]|=255&(Ae<<=7&Ve),_e[je+1]=255&(Ae>>>=8),_e[je+2]=Ae>>>8,Ve+16}function Xf(_e,Ve){var Ae=_e.length,Re=2*Ae>Ve?2*Ae:Ve+5,je=0;if(Ae>=Ve)return _e;if(Bi){var He=XV(Re);if(_e.copy)_e.copy(He);else for(;je<_e.length;++je)He[je]=_e[je];return He}if(On){var Lt=new Uint8Array(Re);if(Lt.set)Lt.set(_e);else for(;je<Ae;++je)Lt[je]=_e[je];return Lt}return _e.length=Re,_e}function ic(_e){for(var Ve=new Array(_e),Ae=0;Ae<_e;++Ae)Ve[Ae]=0;return Ve}function Vh(_e,Ve,Ae){var Re=1,je=0,He=0,Lt=0,an=0,jt=_e.length,Vt=On?new Uint16Array(32):ic(32);for(He=0;He<32;++He)Vt[He]=0;for(He=jt;He<Ae;++He)_e[He]=0;jt=_e.length;var qt=On?new Uint16Array(jt):ic(jt);for(He=0;He<jt;++He)Vt[je=_e[He]]++,Re<je&&(Re=je),qt[He]=0;for(Vt[0]=0,He=1;He<=Re;++He)Vt[He+16]=an=an+Vt[He-1]<<1;for(He=0;He<jt;++He)0!=(an=_e[He])&&(qt[He]=Vt[an+16]++);var In=0;for(He=0;He<jt;++He)if(0!=(In=_e[He]))for(an=Xe(qt[He],Re)>>Re-In,Lt=(1<<Re+4-In)-1;Lt>=0;--Lt)Ve[an|Lt<<In]=15&In|He<<4;return Re}var Yf=On?new Uint16Array(512):ic(512),_1=On?new Uint16Array(32):ic(32);if(!On){for(var Bl=0;Bl<512;++Bl)Yf[Bl]=0;for(Bl=0;Bl<32;++Bl)_1[Bl]=0}!function(){for(var _e=[],Ve=0;Ve<32;Ve++)_e.push(5);Vh(_e,_1,32);var Ae=[];for(Ve=0;Ve<=143;Ve++)Ae.push(8);for(;Ve<=255;Ve++)Ae.push(9);for(;Ve<=279;Ve++)Ae.push(7);for(;Ve<=287;Ve++)Ae.push(8);Vh(Ae,Yf,288)}();var dm=function(){for(var Ve=On?new Uint8Array(32768):[],Ae=0,Re=0;Ae<Gn.length-1;++Ae)for(;Re<Gn[Ae+1];++Re)Ve[Re]=Ae;for(;Re<32768;++Re)Ve[Re]=29;var je=On?new Uint8Array(259):[];for(Ae=0,Re=0;Ae<on.length-1;++Ae)for(;Re<on[Ae+1];++Re)je[Re]=Ae;return function(jt,Vt){return jt.length<8?function He(an,jt){for(var Vt=0;Vt<an.length;){var qt=Math.min(65535,an.length-Vt);for(jt.write_shift(1,+(Vt+qt==an.length)),jt.write_shift(2,qt),jt.write_shift(2,65535&~qt);qt-- >0;)jt[jt.l++]=an[Vt++]}return jt.l}(jt,Vt):function Lt(an,jt){for(var Vt=0,qt=0,In=On?new Uint16Array(32768):[];qt<an.length;){var Vn=Math.min(65535,an.length-qt);if(Vn<10){for(7&(Vt=ku(jt,Vt,+(qt+Vn==an.length)))&&(Vt+=8-(7&Vt)),jt.l=Vt/8|0,jt.write_shift(2,Vn),jt.write_shift(2,65535&~Vn);Vn-- >0;)jt[jt.l++]=an[qt++];Vt=8*jt.l}else{Vt=ku(jt,Vt,+(qt+Vn==an.length)+2);for(var _r=0;Vn-- >0;){var jn=an[qt],Wn=-1,pi=0;if((Wn=In[_r=32767&(_r<<5^jn)])&&((Wn|=-32768&qt)>qt&&(Wn-=32768),Wn<qt))for(;an[Wn+pi]==an[qt+pi]&&pi<250;)++pi;if(pi>2){(jn=je[pi])<=22?Vt=Ou(jt,Vt,gn[jn+1]>>1)-1:(Ou(jt,Vt,3),Ou(jt,Vt+=5,gn[jn-23]>>5),Vt+=3);var vo=jn<8?0:jn-4>>2;vo>0&&(g1(jt,Vt,pi-on[jn]),Vt+=vo),Vt=Ou(jt,Vt,gn[jn=Ve[qt-Wn]]>>3),Vt-=3;var Pu=jn<4?0:jn-2>>1;Pu>0&&(g1(jt,Vt,qt-Wn-Gn[jn]),Vt+=Pu);for(var Ka=0;Ka<pi;++Ka)In[_r]=32767&qt,_r=32767&(_r<<5^an[qt]),++qt;Vn-=pi-1}else jn<=143?jn+=48:Vt=Ll(jt,Vt,1),Vt=Ou(jt,Vt,gn[jn]),In[_r]=32767&qt,++qt}Vt=Ou(jt,Vt,0)-1}}return jt.l=(Vt+7)/8|0,jt.l}(jt,Vt)}}();function $i(_e){var Ve=nn(50+Math.floor(1.1*_e.length)),Ae=dm(_e,Ve);return Ve.slice(0,Ae)}var Ca=On?new Uint16Array(32768):ic(32768),jh=On?new Uint16Array(32768):ic(32768),cl=On?new Uint16Array(128):ic(128),dx=1,wq=1;function XMe(_e,Ve){var Ae=Ri(_e,Ve)+257,Re=Ri(_e,Ve+=5)+1,je=function Ts(_e,Ve){var Ae=7&Ve,Re=Ve>>>3;return(_e[Re]|(Ae<=4?0:_e[Re+1]<<8))>>>Ae&15}(_e,Ve+=5)+4;Ve+=4;for(var He=0,Lt=On?new Uint8Array(19):ic(19),an=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],jt=1,Vt=On?new Uint8Array(8):ic(8),qt=On?new Uint8Array(8):ic(8),In=Lt.length,Vn=0;Vn<je;++Vn)Lt[rt[Vn]]=He=zi(_e,Ve),jt<He&&(jt=He),Vt[He]++,Ve+=3;var _r=0;for(Vt[0]=0,Vn=1;Vn<=jt;++Vn)qt[Vn]=_r=_r+Vt[Vn-1]<<1;for(Vn=0;Vn<In;++Vn)0!=(_r=Lt[Vn])&&(an[Vn]=qt[_r]++);var jn=0;for(Vn=0;Vn<In;++Vn)if(0!=(jn=Lt[Vn])){_r=gn[an[Vn]]>>8-jn;for(var Wn=(1<<7-jn)-1;Wn>=0;--Wn)cl[_r|Wn<<jn]=7&jn|Vn<<3}var pi=[];for(jt=1;pi.length<Ae+Re;)switch(_r=cl[qn(_e,Ve)],Ve+=7&_r,_r>>>=3){case 16:for(He=3+ms(_e,Ve),Ve+=2,_r=pi[pi.length-1];He-- >0;)pi.push(_r);break;case 17:for(He=3+zi(_e,Ve),Ve+=3;He-- >0;)pi.push(0);break;case 18:for(He=11+qn(_e,Ve),Ve+=7;He-- >0;)pi.push(0);break;default:pi.push(_r),jt<_r&&(jt=_r)}var vo=pi.slice(0,Ae),Pu=pi.slice(Ae);for(Vn=Ae;Vn<286;++Vn)vo[Vn]=0;for(Vn=Re;Vn<30;++Vn)Pu[Vn]=0;return dx=Vh(vo,Ca,286),wq=Vh(Pu,jh,30),Ve}function Tq(_e,Ve){var Re=function YMe(_e,Ve){if(3==_e[0]&&!(3&_e[1]))return[W0(Ve),2];for(var Ae=0,Re=0,je=XV(Ve||1<<18),He=0,Lt=je.length>>>0,an=0,jt=0;!(1&Re);)if(Re=zi(_e,Ae),Ae+=3,Re>>>1)for(Re>>1==1?(an=9,jt=5):(Ae=XMe(_e,Ae),an=dx,jt=wq);;){!Ve&&Lt<He+32767&&(Lt=(je=Xf(je,He+32767)).length);var qt=zo(_e,Ae,an),In=Re>>>1==1?Yf[qt]:Ca[qt];if(Ae+=15&In,(In>>>=4)>>>8&255){if(256==In)break;var Vn=(In-=257)<8?0:In-4>>2;Vn>5&&(Vn=0);var _r=He+on[In];Vn>0&&(_r+=zo(_e,Ae,Vn),Ae+=Vn),qt=zo(_e,Ae,jt),Ae+=15&(In=Re>>>1==1?_1[qt]:jh[qt]);var jn=(In>>>=4)<4?0:In-2>>1,Wn=Gn[In];for(jn>0&&(Wn+=zo(_e,Ae,jn),Ae+=jn),!Ve&&Lt<_r&&(Lt=(je=Xf(je,_r+100)).length);He<_r;)je[He]=je[He-Wn],++He}else je[He++]=In}else{7&Ae&&(Ae+=8-(7&Ae));var Vt=_e[Ae>>>3]|_e[1+(Ae>>>3)]<<8;if(Ae+=32,Vt>0)for(!Ve&&Lt<He+Vt&&(Lt=(je=Xf(je,He+Vt)).length);Vt-- >0;)je[He++]=_e[Ae>>>3],Ae+=8}return Ve?[je,Ae+7>>>3]:[je.slice(0,He),Ae+7>>>3]}(_e.slice(_e.l||0),Ve);return _e.l+=Re[1],Re[0]}function Eq(_e,Ve){if(!_e)throw new Error(Ve);typeof console<"u"&&console.error(Ve)}function Cq(_e,Ve){var Ae=_e;tc(Ae,0);var He={FileIndex:[],FullPaths:[]};Ne(He,{root:Ve.root});for(var Lt=Ae.length-4;(80!=Ae[Lt]||75!=Ae[Lt+1]||5!=Ae[Lt+2]||6!=Ae[Lt+3])&&Lt>=0;)--Lt;Ae.l=Lt+4,Ae.l+=4;var an=Ae.read_shift(2);Ae.l+=6;var jt=Ae.read_shift(4);for(Ae.l=jt,Lt=0;Lt<an;++Lt){Ae.l+=20;var Vt=Ae.read_shift(4),qt=Ae.read_shift(4),In=Ae.read_shift(2),Vn=Ae.read_shift(2),_r=Ae.read_shift(2);Ae.l+=8;var jn=Ae.read_shift(4),Wn=g(Ae.slice(Ae.l+In,Ae.l+In+Vn));Ae.l+=In+Vn+_r;var pi=Ae.l;Ae.l=jn+4,KMe(Ae,Vt,qt,He,Wn),Ae.l=pi}return He}function KMe(_e,Ve,Ae,Re,je){_e.l+=2;var He=_e.read_shift(2),Lt=_e.read_shift(2),an=function u(_e){var Ve=65535&_e.read_shift(2),Ae=65535&_e.read_shift(2),Re=new Date,je=31&Ae,He=15&(Ae>>>=5);Ae>>>=4,Re.setMilliseconds(0),Re.setFullYear(Ae+1980),Re.setMonth(He-1),Re.setDate(je);var Lt=31&Ve,an=63&(Ve>>>=5);return Re.setHours(Ve>>>=6),Re.setMinutes(an),Re.setSeconds(Lt<<1),Re}(_e);if(8257&He)throw new Error("Unsupported ZIP encryption");_e.read_shift(4);for(var Vt=_e.read_shift(4),qt=_e.read_shift(4),In=_e.read_shift(2),Vn=_e.read_shift(2),_r="",jn=0;jn<In;++jn)_r+=String.fromCharCode(_e[_e.l++]);if(Vn){var Wn=g(_e.slice(_e.l,_e.l+Vn));(Wn[21589]||{}).mt&&(an=Wn[21589].mt),((je||{})[21589]||{}).mt&&(an=je[21589].mt)}_e.l+=Vn;var pi=_e.slice(_e.l,_e.l+Vt);switch(Lt){case 8:pi=function Nt(_e,Ve){if(!mn)return Tq(_e,Ve);var Re=new(0,mn.InflateRaw),je=Re._processChunk(_e.slice(_e.l),Re._finishFlushFlag);return _e.l+=Re.bytesRead,je}(_e,qt);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Lt)}var vo=!1;8&He&&(134695760==_e.read_shift(4)&&(_e.read_shift(4),vo=!0),Vt=_e.read_shift(4),qt=_e.read_shift(4)),Vt!=Ve&&Eq(vo,"Bad compressed size: "+Ve+" != "+Vt),qt!=Ae&&Eq(vo,"Bad uncompressed size: "+Ae+" != "+qt),n5(Re,_r,pi,{unsafe:!0,mt:an})}var mP={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function QMe(_e,Ve){if(_e.ctype)return _e.ctype;var Ae=_e.name||"",Re=Ae.match(/\.([^\.]+)$/);return Re&&mP[Re[1]]||Ve&&(Re=(Ae=Ve).match(/[\.\\]([^\.\\])+$/))&&mP[Re[1]]?mP[Re[1]]:"application/octet-stream"}function eAe(_e){for(var Ve=DS(_e),Ae=[],Re=0;Re<Ve.length;Re+=76)Ae.push(Ve.slice(Re,Re+76));return Ae.join("\r\n")+"\r\n"}function tAe(_e){var Ve=_e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Vt){var qt=Vt.charCodeAt(0).toString(16).toUpperCase();return"="+(1==qt.length?"0"+qt:qt)});"\n"==(Ve=Ve.replace(/ $/gm,"=20").replace(/\t$/gm,"=09")).charAt(0)&&(Ve="=0D"+Ve.slice(1));for(var Ae=[],Re=(Ve=Ve.replace(/\r(?!\n)/gm,"=0D").replace(/\n\n/gm,"\n=0A").replace(/([^\r\n])\n/gm,"$1=0A")).split("\r\n"),je=0;je<Re.length;++je){var He=Re[je];if(0!=He.length)for(var Lt=0;Lt<He.length;){var an=76,jt=He.slice(Lt,Lt+an);"="==jt.charAt(an-1)?an--:"="==jt.charAt(an-2)?an-=2:"="==jt.charAt(an-3)&&(an-=3),jt=He.slice(Lt,Lt+an),(Lt+=an)<He.length&&(jt+="="),Ae.push(jt)}else Ae.push("")}return Ae.join("\r\n")}function rAe(_e,Ve,Ae){for(var Lt,Re="",je="",He="",an=0;an<10;++an){var jt=Ve[an];if(!jt||jt.match(/^\s*$/))break;var Vt=jt.match(/^(.*?):\s*([^\s].*)$/);if(Vt)switch(Vt[1].toLowerCase()){case"content-location":Re=Vt[2].trim();break;case"content-type":He=Vt[2].trim();break;case"content-transfer-encoding":je=Vt[2].trim()}}switch(++an,je.toLowerCase()){case"base64":Lt=fd(hd(Ve.slice(an).join("")));break;case"quoted-printable":Lt=function nAe(_e){for(var Ve=[],Ae=0;Ae<_e.length;++Ae){for(var Re=_e[Ae];Ae<=_e.length&&"="==Re.charAt(Re.length-1);)Re=Re.slice(0,Re.length-1)+_e[++Ae];Ve.push(Re)}for(var je=0;je<Ve.length;++je)Ve[je]=Ve[je].replace(/[=][0-9A-Fa-f]{2}/g,function(He){return String.fromCharCode(parseInt(He.slice(1),16))});return fd(Ve.join("\r\n"))}(Ve.slice(an));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+je)}var qt=n5(_e,Re.slice(Ae.length),Lt,{unsafe:!0});He&&(qt.ctype=He)}function n5(_e,Ve,Ae,Re){var je=Re&&Re.unsafe;je||Ne(_e);var He=!je&&Or.find(_e,Ve);if(!He){var Lt=_e.FullPaths[0];Ve.slice(0,Lt.length)==Lt?Lt=Ve:("/"!=Lt.slice(-1)&&(Lt+="/"),Lt=(Lt+Ve).replace("//","/")),He={name:i(Ve),type:2},_e.FileIndex.push(He),_e.FullPaths.push(Lt),je||Or.utils.cfb_gc(_e)}return He.content=Ae,He.size=Ae?Ae.length:0,Re&&(Re.CLSID&&(He.clsid=Re.CLSID),Re.mt&&(He.mt=Re.mt),Re.ct&&(He.ct=Re.ct)),He}return n.find=function $t(_e,Ve){var Ae=_e.FullPaths.map(function(jt){return jt.toUpperCase()}),Re=Ae.map(function(jt){var Vt=jt.split("/");return Vt[Vt.length-("/"==jt.slice(-1)?2:1)]}),je=!1;47===Ve.charCodeAt(0)?(je=!0,Ve=Ae[0].slice(0,-1)+Ve):je=-1!==Ve.indexOf("/");var He=Ve.toUpperCase(),Lt=!0===je?Ae.indexOf(He):Re.indexOf(He);if(-1!==Lt)return _e.FileIndex[Lt];var an=!He.match(AS);for(He=He.replace(bc,""),an&&(He=He.replace(AS,"!")),Lt=0;Lt<Ae.length;++Lt)if((an?Ae[Lt].replace(AS,"!"):Ae[Lt]).replace(bc,"")==He||(an?Re[Lt].replace(AS,"!"):Re[Lt]).replace(bc,"")==He)return _e.FileIndex[Lt];return null},n.read=function ht(_e,Ve){var Ae=Ve&&Ve.type;switch(Ae||Bi&&Buffer.isBuffer(_e)&&(Ae="buffer"),Ae||"base64"){case"file":return function Je(_e,Ve){return E(),D(x.readFileSync(_e),Ve)}(_e,Ve);case"base64":return D(fd(hd(_e)),Ve);case"binary":return D(fd(_e),Ve)}return D(_e,Ve)},n.parse=D,n.write=function Nr(_e,Ve){var Ae=kt(_e,Ve);switch(Ve&&Ve.type||"buffer"){case"file":return E(),x.writeFileSync(Ve.filename,Ae),Ae;case"binary":return"string"==typeof Ae?Ae:Hn(Ae);case"base64":return DS("string"==typeof Ae?Ae:Hn(Ae));case"buffer":if(Bi)return Buffer.isBuffer(Ae)?Ae:Fg(Ae);case"array":return"string"==typeof Ae?fd(Ae):Ae}return Ae},n.writeFile=function Si(_e,Ve,Ae){E();var Re=kt(_e,Ae);x.writeFileSync(Ve,Re)},n.utils={cfb_new:function oAe(_e){var Ve={};return Ne(Ve,_e),Ve},cfb_add:n5,cfb_del:function aAe(_e,Ve){Ne(_e);var Ae=Or.find(_e,Ve);if(Ae)for(var Re=0;Re<_e.FileIndex.length;++Re)if(_e.FileIndex[Re]==Ae)return _e.FileIndex.splice(Re,1),_e.FullPaths.splice(Re,1),!0;return!1},cfb_mov:function lAe(_e,Ve,Ae){Ne(_e);var Re=Or.find(_e,Ve);if(Re)for(var je=0;je<_e.FileIndex.length;++je)if(_e.FileIndex[je]==Re)return _e.FileIndex[je].name=i(Ae),_e.FullPaths[je]=Ae,!0;return!1},cfb_gc:function cAe(_e){ft(_e,!0)},ReadShift:FS,CheckField:qj,prep_blob:tc,bconcat:kl,use_zlib:function Ye(_e){try{var Ae=new(0,_e.InflateRaw);if(Ae._processChunk(new Uint8Array([3,0]),Ae._finishFlushFlag),!Ae.bytesRead)throw new Error("zlib does not expose bytesRead");mn=_e}catch(Re){console.error("cannot use native zlib: "+(Re.message||Re))}},_deflateRaw:$i,_inflateRaw:Tq,consts:Kn},n}();let Y0;function Xse(e){return"string"==typeof e?MS(e):Array.isArray(e)?function xse(e){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(e)}(e):e}function OS(e,n,t){if(typeof Y0<"u"&&Y0.writeFileSync)return t?Y0.writeFileSync(e,n,t):Y0.writeFileSync(e,n);if(typeof Deno<"u"){if(t&&"string"==typeof n)switch(t){case"utf8":n=new TextEncoder(t).encode(n);break;case"binary":n=MS(n);break;default:throw new Error("Unsupported encoding "+t)}return Deno.writeFileSync(e,n)}var r="utf8"==t?nm(n):n;if(typeof IE_SaveFile<"u")return IE_SaveFile(r,e);if(typeof Blob<"u"){var i=new Blob([Xse(r)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(i,e);if(typeof saveAs<"u")return saveAs(i,e);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var l=URL.createObjectURL(i);if("object"==typeof chrome&&"function"==typeof(chrome.downloads||{}).download)return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(l)},6e4),chrome.downloads.download({url:l,filename:e,saveAs:!0});var u=document.createElement("a");if(null!=u.download)return u.download=e,u.href=l,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(l)},6e4),l}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var g=File(e);return g.open("w"),g.encoding="binary",Array.isArray(n)&&(n=q0(n)),g.write(n),g.close(),n}catch(x){if(!x.message||!x.message.match(/onstruct/))throw x}throw new Error("cannot save file "+e)}function ea(e){for(var n=Object.keys(e),t=[],r=0;r<n.length;++r)Object.prototype.hasOwnProperty.call(e,n[r])&&t.push(n[r]);return t}function pj(e,n){for(var t=[],r=ea(e),i=0;i!==r.length;++i)null==t[e[r[i]][n]]&&(t[e[r[i]][n]]=r[i]);return t}function Lk(e){for(var n=[],t=ea(e),r=0;r!==t.length;++r)n[e[t[r]]]=t[r];return n}function Bk(e){for(var n=[],t=ea(e),r=0;r!==t.length;++r)n[e[t[r]]]=parseInt(t[r],10);return n}var zk=new Date(1899,11,30,0,0,0);function Ol(e,n){var t=e.getTime();return n&&(t-=1263168e5),(t-(zk.getTime()+6e4*(e.getTimezoneOffset()-zk.getTimezoneOffset())))/864e5}var mj=new Date,Jse=zk.getTime()+6e4*(mj.getTimezoneOffset()-zk.getTimezoneOffset()),gj=mj.getTimezoneOffset();function cF(e){var n=new Date;return n.setTime(24*e*60*60*1e3+Jse),n.getTimezoneOffset()!==gj&&n.setTime(n.getTime()+6e4*(n.getTimezoneOffset()-gj)),n}var _j=new Date("2017-02-19T19:06:09.000Z"),yj=isNaN(_j.getFullYear())?new Date("2/19/17"):_j,eoe=2017==yj.getFullYear();function Lo(e,n){var t=new Date(e);if(eoe)return n>0?t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3):n<0&&t.setTime(t.getTime()-60*t.getTimezoneOffset()*1e3),t;if(e instanceof Date)return e;if(1917==yj.getFullYear()&&!isNaN(t.getFullYear())){var r=t.getFullYear();return e.indexOf(""+r)>-1||t.setFullYear(t.getFullYear()+100),t}var i=e.match(/\d+/g)||["2017","2","19","0","0","0"],l=new Date(+i[0],+i[1]-1,+i[2],+i[3]||0,+i[4]||0,+i[5]||0);return e.indexOf("Z")>-1&&(l=new Date(l.getTime()-60*l.getTimezoneOffset()*1e3)),l}function Ov(e,n){if(Bi&&Buffer.isBuffer(e)){if(n){if(255==e[0]&&254==e[1])return nm(e.slice(2).toString("utf16le"));if(254==e[1]&&255==e[2])return nm(function ZV(e){for(var n=[],t=0;t<e.length>>1;++t)n[t]=String.fromCharCode(e.charCodeAt(2*t+1)+(e.charCodeAt(2*t)<<8));return n.join("")}(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(n){if(255==e[0]&&254==e[1])return nm(new TextDecoder("utf-16le").decode(e.slice(2)));if(254==e[0]&&255==e[1])return nm(new TextDecoder("utf-16be").decode(e.slice(2)))}var t={"\u20ac":"\x80","\u201a":"\x82",\u0192:"\x83","\u201e":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87",\u02c6:"\x88","\u2030":"\x89",\u0160:"\x8a","\u2039":"\x8b",\u0152:"\x8c",\u017d:"\x8e","\u2018":"\x91","\u2019":"\x92","\u201c":"\x93","\u201d":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02dc":"\x98","\u2122":"\x99",\u0161:"\x9a","\u203a":"\x9b",\u0153:"\x9c",\u017e:"\x9e",\u0178:"\x9f"};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[\u20ac\u201a\u0192\u201e\u2026\u2020\u2021\u02c6\u2030\u0160\u2039\u0152\u017d\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u02dc\u2122\u0161\u203a\u0153\u017e\u0178]/g,function(l){return t[l]||l})}catch{}for(var r=[],i=0;i!=e.length;++i)r.push(String.fromCharCode(e[i]));return r.join("")}function Qs(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if("object"!=typeof e||null==e)return e;if(e instanceof Date)return new Date(e.getTime());var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=Qs(e[t]));return n}function ta(e,n){for(var t="";t.length<n;)t+=e;return t}function Hf(e){var n=Number(e);if(!isNaN(n))return isFinite(n)?n:NaN;if(!/\d/.test(e))return n;var t=1,r=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return t*=100,""});return isNaN(n=Number(r))&&(r=r.replace(/[(](.*)[)]/,function(i,l){return t=-t,l}),isNaN(n=Number(r)))?n:n/t}var toe=["january","february","march","april","may","june","july","august","september","october","november","december"];function y2(e){var n=new Date(e),t=new Date(NaN),r=n.getYear(),i=n.getMonth(),l=n.getDate();if(isNaN(l))return t;var u=e.toLowerCase();if(u.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if((u=u.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,"")).length>3&&-1==toe.indexOf(u))return t}else if(u.match(/[a-z]/))return t;return r<0||r>8099?t:(i>0||l>1)&&101!=r?n:e.match(/[^-0-9:,\/\\]/)?t:n}function Ii(e,n,t){if(e.FullPaths){var r;if("string"==typeof t)return r=Bi?Fg(t):function bse(e){for(var n=[],t=0,r=e.length+250,i=W0(e.length+255),l=0;l<e.length;++l){var u=e.charCodeAt(l);if(u<128)i[t++]=u;else if(u<2048)i[t++]=192|u>>6&31,i[t++]=128|63&u;else if(u>=55296&&u<57344){u=64+(1023&u);var g=1023&e.charCodeAt(++l);i[t++]=240|u>>8&7,i[t++]=128|u>>2&63,i[t++]=128|g>>6&15|(3&u)<<4,i[t++]=128|63&g}else i[t++]=224|u>>12&15,i[t++]=128|u>>6&63,i[t++]=128|63&u;t>r&&(n.push(i.slice(0,t)),t=0,i=W0(65535),r=65530)}return n.push(i.slice(0,t)),kl(n)}(t),Or.utils.cfb_add(e,n,r);Or.utils.cfb_add(e,n,t)}else e.file(n,t)}function dF(){return Or.utils.cfb_new()}var na='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n',hF=Lk({"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"}),fF=/[&<>'"]/g,coe=/[\u0000-\u0008\u000b-\u001f]/g;function Rs(e){return(e+"").replace(fF,function(t){return hF[t]}).replace(coe,function(t){return"_x"+("000"+t.charCodeAt(0).toString(16)).slice(-4)+"_"})}function Cj(e){return Rs(e).replace(/ /g,"_x0020_")}var Sj=/[\u0000-\u001f]/g;function Dj(e){return(e+"").replace(fF,function(t){return hF[t]}).replace(/\n/g,"<br/>").replace(Sj,function(t){return"&#x"+("000"+t.charCodeAt(0).toString(16)).slice(-4)+";"})}function pF(e){for(var n="",t=0,r=0,i=0,l=0,u=0,g=0;t<e.length;)(r=e.charCodeAt(t++))<128?n+=String.fromCharCode(r):(i=e.charCodeAt(t++),r>191&&r<224?(u=(31&r)<<6,u|=63&i,n+=String.fromCharCode(u)):(l=e.charCodeAt(t++),r<240?n+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&l):(g=((7&r)<<18|(63&i)<<12|(63&l)<<6|63&(u=e.charCodeAt(t++)))-65536,n+=String.fromCharCode(55296+(g>>>10&1023)),n+=String.fromCharCode(56320+(1023&g)))));return n}function Aj(e){var t,r,g,n=W0(2*e.length),i=1,l=0,u=0;for(r=0;r<e.length;r+=i)i=1,(g=e.charCodeAt(r))<128?t=g:g<224?(t=64*(31&g)+(63&e.charCodeAt(r+1)),i=2):g<240?(t=4096*(15&g)+64*(63&e.charCodeAt(r+1))+(63&e.charCodeAt(r+2)),i=3):(i=4,t=262144*(7&g)+4096*(63&e.charCodeAt(r+1))+64*(63&e.charCodeAt(r+2))+(63&e.charCodeAt(r+3)),u=55296+((t-=65536)>>>10&1023),t=56320+(1023&t)),0!==u&&(n[l++]=255&u,n[l++]=u>>>8,u=0),n[l++]=t%256,n[l++]=t>>>8;return n.slice(0,l).toString("ucs2")}function Ij(e){return Fg(e,"binary").toString("utf8")}var Uk="foo bar baz\xe2\x98\x83\xf0\x9f\x8d\xa3",_o=Bi&&(Ij(Uk)==pF(Uk)&&Ij||Aj(Uk)==pF(Uk)&&Aj)||pF,nm=Bi?function(e){return Fg(e,"utf8").toString("binary")}:function(e){for(var n=[],t=0,r=0,i=0;t<e.length;)switch(r=e.charCodeAt(t++),!0){case r<128:n.push(String.fromCharCode(r));break;case r<2048:n.push(String.fromCharCode(192+(r>>6))),n.push(String.fromCharCode(128+(63&r)));break;case r>=55296&&r<57344:r-=55296,i=e.charCodeAt(t++)-56320+(r<<10),n.push(String.fromCharCode(240+(i>>18&7))),n.push(String.fromCharCode(144+(i>>12&63))),n.push(String.fromCharCode(128+(i>>6&63))),n.push(String.fromCharCode(128+(63&i)));break;default:n.push(String.fromCharCode(224+(r>>12))),n.push(String.fromCharCode(128+(r>>6&63))),n.push(String.fromCharCode(128+(63&r)))}return n.join("")},Pj=/(^\s|\s$|\n)/;function ec(e,n){return"<"+e+(n.match(Pj)?' xml:space="preserve"':"")+">"+n+"</"+e+">"}function RS(e){return ea(e).map(function(n){return" "+n+'="'+e[n]+'"'}).join("")}function Fn(e,n,t){return"<"+e+(null!=t?RS(t):"")+(null!=n?(n.match(Pj)?' xml:space="preserve"':"")+">"+n+"</"+e:"/")+">"}function mF(e,n){try{return e.toISOString().replace(/\.\d*/,"")}catch(t){if(n)throw t}return""}var qa={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},K0=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],gd={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"},Rj=function(e){for(var n=[],r=0;r<e[0].length;++r)if(e[0][r])for(var i=0,l=e[0][r].length;i<l;i+=10240)n.push.apply(n,e[0][r].slice(i,i+10240));return n},Nj=Bi?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(n){return Buffer.isBuffer(n)?n:Fg(n)})):Rj(e)}:Rj,Fj=function(e,n,t){for(var r=[],i=n;i<t;i+=2)r.push(String.fromCharCode(Bg(e,i)));return r.join("").replace(bc,"")},Vk=Bi?function(e,n,t){return Buffer.isBuffer(e)?e.toString("utf16le",n,t).replace(bc,""):Fj(e,n,t)}:Fj,Lj=function(e,n,t){for(var r=[],i=n;i<n+t;++i)r.push(("0"+e[i].toString(16)).slice(-2));return r.join("")},Bj=Bi?function(e,n,t){return Buffer.isBuffer(e)?e.toString("hex",n,n+t):Lj(e,n,t)}:Lj,zj=function(e,n,t){for(var r=[],i=n;i<t;i++)r.push(String.fromCharCode(x2(e,i)));return r.join("")},v2=Bi?function(n,t,r){return Buffer.isBuffer(n)?n.toString("utf8",t,r):zj(n,t,r)}:zj,Uj=function(e,n){var t=Pl(e,n);return t>0?v2(e,n+4,n+4+t-1):""},_F=Uj,Vj=function(e,n){var t=Pl(e,n);return t>0?v2(e,n+4,n+4+t-1):""},yF=Vj,jj=function(e,n){var t=2*Pl(e,n);return t>0?v2(e,n+4,n+4+t-1):""},vF=jj,$j=function(n,t){var r=Pl(n,t);return r>0?Vk(n,t+4,t+4+r):""},xF=$j,Hj=function(e,n){var t=Pl(e,n);return t>0?v2(e,n+4,n+4+t):""},bF=Hj,Gj=function(e,n){return function _oe(e,n){for(var t=1-2*(e[n+7]>>>7),r=((127&e[n+7])<<4)+(e[n+6]>>>4&15),i=15&e[n+6],l=5;l>=0;--l)i=256*i+e[n+l];return 2047==r?0==i?t*(1/0):NaN:(0==r?r=-1022:(r-=1023,i+=Math.pow(2,52)),t*Math.pow(2,r-52)*i)}(e,n)},jk=Gj,wF=function(n){return Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array};Bi&&(_F=function(n,t){if(!Buffer.isBuffer(n))return Uj(n,t);var r=n.readUInt32LE(t);return r>0?n.toString("utf8",t+4,t+4+r-1):""},yF=function(n,t){if(!Buffer.isBuffer(n))return Vj(n,t);var r=n.readUInt32LE(t);return r>0?n.toString("utf8",t+4,t+4+r-1):""},vF=function(n,t){if(!Buffer.isBuffer(n))return jj(n,t);var r=2*n.readUInt32LE(t);return n.toString("utf16le",t+4,t+4+r-1)},xF=function(n,t){if(!Buffer.isBuffer(n))return $j(n,t);var r=n.readUInt32LE(t);return n.toString("utf16le",t+4,t+4+r)},bF=function(n,t){if(!Buffer.isBuffer(n))return Hj(n,t);var r=n.readUInt32LE(t);return n.toString("utf8",t+4,t+4+r)},jk=function(n,t){return Buffer.isBuffer(n)?n.readDoubleLE(t):Gj(n,t)},wF=function(n){return Buffer.isBuffer(n)||Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array}),typeof is<"u"&&function Wj(){Vk=function(e,n,t){return is.utils.decode(1200,e.slice(n,t)).replace(bc,"")},v2=function(e,n,t){return is.utils.decode(65001,e.slice(n,t))},_F=function(e,n){var t=Pl(e,n);return t>0?is.utils.decode(Iv,e.slice(n+4,n+4+t-1)):""},yF=function(e,n){var t=Pl(e,n);return t>0?is.utils.decode(dd,e.slice(n+4,n+4+t-1)):""},vF=function(e,n){var t=2*Pl(e,n);return t>0?is.utils.decode(1200,e.slice(n+4,n+4+t-1)):""},xF=function(e,n){var t=Pl(e,n);return t>0?is.utils.decode(1200,e.slice(n+4,n+4+t)):""},bF=function(e,n){var t=Pl(e,n);return t>0?is.utils.decode(65001,e.slice(n+4,n+4+t)):""}}();var x2=function(e,n){return e[n]},Bg=function(e,n){return 256*e[n+1]+e[n]},voe=function(e,n){var t=256*e[n+1]+e[n];return t<32768?t:-1*(65535-t+1)},Pl=function(e,n){return e[n+3]*(1<<24)+(e[n+2]<<16)+(e[n+1]<<8)+e[n]},Pv=function(e,n){return e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]},xoe=function(e,n){return e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]};function FS(e,n){var r,i,u,g,x,E,t="",l=[];switch(n){case"dbcs":if(E=this.l,Bi&&Buffer.isBuffer(this))t=this.slice(this.l,this.l+2*e).toString("utf16le");else for(x=0;x<e;++x)t+=String.fromCharCode(Bg(this,E)),E+=2;e*=2;break;case"utf8":t=v2(this,this.l,this.l+e);break;case"utf16le":t=Vk(this,this.l,this.l+(e*=2));break;case"wstr":if(!(typeof is<"u"))return FS.call(this,e,"dbcs");t=is.utils.decode(dd,this.slice(this.l,this.l+2*e)),e*=2;break;case"lpstr-ansi":t=_F(this,this.l),e=4+Pl(this,this.l);break;case"lpstr-cp":t=yF(this,this.l),e=4+Pl(this,this.l);break;case"lpwstr":t=vF(this,this.l),e=4+2*Pl(this,this.l);break;case"lpp4":e=4+Pl(this,this.l),t=xF(this,this.l),2&e&&(e+=2);break;case"8lpp4":e=4+Pl(this,this.l),t=bF(this,this.l),3&e&&(e+=4-(3&e));break;case"cstr":for(e=0,t="";0!==(u=x2(this,this.l+e++));)l.push(CS(u));t=l.join("");break;case"_wstr":for(e=0,t="";0!==(u=Bg(this,this.l+e));)l.push(CS(u)),e+=2;e+=2,t=l.join("");break;case"dbcs-cont":for(t="",E=this.l,x=0;x<e;++x){if(this.lens&&-1!==this.lens.indexOf(E))return u=x2(this,E),this.l=E+1,g=FS.call(this,e-x,u?"dbcs-cont":"sbcs-cont"),l.join("")+g;l.push(CS(Bg(this,E))),E+=2}t=l.join(""),e*=2;break;case"cpstr":if(typeof is<"u"){t=is.utils.decode(dd,this.slice(this.l,this.l+e));break}case"sbcs-cont":for(t="",E=this.l,x=0;x!=e;++x){if(this.lens&&-1!==this.lens.indexOf(E))return u=x2(this,E),this.l=E+1,g=FS.call(this,e-x,u?"dbcs-cont":"sbcs-cont"),l.join("")+g;l.push(CS(x2(this,E))),E+=1}t=l.join("");break;default:switch(e){case 1:return r=x2(this,this.l),this.l++,r;case 2:return r=("i"===n?voe:Bg)(this,this.l),this.l+=2,r;case 4:case-4:return"i"!==n&&128&this[this.l+3]?(i=Pl(this,this.l),this.l+=4,i):(r=(e>0?Pv:xoe)(this,this.l),this.l+=4,r);case 8:case-8:if("f"===n)return i=8==e?jk(this,this.l):jk([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,i;e=8;case 16:t=Bj(this,this.l,e)}}return this.l+=e,t}var boe=function(e,n,t){e[t]=255&n,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24&255},woe=function(e,n,t){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},Toe=function(e,n,t){e[t]=255&n,e[t+1]=n>>>8&255};function Eoe(e,n,t){var r=0,i=0;if("dbcs"===t){for(i=0;i!=n.length;++i)Toe(this,n.charCodeAt(i),this.l+2*i);r=2*n.length}else if("sbcs"===t){if(typeof is<"u"&&874==Iv)for(i=0;i!=n.length;++i){var l=is.utils.encode(Iv,n.charAt(i));this[this.l+i]=l[0]}else for(n=n.replace(/[^\x00-\x7F]/g,"_"),i=0;i!=n.length;++i)this[this.l+i]=255&n.charCodeAt(i);r=n.length}else{if("hex"===t){for(;i<e;++i)this[this.l++]=parseInt(n.slice(2*i,2*i+2),16)||0;return this}if("utf16le"===t){var u=Math.min(this.l+e,this.length);for(i=0;i<Math.min(n.length,e);++i){var g=n.charCodeAt(i);this[this.l++]=255&g,this[this.l++]=g>>8}for(;this.l<u;)this[this.l++]=0;return this}switch(e){case 1:r=1,this[this.l]=255&n;break;case 2:r=2,this[this.l]=255&n,this[this.l+1]=255&(n>>>=8);break;case 3:r=3,this[this.l]=255&n,this[this.l+1]=255&(n>>>=8),this[this.l+2]=255&(n>>>=8);break;case 4:r=4,boe(this,n,this.l);break;case 8:if(r=8,"f"===t){!function yoe(e,n,t){var r=(n<0||1/n==-1/0?1:0)<<7,i=0,l=0,u=r?-n:n;isFinite(u)?0==u?i=l=0:(i=Math.floor(Math.log(u)/Math.LN2),l=u*Math.pow(2,52-i),i<=-1023&&(!isFinite(l)||l<Math.pow(2,52))?i=-1022:(l-=Math.pow(2,52),i+=1023)):(i=2047,l=isNaN(n)?26985:0);for(var g=0;g<=5;++g,l/=256)e[t+g]=255&l;e[t+6]=(15&i)<<4|15&l,e[t+7]=i>>4|r}(this,n,this.l);break}case 16:break;case-4:r=4,woe(this,n,this.l)}}return this.l+=r,this}function qj(e,n){var t=Bj(this,this.l,e.length>>1);if(t!==e)throw new Error(n+"Expected "+e+" saw "+t);this.l+=e.length>>1}function tc(e,n){e.l=n,e.read_shift=FS,e.chk=qj,e.write_shift=Eoe}function Tc(e,n){e.l+=n}function nn(e){var n=W0(e);return tc(n,0),n}function Yc(){var e=[],n=Bi?256:2048,t=function(E){var D=nn(E);return tc(D,0),D},r=t(n),i=function(){r&&(r.length>r.l&&((r=r.slice(0,r.l)).l=r.length),r.length>0&&e.push(r),r=null)},l=function(E){return r&&E<r.length-r.l?r:(i(),r=t(Math.max(E+1,n)))};return{next:l,push:function(E){i(),null==(r=E).l&&(r.l=r.length),l(n)},end:function(){return i(),kl(e)},_bufs:e}}function pn(e,n,t,r){var l,i=+n;if(!isNaN(i)){r||(r=eD[i].p||(t||[]).length||0),l=1+(i>=128?1:0)+1,r>=128&&++l,r>=16384&&++l,r>=2097152&&++l;var u=e.next(l);i<=127?u.write_shift(1,i):(u.write_shift(1,128+(127&i)),u.write_shift(1,i>>7));for(var g=0;4!=g;++g){if(!(r>=128)){u.write_shift(1,r);break}u.write_shift(1,128+(127&r)),r>>=7}r>0&&wF(t)&&e.push(t)}}function LS(e,n,t){var r=Qs(e);if(n.s?(r.cRel&&(r.c+=n.s.c),r.rRel&&(r.r+=n.s.r)):(r.cRel&&(r.c+=n.c),r.rRel&&(r.r+=n.r)),!t||t.biff<12){for(;r.c>=256;)r.c-=256;for(;r.r>=65536;)r.r-=65536}return r}function Zj(e,n,t){var r=Qs(e);return r.s=LS(r.s,n.s,t),r.e=LS(r.e,n.s,t),r}function BS(e,n){if(e.cRel&&e.c<0)for(e=Qs(e);e.c<0;)e.c+=n>8?16384:256;if(e.rRel&&e.r<0)for(e=Qs(e);e.r<0;)e.r+=n>8?1048576:n>5?65536:16384;var t=Kr(e);return!e.cRel&&null!=e.cRel&&(t=function Doe(e){return e.replace(/^([A-Z])/,"$$$1")}(t)),!e.rRel&&null!=e.rRel&&(t=function Coe(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}(t)),t}function TF(e,n){return 0!=e.s.r||e.s.rRel||e.e.r!=(n.biff>=12?1048575:n.biff>=8?65536:16384)||e.e.rRel?0!=e.s.c||e.s.cRel||e.e.c!=(n.biff>=12?16383:255)||e.e.cRel?BS(e.s,n.biff)+":"+BS(e.e,n.biff):(e.s.rRel?"":"$")+ra(e.s.r)+":"+(e.e.rRel?"":"$")+ra(e.e.r):(e.s.cRel?"":"$")+yo(e.s.c)+":"+(e.e.cRel?"":"$")+yo(e.e.c)}function EF(e){return parseInt(function Soe(e){return e.replace(/\$(\d+)$/,"$1")}(e),10)-1}function ra(e){return""+(e+1)}function CF(e){for(var n=function Moe(e){return e.replace(/^\$([A-Z])/,"$1")}(e),t=0,r=0;r!==n.length;++r)t=26*t+n.charCodeAt(r)-64;return t-1}function yo(e){if(e<0)throw new Error("invalid column "+e);var n="";for(++e;e;e=Math.floor((e-1)/26))n=String.fromCharCode((e-1)%26+65)+n;return n}function wa(e){for(var n=0,t=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);i>=48&&i<=57?n=10*n+(i-48):i>=65&&i<=90&&(t=26*t+(i-64))}return{c:t-1,r:n-1}}function Kr(e){for(var n=e.c+1,t="";n;n=(n-1)/26|0)t=String.fromCharCode((n-1)%26+65)+t;return t+(e.r+1)}function Kc(e){var n=e.indexOf(":");return-1==n?{s:wa(e),e:wa(e)}:{s:wa(e.slice(0,n)),e:wa(e.slice(n+1))}}function Ei(e,n){return typeof n>"u"||"number"==typeof n?Ei(e.s,e.e):("string"!=typeof e&&(e=Kr(e)),"string"!=typeof n&&(n=Kr(n)),e==n?e:e+":"+n)}function Qi(e){var n={s:{c:0,r:0},e:{c:0,r:0}},t=0,r=0,i=0,l=e.length;for(t=0;r<l&&!((i=e.charCodeAt(r)-64)<1||i>26);++r)t=26*t+i;for(n.s.c=--t,t=0;r<l&&!((i=e.charCodeAt(r)-48)<0||i>9);++r)t=10*t+i;if(n.s.r=--t,r===l||10!=i)return n.e.c=n.s.c,n.e.r=n.s.r,n;for(++r,t=0;r!=l&&!((i=e.charCodeAt(r)-64)<1||i>26);++r)t=26*t+i;for(n.e.c=--t,t=0;r!=l&&!((i=e.charCodeAt(r)-48)<0||i>9);++r)t=10*t+i;return n.e.r=--t,n}function rm(e,n,t){return null==e||null==e.t||"z"==e.t?"":void 0!==e.w?e.w:("d"==e.t&&!e.z&&t&&t.dateNF&&(e.z=t.dateNF),"e"==e.t?Ug[e.v]||e.v:function Xj(e,n){var t="d"==e.t&&n instanceof Date;if(null!=e.z)try{return e.w=pd(e.z,t?Ol(n):n)}catch{}try{return e.w=pd((e.XF||{}).numFmtId||(t?14:0),t?Ol(n):n)}catch{return""+n}}(e,null==n?e.v:n))}function J0(e,n){var t=n&&n.sheet?n.sheet:"Sheet1",r={};return r[t]=e,{SheetNames:[t],Sheets:r}}function Yj(e,n,t){var r=t||{},i=e?Array.isArray(e):r.dense;null!=Qo&&null==i&&(i=Qo);var l=e||(i?[]:{}),u=0,g=0;if(l&&null!=r.origin){if("number"==typeof r.origin)u=r.origin;else{var x="string"==typeof r.origin?wa(r.origin):r.origin;u=x.r,g=x.c}l["!ref"]||(l["!ref"]="A1:A1")}var E={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(l["!ref"]){var D=Qi(l["!ref"]);E.s.c=D.s.c,E.s.r=D.s.r,E.e.c=Math.max(E.e.c,D.e.c),E.e.r=Math.max(E.e.r,D.e.r),-1==u&&(E.e.r=u=D.e.r+1)}for(var R=0;R!=n.length;++R)if(n[R]){if(!Array.isArray(n[R]))throw new Error("aoa_to_sheet expects an array of arrays");for(var L=0;L!=n[R].length;++L)if(!(typeof n[R][L]>"u")){var V={v:n[R][L]},Y=u+R,G=g+L;if(E.s.r>Y&&(E.s.r=Y),E.s.c>G&&(E.s.c=G),E.e.r<Y&&(E.e.r=Y),E.e.c<G&&(E.e.c=G),!n[R][L]||"object"!=typeof n[R][L]||Array.isArray(n[R][L])||n[R][L]instanceof Date)if(Array.isArray(V.v)&&(V.f=n[R][L][1],V.v=V.v[0]),null===V.v)if(V.f)V.t="n";else if(r.nullError)V.t="e",V.v=0;else{if(!r.sheetStubs)continue;V.t="z"}else"number"==typeof V.v?V.t="n":"boolean"==typeof V.v?V.t="b":V.v instanceof Date?(V.z=r.dateNF||$r[14],r.cellDates?(V.t="d",V.w=pd(V.z,Ol(V.v))):(V.t="n",V.v=Ol(V.v),V.w=pd(V.z,V.v))):V.t="s";else V=n[R][L];if(i)l[Y]||(l[Y]=[]),l[Y][G]&&l[Y][G].z&&(V.z=l[Y][G].z),l[Y][G]=V;else{var Q=Kr({c:G,r:Y});l[Q]&&l[Q].z&&(V.z=l[Q].z),l[Q]=V}}}return E.s.c<1e7&&(l["!ref"]=Ei(E)),l}function b2(e,n){return Yj(null,e,n)}function Gf(e,n){return n||(n=nn(4)),n.write_shift(4,e),n}function Ec(e){var n=e.read_shift(4);return 0===n?"":e.read_shift(n,"dbcs")}function Rl(e,n){var t=!1;return null==n&&(t=!0,n=nn(4+2*e.length)),n.write_shift(4,e.length),e.length>0&&n.write_shift(0,e,"dbcs"),t?n.slice(0,n.l):n}function koe(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function SF(e,n){var t=e.l,r=e.read_shift(1),i=Ec(e),l=[],u={t:i,h:i};if(1&r){for(var g=e.read_shift(4),x=0;x!=g;++x)l.push(koe(e));u.r=l}else u.r=[{ich:0,ifnt:0}];return e.l=t+n,u}var Roe=SF;function Ih(e){var n=e.read_shift(4),t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:n,iStyleRef:t}}function Rv(e,n){return null==n&&(n=nn(8)),n.write_shift(-4,e.c),n.write_shift(3,e.iStyleRef||e.s),n.write_shift(1,0),n}function Nv(e){var n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:n}}function Fv(e,n){return null==n&&(n=nn(4)),n.write_shift(3,e.iStyleRef||e.s),n.write_shift(1,0),n}var Foe=Ec,Kj=Rl;function DF(e){var n=e.read_shift(4);return 0===n||4294967295===n?"":e.read_shift(n,"dbcs")}function $k(e,n){var t=!1;return null==n&&(t=!0,n=nn(127)),n.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&n.write_shift(0,e,"dbcs"),t?n.slice(0,n.l):n}var Loe=Ec,MF=DF,AF=$k;function IF(e){var n=e.slice(e.l,e.l+4),t=1&n[0],r=2&n[0];e.l+=4;var i=0===r?jk([0,0,0,0,252&n[0],n[1],n[2],n[3]],0):Pv(n,0)>>2;return t?i/100:i}function Jj(e,n){null==n&&(n=nn(4));var t=0,r=0,i=100*e;if(e==(0|e)&&e>=-(1<<29)&&e<1<<29?r=1:i==(0|i)&&i>=-(1<<29)&&i<1<<29&&(r=1,t=1),!r)throw new Error("unsupported RkNumber "+e);n.write_shift(-4,((t?i:e)<<2)+(t+2))}function Qj(e){var n={s:{},e:{}};return n.s.r=e.read_shift(4),n.e.r=e.read_shift(4),n.s.c=e.read_shift(4),n.e.c=e.read_shift(4),n}var Lv=Qj,w2=function Boe(e,n){return n||(n=nn(16)),n.write_shift(4,e.s.r),n.write_shift(4,e.e.r),n.write_shift(4,e.s.c),n.write_shift(4,e.e.c),n};function Cc(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function Bv(e,n){return(n||nn(8)).write_shift(8,e,"f")}function Hk(e,n){if(n||(n=nn(8)),!e||e.auto)return n.write_shift(4,0),n.write_shift(4,0),n;null!=e.index?(n.write_shift(1,2),n.write_shift(1,e.index)):null!=e.theme?(n.write_shift(1,6),n.write_shift(1,e.theme)):(n.write_shift(1,5),n.write_shift(1,0));var t=e.tint||0;if(t>0?t*=32767:t<0&&(t*=32768),n.write_shift(2,t),e.rgb&&null==e.theme){var r=e.rgb||"FFFFFF";"number"==typeof r&&(r=("000000"+r.toString(16)).slice(-6)),n.write_shift(1,parseInt(r.slice(0,2),16)),n.write_shift(1,parseInt(r.slice(2,4),16)),n.write_shift(1,parseInt(r.slice(4,6),16)),n.write_shift(1,255)}else n.write_shift(2,0),n.write_shift(1,0),n.write_shift(1,0);return n}var OF={1:{n:"CodePage",t:2},2:{n:"Category",t:80},3:{n:"PresentationFormat",t:80},4:{n:"ByteCount",t:3},5:{n:"LineCount",t:3},6:{n:"ParagraphCount",t:3},7:{n:"SlideCount",t:3},8:{n:"NoteCount",t:3},9:{n:"HiddenCount",t:3},10:{n:"MultimediaClipCount",t:3},11:{n:"ScaleCrop",t:11},12:{n:"HeadingPairs",t:4108},13:{n:"TitlesOfParts",t:4126},14:{n:"Manager",t:80},15:{n:"Company",t:80},16:{n:"LinksUpToDate",t:11},17:{n:"CharacterCount",t:3},19:{n:"SharedDoc",t:11},22:{n:"HyperlinksChanged",t:11},23:{n:"AppVersion",t:3,p:"version"},24:{n:"DigSig",t:65},26:{n:"ContentType",t:80},27:{n:"ContentStatus",t:80},28:{n:"Language",t:80},29:{n:"Version",t:80},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}},PF={1:{n:"CodePage",t:2},2:{n:"Title",t:80},3:{n:"Subject",t:80},4:{n:"Author",t:80},5:{n:"Keywords",t:80},6:{n:"Comments",t:80},7:{n:"Template",t:80},8:{n:"LastAuthor",t:80},9:{n:"RevNumber",t:80},10:{n:"EditTime",t:64},11:{n:"LastPrinted",t:64},12:{n:"CreatedDate",t:64},13:{n:"ModifiedDate",t:64},14:{n:"PageCount",t:3},15:{n:"WordCount",t:3},16:{n:"CharCount",t:3},17:{n:"Thumbnail",t:71},18:{n:"Application",t:80},19:{n:"DocSecurity",t:3},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}};function Yoe(e){return e.map(function(n){return[n>>16&255,n>>8&255,255&n]})}var zv=Qs(Yoe([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),Ug={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},RF={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},Zk={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function i7(e,n){var i,t=function Kse(e){for(var n=[],t=ea(e),r=0;r!==t.length;++r)null==n[e[t[r]]]&&(n[e[t[r]]]=[]),n[e[t[r]]].push(t[r]);return n}(RF),r=[];r[r.length]=na,r[r.length]=Fn("Types",null,{xmlns:qa.CT,"xmlns:xsd":qa.xsd,"xmlns:xsi":qa.xsi}),r=r.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(x){return Fn("Default",null,{Extension:x[0],ContentType:x[1]})}));var l=function(x){e[x]&&e[x].length>0&&(r[r.length]=Fn("Override",null,{PartName:("/"==(i=e[x][0])[0]?"":"/")+i,ContentType:Zk[x][n.bookType]||Zk[x].xlsx}))},u=function(x){(e[x]||[]).forEach(function(E){r[r.length]=Fn("Override",null,{PartName:("/"==E[0]?"":"/")+E,ContentType:Zk[x][n.bookType]||Zk[x].xlsx})})},g=function(x){(e[x]||[]).forEach(function(E){r[r.length]=Fn("Override",null,{PartName:("/"==E[0]?"":"/")+E,ContentType:t[x][0]})})};return l("workbooks"),u("sheets"),u("charts"),g("themes"),["strs","styles"].forEach(l),["coreprops","extprops","custprops"].forEach(g),g("vba"),g("comments"),g("threadedcomments"),g("drawings"),u("metadata"),g("people"),r.length>2&&(r[r.length]="</Types>",r[1]=r[1].replace("/>",">")),r.join("")}var Ci={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function zS(e){var n=e.lastIndexOf("/");return e.slice(0,n+1)+"_rels/"+e.slice(n+1)+".rels"}function T2(e){var n=[na,Fn("Relationships",null,{xmlns:qa.RELS})];return ea(e["!id"]).forEach(function(t){n[n.length]=Fn("Relationship",null,e["!id"][t])}),n.length>2&&(n[n.length]="</Relationships>",n[1]=n[1].replace("/>",">")),n.join("")}function Ds(e,n,t,r,i,l){if(i||(i={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),n<0)for(n=e["!idx"];e["!id"]["rId"+n];++n);if(e["!idx"]=n+1,i.Id="rId"+n,i.Type=r,i.Target=t,l?i.TargetMode=l:[Ci.HLINK,Ci.XPATH,Ci.XMISS].indexOf(i.Type)>-1&&(i.TargetMode="External"),e["!id"][i.Id])throw new Error("Cannot rewrite rId "+n);return e["!id"][i.Id]=i,e[("/"+i.Target).replace("//","/")]=i,n}function s7(e,n,t){return['  <rdf:Description rdf:about="'+e+'">\n','    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(t||"odf")+"#"+n+'"/>\n',"  </rdf:Description>\n"].join("")}function rae(e,n){return['  <rdf:Description rdf:about="'+e+'">\n','    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+n+'"/>\n',"  </rdf:Description>\n"].join("")}function o7(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+ES.version+"</meta:generator></office:meta></office:document-meta>"}var Vg=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function FF(e,n,t,r,i){null!=i[e]||null==n||""===n||(i[e]=n,n=Rs(n),r[r.length]=t?Fn(e,n,t):ec(e,n))}function l7(e,n){var t=n||{},r=[na,Fn("cp:coreProperties",null,{"xmlns:cp":qa.CORE_PROPS,"xmlns:dc":qa.dc,"xmlns:dcterms":qa.dcterms,"xmlns:dcmitype":qa.dcmitype,"xmlns:xsi":qa.xsi})],i={};if(!e&&!t.Props)return r.join("");e&&(null!=e.CreatedDate&&FF("dcterms:created","string"==typeof e.CreatedDate?e.CreatedDate:mF(e.CreatedDate,t.WTF),{"xsi:type":"dcterms:W3CDTF"},r,i),null!=e.ModifiedDate&&FF("dcterms:modified","string"==typeof e.ModifiedDate?e.ModifiedDate:mF(e.ModifiedDate,t.WTF),{"xsi:type":"dcterms:W3CDTF"},r,i));for(var l=0;l!=Vg.length;++l){var u=Vg[l],g=t.Props&&null!=t.Props[u[1]]?t.Props[u[1]]:e?e[u[1]]:null;!0===g?g="1":!1===g?g="0":"number"==typeof g&&(g=String(g)),null!=g&&FF(u[0],g,null,r,i)}return r.length>2&&(r[r.length]="</cp:coreProperties>",r[1]=r[1].replace("/>",">")),r.join("")}var Uv=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],c7=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function d7(e){var n=[],t=Fn;return e||(e={}),e.Application="SheetJS",n[n.length]=na,n[n.length]=Fn("Properties",null,{xmlns:qa.EXT_PROPS,"xmlns:vt":qa.vt}),Uv.forEach(function(r){if(void 0!==e[r[1]]){var i;switch(r[2]){case"string":i=Rs(String(e[r[1]]));break;case"bool":i=e[r[1]]?"true":"false"}void 0!==i&&(n[n.length]=t(r[0],i))}}),n[n.length]=t("HeadingPairs",t("vt:vector",t("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+t("vt:variant",t("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),n[n.length]=t("TitlesOfParts",t("vt:vector",e.SheetNames.map(function(r){return"<vt:lpstr>"+Rs(r)+"</vt:lpstr>"}).join(""),{size:e.Worksheets,baseType:"lpstr"})),n.length>2&&(n[n.length]="</Properties>",n[1]=n[1].replace("/>",">")),n.join("")}function h7(e){var n=[na,Fn("Properties",null,{xmlns:qa.CUST_PROPS,"xmlns:vt":qa.vt})];if(!e)return n.join("");var t=1;return ea(e).forEach(function(i){++t,n[n.length]=Fn("property",function goe(e,n){switch(typeof e){case"string":var t=Fn("vt:lpwstr",Rs(e));return n&&(t=t.replace(/&quot;/g,"_x0022_")),t;case"number":return Fn((0|e)==e?"vt:i4":"vt:r8",Rs(String(e)));case"boolean":return Fn("vt:bool",e?"true":"false")}if(e instanceof Date)return Fn("vt:filetime",mF(e));throw new Error("Unable to serialize "+e)}(e[i],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:t,name:Rs(i)})}),n.length>2&&(n[n.length]="</Properties>",n[1]=n[1].replace("/>",">")),n.join("")}var LF={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function y7(e,n){var t=nn(4),r=nn(4);switch(t.write_shift(4,80==e?31:e),e){case 3:r.write_shift(-4,n);break;case 5:(r=nn(8)).write_shift(8,n,"f");break;case 11:r.write_shift(4,n?1:0);break;case 64:r=function hae(e){var t=("string"==typeof e?new Date(Date.parse(e)):e).getTime()/1e3+11644473600,r=t%Math.pow(2,32),i=(t-r)/Math.pow(2,32);i*=1e7;var l=(r*=1e7)/Math.pow(2,32)|0;l>0&&(r%=Math.pow(2,32),i+=l);var u=nn(8);return u.write_shift(4,r),u.write_shift(4,i),u}(n);break;case 31:case 80:for((r=nn(4+2*(n.length+1)+(n.length%2?0:2))).write_shift(4,n.length+1),r.write_shift(0,n,"dbcs");r.l!=r.length;)r.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+n)}return kl([t,r])}var x7=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function vae(e){switch(typeof e){case"boolean":return 11;case"number":return(0|e)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64}return-1}function b7(e,n,t){var r=nn(8),i=[],l=[],u=8,g=0,x=nn(8),E=nn(8);if(x.write_shift(4,2),x.write_shift(4,1200),E.write_shift(4,1),l.push(x),i.push(E),u+=8+x.length,!n){(E=nn(8)).write_shift(4,0),i.unshift(E);var D=[nn(4)];for(D[0].write_shift(4,e.length),g=0;g<e.length;++g){var R=e[g][0];for((x=nn(8+2*(R.length+1)+(R.length%2?0:2))).write_shift(4,g+2),x.write_shift(4,R.length+1),x.write_shift(0,R,"dbcs");x.l!=x.length;)x.write_shift(1,0);D.push(x)}x=kl(D),l.unshift(x),u+=8+x.length}for(g=0;g<e.length;++g)if((!n||n[e[g][0]])&&!(x7.indexOf(e[g][0])>-1||c7.indexOf(e[g][0])>-1)&&null!=e[g][1]){var L=e[g][1],V=0;if(n){var Y=t[V=+n[e[g][0]]];if("version"==Y.p&&"string"==typeof L){var G=L.split(".");L=(+G[0]<<16)+(+G[1]||0)}x=y7(Y.t,L)}else{var Q=vae(L);-1==Q&&(Q=31,L=String(L)),x=y7(Q,L)}l.push(x),(E=nn(8)).write_shift(4,n?V:2+g),i.push(E),u+=8+x.length}var he=8*(l.length+1);for(g=0;g<l.length;++g)i[g].write_shift(4,he),he+=l[g].length;return r.write_shift(4,u),r.write_shift(4,l.length),kl([r].concat(i).concat(l))}function T7(e,n,t,r,i,l){var u=nn(i?68:48),g=[u];u.write_shift(2,65534),u.write_shift(2,0),u.write_shift(4,842412599),u.write_shift(16,Or.utils.consts.HEADER_CLSID,"hex"),u.write_shift(4,i?2:1),u.write_shift(16,n,"hex"),u.write_shift(4,i?68:48);var x=b7(e,t,r);if(g.push(x),i){var E=b7(i,null,null);u.write_shift(16,l,"hex"),u.write_shift(4,68+x.length),g.push(E)}return kl(g)}function Jc(e,n){return n||(n=nn(2)),n.write_shift(2,+!!e),n}function Za(e){return e.read_shift(2,"u")}function kh(e,n){return n||(n=nn(2)),n.write_shift(2,e),n}function C7(e,n,t){return t||(t=nn(2)),t.write_shift(1,"e"==n?+e:+!!e),t.write_shift(1,"e"==n?1:0),t}function VS(e,n,t){var r=e.read_shift(t&&t.biff>=12?2:1),i="sbcs-cont",l=dd;t&&t.biff>=8&&(dd=1200),t&&8!=t.biff?12==t.biff&&(i="wstr"):e.read_shift(1)&&(i="dbcs-cont"),t.biff>=2&&t.biff<=5&&(i="cpstr");var g=r?e.read_shift(r,i):"";return dd=l,g}function Eae(e){var n=e.t||"",r=nn(3);r.write_shift(2,n.length),r.write_shift(1,1);var i=nn(2*n.length);return i.write_shift(2*n.length,n,"utf16le"),kl([r,i])}function S7(e,n,t){return t||(t=nn(3+2*e.length)),t.write_shift(2,e.length),t.write_shift(1,1),t.write_shift(31,e,"utf16le"),t}function D7(e,n){n||(n=nn(6+2*e.length)),n.write_shift(4,1+e.length);for(var t=0;t<e.length;++t)n.write_shift(2,e.charCodeAt(t));return n.write_shift(2,0),n}function Iae(e){var n=nn(512),t=0,r=e.Target;"file://"==r.slice(0,7)&&(r=r.slice(7));var i=r.indexOf("#"),l=i>-1?31:23;switch(r.charAt(0)){case"#":l=28;break;case".":l&=-3}n.write_shift(4,2),n.write_shift(4,l);var u=[8,6815827,6619237,4849780,83];for(t=0;t<u.length;++t)n.write_shift(4,u[t]);if(28==l)D7(r=r.slice(1),n);else if(2&l){for(u="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),t=0;t<u.length;++t)n.write_shift(1,parseInt(u[t],16));var g=i>-1?r.slice(0,i):r;for(n.write_shift(4,2*(g.length+1)),t=0;t<g.length;++t)n.write_shift(2,g.charCodeAt(t));n.write_shift(2,0),8&l&&D7(i>-1?r.slice(i+1):"",n)}else{for(u="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),t=0;t<u.length;++t)n.write_shift(1,parseInt(u[t],16));for(var x=0;"../"==r.slice(3*x,3*x+3)||"..\\"==r.slice(3*x,3*x+3);)++x;for(n.write_shift(2,x),n.write_shift(4,r.length-3*x+1),t=0;t<r.length-3*x;++t)n.write_shift(1,255&r.charCodeAt(t+3*x));for(n.write_shift(1,0),n.write_shift(2,65535),n.write_shift(2,57005),t=0;t<6;++t)n.write_shift(4,0)}return n.slice(0,n.l)}function $v(e,n,t,r){return r||(r=nn(6)),r.write_shift(2,e),r.write_shift(2,n),r.write_shift(2,t||0),r}function Pae(e,n,t){var r=t.biff>8?4:2;return[e.read_shift(r),e.read_shift(r,"i"),e.read_shift(r,"i")]}function Kk(e){var n=e.read_shift(2),t=e.read_shift(2);return{s:{c:e.read_shift(2),r:n},e:{c:e.read_shift(2),r:t}}}function k7(e,n){return n||(n=nn(8)),n.write_shift(2,e.s.r),n.write_shift(2,e.e.r),n.write_shift(2,e.s.c),n.write_shift(2,e.e.c),n}function VF(e,n,t){var r=1536,i=16;switch(t.bookType){case"biff8":case"xla":break;case"biff5":r=1280,i=8;break;case"biff4":r=4,i=6;break;case"biff3":r=3,i=6;break;case"biff2":r=2,i=4;break;default:throw new Error("unsupported BIFF version")}var l=nn(i);return l.write_shift(2,r),l.write_shift(2,n),i>4&&l.write_shift(2,29282),i>6&&l.write_shift(2,1997),i>8&&(l.write_shift(2,49161),l.write_shift(2,1),l.write_shift(2,1798),l.write_shift(2,0)),l}function Gae(e,n){var t=!n||n.biff>=8?2:1,r=nn(8+t*e.name.length);r.write_shift(4,e.pos),r.write_shift(1,e.hs||0),r.write_shift(1,e.dt),r.write_shift(1,e.name.length),n.biff>=8&&r.write_shift(1,1),r.write_shift(t*e.name.length,e.name,n.biff<8?"sbcs":"utf16le");var i=r.slice(0,r.l);return i.l=r.l,i}function ule(e,n,t,r){var i=t&&5==t.biff;r||(r=nn(i?3+n.length:5+2*n.length)),r.write_shift(2,e),r.write_shift(i?1:2,n.length),i||r.write_shift(1,1),r.write_shift((i?1:2)*n.length,n,i?"sbcs":"utf16le");var l=r.length>r.l?r.slice(0,r.l):r;return null==l.l&&(l.l=l.length),l}function F7(e,n,t,r){var i=t&&5==t.biff;r||(r=nn(i?16:20)),r.write_shift(2,0),e.style?(r.write_shift(2,e.numFmtId||0),r.write_shift(2,65524)):(r.write_shift(2,e.numFmtId||0),r.write_shift(2,n<<4));var l=0;return e.numFmtId>0&&i&&(l|=1024),r.write_shift(4,l),r.write_shift(4,0),i||r.write_shift(4,0),r.write_shift(2,0),r}function Ble(e){var n=nn(24),t=wa(e[0]);n.write_shift(2,t.r),n.write_shift(2,t.r),n.write_shift(2,t.c),n.write_shift(2,t.c);for(var r="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),i=0;i<16;++i)n.write_shift(1,parseInt(r[i],16));return kl([n,Iae(e[1])])}function Ule(e){var n=e[1].Tooltip,t=nn(10+2*(n.length+1));t.write_shift(2,2048);var r=wa(e[0]);t.write_shift(2,r.r),t.write_shift(2,r.r),t.write_shift(2,r.c),t.write_shift(2,r.c);for(var i=0;i<n.length;++i)t.write_shift(2,n.charCodeAt(i));return t.write_shift(2,0),t}var jF=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},n=Lk({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(g,x){var E=x||{};E.dateNF||(E.dateNF="yyyymmdd");var D=b2(function t(g,x){var E=[],D=W0(1);switch(x.type){case"base64":D=fd(hd(g));break;case"binary":D=fd(g);break;case"buffer":case"array":D=g}tc(D,0);var R=D.read_shift(1),L=!!(136&R),V=!1,Y=!1;switch(R){case 2:case 3:case 131:case 139:case 245:break;case 48:case 49:V=!0,L=!0;break;case 140:Y=!0;break;default:throw new Error("DBF Unsupported Version: "+R.toString(16))}var G=0,Q=521;2==R&&(G=D.read_shift(2)),D.l+=3,2!=R&&(G=D.read_shift(4)),G>1048576&&(G=1e6),2!=R&&(Q=D.read_shift(2));var he=D.read_shift(2),le=x.codepage||1252;2!=R&&(D.l+=16,D.read_shift(1),0!==D[D.l]&&(le=e[D[D.l]]),D.l+=1,D.l+=2),Y&&(D.l+=36);for(var me=[],ze={},Je=Math.min(D.length,2==R?521:Q-10-(V?264:0)),ht=Y?32:11;D.l<Je&&13!=D[D.l];)switch(ze={},ze.name=is.utils.decode(le,D.slice(D.l,D.l+ht)).replace(/[\u0000\r\n].*$/g,""),D.l+=ht,ze.type=String.fromCharCode(D.read_shift(1)),2!=R&&!Y&&(ze.offset=D.read_shift(4)),ze.len=D.read_shift(1),2==R&&(ze.offset=D.read_shift(2)),ze.dec=D.read_shift(1),ze.name.length&&me.push(ze),2!=R&&(D.l+=Y?13:14),ze.type){case"B":(!V||8!=ze.len)&&x.WTF&&console.log("Skipping "+ze.name+":"+ze.type);break;case"G":case"P":x.WTF&&console.log("Skipping "+ze.name+":"+ze.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+ze.type)}if(13!==D[D.l]&&(D.l=Q-1),13!==D.read_shift(1))throw new Error("DBF Terminator not found "+D.l+" "+D[D.l]);D.l=Q;var Ne=0,dt=0;for(E[0]=[],dt=0;dt!=me.length;++dt)E[0][dt]=me[dt].name;for(;G-- >0;)if(42!==D[D.l])for(++D.l,E[++Ne]=[],dt=0,dt=0;dt!=me.length;++dt){var ft=D.slice(D.l,D.l+me[dt].len);D.l+=me[dt].len,tc(ft,0);var kt=is.utils.decode(le,ft);switch(me[dt].type){case"C":kt.trim().length&&(E[Ne][dt]=kt.replace(/\s+$/,""));break;case"D":E[Ne][dt]=8===kt.length?new Date(+kt.slice(0,4),+kt.slice(4,6)-1,+kt.slice(6,8)):kt;break;case"F":E[Ne][dt]=parseFloat(kt.trim());break;case"+":case"I":E[Ne][dt]=Y?2147483648^ft.read_shift(-4,"i"):ft.read_shift(4,"i");break;case"L":switch(kt.trim().toUpperCase()){case"Y":case"T":E[Ne][dt]=!0;break;case"N":case"F":E[Ne][dt]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+kt+"|")}break;case"M":if(!L)throw new Error("DBF Unexpected MEMO for type "+R.toString(16));E[Ne][dt]="##MEMO##"+(Y?parseInt(kt.trim(),10):ft.read_shift(4));break;case"N":(kt=kt.replace(/\u0000/g,"").trim())&&"."!=kt&&(E[Ne][dt]=+kt||0);break;case"@":E[Ne][dt]=new Date(ft.read_shift(-8,"f")-621356832e5);break;case"T":E[Ne][dt]=new Date(864e5*(ft.read_shift(4)-2440588)+ft.read_shift(4));break;case"Y":E[Ne][dt]=ft.read_shift(4,"i")/1e4+ft.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":E[Ne][dt]=-ft.read_shift(-8,"f");break;case"B":if(V&&8==me[dt].len){E[Ne][dt]=ft.read_shift(8,"f");break}case"G":case"P":ft.l+=me[dt].len;break;case"0":if("_NullFlags"===me[dt].name)break;default:throw new Error("DBF Unsupported data type "+me[dt].type)}}else D.l+=he;if(2!=R&&D.l<D.length&&26!=D[D.l++])throw new Error("DBF EOF Marker missing "+(D.l-1)+" of "+D.length+" "+D[D.l-1].toString(16));return x&&x.sheetRows&&(E=E.slice(0,x.sheetRows)),x.DBF=me,E}(g,E),E);return D["!cols"]=E.DBF.map(function(R){return{wch:R.len,DBF:R}}),delete E.DBF,D}var l={B:8,C:250,L:1,D:8,"?":0,"":0};return{to_workbook:function i(g,x){try{return J0(r(g,x),x)}catch(E){if(x&&x.WTF)throw E}return{SheetNames:[],Sheets:{}}},to_sheet:r,from_sheet:function u(g,x){var E=x||{};if(+E.codepage>=0&&Dh(+E.codepage),"string"==E.type)throw new Error("Cannot write DBF to JS string");var D=Yc(),R=uO(g,{header:1,raw:!0,cellDates:!0}),L=R[0],V=R.slice(1),Y=g["!cols"]||[],G=0,Q=0,he=0,le=1;for(G=0;G<L.length;++G)if(((Y[G]||{}).DBF||{}).name)L[G]=Y[G].DBF.name,++he;else if(null!=L[G]){if(++he,"number"==typeof L[G]&&(L[G]=L[G].toString(10)),"string"!=typeof L[G])throw new Error("DBF Invalid column name "+L[G]+" |"+typeof L[G]+"|");if(L.indexOf(L[G])!==G)for(Q=0;Q<1024;++Q)if(-1==L.indexOf(L[G]+"_"+Q)){L[G]+="_"+Q;break}}var me=Qi(g["!ref"]),ze=[],Je=[],ht=[];for(G=0;G<=me.e.c-me.s.c;++G){var Ne="",dt="",ft=0,kt=[];for(Q=0;Q<V.length;++Q)null!=V[Q][G]&&kt.push(V[Q][G]);if(0!=kt.length&&null!=L[G]){for(Q=0;Q<kt.length;++Q){switch(typeof kt[Q]){case"number":dt="B";break;case"string":default:dt="C";break;case"boolean":dt="L";break;case"object":dt=kt[Q]instanceof Date?"D":"C"}ft=Math.max(ft,String(kt[Q]).length),Ne=Ne&&Ne!=dt?"C":dt}ft>250&&(ft=250),"C"==(dt=((Y[G]||{}).DBF||{}).type)&&Y[G].DBF.len>ft&&(ft=Y[G].DBF.len),"B"==Ne&&"N"==dt&&(Ne="N",ht[G]=Y[G].DBF.dec,ft=Y[G].DBF.len),Je[G]="C"==Ne||"N"==dt?ft:l[Ne]||0,le+=Je[G],ze[G]=Ne}else ze[G]="?"}var $t=D.next(32);for($t.write_shift(4,318902576),$t.write_shift(4,V.length),$t.write_shift(2,296+32*he),$t.write_shift(2,le),G=0;G<4;++G)$t.write_shift(4,0);for($t.write_shift(4,(+n[Iv]||3)<<8),G=0,Q=0;G<L.length;++G)if(null!=L[G]){var vt=D.next(32),wn=(L[G].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);vt.write_shift(1,wn,"sbcs"),vt.write_shift(1,"?"==ze[G]?"C":ze[G],"sbcs"),vt.write_shift(4,Q),vt.write_shift(1,Je[G]||l[ze[G]]||0),vt.write_shift(1,ht[G]||0),vt.write_shift(1,2),vt.write_shift(4,0),vt.write_shift(1,0),vt.write_shift(4,0),vt.write_shift(4,0),Q+=Je[G]||l[ze[G]]||0}var Xn=D.next(264);for(Xn.write_shift(4,13),G=0;G<65;++G)Xn.write_shift(4,0);for(G=0;G<V.length;++G){var Nn=D.next(le);for(Nn.write_shift(1,0),Q=0;Q<L.length;++Q)if(null!=L[Q])switch(ze[Q]){case"L":Nn.write_shift(1,null==V[G][Q]?63:V[G][Q]?84:70);break;case"B":Nn.write_shift(8,V[G][Q]||0,"f");break;case"N":var gr="0";for("number"==typeof V[G][Q]&&(gr=V[G][Q].toFixed(ht[Q]||0)),he=0;he<Je[Q]-gr.length;++he)Nn.write_shift(1,32);Nn.write_shift(1,gr,"sbcs");break;case"D":V[G][Q]?(Nn.write_shift(4,("0000"+V[G][Q].getFullYear()).slice(-4),"sbcs"),Nn.write_shift(2,("00"+(V[G][Q].getMonth()+1)).slice(-2),"sbcs"),Nn.write_shift(2,("00"+V[G][Q].getDate()).slice(-2),"sbcs")):Nn.write_shift(8,"00000000","sbcs");break;case"C":var Kn=String(null!=V[G][Q]?V[G][Q]:"").slice(0,Je[Q]);for(Nn.write_shift(1,Kn,"sbcs"),he=0;he<Je[Q]-Kn.length;++he)Nn.write_shift(1,32)}}return D.next(1).write_shift(1,26),D.end()}}}(),H7=function(){var e={AA:"\xc0",BA:"\xc1",CA:"\xc2",DA:195,HA:"\xc4",JA:197,AE:"\xc8",BE:"\xc9",CE:"\xca",HE:"\xcb",AI:"\xcc",BI:"\xcd",CI:"\xce",HI:"\xcf",AO:"\xd2",BO:"\xd3",CO:"\xd4",DO:213,HO:"\xd6",AU:"\xd9",BU:"\xda",CU:"\xdb",HU:"\xdc",Aa:"\xe0",Ba:"\xe1",Ca:"\xe2",Da:227,Ha:"\xe4",Ja:229,Ae:"\xe8",Be:"\xe9",Ce:"\xea",He:"\xeb",Ai:"\xec",Bi:"\xed",Ci:"\xee",Hi:"\xef",Ao:"\xf2",Bo:"\xf3",Co:"\xf4",Do:245,Ho:"\xf6",Au:"\xf9",Bu:"\xfa",Cu:"\xfb",Hu:"\xfc",KC:"\xc7",Kc:"\xe7",q:"\xe6",z:"\u0153",a:"\xc6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},n=new RegExp("\x1bN("+ea(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),t=function(L,V){var Y=e[V];return"number"==typeof Y?iF(Y):Y},r=function(L,V,Y){var G=V.charCodeAt(0)-32<<4|Y.charCodeAt(0)-48;return 59==G?L:iF(G)};function l(L,V){var $t,Y=L.split(/[\n\r]+/),G=-1,Q=-1,he=0,le=0,me=[],ze=[],Je=null,ht={},Ne=[],dt=[],ft=[],kt=0;for(+V.codepage>=0&&Dh(+V.codepage);he!==Y.length;++he){kt=0;var Nn,vt=Y[he].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,r).replace(n,t),wn=vt.replace(/;;/g,"\0").split(";").map(function(rt){return rt.replace(/\u0000/g,";")});if(vt.length>0)switch(wn[0]){case"ID":case"E":case"B":case"O":case"W":break;case"P":"P"==wn[1].charAt(0)&&ze.push(vt.slice(3).replace(/;;/g,";"));break;case"C":var gr=!1,Kn=!1,Si=!1,Hn=!1,Nr=-1,mn=-1;for(le=1;le<wn.length;++le)switch(wn[le].charAt(0)){case"A":case"G":break;case"X":Q=parseInt(wn[le].slice(1))-1,Kn=!0;break;case"Y":for(G=parseInt(wn[le].slice(1))-1,Kn||(Q=0),$t=me.length;$t<=G;++$t)me[$t]=[];break;case"K":'"'===(Nn=wn[le].slice(1)).charAt(0)?Nn=Nn.slice(1,Nn.length-1):"TRUE"===Nn?Nn=!0:"FALSE"===Nn?Nn=!1:isNaN(Hf(Nn))?isNaN(y2(Nn).getDate())||(Nn=Lo(Nn)):(Nn=Hf(Nn),null!==Je&&g2(Je)&&(Nn=cF(Nn))),typeof is<"u"&&"string"==typeof Nn&&"string"!=(V||{}).type&&(V||{}).codepage&&(Nn=is.utils.decode(V.codepage,Nn)),gr=!0;break;case"E":Hn=!0;var Ye=S2(wn[le].slice(1),{r:G,c:Q});me[G][Q]=[me[G][Q],Ye];break;case"S":Si=!0,me[G][Q]=[me[G][Q],"S5S"];break;case"R":Nr=parseInt(wn[le].slice(1))-1;break;case"C":mn=parseInt(wn[le].slice(1))-1;break;default:if(V&&V.WTF)throw new Error("SYLK bad record "+vt)}if(gr&&(me[G][Q]&&2==me[G][Q].length?me[G][Q][0]=Nn:me[G][Q]=Nn,Je=null),Si){if(Hn)throw new Error("SYLK shared formula cannot have own formula");var Nt=Nr>-1&&me[Nr][mn];if(!Nt||!Nt[1])throw new Error("SYLK shared formula cannot find base");me[G][Q][1]=d9(Nt[1],{r:G-Nr,c:Q-mn})}break;case"F":var st=0;for(le=1;le<wn.length;++le)switch(wn[le].charAt(0)){case"X":Q=parseInt(wn[le].slice(1))-1,++st;break;case"Y":for(G=parseInt(wn[le].slice(1))-1,$t=me.length;$t<=G;++$t)me[$t]=[];break;case"M":kt=parseInt(wn[le].slice(1))/20;break;case"F":case"G":case"S":case"D":case"N":break;case"P":Je=ze[parseInt(wn[le].slice(1))];break;case"W":for(ft=wn[le].slice(1).split(" "),$t=parseInt(ft[0],10);$t<=parseInt(ft[1],10);++$t)kt=parseInt(ft[2],10),dt[$t-1]=0===kt?{hidden:!0}:{wch:kt},e1(dt[$t-1]);break;case"C":dt[Q=parseInt(wn[le].slice(1))-1]||(dt[Q]={});break;case"R":Ne[G=parseInt(wn[le].slice(1))-1]||(Ne[G]={}),kt>0?(Ne[G].hpt=kt,Ne[G].hpx=tO(kt)):0===kt&&(Ne[G].hidden=!0);break;default:if(V&&V.WTF)throw new Error("SYLK bad record "+vt)}st<1&&(Je=null);break;default:if(V&&V.WTF)throw new Error("SYLK bad record "+vt)}}return Ne.length>0&&(ht["!rows"]=Ne),dt.length>0&&(ht["!cols"]=dt),V&&V.sheetRows&&(me=me.slice(0,V.sheetRows)),[me,ht]}function u(L,V){var Y=function i(L,V){switch(V.type){case"base64":return l(hd(L),V);case"binary":return l(L,V);case"buffer":return l(Bi&&Buffer.isBuffer(L)?L.toString("binary"):q0(L),V);case"array":return l(Ov(L),V)}throw new Error("Unrecognized type "+V.type)}(L,V),Q=Y[1],he=b2(Y[0],V);return ea(Q).forEach(function(le){he[le]=Q[le]}),he}function x(L,V,Y,G){var Q="C;Y"+(Y+1)+";X"+(G+1)+";K";switch(L.t){case"n":Q+=L.v||0,L.f&&!L.F&&(Q+=";E"+XF(L.f,{r:Y,c:G}));break;case"b":Q+=L.v?"TRUE":"FALSE";break;case"e":Q+=L.w||L.v;break;case"d":Q+='"'+(L.w||L.v)+'"';break;case"s":Q+='"'+L.v.replace(/"/g,"").replace(/;/g,";;")+'"'}return Q}return e["|"]=254,{to_workbook:function g(L,V){return J0(u(L,V),V)},to_sheet:u,from_sheet:function R(L,V){var he,Y=["ID;PWXL;N;E"],G=[],Q=Qi(L["!ref"]),le=Array.isArray(L),me="\r\n";Y.push("P;PGeneral"),Y.push("F;P0;DG0G8;M255"),L["!cols"]&&function E(L,V){V.forEach(function(Y,G){var Q="F;W"+(G+1)+" "+(G+1)+" ";Y.hidden?Q+="0":("number"==typeof Y.width&&!Y.wpx&&(Y.wpx=HS(Y.width)),"number"==typeof Y.wpx&&!Y.wch&&(Y.wch=GS(Y.wpx)),"number"==typeof Y.wch&&(Q+=Math.round(Y.wch)))," "!=Q.charAt(Q.length-1)&&L.push(Q)})}(Y,L["!cols"]),L["!rows"]&&function D(L,V){V.forEach(function(Y,G){var Q="F;";Y.hidden?Q+="M0;":Y.hpt?Q+="M"+20*Y.hpt+";":Y.hpx&&(Q+="M"+20*WS(Y.hpx)+";"),Q.length>2&&L.push(Q+"R"+(G+1))})}(Y,L["!rows"]),Y.push("B;Y"+(Q.e.r-Q.s.r+1)+";X"+(Q.e.c-Q.s.c+1)+";D"+[Q.s.c,Q.s.r,Q.e.c,Q.e.r].join(" "));for(var ze=Q.s.r;ze<=Q.e.r;++ze)for(var Je=Q.s.c;Je<=Q.e.c;++Je){var ht=Kr({r:ze,c:Je});(he=le?(L[ze]||[])[Je]:L[ht])&&(null!=he.v||he.f&&!he.F)&&G.push(x(he,0,ze,Je))}return Y.join(me)+me+G.join(me)+me+"E"+me}}}(),G7=function(){function n(l,u){for(var g=l.split("\n"),x=-1,E=-1,D=0,R=[];D!==g.length;++D)if("BOT"!==g[D].trim()){if(!(x<0)){for(var L=g[D].trim().split(","),V=L[0],Y=L[1],G=g[++D]||"";1&(G.match(/["]/g)||[]).length&&D<g.length-1;)G+="\n"+g[++D];switch(G=G.trim(),+V){case-1:if("BOT"===G){R[++x]=[],E=0;continue}if("EOD"!==G)throw new Error("Unrecognized DIF special command "+G);break;case 0:R[x][E]="TRUE"===G||"FALSE"!==G&&(isNaN(Hf(Y))?isNaN(y2(Y).getDate())?Y:Lo(Y):Hf(Y)),++E;break;case 1:(G=(G=G.slice(1,G.length-1)).replace(/""/g,'"'))&&G.match(/^=".*"$/)&&(G=G.slice(2,-1)),R[x][E++]=""!==G?G:null}if("EOD"===G)break}}else R[++x]=[],E=0;return u&&u.sheetRows&&(R=R.slice(0,u.sheetRows)),R}function t(l,u){return b2(function e(l,u){switch(u.type){case"base64":return n(hd(l),u);case"binary":return n(l,u);case"buffer":return n(Bi&&Buffer.isBuffer(l)?l.toString("binary"):q0(l),u);case"array":return n(Ov(l),u)}throw new Error("Unrecognized type "+u.type)}(l,u),u)}return{to_workbook:function r(l,u){return J0(t(l,u),u)},to_sheet:t,from_sheet:function(){var l=function(x,E,D,R,L){x.push(E),x.push(D+","+R),x.push('"'+L.replace(/"/g,'""')+'"')},u=function(x,E,D,R){x.push(E+","+D),x.push(1==E?'"'+R.replace(/"/g,'""')+'"':R)};return function(x){var R,E=[],D=Qi(x["!ref"]),L=Array.isArray(x);l(E,"TABLE",0,1,"sheetjs"),l(E,"VECTORS",0,D.e.r-D.s.r+1,""),l(E,"TUPLES",0,D.e.c-D.s.c+1,""),l(E,"DATA",0,0,"");for(var V=D.s.r;V<=D.e.r;++V){u(E,-1,0,"BOT");for(var Y=D.s.c;Y<=D.e.c;++Y){var G=Kr({r:V,c:Y});if(R=L?(x[V]||[])[Y]:x[G])switch(R.t){case"n":var Q=R.w;!Q&&null!=R.v&&(Q=R.v),null==Q?u(E,1,0,R.f&&!R.F?"="+R.f:""):u(E,0,Q,"V");break;case"b":u(E,0,R.v?1:0,R.v?"TRUE":"FALSE");break;case"s":u(E,1,0,isNaN(R.v)?R.v:'="'+R.v+'"');break;case"d":R.w||(R.w=pd(R.z||$r[14],Ol(Lo(R.v)))),u(E,0,R.w,"V");break;default:u(E,1,0,"")}else u(E,1,0,"")}}return u(E,-1,0,"EOD"),E.join("\r\n")}}()}}(),W7=function(){function e(R){return R.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,"\n")}function n(R){return R.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function r(R,L){return b2(function t(R,L){for(var V=R.split("\n"),Y=-1,G=-1,Q=0,he=[];Q!==V.length;++Q){var le=V[Q].trim().split(":");if("cell"===le[0]){var me=wa(le[1]);if(he.length<=me.r)for(Y=he.length;Y<=me.r;++Y)he[Y]||(he[Y]=[]);switch(Y=me.r,G=me.c,le[2]){case"t":he[Y][G]=e(le[3]);break;case"v":he[Y][G]=+le[3];break;case"vtf":var ze=le[le.length-1];case"vtc":he[Y][G]="nl"===le[3]?!!+le[4]:+le[4],"vtf"==le[2]&&(he[Y][G]=[he[Y][G],ze])}}}return L&&L.sheetRows&&(he=he.slice(0,L.sheetRows)),he}(R,L),L)}var l=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join("\n"),u=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join("\n")+"\n",g=["# SocialCalc Spreadsheet Control Save","part:sheet"].join("\n"),x="--SocialCalcSpreadsheetControlSave--";function E(R){if(!R||!R["!ref"])return"";for(var Y,L=[],V=[],G="",Q=Kc(R["!ref"]),he=Array.isArray(R),le=Q.s.r;le<=Q.e.r;++le)for(var me=Q.s.c;me<=Q.e.c;++me)if(G=Kr({r:le,c:me}),(Y=he?(R[le]||[])[me]:R[G])&&null!=Y.v&&"z"!==Y.t){switch(V=["cell",G,"t"],Y.t){case"s":case"str":V.push(n(Y.v));break;case"n":Y.f?(V[2]="vtf",V[3]="n",V[4]=Y.v,V[5]=n(Y.f)):(V[2]="v",V[3]=Y.v);break;case"b":V[2]="vt"+(Y.f?"f":"c"),V[3]="nl",V[4]=Y.v?"1":"0",V[5]=n(Y.f||(Y.v?"TRUE":"FALSE"));break;case"d":var ze=Ol(Lo(Y.v));V[2]="vtc",V[3]="nd",V[4]=""+ze,V[5]=Y.w||pd(Y.z||$r[14],ze);break;case"e":continue}L.push(V.join(":"))}return L.push("sheet:c:"+(Q.e.c-Q.s.c+1)+":r:"+(Q.e.r-Q.s.r+1)+":tvf:1"),L.push("valueformat:1:text-wiki"),L.join("\n")}return{to_workbook:function i(R,L){return J0(r(R,L),L)},to_sheet:r,from_sheet:function D(R){return[l,u,g,u,E(R),x].join("\n")}}}(),E2=function(){function e(D,R,L,V,Y){Y.raw?R[L][V]=D:""===D||(R[L][V]="TRUE"===D||"FALSE"!==D&&(isNaN(Hf(D))?isNaN(y2(D).getDate())?D:Lo(D):Hf(D)))}var t={44:",",9:"\t",59:";",124:"|"},r={44:3,9:2,59:1,124:0};function i(D){for(var R={},L=!1,V=0,Y=0;V<D.length;++V)34==(Y=D.charCodeAt(V))?L=!L:!L&&Y in t&&(R[Y]=(R[Y]||0)+1);for(V in Y=[],R)Object.prototype.hasOwnProperty.call(R,V)&&Y.push([R[V],V]);if(!Y.length)for(V in R=r)Object.prototype.hasOwnProperty.call(R,V)&&Y.push([R[V],V]);return Y.sort(function(G,Q){return G[0]-Q[0]||r[G[1]]-r[Q[1]]}),t[Y.pop()[1]]||44}function u(D,R){return!R||!R.PRN||R.FS||"sep="==D.slice(0,4)||D.indexOf("\t")>=0||D.indexOf(",")>=0||D.indexOf(";")>=0?function l(D,R){var L=R||{},V="";null!=Qo&&null==L.dense&&(L.dense=Qo);var Y=L.dense?[]:{},G={s:{c:0,r:0},e:{c:0,r:0}};"sep="==D.slice(0,4)?13==D.charCodeAt(5)&&10==D.charCodeAt(6)?(V=D.charAt(4),D=D.slice(7)):13==D.charCodeAt(5)||10==D.charCodeAt(5)?(V=D.charAt(4),D=D.slice(6)):V=i(D.slice(0,1024)):V=L&&L.FS?L.FS:i(D.slice(0,1024));var Q=0,he=0,le=0,me=0,ze=0,Je=V.charCodeAt(0),ht=!1,Ne=0,dt=D.charCodeAt(0);D=D.replace(/\r\n/gm,"\n");var ft=null!=L.dateNF?function Wse(e){var n="number"==typeof e?$r[e]:e;return n=n.replace(fj,"(\\d+)"),new RegExp("^"+n+"$")}(L.dateNF):null;function kt(){var $t=D.slice(me,ze),vt={};if('"'==$t.charAt(0)&&'"'==$t.charAt($t.length-1)&&($t=$t.slice(1,-1).replace(/""/g,'"')),0===$t.length)vt.t="z";else if(L.raw)vt.t="s",vt.v=$t;else if(0===$t.trim().length)vt.t="s",vt.v=$t;else if(61==$t.charCodeAt(0))34==$t.charCodeAt(1)&&34==$t.charCodeAt($t.length-1)?(vt.t="s",vt.v=$t.slice(2,-1).replace(/""/g,'"')):function gde(e){return 1!=e.length}($t)?(vt.t="n",vt.f=$t.slice(1)):(vt.t="s",vt.v=$t);else if("TRUE"==$t)vt.t="b",vt.v=!0;else if("FALSE"==$t)vt.t="b",vt.v=!1;else if(isNaN(le=Hf($t)))if(!isNaN(y2($t).getDate())||ft&&$t.match(ft)){vt.z=L.dateNF||$r[14];var wn=0;ft&&$t.match(ft)&&($t=function qse(e,n,t){var r=-1,i=-1,l=-1,u=-1,g=-1,x=-1;(n.match(fj)||[]).forEach(function(R,L){var V=parseInt(t[L+1],10);switch(R.toLowerCase().charAt(0)){case"y":r=V;break;case"d":l=V;break;case"h":u=V;break;case"s":x=V;break;case"m":u>=0?g=V:i=V}}),x>=0&&-1==g&&i>=0&&(g=i,i=-1);var E=(""+(r>=0?r:(new Date).getFullYear())).slice(-4)+"-"+("00"+(i>=1?i:1)).slice(-2)+"-"+("00"+(l>=1?l:1)).slice(-2);7==E.length&&(E="0"+E),8==E.length&&(E="20"+E);var D=("00"+(u>=0?u:0)).slice(-2)+":"+("00"+(g>=0?g:0)).slice(-2)+":"+("00"+(x>=0?x:0)).slice(-2);return-1==u&&-1==g&&-1==x?E:-1==r&&-1==i&&-1==l?D:E+"T"+D}(0,L.dateNF,$t.match(ft)||[]),wn=1),L.cellDates?(vt.t="d",vt.v=Lo($t,wn)):(vt.t="n",vt.v=Ol(Lo($t,wn))),!1!==L.cellText&&(vt.w=pd(vt.z,vt.v instanceof Date?Ol(vt.v):vt.v)),L.cellNF||delete vt.z}else vt.t="s",vt.v=$t;else vt.t="n",!1!==L.cellText&&(vt.w=$t),vt.v=le;if("z"==vt.t||(L.dense?(Y[Q]||(Y[Q]=[]),Y[Q][he]=vt):Y[Kr({c:he,r:Q})]=vt),dt=D.charCodeAt(me=ze+1),G.e.c<he&&(G.e.c=he),G.e.r<Q&&(G.e.r=Q),Ne==Je)++he;else if(he=0,++Q,L.sheetRows&&L.sheetRows<=Q)return!0}e:for(;ze<D.length;++ze)switch(Ne=D.charCodeAt(ze)){case 34:34===dt&&(ht=!ht);break;case Je:case 10:case 13:if(!ht&&kt())break e}return ze-me>0&&kt(),Y["!ref"]=Ei(G),Y}(D,R):b2(function n(D,R){var L=R||{},V=[];if(!D||0===D.length)return V;for(var Y=D.split(/[\r\n]/),G=Y.length-1;G>=0&&0===Y[G].length;)--G;for(var Q=10,he=0,le=0;le<=G;++le)-1==(he=Y[le].indexOf(" "))?he=Y[le].length:he++,Q=Math.max(Q,he);for(le=0;le<=G;++le){V[le]=[];var me=0;for(e(Y[le].slice(0,Q).trim(),V,le,me,L),me=1;me<=(Y[le].length-Q)/10+1;++me)e(Y[le].slice(Q+10*(me-1),Q+10*me).trim(),V,le,me,L)}return L.sheetRows&&(V=V.slice(0,L.sheetRows)),V}(D,R),R)}function g(D,R){var L="",V="string"==R.type?[0,0,0,0]:function h4(e,n){var t="";switch((n||{}).type||"base64"){case"buffer":case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":t=hd(e.slice(0,12));break;case"binary":t=e;break;default:throw new Error("Unrecognized type "+(n&&n.type||"undefined"))}return[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3),t.charCodeAt(4),t.charCodeAt(5),t.charCodeAt(6),t.charCodeAt(7)]}(D,R);switch(R.type){case"base64":L=hd(D);break;case"binary":case"string":L=D;break;case"buffer":L=65001==R.codepage?D.toString("utf8"):R.codepage&&typeof is<"u"?is.utils.decode(R.codepage,D):Bi&&Buffer.isBuffer(D)?D.toString("binary"):q0(D);break;case"array":L=Ov(D);break;default:throw new Error("Unrecognized type "+R.type)}return 239==V[0]&&187==V[1]&&191==V[2]?L=_o(L.slice(3)):"string"!=R.type&&"buffer"!=R.type&&65001==R.codepage?L=_o(L):"binary"==R.type&&typeof is<"u"&&R.codepage&&(L=is.utils.decode(R.codepage,is.utils.encode(28591,L))),"socialcalc:version:"==L.slice(0,19)?W7.to_sheet("string"==R.type?L:_o(L),R):u(L,R)}return{to_workbook:function x(D,R){return J0(g(D,R),R)},to_sheet:g,from_sheet:function E(D){for(var V,R=[],L=Qi(D["!ref"]),Y=Array.isArray(D),G=L.s.r;G<=L.e.r;++G){for(var Q=[],he=L.s.c;he<=L.e.c;++he){var le=Kr({r:G,c:he});if((V=Y?(D[G]||[])[he]:D[le])&&null!=V.v){for(var me=(V.w||(rm(V),V.w)||"").slice(0,10);me.length<10;)me+=" ";Q.push(me+(0===he?" ":""))}else Q.push("          ")}R.push(Q.join(""))}return R.join("\n")}}}(),Hv=function(){function e(Ye,Nt,st){if(Ye){tc(Ye,Ye.l||0);for(var rt=st.Enum||Nr;Ye.l<Ye.length;){var on=Ye.read_shift(2),Gn=rt[on]||rt[65535],An=Ye.read_shift(2),On=Ye.l+An,gn=Gn.f&&Gn.f(Ye,An,st);if(Ye.l=On,Nt(gn,Gn,on))return}}}function t(Ye,Nt){if(!Ye)return Ye;var st=Nt||{};null!=Qo&&null==st.dense&&(st.dense=Qo);var rt=st.dense?[]:{},on="Sheet1",Gn="",An=0,On={},gn=[],fi=[],Xe={s:{r:0,c:0},e:{r:0,c:0}},ms=st.sheetRows||0;if(0==Ye[2]&&(8==Ye[3]||9==Ye[3])&&Ye.length>=16&&5==Ye[14]&&108===Ye[15])throw new Error("Unsupported Works 3 for Mac file");if(2==Ye[2])st.Enum=Nr,e(Ye,function(qn,zo,ku){switch(ku){case 0:st.vers=qn,qn>=4096&&(st.qpro=!0);break;case 6:Xe=qn;break;case 204:qn&&(Gn=qn);break;case 222:Gn=qn;break;case 15:case 51:st.qpro||(qn[1].v=qn[1].v.slice(1));case 13:case 14:case 16:14==ku&&!(112&~qn[2])&&(15&qn[2])>1&&(15&qn[2])<15&&(qn[1].z=st.dateNF||$r[14],st.cellDates&&(qn[1].t="d",qn[1].v=cF(qn[1].v))),st.qpro&&qn[3]>An&&(rt["!ref"]=Ei(Xe),On[on]=rt,gn.push(on),rt=st.dense?[]:{},Xe={s:{r:0,c:0},e:{r:0,c:0}},An=qn[3],on=Gn||"Sheet"+(An+1),Gn="");var Ll=st.dense?(rt[qn[0].r]||[])[qn[0].c]:rt[Kr(qn[0])];if(Ll){Ll.t=qn[1].t,Ll.v=qn[1].v,null!=qn[1].z&&(Ll.z=qn[1].z),null!=qn[1].f&&(Ll.f=qn[1].f);break}st.dense?(rt[qn[0].r]||(rt[qn[0].r]=[]),rt[qn[0].r][qn[0].c]=qn[1]):rt[Kr(qn[0])]=qn[1]}},st);else{if(26!=Ye[2]&&14!=Ye[2])throw new Error("Unrecognized LOTUS BOF "+Ye[2]);st.Enum=mn,14==Ye[2]&&(st.qpro=!0,Ye.l=0),e(Ye,function(qn,zo,ku){switch(ku){case 204:on=qn;break;case 22:qn[1].v=qn[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(qn[3]>An&&(rt["!ref"]=Ei(Xe),On[on]=rt,gn.push(on),rt=st.dense?[]:{},Xe={s:{r:0,c:0},e:{r:0,c:0}},on="Sheet"+((An=qn[3])+1)),ms>0&&qn[0].r>=ms)break;st.dense?(rt[qn[0].r]||(rt[qn[0].r]=[]),rt[qn[0].r][qn[0].c]=qn[1]):rt[Kr(qn[0])]=qn[1],Xe.e.c<qn[0].c&&(Xe.e.c=qn[0].c),Xe.e.r<qn[0].r&&(Xe.e.r=qn[0].r);break;case 27:qn[14e3]&&(fi[qn[14e3][0]]=qn[14e3][1]);break;case 1537:fi[qn[0]]=qn[1],qn[0]==An&&(on=qn[1])}},st)}if(rt["!ref"]=Ei(Xe),On[Gn||on]=rt,gn.push(Gn||on),!fi.length)return{SheetNames:gn,Sheets:On};for(var zi={},Ts=[],Ri=0;Ri<fi.length;++Ri)On[gn[Ri]]?(Ts.push(fi[Ri]||gn[Ri]),zi[fi[Ri]]=On[fi[Ri]]||On[gn[Ri]]):(Ts.push(fi[Ri]),zi[fi[Ri]]={"!ref":"A1"});return{SheetNames:Ts,Sheets:zi}}function E(Ye,Nt,st){var rt=[{c:0,r:0},{t:"n",v:0},0,0];return st.qpro&&20768!=st.vers?(rt[0].c=Ye.read_shift(1),rt[3]=Ye.read_shift(1),rt[0].r=Ye.read_shift(2),Ye.l+=2):(rt[2]=Ye.read_shift(1),rt[0].c=Ye.read_shift(2),rt[0].r=Ye.read_shift(2)),rt}function D(Ye,Nt,st){var rt=Ye.l+Nt,on=E(Ye,0,st);if(on[1].t="s",20768==st.vers){Ye.l++;var Gn=Ye.read_shift(1);return on[1].v=Ye.read_shift(Gn,"utf8"),on}return st.qpro&&Ye.l++,on[1].v=Ye.read_shift(rt-Ye.l,"cstr"),on}function R(Ye,Nt,st){var rt=nn(7+st.length);rt.write_shift(1,255),rt.write_shift(2,Nt),rt.write_shift(2,Ye),rt.write_shift(1,39);for(var on=0;on<rt.length;++on){var Gn=st.charCodeAt(on);rt.write_shift(1,Gn>=128?95:Gn)}return rt.write_shift(1,0),rt}function V(Ye,Nt,st){var rt=nn(7);return rt.write_shift(1,255),rt.write_shift(2,Nt),rt.write_shift(2,Ye),rt.write_shift(2,st,"i"),rt}function G(Ye,Nt,st){var rt=nn(13);return rt.write_shift(1,255),rt.write_shift(2,Nt),rt.write_shift(2,Ye),rt.write_shift(8,st,"f"),rt}function he(Ye,Nt,st){var rt=32768&Nt;return Nt=(rt?Ye:0)+((Nt&=-32769)>=8192?Nt-16384:Nt),(rt?"":"$")+(st?yo(Nt):ra(Nt))}var le={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},me=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function Je(Ye){var Nt=[{c:0,r:0},{t:"n",v:0},0];return Nt[0].r=Ye.read_shift(2),Nt[3]=Ye[Ye.l++],Nt[0].c=Ye[Ye.l++],Nt}function Ne(Ye,Nt,st,rt){var on=nn(6+rt.length);on.write_shift(2,Ye),on.write_shift(1,st),on.write_shift(1,Nt),on.write_shift(1,39);for(var Gn=0;Gn<rt.length;++Gn){var An=rt.charCodeAt(Gn);on.write_shift(1,An>=128?95:An)}return on.write_shift(1,0),on}function ft(Ye,Nt){var st=Je(Ye),rt=Ye.read_shift(4),on=Ye.read_shift(4),Gn=Ye.read_shift(2);if(65535==Gn)return 0===rt&&3221225472===on?(st[1].t="e",st[1].v=15):0===rt&&3489660928===on?(st[1].t="e",st[1].v=42):st[1].v=0,st;var An=32768&Gn;return Gn=(32767&Gn)-16446,st[1].v=(1-2*An)*(on*Math.pow(2,Gn+32)+rt*Math.pow(2,Gn)),st}function kt(Ye,Nt,st,rt){var on=nn(14);if(on.write_shift(2,Ye),on.write_shift(1,st),on.write_shift(1,Nt),0==rt)return on.write_shift(4,0),on.write_shift(4,0),on.write_shift(2,65535),on;var Gn=0,An=0,gn=0;return rt<0&&(Gn=1,rt=-rt),An=0|Math.log2(rt),2147483648&(gn=(rt/=Math.pow(2,An-31))>>>0)||(++An,gn=(rt/=2)>>>0),rt-=gn,gn|=2147483648,gn>>>=0,rt*=Math.pow(2,32),on.write_shift(4,rt>>>0),on.write_shift(4,gn),on.write_shift(2,An+=16383+(Gn?32768:0)),on}function wn(Ye,Nt){var st=Je(Ye),rt=Ye.read_shift(8,"f");return st[1].v=rt,st}function Nn(Ye,Nt){return 0==Ye[Ye.l+Nt-1]?Ye.read_shift(Nt,"cstr"):""}function Hn(Ye,Nt){var st=nn(5+Ye.length);st.write_shift(2,14e3),st.write_shift(2,Nt);for(var rt=0;rt<Ye.length;++rt){var on=Ye.charCodeAt(rt);st[st.l++]=on>127?95:on}return st[st.l++]=0,st}var Nr={0:{n:"BOF",f:Za},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:function g(Ye,Nt,st){var rt={s:{c:0,r:0},e:{c:0,r:0}};return 8==Nt&&st.qpro?(rt.s.c=Ye.read_shift(1),Ye.l++,rt.s.r=Ye.read_shift(2),rt.e.c=Ye.read_shift(1),Ye.l++,rt.e.r=Ye.read_shift(2),rt):(rt.s.c=Ye.read_shift(2),rt.s.r=Ye.read_shift(2),12==Nt&&st.qpro&&(Ye.l+=2),rt.e.c=Ye.read_shift(2),rt.e.r=Ye.read_shift(2),12==Nt&&st.qpro&&(Ye.l+=2),65535==rt.s.c&&(rt.s.c=rt.e.c=rt.s.r=rt.e.r=0),rt)}},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:function L(Ye,Nt,st){var rt=E(Ye,0,st);return rt[1].v=Ye.read_shift(2,"i"),rt}},14:{n:"NUMBER",f:function Y(Ye,Nt,st){var rt=E(Ye,0,st);return rt[1].v=Ye.read_shift(8,"f"),rt}},15:{n:"LABEL",f:D},16:{n:"FORMULA",f:function Q(Ye,Nt,st){var rt=Ye.l+Nt,on=E(Ye,0,st);if(on[1].v=Ye.read_shift(8,"f"),st.qpro)Ye.l=rt;else{var Gn=Ye.read_shift(2);(function ze(Ye,Nt){tc(Ye,0);for(var st=[],rt=0,on="",Gn="",An="",On="";Ye.l<Ye.length;){var gn=Ye[Ye.l++];switch(gn){case 0:st.push(Ye.read_shift(8,"f"));break;case 1:Gn=he(Nt[0].c,Ye.read_shift(2),!0),on=he(Nt[0].r,Ye.read_shift(2),!1),st.push(Gn+on);break;case 2:var fi=he(Nt[0].c,Ye.read_shift(2),!0),Xe=he(Nt[0].r,Ye.read_shift(2),!1);Gn=he(Nt[0].c,Ye.read_shift(2),!0),on=he(Nt[0].r,Ye.read_shift(2),!1),st.push(fi+Xe+":"+Gn+on);break;case 3:if(Ye.l<Ye.length)return void console.error("WK1 premature formula end");break;case 4:st.push("("+st.pop()+")");break;case 5:st.push(Ye.read_shift(2));break;case 6:for(var ms="";gn=Ye[Ye.l++];)ms+=String.fromCharCode(gn);st.push('"'+ms.replace(/"/g,'""')+'"');break;case 8:st.push("-"+st.pop());break;case 23:st.push("+"+st.pop());break;case 22:st.push("NOT("+st.pop()+")");break;case 20:case 21:On=st.pop(),An=st.pop(),st.push(["AND","OR"][gn-20]+"("+An+","+On+")");break;default:if(gn<32&&me[gn])On=st.pop(),An=st.pop(),st.push(An+me[gn]+On);else{if(!le[gn])return gn<=7?console.error("WK1 invalid opcode "+gn.toString(16)):gn<=24?console.error("WK1 unsupported op "+gn.toString(16)):gn<=30?console.error("WK1 invalid opcode "+gn.toString(16)):gn<=115?console.error("WK1 unsupported function opcode "+gn.toString(16)):console.error("WK1 unrecognized opcode "+gn.toString(16));if(69==(rt=le[gn][1])&&(rt=Ye[Ye.l++]),rt>st.length)return void console.error("WK1 bad formula parse 0x"+gn.toString(16)+":|"+st.join("|")+"|");var zi=st.slice(-rt);st.length-=rt,st.push(le[gn][0]+"("+zi.join(",")+")")}}}1==st.length?Nt[1].f=""+st[0]:console.error("WK1 bad formula parse |"+st.join("|")+"|")})(Ye.slice(Ye.l,Ye.l+Gn),on),Ye.l+=Gn}return on}},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:D},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:Nn},222:{n:"SHEETNAMELP",f:function gr(Ye,Nt){var st=Ye[Ye.l++];st>Nt-1&&(st=Nt-1);for(var rt="";rt.length<st;)rt+=String.fromCharCode(Ye[Ye.l++]);return rt}},65535:{n:""}},mn={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:function ht(Ye,Nt){var st=Je(Ye);return st[1].t="s",st[1].v=Ye.read_shift(Nt-4,"cstr"),st}},23:{n:"NUMBER17",f:ft},24:{n:"NUMBER18",f:function dt(Ye,Nt){var st=Je(Ye);st[1].v=Ye.read_shift(2);var rt=st[1].v>>1;if(1&st[1].v)switch(7&rt){case 0:rt=5e3*(rt>>3);break;case 1:rt=500*(rt>>3);break;case 2:rt=(rt>>3)/20;break;case 3:rt=(rt>>3)/200;break;case 4:rt=(rt>>3)/2e3;break;case 5:rt=(rt>>3)/2e4;break;case 6:rt=(rt>>3)/16;break;case 7:rt=(rt>>3)/64}return st[1].v=rt,st}},25:{n:"FORMULA19",f:function $t(Ye,Nt){var st=ft(Ye);return Ye.l+=Nt-14,st}},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:function Si(Ye,Nt){for(var st={},rt=Ye.l+Nt;Ye.l<rt;){var on=Ye.read_shift(2);if(14e3==on){for(st[on]=[0,""],st[on][0]=Ye.read_shift(2);Ye[Ye.l];)st[on][1]+=String.fromCharCode(Ye[Ye.l]),Ye.l++;Ye.l++}}return st}},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:function vt(Ye,Nt){var st=Je(Ye),rt=Ye.read_shift(4);return st[1].v=rt>>6,st}},38:{n:"??"},39:{n:"NUMBER27",f:wn},40:{n:"FORMULA28",f:function Xn(Ye,Nt){var st=wn(Ye);return Ye.l+=Nt-10,st}},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:Nn},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:function Kn(Ye,Nt,st){if(st.qpro&&!(Nt<21)){var rt=Ye.read_shift(1);return Ye.l+=17,Ye.l+=1,Ye.l+=2,[rt,Ye.read_shift(Nt-21,"cstr")]}}},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:function r(Ye,Nt){var st=Nt||{};if(+st.codepage>=0&&Dh(+st.codepage),"string"==st.type)throw new Error("Cannot write WK1 to JS string");var rt=Yc(),on=Qi(Ye["!ref"]),Gn=Array.isArray(Ye),An=[];Un(rt,0,function l(Ye){var Nt=nn(2);return Nt.write_shift(2,Ye),Nt}(1030)),Un(rt,6,function x(Ye){var Nt=nn(8);return Nt.write_shift(2,Ye.s.c),Nt.write_shift(2,Ye.s.r),Nt.write_shift(2,Ye.e.c),Nt.write_shift(2,Ye.e.r),Nt}(on));for(var On=Math.min(on.e.r,8191),gn=on.s.r;gn<=On;++gn)for(var fi=ra(gn),Xe=on.s.c;Xe<=on.e.c;++Xe){gn===on.s.r&&(An[Xe]=yo(Xe));var zi=Gn?(Ye[gn]||[])[Xe]:Ye[An[Xe]+fi];zi&&"z"!=zi.t&&("n"==zi.t?(0|zi.v)==zi.v&&zi.v>=-32768&&zi.v<=32767?Un(rt,13,V(gn,Xe,zi.v)):Un(rt,14,G(gn,Xe,zi.v)):Un(rt,15,R(gn,Xe,rm(zi).slice(0,239))))}return Un(rt,1),rt.end()},book_to_wk3:function i(Ye,Nt){var st=Nt||{};if(+st.codepage>=0&&Dh(+st.codepage),"string"==st.type)throw new Error("Cannot write WK3 to JS string");var rt=Yc();Un(rt,0,function u(Ye){var Nt=nn(26);Nt.write_shift(2,4096),Nt.write_shift(2,4),Nt.write_shift(4,0);for(var st=0,rt=0,on=0,Gn=0;Gn<Ye.SheetNames.length;++Gn){var On=Ye.Sheets[Ye.SheetNames[Gn]];if(On&&On["!ref"]){++on;var gn=Kc(On["!ref"]);st<gn.e.r&&(st=gn.e.r),rt<gn.e.c&&(rt=gn.e.c)}}return st>8191&&(st=8191),Nt.write_shift(2,st),Nt.write_shift(1,on),Nt.write_shift(1,rt),Nt.write_shift(2,0),Nt.write_shift(2,0),Nt.write_shift(1,1),Nt.write_shift(1,2),Nt.write_shift(4,0),Nt.write_shift(4,0),Nt}(Ye));for(var on=0,Gn=0;on<Ye.SheetNames.length;++on)(Ye.Sheets[Ye.SheetNames[on]]||{})["!ref"]&&Un(rt,27,Hn(Ye.SheetNames[on],Gn++));var An=0;for(on=0;on<Ye.SheetNames.length;++on){var On=Ye.Sheets[Ye.SheetNames[on]];if(On&&On["!ref"]){for(var gn=Qi(On["!ref"]),fi=Array.isArray(On),Xe=[],ms=Math.min(gn.e.r,8191),zi=gn.s.r;zi<=ms;++zi)for(var Ts=ra(zi),Ri=gn.s.c;Ri<=gn.e.c;++Ri){zi===gn.s.r&&(Xe[Ri]=yo(Ri));var zo=fi?(On[zi]||[])[Ri]:On[Xe[Ri]+Ts];zo&&"z"!=zo.t&&("n"==zo.t?Un(rt,23,kt(zi,Ri,An,zo.v)):Un(rt,22,Ne(zi,Ri,An,rm(zo).slice(0,239))))}++An}}return Un(rt,1),rt.end()},to_workbook:function n(Ye,Nt){switch(Nt.type){case"base64":return t(fd(hd(Ye)),Nt);case"binary":return t(fd(Ye),Nt);case"buffer":case"array":return t(Ye,Nt)}throw"Unsupported type "+Nt.type}}}(),vce=/^\s|\s$|[\t\n\r]/;function Z7(e,n){if(!n.bookSST)return"";var t=[na];t[t.length]=Fn("sst",null,{xmlns:K0[0],count:e.Count,uniqueCount:e.Unique});for(var r=0;r!=e.length;++r)if(null!=e[r]){var i=e[r],l="<si>";i.r?l+=i.r:(l+="<t",i.t||(i.t=""),i.t.match(vce)&&(l+=' xml:space="preserve"'),l+=">"+Rs(i.t)+"</t>"),t[t.length]=l+="</si>"}return t.length>2&&(t[t.length]="</sst>",t[1]=t[1].replace("/>",">")),t.join("")}var Tce=function Poe(e,n){var t=!1;return null==n&&(t=!0,n=nn(15+4*e.t.length)),n.write_shift(1,0),Rl(e.t,n),t?n.slice(0,n.l):n};function Ece(e){var n=Yc();pn(n,159,function wce(e,n){return n||(n=nn(8)),n.write_shift(4,e.Count),n.write_shift(4,e.Unique),n}(e));for(var t=0;t<e.length;++t)pn(n,19,Tce(e[t]));return pn(n,160),n.end()}function $F(e){var t,l,n=0,r=function X7(e){if(typeof is<"u")return is.utils.encode(Iv,e);for(var n=[],t=e.split(""),r=0;r<t.length;++r)n[r]=t[r].charCodeAt(0);return n}(e),i=r.length+1;for((t=W0(i))[0]=r.length,l=1;l!=i;++l)t[l]=r[l-1];for(l=i-1;l>=0;--l)n=((16384&n?1:0)|n<<1&32767)^t[l];return 52811^n}var Q7=function(){function e(i,l){switch(l.type){case"base64":return n(hd(i),l);case"binary":return n(i,l);case"buffer":return n(Bi&&Buffer.isBuffer(i)?i.toString("binary"):q0(i),l);case"array":return n(Ov(i),l)}throw new Error("Unrecognized type "+l.type)}function n(i,l){var g=(l||{}).dense?[]:{},x=i.match(/\\trowd.*?\\row\b/g);if(!x.length)throw new Error("RTF missing table");var E={s:{c:0,r:0},e:{c:0,r:x.length-1}};return x.forEach(function(D,R){Array.isArray(g)&&(g[R]=[]);for(var Y,L=/\\\w+\b/g,V=0,G=-1;Y=L.exec(D);){if("\\cell"===Y[0]){var Q=D.slice(V,L.lastIndex-Y[0].length);if(" "==Q[0]&&(Q=Q.slice(1)),++G,Q.length){var he={v:Q,t:"s"};Array.isArray(g)?g[R][G]=he:g[Kr({r:R,c:G})]=he}}V=L.lastIndex}G>E.e.c&&(E.e.c=G)}),g["!ref"]=Ei(E),g}return{to_workbook:function t(i,l){return J0(e(i,l),l)},to_sheet:e,from_sheet:function r(i){for(var g,l=["{\\rtf1\\ansi"],u=Qi(i["!ref"]),x=Array.isArray(i),E=u.s.r;E<=u.e.r;++E){l.push("\\trowd\\trautofit1");for(var D=u.s.c;D<=u.e.c;++D)l.push("\\cellx"+(D+1));for(l.push("\\pard\\intbl"),D=u.s.c;D<=u.e.c;++D){var R=Kr({r:E,c:D});(g=x?(i[E]||[])[D]:i[R])&&(null!=g.v||g.f&&!g.F)&&(l.push(" "+(g.w||(rm(g),g.w))),l.push("\\cell"))}l.push("\\pard\\intbl\\row")}return l.join("")+"}"}}}();function $S(e){for(var n=0,t=1;3!=n;++n)t=256*t+(e[n]>255?255:e[n]<0?0:e[n]);return t.toString(16).toUpperCase().slice(1)}var Dc=6;function HS(e){return Math.floor((e+Math.round(128/Dc)/256)*Dc)}function GS(e){return Math.floor((e-5)/Dc*100+.5)/100}function eO(e){return Math.round((e*Dc+5)/Dc*256)/256}function e1(e){e.width?(e.wpx=HS(e.width),e.wch=GS(e.wpx),e.MDW=Dc):e.wpx?(e.wch=GS(e.wpx),e.width=eO(e.wch),e.MDW=Dc):"number"==typeof e.wch&&(e.width=eO(e.wch),e.wpx=HS(e.width),e.MDW=Dc),e.customWidth&&delete e.customWidth}var t9=96;function WS(e){return 96*e/t9}function tO(e){return e*t9/96}function n9(e,n){var r,t=[na,Fn("styleSheet",null,{xmlns:K0[0],"xmlns:vt":qa.vt})];return e.SSF&&null!=(r=function Xce(e){var n=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(t){for(var r=t[0];r<=t[1];++r)null!=e[r]&&(n[n.length]=Fn("numFmt",null,{numFmtId:r,formatCode:Rs(e[r])}))}),1===n.length?"":(n[n.length]="</numFmts>",n[0]=Fn("numFmts",null,{count:n.length-2}).replace("/>",">"),n.join(""))}(e.SSF))&&(t[t.length]=r),t[t.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',t[t.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',t[t.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',t[t.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(r=function Yce(e){var n=[];return n[n.length]=Fn("cellXfs",null),e.forEach(function(t){n[n.length]=Fn("xf",null,t)}),n[n.length]="</cellXfs>",2===n.length?"":(n[0]=Fn("cellXfs",null,{count:n.length-2}).replace("/>",">"),n.join(""))}(n.cellXfs))&&(t[t.length]=r),t[t.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',t[t.length]='<dxfs count="0"/>',t[t.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',t.length>2&&(t[t.length]="</styleSheet>",t[1]=t[1].replace("/>",">")),t.join("")}function Qce(e,n,t){t||(t=nn(6+4*n.length)),t.write_shift(2,e),Rl(n,t);var r=t.length>t.l?t.slice(0,t.l):t;return null==t.l&&(t.l=t.length),r}var WF,nue=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],rue=Tc;function r9(e,n){n||(n=nn(84)),WF||(WF=Lk(nue));var t=WF[e.patternType];null==t&&(t=40),n.write_shift(4,t);var r=0;if(40!=t)for(Hk({auto:1},n),Hk({auto:1},n);r<12;++r)n.write_shift(4,0);else{for(;r<4;++r)n.write_shift(4,0);for(;r<12;++r)n.write_shift(4,0)}return n.length>n.l?n.slice(0,n.l):n}function i9(e,n,t){return t||(t=nn(16)),t.write_shift(2,n||0),t.write_shift(2,e.numFmtId||0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(1,0),t}function qS(e,n){return n||(n=nn(10)),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(4,0),n.write_shift(4,0),n}var sue=Tc;function vue(e,n){var t=Yc();return pn(t,278),function uue(e,n){if(n){var t=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var i=r[0];i<=r[1];++i)null!=n[i]&&++t}),0!=t&&(pn(e,615,Gf(t)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var i=r[0];i<=r[1];++i)null!=n[i]&&pn(e,44,Qce(i,n[i]))}),pn(e,616))}}(t,e.SSF),function due(e){pn(e,611,Gf(1)),pn(e,43,function tue(e,n){n||(n=nn(153)),n.write_shift(2,20*e.sz),function Voe(e,n){n||(n=nn(2)),n.write_shift(1,(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0)),n.write_shift(1,0)}(e,n),n.write_shift(2,e.bold?700:400);var t=0;"superscript"==e.vertAlign?t=1:"subscript"==e.vertAlign&&(t=2),n.write_shift(2,t),n.write_shift(1,e.underline||0),n.write_shift(1,e.family||0),n.write_shift(1,e.charset||0),n.write_shift(1,0),Hk(e.color,n);var r=0;return"major"==e.scheme&&(r=1),"minor"==e.scheme&&(r=2),n.write_shift(1,r),Rl(e.name,n),n.length>n.l?n.slice(0,n.l):n}({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),pn(e,612)}(t),function hue(e){pn(e,603,Gf(2)),pn(e,45,r9({patternType:"none"})),pn(e,45,r9({patternType:"gray125"})),pn(e,604)}(t),function fue(e){pn(e,613,Gf(1)),pn(e,46,function oue(e,n){return n||(n=nn(51)),n.write_shift(1,0),qS(0,n),qS(0,n),qS(0,n),qS(0,n),qS(0,n),n.length>n.l?n.slice(0,n.l):n}()),pn(e,614)}(t),function pue(e){pn(e,626,Gf(1)),pn(e,47,i9({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),pn(e,627)}(t),function mue(e,n){pn(e,617,Gf(n.length)),n.forEach(function(t){pn(e,47,i9(t,0))}),pn(e,618)}(t,n.cellXfs),function gue(e){pn(e,619,Gf(1)),pn(e,48,function aue(e,n){return n||(n=nn(52)),n.write_shift(4,e.xfId),n.write_shift(2,1),n.write_shift(1,+e.builtinId),n.write_shift(1,0),$k(e.name||"",n),n.length>n.l?n.slice(0,n.l):n}({xfId:0,builtinId:0,name:"Normal"})),pn(e,620)}(t),function _ue(e){pn(e,505,Gf(0)),pn(e,506)}(t),function yue(e){pn(e,508,function lue(e,n,t){var r=nn(2052);return r.write_shift(4,e),$k(n,r),$k(t,r),r.length>r.l?r.slice(0,r.l):r}(0,"TableStyleMedium9","PivotStyleMedium4")),pn(e,509)}(t),pn(t,279),t.end()}function qF(e,n){if(n&&n.themeXLSX)return n.themeXLSX;if(e&&"string"==typeof e.raw)return e.raw;var t=[na];return t[t.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',t[t.length]="<a:themeElements>",t[t.length]='<a:clrScheme name="Office">',t[t.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',t[t.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',t[t.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',t[t.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',t[t.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',t[t.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',t[t.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',t[t.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',t[t.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',t[t.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',t[t.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',t[t.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',t[t.length]="</a:clrScheme>",t[t.length]='<a:fontScheme name="Office">',t[t.length]="<a:majorFont>",t[t.length]='<a:latin typeface="Cambria"/>',t[t.length]='<a:ea typeface=""/>',t[t.length]='<a:cs typeface=""/>',t[t.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',t[t.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',t[t.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',t[t.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',t[t.length]='<a:font script="Arab" typeface="Times New Roman"/>',t[t.length]='<a:font script="Hebr" typeface="Times New Roman"/>',t[t.length]='<a:font script="Thai" typeface="Tahoma"/>',t[t.length]='<a:font script="Ethi" typeface="Nyala"/>',t[t.length]='<a:font script="Beng" typeface="Vrinda"/>',t[t.length]='<a:font script="Gujr" typeface="Shruti"/>',t[t.length]='<a:font script="Khmr" typeface="MoolBoran"/>',t[t.length]='<a:font script="Knda" typeface="Tunga"/>',t[t.length]='<a:font script="Guru" typeface="Raavi"/>',t[t.length]='<a:font script="Cans" typeface="Euphemia"/>',t[t.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',t[t.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',t[t.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',t[t.length]='<a:font script="Thaa" typeface="MV Boli"/>',t[t.length]='<a:font script="Deva" typeface="Mangal"/>',t[t.length]='<a:font script="Telu" typeface="Gautami"/>',t[t.length]='<a:font script="Taml" typeface="Latha"/>',t[t.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',t[t.length]='<a:font script="Orya" typeface="Kalinga"/>',t[t.length]='<a:font script="Mlym" typeface="Kartika"/>',t[t.length]='<a:font script="Laoo" typeface="DokChampa"/>',t[t.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',t[t.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',t[t.length]='<a:font script="Viet" typeface="Times New Roman"/>',t[t.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',t[t.length]='<a:font script="Geor" typeface="Sylfaen"/>',t[t.length]="</a:majorFont>",t[t.length]="<a:minorFont>",t[t.length]='<a:latin typeface="Calibri"/>',t[t.length]='<a:ea typeface=""/>',t[t.length]='<a:cs typeface=""/>',t[t.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',t[t.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',t[t.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',t[t.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',t[t.length]='<a:font script="Arab" typeface="Arial"/>',t[t.length]='<a:font script="Hebr" typeface="Arial"/>',t[t.length]='<a:font script="Thai" typeface="Tahoma"/>',t[t.length]='<a:font script="Ethi" typeface="Nyala"/>',t[t.length]='<a:font script="Beng" typeface="Vrinda"/>',t[t.length]='<a:font script="Gujr" typeface="Shruti"/>',t[t.length]='<a:font script="Khmr" typeface="DaunPenh"/>',t[t.length]='<a:font script="Knda" typeface="Tunga"/>',t[t.length]='<a:font script="Guru" typeface="Raavi"/>',t[t.length]='<a:font script="Cans" typeface="Euphemia"/>',t[t.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',t[t.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',t[t.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',t[t.length]='<a:font script="Thaa" typeface="MV Boli"/>',t[t.length]='<a:font script="Deva" typeface="Mangal"/>',t[t.length]='<a:font script="Telu" typeface="Gautami"/>',t[t.length]='<a:font script="Taml" typeface="Latha"/>',t[t.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',t[t.length]='<a:font script="Orya" typeface="Kalinga"/>',t[t.length]='<a:font script="Mlym" typeface="Kartika"/>',t[t.length]='<a:font script="Laoo" typeface="DokChampa"/>',t[t.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',t[t.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',t[t.length]='<a:font script="Viet" typeface="Arial"/>',t[t.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',t[t.length]='<a:font script="Geor" typeface="Sylfaen"/>',t[t.length]="</a:minorFont>",t[t.length]="</a:fontScheme>",t[t.length]='<a:fmtScheme name="Office">',t[t.length]="<a:fillStyleLst>",t[t.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:lin ang="16200000" scaled="1"/>',t[t.length]="</a:gradFill>",t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:lin ang="16200000" scaled="0"/>',t[t.length]="</a:gradFill>",t[t.length]="</a:fillStyleLst>",t[t.length]="<a:lnStyleLst>",t[t.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]="</a:lnStyleLst>",t[t.length]="<a:effectStyleLst>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]="</a:effectStyle>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]="</a:effectStyle>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',t[t.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',t[t.length]="</a:effectStyle>",t[t.length]="</a:effectStyleLst>",t[t.length]="<a:bgFillStyleLst>",t[t.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',t[t.length]="</a:gradFill>",t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',t[t.length]="</a:gradFill>",t[t.length]="</a:bgFillStyleLst>",t[t.length]="</a:fmtScheme>",t[t.length]="</a:themeElements>",t[t.length]="<a:objectDefaults>",t[t.length]="<a:spDef>",t[t.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',t[t.length]="</a:spDef>",t[t.length]="<a:lnDef>",t[t.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',t[t.length]="</a:lnDef>",t[t.length]="</a:objectDefaults>",t[t.length]="<a:extraClrSchemeLst/>",t[t.length]="</a:theme>",t.join("")}function Gue(){var e=Yc();return pn(e,332),pn(e,334,Gf(1)),pn(e,335,function Bue(e){var n=nn(12+2*e.name.length);return n.write_shift(4,e.flags),n.write_shift(4,e.version),Rl(e.name,n),n.slice(0,n.l)}({name:"XLDAPR",version:12e4,flags:3496657072})),pn(e,336),pn(e,339,function Vue(e,n){var t=nn(8+2*n.length);return t.write_shift(4,e),Rl(n,t),t.slice(0,t.l)}(1,"XLDAPR")),pn(e,52),pn(e,35,Gf(514)),pn(e,4096,Gf(0)),pn(e,4097,kh(1)),pn(e,36),pn(e,53),pn(e,340),pn(e,337,function $ue(e,n){var t=nn(8);return t.write_shift(4,e),t.write_shift(4,n?1:0),t}(1,!0)),pn(e,51,function Uue(e){var n=nn(4+8*e.length);n.write_shift(4,e.length);for(var t=0;t<e.length;++t)n.write_shift(4,e[t][0]),n.write_shift(4,e[t][1]);return n}([[1,0]])),pn(e,338),pn(e,333),e.end()}function o9(){var e=[na];return e.push('<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">\n  <metadataTypes count="1">\n    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>\n  </metadataTypes>\n  <futureMetadata name="XLDAPR" count="1">\n    <bk>\n      <extLst>\n        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">\n          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>\n        </ext>\n      </extLst>\n    </bk>\n  </futureMetadata>\n  <cellMetadata count="1">\n    <bk>\n      <rc t="1" v="0"/>\n    </bk>\n  </cellMetadata>\n</metadata>'),e.join("")}var C2=1024;function a9(e,n){for(var t=[21600,21600],r=["m0,0l0",t[1],t[0],t[1],t[0],"0xe"].join(","),i=[Fn("xml",null,{"xmlns:v":gd.v,"xmlns:o":gd.o,"xmlns:x":gd.x,"xmlns:mv":gd.mv}).replace(/\/>/,">"),Fn("o:shapelayout",Fn("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),Fn("v:shapetype",[Fn("v:stroke",null,{joinstyle:"miter"}),Fn("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:t.join(","),path:r})];C2<1e3*e;)C2+=1e3;return n.forEach(function(l){var u=wa(l[0]),g={color2:"#BEFF82",type:"gradient"};"gradient"==g.type&&(g.angle="-180");var x="gradient"==g.type?Fn("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,E=Fn("v:fill",x,g);++C2,i=i.concat(["<v:shape"+RS({id:"_x0000_s"+C2,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(l[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",E,Fn("v:shadow",null,{on:"t",obscured:"t"}),Fn("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",ec("x:Anchor",[u.c+1,0,u.r+1,0,u.c+3,20,u.r+5,20].join(",")),ec("x:AutoFill","False"),ec("x:Row",String(u.r)),ec("x:Column",String(u.c)),l[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),i.push("</xml>"),i.join("")}function c9(e){var n=[na,Fn("comments",null,{xmlns:K0[0]})],t=[];return n.push("<authors>"),e.forEach(function(r){r[1].forEach(function(i){var l=Rs(i.a);-1==t.indexOf(l)&&(t.push(l),n.push("<author>"+l+"</author>")),i.T&&i.ID&&-1==t.indexOf("tc="+i.ID)&&(t.push("tc="+i.ID),n.push("<author>tc="+i.ID+"</author>"))})}),0==t.length&&(t.push("SheetJ5"),n.push("<author>SheetJ5</author>")),n.push("</authors>"),n.push("<commentList>"),e.forEach(function(r){var i=0,l=[];if(r[1][0]&&r[1][0].T&&r[1][0].ID?i=t.indexOf("tc="+r[1][0].ID):r[1].forEach(function(x){x.a&&(i=t.indexOf(Rs(x.a))),l.push(x.t||"")}),n.push('<comment ref="'+r[0]+'" authorId="'+i+'"><text>'),l.length<=1)n.push(ec("t",Rs(l[0]||"")));else{for(var u="Comment:\n    "+l[0]+"\n",g=1;g<l.length;++g)u+="Reply:\n    "+l[g]+"\n";n.push(ec("t",Rs(u)))}n.push("</text></comment>")}),n.push("</commentList>"),n.length>2&&(n[n.length]="</comments>",n[1]=n[1].replace("/>",">")),n.join("")}function ede(e,n,t){var r=[na,Fn("ThreadedComments",null,{xmlns:qa.TCMNT}).replace(/[\/]>/,">")];return e.forEach(function(i){var l="";(i[1]||[]).forEach(function(u,g){if(u.T){u.a&&-1==n.indexOf(u.a)&&n.push(u.a);var x={ref:i[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+t.tcid++).slice(-12)+"}"};0==g?l=x.id:x.parentId=l,u.ID=x.id,u.a&&(x.personId="{54EE7950-7262-4200-6969-"+("000000000000"+n.indexOf(u.a)).slice(-12)+"}"),r.push(Fn("threadedComment",ec("text",u.t||""),x))}else delete u.ID})}),r.push("</ThreadedComments>"),r.join("")}var sde=Ec;function lde(e){var n=Yc(),t=[];return pn(n,628),pn(n,630),e.forEach(function(r){r[1].forEach(function(i){t.indexOf(i.a)>-1||(t.push(i.a.slice(0,54)),pn(n,632,function ode(e){return Rl(e.slice(0,54))}(i.a)))})}),pn(n,631),pn(n,633),e.forEach(function(r){r[1].forEach(function(i){i.iauthor=t.indexOf(i.a);var l={s:wa(r[0]),e:wa(r[0])};pn(n,635,function ide(e,n){return null==n&&(n=nn(36)),n.write_shift(4,e[1].iauthor),w2(e[0],n),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n}([l,i])),i.t&&i.t.length>0&&pn(n,637,function Noe(e,n){var t=!1;return null==n&&(t=!0,n=nn(23+4*e.t.length)),n.write_shift(1,1),Rl(e.t,n),n.write_shift(4,1),function Ooe(e,n){n||(n=nn(4)),n.write_shift(2,e.ich||0),n.write_shift(2,e.ifnt||0)}({ich:0,ifnt:0},n),t?n.slice(0,n.l):n}(i)),pn(n,636),delete i.iauthor})}),pn(n,634),pn(n,629),n.end()}var u9=["xlsb","xlsm","xlam","biff8","xla"],S2=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,n={r:0,c:0};function t(r,i,l,u){var g=!1,x=!1;0==l.length?x=!0:"["==l.charAt(0)&&(x=!0,l=l.slice(1,-1)),0==u.length?g=!0:"["==u.charAt(0)&&(g=!0,u=u.slice(1,-1));var E=l.length>0?0|parseInt(l,10):0,D=u.length>0?0|parseInt(u,10):0;return g?D+=n.c:--D,x?E+=n.r:--E,i+(g?"":"$")+yo(D)+(x?"":"$")+ra(E)}return function(i,l){return n=l,i.replace(e,t)}}(),ZF=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,XF=function(){return function(n,t){return n.replace(ZF,function(r,i,l,u,g,x){var E=CF(u)-(l?0:t.c),D=EF(x)-(g?0:t.r);return i+"R"+(0==D?"":g?D+1:"["+D+"]")+"C"+(0==E?"":l?E+1:"["+E+"]")})}}();function d9(e,n){return e.replace(ZF,function(t,r,i,l,u,g){return r+("$"==i?i+l:yo(CF(l)+n.c))+("$"==u?u+g:ra(EF(g)+n.r))})}function Xa(e){e.l+=1}function t1(e,n){var t=e.read_shift(1==n?1:2);return[16383&t,t>>14&1,t>>15&1]}function h9(e,n,t){var r=2;if(t){if(t.biff>=2&&t.biff<=5)return f9(e);12==t.biff&&(r=4)}var i=e.read_shift(r),l=e.read_shift(r),u=t1(e,2),g=t1(e,2);return{s:{r:i,c:u[0],cRel:u[1],rRel:u[2]},e:{r:l,c:g[0],cRel:g[1],rRel:g[2]}}}function f9(e){var n=t1(e,2),t=t1(e,2),r=e.read_shift(1),i=e.read_shift(1);return{s:{r:n[0],c:r,cRel:n[1],rRel:n[2]},e:{r:t[0],c:i,cRel:t[1],rRel:t[2]}}}function p9(e,n,t){if(t&&t.biff>=2&&t.biff<=5)return function yde(e){var n=t1(e,2),t=e.read_shift(1);return{r:n[0],c:t,cRel:n[1],rRel:n[2]}}(e);var r=e.read_shift(t&&12==t.biff?4:2),i=t1(e,2);return{r,c:i[0],cRel:i[1],rRel:i[2]}}function vde(e){var n=e.read_shift(2),t=e.read_shift(2);return{r:n,c:255&t,fQuoted:!!(16384&t),cRel:t>>15,rRel:t>>15}}function m9(e){var n=1&e[e.l+1];return e.l+=4,[n,1]}function g9(e){return[e.read_shift(1),e.read_shift(1)]}function Zde(e,n){var t=[e.read_shift(1)];if(12==n)switch(t[0]){case 2:t[0]=4;break;case 4:t[0]=16;break;case 0:t[0]=1;break;case 1:t[0]=2}switch(t[0]){case 4:t[1]=function Ta(e,n){return 1===e.read_shift(n)}(e,1)?"TRUE":"FALSE",12!=n&&(e.l+=7);break;case 37:case 16:t[1]=Ug[e[e.l]],e.l+=12==n?4:8;break;case 0:e.l+=8;break;case 1:t[1]=Cc(e);break;case 2:t[1]=function jv(e,n,t){if(t.biff>5)return function jS(e,n,t){var r=e.read_shift(t&&2==t.biff?1:2);return 0===r?(e.l++,""):function Vv(e,n,t){if(t){if(t.biff>=2&&t.biff<=5)return e.read_shift(n,"cpstr");if(t.biff>=12)return e.read_shift(n,"dbcs-cont")}var i=e.read_shift(1);return e.read_shift(n,0===i?"sbcs-cont":"dbcs-cont")}(e,r,t)}(e,0,t);var r=e.read_shift(1);return 0===r?(e.l++,""):e.read_shift(r,t.biff<=4||!e.lens?"cpstr":"sbcs-cont")}(e,0,{biff:n>0&&n<8?2:n});break;default:throw new Error("Bad SerAr: "+t[0])}return t}function Xde(e,n,t){for(var r=e.read_shift(12==t.biff?4:2),i=[],l=0;l!=r;++l)i.push((12==t.biff?Lv:Kk)(e,8));return i}function Yde(e,n,t){var r=0,i=0;12==t.biff?(r=e.read_shift(4),i=e.read_shift(4)):(i=1+e.read_shift(1),r=1+e.read_shift(2)),t.biff>=2&&t.biff<8&&(--r,0==--i&&(i=256));for(var l=0,u=[];l!=r&&(u[l]=[]);++l)for(var g=0;g!=i;++g)u[l][g]=Zde(e,t.biff);return u}function ZS(e,n,t){return e.l+=2,[vde(e)]}function YF(e){return e.l+=6,[]}function _9(e){return e.l+=2,[Za(e),1&e.read_shift(2)]}var ghe=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"],y9={1:{n:"PtgExp",f:function jde(e,n,t){return e.l++,t&&12==t.biff?[e.read_shift(4,"i"),0]:[e.read_shift(2),e.read_shift(t&&2==t.biff?1:2)]}},2:{n:"PtgTbl",f:Tc},3:{n:"PtgAdd",f:Xa},4:{n:"PtgSub",f:Xa},5:{n:"PtgMul",f:Xa},6:{n:"PtgDiv",f:Xa},7:{n:"PtgPower",f:Xa},8:{n:"PtgConcat",f:Xa},9:{n:"PtgLt",f:Xa},10:{n:"PtgLe",f:Xa},11:{n:"PtgEq",f:Xa},12:{n:"PtgGe",f:Xa},13:{n:"PtgGt",f:Xa},14:{n:"PtgNe",f:Xa},15:{n:"PtgIsect",f:Xa},16:{n:"PtgUnion",f:Xa},17:{n:"PtgRange",f:Xa},18:{n:"PtgUplus",f:Xa},19:{n:"PtgUminus",f:Xa},20:{n:"PtgPercent",f:Xa},21:{n:"PtgParen",f:Xa},22:{n:"PtgMissArg",f:Xa},23:{n:"PtgStr",f:function qde(e,n,t){return e.l++,VS(e,0,t)}},26:{n:"PtgSheet",f:function vhe(e,n,t){return e.l+=5,e.l+=2,e.l+=2==t.biff?1:4,["PTGSHEET"]}},27:{n:"PtgEndSheet",f:function xhe(e,n,t){return e.l+=2==t.biff?4:5,["PTGENDSHEET"]}},28:{n:"PtgErr",f:function $de(e){return e.l++,Ug[e.read_shift(1)]}},29:{n:"PtgBool",f:function Gde(e){return e.l++,0!==e.read_shift(1)}},30:{n:"PtgInt",f:function Hde(e){return e.l++,e.read_shift(2)}},31:{n:"PtgNum",f:function Wde(e){return e.l++,Cc(e)}},32:{n:"PtgArray",f:function Dde(e,n,t){var r=(96&e[e.l++])>>5;return e.l+=2==t.biff?6:12==t.biff?14:7,[r]}},33:{n:"PtgFunc",f:function Bde(e,n,t){var r=(96&e[e.l])>>5;e.l+=1;var i=e.read_shift(t&&t.biff<=3?1:2);return[Vhe[i],b9[i],r]}},34:{n:"PtgFuncVar",f:function zde(e,n,t){var r=e[e.l++],i=e.read_shift(1),l=t&&t.biff<=3?[88==r?-1:0,e.read_shift(1)]:function Ude(e){return[e[e.l+1]>>7,32767&e.read_shift(2)]}(e);return[i,(0===l[0]?b9:Uhe)[l[1]]]}},35:{n:"PtgName",f:function Kde(e,n,t){var r=e.read_shift(1)>>>5&3,l=e.read_shift(!t||t.biff>=8?4:2);switch(t.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12}return[r,0,l]}},36:{n:"PtgRef",f:function Nde(e,n,t){var r=(96&e[e.l])>>5;return e.l+=1,[r,p9(e,0,t)]}},37:{n:"PtgArea",f:function wde(e,n,t){return[(96&e[e.l++])>>5,h9(e,0,t)]}},38:{n:"PtgMemArea",f:function ehe(e,n,t){var r=e.read_shift(1)>>>5&3;return e.l+=t&&2==t.biff?3:4,[r,e.read_shift(t&&2==t.biff?1:2)]}},39:{n:"PtgMemErr",f:Tc},40:{n:"PtgMemNoMem",f:Tc},41:{n:"PtgMemFunc",f:function the(e,n,t){return[e.read_shift(1)>>>5&3,e.read_shift(t&&2==t.biff?1:2)]}},42:{n:"PtgRefErr",f:function nhe(e,n,t){var r=e.read_shift(1)>>>5&3;return e.l+=4,t.biff<8&&e.l--,12==t.biff&&(e.l+=2),[r]}},43:{n:"PtgAreaErr",f:function Ede(e,n,t){var r=(96&e[e.l++])>>5;return e.l+=t&&t.biff>8?12:t.biff<8?6:8,[r]}},44:{n:"PtgRefN",f:function Fde(e,n,t){var r=(96&e[e.l])>>5;e.l+=1;var i=function xde(e,n,t){var r=t&&t.biff?t.biff:8;if(r>=2&&r<=5)return function bde(e){var n=e.read_shift(2),t=e.read_shift(1),r=(32768&n)>>15,i=(16384&n)>>14;return n&=16383,1==r&&n>=8192&&(n-=16384),1==i&&t>=128&&(t-=256),{r:n,c:t,cRel:i,rRel:r}}(e);var i=e.read_shift(r>=12?4:2),l=e.read_shift(2),u=(16384&l)>>14,g=(32768&l)>>15;if(l&=16383,1==g)for(;i>524287;)i-=1048576;if(1==u)for(;l>8191;)l-=16384;return{r:i,c:l,cRel:u,rRel:g}}(e,0,t);return[r,i]}},45:{n:"PtgAreaN",f:function Sde(e,n,t){var r=(96&e[e.l++])>>5,i=function _de(e,n,t){if(t.biff<8)return f9(e);var r=e.read_shift(12==t.biff?4:2),i=e.read_shift(12==t.biff?4:2),l=t1(e,2),u=t1(e,2);return{s:{r,c:l[0],cRel:l[1],rRel:l[2]},e:{r:i,c:u[0],cRel:u[1],rRel:u[2]}}}(e,0,t);return[r,i]}},46:{n:"PtgMemAreaN",f:function bhe(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},47:{n:"PtgMemNoMemN",f:function whe(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},57:{n:"PtgNameX",f:function Jde(e,n,t){return 5==t.biff?function Qde(e){var n=e.read_shift(1)>>>5&3,t=e.read_shift(2,"i");e.l+=8;var r=e.read_shift(2);return e.l+=12,[n,t,r]}(e):[e.read_shift(1)>>>5&3,e.read_shift(2),e.read_shift(4)]}},58:{n:"PtgRef3d",f:function Lde(e,n,t){var r=(96&e[e.l])>>5;e.l+=1;var i=e.read_shift(2);return t&&5==t.biff&&(e.l+=12),[r,i,p9(e,0,t)]}},59:{n:"PtgArea3d",f:function Tde(e,n,t){var r=(96&e[e.l++])>>5,i=e.read_shift(2,"i");if(t&&5===t.biff)e.l+=12;return[r,i,h9(e,0,t)]}},60:{n:"PtgRefErr3d",f:function rhe(e,n,t){var r=(96&e[e.l++])>>5,i=e.read_shift(2),l=4;if(t)switch(t.biff){case 5:l=15;break;case 12:l=6}return e.l+=l,[r,i]}},61:{n:"PtgAreaErr3d",f:function Cde(e,n,t){var r=(96&e[e.l++])>>5,i=e.read_shift(2),l=8;if(t)switch(t.biff){case 5:e.l+=12,l=6;break;case 12:l=12}return e.l+=l,[r,i]}},255:{}},Ehe={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Che={1:{n:"PtgElfLel",f:_9},2:{n:"PtgElfRw",f:ZS},3:{n:"PtgElfCol",f:ZS},6:{n:"PtgElfRwV",f:ZS},7:{n:"PtgElfColV",f:ZS},10:{n:"PtgElfRadical",f:ZS},11:{n:"PtgElfRadicalS",f:YF},13:{n:"PtgElfColS",f:YF},15:{n:"PtgElfColSV",f:YF},16:{n:"PtgElfRadicalLel",f:_9},25:{n:"PtgList",f:function _he(e){e.l+=2;var n=e.read_shift(2),t=e.read_shift(2),r=e.read_shift(4),i=e.read_shift(2),l=e.read_shift(2);return{ixti:n,coltype:3&t,rt:ghe[t>>2&31],idx:r,c:i,C:l}}},29:{n:"PtgSxName",f:function yhe(e){return e.l+=2,[e.read_shift(4)]}},255:{}},She={0:{n:"PtgAttrNoop",f:function The(e){return e.l+=4,[0,0]}},1:{n:"PtgAttrSemi",f:function Ode(e,n,t){var r=255&e[e.l+1]?1:0;return e.l+=t&&2==t.biff?3:4,[r]}},2:{n:"PtgAttrIf",f:function Ide(e,n,t){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(t&&2==t.biff?1:2)]}},4:{n:"PtgAttrChoose",f:function Mde(e,n,t){e.l+=2;for(var r=e.read_shift(t&&2==t.biff?1:2),i=[],l=0;l<=r;++l)i.push(e.read_shift(t&&2==t.biff?1:2));return i}},8:{n:"PtgAttrGoto",f:function Ade(e,n,t){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(t&&2==t.biff?1:2)]}},16:{n:"PtgAttrSum",f:function Vde(e,n,t){e.l+=t&&2==t.biff?3:4}},32:{n:"PtgAttrBaxcel",f:m9},33:{n:"PtgAttrBaxcel",f:m9},64:{n:"PtgAttrSpace",f:function Pde(e){return e.read_shift(2),g9(e)}},65:{n:"PtgAttrSpaceSemi",f:function Rde(e){return e.read_shift(2),g9(e)}},128:{n:"PtgAttrIfError",f:function kde(e){var n=255&e[e.l+1]?1:0;return e.l+=2,[n,e.read_shift(2)]}},255:{}};function XS(e,n,t,r){if(r.biff<8)return Tc(e,n);for(var i=e.l+n,l=[],u=0;u!==t.length;++u)switch(t[u][0]){case"PtgArray":t[u][1]=Yde(e,0,r),l.push(t[u][1]);break;case"PtgMemArea":t[u][2]=Xde(e,0,r),l.push(t[u][2]);break;case"PtgExp":r&&12==r.biff&&(t[u][1][1]=e.read_shift(4),l.push(t[u][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+t[u][0]}return 0!=(n=i-e.l)&&l.push(Tc(e,n)),l}function Dhe(e){for(var n=[],t=0;t<e.length;++t){for(var r=e[t],i=[],l=0;l<r.length;++l){var u=r[l];i.push(u?2===u[0]?'"'+u[1].replace(/"/g,'""')+'"':u[1]:"")}n.push(i.join(","))}return n.join(";")}var Mhe={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function v9(e,n,t){if(!e)return"SH33TJSERR0";if(t.biff>8&&(!e.XTI||!e.XTI[n]))return e.SheetNames[n];if(!e.XTI)return"SH33TJSERR6";var r=e.XTI[n];if(t.biff<8)return n>1e4&&(n-=65536),n<0&&(n=-n),0==n?"":e.XTI[n-1];if(!r)return"SH33TJSERR1";var i="";if(t.biff>8)switch(e[r[0]][0]){case 357:return i=-1==r[1]?"#REF":e.SheetNames[r[1]],r[1]==r[2]?i:i+":"+e.SheetNames[r[2]];case 358:return null!=t.SID?e.SheetNames[t.SID]:"SH33TJSSAME"+e[r[0]][0];default:return"SH33TJSSRC"+e[r[0]][0]}switch(e[r[0]][0][0]){case 1025:return i=-1==r[1]?"#REF":e.SheetNames[r[1]]||"SH33TJSERR3",r[1]==r[2]?i:i+":"+e.SheetNames[r[2]];case 14849:return e[r[0]].slice(1).map(function(l){return l.Name}).join(";;");default:return e[r[0]][0][3]?(i=-1==r[1]?"#REF":e[r[0]][0][3][r[1]]||"SH33TJSERR4",r[1]==r[2]?i:i+":"+e[r[0]][0][3][r[2]]):"SH33TJSERR2"}}function x9(e,n,t){var r=v9(e,n,t);return"#REF"==r?r:function Ahe(e,n){if(!(e||n&&n.biff<=5&&n.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}(r,t)}function Mc(e,n,t,r,i){var x,E,D,V,l=i&&i.biff||8,u={s:{c:0,r:0},e:{c:0,r:0}},g=[],R=0,L=0,Y="";if(!e[0]||!e[0][0])return"";for(var G=-1,Q="",he=0,le=e[0].length;he<le;++he){var me=e[0][he];switch(me[0]){case"PtgUminus":g.push("-"+g.pop());break;case"PtgUplus":g.push("+"+g.pop());break;case"PtgPercent":g.push(g.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(x=g.pop(),E=g.pop(),G>=0){switch(e[0][G][1][0]){case 0:Q=ta(" ",e[0][G][1][1]);break;case 1:Q=ta("\r",e[0][G][1][1]);break;default:if(Q="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][G][1][0])}E+=Q,G=-1}g.push(E+Mhe[me[0]]+x);break;case"PtgIsect":x=g.pop(),E=g.pop(),g.push(E+" "+x);break;case"PtgUnion":x=g.pop(),E=g.pop(),g.push(E+","+x);break;case"PtgRange":x=g.pop(),E=g.pop(),g.push(E+":"+x);break;case"PtgAttrChoose":case"PtgAttrGoto":case"PtgAttrIf":case"PtgAttrIfError":case"PtgAttrBaxcel":case"PtgAttrSemi":case"PtgMemArea":case"PtgTbl":case"PtgMemErr":case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":case"PtgMemFunc":case"PtgMemNoMem":break;case"PtgRef":D=LS(me[1][1],u,i),g.push(BS(D,l));break;case"PtgRefN":D=t?LS(me[1][1],t,i):me[1][1],g.push(BS(D,l));break;case"PtgRef3d":R=me[1][1],D=LS(me[1][2],u,i),Y=x9(r,R,i),g.push(Y+"!"+BS(D,l));break;case"PtgFunc":case"PtgFuncVar":var Je=me[1][0],ht=me[1][1];Je||(Je=0);var Ne=0==(Je&=127)?[]:g.slice(-Je);g.length-=Je,"User"===ht&&(ht=Ne.shift()),g.push(ht+"("+Ne.join(",")+")");break;case"PtgBool":g.push(me[1]?"TRUE":"FALSE");break;case"PtgInt":case"PtgErr":g.push(me[1]);break;case"PtgNum":g.push(String(me[1]));break;case"PtgStr":g.push('"'+me[1].replace(/"/g,'""')+'"');break;case"PtgAreaN":V=Zj(me[1][1],t?{s:t}:u,i),g.push(TF(V,i));break;case"PtgArea":V=Zj(me[1][1],u,i),g.push(TF(V,i));break;case"PtgArea3d":V=me[1][2],Y=x9(r,R=me[1][1],i),g.push(Y+"!"+TF(V,i));break;case"PtgAttrSum":g.push("SUM("+g.pop()+")");break;case"PtgName":var dt=(r.names||[])[(L=me[1][2])-1]||(r[0]||[])[L],ft=dt?dt.Name:"SH33TJSNAME"+String(L);ft&&"_xlfn."==ft.slice(0,6)&&!i.xlfn&&(ft=ft.slice(6)),g.push(ft);break;case"PtgNameX":var $t,kt=me[1][1];if(L=me[1][2],!(i.biff<=5)){var vt="";if(14849==((r[kt]||[])[0]||[])[0]||(1025==((r[kt]||[])[0]||[])[0]?r[kt][L]&&r[kt][L].itab>0&&(vt=r.SheetNames[r[kt][L].itab-1]+"!"):vt=r.SheetNames[L-1]+"!"),r[kt]&&r[kt][L])vt+=r[kt][L].Name;else if(r[0]&&r[0][L])vt+=r[0][L].Name;else{var wn=(v9(r,kt,i)||"").split(";;");wn[L-1]?vt=wn[L-1]:vt+="SH33TJSERRX"}g.push(vt);break}kt<0&&(kt=-kt),r[kt]&&($t=r[kt][L]),$t||($t={Name:"SH33TJSERRY"}),g.push($t.Name);break;case"PtgParen":var Xn="(",Nn=")";if(G>=0){switch(Q="",e[0][G][1][0]){case 2:Xn=ta(" ",e[0][G][1][1])+Xn;break;case 3:Xn=ta("\r",e[0][G][1][1])+Xn;break;case 4:Nn=ta(" ",e[0][G][1][1])+Nn;break;case 5:Nn=ta("\r",e[0][G][1][1])+Nn;break;default:if(i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][G][1][0])}G=-1}g.push(Xn+g.pop()+Nn);break;case"PtgRefErr":case"PtgRefErr3d":case"PtgAreaErr":case"PtgAreaErr3d":g.push("#REF!");break;case"PtgExp":var gr={c:t.c,r:t.r};if(r.sharedf[Kr(D={c:me[1][1],r:me[1][0]})]){var Kn=r.sharedf[Kr(D)];g.push(Mc(Kn,0,gr,r,i))}else{var Si=!1;for(x=0;x!=r.arrayf.length;++x)if(!(D.c<(E=r.arrayf[x])[0].s.c||D.c>E[0].e.c||D.r<E[0].s.r||D.r>E[0].e.r)){g.push(Mc(E[1],0,gr,r,i)),Si=!0;break}Si||g.push(me[1])}break;case"PtgArray":g.push("{"+Dhe(me[1])+"}");break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":G=he;break;case"PtgMissArg":g.push("");break;case"PtgList":g.push("Table"+me[1].idx+"[#"+me[1].rt+"]");break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");default:throw new Error("Unrecognized Formula Token: "+String(me))}if(3!=i.biff&&G>=0&&-1==["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"].indexOf(e[0][he][0])){var Nr=!0;switch((me=e[0][G])[1][0]){case 4:Nr=!1;case 0:Q=ta(" ",me[1][1]);break;case 5:Nr=!1;case 1:Q=ta("\r",me[1][1]);break;default:if(Q="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+me[1][0])}g.push((Nr?Q:"")+g.pop()+(Nr?"":Q)),G=-1}}if(g.length>1&&i.WTF)throw new Error("bad formula stack");return g[0]}function iO(e,n,t){var r=e.read_shift(4),i=function YS(e,n,t){for(var i,l,r=e.l+n,u=[];r!=e.l;)n=r-e.l,i=y9[l=e[e.l]]||y9[Ehe[l]],(24===l||25===l)&&(i=(24===l?Che:She)[e[e.l+1]]),i&&i.f?u.push([i.n,i.f(e,n,t)]):Tc(e,n);return u}(e,r,t),l=e.read_shift(4);return[i,l>0?XS(e,l,i,t):null]}var Lhe=iO,sO=iO,Bhe=iO,zhe=iO,Uhe={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},b9={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Vhe={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function jhe(e){return("of:="+e.replace(ZF,"$1[.$2$3$4$5]").replace(/\]:\[/g,":")).replace(/;/g,"|").replace(/,/g,";")}function $he(e){return e.replace(/\./,"!")}var KS=typeof Map<"u";function QF(e,n,t){var r=0,i=e.length;if(t){if(KS?t.has(n):Object.prototype.hasOwnProperty.call(t,n))for(var l=KS?t.get(n):t[n];r<l.length;++r)if(e[l[r]].t===n)return e.Count++,l[r]}else for(;r<i;++r)if(e[r].t===n)return e.Count++,r;return e[i]={t:n},e.Count++,e.Unique++,t&&(KS?(t.has(n)||t.set(n,[]),t.get(n).push(i)):(Object.prototype.hasOwnProperty.call(t,n)||(t[n]=[]),t[n].push(i))),i}function aO(e,n){var t={min:e+1,max:e+1},r=-1;return n.MDW&&(Dc=n.MDW),null!=n.width?t.customWidth=1:null!=n.wpx?r=GS(n.wpx):null!=n.wch&&(r=n.wch),r>-1?(t.width=eO(r),t.customWidth=1):null!=n.width&&(t.width=n.width),n.hidden&&(t.hidden=!0),null!=n.level&&(t.outlineLevel=t.level=n.level),t}function Gv(e,n){if(e){var t=[.7,.7,.75,.75,.3,.3];"xlml"==n&&(t=[1,1,1,1,.5,.5]),null==e.left&&(e.left=t[0]),null==e.right&&(e.right=t[1]),null==e.top&&(e.top=t[2]),null==e.bottom&&(e.bottom=t[3]),null==e.header&&(e.header=t[4]),null==e.footer&&(e.footer=t[5])}}function n1(e,n,t){var r=t.revssf[null!=n.z?n.z:"General"],i=60,l=e.length;if(null==r&&t.ssf)for(;i<392;++i)if(null==t.ssf[i]){em(n.z,i),t.ssf[i]=n.z,t.revssf[n.z]=r=i;break}for(i=0;i!=l;++i)if(e[i].numFmtId===r)return i;return e[l]={numFmtId:r,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},l}function Ghe(e,n,t){if(e&&e["!ref"]){var r=Qi(e["!ref"]);if(r.e.c<r.s.c||r.e.r<r.s.r)throw new Error("Bad range ("+t+"): "+e["!ref"])}}var ofe=["objects","scenarios","selectLockedCells","selectUnlockedCells"],afe=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function vfe(e,n,t,r){if(e.c&&t["!comments"].push([n,e.c]),void 0===e.v&&"string"!=typeof e.f||"z"===e.t&&!e.f)return"";var i="",l=e.t,u=e.v;if("z"!==e.t)switch(e.t){case"b":i=e.v?"1":"0";break;case"n":i=""+e.v;break;case"e":i=Ug[e.v];break;case"d":r&&r.cellDates?i=Lo(e.v,-1).toISOString():((e=Qs(e)).t="n",i=""+(e.v=Ol(Lo(e.v)))),typeof e.z>"u"&&(e.z=$r[14]);break;default:i=e.v}var g=ec("v",Rs(i)),x={r:n},E=n1(r.cellXfs,e,r);switch(0!==E&&(x.s=E),e.t){case"n":case"z":break;case"d":x.t="d";break;case"b":x.t="b";break;case"e":x.t="e";break;default:if(null==e.v){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(r&&r.bookSST){g=ec("v",""+QF(r.Strings,e.v,r.revStrings)),x.t="s";break}x.t="str"}if(e.t!=l&&(e.t=l,e.v=u),"string"==typeof e.f&&e.f){var D=e.F&&e.F.slice(0,n.length)==n?{t:"array",ref:e.F}:null;g=Fn("f",Rs(e.f),D)+(null!=e.v?g:"")}return e.l&&t["!links"].push([n,e.l]),e.D&&(x.cm=1),Fn("c",g,x)}function E9(e,n,t,r){var u,i=[na,Fn("worksheet",null,{xmlns:K0[0],"xmlns:r":qa.r})],g="",x=t.Sheets[t.SheetNames[e]];null==x&&(x={});var E=x["!ref"]||"A1",D=Qi(E);if(D.e.c>16383||D.e.r>1048575){if(n.WTF)throw new Error("Range "+E+" exceeds format limit A1:XFD1048576");D.e.c=Math.min(D.e.c,16383),D.e.r=Math.min(D.e.c,1048575),E=Ei(D)}r||(r={}),x["!comments"]=[];var R=[];(function sfe(e,n,t,r,i){var l=!1,u={},g=null;if("xlsx"!==r.bookType&&n.vbaraw){var x=n.SheetNames[t];try{n.Workbook&&(x=n.Workbook.Sheets[t].CodeName||x)}catch{}l=!0,u.codeName=nm(Rs(x))}if(e&&e["!outline"]){var E={summaryBelow:1,summaryRight:1};e["!outline"].above&&(E.summaryBelow=0),e["!outline"].left&&(E.summaryRight=0),g=(g||"")+Fn("outlinePr",null,E)}!l&&!g||(i[i.length]=Fn("sheetPr",g,u))})(x,t,e,n,i),i[i.length]=Fn("dimension",null,{ref:E}),i[i.length]=function yfe(e,n,t,r){var i={workbookViewId:"0"};return(((r||{}).Workbook||{}).Views||[])[0]&&(i.rightToLeft=r.Workbook.Views[0].RTL?"1":"0"),Fn("sheetViews",Fn("sheetView",null,i),{})}(0,0,0,t),n.sheetFormat&&(i[i.length]=Fn("sheetFormatPr",null,{defaultRowHeight:n.sheetFormat.defaultRowHeight||"16",baseColWidth:n.sheetFormat.baseColWidth||"10",outlineLevelRow:n.sheetFormat.outlineLevelRow||"7"})),null!=x["!cols"]&&x["!cols"].length>0&&(i[i.length]=function ffe(e,n){for(var r,t=["<cols>"],i=0;i!=n.length;++i)(r=n[i])&&(t[t.length]=Fn("col",null,aO(i,r)));return t[t.length]="</cols>",t.join("")}(0,x["!cols"])),i[u=i.length]="<sheetData/>",x["!links"]=[],null!=x["!ref"]&&(g=function bfe(e,n,t,r){var x,Q,i=[],l=[],u=Qi(e["!ref"]),g="",E="",D=[],R=0,L=0,V=e["!rows"],Y=Array.isArray(e),G={r:E},he=-1;for(L=u.s.c;L<=u.e.c;++L)D[L]=yo(L);for(R=u.s.r;R<=u.e.r;++R){for(l=[],E=ra(R),L=u.s.c;L<=u.e.c;++L){x=D[L]+E;var le=Y?(e[R]||[])[L]:e[x];void 0!==le&&null!=(g=vfe(le,x,e,n))&&l.push(g)}(l.length>0||V&&V[R])&&(G={r:E},V&&V[R]&&((Q=V[R]).hidden&&(G.hidden=1),he=-1,Q.hpx?he=WS(Q.hpx):Q.hpt&&(he=Q.hpt),he>-1&&(G.ht=he,G.customHeight=1),Q.level&&(G.outlineLevel=Q.level)),i[i.length]=Fn("row",l.join(""),G))}if(V)for(;R<V.length;++R)V&&V[R]&&(G={r:R+1},(Q=V[R]).hidden&&(G.hidden=1),he=-1,Q.hpx?he=WS(Q.hpx):Q.hpt&&(he=Q.hpt),he>-1&&(G.ht=he,G.customHeight=1),Q.level&&(G.outlineLevel=Q.level),i[i.length]=Fn("row","",G));return i.join("")}(x,n),g.length>0&&(i[i.length]=g)),i.length>u+1&&(i[i.length]="</sheetData>",i[u]=i[u].replace("/>",">")),x["!protect"]&&(i[i.length]=function lfe(e){var n={sheet:1};return ofe.forEach(function(t){null!=e[t]&&e[t]&&(n[t]="1")}),afe.forEach(function(t){null!=e[t]&&!e[t]&&(n[t]="0")}),e.password&&(n.password=$F(e.password).toString(16).toUpperCase()),Fn("sheetProtection",null,n)}(x["!protect"])),null!=x["!autofilter"]&&(i[i.length]=function mfe(e,n,t,r){var i="string"==typeof e.ref?e.ref:Ei(e.ref);t.Workbook||(t.Workbook={Sheets:[]}),t.Workbook.Names||(t.Workbook.Names=[]);var l=t.Workbook.Names,u=Kc(i);u.s.r==u.e.r&&(u.e.r=Kc(n["!ref"]).e.r,i=Ei(u));for(var g=0;g<l.length;++g){var x=l[g];if("_xlnm._FilterDatabase"==x.Name&&x.Sheet==r){x.Ref="'"+t.SheetNames[r]+"'!"+i;break}}return g==l.length&&l.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+t.SheetNames[r]+"'!"+i}),Fn("autoFilter",null,{ref:i})}(x["!autofilter"],x,t,e)),null!=x["!merges"]&&x["!merges"].length>0&&(i[i.length]=function rfe(e){if(0===e.length)return"";for(var n='<mergeCells count="'+e.length+'">',t=0;t!=e.length;++t)n+='<mergeCell ref="'+Ei(e[t])+'"/>';return n+"</mergeCells>"}(x["!merges"]));var V,L=-1,Y=-1;return x["!links"].length>0&&(i[i.length]="<hyperlinks>",x["!links"].forEach(function(G){G[1].Target&&(V={ref:G[0]},"#"!=G[1].Target.charAt(0)&&(Y=Ds(r,-1,Rs(G[1].Target).replace(/#.*$/,""),Ci.HLINK),V["r:id"]="rId"+Y),(L=G[1].Target.indexOf("#"))>-1&&(V.location=Rs(G[1].Target.slice(L+1))),G[1].Tooltip&&(V.tooltip=Rs(G[1].Tooltip)),i[i.length]=Fn("hyperlink",null,V))}),i[i.length]="</hyperlinks>"),delete x["!links"],null!=x["!margins"]&&(i[i.length]=function dfe(e){return Gv(e),Fn("pageMargins",null,e)}(x["!margins"])),(!n||n.ignoreEC||null==n.ignoreEC)&&(i[i.length]=ec("ignoredErrors",Fn("ignoredError",null,{numberStoredAsText:1,sqref:E}))),R.length>0&&(Y=Ds(r,-1,"../drawings/drawing"+(e+1)+".xml",Ci.DRAW),i[i.length]=Fn("drawing",null,{"r:id":"rId"+Y}),x["!drawing"]=R),x["!comments"].length>0&&(Y=Ds(r,-1,"../drawings/vmlDrawing"+(e+1)+".vml",Ci.VML),i[i.length]=Fn("legacyDrawing",null,{"r:id":"rId"+Y}),x["!legacy"]=Y),i.length>1&&(i[i.length]="</worksheet>",i[1]=i[1].replace("/>",">")),i.join("")}function Efe(e,n,t,r){var i=function Tfe(e,n,t){var r=nn(145),i=(t["!rows"]||[])[e]||{};r.write_shift(4,e),r.write_shift(4,0);var l=320;i.hpx?l=20*WS(i.hpx):i.hpt&&(l=20*i.hpt),r.write_shift(2,l),r.write_shift(1,0);var u=0;i.level&&(u|=i.level),i.hidden&&(u|=16),(i.hpx||i.hpt)&&(u|=32),r.write_shift(1,u),r.write_shift(1,0);var g=0,x=r.l;r.l+=4;for(var E={r:e,c:0},D=0;D<16;++D)if(!(n.s.c>D+1<<10||n.e.c<D<<10)){for(var R=-1,L=-1,V=D<<10;V<D+1<<10;++V)E.c=V,(Array.isArray(t)?(t[E.r]||[])[E.c]:t[Kr(E)])&&(R<0&&(R=V),L=V);R<0||(++g,r.write_shift(4,R),r.write_shift(4,L))}var G=r.l;return r.l=x,r.write_shift(4,g),r.l=G,r.length>r.l?r.slice(0,r.l):r}(r,t,n);(i.length>17||(n["!rows"]||[])[r])&&pn(e,0,i)}var Cfe=Lv,Sfe=w2;var lpe=Lv,cpe=w2,S9=["left","right","top","bottom","header","footer"];function Spe(e,n,t,r,i,l,u){if(void 0===n.v)return!1;var g="";switch(n.t){case"b":g=n.v?"1":"0";break;case"d":(n=Qs(n)).z=n.z||$r[14],n.v=Ol(Lo(n.v)),n.t="n";break;case"n":case"e":g=""+n.v;break;default:g=n.v}var x={r:t,c:r};switch(x.s=n1(i.cellXfs,n,i),n.l&&l["!links"].push([Kr(x),n.l]),n.c&&l["!comments"].push([Kr(x),n.c]),n.t){case"s":case"str":return i.bookSST?(g=QF(i.Strings,n.v,i.revStrings),x.t="s",x.v=g,u?pn(e,18,function Gfe(e,n,t){return null==t&&(t=nn(8)),Fv(n,t),t.write_shift(4,n.v),t}(0,x)):pn(e,7,function $fe(e,n,t){return null==t&&(t=nn(12)),Rv(n,t),t.write_shift(4,n.v),t}(0,x))):(x.t="str",u?pn(e,17,function rpe(e,n,t){return null==t&&(t=nn(8+4*e.v.length)),Fv(n,t),Rl(e.v,t),t.length>t.l?t.slice(0,t.l):t}(n,x)):pn(e,6,function tpe(e,n,t){return null==t&&(t=nn(12+4*e.v.length)),Rv(n,t),Rl(e.v,t),t.length>t.l?t.slice(0,t.l):t}(n,x))),!0;case"n":return n.v==(0|n.v)&&n.v>-1e3&&n.v<1e3?u?pn(e,13,function Jfe(e,n,t){return null==t&&(t=nn(8)),Fv(n,t),Jj(e.v,t),t}(n,x)):pn(e,2,function Yfe(e,n,t){return null==t&&(t=nn(12)),Rv(n,t),Jj(e.v,t),t}(n,x)):u?pn(e,16,function Zfe(e,n,t){return null==t&&(t=nn(12)),Fv(n,t),Bv(e.v,t),t}(n,x)):pn(e,5,function qfe(e,n,t){return null==t&&(t=nn(16)),Rv(n,t),Bv(e.v,t),t}(n,x)),!0;case"b":return x.t="b",u?pn(e,15,function Lfe(e,n,t){return null==t&&(t=nn(5)),Fv(n,t),t.write_shift(1,e.v?1:0),t}(n,x)):pn(e,4,function Nfe(e,n,t){return null==t&&(t=nn(9)),Rv(n,t),t.write_shift(1,e.v?1:0),t}(n,x)),!0;case"e":return x.t="e",u?pn(e,14,function Vfe(e,n,t){return null==t&&(t=nn(8)),Fv(n,t),t.write_shift(1,e.v),t.write_shift(2,0),t.write_shift(1,0),t}(n,x)):pn(e,3,function zfe(e,n,t){return null==t&&(t=nn(9)),Rv(n,t),t.write_shift(1,e.v),t}(n,x)),!0}return u?pn(e,12,function Pfe(e,n,t){return null==t&&(t=nn(4)),Fv(n,t)}(0,x)):pn(e,1,function kfe(e,n,t){return null==t&&(t=nn(8)),Rv(n,t)}(0,x)),!0}function Fpe(e,n,t,r){var i=Yc(),l=t.SheetNames[e],u=t.Sheets[l]||{},g=l;try{t&&t.Workbook&&(g=t.Workbook.Sheets[e].CodeName||g)}catch{}var x=Qi(u["!ref"]||"A1");if(x.e.c>16383||x.e.r>1048575){if(n.WTF)throw new Error("Range "+(u["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");x.e.c=Math.min(x.e.c,16383),x.e.r=Math.min(x.e.c,1048575)}return u["!links"]=[],u["!comments"]=[],pn(i,129),(t.vbaraw||u["!outline"])&&pn(i,147,function Afe(e,n,t){null==t&&(t=nn(84+4*e.length));var r=192;n&&(n.above&&(r&=-65),n.left&&(r&=-129)),t.write_shift(1,r);for(var i=1;i<3;++i)t.write_shift(1,0);return Hk({auto:1},t),t.write_shift(-4,-1),t.write_shift(-4,-1),Kj(e,t),t.slice(0,t.l)}(g,u["!outline"])),pn(i,148,Sfe(x)),function Rpe(e,n,t){pn(e,133),pn(e,137,function xpe(e,n,t){null==t&&(t=nn(30));var r=924;return(((n||{}).Views||[])[0]||{}).RTL&&(r|=32),t.write_shift(2,r),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,100),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(4,0),t}(0,t)),pn(e,138),pn(e,134)}(i,0,t.Workbook),function Ape(e,n){!n||!n["!cols"]||(pn(e,390),n["!cols"].forEach(function(t,r){t&&pn(e,60,function gpe(e,n,t){null==t&&(t=nn(18));var r=aO(e,n);t.write_shift(-4,e),t.write_shift(-4,e),t.write_shift(4,256*(r.width||10)),t.write_shift(4,0);var i=0;return n.hidden&&(i|=1),"number"==typeof r.width&&(i|=2),n.level&&(i|=n.level<<8),t.write_shift(2,i),t}(r,t))}),pn(e,391))}(i,u),function Dpe(e,n,t,r){var i=Qi(n["!ref"]||"A1"),u="",g=[];pn(e,145);var x=Array.isArray(n),E=i.e.r;n["!rows"]&&(E=Math.max(i.e.r,n["!rows"].length-1));for(var D=i.s.r;D<=E;++D){u=ra(D),Efe(e,n,i,D);var R=!1;if(D<=i.e.r)for(var L=i.s.c;L<=i.e.c;++L){D===i.s.r&&(g[L]=yo(L));var V=x?(n[D]||[])[L]:n[g[L]+u];R=!!V&&Spe(e,V,D,L,r,n,R)}}pn(e,146)}(i,u,0,n),function Npe(e,n){n["!protect"]&&pn(e,535,function wpe(e,n){return null==n&&(n=nn(66)),n.write_shift(2,e.password?$F(e.password):0),n.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(t){n.write_shift(4,t[1]?null==e[t[0]]||e[t[0]]?0:1:null!=e[t[0]]&&e[t[0]]?0:1)}),n}(n["!protect"]))}(i,u),function Ppe(e,n,t,r){if(n["!autofilter"]){var i=n["!autofilter"],l="string"==typeof i.ref?i.ref:Ei(i.ref);t.Workbook||(t.Workbook={Sheets:[]}),t.Workbook.Names||(t.Workbook.Names=[]);var u=t.Workbook.Names,g=Kc(l);g.s.r==g.e.r&&(g.e.r=Kc(n["!ref"]).e.r,l=Ei(g));for(var x=0;x<u.length;++x){var E=u[x];if("_xlnm._FilterDatabase"==E.Name&&E.Sheet==r){E.Ref="'"+t.SheetNames[r]+"'!"+l;break}}x==u.length&&u.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+t.SheetNames[r]+"'!"+l}),pn(e,161,w2(Qi(l))),pn(e,162)}}(i,u,t,e),function Mpe(e,n){!n||!n["!merges"]||(pn(e,177,function upe(e,n){return null==n&&(n=nn(4)),n.write_shift(4,e),n}(n["!merges"].length)),n["!merges"].forEach(function(t){pn(e,176,cpe(t))}),pn(e,178))}(i,u),function kpe(e,n,t){n["!links"].forEach(function(r){if(r[1].Target){var i=Ds(t,-1,r[1].Target.replace(/#.*$/,""),Ci.HLINK);pn(e,494,function hpe(e,n){var t=nn(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));w2({s:wa(e[0]),e:wa(e[0])},t),AF("rId"+n,t);var r=e[1].Target.indexOf("#");return Rl((-1==r?"":e[1].Target.slice(r+1))||"",t),Rl(e[1].Tooltip||"",t),Rl("",t),t.slice(0,t.l)}(r,i))}}),delete n["!links"]}(i,u,r),u["!margins"]&&pn(i,476,function ype(e,n){return null==n&&(n=nn(48)),Gv(e),S9.forEach(function(t){Bv(e[t],n)}),n}(u["!margins"])),(!n||n.ignoreEC||null==n.ignoreEC)&&function Ipe(e,n){!n||!n["!ref"]||(pn(e,648),pn(e,649,function bpe(e){var n=nn(24);return n.write_shift(4,4),n.write_shift(4,1),w2(e,n),n}(Qi(n["!ref"]))),pn(e,650))}(i,u),function Ope(e,n,t,r){if(n["!comments"].length>0){var i=Ds(r,-1,"../drawings/vmlDrawing"+(t+1)+".vml",Ci.VML);pn(e,551,AF("rId"+i)),n["!legacy"]=i}}(i,u,e,r),pn(i,130),i.end()}var t4=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],Zpe="][*?/\\".split("");function I9(e,n){if(e.length>31){if(n)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var t=!0;return Zpe.forEach(function(r){if(-1!=e.indexOf(r)){if(!n)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");t=!1}}),t}function O9(e){var n=[na];n[n.length]=Fn("workbook",null,{xmlns:K0[0],"xmlns:r":qa.r});var t=e.Workbook&&(e.Workbook.Names||[]).length>0,r={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(t4.forEach(function(g){null!=e.Workbook.WBProps[g[0]]&&e.Workbook.WBProps[g[0]]!=g[1]&&(r[g[0]]=e.Workbook.WBProps[g[0]])}),e.Workbook.WBProps.CodeName&&(r.codeName=e.Workbook.WBProps.CodeName,delete r.CodeName)),n[n.length]=Fn("workbookPr",null,r);var i=e.Workbook&&e.Workbook.Sheets||[],l=0;if(i&&i[0]&&i[0].Hidden){for(n[n.length]="<bookViews>",l=0;l!=e.SheetNames.length&&i[l]&&i[l].Hidden;++l);l==e.SheetNames.length&&(l=0),n[n.length]='<workbookView firstSheet="'+l+'" activeTab="'+l+'"/>',n[n.length]="</bookViews>"}for(n[n.length]="<sheets>",l=0;l!=e.SheetNames.length;++l){var u={name:Rs(e.SheetNames[l].slice(0,31))};if(u.sheetId=""+(l+1),u["r:id"]="rId"+(l+1),i[l])switch(i[l].Hidden){case 1:u.state="hidden";break;case 2:u.state="veryHidden"}n[n.length]=Fn("sheet",null,u)}return n[n.length]="</sheets>",t&&(n[n.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach(function(g){var x={name:g.Name};g.Comment&&(x.comment=g.Comment),null!=g.Sheet&&(x.localSheetId=""+g.Sheet),g.Hidden&&(x.hidden="1"),g.Ref&&(n[n.length]=Fn("definedName",Rs(g.Ref),x))}),n[n.length]="</definedNames>"),n.length>2&&(n[n.length]="</workbook>",n[1]=n[1].replace("/>",">")),n.join("")}function Qpe(e,n){return n||(n=nn(127)),n.write_shift(4,e.Hidden),n.write_shift(4,e.iTabID),AF(e.strRelID,n),Rl(e.name.slice(0,31),n),n.length>n.l?n.slice(0,n.l):n}function cme(e,n){var t=Yc();return pn(t,131),pn(t,128,function ome(e,n){n||(n=nn(127));for(var t=0;4!=t;++t)n.write_shift(4,0);return Rl("SheetJS",n),Rl(ES.version,n),Rl(ES.version,n),Rl("7262",n),n.length>n.l?n.slice(0,n.l):n}()),pn(t,153,function tme(e,n){n||(n=nn(72));var t=0;return e&&e.filterPrivacy&&(t|=8),n.write_shift(4,t),n.write_shift(4,0),Kj(e&&e.CodeName||"ThisWorkbook",n),n.slice(0,n.l)}(e.Workbook&&e.Workbook.WBProps||null)),function lme(e,n){if(n.Workbook&&n.Workbook.Sheets){for(var t=n.Workbook.Sheets,r=0,i=-1,l=-1;r<t.length;++r)!t[r]||!t[r].Hidden&&-1==i?i=r:1==t[r].Hidden&&-1==l&&(l=r);l>i||(pn(e,135),pn(e,158,function ame(e,n){return n||(n=nn(29)),n.write_shift(-4,0),n.write_shift(-4,460),n.write_shift(4,28800),n.write_shift(4,17600),n.write_shift(4,500),n.write_shift(4,e),n.write_shift(4,e),n.write_shift(1,120),n.length>n.l?n.slice(0,n.l):n}(i)),pn(e,136))}}(t,e),function sme(e,n){pn(e,143);for(var t=0;t!=n.SheetNames.length;++t)pn(e,156,Qpe({Hidden:n.Workbook&&n.Workbook.Sheets&&n.Workbook.Sheets[t]&&n.Workbook.Sheets[t].Hidden||0,iTabID:t+1,strRelID:"rId"+(t+1),name:n.SheetNames[t]}));pn(e,144)}(t,e),pn(t,132),t.end()}function Tme(e,n,t,r,i){return(".bin"===n.slice(-4)?Fpe:E9)(e,t,r,i)}function Sme(e,n,t){return(".bin"===n.slice(-4)?lde:c9)(e,t)}function N9(e){return Fn("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+XF(e.Ref,{r:0,c:0})})}function jme(e,n,t,r,i,l,u){if(!e||null==e.v&&null==e.f)return"";var g={};if(e.f&&(g["ss:Formula"]="="+Rs(XF(e.f,u))),e.F&&e.F.slice(0,n.length)==n){var x=wa(e.F.slice(n.length+1));g["ss:ArrayRange"]="RC:R"+(x.r==u.r?"":"["+(x.r-u.r)+"]")+"C"+(x.c==u.c?"":"["+(x.c-u.c)+"]")}if(e.l&&e.l.Target&&(g["ss:HRef"]=Rs(e.l.Target),e.l.Tooltip&&(g["x:HRefScreenTip"]=Rs(e.l.Tooltip))),t["!merges"])for(var E=t["!merges"],D=0;D!=E.length;++D)E[D].s.c!=u.c||E[D].s.r!=u.r||(E[D].e.c>E[D].s.c&&(g["ss:MergeAcross"]=E[D].e.c-E[D].s.c),E[D].e.r>E[D].s.r&&(g["ss:MergeDown"]=E[D].e.r-E[D].s.r));var R="",L="";switch(e.t){case"z":if(!r.sheetStubs)return"";break;case"n":R="Number",L=String(e.v);break;case"b":R="Boolean",L=e.v?"1":"0";break;case"e":R="Error",L=Ug[e.v];break;case"d":R="DateTime",L=new Date(e.v).toISOString(),null==e.z&&(e.z=e.z||$r[14]);break;case"s":R="String",L=function uoe(e){return(e+"").replace(fF,function(t){return hF[t]}).replace(Sj,function(t){return"&#x"+t.charCodeAt(0).toString(16).toUpperCase()+";"})}(e.v||"")}var V=n1(r.cellXfs,e,r);g["ss:StyleID"]="s"+(21+V),g["ss:Index"]=u.c+1;var G="z"==e.t?"":'<Data ss:Type="'+R+'">'+(null!=e.v?L:"")+"</Data>";return(e.c||[]).length>0&&(G+=function Vme(e){return e.map(function(n){var t=function doe(e){return e.replace(/(\r\n|[\r\n])/g,"&#10;")}(n.t||""),r=Fn("ss:Data",t,{xmlns:"http://www.w3.org/TR/REC-html40"});return Fn("Comment",r,{"ss:Author":n.a})}).join("")}(e.c)),Fn("Cell",G,g)}function $me(e,n){var t='<Row ss:Index="'+(e+1)+'"';return n&&(n.hpt&&!n.hpx&&(n.hpx=tO(n.hpt)),n.hpx&&(t+=' ss:AutoFitHeight="0" ss:Height="'+n.hpx+'"'),n.hidden&&(t+=' ss:Hidden="1"')),t+">"}function Gme(e,n,t){var r=[],l=t.Sheets[t.SheetNames[e]],u=l?function zme(e,n,t,r){if(!e||!((r||{}).Workbook||{}).Names)return"";for(var i=r.Workbook.Names,l=[],u=0;u<i.length;++u){var g=i[u];g.Sheet==t&&(g.Name.match(/^_xlfn\./)||l.push(N9(g)))}return l.join("")}(l,0,e,t):"";return u.length>0&&r.push("<Names>"+u+"</Names>"),u=l?function Hme(e,n,t,r){if(!e["!ref"])return"";var i=Qi(e["!ref"]),l=e["!merges"]||[],u=0,g=[];e["!cols"]&&e["!cols"].forEach(function(Q,he){e1(Q);var le=!!Q.width,me=aO(he,Q),ze={"ss:Index":he+1};le&&(ze["ss:Width"]=HS(me.width)),Q.hidden&&(ze["ss:Hidden"]="1"),g.push(Fn("Column",null,ze))});for(var x=Array.isArray(e),E=i.s.r;E<=i.e.r;++E){for(var D=[$me(E,(e["!rows"]||[])[E])],R=i.s.c;R<=i.e.c;++R){var L=!1;for(u=0;u!=l.length;++u)if(!(l[u].s.c>R||l[u].s.r>E||l[u].e.c<R||l[u].e.r<E)){(l[u].s.c!=R||l[u].s.r!=E)&&(L=!0);break}if(!L){var V={r:E,c:R},Y=Kr(V);D.push(jme(x?(e[E]||[])[R]:e[Y],Y,e,n,0,0,V))}}D.push("</Row>"),D.length>2&&g.push(D.join(""))}return g.join("")}(l,n):"",u.length>0&&r.push("<Table>"+u+"</Table>"),r.push(function Ume(e,n,t,r){if(!e)return"";var i=[];if(e["!margins"]&&(i.push("<PageSetup>"),e["!margins"].header&&i.push(Fn("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&i.push(Fn("Footer",null,{"x:Margin":e["!margins"].footer})),i.push(Fn("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),i.push("</PageSetup>")),r&&r.Workbook&&r.Workbook.Sheets&&r.Workbook.Sheets[t])if(r.Workbook.Sheets[t].Hidden)i.push(Fn("Visible",1==r.Workbook.Sheets[t].Hidden?"SheetHidden":"SheetVeryHidden",{}));else{for(var l=0;l<t&&(!r.Workbook.Sheets[l]||r.Workbook.Sheets[l].Hidden);++l);l==t&&i.push("<Selected/>")}return((((r||{}).Workbook||{}).Views||[])[0]||{}).RTL&&i.push("<DisplayRightToLeft/>"),e["!protect"]&&(i.push(ec("ProtectContents","True")),e["!protect"].objects&&i.push(ec("ProtectObjects","True")),e["!protect"].scenarios&&i.push(ec("ProtectScenarios","True")),null==e["!protect"].selectLockedCells||e["!protect"].selectLockedCells?null!=e["!protect"].selectUnlockedCells&&!e["!protect"].selectUnlockedCells&&i.push(ec("EnableSelection","UnlockedCells")):i.push(ec("EnableSelection","NoSelection")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(u){e["!protect"][u[0]]&&i.push("<"+u[1]+"/>")})),0==i.length?"":Fn("WorksheetOptions",i.join(""),{xmlns:gd.x})}(l,0,e,t)),r.join("")}function Wme(e,n){n||(n={}),e.SSF||(e.SSF=Qs($r)),e.SSF&&(_2(),kS(e.SSF),n.revssf=Bk(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF,n.cellXfs=[],n1(n.cellXfs,{},{revssf:{General:0}}));var t=[];t.push(function Nme(e,n){var t=[];return e.Props&&t.push(function uae(e,n){var t=[];return ea(LF).map(function(r){for(var i=0;i<Vg.length;++i)if(Vg[i][1]==r)return Vg[i];for(i=0;i<Uv.length;++i)if(Uv[i][1]==r)return Uv[i];throw r}).forEach(function(r){if(null!=e[r[1]]){var i=n&&n.Props&&null!=n.Props[r[1]]?n.Props[r[1]]:e[r[1]];"date"===r[2]&&(i=new Date(i).toISOString().replace(/\.\d*Z/,"Z")),"number"==typeof i?i=String(i):!0===i||!1===i?i=i?"1":"0":i instanceof Date&&(i=new Date(i).toISOString().replace(/\.\d*Z/,"")),t.push(ec(LF[r[1]]||r[1],i))}}),Fn("DocumentProperties",t.join(""),{xmlns:gd.o})}(e.Props,n)),e.Custprops&&t.push(function dae(e,n){var t=["Worksheets","SheetNames"],r="CustomDocumentProperties",i=[];return e&&ea(e).forEach(function(l){if(Object.prototype.hasOwnProperty.call(e,l)){for(var u=0;u<Vg.length;++u)if(l==Vg[u][1])return;for(u=0;u<Uv.length;++u)if(l==Uv[u][1])return;for(u=0;u<t.length;++u)if(l==t[u])return;var g=e[l],x="string";"number"==typeof g?(x="float",g=String(g)):!0===g||!1===g?(x="boolean",g=g?"1":"0"):g=String(g),i.push(Fn(Cj(l),g,{"dt:dt":x}))}}),n&&ea(n).forEach(function(l){if(Object.prototype.hasOwnProperty.call(n,l)&&(!e||!Object.prototype.hasOwnProperty.call(e,l))){var u=n[l],g="string";"number"==typeof u?(g="float",u=String(u)):!0===u||!1===u?(g="boolean",u=u?"1":"0"):u instanceof Date?(g="dateTime.tz",u=u.toISOString()):u=String(u),i.push(Fn(Cj(l),u,{"dt:dt":g}))}}),"<"+r+' xmlns="'+gd.o+'">'+i.join("")+"</"+r+">"}(e.Props,e.Custprops)),t.join("")}(e,n)),t.push(""),t.push(""),t.push("");for(var r=0;r<e.SheetNames.length;++r)t.push(Fn("Worksheet",Gme(r,n,e),{"ss:Name":Rs(e.SheetNames[r])}));return t[2]=function Lme(e,n){var t=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return n.cellXfs.forEach(function(r,i){var l=[];l.push(Fn("NumberFormat",null,{"ss:Format":Rs($r[r.numFmtId])}));var u={"ss:ID":"s"+(21+i)};t.push(Fn("Style",l.join(""),u))}),Fn("Styles",t.join(""))}(0,n),t[3]=function Bme(e){if(!((e||{}).Workbook||{}).Names)return"";for(var n=e.Workbook.Names,t=[],r=0;r<n.length;++r){var i=n[r];null==i.Sheet&&(i.Name.match(/^_xlfn\./)||t.push(N9(i)))}return Fn("Names",t.join(""))}(e),na+Fn("Workbook",t.join(""),{xmlns:gd.ss,"xmlns:o":gd.o,"xmlns:x":gd.x,"xmlns:ss":gd.ss,"xmlns:dt":gd.dt,"xmlns:html":gd.html})}var QS={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};var eD={0:{f:function wfe(e,n){var t={},r=e.l+n;t.r=e.read_shift(4),e.l+=4;var i=e.read_shift(2);e.l+=1;var l=e.read_shift(1);return e.l=r,7&l&&(t.level=7&l),16&l&&(t.hidden=!0),32&l&&(t.hpt=i/20),t}},1:{f:function Ife(e){return[Ih(e)]}},2:{f:function Xfe(e){return[Ih(e),IF(e),"n"]}},3:{f:function Bfe(e){return[Ih(e),e.read_shift(1),"e"]}},4:{f:function Rfe(e){return[Ih(e),e.read_shift(1),"b"]}},5:{f:function Wfe(e){return[Ih(e),Cc(e),"n"]}},6:{f:function epe(e){return[Ih(e),Ec(e),"str"]}},7:{f:function jfe(e){return[Ih(e),e.read_shift(4),"s"]}},8:{f:function ape(e,n,t){var r=e.l+n,i=Ih(e);i.r=t["!row"];var u=[i,Ec(e),"str"];if(t.cellFormula){e.l+=2;var g=sO(e,r-e.l,t);u[3]=Mc(g,0,i,t.supbooks,t)}else e.l=r;return u}},9:{f:function ope(e,n,t){var r=e.l+n,i=Ih(e);i.r=t["!row"];var u=[i,Cc(e),"n"];if(t.cellFormula){e.l+=2;var g=sO(e,r-e.l,t);u[3]=Mc(g,0,i,t.supbooks,t)}else e.l=r;return u}},10:{f:function ipe(e,n,t){var r=e.l+n,i=Ih(e);i.r=t["!row"];var u=[i,e.read_shift(1),"b"];if(t.cellFormula){e.l+=2;var g=sO(e,r-e.l,t);u[3]=Mc(g,0,i,t.supbooks,t)}else e.l=r;return u}},11:{f:function spe(e,n,t){var r=e.l+n,i=Ih(e);i.r=t["!row"];var u=[i,e.read_shift(1),"e"];if(t.cellFormula){e.l+=2;var g=sO(e,r-e.l,t);u[3]=Mc(g,0,i,t.supbooks,t)}else e.l=r;return u}},12:{f:function Ofe(e){return[Nv(e)]}},13:{f:function Kfe(e){return[Nv(e),IF(e),"n"]}},14:{f:function Ufe(e){return[Nv(e),e.read_shift(1),"e"]}},15:{f:function Ffe(e){return[Nv(e),e.read_shift(1),"b"]}},16:{f:function C9(e){return[Nv(e),Cc(e),"n"]}},17:{f:function npe(e){return[Nv(e),Ec(e),"str"]}},18:{f:function Hfe(e){return[Nv(e),e.read_shift(4),"s"]}},19:{f:SF},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:function rme(e,n,t){var r=e.l+n;e.l+=4,e.l+=1;var i=e.read_shift(4),l=Loe(e),u=Bhe(e,0,t),g=DF(e);e.l=r;var x={Name:l,Ptg:u};return i<268435455&&(x.Sheet=i),g&&(x.Comment=g),x}},40:{},42:{},43:{f:function eue(e,n,t){var r={};r.sz=e.read_shift(2)/20;var i=function Uoe(e){var n=e.read_shift(1);return e.l++,{fBold:1&n,fItalic:2&n,fUnderline:4&n,fStrikeout:8&n,fOutline:16&n,fShadow:32&n,fCondense:64&n,fExtend:128&n}}(e);switch(i.fItalic&&(r.italic=1),i.fCondense&&(r.condense=1),i.fExtend&&(r.extend=1),i.fShadow&&(r.shadow=1),i.fOutline&&(r.outline=1),i.fStrikeout&&(r.strike=1),700===e.read_shift(2)&&(r.bold=1),e.read_shift(2)){case 1:r.vertAlign="superscript";break;case 2:r.vertAlign="subscript"}var u=e.read_shift(1);0!=u&&(r.underline=u);var g=e.read_shift(1);g>0&&(r.family=g);var x=e.read_shift(1);switch(x>0&&(r.charset=x),e.l++,r.color=function zoe(e){var n={},r=e.read_shift(1)>>>1,i=e.read_shift(1),l=e.read_shift(2,"i"),u=e.read_shift(1),g=e.read_shift(1),x=e.read_shift(1);switch(e.l++,r){case 0:n.auto=1;break;case 1:n.index=i;var E=zv[i];E&&(n.rgb=$S(E));break;case 2:n.rgb=$S([u,g,x]);break;case 3:n.theme=i}return 0!=l&&(n.tint=l>0?l/32767:l/32768),n}(e),e.read_shift(1)){case 1:r.scheme="major";break;case 2:r.scheme="minor"}return r.name=Ec(e),r}},44:{f:function Jce(e,n){return[e.read_shift(2),Ec(e)]}},45:{f:rue},46:{f:sue},47:{f:function iue(e,n){var t=e.l+n,r=e.read_shift(2),i=e.read_shift(2);return e.l=t,{ixfe:r,numFmtId:i}}},48:{},49:{f:function Ioe(e){return e.read_shift(4,"i")}},50:{},51:{f:function zue(e){for(var n=[],t=e.read_shift(4);t-- >0;)n.push([e.read_shift(4),e.read_shift(4)]);return n}},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:function $7(e,n,t){if(!t.cellStyles)return Tc(e,n);var r=t&&t.biff>=12?4:2,i=e.read_shift(r),l=e.read_shift(r),u=e.read_shift(r),g=e.read_shift(r),x=e.read_shift(2);2==r&&(e.l+=2);var E={s:i,e:l,w:u,ixfe:g,flags:x};return(t.biff>=5||!t.biff)&&(E.level=x>>8&7),E}},62:{f:function Qfe(e){return[Ih(e),SF(e),"is"]}},63:{f:function Zue(e){var n={};n.i=e.read_shift(4);var t={};t.r=e.read_shift(4),t.c=e.read_shift(4),n.r=Kr(t);var r=e.read_shift(1);return 2&r&&(n.l="1"),8&r&&(n.a="1"),n}},64:{f:function Tpe(){}},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:Tc,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:function vpe(e){var n=e.read_shift(2);return e.l+=28,{RTL:32&n}}},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:function Mfe(e,n){var t={},r=e[e.l];return++e.l,t.above=!(64&r),t.left=!(128&r),e.l+=18,t.name=Foe(e,n-19),t}},148:{f:Cfe,p:16},151:{f:function fpe(){}},152:{},153:{f:function eme(e,n){var t={},r=e.read_shift(4);t.defaultThemeVersion=e.read_shift(4);var i=n>8?Ec(e):"";return i.length>0&&(t.CodeName=i),t.autoCompressPictures=!!(65536&r),t.backupFile=!!(64&r),t.checkCompatibility=!!(4096&r),t.date1904=!!(1&r),t.filterPrivacy=!!(8&r),t.hidePivotFieldList=!!(1024&r),t.promptedSolutions=!!(16&r),t.publishItems=!!(2048&r),t.refreshAllConnections=!!(262144&r),t.saveExternalLinkValues=!!(128&r),t.showBorderUnselectedTables=!!(4&r),t.showInkAnnotation=!!(32&r),t.showObjects=["all","placeholders","none"][r>>13&3],t.showPivotChartFilter=!!(32768&r),t.updateLinks=["userSet","never","always"][r>>8&3],t}},154:{},155:{},156:{f:function Jpe(e,n){var t={};return t.Hidden=e.read_shift(4),t.iTabID=e.read_shift(4),t.strRelID=MF(e,n-8),t.name=Ec(e),t}},157:{},158:{},159:{T:1,f:function xce(e){return[e.read_shift(4),e.read_shift(4)]}},160:{T:-1},161:{T:1,f:Lv},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:lpe},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:function Lue(e,n){return{flags:e.read_shift(4),version:e.read_shift(4),name:Ec(e)}}},336:{T:-1},337:{f:function jue(e){return e.l+=4,0!=e.read_shift(4)},T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:MF},357:{},358:{},359:{},360:{T:1},361:{},362:{f:function V7(e,n,t){if(t.biff<8)return function Cle(e,n,t){3==e[e.l+1]&&e[e.l]++;var r=VS(e,0,t);return 3==r.charCodeAt(0)?r.slice(1):r}(e,0,t);for(var r=[],i=e.l+n,l=e.read_shift(t.biff>8?4:2);0!=l--;)r.push(Pae(e,0,t));if(e.l!=i)throw new Error("Bad ExternSheet: "+e.l+" != "+i);return r}},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:function ppe(e,n,t){var r=e.l+n,i=Qj(e),l=e.read_shift(1),u=[i];if(u[2]=l,t.cellFormula){var g=Lhe(e,r-e.l,t);u[1]=g}else e.l=r;return u}},427:{f:function mpe(e,n,t){var r=e.l+n,l=[Lv(e,16)];if(t.cellFormula){var u=zhe(e,r-e.l,t);l[1]=u,e.l=r}else e.l=r;return l}},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:function _pe(e){var n={};return S9.forEach(function(t){n[t]=Cc(e)}),n}},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:function Dfe(){}},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:function dpe(e,n){var t=e.l+n,r=Lv(e,16),i=DF(e),l=Ec(e),u=Ec(e),g=Ec(e);e.l=t;var x={rfx:r,relId:i,loc:l,display:g};return u&&(x.Tooltip=u),x}},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:MF},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:sde},633:{T:1},634:{T:-1},635:{T:1,f:function rde(e){var n={};n.iauthor=e.read_shift(4);var t=Lv(e,16);return n.rfx=t.s,n.ref=Kr(t.s),e.l+=16,n}},636:{T:-1},637:{f:Roe},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:function Vpe(e,n){return e.l+=10,{name:Ec(e)}}},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:function Epe(){}},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function Un(e,n,t,r){var i=n;if(!isNaN(i)){var l=r||(t||[]).length||0,u=e.next(4);u.write_shift(2,i),u.write_shift(2,l),l>0&&wF(t)&&e.push(t)}}function tD(e,n,t){return e||(e=nn(7)),e.write_shift(2,n),e.write_shift(2,t),e.write_shift(2,0),e.write_shift(1,0),e}function rge(e,n,t,r){if(null!=n.v)switch(n.t){case"d":case"n":var i="d"==n.t?Ol(Lo(n.v)):n.v;return void(i==(0|i)&&i>=0&&i<65536?Un(e,2,function ice(e,n,t){var r=nn(9);return tD(r,e,n),r.write_shift(2,t),r}(t,r,i)):Un(e,3,function nce(e,n,t){var r=nn(15);return tD(r,e,n),r.write_shift(8,t,"f"),r}(t,r,i)));case"b":case"e":return void Un(e,5,function tge(e,n,t,r){var i=nn(9);return tD(i,e,n),C7(t,r||"b",i),i}(t,r,n.v,n.t));case"s":case"str":return void Un(e,4,function nge(e,n,t){var r=nn(8+2*t.length);return tD(r,e,n),r.write_shift(1,t.length),r.write_shift(t.length,t,"sbcs"),r.l<r.length?r.slice(0,r.l):r}(t,r,(n.v||"").slice(0,255)))}Un(e,1,tD(null,t,r))}function hge(e,n,t,r,i){var l=16+n1(i.cellXfs,n,i);if(null!=n.v||n.bf)if(n.bf)Un(e,6,function Fhe(e,n,t,r,i){var l=$v(n,t,i),u=function Nhe(e){if(null==e){var n=nn(8);return n.write_shift(1,3),n.write_shift(1,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,65535),n}return Bv("number"==typeof e?e:0)}(e.v),g=nn(6);g.write_shift(2,33),g.write_shift(4,0);for(var E=nn(e.bf.length),D=0;D<e.bf.length;++D)E[D]=e.bf[D];return kl([l,u,g,E])}(n,t,r,0,l));else switch(n.t){case"d":case"n":Un(e,515,function wle(e,n,t,r){var i=nn(14);return $v(e,n,r,i),Bv(t,i),i}(t,r,"d"==n.t?Ol(Lo(n.v)):n.v,l));break;case"b":case"e":Un(e,517,function xle(e,n,t,r,i,l){var u=nn(8);return $v(e,n,r,u),C7(t,l,u),u}(t,r,n.v,l,0,n.t));break;case"s":case"str":i.bookSST?Un(e,253,function ole(e,n,t,r){var i=nn(10);return $v(e,n,r,i),i.write_shift(4,t),i}(t,r,QF(i.Strings,n.v,i.revStrings),l)):Un(e,516,function lle(e,n,t,r,i){var l=!i||8==i.biff,u=nn(+l+8+(1+l)*t.length);return $v(e,n,r,u),u.write_shift(2,t.length),l&&u.write_shift(1,1),u.write_shift((1+l)*t.length,t,l?"utf16le":"sbcs"),u}(t,r,(n.v||"").slice(0,255),l,i));break;default:Un(e,513,$v(t,r,l))}else Un(e,513,$v(t,r,l))}function fge(e,n,t){var D,r=Yc(),i=t.SheetNames[e],l=t.Sheets[i]||{},u=(t||{}).Workbook||{},g=(u.Sheets||[])[e]||{},x=Array.isArray(l),E=8==n.biff,R="",L=[],V=Qi(l["!ref"]||"A1"),Y=E?65536:16384;if(V.e.c>255||V.e.r>=Y){if(n.WTF)throw new Error("Range "+(l["!ref"]||"A1")+" exceeds format limit A1:IV16384");V.e.c=Math.min(V.e.c,255),V.e.r=Math.min(V.e.c,Y-1)}Un(r,2057,VF(0,16,n)),Un(r,13,kh(1)),Un(r,12,kh(100)),Un(r,15,Jc(!0)),Un(r,17,Jc(!1)),Un(r,16,Bv(.001)),Un(r,95,Jc(!0)),Un(r,42,Jc(!1)),Un(r,43,Jc(!1)),Un(r,130,kh(1)),Un(r,128,function vle(e){var n=nn(8);return n.write_shift(4,0),n.write_shift(2,e[0]?e[0]+1:0),n.write_shift(2,e[1]?e[1]+1:0),n}([0,0])),Un(r,131,Jc(!1)),Un(r,132,Jc(!1)),E&&function dge(e,n){if(n){var t=0;n.forEach(function(r,i){++t<=256&&r&&Un(e,125,function Wle(e,n){var t=nn(12);t.write_shift(2,n),t.write_shift(2,n),t.write_shift(2,256*e.width),t.write_shift(2,0);var r=0;return e.hidden&&(r|=1),t.write_shift(1,r),t.write_shift(1,r=e.level||0),t.write_shift(2,0),t}(aO(i,r),i))})}}(r,l["!cols"]),Un(r,512,function hle(e,n){var t=8!=n.biff&&n.biff?2:4,r=nn(2*t+6);return r.write_shift(t,e.s.r),r.write_shift(t,e.e.r+1),r.write_shift(2,e.s.c),r.write_shift(2,e.e.c+1),r.write_shift(2,0),r}(V,n)),E&&(l["!links"]=[]);for(var G=V.s.r;G<=V.e.r;++G){R=ra(G);for(var Q=V.s.c;Q<=V.e.c;++Q){G===V.s.r&&(L[Q]=yo(Q)),D=L[Q]+R;var he=x?(l[G]||[])[Q]:l[D];he&&(hge(r,he,G,Q,n),E&&he.l&&l["!links"].push([D,he.l]))}}var le=g.CodeName||g.name||i;return E&&Un(r,574,function tle(e){var n=nn(18),t=1718;return e&&e.RTL&&(t|=64),n.write_shift(2,t),n.write_shift(4,0),n.write_shift(4,64),n.write_shift(4,0),n.write_shift(4,0),n}((u.Views||[])[0])),E&&(l["!merges"]||[]).length&&Un(r,229,function Ole(e){var n=nn(2+8*e.length);n.write_shift(2,e.length);for(var t=0;t<e.length;++t)k7(e[t],n);return n}(l["!merges"])),E&&function uge(e,n){for(var t=0;t<n["!links"].length;++t){var r=n["!links"][t];Un(e,440,Ble(r)),r[1].Tooltip&&Un(e,2048,Ule(r))}delete n["!links"]}(r,l),Un(r,442,S7(le)),E&&function lge(e,n){var t=nn(19);t.write_shift(4,2151),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(2,3),t.write_shift(1,1),t.write_shift(4,0),Un(e,2151,t),(t=nn(39)).write_shift(4,2152),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(2,3),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(2,1),t.write_shift(4,4),t.write_shift(2,0),k7(Qi(n["!ref"]||"A1"),t),t.write_shift(4,4),Un(e,2152,t)}(r,l),Un(r,10),r.end()}function pge(e,n,t){var r=Yc(),i=(e||{}).Workbook||{},l=i.Sheets||[],u=i.WBProps||{},g=8==t.biff,x=5==t.biff;Un(r,2057,VF(0,5,t)),"xla"==t.bookType&&Un(r,135),Un(r,225,g?kh(1200):null),Un(r,193,function xae(e,n){n||(n=nn(e));for(var t=0;t<e;++t)n.write_shift(1,0);return n}(2)),x&&Un(r,191),x&&Un(r,192),Un(r,226),Un(r,92,function jae(e,n){var t=!n||8==n.biff,r=nn(t?112:54);for(r.write_shift(8==n.biff?2:1,7),t&&r.write_shift(1,0),r.write_shift(4,859007059),r.write_shift(4,5458548|(t?0:536870912));r.l<r.length;)r.write_shift(1,t?0:32);return r}(0,t)),Un(r,66,kh(g?1200:1252)),g&&Un(r,353,kh(0)),g&&Un(r,448),Un(r,317,function Xle(e){for(var n=nn(2*e),t=0;t<e;++t)n.write_shift(2,t+1);return n}(e.SheetNames.length)),g&&e.vbaraw&&Un(r,211),g&&e.vbaraw&&Un(r,442,S7(u.CodeName||"ThisWorkbook")),Un(r,156,kh(17)),Un(r,25,Jc(!1)),Un(r,18,Jc(!1)),Un(r,19,kh(0)),g&&Un(r,431,Jc(!1)),g&&Un(r,444,kh(0)),Un(r,61,function Qae(){var e=nn(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}()),Un(r,64,Jc(!1)),Un(r,141,kh(0)),Un(r,34,Jc("true"==function qpe(e){return e.Workbook&&e.Workbook.WBProps&&function Do(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}(e.Workbook.WBProps.date1904)?"true":"false"}(e))),Un(r,14,Jc(!0)),g&&Un(r,439,Jc(!1)),Un(r,218,kh(0)),function oge(e,n,t){Un(e,49,function ile(e,n){var t=e.name||"Arial",r=n&&5==n.biff,l=nn(r?15+t.length:16+2*t.length);return l.write_shift(2,20*(e.sz||12)),l.write_shift(4,0),l.write_shift(2,400),l.write_shift(4,0),l.write_shift(2,0),l.write_shift(1,t.length),r||l.write_shift(1,1),l.write_shift((r?1:2)*t.length,t,r?"sbcs":"utf16le"),l}({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},t))}(r,0,t),function age(e,n,t){n&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var i=r[0];i<=r[1];++i)null!=n[i]&&Un(e,1054,ule(i,n[i],t))})}(r,e.SSF,t),function cge(e,n){for(var t=0;t<16;++t)Un(e,224,F7({numFmtId:0,style:!0},0,n));n.cellXfs.forEach(function(r){Un(e,224,F7(r,0,n))})}(r,t),g&&Un(r,352,Jc(!1));var D=r.end(),R=Yc();g&&Un(R,140,function jle(e){return e||(e=nn(4)),e.write_shift(2,1),e.write_shift(2,1),e}()),g&&t.Strings&&function ege(e,n,t,r){var i=r||(t||[]).length||0;if(i<=8224)return Un(e,n,t,i);var l=n;if(!isNaN(l)){for(var u=t.parts||[],g=0,x=0,E=0;E+(u[g]||8224)<=8224;)E+=u[g]||8224,g++;var D=e.next(4);for(D.write_shift(2,l),D.write_shift(2,E),e.push(t.slice(x,x+E)),x+=E;x<i;){for((D=e.next(4)).write_shift(2,60),E=0;E+(u[g]||8224)<=8224;)E+=u[g]||8224,g++;D.write_shift(2,E),e.push(t.slice(x,x+E)),x+=E}}}(R,252,function qae(e,n){var t=nn(8);t.write_shift(4,e.Count),t.write_shift(4,e.Unique);for(var r=[],i=0;i<e.length;++i)r[i]=Eae(e[i]);var l=kl([t].concat(r));return l.parts=[t.length].concat(r.map(function(u){return u.length})),l}(t.Strings)),Un(R,10);var L=R.end(),V=Yc(),Y=0,G=0;for(G=0;G<e.SheetNames.length;++G)Y+=(g?12:11)+(g?2:1)*e.SheetNames[G].length;var Q=D.length+Y+L.length;for(G=0;G<e.SheetNames.length;++G)Un(V,133,Gae({pos:Q,hs:(l[G]||{}).Hidden||0,dt:0,name:e.SheetNames[G]},t)),Q+=n[G].length;var le=V.end();if(Y!=le.length)throw new Error("BS8 "+Y+" != "+le.length);var me=[];return D.length&&me.push(D),le.length&&me.push(le),L.length&&me.push(L),kl(me)}function L9(e,n){for(var t=0;t<=e.SheetNames.length;++t){var r=e.Sheets[e.SheetNames[t]];r&&r["!ref"]&&Kc(r["!ref"]).e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+e.SheetNames[t]+"' extends beyond column IV (255).  Data may be lost.")}var l=n||{};switch(l.biff||2){case 8:case 5:return function mge(e,n){var t=n||{},r=[];e&&!e.SSF&&(e.SSF=Qs($r)),e&&e.SSF&&(_2(),kS(e.SSF),t.revssf=Bk(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,d4(t),t.cellXfs=[],n1(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var i=0;i<e.SheetNames.length;++i)r[r.length]=fge(i,t,e);return r.unshift(pge(e,r,t)),kl(r)}(e,n);case 4:case 3:case 2:return function sge(e,n){var t=n||{};null!=Qo&&null==t.dense&&(t.dense=Qo);for(var r=Yc(),i=0,l=0;l<e.SheetNames.length;++l)e.SheetNames[l]==t.sheet&&(i=l);if(0==i&&t.sheet&&e.SheetNames[0]!=t.sheet)throw new Error("Sheet not found: "+t.sheet);return Un(r,4==t.biff?1033:3==t.biff?521:9,VF(0,16,t)),function ige(e,n,t,r){var u,i=Array.isArray(n),l=Qi(n["!ref"]||"A1"),g="",x=[];if(l.e.c>255||l.e.r>16383){if(r.WTF)throw new Error("Range "+(n["!ref"]||"A1")+" exceeds format limit A1:IV16384");l.e.c=Math.min(l.e.c,255),l.e.r=Math.min(l.e.c,16383),u=Ei(l)}for(var E=l.s.r;E<=l.e.r;++E){g=ra(E);for(var D=l.s.c;D<=l.e.c;++D){E===l.s.r&&(x[D]=yo(D)),u=x[D]+g;var R=i?(n[E]||[])[D]:n[u];R&&rge(e,R,E,D)}}}(r,e.Sheets[e.SheetNames[i]],0,t),Un(r,10),r.end()}(e,n)}throw new Error("invalid type "+l.bookType+" for BIFF")}function z9(e,n,t,r){for(var i=e["!merges"]||[],l=[],u=n.s.c;u<=n.e.c;++u){for(var g=0,x=0,E=0;E<i.length;++E)if(!(i[E].s.r>t||i[E].s.c>u||i[E].e.r<t||i[E].e.c<u)){if(i[E].s.r<t||i[E].s.c<u){g=-1;break}g=i[E].e.r-i[E].s.r+1,x=i[E].e.c-i[E].s.c+1;break}if(!(g<0)){var D=Kr({r:t,c:u}),R=r.dense?(e[t]||[])[u]:e[D],L=R&&null!=R.v&&(R.h||Dj(R.w||(rm(R),R.w)||""))||"",V={};g>1&&(V.rowspan=g),x>1&&(V.colspan=x),r.editable?L='<span contenteditable="true">'+L+"</span>":R&&(V["data-t"]=R&&R.t||"z",null!=R.v&&(V["data-v"]=R.v),null!=R.z&&(V["data-z"]=R.z),R.l&&"#"!=(R.l.Target||"#").charAt(0)&&(L='<a href="'+R.l.Target+'">'+L+"</a>")),V.id=(r.id||"sjs")+"-"+D,l.push(Fn("td",L,V))}}return"<tr>"+l.join("")+"</tr>"}var U9='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',V9="</body></html>";function $9(e,n){var t=n||{},i=null!=t.footer?t.footer:V9,l=[null!=t.header?t.header:U9],u=Kc(e["!ref"]);t.dense=Array.isArray(e),l.push(function j9(e,n,t){return[].join("")+"<table"+(t&&t.id?' id="'+t.id+'"':"")+">"}(0,0,t));for(var g=u.s.r;g<=u.e.r;++g)l.push(z9(e,u,g,t));return l.push("</table>"+i),l.join("")}var xge=function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),n="<office:document-styles "+RS({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return na+n}}(),K9=function(){var e=function(l){return Rs(l).replace(/  +/g,function(u){return'<text:s text:c="'+u.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},n="          <table:table-cell />\n",r=function(l,u,g){var x=[];x.push('      <table:table table:name="'+Rs(u.SheetNames[g])+'" table:style-name="ta1">\n');var E=0,D=0,R=Kc(l["!ref"]||"A1"),L=l["!merges"]||[],V=0,Y=Array.isArray(l);if(l["!cols"])for(D=0;D<=R.e.c;++D)x.push("        <table:table-column"+(l["!cols"][D]?' table:style-name="co'+l["!cols"][D].ods+'"':"")+"></table:table-column>\n");var Q=l["!rows"]||[];for(E=0;E<R.s.r;++E)x.push("        <table:table-row"+(Q[E]?' table:style-name="ro'+Q[E].ods+'"':"")+"></table:table-row>\n");for(;E<=R.e.r;++E){for(x.push("        <table:table-row"+(Q[E]?' table:style-name="ro'+Q[E].ods+'"':"")+">\n"),D=0;D<R.s.c;++D)x.push(n);for(;D<=R.e.c;++D){var he=!1,le={},me="";for(V=0;V!=L.length;++V)if(!(L[V].s.c>D||L[V].s.r>E||L[V].e.c<D||L[V].e.r<E)){(L[V].s.c!=D||L[V].s.r!=E)&&(he=!0),le["table:number-columns-spanned"]=L[V].e.c-L[V].s.c+1,le["table:number-rows-spanned"]=L[V].e.r-L[V].s.r+1;break}if(he)x.push("          <table:covered-table-cell/>\n");else{var ze=Kr({r:E,c:D}),Je=Y?(l[E]||[])[D]:l[ze];if(Je&&Je.f&&(le["table:formula"]=Rs(jhe(Je.f)),Je.F&&Je.F.slice(0,ze.length)==ze)){var ht=Kc(Je.F);le["table:number-matrix-columns-spanned"]=ht.e.c-ht.s.c+1,le["table:number-matrix-rows-spanned"]=ht.e.r-ht.s.r+1}if(Je){switch(Je.t){case"b":me=Je.v?"TRUE":"FALSE",le["office:value-type"]="boolean",le["office:boolean-value"]=Je.v?"true":"false";break;case"n":me=Je.w||String(Je.v||0),le["office:value-type"]="float",le["office:value"]=Je.v||0;break;case"s":case"str":me=null==Je.v?"":Je.v,le["office:value-type"]="string";break;case"d":me=Je.w||Lo(Je.v).toISOString(),le["office:value-type"]="date",le["office:date-value"]=Lo(Je.v).toISOString(),le["table:style-name"]="ce1";break;default:x.push(n);continue}var Ne=e(me);if(Je.l&&Je.l.Target){var dt=Je.l.Target;"#"!=(dt="#"==dt.charAt(0)?"#"+$he(dt.slice(1)):dt).charAt(0)&&!dt.match(/^\w+:/)&&(dt="../"+dt),Ne=Fn("text:a",Ne,{"xlink:href":dt.replace(/&/g,"&amp;")})}x.push("          "+Fn("table:table-cell",Fn("text:p",Ne,{}),le)+"\n")}else x.push(n)}}x.push("        </table:table-row>\n")}return x.push("      </table:table>\n"),x.join("")};return function(u,g){var x=[na],E=RS({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),D=RS({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});"fods"==g.bookType?(x.push("<office:document"+E+D+">\n"),x.push(o7().replace(/office:document-meta/g,"office:meta"))):x.push("<office:document-content"+E+">\n"),function(l,u){l.push(" <office:automatic-styles>\n"),l.push('  <number:date-style style:name="N37" number:automatic-order="true">\n'),l.push('   <number:month number:style="long"/>\n'),l.push("   <number:text>/</number:text>\n"),l.push('   <number:day number:style="long"/>\n'),l.push("   <number:text>/</number:text>\n"),l.push("   <number:year/>\n"),l.push("  </number:date-style>\n");var g=0;u.SheetNames.map(function(E){return u.Sheets[E]}).forEach(function(E){if(E&&E["!cols"])for(var D=0;D<E["!cols"].length;++D)if(E["!cols"][D]){var R=E["!cols"][D];if(null==R.width&&null==R.wpx&&null==R.wch)continue;e1(R),R.ods=g;var L=E["!cols"][D].wpx+"px";l.push('  <style:style style:name="co'+g+'" style:family="table-column">\n'),l.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+L+'"/>\n'),l.push("  </style:style>\n"),++g}});var x=0;u.SheetNames.map(function(E){return u.Sheets[E]}).forEach(function(E){if(E&&E["!rows"])for(var D=0;D<E["!rows"].length;++D)if(E["!rows"][D]){E["!rows"][D].ods=x;var R=E["!rows"][D].hpx+"px";l.push('  <style:style style:name="ro'+x+'" style:family="table-row">\n'),l.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+R+'"/>\n'),l.push("  </style:style>\n"),++x}}),l.push('  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">\n'),l.push('   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>\n'),l.push("  </style:style>\n"),l.push('  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>\n'),l.push(" </office:automatic-styles>\n")}(x,u),x.push("  <office:body>\n"),x.push("    <office:spreadsheet>\n");for(var R=0;R!=u.SheetNames.length;++R)x.push(r(u.Sheets[u.SheetNames[R]],u,R));return x.push("    </office:spreadsheet>\n"),x.push("  </office:body>\n"),x.push("fods"==g.bookType?"</office:document>":"</office:document-content>"),x.join("")}}();function J9(e,n){if("fods"==n.bookType)return K9(e,n);var t=dF(),r="",i=[],l=[];return Ii(t,r="mimetype","application/vnd.oasis.opendocument.spreadsheet"),Ii(t,r="content.xml",K9(e,n)),i.push([r,"text/xml"]),l.push([r,"ContentFile"]),Ii(t,r="styles.xml",xge(e,n)),i.push([r,"text/xml"]),l.push([r,"StylesFile"]),Ii(t,r="meta.xml",na+o7()),i.push([r,"text/xml"]),l.push([r,"MetadataFile"]),Ii(t,r="manifest.rdf",function iae(e){var n=[na];n.push('<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n');for(var t=0;t!=e.length;++t)n.push(s7(e[t][0],e[t][1])),n.push(rae("",e[t][0]));return n.push(s7("","Document","pkg")),n.push("</rdf:RDF>"),n.join("")}(l)),i.push([r,"application/rdf+xml"]),Ii(t,r="META-INF/manifest.xml",function nae(e){var n=[na];n.push('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">\n'),n.push('  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>\n');for(var t=0;t<e.length;++t)n.push('  <manifest:file-entry manifest:full-path="'+e[t][0]+'" manifest:media-type="'+e[t][1]+'"/>\n');return n.push("</manifest:manifest>"),n.join("")}(i)),t}function Wv(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function bge(e){return typeof TextEncoder<"u"?(new TextEncoder).encode(e):fd(nm(e))}function r1(e){var n=e.reduce(function(i,l){return i+l.length},0),t=new Uint8Array(n),r=0;return e.forEach(function(i){t.set(i,r),r+=i.length}),t}function nD(e,n){var t=n?n[0]:0,r=127&e[t];e:if(e[t++]>=128&&(r|=(127&e[t])<<7,e[t++]<128||(r|=(127&e[t])<<14,e[t++]<128)||(r|=(127&e[t])<<21,e[t++]<128)||(r+=(127&e[t])*Math.pow(2,28),++t,e[t++]<128)||(r+=(127&e[t])*Math.pow(2,35),++t,e[t++]<128)||(r+=(127&e[t])*Math.pow(2,42),++t,e[t++]<128)))break e;return n&&(n[0]=t),r}function Ms(e){var n=new Uint8Array(7);n[0]=127&e;var t=1;e:if(e>127){if(n[t-1]|=128,n[t]=e>>7&127,++t,e<=16383||(n[t-1]|=128,n[t]=e>>14&127,++t,e<=2097151)||(n[t-1]|=128,n[t]=e>>21&127,++t,e<=268435455)||(n[t-1]|=128,n[t]=e/256>>>21&127,++t,e<=34359738367)||(n[t-1]|=128,n[t]=e/65536>>>21&127,++t,e<=4398046511103))break e;n[t-1]|=128,n[t]=e/16777216>>>21&127,++t}return n.slice(0,t)}function ia(e){var n=0,t=127&e[n];e:if(e[n++]>=128){if(t|=(127&e[n])<<7,e[n++]<128||(t|=(127&e[n])<<14,e[n++]<128)||(t|=(127&e[n])<<21,e[n++]<128))break e;t|=(127&e[n])<<28}return t}function ps(e){for(var n=[],t=[0];t[0]<e.length;){var g,r=t[0],i=nD(e,t),l=7&i,u=0;if(0==(i=Math.floor(i/8)))break;switch(l){case 0:for(var x=t[0];e[t[0]++]>=128;);g=e.slice(x,t[0]);break;case 5:g=e.slice(t[0],t[0]+(u=4)),t[0]+=u;break;case 1:g=e.slice(t[0],t[0]+(u=8)),t[0]+=u;break;case 2:u=nD(e,t),g=e.slice(t[0],t[0]+u),t[0]+=u;break;default:throw new Error("PB Type ".concat(l," for Field ").concat(i," at offset ").concat(r))}var E={data:g,type:l};null==n[i]?n[i]=[E]:n[i].push(E)}return n}function Fl(e){var n=[];return e.forEach(function(t,r){t.forEach(function(i){i.data&&(n.push(Ms(8*r+i.type)),2==i.type&&n.push(Ms(i.data.length)),n.push(i.data))})}),r1(n)}function Oh(e){for(var n,t=[],r=[0];r[0]<e.length;){var i=nD(e,r),l=ps(e.slice(r[0],r[0]+i));r[0]+=i;var u={id:ia(l[1][0].data),messages:[]};l[2].forEach(function(g){var x=ps(g.data),E=ia(x[3][0].data);u.messages.push({meta:x,data:e.slice(r[0],r[0]+E)}),r[0]+=E}),null!=(n=l[3])&&n[0]&&(u.merge=ia(l[3][0].data)>>>0>0),t.push(u)}return t}function M2(e){var n=[];return e.forEach(function(t){var r=[];r[1]=[{data:Ms(t.id),type:0}],r[2]=[],null!=t.merge&&(r[3]=[{data:Ms(+!!t.merge),type:0}]);var i=[];t.messages.forEach(function(u){i.push(u.data),u.meta[3]=[{type:0,data:Ms(u.data.length)}],r[2].push({data:Fl(u.meta),type:2})});var l=Fl(r);n.push(Ms(l.length)),n.push(l),i.forEach(function(u){return n.push(u)})}),r1(n)}function Cge(e,n){if(0!=e)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var t=[0],r=nD(n,t),i=[];t[0]<n.length;){var l=3&n[t[0]];if(0!=l){var x=0,E=0;if(1==l?(E=4+(n[t[0]]>>2&7),x=(224&n[t[0]++])<<3,x|=n[t[0]++]):(E=1+(n[t[0]++]>>2),2==l?(x=n[t[0]]|n[t[0]+1]<<8,t[0]+=2):(x=(n[t[0]]|n[t[0]+1]<<8|n[t[0]+2]<<16|n[t[0]+3]<<24)>>>0,t[0]+=4)),i=[r1(i)],0==x)throw new Error("Invalid offset 0");if(x>i[0].length)throw new Error("Invalid offset beyond length");if(E>=x)for(i.push(i[0].slice(-x)),E-=x;E>=i[i.length-1].length;)i.push(i[i.length-1]),E-=i[i.length-1].length;i.push(i[0].slice(-x,-x+E))}else{var u=n[t[0]++]>>2;if(u<60)++u;else{var g=u-59;u=n[t[0]],g>1&&(u|=n[t[0]+1]<<8),g>2&&(u|=n[t[0]+2]<<16),g>3&&(u|=n[t[0]+3]<<24),u>>>=0,u++,t[0]+=g}i.push(n.slice(t[0],t[0]+u)),t[0]+=u}}var D=r1(i);if(D.length!=r)throw new Error("Unexpected length: ".concat(D.length," != ").concat(r));return D}function Ph(e){for(var n=[],t=0;t<e.length;){var r=e[t++],i=e[t]|e[t+1]<<8|e[t+2]<<16;n.push(Cge(r,e.slice(t+=3,t+i))),t+=i}if(t!==e.length)throw new Error("data is not a valid framed stream!");return r1(n)}function A2(e){for(var n=[],t=0;t<e.length;){var r=Math.min(e.length-t,268435455),i=new Uint8Array(4);n.push(i);var l=Ms(r),u=l.length;n.push(l),r<=60?(u++,n.push(new Uint8Array([r-1<<2]))):r<=256?(u+=2,n.push(new Uint8Array([240,r-1&255]))):r<=65536?(u+=3,n.push(new Uint8Array([244,r-1&255,r-1>>8&255]))):r<=16777216?(u+=4,n.push(new Uint8Array([248,r-1&255,r-1>>8&255,r-1>>16&255]))):r<=4294967296&&(u+=5,n.push(new Uint8Array([252,r-1&255,r-1>>8&255,r-1>>16&255,r-1>>>24&255]))),n.push(e.slice(t,t+r)),u+=r,i[0]=0,i[1]=255&u,i[2]=u>>8&255,i[3]=u>>16&255,t+=r}return r1(n)}function a4(e,n){var t=new Uint8Array(32),r=Wv(t),i=12,l=0;switch(t[0]=5,e.t){case"n":t[1]=2,function Ege(e,n,t){var r=Math.floor(0==t?0:Math.LOG10E*Math.log(Math.abs(t)))+6176-20,i=t/Math.pow(10,r-6176);e[n+15]|=r>>7,e[n+14]|=(127&r)<<1;for(var l=0;i>=1;++l,i/=256)e[n+l]=255&i;e[n+15]|=t>=0?0:128}(t,i,e.v),l|=1,i+=16;break;case"b":t[1]=6,r.setFloat64(i,e.v?1:0,!0),l|=2,i+=8;break;case"s":if(-1==n.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));t[1]=3,r.setUint32(i,n.indexOf(e.v),!0),l|=8,i+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(8,l,!0),t.slice(0,i)}function l4(e,n){var t=new Uint8Array(32),r=Wv(t),i=12,l=0;switch(t[0]=3,e.t){case"n":t[2]=2,r.setFloat64(i,e.v,!0),l|=32,i+=8;break;case"b":t[2]=6,r.setFloat64(i,e.v?1:0,!0),l|=32,i+=8;break;case"s":if(-1==n.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));t[2]=3,r.setUint32(i,n.indexOf(e.v),!0),l|=16,i+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(4,l,!0),t.slice(0,i)}function Ac(e){return nD(ps(e)[1][0].data)}function Nge(e,n,t){var r,i,l,u;if(null==(r=e[6])||!r[0]||null==(i=e[7])||!i[0])throw"Mutation only works on post-BNC storages!";if((null==(u=null==(l=e[8])?void 0:l[0])?void 0:u.data)&&ia(e[8][0].data)>0)throw"Math only works with normal offsets";for(var x=0,E=Wv(e[7][0].data),D=0,R=[],L=Wv(e[4][0].data),V=0,Y=[],G=0;G<n.length;++G)if(null!=n[G]){var Q,he;switch(E.setUint16(2*G,D,!0),L.setUint16(2*G,V,!0),typeof n[G]){case"string":Q=a4({t:"s",v:n[G]},t),he=l4({t:"s",v:n[G]},t);break;case"number":Q=a4({t:"n",v:n[G]},t),he=l4({t:"n",v:n[G]},t);break;case"boolean":Q=a4({t:"b",v:n[G]},t),he=l4({t:"b",v:n[G]},t);break;default:throw new Error("Unsupported value "+n[G])}R.push(Q),D+=Q.length,Y.push(he),V+=he.length,++x}else E.setUint16(2*G,65535,!0),L.setUint16(2*G,65535);for(e[2][0].data=Ms(x);G<e[7][0].data.length/2;++G)E.setUint16(2*G,65535,!0),L.setUint16(2*G,65535,!0);return e[6][0].data=r1(R),e[3][0].data=r1(Y),x}function d4(e){!function t$(e){return function(t){for(var r=0;r!=e.length;++r){var i=e[r];void 0===t[i[0]]&&(t[i[0]]=i[1]),"n"===i[2]&&(t[i[0]]=Number(t[i[0]]))}}}([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function jge(e,n){return"ods"==n.bookType?J9(e,n):"numbers"==n.bookType?function Fge(e,n){if(!n||!n.numbers)throw new Error("Must pass a `numbers` option -- check the README");var t=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var r=Kc(t["!ref"]);r.s.r=r.s.c=0;var i=!1;r.e.c>9&&(i=!0,r.e.c=9),r.e.r>49&&(i=!0,r.e.r=49),i&&console.error("The Numbers writer is currently limited to ".concat(Ei(r)));var l=uO(t,{range:r,header:1}),u=["~Sh33tJ5~"];l.forEach(function(st){return st.forEach(function(rt){"string"==typeof rt&&u.push(rt)})});var g={},x=[],E=Or.read(n.numbers,{type:"base64"});E.FileIndex.map(function(st,rt){return[st,E.FullPaths[rt]]}).forEach(function(st){var rt=st[0],on=st[1];2==rt.type&&rt.name.match(/\.iwa/)&&Oh(Ph(rt.content)).forEach(function(gn){x.push(gn.id),g[gn.id]={deps:[],location:on,type:ia(gn.messages[0].meta[1][0].data)}})}),x.sort(function(st,rt){return st-rt});var D=x.filter(function(st){return st>1}).map(function(st){return[st,Ms(st)]});E.FileIndex.map(function(st,rt){return[st,E.FullPaths[rt]]}).forEach(function(st){var rt=st[0];rt.name.match(/\.iwa/)&&Oh(Ph(rt.content)).forEach(function(An){An.messages.forEach(function(On){D.forEach(function(gn){An.messages.some(function(fi){return 11006!=ia(fi.meta[1][0].data)&&function wge(e,n){e:for(var t=0;t<=e.length-n.length;++t){for(var r=0;r<n.length;++r)if(e[t+r]!=n[r])continue e;return!0}return!1}(fi.data,gn[1])})&&g[gn[0]].deps.push(An.id)})})})});for(var Y,L=Or.find(E,g[1].location),V=Oh(Ph(L.content)),G=0;G<V.length;++G){var Q=V[G];1==Q.id&&(Y=Q)}var he=Ac(ps(Y.messages[0].data)[1][0].data);for(V=Oh(Ph((L=Or.find(E,g[he].location)).content)),G=0;G<V.length;++G)(Q=V[G]).id==he&&(Y=Q);for(he=Ac(ps(Y.messages[0].data)[2][0].data),V=Oh(Ph((L=Or.find(E,g[he].location)).content)),G=0;G<V.length;++G)(Q=V[G]).id==he&&(Y=Q);for(he=Ac(ps(Y.messages[0].data)[2][0].data),V=Oh(Ph((L=Or.find(E,g[he].location)).content)),G=0;G<V.length;++G)(Q=V[G]).id==he&&(Y=Q);var le=ps(Y.messages[0].data);le[6][0].data=Ms(r.e.r+1),le[7][0].data=Ms(r.e.c+1);for(var me=Ac(le[46][0].data),ze=Or.find(E,g[me].location),Je=Oh(Ph(ze.content)),ht=0;ht<Je.length&&Je[ht].id!=me;++ht);if(Je[ht].id!=me)throw"Bad ColumnRowUIDMapArchive";var Ne=ps(Je[ht].messages[0].data);Ne[1]=[],Ne[2]=[],Ne[3]=[];for(var dt=0;dt<=r.e.c;++dt){var ft=[];ft[1]=ft[2]=[{type:0,data:Ms(dt+420690)}],Ne[1].push({type:2,data:Fl(ft)}),Ne[2].push({type:0,data:Ms(dt)}),Ne[3].push({type:0,data:Ms(dt)})}Ne[4]=[],Ne[5]=[],Ne[6]=[];for(var kt=0;kt<=r.e.r;++kt)(ft=[])[1]=ft[2]=[{type:0,data:Ms(kt+726270)}],Ne[4].push({type:2,data:Fl(ft)}),Ne[5].push({type:0,data:Ms(kt)}),Ne[6].push({type:0,data:Ms(kt)});Je[ht].messages[0].data=Fl(Ne),ze.content=A2(M2(Je)),ze.size=ze.content.length,delete le[46];var $t=ps(le[4][0].data);$t[7][0].data=Ms(r.e.r+1);var wn=Ac(ps($t[1][0].data)[2][0].data);if((Je=Oh(Ph((ze=Or.find(E,g[wn].location)).content)))[0].id!=wn)throw"Bad HeaderStorageBucket";var Xn=ps(Je[0].messages[0].data);for(kt=0;kt<l.length;++kt){var Nn=ps(Xn[2][0].data);Nn[1][0].data=Ms(kt),Nn[4][0].data=Ms(l[kt].length),Xn[2][kt]={type:Xn[2][0].type,data:Fl(Nn)}}Je[0].messages[0].data=Fl(Xn),ze.content=A2(M2(Je)),ze.size=ze.content.length;var gr=Ac($t[2][0].data);if((Je=Oh(Ph((ze=Or.find(E,g[gr].location)).content)))[0].id!=gr)throw"Bad HeaderStorageBucket";for(Xn=ps(Je[0].messages[0].data),dt=0;dt<=r.e.c;++dt)(Nn=ps(Xn[2][0].data))[1][0].data=Ms(dt),Nn[4][0].data=Ms(r.e.r+1),Xn[2][dt]={type:Xn[2][0].type,data:Fl(Nn)};Je[0].messages[0].data=Fl(Xn),ze.content=A2(M2(Je)),ze.size=ze.content.length;var Kn=Ac($t[4][0].data);!function(){for(var on,st=Or.find(E,g[Kn].location),rt=Oh(Ph(st.content)),Gn=0;Gn<rt.length;++Gn){var An=rt[Gn];An.id==Kn&&(on=An)}var On=ps(on.messages[0].data);On[3]=[];var gn=[];u.forEach(function(ms,zi){gn[1]=[{type:0,data:Ms(zi)}],gn[2]=[{type:0,data:Ms(1)}],gn[3]=[{type:2,data:bge(ms)}],On[3].push({type:2,data:Fl(gn)})}),on.messages[0].data=Fl(On);var Xe=A2(M2(rt));st.content=Xe,st.size=st.content.length}();var Si=ps($t[3][0].data),Hn=Si[1][0];delete Si[2];var Nr=ps(Hn.data),mn=Ac(Nr[2][0].data);!function(){for(var on,st=Or.find(E,g[mn].location),rt=Oh(Ph(st.content)),Gn=0;Gn<rt.length;++Gn){var An=rt[Gn];An.id==mn&&(on=An)}var On=ps(on.messages[0].data);delete On[6],delete Si[7];var gn=new Uint8Array(On[5][0].data);On[5]=[];for(var fi=0,Xe=0;Xe<=r.e.r;++Xe){var ms=ps(gn);fi+=Nge(ms,l[Xe],u),ms[1][0].data=Ms(Xe),On[5].push({data:Fl(ms),type:2})}On[1]=[{type:0,data:Ms(r.e.c+1)}],On[2]=[{type:0,data:Ms(r.e.r+1)}],On[3]=[{type:0,data:Ms(fi)}],On[4]=[{type:0,data:Ms(r.e.r+1)}],on.messages[0].data=Fl(On);var Ts=A2(M2(rt));st.content=Ts,st.size=st.content.length}(),Hn.data=Fl(Nr),$t[3][0].data=Fl(Si),le[4][0].data=Fl($t),Y.messages[0].data=Fl(le);var Nt=A2(M2(V));return L.content=Nt,L.size=L.content.length,E}(e,n):"xlsb"==n.bookType?function $ge(e,n){C2=1024,e&&!e.SSF&&(e.SSF=Qs($r)),e&&e.SSF&&(_2(),kS(e.SSF),n.revssf=Bk(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF),n.rels={},n.wbrels={},n.Strings=[],n.Strings.Count=0,n.Strings.Unique=0,KS?n.revStrings=new Map:(n.revStrings={},n.revStrings.foo=[],delete n.revStrings.foo);var t="xlsb"==n.bookType?"bin":"xml",r=u9.indexOf(n.bookType)>-1,i={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};d4(n=n||{});var l=dF(),u="",g=0;if(n.cellXfs=[],n1(n.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),Ii(l,u="docProps/core.xml",l7(e.Props,n)),i.coreprops.push(u),Ds(n.rels,2,u,Ci.CORE_PROPS),u="docProps/app.xml",!e.Props||!e.Props.SheetNames)if(e.Workbook&&e.Workbook.Sheets){for(var x=[],E=0;E<e.SheetNames.length;++E)2!=(e.Workbook.Sheets[E]||{}).Hidden&&x.push(e.SheetNames[E]);e.Props.SheetNames=x}else e.Props.SheetNames=e.SheetNames;for(e.Props.Worksheets=e.Props.SheetNames.length,Ii(l,u,d7(e.Props)),i.extprops.push(u),Ds(n.rels,3,u,Ci.EXT_PROPS),e.Custprops!==e.Props&&ea(e.Custprops||{}).length>0&&(Ii(l,u="docProps/custom.xml",h7(e.Custprops)),i.custprops.push(u),Ds(n.rels,4,u,Ci.CUST_PROPS)),g=1;g<=e.SheetNames.length;++g){var D={"!id":{}},R=e.Sheets[e.SheetNames[g-1]];if(Ii(l,u="xl/worksheets/sheet"+g+"."+t,Tme(g-1,u,n,e,D)),i.sheets.push(u),Ds(n.wbrels,-1,"worksheets/sheet"+g+"."+t,Ci.WS[0]),R){var V=R["!comments"],Y=!1,G="";V&&V.length>0&&(Ii(l,G="xl/comments"+g+"."+t,Sme(V,G,n)),i.comments.push(G),Ds(D,-1,"../comments"+g+"."+t,Ci.CMNT),Y=!0),R["!legacy"]&&Y&&Ii(l,"xl/drawings/vmlDrawing"+g+".vml",a9(g,R["!comments"])),delete R["!comments"],delete R["!legacy"]}D["!id"].rId1&&Ii(l,zS(u),T2(D))}return null!=n.Strings&&n.Strings.length>0&&(Ii(l,u="xl/sharedStrings."+t,function Cme(e,n,t){return(".bin"===n.slice(-4)?Ece:Z7)(e,t)}(n.Strings,u,n)),i.strs.push(u),Ds(n.wbrels,-1,"sharedStrings."+t,Ci.SST)),Ii(l,u="xl/workbook."+t,function wme(e,n,t){return(".bin"===n.slice(-4)?cme:O9)(e,t)}(e,u,n)),i.workbooks.push(u),Ds(n.rels,1,u,Ci.WB),Ii(l,u="xl/theme/theme1.xml",qF(e.Themes,n)),i.themes.push(u),Ds(n.wbrels,-1,"theme/theme1.xml",Ci.THEME),Ii(l,u="xl/styles."+t,function Eme(e,n,t){return(".bin"===n.slice(-4)?vue:n9)(e,t)}(e,u,n)),i.styles.push(u),Ds(n.wbrels,-1,"styles."+t,Ci.STY),e.vbaraw&&r&&(Ii(l,u="xl/vbaProject.bin",e.vbaraw),i.vba.push(u),Ds(n.wbrels,-1,"vbaProject.bin",Ci.VBA)),Ii(l,u="xl/metadata."+t,function Dme(e){return(".bin"===e.slice(-4)?Gue:o9)()}(u)),i.metadata.push(u),Ds(n.wbrels,-1,"metadata."+t,Ci.XLMETA),Ii(l,"[Content_Types].xml",i7(i,n)),Ii(l,"_rels/.rels",T2(n.rels)),Ii(l,"xl/_rels/workbook."+t+".rels",T2(n.wbrels)),delete n.revssf,delete n.ssf,l}(e,n):function n$(e,n){C2=1024,e&&!e.SSF&&(e.SSF=Qs($r)),e&&e.SSF&&(_2(),kS(e.SSF),n.revssf=Bk(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF),n.rels={},n.wbrels={},n.Strings=[],n.Strings.Count=0,n.Strings.Unique=0,KS?n.revStrings=new Map:(n.revStrings={},n.revStrings.foo=[],delete n.revStrings.foo);var t="xml",r=u9.indexOf(n.bookType)>-1,i={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};d4(n=n||{});var l=dF(),u="",g=0;if(n.cellXfs=[],n1(n.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),Ii(l,u="docProps/core.xml",l7(e.Props,n)),i.coreprops.push(u),Ds(n.rels,2,u,Ci.CORE_PROPS),u="docProps/app.xml",!e.Props||!e.Props.SheetNames)if(e.Workbook&&e.Workbook.Sheets){for(var x=[],E=0;E<e.SheetNames.length;++E)2!=(e.Workbook.Sheets[E]||{}).Hidden&&x.push(e.SheetNames[E]);e.Props.SheetNames=x}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,Ii(l,u,d7(e.Props)),i.extprops.push(u),Ds(n.rels,3,u,Ci.EXT_PROPS),e.Custprops!==e.Props&&ea(e.Custprops||{}).length>0&&(Ii(l,u="docProps/custom.xml",h7(e.Custprops)),i.custprops.push(u),Ds(n.rels,4,u,Ci.CUST_PROPS));var D=["SheetJ5"];for(n.tcid=0,g=1;g<=e.SheetNames.length;++g){var R={"!id":{}},L=e.Sheets[e.SheetNames[g-1]];if(Ii(l,u="xl/worksheets/sheet"+g+"."+t,E9(g-1,n,e,R)),i.sheets.push(u),Ds(n.wbrels,-1,"worksheets/sheet"+g+"."+t,Ci.WS[0]),L){var Y=L["!comments"],G=!1,Q="";if(Y&&Y.length>0){var he=!1;Y.forEach(function(le){le[1].forEach(function(me){1==me.T&&(he=!0)})}),he&&(Ii(l,Q="xl/threadedComments/threadedComment"+g+"."+t,ede(Y,D,n)),i.threadedcomments.push(Q),Ds(R,-1,"../threadedComments/threadedComment"+g+"."+t,Ci.TCMNT)),Ii(l,Q="xl/comments"+g+"."+t,c9(Y)),i.comments.push(Q),Ds(R,-1,"../comments"+g+"."+t,Ci.CMNT),G=!0}L["!legacy"]&&G&&Ii(l,"xl/drawings/vmlDrawing"+g+".vml",a9(g,L["!comments"])),delete L["!comments"],delete L["!legacy"]}R["!id"].rId1&&Ii(l,zS(u),T2(R))}return null!=n.Strings&&n.Strings.length>0&&(Ii(l,u="xl/sharedStrings."+t,Z7(n.Strings,n)),i.strs.push(u),Ds(n.wbrels,-1,"sharedStrings."+t,Ci.SST)),Ii(l,u="xl/workbook."+t,O9(e)),i.workbooks.push(u),Ds(n.rels,1,u,Ci.WB),Ii(l,u="xl/theme/theme1.xml",qF(e.Themes,n)),i.themes.push(u),Ds(n.wbrels,-1,"theme/theme1.xml",Ci.THEME),Ii(l,u="xl/styles."+t,n9(e,n)),i.styles.push(u),Ds(n.wbrels,-1,"styles."+t,Ci.STY),e.vbaraw&&r&&(Ii(l,u="xl/vbaProject.bin",e.vbaraw),i.vba.push(u),Ds(n.wbrels,-1,"vbaProject.bin",Ci.VBA)),Ii(l,u="xl/metadata."+t,o9()),i.metadata.push(u),Ds(n.wbrels,-1,"metadata."+t,Ci.XLMETA),D.length>1&&(Ii(l,u="xl/persons/person.xml",function nde(e){var n=[na,Fn("personList",null,{xmlns:qa.TCMNT,"xmlns:x":K0[0]}).replace(/[\/]>/,">")];return e.forEach(function(t,r){n.push(Fn("person",null,{displayName:t,id:"{54EE7950-7262-4200-6969-"+("000000000000"+r).slice(-12)+"}",userId:t,providerId:"None"}))}),n.push("</personList>"),n.join("")}(D)),i.people.push(u),Ds(n.wbrels,-1,"persons/person.xml",Ci.PEOPLE)),Ii(l,"[Content_Types].xml",i7(i,n)),Ii(l,"_rels/.rels",T2(n.rels)),Ii(l,"xl/_rels/workbook.xml.rels",T2(n.wbrels)),delete n.revssf,delete n.ssf,l}(e,n)}function i$(e,n){switch(n.type){case"base64":case"binary":break;case"buffer":case"array":n.type="";break;case"file":return OS(n.file,Or.write(e,{type:Bi?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+n.bookType+"' files");default:throw new Error("Unrecognized type "+n.type)}return Or.write(e,n)}function om(e,n,t){t||(t="");var r=t+e;switch(n.type){case"base64":return DS(nm(r));case"binary":return nm(r);case"string":return e;case"file":return OS(n.file,r,"utf8");case"buffer":return Bi?Fg(r,"utf8"):typeof TextEncoder<"u"?(new TextEncoder).encode(r):om(r,{type:"binary"}).split("").map(function(i){return i.charCodeAt(0)})}throw new Error("Unrecognized type "+n.type)}function cO(e,n){switch(n.type){case"string":case"base64":case"binary":for(var t="",r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return"base64"==n.type?DS(t):"string"==n.type?_o(t):t;case"file":return OS(n.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+n.type)}}function rD(e,n){(function Ok(){Dh(1200),function yse(){kk(1252)}()})(),function k9(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");!function Xpe(e,n,t){e.forEach(function(r,i){I9(r);for(var l=0;l<i;++l)if(r==e[l])throw new Error("Duplicate Sheet Name: "+r);if(t){var u=n&&n[i]&&n[i].CodeName||r;if(95==u.charCodeAt(0)&&u.length>22)throw new Error("Bad Code Name: Worksheet"+u)}})}(e.SheetNames,e.Workbook&&e.Workbook.Sheets||[],!!e.vbaraw);for(var t=0;t<e.SheetNames.length;++t)Ghe(e.Sheets[e.SheetNames[t]],0,t)}(e);var t=Qs(n||{});if(t.cellStyles&&(t.cellNF=!0,t.sheetStubs=!0),"array"==t.type){t.type="binary";var r=rD(e,t);return t.type="array",MS(r)}var i=0;if(t.sheet&&(i="number"==typeof t.sheet?t.sheet:e.SheetNames.indexOf(t.sheet),!e.SheetNames[i]))throw new Error("Sheet not found: "+t.sheet+" : "+typeof t.sheet);switch(t.bookType||"xlsb"){case"xml":case"xlml":return om(Wme(e,t),t);case"slk":case"sylk":return om(H7.from_sheet(e.Sheets[e.SheetNames[i]],t),t);case"htm":case"html":return om($9(e.Sheets[e.SheetNames[i]],t),t);case"txt":return function Jge(e,n){switch(n.type){case"base64":return DS(e);case"binary":case"string":return e;case"file":return OS(n.file,e,"binary");case"buffer":return Bi?Fg(e,"binary"):e.split("").map(function(t){return t.charCodeAt(0)})}throw new Error("Unrecognized type "+n.type)}(u$(e.Sheets[e.SheetNames[i]],t),t);case"csv":return om(g4(e.Sheets[e.SheetNames[i]],t),t,"\ufeff");case"dif":return om(G7.from_sheet(e.Sheets[e.SheetNames[i]],t),t);case"dbf":return cO(jF.from_sheet(e.Sheets[e.SheetNames[i]],t),t);case"prn":return om(E2.from_sheet(e.Sheets[e.SheetNames[i]],t),t);case"rtf":return om(Q7.from_sheet(e.Sheets[e.SheetNames[i]],t),t);case"eth":return om(W7.from_sheet(e.Sheets[e.SheetNames[i]],t),t);case"fods":return om(J9(e,t),t);case"wk1":return cO(Hv.sheet_to_wk1(e.Sheets[e.SheetNames[i]],t),t);case"wk3":return cO(Hv.book_to_wk3(e,t),t);case"biff2":t.biff||(t.biff=2);case"biff3":t.biff||(t.biff=3);case"biff4":return t.biff||(t.biff=4),cO(L9(e,t),t);case"biff5":t.biff||(t.biff=5);case"biff8":case"xla":case"xls":return t.biff||(t.biff=8),function Kge(e,n){var t=n||{};return i$(function Qme(e,n){var t=n||{},r=Or.utils.cfb_new({root:"R"}),i="/Workbook";switch(t.bookType||"xls"){case"xls":t.bookType="biff8";case"xla":t.bookType||(t.bookType="xla");case"biff8":i="/Workbook",t.biff=8;break;case"biff5":i="/Book",t.biff=5;break;default:throw new Error("invalid type "+t.bookType+" for XLS CFB")}return Or.utils.cfb_add(r,i,L9(e,t)),8==t.biff&&(e.Props||e.Custprops)&&function Jme(e,n){var u,t=[],r=[],i=[],l=0,g=pj(OF,"n"),x=pj(PF,"n");if(e.Props)for(u=ea(e.Props),l=0;l<u.length;++l)(Object.prototype.hasOwnProperty.call(g,u[l])?t:Object.prototype.hasOwnProperty.call(x,u[l])?r:i).push([u[l],e.Props[u[l]]]);if(e.Custprops)for(u=ea(e.Custprops),l=0;l<u.length;++l)Object.prototype.hasOwnProperty.call(e.Props||{},u[l])||(Object.prototype.hasOwnProperty.call(g,u[l])?t:Object.prototype.hasOwnProperty.call(x,u[l])?r:i).push([u[l],e.Custprops[u[l]]]);var E=[];for(l=0;l<i.length;++l)x7.indexOf(i[l][0])>-1||c7.indexOf(i[l][0])>-1||null!=i[l][1]&&E.push(i[l]);r.length&&Or.utils.cfb_add(n,"/\x05SummaryInformation",T7(r,QS.SI,x,PF)),(t.length||E.length)&&Or.utils.cfb_add(n,"/\x05DocumentSummaryInformation",T7(t,QS.DSI,g,OF,E.length?E:null,QS.UDI))}(e,r),8==t.biff&&e.vbaraw&&function dde(e,n){n.FullPaths.forEach(function(t,r){if(0!=r){var i=t.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");"/"!==i.slice(-1)&&Or.utils.cfb_add(e,i,n.FileIndex[r].content)}})}(r,Or.read(e.vbaraw,{type:"string"==typeof e.vbaraw?"binary":"buffer"})),r}(e,t),t)}(e,t);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return function Xge(e,n){var t=Qs(n||{});return function s$(e,n){var t={},r=Bi?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(n.compression&&(t.compression="DEFLATE"),n.password)t.type=r;else switch(n.type){case"base64":t.type="base64";break;case"binary":t.type="string";break;case"string":throw new Error("'string' output type invalid for '"+n.bookType+"' files");case"buffer":case"file":t.type=r;break;default:throw new Error("Unrecognized type "+n.type)}var i=e.FullPaths?Or.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[t.type]||t.type,compression:!!n.compression}):e.generate(t);if(typeof Deno<"u"&&"string"==typeof i){if("binary"==n.type||"base64"==n.type)return i;i=new Uint8Array(MS(i))}return n.password&&typeof encrypt_agile<"u"?i$(encrypt_agile(i,n.password),n):"file"===n.type?OS(n.file,i):"string"==n.type?_o(i):i}(jge(e,t),t)}(e,t);default:throw new Error("Unrecognized bookType |"+t.bookType+"|")}}function a$(e,n,t,r,i,l,u,g){var x=ra(t),E=g.defval,D=g.raw||!Object.prototype.hasOwnProperty.call(g,"raw"),R=!0,L=1===i?[]:{};if(1!==i)if(Object.defineProperty)try{Object.defineProperty(L,"__rowNum__",{value:t,enumerable:!1})}catch{L.__rowNum__=t}else L.__rowNum__=t;if(!u||e[t])for(var V=n.s.c;V<=n.e.c;++V){var Y=u?e[t][V]:e[r[V]+x];if(void 0!==Y&&void 0!==Y.t){var G=Y.v;switch(Y.t){case"z":if(null==G)break;continue;case"e":G=0==G?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+Y.t)}if(null!=l[V]){if(null==G)if("e"==Y.t&&null===G)L[l[V]]=null;else if(void 0!==E)L[l[V]]=E;else{if(!D||null!==G)continue;L[l[V]]=null}else L[l[V]]=D&&("n"!==Y.t||"n"===Y.t&&!1!==g.rawNumbers)?G:rm(Y,G,g);null!=G&&(R=!1)}}else{if(void 0===E)continue;null!=l[V]&&(L[l[V]]=E)}}return{row:L,isempty:R}}function uO(e,n){if(null==e||null==e["!ref"])return[];var t={t:"n",v:0},r=0,i=1,l=[],u=0,g="",x={s:{r:0,c:0},e:{r:0,c:0}},E=n||{},D=null!=E.range?E.range:e["!ref"];switch(1===E.header?r=1:"A"===E.header?r=2:Array.isArray(E.header)?r=3:null==E.header&&(r=0),typeof D){case"string":x=Qi(D);break;case"number":(x=Qi(e["!ref"])).s.r=D;break;default:x=D}r>0&&(i=0);var R=ra(x.s.r),L=[],V=[],Y=0,G=0,Q=Array.isArray(e),he=x.s.r,le=0,me={};Q&&!e[he]&&(e[he]=[]);var ze=E.skipHidden&&e["!cols"]||[],Je=E.skipHidden&&e["!rows"]||[];for(le=x.s.c;le<=x.e.c;++le)if(!(ze[le]||{}).hidden)switch(L[le]=yo(le),t=Q?e[he][le]:e[L[le]+R],r){case 1:l[le]=le-x.s.c;break;case 2:l[le]=L[le];break;case 3:l[le]=E.header[le-x.s.c];break;default:if(null==t&&(t={w:"__EMPTY",t:"s"}),g=u=rm(t,null,E),G=me[u]||0){do{g=u+"_"+G++}while(me[g]);me[u]=G,me[g]=1}else me[u]=1;l[le]=g}for(he=x.s.r+i;he<=x.e.r;++he)if(!(Je[he]||{}).hidden){var ht=a$(e,x,he,L,r,l,Q,E);(!1===ht.isempty||(1===r?!1!==E.blankrows:E.blankrows))&&(V[Y++]=ht.row)}return V.length=Y,V}var l$=/"/g;function c$(e,n,t,r,i,l,u,g){for(var x=!0,E=[],D="",R=ra(t),L=n.s.c;L<=n.e.c;++L)if(r[L]){var V=g.dense?(e[t]||[])[L]:e[r[L]+R];if(null==V)D="";else if(null!=V.v){x=!1,D=""+(g.rawNumbers&&"n"==V.t?V.v:rm(V,null,g));for(var Y=0,G=0;Y!==D.length;++Y)if((G=D.charCodeAt(Y))===i||G===l||34===G||g.forceQuotes){D='"'+D.replace(l$,'""')+'"';break}"ID"==D&&(D='"ID"')}else null==V.f||V.F?D="":(x=!1,(D="="+V.f).indexOf(",")>=0&&(D='"'+D.replace(l$,'""')+'"'));E.push(D)}return!1===g.blankrows&&x?null:E.join(u)}function g4(e,n){var t=[],r=n??{};if(null==e||null==e["!ref"])return"";var i=Qi(e["!ref"]),l=void 0!==r.FS?r.FS:",",u=l.charCodeAt(0),g=void 0!==r.RS?r.RS:"\n",x=g.charCodeAt(0),E=new RegExp(("|"==l?"\\|":l)+"+$"),D="",R=[];r.dense=Array.isArray(e);for(var L=r.skipHidden&&e["!cols"]||[],V=r.skipHidden&&e["!rows"]||[],Y=i.s.c;Y<=i.e.c;++Y)(L[Y]||{}).hidden||(R[Y]=yo(Y));for(var G=0,Q=i.s.r;Q<=i.e.r;++Q)(V[Q]||{}).hidden||null!=(D=c$(e,i,Q,R,u,x,l,r))&&(r.strip&&(D=D.replace(E,"")),(D||!1!==r.blankrows)&&t.push((G++?g:"")+D));return delete r.dense,t.join("")}function u$(e,n){n||(n={}),n.FS="\t",n.RS="\n";var t=g4(e,n);return typeof is>"u"||"string"==n.type?t:"\xff\xfe"+is.utils.encode(1200,t,"str")}function d$(e,n,t){var r=t||{},i=+!r.skipHeader,l=e||{},u=0,g=0;if(l&&null!=r.origin)if("number"==typeof r.origin)u=r.origin;else{var x="string"==typeof r.origin?wa(r.origin):r.origin;u=x.r,g=x.c}var E,D={s:{c:0,r:0},e:{c:g,r:u+n.length-1+i}};if(l["!ref"]){var R=Qi(l["!ref"]);D.e.c=Math.max(D.e.c,R.e.c),D.e.r=Math.max(D.e.r,R.e.r),-1==u&&(D.e.r=(u=R.e.r+1)+n.length-1+i)}else-1==u&&(u=0,D.e.r=n.length-1+i);var L=r.header||[],V=0;n.forEach(function(G,Q){ea(G).forEach(function(he){-1==(V=L.indexOf(he))&&(L[V=L.length]=he);var le=G[he],me="z",ze="",Je=Kr({c:g+V,r:u+Q+i});E=iD(l,Je),!le||"object"!=typeof le||le instanceof Date?("number"==typeof le?me="n":"boolean"==typeof le?me="b":"string"==typeof le?me="s":le instanceof Date?(me="d",r.cellDates||(me="n",le=Ol(le)),ze=r.dateNF||$r[14]):null===le&&r.nullError&&(me="e",le=0),E?(E.t=me,E.v=le,delete E.w,delete E.R,ze&&(E.z=ze)):l[Je]=E={t:me,v:le},ze&&(E.z=ze)):l[Je]=le})}),D.e.c=Math.max(D.e.c,g+L.length-1);var Y=ra(u);if(i)for(V=0;V<L.length;++V)l[yo(V+g)+Y]={t:"s",v:L[V]};return l["!ref"]=Ei(D),l}function iD(e,n,t){if("string"==typeof n){if(Array.isArray(e)){var r=wa(n);return e[r.r]||(e[r.r]=[]),e[r.r][r.c]||(e[r.r][r.c]={t:"z"})}return e[n]||(e[n]={t:"z"})}return iD(e,Kr("number"!=typeof n?n:{r:n,c:t||0}))}var f$_json_to_sheet=function e_e(e,n){return d$(null,e,n)},p$=Ja(578);let v4=(()=>{class e{constructor(t){this.httpClient=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getProducts(){return this.httpClient.get(this.baseUrl+"api/product/products")}updateProduct(t,r){return this.httpClient.put(this.baseUrl+"api/product/products/"+t,r)}createProduct(t){return this.httpClient.post(this.baseUrl+"api/product/product/",t)}updateCatalogoPage(){return this.httpClient.get(this.baseUrl+"api/product/syn_products_page")}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),x4=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getSuppliers(){return this.http.get(`${this.baseUrl}api/supplier/suppliers`)}createSupplier(t){return this.http.post(`${this.baseUrl}api/supplier/supplier`,t)}updateSupplier(t){return this.http.put(`${this.baseUrl}api/supplier/supplier/${t._id}`,t)}deleteSupplier(t){return this.http.delete(`${this.baseUrl}api/supplier/supplier/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),m$=(()=>{class e{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(id),ut(Li))};static#t=this.\u0275dir=Sn({type:e})}return e})(),qv=(()=>{class e extends m${static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275dir=Sn({type:e,features:[hs]})}return e})();const _d=new vn(""),h_e={provide:_d,useExisting:Fi(()=>hO),multi:!0};let hO=(()=>{class e extends qv{writeValue(t){this.setProperty("checked",t)}static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275dir=Sn({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,i){1&r&&ct("change",function(u){return i.onChange(u.target.checked)})("blur",function(){return i.onTouched()})},features:[js([h_e]),hs]})}return e})();const f_e={provide:_d,useExisting:Fi(()=>Hs),multi:!0},m_e=new vn("");let Hs=(()=>{class e extends m${constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function p_e(){const e=B0()?B0().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(id),ut(Li),ut(m_e,8))};static#t=this.\u0275dir=Sn({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){1&r&&ct("input",function(u){return i._handleInput(u.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(u){return i._compositionEnd(u.target.value)})},features:[js([f_e]),hs]})}return e})();function i1(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function g$(e){return null!=e&&"number"==typeof e.length}const nc=new vn(""),s1=new vn(""),g_e=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class I2{static min(n){return _$(n)}static max(n){return y$(n)}static required(n){return v$(n)}static requiredTrue(n){return function x$(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function b$(e){return i1(e.value)||g_e.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function w$(e){return n=>i1(n.value)||!g$(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return function T$(e){return n=>g$(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static pattern(n){return function E$(e){if(!e)return fO;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),r=>{if(i1(r.value))return null;const i=r.value;return n.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}(n)}static nullValidator(n){return null}static compose(n){return I$(n)}static composeAsync(n){return k$(n)}}function _$(e){return n=>{if(i1(n.value)||i1(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}function y$(e){return n=>{if(i1(n.value)||i1(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}function v$(e){return i1(e.value)?{required:!0}:null}function fO(e){return null}function C$(e){return null!=e}function S$(e){return XC(e)?Ha(e):e}function D$(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function M$(e,n){return n.map(t=>t(e))}function A$(e){return e.map(n=>function __e(e){return!e.validate}(n)?n:t=>n.validate(t))}function I$(e){if(!e)return null;const n=e.filter(C$);return 0==n.length?null:function(t){return D$(M$(t,n))}}function b4(e){return null!=e?I$(A$(e)):null}function k$(e){if(!e)return null;const n=e.filter(C$);return 0==n.length?null:function(t){return function d_e(...e){const n=rk(e),{args:t,keys:r}=BU(e),i=new Di(l=>{const{length:u}=t;if(!u)return void l.complete();const g=new Array(u);let x=u,E=u;for(let D=0;D<u;D++){let R=!1;Dl(t[D]).subscribe(te(l,L=>{R||(R=!0,E--),g[D]=L},()=>x--,void 0,()=>{(!x||!R)&&(E||l.next(r?zU(r,g):g),l.complete())}))}});return n?i.pipe(MN(n)):i}(M$(t,n).map(S$)).pipe(pe(D$))}}function w4(e){return null!=e?k$(A$(e)):null}function O$(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function P$(e){return e._rawValidators}function R$(e){return e._rawAsyncValidators}function T4(e){return e?Array.isArray(e)?e:[e]:[]}function pO(e,n){return Array.isArray(e)?e.includes(n):e===n}function N$(e,n){const t=T4(n);return T4(e).forEach(i=>{pO(t,i)||t.push(i)}),t}function F$(e,n){return T4(n).filter(t=>!pO(e,t))}class L${constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=b4(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=w4(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class Qc extends L${get formDirective(){return null}get path(){return null}}class o1 extends L${constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class B${constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let so=(()=>{class e extends B${constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(o1,2))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){2&r&&Xi("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[hs]})}return e})(),k2=(()=>{class e extends B${constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Qc,10))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){2&r&&Xi("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[hs]})}return e})();const sD="VALID",gO="INVALID",O2="PENDING",oD="DISABLED";class P2{}class U$ extends P2{constructor(n,t){super(),this.value=n,this.source=t}}class S4 extends P2{constructor(n,t){super(),this.pristine=n,this.source=t}}class D4 extends P2{constructor(n,t){super(),this.touched=n,this.source=t}}class _O extends P2{constructor(n,t){super(),this.status=n,this.source=t}}class w_e extends P2{constructor(n){super(),this.source=n}}class T_e extends P2{constructor(n){super(),this.source=n}}function M4(e){return(yO(e)?e.validators:e)||null}function A4(e,n){return(yO(n)?n.asyncValidators:e)||null}function yO(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function V$(e,n,t){const r=e.controls;if(!(n?Object.keys(r):r).length)throw new ln(1e3,"");if(!r[t])throw new ln(1001,"")}function j$(e,n,t){e._forEachChild((r,i)=>{if(void 0===t[i])throw new ln(1002,"")})}class vO{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=eS(()=>this.statusReactive()),this.statusReactive=Ag(void 0),this._pristine=eS(()=>this.pristineReactive()),this.pristineReactive=Ag(!0),this._touched=eS(()=>this.touchedReactive()),this.touchedReactive=Ag(!1),this._events=new Mi,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return qp(this.statusReactive)}set status(n){qp(()=>this.statusReactive.set(n))}get valid(){return this.status===sD}get invalid(){return this.status===gO}get pending(){return this.status==O2}get disabled(){return this.status===oD}get enabled(){return this.status!==oD}get pristine(){return qp(this.pristineReactive)}set pristine(n){qp(()=>this.pristineReactive.set(n))}get dirty(){return!this.pristine}get touched(){return qp(this.touchedReactive)}set touched(n){qp(()=>this.touchedReactive.set(n))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(N$(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(N$(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(F$(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(F$(n,this._rawAsyncValidators))}hasValidator(n){return pO(this._rawValidators,n)}hasAsyncValidator(n){return pO(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){const t=!1===this.touched;this.touched=!0;const r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched({...n,sourceControl:r}),t&&!1!==n.emitEvent&&this._events.next(new D4(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(n))}markAsUntouched(n={}){const t=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const r=n.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),t&&!1!==n.emitEvent&&this._events.next(new D4(!1,r))}markAsDirty(n={}){const t=!0===this.pristine;this.pristine=!1;const r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty({...n,sourceControl:r}),t&&!1!==n.emitEvent&&this._events.next(new S4(!1,r))}markAsPristine(n={}){const t=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const r=n.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),t&&!1!==n.emitEvent&&this._events.next(new S4(!0,r))}markAsPending(n={}){this.status=O2;const t=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new _O(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending({...n,sourceControl:t})}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=oD,this.errors=null,this._forEachChild(i=>{i.disable({...n,onlySelf:!0})}),this._updateValue();const r=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new U$(this.value,r)),this._events.next(new _O(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t},this),this._onDisabledChange.forEach(i=>i(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=sD,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t},this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,t){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===sD||this.status===O2)&&this._runAsyncValidator(r,n.emitEvent)}const t=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new U$(this.value,t)),this._events.next(new _O(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity({...n,sourceControl:t})}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?oD:sD}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,t){if(this.asyncValidator){this.status=O2,this._hasOwnPendingAsyncValidator={emitEvent:!1!==t};const r=S$(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent,this,t.shouldHaveEmitted)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(n,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,t,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new _O(this.status,t)),this._parent&&this._parent._updateControlsErrors(n,t,r)}_initObservables(){this.valueChanges=new rr,this.statusChanges=new rr}_calculateStatus(){return this._allControlsDisabled()?oD:this.errors?gO:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(O2)?O2:this._anyControlsHaveStatus(gO)?gO:sD}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,t){const r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,t),i&&this._events.next(new S4(this.pristine,t))}_updateTouched(n={},t){this.touched=this._anyControlsTouched(),this._events.next(new D4(this.touched,t)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,t)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){yO(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function E_e(e){return Array.isArray(e)?b4(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function C_e(e){return Array.isArray(e)?w4(e):e||null}(this._rawAsyncValidators)}}class aD extends vO{constructor(n,t,r){super(M4(t),A4(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,r={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){j$(this,0,n),Object.keys(n).forEach(r=>{V$(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(r=>{const i=this.controls[r];i&&i.patchValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((r,i)=>{r.reset(n?n[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,r)=>(n[r]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&n(r,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(n,t){let r=n;return this._forEachChild((i,l)=>{r=t(r,i,l)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class $$ extends aD{}const Zv=new vn("CallSetDisabledState",{providedIn:"root",factory:()=>lD}),lD="always";function xO(e,n){return[...n.path,e]}function cD(e,n,t=lD){I4(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function D_e(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&H$(e,n)})}(e,n),function A_e(e,n){const t=(r,i)=>{n.valueAccessor.writeValue(r),i&&n.viewToModelUpdate(r)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function M_e(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&H$(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function S_e(e,n){if(n.valueAccessor.setDisabledState){const t=r=>{n.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function bO(e,n,t=!0){const r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),TO(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function wO(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function I4(e,n){const t=P$(e);null!==n.validator?e.setValidators(O$(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const r=R$(e);null!==n.asyncValidator?e.setAsyncValidators(O$(r,n.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const i=()=>e.updateValueAndValidity();wO(n._rawValidators,i),wO(n._rawAsyncValidators,i)}function TO(e,n){let t=!1;if(null!==e){if(null!==n.validator){const i=P$(e);if(Array.isArray(i)&&i.length>0){const l=i.filter(u=>u!==n.validator);l.length!==i.length&&(t=!0,e.setValidators(l))}}if(null!==n.asyncValidator){const i=R$(e);if(Array.isArray(i)&&i.length>0){const l=i.filter(u=>u!==n.asyncValidator);l.length!==i.length&&(t=!0,e.setAsyncValidators(l))}}}const r=()=>{};return wO(n._rawValidators,r),wO(n._rawAsyncValidators,r),t}function H$(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function G$(e,n){I4(e,n)}function O4(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}function W$(e,n){e._syncPendingControls(),n.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function P4(e,n){if(!n)return null;let t,r,i;return Array.isArray(n),n.forEach(l=>{l.constructor===Hs?t=l:function O_e(e){return Object.getPrototypeOf(e.constructor)===qv}(l)?r=l:i=l}),i||r||t||null}const R_e={provide:Qc,useExisting:Fi(()=>Xv)},uD=Promise.resolve();let Xv=(()=>{class e extends Qc{get submitted(){return qp(this.submittedReactive)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=eS(()=>this.submittedReactive()),this.submittedReactive=Ag(!1),this._directives=new Set,this.ngSubmit=new rr,this.form=new aD({},b4(t),w4(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){uD.then(()=>{const r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),cD(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){uD.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){uD.then(()=>{const r=this._findContainer(t.path),i=new aD({});G$(i,t),r.registerControl(t.name,i),i.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){uD.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){uD.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),W$(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(r){return new(r||e)(ut(nc,10),ut(s1,10),ut(Zv,8))};static#t=this.\u0275dir=Sn({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,i){1&r&&ct("submit",function(u){return i.onSubmit(u)})("reset",function(){return i.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[js([R_e]),hs]})}return e})();function q$(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function Z$(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const dD=class extends vO{constructor(n=null,t,r){super(M4(t),A4(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),yO(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=Z$(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){q$(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){q$(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){Z$(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},L_e={provide:o1,useExisting:Fi(()=>oo)},K$=Promise.resolve();let oo=(()=>{class e extends o1{constructor(t,r,i,l,u,g){super(),this._changeDetectorRef=u,this.callSetDisabledState=g,this.control=new dD,this._registered=!1,this.name="",this.update=new rr,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=P4(0,l)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),O4(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){cD(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){K$.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const r=t.isDisabled.currentValue,i=0!==r&&go(r);K$.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?xO(t,this._parent):[t]}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Qc,9),ut(nc,10),ut(s1,10),ut(_d,10),ut(Th,8),ut(Zv,8))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[js([L_e]),hs,Co]})}return e})(),R2=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Sn({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})();const B_e={provide:_d,useExisting:Fi(()=>Nh),multi:!0};let Nh=(()=>{class e extends qv{writeValue(t){this.setProperty("value",t??"")}registerOnChange(t){this.onChange=r=>{t(""==r?null:parseFloat(r))}}static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275dir=Sn({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,i){1&r&&ct("input",function(u){return i.onChange(u.target.value)})("blur",function(){return i.onTouched()})},features:[js([B_e]),hs]})}return e})();const R4=new vn(""),$_e={provide:Qc,useExisting:Fi(()=>EO)};let EO=(()=>{class e extends Qc{get submitted(){return qp(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=eS(()=>this._submittedReactive()),this._submittedReactive=Ag(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new rr,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(TO(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const r=this.form.get(t.path);return cD(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){bO(t.control||null,t,!1),function P_e(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this._submittedReactive.set(!0),W$(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new w_e(this.control)),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this._submittedReactive.set(!1),this.form._events.next(new T_e(this.form))}_updateDomValue(){this.directives.forEach(t=>{const r=t.control,i=this.form.get(t.path);r!==i&&(bO(r||null,t),(e=>e instanceof dD)(i)&&(cD(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const r=this.form.get(t.path);G$(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const r=this.form.get(t.path);r&&function I_e(e,n){return TO(e,n)}(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){I4(this.form,this),this._oldForm&&TO(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(r){return new(r||e)(ut(nc,10),ut(s1,10),ut(Zv,8))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","formGroup",""]],hostBindings:function(r,i){1&r&&ct("submit",function(u){return i.onSubmit(u)})("reset",function(){return i.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[js([$_e]),hs,Co]})}return e})();const W_e={provide:o1,useExisting:Fi(()=>L4)};let L4=(()=>{class e extends o1{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,r,i,l,u){super(),this._ngModelWarningConfig=u,this._added=!1,this.name=null,this.update=new rr,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=P4(0,l)}ngOnChanges(t){this._added||this._setUpControl(),O4(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return xO(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(r){return new(r||e)(ut(Qc,13),ut(nc,10),ut(s1,10),ut(_d,10),ut(R4,8))};static#n=this.\u0275dir=Sn({type:e,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[js([W_e]),hs,Co]})}return e})();const q_e={provide:_d,useExisting:Fi(()=>eu),multi:!0};function nH(e,n){return null==e?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let eu=(()=>{class e extends qv{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const i=nH(this._getOptionId(t),t);this.setProperty("value",i)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function Z_e(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275dir=Sn({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,i){1&r&&ct("change",function(u){return i.onChange(u.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[js([q_e]),hs]})}return e})(),yd=(()=>{class e{constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(nH(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Li),ut(id),ut(eu,9))};static#t=this.\u0275dir=Sn({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();const X_e={provide:_d,useExisting:Fi(()=>B4),multi:!0};function rH(e,n){return null==e?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let B4=(()=>{class e extends qv{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const i=t.map(l=>this._getOptionId(l));r=(l,u)=>{l._setSelected(i.indexOf(u.toString())>-1)}}else r=(i,l)=>{i._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const i=[],l=r.selectedOptions;if(void 0!==l){const u=l;for(let g=0;g<u.length;g++){const E=this._getOptionValue(u[g].value);i.push(E)}}else{const u=r.options;for(let g=0;g<u.length;g++){const x=u[g];if(x.selected){const E=this._getOptionValue(x.value);i.push(E)}}}this.value=i,t(i)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function Y_e(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275dir=Sn({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,i){1&r&&ct("change",function(u){return i.onChange(u.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[js([X_e]),hs]})}return e})(),vd=(()=>{class e{constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(rH(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(rH(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Li),ut(id),ut(B4,9))};static#t=this.\u0275dir=Sn({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();function sH(e){return"number"==typeof e?e:parseFloat(e)}let Yv=(()=>{class e{constructor(){this._validator=fO}ngOnChanges(t){if(this.inputName in t){const r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):fO,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return null!=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Sn({type:e,features:[Co]})}return e})();const K_e={provide:nc,useExisting:Fi(()=>z4),multi:!0};let z4=(()=>{class e extends Yv{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=t=>sH(t),this.createValidator=t=>y$(t)}static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275dir=Sn({type:e,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(r,i){2&r&&rs("max",i._enabled?i.max:null)},inputs:{max:"max"},features:[js([K_e]),hs]})}return e})();const J_e={provide:nc,useExisting:Fi(()=>CO),multi:!0};let CO=(()=>{class e extends Yv{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=t=>sH(t),this.createValidator=t=>_$(t)}static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275dir=Sn({type:e,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,i){2&r&&rs("min",i._enabled?i.min:null)},inputs:{min:"min"},features:[js([J_e]),hs]})}return e})();const Q_e={provide:nc,useExisting:Fi(()=>a1),multi:!0};let a1=(()=>{class e extends Yv{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=go,this.createValidator=t=>v$}enabled(t){return t}static#e=this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Ki(e)))(i||e)}})();static#t=this.\u0275dir=Sn({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,i){2&r&&rs("required",i._enabled?"":null)},inputs:{required:"required"},features:[js([Q_e]),hs]})}return e})(),dH=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})();class hH extends vO{constructor(n,t,r){super(M4(t),A4(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,r={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,t={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,r={}){let i=this._adjustIndex(n);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){j$(this,0,n),n.forEach((r,i)=>{V$(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((r,i)=>{r.reset(n[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,r)=>{n(t,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function fH(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let s0e=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,r=null){const i=this._reduceControls(t);let l={};return fH(r)?l=r:null!==r&&(l.validators=r.validator,l.asyncValidators=r.asyncValidator),new aD(i,l)}record(t,r=null){const i=this._reduceControls(t);return new $$(i,r)}control(t,r,i){let l={};return this.useNonNullable?(fH(r)?l=r:(l.validators=r,l.asyncValidators=i),new dD(t,{...l,nonNullable:!0})):new dD(t,r,i)}array(t,r,i){const l=t.map(u=>this._createControl(u));return new hH(l,r,i)}_reduceControls(t){const r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){return t instanceof dD||t instanceof vO?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),o0e=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:Zv,useValue:t.callSetDisabledState??lD}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({imports:[dH]})}return e})(),a0e=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:R4,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:Zv,useValue:t.callSetDisabledState??lD}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({imports:[dH]})}return e})();function l0e(e,n){1&e&&Rt(0,"br")}function c0e(e,n){if(1&e&&(P(0,"div",84),U(1),O()),2&e){const t=Ge();W(),Zn(" ",t.successMessage," ")}}function u0e(e,n){if(1&e&&(P(0,"div",85),U(1),O()),2&e){const t=Ge();W(),Zn(" ",t.errorMessage," ")}}function d0e(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td"),U(8),O(),P(9,"td"),U(10),O(),P(11,"td"),U(12),zn(13,"currency"),O(),P(14,"td"),U(15),zn(16,"currency"),O(),P(17,"td"),U(18),O(),P(19,"td"),U(20),O(),P(21,"td"),U(22),O(),P(23,"td")(24,"span",86),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().openEditModal(i,"update"))}),Rt(25,"i",87),O()()()}if(2&e){const t=n.$implicit;W(2),tt(t.sku),W(2),tt(t.name),W(2),tt(t.unit),W(2),tt(t.child),W(2),tt(t.category),W(2),tt(Jo(13,10,t.price_purchase,"USD","symbol","1.0-0")),W(3),tt(Jo(16,15,t.price_sale,"USD","symbol","1.0-0")),W(3),tt(t.margen),W(2),tt(t.step_unit),W(2),tt(t.factor_volumen)}}function h0e(e,n){if(1&e&&(P(0,"option",88),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t.nickname),W(),tt(t.nickname)}}function f0e(e,n){if(1&e){const t=lr();P(0,"button",89),ct("click",function(){return Bt(t),zt(Ge().updated_product())}),U(1,"Guardar Cambios"),O()}2&e&&Oe("disabled",!Ge().camposCompletos())}function p0e(e,n){if(1&e){const t=lr();P(0,"button",90),ct("click",function(){return Bt(t),zt(Ge().created_product())}),U(1,"Nuevo Producto"),O()}}let m0e=(()=>{class e{constructor(t,r,i){this.productService=t,this.router=r,this.supplierService=i,this.products=[],this.filteredProducts=[],this.searchText="",this.product={},this.actionTipo="",this.successMessage="",this.errorMessage="",this.sortColumn="",this.sortDirection=1,this.suppliers=[]}ngOnInit(){this.checkIfLoggedIn()?(this.getProducts(),this.supplierService.getSuppliers().subscribe(r=>{this.suppliers=r})):this.router.navigate(["/login"])}checkIfLoggedIn(){return!!localStorage.getItem("token")}getProducts(){this.productService.getProducts().subscribe(t=>{this.products=t,this.filteredProducts=t,this.filterProducts()})}exportToExcel(t=1){const r=this.products.map(D=>({SKU:D.sku,Nombre:D.name,Precio_Venta:new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(D.price_sale*t)})),i=(new Date).toISOString().split("T")[0],l=f$_json_to_sheet(r);l["!cols"]=[{wch:20},{wch:40},{wch:20}];const x=rD({Sheets:{Productos:l},SheetNames:["Productos"]},{bookType:"xlsx",type:"array"}),E=new Blob([x],{type:"application/octet-stream"});(0,p$.saveAs)(E,`productos_${i}_FRESCAPP.xlsx`)}filterProducts(){if(""!==this.searchText.trim()){const t=this.searchText.toLowerCase();this.filteredProducts=this.products.filter(r=>r.name.toLowerCase().includes(t)||r.unit?.toLowerCase().includes(t)||r.category?.toLowerCase().includes(t)||r.sku?.toLowerCase().includes(t)||r.child?.toString().includes(t))}else this.filteredProducts=this.products}openEditModal(t,r){this.product=t,this.actionTipo=r}updated_product(){this.product.price_sale=parseFloat(this.product.price_sale),this.product.price_purchase=parseFloat(this.product.price_purchase),this.product.margen=parseFloat(this.product.margen),this.product.discount=parseFloat(this.product.discount),this.product.iva_value=parseFloat(this.product.iva_value),this.product.is_visible=!!this.product.is_visible,this.product.iva="true"===this.product.iva,this.productService.updateProduct(this.product.id,this.product).subscribe(t=>{this.successMessage="\xa1Producto actualizado correctamente!",this.getProducts(),setTimeout(()=>{this.successMessage=""},3e3)})}created_product(){this.product.price_sale=+this.product.price_sale,this.product.price_purchase=+this.product.price_purchase,this.product.quantity=0,this.product.iva="true"===this.product.iva,this.productService.createProduct(this.product).subscribe(t=>{this.getProducts()})}camposCompletos(){const{name:t,unit:r,category:i,sku:l,price_sale:u,image:V,status:Y}=this.product;return!!(t&&r&&i&&l&&u&&V&&Y)}updateCataloPage(){this.productService.updateCatalogoPage().subscribe(t=>{})}sortBy(t){this.sortColumn===t?this.sortDirection=-this.sortDirection:(this.sortColumn=t,this.sortDirection=1),this.filteredProducts.sort((r,i)=>r[t]<i[t]?-1*this.sortDirection:r[t]>i[t]?1*this.sortDirection:0)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(v4),ut(ws),ut(x4))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-products"]],decls:218,vars:31,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],[1,"col-6"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","keyup","ngModel"],["type","button","data-bs-toggle","modal","data-bs-target","#editProductModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-success",3,"click"],[4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"table"],[3,"click"],[4,"ngFor","ngForOf"],["id","editProductModal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","editProductModalLabel",1,"modal-title"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-10"],[1,"form-group"],["for","name"],["type","text","id","name","name","name",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-2"],["for","unit"],["id","unit","name","unit",1,"form-control",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],["value","KG"],["value","UNIDAD"],["value","CANASTILLA"],["value","BULTO"],[1,"col-4"],["for","category"],["id","category","name","category",1,"form-control",3,"ngModelChange","ngModel"],["value","Abarrotes"],["value","Frutas"],["value","Hortalizas"],["value","Tub\xe9rculos"],["value","Verduras"],[1,"col-8"],["for","sku"],["type","text","id","sku","name","sku",1,"form-control",3,"ngModelChange","ngModel"],["for","price_sale"],["type","number","id","price_sale","name","price_sale",1,"form-control",3,"ngModelChange","ngModel"],["for","price_purchase"],["type","number","id","price_purchase","name","price_purchase",1,"form-control",3,"ngModelChange","ngModel"],["for","discount"],["type","number","id","discount","name","discount",1,"form-control",3,"ngModelChange","ngModel"],["for","margen"],["type","number","id","margen","name","margen",1,"form-control",3,"ngModelChange","ngModel"],["for","iva"],["id","iva","name","iva",1,"form-control",3,"ngModelChange","ngModel"],["value","true"],["value","false"],["for","iva_value"],["type","number","id","iva_value","name","iva_value",1,"form-control",3,"ngModelChange","ngModel"],["id","root","name","root",1,"form-control",3,"ngModelChange","ngModel"],["value","1"],["value","0"],["type","text","id","child","name","child",1,"form-control",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description",1,"form-control",3,"ngModelChange","ngModel"],["for","image"],["type","text","id","image","name","image",1,"form-control",3,"ngModelChange","ngModel"],["for","status"],["id","status","name","status",1,"form-control",3,"ngModelChange","ngModel"],["value","active"],["value","inactive"],["for","is_visible"],["id","is_visible","name","is_visible",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","margen","name","margen",1,"form-control",3,"ngModelChange","ngModel"],["id","tipo_pricing","name","tipo_pricing",1,"form-control",3,"ngModelChange","ngModel"],["value","Manual"],["value","Auto"],[1,"form-control",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["alt","Imagen del producto",1,"img-fluid",3,"src"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","class","btn btn-primary","data-bs-dismiss","modal",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-primary","data-bs-dismiss","modal",3,"click",4,"ngIf"],["role","alert",1,"alert","alert-success"],["role","alert",1,"alert","alert-danger"],["data-bs-toggle","modal","data-bs-target","#editProductModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-pencil-alt","fa-lg"],[3,"ngValue"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click","disabled"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),ct("click",function(){return i.updateCataloPage()}),U(4,"Actualizar cat\xe1logo P\xe1gina"),O()(),P(5,"div",4)(6,"input",5),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterProducts()}),O()(),P(7,"div",2)(8,"button",6),ct("click",function(){return i.openEditModal({},"new")}),U(9,"Nuevo Producto"),O()(),P(10,"div",2)(11,"button",7),ct("click",function(){return i.exportToExcel(.93)}),U(12,"Descargar Excel para Instituciones (7% menos de margen)"),O()(),P(13,"div",2)(14,"button",7),ct("click",function(){return i.exportToExcel(1)}),U(15,"Descargar Excel"),O()()(),gt(16,l0e,1,0,"br",8)(17,c0e,2,1,"div",9)(18,u0e,2,1,"div",10),Rt(19,"br"),P(20,"table",11)(21,"thead")(22,"tr")(23,"th",12),ct("click",function(){return i.sortBy("sku")}),U(24,"sku"),O(),P(25,"th",12),ct("click",function(){return i.sortBy("name")}),U(26,"Nombre"),O(),P(27,"th",12),ct("click",function(){return i.sortBy("unit")}),U(28,"Unidad"),O(),P(29,"th",12),ct("click",function(){return i.sortBy("child")}),U(30,"Padre"),O(),P(31,"th",12),ct("click",function(){return i.sortBy("category")}),U(32,"Categoria"),O(),P(33,"th",12),ct("click",function(){return i.sortBy("price_purchase")}),U(34,"Precio Compra"),O(),P(35,"th",12),ct("click",function(){return i.sortBy("price_sale")}),U(36,"Precio Venta"),O(),P(37,"th",12),ct("click",function(){return i.sortBy("margen")}),U(38,"Margen"),O(),P(39,"th",12),ct("click",function(){return i.sortBy("step_unit")}),U(40,"Step Unit"),O(),P(41,"th",12),ct("click",function(){return i.sortBy("factor_volumen")}),U(42,"Factor de Volumen"),O(),P(43,"th"),U(44,"Acciones"),O()()(),P(45,"tbody"),gt(46,d0e,26,20,"tr",13),O()()(),P(47,"div",14)(48,"div",15)(49,"div",16)(50,"div",17)(51,"h5",18),U(52,"Editar Producto"),O()(),P(53,"div",19)(54,"div",20)(55,"div",21)(56,"div",22)(57,"div",23)(58,"label",24),U(59,"Nombre:"),O(),P(60,"input",25),St("ngModelChange",function(u){return Dt(i.product.name,u)||(i.product.name=u),u}),O()()(),P(61,"div",26)(62,"div",23)(63,"label",27),U(64,"Unidad:"),O(),P(65,"select",28),St("ngModelChange",function(u){return Dt(i.product.unit,u)||(i.product.unit=u),u}),P(66,"option",29),U(67,"Selecciona una unidad"),O(),P(68,"option",30),U(69,"Kg"),O(),P(70,"option",31),U(71,"Unidad"),O(),P(72,"option",32),U(73,"Canastilla"),O(),P(74,"option",33),U(75,"Bulto"),O()()()()(),P(76,"div",21)(77,"div",34)(78,"div",23)(79,"label",35),U(80,"Categor\xeda:"),O(),P(81,"select",36),St("ngModelChange",function(u){return Dt(i.product.category,u)||(i.product.category=u),u}),P(82,"option",29),U(83,"Selecciona una Categor\xeda"),O(),P(84,"option",37),U(85,"Abarrotes"),O(),P(86,"option",38),U(87,"Frutas"),O(),P(88,"option",39),U(89,"Hortalizas"),O(),P(90,"option",40),U(91,"Tub\xe9rculos"),O(),P(92,"option",41),U(93,"Verduras"),O()()()(),P(94,"div",42)(95,"div",23)(96,"label",43),U(97,"SKU:"),O(),P(98,"input",44),St("ngModelChange",function(u){return Dt(i.product.sku,u)||(i.product.sku=u),u}),O()()()(),P(99,"div",21)(100,"div",4)(101,"div",23)(102,"label",45),U(103,"Precio de Venta:"),O(),P(104,"input",46),St("ngModelChange",function(u){return Dt(i.product.price_sale,u)||(i.product.price_sale=u),u}),O()()(),P(105,"div",4)(106,"div",23)(107,"label",47),U(108,"Precio de Compra:"),O(),P(109,"input",48),St("ngModelChange",function(u){return Dt(i.product.price_purchase,u)||(i.product.price_purchase=u),u}),O()()()(),P(110,"div",21)(111,"div",4)(112,"div",23)(113,"label",49),U(114,"Descuento:"),O(),P(115,"input",50),St("ngModelChange",function(u){return Dt(i.product.discount,u)||(i.product.discount=u),u}),O()()(),P(116,"div",4)(117,"div",23)(118,"label",51),U(119,"Margen:"),O(),P(120,"input",52),St("ngModelChange",function(u){return Dt(i.product.margen,u)||(i.product.margen=u),u}),O()()()(),P(121,"div",21)(122,"div",4)(123,"div",23)(124,"label",53),U(125,"IVA:"),O(),P(126,"select",54),St("ngModelChange",function(u){return Dt(i.product.iva,u)||(i.product.iva=u),u}),P(127,"option",29),U(128,"Selecciona una unidad"),O(),P(129,"option",55),U(130,"Si"),O(),P(131,"option",56),U(132,"No"),O()()()(),P(133,"div",4)(134,"div",23)(135,"label",57),U(136,"Valor IVA:"),O(),P(137,"input",58),St("ngModelChange",function(u){return Dt(i.product.iva_value,u)||(i.product.iva_value=u),u}),O()()()(),P(138,"div",21)(139,"div",4)(140,"div",23)(141,"label",53),U(142,"Padre:"),O(),P(143,"select",59),St("ngModelChange",function(u){return Dt(i.product.root,u)||(i.product.root=u),u}),P(144,"option",29),U(145,"Selecciona una opci\xf3n"),O(),P(146,"option",60),U(147,"Si"),O(),P(148,"option",61),U(149,"No"),O()()()(),P(150,"div",4)(151,"div",23)(152,"label",57),U(153,"SKU Padre:"),O(),P(154,"input",62),St("ngModelChange",function(u){return Dt(i.product.child,u)||(i.product.child=u),u}),O()()()(),P(155,"div",23)(156,"label",63),U(157,"Descripci\xf3n:"),O(),P(158,"textarea",64),St("ngModelChange",function(u){return Dt(i.product.description,u)||(i.product.description=u),u}),O()(),P(159,"div",21)(160,"div",4)(161,"div",23)(162,"label",65),U(163,"Imagen:"),O(),P(164,"input",66),St("ngModelChange",function(u){return Dt(i.product.image,u)||(i.product.image=u),u}),O()(),P(165,"div",23)(166,"label",67),U(167,"Estado:"),O(),P(168,"select",68),St("ngModelChange",function(u){return Dt(i.product.status,u)||(i.product.status=u),u}),P(169,"option",69),U(170,"Activo"),O(),P(171,"option",70),U(172,"Inactivo"),O()()(),P(173,"div",23)(174,"label",71),U(175,"Visible:"),O(),P(176,"select",72),St("ngModelChange",function(u){return Dt(i.product.is_visible,u)||(i.product.is_visible=u),u}),P(177,"option",55),U(178,"Si"),O(),P(179,"option",56),U(180,"No"),O()()(),P(181,"div",23)(182,"label",67),U(183,"step unit:"),O(),P(184,"input",52),St("ngModelChange",function(u){return Dt(i.product.step_unit,u)||(i.product.step_unit=u),u}),O()(),P(185,"div",23)(186,"label",67),U(187,"step unit Sipsa:"),O(),P(188,"input",52),St("ngModelChange",function(u){return Dt(i.product.step_unit_sipsa,u)||(i.product.step_unit_sipsa=u),u}),O()(),P(189,"div",23)(190,"label",67),U(191,"Factor de Vol\xfamen:"),O(),P(192,"input",52),St("ngModelChange",function(u){return Dt(i.product.factor_volumen,u)||(i.product.factor_volumen=u),u}),O()(),P(193,"div",23)(194,"label",67),U(195,"Sipsa ID:"),O(),P(196,"input",73),St("ngModelChange",function(u){return Dt(i.product.sipsa_id,u)||(i.product.sipsa_id=u),u}),O()(),P(197,"div",23)(198,"label",71),U(199,"Tipo Pricing:"),O(),P(200,"select",74),St("ngModelChange",function(u){return Dt(i.product.tipo_pricing,u)||(i.product.tipo_pricing=u),u}),P(201,"option",75),U(202,"Manual"),O(),P(203,"option",76),U(204,"Auto"),O()()(),P(205,"div",23)(206,"label"),U(207,"Proveedor:"),O(),P(208,"select",77),St("ngModelChange",function(u){return Dt(i.product.proveedor,u)||(i.product.proveedor=u),u}),gt(209,h0e,2,2,"option",78),O()()(),P(210,"div",4)(211,"div",42),Rt(212,"img",79),O()()()()(),P(213,"div",80)(214,"button",81),U(215,"Cerrar"),O(),gt(216,f0e,2,1,"button",82)(217,p0e,2,0,"button",83),O()()()()),2&r&&(W(6),Ct("ngModel",i.searchText),W(10),Oe("ngIf",i.successMessage),W(),Oe("ngIf",i.successMessage),W(),Oe("ngIf",i.errorMessage),W(28),Oe("ngForOf",i.filteredProducts),W(14),Ct("ngModel",i.product.name),W(5),Ct("ngModel",i.product.unit),W(16),Ct("ngModel",i.product.category),W(17),Ct("ngModel",i.product.sku),W(6),Ct("ngModel",i.product.price_sale),W(5),Ct("ngModel",i.product.price_purchase),W(6),Ct("ngModel",i.product.discount),W(5),Ct("ngModel",i.product.margen),W(6),Ct("ngModel",i.product.iva),W(11),Ct("ngModel",i.product.iva_value),W(6),Ct("ngModel",i.product.root),W(11),Ct("ngModel",i.product.child),W(4),Ct("ngModel",i.product.description),W(6),Ct("ngModel",i.product.image),W(4),Ct("ngModel",i.product.status),W(8),Ct("ngModel",i.product.is_visible),W(8),Ct("ngModel",i.product.step_unit),W(4),Ct("ngModel",i.product.step_unit_sipsa),W(4),Ct("ngModel",i.product.factor_volumen),W(4),Ct("ngModel",i.product.sipsa_id),W(4),Ct("ngModel",i.product.tipo_pricing),W(8),Ct("ngModel",i.product.proveedor),W(),Oe("ngForOf",i.suppliers),W(3),Oe("src",i.product.image,_g),W(4),Oe("ngIf","update"===i.actionTipo),W(),Oe("ngIf","new"===i.actionTipo))},dependencies:[No,So,yd,vd,Hs,Nh,eu,so,oo,ld]})}return e})(),U4=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getClientes(){return this.http.get(this.baseUrl+"api/customer/customers")}createCliente(t){return this.http.post(`${this.baseUrl}api/customer/customer`,t)}updateCliente(t){return this.http.put(`${this.baseUrl}api/customer/customers/${t.id}`,t)}deleteCliente(t){return this.http.delete(`${this.baseUrl}/${t}`)}changePassword(t,r){return this.http.post(this.baseUrl+"api/user/change_password_admin",{user_id:t,password:r})}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),N2=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getOrders(t,r){return this.http.get(this.baseUrl+"api/order/orders/"+t+"/"+r)}getOrdersByStatus(t){return this.http.get(this.baseUrl+"api/order/orders/status/"+t)}updateOrder(t,r){return this.http.post(this.baseUrl+"api/order/order/"+t,r)}createOrder(t){return this.http.post(this.baseUrl+"api/order/order",t)}getConfig(){return this.http.get(this.baseUrl+"api/config/configOrder")}deleteOrder(t){return this.http.delete(this.baseUrl+"api/order/order/"+t)}getLastOrdersByCustomerId(t){return this.http.get(this.baseUrl+"api/order/orders_latest_customer/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function g0e(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td"),U(8),O(),P(9,"td"),U(10),O(),P(11,"td"),U(12),O(),P(13,"td"),U(14),O(),P(15,"td"),U(16),O(),P(17,"td")(18,"div",57)(19,"div",4)(20,"button",58),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().openEditModal(i,"edit"))}),Rt(21,"i",59),O()(),P(22,"div",4)(23,"button",60),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().openEditModal(i,"edit"))}),Rt(24,"i",61),O()()()()()}if(2&e){const t=n.$implicit;W(2),tt(t.name),W(2),tt(t.phone),W(2),tt(t.document),W(2),tt(t.document_type),W(2),tt(t.address),W(2),tt(t.restaurant_name),W(2),tt(t.email),W(2),tt(t.category)}}function _0e(e,n){if(1&e&&(P(0,"option",62),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function y0e(e,n){if(1&e&&(P(0,"option",62),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function v0e(e,n){if(1&e&&(P(0,"option",62),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function x0e(e,n){if(1&e&&(P(0,"option",62),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function b0e(e,n){if(1&e){const t=lr();P(0,"div",63)(1,"input",64),St("ngModelChange",function(i){const l=Bt(t).index,u=Ge();return Dt(u.selectedCustomer.list_products[l],i)||(u.selectedCustomer.list_products[l]=i),zt(i)}),O(),P(2,"button",65),ct("click",function(){const i=Bt(t).index;return zt(Ge().removeProduct(i))}),U(3,"Eliminar"),O()()}if(2&e){const t=n.index,r=Ge();W(),_v("name","product-",t,""),Ct("ngModel",r.selectedCustomer.list_products[t])}}function w0e(e,n){if(1&e){const t=lr();P(0,"div",20)(1,"label",51),U(2,"Contrase\xf1a"),O(),P(3,"input",66),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.selectedCustomer.password,i)||(l.selectedCustomer.password=i),zt(i)}),O()()}if(2&e){const t=Ge();W(3),Ct("ngModel",t.selectedCustomer.password)}}function T0e(e,n){if(1&e){const t=lr();P(0,"button",67),ct("click",function(){return Bt(t),zt(Ge().saveCustomer())}),U(1,"Guardar"),O()}}function E0e(e,n){if(1&e){const t=lr();P(0,"button",67),ct("click",function(){return Bt(t),zt(Ge().createCustomer())}),U(1,"Crear"),O()}}function C0e(e,n){1&e&&(P(0,"div",68),U(1," Las contrase\xf1as no coinciden. "),O())}let S0e=(()=>{class e{constructor(t,r){this.clientesService=t,this.orderService=r,this.customers=[],this.filteredCustomers=[],this.searchText="",this.selectedCustomer={},this.isNewCustomer=!0,this.documentTypes=[],this.cateroryTypes=[],this.statusTypes=[],this.roles=["Administrador","Comercial","Comprador","Cliente"],this.userPassword={newPassword:"",confirmPassword:""},this.passwordMismatch=!1}ngOnInit(){this.getClientes(),this.orderService.getConfig().subscribe(t=>{this.documentTypes=t.document_type,this.cateroryTypes=t.category,this.statusTypes=["active","inactive"]})}getClientes(){this.clientesService.getClientes().subscribe(t=>{this.customers=t,this.filteredCustomers=this.customers},t=>{console.error("Error al obtener clientes:",t)})}filterCustomers(){this.filteredCustomers=this.customers.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())||t.phone.toLowerCase().includes(this.searchText.toLowerCase())||t.document.toLowerCase().includes(this.searchText.toLowerCase())||t.email.toLowerCase().includes(this.searchText.toLowerCase())||t.restaurant_name.toLowerCase().includes(this.searchText.toLowerCase())||t.status.toLowerCase().includes(this.searchText.toLowerCase()))}openEditModal(t,r){this.selectedCustomer="new"===r?{}:{...t},this.isNewCustomer="edit"!=r}edit_customer(t){this.openEditModal(t,"edit")}saveCustomer(){this.clientesService.updateCliente(this.selectedCustomer).subscribe(t=>{this.getClientes()},t=>{console.error("Error al actualizar cliente:",t)})}createCustomer(){this.clientesService.createCliente(this.selectedCustomer).subscribe(t=>{this.getClientes()},t=>{console.error("Error al actualizar cliente:",t)})}addProduct(){this.selectedCustomer.list_products.push("")}removeProduct(t){this.selectedCustomer.list_products.splice(t,1)}trackByIndex(t,r){return t}delete_customer(t){confirm("\xbfEst\xe1 seguro de que desea eliminar este cliente?")&&this.clientesService.deleteCliente(t._id).subscribe(()=>{this.customers=this.customers.filter(r=>r._id!==t._id),this.filterCustomers()},r=>{console.error("Error al eliminar cliente:",r)})}checkPasswordMismatch(){this.passwordMismatch=this.userPassword.newPassword!==this.userPassword.confirmPassword}changePassword(){this.checkPasswordMismatch(),this.passwordMismatch||this.clientesService.changePassword(this.selectedCustomer.id,this.userPassword.newPassword).subscribe(()=>{},t=>{console.error("Error al cambiar la contrase\xf1a:",t)})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(U4),ut(N2))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-clientes"]],decls:124,vars:26,consts:[["customerForm","ngForm"],["passwordForm","ngForm"],[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#customerModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus-circle","fa-lg"],[1,"col-10"],["type","text","placeholder","Buscar cliente...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"row"],[1,"container-fluid"],[1,"table"],[4,"ngFor","ngForOf"],["id","customerModal","tabindex","-1","aria-labelledby","customerModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","customerModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","phone",1,"form-label"],["type","text","id","phone","name","phone","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","document",1,"form-label"],["type","text","id","document","name","document","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","documentType",1,"form-label"],["id","documentType","name","documentType",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","address",1,"form-label"],["type","text","id","address","name","address",1,"form-control",3,"ngModelChange","ngModel"],["for","restaurantName",1,"form-label"],["type","text","id","restaurantName","name","restaurantName",1,"form-control",3,"ngModelChange","ngModel"],["for","email",1,"form-label"],["type","email","id","email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","status",1,"form-label"],["id","status","name","status",1,"form-control",3,"ngModelChange","ngModel"],["for","category",1,"form-label"],["id","category","name","category",1,"form-control",3,"ngModelChange","ngModel"],["for","role",1,"form-label"],["id","role","name","role",1,"form-control",3,"ngModelChange","ngModel"],["for","list_products",1,"form-label"],["class","input-group mb-2",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"btn","btn-success",3,"click"],["class","mb-3",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","class","btn btn-primary","data-bs-dismiss","modal",3,"click",4,"ngIf"],["id","passwordModal","tabindex","-1","aria-labelledby","passwordModalLabel","aria-hidden","true",1,"modal","fade"],["id","passwordModalLabel",1,"modal-title"],["for","password",1,"form-label"],["type","password","id","password","name","newPassword","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","name","confirmPassword","required","",1,"form-control",3,"ngModelChange","ngModel"],["class","text-danger",4,"ngIf"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click","disabled"],[1,"row","justify-content-center"],["title","Edit","data-bs-toggle","modal","data-bs-target","#customerModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"fa","fa-pencil"],["title","changePassword","data-bs-toggle","modal","data-bs-target","#passwordModal","data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],[1,"fa","fa-lock"],[3,"value"],[1,"input-group","mb-2"],["type","text",1,"form-control",3,"ngModelChange","ngModel","name"],["type","button",1,"btn","btn-danger",3,"click"],["type","password","id","password","name","password","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"text-danger"]],template:function(r,i){if(1&r){const l=lr();P(0,"div",2)(1,"div",3)(2,"div",4)(3,"button",5),ct("click",function(){return Bt(l),zt(i.openEditModal({},"new"))}),Rt(4,"i",6),U(5," Nuevo Cliente"),O()(),P(6,"div",7)(7,"input",8),St("ngModelChange",function(g){return Bt(l),Dt(i.searchText,g)||(i.searchText=g),zt(g)}),ct("keyup",function(){return Bt(l),zt(i.filterCustomers())}),O()(),Rt(8,"br"),P(9,"div",9)(10,"div",10)(11,"table",11)(12,"thead")(13,"tr")(14,"th"),U(15,"Nombre"),O(),P(16,"th"),U(17,"Tel\xe9fono"),O(),P(18,"th"),U(19,"Documento"),O(),P(20,"th"),U(21,"Tipo de Documento"),O(),P(22,"th"),U(23,"Direcci\xf3n"),O(),P(24,"th"),U(25,"Nombre del Restaurante"),O(),P(26,"th"),U(27,"Email"),O(),P(28,"th"),U(29,"Categor\xeda"),O(),P(30,"th"),U(31,"Acciones"),O()()(),P(32,"tbody"),gt(33,g0e,25,8,"tr",12),O()()()()()(),P(34,"div",13)(35,"div",14)(36,"div",15)(37,"div",16)(38,"h5",17),U(39),O(),Rt(40,"button",18),O(),P(41,"div",19)(42,"form",null,0)(44,"div",20)(45,"label",21),U(46,"Nombre"),O(),P(47,"input",22),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.name,g)||(i.selectedCustomer.name=g),zt(g)}),O()(),P(48,"div",20)(49,"label",23),U(50,"Tel\xe9fono"),O(),P(51,"input",24),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.phone,g)||(i.selectedCustomer.phone=g),zt(g)}),O()(),P(52,"div",20)(53,"label",25),U(54,"Documento"),O(),P(55,"input",26),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.document,g)||(i.selectedCustomer.document=g),zt(g)}),O()(),P(56,"div",20)(57,"label",27),U(58,"Tipo de Documento"),O(),P(59,"select",28),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.document_type,g)||(i.selectedCustomer.document_type=g),zt(g)}),gt(60,_0e,2,2,"option",29),O()(),P(61,"div",20)(62,"label",30),U(63,"Direcci\xf3n"),O(),P(64,"input",31),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.address,g)||(i.selectedCustomer.address=g),zt(g)}),O()(),P(65,"div",20)(66,"label",32),U(67,"Nombre del Restaurante"),O(),P(68,"input",33),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.restaurant_name,g)||(i.selectedCustomer.restaurant_name=g),zt(g)}),O()(),P(69,"div",20)(70,"label",34),U(71,"Email"),O(),P(72,"input",35),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.email,g)||(i.selectedCustomer.email=g),zt(g)}),O()(),P(73,"div",20)(74,"label",36),U(75,"Estado"),O(),P(76,"select",37),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.status,g)||(i.selectedCustomer.status=g),zt(g)}),gt(77,y0e,2,2,"option",29),O()(),P(78,"div",20)(79,"label",38),U(80,"Categor\xeda"),O(),P(81,"select",39),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.category,g)||(i.selectedCustomer.category=g),zt(g)}),gt(82,v0e,2,2,"option",29),O()(),P(83,"div",20)(84,"label",40),U(85,"Rol"),O(),P(86,"select",41),St("ngModelChange",function(g){return Bt(l),Dt(i.selectedCustomer.role,g)||(i.selectedCustomer.role=g),zt(g)}),gt(87,x0e,2,2,"option",29),O()(),P(88,"div",20)(89,"label",42),U(90,"Productos"),O(),gt(91,b0e,4,3,"div",43),P(92,"button",44),ct("click",function(){return Bt(l),zt(i.addProduct())}),U(93,"A\xf1adir Producto"),O()(),gt(94,w0e,4,1,"div",45),O()(),P(95,"div",46)(96,"button",47),U(97,"Cancelar"),O(),gt(98,T0e,2,0,"button",48)(99,E0e,2,0,"button",48),O()()()(),P(100,"div",49)(101,"div",14)(102,"div",15)(103,"div",16)(104,"h5",50),U(105,"Actualizar Contrase\xf1a"),O(),Rt(106,"button",18),O(),P(107,"div",19)(108,"form",null,1)(110,"div",20)(111,"label",51),U(112,"Nueva Contrase\xf1a"),O(),P(113,"input",52),St("ngModelChange",function(g){return Bt(l),Dt(i.userPassword.newPassword,g)||(i.userPassword.newPassword=g),zt(g)}),O()(),P(114,"div",20)(115,"label",53),U(116,"Confirmar Contrase\xf1a"),O(),P(117,"input",54),St("ngModelChange",function(g){return Bt(l),Dt(i.userPassword.confirmPassword,g)||(i.userPassword.confirmPassword=g),zt(g)}),O()(),gt(118,C0e,2,0,"div",55),O()(),P(119,"div",46)(120,"button",47),U(121,"Cancelar"),O(),P(122,"button",56),ct("click",function(){return Bt(l),zt(i.changePassword())}),U(123,"Actualizar Contrase\xf1a"),O()()()()()}if(2&r){const l=xa(109);W(7),Ct("ngModel",i.searchText),W(26),Oe("ngForOf",i.filteredCustomers),W(6),tt(i.isNewCustomer?"Nuevo Cliente":"Editar Cliente"),W(8),Ct("ngModel",i.selectedCustomer.name),W(4),Ct("ngModel",i.selectedCustomer.phone),W(4),Ct("ngModel",i.selectedCustomer.document),W(4),Ct("ngModel",i.selectedCustomer.document_type),W(),Oe("ngForOf",i.documentTypes),W(4),Ct("ngModel",i.selectedCustomer.address),W(4),Ct("ngModel",i.selectedCustomer.restaurant_name),W(4),Ct("ngModel",i.selectedCustomer.email),W(4),Ct("ngModel",i.selectedCustomer.status),W(),Oe("ngForOf",i.statusTypes),W(4),Ct("ngModel",i.selectedCustomer.category),W(),Oe("ngForOf",i.cateroryTypes),W(4),Ct("ngModel",i.selectedCustomer.role),W(),Oe("ngForOf",i.roles),W(4),Oe("ngForOf",i.selectedCustomer.list_products)("ngForTrackBy",i.trackByIndex),W(3),Oe("ngIf",i.isNewCustomer),W(4),Oe("ngIf",!i.isNewCustomer),W(),Oe("ngIf",i.isNewCustomer),W(14),Ct("ngModel",i.userPassword.newPassword),W(4),Ct("ngModel",i.userPassword.confirmPassword),W(),Oe("ngIf",i.passwordMismatch),W(4),Oe("disabled",l.invalid||i.passwordMismatch)}},dependencies:[No,So,R2,yd,vd,Hs,eu,so,k2,a1,oo,Xv]})}return e})(),V4=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}send_invoice(t){return this.http.get(this.baseUrl+"api/alegra/send_invoice/"+t)}get_invoice(t){return this.http.get(this.baseUrl+"api/alegra/get_invoice/"+t)}send_purchase(t){return this.http.get(this.baseUrl+"api/alegra/send_purchase/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),D0e=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}get_order(t){return this.http.get(this.baseUrl+"api/woo/get_order/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),SO=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getRoutes(){return this.http.get(this.baseUrl+"api/route/routes")}getRoute(t){return this.http.get(this.baseUrl+"api/route/route/"+t)}getRouteByDate(t){return this.http.get(this.baseUrl+"api/route/route/fecha/"+t)}updateRoute(t){const r=new FormData;return r.append("route",JSON.stringify(t)),this.http.put(this.baseUrl+"api/route/route",r)}updateStop(t,r){const i=new FormData;return i.append("route",JSON.stringify(t)),r&&i.append("evidence",r,r.name),this.http.put(`${this.baseUrl}api/route/route`,i)}delteRoute(t){return this.http.delete(this.baseUrl+"api/route/route/"+t)}createRoute(t,r,i){return this.http.post(this.baseUrl+"api/route/route",{close_date:t,driver:r,cost:i})}getStopNumber(t){return this.http.get(this.baseUrl+"api/route/stop_order_number/"+t)}getRouteConsolidated(t){return this.http.get(this.baseUrl+"api/route/consolidated/"+t+"/")}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class M0e extends os{constructor(n,t){super()}schedule(n,t=0){return this}}const DO={setInterval(e,n,...t){const{delegate:r}=DO;return r?.setInterval?r.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=DO;return(n?.clearInterval||clearInterval)(e)},delegate:void 0};class j4 extends M0e{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var r;if(this.closed)return this;this.state=n;const i=this.id,l=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(l,i,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(l,this.id,t),this}requestAsyncId(n,t,r=0){return DO.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&DO.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(n,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let i,r=!1;try{this.work(n)}catch(l){r=!0,i=l||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Ln(r,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}const pH={now:()=>(pH.delegate||Date).now(),delegate:void 0};class hD{constructor(n,t=hD.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,r){return new this.schedulerActionCtor(this,n).schedule(r,t)}}hD.now=pH.now;class $4 extends hD{constructor(n,t=hD.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let r;this._active=!0;do{if(r=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,r){for(;n=t.shift();)n.unsubscribe();throw r}}}const MO=new $4(j4),A0e=MO;function H4(e=0,n,t=A0e){let r=-1;return null!=n&&(Jz(n)?t=n:r=n),new Di(i=>{let l=function k0e(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;l<0&&(l=0);let u=0;return t.schedule(function(){i.closed||(i.next(u++),0<=r?this.schedule(void 0,r):i.complete())},l)})}const fD={schedule(e){let n=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:r}=fD;r&&(n=r.requestAnimationFrame,t=r.cancelAnimationFrame);const i=n(l=>{t=void 0,e(l)});return new os(()=>t?.(i))},requestAnimationFrame(...e){const{delegate:n}=fD;return(n?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:n}=fD;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0},F0e=new class N0e extends $4{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:r}=this;let i;n=n||r.shift();do{if(i=n.execute(n.state,n.delay))break}while((n=r[0])&&n.id===t&&r.shift());if(this._active=!1,i){for(;(n=r[0])&&n.id===t&&r.shift();)n.unsubscribe();throw i}}}(class R0e extends j4{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,r=0){return null!==r&&r>0?super.requestAsyncId(n,t,r):(n.actions.push(this),n._scheduled||(n._scheduled=fD.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,t,r=0){var i;if(null!=r?r>0:this.delay>0)return super.recycleAsyncId(n,t,r);const{actions:l}=n;null!=t&&(null===(i=l[l.length-1])||void 0===i?void 0:i.id)!==t&&(fD.cancelAnimationFrame(t),n._scheduled=void 0)}});let G4,L0e=1;const AO={};function mH(e){return e in AO&&(delete AO[e],!0)}const B0e={setImmediate(e){const n=L0e++;return AO[n]=!0,G4||(G4=Promise.resolve()),G4.then(()=>mH(n)&&e()),n},clearImmediate(e){mH(e)}},{setImmediate:z0e,clearImmediate:U0e}=B0e,IO={setImmediate(...e){const{delegate:n}=IO;return(n?.setImmediate||z0e)(...e)},clearImmediate(e){const{delegate:n}=IO;return(n?.clearImmediate||U0e)(e)},delegate:void 0},$0e=new class j0e extends $4{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:r}=this;let i;n=n||r.shift();do{if(i=n.execute(n.state,n.delay))break}while((n=r[0])&&n.id===t&&r.shift());if(this._active=!1,i){for(;(n=r[0])&&n.id===t&&r.shift();)n.unsubscribe();throw i}}}(class V0e extends j4{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,r=0){return null!==r&&r>0?super.requestAsyncId(n,t,r):(n.actions.push(this),n._scheduled||(n._scheduled=IO.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,t,r=0){var i;if(null!=r?r>0:this.delay>0)return super.recycleAsyncId(n,t,r);const{actions:l}=n;null!=t&&(null===(i=l[l.length-1])||void 0===i?void 0:i.id)!==t&&(IO.clearImmediate(t),n._scheduled===t&&(n._scheduled=void 0))}}),H0e=["addListener","removeListener"],G0e=["addEventListener","removeEventListener"],W0e=["on","off"];function Ea(e,n,t,r){if(xr(t)&&(r=t,t=void 0),r)return Ea(e,n,t).pipe(MN(r));const[i,l]=function X0e(e){return xr(e.addEventListener)&&xr(e.removeEventListener)}(e)?G0e.map(u=>g=>e[u](n,g,t)):function q0e(e){return xr(e.addListener)&&xr(e.removeListener)}(e)?H0e.map(gH(e,n)):function Z0e(e){return xr(e.on)&&xr(e.off)}(e)?W0e.map(gH(e,n)):[];if(!i&&wN(e))return Ml(u=>Ea(u,n,t))(Dl(e));if(!i)throw new TypeError("Invalid event target");return new Di(u=>{const g=(...x)=>u.next(1<x.length?x:x[0]);return i(g),()=>l(g)})}function gH(e,n){return t=>r=>e[t](n,r)}function kO(...e){const n=oS(e),t=function vte(e,n){return"number"==typeof _N(e)?e.pop():n}(e,1/0),r=e;return r.length?1===r.length?Dl(r[0]):n2(t)(Ha(r,n)):cd}const Y0e=["content"],K0e=["scroll"],J0e=["padding"],_H=["*"],pD=e=>({searchTerm:e});function Q0e(e,n){if(1&e&&(P(0,"div",3),pI(1,6),O()),2&e){const t=Ge();W(),Oe("ngTemplateOutlet",t.headerTemplate)("ngTemplateOutletContext",ba(2,pD,t.filterValue))}}function e1e(e,n){if(1&e&&(P(0,"div",5),pI(1,6),O()),2&e){const t=Ge();W(),Oe("ngTemplateOutlet",t.footerTemplate)("ngTemplateOutletContext",ba(2,pD,t.filterValue))}}const t1e=["searchInput"],n1e=["clearButton"],r1e=(e,n,t)=>({item:e,clear:n,label:t}),i1e=(e,n)=>({items:e,clear:n}),s1e=(e,n,t,r)=>({item:e,item$:n,index:t,searchTerm:r});function o1e(e,n){if(1&e){const t=lr();P(0,"span",21),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge(2).unselect(i))}),U(1,"\xd7"),O(),Rt(2,"span",22)}if(2&e){const t=Ge().$implicit,r=Ge(2);W(2),Oe("ngItemLabel",t.label)("escape",r.escapeHTML)}}function a1e(e,n){}function l1e(e,n){if(1&e&&(P(0,"div",20),gt(1,o1e,3,2,"ng-template",null,1,Sl)(3,a1e,0,0,"ng-template",12),O()),2&e){const t=n.$implicit,r=xa(2),i=Ge(2);Xi("ng-value-disabled",t.disabled),W(3),Oe("ngTemplateOutlet",i.labelTemplate||r)("ngTemplateOutletContext",vv(4,r1e,t.value,i.clearItem,t.label))}}function c1e(e,n){1&e&&vh(0,l1e,4,8,"div",19,s3().trackByOption,!0),2&e&&xh(Ge().selectedItems)}function u1e(e,n){}function d1e(e,n){if(1&e&&gt(0,u1e,0,0,"ng-template",12),2&e){const t=Ge();Oe("ngTemplateOutlet",t.multiLabelTemplate)("ngTemplateOutletContext",yv(2,i1e,t.selectedValues,t.clearItem))}}function h1e(e,n){1&e&&Rt(0,"div",24)}function f1e(e,n){}function p1e(e,n){if(1&e&&gt(0,h1e,1,0,"ng-template",null,2,Sl)(2,f1e,0,0,"ng-template",23),2&e){const t=xa(1),r=Ge();W(2),Oe("ngTemplateOutlet",r.loadingSpinnerTemplate||t)}}function m1e(e,n){1&e&&(P(0,"span",15,3)(2,"span",25),U(3,"\xd7"),O()()),2&e&&xI("title",Ge().clearAllText)}function g1e(e,n){if(1&e&&Rt(0,"span",30),2&e){const t=Ge().$implicit,r=Ge(2);Oe("ngItemLabel",t.label)("escape",r.escapeHTML)}}function _1e(e,n){}function y1e(e,n){if(1&e){const t=lr();P(0,"div",29),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge(2).toggleItem(i))})("mouseover",function(){const i=Bt(t).$implicit;return zt(Ge(2).onItemHover(i))}),gt(1,g1e,1,2,"ng-template",null,4,Sl)(3,_1e,0,0,"ng-template",12),O()}if(2&e){const t=n.$implicit,r=xa(2),i=Ge(2);Xi("ng-option-disabled",t.disabled)("ng-option-selected",t.selected)("ng-optgroup",t.children)("ng-option",!t.children)("ng-option-child",!!t.parent)("ng-option-marked",t===i.itemsList.markedItem),rs("role",t.children?"group":"option")("aria-selected",t.selected)("id",null==t?null:t.htmlId),W(3),Oe("ngTemplateOutlet",t.children?i.optgroupTemplate||r:i.optionTemplate||r)("ngTemplateOutletContext",x3(17,s1e,t.value,t,t.index,i.searchTerm))}}function v1e(e,n){if(1&e&&(P(0,"span")(1,"span",32),U(2),O(),U(3),O()),2&e){const t=Ge(3);W(2),tt(t.addTagText),W(),Zn('"',t.searchTerm,'"')}}function x1e(e,n){}function b1e(e,n){if(1&e){const t=lr();P(0,"div",31),ct("mouseover",function(){return Bt(t),zt(Ge(2).itemsList.unmarkItem())})("click",function(){return Bt(t),zt(Ge(2).selectTag())}),gt(1,v1e,4,2,"ng-template",null,5,Sl)(3,x1e,0,0,"ng-template",12),O()}if(2&e){const t=xa(2),r=Ge(2);Xi("ng-option-marked",!r.itemsList.markedItem),W(3),Oe("ngTemplateOutlet",r.tagTemplate||t)("ngTemplateOutletContext",ba(4,pD,r.searchTerm))}}function w1e(e,n){if(1&e&&(P(0,"div",33),U(1),O()),2&e){const t=Ge(3);W(),tt(t.notFoundText)}}function T1e(e,n){}function E1e(e,n){if(1&e&&gt(0,w1e,2,1,"ng-template",null,6,Sl)(2,T1e,0,0,"ng-template",12),2&e){const t=xa(1),r=Ge(2);W(2),Oe("ngTemplateOutlet",r.notFoundTemplate||t)("ngTemplateOutletContext",ba(2,pD,r.searchTerm))}}function C1e(e,n){if(1&e&&(P(0,"div",33),U(1),O()),2&e){const t=Ge(3);W(),tt(t.typeToSearchText)}}function S1e(e,n){}function D1e(e,n){if(1&e&&gt(0,C1e,2,1,"ng-template",null,7,Sl)(2,S1e,0,0,"ng-template",23),2&e){const t=xa(1),r=Ge(2);W(2),Oe("ngTemplateOutlet",r.typeToSearchTemplate||t)}}function M1e(e,n){if(1&e&&(P(0,"div",33),U(1),O()),2&e){const t=Ge(3);W(),tt(t.loadingText)}}function A1e(e,n){}function I1e(e,n){if(1&e&&gt(0,M1e,2,1,"ng-template",null,8,Sl)(2,A1e,0,0,"ng-template",12),2&e){const t=xa(1),r=Ge(2);W(2),Oe("ngTemplateOutlet",r.loadingTextTemplate||t)("ngTemplateOutletContext",ba(2,pD,r.searchTerm))}}function k1e(e,n){if(1&e){const t=lr();P(0,"ng-dropdown-panel",26),ct("update",function(i){return Bt(t),zt(Ge().viewPortItems=i)})("scroll",function(i){return Bt(t),zt(Ge().scroll.emit(i))})("scrollToEnd",function(i){return Bt(t),zt(Ge().scrollToEnd.emit(i))})("outsideClick",function(){return Bt(t),zt(Ge().close())}),FC(1),vh(2,y1e,4,22,"div",27,s3().trackByOption,!0),gt(4,b1e,4,6,"div",28),LC(),gt(5,E1e,3,4)(6,D1e,3,1)(7,I1e,3,4),O()}if(2&e){const t=Ge();Xi("ng-select-multiple",t.multiple),Oe("virtualScroll",t.virtualScroll)("bufferAmount",t.bufferAmount)("appendTo",t.appendTo)("position",t.dropdownPosition)("headerTemplate",t.headerTemplate)("footerTemplate",t.footerTemplate)("filterValue",t.searchTerm)("items",t.itemsList.filteredItems)("markedItem",t.itemsList.markedItem)("ngClass",t.appendTo?t.classes:null)("id",t.dropdownId),W(2),xh(t.viewPortItems),W(2),Os(t.showAddTag?4:-1),W(),Os(t.showNoItemsFound()?5:-1),W(),Os(t.showTypeToSearch()?6:-1),W(),Os(t.loading&&0===t.itemsList.filteredItems.length?7:-1)}}const yH=/[&<>"']/g,O1e=RegExp(yH.source),P1e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Bo(e){return null!=e}function mD(e){return"object"==typeof e&&Bo(e)}function OO(e){return e instanceof Function}let F1e=(()=>{class e{constructor(t){this.element=t,this.escape=!0}ngOnChanges(t){this.element.nativeElement.innerHTML=this.escape?function R1e(e){return e&&O1e.test(e)?e.replace(yH,n=>P1e[n]):e}(this.ngItemLabel):this.ngItemLabel}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Li))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ngItemLabel",""]],inputs:{ngItemLabel:"ngItemLabel",escape:"escape"},features:[Co]})}return e})(),L1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-option-tmp",""]]})}return e})(),B1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-optgroup-tmp",""]]})}return e})(),z1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-label-tmp",""]]})}return e})(),U1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-multi-label-tmp",""]]})}return e})(),V1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-header-tmp",""]]})}return e})(),j1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-footer-tmp",""]]})}return e})(),$1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-notfound-tmp",""]]})}return e})(),H1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-typetosearch-tmp",""]]})}return e})(),G1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-loadingtext-tmp",""]]})}return e})(),W1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-tag-tmp",""]]})}return e})(),q1e=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ui))};static#t=this.\u0275dir=Sn({type:e,selectors:[["","ng-loadingspinner-tmp",""]]})}return e})();function vH(){return"axxxxxxxxxxx".replace(/[x]/g,()=>(16*Math.random()|0).toString(16))}const Z1e={"\u24b6":"A",\uff21:"A",\u00c0:"A",\u00c1:"A",\u00c2:"A",\u1ea6:"A",\u1ea4:"A",\u1eaa:"A",\u1ea8:"A",\u00c3:"A",\u0100:"A",\u0102:"A",\u1eb0:"A",\u1eae:"A",\u1eb4:"A",\u1eb2:"A",\u0226:"A",\u01e0:"A",\u00c4:"A",\u01de:"A",\u1ea2:"A",\u00c5:"A",\u01fa:"A",\u01cd:"A",\u0200:"A",\u0202:"A",\u1ea0:"A",\u1eac:"A",\u1eb6:"A",\u1e00:"A",\u0104:"A",\u023a:"A",\u2c6f:"A",\ua732:"AA",\u00c6:"AE",\u01fc:"AE",\u01e2:"AE",\ua734:"AO",\ua736:"AU",\ua738:"AV",\ua73a:"AV",\ua73c:"AY","\u24b7":"B",\uff22:"B",\u1e02:"B",\u1e04:"B",\u1e06:"B",\u0243:"B",\u0182:"B",\u0181:"B","\u24b8":"C",\uff23:"C",\u0106:"C",\u0108:"C",\u010a:"C",\u010c:"C",\u00c7:"C",\u1e08:"C",\u0187:"C",\u023b:"C",\ua73e:"C","\u24b9":"D",\uff24:"D",\u1e0a:"D",\u010e:"D",\u1e0c:"D",\u1e10:"D",\u1e12:"D",\u1e0e:"D",\u0110:"D",\u018b:"D",\u018a:"D",\u0189:"D",\ua779:"D",\u01f1:"DZ",\u01c4:"DZ",\u01f2:"Dz",\u01c5:"Dz","\u24ba":"E",\uff25:"E",\u00c8:"E",\u00c9:"E",\u00ca:"E",\u1ec0:"E",\u1ebe:"E",\u1ec4:"E",\u1ec2:"E",\u1ebc:"E",\u0112:"E",\u1e14:"E",\u1e16:"E",\u0114:"E",\u0116:"E",\u00cb:"E",\u1eba:"E",\u011a:"E",\u0204:"E",\u0206:"E",\u1eb8:"E",\u1ec6:"E",\u0228:"E",\u1e1c:"E",\u0118:"E",\u1e18:"E",\u1e1a:"E",\u0190:"E",\u018e:"E","\u24bb":"F",\uff26:"F",\u1e1e:"F",\u0191:"F",\ua77b:"F","\u24bc":"G",\uff27:"G",\u01f4:"G",\u011c:"G",\u1e20:"G",\u011e:"G",\u0120:"G",\u01e6:"G",\u0122:"G",\u01e4:"G",\u0193:"G",\ua7a0:"G",\ua77d:"G",\ua77e:"G","\u24bd":"H",\uff28:"H",\u0124:"H",\u1e22:"H",\u1e26:"H",\u021e:"H",\u1e24:"H",\u1e28:"H",\u1e2a:"H",\u0126:"H",\u2c67:"H",\u2c75:"H",\ua78d:"H","\u24be":"I",\uff29:"I",\u00cc:"I",\u00cd:"I",\u00ce:"I",\u0128:"I",\u012a:"I",\u012c:"I",\u0130:"I",\u00cf:"I",\u1e2e:"I",\u1ec8:"I",\u01cf:"I",\u0208:"I",\u020a:"I",\u1eca:"I",\u012e:"I",\u1e2c:"I",\u0197:"I","\u24bf":"J",\uff2a:"J",\u0134:"J",\u0248:"J","\u24c0":"K",\uff2b:"K",\u1e30:"K",\u01e8:"K",\u1e32:"K",\u0136:"K",\u1e34:"K",\u0198:"K",\u2c69:"K",\ua740:"K",\ua742:"K",\ua744:"K",\ua7a2:"K","\u24c1":"L",\uff2c:"L",\u013f:"L",\u0139:"L",\u013d:"L",\u1e36:"L",\u1e38:"L",\u013b:"L",\u1e3c:"L",\u1e3a:"L",\u0141:"L",\u023d:"L",\u2c62:"L",\u2c60:"L",\ua748:"L",\ua746:"L",\ua780:"L",\u01c7:"LJ",\u01c8:"Lj","\u24c2":"M",\uff2d:"M",\u1e3e:"M",\u1e40:"M",\u1e42:"M",\u2c6e:"M",\u019c:"M","\u24c3":"N",\uff2e:"N",\u01f8:"N",\u0143:"N",\u00d1:"N",\u1e44:"N",\u0147:"N",\u1e46:"N",\u0145:"N",\u1e4a:"N",\u1e48:"N",\u0220:"N",\u019d:"N",\ua790:"N",\ua7a4:"N",\u01ca:"NJ",\u01cb:"Nj","\u24c4":"O",\uff2f:"O",\u00d2:"O",\u00d3:"O",\u00d4:"O",\u1ed2:"O",\u1ed0:"O",\u1ed6:"O",\u1ed4:"O",\u00d5:"O",\u1e4c:"O",\u022c:"O",\u1e4e:"O",\u014c:"O",\u1e50:"O",\u1e52:"O",\u014e:"O",\u022e:"O",\u0230:"O",\u00d6:"O",\u022a:"O",\u1ece:"O",\u0150:"O",\u01d1:"O",\u020c:"O",\u020e:"O",\u01a0:"O",\u1edc:"O",\u1eda:"O",\u1ee0:"O",\u1ede:"O",\u1ee2:"O",\u1ecc:"O",\u1ed8:"O",\u01ea:"O",\u01ec:"O",\u00d8:"O",\u01fe:"O",\u0186:"O",\u019f:"O",\ua74a:"O",\ua74c:"O",\u01a2:"OI",\ua74e:"OO",\u0222:"OU","\u24c5":"P",\uff30:"P",\u1e54:"P",\u1e56:"P",\u01a4:"P",\u2c63:"P",\ua750:"P",\ua752:"P",\ua754:"P","\u24c6":"Q",\uff31:"Q",\ua756:"Q",\ua758:"Q",\u024a:"Q","\u24c7":"R",\uff32:"R",\u0154:"R",\u1e58:"R",\u0158:"R",\u0210:"R",\u0212:"R",\u1e5a:"R",\u1e5c:"R",\u0156:"R",\u1e5e:"R",\u024c:"R",\u2c64:"R",\ua75a:"R",\ua7a6:"R",\ua782:"R","\u24c8":"S",\uff33:"S",\u1e9e:"S",\u015a:"S",\u1e64:"S",\u015c:"S",\u1e60:"S",\u0160:"S",\u1e66:"S",\u1e62:"S",\u1e68:"S",\u0218:"S",\u015e:"S",\u2c7e:"S",\ua7a8:"S",\ua784:"S","\u24c9":"T",\uff34:"T",\u1e6a:"T",\u0164:"T",\u1e6c:"T",\u021a:"T",\u0162:"T",\u1e70:"T",\u1e6e:"T",\u0166:"T",\u01ac:"T",\u01ae:"T",\u023e:"T",\ua786:"T",\ua728:"TZ","\u24ca":"U",\uff35:"U",\u00d9:"U",\u00da:"U",\u00db:"U",\u0168:"U",\u1e78:"U",\u016a:"U",\u1e7a:"U",\u016c:"U",\u00dc:"U",\u01db:"U",\u01d7:"U",\u01d5:"U",\u01d9:"U",\u1ee6:"U",\u016e:"U",\u0170:"U",\u01d3:"U",\u0214:"U",\u0216:"U",\u01af:"U",\u1eea:"U",\u1ee8:"U",\u1eee:"U",\u1eec:"U",\u1ef0:"U",\u1ee4:"U",\u1e72:"U",\u0172:"U",\u1e76:"U",\u1e74:"U",\u0244:"U","\u24cb":"V",\uff36:"V",\u1e7c:"V",\u1e7e:"V",\u01b2:"V",\ua75e:"V",\u0245:"V",\ua760:"VY","\u24cc":"W",\uff37:"W",\u1e80:"W",\u1e82:"W",\u0174:"W",\u1e86:"W",\u1e84:"W",\u1e88:"W",\u2c72:"W","\u24cd":"X",\uff38:"X",\u1e8a:"X",\u1e8c:"X","\u24ce":"Y",\uff39:"Y",\u1ef2:"Y",\u00dd:"Y",\u0176:"Y",\u1ef8:"Y",\u0232:"Y",\u1e8e:"Y",\u0178:"Y",\u1ef6:"Y",\u1ef4:"Y",\u01b3:"Y",\u024e:"Y",\u1efe:"Y","\u24cf":"Z",\uff3a:"Z",\u0179:"Z",\u1e90:"Z",\u017b:"Z",\u017d:"Z",\u1e92:"Z",\u1e94:"Z",\u01b5:"Z",\u0224:"Z",\u2c7f:"Z",\u2c6b:"Z",\ua762:"Z","\u24d0":"a",\uff41:"a",\u1e9a:"a",\u00e0:"a",\u00e1:"a",\u00e2:"a",\u1ea7:"a",\u1ea5:"a",\u1eab:"a",\u1ea9:"a",\u00e3:"a",\u0101:"a",\u0103:"a",\u1eb1:"a",\u1eaf:"a",\u1eb5:"a",\u1eb3:"a",\u0227:"a",\u01e1:"a",\u00e4:"a",\u01df:"a",\u1ea3:"a",\u00e5:"a",\u01fb:"a",\u01ce:"a",\u0201:"a",\u0203:"a",\u1ea1:"a",\u1ead:"a",\u1eb7:"a",\u1e01:"a",\u0105:"a",\u2c65:"a",\u0250:"a",\ua733:"aa",\u00e6:"ae",\u01fd:"ae",\u01e3:"ae",\ua735:"ao",\ua737:"au",\ua739:"av",\ua73b:"av",\ua73d:"ay","\u24d1":"b",\uff42:"b",\u1e03:"b",\u1e05:"b",\u1e07:"b",\u0180:"b",\u0183:"b",\u0253:"b","\u24d2":"c",\uff43:"c",\u0107:"c",\u0109:"c",\u010b:"c",\u010d:"c",\u00e7:"c",\u1e09:"c",\u0188:"c",\u023c:"c",\ua73f:"c",\u2184:"c","\u24d3":"d",\uff44:"d",\u1e0b:"d",\u010f:"d",\u1e0d:"d",\u1e11:"d",\u1e13:"d",\u1e0f:"d",\u0111:"d",\u018c:"d",\u0256:"d",\u0257:"d",\ua77a:"d",\u01f3:"dz",\u01c6:"dz","\u24d4":"e",\uff45:"e",\u00e8:"e",\u00e9:"e",\u00ea:"e",\u1ec1:"e",\u1ebf:"e",\u1ec5:"e",\u1ec3:"e",\u1ebd:"e",\u0113:"e",\u1e15:"e",\u1e17:"e",\u0115:"e",\u0117:"e",\u00eb:"e",\u1ebb:"e",\u011b:"e",\u0205:"e",\u0207:"e",\u1eb9:"e",\u1ec7:"e",\u0229:"e",\u1e1d:"e",\u0119:"e",\u1e19:"e",\u1e1b:"e",\u0247:"e",\u025b:"e",\u01dd:"e","\u24d5":"f",\uff46:"f",\u1e1f:"f",\u0192:"f",\ua77c:"f","\u24d6":"g",\uff47:"g",\u01f5:"g",\u011d:"g",\u1e21:"g",\u011f:"g",\u0121:"g",\u01e7:"g",\u0123:"g",\u01e5:"g",\u0260:"g",\ua7a1:"g",\u1d79:"g",\ua77f:"g","\u24d7":"h",\uff48:"h",\u0125:"h",\u1e23:"h",\u1e27:"h",\u021f:"h",\u1e25:"h",\u1e29:"h",\u1e2b:"h",\u1e96:"h",\u0127:"h",\u2c68:"h",\u2c76:"h",\u0265:"h",\u0195:"hv","\u24d8":"i",\uff49:"i",\u00ec:"i",\u00ed:"i",\u00ee:"i",\u0129:"i",\u012b:"i",\u012d:"i",\u00ef:"i",\u1e2f:"i",\u1ec9:"i",\u01d0:"i",\u0209:"i",\u020b:"i",\u1ecb:"i",\u012f:"i",\u1e2d:"i",\u0268:"i",\u0131:"i","\u24d9":"j",\uff4a:"j",\u0135:"j",\u01f0:"j",\u0249:"j","\u24da":"k",\uff4b:"k",\u1e31:"k",\u01e9:"k",\u1e33:"k",\u0137:"k",\u1e35:"k",\u0199:"k",\u2c6a:"k",\ua741:"k",\ua743:"k",\ua745:"k",\ua7a3:"k","\u24db":"l",\uff4c:"l",\u0140:"l",\u013a:"l",\u013e:"l",\u1e37:"l",\u1e39:"l",\u013c:"l",\u1e3d:"l",\u1e3b:"l",\u017f:"l",\u0142:"l",\u019a:"l",\u026b:"l",\u2c61:"l",\ua749:"l",\ua781:"l",\ua747:"l",\u01c9:"lj","\u24dc":"m",\uff4d:"m",\u1e3f:"m",\u1e41:"m",\u1e43:"m",\u0271:"m",\u026f:"m","\u24dd":"n",\uff4e:"n",\u01f9:"n",\u0144:"n",\u00f1:"n",\u1e45:"n",\u0148:"n",\u1e47:"n",\u0146:"n",\u1e4b:"n",\u1e49:"n",\u019e:"n",\u0272:"n",\u0149:"n",\ua791:"n",\ua7a5:"n",\u01cc:"nj","\u24de":"o",\uff4f:"o",\u00f2:"o",\u00f3:"o",\u00f4:"o",\u1ed3:"o",\u1ed1:"o",\u1ed7:"o",\u1ed5:"o",\u00f5:"o",\u1e4d:"o",\u022d:"o",\u1e4f:"o",\u014d:"o",\u1e51:"o",\u1e53:"o",\u014f:"o",\u022f:"o",\u0231:"o",\u00f6:"o",\u022b:"o",\u1ecf:"o",\u0151:"o",\u01d2:"o",\u020d:"o",\u020f:"o",\u01a1:"o",\u1edd:"o",\u1edb:"o",\u1ee1:"o",\u1edf:"o",\u1ee3:"o",\u1ecd:"o",\u1ed9:"o",\u01eb:"o",\u01ed:"o",\u00f8:"o",\u01ff:"o",\u0254:"o",\ua74b:"o",\ua74d:"o",\u0275:"o",\u01a3:"oi",\u0223:"ou",\ua74f:"oo","\u24df":"p",\uff50:"p",\u1e55:"p",\u1e57:"p",\u01a5:"p",\u1d7d:"p",\ua751:"p",\ua753:"p",\ua755:"p","\u24e0":"q",\uff51:"q",\u024b:"q",\ua757:"q",\ua759:"q","\u24e1":"r",\uff52:"r",\u0155:"r",\u1e59:"r",\u0159:"r",\u0211:"r",\u0213:"r",\u1e5b:"r",\u1e5d:"r",\u0157:"r",\u1e5f:"r",\u024d:"r",\u027d:"r",\ua75b:"r",\ua7a7:"r",\ua783:"r","\u24e2":"s",\uff53:"s",\u00df:"s",\u015b:"s",\u1e65:"s",\u015d:"s",\u1e61:"s",\u0161:"s",\u1e67:"s",\u1e63:"s",\u1e69:"s",\u0219:"s",\u015f:"s",\u023f:"s",\ua7a9:"s",\ua785:"s",\u1e9b:"s","\u24e3":"t",\uff54:"t",\u1e6b:"t",\u1e97:"t",\u0165:"t",\u1e6d:"t",\u021b:"t",\u0163:"t",\u1e71:"t",\u1e6f:"t",\u0167:"t",\u01ad:"t",\u0288:"t",\u2c66:"t",\ua787:"t",\ua729:"tz","\u24e4":"u",\uff55:"u",\u00f9:"u",\u00fa:"u",\u00fb:"u",\u0169:"u",\u1e79:"u",\u016b:"u",\u1e7b:"u",\u016d:"u",\u00fc:"u",\u01dc:"u",\u01d8:"u",\u01d6:"u",\u01da:"u",\u1ee7:"u",\u016f:"u",\u0171:"u",\u01d4:"u",\u0215:"u",\u0217:"u",\u01b0:"u",\u1eeb:"u",\u1ee9:"u",\u1eef:"u",\u1eed:"u",\u1ef1:"u",\u1ee5:"u",\u1e73:"u",\u0173:"u",\u1e77:"u",\u1e75:"u",\u0289:"u","\u24e5":"v",\uff56:"v",\u1e7d:"v",\u1e7f:"v",\u028b:"v",\ua75f:"v",\u028c:"v",\ua761:"vy","\u24e6":"w",\uff57:"w",\u1e81:"w",\u1e83:"w",\u0175:"w",\u1e87:"w",\u1e85:"w",\u1e98:"w",\u1e89:"w",\u2c73:"w","\u24e7":"x",\uff58:"x",\u1e8b:"x",\u1e8d:"x","\u24e8":"y",\uff59:"y",\u1ef3:"y",\u00fd:"y",\u0177:"y",\u1ef9:"y",\u0233:"y",\u1e8f:"y",\u00ff:"y",\u1ef7:"y",\u1e99:"y",\u1ef5:"y",\u01b4:"y",\u024f:"y",\u1eff:"y","\u24e9":"z",\uff5a:"z",\u017a:"z",\u1e91:"z",\u017c:"z",\u017e:"z",\u1e93:"z",\u1e95:"z",\u01b6:"z",\u0225:"z",\u0240:"z",\u2c6c:"z",\ua763:"z",\u0386:"\u0391",\u0388:"\u0395",\u0389:"\u0397",\u038a:"\u0399",\u03aa:"\u0399",\u038c:"\u039f",\u038e:"\u03a5",\u03ab:"\u03a5",\u038f:"\u03a9",\u03ac:"\u03b1",\u03ad:"\u03b5",\u03ae:"\u03b7",\u03af:"\u03b9",\u03ca:"\u03b9",\u0390:"\u03b9",\u03cc:"\u03bf",\u03cd:"\u03c5",\u03cb:"\u03c5",\u03b0:"\u03c5",\u03c9:"\u03c9",\u03c2:"\u03c3"};function PO(e){return e.replace(/[^\u0000-\u007E]/g,t=>Z1e[t]||t)}class X1e{constructor(n,t){this._ngSelect=n,this._selectionModel=t,this._items=[],this._filteredItems=[],this._markedIndex=-1}get items(){return this._items}get filteredItems(){return this._filteredItems}get markedIndex(){return this._markedIndex}get selectedItems(){return this._selectionModel.value}get markedItem(){return this._filteredItems[this._markedIndex]}get noItemsToSelect(){return this._ngSelect.hideSelected&&this._items.length===this.selectedItems.length}get maxItemsSelected(){return this._ngSelect.multiple&&this._ngSelect.maxSelectedItems<=this.selectedItems.length}get lastSelectedItem(){let n=this.selectedItems.length-1;for(;n>=0;n--){const t=this.selectedItems[n];if(!t.disabled)return t}return null}setItems(n){this._items=n.map((t,r)=>this.mapItem(t,r)),this._ngSelect.groupBy?(this._groups=this._groupBy(this._items,this._ngSelect.groupBy),this._items=this._flatten(this._groups)):(this._groups=new Map,this._groups.set(void 0,this._items)),this._filteredItems=[...this._items]}select(n){if(n.selected||this.maxItemsSelected)return;const t=this._ngSelect.multiple;t||this.clearSelected(),this._selectionModel.select(n,t,this._ngSelect.selectableGroupAsModel),this._ngSelect.hideSelected&&this._hideSelected(n)}unselect(n){n.selected&&(this._selectionModel.unselect(n,this._ngSelect.multiple),this._ngSelect.hideSelected&&Bo(n.index)&&this._ngSelect.multiple&&this._showSelected(n))}findItem(n){let t;return t=this._ngSelect.compareWith?r=>this._ngSelect.compareWith(r.value,n):this._ngSelect.bindValue?r=>!r.children&&this.resolveNested(r.value,this._ngSelect.bindValue)===n:r=>r.value===n||!r.children&&r.label&&r.label===this.resolveNested(n,this._ngSelect.bindLabel),this._items.find(r=>t(r))}addItem(n){const t=this.mapItem(n,this._items.length);return this._items.push(t),this._filteredItems.push(t),t}clearSelected(n=!1){this._selectionModel.clear(n),this._items.forEach(t=>{t.selected=n&&t.selected&&t.disabled,t.marked=!1}),this._ngSelect.hideSelected&&this.resetFilteredItems()}findByLabel(n){return n=PO(n).toLocaleLowerCase(),this.filteredItems.find(t=>PO(t.label).toLocaleLowerCase().substr(0,n.length)===n)}filter(n){if(!n)return void this.resetFilteredItems();this._filteredItems=[],n=this._ngSelect.searchFn?n:PO(n).toLocaleLowerCase();const t=this._ngSelect.searchFn||this._defaultSearchFn,r=this._ngSelect.hideSelected;for(const i of Array.from(this._groups.keys())){const l=[];for(const u of this._groups.get(i))r&&(u.parent&&u.parent.selected||u.selected)||t(n,this._ngSelect.searchFn?u.value:u)&&l.push(u);if(l.length>0){const[u]=l.slice(-1);if(u.parent){const g=this._items.find(x=>x===u.parent);this._filteredItems.push(g)}this._filteredItems.push(...l)}}}resetFilteredItems(){this._filteredItems.length!==this._items.length&&(this._filteredItems=this._ngSelect.hideSelected&&this.selectedItems.length>0?this._items.filter(n=>!n.selected):this._items)}unmarkItem(){this._markedIndex=-1}markNextItem(){this._stepToItem(1)}markPreviousItem(){this._stepToItem(-1)}markItem(n){this._markedIndex=this._filteredItems.indexOf(n)}markSelectedOrDefault(n){if(0===this._filteredItems.length)return;const t=this._getLastMarkedIndex();this._markedIndex=t>-1?t:n?this.filteredItems.findIndex(r=>!r.disabled):-1}resolveNested(n,t){if(!mD(n))return n;if(-1===t.indexOf("."))return n[t];{const r=t.split(".");let i=n;for(let l=0,u=r.length;l<u;++l){if(null==i)return null;i=i[r[l]]}return i}}mapItem(n,t){const r=Bo(n.$ngOptionLabel)?n.$ngOptionLabel:this.resolveNested(n,this._ngSelect.bindLabel),i=Bo(n.$ngOptionValue)?n.$ngOptionValue:n;return{index:t,label:Bo(r)?r.toString():"",value:i,disabled:n.disabled,htmlId:`${this._ngSelect.dropdownId}-${t}`}}mapSelectedItems(){const n=this._ngSelect.multiple;for(const t of this.selectedItems){const r=this._ngSelect.bindValue?this.resolveNested(t.value,this._ngSelect.bindValue):t.value,i=Bo(r)?this.findItem(r):null;this._selectionModel.unselect(t,n),this._selectionModel.select(i||t,n,this._ngSelect.selectableGroupAsModel)}this._ngSelect.hideSelected&&(this._filteredItems=this.filteredItems.filter(t=>-1===this.selectedItems.indexOf(t)))}_showSelected(n){if(this._filteredItems.push(n),n.parent){const t=n.parent;this._filteredItems.find(i=>i===t)||this._filteredItems.push(t)}else if(n.children)for(const t of n.children)t.selected=!1,this._filteredItems.push(t);this._filteredItems=[...this._filteredItems.sort((t,r)=>t.index-r.index)]}_hideSelected(n){this._filteredItems=this._filteredItems.filter(t=>t!==n),n.parent?n.parent.children.every(r=>r.selected)&&(this._filteredItems=this._filteredItems.filter(r=>r!==n.parent)):n.children&&(this._filteredItems=this.filteredItems.filter(t=>t.parent!==n))}_defaultSearchFn(n,t){return PO(t.label).toLocaleLowerCase().indexOf(n)>-1}_getNextItemIndex(n){return n>0?this._markedIndex>=this._filteredItems.length-1?0:this._markedIndex+1:this._markedIndex<=0?this._filteredItems.length-1:this._markedIndex-1}_stepToItem(n){0===this._filteredItems.length||this._filteredItems.every(t=>t.disabled)||(this._markedIndex=this._getNextItemIndex(n),this.markedItem.disabled&&this._stepToItem(n))}_getLastMarkedIndex(){if(this._ngSelect.hideSelected||this._markedIndex>-1&&void 0===this.markedItem)return-1;const n=this._filteredItems.indexOf(this.lastSelectedItem);return this.lastSelectedItem&&n<0?-1:Math.max(this.markedIndex,n)}_groupBy(n,t){const r=new Map;if(0===n.length)return r;if(Array.isArray(n[0].value[t])){for(const u of n){const g=(u.value[t]||[]).map((x,E)=>this.mapItem(x,E));r.set(u,g)}return r}const i=OO(this._ngSelect.groupBy),l=u=>{const g=i?t(u.value):u.value[t];return Bo(g)?g:void 0};for(const u of n){const g=l(u),x=r.get(g);x?x.push(u):r.set(g,[u])}return r}_flatten(n){const t=OO(this._ngSelect.groupBy),r=[];for(const i of Array.from(n.keys())){let l=r.length;if(void 0===i){const R=n.get(void 0)||[];r.push(...R.map(L=>(L.index=l++,L)));continue}const u=mD(i),g={label:u?"":String(i),children:void 0,parent:null,index:l++,disabled:!this._ngSelect.selectableGroup,htmlId:vH()},x=t?this._ngSelect.bindLabel:this._ngSelect.groupBy,E=this._ngSelect.groupValue||(()=>u?i.value:{[x]:i}),D=n.get(i).map(R=>(R.parent=g,R.children=void 0,R.index=l++,R));g.children=D,g.value=E(i,D.map(R=>R.value)),r.push(g),r.push(...D)}return r}}var am=function(e){return e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Esc=27]="Esc",e[e.Space=32]="Space",e[e.ArrowUp=38]="ArrowUp",e[e.ArrowDown=40]="ArrowDown",e[e.Backspace=8]="Backspace",e}(am||{});let xH=(()=>{class e{constructor(){this._dimensions={itemHeight:0,panelHeight:0,itemsPerViewport:0}}get dimensions(){return this._dimensions}calculateItems(t,r,i){const l=this._dimensions,u=l.itemHeight*r,x=Math.max(0,t)/u*r;let E=Math.min(r,Math.ceil(x)+(l.itemsPerViewport+1));const R=Math.max(0,E-l.itemsPerViewport);let L=Math.min(R,Math.floor(x)),V=l.itemHeight*Math.ceil(L)-l.itemHeight*Math.min(L,i);return V=isNaN(V)?0:V,L=isNaN(L)?-1:L,E=isNaN(E)?-1:E,L-=i,L=Math.max(0,L),E+=i,E=Math.min(r,E),{topPadding:V,scrollHeight:u,start:L,end:E}}setDimensions(t,r){const i=Math.max(1,Math.floor(r/t));this._dimensions={itemHeight:t,panelHeight:r,itemsPerViewport:i}}getScrollTo(t,r,i){const{panelHeight:l}=this.dimensions,u=t+r,x=i+l;return l>=u&&i===t?null:u>x?i+u-x:t<=i?t:null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac})}return e})();const bH=["top","right","bottom","left"],Y1e=typeof requestAnimationFrame<"u"?F0e:$0e;let wH=(()=>{class e{constructor(t,r,i,l,u){this._renderer=t,this._zone=r,this._panelService=i,this._document=u,this.items=[],this.position="auto",this.virtualScroll=!1,this.filterValue=null,this.update=new rr,this.scroll=new rr,this.scrollToEnd=new rr,this.outsideClick=new rr,this._destroy$=new Mi,this._scrollToEndFired=!1,this._updateScrollHeight=!1,this._lastScrollPosition=0,this._dropdown=l.nativeElement}get currentPosition(){return this._currentPosition}get itemsLength(){return this._itemsLength}set itemsLength(t){t!==this._itemsLength&&(this._itemsLength=t,this._onItemsLengthChanged())}get _startOffset(){if(this.markedItem){const{itemHeight:t,panelHeight:r}=this._panelService.dimensions,i=this.markedItem.index*t;return r>i?0:i}return 0}ngOnInit(){this._select=this._dropdown.parentElement,this._virtualPadding=this.paddingElementRef.nativeElement,this._scrollablePanel=this.scrollElementRef.nativeElement,this._contentPanel=this.contentElementRef.nativeElement,this._handleScroll(),this._handleOutsideClick(),this._appendDropdown(),this._setupMousedownListener()}ngOnChanges(t){if(t.items){const r=t.items;this._onItemsChange(r.currentValue,r.firstChange)}}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete(),this._destroy$.unsubscribe(),this.appendTo&&this._renderer.removeChild(this._dropdown.parentNode,this._dropdown)}scrollTo(t,r=!1){if(!t)return;const i=this.items.indexOf(t);if(i<0||i>=this.itemsLength)return;let l;if(this.virtualScroll){const u=this._panelService.dimensions.itemHeight;l=this._panelService.getScrollTo(i*u,u,this._lastScrollPosition)}else{const u=this._dropdown.querySelector(`#${t.htmlId}`);l=this._panelService.getScrollTo(u.offsetTop,u.clientHeight,r?u.offsetTop:this._lastScrollPosition)}Bo(l)&&(this._scrollablePanel.scrollTop=l)}scrollToTag(){const t=this._scrollablePanel;t.scrollTop=t.scrollHeight-t.clientHeight}adjustPosition(){this._updateYPosition()}_handleDropdownPosition(){this._currentPosition=this._calculateCurrentPosition(this._dropdown),bH.includes(this._currentPosition)?this._updateDropdownClass(this._currentPosition):this._updateDropdownClass("bottom"),this.appendTo&&this._updateYPosition(),this._dropdown.style.opacity="1"}_updateDropdownClass(t){bH.forEach(i=>{const l=`ng-select-${i}`;this._renderer.removeClass(this._dropdown,l),this._renderer.removeClass(this._select,l)});const r=`ng-select-${t}`;this._renderer.addClass(this._dropdown,r),this._renderer.addClass(this._select,r)}_handleScroll(){this._zone.runOutsideAngular(()=>{Ea(this.scrollElementRef.nativeElement,"scroll").pipe(Fo(this._destroy$),function O0e(e,n=MO){return function I0e(e){return Ie((n,t)=>{let r=!1,i=null,l=null,u=!1;const g=()=>{if(l?.unsubscribe(),l=null,r){r=!1;const E=i;i=null,t.next(E)}u&&t.complete()},x=()=>{l=null,u&&t.complete()};n.subscribe(te(t,E=>{r=!0,i=E,l||Dl(e(E)).subscribe(l=te(t,g,x))},()=>{u=!0,(!r||!l||l.closed)&&t.complete()}))})}(()=>H4(e,n))}(0,Y1e)).subscribe(t=>{const r=t.path||t.composedPath&&t.composedPath();r&&(0!==r.length||t.target)&&this._onContentScrolled(r&&0!==r.length?r[0].scrollTop:t.target.scrollTop)})})}_handleOutsideClick(){this._document&&this._zone.runOutsideAngular(()=>{kO(Ea(this._document,"touchstart",{capture:!0}),Ea(this._document,"click",{capture:!0})).pipe(Fo(this._destroy$)).subscribe(t=>this._checkToClose(t))})}_checkToClose(t){if(this._select.contains(t.target)||this._dropdown.contains(t.target))return;const r=t.path||t.composedPath&&t.composedPath();t.target&&t.target.shadowRoot&&r&&r[0]&&this._select.contains(r[0])||this._zone.run(()=>this.outsideClick.emit())}_onItemsChange(t,r){this.items=t||[],this._scrollToEndFired=!1,this.itemsLength=t.length,this.virtualScroll?this._updateItemsRange(r):(this._setVirtualHeight(),this._updateItems(r))}_updateItems(t){this.update.emit(this.items),!1!==t&&this._zone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._panelService.setDimensions(0,this._scrollablePanel.clientHeight),this._handleDropdownPosition(),this.scrollTo(this.markedItem,t)})})}_updateItemsRange(t){this._zone.runOutsideAngular(()=>{this._measureDimensions().then(()=>{t?(this._renderItemsRange(this._startOffset),this._handleDropdownPosition()):this._renderItemsRange()})})}_onContentScrolled(t){this.virtualScroll&&this._renderItemsRange(t),this._lastScrollPosition=t,this._fireScrollToEnd(t)}_updateVirtualHeight(t){this._updateScrollHeight&&(this._virtualPadding.style.height=`${t}px`,this._updateScrollHeight=!1)}_setVirtualHeight(){this._virtualPadding&&(this._virtualPadding.style.height="0px")}_onItemsLengthChanged(){this._updateScrollHeight=!0}_renderItemsRange(t=null){if(t&&this._lastScrollPosition===t)return;const r=this._panelService.calculateItems(t=t||this._scrollablePanel.scrollTop,this.itemsLength,this.bufferAmount);this._updateVirtualHeight(r.scrollHeight),this._contentPanel.style.transform=`translateY(${r.topPadding}px)`,this._zone.run(()=>{this.update.emit(this.items.slice(r.start,r.end)),this.scroll.emit({start:r.start,end:r.end})}),Bo(t)&&0===this._lastScrollPosition&&(this._scrollablePanel.scrollTop=t,this._lastScrollPosition=t)}_measureDimensions(){if(this._panelService.dimensions.itemHeight>0||0===this.itemsLength)return Promise.resolve(this._panelService.dimensions);const[t]=this.items;return this.update.emit([t]),Promise.resolve().then(()=>{const i=this._dropdown.querySelector(`#${t.htmlId}`).clientHeight;return this._virtualPadding.style.height=i*this.itemsLength+"px",this._panelService.setDimensions(i,this._scrollablePanel.clientHeight),this._panelService.dimensions})}_fireScrollToEnd(t){this._scrollToEndFired||0===t||t+this._dropdown.clientHeight>=(this.virtualScroll?this._virtualPadding:this._contentPanel).clientHeight-1&&(this._zone.run(()=>this.scrollToEnd.emit()),this._scrollToEndFired=!0)}_calculateCurrentPosition(t){if("auto"!==this.position)return this.position;const r=this._select.getBoundingClientRect(),i=document.documentElement.scrollTop||document.body.scrollTop;return r.top+window.pageYOffset+r.height+t.getBoundingClientRect().height>i+document.documentElement.clientHeight?"top":"bottom"}_appendDropdown(){if(this.appendTo){if(this._parent=document.querySelector(this.appendTo),!this._parent)throw new Error(`appendTo selector ${this.appendTo} did not found any parent element`);this._updateXPosition(),this._parent.appendChild(this._dropdown)}}_updateXPosition(){const t=this._select.getBoundingClientRect(),r=this._parent.getBoundingClientRect();this._dropdown.style.left=t.left-r.left+"px",this._dropdown.style.width=t.width+"px",this._dropdown.style.minWidth=t.width+"px"}_updateYPosition(){const t=this._select.getBoundingClientRect(),r=this._parent.getBoundingClientRect(),i=t.height;"top"===this._currentPosition?(this._dropdown.style.bottom=r.bottom-t.bottom+i+"px",this._dropdown.style.top="auto"):"bottom"===this._currentPosition&&(this._dropdown.style.top=t.top-r.top+i+"px",this._dropdown.style.bottom="auto")}_setupMousedownListener(){this._zone.runOutsideAngular(()=>{Ea(this._dropdown,"mousedown").pipe(Fo(this._destroy$)).subscribe(t=>{"INPUT"!==t.target.tagName&&t.preventDefault()})})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(id),ut(ni),ut(xH),ut(Li),ut(Ro,8))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["ng-dropdown-panel"]],viewQuery:function(r,i){if(1&r&&(od(Y0e,7,Li),od(K0e,7,Li),od(J0e,7,Li)),2&r){let l;_i(l=yi())&&(i.contentElementRef=l.first),_i(l=yi())&&(i.scrollElementRef=l.first),_i(l=yi())&&(i.paddingElementRef=l.first)}},inputs:{items:"items",markedItem:"markedItem",position:"position",appendTo:"appendTo",bufferAmount:"bufferAmount",virtualScroll:[2,"virtualScroll","virtualScroll",go],headerTemplate:"headerTemplate",footerTemplate:"footerTemplate",filterValue:"filterValue"},outputs:{update:"update",scroll:"scroll",scrollToEnd:"scrollToEnd",outsideClick:"outsideClick"},features:[MC,Co],ngContentSelectors:_H,decls:9,vars:6,consts:[["scroll",""],["padding",""],["content",""],[1,"ng-dropdown-header"],["role","listbox",1,"ng-dropdown-panel-items","scroll-host"],[1,"ng-dropdown-footer"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(r,i){1&r&&(yI(),gt(0,Q0e,2,4,"div",3),P(1,"div",4,0),Rt(3,"div",null,1),P(5,"div",null,2),vI(7),O()(),gt(8,e1e,2,4,"div",5)),2&r&&(Os(i.headerTemplate?0:-1),W(3),Xi("total-padding",i.virtualScroll),W(2),Xi("scrollable-content",i.virtualScroll&&i.items.length),W(3),Os(i.footerTemplate?8:-1))},dependencies:[bv],encapsulation:2,changeDetection:0})}return e})(),K1e=(()=>{class e{constructor(t){this.elementRef=t,this.disabled=!1,this.stateChange$=new Mi}get label(){return(this.elementRef.nativeElement.textContent||"").trim()}ngOnChanges(t){t.disabled&&this.stateChange$.next({value:this.value,disabled:this.disabled})}ngAfterViewChecked(){this.label!==this._previousLabel&&(this._previousLabel=this.label,this.stateChange$.next({value:this.value,disabled:this.disabled,label:this.elementRef.nativeElement.innerHTML}))}ngOnDestroy(){this.stateChange$.complete()}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Li))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["ng-option"]],inputs:{value:"value",disabled:[2,"disabled","disabled",go]},features:[MC,Co],ngContentSelectors:_H,decls:1,vars:0,template:function(r,i){1&r&&(yI(),vI(0))},encapsulation:2,changeDetection:0})}return e})(),J1e=(()=>{class e{constructor(){this.notFoundText="No items found",this.typeToSearchText="Type to search",this.addTagText="Add item",this.loadingText="Loading...",this.clearAllText="Clear all",this.disableVirtualScroll=!0,this.openOnEnter=!0,this.appearance="underline"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Q1e=(()=>{class e{warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const TH=new vn("ng-select-selection-model");let EH=(()=>{class e{get items(){return this._items}set items(t){this._itemsAreUsed=!0,this._items=t??[]}get compareWith(){return this._compareWith}set compareWith(t){if(null!=t&&!OO(t))throw Error("`compareWith` must be a function.");this._compareWith=t}get clearSearchOnAdd(){return Bo(this._clearSearchOnAdd)?this._clearSearchOnAdd:Bo(this.config.clearSearchOnAdd)?this.config.clearSearchOnAdd:this.closeOnSelect}set clearSearchOnAdd(t){this._clearSearchOnAdd=t}get deselectOnClick(){return Bo(this._deselectOnClick)?this._deselectOnClick:Bo(this.config.deselectOnClick)?this.config.deselectOnClick:this.multiple}set deselectOnClick(t){this._deselectOnClick=t}get disabled(){return this.readonly||this._disabled}get filtered(){return!!this.searchTerm&&this.searchable||this._isComposing}get single(){return!this.multiple}get _editableSearchTerm(){return this.editableSearchTerm&&!this.multiple}constructor(t,r,i,l,u,g,x){this.classes=t,this.autoFocus=r,this.config=i,this._cd=g,this._console=x,this.markFirst=!0,this.dropdownPosition="auto",this.loading=!1,this.closeOnSelect=!0,this.hideSelected=!1,this.selectOnTab=!1,this.bufferAmount=4,this.selectableGroup=!1,this.selectableGroupAsModel=!0,this.searchFn=null,this.trackByFn=null,this.clearOnBackspace=!0,this.labelForId=null,this.inputAttrs={},this.readonly=!1,this.searchWhileComposing=!0,this.minTermLength=0,this.editableSearchTerm=!1,this.keyDownFn=E=>!0,this.multiple=!1,this.addTag=!1,this.searchable=!0,this.clearable=!0,this.isOpen=!1,this.blurEvent=new rr,this.focusEvent=new rr,this.changeEvent=new rr,this.openEvent=new rr,this.closeEvent=new rr,this.searchEvent=new rr,this.clearEvent=new rr,this.addEvent=new rr,this.removeEvent=new rr,this.scroll=new rr,this.scrollToEnd=new rr,this.useDefaultClass=!0,this.viewPortItems=[],this.searchTerm=null,this.dropdownId=vH(),this.escapeHTML=!0,this._items=[],this._defaultLabel="label",this._pressedKeys=[],this._isComposing=!1,this._destroy$=new Mi,this._keyPress$=new Mi,this._onChange=E=>{},this._onTouched=()=>{},this.clearItem=E=>{const D=this.selectedItems.find(R=>R.value===E);this.unselect(D)},this.trackByOption=(E,D)=>this.trackByFn?this.trackByFn(D.value):D,this._mergeGlobalConfig(i),this.itemsList=new X1e(this,l()),this.element=u.nativeElement}get selectedItems(){return this.itemsList.selectedItems}get selectedValues(){return this.selectedItems.map(t=>t.value)}get hasValue(){return this.selectedItems.length>0}get currentPanelPosition(){if(this.dropdownPanel)return this.dropdownPanel.currentPosition}ngOnInit(){this._handleKeyPresses(),this._setInputAttributes()}ngOnChanges(t){t.multiple&&this.itemsList.clearSelected(),t.items&&this._setItems(t.items.currentValue||[]),t.isOpen&&(this._manualOpen=Bo(t.isOpen.currentValue))}ngAfterViewInit(){this._itemsAreUsed||(this.escapeHTML=!1,this._setItemsFromNgOptions()),Bo(this.autoFocus)&&this.focus()}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}handleKeyDown(t){if(am[t.which]){if(!1===this.keyDownFn(t))return;this.handleKeyCode(t)}else t.key&&1===t.key.length&&this._keyPress$.next(t.key.toLocaleLowerCase())}handleKeyCode(t){this.clearButton&&this.clearButton.nativeElement===t.target?this.handleKeyCodeClear(t):this.handleKeyCodeInput(t)}handleKeyCodeInput(t){switch(t.which){case am.ArrowDown:this._handleArrowDown(t);break;case am.ArrowUp:this._handleArrowUp(t);break;case am.Space:this._handleSpace(t);break;case am.Enter:this._handleEnter(t);break;case am.Tab:this._handleTab(t);break;case am.Esc:this.close(),t.preventDefault();break;case am.Backspace:this._handleBackspace()}}handleKeyCodeClear(t){t.which===am.Enter&&(this.handleClearClick(),t.preventDefault())}handleMousedown(t){const r=t.target;"INPUT"!==r.tagName&&t.preventDefault(),r.classList.contains("ng-clear-wrapper")?this.handleClearClick():r.classList.contains("ng-arrow-wrapper")?this.handleArrowClick():r.classList.contains("ng-value-icon")||(this.focused||this.focus(),this.searchable?this.open():this.toggle())}handleArrowClick(){this.isOpen?this.close():this.open()}handleClearClick(){this.hasValue&&(this.itemsList.clearSelected(!0),this._updateNgModel()),this._clearSearch(),this.focus(),this.clearEvent.emit(),this._onSelectionChanged()}clearModel(){this.clearable&&(this.itemsList.clearSelected(),this._updateNgModel())}writeValue(t){this.itemsList.clearSelected(),this._handleWriteValue(t),this._cd.markForCheck()}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this._disabled=t,this._cd.markForCheck()}toggle(){this.isOpen?this.close():this.open()}open(){this.disabled||this.isOpen||this._manualOpen||!this._isTypeahead&&!this.addTag&&this.itemsList.noItemsToSelect||(this.isOpen=!0,this.itemsList.markSelectedOrDefault(this.markFirst),this.openEvent.emit(),this.searchTerm||this.focus(),this.detectChanges())}close(){!this.isOpen||this._manualOpen||(this.isOpen=!1,this._isComposing=!1,this._editableSearchTerm?this.itemsList.resetFilteredItems():this._clearSearch(),this.itemsList.unmarkItem(),this._onTouched(),this.closeEvent.emit(),this._cd.markForCheck())}toggleItem(t){!t||t.disabled||this.disabled||(this.deselectOnClick&&t.selected?this.unselect(t):this.select(t),this._editableSearchTerm&&this._setSearchTermFromItems(),this._onSelectionChanged())}select(t){t.selected||(this.itemsList.select(t),this.clearSearchOnAdd&&!this._editableSearchTerm&&this._clearSearch(),this._updateNgModel(),this.multiple&&this.addEvent.emit(t.value)),(this.closeOnSelect||this.itemsList.noItemsToSelect)&&this.close()}focus(){this.searchInput.nativeElement.focus()}blur(){this.searchInput.nativeElement.blur()}unselect(t){t&&(this.itemsList.unselect(t),this.focus(),this._updateNgModel(),this.removeEvent.emit(t.value))}selectTag(){let t;t=OO(this.addTag)?this.addTag(this.searchTerm):this._primitive?this.searchTerm:{[this.bindLabel]:this.searchTerm};const r=i=>this._isTypeahead||!this.isOpen?this.itemsList.mapItem(i,null):this.itemsList.addItem(i);!function N1e(e){return e instanceof Promise}(t)?t&&this.select(r(t)):t.then(i=>this.select(r(i))).catch(()=>{})}showClear(){return this.clearable&&(this.hasValue||this.searchTerm)&&!this.disabled}focusOnClear(){this.blur(),this.clearButton&&this.clearButton.nativeElement.focus()}get showAddTag(){if(!this._validTerm)return!1;const t=this.searchTerm.toLowerCase().trim();return this.addTag&&!this.itemsList.filteredItems.some(r=>r.label.toLowerCase()===t)&&(!this.hideSelected&&this.isOpen||!this.selectedItems.some(r=>r.label.toLowerCase()===t))&&!this.loading}showNoItemsFound(){const t=0===this.itemsList.filteredItems.length;return(t&&!this._isTypeahead&&!this.loading||t&&this._isTypeahead&&this._validTerm&&!this.loading)&&!this.showAddTag}showTypeToSearch(){return 0===this.itemsList.filteredItems.length&&this._isTypeahead&&!this._validTerm&&!this.loading}onCompositionStart(){this._isComposing=!0}onCompositionEnd(t){this._isComposing=!1,!this.searchWhileComposing&&this.filter(t)}filter(t){this._isComposing&&!this.searchWhileComposing||(this.searchTerm=t,this._isTypeahead&&(this._validTerm||0===this.minTermLength)&&this.typeahead.next(t),this._isTypeahead||(this.itemsList.filter(this.searchTerm),this.isOpen&&this.itemsList.markSelectedOrDefault(this.markFirst)),this.searchEvent.emit({term:t,items:this.itemsList.filteredItems.map(r=>r.value)}),this.open())}onInputFocus(t){this.focused||(this._editableSearchTerm&&this._setSearchTermFromItems(),this.element.classList.add("ng-select-focused"),this.focusEvent.emit(t),this.focused=!0)}onInputBlur(t){this.element.classList.remove("ng-select-focused"),this.blurEvent.emit(t),!this.isOpen&&!this.disabled&&this._onTouched(),this._editableSearchTerm&&this._setSearchTermFromItems(),this.focused=!1}onItemHover(t){t.disabled||this.itemsList.markItem(t)}detectChanges(){this._cd.destroyed||this._cd.detectChanges()}_setSearchTermFromItems(){const t=this.selectedItems&&this.selectedItems[0];this.searchTerm=t&&t.label||null}_setItems(t){const r=t[0];this.bindLabel=this.bindLabel||this._defaultLabel,this._primitive=Bo(r)?!mD(r):this._primitive||this.bindLabel===this._defaultLabel,this.itemsList.setItems(t),t.length>0&&this.hasValue&&this.itemsList.mapSelectedItems(),this.isOpen&&Bo(this.searchTerm)&&!this._isTypeahead&&this.itemsList.filter(this.searchTerm),(this._isTypeahead||this.isOpen)&&this.itemsList.markSelectedOrDefault(this.markFirst)}_setItemsFromNgOptions(){const t=i=>{this.items=i.map(l=>({$ngOptionValue:l.value,$ngOptionLabel:l.elementRef.nativeElement.innerHTML,disabled:l.disabled})),this.itemsList.setItems(this.items),this.hasValue&&this.itemsList.mapSelectedItems(),this.detectChanges()},r=()=>{const i=kO(this.ngOptions.changes,this._destroy$);kO(...this.ngOptions.map(l=>l.stateChange$)).pipe(Fo(i)).subscribe(l=>{const u=this.itemsList.findItem(l.value);u.disabled=l.disabled,u.label=l.label||u.label,this._cd.detectChanges()})};this.ngOptions.changes.pipe(kN(this.ngOptions),Fo(this._destroy$)).subscribe(i=>{this.bindLabel=this._defaultLabel,t(i),r()})}_isValidWriteValue(t){if(!Bo(t)||this.multiple&&""===t||Array.isArray(t)&&0===t.length)return!1;const r=i=>!(!Bo(this.compareWith)&&mD(i)&&this.bindValue&&(this._console.warn(`Setting object(${JSON.stringify(i)}) as your model with bindValue is not allowed unless [compareWith] is used.`),1));return this.multiple?Array.isArray(t)?t.every(i=>r(i)):(this._console.warn("Multiple select ngModel should be array."),!1):r(t)}_handleWriteValue(t){if(!this._isValidWriteValue(t))return;const r=i=>{let l=this.itemsList.findItem(i);if(l)this.itemsList.select(l);else{const u=mD(i);u||!u&&!this.bindValue?this.itemsList.select(this.itemsList.mapItem(i,null)):this.bindValue&&(l={[this.bindLabel]:null,[this.bindValue]:i},this.itemsList.select(this.itemsList.mapItem(l,null)))}};this.multiple?t.forEach(i=>r(i)):r(t)}_handleKeyPresses(){this.searchable||this._keyPress$.pipe(Fo(this._destroy$),Il(t=>this._pressedKeys.push(t)),function P0e(e,n=MO){return Ie((t,r)=>{let i=null,l=null,u=null;const g=()=>{if(i){i.unsubscribe(),i=null;const E=l;l=null,r.next(E)}};function x(){const E=u+e,D=n.now();if(D<E)return i=this.schedule(void 0,E-D),void r.add(i);g()}t.subscribe(te(r,E=>{l=E,u=n.now(),i||(i=n.schedule(x,e),r.add(i))},()=>{g(),r.complete()},void 0,()=>{l=i=null}))})}(200),Ga(()=>this._pressedKeys.length>0),pe(()=>this._pressedKeys.join(""))).subscribe(t=>{const r=this.itemsList.findByLabel(t);r&&(this.isOpen?(this.itemsList.markItem(r),this._scrollToMarked(),this._cd.markForCheck()):this.select(r)),this._pressedKeys=[]})}_setInputAttributes(){const t=this.searchInput.nativeElement,r={type:"text",autocorrect:"off",autocapitalize:"off",autocomplete:this.labelForId?"off":this.dropdownId,...this.inputAttrs};for(const i of Object.keys(r))t.setAttribute(i,r[i])}_updateNgModel(){const t=[];for(const i of this.selectedItems)if(this.bindValue){let l=null;l=i.children?i.value[(this.groupValue?this.bindValue:this.groupBy)||this.groupBy]:this.itemsList.resolveNested(i.value,this.bindValue),t.push(l)}else t.push(i.value);const r=this.selectedItems.map(i=>i.value);this.multiple?(this._onChange(t),this.changeEvent.emit(r)):(this._onChange(Bo(t[0])?t[0]:null),this.changeEvent.emit(r[0])),this._cd.markForCheck()}_clearSearch(){this.searchTerm&&(this._changeSearch(null),this.itemsList.resetFilteredItems())}_changeSearch(t){this.searchTerm=t,this._isTypeahead&&this.typeahead.next(t)}_scrollToMarked(){!this.isOpen||!this.dropdownPanel||this.dropdownPanel.scrollTo(this.itemsList.markedItem)}_scrollToTag(){!this.isOpen||!this.dropdownPanel||this.dropdownPanel.scrollToTag()}_onSelectionChanged(){this.isOpen&&this.deselectOnClick&&this.appendTo&&(this._cd.detectChanges(),this.dropdownPanel.adjustPosition())}_handleTab(t){if(!1===this.isOpen)if(this.showClear()&&!t.shiftKey)this.focusOnClear(),t.preventDefault();else if(!this.addTag)return;this.selectOnTab?this.itemsList.markedItem?(this.toggleItem(this.itemsList.markedItem),t.preventDefault()):this.showAddTag?(this.selectTag(),t.preventDefault()):this.close():this.close()}_handleEnter(t){if(this.isOpen||this._manualOpen)this.itemsList.markedItem?this.toggleItem(this.itemsList.markedItem):this.showAddTag&&this.selectTag();else{if(!this.openOnEnter)return;this.open()}t.preventDefault()}_handleSpace(t){this.isOpen||this._manualOpen||(this.open(),t.preventDefault())}_handleArrowDown(t){this._nextItemIsTag(1)?(this.itemsList.unmarkItem(),this._scrollToTag()):(this.itemsList.markNextItem(),this._scrollToMarked()),this.open(),t.preventDefault()}_handleArrowUp(t){this.isOpen&&(this._nextItemIsTag(-1)?(this.itemsList.unmarkItem(),this._scrollToTag()):(this.itemsList.markPreviousItem(),this._scrollToMarked()),t.preventDefault())}_nextItemIsTag(t){const r=this.itemsList.markedIndex+t;return this.addTag&&this.searchTerm&&this.itemsList.markedItem&&(r<0||r===this.itemsList.filteredItems.length)}_handleBackspace(){this.searchTerm||!this.clearable||!this.clearOnBackspace||!this.hasValue||(this.multiple?this.unselect(this.itemsList.lastSelectedItem):this.clearModel())}get _isTypeahead(){return this.typeahead&&this.typeahead.observers.length>0}get _validTerm(){const t=this.searchTerm&&this.searchTerm.trim();return t&&t.length>=this.minTermLength}_mergeGlobalConfig(t){this.placeholder=this.placeholder||t.placeholder,this.notFoundText=this.notFoundText||t.notFoundText,this.typeToSearchText=this.typeToSearchText||t.typeToSearchText,this.addTagText=this.addTagText||t.addTagText,this.loadingText=this.loadingText||t.loadingText,this.clearAllText=this.clearAllText||t.clearAllText,this.virtualScroll=Bo(this.virtualScroll)?this.virtualScroll:!!Bo(t.disableVirtualScroll)&&!t.disableVirtualScroll,this.openOnEnter=Bo(this.openOnEnter)?this.openOnEnter:t.openOnEnter,this.appendTo=this.appendTo||t.appendTo,this.bindValue=this.bindValue||t.bindValue,this.bindLabel=this.bindLabel||t.bindLabel,this.appearance=this.appearance||t.appearance}static#e=this.\u0275fac=function(r){return new(r||e)(_u("class"),_u("autofocus"),ut(J1e),ut(TH),ut(Li),ut(Th),ut(Q1e))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["ng-select"]],contentQueries:function(r,i,l){if(1&r&&(vs(l,L1e,5,ui),vs(l,B1e,5,ui),vs(l,z1e,5,ui),vs(l,U1e,5,ui),vs(l,V1e,5,ui),vs(l,j1e,5,ui),vs(l,$1e,5,ui),vs(l,H1e,5,ui),vs(l,G1e,5,ui),vs(l,W1e,5,ui),vs(l,q1e,5,ui),vs(l,K1e,5)),2&r){let u;_i(u=yi())&&(i.optionTemplate=u.first),_i(u=yi())&&(i.optgroupTemplate=u.first),_i(u=yi())&&(i.labelTemplate=u.first),_i(u=yi())&&(i.multiLabelTemplate=u.first),_i(u=yi())&&(i.headerTemplate=u.first),_i(u=yi())&&(i.footerTemplate=u.first),_i(u=yi())&&(i.notFoundTemplate=u.first),_i(u=yi())&&(i.typeToSearchTemplate=u.first),_i(u=yi())&&(i.loadingTextTemplate=u.first),_i(u=yi())&&(i.tagTemplate=u.first),_i(u=yi())&&(i.loadingSpinnerTemplate=u.first),_i(u=yi())&&(i.ngOptions=u)}},viewQuery:function(r,i){if(1&r&&(od(wH,5),od(t1e,7),od(n1e,5)),2&r){let l;_i(l=yi())&&(i.dropdownPanel=l.first),_i(l=yi())&&(i.searchInput=l.first),_i(l=yi())&&(i.clearButton=l.first)}},hostVars:20,hostBindings:function(r,i){1&r&&ct("keydown",function(u){return i.handleKeyDown(u)}),2&r&&Xi("ng-select-typeahead",i.typeahead)("ng-select-multiple",i.multiple)("ng-select-taggable",i.addTag)("ng-select-searchable",i.searchable)("ng-select-clearable",i.clearable)("ng-select-opened",i.isOpen)("ng-select",i.useDefaultClass)("ng-select-disabled",i.disabled)("ng-select-filtered",i.filtered)("ng-select-single",i.single)},inputs:{bindLabel:"bindLabel",bindValue:"bindValue",markFirst:[2,"markFirst","markFirst",go],placeholder:"placeholder",notFoundText:"notFoundText",typeToSearchText:"typeToSearchText",addTagText:"addTagText",loadingText:"loadingText",clearAllText:"clearAllText",appearance:"appearance",dropdownPosition:"dropdownPosition",appendTo:"appendTo",loading:[2,"loading","loading",go],closeOnSelect:[2,"closeOnSelect","closeOnSelect",go],hideSelected:[2,"hideSelected","hideSelected",go],selectOnTab:[2,"selectOnTab","selectOnTab",go],openOnEnter:[2,"openOnEnter","openOnEnter",go],maxSelectedItems:[2,"maxSelectedItems","maxSelectedItems",BI],groupBy:"groupBy",groupValue:"groupValue",bufferAmount:[2,"bufferAmount","bufferAmount",BI],virtualScroll:[2,"virtualScroll","virtualScroll",go],selectableGroup:[2,"selectableGroup","selectableGroup",go],selectableGroupAsModel:[2,"selectableGroupAsModel","selectableGroupAsModel",go],searchFn:"searchFn",trackByFn:"trackByFn",clearOnBackspace:[2,"clearOnBackspace","clearOnBackspace",go],labelForId:"labelForId",inputAttrs:"inputAttrs",tabIndex:[2,"tabIndex","tabIndex",BI],readonly:[2,"readonly","readonly",go],searchWhileComposing:[2,"searchWhileComposing","searchWhileComposing",go],minTermLength:[2,"minTermLength","minTermLength",BI],editableSearchTerm:[2,"editableSearchTerm","editableSearchTerm",go],keyDownFn:"keyDownFn",typeahead:"typeahead",multiple:[2,"multiple","multiple",go],addTag:"addTag",searchable:[2,"searchable","searchable",go],clearable:[2,"clearable","clearable",go],isOpen:[2,"isOpen","isOpen",go],items:"items",compareWith:"compareWith",clearSearchOnAdd:"clearSearchOnAdd",deselectOnClick:"deselectOnClick"},outputs:{blurEvent:"blur",focusEvent:"focus",changeEvent:"change",openEvent:"open",closeEvent:"close",searchEvent:"search",clearEvent:"clear",addEvent:"add",removeEvent:"remove",scroll:"scroll",scrollToEnd:"scrollToEnd"},features:[js([{provide:_d,useExisting:Fi(()=>e),multi:!0},xH]),MC,Co],decls:14,vars:19,consts:[["searchInput",""],["defaultLabelTemplate",""],["defaultLoadingSpinnerTemplate",""],["clearButton",""],["defaultOptionTemplate",""],["defaultTagTemplate",""],["defaultNotFoundTemplate",""],["defaultTypeToSearchTemplate",""],["defaultLoadingTextTemplate",""],[1,"ng-select-container",3,"mousedown"],[1,"ng-value-container"],[1,"ng-placeholder"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["role","combobox","aria-haspopup","listbox",1,"ng-input"],["aria-autocomplete","list",3,"input","compositionstart","compositionend","focus","blur","change","readOnly","disabled","value"],["tabindex","0",1,"ng-clear-wrapper",3,"title"],[1,"ng-arrow-wrapper"],[1,"ng-arrow"],["role","listbox","aria-label","Options list",1,"ng-dropdown-panel",3,"virtualScroll","bufferAmount","appendTo","position","headerTemplate","footerTemplate","filterValue","items","markedItem","ng-select-multiple","ngClass","id"],[1,"ng-value",3,"ng-value-disabled"],[1,"ng-value"],["aria-hidden","true",1,"ng-value-icon","left",3,"click"],[1,"ng-value-label",3,"ngItemLabel","escape"],[3,"ngTemplateOutlet"],[1,"ng-spinner-loader"],["aria-hidden","true",1,"ng-clear"],["role","listbox","aria-label","Options list",1,"ng-dropdown-panel",3,"update","scroll","scrollToEnd","outsideClick","virtualScroll","bufferAmount","appendTo","position","headerTemplate","footerTemplate","filterValue","items","markedItem","ngClass","id"],[1,"ng-option",3,"ng-option-disabled","ng-option-selected","ng-optgroup","ng-option","ng-option-child","ng-option-marked"],["role","option",1,"ng-option",3,"ng-option-marked"],[1,"ng-option",3,"click","mouseover"],[1,"ng-option-label",3,"ngItemLabel","escape"],["role","option",1,"ng-option",3,"mouseover","click"],[1,"ng-tag-label"],[1,"ng-option","ng-option-disabled"]],template:function(r,i){if(1&r){const l=lr();P(0,"div",9),ct("mousedown",function(g){return Bt(l),zt(i.handleMousedown(g))}),P(1,"div",10)(2,"div",11),U(3),O(),gt(4,c1e,2,0)(5,d1e,1,5,null,12),P(6,"div",13)(7,"input",14,0),ct("input",function(){Bt(l);const g=xa(8);return zt(i.filter(g.value))})("compositionstart",function(){return Bt(l),zt(i.onCompositionStart())})("compositionend",function(){Bt(l);const g=xa(8);return zt(i.onCompositionEnd(g.value))})("focus",function(g){return Bt(l),zt(i.onInputFocus(g))})("blur",function(g){return Bt(l),zt(i.onInputBlur(g))})("change",function(g){return Bt(l),zt(g.stopPropagation())}),O()()(),gt(9,p1e,3,1)(10,m1e,4,1,"span",15),P(11,"span",16),Rt(12,"span",17),O()(),gt(13,k1e,8,17,"ng-dropdown-panel",18)}2&r&&(Xi("ng-appearance-outline","outline"===i.appearance)("ng-has-value",i.hasValue),W(3),tt(i.placeholder),W(),Os(i.multiLabelTemplate&&i.multiple||!(i.selectedItems.length>0)?-1:4),W(),Os(i.multiple&&i.multiLabelTemplate&&i.selectedValues.length>0?5:-1),W(),rs("aria-expanded",i.isOpen)("aria-owns",i.isOpen?i.dropdownId:null),W(),Oe("readOnly",!i.searchable||i.itemsList.maxItemsSelected)("disabled",i.disabled)("value",i.searchTerm?i.searchTerm:""),rs("id",i.labelForId)("tabindex",i.tabIndex)("aria-activedescendant",i.isOpen?null==i.itemsList||null==i.itemsList.markedItem?null:i.itemsList.markedItem.htmlId:null)("aria-controls",i.isOpen?i.dropdownId:null),W(2),Os(i.loading?9:-1),W(),Os(i.showClear()?10:-1),W(3),Os(i.isOpen?13:-1))},dependencies:[Zp,bv,wH,F1e],styles:['@charset "UTF-8";.ng-select{position:relative;display:block;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.ng-select div,.ng-select input,.ng-select span{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.ng-select [hidden]{display:none}.ng-select.ng-select-searchable .ng-select-container .ng-value-container .ng-input{opacity:1}.ng-select.ng-select-opened .ng-select-container{z-index:1001}.ng-select.ng-select-disabled .ng-select-container .ng-value-container .ng-placeholder,.ng-select.ng-select-disabled .ng-select-container .ng-value-container .ng-value{-webkit-user-select:none;user-select:none;cursor:default}.ng-select.ng-select-disabled .ng-arrow-wrapper{cursor:default}.ng-select.ng-select-filtered .ng-placeholder{display:none}.ng-select .ng-select-container{cursor:default;display:flex;outline:none;overflow:hidden;position:relative;width:100%}.ng-select .ng-select-container .ng-value-container{display:flex;flex:1}.ng-select .ng-select-container .ng-value-container .ng-input{opacity:0}.ng-select .ng-select-container .ng-value-container .ng-input>input{box-sizing:content-box;background:none transparent;border:0 none;box-shadow:none;outline:none;padding:0;cursor:default;width:100%}.ng-select .ng-select-container .ng-value-container .ng-input>input::-ms-clear{display:none}.ng-select .ng-select-container .ng-value-container .ng-input>input[readonly]{-webkit-user-select:none;user-select:none;width:0;padding:0}.ng-select.ng-select-single.ng-select-filtered .ng-select-container .ng-value-container .ng-value{visibility:hidden}.ng-select.ng-select-single .ng-select-container .ng-value-container,.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-value{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-value .ng-value-icon{display:none}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-input{position:absolute;left:0;width:100%}.ng-select.ng-select-multiple.ng-select-disabled>.ng-select-container .ng-value-container .ng-value .ng-value-icon{display:none}.ng-select.ng-select-multiple .ng-select-container .ng-value-container{flex-wrap:wrap}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{position:absolute}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{white-space:nowrap}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value.ng-value-disabled .ng-value-icon{display:none}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value .ng-value-icon{cursor:pointer}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-input{flex:1;z-index:2}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{z-index:1}.ng-select .ng-clear-wrapper{cursor:pointer;position:relative;width:17px;-webkit-user-select:none;user-select:none}.ng-select .ng-clear-wrapper .ng-clear{display:inline-block;font-size:18px;line-height:1;pointer-events:none}.ng-select .ng-spinner-loader{border-radius:50%;width:17px;height:17px;margin-right:5px;font-size:10px;position:relative;text-indent:-9999em;border-top:2px solid rgba(66,66,66,.2);border-right:2px solid rgba(66,66,66,.2);border-bottom:2px solid rgba(66,66,66,.2);border-left:2px solid #424242;transform:translateZ(0);animation:load8 .8s infinite linear}.ng-select .ng-spinner-loader:after{border-radius:50%;width:17px;height:17px}@-webkit-keyframes load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.ng-select .ng-arrow-wrapper{cursor:pointer;position:relative;text-align:center;-webkit-user-select:none;user-select:none}.ng-select .ng-arrow-wrapper .ng-arrow{pointer-events:none;display:inline-block;height:0;width:0;position:relative}.ng-dropdown-panel{box-sizing:border-box;position:absolute;opacity:0;width:100%;z-index:1050;-webkit-overflow-scrolling:touch}.ng-dropdown-panel .ng-dropdown-panel-items{display:block;height:auto;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;max-height:240px;overflow-y:auto}.ng-dropdown-panel .ng-dropdown-panel-items .ng-optgroup{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option{box-sizing:border-box;cursor:pointer;display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option .ng-option-label:empty:before{content:"\\200b"}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option .highlighted{font-weight:700;text-decoration:underline}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option.disabled{cursor:default}.ng-dropdown-panel .scroll-host{overflow:hidden;overflow-y:auto;position:relative;display:block;-webkit-overflow-scrolling:touch}.ng-dropdown-panel .scrollable-content{top:0;left:0;width:100%;height:100%;position:absolute}.ng-dropdown-panel .total-padding{width:1px;opacity:0}\n'],encapsulation:2,changeDetection:0})}return e})();function eye(){return new tye}class tye{constructor(){this._selected=[]}get value(){return this._selected}select(n,t,r){if(n.selected=!0,(!n.children||!t&&r)&&this._selected.push(n),t)if(n.parent){const i=n.parent.children.length,l=n.parent.children.filter(u=>u.selected).length;n.parent.selected=i===l}else n.children&&(this._setChildrenSelectedState(n.children,!0),this._removeChildren(n),this._selected=r&&this._activeChildren(n)?[...this._selected.filter(i=>i.parent!==n),n]:[...this._selected,...n.children.filter(i=>!i.disabled)])}unselect(n,t){if(this._selected=this._selected.filter(r=>r!==n),n.selected=!1,t)if(n.parent&&n.parent.selected){const r=n.parent.children;this._removeParent(n.parent),this._removeChildren(n.parent),this._selected.push(...r.filter(i=>i!==n&&!i.disabled)),n.parent.selected=!1}else n.children&&(this._setChildrenSelectedState(n.children,!1),this._removeChildren(n))}clear(n){this._selected=n?this._selected.filter(t=>t.disabled):[]}_setChildrenSelectedState(n,t){for(const r of n)r.disabled||(r.selected=t)}_removeChildren(n){this._selected=[...this._selected.filter(t=>t.parent!==n),...n.children.filter(t=>t.parent===n&&t.disabled&&t.selected)]}_removeParent(n){this._selected=this._selected.filter(t=>t!==n)}_activeChildren(n){return n.children.every(t=>!t.disabled||t.selected)}}let nye=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({providers:[{provide:TH,useValue:eye}],imports:[Tz]})}return e})();const l1=e=>({"is-invalid":e});function rye(e,n){if(1&e&&(P(0,"option",78),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),Zn(" ",t," ")}}function iye(e,n){1&e&&Rt(0,"br")}function sye(e,n){if(1&e&&(P(0,"div",79),U(1),O()),2&e){const t=Ge();W(),Zn(" ",t.successMessage," ")}}function oye(e,n){if(1&e&&(P(0,"div",83),U(1),Rt(2,"button",84),O()),2&e){const t=Ge(2);W(),Zn(" ",t.messageAlegra," ")}}function aye(e,n){if(1&e&&(P(0,"div",85),U(1),Rt(2,"button",84),O()),2&e){const t=Ge(2);W(),Zn(" ",t.messageAlegra," ")}}function lye(e,n){if(1&e&&(P(0,"div",80),gt(1,oye,3,1,"div",81)(2,aye,3,1,"div",82),O()),2&e){const t=Ge();W(),Oe("ngIf","201"==t.statusCodeAlegra),W(),Oe("ngIf","201"!=t.statusCodeAlegra)}}function cye(e,n){if(1&e&&(P(0,"span"),U(1),O()),2&e){const t=Ge();W(),tt(t.sortDirection)}}function uye(e,n){if(1&e&&(P(0,"span"),U(1),O()),2&e){const t=Ge();W(),tt(t.sortDirection)}}function dye(e,n){if(1&e&&(P(0,"span"),U(1),O()),2&e){const t=Ge();W(),tt(t.sortDirection)}}function hye(e,n){if(1&e&&(P(0,"span"),U(1),O()),2&e){const t=Ge();W(),tt(t.sortDirection)}}function fye(e,n){if(1&e&&(P(0,"span"),U(1),O()),2&e){const t=Ge();W(),tt(t.sortDirection)}}function pye(e,n){if(1&e&&(P(0,"span"),U(1),O()),2&e){const t=Ge();W(),tt(t.sortDirection)}}function mye(e,n){if(1&e&&(P(0,"span"),U(1),O()),2&e){const t=Ge();W(),tt(t.sortDirection)}}function gye(e,n){if(1&e){const t=lr();P(0,"span",91),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().openEditModal(i,"update"))}),Rt(1,"i",92),O()}}function _ye(e,n){if(1&e){const t=lr();P(0,"div",2)(1,"span",93),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().get_invoice(i.order_number))}),Rt(2,"i",94),O()()}}function yye(e,n){if(1&e){const t=lr();P(0,"div",2)(1,"span",95),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().delete_order(i.id))}),Rt(2,"i",96),O()()}}function vye(e,n){if(1&e){const t=lr();P(0,"div",97),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().getEvidence(i.order_number))}),P(1,"span",98),Rt(2,"i",99),O()()}}function xye(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td"),U(8),O(),P(9,"td"),U(10),O(),P(11,"td"),U(12),zn(13,"date"),O(),P(14,"td"),U(15),zn(16,"currency"),O(),P(17,"td"),U(18),O(),P(19,"td")(20,"div",31)(21,"div",2),gt(22,gye,2,0,"span",86),O(),P(23,"div",2)(24,"span",87),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().openPdfModal(i.id,"unique"))}),Rt(25,"i",88),O()(),gt(26,_ye,3,0,"div",89)(27,yye,3,0,"div",89)(28,vye,3,0,"div",90),O()()()}if(2&e){const t=n.$implicit;W(2),tt(t.order_number),W(2),tt(t.customer_email),W(2),tt(t.customer_phone),W(2),tt(t.customer_documentNumber),W(2),tt(t.customer_name),W(2),tt(fs(13,12,t.delivery_date,"yyyy-MM-dd")),W(3),tt(vc(16,15,t.total)),W(3),tt(t.status),W(4),Oe("ngIf","Creada"==t.status),W(4),Oe("ngIf","000"!=t.alegra_id),W(),Oe("ngIf","Creada"==t.status),W(),Oe("ngIf","000"!=t.alegra_id)}}function bye(e,n){if(1&e&&(P(0,"option",78),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function wye(e,n){if(1&e&&(P(0,"option",78),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function Tye(e,n){if(1&e&&(P(0,"option",78),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function Eye(e,n){if(1&e&&(P(0,"option",78),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function Cye(e,n){if(1&e&&(P(0,"option",78),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function Sye(e,n){if(1&e&&(P(0,"option",78),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function Dye(e,n){if(1&e&&(P(0,"option",78),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function Mye(e,n){if(1&e){const t=lr();P(0,"tr")(1,"ng-select",100),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.id,i)||(l.id=i),zt(i)}),ct("change",function(){const i=Bt(t).$implicit;return zt(Ge().onProductSelect(i))}),O(),P(2,"td")(3,"input",101),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.sku,i)||(l.sku=i),zt(i)}),O()(),P(4,"td")(5,"input",102),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.price_sale,i)||(l.price_sale=i),zt(i)}),O()(),P(6,"td")(7,"input",102),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.quantity,i)||(l.quantity=i),zt(i)}),O()(),P(8,"td")(9,"input",103),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.iva,i)||(l.iva=i),zt(i)}),O()(),P(10,"td")(11,"input",102),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.iva_value,i)||(l.iva_value=i),zt(i)}),O()(),P(12,"td")(13,"button",104),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().removeProduct(i))}),Rt(14,"i",105),O()()()}if(2&e){const t=n.$implicit,r=Ge();W(),xI("placeholder",t.name),Oe("items",r.products)("searchable",!0),Ct("ngModel",t.id),W(2),Ct("ngModel",t.sku),W(2),Ct("ngModel",t.price_sale),W(2),Ct("ngModel",t.quantity),W(2),Ct("ngModel",t.iva),W(2),Ct("ngModel",t.iva_value)}}function Aye(e,n){1&e&&Rt(0,"iframe",106),2&e&&Oe("src",Ge().evidence,Sf)}function Iye(e,n){1&e&&(P(0,"h1"),U(1," Sin evidencia registrada"),O())}let kye=(()=>{class e{constructor(t,r,i,l,u,g,x,E,D){this.orderService=t,this.router=r,this.productService=i,this.clienteService=l,this.sanitizer=u,this.alegraService=g,this.datePipe=x,this.wooService=E,this.routeService=D,this.searchText="",this.today=new Date,this.yyyy=this.today.getFullYear(),this.mm=String(this.today.getMonth()+1).padStart(2,"0"),this.dd=String(this.today.getDate()).padStart(2,"0"),this.searchDate_start=`${this.yyyy}-${this.mm}-${this.dd}`,this.searchDate_end=`${this.yyyy}-${this.mm}-${this.dd}`,this.searchDate=`${this.yyyy}-${this.mm}-${this.dd}`,this.searchStartDate=`${this.yyyy}-${this.mm}-${this.dd}`,this.searchEndDate=`${this.yyyy}-${this.mm}-${this.dd}`,this.searchStatus="Estado",this.statusOrders=["Estado","Creada","Por entregar","Pagada","Pendiente de pago"],this.source=["P\xe1gina","Aplicaci\xf3n","Web"],this.driver=["Carlos","Diago","Jhony","Sebas","Cata"],this.seller=["Cata","Diago","Migue","Auto"],this.order={},this.product={},this.customers=[],this.actionType="",this.successMessage="",this.failedMessage="",this.documentTypes=[],this.paymentMethods=[],this.deliverySlots=[],this.products=[],this.selectedsku="",this.messageAlegra="",this.statusCodeAlegra="",this.sortColumn="",this.sortDirection="asc",this.orderNumbertosync="",this.order_numer_sug=Math.floor(1e4+9e4*Math.random()).toString(),this.evidence="",this.titleEvidence="",this.typeEvidence="",this.showHeaderOrder=!0,this.institucion=!1}ngOnInit(){this.checkIfLoggedIn()?(this.getOrders("date"),this.orderService.getConfig().subscribe(r=>{this.documentTypes=r.document_type,this.paymentMethods=r.payments_method,this.deliverySlots=r.delivery_slots}),this.obtenerProductos(),this.getCustomers()):this.router.navigate(["/login"])}toggleHeaderOrder(){this.showHeaderOrder=!this.showHeaderOrder}checkIfLoggedIn(){return!!localStorage.getItem("token")}getOrders(t){this.orders=[],"date"==t?this.orderService.getOrders(this.datePipe.transform(this.searchStartDate,"yyyy-MM-dd"),this.datePipe.transform(this.searchEndDate,"yyyy-MM-dd")).subscribe(r=>{this.orders=r,this.filteredOrders=r,this.filterOrders()}):this.orderService.getOrdersByStatus(this.searchStatus).subscribe(r=>{this.orders=r,this.filteredOrders=r,this.filterOrders()})}filterOrders(){this.filteredOrders=""!==this.searchText.trim()?this.orders?.filter(t=>["order_number","customer_email","customer_phone","customer_documentNumber","customer_name","delivery_date","status"].some(r=>t[r]?.toLowerCase().includes(this.searchText.toLowerCase()))):this.orders}openEditModal(t,r){this.order=t,this.actionType=r,0===Object.keys(t).length&&(this.order.order_number=this.order_numer_sug)}updated_order(){const t=new Date,r=t.getFullYear(),i=t.getMonth()+1,l=t.getDate(),u=t.getHours(),g=t.getMinutes(),x=t.getSeconds(),E=`${r}-${i.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")} ${u.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`;this.order.total=parseFloat(this.order.products.reduce((D,R)=>D+R.quantity*R.price_sale,0)),this.order.updated_at=E,this.orderService.updateOrder(this.order.id,this.order).subscribe(D=>{}),this.getOrders("date")}created_order(){const t=new Date,r=t.getFullYear(),i=t.getMonth()+1,l=t.getDate(),u=t.getHours(),g=t.getMinutes(),x=t.getSeconds(),E=`${r}-${i.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")} ${u.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`;this.order.created_at=E,this.order.updated_at=E,this.order.total=parseFloat(this.order.products.reduce((D,R)=>D+R.quantity*R.price_sale,0)),this.orderService.createOrder(this.order).subscribe(D=>{}),this.getOrders("date")}saveOrder(){"update"===this.actionType?(this.updated_order(),this.getOrders("date")):"new"===this.actionType&&(this.created_order(),this.getOrders("date"))}removeProduct(t){const r=this.order.products.indexOf(t);-1!==r&&this.order.products.splice(r,1)}addProduct(){this.order.products||(this.order.products=[]),this.order.products.push({sku:"",name:"",price_sale:0,quantity:1,iva:!1,iva_value:0,unit:"",category:""})}obtenerProductos(){this.productService.getProducts().subscribe(t=>{this.products=t})}openPdfModal(t,r){this.pdfData=this.sanitizer.bypassSecurityTrustResourceUrl("unique"==r?"https://app.buyfrescapp.com:5000/api/order/generate_pdf/"+t:"https://app.buyfrescapp.com:5000/api/reports/picking/"+this.searchStartDate+"/"+this.searchEndDate)}getCustomers(){this.clienteService.getClientes().subscribe(t=>{this.customers=t.map(r=>({...r,customLabel:`${r.name} (${r.address||"sin direcci\xf3n"})`}))})}filteredCustomers(){return this.searchText?this.customers.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())):this.customers}onCustomerSelect(){const t=this.customers.find(r=>r.id===this.selectedCustomerId);t&&(this.order.customer_name=t.name,this.order.customer_email=t.email,this.order.customer_phone=t.phone,this.order.customer_documentNumber=t.document,this.order.customer_documentType=t.document_type,this.order.deliveryAddress=t.address)}onProductSelect(t){const r=this.products.find(i=>i.id===t.id);r&&(t.name=r.name,t.sku=r.sku,t.price_sale=r.price_sale,t.iva=r.iva,t.iva_value=r.iva_value,t.unit=r.unit,t.category=r.category)}sync_allegra(t){this.alegraService.send_invoice(t).subscribe(r=>{"201"==r.status?(this.statusCodeAlegra="201",this.messageAlegra=r.message||"Factura creada exitosamente."):this.messageAlegra=r.error?.message||"Ocurri\xf3 un error",this.getOrders("date")},r=>{this.statusCodeAlegra=r.status.toString(),this.messageAlegra=r.error?.message||"Ocurri\xf3 un error",this.getOrders("date")})}get_invoice(t){this.alegraService.get_invoice(t).subscribe(r=>{this.facturaData=this.sanitizer.bypassSecurityTrustResourceUrl(r)})}delete_order(t){this.orderService.deleteOrder(t).subscribe(r=>{this.getOrders("date")})}sort(t){!this.filteredOrders||0===this.filteredOrders.length||(this.sortColumn===t?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),this.filteredOrders.sort((r,i)=>{const l=r[this.sortColumn],u=i[this.sortColumn];return null==l?"asc"===this.sortDirection?1:-1:null==u||l<u?"asc"===this.sortDirection?-1:1:l>u?"asc"===this.sortDirection?1:-1:0}))}sendSyncOrder(t){this.wooService.get_order(t).subscribe(r=>{r?(this.successMessage=r.message||"Orden sincronizada correctamente!",this.getOrders("date")):(this.failedMessage=r.message||"Fall\xf3 la sincronizac\xf3n de la orden!",this.getOrders("date"))})}getEvidence(t){this.routeService.getStopNumber(t).subscribe(r=>{if(this.titleEvidence=r.payment_method,null==r.evidence)this.titleEvidence="Sin evidencia";else{let l;switch(this.evidence=this.sanitizer.bypassSecurityTrustResourceUrl("https://app.buyfrescapp.com:5000/api/route/route/evidence/"+r.evidence),r.evidence.split(".").pop().toLowerCase()){case"pdf":l="application/pdf";break;case"jpg":case"jpeg":l="image/jpeg";break;case"png":l="image/png";break;case"gif":l="image/gif";break;case"txt":l="text/plain";break;case"html":l="text/html";break;default:l="application/octet-stream"}this.typeEvidence=l}})}camposCompletos(){return!!(this.order?.delivery_date&&this.order?.deliverySlot&&this.order?.paymentMethod&&this.order?.deliveryAddress&&this.order?.status&&this.order?.seller_name&&this.order?.source&&this.order?.driver_name)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(N2),ut(ws),ut(v4),ut(U4),ut(tk),ut(V4),ut(Jw),ut(D0e),ut(SO))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-orders"]],decls:244,vars:82,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus-circle","fa-lg"],[1,"col-3"],["type","text","placeholder","Buscar orden...",1,"form-control",3,"ngModelChange","keyup","ngModel"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"form-control",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","N\xfamero de la p\xe1gina",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-refresh","fa-lg"],["data-bs-toggle","modal","data-bs-target","#pdfModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"fas","fa-file-pdf","fa-lg"],[4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["class","position-fixed top-0 end-0 p-3","style","z-index: 11",4,"ngIf"],[1,"table"],[3,"click"],[4,"ngFor","ngForOf"],["id","editOrderModal","tabindex","-1","role","dialog",1,"modal","fade","bd-example-modal-lg"],["role","document",1,"modal-dialog","modal-dialog-centered",2,"max-width","80%"],[1,"modal-content"],[1,"modal-header","d-flex","justify-content-between","align-items-center"],[1,"modal-title","m-0"],["type","button",1,"btn","btn-sm","btn-outline-secondary","ms-2",3,"click"],[1,"bi"],[1,"modal-body"],[1,"container-fluid"],["id","headerOrder"],[1,"row"],[1,"col-6"],[1,"form-group"],["for","documentType"],["bindLabel","customLabel","bindValue","id","placeholder","Escribe para buscar...",3,"ngModelChange","change","items","searchable","ngModel"],["for","order_number"],["type","text","id","order_number","name","order_number",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_email"],["type","email","id","customer_email","name","customer_email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_name"],["type","text","id","customer_name","name","customer_name","required","",1,"form-control",3,"ngModelChange","ngModel"],["id","documentType","name","documentType",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_documentNumber"],["type","text","id","customer_documentNumber","name","customer_documentNumber",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_phone"],["type","text","id","customer_phone","name","customer_phone",1,"form-control",3,"ngModelChange","ngModel"],["for","total"],["type","number","id","total","name","total",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","delivery_date"],["type","date","id","delivery_date","name","delivery_date",1,"form-control",3,"ngModelChange","ngModel","ngClass"],["for","deliverySlot"],["id","deliverySlot","name","deliverySlot",1,"form-control",3,"ngModelChange","ngModel","ngClass"],["for","paymentMethod"],["id","paymentMethod","name","paymentMethod",1,"form-control",3,"ngModelChange","ngModel","ngClass"],["for","payment_date"],["type","date","id","payment_date","name","payment_date",1,"form-control",3,"ngModelChange","ngModel"],["for","deliveryAddress"],["type","text","id","deliveryAddress","name","deliveryAddress",1,"form-control",3,"ngModelChange","ngModel","ngClass"],["for","deliveryAddressDetails"],["type","text","id","deliveryAddressDetails","name","deliveryAddressDetails",1,"form-control",3,"ngModelChange","ngModel"],["for","status"],["id","status","name","status",1,"form-control",3,"ngModelChange","ngModel","ngClass"],[1,"col-12"],[1,"col-4"],["type","button",1,"btn","btn-primary",3,"click"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["id","pdfModal","tabindex","-1","role","dialog","aria-labelledby","pdfModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-header"],["id","pdfModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["type","application/pdf","width","100%","height","600px",3,"src"],["id","facturaModal","tabindex","-1","role","dialog","aria-labelledby","facturaLabel","aria-hidden","true",1,"modal","fade"],["id","evidenciaModal","tabindex","-1","role","dialog","aria-labelledby","evidenciaLabel","aria-hidden","true",1,"modal","fade"],["type","{this.typeEvidence}","width","100%","height","600px",3,"src",4,"ngIf"],[3,"value"],["role","alert",1,"alert","alert-success"],[1,"position-fixed","top-0","end-0","p-3",2,"z-index","11"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],["style","cursor: pointer;","data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",3,"click",4,"ngIf"],["data-bs-toggle","modal","data-bs-target","#pdfModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-danger"],["class","col-auto",4,"ngIf"],["class","col-auto",3,"click",4,"ngIf"],["data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-pencil-alt","fa-lg","text-primary"],["data-bs-toggle","modal","data-bs-target","#facturaModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-primary"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-trash","fa-lg","text-danger"],[1,"col-auto",3,"click"],["data-bs-toggle","modal","data-bs-target","#evidenciaModal","data-bs-dismiss","modal",2,"cursor","pointer"],[1,"fas","fa-eye","fa-lg","text-warning"],["bindLabel","name","bindValue","id",3,"ngModelChange","change","items","searchable","placeholder","ngModel"],["type","text",1,"form-control",3,"ngModelChange","ngModel"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],["type","checkbox",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"],["type","{this.typeEvidence}","width","100%","height","600px",3,"src"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),ct("click",function(){return i.openEditModal({},"new")}),Rt(4,"i",4),U(5," Nueva Orden"),O()(),P(6,"div",5)(7,"input",6),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterOrders()}),O()(),P(8,"div",2)(9,"input",7),St("ngModelChange",function(u){return Dt(i.searchStartDate,u)||(i.searchStartDate=u),u}),ct("change",function(){return i.getOrders("date")}),O()(),P(10,"div",2)(11,"input",7),St("ngModelChange",function(u){return Dt(i.searchEndDate,u)||(i.searchEndDate=u),u}),ct("change",function(){return i.getOrders("date")}),O()(),P(12,"div",2)(13,"select",8),St("ngModelChange",function(u){return Dt(i.searchStatus,u)||(i.searchStatus=u),u}),ct("change",function(){return i.getOrders("status")}),gt(14,rye,2,2,"option",9),O()(),P(15,"div",2)(16,"input",10),St("ngModelChange",function(u){return Dt(i.orderNumbertosync,u)||(i.orderNumbertosync=u),u}),O()(),P(17,"div",2)(18,"button",11),ct("click",function(){return i.sendSyncOrder(i.orderNumbertosync)}),Rt(19,"i",12),U(20," Sincronizar Orden"),O()(),P(21,"div",2)(22,"button",13),ct("click",function(){return i.openPdfModal(i.order.id,"list")}),Rt(23,"i",14),U(24," Descargar lista "),O()()(),gt(25,iye,1,0,"br",15)(26,sye,2,1,"div",16)(27,lye,3,2,"div",17),Rt(28,"br"),P(29,"table",18)(30,"thead")(31,"tr")(32,"th",19),ct("click",function(){return i.sort("order_number")}),U(33,"N\xfamero de Orden "),gt(34,cye,2,1,"span",15),O(),P(35,"th",19),ct("click",function(){return i.sort("customer_email")}),U(36,"Email del Cliente "),gt(37,uye,2,1,"span",15),O(),P(38,"th",19),ct("click",function(){return i.sort("customer_phone")}),U(39,"Tel\xe9fono del Cliente "),gt(40,dye,2,1,"span",15),O(),P(41,"th",19),ct("click",function(){return i.sort("customer_documentNumber")}),U(42,"Documento del Cliente "),gt(43,hye,2,1,"span",15),O(),P(44,"th",19),ct("click",function(){return i.sort("customer_name")}),U(45,"Nombre del Cliente "),gt(46,fye,2,1,"span",15),O(),P(47,"th",19),ct("click",function(){return i.sort("delivery_date")}),U(48,"Fecha de Entrega "),gt(49,pye,2,1,"span",15),O(),P(50,"th"),U(51,"total"),O(),P(52,"th",19),ct("click",function(){return i.sort("status")}),U(53,"Estado "),gt(54,mye,2,1,"span",15),O(),P(55,"th"),U(56,"Acciones"),O()()(),P(57,"tbody"),gt(58,xye,29,17,"tr",20),O()()(),P(59,"div",21)(60,"div",22)(61,"div",23)(62,"div",24)(63,"h5",25),U(64,"Editar Orden"),O(),P(65,"button",26),ct("click",function(){return i.toggleHeaderOrder()}),Rt(66,"i",27),O()(),P(67,"div",28)(68,"div",29)(69,"div",30)(70,"div",31)(71,"div",32)(72,"div",33)(73,"label",34),U(74,"Cliente:"),O(),P(75,"ng-select",35),St("ngModelChange",function(u){return Dt(i.selectedCustomerId,u)||(i.selectedCustomerId=u),u}),ct("change",function(){return i.onCustomerSelect()}),O()()(),P(76,"div",32)(77,"div",33)(78,"label",36),U(79,"N\xfamero de Orden:"),O(),P(80,"input",37),St("ngModelChange",function(u){return Dt(i.order.order_number,u)||(i.order.order_number=u),u}),O()()()(),P(81,"div",31)(82,"div",32)(83,"div",33)(84,"label",38),U(85,"Email del Cliente:"),O(),P(86,"input",39),St("ngModelChange",function(u){return Dt(i.order.customer_email,u)||(i.order.customer_email=u),u}),O()()(),P(87,"div",32)(88,"div",33)(89,"label",40),U(90,"Nombre del Cliente:"),O(),P(91,"input",41),St("ngModelChange",function(u){return Dt(i.order.customer_name,u)||(i.order.customer_name=u),u}),O()()()(),P(92,"div",31)(93,"div",32)(94,"div",33)(95,"label",34),U(96,"Tipo de Documento:"),O(),P(97,"select",42),St("ngModelChange",function(u){return Dt(i.order.customer_documentType,u)||(i.order.customer_documentType=u),u}),gt(98,bye,2,2,"option",9),O()()(),P(99,"div",32)(100,"div",33)(101,"label",43),U(102,"N\xfamero de Documento del Cliente:"),O(),P(103,"input",44),St("ngModelChange",function(u){return Dt(i.order.customer_documentNumber,u)||(i.order.customer_documentNumber=u),u}),O()()()(),P(104,"div",31)(105,"div",32)(106,"div",33)(107,"label",45),U(108,"Tel\xe9fono del Cliente:"),O(),P(109,"input",46),St("ngModelChange",function(u){return Dt(i.order.customer_phone,u)||(i.order.customer_phone=u),u}),O()()(),P(110,"div",32)(111,"div",33)(112,"label",47),U(113,"Total:"),O(),P(114,"input",48),St("ngModelChange",function(u){return Dt(i.order.total,u)||(i.order.total=u),u}),O()()()(),P(115,"div",31)(116,"div",32)(117,"div",33)(118,"label",49),U(119,"Fecha de Entrega:"),O(),P(120,"input",50),St("ngModelChange",function(u){return Dt(i.order.delivery_date,u)||(i.order.delivery_date=u),u}),O()()(),P(121,"div",32)(122,"div",33)(123,"label",51),U(124,"Horario de Entrega:"),O(),P(125,"select",52),St("ngModelChange",function(u){return Dt(i.order.deliverySlot,u)||(i.order.deliverySlot=u),u}),gt(126,wye,2,2,"option",9),O()()()(),Rt(127,"div",31),P(128,"div",31)(129,"div",32)(130,"div",33)(131,"label",53),U(132,"M\xe9todo de Pago:"),O(),P(133,"select",54),St("ngModelChange",function(u){return Dt(i.order.paymentMethod,u)||(i.order.paymentMethod=u),u}),gt(134,Tye,2,2,"option",9),O()()(),P(135,"div",32)(136,"div",33)(137,"label",55),U(138,"Fecha de Pago:"),O(),P(139,"input",56),St("ngModelChange",function(u){return Dt(i.order.payment_date,u)||(i.order.payment_date=u),u}),O()()()(),P(140,"div",31)(141,"div",32)(142,"div",33)(143,"label",57),U(144,"Direcci\xf3n de Entrega:"),O(),P(145,"input",58),St("ngModelChange",function(u){return Dt(i.order.deliveryAddress,u)||(i.order.deliveryAddress=u),u}),O()()(),P(146,"div",32)(147,"div",33)(148,"label",59),U(149,"Detalles de la Direcci\xf3n de Entrega:"),O(),P(150,"input",60),St("ngModelChange",function(u){return Dt(i.order.deliveryAddressDetails,u)||(i.order.deliveryAddressDetails=u),u}),O()()()(),P(151,"div",31)(152,"div",32)(153,"div",33)(154,"label",61),U(155,"Estado:"),O(),P(156,"select",62),St("ngModelChange",function(u){return Dt(i.order.status,u)||(i.order.status=u),u}),gt(157,Eye,2,2,"option",9),O()()(),P(158,"div",32)(159,"div",33)(160,"label",61),U(161,"Vendedor:"),O(),P(162,"select",62),St("ngModelChange",function(u){return Dt(i.order.seller_name,u)||(i.order.seller_name=u),u}),gt(163,Cye,2,2,"option",9),O()()()(),P(164,"div",31)(165,"div",32)(166,"div",33)(167,"label",61),U(168,"Fuente:"),O(),P(169,"select",62),St("ngModelChange",function(u){return Dt(i.order.source,u)||(i.order.source=u),u}),gt(170,Sye,2,2,"option",9),O()()(),P(171,"div",32)(172,"div",33)(173,"label",61),U(174,"Conductor:"),O(),P(175,"select",62),St("ngModelChange",function(u){return Dt(i.order.driver_name,u)||(i.order.driver_name=u),u}),gt(176,Dye,2,2,"option",9),O()()()()(),Rt(177,"br")(178,"br"),P(179,"div",31)(180,"div",63)(181,"table",18)(182,"thead")(183,"tr")(184,"th",64),U(185,"Producto"),O(),P(186,"th"),U(187,"sku"),O(),P(188,"th"),U(189,"Precio Venta"),O(),P(190,"th"),U(191,"Cantidad"),O(),P(192,"th"),U(193,"IVA"),O(),P(194,"th"),U(195,"Valor IVA"),O(),P(196,"th"),U(197,"Acciones"),O()()(),P(198,"tbody"),gt(199,Mye,15,9,"tr",20),O()(),P(200,"button",65),ct("click",function(){return i.addProduct()}),U(201,"Agregar Producto"),O()()()()(),P(202,"div",66)(203,"button",67),U(204,"Cerrar"),O(),P(205,"button",68),ct("click",function(){return i.saveOrder()}),U(206,"Guardar Cambios"),O()()()()(),P(207,"div",69)(208,"div",70)(209,"div",23)(210,"div",71)(211,"h5",72),U(212,"Remisi\xf3n"),O(),Rt(213,"button",73),O(),P(214,"div",28),Rt(215,"iframe",74),O(),P(216,"div",66)(217,"button",67),U(218,"Cerrar"),O()()()()(),P(219,"div",75)(220,"div",70)(221,"div",23)(222,"div",71)(223,"h5",72),U(224,"Factura"),O(),Rt(225,"button",73),O(),P(226,"div",28),Rt(227,"iframe",74),O(),P(228,"div",66)(229,"button",67),U(230,"Cerrar"),O()()()()(),P(231,"div",76)(232,"div",70)(233,"div",23)(234,"div",71)(235,"h5",72),U(236),O(),Rt(237,"button",73),O(),P(238,"div",28),gt(239,Aye,1,1,"iframe",77)(240,Iye,2,0,"h1",15),O(),P(241,"div",66)(242,"button",67),U(243,"Cerrar"),O()()()()()),2&r&&(W(7),Ct("ngModel",i.searchText),W(2),Ct("ngModel",i.searchStartDate),W(2),Ct("ngModel",i.searchEndDate),W(2),Ct("ngModel",i.searchStatus),W(),Oe("ngForOf",i.statusOrders),W(2),Ct("ngModel",i.orderNumbertosync),W(9),Oe("ngIf",i.successMessage),W(),Oe("ngIf",i.successMessage),W(),Oe("ngIf",i.statusCodeAlegra),W(7),Oe("ngIf","order_number"===i.sortColumn),W(3),Oe("ngIf","customer_email"===i.sortColumn),W(3),Oe("ngIf","customer_phone"===i.sortColumn),W(3),Oe("ngIf","customer_documentNumber"===i.sortColumn),W(3),Oe("ngIf","customer_name"===i.sortColumn),W(3),Oe("ngIf","delivery_date"===i.sortColumn),W(5),Oe("ngIf","status"===i.sortColumn),W(4),Oe("ngForOf",i.filteredOrders),W(8),Xi("bi-chevron-down",!i.showHeaderOrder)("bi-chevron-up",i.showHeaderOrder),W(3),Xi("d-none",!i.showHeaderOrder),W(6),Oe("items",i.customers)("searchable",!0),Ct("ngModel",i.selectedCustomerId),W(5),Ct("ngModel",i.order.order_number),W(6),Ct("ngModel",i.order.customer_email),W(5),Ct("ngModel",i.order.customer_name),W(6),Ct("ngModel",i.order.customer_documentType),W(),Oe("ngForOf",i.documentTypes),W(5),Ct("ngModel",i.order.customer_documentNumber),W(6),Ct("ngModel",i.order.customer_phone),W(5),Ct("ngModel",i.order.total),Oe("disabled",!0),W(6),Ct("ngModel",i.order.delivery_date),Oe("ngClass",ba(66,l1,""===i.order.delivery_date)),W(5),Ct("ngModel",i.order.deliverySlot),Oe("ngClass",ba(68,l1,""===i.order.deliverySlot)),W(),Oe("ngForOf",i.deliverySlots),W(7),Ct("ngModel",i.order.paymentMethod),Oe("ngClass",ba(70,l1,""===i.order.paymentMethod)),W(),Oe("ngForOf",i.paymentMethods),W(5),Ct("ngModel",i.order.payment_date),W(6),Ct("ngModel",i.order.deliveryAddress),Oe("ngClass",ba(72,l1,""===i.order.deliveryAddress)),W(5),Ct("ngModel",i.order.deliveryAddressDetails),W(6),Ct("ngModel",i.order.status),Oe("ngClass",ba(74,l1,""===i.order.status)),W(),Oe("ngForOf",i.statusOrders),W(5),Ct("ngModel",i.order.seller_name),Oe("ngClass",ba(76,l1,""===i.order.seller_name)),W(),Oe("ngForOf",i.seller),W(6),Ct("ngModel",i.order.source),Oe("ngClass",ba(78,l1,""===i.order.source)),W(),Oe("ngForOf",i.source),W(5),Ct("ngModel",i.order.driver_name),Oe("ngClass",ba(80,l1,""===i.order.driver_name)),W(),Oe("ngForOf",i.driver),W(23),Oe("ngForOf",i.order.products),W(6),Oe("disabled",!i.camposCompletos()),W(10),Oe("src",i.pdfData,Sf),W(12),Oe("src",i.facturaData,Sf),W(9),Zn("Evidencia de pago en ",i.titleEvidence,""),W(3),Oe("ngIf",""!=i.evidence),W(),Oe("ngIf",""==i.evidence))},dependencies:[Zp,No,So,yd,vd,Hs,Nh,hO,eu,so,a1,oo,EH,ld,Jw]})}return e})(),gD=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/",this._username=""}login(t,r){return this.http.post(this.baseUrl+"api/user/login_admin",{user:t,password:r}).pipe(pe(i=>(i.token&&(localStorage.setItem("token",i.token),localStorage.setItem("role",i.user_data.role)),i)))}logout(t){const r={headers:new Cu({Authorization:`Bearer ${t}`})};return this.http.post(this.baseUrl+"api/user/logout",{},r)}checkToken(t){const r={headers:new Cu({Authorization:`Bearer ${t}`})};return this.http.post(this.baseUrl+"api/user/check_token",{},r)}changePassword(t,r){return this.http.post(this.baseUrl+"api/user/restore",{password:r,user_id:t})}deleteAccount(t,r){return this.http.post(this.baseUrl+"api/user/delete_account",{password:r,user_email:t})}setUsername(t){this._username=t}getUsername(){return this._username}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Oye(e,n){if(1&e&&(P(0,"div",10),U(1),O()),2&e){const t=Ge();W(),Zn(" ",t.error," ")}}let Pye=(()=>{class e{constructor(t,r){this.authService=t,this.router=r,this.username="",this.password="",this.error="",this.flag=!1}login(){if(""===this.username||""===this.password)return this.flag=!0,void(this.error="Por favor, ingrese nombre de usuario y contrase\xf1a.");this.authService.login(this.username,this.password).subscribe(t=>{localStorage.setItem("username",this.username),localStorage.setItem("token",t?.token||"");const r=t?.user_data?.role;Array.isArray(r)?localStorage.setItem("role",JSON.stringify(r)):localStorage.setItem("role",JSON.stringify([])),this.router.navigate(["/home"])},t=>{this.flag=!0,this.error="Nombre de usuario o contrase\xf1a incorrectos."})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(gD),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-login"]],decls:19,vars:3,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-12","text-center"],["src","assets\\banner.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"container-fluid"],[1,"form-group"],["type","text","id","username","placeholder","Usuario",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-primary","btn-block","btn-lg",3,"click"],["class","alert alert-danger mt-3","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-danger","mt-3"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2),Rt(3,"img",3),O(),P(4,"div",2)(5,"h1"),U(6,"Ingreso al Admin"),O(),Rt(7,"br"),P(8,"div",4)(9,"div",5)(10,"input",6),St("ngModelChange",function(u){return Dt(i.username,u)||(i.username=u),u}),O()(),Rt(11,"br"),P(12,"div",5)(13,"input",7),St("ngModelChange",function(u){return Dt(i.password,u)||(i.password=u),u}),O()(),Rt(14,"br"),P(15,"button",8),ct("click",function(){return i.login()}),U(16,"Iniciar Sesi\xf3n"),O(),Rt(17,"br"),gt(18,Oye,2,1,"div",9),O()()()()),2&r&&(W(10),Ct("ngModel",i.username),W(3),Ct("ngModel",i.password),W(5),Oe("ngIf",i.flag))},dependencies:[So,Hs,so,oo]})}return e})();function Rye(e,n){1&e&&(P(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),U(4,"Productos"),O(),P(5,"p",7),U(6,"Administrar productos"),O(),P(7,"button",8),U(8,"Ver productos"),O()()()())}function Nye(e,n){1&e&&(P(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),U(4,"\xd3rdenes"),O(),P(5,"p",7),U(6,"Administrar \xf3rdenes"),O(),P(7,"button",9),U(8,"Ver \xf3rdenes"),O()()()())}function Fye(e,n){1&e&&(P(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),U(4,"Clientes"),O(),P(5,"p",7),U(6,"Administrar clientes"),O(),P(7,"button",10),U(8,"Ver clientes"),O()()()())}function Lye(e,n){1&e&&(P(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),U(4,"Reportes"),O(),P(5,"p",7),U(6,"Ver reportes"),O(),P(7,"button",11),U(8,"Ver reportes"),O()()()())}function Bye(e,n){1&e&&(P(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),U(4,"CRM"),O(),P(5,"p",7),U(6,"Gestionar nuevos Clientes"),O(),P(7,"button",12),U(8,"CRM"),O()()()())}let zye=(()=>{class e{constructor(t,r){this.authService=t,this.router=r,this.isLoggedIn=!1,this.role=""}ngOnInit(){this.checkToken(),this.role=localStorage.getItem("role")}checkToken(){const t=localStorage.getItem("token");t?this.authService.checkToken(t).subscribe(()=>{this.isLoggedIn=!0},r=>{console.error("Error al verificar el token:",r),this.isLoggedIn=!1,this.router.navigate(["/login"])}):(this.isLoggedIn=!1,this.router.navigate(["/login"]))}redirectToLogin(){this.router.navigate(["/login"])}static#e=this.\u0275fac=function(r){return new(r||e)(ut(gD),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-home"]],decls:7,vars:5,consts:[[1,"container","mt-5"],[1,"row"],["class","col-md-3 mb-4",4,"ngIf"],[1,"col-md-3","mb-4"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["routerLink","/productos",1,"btn","btn-primary","btn-block"],["routerLink","/ordenes",1,"btn","btn-primary","btn-block"],["routerLink","/clientes",1,"btn","btn-primary","btn-block"],["routerLink","/reports",1,"btn","btn-primary","btn-block"],["routerLink","/crm",1,"btn","btn-primary","btn-block"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1),gt(2,Rye,9,0,"div",2)(3,Nye,9,0,"div",2)(4,Fye,9,0,"div",2)(5,Lye,9,0,"div",2)(6,Bye,9,0,"div",2),O()()),2&r&&(W(2),Oe("ngIf","administrador"==i.role),W(),Oe("ngIf","administrador"==i.role),W(),Oe("ngIf","administrador"==i.role),W(),Oe("ngIf","administrador"==i.role),W(),Oe("ngIf","administrador"==i.role||"comercial"==i.role))},dependencies:[So,H0]})}return e})(),Uye=(()=>{class e{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-reports"]],decls:38,vars:0,consts:[[1,"container","mt-5"],[1,"row"],[1,"col-md-3","mb-4"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["routerLink","/ue",1,"btn","btn-primary","btn-block"],["href","hhttps://lookerstudio.google.com/s/v4vfRS28WbU","target","_blank",1,"btn","btn-primary","btn-block"],["href","https://lookerstudio.google.com/s/o4_RMjL0HI0","target","_blank",1,"btn","btn-primary","btn-block"],["href","https://lookerstudio.google.com/s/mqG0GRi2nII","target","_blank",1,"btn","btn-primary","btn-block"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),U(6,"Unit Economics"),O(),P(7,"p",6),U(8,"Reporte mensual y semanal de los UE."),O(),P(9,"a",7),U(10," Unit Economics Reporte "),O()()()(),P(11,"div",2)(12,"div",3)(13,"div",4)(14,"h5",5),U(15,"Gesti\xf3n de clientes"),O(),P(16,"p",6),U(17,"Comportamiento de compras por cliente y d\xeda de la semana"),O(),P(18,"a",8),U(19," Gesti\xf3n de clientes "),O()()()(),P(20,"div",2)(21,"div",3)(22,"div",4)(23,"h5",5),U(24,"Pron\xf3stico de compras"),O(),P(25,"p",6),U(26,"Reporte de pron\xf3stico para planear compras semanales."),O(),P(27,"a",9),U(28," Pron\xf3stico de compras "),O()()()(),P(29,"div",2)(30,"div",3)(31,"div",4)(32,"h5",5),U(33,"Cash Margin por producto"),O(),P(34,"p",6),U(35,"Reporte para evaluar cada producto."),O(),P(36,"a",10),U(37," Cash Margin "),O()()()()()())},dependencies:[H0]})}return e})();function Vye(e,n){if(1&e&&(P(0,"div",12),U(1),O()),2&e){const t=Ge();W(),tt(t.mensajeError)}}function jye(e,n){if(1&e&&(P(0,"div",13),U(1),O()),2&e){const t=Ge();W(),tt(t.mensajeSuccess)}}let $ye=(()=>{class e{constructor(t,r){this.route=t,this.authService=r,this.password1="",this.password2="",this.mensajeError="",this.mensajeSuccess="",this.user_id=""}ngOnInit(){this.route.params.subscribe(t=>{this.user_id=t.user_id})}restablecer(){this.password1===this.password2?this.user_id?this.authService.changePassword(this.user_id,this.password1).subscribe(()=>{this.mensajeSuccess="Se realiz\xf3 el cambio de contrase\xf1a correctamente, vuelve a intentar ingresar en la app. Gracias."},t=>{this.mensajeError="No se realiz\xf3 el cambio de contrase\xf1a, por favor intentalo m\xe1s tarde o comun\xedcate a nuestro Whatsapp 3115455042"}):this.mensajeError="No se encontr\xf3 el user_id. Por favor intenta nuevamente.":this.mensajeError="Las contrase\xf1as no coinciden."}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Su),ut(gD))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-restore-password"]],decls:18,vars:4,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-auto","text-center"],["src","assets\\banner.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"col-auto"],[1,"container-fluid"],[1,"form-group"],["type","password","id","password1","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password2","placeholder","Confirmar Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn",2,"background-color","#97D700",3,"click"],["class","text-danger",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"text-danger"],[1,"text-success"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2),Rt(3,"img",3),O(),P(4,"div",4)(5,"div",5),Rt(6,"br")(7,"br"),P(8,"div",6)(9,"input",7),St("ngModelChange",function(u){return Dt(i.password1,u)||(i.password1=u),u}),O()(),Rt(10,"br"),P(11,"div",6)(12,"input",8),St("ngModelChange",function(u){return Dt(i.password2,u)||(i.password2=u),u}),O()(),Rt(13,"br"),P(14,"button",9),ct("click",function(){return i.restablecer()}),U(15,"Reestablecer"),O(),gt(16,Vye,2,1,"div",10)(17,jye,2,1,"div",11),O()()()()),2&r&&(W(9),Ct("ngModel",i.password1),W(3),Ct("ngModel",i.password2),W(4),Oe("ngIf",i.mensajeError),W(),Oe("ngIf",i.mensajeSuccess))},dependencies:[So,Hs,so,oo]})}return e})();function Hye(e,n){if(1&e&&(P(0,"div",12),U(1),O()),2&e){const t=Ge();W(),tt(t.mensajeError)}}function Gye(e,n){if(1&e&&(P(0,"div",13),U(1),O()),2&e){const t=Ge();W(),tt(t.mensajeSuccess)}}let Wye=(()=>{class e{constructor(t,r){this.route=t,this.authService=r,this.password="",this.mensajeError="",this.mensajeSuccess="",this.user_email="",this.route.queryParams.subscribe(i=>{this.user_email=i.user_id})}delete(){this.authService.deleteAccount(this.user_email,this.password).subscribe(()=>{this.mensajeSuccess="Se elimin\xf3 la cuenta "+this.user_email+" correctamente"},t=>{this.mensajeError="No se elimin\xf3 correctamente la cuenta, por favor comunicate con nuestro Whatsapp 3115455042"})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Su),ut(gD))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-delete-account"]],decls:18,vars:4,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-auto","text-center"],["src","assets\\banner.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"col-auto"],[1,"container-fluid"],[1,"form-group"],["type","email","id","email","placeholder","Email",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn",2,"background-color","#97D700",3,"click"],["class","text-danger",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"text-danger"],[1,"text-success"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2),Rt(3,"img",3),O(),P(4,"div",4)(5,"div",5),Rt(6,"br")(7,"br"),P(8,"div",6)(9,"input",7),St("ngModelChange",function(u){return Dt(i.user_email,u)||(i.user_email=u),u}),O()(),Rt(10,"br"),P(11,"div",6)(12,"input",8),St("ngModelChange",function(u){return Dt(i.password,u)||(i.password=u),u}),O()(),Rt(13,"br"),P(14,"button",9),ct("click",function(){return i.delete()}),U(15,"Eliminar cuenta"),O(),gt(16,Hye,2,1,"div",10)(17,Gye,2,1,"div",11),O()()()()),2&r&&(W(9),Ct("ngModel",i.user_email),W(3),Ct("ngModel",i.password),W(4),Oe("ngIf",i.mensajeError),W(),Oe("ngIf",i.mensajeSuccess))},dependencies:[So,Hs,so,oo]})}return e})(),CH=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getPurchases(){return this.http.get(this.baseUrl+"api/purchase/purchases/")}getPurchase(t){return this.http.get(this.baseUrl+"api/purchase/purchase/"+t)}updatePurchase(t){return this.http.put(this.baseUrl+"api/purchase/purchase",t)}deletePurchase(t){return this.http.delete(this.baseUrl+"api/purchase/purchase/"+t)}createPurchase(t){return this.http.post(this.baseUrl+"api/purchase/create/",t)}updatePrice(t){return this.http.post(`${this.baseUrl}api/purchase/update_price`,t)}getReport(t){return`${this.baseUrl}api/purchase/purchase/report/${t}`}getDetailPurchase(t){return this.http.get(`${this.baseUrl}api/purchase/purchase/detail/${t}`)}deleteProductFromPurchase(t,r){return this.http.post(`${this.baseUrl}api/purchase/purchase/delete_product`,{purchase_number:t,sku:r})}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const qye=()=>["administrador"];function Zye(e,n){if(1&e&&(P(0,"div",47),U(1),Rt(2,"button",48),O()),2&e){const t=Ge();W(),Zn(" ",t.messagePurchase," ")}}function Xye(e,n){if(1&e){const t=lr();P(0,"div",4)(1,"span",56),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().setPurchase(i))}),Rt(2,"i",57),O()()}}function Yye(e,n){if(1&e){const t=lr();P(0,"div",4)(1,"span",58),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().setPurchase(i))}),Rt(2,"i",59),O()()}}function Kye(e,n){if(1&e){const t=lr();P(0,"div",4)(1,"span",60),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().downloadExcel(i))}),Rt(2,"i",61),O()()}}function Jye(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(2),O(),P(3,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(4),O(),P(5,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(6),O(),P(7,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(8),O(),P(9,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(10),O(),P(11,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(12),O(),P(13,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(14),zn(15,"currency"),O(),P(16,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(17),zn(18,"currency"),O(),P(19,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(20),zn(21,"currency"),O(),P(22,"td",49),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToPurchase(i.purchase_number))}),U(23),O(),P(24,"td")(25,"div",50)(26,"div",4)(27,"span",51),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().openPdfModal(i.purchase_number))}),Rt(28,"i",52),O()(),gt(29,Xye,3,0,"div",53)(30,Yye,3,0,"div",53)(31,Kye,3,0,"div",53),P(32,"div",4)(33,"span",54),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().openDetailPurchase(i))}),Rt(34,"i",55),O()()()()()}if(2&e){const t=n.$implicit,r=Ge();W(2),tt(t.purchase_number),W(2),tt(t.date),W(2),tt(t.products.length),W(2),Zn(" ",r.calculateRegisteredPercentage(t.products),"% "),W(2),Zn(" ",r.calculateRegisteredParcialPercentage(t.products),"% "),W(2),Zn(" ",r.calculateFacturadaPercentage(t.products),"% "),W(2),Zn(" ",fs(15,13,t.efectivoEntreado,"COP ")," "),W(3),Zn(" ",fs(18,16,r.calculateTotalEstimate(t.products),"COP ")," "),W(3),Zn(" ",fs(21,19,r.calculatetotalReal(t.products),"COP ")," "),W(3),tt(t.status),W(6),Oe("ngIf","Creada"==t.status),W(),Oe("ngIf","Creada"==t.status),W(),Oe("ngIf",r.hasRole(Va(22,qye)))}}function Qye(e,n){if(1&e&&(P(0,"div")(1,"label"),U(2,"SKU:"),O(),P(3,"span",62),U(4),O()()),2&e){const t=Ge();W(4),tt(null==t.newItem?null:t.newItem.sku)}}function eve(e,n){if(1&e&&(P(0,"div")(1,"label"),U(2,"Unidad:"),O(),P(3,"span",62),U(4),O()()),2&e){const t=Ge();W(4),tt(null==t.newItem?null:t.newItem.unit)}}function tve(e,n){if(1&e&&(P(0,"div")(1,"label"),U(2,"Precio de compra sugerido:"),O(),P(3,"span",62),U(4),zn(5,"currency"),O()()),2&e){const t=Ge();W(4),tt(fs(5,1,null==t.newItem?null:t.newItem.price_purchase,"USD"))}}function nve(e,n){if(1&e){const t=lr();P(0,"div")(1,"label"),U(2,"Cantidad Pron\xf3stico:"),O(),P(3,"input",63),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.quantityProdcutSelect,i)||(l.quantityProdcutSelect=i),zt(i)}),O()()}if(2&e){const t=Ge();W(3),Ct("ngModel",t.quantityProdcutSelect)}}function rve(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),zn(7,"currency"),O(),P(8,"td"),U(9),zn(10,"currency"),O()()),2&e){const t=n.$implicit;W(2),tt(t.nombre),W(2),tt(t.cantidad_productos),W(2),tt(Jo(7,4,t.valor_estimado,"COP","symbol","1.0-0")),W(3),tt(Jo(10,9,t.valor_real,"COP","symbol","1.0-0"))}}function ive(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),zn(7,"currency"),O(),P(8,"td"),U(9),zn(10,"currency"),O()()),2&e){const t=n.$implicit;W(2),tt(t.nombre),W(2),tt(t.cantidad_productos),W(2),tt(Jo(7,4,t.valor_estimado,"COP","symbol","1.0-0")),W(3),tt(Jo(10,9,t.valor_real,"COP","symbol","1.0-0"))}}let sve=(()=>{class e{constructor(t,r,i,l,u){this.purchaseService=t,this.alegraService=r,this.router=i,this.sanitizer=l,this.productService=u,this.purchases=[],this.filteredPurchases=[],this.searchText="",this.fechaNewOrder="",this.messagePurchase="",this.statusCodePurchase="",this.productSelect={},this.quantityProdcutSelect=0,this.newItem={},this.products=[],this.purchaseSelect="",this.efectivoEntreado=0,this.perSellerArray=[],this.perPaymentArray=[]}ngOnInit(){this.getPurchases()}hasRole(t){return t.some(r=>localStorage.getItem("role")?.includes(r))}navigateToPurchase(t){this.router.navigate(["/purchase",t])}filterPurchases(){this.filteredPurchases=""!==this.searchText.trim()?this.purchases.filter(t=>t.purchase_number.toLowerCase().includes(this.searchText.toLowerCase())):this.purchases}newPurchase(){this.purchaseService.createPurchase({date:this.fechaNewOrder,efectivoEntreado:this.efectivoEntreado}).subscribe(r=>{this.getPurchases(),this.messagePurchase="Orden de compra creada exitosamente!",this.statusCodePurchase=r.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},r=>{this.messagePurchase="Fallo al crear la Orden de compra.",this.statusCodePurchase=r.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)})}getPurchases(){this.purchaseService.getPurchases().subscribe(t=>{this.purchases=t})}openPdfModal(t){this.pdfData=this.sanitizer.bypassSecurityTrustResourceUrl(this.purchaseService.getReport(t))}convertToArray(t){return Object.entries(t).map(([r,i])=>({nombre:r,...i}))}openDetailPurchase(t){this.purchaseService.getDetailPurchase(t.purchase_number).subscribe(r=>{this.perSellerArray=this.convertToArray(r.per_seller),this.perPaymentArray=this.convertToArray(r.per_payment)})}delete_purchase(t){this.purchaseService.deletePurchase(t).subscribe(r=>{this.getPurchases(),this.messagePurchase="Orden de compra eliminada exitosamente!",this.statusCodePurchase=r.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},r=>{this.messagePurchase="Fallo al eliminar la Orden de compra.",this.statusCodePurchase=r.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)})}calculateRegisteredPercentage(t){if(0===t.length)return 0;const r=t.filter(i=>"Registrado"===i.status).length;return Math.round(r/t.length*100)}calculateRegisteredParcialPercentage(t){if(0===t.length)return 0;const r=t.filter(i=>"Registro parcial"===i.status).length;return Math.round(r/t.length*100)}calculateFacturadaPercentage(t){if(0===t.length)return 0;const r=t.filter(i=>"Facturada"===i.status).length;return Math.round(r/t.length*100)}calculateTotalEstimate(t){return t.reduce((r,i)=>{const l=Math.max(i.total_quantity||0,0);return r+(i.price_purchase||0)*l},0)}calculatetotalReal(t){return t.reduce((r,i)=>r+(i.final_price_purchase||0)*(i.total_quantity||0),0)}downloadExcel(t){const l=t.products.map(R=>({SKU:R.sku,Nombre:R.name,Categor\u00eda:R.category,Precio_Sugerido:R.price_purchase,Precio_Real:R.final_price_purchase,Cantidad:R.total_quantity_ordered,Total_Sugerido:R.price_purchase*R.total_quantity_ordered,Total_Real:R.final_price_purchase*R.total_quantity_ordered,status:R.status})),x=rD({Sheets:{Productos:f$_json_to_sheet(l)},SheetNames:["Productos"]},{bookType:"xlsx",type:"array"}),E=new Blob([x],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});p$.saveAs(E,`Compra_${t.purchase_number}.xlsx`)}sync_allegra(t){this.alegraService.send_purchase(t.date).subscribe(r=>{this.getPurchases(),this.messagePurchase="Ordenes de compras sincronizada exitosamente!",this.statusCodePurchase=r.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},r=>{this.messagePurchase="Fallo al sincronizar las Ordenes de compra.",this.statusCodePurchase=r.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)}),this.getPurchases()}setPurchase(t){this.purchaseSelect=t,this.productService.getProducts().subscribe(r=>{this.products=r.filter(i=>"1"===i.root)},r=>{console.error("Error al obtener los productos:",r)})}onProductSelect(t){t&&(this.newItem.total_quantity_ordered=0,this.newItem.clients=[],this.newItem.sku=t.sku,this.newItem.name=t.name,this.newItem.price_purchase=t.price_purchase,this.newItem.proveedor="",this.newItem.category=t.category,this.newItem.unit=t.unit,this.newItem.status="Creada",this.newItem.link_document_support="",this.newItem.final_price_purchase=0,this.newItem.forecast=this.quantityProdcutSelect,this.newItem.inventory=0,this.newItem.total_quantity=this.quantityProdcutSelect)}add_item(){this.newItem.forecast=this.quantityProdcutSelect,this.newItem.total_quantity=this.quantityProdcutSelect,this.newItem.clients=[{client_name:"Inventario",quantity:this.quantityProdcutSelect}],this.purchaseSelect.products.push(this.newItem),this.purchaseService.updatePurchase(this.purchaseSelect).subscribe(t=>{this.getPurchases(),this.messagePurchase="Orden de compra editada exitosamente!",this.statusCodePurchase=t.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},t=>{this.messagePurchase="Fallo al editar la Orden de compra.",this.statusCodePurchase=t.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)})}comments(){this.purchaseService.updatePurchase(this.purchaseSelect).subscribe(t=>{this.getPurchases(),this.messagePurchase="Orden de compra editada exitosamente!",this.statusCodePurchase=t.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},t=>{this.messagePurchase="Fallo al editar la Orden de compra.",this.statusCodePurchase=t.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)})}enableSaveButton(){return""==this.fechaNewOrder||0==this.efectivoEntreado}static#e=this.\u0275fac=function(r){return new(r||e)(ut(CH),ut(V4),ut(ws),ut(tk),ut(v4))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-purchases"]],decls:153,vars:19,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-6"],["type","text","placeholder","Buscar compra...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#newPurchase","data-bs-dismiss","modal",1,"btn","btn-primary"],[1,"fas","fa-plus-circle","fa-lg"],["type","button","routerLink","/suppliers",1,"btn","btn-primary"],[1,"fas","fa-user","fa-lg"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","addcomments","tabindex","-1","role","dialog","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"form-group"],["for","fecha"],["type","number","id","efectivoEntreado","name","efectivoEntreado",1,"form-control",3,"ngModelChange","ngModel"],["type","text",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"btn","btn-primary",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["id","newPurchase","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],["id","newPurchase",1,"modal-title"],[1,"container"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-right"],[1,"btn","btn-primary",3,"click","disabled"],["id","pdfModal","tabindex","-1","role","dialog","aria-labelledby","pdfModalLabel","aria-hidden","true",1,"modal","fade"],["id","pdfModalLabel",1,"modal-title"],["type","application/pdf","width","100%","height","600px",3,"src"],["id","addItem","tabindex","-1","role","dialog","aria-hidden","true",1,"modal","fade"],["bindLabel","name","bindValue","id",3,"ngModelChange","change","items","searchable","ngModel"],[4,"ngIf"],["id","purchaseDetailModal","tabindex","-1","aria-labelledby","purchaseDetailModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-xl"],["id","purchaseDetailModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Cerrar",1,"btn-close"],[1,"mt-2"],[1,"table","table-bordered","table-hover","table-sm"],[1,"table-light"],[1,"mt-4"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[3,"click"],[1,"row"],["data-bs-toggle","modal","data-bs-target","#pdfModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-primary"],["class","col-auto",4,"ngIf"],["data-bs-toggle","modal","data-bs-target","#purchaseDetailModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-calendar","fa-lg","text-warning"],["data-bs-toggle","modal","data-bs-target","#addItem","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-plus-circle","fa-lg","text-primary"],["data-bs-target","#addcomments","data-bs-dismiss","modal","data-bs-toggle","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-message","fa-lg","text-warning"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-file-excel","fa-lg","text-success"],[1,"form-control"],["type","number",1,"form-control",3,"ngModelChange","ngModel"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterPurchases()}),O()(),P(4,"div",4)(5,"button",5),Rt(6,"i",6),U(7," Nueva compra"),O()(),P(8,"div",4)(9,"button",7),Rt(10,"i",8),U(11," Proveedores"),O()()(),gt(12,Zye,3,1,"div",9),P(13,"table",10)(14,"thead")(15,"tr")(16,"th"),U(17,"N\xfamero de Compra"),O(),P(18,"th"),U(19,"Fecha"),O(),P(20,"th"),U(21,"Cantidad SKU"),O(),P(22,"th"),U(23,"Porc. Registrado"),O(),P(24,"th"),U(25,"Porc. Registro Pacial"),O(),P(26,"th"),U(27,"Porc. Facturado"),O(),P(28,"th"),U(29,"Efectivo Entregado"),O(),P(30,"th"),U(31,"Total Estimado"),O(),P(32,"th"),U(33,"Total Real"),O(),P(34,"th"),U(35,"Estado"),O(),P(36,"th"),U(37,"Acciones"),O()()(),P(38,"tbody"),gt(39,Jye,35,23,"tr",11),O()()(),P(40,"div",12)(41,"div",13)(42,"div",14)(43,"div",15)(44,"h5",16),U(45,"Agregar comentario"),O(),Rt(46,"button",17),O(),P(47,"div",18)(48,"div",19)(49,"label",20),U(50,"Efectivo entregado:"),O(),P(51,"input",21),St("ngModelChange",function(u){return Dt(i.efectivoEntreado,u)||(i.efectivoEntreado=u),u}),O()(),P(52,"input",22),St("ngModelChange",function(u){return Dt(i.purchaseSelect.comments,u)||(i.purchaseSelect.comments=u),u}),O()(),P(53,"div",23)(54,"button",24),ct("click",function(){return i.comments()}),U(55,"Agregar Comentario"),O(),P(56,"button",25),U(57,"Cerrar"),O()()()()(),P(58,"div",26)(59,"div",27)(60,"div",14)(61,"div",15)(62,"h5",28),U(63,"Nueva compra"),O()(),P(64,"div",18)(65,"div",29)(66,"div",19)(67,"label",20),U(68,"Fecha:"),O(),P(69,"input",30),St("ngModelChange",function(u){return Dt(i.fechaNewOrder,u)||(i.fechaNewOrder=u),u}),O()(),P(70,"div",19)(71,"label",20),U(72,"Efectivo entregado:"),O(),P(73,"input",21),St("ngModelChange",function(u){return Dt(i.efectivoEntreado,u)||(i.efectivoEntreado=u),u}),O()(),Rt(74,"br"),P(75,"div",31)(76,"button",32),ct("click",function(){return i.newPurchase()}),U(77,"Nueva Orden de compra"),O()()()()()()(),P(78,"div",33)(79,"div",13)(80,"div",14)(81,"div",15)(82,"h5",34),U(83,"Orden de compra"),O(),Rt(84,"button",17),O(),P(85,"div",18),Rt(86,"iframe",35),O(),P(87,"div",23)(88,"button",25),U(89,"Cerrar"),O()()()()(),P(90,"div",36)(91,"div",13)(92,"div",14)(93,"div",15)(94,"h5",16),U(95,"Agregar producto a Orden de Compra"),O(),Rt(96,"button",17),O(),P(97,"div",18)(98,"ng-select",37),St("ngModelChange",function(u){return Dt(i.productSelect,u)||(i.productSelect=u),u}),ct("change",function(u){return i.onProductSelect(u)}),O(),Rt(99,"br"),gt(100,Qye,5,1,"div",38),Rt(101,"br"),gt(102,eve,5,1,"div",38),Rt(103,"br"),gt(104,tve,6,4,"div",38),Rt(105,"br"),gt(106,nve,4,1,"div",38),O(),P(107,"div",23)(108,"button",32),ct("click",function(){return i.add_item()}),U(109,"Agregar"),O(),P(110,"button",25),U(111,"Cerrar"),O()()()()(),P(112,"div",39)(113,"div",40)(114,"div",14)(115,"div",15)(116,"h5",41),U(117," Detalle de Compra "),O(),Rt(118,"button",42),O(),P(119,"div",18)(120,"h6",43),U(121,"Por Proveedor"),O(),P(122,"table",44)(123,"thead",45)(124,"tr")(125,"th"),U(126,"Proveedor"),O(),P(127,"th"),U(128,"Cantidad Productos"),O(),P(129,"th"),U(130,"Valor Estimado"),O(),P(131,"th"),U(132,"Valor Real"),O()()(),P(133,"tbody"),gt(134,rve,11,14,"tr",11),O()(),P(135,"h6",46),U(136,"Por Tipo de Pago"),O(),P(137,"table",44)(138,"thead",45)(139,"tr")(140,"th"),U(141,"Tipo de Pago"),O(),P(142,"th"),U(143,"Cantidad Productos"),O(),P(144,"th"),U(145,"Valor Estimado"),O(),P(146,"th"),U(147,"Valor Real"),O()()(),P(148,"tbody"),gt(149,ive,11,14,"tr",11),O()()(),P(150,"div",23)(151,"button",25),U(152,"Cerrar"),O()()()()()),2&r&&(W(3),Ct("ngModel",i.searchText),W(9),Oe("ngIf",i.messagePurchase),W(27),Oe("ngForOf",i.purchases),W(12),Ct("ngModel",i.efectivoEntreado),W(),Ct("ngModel",i.purchaseSelect.comments),W(17),Ct("ngModel",i.fechaNewOrder),W(4),Ct("ngModel",i.efectivoEntreado),W(3),Oe("disabled",i.enableSaveButton()),W(10),Oe("src",i.pdfData,Sf),W(12),Oe("items",i.products)("searchable",!0),Ct("ngModel",i.productSelect),W(2),Oe("ngIf",i.newItem.sku),W(2),Oe("ngIf",i.newItem.sku),W(2),Oe("ngIf",i.newItem.sku),W(2),Oe("ngIf",i.newItem.sku),W(2),Oe("disabled",!i.newItem.sku),W(26),Oe("ngForOf",i.perSellerArray),W(15),Oe("ngForOf",i.perPaymentArray))},dependencies:[No,So,H0,Hs,Nh,so,oo,EH,ld]})}return e})();const{isArray:uve}=Array;function SH(e){return 1===e.length&&uve(e[0])?e[0]:e}function W4(...e){const n=rk(e),t=SH(e);return t.length?new Di(r=>{let i=t.map(()=>[]),l=t.map(()=>!1);r.add(()=>{i=l=null});for(let u=0;!r.closed&&u<t.length;u++)Dl(t[u]).subscribe(te(r,g=>{if(i[u].push(g),i.every(x=>x.length)){const x=i.map(E=>E.shift());r.next(n?n(...x):x),i.some((E,D)=>!E.length&&l[D])&&r.complete()}},()=>{l[u]=!0,!i[u].length&&r.complete()}));return()=>{i=l=null}}):cd}function q4(...e){const n=rk(e);return Ie((t,r)=>{const i=e.length,l=new Array(i);let u=e.map(()=>!1),g=!1;for(let x=0;x<i;x++)Dl(e[x]).subscribe(te(r,E=>{l[x]=E,!g&&!u[x]&&(u[x]=!0,(g=u.every(dl))&&(u=null))},Uo));t.subscribe(te(r,x=>{if(g){const E=[x,...l];r.next(n?n(...E):E)}}))})}var yve={left:"right",right:"left",bottom:"top",top:"bottom"};function RO(e){return e.replace(/left|right|bottom|top/g,function(n){return yve[n]})}function lm(e){return e.split("-")[0]}var vve={start:"end",end:"start"};function AH(e){return e.replace(/start|end/g,function(n){return vve[n]})}var tu="top",xd="bottom",bd="right",nu="left",NO="auto",F2=[tu,xd,bd,nu],Kv="start",L2="end",IH="clippingParents",Z4="viewport",B2="popper",kH="reference",X4=F2.reduce(function(e,n){return e.concat([n+"-"+Kv,n+"-"+L2])},[]),Y4=[].concat(F2,[NO]).reduce(function(e,n){return e.concat([n,n+"-"+Kv,n+"-"+L2])},[]),OH="beforeRead",PH="read",RH="afterRead",NH="beforeMain",FH="main",LH="afterMain",BH="beforeWrite",zH="write",UH="afterWrite",VH=[OH,PH,RH,NH,FH,LH,BH,zH,UH];function wd(e){if(null==e)return window;if("[object Window]"!==e.toString()){var n=e.ownerDocument;return n&&n.defaultView||window}return e}function Jv(e){return e instanceof wd(e).Element||e instanceof Element}function Fh(e){return e instanceof wd(e).HTMLElement||e instanceof HTMLElement}function K4(e){return!(typeof ShadowRoot>"u")&&(e instanceof wd(e).ShadowRoot||e instanceof ShadowRoot)}function c1(e){return((Jv(e)?e.ownerDocument:e.document)||window.document).documentElement}var Qv=Math.max,FO=Math.min,z2=Math.round;function J4(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(n){return n.brand+"/"+n.version}).join(" "):navigator.userAgent}function jH(){return!/^((?!chrome|android).)*safari/i.test(J4())}function U2(e,n,t){void 0===n&&(n=!1),void 0===t&&(t=!1);var r=e.getBoundingClientRect(),i=1,l=1;n&&Fh(e)&&(i=e.offsetWidth>0&&z2(r.width)/e.offsetWidth||1,l=e.offsetHeight>0&&z2(r.height)/e.offsetHeight||1);var g=(Jv(e)?wd(e):window).visualViewport,x=!jH()&&t,E=(r.left+(x&&g?g.offsetLeft:0))/i,D=(r.top+(x&&g?g.offsetTop:0))/l,R=r.width/i,L=r.height/l;return{width:R,height:L,top:D,right:E+R,bottom:D+L,left:E,x:E,y:D}}function Q4(e){var n=wd(e);return{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function eL(e){return U2(c1(e)).left+Q4(e).scrollLeft}function Hg(e){return wd(e).getComputedStyle(e)}function cm(e){return e?(e.nodeName||"").toLowerCase():null}function LO(e){return"html"===cm(e)?e:e.assignedSlot||e.parentNode||(K4(e)?e.host:null)||c1(e)}function tL(e){var n=Hg(e);return/auto|scroll|overlay|hidden/.test(n.overflow+n.overflowY+n.overflowX)}function $H(e){return["html","body","#document"].indexOf(cm(e))>=0?e.ownerDocument.body:Fh(e)&&tL(e)?e:$H(LO(e))}function _D(e,n){var t;void 0===n&&(n=[]);var r=$H(e),i=r===(null==(t=e.ownerDocument)?void 0:t.body),l=wd(r),u=i?[l].concat(l.visualViewport||[],tL(r)?r:[]):r,g=n.concat(u);return i?g:g.concat(_D(LO(u)))}function wve(e){return["table","td","th"].indexOf(cm(e))>=0}function HH(e){return Fh(e)&&"fixed"!==Hg(e).position?e.offsetParent:null}function yD(e){for(var n=wd(e),t=HH(e);t&&wve(t)&&"static"===Hg(t).position;)t=HH(t);return t&&("html"===cm(t)||"body"===cm(t)&&"static"===Hg(t).position)?n:t||function Tve(e){var n=/firefox/i.test(J4());if(/Trident/i.test(J4())&&Fh(e)&&"fixed"===Hg(e).position)return null;var i=LO(e);for(K4(i)&&(i=i.host);Fh(i)&&["html","body"].indexOf(cm(i))<0;){var l=Hg(i);if("none"!==l.transform||"none"!==l.perspective||"paint"===l.contain||-1!==["transform","perspective"].indexOf(l.willChange)||n&&"filter"===l.willChange||n&&l.filter&&"none"!==l.filter)return i;i=i.parentNode}return null}(e)||n}function GH(e,n){var t=n.getRootNode&&n.getRootNode();if(e.contains(n))return!0;if(t&&K4(t)){var r=n;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function nL(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function WH(e,n,t){return n===Z4?nL(function xve(e,n){var t=wd(e),r=c1(e),i=t.visualViewport,l=r.clientWidth,u=r.clientHeight,g=0,x=0;if(i){l=i.width,u=i.height;var E=jH();(E||!E&&"fixed"===n)&&(g=i.offsetLeft,x=i.offsetTop)}return{width:l,height:u,x:g+eL(e),y:x}}(e,t)):Jv(n)?function Eve(e,n){var t=U2(e,!1,"fixed"===n);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}(n,t):nL(function bve(e){var n,t=c1(e),r=Q4(e),i=null==(n=e.ownerDocument)?void 0:n.body,l=Qv(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),u=Qv(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),g=-r.scrollLeft+eL(e),x=-r.scrollTop;return"rtl"===Hg(i||t).direction&&(g+=Qv(t.clientWidth,i?i.clientWidth:0)-l),{width:l,height:u,x:g,y:x}}(c1(e)))}function V2(e){return e.split("-")[1]}function rL(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function qH(e){var x,n=e.reference,t=e.element,r=e.placement,i=r?lm(r):null,l=r?V2(r):null,u=n.x+n.width/2-t.width/2,g=n.y+n.height/2-t.height/2;switch(i){case tu:x={x:u,y:n.y-t.height};break;case xd:x={x:u,y:n.y+n.height};break;case bd:x={x:n.x+n.width,y:g};break;case nu:x={x:n.x-t.width,y:g};break;default:x={x:n.x,y:n.y}}var E=i?rL(i):null;if(null!=E){var D="y"===E?"height":"width";switch(l){case Kv:x[E]=x[E]-(n[D]/2-t[D]/2);break;case L2:x[E]=x[E]+(n[D]/2-t[D]/2)}}return x}function XH(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function YH(e,n){return n.reduce(function(t,r){return t[r]=e,t},{})}function j2(e,n){void 0===n&&(n={});var r=n.placement,i=void 0===r?e.placement:r,l=n.strategy,u=void 0===l?e.strategy:l,g=n.boundary,x=void 0===g?IH:g,E=n.rootBoundary,D=void 0===E?Z4:E,R=n.elementContext,L=void 0===R?B2:R,V=n.altBoundary,Y=void 0!==V&&V,G=n.padding,Q=void 0===G?0:G,he=XH("number"!=typeof Q?Q:YH(Q,F2)),me=e.rects.popper,ze=e.elements[Y?L===B2?kH:B2:L],Je=function Sve(e,n,t,r){var i="clippingParents"===n?function Cve(e){var n=_D(LO(e)),r=["absolute","fixed"].indexOf(Hg(e).position)>=0&&Fh(e)?yD(e):e;return Jv(r)?n.filter(function(i){return Jv(i)&&GH(i,r)&&"body"!==cm(i)}):[]}(e):[].concat(n),l=[].concat(i,[t]),g=l.reduce(function(x,E){var D=WH(e,E,r);return x.top=Qv(D.top,x.top),x.right=FO(D.right,x.right),x.bottom=FO(D.bottom,x.bottom),x.left=Qv(D.left,x.left),x},WH(e,l[0],r));return g.width=g.right-g.left,g.height=g.bottom-g.top,g.x=g.left,g.y=g.top,g}(Jv(ze)?ze:ze.contextElement||c1(e.elements.popper),x,D,u),ht=U2(e.elements.reference),Ne=qH({reference:ht,element:me,strategy:"absolute",placement:i}),dt=nL(Object.assign({},me,Ne)),ft=L===B2?dt:ht,kt={top:Je.top-ft.top+he.top,bottom:ft.bottom-Je.bottom+he.bottom,left:Je.left-ft.left+he.left,right:ft.right-Je.right+he.right},$t=e.modifiersData.offset;if(L===B2&&$t){var vt=$t[i];Object.keys(kt).forEach(function(wn){var Xn=[bd,xd].indexOf(wn)>=0?1:-1,Nn=[tu,xd].indexOf(wn)>=0?"y":"x";kt[wn]+=vt[Nn]*Xn})}return kt}const iL={name:"flip",enabled:!0,phase:"main",fn:function Ave(e){var n=e.state,t=e.options,r=e.name;if(!n.modifiersData[r]._skip){for(var i=t.mainAxis,l=void 0===i||i,u=t.altAxis,g=void 0===u||u,x=t.fallbackPlacements,E=t.padding,D=t.boundary,R=t.rootBoundary,L=t.altBoundary,V=t.flipVariations,Y=void 0===V||V,G=t.allowedAutoPlacements,Q=n.options.placement,he=lm(Q),me=x||(he!==Q&&Y?function Mve(e){if(lm(e)===NO)return[];var n=RO(e);return[AH(e),n,AH(n)]}(Q):[RO(Q)]),ze=[Q].concat(me).reduce(function(st,rt){return st.concat(lm(rt)===NO?function Dve(e,n){void 0===n&&(n={});var i=n.boundary,l=n.rootBoundary,u=n.padding,g=n.flipVariations,x=n.allowedAutoPlacements,E=void 0===x?Y4:x,D=V2(n.placement),R=D?g?X4:X4.filter(function(Y){return V2(Y)===D}):F2,L=R.filter(function(Y){return E.indexOf(Y)>=0});0===L.length&&(L=R);var V=L.reduce(function(Y,G){return Y[G]=j2(e,{placement:G,boundary:i,rootBoundary:l,padding:u})[lm(G)],Y},{});return Object.keys(V).sort(function(Y,G){return V[Y]-V[G]})}(n,{placement:rt,boundary:D,rootBoundary:R,padding:E,flipVariations:Y,allowedAutoPlacements:G}):rt)},[]),Je=n.rects.reference,ht=n.rects.popper,Ne=new Map,dt=!0,ft=ze[0],kt=0;kt<ze.length;kt++){var $t=ze[kt],vt=lm($t),wn=V2($t)===Kv,Xn=[tu,xd].indexOf(vt)>=0,Nn=Xn?"width":"height",gr=j2(n,{placement:$t,boundary:D,rootBoundary:R,altBoundary:L,padding:E}),Kn=Xn?wn?bd:nu:wn?xd:tu;Je[Nn]>ht[Nn]&&(Kn=RO(Kn));var Si=RO(Kn),Hn=[];if(l&&Hn.push(gr[vt]<=0),g&&Hn.push(gr[Kn]<=0,gr[Si]<=0),Hn.every(function(st){return st})){ft=$t,dt=!1;break}Ne.set($t,Hn)}if(dt)for(var mn=function(rt){var on=ze.find(function(Gn){var An=Ne.get(Gn);if(An)return An.slice(0,rt).every(function(On){return On})});if(on)return ft=on,"break"},Ye=Y?3:1;Ye>0&&"break"!==mn(Ye);Ye--);n.placement!==ft&&(n.modifiersData[r]._skip=!0,n.placement=ft,n.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function vD(e,n,t){return Qv(e,FO(n,t))}function sL(e){var n=U2(e),t=e.offsetWidth,r=e.offsetHeight;return Math.abs(n.width-t)<=1&&(t=n.width),Math.abs(n.height-r)<=1&&(r=n.height),{x:e.offsetLeft,y:e.offsetTop,width:t,height:r}}const oL={name:"preventOverflow",enabled:!0,phase:"main",fn:function Ove(e){var n=e.state,t=e.options,r=e.name,i=t.mainAxis,l=void 0===i||i,u=t.altAxis,g=void 0!==u&&u,L=t.tether,V=void 0===L||L,Y=t.tetherOffset,G=void 0===Y?0:Y,Q=j2(n,{boundary:t.boundary,rootBoundary:t.rootBoundary,padding:t.padding,altBoundary:t.altBoundary}),he=lm(n.placement),le=V2(n.placement),me=!le,ze=rL(he),Je=function Ive(e){return"x"===e?"y":"x"}(ze),ht=n.modifiersData.popperOffsets,Ne=n.rects.reference,dt=n.rects.popper,ft="function"==typeof G?G(Object.assign({},n.rects,{placement:n.placement})):G,kt="number"==typeof ft?{mainAxis:ft,altAxis:ft}:Object.assign({mainAxis:0,altAxis:0},ft),$t=n.modifiersData.offset?n.modifiersData.offset[n.placement]:null,vt={x:0,y:0};if(ht){if(l){var wn,Xn="y"===ze?tu:nu,Nn="y"===ze?xd:bd,gr="y"===ze?"height":"width",Kn=ht[ze],Si=Kn+Q[Xn],Hn=Kn-Q[Nn],Nr=V?-dt[gr]/2:0,mn=le===Kv?Ne[gr]:dt[gr],Ye=le===Kv?-dt[gr]:-Ne[gr],Nt=n.elements.arrow,st=V&&Nt?sL(Nt):{width:0,height:0},rt=n.modifiersData["arrow#persistent"]?n.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},on=rt[Xn],Gn=rt[Nn],An=vD(0,Ne[gr],st[gr]),On=me?Ne[gr]/2-Nr-An-on-kt.mainAxis:mn-An-on-kt.mainAxis,gn=me?-Ne[gr]/2+Nr+An+Gn+kt.mainAxis:Ye+An+Gn+kt.mainAxis,fi=n.elements.arrow&&yD(n.elements.arrow),Xe=fi?"y"===ze?fi.clientTop||0:fi.clientLeft||0:0,ms=null!=(wn=$t?.[ze])?wn:0,Ts=Kn+gn-ms,Ri=vD(V?FO(Si,Kn+On-ms-Xe):Si,Kn,V?Qv(Hn,Ts):Hn);ht[ze]=Ri,vt[ze]=Ri-Kn}if(g){var qn,Ll=ht[Je],Ou="y"===Je?"height":"width",g1=Ll+Q["x"===ze?tu:nu],Xf=Ll-Q["x"===ze?xd:bd],ic=-1!==[tu,nu].indexOf(he),Vh=null!=(qn=$t?.[Je])?qn:0,Yf=ic?g1:Ll-Ne[Ou]-dt[Ou]-Vh+kt.altAxis,_1=ic?Ll+Ne[Ou]+dt[Ou]-Vh-kt.altAxis:Xf,Bl=V&&ic?function kve(e,n,t){var r=vD(e,n,t);return r>t?t:r}(Yf,Ll,_1):vD(V?Yf:g1,Ll,V?_1:Xf);ht[Je]=Bl,vt[Je]=Bl-Ll}n.modifiersData[r]=vt}},requiresIfExists:["offset"]},aL={name:"arrow",enabled:!0,phase:"main",fn:function Rve(e){var n,t=e.state,r=e.name,i=e.options,l=t.elements.arrow,u=t.modifiersData.popperOffsets,g=lm(t.placement),x=rL(g),D=[nu,bd].indexOf(g)>=0?"height":"width";if(l&&u){var R=function(n,t){return XH("number"!=typeof(n="function"==typeof n?n(Object.assign({},t.rects,{placement:t.placement})):n)?n:YH(n,F2))}(i.padding,t),L=sL(l),V="y"===x?tu:nu,Y="y"===x?xd:bd,G=t.rects.reference[D]+t.rects.reference[x]-u[x]-t.rects.popper[D],Q=u[x]-t.rects.reference[x],he=yD(l),le=he?"y"===x?he.clientHeight||0:he.clientWidth||0:0,ht=le/2-L[D]/2+(G/2-Q/2),Ne=vD(R[V],ht,le-L[D]-R[Y]);t.modifiersData[r]=((n={})[x]=Ne,n.centerOffset=Ne-ht,n)}},effect:function Nve(e){var n=e.state,r=e.options.element,i=void 0===r?"[data-popper-arrow]":r;null!=i&&("string"==typeof i&&!(i=n.elements.popper.querySelector(i))||GH(n.elements.popper,i)&&(n.elements.arrow=i))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function zve(e,n,t){void 0===t&&(t=!1);var r=Fh(n),i=Fh(n)&&function Bve(e){var n=e.getBoundingClientRect(),t=z2(n.width)/e.offsetWidth||1,r=z2(n.height)/e.offsetHeight||1;return 1!==t||1!==r}(n),l=c1(n),u=U2(e,i,t),g={scrollLeft:0,scrollTop:0},x={x:0,y:0};return(r||!r&&!t)&&(("body"!==cm(n)||tL(l))&&(g=function Lve(e){return e!==wd(e)&&Fh(e)?function Fve(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}(e):Q4(e)}(n)),Fh(n)?((x=U2(n,!0)).x+=n.clientLeft,x.y+=n.clientTop):l&&(x.x=eL(l))),{x:u.left+g.scrollLeft-x.x,y:u.top+g.scrollTop-x.y,width:u.width,height:u.height}}function Uve(e){var n=new Map,t=new Set,r=[];function i(l){t.add(l.name),[].concat(l.requires||[],l.requiresIfExists||[]).forEach(function(g){if(!t.has(g)){var x=n.get(g);x&&i(x)}}),r.push(l)}return e.forEach(function(l){n.set(l.name,l)}),e.forEach(function(l){t.has(l.name)||i(l)}),r}function jve(e){var n;return function(){return n||(n=new Promise(function(t){Promise.resolve().then(function(){n=void 0,t(e())})})),n}}var KH={placement:"bottom",modifiers:[],strategy:"absolute"};function JH(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return!n.some(function(r){return!(r&&"function"==typeof r.getBoundingClientRect)})}function BO(e){void 0===e&&(e={});var t=e.defaultModifiers,r=void 0===t?[]:t,i=e.defaultOptions,l=void 0===i?KH:i;return function(g,x,E){void 0===E&&(E=l);var D={placement:"bottom",orderedModifiers:[],options:Object.assign({},KH,l),modifiersData:{},elements:{reference:g,popper:x},attributes:{},styles:{}},R=[],L=!1,V={state:D,setOptions:function(he){var le="function"==typeof he?he(D.options):he;G(),D.options=Object.assign({},l,D.options,le),D.scrollParents={reference:Jv(g)?_D(g):g.contextElement?_D(g.contextElement):[],popper:_D(x)};var me=function Vve(e){var n=Uve(e);return VH.reduce(function(t,r){return t.concat(n.filter(function(i){return i.phase===r}))},[])}(function $ve(e){var n=e.reduce(function(t,r){var i=t[r.name];return t[r.name]=i?Object.assign({},i,r,{options:Object.assign({},i.options,r.options),data:Object.assign({},i.data,r.data)}):r,t},{});return Object.keys(n).map(function(t){return n[t]})}([].concat(r,D.options.modifiers)));return D.orderedModifiers=me.filter(function(ze){return ze.enabled}),function Y(){D.orderedModifiers.forEach(function(Q){var le=Q.options,ze=Q.effect;if("function"==typeof ze){var Je=ze({state:D,name:Q.name,instance:V,options:void 0===le?{}:le});R.push(Je||function(){})}})}(),V.update()},forceUpdate:function(){if(!L){var he=D.elements,le=he.reference,me=he.popper;if(JH(le,me)){D.rects={reference:zve(le,yD(me),"fixed"===D.options.strategy),popper:sL(me)},D.reset=!1,D.placement=D.options.placement,D.orderedModifiers.forEach(function(kt){return D.modifiersData[kt.name]=Object.assign({},kt.data)});for(var ze=0;ze<D.orderedModifiers.length;ze++)if(!0!==D.reset){var Je=D.orderedModifiers[ze],ht=Je.fn,Ne=Je.options;"function"==typeof ht&&(D=ht({state:D,options:void 0===Ne?{}:Ne,name:Je.name,instance:V})||D)}else D.reset=!1,ze=-1}}},update:jve(function(){return new Promise(function(Q){V.forceUpdate(),Q(D)})}),destroy:function(){G(),L=!0}};if(!JH(g,x))return V;function G(){R.forEach(function(Q){return Q()}),R=[]}return V.setOptions(E).then(function(Q){!L&&E.onFirstUpdate&&E.onFirstUpdate(Q)}),V}}var Hve=BO(),zO={passive:!0};const lL={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function Gve(e){var n=e.state,t=e.instance,r=e.options,i=r.scroll,l=void 0===i||i,u=r.resize,g=void 0===u||u,x=wd(n.elements.popper),E=[].concat(n.scrollParents.reference,n.scrollParents.popper);return l&&E.forEach(function(D){D.addEventListener("scroll",t.update,zO)}),g&&x.addEventListener("resize",t.update,zO),function(){l&&E.forEach(function(D){D.removeEventListener("scroll",t.update,zO)}),g&&x.removeEventListener("resize",t.update,zO)}},data:{}},cL={name:"popperOffsets",enabled:!0,phase:"read",fn:function Wve(e){var n=e.state;n.modifiersData[e.name]=qH({reference:n.rects.reference,element:n.rects.popper,strategy:"absolute",placement:n.placement})},data:{}};var qve={top:"auto",right:"auto",bottom:"auto",left:"auto"};function QH(e){var n,t=e.popper,r=e.popperRect,i=e.placement,l=e.variation,u=e.offsets,g=e.position,x=e.gpuAcceleration,E=e.adaptive,D=e.roundOffsets,R=e.isFixed,L=u.x,V=void 0===L?0:L,Y=u.y,G=void 0===Y?0:Y,Q="function"==typeof D?D({x:V,y:G}):{x:V,y:G};V=Q.x,G=Q.y;var he=u.hasOwnProperty("x"),le=u.hasOwnProperty("y"),me=nu,ze=tu,Je=window;if(E){var ht=yD(t),Ne="clientHeight",dt="clientWidth";ht===wd(t)&&"static"!==Hg(ht=c1(t)).position&&"absolute"===g&&(Ne="scrollHeight",dt="scrollWidth"),(i===tu||(i===nu||i===bd)&&l===L2)&&(ze=xd,G-=(R&&ht===Je&&Je.visualViewport?Je.visualViewport.height:ht[Ne])-r.height,G*=x?1:-1),i!==nu&&(i!==tu&&i!==xd||l!==L2)||(me=bd,V-=(R&&ht===Je&&Je.visualViewport?Je.visualViewport.width:ht[dt])-r.width,V*=x?1:-1)}var wn,$t=Object.assign({position:g},E&&qve),vt=!0===D?function Zve(e,n){var r=e.y,i=n.devicePixelRatio||1;return{x:z2(e.x*i)/i||0,y:z2(r*i)/i||0}}({x:V,y:G},wd(t)):{x:V,y:G};return V=vt.x,G=vt.y,Object.assign({},$t,x?((wn={})[ze]=le?"0":"",wn[me]=he?"0":"",wn.transform=(Je.devicePixelRatio||1)<=1?"translate("+V+"px, "+G+"px)":"translate3d("+V+"px, "+G+"px, 0)",wn):((n={})[ze]=le?G+"px":"",n[me]=he?V+"px":"",n.transform="",n))}const uL={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function Xve(e){var n=e.state,t=e.options,r=t.gpuAcceleration,i=void 0===r||r,l=t.adaptive,u=void 0===l||l,g=t.roundOffsets,x=void 0===g||g,E={placement:lm(n.placement),variation:V2(n.placement),popper:n.elements.popper,popperRect:n.rects.popper,gpuAcceleration:i,isFixed:"fixed"===n.options.strategy};null!=n.modifiersData.popperOffsets&&(n.styles.popper=Object.assign({},n.styles.popper,QH(Object.assign({},E,{offsets:n.modifiersData.popperOffsets,position:n.options.strategy,adaptive:u,roundOffsets:x})))),null!=n.modifiersData.arrow&&(n.styles.arrow=Object.assign({},n.styles.arrow,QH(Object.assign({},E,{offsets:n.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:x})))),n.attributes.popper=Object.assign({},n.attributes.popper,{"data-popper-placement":n.placement})},data:{}},dL={name:"applyStyles",enabled:!0,phase:"write",fn:function Yve(e){var n=e.state;Object.keys(n.elements).forEach(function(t){var r=n.styles[t]||{},i=n.attributes[t]||{},l=n.elements[t];!Fh(l)||!cm(l)||(Object.assign(l.style,r),Object.keys(i).forEach(function(u){var g=i[u];!1===g?l.removeAttribute(u):l.setAttribute(u,!0===g?"":g)}))})},effect:function Kve(e){var n=e.state,t={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(n.elements.popper.style,t.popper),n.styles=t,n.elements.arrow&&Object.assign(n.elements.arrow.style,t.arrow),function(){Object.keys(n.elements).forEach(function(r){var i=n.elements[r],l=n.attributes[r]||{},g=Object.keys(n.styles.hasOwnProperty(r)?n.styles[r]:t[r]).reduce(function(x,E){return x[E]="",x},{});!Fh(i)||!cm(i)||(Object.assign(i.style,g),Object.keys(l).forEach(function(x){i.removeAttribute(x)}))})}},requires:["computeStyles"]};var eG=BO({defaultModifiers:[lL,cL,uL,dL]});const hL={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function exe(e){var n=e.state,r=e.name,i=e.options.offset,l=void 0===i?[0,0]:i,u=Y4.reduce(function(D,R){return D[R]=function Qve(e,n,t){var r=lm(e),i=[nu,tu].indexOf(r)>=0?-1:1,l="function"==typeof t?t(Object.assign({},n,{placement:e})):t,u=l[0],g=l[1];return u=u||0,g=(g||0)*i,[nu,bd].indexOf(r)>=0?{x:g,y:u}:{x:u,y:g}}(R,n.rects,l),D},{}),g=u[n.placement],E=g.y;null!=n.modifiersData.popperOffsets&&(n.modifiersData.popperOffsets.x+=g.x,n.modifiersData.popperOffsets.y+=E),n.modifiersData[r]=u}},txe=["*"],kxe=["dialog"],nG={animation:!0,transitionTimerDelayMs:5};let UO=(()=>{class e{constructor(){this.animation=nG.animation}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function $2(e){return"string"==typeof e}function ex(e){return null!=e}function H2(e){return(e||document.body).getBoundingClientRect()}const Ebe=()=>{},{transitionTimerDelayMs:Cbe}=nG,xD=new Map,Lh=(e,n,t,r)=>{let i=r.context||{};const l=xD.get(n);if(l)switch(r.runningTransition){case"continue":return cd;case"stop":e.run(()=>l.transition$.complete()),i=Object.assign(l.context,i),xD.delete(n)}const u=t(n,r.animation,i)||Ebe;if(!r.animation||"none"===window.getComputedStyle(n).transitionProperty)return e.run(()=>u()),jr(void 0).pipe(function Tbe(e){return n=>new Di(t=>n.subscribe({next:u=>e.run(()=>t.next(u)),error:u=>e.run(()=>t.error(u)),complete:()=>e.run(()=>t.complete())}))}(e));const g=new Mi,x=new Mi,E=g.pipe(function hve(...e){return n=>uS(n,jr(...e))}(!0));xD.set(n,{transition$:g,complete:()=>{x.next(),x.complete()},context:i});const D=function xbe(e){const{transitionDelay:n,transitionDuration:t}=window.getComputedStyle(e);return 1e3*(parseFloat(n)+parseFloat(t))}(n);return e.runOutsideAngular(()=>{const R=Ea(n,"transitionend").pipe(Fo(E),Ga(({target:V})=>V===n));(function DH(...e){return 1===(e=SH(e)).length?Dl(e[0]):new Di(function dve(e){return n=>{let t=[];for(let r=0;t&&!n.closed&&r<e.length;r++)t.push(Dl(e[r]).subscribe(te(n,i=>{if(t){for(let l=0;l<t.length;l++)l!==r&&t[l].unsubscribe();t=null}n.next(i)})))}}(e))})(H4(D+Cbe).pipe(Fo(E)),R,x).pipe(Fo(E)).subscribe(()=>{xD.delete(n),e.run(()=>{u(),g.next(),g.complete()})})}),g.asObservable()};let cG=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),uG=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),fG=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),pG=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})();typeof navigator<"u"&&navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));const bG=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function wG(e){const n=Array.from(e.querySelectorAll(bG)).filter(t=>-1!==t.tabIndex);return[n[0],n[n.length-1]]}new Date(1882,10,12),new Date(2174,10,25);let BG=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),UG=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),Mwe=(()=>{class e{constructor(){this._ngbConfig=Qe(UO),this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0}get animation(){return this._animation??this._ngbConfig.animation}set animation(t){this._animation=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class sx{constructor(n,t,r){this.nodes=n,this.viewRef=t,this.componentRef=r}}let Awe=(()=>{class e{constructor(){this._document=Qe(Ro)}hide(){const t=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),r=this._document.body,i=r.style,{overflow:l,paddingRight:u}=i;if(t>0){const g=parseFloat(window.getComputedStyle(r).paddingRight);i.paddingRight=`${g+t}px`}return i.overflow="hidden",()=>{t>0&&(i.paddingRight=u),i.overflow=l}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Iwe=(()=>{class e{constructor(){this._nativeElement=Qe(Li).nativeElement,this._zone=Qe(ni)}ngOnInit(){this._zone.onStable.asObservable().pipe(xc(1)).subscribe(()=>{Lh(this._zone,this._nativeElement,(t,r)=>{r&&H2(t),t.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return Lh(this._zone,this._nativeElement,({classList:t})=>t.remove("show"),{animation:this.animation,runningTransition:"stop"})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Lr({type:e,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(r,i){2&r&&(RC("modal-backdrop"+(i.backdropClass?" "+i.backdropClass:"")),Xi("show",!i.animation)("fade",i.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},standalone:!0,features:[Bf],decls:0,vars:0,template:function(r,i){},encapsulation:2})}return e})();class VG{update(n){}close(n){}dismiss(n){}}const kwe=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","scrollable","size","windowClass","modalDialogClass"],Owe=["animation","backdropClass"];class Pwe{_applyWindowOptions(n,t){kwe.forEach(r=>{ex(t[r])&&(n[r]=t[r])})}_applyBackdropOptions(n,t){Owe.forEach(r=>{ex(t[r])&&(n[r]=t[r])})}update(n){this._applyWindowOptions(this._windowCmptRef.instance,n),this._backdropCmptRef&&this._backdropCmptRef.instance&&this._applyBackdropOptions(this._backdropCmptRef.instance,n)}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(Fo(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(Fo(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}constructor(n,t,r,i){this._windowCmptRef=n,this._contentRef=t,this._backdropCmptRef=r,this._beforeDismiss=i,this._closed=new Mi,this._dismissed=new Mi,this._hidden=new Mi,n.instance.dismissEvent.subscribe(l=>{this.dismiss(l)}),this.result=new Promise((l,u)=>{this._resolve=l,this._reject=u}),this.result.then(null,()=>{})}close(n){this._windowCmptRef&&(this._closed.next(n),this._resolve(n),this._removeModalElements())}_dismiss(n){this._dismissed.next(n),this._reject(n),this._removeModalElements()}dismiss(n){if(this._windowCmptRef)if(this._beforeDismiss){const t=this._beforeDismiss();!function rG(e){return e&&e.then}(t)?!1!==t&&this._dismiss(n):t.then(r=>{!1!==r&&this._dismiss(n)},()=>{})}else this._dismiss(n)}_removeModalElements(){const n=this._windowCmptRef.instance.hide(),t=this._backdropCmptRef?this._backdropCmptRef.instance.hide():jr(void 0);n.subscribe(()=>{const{nativeElement:r}=this._windowCmptRef.location;r.parentNode.removeChild(r),this._windowCmptRef.destroy(),this._contentRef?.viewRef?.destroy(),this._windowCmptRef=null,this._contentRef=null}),t.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:r}=this._backdropCmptRef.location;r.parentNode.removeChild(r),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),W4(n,t).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var DL=function(e){return e[e.BACKDROP_CLICK=0]="BACKDROP_CLICK",e[e.ESC=1]="ESC",e}(DL||{});let Rwe=(()=>{class e{constructor(){this._document=Qe(Ro),this._elRef=Qe(Li),this._zone=Qe(ni),this._closed$=new Mi,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new rr,this.shown=new Mi,this.hidden=new Mi}get fullscreenClass(){return!0===this.fullscreen?" modal-fullscreen":$2(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(t){this.dismissEvent.emit(t)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe(xc(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:t}=this._elRef,r={animation:this.animation,runningTransition:"stop"},u=W4(Lh(this._zone,t,()=>t.classList.remove("show"),r),Lh(this._zone,this._dialogEl.nativeElement,()=>{},r));return u.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),u}_show(){const t={animation:this.animation,runningTransition:"continue"};W4(Lh(this._zone,this._elRef.nativeElement,(l,u)=>{u&&H2(l),l.classList.add("show")},t),Lh(this._zone,this._dialogEl.nativeElement,()=>{},t)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:t}=this._elRef;this._zone.runOutsideAngular(()=>{Ea(t,"keydown").pipe(Fo(this._closed$),Ga(i=>"Escape"===i.key)).subscribe(i=>{this.keyboard?requestAnimationFrame(()=>{i.defaultPrevented||this._zone.run(()=>this.dismiss(DL.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let r=!1;Ea(this._dialogEl.nativeElement,"mousedown").pipe(Fo(this._closed$),Il(()=>r=!1),Sh(()=>Ea(t,"mouseup").pipe(Fo(this._closed$),xc(1))),Ga(({target:i})=>t===i)).subscribe(()=>{r=!0}),Ea(t,"click").pipe(Fo(this._closed$)).subscribe(({target:i})=>{t===i&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!r&&this._zone.run(()=>this.dismiss(DL.BACKDROP_CLICK))),r=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:t}=this._elRef;if(!t.contains(document.activeElement)){const r=t.querySelector("[ngbAutofocus]"),i=wG(t)[0];(r||i||t).focus()}}_restoreFocus(){const t=this._document.body,r=this._elWithFocus;let i;i=r&&r.focus&&t.contains(r)?r:t,this._zone.runOutsideAngular(()=>{setTimeout(()=>i.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&Lh(this._zone,this._elRef.nativeElement,({classList:t})=>(t.add("modal-static"),()=>t.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Lr({type:e,selectors:[["ngb-modal-window"]],viewQuery:function(r,i){if(1&r&&od(kxe,7),2&r){let l;_i(l=yi())&&(i._dialogEl=l.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(r,i){2&r&&(rs("aria-modal",!0)("aria-labelledby",i.ariaLabelledBy)("aria-describedby",i.ariaDescribedBy),RC("modal d-block"+(i.windowClass?" "+i.windowClass:"")),Xi("fade",i.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},standalone:!0,features:[Bf],ngContentSelectors:txe,decls:4,vars:2,consts:[["dialog",""],["role","document"],[1,"modal-content"]],template:function(r,i){1&r&&(yI(),P(0,"div",1,0)(2,"div",2),vI(3),O()()),2&r&&RC("modal-dialog"+(i.size?" modal-"+i.size:"")+(i.centered?" modal-dialog-centered":"")+i.fullscreenClass+(i.scrollable?" modal-dialog-scrollable":"")+(i.modalDialogClass?" "+i.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}\n"],encapsulation:2})}return e})(),Nwe=(()=>{class e{constructor(){this._applicationRef=Qe(wh),this._injector=Qe(zs),this._environmentInjector=Qe(Go),this._document=Qe(Ro),this._scrollBar=Qe(Awe),this._activeWindowCmptHasChanged=new Mi,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._modalRefs=[],this._windowCmpts=[],this._activeInstances=new rr;const t=Qe(ni);this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const r=this._windowCmpts[this._windowCmpts.length-1];((e,n,t,r=!1)=>{e.runOutsideAngular(()=>{const i=Ea(n,"focusin").pipe(Fo(t),pe(l=>l.target));Ea(n,"keydown").pipe(Fo(t),Ga(l=>"Tab"===l.key),q4(i)).subscribe(([l,u])=>{const[g,x]=wG(n);(u===g||u===n)&&l.shiftKey&&(x.focus(),l.preventDefault()),u===x&&!l.shiftKey&&(g.focus(),l.preventDefault())}),r&&Ea(n,"click").pipe(Fo(t),q4(i),pe(l=>l[1])).subscribe(l=>l.focus())})})(t,r.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(r.location.nativeElement)}})}_restoreScrollBar(){const t=this._scrollBarRestoreFn;t&&(this._scrollBarRestoreFn=null,t())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(t,r,i){const l=i.container instanceof HTMLElement?i.container:ex(i.container)?this._document.querySelector(i.container):this._document.body;if(!l)throw new Error(`The specified modal container "${i.container||"body"}" was not found in the DOM.`);this._hideScrollBar();const u=new VG,g=(t=i.injector||t).get(Go,null)||this._environmentInjector,x=this._getContentRef(t,g,r,u,i);let E=!1!==i.backdrop?this._attachBackdrop(l):void 0,D=this._attachWindowComponent(l,x.nodes),R=new Pwe(D,x,E,i.beforeDismiss);return this._registerModalRef(R),this._registerWindowCmpt(D),R.hidden.pipe(xc(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(this._document.body.classList.remove("modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),u.close=L=>{R.close(L)},u.dismiss=L=>{R.dismiss(L)},u.update=L=>{R.update(L)},R.update(i),1===this._modalRefs.length&&this._document.body.classList.add("modal-open"),E&&E.instance&&E.changeDetectorRef.detectChanges(),D.changeDetectorRef.detectChanges(),R}get activeInstances(){return this._activeInstances}dismissAll(t){this._modalRefs.forEach(r=>r.dismiss(t))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(t){let r=H3(Iwe,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(r.hostView),t.appendChild(r.location.nativeElement),r}_attachWindowComponent(t,r){let i=H3(Rwe,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:r});return this._applicationRef.attachView(i.hostView),t.appendChild(i.location.nativeElement),i}_getContentRef(t,r,i,l,u){return i?i instanceof ui?this._createFromTemplateRef(i,l):$2(i)?this._createFromString(i):this._createFromComponent(t,r,i,l,u):new sx([])}_createFromTemplateRef(t,r){const l=t.createEmbeddedView({$implicit:r,close(u){r.close(u)},dismiss(u){r.dismiss(u)}});return this._applicationRef.attachView(l),new sx([l.rootNodes],l)}_createFromString(t){const r=this._document.createTextNode(`${t}`);return new sx([[r]])}_createFromComponent(t,r,i,l,u){const x=H3(i,{environmentInjector:r,elementInjector:zs.create({providers:[{provide:VG,useValue:l}],parent:t})}),E=x.location.nativeElement;return u.scrollable&&E.classList.add("component-host-scrollable"),this._applicationRef.attachView(x.hostView),new sx([[E]],x.hostView,x)}_setAriaHidden(t){const r=t.parentElement;r&&t!==this._document.body&&(Array.from(r.children).forEach(i=>{i!==t&&"SCRIPT"!==i.nodeName&&(this._ariaHiddenValues.set(i,i.getAttribute("aria-hidden")),i.setAttribute("aria-hidden","true"))}),this._setAriaHidden(r))}_revertAriaHidden(){this._ariaHiddenValues.forEach((t,r)=>{t?r.setAttribute("aria-hidden",t):r.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(t){const r=()=>{const i=this._modalRefs.indexOf(t);i>-1&&(this._modalRefs.splice(i,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(t),this._activeInstances.emit(this._modalRefs),t.result.then(r,r)}_registerWindowCmpt(t){this._windowCmpts.push(t),this._activeWindowCmptHasChanged.next(),t.onDestroy(()=>{const r=this._windowCmpts.indexOf(t);r>-1&&(this._windowCmpts.splice(r,1),this._activeWindowCmptHasChanged.next())})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),jG=(()=>{class e{constructor(){this._injector=Qe(zs),this._modalStack=Qe(Nwe),this._config=Qe(Mwe)}open(t,r={}){const i={...this._config,animation:this._config.animation,...r};return this._modalStack.open(this._injector,t,i)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(t){this._modalStack.dismissAll(t)}hasOpenModals(){return this._modalStack.hasOpenModals()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),$G=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({providers:[jG]})}return e})(),WG=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),eW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),tW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),nW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),rW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),iW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),sW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),oW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),aW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})();new vn("live announcer delay",{providedIn:"root",factory:()=>100});let lW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})(),cW=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({})}return e})();const Ywe=[cG,uG,fG,pG,BG,UG,$G,WG,cW,eW,tW,nW,rW,iW,sW,oW,aW,lW];let Kwe=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({imports:[Ywe,cG,uG,fG,pG,BG,UG,$G,WG,cW,eW,tW,nW,rW,iW,sW,oW,aW,lW]})}return e})();const Jwe=(e,n,t,r)=>({"table-success":e,"table-warning":n,"table-primary":t,"table-danger":r}),Qwe=()=>["administrador"],e2e=(e,n)=>({"btn-danger":e,"btn-primary":n});function t2e(e,n){if(1&e){const t=lr();P(0,"tr",7),ct("click",function(){const i=Bt(t).$implicit,l=Ge(),u=xa(13);return zt(l.openEditModal(u,i))}),P(1,"td"),U(2),O(),P(3,"td"),U(4),O()()}if(2&e){const t=n.$implicit,r=Ge();Oe("ngClass",x3(3,Jwe,"Registrado"===t.status,"Registro parcial"===t.status,"Facturada"===t.status,(t.final_price_purchase>=1.4*t.price_purchase||t.final_price_purchase<=.4*t.price_purchase)&&0!=t.final_price_purchase)),W(2),tt(t.category.substring(0,3).toUpperCase()+" - "+t.name),W(2),tt(r.round(t.total_quantity)+" "+t.unit)}}function n2e(e,n){if(1&e&&(P(0,"div",24),U(1),O()),2&e){const t=Ge(2);W(),tt(t.successMessage)}}function r2e(e,n){if(1&e&&(P(0,"div",25),U(1),O()),2&e){const t=Ge(2);W(),tt(t.errorMessage)}}function i2e(e,n){if(1&e&&(P(0,"option",26),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t),W(),tt(t.nickname)}}function s2e(e,n){if(1&e&&(P(0,"option",26),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t),W(),tt(t)}}function o2e(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O()()),2&e){const t=n.$implicit;W(2),tt(t.client_name),W(2),tt(t.quantity)}}function a2e(e,n){if(1&e&&(P(0,"div")(1,"h6",27),U(2,"Clientes que pidieron este producto:"),O(),P(3,"table",4)(4,"thead")(5,"tr")(6,"th"),U(7,"Cliente"),O(),P(8,"th"),U(9,"Cantidad"),O()()(),P(10,"tbody"),gt(11,o2e,5,2,"tr",28),O()()()),2&e){const t=Ge(2);W(11),Oe("ngForOf",t.selectedProduct.clients)}}function l2e(e,n){if(1&e){const t=lr();P(0,"button",29),ct("click",function(){Bt(t);const i=Ge().$implicit,l=Ge();return l.deleteProduct(l.selectedProduct),zt(i.close("Delete click"))}),Rt(1,"i",30),O()}}function c2e(e,n){if(1&e){const t=lr();P(0,"button",31),ct("click",function(){Bt(t);const i=Ge().$implicit;return Ge().savePrice(),zt(i.close("Save click"))}),U(1," Guardar "),O()}if(2&e){const t=Ge(2);Oe("ngClass",yv(2,e2e,!t.isPriceValid,t.isPriceValid))("disabled",!t.isPriceValid)}}function u2e(e,n){if(1&e){const t=lr();P(0,"div",8)(1,"h5",9),U(2),O(),P(3,"button",10),ct("click",function(){return zt(Bt(t).$implicit.dismiss("Cross click"))}),O()(),P(4,"div",11),gt(5,n2e,2,1,"div",12)(6,r2e,2,1,"div",13),P(7,"div")(8,"label"),U(9,"Precio de Compra sugerido:"),O(),P(10,"span",14),U(11),O()(),P(12,"div")(13,"label"),U(14,"Precio de Compra:"),O(),P(15,"input",15),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.selectedProduct.final_price_purchase,i)||(l.selectedProduct.final_price_purchase=i),zt(i)}),O()(),P(16,"div")(17,"label"),U(18,"Proveedor:"),O(),P(19,"select",16),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.selectedProduct.proveedor,i)||(l.selectedProduct.proveedor=i),zt(i)}),gt(20,i2e,2,2,"option",17),O()(),P(21,"div")(22,"label"),U(23,"Tipo de transacci\xf3n:"),O(),P(24,"select",16),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.selectedProduct.type_transaction,i)||(l.selectedProduct.type_transaction=i),zt(i)}),gt(25,s2e,2,2,"option",17),O()(),gt(26,a2e,12,1,"div",18),P(27,"div")(28,"label"),U(29,"Inventario:"),O(),P(30,"span",14),U(31),O()(),P(32,"div")(33,"label"),U(34,"Pron\xf3stico:"),O(),P(35,"input",15),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.selectedProduct.forecast,i)||(l.selectedProduct.forecast=i),zt(i)}),O()()(),P(36,"div",19),gt(37,l2e,2,0,"button",20),P(38,"div",21)(39,"button",22),ct("click",function(){return zt(Bt(t).$implicit.dismiss("Cancel"))}),U(40,"Cancelar"),O(),gt(41,c2e,2,5,"button",23),O()()}if(2&e){const t=Ge();W(2),tt(t.selectedProduct.name),W(3),Oe("ngIf",t.successMessage),W(),Oe("ngIf",t.errorMessage),W(5),tt(t.redondear(t.selectedProduct.price_purchase)),W(4),Ct("ngModel",t.selectedProduct.final_price_purchase),W(4),Ct("ngModel",t.selectedProduct.proveedor),W(),Oe("ngForOf",t.suppliers),W(4),Ct("ngModel",t.selectedProduct.type_transaction),W(),Oe("ngForOf",t.transactionTypes),W(),Oe("ngIf",null==t.selectedProduct.clients?null:t.selectedProduct.clients.length),W(5),tt(t.selectedProduct.inventory),W(4),Ct("ngModel",t.selectedProduct.forecast),W(2),Oe("ngIf",t.hasRole(Va(14,Qwe))&&"Facturada"!=t.selectedProduct.status),W(4),Oe("ngIf","Facturada"!=t.selectedProduct.status)}}let d2e=(()=>{class e{constructor(t,r,i,l){this.route=t,this.purchaseService=r,this.modalService=i,this.supplierService=l,this.selectedProduct=null,this.editedPrice=null,this.purchaseNumber="",this.purchase=null,this.filteredProducts=[],this.searchTerm="",this.sortColumn="",this.sortDirection=1,this.successMessage=null,this.errorMessage=null,this.suppliers=[],this.transactionTypes=["Efectivo","Cr\xe9dito"],this.priceTolerance=1,this.isPriceValid=!0,this.role=[],this.route.params.subscribe(u=>{this.purchaseNumber=u.purchaseNumber})}ngOnInit(){const t=localStorage.getItem("role");this.role=t?JSON.parse(t):[],this.getPurchase(),this.supplierService.getSuppliers().subscribe(r=>{this.suppliers=r})}redondear(t){return Math.round(100*t)/100}getPurchase(){this.purchaseService.getPurchase(this.purchaseNumber).subscribe(t=>{this.purchase=t,this.filteredProducts=this.purchase.products.sort((r,i)=>r.category.toLowerCase()<i.category.toLowerCase()?-1:r.category.toLowerCase()>i.category.toLowerCase()?1:r.name.toLowerCase()<i.name.toLowerCase()?-1:r.name.toLowerCase()>i.name.toLowerCase()?1:0)})}filterProducts(){this.filteredProducts=this.purchase.products.filter(t=>t.name.toLowerCase().includes(this.searchTerm.toLowerCase()))}sortBy(t){this.sortColumn===t?this.sortDirection=-this.sortDirection:(this.sortColumn=t,this.sortDirection=1),this.filteredProducts.sort((r,i)=>r[t]<i[t]?-1*this.sortDirection:r[t]>i[t]?1*this.sortDirection:0)}openEditModal(t,r){this.selectedProduct=r,this.editedPrice=0,this.modalService.open(t),this.successMessage=null,this.errorMessage=null,this.selectedProduct.proveedor=this.suppliers.find(i=>i._id===r.proveedor._id)}savePrice(){let t="Creada";this.selectedProduct.final_price_purchase>0&&this.selectedProduct.proveedor?t="Registrado":(this.selectedProduct.final_price_purchase||this.selectedProduct.proveedor)&&(t="Registro parcial"),this.selectedProduct.status=t,this.purchaseService.updatePrice({sku:this.selectedProduct.sku,purchase_number:this.purchaseNumber,final_price_purchase:this.selectedProduct.final_price_purchase,forecast:this.selectedProduct.forecast,total_quantity:this.selectedProduct.total_quantity_ordered+this.selectedProduct.forecast-this.selectedProduct.inventory,proveedor:this.selectedProduct.proveedor,type_transaction:this.selectedProduct.type_transaction||"Efectivo",status:t}).subscribe(i=>{this.successMessage="Precio guardado exitosamente.",this.errorMessage=null,this.getPurchase()},i=>{this.successMessage=null,this.errorMessage="Error al guardar el precio."})}round(t){return Math.round(t)}deleteProduct(t){this.purchaseService.deleteProductFromPurchase(this.purchaseNumber,t.sku).subscribe(r=>{this.successMessage="Producto eliminado exitosamente.",this.errorMessage=null,this.getPurchase()},r=>{this.successMessage=null,this.errorMessage="Error al eliminar el producto."})}hasRole(t){return t.some(r=>this.role.includes(r))}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Su),ut(CH),ut(jG),ut(x4))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-purchase"]],decls:14,vars:2,consts:[["productModal",""],[1,"container-fluid","mt-5"],[1,"mb-3"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","ngModel"],[1,"table"],[3,"click"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"click","ngClass"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"form-control"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-control",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"modal-footer","d-flex","align-items-center"],["type","button","class","btn btn-link text-danger p-0 me-3",3,"click",4,"ngIf"],[1,"ms-auto","d-flex","gap-2"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button","class","btn",3,"ngClass","disabled","click",4,"ngIf"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[3,"ngValue"],[1,"mt-3"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-link","text-danger","p-0","me-3",3,"click"],[1,"fa","fa-trash"],["type","button",1,"btn",3,"click","ngClass","disabled"]],template:function(r,i){if(1&r){const l=lr();P(0,"div",1)(1,"div",2)(2,"input",3),St("ngModelChange",function(g){return Bt(l),Dt(i.searchTerm,g)||(i.searchTerm=g),zt(g)}),ct("ngModelChange",function(){return Bt(l),zt(i.filterProducts())}),O()(),P(3,"table",4)(4,"thead")(5,"tr")(6,"th",5),ct("click",function(){return Bt(l),zt(i.sortBy("name"))}),U(7,"Producto"),O(),P(8,"th",5),ct("click",function(){return Bt(l),zt(i.sortBy("total_quantity"))}),U(9,"Cantidad"),O()()(),P(10,"tbody"),gt(11,t2e,5,8,"tr",6),O()()(),gt(12,u2e,42,15,"ng-template",null,0,Sl)}2&r&&(W(2),Ct("ngModel",i.searchTerm),W(9),Oe("ngForOf",i.filteredProducts))},dependencies:[Zp,No,So,yd,vd,Hs,Nh,eu,so,oo],styles:[".table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}"]})}return e})(),IL=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}createAction(t){return this.http.post(`${this.baseUrl}api/action/action`,t)}getActions(t){return this.http.get(`${this.baseUrl}api/action/actions/${t}`)}getAction(t){return this.http.get(`${this.baseUrl}api/action/action/${t}`)}editAction(t,r){return this.http.put(`${this.baseUrl}api/action/action/${t}`,r)}deleteAction(t){return this.http.delete(`${this.baseUrl}api/action/action/${t}`)}getPotentialCustomers(){return this.http.get(`${this.baseUrl}api/action/potentialCustomers`)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const h2e=e=>({"table-success":e});function f2e(e,n){if(1&e&&(P(0,"div",12),U(1),Rt(2,"button",13),O()),2&e){const t=Ge();W(),Zn(" ",t.messageAction," ")}}function p2e(e,n){if(1&e){const t=lr();P(0,"div",17)(1,"button",7),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().resolver(i.actionNumber))}),Rt(2,"i",18),O()()}}function m2e(e,n){if(1&e){const t=lr();P(0,"tr",14),ct("click",function(){const i=Bt(t).$implicit,l=Ge();return zt("Creada"===i.status?l.navigateToaAction(i.actionNumber):l.viewAction(i))}),P(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td")(8,"div",15),gt(9,p2e,3,0,"div",16),O()()()}if(2&e){const t=n.$implicit;Oe("ngClass",ba(7,h2e,"Completada"===t.status)),rs("data-bs-toggle","Creada"!==t.status?"modal":null)("data-bs-target","Creada"!==t.status?"#viewModal":null),W(2),tt(t.dateAction),W(2),tt(t.customer.name||"Por seleccionar..."),W(2),tt(t.customer.address),W(3),Oe("ngIf","Completada"==t.status)}}function g2e(e,n){if(1&e&&(P(0,"div",26)(1,"label"),U(2,"N\xfamero de Pedido:"),O(),P(3,"p"),U(4),O()()),2&e){const t=Ge(2);W(4),tt(t.actionSelect.orderNumber)}}function _2e(e,n){if(1&e&&(P(0,"div",19)(1,"div",20)(2,"div",21)(3,"div",22)(4,"h5",23),U(5,"Detalles de la Acci\xf3n"),O(),Rt(6,"button",24),O(),P(7,"div",25)(8,"div",26)(9,"label"),U(10,"Fecha Ejecuci\xf3n:"),O(),P(11,"p"),U(12),O()(),P(13,"div",26)(14,"label"),U(15,"Cliente:"),O(),P(16,"p"),U(17),O()(),P(18,"div",26)(19,"label"),U(20,"Tel\xe9fono:"),O(),P(21,"p"),U(22),O()(),P(23,"div",26)(24,"label"),U(25,"Correo:"),O(),P(26,"p"),U(27),O()(),P(28,"div",26)(29,"label"),U(30,"Direcci\xf3n:"),O(),P(31,"p"),U(32),O()(),P(33,"div",26)(34,"label"),U(35,"Tipo de Acci\xf3n:"),O(),P(36,"p"),U(37),O()(),gt(38,g2e,5,1,"div",27),P(39,"div",26)(40,"label"),U(41,"Manager:"),O(),P(42,"p"),U(43),O()(),P(44,"div",26)(45,"label"),U(46,"Detalle Acci\xf3n:"),O(),P(47,"p"),U(48),O()(),P(49,"div",26)(50,"label"),U(51,"Tipo Soluci\xf3n:"),O(),P(52,"p"),U(53),O()(),P(54,"div",26)(55,"label"),U(56,"Detalle Soluci\xf3n:"),O(),P(57,"p"),U(58),O()(),P(59,"div",26)(60,"label"),U(61,"Fecha Soluci\xf3n:"),O(),P(62,"p"),U(63),O()(),P(64,"div",26)(65,"label"),U(66,"Estado:"),O(),P(67,"p"),U(68),O()()(),P(69,"div",28)(70,"button",29),U(71,"Cerrar"),O()()()()()),2&e){const t=Ge();W(12),tt(t.actionSelect.dateAction),W(5),tt(t.actionSelect.customer.name),W(5),tt(t.actionSelect.customer.phone),W(5),tt(t.actionSelect.customer.email),W(5),tt(t.actionSelect.customer.address),W(5),tt(t.actionSelect.type.name),W(),Oe("ngIf",t.actionSelect.orderNumber),W(5),tt(t.actionSelect.manager),W(5),tt(t.actionSelect.actionComment),W(5),tt(t.actionSelect.solutionType),W(5),tt(t.actionSelect.solutionComment),W(5),tt(t.actionSelect.dateSolution),W(5),tt(t.actionSelect.status)}}let y2e=(()=>{class e{constructor(t,r,i){this.actionService=t,this.router=r,this.datePipe=i,this.searchText="",this.messageAction="",this.statusCodeAction="",this.managers=["Ferney","Cata","Diago","Saco"],this.today=new Date,this.yyyy=this.today.getFullYear(),this.mm=String(this.today.getMonth()+1).padStart(2,"0"),this.dd=String(this.today.getDate()).padStart(2,"0"),this.searchDate=`${this.yyyy}-${this.mm}-${this.dd}`,this.selectedManager=null}ngOnInit(){this.getActions(),this.selectedManager=localStorage.getItem("username")}navigateToaAction(t){this.router.navigate(["/edit_action",t])}filterActions(){this.filteredActions=""!==this.searchText.trim()?this.actions?.filter(t=>{const r=this.searchText.toLowerCase();return t.customer.name&&t.customer.name.toLowerCase().includes(r)||t.customer.address&&t.customer.address.toLowerCase().includes(r)||t.customer.phone&&t.customer.phone.toLowerCase().includes(r)||t.customer.email&&t.customer.email.toLowerCase().includes(r)||t.manager&&t.manager.toLowerCase().includes(r)||t.status&&t.status.toLowerCase().includes(r)||t.actionComment&&t.actionComment.toLowerCase().includes(r)||t.solutionType&&t.solutionType.toLowerCase().includes(r)||t.solutionComment&&t.solutionComment.toLowerCase().includes(r)}):this.actions}newAction(){this.router.navigate(["/newAction"])}getActions(){this.actionService.getActions(this.searchDate).subscribe(t=>{this.actions=t,this.filteredActions=this.actions})}delete_action(t){this.actionService.deleteAction(t).subscribe(r=>{this.getActions(),this.messageAction="Accion eliminada exitosamente!",this.statusCodeAction=r.statusCode||"200",setTimeout(()=>{this.messageAction=""},3e3)},r=>{this.messageAction="Fallo al eliminar la accion.",this.statusCodeAction=r.status||"500",setTimeout(()=>{this.messageAction=""},3e3)})}resolver(t){this.router.navigate(["/edit_action",t])}viewAction(t){this.actionSelect=t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(IL),ut(ws),ut(Jw))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-list-actionns-customers"]],decls:26,vars:5,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-12"],["type","text","placeholder","Buscar acci\xf3n...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"row","justify-right","text-center"],[1,"col-6"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-primary",3,"click"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[3,"ngClass","click",4,"ngFor","ngForOf"],["class","modal fade","id","viewModal","tabindex","-1","aria-labelledby","viewModalLabel","aria-hidden","true",4,"ngIf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[3,"click","ngClass"],[1,"row"],["class","col-auto",4,"ngIf"],[1,"col-auto"],[1,"fa","fa-pencil"],["id","viewModal","tabindex","-1","aria-labelledby","viewModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","viewModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"form-group","mb-3"],["class","form-group mb-3",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterActions()}),O()()(),Rt(4,"br"),P(5,"div",4)(6,"div",5)(7,"input",6),St("ngModelChange",function(u){return Dt(i.searchDate,u)||(i.searchDate=u),u}),ct("ngModelChange",function(){return i.getActions()}),O()(),P(8,"div",5)(9,"button",7),ct("click",function(){return i.newAction()}),U(10,"Nueva Acci\xf3n"),O()()(),gt(11,f2e,3,1,"div",8),P(12,"table",9)(13,"thead")(14,"tr")(15,"th"),U(16," Fecha "),O(),P(17,"th"),U(18," Cliente "),O(),P(19,"th"),U(20," Direcci\xf3n"),O(),P(21,"th"),U(22," Opciones"),O()()(),P(23,"tbody"),gt(24,m2e,10,9,"tr",10),O()()(),gt(25,_2e,72,13,"div",11)),2&r&&(W(3),Ct("ngModel",i.searchText),W(4),Ct("ngModel",i.searchDate),W(4),Oe("ngIf",i.messageAction),W(13),Oe("ngForOf",i.filteredActions),W(),Oe("ngIf",i.actionSelect))},dependencies:[Zp,No,So,Hs,so,oo]})}return e})();var uW=Ja(247);function dW(e,n,t){return void 0===t&&(t={x:0,y:0}),{top:e.top-n.height-t.y,right:e.right-n.width+t.x,bottom:e.bottom-n.height+t.y,left:e.left-n.width-t.x}}function hW(e){return[tu,bd,xd,nu].some(function(n){return e[n]>=0})}const fW={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function v2e(e){var n=e.state,t=e.name,r=n.rects.reference,i=n.rects.popper,l=n.modifiersData.preventOverflow,u=j2(n,{elementContext:"reference"}),g=j2(n,{altBoundary:!0}),x=dW(u,r),E=dW(g,i,l),D=hW(x),R=hW(E);n.modifiersData[t]={referenceClippingOffsets:x,popperEscapeOffsets:E,isReferenceHidden:D,hasPopperEscaped:R},n.attributes.popper=Object.assign({},n.attributes.popper,{"data-popper-reference-hidden":D,"data-popper-escaped":R})}};var kL=BO({defaultModifiers:[lL,cL,uL,dL,hL,iL,oL,aL,fW]});const u1=new Map,OL={set(e,n,t){u1.has(e)||u1.set(e,new Map);const r=u1.get(e);r.has(n)||0===r.size?r.set(n,t):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(r.keys())[0]}.`)},get:(e,n)=>u1.has(e)&&u1.get(e).get(n)||null,remove(e,n){if(!u1.has(e))return;const t=u1.get(e);t.delete(n),0===t.size&&u1.delete(e)}},PL="transitionend",pW=e=>(e&&window.CSS&&window.CSS.escape&&(e=e.replace(/#([^\s"#']+)/g,(n,t)=>`#${CSS.escape(t)}`)),e),mW=e=>{e.dispatchEvent(new Event(PL))},Gg=e=>!(!e||"object"!=typeof e)&&(typeof e.jquery<"u"&&(e=e[0]),typeof e.nodeType<"u"),d1=e=>Gg(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(pW(e)):null,q2=e=>{if(!Gg(e)||0===e.getClientRects().length)return!1;const n="visible"===getComputedStyle(e).getPropertyValue("visibility"),t=e.closest("details:not([open])");if(!t)return n;if(t!==e){const r=e.closest("summary");if(r&&r.parentNode!==t||null===r)return!1}return n},h1=e=>!(e&&e.nodeType===Node.ELEMENT_NODE&&!e.classList.contains("disabled"))||(typeof e.disabled<"u"?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled")),gW=e=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof e.getRootNode){const n=e.getRootNode();return n instanceof ShadowRoot?n:null}return e instanceof ShadowRoot?e:e.parentNode?gW(e.parentNode):null},QO=()=>{},_W=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,RL=[],Bh=()=>"rtl"===document.documentElement.dir,zh=e=>{(e=>{"loading"===document.readyState?(RL.length||document.addEventListener("DOMContentLoaded",()=>{for(const n of RL)n()}),RL.push(e)):e()})(()=>{const n=_W();if(n){const t=e.NAME,r=n.fn[t];n.fn[t]=e.jQueryInterface,n.fn[t].Constructor=e,n.fn[t].noConflict=()=>(n.fn[t]=r,e.jQueryInterface)}})},Iu=(e,n=[],t=e)=>"function"==typeof e?e(...n):t,yW=(e,n,t=!0)=>{if(!t)return void Iu(e);const i=(e=>{if(!e)return 0;let{transitionDuration:n,transitionDelay:t}=window.getComputedStyle(e);const r=Number.parseFloat(n),i=Number.parseFloat(t);return r||i?(n=n.split(",")[0],t=t.split(",")[0],1e3*(Number.parseFloat(n)+Number.parseFloat(t))):0})(n)+5;let l=!1;const u=({target:g})=>{g===n&&(l=!0,n.removeEventListener(PL,u),Iu(e))};n.addEventListener(PL,u),setTimeout(()=>{l||mW(n)},i)},NL=(e,n,t,r)=>{const i=e.length;let l=e.indexOf(n);return-1===l?!t&&r?e[i-1]:e[0]:(l+=t?1:-1,r&&(l=(l+i)%i),e[Math.max(0,Math.min(l,i-1))])},D2e=/[^.]*(?=\..*)\.|.*/,M2e=/\..*/,A2e=/::\d+$/,FL={};let vW=1;const xW={mouseenter:"mouseover",mouseleave:"mouseout"},I2e=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function bW(e,n){return n&&`${n}::${vW++}`||e.uidEvent||vW++}function wW(e){const n=bW(e);return e.uidEvent=n,FL[n]=FL[n]||{},FL[n]}function TW(e,n,t=null){return Object.values(e).find(r=>r.callable===n&&r.delegationSelector===t)}function EW(e,n,t){const r="string"==typeof n,i=r?t:n||t;let l=SW(e);return I2e.has(l)||(l=e),[r,i,l]}function CW(e,n,t,r,i){if("string"!=typeof n||!e)return;let[l,u,g]=EW(n,t,r);var Y;n in xW&&(Y=u,u=function(G){if(!G.relatedTarget||G.relatedTarget!==G.delegateTarget&&!G.delegateTarget.contains(G.relatedTarget))return Y.call(this,G)});const x=wW(e),E=x[g]||(x[g]={}),D=TW(E,u,l?t:null);if(D)return void(D.oneOff=D.oneOff&&i);const R=bW(u,n.replace(D2e,"")),L=l?function O2e(e,n,t){return function r(i){const l=e.querySelectorAll(n);for(let{target:u}=i;u&&u!==this;u=u.parentNode)for(const g of l)if(g===u)return BL(i,{delegateTarget:u}),r.oneOff&&bn.off(e,i.type,n,t),t.apply(u,[i])}}(e,t,u):function k2e(e,n){return function t(r){return BL(r,{delegateTarget:e}),t.oneOff&&bn.off(e,r.type,n),n.apply(e,[r])}}(e,u);L.delegationSelector=l?t:null,L.callable=u,L.oneOff=i,L.uidEvent=R,E[R]=L,e.addEventListener(g,L,l)}function LL(e,n,t,r,i){const l=TW(n[t],r,i);l&&(e.removeEventListener(t,l,!!i),delete n[t][l.uidEvent])}function P2e(e,n,t,r){const i=n[t]||{};for(const[l,u]of Object.entries(i))l.includes(r)&&LL(e,n,t,u.callable,u.delegationSelector)}function SW(e){return e=e.replace(M2e,""),xW[e]||e}const bn={on(e,n,t,r){CW(e,n,t,r,!1)},one(e,n,t,r){CW(e,n,t,r,!0)},off(e,n,t,r){if("string"!=typeof n||!e)return;const[i,l,u]=EW(n,t,r),g=u!==n,x=wW(e),E=x[u]||{},D=n.startsWith(".");if(typeof l<"u"){if(!Object.keys(E).length)return;LL(e,x,u,l,i?t:null)}else{if(D)for(const R of Object.keys(x))P2e(e,x,R,n.slice(1));for(const[R,L]of Object.entries(E)){const V=R.replace(A2e,"");(!g||n.includes(V))&&LL(e,x,u,L.callable,L.delegationSelector)}}},trigger(e,n,t){if("string"!=typeof n||!e)return null;const r=_W();let u=null,g=!0,x=!0,E=!1;n!==SW(n)&&r&&(u=r.Event(n,t),r(e).trigger(u),g=!u.isPropagationStopped(),x=!u.isImmediatePropagationStopped(),E=u.isDefaultPrevented());const D=BL(new Event(n,{bubbles:g,cancelable:!0}),t);return E&&D.preventDefault(),x&&e.dispatchEvent(D),D.defaultPrevented&&u&&u.preventDefault(),D}};function BL(e,n={}){for(const[t,r]of Object.entries(n))try{e[t]=r}catch{Object.defineProperty(e,t,{configurable:!0,get:()=>r})}return e}function DW(e){if("true"===e)return!0;if("false"===e)return!1;if(e===Number(e).toString())return Number(e);if(""===e||"null"===e)return null;if("string"!=typeof e)return e;try{return JSON.parse(decodeURIComponent(e))}catch{return e}}function zL(e){return e.replace(/[A-Z]/g,n=>`-${n.toLowerCase()}`)}const Wg={setDataAttribute(e,n,t){e.setAttribute(`data-bs-${zL(n)}`,t)},removeDataAttribute(e,n){e.removeAttribute(`data-bs-${zL(n)}`)},getDataAttributes(e){if(!e)return{};const n={},t=Object.keys(e.dataset).filter(r=>r.startsWith("bs")&&!r.startsWith("bsConfig"));for(const r of t){let i=r.replace(/^bs/,"");i=i.charAt(0).toLowerCase()+i.slice(1,i.length),n[i]=DW(e.dataset[r])}return n},getDataAttribute:(e,n)=>DW(e.getAttribute(`data-bs-${zL(n)}`))};class ED{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(n){return n=this._mergeConfigObj(n),n=this._configAfterMerge(n),this._typeCheckConfig(n),n}_configAfterMerge(n){return n}_mergeConfigObj(n,t){const r=Gg(t)?Wg.getDataAttribute(t,"config"):{};return{...this.constructor.Default,..."object"==typeof r?r:{},...Gg(t)?Wg.getDataAttributes(t):{},..."object"==typeof n?n:{}}}_typeCheckConfig(n,t=this.constructor.DefaultType){for(const[r,i]of Object.entries(t)){const l=n[r],u=Gg(l)?"element":null==(e=l)?`${e}`:Object.prototype.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(i).test(u))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${r}" provided type "${u}" but expected type "${i}".`)}var e}}class Zf extends ED{constructor(n,t){super(),(n=d1(n))&&(this._element=n,this._config=this._getConfig(t),OL.set(this._element,this.constructor.DATA_KEY,this))}dispose(){OL.remove(this._element,this.constructor.DATA_KEY),bn.off(this._element,this.constructor.EVENT_KEY);for(const n of Object.getOwnPropertyNames(this))this[n]=null}_queueCallback(n,t,r=!0){yW(n,t,r)}_getConfig(n){return n=this._mergeConfigObj(n,this._element),n=this._configAfterMerge(n),this._typeCheckConfig(n),n}static getInstance(n){return OL.get(d1(n),this.DATA_KEY)}static getOrCreateInstance(n,t={}){return this.getInstance(n)||new this(n,"object"==typeof t?t:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(n){return`${n}${this.EVENT_KEY}`}}const UL=e=>{let n=e.getAttribute("data-bs-target");if(!n||"#"===n){let t=e.getAttribute("href");if(!t||!t.includes("#")&&!t.startsWith("."))return null;t.includes("#")&&!t.startsWith("#")&&(t=`#${t.split("#")[1]}`),n=t&&"#"!==t?t.trim():null}return n?n.split(",").map(t=>pW(t)).join(","):null},Rr={find:(e,n=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(n,e)),findOne:(e,n=document.documentElement)=>Element.prototype.querySelector.call(n,e),children:(e,n)=>[].concat(...e.children).filter(t=>t.matches(n)),parents(e,n){const t=[];let r=e.parentNode.closest(n);for(;r;)t.push(r),r=r.parentNode.closest(n);return t},prev(e,n){let t=e.previousElementSibling;for(;t;){if(t.matches(n))return[t];t=t.previousElementSibling}return[]},next(e,n){let t=e.nextElementSibling;for(;t;){if(t.matches(n))return[t];t=t.nextElementSibling}return[]},focusableChildren(e){const n=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(t=>`${t}:not([tabindex^="-"])`).join(",");return this.find(n,e).filter(t=>!h1(t)&&q2(t))},getSelectorFromElement(e){const n=UL(e);return n&&Rr.findOne(n)?n:null},getElementFromSelector(e){const n=UL(e);return n?Rr.findOne(n):null},getMultipleElementsFromSelector(e){const n=UL(e);return n?Rr.find(n):[]}},eP=(e,n="hide")=>{const r=e.NAME;bn.on(document,`click.dismiss${e.EVENT_KEY}`,`[data-bs-dismiss="${r}"]`,function(i){if(["A","AREA"].includes(this.tagName)&&i.preventDefault(),h1(this))return;const l=Rr.getElementFromSelector(this)||this.closest(`.${r}`);e.getOrCreateInstance(l)[n]()})},MW=".bs.alert",F2e=`close${MW}`,L2e=`closed${MW}`;class tP extends Zf{static get NAME(){return"alert"}close(){if(bn.trigger(this._element,F2e).defaultPrevented)return;this._element.classList.remove("show");const t=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,t)}_destroyElement(){this._element.remove(),bn.trigger(this._element,L2e),this.dispose()}static jQueryInterface(n){return this.each(function(){const t=tP.getOrCreateInstance(this);if("string"==typeof n){if(void 0===t[n]||n.startsWith("_")||"constructor"===n)throw new TypeError(`No method named "${n}"`);t[n](this)}})}}eP(tP,"close"),zh(tP);const AW='[data-bs-toggle="button"]';class nP extends Zf{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(n){return this.each(function(){const t=nP.getOrCreateInstance(this);"toggle"===n&&t[n]()})}}bn.on(document,"click.bs.button.data-api",AW,e=>{e.preventDefault();const n=e.target.closest(AW);nP.getOrCreateInstance(n).toggle()}),zh(nP);const Z2=".bs.swipe",W2e=`touchstart${Z2}`,q2e=`touchmove${Z2}`,Z2e=`touchend${Z2}`,X2e=`pointerdown${Z2}`,Y2e=`pointerup${Z2}`,tTe={endCallback:null,leftCallback:null,rightCallback:null},nTe={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class rP extends ED{constructor(n,t){super(),this._element=n,n&&rP.isSupported()&&(this._config=this._getConfig(t),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return tTe}static get DefaultType(){return nTe}static get NAME(){return"swipe"}dispose(){bn.off(this._element,Z2)}_start(n){this._supportPointerEvents?this._eventIsPointerPenTouch(n)&&(this._deltaX=n.clientX):this._deltaX=n.touches[0].clientX}_end(n){this._eventIsPointerPenTouch(n)&&(this._deltaX=n.clientX-this._deltaX),this._handleSwipe(),Iu(this._config.endCallback)}_move(n){this._deltaX=n.touches&&n.touches.length>1?0:n.touches[0].clientX-this._deltaX}_handleSwipe(){const n=Math.abs(this._deltaX);if(n<=40)return;const t=n/this._deltaX;this._deltaX=0,t&&Iu(t>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(bn.on(this._element,X2e,n=>this._start(n)),bn.on(this._element,Y2e,n=>this._end(n)),this._element.classList.add("pointer-event")):(bn.on(this._element,W2e,n=>this._start(n)),bn.on(this._element,q2e,n=>this._move(n)),bn.on(this._element,Z2e,n=>this._end(n)))}_eventIsPointerPenTouch(n){return this._supportPointerEvents&&("pen"===n.pointerType||"touch"===n.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const f1=".bs.carousel",IW=".data-api",CD="next",X2="prev",Y2="left",iP="right",aTe=`slide${f1}`,VL=`slid${f1}`,lTe=`keydown${f1}`,cTe=`mouseenter${f1}`,uTe=`mouseleave${f1}`,dTe=`dragstart${f1}`,hTe=`load${f1}${IW}`,fTe=`click${f1}${IW}`,kW="carousel",sP="active",OW=".active",PW=".carousel-item",vTe=OW+PW,ETe={ArrowLeft:iP,ArrowRight:Y2},CTe={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},STe={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class SD extends Zf{constructor(n,t){super(n,t),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Rr.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===kW&&this.cycle()}static get Default(){return CTe}static get DefaultType(){return STe}static get NAME(){return"carousel"}next(){this._slide(CD)}nextWhenVisible(){!document.hidden&&q2(this._element)&&this.next()}prev(){this._slide(X2)}pause(){this._isSliding&&mW(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding)return void bn.one(this._element,VL,()=>this.cycle());this.cycle()}}to(n){const t=this._getItems();if(n>t.length-1||n<0)return;if(this._isSliding)return void bn.one(this._element,VL,()=>this.to(n));const r=this._getItemIndex(this._getActive());r!==n&&this._slide(n>r?CD:X2,t[n])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(n){return n.defaultInterval=n.interval,n}_addEventListeners(){this._config.keyboard&&bn.on(this._element,lTe,n=>this._keydown(n)),"hover"===this._config.pause&&(bn.on(this._element,cTe,()=>this.pause()),bn.on(this._element,uTe,()=>this._maybeEnableCycle())),this._config.touch&&rP.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const r of Rr.find(".carousel-item img",this._element))bn.on(r,dTe,i=>i.preventDefault());this._swipeHelper=new rP(this._element,{leftCallback:()=>this._slide(this._directionToOrder(Y2)),rightCallback:()=>this._slide(this._directionToOrder(iP)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}})}_keydown(n){if(/input|textarea/i.test(n.target.tagName))return;const t=ETe[n.key];t&&(n.preventDefault(),this._slide(this._directionToOrder(t)))}_getItemIndex(n){return this._getItems().indexOf(n)}_setActiveIndicatorElement(n){if(!this._indicatorsElement)return;const t=Rr.findOne(OW,this._indicatorsElement);t.classList.remove(sP),t.removeAttribute("aria-current");const r=Rr.findOne(`[data-bs-slide-to="${n}"]`,this._indicatorsElement);r&&(r.classList.add(sP),r.setAttribute("aria-current","true"))}_updateInterval(){const n=this._activeElement||this._getActive();if(!n)return;const t=Number.parseInt(n.getAttribute("data-bs-interval"),10);this._config.interval=t||this._config.defaultInterval}_slide(n,t=null){if(this._isSliding)return;const r=this._getActive(),i=n===CD,l=t||NL(this._getItems(),r,i,this._config.wrap);if(l===r)return;const u=this._getItemIndex(l),g=V=>bn.trigger(this._element,V,{relatedTarget:l,direction:this._orderToDirection(n),from:this._getItemIndex(r),to:u});if(g(aTe).defaultPrevented||!r||!l)return;const E=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(u),this._activeElement=l;const D=i?"carousel-item-start":"carousel-item-end",R=i?"carousel-item-next":"carousel-item-prev";l.classList.add(R),r.classList.add(D),l.classList.add(D),this._queueCallback(()=>{l.classList.remove(D,R),l.classList.add(sP),r.classList.remove(sP,R,D),this._isSliding=!1,g(VL)},r,this._isAnimated()),E&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Rr.findOne(vTe,this._element)}_getItems(){return Rr.find(PW,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(n){return Bh()?n===Y2?X2:CD:n===Y2?CD:X2}_orderToDirection(n){return Bh()?n===X2?Y2:iP:n===X2?iP:Y2}static jQueryInterface(n){return this.each(function(){const t=SD.getOrCreateInstance(this,n);if("number"!=typeof n){if("string"==typeof n){if(void 0===t[n]||n.startsWith("_")||"constructor"===n)throw new TypeError(`No method named "${n}"`);t[n]()}}else t.to(n)})}}bn.on(document,fTe,"[data-bs-slide], [data-bs-slide-to]",function(e){const n=Rr.getElementFromSelector(this);if(!n||!n.classList.contains(kW))return;e.preventDefault();const t=SD.getOrCreateInstance(n),r=this.getAttribute("data-bs-slide-to");return r?(t.to(r),void t._maybeEnableCycle()):"next"===Wg.getDataAttribute(this,"slide")?(t.next(),void t._maybeEnableCycle()):(t.prev(),void t._maybeEnableCycle())}),bn.on(window,hTe,()=>{const e=Rr.find('[data-bs-ride="carousel"]');for(const n of e)SD.getOrCreateInstance(n)}),zh(SD);const DD=".bs.collapse",ATe=`show${DD}`,ITe=`shown${DD}`,kTe=`hide${DD}`,OTe=`hidden${DD}`,PTe=`click${DD}.data-api`,jL="show",K2="collapse",oP="collapsing",NTe=`:scope .${K2} .${K2}`,$L='[data-bs-toggle="collapse"]',UTe={parent:null,toggle:!0},VTe={parent:"(null|element)",toggle:"boolean"};class MD extends Zf{constructor(n,t){super(n,t),this._isTransitioning=!1,this._triggerArray=[];const r=Rr.find($L);for(const i of r){const l=Rr.getSelectorFromElement(i),u=Rr.find(l).filter(g=>g===this._element);null!==l&&u.length&&this._triggerArray.push(i)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return UTe}static get DefaultType(){return VTe}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let n=[];if(this._config.parent&&(n=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(g=>g!==this._element).map(g=>MD.getOrCreateInstance(g,{toggle:!1}))),n.length&&n[0]._isTransitioning||bn.trigger(this._element,ATe).defaultPrevented)return;for(const g of n)g.hide();const r=this._getDimension();this._element.classList.remove(K2),this._element.classList.add(oP),this._element.style[r]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const u=`scroll${r[0].toUpperCase()+r.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(oP),this._element.classList.add(K2,jL),this._element.style[r]="",bn.trigger(this._element,ITe)},this._element,!0),this._element.style[r]=`${this._element[u]}px`}hide(){if(this._isTransitioning||!this._isShown()||bn.trigger(this._element,kTe).defaultPrevented)return;const t=this._getDimension();this._element.style[t]=`${this._element.getBoundingClientRect()[t]}px`,this._element.classList.add(oP),this._element.classList.remove(K2,jL);for(const i of this._triggerArray){const l=Rr.getElementFromSelector(i);l&&!this._isShown(l)&&this._addAriaAndCollapsedClass([i],!1)}this._isTransitioning=!0,this._element.style[t]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(oP),this._element.classList.add(K2),bn.trigger(this._element,OTe)},this._element,!0)}_isShown(n=this._element){return n.classList.contains(jL)}_configAfterMerge(n){return n.toggle=!!n.toggle,n.parent=d1(n.parent),n}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const n=this._getFirstLevelChildren($L);for(const t of n){const r=Rr.getElementFromSelector(t);r&&this._addAriaAndCollapsedClass([t],this._isShown(r))}}_getFirstLevelChildren(n){const t=Rr.find(NTe,this._config.parent);return Rr.find(n,this._config.parent).filter(r=>!t.includes(r))}_addAriaAndCollapsedClass(n,t){if(n.length)for(const r of n)r.classList.toggle("collapsed",!t),r.setAttribute("aria-expanded",t)}static jQueryInterface(n){const t={};return"string"==typeof n&&/show|hide/.test(n)&&(t.toggle=!1),this.each(function(){const r=MD.getOrCreateInstance(this,t);if("string"==typeof n){if(typeof r[n]>"u")throw new TypeError(`No method named "${n}"`);r[n]()}})}}bn.on(document,PTe,$L,function(e){("A"===e.target.tagName||e.delegateTarget&&"A"===e.delegateTarget.tagName)&&e.preventDefault();for(const n of Rr.getMultipleElementsFromSelector(this))MD.getOrCreateInstance(n,{toggle:!1}).toggle()}),zh(MD);const RW="dropdown",ox=".bs.dropdown",HL=".data-api",$Te="ArrowUp",FW="ArrowDown",GTe=`hide${ox}`,WTe=`hidden${ox}`,qTe=`show${ox}`,ZTe=`shown${ox}`,LW=`click${ox}${HL}`,BW=`keydown${ox}${HL}`,XTe=`keyup${ox}${HL}`,J2="show",ax='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',tEe=`${ax}.${J2}`,aP=".dropdown-menu",sEe=Bh()?"top-end":"top-start",oEe=Bh()?"top-start":"top-end",aEe=Bh()?"bottom-end":"bottom-start",lEe=Bh()?"bottom-start":"bottom-end",cEe=Bh()?"left-start":"right-start",uEe=Bh()?"right-start":"left-start",fEe={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},pEe={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class um extends Zf{constructor(n,t){super(n,t),this._popper=null,this._parent=this._element.parentNode,this._menu=Rr.next(this._element,aP)[0]||Rr.prev(this._element,aP)[0]||Rr.findOne(aP,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return fEe}static get DefaultType(){return pEe}static get NAME(){return RW}toggle(){return this._isShown()?this.hide():this.show()}show(){if(h1(this._element)||this._isShown())return;const n={relatedTarget:this._element};if(!bn.trigger(this._element,qTe,n).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const r of[].concat(...document.body.children))bn.on(r,"mouseover",QO);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(J2),this._element.classList.add(J2),bn.trigger(this._element,ZTe,n)}}hide(){!h1(this._element)&&this._isShown()&&this._completeHide({relatedTarget:this._element})}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(n){if(!bn.trigger(this._element,GTe,n).defaultPrevented){if("ontouchstart"in document.documentElement)for(const r of[].concat(...document.body.children))bn.off(r,"mouseover",QO);this._popper&&this._popper.destroy(),this._menu.classList.remove(J2),this._element.classList.remove(J2),this._element.setAttribute("aria-expanded","false"),Wg.removeDataAttribute(this._menu,"popper"),bn.trigger(this._element,WTe,n)}}_getConfig(n){if("object"==typeof(n=super._getConfig(n)).reference&&!Gg(n.reference)&&"function"!=typeof n.reference.getBoundingClientRect)throw new TypeError(`${RW.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return n}_createPopper(){if(typeof Ic>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let n=this._element;"parent"===this._config.reference?n=this._parent:Gg(this._config.reference)?n=d1(this._config.reference):"object"==typeof this._config.reference&&(n=this._config.reference);const t=this._getPopperConfig();this._popper=kL(n,this._menu,t)}_isShown(){return this._menu.classList.contains(J2)}_getPlacement(){const n=this._parent;if(n.classList.contains("dropend"))return cEe;if(n.classList.contains("dropstart"))return uEe;if(n.classList.contains("dropup-center"))return"top";if(n.classList.contains("dropdown-center"))return"bottom";const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return n.classList.contains("dropup")?t?oEe:sEe:t?lEe:aEe}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:n}=this._config;return"string"==typeof n?n.split(",").map(t=>Number.parseInt(t,10)):"function"==typeof n?t=>n(t,this._element):n}_getPopperConfig(){const n={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(Wg.setDataAttribute(this._menu,"popper","static"),n.modifiers=[{name:"applyStyles",enabled:!1}]),{...n,...Iu(this._config.popperConfig,[n])}}_selectMenuItem({key:n,target:t}){const r=Rr.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(i=>q2(i));r.length&&NL(r,t,n===FW,!r.includes(t)).focus()}static jQueryInterface(n){return this.each(function(){const t=um.getOrCreateInstance(this,n);if("string"==typeof n){if(typeof t[n]>"u")throw new TypeError(`No method named "${n}"`);t[n]()}})}static clearMenus(n){if(2===n.button||"keyup"===n.type&&"Tab"!==n.key)return;const t=Rr.find(tEe);for(const r of t){const i=um.getInstance(r);if(!i||!1===i._config.autoClose)continue;const l=n.composedPath(),u=l.includes(i._menu);if(l.includes(i._element)||"inside"===i._config.autoClose&&!u||"outside"===i._config.autoClose&&u||i._menu.contains(n.target)&&("keyup"===n.type&&"Tab"===n.key||/input|select|option|textarea|form/i.test(n.target.tagName)))continue;const g={relatedTarget:i._element};"click"===n.type&&(g.clickEvent=n),i._completeHide(g)}}static dataApiKeydownHandler(n){const t=/input|textarea/i.test(n.target.tagName),r="Escape"===n.key,i=[$Te,FW].includes(n.key);if(!i&&!r||t&&!r)return;n.preventDefault();const l=this.matches(ax)?this:Rr.prev(this,ax)[0]||Rr.next(this,ax)[0]||Rr.findOne(ax,n.delegateTarget.parentNode),u=um.getOrCreateInstance(l);if(i)return n.stopPropagation(),u.show(),void u._selectMenuItem(n);u._isShown()&&(n.stopPropagation(),u.hide(),l.focus())}}bn.on(document,BW,ax,um.dataApiKeydownHandler),bn.on(document,BW,aP,um.dataApiKeydownHandler),bn.on(document,LW,um.clearMenus),bn.on(document,XTe,um.clearMenus),bn.on(document,LW,ax,function(e){e.preventDefault(),um.getOrCreateInstance(this).toggle()}),zh(um);const zW="backdrop",VW=`mousedown.bs.${zW}`,gEe={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},_Ee={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class jW extends ED{constructor(n){super(),this._config=this._getConfig(n),this._isAppended=!1,this._element=null}static get Default(){return gEe}static get DefaultType(){return _Ee}static get NAME(){return zW}show(n){if(!this._config.isVisible)return void Iu(n);this._append();this._getElement().classList.add("show"),this._emulateAnimation(()=>{Iu(n)})}hide(n){this._config.isVisible?(this._getElement().classList.remove("show"),this._emulateAnimation(()=>{this.dispose(),Iu(n)})):Iu(n)}dispose(){this._isAppended&&(bn.off(this._element,VW),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const n=document.createElement("div");n.className=this._config.className,this._config.isAnimated&&n.classList.add("fade"),this._element=n}return this._element}_configAfterMerge(n){return n.rootElement=d1(n.rootElement),n}_append(){if(this._isAppended)return;const n=this._getElement();this._config.rootElement.append(n),bn.on(n,VW,()=>{Iu(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(n){yW(n,this._getElement(),this._config.isAnimated)}}const lP=".bs.focustrap",vEe=`focusin${lP}`,xEe=`keydown.tab${lP}`,$W="backward",TEe={autofocus:!0,trapElement:null},EEe={autofocus:"boolean",trapElement:"element"};class HW extends ED{constructor(n){super(),this._config=this._getConfig(n),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return TEe}static get DefaultType(){return EEe}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),bn.off(document,lP),bn.on(document,vEe,n=>this._handleFocusin(n)),bn.on(document,xEe,n=>this._handleKeydown(n)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,bn.off(document,lP))}_handleFocusin(n){const{trapElement:t}=this._config;if(n.target===document||n.target===t||t.contains(n.target))return;const r=Rr.focusableChildren(t);0===r.length?t.focus():this._lastTabNavDirection===$W?r[r.length-1].focus():r[0].focus()}_handleKeydown(n){"Tab"===n.key&&(this._lastTabNavDirection=n.shiftKey?$W:"forward")}}const GW=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",WW=".sticky-top",cP="padding-right",qW="margin-right";class GL{constructor(){this._element=document.body}getWidth(){const n=document.documentElement.clientWidth;return Math.abs(window.innerWidth-n)}hide(){const n=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,cP,t=>t+n),this._setElementAttributes(GW,cP,t=>t+n),this._setElementAttributes(WW,qW,t=>t-n)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,cP),this._resetElementAttributes(GW,cP),this._resetElementAttributes(WW,qW)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(n,t,r){const i=this.getWidth();this._applyManipulationCallback(n,u=>{if(u!==this._element&&window.innerWidth>u.clientWidth+i)return;this._saveInitialAttribute(u,t);const g=window.getComputedStyle(u).getPropertyValue(t);u.style.setProperty(t,`${r(Number.parseFloat(g))}px`)})}_saveInitialAttribute(n,t){const r=n.style.getPropertyValue(t);r&&Wg.setDataAttribute(n,t,r)}_resetElementAttributes(n,t){this._applyManipulationCallback(n,i=>{const l=Wg.getDataAttribute(i,t);null!==l?(Wg.removeDataAttribute(i,t),i.style.setProperty(t,l)):i.style.removeProperty(t)})}_applyManipulationCallback(n,t){if(Gg(n))t(n);else for(const r of Rr.find(n,this._element))t(r)}}const Uh=".bs.modal",MEe=`hide${Uh}`,AEe=`hidePrevented${Uh}`,ZW=`hidden${Uh}`,XW=`show${Uh}`,IEe=`shown${Uh}`,kEe=`resize${Uh}`,OEe=`click.dismiss${Uh}`,PEe=`mousedown.dismiss${Uh}`,REe=`keydown.dismiss${Uh}`,NEe=`click${Uh}.data-api`,YW="modal-open",WL="modal-static",VEe={backdrop:!0,focus:!0,keyboard:!0},jEe={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class lx extends Zf{constructor(n,t){super(n,t),this._dialog=Rr.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new GL,this._addEventListeners()}static get Default(){return VEe}static get DefaultType(){return jEe}static get NAME(){return"modal"}toggle(n){return this._isShown?this.hide():this.show(n)}show(n){this._isShown||this._isTransitioning||bn.trigger(this._element,XW,{relatedTarget:n}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(YW),this._adjustDialog(),this._backdrop.show(()=>this._showElement(n)))}hide(){!this._isShown||this._isTransitioning||bn.trigger(this._element,MEe).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove("show"),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){bn.off(window,Uh),bn.off(this._dialog,Uh),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new jW({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new HW({trapElement:this._element})}_showElement(n){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const t=Rr.findOne(".modal-body",this._dialog);t&&(t.scrollTop=0),this._element.classList.add("show"),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,bn.trigger(this._element,IEe,{relatedTarget:n})},this._dialog,this._isAnimated())}_addEventListeners(){bn.on(this._element,REe,n=>{if("Escape"===n.key){if(this._config.keyboard)return void this.hide();this._triggerBackdropTransition()}}),bn.on(window,kEe,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),bn.on(this._element,PEe,n=>{bn.one(this._element,OEe,t=>{if(this._element===n.target&&this._element===t.target){if("static"===this._config.backdrop)return void this._triggerBackdropTransition();this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(YW),this._resetAdjustments(),this._scrollBar.reset(),bn.trigger(this._element,ZW)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(bn.trigger(this._element,AEe).defaultPrevented)return;const t=this._element.scrollHeight>document.documentElement.clientHeight,r=this._element.style.overflowY;"hidden"===r||this._element.classList.contains(WL)||(t||(this._element.style.overflowY="hidden"),this._element.classList.add(WL),this._queueCallback(()=>{this._element.classList.remove(WL),this._queueCallback(()=>{this._element.style.overflowY=r},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const n=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),r=t>0;if(r&&!n){const i=Bh()?"paddingLeft":"paddingRight";this._element.style[i]=`${t}px`}if(!r&&n){const i=Bh()?"paddingRight":"paddingLeft";this._element.style[i]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(n,t){return this.each(function(){const r=lx.getOrCreateInstance(this,n);if("string"==typeof n){if(typeof r[n]>"u")throw new TypeError(`No method named "${n}"`);r[n](t)}})}}bn.on(document,NEe,'[data-bs-toggle="modal"]',function(e){const n=Rr.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),bn.one(n,XW,i=>{i.defaultPrevented||bn.one(n,ZW,()=>{q2(this)&&this.focus()})});const t=Rr.findOne(".modal.show");t&&lx.getInstance(t).hide(),lx.getOrCreateInstance(n).toggle(this)}),eP(lx),zh(lx);const qg=".bs.offcanvas",JW=".data-api",HEe=`load${qg}${JW}`,eq="showing",nq=".offcanvas.show",qEe=`show${qg}`,ZEe=`shown${qg}`,XEe=`hide${qg}`,rq=`hidePrevented${qg}`,iq=`hidden${qg}`,YEe=`resize${qg}`,KEe=`click${qg}${JW}`,JEe=`keydown.dismiss${qg}`,eCe={backdrop:!0,keyboard:!0,scroll:!1},tCe={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class p1 extends Zf{constructor(n,t){super(n,t),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return eCe}static get DefaultType(){return tCe}static get NAME(){return"offcanvas"}toggle(n){return this._isShown?this.hide():this.show(n)}show(n){this._isShown||bn.trigger(this._element,qEe,{relatedTarget:n}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new GL).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(eq),this._queueCallback(()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add("show"),this._element.classList.remove(eq),bn.trigger(this._element,ZEe,{relatedTarget:n})},this._element,!0))}hide(){this._isShown&&!bn.trigger(this._element,XEe).defaultPrevented&&(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add("hiding"),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove("show","hiding"),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new GL).reset(),bn.trigger(this._element,iq)},this._element,!0))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=!!this._config.backdrop;return new jW({className:"offcanvas-backdrop",isVisible:t,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:t?()=>{"static"!==this._config.backdrop?this.hide():bn.trigger(this._element,rq)}:null})}_initializeFocusTrap(){return new HW({trapElement:this._element})}_addEventListeners(){bn.on(this._element,JEe,n=>{if("Escape"===n.key){if(this._config.keyboard)return void this.hide();bn.trigger(this._element,rq)}})}static jQueryInterface(n){return this.each(function(){const t=p1.getOrCreateInstance(this,n);if("string"==typeof n){if(void 0===t[n]||n.startsWith("_")||"constructor"===n)throw new TypeError(`No method named "${n}"`);t[n](this)}})}}bn.on(document,KEe,'[data-bs-toggle="offcanvas"]',function(e){const n=Rr.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&e.preventDefault(),h1(this))return;bn.one(n,iq,()=>{q2(this)&&this.focus()});const t=Rr.findOne(nq);t&&t!==n&&p1.getInstance(t).hide(),p1.getOrCreateInstance(n).toggle(this)}),bn.on(window,HEe,()=>{for(const e of Rr.find(nq))p1.getOrCreateInstance(e).show()}),bn.on(window,YEe,()=>{for(const e of Rr.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(e).position&&p1.getOrCreateInstance(e).hide()}),eP(p1),zh(p1);const sq={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},nCe=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),rCe=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,iCe=(e,n)=>{const t=e.nodeName.toLowerCase();return n.includes(t)?!nCe.has(t)||!!rCe.test(e.nodeValue):n.filter(r=>r instanceof RegExp).some(r=>r.test(t))},aCe={allowList:sq,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},lCe={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},cCe={entry:"(string|element|function|null)",selector:"(string|element)"};class uCe extends ED{constructor(n){super(),this._config=this._getConfig(n)}static get Default(){return aCe}static get DefaultType(){return lCe}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(n=>this._resolvePossibleFunction(n)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(n){return this._checkContent(n),this._config.content={...this._config.content,...n},this}toHtml(){const n=document.createElement("div");n.innerHTML=this._maybeSanitize(this._config.template);for(const[i,l]of Object.entries(this._config.content))this._setContent(n,l,i);const t=n.children[0],r=this._resolvePossibleFunction(this._config.extraClass);return r&&t.classList.add(...r.split(" ")),t}_typeCheckConfig(n){super._typeCheckConfig(n),this._checkContent(n.content)}_checkContent(n){for(const[t,r]of Object.entries(n))super._typeCheckConfig({selector:t,entry:r},cCe)}_setContent(n,t,r){const i=Rr.findOne(r,n);if(i){if(!(t=this._resolvePossibleFunction(t)))return void i.remove();if(Gg(t))return void this._putElementInTemplate(d1(t),i);if(this._config.html)return void(i.innerHTML=this._maybeSanitize(t));i.textContent=t}}_maybeSanitize(n){return this._config.sanitize?function sCe(e,n,t){if(!e.length)return e;if(t&&"function"==typeof t)return t(e);const i=(new window.DOMParser).parseFromString(e,"text/html"),l=[].concat(...i.body.querySelectorAll("*"));for(const u of l){const g=u.nodeName.toLowerCase();if(!Object.keys(n).includes(g)){u.remove();continue}const x=[].concat(...u.attributes),E=[].concat(n["*"]||[],n[g]||[]);for(const D of x)iCe(D,E)||u.removeAttribute(D.nodeName)}return i.body.innerHTML}(n,this._config.allowList,this._config.sanitizeFn):n}_resolvePossibleFunction(n){return Iu(n,[this])}_putElementInTemplate(n,t){if(this._config.html)return t.innerHTML="",void t.append(n);t.textContent=n.textContent}}const hCe=new Set(["sanitize","allowList","sanitizeFn"]),qL="fade",uP="show",aq="hide.bs.modal",AD="hover",ZL="focus",DCe={AUTO:"auto",TOP:"top",RIGHT:Bh()?"left":"right",BOTTOM:"bottom",LEFT:Bh()?"right":"left"},MCe={allowList:sq,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},ACe={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Q2 extends Zf{constructor(n,t){if(typeof Ic>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(n,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return MCe}static get DefaultType(){return ACe}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown())return void this._leave();this._enter()}}dispose(){clearTimeout(this._timeout),bn.off(this._element.closest(".modal"),aq,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const n=bn.trigger(this._element,this.constructor.eventName("show")),r=(gW(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(n.defaultPrevented||!r)return;this._disposePopper();const i=this._getTipElement();this._element.setAttribute("aria-describedby",i.getAttribute("id"));const{container:l}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(l.append(i),bn.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(i),i.classList.add(uP),"ontouchstart"in document.documentElement)for(const g of[].concat(...document.body.children))bn.on(g,"mouseover",QO);this._queueCallback(()=>{bn.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!bn.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(uP),"ontouchstart"in document.documentElement)for(const i of[].concat(...document.body.children))bn.off(i,"mouseover",QO);this._activeTrigger.click=!1,this._activeTrigger[ZL]=!1,this._activeTrigger[AD]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),bn.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(n){const t=this._getTemplateFactory(n).toHtml();if(!t)return null;t.classList.remove(qL,uP),t.classList.add(`bs-${this.constructor.NAME}-auto`);const r=(e=>{do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e));return e})(this.constructor.NAME).toString();return t.setAttribute("id",r),this._isAnimated()&&t.classList.add(qL),t}setContent(n){this._newContent=n,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(n){return this._templateFactory?this._templateFactory.changeContent(n):this._templateFactory=new uCe({...this._config,content:n,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(n){return this.constructor.getOrCreateInstance(n.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(qL)}_isShown(){return this.tip&&this.tip.classList.contains(uP)}_createPopper(n){const t=Iu(this._config.placement,[this,n,this._element]),r=DCe[t.toUpperCase()];return kL(this._element,n,this._getPopperConfig(r))}_getOffset(){const{offset:n}=this._config;return"string"==typeof n?n.split(",").map(t=>Number.parseInt(t,10)):"function"==typeof n?t=>n(t,this._element):n}_resolvePossibleFunction(n){return Iu(n,[this._element])}_getPopperConfig(n){const t={placement:n,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:r=>{this._getTipElement().setAttribute("data-popper-placement",r.state.placement)}}]};return{...t,...Iu(this._config.popperConfig,[t])}}_setListeners(){const n=this._config.trigger.split(" ");for(const t of n)if("click"===t)bn.on(this._element,this.constructor.eventName("click"),this._config.selector,r=>{this._initializeOnDelegatedTarget(r).toggle()});else if("manual"!==t){const r=this.constructor.eventName(t===AD?"mouseenter":"focusin"),i=this.constructor.eventName(t===AD?"mouseleave":"focusout");bn.on(this._element,r,this._config.selector,l=>{const u=this._initializeOnDelegatedTarget(l);u._activeTrigger["focusin"===l.type?ZL:AD]=!0,u._enter()}),bn.on(this._element,i,this._config.selector,l=>{const u=this._initializeOnDelegatedTarget(l);u._activeTrigger["focusout"===l.type?ZL:AD]=u._element.contains(l.relatedTarget),u._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},bn.on(this._element.closest(".modal"),aq,this._hideModalHandler)}_fixTitle(){const n=this._element.getAttribute("title");n&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",n),this._element.setAttribute("data-bs-original-title",n),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(n,t){clearTimeout(this._timeout),this._timeout=setTimeout(n,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(n){const t=Wg.getDataAttributes(this._element);for(const r of Object.keys(t))hCe.has(r)&&delete t[r];return n={...t,..."object"==typeof n&&n?n:{}},n=this._mergeConfigObj(n),n=this._configAfterMerge(n),this._typeCheckConfig(n),n}_configAfterMerge(n){return n.container=!1===n.container?document.body:d1(n.container),"number"==typeof n.delay&&(n.delay={show:n.delay,hide:n.delay}),"number"==typeof n.title&&(n.title=n.title.toString()),"number"==typeof n.content&&(n.content=n.content.toString()),n}_getDelegateConfig(){const n={};for(const[t,r]of Object.entries(this._config))this.constructor.Default[t]!==r&&(n[t]=r);return n.selector=!1,n.trigger="manual",n}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(n){return this.each(function(){const t=Q2.getOrCreateInstance(this,n);if("string"==typeof n){if(typeof t[n]>"u")throw new TypeError(`No method named "${n}"`);t[n]()}})}}zh(Q2);const PCe={...Q2.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},RCe={...Q2.DefaultType,content:"(null|string|element|function)"};class XL extends Q2{static get Default(){return PCe}static get DefaultType(){return RCe}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(n){return this.each(function(){const t=XL.getOrCreateInstance(this,n);if("string"==typeof n){if(typeof t[n]>"u")throw new TypeError(`No method named "${n}"`);t[n]()}})}}zh(XL);const YL=".bs.scrollspy",LCe=`activate${YL}`,lq=`click${YL}`,BCe=`load${YL}.data-api`,eT="active",KL="[href]",cq=".nav-link",jCe=`${cq}, .nav-item > ${cq}, .list-group-item`,GCe={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},WCe={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class dP extends Zf{constructor(n,t){super(n,t),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return GCe}static get DefaultType(){return WCe}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const n of this._observableSections.values())this._observer.observe(n)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(n){return n.target=d1(n.target)||document.body,n.rootMargin=n.offset?`${n.offset}px 0px -30%`:n.rootMargin,"string"==typeof n.threshold&&(n.threshold=n.threshold.split(",").map(t=>Number.parseFloat(t))),n}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(bn.off(this._config.target,lq),bn.on(this._config.target,lq,KL,n=>{const t=this._observableSections.get(n.target.hash);if(t){n.preventDefault();const r=this._rootElement||window,i=t.offsetTop-this._element.offsetTop;if(r.scrollTo)return void r.scrollTo({top:i,behavior:"smooth"});r.scrollTop=i}}))}_getNewObserver(){return new IntersectionObserver(t=>this._observerCallback(t),{root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin})}_observerCallback(n){const t=u=>this._targetLinks.get(`#${u.target.id}`),r=u=>{this._previousScrollData.visibleEntryTop=u.target.offsetTop,this._process(t(u))},i=(this._rootElement||document.documentElement).scrollTop,l=i>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=i;for(const u of n){if(!u.isIntersecting){this._activeTarget=null,this._clearActiveClass(t(u));continue}const g=u.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(l&&g){if(r(u),!i)return}else!l&&!g&&r(u)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const n=Rr.find(KL,this._config.target);for(const t of n){if(!t.hash||h1(t))continue;const r=Rr.findOne(decodeURI(t.hash),this._element);q2(r)&&(this._targetLinks.set(decodeURI(t.hash),t),this._observableSections.set(t.hash,r))}}_process(n){this._activeTarget!==n&&(this._clearActiveClass(this._config.target),this._activeTarget=n,n.classList.add(eT),this._activateParents(n),bn.trigger(this._element,LCe,{relatedTarget:n}))}_activateParents(n){if(n.classList.contains("dropdown-item"))Rr.findOne(".dropdown-toggle",n.closest(".dropdown")).classList.add(eT);else for(const t of Rr.parents(n,".nav, .list-group"))for(const r of Rr.prev(t,jCe))r.classList.add(eT)}_clearActiveClass(n){n.classList.remove(eT);const t=Rr.find(`${KL}.${eT}`,n);for(const r of t)r.classList.remove(eT)}static jQueryInterface(n){return this.each(function(){const t=dP.getOrCreateInstance(this,n);if("string"==typeof n){if(void 0===t[n]||n.startsWith("_")||"constructor"===n)throw new TypeError(`No method named "${n}"`);t[n]()}})}}bn.on(window,BCe,()=>{for(const e of Rr.find('[data-bs-spy="scroll"]'))dP.getOrCreateInstance(e)}),zh(dP);const cx=".bs.tab",ZCe=`hide${cx}`,XCe=`hidden${cx}`,YCe=`show${cx}`,KCe=`shown${cx}`,JCe=`click${cx}`,QCe=`keydown${cx}`,eSe=`load${cx}`,tSe="ArrowLeft",uq="ArrowRight",nSe="ArrowUp",dq="ArrowDown",JL="Home",hq="End",ux="active",QL="show",pq=".dropdown-toggle",e5=`:not(${pq})`,mq='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',t5=`.nav-link${e5}, .list-group-item${e5}, [role="tab"]${e5}, ${mq}`,lSe=`.${ux}[data-bs-toggle="tab"], .${ux}[data-bs-toggle="pill"], .${ux}[data-bs-toggle="list"]`;class tT extends Zf{constructor(n){super(n),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),bn.on(this._element,QCe,t=>this._keydown(t)))}static get NAME(){return"tab"}show(){const n=this._element;if(this._elemIsActive(n))return;const t=this._getActiveElem(),r=t?bn.trigger(t,ZCe,{relatedTarget:n}):null;bn.trigger(n,YCe,{relatedTarget:t}).defaultPrevented||r&&r.defaultPrevented||(this._deactivate(t,n),this._activate(n,t))}_activate(n,t){n&&(n.classList.add(ux),this._activate(Rr.getElementFromSelector(n)),this._queueCallback(()=>{"tab"===n.getAttribute("role")?(n.removeAttribute("tabindex"),n.setAttribute("aria-selected",!0),this._toggleDropDown(n,!0),bn.trigger(n,KCe,{relatedTarget:t})):n.classList.add(QL)},n,n.classList.contains("fade")))}_deactivate(n,t){n&&(n.classList.remove(ux),n.blur(),this._deactivate(Rr.getElementFromSelector(n)),this._queueCallback(()=>{"tab"===n.getAttribute("role")?(n.setAttribute("aria-selected",!1),n.setAttribute("tabindex","-1"),this._toggleDropDown(n,!1),bn.trigger(n,XCe,{relatedTarget:t})):n.classList.remove(QL)},n,n.classList.contains("fade")))}_keydown(n){if(![tSe,uq,nSe,dq,JL,hq].includes(n.key))return;n.stopPropagation(),n.preventDefault();const t=this._getChildren().filter(i=>!h1(i));let r;if([JL,hq].includes(n.key))r=t[n.key===JL?0:t.length-1];else{const i=[uq,dq].includes(n.key);r=NL(t,n.target,i,!0)}r&&(r.focus({preventScroll:!0}),tT.getOrCreateInstance(r).show())}_getChildren(){return Rr.find(t5,this._parent)}_getActiveElem(){return this._getChildren().find(n=>this._elemIsActive(n))||null}_setInitialAttributes(n,t){this._setAttributeIfNotExists(n,"role","tablist");for(const r of t)this._setInitialAttributesOnChild(r)}_setInitialAttributesOnChild(n){n=this._getInnerElement(n);const t=this._elemIsActive(n),r=this._getOuterElement(n);n.setAttribute("aria-selected",t),r!==n&&this._setAttributeIfNotExists(r,"role","presentation"),t||n.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(n,"role","tab"),this._setInitialAttributesOnTargetPanel(n)}_setInitialAttributesOnTargetPanel(n){const t=Rr.getElementFromSelector(n);t&&(this._setAttributeIfNotExists(t,"role","tabpanel"),n.id&&this._setAttributeIfNotExists(t,"aria-labelledby",`${n.id}`))}_toggleDropDown(n,t){const r=this._getOuterElement(n);if(!r.classList.contains("dropdown"))return;const i=(l,u)=>{const g=Rr.findOne(l,r);g&&g.classList.toggle(u,t)};i(pq,ux),i(".dropdown-menu",QL),r.setAttribute("aria-expanded",t)}_setAttributeIfNotExists(n,t,r){n.hasAttribute(t)||n.setAttribute(t,r)}_elemIsActive(n){return n.classList.contains(ux)}_getInnerElement(n){return n.matches(t5)?n:Rr.findOne(t5,n)}_getOuterElement(n){return n.closest(".nav-item, .list-group-item")||n}static jQueryInterface(n){return this.each(function(){const t=tT.getOrCreateInstance(this);if("string"==typeof n){if(void 0===t[n]||n.startsWith("_")||"constructor"===n)throw new TypeError(`No method named "${n}"`);t[n]()}})}}bn.on(document,JCe,mq,function(e){["A","AREA"].includes(this.tagName)&&e.preventDefault(),!h1(this)&&tT.getOrCreateInstance(this).show()}),bn.on(window,eSe,()=>{for(const e of Rr.find(lSe))tT.getOrCreateInstance(e)}),zh(tT);const m1=".bs.toast",uSe=`mouseover${m1}`,dSe=`mouseout${m1}`,hSe=`focusin${m1}`,fSe=`focusout${m1}`,pSe=`hide${m1}`,mSe=`hidden${m1}`,gSe=`show${m1}`,_Se=`shown${m1}`,hP="show",fP="showing",vSe={animation:"boolean",autohide:"boolean",delay:"number"},xSe={animation:!0,autohide:!0,delay:5e3};class pP extends Zf{constructor(n,t){super(n,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return xSe}static get DefaultType(){return vSe}static get NAME(){return"toast"}show(){bn.trigger(this._element,gSe).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove("hide"),this._element.classList.add(hP,fP),this._queueCallback(()=>{this._element.classList.remove(fP),bn.trigger(this._element,_Se),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&!bn.trigger(this._element,pSe).defaultPrevented&&(this._element.classList.add(fP),this._queueCallback(()=>{this._element.classList.add("hide"),this._element.classList.remove(fP,hP),bn.trigger(this._element,mSe)},this._element,this._config.animation))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(hP),super.dispose()}isShown(){return this._element.classList.contains(hP)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(n,t){switch(n.type){case"mouseover":case"mouseout":this._hasMouseInteraction=t;break;case"focusin":case"focusout":this._hasKeyboardInteraction=t}if(t)return void this._clearTimeout();const r=n.relatedTarget;this._element===r||this._element.contains(r)||this._maybeScheduleHide()}_setListeners(){bn.on(this._element,uSe,n=>this._onInteraction(n,!0)),bn.on(this._element,dSe,n=>this._onInteraction(n,!1)),bn.on(this._element,hSe,n=>this._onInteraction(n,!0)),bn.on(this._element,fSe,n=>this._onInteraction(n,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(n){return this.each(function(){const t=pP.getOrCreateInstance(this,n);if("string"==typeof n){if(typeof t[n]>"u")throw new TypeError(`No method named "${n}"`);t[n](this)}})}}function bSe(e,n){if(1&e){const t=lr();P(0,"div",4)(1,"label",44),U(2,"N\xfamero de Pedido:"),O(),P(3,"input",45),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.actionObject.orderNumber,i)||(l.actionObject.orderNumber=i),zt(i)}),O()()}if(2&e){const t=Ge();W(3),Ct("ngModel",t.actionObject.orderNumber)}}function wSe(e,n){if(1&e&&(P(0,"option",46),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function TSe(e,n){if(1&e){const t=lr();P(0,"li",47),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().selectCustomer(i))}),U(1),O()}if(2&e){const t=n.$implicit;W(),m3(" ",t.name," - ",t.phone," - ",t.email," - ",t.address," ")}}eP(pP),zh(pP);let ESe=(()=>{class e{constructor(t,r,i){this.actionService=t,this.router=r,this.route=i,this.actionObject={dateAction:"",dateSolution:"",type:"",customer:{},orderNumber:"",manager:"",status:"",actionComment:"",solutionType:"",solutionComment:"",latitude:null,longitude:null},this.searchTerm="",this.customers=[],this.filteredCustomers=[],this.solutions=[]}ngOnInit(){this.loadAction(),this.getCurrentLocation(),this.loadCustomers();const t=document.getElementById("customerModal");t?this.modal=new lx(t):console.error("Modal element not found")}loadAction(){const t=this.route.snapshot.paramMap.get("action");t&&this.actionService.getAction(t).subscribe(r=>{this.actionObject=r,this.solutions=r.type.solutions,this.initializeMap()},r=>{console.error("Error al cargar la acci\xf3n:",r)})}loadCustomers(){this.actionService.getPotentialCustomers().subscribe(t=>{this.customers=t,this.filteredCustomers=this.customers},t=>{console.error("Error al cargar los clientes:",t)})}searchCustomer(){this.filteredCustomers=this.searchTerm?this.customers.filter(t=>t.name.toLowerCase().includes(this.searchTerm.toLowerCase())||t.email.toLowerCase().includes(this.searchTerm.toLowerCase())||t.phone.toString().includes(this.searchTerm)||t.address.toLowerCase().includes(this.searchTerm.toLowerCase())):this.customers}selectCustomer(t){this.actionObject.customer=t,this.initializeMap(),this.modal&&this.modal.hide()}initializeMap(){this.actionObject.customer.latitude&&this.actionObject.customer.longitude&&(this.map=new uW.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",projection:{name:"mercator"},zoom:15,center:[parseFloat(this.actionObject.customer.longitude),parseFloat(this.actionObject.customer.latitude)],accessToken:"pk.eyJ1Ijoidm1kaWFnb3YiLCJhIjoiY2x4MGtxY2NlMDFxdDJycTdrdXhvYWE4byJ9.rQb2uBaS48sEyvpbdMj14Q"}),(new uW.Marker).setLngLat([parseFloat(this.actionObject.customer.longitude),parseFloat(this.actionObject.customer.latitude)]).addTo(this.map))}getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.actionObject.latitude=t.coords.latitude,this.actionObject.longitude=t.coords.longitude},t=>{console.error("Error obteniendo la ubicaci\xf3n:",t)}):console.error("Geolocalizaci\xf3n no es soportada por el navegador")}completar(){const t=(new Date).toLocaleString("en-US",{timeZone:"America/Bogota"});this.actionObject.dateSolution=new Date(t).toISOString(),this.getCurrentLocation(),this.actionService.editAction(this.actionObject.actionNumber,this.actionObject).subscribe(r=>{this.router.navigate(["/crm"])})}backList(){this.router.navigate(["/crm"])}openCustomers(){this.modal&&this.modal.show()}static#e=this.\u0275fac=function(r){return new(r||e)(ut(IL),ut(ws),ut(Su))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-edit-action"]],decls:84,vars:15,consts:[["href",Mf`https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.css`,"rel","stylesheet"],["href",Mf`https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css`,"rel","stylesheet"],[1,"container"],[1,"mb-4"],[1,"form-group","mb-3"],["for","dateAction"],["type","text","id","dateAction","name","dateAction","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-secondary","mb-3",3,"click"],["for","customer"],["type","text","id","name","name","name",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","address","name","address",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","phone","name","phone",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","email","name","email",1,"form-control",3,"ngModelChange","ngModel"],["id","map",1,"map-container"],["for","type"],["type","text","id","type","name","type","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["class","form-group mb-3",4,"ngIf"],["for","manager"],["type","text","id","manager","name","manager","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","actionComment"],["type","text","id","actionComment","name","actionComment","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","solution"],["id","solution","name","solution","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["for","solutionComment"],["type","text","id","solutionComment","name","solutionComment",1,"form-control",3,"ngModelChange","ngModel"],["id","estado","name","estado","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","Completada"],["value","Creada"],[1,"row"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],["id","customerModal","tabindex","-1","aria-labelledby","customerModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","customerModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["type","text","placeholder","Buscar cliente",1,"form-control","mb-3",3,"ngModelChange","input","ngModel"],[1,"list-group"],["class","list-group-item",3,"click",4,"ngFor","ngForOf"],["for","orderNumber"],["type","text","id","orderNumber","name","orderNumber","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],[1,"list-group-item",3,"click"]],template:function(r,i){1&r&&(Rt(0,"link",0)(1,"link",1)(2,"br")(3,"br"),P(4,"div",2)(5,"h3",3),U(6,"Completar acci\xf3n"),O(),P(7,"form")(8,"div",4)(9,"label",5),U(10,"Fecha Ejecuci\xf3n:"),O(),P(11,"input",6),St("ngModelChange",function(u){return Dt(i.actionObject.dateAction,u)||(i.actionObject.dateAction=u),u}),O()(),P(12,"button",7),ct("click",function(){return i.openCustomers()}),U(13," Buscar Cliente "),O(),P(14,"div",4)(15,"label",8),U(16,"Nombre Cliente:"),O(),P(17,"input",9),St("ngModelChange",function(u){return Dt(i.actionObject.customer.name,u)||(i.actionObject.customer.name=u),u}),O()(),P(18,"div",4)(19,"label",8),U(20,"Direcci\xf3n Cliente:"),O(),P(21,"input",10),St("ngModelChange",function(u){return Dt(i.actionObject.customer.address,u)||(i.actionObject.customer.address=u),u}),O()(),P(22,"div",4)(23,"label",8),U(24,"Tel\xe9fono Cliente:"),O(),P(25,"input",11),St("ngModelChange",function(u){return Dt(i.actionObject.customer.phone,u)||(i.actionObject.customer.phone=u),u}),O()(),P(26,"div",4)(27,"label",8),U(28,"Email Cliente:"),O(),P(29,"input",12),St("ngModelChange",function(u){return Dt(i.actionObject.customer.email,u)||(i.actionObject.customer.email=u),u}),O()(),P(30,"div",4),Rt(31,"div",13),O(),P(32,"div",4)(33,"label",14),U(34,"Tipo de Acci\xf3n:"),O(),P(35,"input",15),St("ngModelChange",function(u){return Dt(i.actionObject.type.name,u)||(i.actionObject.type.name=u),u}),O()(),gt(36,bSe,4,1,"div",16),P(37,"div",4)(38,"label",17),U(39,"Manager:"),O(),P(40,"input",18),St("ngModelChange",function(u){return Dt(i.actionObject.manager,u)||(i.actionObject.manager=u),u}),O()(),P(41,"div",4)(42,"label",19),U(43,"Detalle:"),O(),P(44,"input",20),St("ngModelChange",function(u){return Dt(i.actionObject.actionComment,u)||(i.actionObject.actionComment=u),u}),O()(),P(45,"div",4)(46,"label",21),U(47,"Soluci\xf3n:"),O(),P(48,"select",22),St("ngModelChange",function(u){return Dt(i.actionObject.solutionType,u)||(i.actionObject.solutionType=u),u}),P(49,"option",23),U(50,"Seleccione una soluci\xf3n"),O(),gt(51,wSe,2,2,"option",24),O()(),P(52,"div",4)(53,"label",25),U(54,"Detalle Soluci\xf3n:"),O(),P(55,"input",26),St("ngModelChange",function(u){return Dt(i.actionObject.solutionComment,u)||(i.actionObject.solutionComment=u),u}),O()(),P(56,"div",4)(57,"label",21),U(58,"Estado:"),O(),P(59,"select",27),St("ngModelChange",function(u){return Dt(i.actionObject.status,u)||(i.actionObject.status=u),u}),P(60,"option",23),U(61,"Seleccione un estado"),O(),P(62,"option",28),U(63,"Completada"),O(),P(64,"option",29),U(65,"Creada"),O()()(),P(66,"div",30)(67,"div",31)(68,"button",32),ct("click",function(){return i.completar()}),U(69,"Completar"),O()(),P(70,"div",31)(71,"button",33),ct("click",function(){return i.backList()}),U(72,"Regresar"),O()()()()(),P(73,"div",34)(74,"div",35)(75,"div",36)(76,"div",37)(77,"h5",38),U(78,"Buscar Cliente"),O(),Rt(79,"button",39),O(),P(80,"div",40)(81,"input",41),St("ngModelChange",function(u){return Dt(i.searchTerm,u)||(i.searchTerm=u),u}),ct("input",function(){return i.searchCustomer()}),O(),P(82,"ul",42),gt(83,TSe,2,4,"li",43),O()()()()()),2&r&&(W(11),Ct("ngModel",i.actionObject.dateAction),W(6),Ct("ngModel",i.actionObject.customer.name),W(4),Ct("ngModel",i.actionObject.customer.address),W(4),Ct("ngModel",i.actionObject.customer.phone),W(4),Ct("ngModel",i.actionObject.customer.email),W(6),Ct("ngModel",i.actionObject.type.name),W(),Oe("ngIf",i.actionObject.orderNumber),W(4),Ct("ngModel",i.actionObject.manager),W(4),Ct("ngModel",i.actionObject.actionComment),W(4),Ct("ngModel",i.actionObject.solutionType),W(3),Oe("ngForOf",i.solutions),W(4),Ct("ngModel",i.actionObject.solutionComment),W(4),Ct("ngModel",i.actionObject.status),W(22),Ct("ngModel",i.searchTerm),W(2),Oe("ngForOf",i.filteredCustomers))},dependencies:[No,So,R2,yd,vd,Hs,eu,so,k2,a1,oo,Xv],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:400px}"]})}return e})();const _q=()=>({standalone:!0});function CSe(e,n){if(1&e){const t=lr();P(0,"div",2)(1,"label",33),U(2,"Cliente:"),O(),P(3,"div",34)(4,"input",35),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.newActionObject.customer.name,i)||(l.newActionObject.customer.name=i),zt(i)}),O(),P(5,"button",36),U(6," Seleccionar Cliente "),O()()()}if(2&e){const t=Ge();W(4),Ct("ngModel",t.newActionObject.customer.name)}}function SSe(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td")(8,"button",37),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().selectCustomer(i))}),U(9," Seleccionar "),O()()()}if(2&e){const t=n.$implicit;W(2),tt(t.name),W(2),tt(t.phone),W(2),tt(t.email)}}function DSe(e,n){if(1&e&&(P(0,"option",38),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t),W(),tt(t.name)}}function MSe(e,n){if(1&e&&(P(0,"option",41),U(1),O()),2&e){const t=n.$implicit;Oe("value",t.order_number),W(),Zw("",t.order_number," - ( ",t.delivery_date,")")}}function ASe(e,n){if(1&e){const t=lr();P(0,"div",2)(1,"label",39),U(2,"N\xfamero de Pedido:"),O(),P(3,"select",40),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.newActionObject.orderNumber,i)||(l.newActionObject.orderNumber=i),zt(i)}),P(4,"option",23),U(5,"Seleccione un pedido"),O(),gt(6,MSe,2,3,"option",27),O()()}if(2&e){const t=Ge();W(3),Ct("ngModel",t.newActionObject.orderNumber),W(3),Oe("ngForOf",t.orders)}}function ISe(e,n){if(1&e&&(P(0,"option",41),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}let kSe=(()=>{class e{constructor(t,r,i,l){this.actionService=t,this.customerService=r,this.orderService=i,this.router=l,this.newActionObject={dateAction:"",dateSolution:"",type:{},customer:{},orderNumber:"",manager:"",status:"Creada",actionComment:"",solutionType:"",solutionComment:"",longituted:"",latituted:""},this.customers=[],this.actionTypes=[],this.orders=[],this.managers=[],this.searchText="",this.isCustomerExisting=!0}ngOnInit(){this.loadCustomers(),this.orderService.getConfig().subscribe(t=>{this.actionTypes=t.actionsType,this.managers=t.comercials})}loadCustomers(){this.customerService.getClientes().subscribe(t=>{this.customers=t},t=>{console.error("Error al cargar los clientes:",t)})}loadOrders(t){this.orderService.getLastOrdersByCustomerId(t).subscribe(r=>{this.orders=r},r=>{console.error("Error al cargar los pedidos:",r)})}selectCustomer(t){this.newActionObject.customer=t,this.loadOrders(t.email)}onTypeChange(){this.newActionObject.type.requiresOrder&&this.newActionObject.customer.id&&this.loadOrders(this.newActionObject.customer.email)}createAction(){this.newActionObject.dateAction&&this.newActionObject.type?this.actionService.createAction(this.newActionObject).subscribe(t=>{this.router.navigate(["/crm"])},t=>{console.error("Error al crear la acci\xf3n:",t)}):alert("Por favor, completa todos los campos obligatorios.")}filteredCustomers(){if(!this.searchText)return this.customers;const t=this.searchText.toLowerCase();return this.customers.filter(r=>r.phone.toLowerCase().includes(t)||r.name.toLowerCase().includes(t)||r.email.toLowerCase().includes(t))}backList(){this.router.navigate(["/crm"])}onCustomerExistsChange(){this.isCustomerExisting||(this.newActionObject.customer={address:"",category:"",document:"",document_type:"",email:"",latitude:"",longitude:"",micro_category:"",name:"Cliente no existe",phone:""})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(IL),ut(U4),ut(N2),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-new-action"]],decls:68,vars:15,consts:[[1,"container"],[1,"mb-4"],[1,"form-group","mb-3"],["for","dateAction"],["type","date","id","dateAction","name","dateAction","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-check"],["type","checkbox","id","customerExists",1,"form-check-input",3,"ngModelChange","change","ngModel","ngModelOptions"],["for","customerExists",1,"form-check-label"],["class","form-group mb-3",4,"ngIf"],["id","customerModal","tabindex","-1","aria-labelledby","customerModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","customerModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["type","text","placeholder","Buscar cliente...",1,"form-control","mb-3",3,"ngModelChange","ngModel","ngModelOptions"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["for","type"],["id","type","name","type","required","",1,"form-control",3,"ngModelChange","change","ngModel"],["value","","disabled","","selected",""],[3,"ngValue",4,"ngFor","ngForOf"],["for","manager"],["id","manager","name","manager","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","id","actionComment","name","actionComment",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],["for","customerId"],[1,"input-group"],["type","text","id","customer","name","customer","readonly","","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","button","data-bs-toggle","modal","data-bs-target","#customerModal",1,"btn","btn-outline-secondary"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[3,"ngValue"],["for","orderNumber"],["id","orderNumber","name","orderNumber",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"]],template:function(r,i){1&r&&(Rt(0,"br")(1,"br"),P(2,"div",0)(3,"h3",1),U(4,"Nueva acci\xf3n"),O(),P(5,"form")(6,"div",2)(7,"label",3),U(8,"Fecha Ejecuci\xf3n:"),O(),P(9,"input",4),St("ngModelChange",function(u){return Dt(i.newActionObject.dateAction,u)||(i.newActionObject.dateAction=u),u}),O()(),P(10,"div",2)(11,"div",5)(12,"input",6),St("ngModelChange",function(u){return Dt(i.isCustomerExisting,u)||(i.isCustomerExisting=u),u}),ct("change",function(){return i.onCustomerExistsChange()}),O(),P(13,"label",7),U(14," \xbfEl cliente existe? "),O()()(),gt(15,CSe,7,1,"div",8),P(16,"div",9)(17,"div",10)(18,"div",11)(19,"div",12)(20,"h5",13),U(21,"Seleccionar Cliente"),O(),Rt(22,"button",14),O(),P(23,"div",15)(24,"input",16),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),O(),P(25,"table",17)(26,"thead")(27,"tr")(28,"th"),U(29,"Nombre"),O(),P(30,"th"),U(31,"Email"),O(),P(32,"th"),U(33,"Tel\xe9fono"),O(),P(34,"th"),U(35,"Acci\xf3n"),O()()(),P(36,"tbody"),gt(37,SSe,10,3,"tr",18),O()()(),P(38,"div",19)(39,"button",20),U(40,"Cerrar"),O()()()()(),P(41,"div",2)(42,"label",21),U(43,"Tipo de Acci\xf3n:"),O(),P(44,"select",22),St("ngModelChange",function(u){return Dt(i.newActionObject.type,u)||(i.newActionObject.type=u),u}),ct("change",function(){return i.onTypeChange()}),P(45,"option",23),U(46,"Seleccione una opci\xf3n"),O(),gt(47,DSe,2,2,"option",24),O()(),gt(48,ASe,7,2,"div",8),P(49,"div",2)(50,"label",25),U(51,"Manager:"),O(),P(52,"select",26),St("ngModelChange",function(u){return Dt(i.newActionObject.manager,u)||(i.newActionObject.manager=u),u}),P(53,"option",23),U(54,"Seleccione un manager"),O(),gt(55,ISe,2,2,"option",27),O()(),P(56,"div",2)(57,"label",25),U(58,"Detalle:"),O(),P(59,"input",28),St("ngModelChange",function(u){return Dt(i.newActionObject.actionComment,u)||(i.newActionObject.actionComment=u),u}),O()(),Rt(60,"br"),P(61,"div",29)(62,"div",30)(63,"button",31),ct("click",function(){return i.createAction()}),U(64,"Crear acci\xf3n"),O()(),P(65,"div",30)(66,"button",32),ct("click",function(){return i.backList()}),U(67,"Regresar"),O()()()()()),2&r&&(W(9),Ct("ngModel",i.newActionObject.dateAction),W(3),Ct("ngModel",i.isCustomerExisting),Oe("ngModelOptions",Va(13,_q)),W(3),Oe("ngIf",i.isCustomerExisting),W(9),Ct("ngModel",i.searchText),Oe("ngModelOptions",Va(14,_q)),W(13),Oe("ngForOf",i.filteredCustomers()),W(7),Ct("ngModel",i.newActionObject.type),W(3),Oe("ngForOf",i.actionTypes),W(),Oe("ngIf",i.newActionObject.type.requiresOrder),W(4),Ct("ngModel",i.newActionObject.manager),W(3),Oe("ngForOf",i.managers),W(4),Ct("ngModel",i.newActionObject.actionComment))},dependencies:[No,So,R2,yd,vd,Hs,hO,eu,so,k2,a1,oo,Xv]})}return e})();function OSe(e,n){if(1&e&&(P(0,"div",36),U(1),Rt(2,"button",37),O()),2&e){const t=Ge();W(),Zn(" ",t.messageSupplier," ")}}function PSe(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td"),U(8),O(),P(9,"td"),U(10),O(),P(11,"td"),U(12),O(),P(13,"td"),U(14),O(),P(15,"td")(16,"div",38)(17,"div",4)(18,"span",39),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().setCurrentSupplier(i))}),Rt(19,"i",40),O()(),P(20,"div",4)(21,"span",41),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().deleteSupplier(i._id))}),Rt(22,"i",42),O()()()()()}if(2&e){const t=n.$implicit;W(2),tt(t.name),W(2),tt(t.nickname),W(2),tt(t.nit),W(2),tt(t.email),W(2),tt(t.address),W(2),tt(t.phone),W(2),tt(t.typeSupport)}}let RSe=(()=>{class e{constructor(t,r){this.supplierService=t,this.router=r,this.suppliers=[],this.filteredSuppliers=[],this.searchText="",this.messageSupplier="",this.isEditMode=!1,this.currentSupplier={id:null,name:"",nit:"",email:"",address:"",phone:"",nickname:"",typeSupport:""}}ngOnInit(){this.getSuppliers()}getSuppliers(){this.supplierService.getSuppliers().subscribe(t=>{this.suppliers=t,this.filteredSuppliers=t})}filterSuppliers(){this.filteredSuppliers=""!==this.searchText.trim()?this.suppliers.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())||t.nit.toLowerCase().includes(this.searchText.toLowerCase())):this.suppliers}setCurrentSupplier(t){this.isEditMode=!0,this.currentSupplier={...t}}saveSupplier(){this.isEditMode?this.supplierService.updateSupplier(this.currentSupplier).subscribe(t=>{this.getSuppliers(),this.messageSupplier="Proveedor actualizado exitosamente!",this.clearMessageAfterDelay()},t=>{this.messageSupplier="Error al actualizar el proveedor.",this.clearMessageAfterDelay()}):this.supplierService.createSupplier(this.currentSupplier).subscribe(t=>{this.getSuppliers(),this.messageSupplier="Proveedor creado exitosamente!",this.clearMessageAfterDelay()},t=>{this.messageSupplier="Error al crear el proveedor.",this.clearMessageAfterDelay()}),this.isEditMode=!1,this.resetCurrentSupplier()}deleteSupplier(t){this.supplierService.deleteSupplier(t).subscribe(r=>{this.getSuppliers(),this.messageSupplier="Proveedor eliminado exitosamente!",this.clearMessageAfterDelay()},r=>{this.messageSupplier="Error al eliminar el proveedor.",this.clearMessageAfterDelay()})}resetCurrentSupplier(){this.currentSupplier={id:null,name:"",nit:"",email:"",address:"",phone:"",nickname:"",typeSupport:""}}clearMessageAfterDelay(){setTimeout(()=>{this.messageSupplier=""},3e3)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(x4),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-suppliers"]],decls:81,vars:13,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-6"],["type","text","placeholder","Buscar proveedor...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#newSupplierModal","data-bs-dismiss","modal",1,"btn","btn-primary"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","newSupplierModal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-group"],["for","name"],["type","text","id","name",1,"form-control",3,"ngModelChange","ngModel"],["for","nit"],["type","text","id","nit",1,"form-control",3,"ngModelChange","ngModel"],["for","email"],["type","email","id","email",1,"form-control",3,"ngModelChange","ngModel"],["for","address"],["type","text","id","address",1,"form-control",3,"ngModelChange","ngModel"],["for","phone"],["type","text","id","phone",1,"form-control",3,"ngModelChange","ngModel"],["for","typeSupport"],["id","typeSupport",1,"form-select",3,"ngModelChange","ngModel"],["value","Documento soporte"],["value","Factura electr\xf3nica"],["id","type_transaction",1,"form-select",3,"ngModelChange","ngModel"],["value","Efectivo"],["value","Cr\xe9dito"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[1,"row"],["data-bs-toggle","modal","data-bs-target","#newSupplierModal",2,"cursor","pointer",3,"click"],[1,"fas","fa-edit","fa-lg","text-primary"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-trash","fa-lg","text-danger"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterSuppliers()}),O()(),P(4,"div",4)(5,"button",5),U(6,"Nuevo Proveedor"),O()()(),gt(7,OSe,3,1,"div",6),P(8,"table",7)(9,"thead")(10,"tr")(11,"th"),U(12,"Nombre"),O(),P(13,"th"),U(14,"Apodo"),O(),P(15,"th"),U(16,"NIT"),O(),P(17,"th"),U(18,"Email"),O(),P(19,"th"),U(20,"Direcci\xf3n"),O(),P(21,"th"),U(22,"Phone"),O(),P(23,"th"),U(24,"Tipo Soporte"),O(),P(25,"th"),U(26,"Acciones"),O()()(),P(27,"tbody"),gt(28,PSe,23,7,"tr",8),O()()(),P(29,"div",9)(30,"div",10)(31,"div",11)(32,"div",12)(33,"h5",13),U(34),O()(),P(35,"div",14)(36,"div",15)(37,"label",16),U(38,"Nombre:"),O(),P(39,"input",17),St("ngModelChange",function(u){return Dt(i.currentSupplier.name,u)||(i.currentSupplier.name=u),u}),O()(),P(40,"div",15)(41,"label",16),U(42,"Apodo:"),O(),P(43,"input",17),St("ngModelChange",function(u){return Dt(i.currentSupplier.nickname,u)||(i.currentSupplier.nickname=u),u}),O()(),P(44,"div",15)(45,"label",18),U(46,"NIT:"),O(),P(47,"input",19),St("ngModelChange",function(u){return Dt(i.currentSupplier.nit,u)||(i.currentSupplier.nit=u),u}),O()(),P(48,"div",15)(49,"label",20),U(50,"Correo Electr\xf3nico:"),O(),P(51,"input",21),St("ngModelChange",function(u){return Dt(i.currentSupplier.email,u)||(i.currentSupplier.email=u),u}),O()(),P(52,"div",15)(53,"label",22),U(54,"Direcci\xf3n:"),O(),P(55,"input",23),St("ngModelChange",function(u){return Dt(i.currentSupplier.address,u)||(i.currentSupplier.address=u),u}),O()(),P(56,"div",15)(57,"label",24),U(58,"Tel\xe9fono:"),O(),P(59,"input",25),St("ngModelChange",function(u){return Dt(i.currentSupplier.phone,u)||(i.currentSupplier.phone=u),u}),O()(),P(60,"div",15)(61,"label",26),U(62,"Tipo de Soporte:"),O(),P(63,"select",27),St("ngModelChange",function(u){return Dt(i.currentSupplier.typeSupport,u)||(i.currentSupplier.typeSupport=u),u}),P(64,"option",28),U(65,"Documento soporte"),O(),P(66,"option",29),U(67,"Factura electr\xf3nica"),O()()(),P(68,"div",15)(69,"label",26),U(70,"Tipo de Pago:"),O(),P(71,"select",30),St("ngModelChange",function(u){return Dt(i.currentSupplier.type_transaction,u)||(i.currentSupplier.type_transaction=u),u}),P(72,"option",31),U(73,"Efectivo"),O(),P(74,"option",32),U(75,"Cr\xe9dito"),O()()()(),P(76,"div",33)(77,"button",34),U(78,"Cancelar"),O(),P(79,"button",35),ct("click",function(){return i.saveSupplier()}),U(80),O()()()()()),2&r&&(W(3),Ct("ngModel",i.searchText),W(4),Oe("ngIf",i.messageSupplier),W(21),Oe("ngForOf",i.filteredSuppliers),W(6),tt(i.isEditMode?"Editar Proveedor":"Nuevo Proveedor"),W(5),Ct("ngModel",i.currentSupplier.name),W(4),Ct("ngModel",i.currentSupplier.nickname),W(4),Ct("ngModel",i.currentSupplier.nit),W(4),Ct("ngModel",i.currentSupplier.email),W(4),Ct("ngModel",i.currentSupplier.address),W(4),Ct("ngModel",i.currentSupplier.phone),W(4),Ct("ngModel",i.currentSupplier.typeSupport),W(8),Ct("ngModel",i.currentSupplier.type_transaction),W(9),Zn(" ",i.isEditMode?"Guardar Cambios":"Crear Proveedor"," "))},dependencies:[No,So,yd,vd,Hs,eu,so,oo]})}return e})();const NSe=(e,n)=>({"table-success":e,"table-warning":n});function FSe(e,n){if(1&e){const t=lr();P(0,"tr",33),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToStop(i))}),P(1,"td",34),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToStop(i))}),U(2),O(),P(3,"td",34),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToStop(i))}),U(4),O(),P(5,"td",34),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToStop(i))}),U(6),O(),P(7,"td",34),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToStop(i))}),U(8),zn(9,"currency"),O()()}if(2&e){const t=n.$implicit;Oe("ngClass",yv(8,NSe,"Pagada"===t.status,"Pendiente de pago"===t.status)),W(2),tt(t.order),W(2),tt(t.address),W(2),tt(t.client_name),W(2),tt(fs(9,5,t.total_to_charge,"USD"))}}function LSe(e,n){if(1&e&&(P(0,"option",35),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t),W(),Zn("",t," ")}}function BSe(e,n){if(1&e&&(P(0,"option",35),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t),W(),Zn("",t," ")}}let zSe=(()=>{class e{constructor(t,r,i){this.routesService=t,this.router=r,this.route=i,this.stops=[],this.routeNumber=0,this.methedoPayments=["Davivienda","Bancolombia","Efectivo"],this.statusStops=["Por entregar","Pendiente de pago","Pagada"],this.selectedFile=null,this.route.params.subscribe(l=>{this.routeNumber=l.route_number})}ngOnInit(){this.getStops()}getStops(){this.routesService.getRoute(this.routeNumber).subscribe(t=>{this.routeSelect=t,this.stops=t.stops.sort((r,i)=>r.order-i.order),this.stopSelect=this.stops[0]})}onStatusChange(t){"Pagada"===t?this.stopSelect.total_charged=this.stopSelect.total_to_charge:(this.stopSelect.total_charged=0,this.stopSelect.payment_date=null)}navigateToStop(t){this.stopSelect=t}onFileSelected(t){const r=t.target.files[0];if(r){const i=r.name.split(".").pop(),l=`${this.routeNumber}_${this.stopSelect.order}.${i}`,u=new File([r],l,{type:r.type});this.selectedFile=u,this.stopSelect.evidence=l}}saveStop(){const t=new FormData;t.append("route",JSON.stringify(this.routeSelect)),this.selectedFile&&t.append("file",this.selectedFile,this.selectedFile.name),this.routesService.updateStop(this.routeSelect,this.selectedFile).subscribe(r=>{console.log("Parada guardada y ruta actualizada",r)},r=>{console.error("Error al guardar la parada",r)})}navigateToRoute(){this.router.navigate(["/rutas"])}static#e=this.\u0275fac=function(r){return new(r||e)(ut(SO),ut(ws),ut(Su))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-stops"]],decls:89,vars:22,consts:[[1,"container-fluid","mt-5"],[1,"btn","btn-secondary","w-100",3,"click"],[1,"table"],["data-bs-toggle","modal","data-bs-target","#editStop","data-bs-dismiss","modal",3,"ngClass","click",4,"ngFor","ngForOf"],["id","editStop","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"container"],[1,"form-group"],["for","client_name"],["type","client_name","id","client_name","name","client_name","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","address"],["type","address","id","address","name","address","disabled","",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-6"],["type","slot","id","slot","name","slot","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["type","open_hour","id","open_hour","name","open_hour","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","cost"],["type","text","id","cost","name","cost","disabled","",1,"form-control",3,"value"],[1,"form-control",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["for","total_charged"],["type","number","id","total_charged","name","total_charged",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","payment_date"],["type","date","id","payment_date","name","payment_date",1,"form-control",3,"ngModelChange","ngModel"],["for","evidence"],["type","file","id","evidence","name","evidence",1,"form-control",3,"change"],["target","_blank",3,"href"],["data-bs-dismiss","modal",1,"btn","btn-primary","w-100",3,"click","disabled"],["data-bs-dismiss","modal",1,"btn","btn-secondary","w-100"],["data-bs-toggle","modal","data-bs-target","#editStop","data-bs-dismiss","modal",3,"click","ngClass"],[3,"click"],[3,"ngValue"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"button",1),ct("click",function(){return i.navigateToRoute()}),U(2,"Regresar"),O(),Rt(3,"br")(4,"br"),P(5,"h1"),U(6),O(),P(7,"table",2)(8,"thead")(9,"tr")(10,"th"),U(11,"Ruta"),O(),P(12,"th"),U(13,"Direcci\xf3n"),O(),P(14,"th"),U(15,"Cliente"),O(),P(16,"th"),U(17,"Total Pedido"),O()()(),P(18,"tbody"),gt(19,FSe,10,11,"tr",3),O()()(),P(20,"div",4)(21,"div",5)(22,"div",6)(23,"div",7)(24,"h5",8),U(25),O()(),P(26,"div",9)(27,"div",10)(28,"div",11)(29,"label",12),U(30,"Cliente:"),O(),P(31,"input",13),St("ngModelChange",function(u){return Dt(i.stopSelect.client_name,u)||(i.stopSelect.client_name=u),u}),O()(),Rt(32,"br"),P(33,"div",11)(34,"label",14),U(35,"Direcci\xf3n:"),O(),P(36,"input",15),St("ngModelChange",function(u){return Dt(i.stopSelect.address,u)||(i.stopSelect.address=u),u}),O()(),Rt(37,"br"),P(38,"div",16)(39,"div",17)(40,"div",11)(41,"input",18),St("ngModelChange",function(u){return Dt(i.stopSelect.slot,u)||(i.stopSelect.slot=u),u}),O()()(),P(42,"div",17)(43,"div",11)(44,"input",19),St("ngModelChange",function(u){return Dt(i.stopSelect.open_hour,u)||(i.stopSelect.open_hour=u),u}),O()()()(),Rt(45,"br"),P(46,"div",11)(47,"label",20),U(48,"Total a pagar:"),O(),Rt(49,"input",21),zn(50,"currency"),O(),Rt(51,"br"),P(52,"div")(53,"label"),U(54,"Estado:"),O(),P(55,"select",22),St("ngModelChange",function(u){return Dt(i.stopSelect.status,u)||(i.stopSelect.status=u),u}),ct("ngModelChange",function(u){return i.onStatusChange(u)}),gt(56,LSe,2,2,"option",23),O()(),Rt(57,"br"),P(58,"div",11)(59,"label",24),U(60,"Total recibido:"),O(),P(61,"input",25),St("ngModelChange",function(u){return Dt(i.stopSelect.total_charged,u)||(i.stopSelect.total_charged=u),u}),O()(),Rt(62,"br"),P(63,"div")(64,"label"),U(65,"Metodo de pago:"),O(),P(66,"select",22),St("ngModelChange",function(u){return Dt(i.stopSelect.payment_method,u)||(i.stopSelect.payment_method=u),u}),gt(67,BSe,2,2,"option",23),O()(),Rt(68,"br"),P(69,"div",11)(70,"label",26),U(71,"Fecha Pago:"),O(),P(72,"input",27),St("ngModelChange",function(u){return Dt(i.stopSelect.payment_date,u)||(i.stopSelect.payment_date=u),u}),O()(),Rt(73,"br"),P(74,"div",11)(75,"label",28),U(76,"Evidencia (archivo o foto):"),O(),P(77,"input",29),ct("change",function(u){return i.onFileSelected(u)}),O()(),Rt(78,"br"),P(79,"a",30),U(80,"Descargar evidencia"),O(),Rt(81,"br")(82,"br"),P(83,"button",31),ct("click",function(){return i.saveStop()}),U(84,"Guardar Parada"),O(),Rt(85,"br")(86,"br"),P(87,"button",32),U(88,"Cancelar"),O()()()()()()),2&r&&(W(6),Zn("Ruta del ",i.routeSelect.close_date,""),W(13),Oe("ngForOf",i.stops),W(6),Zn("Parada No. ",i.stopSelect.order,""),W(6),Ct("ngModel",i.stopSelect.client_name),W(5),Ct("ngModel",i.stopSelect.address),W(5),Ct("ngModel",i.stopSelect.slot),W(3),Ct("ngModel",i.stopSelect.open_hour),W(5),Oe("value",Ql(50,18,i.stopSelect.total_to_charge,"USD","symbol")),W(6),Ct("ngModel",i.stopSelect.status),W(),Oe("ngForOf",i.statusStops),W(5),Ct("ngModel",i.stopSelect.total_charged),Oe("disabled","Pagada"==i.stopSelect.status),W(5),Ct("ngModel",i.stopSelect.payment_method),W(),Oe("ngForOf",i.methedoPayments),W(5),Ct("ngModel",i.stopSelect.payment_date),W(7),_v("href","https://app.buyfrescapp.com:5000/api/route/route/evidence/",i.stopSelect.evidence,"",_g),W(4),Oe("disabled","Pagada"==i.stopSelect.status&&null==i.stopSelect.payment_date))},dependencies:[Zp,No,yd,vd,Hs,Nh,eu,so,oo,ld]})}return e})();const USe=()=>["administrador"];function VSe(e,n){if(1&e&&(P(0,"div",36),U(1),Rt(2,"button",37),O()),2&e){const t=Ge();W(),Zn(" ",t.messageRoute," ")}}function jSe(e,n){if(1&e){const t=lr();P(0,"div",40)(1,"span",43),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().openEditRoute(i))}),Rt(2,"i",44),O()()}}function $Se(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToRoute(i.route_number))}),U(2),O(),P(3,"td",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToRoute(i.route_number))}),U(4),O(),P(5,"td",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToRoute(i.route_number))}),U(6),zn(7,"currency"),O(),P(8,"td",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToRoute(i.route_number))}),U(9),O(),P(10,"td",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToRoute(i.route_number))}),U(11),zn(12,"currency"),O(),P(13,"td",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToRoute(i.route_number))}),U(14),zn(15,"currency"),O(),P(16,"td",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToRoute(i.route_number))}),U(17),zn(18,"currency"),O(),P(19,"td",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToRoute(i.route_number))}),U(20),zn(21,"currency"),O(),P(22,"td")(23,"div",25),gt(24,jSe,3,0,"div",39),P(25,"div",40)(26,"span",41),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().getRouteConsolidated(i.route_number))}),Rt(27,"i",42),O()()()()()}if(2&e){const t=n.$implicit,r=Ge();W(2),tt(t.route_number),W(2),tt(t.close_date),W(2),tt(fs(7,9,t.cost,"USD")),W(3),Zn(" ",r.calculateTotalStops(t.id)," "),W(2),Zn(" ",fs(12,12,r.calculateTotalToCharge(t.id),"USD")," "),W(3),Zn(" ",fs(15,15,r.calculateTotalPayment(t.id,"Efectivo"),"USD")," "),W(3),Zn(" ",fs(18,18,r.calculateTotalPayment(t.id,"Davivienda"),"USD")," "),W(3),Zn(" ",fs(21,21,r.calculateTotalPayment(t.id,"Bancolombia"),"USD")," "),W(4),Oe("ngIf",r.hasRole(Va(24,USe)))}}function HSe(e,n){if(1&e&&(P(0,"option",48),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),Zn(" ",t," ")}}function GSe(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td")(6,"select",45),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.driver_name,i)||(l.driver_name=i),zt(i)}),gt(7,HSe,2,2,"option",46),O()(),P(8,"td"),U(9),O(),P(10,"td")(11,"input",47),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.order,i)||(l.order=i),zt(i)}),O()()()}if(2&e){const t=n.$implicit,r=Ge();W(2),tt(t.client_name),W(2),tt(t.address),W(2),Ct("ngModel",t.driver_name),W(),Oe("ngForOf",r.drivers),W(2),tt(t.slot+" ("+t.open_hour+")"),W(2),Ct("ngModel",t.order)}}function WSe(e,n){if(1&e&&(P(0,"li"),U(1),O()),2&e){const t=n.$implicit;W(),tt(t)}}function qSe(e,n){if(1&e&&(P(0,"div",49)(1,"div",50)(2,"div",51)(3,"h5",52),U(4),O()(),P(5,"div",53)(6,"p")(7,"strong"),U(8,"Paradas:"),O(),U(9),O(),P(10,"ul",54)(11,"li")(12,"strong"),U(13,"Efectivo:"),O(),U(14),zn(15,"currency"),O(),P(16,"li")(17,"strong"),U(18,"Davivienda:"),O(),U(19),zn(20,"currency"),O(),P(21,"li")(22,"strong"),U(23,"Bancolombia:"),O(),U(24),zn(25,"currency"),O()(),P(26,"p")(27,"strong"),U(28,"Cantidad de items:"),O(),U(29),O(),P(30,"p")(31,"strong"),U(32,"Peso Kg/Und:"),O(),U(33),O(),P(34,"ul"),gt(35,WSe,2,1,"li",7),O()()()()),2&e){const t=n.$implicit;W(4),tt(t.driver_name||"Sin asignar"),W(5),Zn(" ",t.cantidad_stops,""),W(5),Zn(" ",fs(15,8,t.dinero_por_metodo.Efectivo,"USD"),""),W(5),Zn(" ",fs(20,11,t.dinero_por_metodo.Davivienda,"USD"),""),W(5),Zn(" ",fs(25,14,t.dinero_por_metodo.Bancolombia,"USD"),""),W(5),Zn(" ",t.cantidad_sku,""),W(4),Zn(" ",t.total_products_quantity,""),W(2),Oe("ngForOf",t.order_numbers)}}let ZSe=(()=>{class e{constructor(t,r){this.routesService=t,this.router=r,this.filteredRoutes=[],this.routes=[],this.searchText="",this.messageRoute="",this.newRouteDate="",this.newRouteDriver="",this.newCost=0,this.drivers=["Carlos","Diago","Jhony","Sebas","Cata"],this.selectedRoute="",this.routeConsolidada=null}ngOnInit(){this.getRoutes()}hasRole(t){return t.some(r=>localStorage.getItem("role")?.includes(r))}getRoutes(){this.routesService.getRoutes().subscribe(t=>{this.routes=t,this.filteredRoutes=this.routes})}filterRoutes(){}createRoute(){this.routesService.createRoute(this.newRouteDate,this.newRouteDriver,this.newCost).subscribe(t=>{this.messageRoute="Nueva ruta creada exitosamente!",this.getRoutes(),this.filteredRoutes=this.routes})}deleteRoute(t){this.routesService.delteRoute(t.id).subscribe(r=>{this.messageRoute="Ruta eliminada exitosamente!",this.getRoutes(),this.filteredRoutes=this.routes})}navigateToRoute(t){this.router.navigate(["/stops",t])}programarRuta(t){}calculateTotalToCharge(t){const r=this.filteredRoutes.find(i=>i.id===t);if(r){let i=0;return r.stops.forEach(l=>{i+=l.total_to_charge}),i}return 0}calculateTotalPayment(t,r){const i=this.filteredRoutes.find(l=>l.id===t);if(i){let l=0;return i.stops.forEach(u=>{u.payment_method==r&&(l+=Number(u.total_charged))}),l}return 0}calculateTotalStops(t){const r=this.filteredRoutes.find(i=>i.id===t);return r?r.stops.length:0}openEditRoute(t){this.selectedRoute={...t},this.selectedRoute.stops=this.selectedRoute.stops.sort((r,i)=>r.order-i.order)}moveStopUp(t){if(t>0){const r=this.selectedRoute.stops;[r[t-1],r[t]]=[r[t],r[t-1]]}}moveStopDown(t){const r=this.selectedRoute.stops;t<r.length-1&&([r[t],r[t+1]]=[r[t+1],r[t]])}updateRoute(){this.routesService.updateRoute(this.selectedRoute).subscribe(t=>{this.getRoutes()})}getRouteConsolidated(t){this.routesService.getRouteConsolidated(t).subscribe(r=>{this.routeConsolidada=r})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(SO),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-list-rutas"]],decls:104,vars:10,consts:[["rel","stylesheet","href",Mf`https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css`],[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-6"],["type","text","placeholder","Buscar ruta...",1,"form-control",3,"ngModelChange","keyup","ngModel"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","newRouteModal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"container"],[1,"form-group"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],["for","cost"],["type","number","id","cost","name","cost",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],["id","editRouteModal","tabindex","-1","role","dialog",1,"modal","fade","bd-example-modal-lg"],["role","document",1,"modal-dialog","modal-dialog-centered",2,"max-width","40%"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"row"],["for","editFecha"],["type","date","id","editFecha",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","editCost"],["type","number","id","editCost",1,"form-control",3,"ngModelChange","ngModel"],[1,"table","table-bordered"],["id","RouteConsolidada","tabindex","-1","role","dialog","aria-labelledby","RouteConsolidadaLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],["type","button","data-dismiss","modal","aria-label","Cerrar",1,"close"],["aria-hidden","true"],["class","col-md-4 mb-3",4,"ngFor","ngForOf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[3,"click"],["class","col-auto",4,"ngIf"],[1,"col-auto"],["data-bs-toggle","modal","data-bs-target","#RouteConsolidada","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fa","fa-money","fa-lg","text-warning"],["data-bs-toggle","modal","data-bs-target","#editRouteModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-calendar","fa-lg","text-success"],[1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Orden",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],[1,"col-md-4","mb-3"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],[1,"card-body"],[1,"list-unstyled"]],template:function(r,i){1&r&&(Rt(0,"link",0),P(1,"div",1)(2,"div",2)(3,"div",3)(4,"input",4),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterRoutes()}),O()()(),gt(5,VSe,3,1,"div",5),P(6,"table",6)(7,"thead")(8,"tr")(9,"th"),U(10,"Ruta"),O(),P(11,"th"),U(12,"Fecha"),O(),P(13,"th"),U(14,"Costo"),O(),P(15,"th"),U(16,"Cantidad de Paradas"),O(),P(17,"th"),U(18,"Dinero a Recaudar"),O(),P(19,"th"),U(20,"Efectivo"),O(),P(21,"th"),U(22,"Davivienda"),O(),P(23,"th"),U(24,"Bancolombia"),O(),P(25,"th"),U(26,"Acciones"),O()()(),P(27,"tbody"),gt(28,$Se,28,25,"tr",7),O()()(),P(29,"div",8)(30,"div",9)(31,"div",10)(32,"div",11)(33,"h5",12),U(34,"Nueva Ruta"),O()(),P(35,"div",13)(36,"div",14)(37,"div",15)(38,"label",16),U(39,"Fecha:"),O(),P(40,"input",17),St("ngModelChange",function(u){return Dt(i.newRouteDate,u)||(i.newRouteDate=u),u}),O()(),Rt(41,"br"),P(42,"div",15)(43,"label",18),U(44,"Costo:"),O(),P(45,"input",19),St("ngModelChange",function(u){return Dt(i.newCost,u)||(i.newCost=u),u}),O()(),Rt(46,"br"),P(47,"div",20)(48,"button",21),ct("click",function(){return i.createRoute()}),U(49,"Crear Ruta"),O()()()()()()(),P(50,"div",22)(51,"div",23)(52,"div",10)(53,"div",11)(54,"h5",12),U(55,"Editar Ruta"),O(),Rt(56,"button",24),O(),P(57,"div",13)(58,"div",14)(59,"div",25)(60,"div",3)(61,"div",15)(62,"label",26),U(63,"Fecha:"),O(),P(64,"input",27),St("ngModelChange",function(u){return Dt(i.selectedRoute.close_date,u)||(i.selectedRoute.close_date=u),u}),O()()(),P(65,"div",3)(66,"div",15)(67,"label",28),U(68,"Costo:"),O(),P(69,"input",29),St("ngModelChange",function(u){return Dt(i.selectedRoute.cost,u)||(i.selectedRoute.cost=u),u}),O()()()(),Rt(70,"br"),P(71,"div",15)(72,"label"),U(73,"Orden de Paradas:"),O(),P(74,"table",30)(75,"thead")(76,"tr")(77,"th"),U(78,"Cliente"),O(),P(79,"th"),U(80,"Direcci\xf3n"),O(),P(81,"th"),U(82,"Conductor"),O(),P(83,"th"),U(84,"Horario"),O(),P(85,"th"),U(86,"Orden"),O()()(),P(87,"tbody"),gt(88,GSe,12,6,"tr",7),O()()(),Rt(89,"br"),P(90,"div",20)(91,"button",21),ct("click",function(){return i.updateRoute()}),U(92,"Guardar Cambios"),O()()()()()()(),P(93,"div",31)(94,"div",32)(95,"div",10)(96,"div",11)(97,"button",33)(98,"span",34),U(99,"\xd7"),O()()(),P(100,"div",13)(101,"div",14)(102,"div",25),gt(103,qSe,36,17,"div",35),O()()()()()()),2&r&&(W(4),Ct("ngModel",i.searchText),W(),Oe("ngIf",i.messageRoute),W(23),Oe("ngForOf",i.filteredRoutes),W(12),Ct("ngModel",i.newRouteDate),W(5),Ct("ngModel",i.newCost),W(19),Ct("ngModel",i.selectedRoute.close_date),Oe("disabled",!0),W(5),Ct("ngModel",i.selectedRoute.cost),W(19),Oe("ngForOf",i.selectedRoute.stops),W(15),Oe("ngForOf",i.routeConsolidada))},dependencies:[No,So,yd,vd,Hs,Nh,eu,so,oo,ld]})}return e})(),XSe=(()=>{class e{constructor(t){this.httpClient=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getProductsHistory(t,r){return this.httpClient.get(this.baseUrl+"api/products_history/products_history/"+t+"/"+r)}updatePrices(t){return this.httpClient.get(this.baseUrl+"api/products_history/products_history_new/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function YSe(e,n){1&e&&Rt(0,"br")}function KSe(e,n){if(1&e&&(P(0,"div",23),U(1),O()),2&e){const t=Ge();W(),Zn(" ",t.successMessage," ")}}function JSe(e,n){if(1&e&&(P(0,"div",24),U(1),O()),2&e){const t=Ge();W(),Zn(" ",t.errorMessage," ")}}function QSe(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td"),U(8),O(),P(9,"td"),U(10),O(),P(11,"td"),U(12),O(),P(13,"td"),U(14),O(),P(15,"td"),U(16),O(),P(17,"td"),U(18),O(),P(19,"td"),U(20),O(),P(21,"td"),U(22),O(),P(23,"td"),U(24),O(),P(25,"td"),U(26),zn(27,"currency"),O(),P(28,"td"),U(29),zn(30,"currency"),O(),P(31,"td"),U(32),zn(33,"currency"),O(),P(34,"td"),U(35),zn(36,"currency"),O(),P(37,"td"),U(38),zn(39,"currency"),O(),P(40,"td"),U(41),zn(42,"currency"),O(),P(43,"td"),U(44),zn(45,"currency"),O(),P(46,"td"),U(47),zn(48,"currency"),O()()),2&e){const t=n.$implicit;W(2),tt(t.operation_date),W(2),tt(t.name),W(2),tt(t.sku),W(2),tt(t.unit),W(2),tt(t.category),W(2),tt(t.root),W(2),tt(t.child),W(2),tt(t.step_unit),W(2),tt(t.step_unit_sipsa),W(2),tt(t.factor_volumen),W(2),tt(t.sipsa_id),W(2),tt(t.margen),W(2),tt(Jo(27,20,t.last_price_purchased,"USD","symbol","1.0-0")),W(3),tt(Jo(30,25,t.last_price_purchase,"USD","symbol","1.0-0")),W(3),tt(Jo(33,30,t.last_price_sale,"USD","symbol","1.0-0")),W(3),tt(Jo(36,35,t.minimoKg,"USD","symbol","1.0-0")),W(3),tt(Jo(39,40,t.maximoKg,"USD","symbol","1.0-0")),W(3),tt(Jo(42,45,t.promedioKg,"USD","symbol","1.0-0")),W(3),tt(Jo(45,50,t.price_sale,"USD","symbol","1.0-0")),W(3),tt(Jo(48,55,t.price_purchase,"USD","symbol","1.0-0"))}}function eDe(e,n){if(1&e){const t=lr();P(0,"div")(1,"div",25)(2,"div",26)(3,"label",27),U(4,"Fecha:"),O(),P(5,"input",28),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.operationDate,i)||(l.operationDate=i),zt(i)}),O()(),Rt(6,"br"),P(7,"div",29)(8,"button",7),ct("click",function(){Bt(t);const i=Ge();return zt(i.updatePrices(i.operationDate))}),U(9,"Actualizar Precios"),O()()()()}if(2&e){const t=Ge();W(5),Ct("ngModel",t.operationDate)}}function tDe(e,n){1&e&&(P(0,"div",30)(1,"div",31)(2,"span",32),U(3,"Cargando..."),O()(),P(4,"p",33),U(5,"Actualizando precios, por favor espera..."),O()())}let nDe=(()=>{class e{constructor(t,r){this.productHistoryService=t,this.router=r,this.products=[],this.filteredProducts=[],this.searchText="",this.today=new Date,this.yyyy=this.today.getFullYear(),this.mm=String(this.today.getMonth()+1).padStart(2,"0"),this.dd=String(this.today.getDate()).padStart(2,"0"),this.searchDate_start=`${this.yyyy}-${this.mm}-${this.dd}`,this.searchDate_end=`${this.yyyy}-${this.mm}-${this.dd}`,this.operationDate=`${this.yyyy}-${this.mm}-${this.dd}`,this.product={},this.actionTipo="",this.successMessage="",this.errorMessage="",this.isLoading=!1}ngOnInit(){this.getProducts(this.searchDate_start,this.searchDate_end)}getProducts(t,r){this.productHistoryService.getProductsHistory(t,r).subscribe(i=>{this.products=i,this.filteredProducts=i,this.filterProducts()})}filterProducts(){const t=this.searchText.trim().toLowerCase();this.filteredProducts=""!==t?this.products.filter(r=>r.sku.toLowerCase().includes(t)||r.name.toLowerCase().includes(t)||r.category.toLowerCase().includes(t)):this.products}updatePrices(t){this.isLoading=!0,this.productHistoryService.updatePrices(t).subscribe(r=>{this.successMessage="Precios actualizados correctamente.",this.isLoading=!1},r=>{this.errorMessage="Hubo un error al actualizar los precios.",this.isLoading=!1})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(XSe),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-pricing"]],decls:74,vars:9,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-6"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"col-auto"],["type","date","id","fechaInicio",1,"form-control",3,"ngModelChange","ngModel"],["type","date","id","fechaFin",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-search"],["data-bs-toggle","modal","data-bs-target","#update_price","data-bs-dismiss","modal",1,"btn","btn-primary"],[1,"fas","fa-refresh"],[4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","update_price","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","update_price",1,"modal-title"],[1,"modal-body"],["class","text-center",4,"ngIf"],["role","alert",1,"alert","alert-success"],["role","alert",1,"alert","alert-danger"],[1,"container"],[1,"form-group"],["for","fecha"],["type","date","id","operationDate",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-right"],[1,"text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterProducts()}),O()(),P(4,"div",4)(5,"input",5),St("ngModelChange",function(u){return Dt(i.searchDate_start,u)||(i.searchDate_start=u),u}),O()(),P(6,"div",4)(7,"input",6),St("ngModelChange",function(u){return Dt(i.searchDate_end,u)||(i.searchDate_end=u),u}),O()(),P(8,"div",4)(9,"button",7),ct("click",function(){return i.getProducts(i.searchDate_start,i.searchDate_end)}),Rt(10,"i",8),U(11," Buscar "),O()(),P(12,"div",4)(13,"button",9),Rt(14,"i",10),U(15," Actualizar precios "),O()()(),gt(16,YSe,1,0,"br",11)(17,KSe,2,1,"div",12)(18,JSe,2,1,"div",13),Rt(19,"br"),P(20,"table",14)(21,"thead")(22,"tr")(23,"th"),U(24,"Fecha"),O(),P(25,"th"),U(26,"Nombre"),O(),P(27,"th"),U(28,"sku"),O(),P(29,"th"),U(30,"Unidad"),O(),P(31,"th"),U(32,"Categoria"),O(),P(33,"th"),U(34,"Padre"),O(),P(35,"th"),U(36,"Hijo"),O(),P(37,"th"),U(38,"Step Unit"),O(),P(39,"th"),U(40,"Step Unit Sipsa"),O(),P(41,"th"),U(42,"Factor Volumen"),O(),P(43,"th"),U(44,"Sipsa ID"),O(),P(45,"th"),U(46,"Margen"),O(),P(47,"th"),U(48,"\xdaltima Compra"),O(),P(49,"th"),U(50,"\xdaltima Compra Sugerida"),O(),P(51,"th"),U(52,"\xdaltima Precio Venta"),O(),P(53,"th"),U(54,"Sipsa M\xednimo"),O(),P(55,"th"),U(56,"Sipsa M\xe1ximo"),O(),P(57,"th"),U(58,"Sipsa Promedio"),O(),P(59,"th"),U(60,"Precio Venta"),O(),P(61,"th"),U(62,"Precio Compra"),O()()(),P(63,"tbody"),gt(64,QSe,49,60,"tr",15),O()()(),P(65,"div",16)(66,"div",17)(67,"div",18)(68,"div",19)(69,"h5",20),U(70,"Actulizar Precios"),O()(),P(71,"div",21),gt(72,eDe,10,1,"div",11)(73,tDe,6,0,"div",22),O()()()()),2&r&&(W(3),Ct("ngModel",i.searchText),W(2),Ct("ngModel",i.searchDate_start),W(2),Ct("ngModel",i.searchDate_end),W(9),Oe("ngIf",i.successMessage),W(),Oe("ngIf",i.successMessage),W(),Oe("ngIf",i.errorMessage),W(46),Oe("ngForOf",i.filteredProducts),W(8),Oe("ngIf",!i.isLoading),W(),Oe("ngIf",i.isLoading))},dependencies:[No,So,Hs,so,oo,ld]})}return e})(),rDe=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getCostos(){return this.http.get(this.baseUrl+"api/cost/cost")}updateCosto(t){return this.http.put(this.baseUrl+"api/cost/cost",t)}deleteCosto(t){return this.http.delete(this.baseUrl+"api/cost/cost/"+t)}createCosto(t){return this.http.post(this.baseUrl+"api/cost/cost",t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function iDe(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),zn(7,"currency"),O(),P(8,"td"),U(9),O(),P(10,"td"),U(11),O(),P(12,"td")(13,"button",36),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().editCost(i))}),Rt(14,"i",37),O(),P(15,"button",38),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().deleteCost(i))}),Rt(16,"i",39),O()()()}if(2&e){const t=n.$implicit;W(2),tt(t.typeCost),W(2),tt(t.detail),W(2),tt(vc(7,5,t.amount)),W(3),tt(t.typePeriod),W(2),tt(t.period)}}function sDe(e,n){if(1&e&&(P(0,"option",42),U(1),O()),2&e){const t=n.$implicit;Oe("value",t),W(),tt(t)}}function oDe(e,n){if(1&e){const t=lr();P(0,"div",14)(1,"label",40),U(2,"Mes"),O(),P(3,"select",16),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.currentCost.period,i)||(l.currentCost.period=i),zt(i)}),gt(4,sDe,2,2,"option",41),O()()}if(2&e){const t=Ge();W(3),Ct("ngModel",t.currentCost.period),W(),Oe("ngForOf",t.months)}}function aDe(e,n){if(1&e){const t=lr();P(0,"div",14)(1,"label",43),U(2,"N\xfamero de Semana"),O(),P(3,"input",26),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.currentCost.period,i)||(l.currentCost.period=i),zt(i)}),O()()}if(2&e){const t=Ge();W(3),Ct("ngModel",t.currentCost.period)}}function lDe(e,n){if(1&e){const t=lr();P(0,"div",14)(1,"label",44),U(2,"Fecha"),O(),P(3,"input",45),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.currentCost.period,i)||(l.currentCost.period=i),zt(i)}),O()()}if(2&e){const t=Ge();W(3),Ct("ngModel",t.currentCost.period)}}let cDe=(()=>{class e{constructor(t){this.costService=t,this.costs=[],this.currentCost={},this.editingCost=!1,this.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],this.messageCost="",this.statusCodeCost=""}ngOnInit(){this.getCosts()}openNewCostModal(){this.currentCost={typeCost:"",detail:"",amount:0,typePeriod:"",period:""},this.editingCost=!1}getCosts(){this.costService.getCostos().subscribe(t=>{this.costs=t})}editCost(t){this.currentCost={...t},this.editingCost=!0}saveCost(){this.editingCost?this.costService.updateCosto(this.currentCost).subscribe(t=>{this.getCosts(),this.messageCost="Costo actualizado exitosamente!",this.statusCodeCost=t.statusCode||"200",setTimeout(()=>{this.messageCost=""},3e3)},t=>{this.messageCost="Fallo al actualizar el costo.",this.statusCodeCost=t.status||"500",setTimeout(()=>{this.messageCost=""},3e3)}):this.costService.createCosto(this.currentCost).subscribe(t=>{this.getCosts(),this.messageCost="Costo creado exitosamente!",this.statusCodeCost=t.statusCode||"200",setTimeout(()=>{this.messageCost=""},3e3)},t=>{this.messageCost="Fallo al crear el costo.",this.statusCodeCost=t.status||"500",setTimeout(()=>{this.messageCost=""},3e3)})}deleteCost(t){this.costService.deleteCosto(t.id).subscribe(r=>{this.getCosts(),this.messageCost="Costo eliminado exitosamente!",this.statusCodeCost=r.statusCode||"200",setTimeout(()=>{this.messageCost=""},3e3)},r=>{this.messageCost="Fallo al eliminar el costo.",this.statusCodeCost=r.status||"500",setTimeout(()=>{this.messageCost=""},3e3)})}resetPeriodDetail(){this.currentCost.periodDetail=""}static#e=this.\u0275fac=function(r){return new(r||e)(ut(rDe))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-costs"]],decls:73,vars:9,consts:[[1,"container-fluid","mt-5"],[1,"row","mb-3"],[1,"col-auto"],["data-bs-toggle","modal","data-bs-target","#costModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus-circle"],[1,"table"],[4,"ngFor","ngForOf"],["id","costModal","tabindex","-1","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"btn-close"],[1,"modal-body"],[1,"form-group","mb-3"],["for","type"],[1,"form-control",3,"ngModelChange","ngModel"],["value","cost_supply"],["value","perssonel"],["value","cost_tech"],["value","wh_rent"],["value","sales_force"],["value","cost_others"],["for","detail"],["type","text",1,"form-control",3,"ngModelChange","ngModel"],["for","amount"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],["for","period"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value","Mensual"],["value","Semanal"],["value","Diario"],["class","form-group mb-3",4,"ngIf"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],["data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],["data-bs-dismiss","modal","data-bs-toggle","modal","data-bs-target","#costModal",1,"btn","btn-primary","btn-sm",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"fas","fa-trash"],["for","month"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["for","week"],["for","date"],["type","date",1,"form-control",3,"ngModelChange","ngModel"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),ct("click",function(){return i.openNewCostModal()}),Rt(4,"i",4),U(5," Agregar Costo "),O()()(),P(6,"table",5)(7,"thead")(8,"tr")(9,"th"),U(10,"Tipo de Costo"),O(),P(11,"th"),U(12,"Detalle"),O(),P(13,"th"),U(14,"Monto"),O(),P(15,"th"),U(16,"Tipo Periodo"),O(),P(17,"th"),U(18,"Periodo"),O(),P(19,"th"),U(20,"Acciones"),O()()(),P(21,"tbody"),gt(22,iDe,17,7,"tr",6),O()(),P(23,"div",7)(24,"div",8)(25,"div",9)(26,"div",10)(27,"h5",11),U(28),O(),Rt(29,"button",12),O(),P(30,"div",13)(31,"div",14)(32,"label",15),U(33,"Tipo de Costo"),O(),P(34,"select",16),St("ngModelChange",function(u){return Dt(i.currentCost.typeCost,u)||(i.currentCost.typeCost=u),u}),P(35,"option",17),U(36,"Insumos"),O(),P(37,"option",18),U(38,"Auxiliar Ops"),O(),P(39,"option",19),U(40,"Tecnolog\xeda"),O(),P(41,"option",20),U(42,"Arriendo"),O(),P(43,"option",21),U(44,"Fuerza de Venta"),O(),P(45,"option",22),U(46,"Otro"),O()()(),P(47,"div",14)(48,"label",23),U(49,"Detalle"),O(),P(50,"input",24),St("ngModelChange",function(u){return Dt(i.currentCost.detail,u)||(i.currentCost.detail=u),u}),O()(),P(51,"div",14)(52,"label",25),U(53,"Monto"),O(),P(54,"input",26),St("ngModelChange",function(u){return Dt(i.currentCost.amount,u)||(i.currentCost.amount=u),u}),O()(),P(55,"div",14)(56,"label",27),U(57,"Periodo"),O(),P(58,"select",28),St("ngModelChange",function(u){return Dt(i.currentCost.typePeriod,u)||(i.currentCost.typePeriod=u),u}),ct("change",function(){return i.resetPeriodDetail()}),P(59,"option",29),U(60,"Mensual"),O(),P(61,"option",30),U(62,"Semanal"),O(),P(63,"option",31),U(64,"Diario"),O()()(),gt(65,oDe,5,2,"div",32)(66,aDe,4,1,"div",32)(67,lDe,4,1,"div",32),O(),P(68,"div",33)(69,"button",34),U(70,"Cancelar"),O(),P(71,"button",35),ct("click",function(){return i.saveCost()}),U(72," Guardar "),O()()()()()()),2&r&&(W(22),Oe("ngForOf",i.costs),W(6),tt(i.editingCost?"Editar Costo":"Nuevo Costo"),W(6),Ct("ngModel",i.currentCost.typeCost),W(16),Ct("ngModel",i.currentCost.detail),W(4),Ct("ngModel",i.currentCost.amount),W(4),Ct("ngModel",i.currentCost.typePeriod),W(7),Oe("ngIf","Mensual"===i.currentCost.typePeriod),W(),Oe("ngIf","Semanal"===i.currentCost.typePeriod),W(),Oe("ngIf","Diario"===i.currentCost.typePeriod))},dependencies:[No,So,yd,vd,Hs,Nh,eu,so,oo,ld]})}return e})(),yq=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getInventories(){return this.http.get(this.baseUrl+"api/inventory/inventories")}getInventory(t){return this.http.get(this.baseUrl+"api/inventory/inventory/"+t)}updateInventory(t){return this.http.put(`${this.baseUrl}/api/inventory/inventory/${t.id}`,t)}deleteInventory(t){return this.http.delete(this.baseUrl+"api/inventory/inventory/"+t)}createInventory(t){return this.http.get(this.baseUrl+"api/inventory/create/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function uDe(e,n){if(1&e&&(P(0,"div",16),U(1),Rt(2,"button",17),O()),2&e){const t=Ge();W(),Zn(" ",t.messageInventory," ")}}function dDe(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td",18),U(4),O(),P(5,"td",19),U(6),zn(7,"currency"),O(),P(8,"td")(9,"div",20)(10,"div",21)(11,"span",22),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToInventory(i.id))}),Rt(12,"i",23),O()()()()()}if(2&e){const t=n.$implicit,r=Ge();W(2),tt(t.close_date),W(2),Zn(" ",r.productsCost(t.products)," "),W(2),Zn(" ",Jo(7,3,r.productsValue(t.products),"USD","symbol","1.2-2")," ")}}let hDe=(()=>{class e{constructor(t,r){this.router=t,this.inventoryService=r,this.inventories=[],this.messageInventory="",this.fechaNewInventory="",this.statusCodeInventory=""}ngOnInit(){this.getInventories()}hasRole(t){return t.some(r=>localStorage.getItem("role")?.includes(r))}newInventory(){this.inventoryService.createInventory(this.fechaNewInventory).subscribe(t=>{this.getInventories(),this.messageInventory="Inventario creado exitosamente!",this.statusCodeInventory=t.statusCode||"200",setTimeout(()=>{this.messageInventory=""},3e3)},t=>{this.messageInventory="Fallo al crear el Inventario.",this.statusCodeInventory=t.status||"500",setTimeout(()=>{this.messageInventory=""},3e3)})}delete_inventory(t){this.inventoryService.deleteInventory(t).subscribe(r=>{this.getInventories(),this.messageInventory="Inventario eliminado exitosamente!",this.statusCodeInventory=r.statusCode||"200",setTimeout(()=>{this.messageInventory=""},3e3)},r=>{this.messageInventory="Fallo al eliminar el Inventario.",this.statusCodeInventory=r.status||"500",setTimeout(()=>{this.messageInventory=""},3e3)})}navigateToInventory(t){this.router.navigate(["/inventory",t])}getInventories(){this.inventoryService.getInventories().subscribe(t=>{this.inventories=t.sort((r,i)=>new Date(i.close_date).getTime()-new Date(r.close_date).getTime())})}productsCost(t){if(0===t.length)return 0;const r=t.filter(i=>i.quantity>0).length;return Math.round(r)}productsValue(t){if(0===t.length)return 0;const r=t.reduce((i,l)=>l.quantity>0&&l.cost>0?i+l.quantity*l.cost:i,0);return Math.round(r)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ws),ut(yq))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["ng-component"]],decls:31,vars:3,consts:[[1,"container-fluid","mt-5"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","newInventory","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","newInventory",1,"modal-title"],[1,"modal-body"],[1,"container"],[1,"form-group"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],["id","product-count"],["id","cost"],[1,"row"],[1,"col-auto"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-pencil","fa-lg","text-primary"]],template:function(r,i){1&r&&(P(0,"div",0),gt(1,uDe,3,1,"div",1),P(2,"table",2)(3,"thead")(4,"tr")(5,"th"),U(6,"Fecha"),O(),P(7,"th"),U(8,"Productos Registrados"),O(),P(9,"th"),U(10,"Costo"),O(),P(11,"th"),U(12,"Acciones"),O()()(),P(13,"tbody"),gt(14,dDe,13,8,"tr",3),O()()(),P(15,"div",4)(16,"div",5)(17,"div",6)(18,"div",7)(19,"h5",8),U(20,"Nuevo Inventario"),O()(),P(21,"div",9)(22,"div",10)(23,"div",11)(24,"label",12),U(25,"Fecha:"),O(),P(26,"input",13),St("ngModelChange",function(u){return Dt(i.fechaNewInventory,u)||(i.fechaNewInventory=u),u}),O()(),Rt(27,"br"),P(28,"div",14)(29,"button",15),ct("click",function(){return i.newInventory()}),U(30,"Nuevo Inventario"),O()()()()()()()),2&r&&(W(),Oe("ngIf",i.messageInventory),W(13),Oe("ngForOf",i.inventories),W(12),Ct("ngModel",i.fechaNewInventory))},dependencies:[No,So,Hs,so,oo,ld]})}return e})();const fDe=e=>({"table-success":e});function pDe(e,n){if(1&e){const t=lr();P(0,"tr",9)(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td")(6,"input",10),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.cost,i)||(l.cost=i),zt(i)}),O()(),P(7,"td")(8,"input",10),St("ngModelChange",function(i){const l=Bt(t).$implicit;return Dt(l.quantity,i)||(l.quantity=i),zt(i)}),O()()()}if(2&e){const t=n.$implicit;Oe("ngClass",ba(5,fDe,t.quantity>0)),W(2),tt(t.sku),W(2),tt(t.name),W(2),Ct("ngModel",t.cost),W(2),Ct("ngModel",t.quantity)}}let mDe=(()=>{class e{constructor(t,r,i){this.router=t,this.inventoryService=r,this.route=i,this.filteredProducts=[],this.searchTerm="",this.inventoryId="",this.route.params.subscribe(l=>{this.inventoryId=l.id})}ngOnInit(){this.getInventory()}getInventory(){this.inventoryService.getInventory(this.inventoryId).subscribe(t=>{this.inventory=t,this.filteredProducts=this.inventory.products.sort((r,i)=>i.quantity-r.quantity)})}filterProducts(){this.filteredProducts=this.inventory.products.filter(t=>t.name.toLowerCase().includes(this.searchTerm.toLowerCase()))}saveChanges(){this.inventory.products=this.inventory.products.map(t=>{const r=this.filteredProducts.find(i=>i.sku===t.sku);return r?{...t,cost:r.cost,quantity:r.quantity}:t}),this.inventoryService.updateInventory(this.inventory).subscribe(t=>{this.getInventory()},t=>{console.error("Error al actualizar el inventario:",t)})}goBack(){this.router.navigate(["/inventories"])}static#e=this.\u0275fac=function(r){return new(r||e)(ut(ws),ut(yq),ut(Su))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["ng-component"]],decls:23,vars:2,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-8"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-auto"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-secondary",3,"click"],[1,"table"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],["type","number","min","0",1,"form-control",3,"ngModelChange","ngModel"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),St("ngModelChange",function(u){return Dt(i.searchTerm,u)||(i.searchTerm=u),u}),ct("ngModelChange",function(){return i.filterProducts()}),O()(),P(4,"div",4)(5,"button",5),ct("click",function(){return i.saveChanges()}),U(6,"Guardar"),O()(),P(7,"div",4)(8,"button",6),ct("click",function(){return i.goBack()}),U(9,"Regresar"),O()()(),P(10,"table",7)(11,"thead")(12,"tr")(13,"th"),U(14,"Sku"),O(),P(15,"th"),U(16,"Nombre"),O(),P(17,"th"),U(18,"Costo"),O(),P(19,"th"),U(20,"Cantidad"),O()()(),P(21,"tbody"),gt(22,pDe,9,7,"tr",8),O()()()),2&r&&(W(3),Ct("ngModel",i.searchTerm),W(19),Oe("ngForOf",i.filteredProducts))},dependencies:[Zp,No,Hs,Nh,so,CO,oo]})}return e})(),vq=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getCierres(){return this.http.get(this.baseUrl+"api/cierres/")}getCierre(t){return this.http.get(this.baseUrl+"api/cierres/"+t+"/")}updateCierre(t){return this.http.put(`${this.baseUrl}api/cierres/${t.id}`,t)}deleteCierre(t){return this.http.delete(this.baseUrl+"api/cierres/"+t)}createCierre(t){return this.http.post(this.baseUrl+"api/cierres/"+t,{})}saveCierre(t){return t.id?this.updateCierre(t):this.createCierre(t.fecha)}validateCierre(t){return this.http.get(this.baseUrl+"api/cierres/validate/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const gDe=(e,n,t)=>({"badge bg-danger":e,"badge bg-warning text-dark":n,"badge bg-secondary":t});function _De(e,n){if(1&e){const t=lr();P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),zn(5,"currency"),O(),P(6,"td"),U(7),O(),P(8,"td"),U(9),O(),P(10,"td"),U(11),zn(12,"currency"),O(),P(13,"td"),U(14),zn(15,"currency"),O(),P(16,"td"),U(17),zn(18,"currency"),O(),P(19,"td"),U(20),zn(21,"currency"),O(),P(22,"td"),U(23),zn(24,"currency"),O(),P(25,"td"),U(26),zn(27,"currency"),O(),P(28,"td"),U(29),zn(30,"currency"),O(),P(31,"td"),U(32),O(),P(33,"td"),U(34),zn(35,"currency"),O(),P(36,"td"),U(37),zn(38,"currency"),O(),P(39,"td"),U(40),zn(41,"currency"),O(),P(42,"td"),U(43),zn(44,"currency"),O(),P(45,"td"),U(46),zn(47,"currency"),O(),P(48,"td"),U(49),zn(50,"currency"),O(),P(51,"td")(52,"div",23)(53,"div",3)(54,"span",24),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().toCierre(i))}),Rt(55,"i",25),O()()()()()}if(2&e){const t=n.$implicit;W(2),tt(t.close_date),W(2),tt(Ql(5,18,t.gmv,"COP","symbol")),W(3),tt(t.orders),W(2),tt(t.lines),W(2),tt(Ql(12,22,t.cogs,"COP","symbol")),W(3),tt(Ql(15,26,t.purchase,"COP","symbol")),W(3),tt(Ql(18,30,t.inventory,"COP","symbol")),W(3),tt(Ql(21,34,t.leakage,"COP","symbol")),W(3),tt(Ql(24,38,t.cost_log,"COP","symbol")),W(3),tt(Ql(27,42,t.aov,"COP","symbol")),W(3),tt(Ql(30,46,t.alv,"COP","symbol")),W(3),tt(t.margin),W(2),tt(Ql(35,50,t.cash_margin,"COP","symbol")),W(3),tt(Ql(38,54,t.cash,"COP","symbol")),W(3),tt(Ql(41,58,t.davivienda,"COP","symbol")),W(3),tt(Ql(44,62,t.bancolombia,"COP","symbol")),W(3),tt(Ql(47,66,t.cartera_today,"COP","symbol")),W(3),tt(Ql(50,70,t.cartera_total,"COP","symbol"))}}function yDe(e,n){1&e&&(P(0,"div",26),U(1,"Validando cierre..."),O())}function vDe(e,n){if(1&e&&(P(0,"tr")(1,"td")(2,"span",37),U(3),O()(),P(4,"td"),U(5),O()()),2&e){const t=n.$implicit;W(2),Oe("ngClass",vv(3,gDe,"grave"===t.tipo,"medio"===t.tipo,"bajo"===t.tipo)),W(),tt(t.tipo),W(2),tt(t.mensaje||t)}}function xDe(e,n){if(1&e&&(P(0,"div",29)(1,"h2",30)(2,"button",31),U(3),zn(4,"titlecase"),O()(),P(5,"div",32)(6,"div",33)(7,"table",34)(8,"thead",35)(9,"tr")(10,"th",36),U(11,"Nivel"),O(),P(12,"th"),U(13,"Mensaje"),O()()(),P(14,"tbody"),gt(15,vDe,6,7,"tr",7),O()()()()()),2&e){const t=n.$implicit,r=n.index;W(),_v("id","heading-",r,""),W(),rs("data-bs-target","#collapse-"+r)("aria-controls","collapse-"+r),W(),Zw(" ",vc(4,9,t.key)," (",t.value.length," errores) "),W(2),Oe("id","collapse-"+r),rs("aria-labelledby","heading-"+r),W(10),Oe("ngForOf",t.value)}}function bDe(e,n){if(1&e&&(P(0,"div")(1,"div",27),gt(2,xDe,16,11,"div",28),zn(3,"keyvalue"),O()()),2&e){const t=Ge();W(2),Oe("ngForOf",vc(3,1,t.getErroresAgrupados()))}}let wDe=(()=>{class e{constructor(t,r){this.cierresService=t,this.router=r,this.newDate="",this.minDate="",this.cierres=[],this.validando=!1,this.validacion=null,this.validacionExitosa=!1}ngOnInit(){const t=new Date,r=t.getFullYear()-1,i=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");this.minDate=`${r}-${i}-${l}`,this.getCierres()}validarFecha(){this.newDate&&(this.validando=!0,this.validacion=null,this.validacionExitosa=!1,this.cierresService.validateCierre(this.newDate).subscribe({next:t=>{this.validacion=t;const r=t.errores?.some(i=>"grave"===i.tipo);this.validacionExitosa=!r},error:t=>{this.validacion={errores:[{tipo:"grave",mensaje:"Error en la validaci\xf3n"}]},this.validacionExitosa=!1},complete:()=>this.validando=!1}))}createCierre(){this.newDate&&this.cierresService.createCierre(this.newDate).subscribe(t=>{const r=document.getElementById("newCierre");if(r){bootstrap.Modal.getInstance(r)?.hide(),document.body.classList.remove("modal-open");const l=document.getElementsByClassName("modal-backdrop");for(;l.length>0;)l[0].parentNode?.removeChild(l[0])}this.newDate="",this.getCierres()})}getCierres(){this.cierresService.getCierres().subscribe(t=>{this.cierres=t},t=>{console.error("Error al obtener cierres:",t)})}toCierre(t){this.router.navigate(["/cierre",t.close_date])}getErroresAgrupados(){const t={};if(!this.validacion?.errores)return t;for(const r of this.validacion.errores){const i=r.clasificacion||"general";t[i]||(t[i]=[]),t[i].push(r)}return t}static#e=this.\u0275fac=function(r){return new(r||e)(ut(vq),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-cierres"]],decls:69,vars:6,consts:[["cierreForm","ngForm"],[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#newCierre",1,"btn","btn-primary"],[1,"fas","fa-plus-circle","fa-lg"],[1,"table"],[4,"ngFor","ngForOf"],["id","newCierre","tabindex","-1","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-xl"],[1,"modal-content",3,"ngSubmit"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"btn-close"],[1,"modal-body"],[1,"mb-3"],["for","fecha",1,"form-label"],["type","date","id","fecha","name","fecha","required","",1,"form-control",3,"ngModelChange","change","ngModel","min"],["class","alert alert-info",4,"ngIf"],[4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"row","g-1"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-edit","fa-lg","text-primary"],[1,"alert","alert-info"],["id","erroresAccordion",1,"accordion"],["class","accordion-item",4,"ngFor","ngForOf"],[1,"accordion-item"],[1,"accordion-header",3,"id"],["type","button","data-bs-toggle","collapse","aria-expanded","false",1,"accordion-button","collapsed"],["data-bs-parent","#erroresAccordion",1,"accordion-collapse","collapse",3,"id"],[1,"accordion-body","p-2"],[1,"table","table-sm","table-bordered","mb-0"],[1,"table-light"],[2,"width","100px"],[3,"ngClass"]],template:function(r,i){if(1&r){const l=lr();P(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),Rt(4,"i",5),U(5," Generar cierre "),O()()(),P(6,"table",6)(7,"thead")(8,"tr")(9,"th"),U(10,"Fecha"),O(),P(11,"th"),U(12,"GMV"),O(),P(13,"th"),U(14,"Orders"),O(),P(15,"th"),U(16,"Lines"),O(),P(17,"th"),U(18,"COG"),O(),P(19,"th"),U(20,"Purchases"),O(),P(21,"th"),U(22,"Inventory"),O(),P(23,"th"),U(24,"Leakage"),O(),P(25,"th"),U(26,"Log\xedstica"),O(),P(27,"th"),U(28,"AOV"),O(),P(29,"th"),U(30,"ALV"),O(),P(31,"th"),U(32,"Margen"),O(),P(33,"th"),U(34,"Utilidad Neto"),O(),P(35,"th"),U(36,"Efectivo"),O(),P(37,"th"),U(38,"Davivienda"),O(),P(39,"th"),U(40,"Bancolombia"),O(),P(41,"th"),U(42,"Cartera hoy"),O(),P(43,"th"),U(44,"Cartera Total"),O(),P(45,"th"),U(46,"Acciones"),O()()(),P(47,"tbody"),gt(48,_De,56,74,"tr",7),O()()(),P(49,"div",8)(50,"div",9)(51,"form",10,0),ct("ngSubmit",function(){return Bt(l),zt(i.createCierre())}),P(53,"div",11)(54,"h5",12),U(55,"Nuevo cierre"),O(),Rt(56,"button",13),O(),P(57,"div",14)(58,"div",15)(59,"label",16),U(60,"Fecha"),O(),P(61,"input",17),St("ngModelChange",function(g){return Bt(l),Dt(i.newDate,g)||(i.newDate=g),zt(g)}),ct("change",function(){return Bt(l),zt(i.validarFecha())}),O()(),gt(62,yDe,2,0,"div",18)(63,bDe,4,3,"div",19),O(),P(64,"div",20)(65,"button",21),U(66," Cancelar "),O(),P(67,"button",22),U(68," Guardar "),O()()()()()}if(2&r){const l=xa(52);W(48),Oe("ngForOf",i.cierres),W(13),Ct("ngModel",i.newDate),Oe("min",i.minDate),W(),Oe("ngIf",i.validando),W(),Oe("ngIf",null==i.validacion||null==i.validacion.errores?null:i.validacion.errores.length),W(4),Oe("disabled",!l.form.valid||!i.validacionExitosa)}},dependencies:[Zp,No,So,R2,Hs,so,k2,a1,oo,Xv,xz,ld,bz]})}return e})();function TDe(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),zn(7,"currency"),O(),P(8,"td"),U(9),zn(10,"currency"),O(),P(11,"td"),U(12),O(),P(13,"td"),U(14),zn(15,"currency"),O(),P(16,"td"),U(17),zn(18,"currency"),O(),P(19,"td"),U(20),zn(21,"currency"),O()()),2&e){const t=n.$implicit;W(2),tt(t.sku),W(2),tt(t.name),W(2),tt(vc(7,8,t.price_purchase)),W(3),tt(vc(10,10,t.final_price_purchase)),W(3),tt(t.total_quantity_ordered),W(2),tt(vc(15,12,t.totalEstimated)),W(3),tt(vc(18,14,t.totalReal)),W(3),Zn(" ",vc(21,16,t.difference)," ")}}function EDe(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),zn(7,"currency"),O(),P(8,"td"),U(9),O()()),2&e){const t=n.$implicit;W(2),tt(t.supplier),W(2),tt(t.totalVolume),W(2),tt(vc(7,4,t.totalMoney)),W(3),tt(t.totalItems)}}function CDe(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td"),U(8),zn(9,"currency"),O()()),2&e){const t=n.$implicit;W(2),tt(t.status),W(2),tt(t.count),W(2),tt(t.totalVolume),W(2),tt(vc(9,4,t.totalMoney))}}let SDe=(()=>{class e{constructor(t,r,i){this.route=t,this.router=r,this.svc=i,this.top_20_purchase=[],this.suppliesSummary=[],this.purchasesByStatus=[]}ngOnInit(){this.fechaParam=this.route.snapshot.paramMap.get("fecha"),this.svc.getCierre(this.fechaParam).subscribe(t=>{this.datos_cierre=t,this.load_top_purchases(),this.load_top_supplies(),this.loadPurchasesByStatus()})}load_top_purchases(){const t={};this.datos_cierre.purchase.products.forEach(i=>{const l=i.sku,u=i.price_purchase*i.total_quantity_ordered,g=i.final_price_purchase*i.total_quantity_ordered;if(t[l]){const x=t[l];x.total_quantity_ordered=(x.total_quantity_ordered??0)+i.total_quantity_ordered,x.totalEstimated=(x.totalEstimated??0)+u,x.totalReal=(x.totalReal??0)+g}else t[l]={sku:i.sku,name:i.name,price_purchase:i.price_purchase,final_price_purchase:i.final_price_purchase,total_quantity_ordered:i.total_quantity_ordered,totalEstimated:u,totalReal:g}});const r=Object.values(t).map(i=>({...i,difference:i.totalEstimated-i.totalReal})).sort((i,l)=>i.difference-l.difference).slice(0,20);this.top_20_purchase=r}load_top_supplies(){const t={};this.datos_cierre.purchase.products.forEach(r=>{const i=r.proveedor?.name??"Sin proveedor";t[i]||(t[i]={supplier:i,totalVolume:0,totalMoney:0,totalItems:0});const l=t[i];l.totalVolume+=r.total_quantity_ordered,l.totalMoney+=r.price_purchase*r.total_quantity_ordered,l.totalItems+=1}),this.suppliesSummary=Object.values(t).sort((r,i)=>i.totalMoney-r.totalMoney).slice(0,20)}loadPurchasesByStatus(){const t={};this.datos_cierre.purchase.products.forEach(r=>{const i=r.status??"Sin estado",l=r.total_quantity_ordered,u=r.price_purchase*l;t[i]||(t[i]={status:i,count:0,totalVolume:0,totalMoney:0}),t[i].count+=1,t[i].totalVolume+=l,t[i].totalMoney+=u}),this.purchasesByStatus=Object.values(t).sort((r,i)=>i.count-r.count)}getFacturadoRegistradoPercent(){const t=this.datos_cierre.purchase.products,r=new Set(["Facturada","Registrado"]);let i=0,l=0,u=0,g=0;t.forEach(D=>{const R=D.total_quantity_ordered,L=D.price_purchase*R;i+=R,l+=L,r.has(D.status)&&(u+=R,g+=L)});const E=l?g/l*100:0;this.percentByVolume=i?u/i*100:0,this.percentByMoney=E}static#e=this.\u0275fac=function(r){return new(r||e)(ut(Su),ut(ws),ut(vq))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-cierre"]],decls:98,vars:24,consts:[[1,"container","py-5"],["id","accCierre",1,"accordion"],[1,"card"],[1,"card-header"],[1,"list-group","list-group-flush"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],[1,"table-responsive"],[1,"table","table-striped","table-hover"],[1,"table-dark"],[4,"ngFor","ngForOf"],[1,"table-light"],[1,"table","table-bordered","table-hover"],[1,"mt-3","text-end"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"h3"),U(2),O(),P(3,"div",1)(4,"div",2)(5,"div",3)(6,"h5"),U(7,"Indicadores de Cierre"),O()(),P(8,"ul",4)(9,"li",5)(10,"span"),U(11,"% Volumen Facturado+Registrado"),O(),P(12,"span"),U(13),zn(14,"number"),O()(),P(15,"li",5)(16,"span"),U(17,"% Dinero Facturado+Registrado"),O(),P(18,"span"),U(19),zn(20,"number"),O()(),P(21,"li",5)(22,"span"),U(23,"Volumen Total Compras"),O(),P(24,"span"),U(25),zn(26,"number"),O()(),P(27,"li",5)(28,"span"),U(29,"Dinero Total Compras"),O(),P(30,"span"),U(31),zn(32,"currency"),O()(),P(33,"li",5)(34,"span"),U(35,"M\xe1rgen de Efectivo"),O(),P(36,"span"),U(37),zn(38,"currency"),O()(),P(39,"li",5)(40,"span"),U(41,"Cierre Total"),O(),P(42,"span"),U(43),zn(44,"currency"),O()()()(),P(45,"div",6)(46,"table",7)(47,"thead",8)(48,"tr")(49,"th"),U(50,"SKU"),O(),P(51,"th"),U(52,"Nombre"),O(),P(53,"th"),U(54,"Precio Compra"),O(),P(55,"th"),U(56,"Precio Final"),O(),P(57,"th"),U(58,"Cant. Pedida"),O(),P(59,"th"),U(60,"Total Estimado"),O(),P(61,"th"),U(62,"Total Real"),O(),P(63,"th"),U(64,"Diferencia"),O()()(),P(65,"tbody"),gt(66,TDe,22,18,"tr",9),O()()(),P(67,"div",6)(68,"table",7)(69,"thead",10)(70,"tr")(71,"th"),U(72,"Proveedor"),O(),P(73,"th"),U(74,"Volumen Total"),O(),P(75,"th"),U(76,"Dinero Total"),O(),P(77,"th"),U(78,"L\xedneas de Pedido"),O()()(),P(79,"tbody"),gt(80,EDe,10,6,"tr",9),O()()(),P(81,"div",6)(82,"table",11)(83,"thead",10)(84,"tr")(85,"th"),U(86,"Estado"),O(),P(87,"th"),U(88,"Cantidad de Productos"),O(),P(89,"th"),U(90,"Volumen Total"),O(),P(91,"th"),U(92,"Dinero Total"),O()()(),P(93,"tbody"),gt(94,CDe,10,6,"tr",9),O()()()(),P(95,"div",12)(96,"button",13),ct("click",function(){return i.router.navigate(["/cierres"])}),U(97,"Regresar"),O()()()),2&r&&(W(2),Zn(" Cierre del ",i.fechaParam,""),W(11),Zn("",fs(14,10,i.percentByVolume,"1.2-2"),"\u2009%"),W(6),Zn("",fs(20,13,i.percentByMoney,"1.2-2"),"\u2009%"),W(6),tt(vc(26,16,i.totalVolume)),W(6),tt(vc(32,18,i.totalMoney)),W(6),tt(vc(38,20,i.cash_margin)),W(6),tt(vc(44,22,i.cierre_total)),W(23),Oe("ngForOf",i.top_20_purchase),W(14),Oe("ngForOf",i.suppliesSummary),W(14),Oe("ngForOf",i.purchasesByStatus))},dependencies:[No,YI,ld],encapsulation:2})}return e})(),DDe=(()=>{class e{constructor(t){this.httpClient=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getProducts(){return this.httpClient.get(this.baseUrl+"api/products_history/products_history_analytics")}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const xq=(e,n,t)=>({"bg-danger":e,"bg-success":n,"bg-warning":t});function MDe(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),zn(5,"currency"),O(),P(6,"td"),U(7),zn(8,"currency"),O(),P(9,"td"),U(10),zn(11,"currency"),O(),P(12,"td")(13,"span",7),U(14),zn(15,"number"),O()(),P(16,"td")(17,"span",7),U(18),zn(19,"number"),O()()()),2&e){const t=n.$implicit;W(2),tt(t.name),W(2),tt(Jo(5,8,t.price_sale_today,"USD","symbol","1.0-0")),W(3),tt(Jo(8,13,t.price_sale_yesterday,"USD","symbol","1.0-0")),W(3),tt(Jo(11,18,t.price_sale_last_tuesday,"USD","symbol","1.0-0")),W(3),Oe("ngClass",vv(29,xq,t.variation_yesterday_today>0,t.variation_yesterday_today<0,0===t.variation_yesterday_today)),W(),Zn(" ",fs(15,23,t.variation_yesterday_today,"1.1-1"),"% "),W(3),Oe("ngClass",vv(33,xq,t.variation_last_week_today>0,t.variation_last_week_today<0,0===t.variation_last_week_today)),W(),Zn(" ",fs(19,26,t.variation_last_week_today,"1.1-1"),"% ")}}let ADe=(()=>{class e{constructor(t,r){this.productService=t,this.router=r,this.products=[],this.filteredProducts=[],this.searchText="",this.sortColumn="",this.sortDirection=1}ngOnInit(){this.getProducts()}getProducts(){this.productService.getProducts().subscribe(t=>{this.products=t,this.filteredProducts=t,this.filterProducts()})}filterProducts(){if(""!==this.searchText.trim()){const t=this.searchText.toLowerCase();this.filteredProducts=this.products.filter(r=>r.name.toLowerCase().includes(t)||r.unit?.toLowerCase().includes(t)||r.category?.toLowerCase().includes(t)||r.sku?.toLowerCase().includes(t)||r.child?.toString().includes(t))}else this.filteredProducts=this.products}sortBy(t){this.sortColumn===t?this.sortDirection=-this.sortDirection:(this.sortColumn=t,this.sortDirection=1),this.filteredProducts.sort((r,i)=>r[t]<i[t]?-1*this.sortDirection:r[t]>i[t]?1*this.sortDirection:0)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(DDe),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-products-analytics"]],decls:21,vars:2,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"table"],[3,"click"],[4,"ngFor","ngForOf"],[1,"badge","rounded-pill",3,"ngClass"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterProducts()}),O()()(),P(4,"table",4)(5,"thead")(6,"tr")(7,"th",5),ct("click",function(){return i.sortBy("name")}),U(8,"Nombre"),O(),P(9,"th",5),ct("click",function(){return i.sortBy("price_sale_today")}),U(10,"Hoy"),O(),P(11,"th",5),ct("click",function(){return i.sortBy("price_sale_yesterday")}),U(12,"Ayer"),O(),P(13,"th",5),ct("click",function(){return i.sortBy("price_sale_last_tuesday")}),U(14,"Semana Pasada"),O(),P(15,"th",5),ct("click",function(){return i.sortBy("variation_yesterday_today")}),U(16,"% Ayer"),O(),P(17,"th",5),ct("click",function(){return i.sortBy("variation_last_week_today")}),U(18,"% Semana Pasada"),O()()(),P(19,"tbody"),gt(20,MDe,20,37,"tr",6),O()()()),2&r&&(W(3),Ct("ngModel",i.searchText),W(17),Oe("ngForOf",i.filteredProducts))},dependencies:[Zp,No,Hs,so,oo,YI,ld]})}return e})();function IDe(e,n){if(1&e){const t=lr();P(0,"div",44)(1,"span",48),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().get_invoice(i.order_number))}),Rt(2,"i",49),O()()}}function kDe(e,n){if(1&e){const t=lr();P(0,"tr",43),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().navigateToStop(i))}),P(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td"),U(8),O(),P(9,"td"),U(10),O(),P(11,"td"),U(12),O(),P(13,"td"),U(14),zn(15,"currency"),O(),P(16,"td"),U(17),zn(18,"currency"),O(),P(19,"td"),U(20),O(),P(21,"td"),U(22),O(),P(23,"td"),U(24),O(),P(25,"td"),U(26),O(),P(27,"td")(28,"div",1)(29,"div",44)(30,"span",45),ct("click",function(){const i=Bt(t).$implicit;return zt(Ge().openPdfModal(i.id))}),Rt(31,"i",46),O()(),gt(32,IDe,3,0,"div",47),O()(),Rt(33,"td"),O()}if(2&e){const t=n.$implicit,r=Ge();W(2),tt(t.delivery_date),W(2),tt(t.order_number),W(2),tt(t.customer_name),W(2),tt(t.customer_email),W(2),tt(t.customer_phone),W(2),tt(t.deliveryAddress),W(2),tt(Jo(15,13,t.total,"USD","symbol","1.2-2")),W(3),tt(Jo(18,18,t.total-t.totalPayment,"USD","symbol","1.2-2")),W(3),tt(t.status),W(2),tt(t.paymentMethod),W(2),tt(r.daysMora(t)),W(2),tt(t.driver_name),W(6),Oe("ngIf","000"!=t.alegra_id)}}function ODe(e,n){if(1&e&&(P(0,"option",50),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t),W(),Zn("",t," ")}}function PDe(e,n){if(1&e&&(P(0,"option",50),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t),W(),Zn("",t," ")}}let RDe=(()=>{class e{constructor(t,r,i,l){this.orderService=t,this.alegraService=r,this.sanitizer=i,this.routeService=l,this.orders=[],this.total_cartera=0,this.total_orders=0,this.searchText="",this.ordersFiltered=[],this.evidence=null,this.titleEvidence="",this.facturaData=null,this.pdfData=null,this.typeEvidence="",this.stopSelect={order:0,order_number:0,client_name:"",address:"",slot:"",total_to_charge:0,total_charged:0,payment_date:null,status:"",evidence:"",open_hour:"",payment_method:""},this.methedoPayments=["Davivienda","Bancolombia","Efectivo"],this.statusStops=["Por entregar","Pendiente de pago","Pagada"],this.selectedFile=null,this.routeNumber=0}ngOnInit(){this.getOrders()}getOrders(){this.orderService.getOrdersByStatus("Pendiente de pago").subscribe(t=>{this.orders=t,this.ordersFiltered=t,this.total_cartera=this.ordersFiltered.reduce((r,i)=>r+(i.total-i.totalPayment?Number(i.total-i.totalPayment):0),0),this.total_cartera=parseFloat(this.total_cartera.toFixed(2)),this.total_orders=this.orders.length})}filterorders(){const t=this.searchText.trim().toLowerCase();this.ordersFiltered=""!==t?this.orders.filter(r=>[r.cliente,r.delivery_date,r.customer_name,r.order_number,r.customer_email,r.customer_phone,r.deliveryAddress,r.status,r.paymentMethod,r.driver_name].some(l=>(l??"").toString().toLowerCase().includes(t))):this.orders,this.total_cartera=this.ordersFiltered.reduce((r,i)=>r+(Number(i.total??0)-Number(i.totalPayment??0)),0),this.total_cartera=parseFloat(this.total_cartera.toFixed(2)),this.total_orders=this.ordersFiltered.length}daysMora(t){if(!t.delivery_date)return 0;const r=new Date(t.delivery_date),l=(new Date).getTime()-r.getTime();return Math.floor(l/864e5)}get_invoice(t){this.alegraService.get_invoice(t).subscribe(r=>{this.facturaData=this.sanitizer.bypassSecurityTrustResourceUrl(r)})}openPdfModal(t){this.pdfData=this.sanitizer.bypassSecurityTrustResourceUrl("https://app.buyfrescapp.com:5000/api/order/generate_pdf/"+t)}onStatusChange(t){"Pagada"===t?this.stopSelect.total_charged=this.stopSelect.total_to_charge:(this.stopSelect.total_charged=0,this.stopSelect.payment_date=null)}onFileSelected(t){const r=t.target.files[0];if(r){const i=r.name.split(".").pop(),l=`${this.routeNumber}_${this.stopSelect.order_number}.${i}`,u=new File([r],l,{type:r.type});this.selectedFile=u,this.stopSelect.evidence=l}}saveStop(){const r=this.routeSelect.stops.findIndex(i=>i.order_number===this.stopSelect.order_number);if(-1!==r){this.routeSelect.stops[r]={...this.routeSelect.stops[r],...this.stopSelect};const i=new FormData;i.append("route",JSON.stringify(this.routeSelect)),this.selectedFile&&i.append("file",this.selectedFile,this.selectedFile.name),this.routeService.updateStop(this.routeSelect,this.selectedFile).subscribe(l=>{this.getOrders(),this.filterorders()},l=>{console.error("Error al guardar la parada",l)})}else console.error("Parada no encontrada")}navigateToStop(t){this.routeService.getRouteByDate(t.delivery_date).subscribe(r=>{this.routeSelect=JSON.parse(r)}),this.routeService.getStopNumber(t.order_number).subscribe(r=>{this.routeService.getStopNumber(t.order_number).subscribe(i=>{this.stopSelect=i})})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(N2),ut(V4),ut(tk),ut(SO))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-cartera"]],decls:132,vars:31,consts:[[1,"container-fluid","mt-5"],[1,"row"],[1,"col-3"],[1,"h3",2,"background-color","yellow"],[1,"col-6"],["type","text","placeholder","Buscar Ordenes...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"table"],["data-bs-toggle","modal","data-bs-target","#editStop","data-bs-dismiss","modal",3,"click",4,"ngFor","ngForOf"],["id","pdfModal","tabindex","-1","role","dialog","aria-labelledby","pdfModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","pdfModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["type","application/pdf","width","100%","height","600px",3,"src"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["id","facturaModal","tabindex","-1","role","dialog","aria-labelledby","facturaLabel","aria-hidden","true",1,"modal","fade"],["id","editStop","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-title"],[1,"container"],[1,"form-group"],["for","client_name"],["type","client_name","id","client_name","name","client_name","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","address"],["type","address","id","address","name","address","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["type","slot","id","slot","name","slot","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["type","open_hour","id","open_hour","name","open_hour","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","cost"],["type","text","id","cost","name","cost","disabled","",1,"form-control",3,"value"],[1,"form-control",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["for","total_charged"],["type","number","id","total_charged","name","total_charged",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","payment_date"],["type","date","id","payment_date","name","payment_date",1,"form-control",3,"ngModelChange","ngModel"],["for","evidence"],["type","file","id","evidence","name","evidence",1,"form-control",3,"change"],["target","_blank",3,"href"],["data-bs-dismiss","modal",1,"btn","btn-primary","w-100",3,"click","disabled"],["data-bs-dismiss","modal",1,"btn","btn-secondary","w-100"],["data-bs-toggle","modal","data-bs-target","#editStop","data-bs-dismiss","modal",3,"click"],[1,"col-auto"],["data-bs-toggle","modal","data-bs-target","#pdfModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-danger"],["class","col-auto",4,"ngIf"],["data-bs-toggle","modal","data-bs-target","#facturaModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-primary"],[3,"ngValue"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),U(4),zn(5,"currency"),O()(),P(6,"div",4)(7,"input",5),St("ngModelChange",function(u){return Dt(i.searchText,u)||(i.searchText=u),u}),ct("keyup",function(){return i.filterorders()}),O()()(),P(8,"table",6)(9,"thead")(10,"tr")(11,"th"),U(12,"Fecha de Entrega"),O(),P(13,"th"),U(14,"N\xfamero de Orden"),O(),P(15,"th"),U(16,"Cliente"),O(),P(17,"th"),U(18,"Email"),O(),P(19,"th"),U(20,"Tel\xe9fono"),O(),P(21,"th"),U(22,"Direcci\xf3n"),O(),P(23,"th"),U(24,"Total Orden"),O(),P(25,"th"),U(26,"Valor Pendiente"),O(),P(27,"th"),U(28,"Estado"),O(),P(29,"th"),U(30,"Medio de Pago"),O(),P(31,"th"),U(32,"D\xedas Mora"),O(),P(33,"th"),U(34,"Conductor"),O(),P(35,"th"),U(36," Acciones"),O()()(),P(37,"tbody"),gt(38,kDe,34,23,"tr",7),O()()(),P(39,"div",8)(40,"div",9)(41,"div",10)(42,"div",11)(43,"h5",12),U(44,"Remisi\xf3n"),O(),Rt(45,"button",13),O(),P(46,"div",14),Rt(47,"iframe",15),O(),P(48,"div",16)(49,"button",17),U(50,"Cerrar"),O()()()()(),P(51,"div",18)(52,"div",9)(53,"div",10)(54,"div",11)(55,"h5",12),U(56,"Factura"),O(),Rt(57,"button",13),O(),P(58,"div",14),Rt(59,"iframe",15),O(),P(60,"div",16)(61,"button",17),U(62,"Cerrar"),O()()()()(),P(63,"div",19)(64,"div",20)(65,"div",10)(66,"div",11)(67,"h5",21),U(68),O()(),P(69,"div",14)(70,"div",22)(71,"div",23)(72,"label",24),U(73,"Cliente:"),O(),P(74,"input",25),St("ngModelChange",function(u){return Dt(i.stopSelect.client_name,u)||(i.stopSelect.client_name=u),u}),O()(),Rt(75,"br"),P(76,"div",23)(77,"label",26),U(78,"Direcci\xf3n:"),O(),P(79,"input",27),St("ngModelChange",function(u){return Dt(i.stopSelect.address,u)||(i.stopSelect.address=u),u}),O()(),Rt(80,"br"),P(81,"div",1)(82,"div",4)(83,"div",23)(84,"input",28),St("ngModelChange",function(u){return Dt(i.stopSelect.slot,u)||(i.stopSelect.slot=u),u}),O()()(),P(85,"div",4)(86,"div",23)(87,"input",29),St("ngModelChange",function(u){return Dt(i.stopSelect.open_hour,u)||(i.stopSelect.open_hour=u),u}),O()()()(),Rt(88,"br"),P(89,"div",23)(90,"label",30),U(91,"Total a pagar:"),O(),Rt(92,"input",31),zn(93,"currency"),O(),Rt(94,"br"),P(95,"div")(96,"label"),U(97,"Estado:"),O(),P(98,"select",32),St("ngModelChange",function(u){return Dt(i.stopSelect.status,u)||(i.stopSelect.status=u),u}),ct("ngModelChange",function(u){return i.onStatusChange(u)}),gt(99,ODe,2,2,"option",33),O()(),Rt(100,"br"),P(101,"div",23)(102,"label",34),U(103,"Total recibido:"),O(),P(104,"input",35),St("ngModelChange",function(u){return Dt(i.stopSelect.total_charged,u)||(i.stopSelect.total_charged=u),u}),O()(),Rt(105,"br"),P(106,"div")(107,"label"),U(108,"Metodo de pago:"),O(),P(109,"select",32),St("ngModelChange",function(u){return Dt(i.stopSelect.payment_method,u)||(i.stopSelect.payment_method=u),u}),gt(110,PDe,2,2,"option",33),O()(),Rt(111,"br"),P(112,"div",23)(113,"label",36),U(114,"Fecha Pago:"),O(),P(115,"input",37),St("ngModelChange",function(u){return Dt(i.stopSelect.payment_date,u)||(i.stopSelect.payment_date=u),u}),O()(),Rt(116,"br"),P(117,"div",23)(118,"label",38),U(119,"Evidencia (archivo o foto):"),O(),P(120,"input",39),ct("change",function(u){return i.onFileSelected(u)}),O()(),Rt(121,"br"),P(122,"a",40),U(123,"Descargar evidencia"),O(),Rt(124,"br")(125,"br"),P(126,"button",41),ct("click",function(){return i.saveStop()}),U(127,"Guardar Parada"),O(),Rt(128,"br")(129,"br"),P(130,"button",42),U(131,"Cancelar"),O()()()()()()),2&r&&(W(4),Zw("Total Cartera: ",Jo(5,22,i.total_cartera,"USD","symbol","1.2-2")," en ",i.total_orders," ordenes "),W(3),Ct("ngModel",i.searchText),W(31),Oe("ngForOf",i.ordersFiltered),W(9),Oe("src",i.pdfData,Sf),W(12),Oe("src",i.facturaData,Sf),W(9),Zn("Parada No. ",i.stopSelect.order,""),W(6),Ct("ngModel",i.stopSelect.client_name),W(5),Ct("ngModel",i.stopSelect.address),W(5),Ct("ngModel",i.stopSelect.slot),W(3),Ct("ngModel",i.stopSelect.open_hour),W(5),Oe("value",Ql(93,27,i.stopSelect.total_to_charge,"USD","symbol")),W(6),Ct("ngModel",i.stopSelect.status),W(),Oe("ngForOf",i.statusStops),W(5),Ct("ngModel",i.stopSelect.total_charged),Oe("disabled","Pagada"==i.stopSelect.status),W(5),Ct("ngModel",i.stopSelect.payment_method),W(),Oe("ngForOf",i.methedoPayments),W(5),Ct("ngModel",i.stopSelect.payment_date),W(7),_v("href","https://app.buyfrescapp.com:5000/api/route/route/evidence/",i.stopSelect.evidence,"",_g),W(4),Oe("disabled","Pagada"==i.stopSelect.status&&null==i.stopSelect.payment_date))},dependencies:[No,So,yd,vd,Hs,Nh,eu,so,oo,ld]})}return e})(),bq=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/api/strikes"}getAll(t){let r=new Xp;return null!=t&&(r=r.set("limit",t.toString())),this.http.get(this.baseUrl,{params:r})}getByOrder(t){const r=(new Xp).set("order_number",t.toString());return this.http.get(this.baseUrl,{params:r})}get(t){return this.http.get(`${this.baseUrl}/${t}`)}create(t){return this.http.post(this.baseUrl,{order_number:t.order_number,sku:t.sku,strike_type:t.strike_type,missing_quantity:t.missing_quantity,detail:t.detail})}update(t,r){const i={};return null!=r.order_number&&(i.order_number=r.order_number),null!=r.sku&&(i.sku=r.sku),null!=r.strike_type&&(i.strike_type=r.strike_type),null!=r.missing_quantity&&(i.missing_quantity=r.missing_quantity),null!=r.detail&&(i.detail=r.detail),this.http.put(`${this.baseUrl}/${t}`,i)}delete(t){return this.http.delete(`${this.baseUrl}/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function NDe(e,n){if(1&e){const t=lr();P(0,"button",8),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().goToEdit(i.id))}),U(1," Editar "),O()}}function FDe(e,n){if(1&e){const t=lr();P(0,"button",9),ct("click",function(){Bt(t);const i=Ge().$implicit;return zt(Ge().delete(i.id))}),U(1," Eliminar "),O()}}function LDe(e,n){if(1&e&&(P(0,"tr")(1,"td"),U(2),O(),P(3,"td"),U(4),O(),P(5,"td"),U(6),O(),P(7,"td"),U(8),O(),P(9,"td"),U(10),O(),P(11,"td"),U(12),O(),P(13,"td"),U(14),zn(15,"date"),O(),P(16,"td"),gt(17,NDe,2,0,"button",6),zn(18,"date"),zn(19,"date"),gt(20,FDe,2,0,"button",7),zn(21,"date"),zn(22,"date"),O()()),2&e){const t=n.$implicit,r=Ge();W(2),tt(t.order_number),W(2),tt(t.sku||"-"),W(2),tt(t.name||"-"),W(2),tt(r.typeLabels[t.strike_type]||t.strike_type),W(2),tt(t.missing_quantity),W(2),tt(t.detail),W(2),tt(fs(15,9,t.timestamp,"short")),W(3),Oe("ngIf",fs(18,12,t.timestamp,"yyyy-MM-dd")===fs(19,15,r.today,"yyyy-MM-dd")),W(3),Oe("ngIf",fs(21,18,t.timestamp,"yyyy-MM-dd")===fs(22,21,r.today,"yyyy-MM-dd"))}}let BDe=(()=>{class e{constructor(t,r){this.strikeService=t,this.router=r,this.allStrikes=[],this.filteredStrikes=[],this.today=new Date,this.searchTerm="",this.typeLabels={quality:"Calidad",partial_missing:"Faltante parcial",total_missing:"Faltante total",late_arrival:"Llegada tarde",cancel_order:"Cancelaci\xf3n"}}ngOnInit(){this.loadStrikes()}loadStrikes(){this.strikeService.getAll().subscribe(t=>{this.allStrikes=t,this.applyFilter()})}applyFilter(){const t=this.searchTerm.trim().toLowerCase();this.filteredStrikes=t?this.allStrikes.filter(r=>Object.values(r).some(i=>null!=i&&i.toString().toLowerCase().includes(t))):[...this.allStrikes]}onSearchChange(){this.applyFilter()}delete(t){confirm("\xbfEliminar este strike?")&&this.strikeService.delete(t).subscribe(()=>this.loadStrikes())}goToCreate(){this.router.navigate(["/strike","new"])}goToEdit(t){this.router.navigate(["/strike",t])}static#e=this.\u0275fac=function(r){return new(r||e)(ut(bq),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-strikes"]],decls:26,vars:2,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],["type","text","placeholder","Buscar en cualquier columna...",1,"form-control","w-50",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary me-2",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-secondary","me-2",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"input",2),St("ngModelChange",function(u){return Dt(i.searchTerm,u)||(i.searchTerm=u),u}),ct("ngModelChange",function(){return i.onSearchChange()}),O(),P(3,"button",3),ct("click",function(){return i.goToCreate()}),U(4," Nuevo Strike "),O()(),P(5,"table",4)(6,"thead")(7,"tr")(8,"th"),U(9,"Order #"),O(),P(10,"th"),U(11,"SKU"),O(),P(12,"th"),U(13,"Producto"),O(),P(14,"th"),U(15,"Tipo"),O(),P(16,"th"),U(17,"Cantidad"),O(),P(18,"th"),U(19,"Detalle"),O(),P(20,"th"),U(21,"Fecha"),O(),P(22,"th"),U(23,"Acciones"),O()()(),P(24,"tbody"),gt(25,LDe,23,24,"tr",5),O()()()),2&r&&(W(2),Ct("ngModel",i.searchTerm),W(23),Oe("ngForOf",i.filteredStrikes))},dependencies:[No,So,Hs,so,oo,Jw]})}return e})();const jDe=()=>["quality","partial_missing","total_missing"];function $De(e,n){if(1&e&&(P(0,"option",5),U(1),O()),2&e){const t=n.$implicit;Oe("ngValue",t.order_number),W(),Zw(" #",t.order_number," \u2013 ",t.customer_name," ")}}function HDe(e,n){if(1&e&&(P(0,"option",15),U(1),O()),2&e){const t=n.$implicit;Oe("value",t.value),W(),tt(t.label)}}function GDe(e,n){if(1&e&&(P(0,"option",15),U(1),O()),2&e){const t=n.$implicit;Oe("value",t.sku),W(),p3(" ",t.sku," \u2013 ",t.name," (",t.quantity," und) ")}}function WDe(e,n){if(1&e&&(P(0,"div",2)(1,"label",19),U(2,"Cantidad faltante"),O(),Rt(3,"input",20),O()),2&e){const t=Ge(2);W(3),Oe("min",1)("max",t.maxQuantity())}}function qDe(e,n){if(1&e){const t=lr();FC(0),P(1,"div",2)(2,"label",16),U(3,"Producto"),O(),P(4,"select",17),ct("change",function(){return Bt(t),zt(Ge().onSkuChange())}),P(5,"option",5),U(6,"Seleccione producto..."),O(),gt(7,GDe,2,4,"option",9),O()(),gt(8,WDe,4,2,"div",18),LC()}if(2&e){const t=Ge();W(5),Oe("ngValue",null),W(2),Oe("ngForOf",t.items),W(),Oe("ngIf","partial_missing"===t.form.get("strike_type").value||"quality"===t.form.get("strike_type").value)}}let ZDe=(()=>{class e{constructor(t,r,i,l,u){this.fb=t,this.strikeService=r,this.orderService=i,this.router=l,this.route=u,this.orders=[],this.items=[],this.strikeTypes=[{value:"quality",label:"Calidad"},{value:"partial_missing",label:"Faltante parcial"},{value:"total_missing",label:"Faltante total"},{value:"late_arrival",label:"Llegada tarde"},{value:"cancel_order",label:"Cancelaci\xf3n"}]}ngOnInit(){this.form=this.fb.group({order_number:[null,I2.required],strike_type:[null,I2.required],sku:[null],name:[null],missing_quantity:[0],detail:[""]});const t=function VDe(){return function UDe(e){const n=function zDe(e){const n=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===n?new e.constructor(+e):"number"==typeof e||"[object Number]"===n||"string"==typeof e||"[object String]"===n?new Date(e):new Date(NaN)}(e);return n.setHours(0,0,0,0),n}(Date.now())}().toISOString().slice(0,10);this.orderService.getOrders(t,t).subscribe(r=>{this.orders=r,this.strikeId="new"==this.route.snapshot.paramMap.get("id")?"":this.route.snapshot.paramMap.get("id")||void 0,this.strikeId&&this.strikeService.get(this.strikeId).subscribe(i=>{this.form.patchValue({order_number:i.order_number,strike_type:i.strike_type,sku:i.sku,name:i.name,missing_quantity:i.missing_quantity,detail:i.detail});const l=this.orders.find(u=>u.order_number===i.order_number);this.items=l?l.products:[],this.form.get("sku").setValue(i.sku),this.form.get("missing_quantity").setValue(i.missing_quantity),this.onTypeChange(i.strike_type)})}),this.form.get("order_number").valueChanges.subscribe(()=>this.onOrderChange()),this.form.get("strike_type").valueChanges.subscribe(r=>this.onTypeChange(r))}onOrderChange(){const t=this.form.get("order_number").value,r=this.orders.find(i=>i.order_number===t);this.items=r?r.products:[],this.form.patchValue({sku:null,missingQuantity:0})}onTypeChange(t){const r=this.form.get("sku"),i=this.form.get("missing_quantity");["quality","partial_missing","total_missing"].includes(t)?(r.setValidators(I2.required),"partial_missing"===t?i.setValidators([I2.required,I2.min(1),I2.max(this.maxQuantity())]):(i.clearValidators(),i.setValue("total_missing"===t?this.maxQuantity():0))):(r.clearValidators(),i.clearValidators(),this.form.patchValue({sku:null,missingQuantity:0})),r.updateValueAndValidity(),i.updateValueAndValidity()}maxQuantity(){const t=this.form.get("sku").value,r=this.items.find(i=>i.sku===t);return r?r.quantity:0}onSkuChange(){const t=this.items.find(l=>l.sku===this.form.get("sku").value),i=this.form.value;this.form.patchValue({order_number:i.order_number,strike_type:i.strike_type,sku:i.sku,name:i.name||t.name,missing_quantity:t.quantity,detail:i.detail})}submit(){const t=this.form.value,r={order_number:t.order_number,strike_type:t.strike_type,sku:t.sku,name:t.name,missing_quantity:t.missing_quantity,detail:t.detail};"new"==this.route.snapshot.paramMap.get("id")&&(this.strikeId=""),"new"!=this.route.snapshot.paramMap.get("id")?this.strikeService.update(this.route.snapshot.paramMap.get("id")||"",r).subscribe(()=>{this.router.navigate(["/strikes"])}):this.strikeService.create(r).subscribe(()=>{this.router.navigate(["/strikes"])})}static#e=this.\u0275fac=function(r){return new(r||e)(ut(s0e),ut(bq),ut(N2),ut(ws),ut(Su))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-strike"]],decls:27,vars:7,consts:[[1,"container","mt-4"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","order_number",1,"form-label"],["formControlName","order_number","id","order_number",1,"form-select"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["for","strike_type",1,"form-label"],["formControlName","strike_type","id","strike_type",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["for","detail",1,"form-label"],["id","detail","formControlName","detail","rows","3",1,"form-control"],["type","submit",1,"btn","btn-primary"],["type","button","routerLink","/strikes",1,"btn","btn-secondary","ms-2"],[3,"value"],["for","sku",1,"form-label"],["formControlName","sku","id","sku",1,"form-select",3,"change"],["class","mb-3",4,"ngIf"],["for","missing_quantity",1,"form-label"],["type","number","id","missing_quantity","formControlName","missing_quantity",1,"form-control",3,"min","max"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"h2"),U(2,"Nuevo Strike"),O(),P(3,"form",1),ct("ngSubmit",function(){return i.submit()}),P(4,"div",2)(5,"label",3),U(6,"Orden"),O(),P(7,"select",4)(8,"option",5),U(9,"Seleccione orden..."),O(),gt(10,$De,2,3,"option",6),O()(),P(11,"div",2)(12,"label",7),U(13,"Tipo de Strike"),O(),P(14,"select",8)(15,"option",5),U(16,"Seleccione tipo..."),O(),gt(17,HDe,2,2,"option",9),O()(),gt(18,qDe,9,3,"ng-container",10),P(19,"div",2)(20,"label",11),U(21,"Detalle"),O(),Rt(22,"textarea",12),O(),P(23,"button",13),U(24,"Guardar"),O(),P(25,"button",14),U(26,"Cancelar"),O()()()),2&r&&(W(3),Oe("formGroup",i.form),W(5),Oe("ngValue",null),W(2),Oe("ngForOf",i.orders),W(5),Oe("ngValue",null),W(2),Oe("ngForOf",i.strikeTypes),W(),Oe("ngIf",Va(6,jDe).includes(i.form.get("strike_type").value)))},dependencies:[No,So,H0,R2,yd,vd,Hs,Nh,eu,so,k2,CO,z4,EO,L4]})}return e})(),XDe=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getUE(t){return this.http.get(`${this.baseUrl}api/ue/ue/${t}`)}updateUE(t){return this.http.post(`${this.baseUrl}api/ue/updateUE`,{dateUpdate:t})}getUnitEconomics(){return this.http.get(`${this.baseUrl}api/analytics/ue_daily`)}static#e=this.\u0275fac=function(r){return new(r||e)($n(Al))};static#t=this.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function YDe(e,n){1&e&&(P(0,"div",2)(1,"div",3)(2,"span",4),U(3,"Cargando..."),O()()())}function KDe(e,n){if(1&e&&(P(0,"th",17),U(1),O()),2&e){const t=n.$implicit;W(),tt(t)}}function JDe(e,n){if(1&e&&(P(0,"td",17),U(1),zn(2,"number"),O()),2&e){const t=n.$implicit,r=Ge().$implicit,i=Ge(2);W(),Zn(" ",fs(2,1,i.getResumenMensual(t,r.key),"1.0-0")," ")}}function QDe(e,n){if(1&e&&(P(0,"tr")(1,"td",9),U(2),O(),gt(3,JDe,3,4,"td",10),O()),2&e){const t=n.$implicit,r=Ge(2);W(2),tt(t.label),W(),Oe("ngForOf",r.getMeses())}}function eMe(e,n){if(1&e&&(P(0,"td",17),U(1),zn(2,"number"),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",fs(2,1,r.getUtilidadMensual(t),"1.0-0")," ")}}function tMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargenMensual(t)," ")}}function nMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargenBrutoMensual(t)," ")}}function rMe(e,n){if(1&e&&(P(0,"td",17),U(1),zn(2,"number"),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",fs(2,1,r.getAOVMensual(t),"1.0-0")," ")}}function iMe(e,n){if(1&e&&(P(0,"td",17),U(1),zn(2,"number"),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",fs(2,1,r.getAOLMensual(t),"1.0-0")," ")}}function sMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargenLogisticoMensual(t)," ")}}function oMe(e,n){if(1&e&&(P(0,"th",17),U(1),O()),2&e){const t=n.$implicit;W(),tt(t)}}function aMe(e,n){if(1&e&&(P(0,"td",17),U(1),zn(2,"number"),O()),2&e){const t=n.$implicit,r=Ge().$implicit,i=Ge(2);W(),Zn(" ",fs(2,1,i.getResumenSemanal(t,r.key),"1.0-0")," ")}}function lMe(e,n){if(1&e&&(P(0,"tr")(1,"td",9),U(2),O(),gt(3,aMe,3,4,"td",10),O()),2&e){const t=n.$implicit,r=Ge(2);W(2),tt(t.label),W(),Oe("ngForOf",r.getSemanas())}}function cMe(e,n){if(1&e&&(P(0,"td",17),U(1),zn(2,"number"),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",fs(2,1,r.getUtilidadSemanal(t),"1.0-0")," ")}}function uMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargenSemanal(t)," ")}}function dMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargenBrutoSemanal(t)," ")}}function hMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getAOVSemanal(t)," ")}}function fMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getAOLSemanal(t)," ")}}function pMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargenLogisticoSemanal(t)," ")}}function mMe(e,n){if(1&e&&(P(0,"th",17),U(1),O()),2&e){const t=n.$implicit;W(),tt(t)}}function gMe(e,n){if(1&e&&(P(0,"td",17),U(1),zn(2,"number"),O()),2&e){const t=n.$implicit,r=Ge().$implicit,i=Ge(2);W(),Zn(" ",fs(2,1,i.getResumen(i.groupedData[t],r.key),"1.0-0")," ")}}function _Me(e,n){if(1&e&&(P(0,"tr")(1,"td",9),U(2),O(),gt(3,gMe,3,4,"td",10),O()),2&e){const t=n.$implicit,r=Ge(2);W(2),tt(t.label),W(),Oe("ngForOf",r.getFechasFiltradas())}}function yMe(e,n){if(1&e&&(P(0,"td",17),U(1),zn(2,"number"),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",fs(2,1,r.getUtilidad(r.groupedData[t]),"1.0-0")," ")}}function vMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargen(r.groupedData[t])," ")}}function xMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargenBruto(r.groupedData[t])," ")}}function bMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getAOV(r.groupedData[t])," ")}}function wMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getAOL(r.groupedData[t])," ")}}function TMe(e,n){if(1&e&&(P(0,"td",17),U(1),O()),2&e){const t=n.$implicit,r=Ge(2);W(),Zn(" ",r.getMargenLogistico(r.groupedData[t])," ")}}function EMe(e,n){if(1&e){const t=lr();P(0,"div",5)(1,"h4",6),U(2,"Resumen Mensual"),O(),P(3,"table",7)(4,"thead",8)(5,"tr")(6,"th",9),U(7,"Indicador"),O(),gt(8,KDe,2,1,"th",10),O()(),P(9,"tbody"),gt(10,QDe,4,2,"tr",11),P(11,"tr")(12,"td",12),U(13,"Utilidad"),O(),gt(14,eMe,3,4,"td",10),O(),P(15,"tr")(16,"td",12),U(17,"Margen"),O(),gt(18,tMe,2,1,"td",10),O(),P(19,"tr")(20,"td",9),U(21,"Margen Bruto"),O(),gt(22,nMe,2,1,"td",10),O(),P(23,"tr")(24,"td",9),U(25,"AOV"),O(),gt(26,rMe,3,4,"td",10),O(),P(27,"tr")(28,"td",9),U(29,"AOL"),O(),gt(30,iMe,3,4,"td",10),O(),P(31,"tr")(32,"td",9),U(33,"Margen Log\xedstico"),O(),gt(34,sMe,2,1,"td",10),O()()(),P(35,"h4",13),U(36,"Resumen Semanal"),O(),P(37,"table",7)(38,"thead",8)(39,"tr")(40,"th",9),U(41,"Indicador"),O(),gt(42,oMe,2,1,"th",10),O()(),P(43,"tbody"),gt(44,lMe,4,2,"tr",11),P(45,"tr")(46,"td",12),U(47,"Utilidad"),O(),gt(48,cMe,3,4,"td",10),O(),P(49,"tr")(50,"td",12),U(51,"Margen"),O(),gt(52,uMe,2,1,"td",10),O(),P(53,"tr")(54,"td",9),U(55,"Margen Bruto"),O(),gt(56,dMe,2,1,"td",10),O(),P(57,"tr")(58,"td",9),U(59,"AOV"),O(),gt(60,hMe,2,1,"td",10),O(),P(61,"tr")(62,"td",9),U(63,"AOL"),O(),gt(64,fMe,2,1,"td",10),O(),P(65,"tr")(66,"td",9),U(67,"Margen Log\xedstico"),O(),gt(68,pMe,2,1,"td",10),O()()(),P(69,"h4",13),U(70,"Resumen Diario"),O(),P(71,"div",14)(72,"div",15)(73,"label"),U(74,"Desde:"),O(),P(75,"input",16),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.fechaInicio,i)||(l.fechaInicio=i),zt(i)}),O()(),P(76,"div",15)(77,"label"),U(78,"Hasta:"),O(),P(79,"input",16),St("ngModelChange",function(i){Bt(t);const l=Ge();return Dt(l.fechaFin,i)||(l.fechaFin=i),zt(i)}),O()()(),P(80,"table",7)(81,"thead",8)(82,"tr")(83,"th",9),U(84,"Indicador"),O(),gt(85,mMe,2,1,"th",10),O()(),P(86,"tbody"),gt(87,_Me,4,2,"tr",11),P(88,"tr")(89,"td",12),U(90,"Utilidad"),O(),gt(91,yMe,3,4,"td",10),O(),P(92,"tr")(93,"td",12),U(94,"Margen"),O(),gt(95,vMe,2,1,"td",10),O(),P(96,"tr")(97,"td",9),U(98,"Margen Bruto"),O(),gt(99,xMe,2,1,"td",10),O(),P(100,"tr")(101,"td",9),U(102,"AOV"),O(),gt(103,bMe,2,1,"td",10),O(),P(104,"tr")(105,"td",9),U(106,"AOL"),O(),gt(107,wMe,2,1,"td",10),O(),P(108,"tr")(109,"td",9),U(110,"Margen Log\xedstico"),O(),gt(111,TMe,2,1,"td",10),O()()()()}if(2&e){const t=Ge();W(8),Oe("ngForOf",t.getMeses()),W(2),Oe("ngForOf",t.indicadores),W(4),Oe("ngForOf",t.getMeses()),W(4),Oe("ngForOf",t.getMeses()),W(4),Oe("ngForOf",t.getMeses()),W(4),Oe("ngForOf",t.getMeses()),W(4),Oe("ngForOf",t.getMeses()),W(4),Oe("ngForOf",t.getMeses()),W(8),Oe("ngForOf",t.getSemanas()),W(2),Oe("ngForOf",t.indicadores),W(4),Oe("ngForOf",t.getSemanas()),W(4),Oe("ngForOf",t.getSemanas()),W(4),Oe("ngForOf",t.getSemanas()),W(4),Oe("ngForOf",t.getSemanas()),W(4),Oe("ngForOf",t.getSemanas()),W(4),Oe("ngForOf",t.getSemanas()),W(7),Ct("ngModel",t.fechaInicio),W(4),Ct("ngModel",t.fechaFin),W(6),Oe("ngForOf",t.getFechasFiltradas()),W(2),Oe("ngForOf",t.indicadores),W(4),Oe("ngForOf",t.getFechasFiltradas()),W(4),Oe("ngForOf",t.getFechasFiltradas()),W(4),Oe("ngForOf",t.getFechasFiltradas()),W(4),Oe("ngForOf",t.getFechasFiltradas()),W(4),Oe("ngForOf",t.getFechasFiltradas()),W(4),Oe("ngForOf",t.getFechasFiltradas())}}const CMe=[{path:"productos",component:m0e,canActivate:[io]},{path:"clientes",component:S0e,canActivate:[io]},{path:"ordenes",component:kye,canActivate:[io]},{path:"home",component:zye,canActivate:[io]},{path:"reports",component:Uye,canActivate:[io]},{path:"delete-account",component:Wye,canActivate:[io]},{path:"purchases",component:sve,canActivate:[io]},{path:"purchase/:purchaseNumber",component:d2e,canActivate:[io]},{path:"crm",component:y2e,canActivate:[io]},{path:"edit_action/:action",component:ESe,canActivate:[io]},{path:"newAction",component:kSe,canActivate:[io]},{path:"suppliers",component:RSe,canActivate:[io]},{path:"rutas",component:ZSe,canActivate:[io]},{path:"precios",component:nDe,canActivate:[io]},{path:"costos",component:cDe,canActivate:[io]},{path:"inventories",component:hDe,canActivate:[io]},{path:"stops/:route_number",component:zSe,canActivate:[io]},{path:"inventory/:id",component:mDe,canActivate:[io]},{path:"products-analytics",component:ADe,canActivate:[io]},{path:"cierres",component:wDe,canActivate:[io]},{path:"cierre/:fecha",component:SDe,canActivate:[io]},{path:"cartera",component:RDe,canActivate:[io]},{path:"strikes",component:BDe,canActivate:[io]},{path:"strike/:id",component:ZDe,canActivate:[io]},{path:"ue",component:(()=>{class e{constructor(t){this.unitEconomicsService=t,this.groupedData={},this.loading=!0,this.fechaInicio=new Date(Date.now()-6048e5).toISOString().split("T")[0],this.fechaFin=(new Date).toISOString().split("T")[0],this.indicadores=[{key:"gmv",label:"GMV"},{key:"cogs",label:"COGS"},{key:"cost_others",label:"Otros Costos"},{key:"logistics_cost",label:"Log\xedstica"},{key:"perssonel",label:"Personal"},{key:"cost_tech",label:"Tecnolog\xeda"},{key:"total_orders",label:"\xd3rdenes"},{key:"total_lines",label:"L\xedneas"}]}ngOnInit(){this.unitEconomicsService.getUnitEconomics().subscribe(t=>{this.groupedData=this.groupByDate(t),this.loading=!1},t=>{console.error("Error fetching unit economics data:",t),this.loading=!1})}groupByDate(t){return t.reduce((r,i)=>{const l=i.fecha;return r[l]||(r[l]=[]),r[l].push(i),r},{})}getResumen(t,r){return t.filter(i=>i.variable===r).reduce((i,l)=>i+l.valor,0)}getUtilidad(t){return["gmv","cogs","cost_others","logistics_cost","perssonel","cost_tech"].map(r=>this.getResumen(t,r)).reduce((r,i)=>r+i,0)}getMargen(t){const r=this.getResumen(t,"gmv"),i=this.getUtilidad(t);return 0!==r?(i/r*100).toFixed(2)+"%":"N/A"}getMargenBruto(t){const r=this.getResumen(t,"gmv"),i=this.getResumen(t,"cogs");return 0===r?"N/A":(100*(1- -1*i/r)).toFixed(2)+"%"}getMargenLogistico(t){const r=this.getResumen(t,"gmv"),i=this.getResumen(t,"logistics_cost");return 0===r?"N/A":(i/r*100).toFixed(2)+"%"}getMargenBrutoMensual(t){const r=this.getResumenMensual(t,"gmv"),i=this.getResumenMensual(t,"cogs");return 0!==r?(100*(1- -1*i/r)).toFixed(2)+"%":"N/A"}getMargenBrutoSemanal(t){const r=this.getResumenSemanal(t,"gmv"),i=this.getResumenSemanal(t,"cogs");return 0!==r?(100*(1- -1*i/r)).toFixed(2)+"%":"N/A"}getMargenLogisticoMensual(t){const r=this.getResumenMensual(t,"gmv"),i=this.getResumenMensual(t,"logistics_cost");return 0!==r?(i/r*100).toFixed(2)+"%":"N/A"}getMargenLogisticoSemanal(t){const r=this.getResumenSemanal(t,"gmv"),i=this.getResumenSemanal(t,"logistics_cost");return 0!==r?(i/r*100).toFixed(2)+"%":"N/A"}getAOVMensual(t){const r=this.getResumenMensual(t,"gmv"),i=this.getResumenMensual(t,"total_orders");return 0!==i?(r/i).toFixed(0):"N/A"}getAOVSemanal(t){const r=this.getResumenSemanal(t,"gmv"),i=this.getResumenSemanal(t,"total_orders");return 0!==i?(r/i).toFixed(0):"N/A"}getAOLMensual(t){const r=this.getResumenMensual(t,"gmv"),i=this.getResumenMensual(t,"total_lines");return 0!==i?(r/i).toFixed(2):"N/A"}getAOLSemanal(t){const r=this.getResumenSemanal(t,"gmv"),i=this.getResumenSemanal(t,"total_lines");return 0!==i?(r/i).toFixed(2):"N/A"}getAOV(t){const r=this.getResumen(t,"gmv"),i=this.getResumen(t,"total_orders");return 0===i?"N/A":(r/i).toFixed(0)}getAOL(t){const r=this.getResumen(t,"total_lines"),i=this.getResumen(t,"gmv");return 0===r?"N/A":(i/r).toFixed(2)}getFechas(){return Object.keys(this.groupedData).sort()}getFechasFiltradas(){const t=new Date(this.fechaInicio),r=new Date(this.fechaFin);return this.getFechas().filter(i=>{const l=new Date(i);return(!this.fechaInicio||l>=t)&&(!this.fechaFin||l<=r)})}getMeses(){const t=new Set;return this.getFechas().forEach(r=>t.add(r.slice(0,7))),Array.from(t).sort()}getResumenMensual(t,r){return this.getFechas().filter(i=>i.startsWith(t)).flatMap(i=>this.groupedData[i]).filter(i=>i.variable===r).reduce((i,l)=>i+l.valor,0)}getUtilidadMensual(t){return["gmv","cogs","cost_others","logistics_cost","perssonel","cost_tech"].map(r=>this.getResumenMensual(t,r)).reduce((r,i)=>r+i,0)}getMargenMensual(t){const r=this.getResumenMensual(t,"gmv"),i=this.getUtilidadMensual(t);return 0!==r?(i/r*100).toFixed(2)+"%":"N/A"}getSemanas(){const t=new Set;return this.getFechas().forEach(r=>{const i=new Date(r),l=i.getFullYear(),u=this.getISOWeek(i);t.add(`${l}-W${u.toString().padStart(2,"0")}`)}),Array.from(t).sort()}getResumenSemanal(t,r){return this.getFechas().filter(i=>this.getSemanaISO(i)===t).flatMap(i=>this.groupedData[i]).filter(i=>i.variable===r).reduce((i,l)=>i+l.valor,0)}getUtilidadSemanal(t){return["gmv","cogs","cost_others","logistics_cost","perssonel","cost_tech"].map(r=>this.getResumenSemanal(t,r)).reduce((r,i)=>r+i,0)}getMargenSemanal(t){const r=this.getResumenSemanal(t,"gmv"),i=this.getUtilidadSemanal(t);return 0!==r?(i/r*100).toFixed(2)+"%":"N/A"}getSemanaISO(t){const r=new Date(t);return`${r.getFullYear()}-W${this.getISOWeek(r).toString().padStart(2,"0")}`}getISOWeek(t){const r=new Date(t.getTime());r.setUTCDate(r.getUTCDate()+4-(r.getUTCDay()||7));const i=new Date(Date.UTC(r.getUTCFullYear(),0,1));return Math.ceil(((r.getTime()-i.getTime())/864e5+1)/7)}static#e=this.\u0275fac=function(r){return new(r||e)(ut(XDe))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-ue"]],decls:2,vars:2,consts:[["class","text-center my-5",4,"ngIf"],["class","container",4,"ngIf"],[1,"text-center","my-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"container"],[1,"mt-4"],[1,"table","table-sm","table-bordered","align-middle"],[1,"table-light"],[1,"text-start"],["class","text-end",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"text-start","fw-bold"],[1,"mt-5"],[1,"row","mb-3"],[1,"col-md-6"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-end"]],template:function(r,i){1&r&&gt(0,YDe,4,0,"div",0)(1,EMe,112,26,"div",1),2&r&&(Oe("ngIf",i.loading),W(),Oe("ngIf",!i.loading))},dependencies:[No,So,Hs,so,oo,YI]})}return e})(),canActivate:[io]},{path:"pedidos-report",component:(()=>{class e{constructor(t){this.orderService=t,this.fechaHoy=(new Date).toISOString().substring(0,10),this.fechaSeleccionada=this.fechaHoy}descargarPDF(){window.open("https://app.buyfrescapp.com:5000/api/reports/picking/"+this.fechaSeleccionada+"/"+this.fechaSeleccionada,"_blank")}static#e=this.\u0275fac=function(r){return new(r||e)(ut(N2))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-pedidos-report"]],decls:8,vars:2,consts:[[1,"container","p-3"],[1,"mb-3"],["for","fecha",1,"form-label"],["type","date","id","fecha",1,"form-control",3,"ngModelChange","ngModel","value"],[1,"text-center","mt-4"],[1,"btn","btn-outline-danger","border-0",3,"click"],[1,"fas","fa-file-pdf","fa-5x"]],template:function(r,i){1&r&&(P(0,"div",0)(1,"div",1)(2,"label",2),U(3,"Fecha"),O(),P(4,"input",3),St("ngModelChange",function(u){return Dt(i.fechaSeleccionada,u)||(i.fechaSeleccionada=u),u}),O()(),P(5,"div",4)(6,"button",5),ct("click",function(){return i.descargarPDF()}),Rt(7,"i",6),O()()()),2&r&&(W(4),Ct("ngModel",i.fechaSeleccionada),Oe("value",i.fechaHoy))},dependencies:[Hs,so,oo]})}return e})(),canActivate:[io]},{path:"login",component:Pye},{path:"restore/:user_id",component:$ye},{path:"",redirectTo:"home",pathMatch:"full"}];let SMe=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e});static#n=this.\u0275inj=dn({imports:[WV.forRoot(CMe,{useHash:!1}),WV]})}return e})();const DMe=e=>({show:e}),Zg=()=>["administrador"],MMe=()=>["administrador","conductor"],AMe=()=>["administrador","comprador"],IMe=()=>["administrador","auxiliar"],kMe=()=>["administrador","comprador","auxiliar"];function OMe(e,n){1&e&&(P(0,"li",7)(1,"a",9),U(2,"Productos"),O()())}function PMe(e,n){1&e&&(P(0,"li",7)(1,"a",10),U(2,"Clientes"),O()())}function RMe(e,n){1&e&&(P(0,"li",7)(1,"a",11),U(2,"Pedidos"),O()())}function NMe(e,n){1&e&&(P(0,"li",7)(1,"a",12),U(2,"Rutas"),O()())}function FMe(e,n){1&e&&(P(0,"li",7)(1,"a",13),U(2,"Compras"),O()())}function LMe(e,n){1&e&&(P(0,"li",7)(1,"a",14),U(2,"Inventario"),O()())}function BMe(e,n){1&e&&(P(0,"li",7)(1,"a",15),U(2,"Precios"),O()())}function zMe(e,n){1&e&&(P(0,"li",7)(1,"a",16),U(2,"Reportes"),O()())}function UMe(e,n){1&e&&(P(0,"li",7)(1,"a",17),U(2,"Costos"),O()())}function VMe(e,n){1&e&&(P(0,"li",7)(1,"a",18),U(2,"Cartera"),O()())}function jMe(e,n){1&e&&(P(0,"li",7)(1,"a",19),U(2,"Cierres"),O()())}function $Me(e,n){1&e&&(P(0,"li",7)(1,"a",20),U(2,"Strikes"),O()())}function HMe(e,n){1&e&&(P(0,"li",7)(1,"a",21),U(2,"Pedidos"),O()())}function GMe(e,n){if(1&e){const t=lr();P(0,"nav",1)(1,"button",2),ct("click",function(){return Bt(t),zt(Ge().toggleMenu())}),Rt(2,"img",3),O(),P(3,"div",4)(4,"ul",5),gt(5,OMe,3,0,"li",6)(6,PMe,3,0,"li",6)(7,RMe,3,0,"li",6)(8,NMe,3,0,"li",6)(9,FMe,3,0,"li",6)(10,LMe,3,0,"li",6)(11,BMe,3,0,"li",6)(12,zMe,3,0,"li",6)(13,UMe,3,0,"li",6)(14,VMe,3,0,"li",6)(15,jMe,3,0,"li",6)(16,$Me,3,0,"li",6)(17,HMe,3,0,"li",6),P(18,"li",7)(19,"a",8),ct("click",function(){return Bt(t),zt(Ge().logout())}),U(20,"Cerrar Sesi\xf3n"),O()()()()()}if(2&e){const t=Ge();W(),rs("aria-expanded",!t.isMenuCollapsed),W(2),Oe("ngClass",ba(15,DMe,!t.isMenuCollapsed)),W(2),Oe("ngIf",t.hasRole(Va(17,Zg))),W(),Oe("ngIf",t.hasRole(Va(18,Zg))),W(),Oe("ngIf",t.hasRole(Va(19,Zg))),W(),Oe("ngIf",t.hasRole(Va(20,MMe))),W(),Oe("ngIf",t.hasRole(Va(21,AMe))),W(),Oe("ngIf",t.hasRole(Va(22,IMe))),W(),Oe("ngIf",t.hasRole(Va(23,Zg))),W(),Oe("ngIf",t.hasRole(Va(24,Zg))),W(),Oe("ngIf",t.hasRole(Va(25,Zg))),W(),Oe("ngIf",t.hasRole(Va(26,Zg))),W(),Oe("ngIf",t.hasRole(Va(27,Zg))),W(),Oe("ngIf",t.hasRole(Va(28,Zg))),W(),Oe("ngIf",t.hasRole(Va(29,kMe)))}}let WMe=(()=>{class e{constructor(t,r){this.authService=t,this.router=r,this.role=[],this.isMenuCollapsed=!0}ngOnInit(){const t=localStorage.getItem("role");this.role=t?JSON.parse(t):[]}isLoggedIn(){return!!localStorage.getItem("token")}hasRole(t){return t.some(r=>this.role.includes(r))}toggleMenu(){this.isMenuCollapsed=!this.isMenuCollapsed}logout(){const t=localStorage.getItem("token");t?this.authService.logout(t).subscribe(()=>{localStorage.removeItem("token"),localStorage.removeItem("role"),this.router.navigate(["/login"])},()=>this.router.navigate(["/login"])):this.router.navigate(["/login"])}static#e=this.\u0275fac=function(r){return new(r||e)(ut(gD),ut(ws))};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-navigation-bar"]],decls:1,vars:1,consts:[["class","navbar navbar-expand-lg navbar-dark bg-dark","style","padding: 0;",4,"ngIf"],[1,"navbar","navbar-expand-lg","navbar-dark","bg-dark",2,"padding","0"],["type","button","aria-controls","navbarNav",1,"navbar-toggler",3,"click"],["src","assets/icon_app.png","alt","Logo","width","30"],["id","navbarNav",1,"collapse","navbar-collapse",3,"ngClass"],[1,"navbar-nav"],["class","nav-item",4,"ngIf"],[1,"nav-item"],[1,"nav-link",3,"click"],["routerLink","/productos","routerLinkActive","active",1,"nav-link"],["routerLink","/clientes","routerLinkActive","active",1,"nav-link"],["routerLink","/ordenes","routerLinkActive","active",1,"nav-link"],["routerLink","/rutas","routerLinkActive","active",1,"nav-link"],["routerLink","/purchases","routerLinkActive","active",1,"nav-link"],["routerLink","/inventories","routerLinkActive","active",1,"nav-link"],["routerLink","/precios","routerLinkActive","active",1,"nav-link"],["routerLink","/reports","routerLinkActive","active",1,"nav-link"],["routerLink","/costos","routerLinkActive","active",1,"nav-link"],["routerLink","/cartera","routerLinkActive","active",1,"nav-link"],["routerLink","/cierres","routerLinkActive","active",1,"nav-link"],["routerLink","/strikes","routerLinkActive","active",1,"nav-link"],["routerLink","/pedidos-report","routerLinkActive","active",1,"nav-link"]],template:function(r,i){1&r&&gt(0,GMe,21,30,"nav",0),2&r&&Oe("ngIf",i.isLoggedIn())},dependencies:[Zp,So,H0,BV],styles:[".navbar[_ngcontent-%COMP%]{background-color:#333}.nav[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:0;overflow:hidden}.nav-item[_ngcontent-%COMP%]{float:left}.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;color:#fff;text-align:center;padding:14px 16px;text-decoration:none}.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#ddd;color:#000}.active[_ngcontent-%COMP%]{background-color:#4caf50}"]})}return e})(),qMe=(()=>{class e{constructor(){this.title="Frescapp"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Lr({type:e,selectors:[["app-root"]],decls:3,vars:0,template:function(r,i){1&r&&(P(0,"div"),Rt(1,"app-navigation-bar"),O(),Rt(2,"router-outlet"))},dependencies:[GN,WMe]})}return e})(),ZMe=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Wi({type:e,bootstrap:[qMe]});static#n=this.\u0275inj=dn({providers:[Jw,{provide:z0,useClass:rz}],imports:[fte,SMe,o0e,nye,Ine,a0e,Kwe]})}return e})();dte().bootstrapModule(ZMe).catch(e=>console.error(e))},578:function(Ed,Ru){var Ja,kc;void 0!==(kc="function"==typeof(Ja=function(){"use strict";function f(Jr,ii,Es){var ki=new XMLHttpRequest;ki.open("GET",Jr),ki.responseType="blob",ki.onload=function(){gs(ki.response,ii,Es)},ki.onerror=function(){console.error("could not download file")},ki.send()}function xo(Jr){var ii=new XMLHttpRequest;ii.open("HEAD",Jr,!1);try{ii.send()}catch{}return 200<=ii.status&&299>=ii.status}function ss(Jr){try{Jr.dispatchEvent(new MouseEvent("click"))}catch{var ii=document.createEvent("MouseEvents");ii.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),Jr.dispatchEvent(ii)}}var cn="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,Hr=cn.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),gs=cn.saveAs||("object"!=typeof window||window!==cn?function(){}:"download"in HTMLAnchorElement.prototype&&!Hr?function(Jr,ii,Es){var ki=cn.URL||cn.webkitURL,eo=document.createElement("a");eo.download=ii=ii||Jr.name||"download",eo.rel="noopener","string"==typeof Jr?(eo.href=Jr,eo.origin===location.origin?ss(eo):xo(eo.href)?f(Jr,ii,Es):ss(eo,eo.target="_blank")):(eo.href=ki.createObjectURL(Jr),setTimeout(function(){ki.revokeObjectURL(eo.href)},4e4),setTimeout(function(){ss(eo)},0))}:"msSaveOrOpenBlob"in navigator?function(Jr,ii,Es){if(ii=ii||Jr.name||"download","string"!=typeof Jr)navigator.msSaveOrOpenBlob(function ao(Jr,ii){return typeof ii>"u"?ii={autoBom:!1}:"object"!=typeof ii&&(console.warn("Deprecated: Expected third argument to be a object"),ii={autoBom:!ii}),ii.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(Jr.type)?new Blob(["\ufeff",Jr],{type:Jr.type}):Jr}(Jr,Es),ii);else if(xo(Jr))f(Jr,ii,Es);else{var ki=document.createElement("a");ki.href=Jr,ki.target="_blank",setTimeout(function(){ss(ki)})}}:function(Jr,ii,Es,ki){if((ki=ki||open("","_blank"))&&(ki.document.title=ki.document.body.innerText="downloading..."),"string"==typeof Jr)return f(Jr,ii,Es);var eo="application/octet-stream"===Jr.type,Oc=/constructor/i.test(cn.HTMLElement)||cn.safari,sa=/CriOS\/[\d]+/.test(navigator.userAgent);if((sa||eo&&Oc||Hr)&&typeof FileReader<"u"){var Ni=new FileReader;Ni.onloadend=function(){var Sa=Ni.result;Sa=sa?Sa:Sa.replace(/^data:[^;]*;/,"data:attachment/file;"),ki?ki.location.href=Sa:location=Sa,ki=null},Ni.readAsDataURL(Jr)}else{var Oi=cn.URL||cn.webkitURL,lo=Oi.createObjectURL(Jr);ki?ki.location=lo:location.href=lo,ki=null,setTimeout(function(){Oi.revokeObjectURL(lo)},4e4)}});cn.saveAs=gs.saveAs=gs,Ed.exports=gs})?Ja.apply(Ru,[]):Ja)&&(Ed.exports=kc)},247:function(Ed){Ed.exports=function(){"use strict";var Ru,Ja,Ic;function kc(f,xo){if(Ru)if(Ja){var ss="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ru+")(sharedChunk); ("+Ja+")(sharedChunk); self.onerror = null;",cn={};Ru(cn),Ic=xo(cn),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ic.workerUrl=window.URL.createObjectURL(new Blob([ss],{type:"text/javascript"})))}else Ja=xo;else Ru=xo}return kc(0,function(f){var xo="3.6.0";let ss;const cn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ss){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ss=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{ss=o}}return ss},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!cn.API_URL)return null;try{const o=new URL(cn.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Hr(o){return cn.API_URL_REGEX.test(o)}function gs(o){return 0===o.indexOf("mapbox:")}function Jr(o){return cn.API_CDN_URL_REGEX.test(o)}function ii(o){return cn.API_SPRITE_REGEX.test(o)}function Es(o){return cn.API_STYLE_REGEX.test(o)&&!ii(o)}const ki={create:"create",load:"load",fullLoad:"fullLoad"},eo={mark(o){performance.mark(o)},measure(o,s,a){performance.measure(o,s,a)}};function Oc(o){const s=o.name.split("?")[0];return Jr(s)&&s.includes("mapbox-gl.js")?"javascript":Jr(s)&&s.includes("mapbox-gl.css")?"css":cn.API_FONTS_REGEX.test(s)?"fontRange":ii(s)?"sprite":Es(s)?"style":cn.API_TILEJSON_REGEX.test(s)?"tilejson":"other"}function sa(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Ni={},Oi={};Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.setMatrixArrayType=function(o){Oi.ARRAY_TYPE=Sa=o},Oi.toRadian=function(o){return o*$h},Oi.equals=function(o,s){return Math.abs(o-s)<=lo*Math.max(1,Math.abs(o),Math.abs(s))},Oi.RANDOM=Oi.ARRAY_TYPE=Oi.EPSILON=void 0;var lo=1e-6;Oi.EPSILON=lo;var Sa=typeof Float32Array<"u"?Float32Array:Array;Oi.ARRAY_TYPE=Sa;var Nu=Math.random;Oi.RANDOM=Nu;var $h=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var o=0,s=arguments.length;s--;)o+=arguments[s]*arguments[s];return Math.sqrt(o)});var xi={};function Zr(o){return(Zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}Object.defineProperty(xi,"__esModule",{value:!0}),xi.create=function(){var o=new Da.ARRAY_TYPE(4);return Da.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},xi.clone=function(o){var s=new Da.ARRAY_TYPE(4);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s},xi.copy=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o},xi.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o},xi.fromValues=function(o,s,a,d){var h=new Da.ARRAY_TYPE(4);return h[0]=o,h[1]=s,h[2]=a,h[3]=d,h},xi.set=function(o,s,a,d,h){return o[0]=s,o[1]=a,o[2]=d,o[3]=h,o},xi.transpose=function(o,s){if(o===s){var a=s[1];o[1]=s[2],o[2]=a}else o[0]=s[0],o[1]=s[2],o[2]=s[1],o[3]=s[3];return o},xi.invert=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=a*m-h*d;return _?(o[0]=m*(_=1/_),o[1]=-d*_,o[2]=-h*_,o[3]=a*_,o):null},xi.adjoint=function(o,s){var a=s[0];return o[0]=s[3],o[1]=-s[1],o[2]=-s[2],o[3]=a,o},xi.determinant=function(o){return o[0]*o[3]-o[2]*o[1]},xi.multiply=Hh,xi.rotate=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=Math.sin(a),T=Math.cos(a);return o[0]=d*T+m*b,o[1]=h*T+_*b,o[2]=d*-b+m*T,o[3]=h*-b+_*T,o},xi.scale=function(o,s,a){var d=s[1],h=s[2],m=s[3],_=a[0],b=a[1];return o[0]=s[0]*_,o[1]=d*_,o[2]=h*b,o[3]=m*b,o},xi.fromRotation=function(o,s){var a=Math.sin(s),d=Math.cos(s);return o[0]=d,o[1]=a,o[2]=-a,o[3]=d,o},xi.fromScaling=function(o,s){return o[0]=s[0],o[1]=0,o[2]=0,o[3]=s[1],o},xi.str=function(o){return"mat2("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},xi.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},xi.LDU=function(o,s,a,d){return o[2]=d[2]/d[0],a[0]=d[0],a[1]=d[1],a[3]=d[3]-o[2]*a[1],[o,s,a]},xi.add=function(o,s,a){return o[0]=s[0]+a[0],o[1]=s[1]+a[1],o[2]=s[2]+a[2],o[3]=s[3]+a[3],o},xi.subtract=Gh,xi.exactEquals=function(o,s){return o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]&&o[3]===s[3]},xi.equals=function(o,s){var a=o[0],d=o[1],h=o[2],m=o[3],_=s[0],b=s[1],T=s[2],S=s[3];return Math.abs(a-_)<=Da.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(d-b)<=Da.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))&&Math.abs(h-T)<=Da.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(m-S)<=Da.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},xi.multiplyScalar=function(o,s,a){return o[0]=s[0]*a,o[1]=s[1]*a,o[2]=s[2]*a,o[3]=s[3]*a,o},xi.multiplyScalarAndAdd=function(o,s,a,d){return o[0]=s[0]+a[0]*d,o[1]=s[1]+a[1]*d,o[2]=s[2]+a[2]*d,o[3]=s[3]+a[3]*d,o},xi.sub=xi.mul=void 0;var Da=function(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==Zr(o)&&"function"!=typeof o)return{default:o};var a=Fu(void 0);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}(Oi);function Fu(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(Fu=function(d){return d?a:s})(o)}function Hh(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=a[0],T=a[1],S=a[2],A=a[3];return o[0]=d*b+m*T,o[1]=h*b+_*T,o[2]=d*S+m*A,o[3]=h*S+_*A,o}function Gh(o,s,a){return o[0]=s[0]-a[0],o[1]=s[1]-a[1],o[2]=s[2]-a[2],o[3]=s[3]-a[3],o}xi.mul=Hh,xi.sub=Gh;var mi={};function ru(o){return(ru="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}Object.defineProperty(mi,"__esModule",{value:!0}),mi.create=function(){var o=new oa.ARRAY_TYPE(6);return oa.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[4]=0,o[5]=0),o[0]=1,o[3]=1,o},mi.clone=function(o){var s=new oa.ARRAY_TYPE(6);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s[4]=o[4],s[5]=o[5],s},mi.copy=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o[4]=s[4],o[5]=s[5],o},mi.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o[4]=0,o[5]=0,o},mi.fromValues=function(o,s,a,d,h,m){var _=new oa.ARRAY_TYPE(6);return _[0]=o,_[1]=s,_[2]=a,_[3]=d,_[4]=h,_[5]=m,_},mi.set=function(o,s,a,d,h,m,_){return o[0]=s,o[1]=a,o[2]=d,o[3]=h,o[4]=m,o[5]=_,o},mi.invert=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=s[4],b=s[5],T=a*m-d*h;return T?(o[0]=m*(T=1/T),o[1]=-d*T,o[2]=-h*T,o[3]=a*T,o[4]=(h*b-m*_)*T,o[5]=(d*_-a*b)*T,o):null},mi.determinant=function(o){return o[0]*o[3]-o[1]*o[2]},mi.multiply=Wh,mi.rotate=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=s[4],T=s[5],S=Math.sin(a),A=Math.cos(a);return o[0]=d*A+m*S,o[1]=h*A+_*S,o[2]=d*-S+m*A,o[3]=h*-S+_*A,o[4]=b,o[5]=T,o},mi.scale=function(o,s,a){var d=s[1],h=s[2],m=s[3],_=s[4],b=s[5],T=a[0],S=a[1];return o[0]=s[0]*T,o[1]=d*T,o[2]=h*S,o[3]=m*S,o[4]=_,o[5]=b,o},mi.translate=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=s[4],T=s[5],S=a[0],A=a[1];return o[0]=d,o[1]=h,o[2]=m,o[3]=_,o[4]=d*S+m*A+b,o[5]=h*S+_*A+T,o},mi.fromRotation=function(o,s){var a=Math.sin(s),d=Math.cos(s);return o[0]=d,o[1]=a,o[2]=-a,o[3]=d,o[4]=0,o[5]=0,o},mi.fromScaling=function(o,s){return o[0]=s[0],o[1]=0,o[2]=0,o[3]=s[1],o[4]=0,o[5]=0,o},mi.fromTranslation=function(o,s){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o[4]=s[0],o[5]=s[1],o},mi.str=function(o){return"mat2d("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+")"},mi.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],1)},mi.add=function(o,s,a){return o[0]=s[0]+a[0],o[1]=s[1]+a[1],o[2]=s[2]+a[2],o[3]=s[3]+a[3],o[4]=s[4]+a[4],o[5]=s[5]+a[5],o},mi.subtract=iu,mi.multiplyScalar=function(o,s,a){return o[0]=s[0]*a,o[1]=s[1]*a,o[2]=s[2]*a,o[3]=s[3]*a,o[4]=s[4]*a,o[5]=s[5]*a,o},mi.multiplyScalarAndAdd=function(o,s,a,d){return o[0]=s[0]+a[0]*d,o[1]=s[1]+a[1]*d,o[2]=s[2]+a[2]*d,o[3]=s[3]+a[3]*d,o[4]=s[4]+a[4]*d,o[5]=s[5]+a[5]*d,o},mi.exactEquals=function(o,s){return o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]&&o[3]===s[3]&&o[4]===s[4]&&o[5]===s[5]},mi.equals=function(o,s){var a=o[0],d=o[1],h=o[2],m=o[3],_=o[4],b=o[5],T=s[0],S=s[1],A=s[2],k=s[3],N=s[4],z=s[5];return Math.abs(a-T)<=oa.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(d-S)<=oa.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(h-A)<=oa.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(m-k)<=oa.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(_-N)<=oa.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(b-z)<=oa.EPSILON*Math.max(1,Math.abs(b),Math.abs(z))},mi.sub=mi.mul=void 0;var oa=function(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==ru(o)&&"function"!=typeof o)return{default:o};var a=hm(void 0);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}(Oi);function hm(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(hm=function(d){return d?a:s})(o)}function Wh(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=s[4],T=s[5],S=a[0],A=a[1],k=a[2],N=a[3],z=a[4],H=a[5];return o[0]=d*S+m*A,o[1]=h*S+_*A,o[2]=d*k+m*N,o[3]=h*k+_*N,o[4]=d*z+m*H+b,o[5]=h*z+_*H+T,o}function iu(o,s,a){return o[0]=s[0]-a[0],o[1]=s[1]-a[1],o[2]=s[2]-a[2],o[3]=s[3]-a[3],o[4]=s[4]-a[4],o[5]=s[5]-a[5],o}mi.mul=Wh,mi.sub=iu;var ai={};function Lu(o){return(Lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=function(){var o=new Gs.ARRAY_TYPE(9);return Gs.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},ai.fromMat4=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[4],o[4]=s[5],o[5]=s[6],o[6]=s[8],o[7]=s[9],o[8]=s[10],o},ai.clone=function(o){var s=new Gs.ARRAY_TYPE(9);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s[4]=o[4],s[5]=o[5],s[6]=o[6],s[7]=o[7],s[8]=o[8],s},ai.copy=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o[4]=s[4],o[5]=s[5],o[6]=s[6],o[7]=s[7],o[8]=s[8],o},ai.fromValues=function(o,s,a,d,h,m,_,b,T){var S=new Gs.ARRAY_TYPE(9);return S[0]=o,S[1]=s,S[2]=a,S[3]=d,S[4]=h,S[5]=m,S[6]=_,S[7]=b,S[8]=T,S},ai.set=function(o,s,a,d,h,m,_,b,T,S){return o[0]=s,o[1]=a,o[2]=d,o[3]=h,o[4]=m,o[5]=_,o[6]=b,o[7]=T,o[8]=S,o},ai.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ai.transpose=function(o,s){if(o===s){var a=s[1],d=s[2],h=s[5];o[1]=s[3],o[2]=s[6],o[3]=a,o[5]=s[7],o[6]=d,o[7]=h}else o[0]=s[0],o[1]=s[3],o[2]=s[6],o[3]=s[1],o[4]=s[4],o[5]=s[7],o[6]=s[2],o[7]=s[5],o[8]=s[8];return o},ai.invert=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=s[4],b=s[5],T=s[6],S=s[7],A=s[8],k=A*_-b*S,N=-A*m+b*T,z=S*m-_*T,H=a*k+d*N+h*z;return H?(o[0]=k*(H=1/H),o[1]=(-A*d+h*S)*H,o[2]=(b*d-h*_)*H,o[3]=N*H,o[4]=(A*a-h*T)*H,o[5]=(-b*a+h*m)*H,o[6]=z*H,o[7]=(-S*a+d*T)*H,o[8]=(_*a-d*m)*H,o):null},ai.adjoint=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=s[4],b=s[5],T=s[6],S=s[7],A=s[8];return o[0]=_*A-b*S,o[1]=h*S-d*A,o[2]=d*b-h*_,o[3]=b*T-m*A,o[4]=a*A-h*T,o[5]=h*m-a*b,o[6]=m*S-_*T,o[7]=d*T-a*S,o[8]=a*_-d*m,o},ai.determinant=function(o){var s=o[3],a=o[4],d=o[5],h=o[6],m=o[7],_=o[8];return o[0]*(_*a-d*m)+o[1]*(-_*s+d*h)+o[2]*(m*s-a*h)},ai.multiply=Yg,ai.translate=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=s[8],N=a[0],z=a[1];return o[0]=d,o[1]=h,o[2]=m,o[3]=_,o[4]=b,o[5]=T,o[6]=N*d+z*_+S,o[7]=N*h+z*b+A,o[8]=N*m+z*T+k,o},ai.rotate=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=s[8],N=Math.sin(a),z=Math.cos(a);return o[0]=z*d+N*_,o[1]=z*h+N*b,o[2]=z*m+N*T,o[3]=z*_-N*d,o[4]=z*b-N*h,o[5]=z*T-N*m,o[6]=S,o[7]=A,o[8]=k,o},ai.scale=function(o,s,a){var d=a[0],h=a[1];return o[0]=d*s[0],o[1]=d*s[1],o[2]=d*s[2],o[3]=h*s[3],o[4]=h*s[4],o[5]=h*s[5],o[6]=s[6],o[7]=s[7],o[8]=s[8],o},ai.fromTranslation=function(o,s){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=s[0],o[7]=s[1],o[8]=1,o},ai.fromRotation=function(o,s){var a=Math.sin(s),d=Math.cos(s);return o[0]=d,o[1]=a,o[2]=0,o[3]=-a,o[4]=d,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ai.fromScaling=function(o,s){return o[0]=s[0],o[1]=0,o[2]=0,o[3]=0,o[4]=s[1],o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ai.fromMat2d=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=0,o[3]=s[2],o[4]=s[3],o[5]=0,o[6]=s[4],o[7]=s[5],o[8]=1,o},ai.fromQuat=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=a+a,b=d+d,T=h+h,S=a*_,A=d*_,k=d*b,N=h*_,z=h*b,H=h*T,q=m*_,X=m*b,ee=m*T;return o[0]=1-k-H,o[3]=A-ee,o[6]=N+X,o[1]=A+ee,o[4]=1-S-H,o[7]=z-q,o[2]=N-X,o[5]=z+q,o[8]=1-S-k,o},ai.normalFromMat4=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=s[4],b=s[5],T=s[6],S=s[7],A=s[8],k=s[9],N=s[10],z=s[11],H=s[12],q=s[13],X=s[14],ee=s[15],de=a*b-d*_,ue=a*T-h*_,fe=a*S-m*_,be=d*T-h*b,Te=d*S-m*b,De=h*S-m*T,Be=A*q-k*H,Ze=A*X-N*H,ot=A*ee-z*H,Ke=k*X-N*q,_t=k*ee-z*q,Ft=N*ee-z*X,yt=de*Ft-ue*_t+fe*Ke+be*ot-Te*Ze+De*Be;return yt?(o[0]=(b*Ft-T*_t+S*Ke)*(yt=1/yt),o[1]=(T*ot-_*Ft-S*Ze)*yt,o[2]=(_*_t-b*ot+S*Be)*yt,o[3]=(h*_t-d*Ft-m*Ke)*yt,o[4]=(a*Ft-h*ot+m*Ze)*yt,o[5]=(d*ot-a*_t-m*Be)*yt,o[6]=(q*De-X*Te+ee*be)*yt,o[7]=(X*fe-H*De-ee*ue)*yt,o[8]=(H*Te-q*fe+ee*de)*yt,o):null},ai.projection=function(o,s,a){return o[0]=2/s,o[1]=0,o[2]=0,o[3]=0,o[4]=-2/a,o[5]=0,o[6]=-1,o[7]=1,o[8]=1,o},ai.str=function(o){return"mat3("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+", "+o[8]+")"},ai.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8])},ai.add=function(o,s,a){return o[0]=s[0]+a[0],o[1]=s[1]+a[1],o[2]=s[2]+a[2],o[3]=s[3]+a[3],o[4]=s[4]+a[4],o[5]=s[5]+a[5],o[6]=s[6]+a[6],o[7]=s[7]+a[7],o[8]=s[8]+a[8],o},ai.subtract=pm,ai.multiplyScalar=function(o,s,a){return o[0]=s[0]*a,o[1]=s[1]*a,o[2]=s[2]*a,o[3]=s[3]*a,o[4]=s[4]*a,o[5]=s[5]*a,o[6]=s[6]*a,o[7]=s[7]*a,o[8]=s[8]*a,o},ai.multiplyScalarAndAdd=function(o,s,a,d){return o[0]=s[0]+a[0]*d,o[1]=s[1]+a[1]*d,o[2]=s[2]+a[2]*d,o[3]=s[3]+a[3]*d,o[4]=s[4]+a[4]*d,o[5]=s[5]+a[5]*d,o[6]=s[6]+a[6]*d,o[7]=s[7]+a[7]*d,o[8]=s[8]+a[8]*d,o},ai.exactEquals=function(o,s){return o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]&&o[3]===s[3]&&o[4]===s[4]&&o[5]===s[5]&&o[6]===s[6]&&o[7]===s[7]&&o[8]===s[8]},ai.equals=function(o,s){var a=o[0],d=o[1],h=o[2],m=o[3],_=o[4],b=o[5],T=o[6],S=o[7],A=o[8],k=s[0],N=s[1],z=s[2],H=s[3],q=s[4],X=s[5],ee=s[6],de=s[7],ue=s[8];return Math.abs(a-k)<=Gs.EPSILON*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(d-N)<=Gs.EPSILON*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(h-z)<=Gs.EPSILON*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(m-H)<=Gs.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(_-q)<=Gs.EPSILON*Math.max(1,Math.abs(_),Math.abs(q))&&Math.abs(b-X)<=Gs.EPSILON*Math.max(1,Math.abs(b),Math.abs(X))&&Math.abs(T-ee)<=Gs.EPSILON*Math.max(1,Math.abs(T),Math.abs(ee))&&Math.abs(S-de)<=Gs.EPSILON*Math.max(1,Math.abs(S),Math.abs(de))&&Math.abs(A-ue)<=Gs.EPSILON*Math.max(1,Math.abs(A),Math.abs(ue))},ai.sub=ai.mul=void 0;var Gs=function(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==Lu(o)&&"function"!=typeof o)return{default:o};var a=fm(void 0);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}(Oi);function fm(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(fm=function(d){return d?a:s})(o)}function Yg(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=s[8],N=a[0],z=a[1],H=a[2],q=a[3],X=a[4],ee=a[5],de=a[6],ue=a[7],fe=a[8];return o[0]=N*d+z*_+H*S,o[1]=N*h+z*b+H*A,o[2]=N*m+z*T+H*k,o[3]=q*d+X*_+ee*S,o[4]=q*h+X*b+ee*A,o[5]=q*m+X*T+ee*k,o[6]=de*d+ue*_+fe*S,o[7]=de*h+ue*b+fe*A,o[8]=de*m+ue*T+fe*k,o}function pm(o,s,a){return o[0]=s[0]-a[0],o[1]=s[1]-a[1],o[2]=s[2]-a[2],o[3]=s[3]-a[3],o[4]=s[4]-a[4],o[5]=s[5]-a[5],o[6]=s[6]-a[6],o[7]=s[7]-a[7],o[8]=s[8]-a[8],o}ai.mul=Yg,ai.sub=pm;var er={};function Cd(o){return(Cd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}Object.defineProperty(er,"__esModule",{value:!0}),er.create=function(){var o=new Yi.ARRAY_TYPE(16);return Yi.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},er.clone=function(o){var s=new Yi.ARRAY_TYPE(16);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s[4]=o[4],s[5]=o[5],s[6]=o[6],s[7]=o[7],s[8]=o[8],s[9]=o[9],s[10]=o[10],s[11]=o[11],s[12]=o[12],s[13]=o[13],s[14]=o[14],s[15]=o[15],s},er.copy=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o[4]=s[4],o[5]=s[5],o[6]=s[6],o[7]=s[7],o[8]=s[8],o[9]=s[9],o[10]=s[10],o[11]=s[11],o[12]=s[12],o[13]=s[13],o[14]=s[14],o[15]=s[15],o},er.fromValues=function(o,s,a,d,h,m,_,b,T,S,A,k,N,z,H,q){var X=new Yi.ARRAY_TYPE(16);return X[0]=o,X[1]=s,X[2]=a,X[3]=d,X[4]=h,X[5]=m,X[6]=_,X[7]=b,X[8]=T,X[9]=S,X[10]=A,X[11]=k,X[12]=N,X[13]=z,X[14]=H,X[15]=q,X},er.set=function(o,s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X){return o[0]=s,o[1]=a,o[2]=d,o[3]=h,o[4]=m,o[5]=_,o[6]=b,o[7]=T,o[8]=S,o[9]=A,o[10]=k,o[11]=N,o[12]=z,o[13]=H,o[14]=q,o[15]=X,o},er.identity=Ht,er.transpose=function(o,s){if(o===s){var a=s[1],d=s[2],h=s[3],m=s[6],_=s[7],b=s[11];o[1]=s[4],o[2]=s[8],o[3]=s[12],o[4]=a,o[6]=s[9],o[7]=s[13],o[8]=d,o[9]=m,o[11]=s[14],o[12]=h,o[13]=_,o[14]=b}else o[0]=s[0],o[1]=s[4],o[2]=s[8],o[3]=s[12],o[4]=s[1],o[5]=s[5],o[6]=s[9],o[7]=s[13],o[8]=s[2],o[9]=s[6],o[10]=s[10],o[11]=s[14],o[12]=s[3],o[13]=s[7],o[14]=s[11],o[15]=s[15];return o},er.invert=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=s[4],b=s[5],T=s[6],S=s[7],A=s[8],k=s[9],N=s[10],z=s[11],H=s[12],q=s[13],X=s[14],ee=s[15],de=a*b-d*_,ue=a*T-h*_,fe=a*S-m*_,be=d*T-h*b,Te=d*S-m*b,De=h*S-m*T,Be=A*q-k*H,Ze=A*X-N*H,ot=A*ee-z*H,Ke=k*X-N*q,_t=k*ee-z*q,Ft=N*ee-z*X,yt=de*Ft-ue*_t+fe*Ke+be*ot-Te*Ze+De*Be;return yt?(o[0]=(b*Ft-T*_t+S*Ke)*(yt=1/yt),o[1]=(h*_t-d*Ft-m*Ke)*yt,o[2]=(q*De-X*Te+ee*be)*yt,o[3]=(N*Te-k*De-z*be)*yt,o[4]=(T*ot-_*Ft-S*Ze)*yt,o[5]=(a*Ft-h*ot+m*Ze)*yt,o[6]=(X*fe-H*De-ee*ue)*yt,o[7]=(A*De-N*fe+z*ue)*yt,o[8]=(_*_t-b*ot+S*Be)*yt,o[9]=(d*ot-a*_t-m*Be)*yt,o[10]=(H*Te-q*fe+ee*de)*yt,o[11]=(k*fe-A*Te-z*de)*yt,o[12]=(b*Ze-_*Ke-T*Be)*yt,o[13]=(a*Ke-d*Ze+h*Be)*yt,o[14]=(q*ue-H*be-X*de)*yt,o[15]=(A*be-k*ue+N*de)*yt,o):null},er.adjoint=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=s[4],b=s[5],T=s[6],S=s[7],A=s[8],k=s[9],N=s[10],z=s[11],H=s[12],q=s[13],X=s[14],ee=s[15];return o[0]=b*(N*ee-z*X)-k*(T*ee-S*X)+q*(T*z-S*N),o[1]=-(d*(N*ee-z*X)-k*(h*ee-m*X)+q*(h*z-m*N)),o[2]=d*(T*ee-S*X)-b*(h*ee-m*X)+q*(h*S-m*T),o[3]=-(d*(T*z-S*N)-b*(h*z-m*N)+k*(h*S-m*T)),o[4]=-(_*(N*ee-z*X)-A*(T*ee-S*X)+H*(T*z-S*N)),o[5]=a*(N*ee-z*X)-A*(h*ee-m*X)+H*(h*z-m*N),o[6]=-(a*(T*ee-S*X)-_*(h*ee-m*X)+H*(h*S-m*T)),o[7]=a*(T*z-S*N)-_*(h*z-m*N)+A*(h*S-m*T),o[8]=_*(k*ee-z*q)-A*(b*ee-S*q)+H*(b*z-S*k),o[9]=-(a*(k*ee-z*q)-A*(d*ee-m*q)+H*(d*z-m*k)),o[10]=a*(b*ee-S*q)-_*(d*ee-m*q)+H*(d*S-m*b),o[11]=-(a*(b*z-S*k)-_*(d*z-m*k)+A*(d*S-m*b)),o[12]=-(_*(k*X-N*q)-A*(b*X-T*q)+H*(b*N-T*k)),o[13]=a*(k*X-N*q)-A*(d*X-h*q)+H*(d*N-h*k),o[14]=-(a*(b*X-T*q)-_*(d*X-h*q)+H*(d*T-h*b)),o[15]=a*(b*N-T*k)-_*(d*N-h*k)+A*(d*T-h*b),o},er.determinant=function(o){var s=o[0],a=o[1],d=o[2],h=o[3],m=o[4],_=o[5],b=o[6],T=o[7],S=o[8],A=o[9],k=o[10],N=o[11],z=o[12],H=o[13],q=o[14],X=o[15];return(s*_-a*m)*(k*X-N*q)-(s*b-d*m)*(A*X-N*H)+(s*T-h*m)*(A*q-k*H)+(a*b-d*_)*(S*X-N*z)-(a*T-h*_)*(S*q-k*z)+(d*T-h*b)*(S*H-A*z)},er.multiply=yn,er.translate=function(o,s,a){var d,h,m,_,b,T,S,A,k,N,z,H,q=a[0],X=a[1],ee=a[2];return s===o?(o[12]=s[0]*q+s[4]*X+s[8]*ee+s[12],o[13]=s[1]*q+s[5]*X+s[9]*ee+s[13],o[14]=s[2]*q+s[6]*X+s[10]*ee+s[14],o[15]=s[3]*q+s[7]*X+s[11]*ee+s[15]):(h=s[1],m=s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=s[8],N=s[9],z=s[10],H=s[11],o[0]=d=s[0],o[1]=h,o[2]=m,o[3]=_,o[4]=b,o[5]=T,o[6]=S,o[7]=A,o[8]=k,o[9]=N,o[10]=z,o[11]=H,o[12]=d*q+b*X+k*ee+s[12],o[13]=h*q+T*X+N*ee+s[13],o[14]=m*q+S*X+z*ee+s[14],o[15]=_*q+A*X+H*ee+s[15]),o},er.scale=function(o,s,a){var d=a[0],h=a[1],m=a[2];return o[0]=s[0]*d,o[1]=s[1]*d,o[2]=s[2]*d,o[3]=s[3]*d,o[4]=s[4]*h,o[5]=s[5]*h,o[6]=s[6]*h,o[7]=s[7]*h,o[8]=s[8]*m,o[9]=s[9]*m,o[10]=s[10]*m,o[11]=s[11]*m,o[12]=s[12],o[13]=s[13],o[14]=s[14],o[15]=s[15],o},er.rotate=function(o,s,a,d){var h,m,_,b,T,S,A,k,N,z,H,q,X,ee,de,ue,fe,be,Te,De,Be,Ze,ot,Ke,_t=d[0],Ft=d[1],yt=d[2],Wt=Math.hypot(_t,Ft,yt);return Wt<Yi.EPSILON?null:(_t*=Wt=1/Wt,Ft*=Wt,yt*=Wt,h=Math.sin(a),m=Math.cos(a),T=s[1],S=s[2],A=s[3],N=s[5],z=s[6],H=s[7],X=s[9],ee=s[10],de=s[11],ue=_t*_t*(_=1-m)+m,Te=_t*Ft*_-yt*h,De=Ft*Ft*_+m,Be=yt*Ft*_+_t*h,Ze=_t*yt*_+Ft*h,ot=Ft*yt*_-_t*h,Ke=yt*yt*_+m,o[0]=(b=s[0])*ue+(k=s[4])*(fe=Ft*_t*_+yt*h)+(q=s[8])*(be=yt*_t*_-Ft*h),o[1]=T*ue+N*fe+X*be,o[2]=S*ue+z*fe+ee*be,o[3]=A*ue+H*fe+de*be,o[4]=b*Te+k*De+q*Be,o[5]=T*Te+N*De+X*Be,o[6]=S*Te+z*De+ee*Be,o[7]=A*Te+H*De+de*Be,o[8]=b*Ze+k*ot+q*Ke,o[9]=T*Ze+N*ot+X*Ke,o[10]=S*Ze+z*ot+ee*Ke,o[11]=A*Ze+H*ot+de*Ke,s!==o&&(o[12]=s[12],o[13]=s[13],o[14]=s[14],o[15]=s[15]),o)},er.rotateX=function(o,s,a){var d=Math.sin(a),h=Math.cos(a),m=s[4],_=s[5],b=s[6],T=s[7],S=s[8],A=s[9],k=s[10],N=s[11];return s!==o&&(o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o[12]=s[12],o[13]=s[13],o[14]=s[14],o[15]=s[15]),o[4]=m*h+S*d,o[5]=_*h+A*d,o[6]=b*h+k*d,o[7]=T*h+N*d,o[8]=S*h-m*d,o[9]=A*h-_*d,o[10]=k*h-b*d,o[11]=N*h-T*d,o},er.rotateY=function(o,s,a){var d=Math.sin(a),h=Math.cos(a),m=s[0],_=s[1],b=s[2],T=s[3],S=s[8],A=s[9],k=s[10],N=s[11];return s!==o&&(o[4]=s[4],o[5]=s[5],o[6]=s[6],o[7]=s[7],o[12]=s[12],o[13]=s[13],o[14]=s[14],o[15]=s[15]),o[0]=m*h-S*d,o[1]=_*h-A*d,o[2]=b*h-k*d,o[3]=T*h-N*d,o[8]=m*d+S*h,o[9]=_*d+A*h,o[10]=b*d+k*h,o[11]=T*d+N*h,o},er.rotateZ=function(o,s,a){var d=Math.sin(a),h=Math.cos(a),m=s[0],_=s[1],b=s[2],T=s[3],S=s[4],A=s[5],k=s[6],N=s[7];return s!==o&&(o[8]=s[8],o[9]=s[9],o[10]=s[10],o[11]=s[11],o[12]=s[12],o[13]=s[13],o[14]=s[14],o[15]=s[15]),o[0]=m*h+S*d,o[1]=_*h+A*d,o[2]=b*h+k*d,o[3]=T*h+N*d,o[4]=S*h-m*d,o[5]=A*h-_*d,o[6]=k*h-b*d,o[7]=N*h-T*d,o},er.fromTranslation=function(o,s){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=s[0],o[13]=s[1],o[14]=s[2],o[15]=1,o},er.fromScaling=function(o,s){return o[0]=s[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=s[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},er.fromRotation=function(o,s,a){var d,h,m,_=a[0],b=a[1],T=a[2],S=Math.hypot(_,b,T);return S<Yi.EPSILON?null:(_*=S=1/S,b*=S,T*=S,d=Math.sin(s),h=Math.cos(s),o[0]=_*_*(m=1-h)+h,o[1]=b*_*m+T*d,o[2]=T*_*m-b*d,o[3]=0,o[4]=_*b*m-T*d,o[5]=b*b*m+h,o[6]=T*b*m+_*d,o[7]=0,o[8]=_*T*m+b*d,o[9]=b*T*m-_*d,o[10]=T*T*m+h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)},er.fromXRotation=function(o,s){var a=Math.sin(s),d=Math.cos(s);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=d,o[6]=a,o[7]=0,o[8]=0,o[9]=-a,o[10]=d,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},er.fromYRotation=function(o,s){var a=Math.sin(s),d=Math.cos(s);return o[0]=d,o[1]=0,o[2]=-a,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=a,o[9]=0,o[10]=d,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},er.fromZRotation=function(o,s){var a=Math.sin(s),d=Math.cos(s);return o[0]=d,o[1]=a,o[2]=0,o[3]=0,o[4]=-a,o[5]=d,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},er.fromRotationTranslation=En,er.fromQuat2=function(o,s){var a=new Yi.ARRAY_TYPE(3),d=-s[0],h=-s[1],m=-s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=d*d+h*h+m*m+_*_;return k>0?(a[0]=2*(b*_+A*d+T*m-S*h)/k,a[1]=2*(T*_+A*h+S*d-b*m)/k,a[2]=2*(S*_+A*m+b*h-T*d)/k):(a[0]=2*(b*_+A*d+T*m-S*h),a[1]=2*(T*_+A*h+S*d-b*m),a[2]=2*(S*_+A*m+b*h-T*d)),En(o,s,a),o},er.getTranslation=function(o,s){return o[0]=s[12],o[1]=s[13],o[2]=s[14],o},er.getScaling=ir,er.getRotation=function(o,s){var a=new Yi.ARRAY_TYPE(3);ir(a,s);var d=1/a[0],h=1/a[1],m=1/a[2],_=s[0]*d,b=s[1]*h,T=s[2]*m,S=s[4]*d,A=s[5]*h,k=s[6]*m,N=s[8]*d,z=s[9]*h,H=s[10]*m,q=_+A+H,X=0;return q>0?(X=2*Math.sqrt(q+1),o[3]=.25*X,o[0]=(k-z)/X,o[1]=(N-T)/X,o[2]=(b-S)/X):_>A&&_>H?(X=2*Math.sqrt(1+_-A-H),o[3]=(k-z)/X,o[0]=.25*X,o[1]=(b+S)/X,o[2]=(N+T)/X):A>H?(X=2*Math.sqrt(1+A-_-H),o[3]=(N-T)/X,o[0]=(b+S)/X,o[1]=.25*X,o[2]=(k+z)/X):(X=2*Math.sqrt(1+H-_-A),o[3]=(b-S)/X,o[0]=(N+T)/X,o[1]=(k+z)/X,o[2]=.25*X),o},er.fromRotationTranslationScale=function(o,s,a,d){var h=s[0],m=s[1],_=s[2],b=s[3],T=h+h,S=m+m,A=_+_,k=h*T,N=h*S,z=h*A,H=m*S,q=m*A,X=_*A,ee=b*T,de=b*S,ue=b*A,fe=d[0],be=d[1],Te=d[2];return o[0]=(1-(H+X))*fe,o[1]=(N+ue)*fe,o[2]=(z-de)*fe,o[3]=0,o[4]=(N-ue)*be,o[5]=(1-(k+X))*be,o[6]=(q+ee)*be,o[7]=0,o[8]=(z+de)*Te,o[9]=(q-ee)*Te,o[10]=(1-(k+H))*Te,o[11]=0,o[12]=a[0],o[13]=a[1],o[14]=a[2],o[15]=1,o},er.fromRotationTranslationScaleOrigin=function(o,s,a,d,h){var m=s[0],_=s[1],b=s[2],T=s[3],S=m+m,A=_+_,k=b+b,N=m*S,z=m*A,H=m*k,q=_*A,X=_*k,ee=b*k,de=T*S,ue=T*A,fe=T*k,be=d[0],Te=d[1],De=d[2],Be=h[0],Ze=h[1],ot=h[2],Ke=(1-(q+ee))*be,_t=(z+fe)*be,Ft=(H-ue)*be,yt=(z-fe)*Te,Wt=(1-(N+ee))*Te,mt=(X+de)*Te,Tt=(H+ue)*De,Kt=(X-de)*De,bt=(1-(N+q))*De;return o[0]=Ke,o[1]=_t,o[2]=Ft,o[3]=0,o[4]=yt,o[5]=Wt,o[6]=mt,o[7]=0,o[8]=Tt,o[9]=Kt,o[10]=bt,o[11]=0,o[12]=a[0]+Be-(Ke*Be+yt*Ze+Tt*ot),o[13]=a[1]+Ze-(_t*Be+Wt*Ze+Kt*ot),o[14]=a[2]+ot-(Ft*Be+mt*Ze+bt*ot),o[15]=1,o},er.fromQuat=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=a+a,b=d+d,T=h+h,S=a*_,A=d*_,k=d*b,N=h*_,z=h*b,H=h*T,q=m*_,X=m*b,ee=m*T;return o[0]=1-k-H,o[1]=A+ee,o[2]=N-X,o[3]=0,o[4]=A-ee,o[5]=1-S-H,o[6]=z+q,o[7]=0,o[8]=N+X,o[9]=z-q,o[10]=1-S-k,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},er.frustum=function(o,s,a,d,h,m,_){var b=1/(a-s),T=1/(h-d),S=1/(m-_);return o[0]=2*m*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*m*T,o[6]=0,o[7]=0,o[8]=(a+s)*b,o[9]=(h+d)*T,o[10]=(_+m)*S,o[11]=-1,o[12]=0,o[13]=0,o[14]=_*m*2*S,o[15]=0,o},er.perspectiveNO=hr,er.perspectiveZO=function(o,s,a,d,h){var m,_=1/Math.tan(s/2);return o[0]=_/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=h&&h!==1/0?(o[10]=h*(m=1/(d-h)),o[14]=h*d*m):(o[10]=-1,o[14]=-d),o},er.perspectiveFromFieldOfView=function(o,s,a,d){var h=Math.tan(s.upDegrees*Math.PI/180),m=Math.tan(s.downDegrees*Math.PI/180),_=Math.tan(s.leftDegrees*Math.PI/180),b=Math.tan(s.rightDegrees*Math.PI/180),T=2/(_+b),S=2/(h+m);return o[0]=T,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=S,o[6]=0,o[7]=0,o[8]=-(_-b)*T*.5,o[9]=(h-m)*S*.5,o[10]=d/(a-d),o[11]=-1,o[12]=0,o[13]=0,o[14]=d*a/(a-d),o[15]=0,o},er.orthoNO=xr,er.orthoZO=function(o,s,a,d,h,m,_){var b=1/(s-a),T=1/(d-h),S=1/(m-_);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=S,o[11]=0,o[12]=(s+a)*b,o[13]=(h+d)*T,o[14]=m*S,o[15]=1,o},er.lookAt=function(o,s,a,d){var h,m,_,b,T,S,A,k,N,z,H=s[0],q=s[1],X=s[2],ee=d[0],de=d[1],ue=d[2],fe=a[0],be=a[1],Te=a[2];return Math.abs(H-fe)<Yi.EPSILON&&Math.abs(q-be)<Yi.EPSILON&&Math.abs(X-Te)<Yi.EPSILON?Ht(o):(A=H-fe,k=q-be,N=X-Te,h=de*(N*=z=1/Math.hypot(A,k,N))-ue*(k*=z),m=ue*(A*=z)-ee*N,_=ee*k-de*A,(z=Math.hypot(h,m,_))?(h*=z=1/z,m*=z,_*=z):(h=0,m=0,_=0),b=k*_-N*m,T=N*h-A*_,S=A*m-k*h,(z=Math.hypot(b,T,S))?(b*=z=1/z,T*=z,S*=z):(b=0,T=0,S=0),o[0]=h,o[1]=b,o[2]=A,o[3]=0,o[4]=m,o[5]=T,o[6]=k,o[7]=0,o[8]=_,o[9]=S,o[10]=N,o[11]=0,o[12]=-(h*H+m*q+_*X),o[13]=-(b*H+T*q+S*X),o[14]=-(A*H+k*q+N*X),o[15]=1,o)},er.targetTo=function(o,s,a,d){var h=s[0],m=s[1],_=s[2],b=d[0],T=d[1],S=d[2],A=h-a[0],k=m-a[1],N=_-a[2],z=A*A+k*k+N*N;z>0&&(A*=z=1/Math.sqrt(z),k*=z,N*=z);var H=T*N-S*k,q=S*A-b*N,X=b*k-T*A;return(z=H*H+q*q+X*X)>0&&(H*=z=1/Math.sqrt(z),q*=z,X*=z),o[0]=H,o[1]=q,o[2]=X,o[3]=0,o[4]=k*X-N*q,o[5]=N*H-A*X,o[6]=A*q-k*H,o[7]=0,o[8]=A,o[9]=k,o[10]=N,o[11]=0,o[12]=h,o[13]=m,o[14]=_,o[15]=1,o},er.str=function(o){return"mat4("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+", "+o[8]+", "+o[9]+", "+o[10]+", "+o[11]+", "+o[12]+", "+o[13]+", "+o[14]+", "+o[15]+")"},er.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15])},er.add=function(o,s,a){return o[0]=s[0]+a[0],o[1]=s[1]+a[1],o[2]=s[2]+a[2],o[3]=s[3]+a[3],o[4]=s[4]+a[4],o[5]=s[5]+a[5],o[6]=s[6]+a[6],o[7]=s[7]+a[7],o[8]=s[8]+a[8],o[9]=s[9]+a[9],o[10]=s[10]+a[10],o[11]=s[11]+a[11],o[12]=s[12]+a[12],o[13]=s[13]+a[13],o[14]=s[14]+a[14],o[15]=s[15]+a[15],o},er.subtract=Gi,er.multiplyScalar=function(o,s,a){return o[0]=s[0]*a,o[1]=s[1]*a,o[2]=s[2]*a,o[3]=s[3]*a,o[4]=s[4]*a,o[5]=s[5]*a,o[6]=s[6]*a,o[7]=s[7]*a,o[8]=s[8]*a,o[9]=s[9]*a,o[10]=s[10]*a,o[11]=s[11]*a,o[12]=s[12]*a,o[13]=s[13]*a,o[14]=s[14]*a,o[15]=s[15]*a,o},er.multiplyScalarAndAdd=function(o,s,a,d){return o[0]=s[0]+a[0]*d,o[1]=s[1]+a[1]*d,o[2]=s[2]+a[2]*d,o[3]=s[3]+a[3]*d,o[4]=s[4]+a[4]*d,o[5]=s[5]+a[5]*d,o[6]=s[6]+a[6]*d,o[7]=s[7]+a[7]*d,o[8]=s[8]+a[8]*d,o[9]=s[9]+a[9]*d,o[10]=s[10]+a[10]*d,o[11]=s[11]+a[11]*d,o[12]=s[12]+a[12]*d,o[13]=s[13]+a[13]*d,o[14]=s[14]+a[14]*d,o[15]=s[15]+a[15]*d,o},er.exactEquals=function(o,s){return o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]&&o[3]===s[3]&&o[4]===s[4]&&o[5]===s[5]&&o[6]===s[6]&&o[7]===s[7]&&o[8]===s[8]&&o[9]===s[9]&&o[10]===s[10]&&o[11]===s[11]&&o[12]===s[12]&&o[13]===s[13]&&o[14]===s[14]&&o[15]===s[15]},er.equals=function(o,s){var a=o[0],d=o[1],h=o[2],m=o[3],_=o[4],b=o[5],T=o[6],S=o[7],A=o[8],k=o[9],N=o[10],z=o[11],H=o[12],q=o[13],X=o[14],ee=o[15],de=s[0],ue=s[1],fe=s[2],be=s[3],Te=s[4],De=s[5],Be=s[6],Ze=s[7],ot=s[8],Ke=s[9],_t=s[10],Ft=s[11],yt=s[12],Wt=s[13],mt=s[14],Tt=s[15];return Math.abs(a-de)<=Yi.EPSILON*Math.max(1,Math.abs(a),Math.abs(de))&&Math.abs(d-ue)<=Yi.EPSILON*Math.max(1,Math.abs(d),Math.abs(ue))&&Math.abs(h-fe)<=Yi.EPSILON*Math.max(1,Math.abs(h),Math.abs(fe))&&Math.abs(m-be)<=Yi.EPSILON*Math.max(1,Math.abs(m),Math.abs(be))&&Math.abs(_-Te)<=Yi.EPSILON*Math.max(1,Math.abs(_),Math.abs(Te))&&Math.abs(b-De)<=Yi.EPSILON*Math.max(1,Math.abs(b),Math.abs(De))&&Math.abs(T-Be)<=Yi.EPSILON*Math.max(1,Math.abs(T),Math.abs(Be))&&Math.abs(S-Ze)<=Yi.EPSILON*Math.max(1,Math.abs(S),Math.abs(Ze))&&Math.abs(A-ot)<=Yi.EPSILON*Math.max(1,Math.abs(A),Math.abs(ot))&&Math.abs(k-Ke)<=Yi.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ke))&&Math.abs(N-_t)<=Yi.EPSILON*Math.max(1,Math.abs(N),Math.abs(_t))&&Math.abs(z-Ft)<=Yi.EPSILON*Math.max(1,Math.abs(z),Math.abs(Ft))&&Math.abs(H-yt)<=Yi.EPSILON*Math.max(1,Math.abs(H),Math.abs(yt))&&Math.abs(q-Wt)<=Yi.EPSILON*Math.max(1,Math.abs(q),Math.abs(Wt))&&Math.abs(X-mt)<=Yi.EPSILON*Math.max(1,Math.abs(X),Math.abs(mt))&&Math.abs(ee-Tt)<=Yi.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Tt))},er.sub=er.mul=er.ortho=er.perspective=void 0;var Yi=function(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==Cd(o)&&"function"!=typeof o)return{default:o};var a=At(void 0);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}(Oi);function At(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(At=function(d){return d?a:s})(o)}function Ht(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function yn(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=s[8],N=s[9],z=s[10],H=s[11],q=s[12],X=s[13],ee=s[14],de=s[15],ue=a[0],fe=a[1],be=a[2],Te=a[3];return o[0]=ue*d+fe*b+be*k+Te*q,o[1]=ue*h+fe*T+be*N+Te*X,o[2]=ue*m+fe*S+be*z+Te*ee,o[3]=ue*_+fe*A+be*H+Te*de,o[4]=(ue=a[4])*d+(fe=a[5])*b+(be=a[6])*k+(Te=a[7])*q,o[5]=ue*h+fe*T+be*N+Te*X,o[6]=ue*m+fe*S+be*z+Te*ee,o[7]=ue*_+fe*A+be*H+Te*de,o[8]=(ue=a[8])*d+(fe=a[9])*b+(be=a[10])*k+(Te=a[11])*q,o[9]=ue*h+fe*T+be*N+Te*X,o[10]=ue*m+fe*S+be*z+Te*ee,o[11]=ue*_+fe*A+be*H+Te*de,o[12]=(ue=a[12])*d+(fe=a[13])*b+(be=a[14])*k+(Te=a[15])*q,o[13]=ue*h+fe*T+be*N+Te*X,o[14]=ue*m+fe*S+be*z+Te*ee,o[15]=ue*_+fe*A+be*H+Te*de,o}function En(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=d+d,T=h+h,S=m+m,A=d*b,k=d*T,N=d*S,z=h*T,H=h*S,q=m*S,X=_*b,ee=_*T,de=_*S;return o[0]=1-(z+q),o[1]=k+de,o[2]=N-ee,o[3]=0,o[4]=k-de,o[5]=1-(A+q),o[6]=H+X,o[7]=0,o[8]=N+ee,o[9]=H-X,o[10]=1-(A+z),o[11]=0,o[12]=a[0],o[13]=a[1],o[14]=a[2],o[15]=1,o}function ir(o,s){var a=s[4],d=s[5],h=s[6],m=s[8],_=s[9],b=s[10];return o[0]=Math.hypot(s[0],s[1],s[2]),o[1]=Math.hypot(a,d,h),o[2]=Math.hypot(m,_,b),o}function hr(o,s,a,d,h){var m,_=1/Math.tan(s/2);return o[0]=_/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=h&&h!==1/0?(o[10]=(h+d)*(m=1/(d-h)),o[14]=2*h*d*m):(o[10]=-1,o[14]=-2*d),o}function xr(o,s,a,d,h,m,_){var b=1/(s-a),T=1/(d-h),S=1/(m-_);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*S,o[11]=0,o[12]=(s+a)*b,o[13]=(h+d)*T,o[14]=(_+m)*S,o[15]=1,o}function Gi(o,s,a){return o[0]=s[0]-a[0],o[1]=s[1]-a[1],o[2]=s[2]-a[2],o[3]=s[3]-a[3],o[4]=s[4]-a[4],o[5]=s[5]-a[5],o[6]=s[6]-a[6],o[7]=s[7]-a[7],o[8]=s[8]-a[8],o[9]=s[9]-a[9],o[10]=s[10]-a[10],o[11]=s[11]-a[11],o[12]=s[12]-a[12],o[13]=s[13]-a[13],o[14]=s[14]-a[14],o[15]=s[15]-a[15],o}er.perspective=hr,er.ortho=xr,er.mul=yn,er.sub=Gi;var Cn={},Ln={};function os(o){return(os="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.create=Bu,Ln.clone=function(o){var s=new co.ARRAY_TYPE(3);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s},Ln.length=As,Ln.fromValues=function(o,s,a){var d=new co.ARRAY_TYPE(3);return d[0]=o,d[1]=s,d[2]=a,d},Ln.copy=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o},Ln.set=function(o,s,a,d){return o[0]=s,o[1]=a,o[2]=d,o},Ln.add=function(o,s,a){return o[0]=s[0]+a[0],o[1]=s[1]+a[1],o[2]=s[2]+a[2],o},Ln.subtract=sc,Ln.multiply=cs,Ln.divide=Uo,Ln.ceil=function(o,s){return o[0]=Math.ceil(s[0]),o[1]=Math.ceil(s[1]),o[2]=Math.ceil(s[2]),o},Ln.floor=function(o,s){return o[0]=Math.floor(s[0]),o[1]=Math.floor(s[1]),o[2]=Math.floor(s[2]),o},Ln.min=function(o,s,a){return o[0]=Math.min(s[0],a[0]),o[1]=Math.min(s[1],a[1]),o[2]=Math.min(s[2],a[2]),o},Ln.max=function(o,s,a){return o[0]=Math.max(s[0],a[0]),o[1]=Math.max(s[1],a[1]),o[2]=Math.max(s[2],a[2]),o},Ln.round=function(o,s){return o[0]=Math.round(s[0]),o[1]=Math.round(s[1]),o[2]=Math.round(s[2]),o},Ln.scale=function(o,s,a){return o[0]=s[0]*a,o[1]=s[1]*a,o[2]=s[2]*a,o},Ln.scaleAndAdd=function(o,s,a,d){return o[0]=s[0]+a[0]*d,o[1]=s[1]+a[1]*d,o[2]=s[2]+a[2]*d,o},Ln.distance=Sd,Ln.squaredDistance=qh,Ln.squaredLength=Dd,Ln.negate=function(o,s){return o[0]=-s[0],o[1]=-s[1],o[2]=-s[2],o},Ln.inverse=function(o,s){return o[0]=1/s[0],o[1]=1/s[1],o[2]=1/s[2],o},Ln.normalize=function(o,s){var a=s[0],d=s[1],h=s[2],m=a*a+d*d+h*h;return m>0&&(m=1/Math.sqrt(m)),o[0]=s[0]*m,o[1]=s[1]*m,o[2]=s[2]*m,o},Ln.dot=Md,Ln.cross=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=a[0],b=a[1],T=a[2];return o[0]=h*T-m*b,o[1]=m*_-d*T,o[2]=d*b-h*_,o},Ln.lerp=function(o,s,a,d){var h=s[0],m=s[1],_=s[2];return o[0]=h+d*(a[0]-h),o[1]=m+d*(a[1]-m),o[2]=_+d*(a[2]-_),o},Ln.hermite=function(o,s,a,d,h,m){var _=m*m,b=_*(2*m-3)+1,T=_*(m-2)+m,S=_*(m-1),A=_*(3-2*m);return o[0]=s[0]*b+a[0]*T+d[0]*S+h[0]*A,o[1]=s[1]*b+a[1]*T+d[1]*S+h[1]*A,o[2]=s[2]*b+a[2]*T+d[2]*S+h[2]*A,o},Ln.bezier=function(o,s,a,d,h,m){var _=1-m,b=_*_,T=m*m,S=b*_,A=3*m*b,k=3*T*_,N=T*m;return o[0]=s[0]*S+a[0]*A+d[0]*k+h[0]*N,o[1]=s[1]*S+a[1]*A+d[1]*k+h[1]*N,o[2]=s[2]*S+a[2]*A+d[2]*k+h[2]*N,o},Ln.random=function(o,s){s=s||1;var a=2*co.RANDOM()*Math.PI,d=2*co.RANDOM()-1,h=Math.sqrt(1-d*d)*s;return o[0]=Math.cos(a)*h,o[1]=Math.sin(a)*h,o[2]=d*s,o},Ln.transformMat4=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=a[3]*d+a[7]*h+a[11]*m+a[15];return o[0]=(a[0]*d+a[4]*h+a[8]*m+a[12])/(_=_||1),o[1]=(a[1]*d+a[5]*h+a[9]*m+a[13])/_,o[2]=(a[2]*d+a[6]*h+a[10]*m+a[14])/_,o},Ln.transformMat3=function(o,s,a){var d=s[0],h=s[1],m=s[2];return o[0]=d*a[0]+h*a[3]+m*a[6],o[1]=d*a[1]+h*a[4]+m*a[7],o[2]=d*a[2]+h*a[5]+m*a[8],o},Ln.transformQuat=function(o,s,a){var d=a[0],h=a[1],m=a[2],_=s[0],b=s[1],T=s[2],S=h*T-m*b,A=m*_-d*T,k=d*b-h*_,N=h*k-m*A,z=m*S-d*k,H=d*A-h*S,q=2*a[3];return A*=q,k*=q,z*=2,H*=2,o[0]=_+(S*=q)+(N*=2),o[1]=b+A+z,o[2]=T+k+H,o},Ln.rotateX=function(o,s,a,d){var h=[],m=[];return h[0]=s[0]-a[0],h[1]=s[1]-a[1],h[2]=s[2]-a[2],m[0]=h[0],m[1]=h[1]*Math.cos(d)-h[2]*Math.sin(d),m[2]=h[1]*Math.sin(d)+h[2]*Math.cos(d),o[0]=m[0]+a[0],o[1]=m[1]+a[1],o[2]=m[2]+a[2],o},Ln.rotateY=function(o,s,a,d){var h=[],m=[];return h[0]=s[0]-a[0],h[1]=s[1]-a[1],h[2]=s[2]-a[2],m[0]=h[2]*Math.sin(d)+h[0]*Math.cos(d),m[1]=h[1],m[2]=h[2]*Math.cos(d)-h[0]*Math.sin(d),o[0]=m[0]+a[0],o[1]=m[1]+a[1],o[2]=m[2]+a[2],o},Ln.rotateZ=function(o,s,a,d){var h=[],m=[];return h[0]=s[0]-a[0],h[1]=s[1]-a[1],h[2]=s[2]-a[2],m[0]=h[0]*Math.cos(d)-h[1]*Math.sin(d),m[1]=h[0]*Math.sin(d)+h[1]*Math.cos(d),m[2]=h[2],o[0]=m[0]+a[0],o[1]=m[1]+a[1],o[2]=m[2]+a[2],o},Ln.angle=function(o,s){var a=o[0],d=o[1],h=o[2],m=s[0],_=s[1],b=s[2],T=Math.sqrt(a*a+d*d+h*h)*Math.sqrt(m*m+_*_+b*b),S=T&&Md(o,s)/T;return Math.acos(Math.min(Math.max(S,-1),1))},Ln.zero=function(o){return o[0]=0,o[1]=0,o[2]=0,o},Ln.str=function(o){return"vec3("+o[0]+", "+o[1]+", "+o[2]+")"},Ln.exactEquals=function(o,s){return o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]},Ln.equals=function(o,s){var a=o[0],d=o[1],h=o[2],m=s[0],_=s[1],b=s[2];return Math.abs(a-m)<=co.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(d-_)<=co.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(h-b)<=co.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))},Ln.forEach=Ln.sqrLen=Ln.len=Ln.sqrDist=Ln.dist=Ln.div=Ln.mul=Ln.sub=void 0;var co=function(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==os(o)&&"function"!=typeof o)return{default:o};var a=Qa(void 0);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}(Oi);function Qa(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(Qa=function(d){return d?a:s})(o)}function Bu(){var o=new co.ARRAY_TYPE(3);return co.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function As(o){return Math.hypot(o[0],o[1],o[2])}function sc(o,s,a){return o[0]=s[0]-a[0],o[1]=s[1]-a[1],o[2]=s[2]-a[2],o}function cs(o,s,a){return o[0]=s[0]*a[0],o[1]=s[1]*a[1],o[2]=s[2]*a[2],o}function Uo(o,s,a){return o[0]=s[0]/a[0],o[1]=s[1]/a[1],o[2]=s[2]/a[2],o}function Sd(o,s){return Math.hypot(s[0]-o[0],s[1]-o[1],s[2]-o[2])}function qh(o,s){var a=s[0]-o[0],d=s[1]-o[1],h=s[2]-o[2];return a*a+d*d+h*h}function Dd(o){var s=o[0],a=o[1],d=o[2];return s*s+a*a+d*d}function Md(o,s){return o[0]*s[0]+o[1]*s[1]+o[2]*s[2]}Ln.sub=sc,Ln.mul=cs,Ln.div=Uo,Ln.dist=Sd,Ln.sqrDist=qh,Ln.len=As,Ln.sqrLen=Dd;var Vo,jo=(Vo=Bu(),function(o,s,a,d,h,m){var _,b;for(s||(s=3),a||(a=0),b=d?Math.min(d*s+a,o.length):o.length,_=a;_<b;_+=s)Vo[0]=o[_],Vo[1]=o[_+1],Vo[2]=o[_+2],h(Vo,Vo,m),o[_]=Vo[0],o[_+1]=Vo[1],o[_+2]=Vo[2];return o});Ln.forEach=jo;var cr={};function Ad(o){return(Ad="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}Object.defineProperty(cr,"__esModule",{value:!0}),cr.create=Zh,cr.clone=function(o){var s=new Ma.ARRAY_TYPE(4);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s},cr.fromValues=function(o,s,a,d){var h=new Ma.ARRAY_TYPE(4);return h[0]=o,h[1]=s,h[2]=a,h[3]=d,h},cr.copy=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o},cr.set=function(o,s,a,d,h){return o[0]=s,o[1]=a,o[2]=d,o[3]=h,o},cr.add=function(o,s,a){return o[0]=s[0]+a[0],o[1]=s[1]+a[1],o[2]=s[2]+a[2],o[3]=s[3]+a[3],o},cr.subtract=ul,cr.multiply=zu,cr.divide=mm,cr.ceil=function(o,s){return o[0]=Math.ceil(s[0]),o[1]=Math.ceil(s[1]),o[2]=Math.ceil(s[2]),o[3]=Math.ceil(s[3]),o},cr.floor=function(o,s){return o[0]=Math.floor(s[0]),o[1]=Math.floor(s[1]),o[2]=Math.floor(s[2]),o[3]=Math.floor(s[3]),o},cr.min=function(o,s,a){return o[0]=Math.min(s[0],a[0]),o[1]=Math.min(s[1],a[1]),o[2]=Math.min(s[2],a[2]),o[3]=Math.min(s[3],a[3]),o},cr.max=function(o,s,a){return o[0]=Math.max(s[0],a[0]),o[1]=Math.max(s[1],a[1]),o[2]=Math.max(s[2],a[2]),o[3]=Math.max(s[3],a[3]),o},cr.round=function(o,s){return o[0]=Math.round(s[0]),o[1]=Math.round(s[1]),o[2]=Math.round(s[2]),o[3]=Math.round(s[3]),o},cr.scale=function(o,s,a){return o[0]=s[0]*a,o[1]=s[1]*a,o[2]=s[2]*a,o[3]=s[3]*a,o},cr.scaleAndAdd=function(o,s,a,d){return o[0]=s[0]+a[0]*d,o[1]=s[1]+a[1]*d,o[2]=s[2]+a[2]*d,o[3]=s[3]+a[3]*d,o},cr.distance=Id,cr.squaredDistance=Xh,cr.length=kd,cr.squaredLength=dl,cr.negate=function(o,s){return o[0]=-s[0],o[1]=-s[1],o[2]=-s[2],o[3]=-s[3],o},cr.inverse=function(o,s){return o[0]=1/s[0],o[1]=1/s[1],o[2]=1/s[2],o[3]=1/s[3],o},cr.normalize=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=a*a+d*d+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),o[0]=a*_,o[1]=d*_,o[2]=h*_,o[3]=m*_,o},cr.dot=function(o,s){return o[0]*s[0]+o[1]*s[1]+o[2]*s[2]+o[3]*s[3]},cr.cross=function(o,s,a,d){var h=a[0]*d[1]-a[1]*d[0],m=a[0]*d[2]-a[2]*d[0],_=a[0]*d[3]-a[3]*d[0],b=a[1]*d[2]-a[2]*d[1],T=a[1]*d[3]-a[3]*d[1],S=a[2]*d[3]-a[3]*d[2],A=s[0],k=s[1],N=s[2],z=s[3];return o[0]=k*S-N*T+z*b,o[1]=-A*S+N*_-z*m,o[2]=A*T-k*_+z*h,o[3]=-A*b+k*m-N*h,o},cr.lerp=function(o,s,a,d){var h=s[0],m=s[1],_=s[2],b=s[3];return o[0]=h+d*(a[0]-h),o[1]=m+d*(a[1]-m),o[2]=_+d*(a[2]-_),o[3]=b+d*(a[3]-b),o},cr.random=function(o,s){var a,d,h,m,_,b;s=s||1;do{_=(a=2*Ma.RANDOM()-1)*a+(d=2*Ma.RANDOM()-1)*d}while(_>=1);do{b=(h=2*Ma.RANDOM()-1)*h+(m=2*Ma.RANDOM()-1)*m}while(b>=1);var T=Math.sqrt((1-_)/b);return o[0]=s*a,o[1]=s*d,o[2]=s*h*T,o[3]=s*m*T,o},cr.transformMat4=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3];return o[0]=a[0]*d+a[4]*h+a[8]*m+a[12]*_,o[1]=a[1]*d+a[5]*h+a[9]*m+a[13]*_,o[2]=a[2]*d+a[6]*h+a[10]*m+a[14]*_,o[3]=a[3]*d+a[7]*h+a[11]*m+a[15]*_,o},cr.transformQuat=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=a[0],b=a[1],T=a[2],S=a[3],A=S*d+b*m-T*h,k=S*h+T*d-_*m,N=S*m+_*h-b*d,z=-_*d-b*h-T*m;return o[0]=A*S+z*-_+k*-T-N*-b,o[1]=k*S+z*-b+N*-_-A*-T,o[2]=N*S+z*-T+A*-b-k*-_,o[3]=s[3],o},cr.zero=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=0,o},cr.str=function(o){return"vec4("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},cr.exactEquals=function(o,s){return o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]&&o[3]===s[3]},cr.equals=function(o,s){var a=o[0],d=o[1],h=o[2],m=o[3],_=s[0],b=s[1],T=s[2],S=s[3];return Math.abs(a-_)<=Ma.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(d-b)<=Ma.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))&&Math.abs(h-T)<=Ma.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(m-S)<=Ma.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},cr.forEach=cr.sqrLen=cr.len=cr.sqrDist=cr.dist=cr.div=cr.mul=cr.sub=void 0;var Ma=function(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==Ad(o)&&"function"!=typeof o)return{default:o};var a=zl(void 0);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}(Oi);function zl(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(zl=function(d){return d?a:s})(o)}function Zh(){var o=new Ma.ARRAY_TYPE(4);return Ma.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function ul(o,s,a){return o[0]=s[0]-a[0],o[1]=s[1]-a[1],o[2]=s[2]-a[2],o[3]=s[3]-a[3],o}function zu(o,s,a){return o[0]=s[0]*a[0],o[1]=s[1]*a[1],o[2]=s[2]*a[2],o[3]=s[3]*a[3],o}function mm(o,s,a){return o[0]=s[0]/a[0],o[1]=s[1]/a[1],o[2]=s[2]/a[2],o[3]=s[3]/a[3],o}function Id(o,s){return Math.hypot(s[0]-o[0],s[1]-o[1],s[2]-o[2],s[3]-o[3])}function Xh(o,s){var a=s[0]-o[0],d=s[1]-o[1],h=s[2]-o[2],m=s[3]-o[3];return a*a+d*d+h*h+m*m}function kd(o){return Math.hypot(o[0],o[1],o[2],o[3])}function dl(o){var s=o[0],a=o[1],d=o[2],h=o[3];return s*s+a*a+d*d+h*h}cr.sub=ul,cr.mul=zu,cr.div=mm,cr.dist=Id,cr.sqrDist=Xh,cr.len=kd,cr.sqrLen=dl;var o,Od=(o=Zh(),function(s,a,d,h,m,_){var b,T;for(a||(a=4),d||(d=0),T=h?Math.min(h*a+d,s.length):s.length,b=d;b<T;b+=a)o[0]=s[b],o[1]=s[b+1],o[2]=s[b+2],o[3]=s[b+3],m(o,o,_),s[b]=o[0],s[b+1]=o[1],s[b+2]=o[2],s[b+3]=o[3];return s});function Yh(o){return(Yh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}cr.forEach=Od,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.create=Kh,Cn.identity=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o},Cn.setAxisAngle=Hi,Cn.getAxisAngle=function(o,s){var a=2*Math.acos(s[3]),d=Math.sin(a/2);return d>Di.EPSILON?(o[0]=s[0]/d,o[1]=s[1]/d,o[2]=s[2]/d):(o[0]=1,o[1]=0,o[2]=0),a},Cn.getAngle=function(o,s){var a=Ee(o,s);return Math.acos(2*a*a-1)},Cn.multiply=Kf,Cn.rotateX=function(o,s,a){a*=.5;var d=s[0],h=s[1],m=s[2],_=s[3],b=Math.sin(a),T=Math.cos(a);return o[0]=d*T+_*b,o[1]=h*T+m*b,o[2]=m*T-h*b,o[3]=_*T-d*b,o},Cn.rotateY=function(o,s,a){a*=.5;var d=s[0],h=s[1],m=s[2],_=s[3],b=Math.sin(a),T=Math.cos(a);return o[0]=d*T-m*b,o[1]=h*T+_*b,o[2]=m*T+d*b,o[3]=_*T-h*b,o},Cn.rotateZ=function(o,s,a){a*=.5;var d=s[0],h=s[1],m=s[2],_=s[3],b=Math.sin(a),T=Math.cos(a);return o[0]=d*T+h*b,o[1]=h*T-d*b,o[2]=m*T+_*b,o[3]=_*T-m*b,o},Cn.calculateW=function(o,s){var a=s[0],d=s[1],h=s[2];return o[0]=a,o[1]=d,o[2]=h,o[3]=Math.sqrt(Math.abs(1-a*a-d*d-h*h)),o},Cn.exp=Ie,Cn.ln=te,Cn.pow=function(o,s,a){return te(o,s),ke(o,o,a),Ie(o,o),o},Cn.slerp=oe,Cn.random=function(o){var s=Di.RANDOM(),a=Di.RANDOM(),d=Di.RANDOM(),h=Math.sqrt(1-s),m=Math.sqrt(s);return o[0]=h*Math.sin(2*Math.PI*a),o[1]=h*Math.cos(2*Math.PI*a),o[2]=m*Math.sin(2*Math.PI*d),o[3]=m*Math.cos(2*Math.PI*d),o},Cn.invert=function(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=a*a+d*d+h*h+m*m,b=_?1/_:0;return o[0]=-a*b,o[1]=-d*b,o[2]=-h*b,o[3]=m*b,o},Cn.conjugate=function(o,s){return o[0]=-s[0],o[1]=-s[1],o[2]=-s[2],o[3]=s[3],o},Cn.fromMat3=pe,Cn.fromEuler=function(o,s,a,d){var h=.5*Math.PI/180;s*=h,a*=h,d*=h;var m=Math.sin(s),_=Math.cos(s),b=Math.sin(a),T=Math.cos(a),S=Math.sin(d),A=Math.cos(d);return o[0]=m*T*A-_*b*S,o[1]=_*b*A+m*T*S,o[2]=_*T*S-m*b*A,o[3]=_*T*A+m*b*S,o},Cn.str=function(o){return"quat("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},Cn.setAxes=Cn.sqlerp=Cn.rotationTo=Cn.equals=Cn.exactEquals=Cn.normalize=Cn.sqrLen=Cn.squaredLength=Cn.len=Cn.length=Cn.lerp=Cn.dot=Cn.scale=Cn.mul=Cn.add=Cn.set=Cn.copy=Cn.fromValues=Cn.clone=void 0;var Di=Mi(Oi),Kg=Mi(ai),oc=Mi(Ln),$o=Mi(cr);function gm(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(gm=function(d){return d?a:s})(o)}function Mi(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==Yh(o)&&"function"!=typeof o)return{default:o};var a=gm(s);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}function Kh(){var o=new Di.ARRAY_TYPE(4);return Di.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Hi(o,s,a){a*=.5;var d=Math.sin(a);return o[0]=d*s[0],o[1]=d*s[1],o[2]=d*s[2],o[3]=Math.cos(a),o}function Kf(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=a[0],T=a[1],S=a[2],A=a[3];return o[0]=d*A+_*b+h*S-m*T,o[1]=h*A+_*T+m*b-d*S,o[2]=m*A+_*S+d*T-h*b,o[3]=_*A-d*b-h*T-m*S,o}function Ie(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=Math.sqrt(a*a+d*d+h*h),b=Math.exp(m),T=_>0?b*Math.sin(_)/_:0;return o[0]=a*T,o[1]=d*T,o[2]=h*T,o[3]=b*Math.cos(_),o}function te(o,s){var a=s[0],d=s[1],h=s[2],m=s[3],_=Math.sqrt(a*a+d*d+h*h),b=_>0?Math.atan2(_,m)/_:0;return o[0]=a*b,o[1]=d*b,o[2]=h*b,o[3]=.5*Math.log(a*a+d*d+h*h+m*m),o}function oe(o,s,a,d){var h,m,_,b,T,S=s[0],A=s[1],k=s[2],N=s[3],z=a[0],H=a[1],q=a[2],X=a[3];return(m=S*z+A*H+k*q+N*X)<0&&(m=-m,z=-z,H=-H,q=-q,X=-X),1-m>Di.EPSILON?(h=Math.acos(m),_=Math.sin(h),b=Math.sin((1-d)*h)/_,T=Math.sin(d*h)/_):(b=1-d,T=d),o[0]=b*S+T*z,o[1]=b*A+T*H,o[2]=b*k+T*q,o[3]=b*N+T*X,o}function pe(o,s){var a,d=s[0]+s[4]+s[8];if(d>0)a=Math.sqrt(d+1),o[3]=.5*a,o[0]=(s[5]-s[7])*(a=.5/a),o[1]=(s[6]-s[2])*a,o[2]=(s[1]-s[3])*a;else{var h=0;s[4]>s[0]&&(h=1),s[8]>s[3*h+h]&&(h=2);var m=(h+1)%3,_=(h+2)%3;a=Math.sqrt(s[3*h+h]-s[3*m+m]-s[3*_+_]+1),o[h]=.5*a,o[3]=(s[3*m+_]-s[3*_+m])*(a=.5/a),o[m]=(s[3*m+h]+s[3*h+m])*a,o[_]=(s[3*_+h]+s[3*h+_])*a}return o}Cn.clone=$o.clone,Cn.fromValues=$o.fromValues,Cn.copy=$o.copy,Cn.set=$o.set,Cn.add=$o.add,Cn.mul=Kf;var ke=$o.scale;Cn.scale=ke;var Ee=$o.dot;Cn.dot=Ee,Cn.lerp=$o.lerp;var We=$o.length;Cn.length=We,Cn.len=We;var lt=$o.squaredLength;Cn.squaredLength=lt,Cn.sqrLen=lt;var $e=$o.normalize;Cn.normalize=$e,Cn.exactEquals=$o.exactEquals,Cn.equals=$o.equals;var it,Pt,Ot,un=(it=oc.create(),Pt=oc.fromValues(1,0,0),Ot=oc.fromValues(0,1,0),function(o,s,a){var d=oc.dot(s,a);return d<-.999999?(oc.cross(it,Pt,s),oc.len(it)<1e-6&&oc.cross(it,Ot,s),oc.normalize(it,it),Hi(o,it,Math.PI),o):d>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(oc.cross(it,s,a),o[0]=it[0],o[1]=it[1],o[2]=it[2],o[3]=1+d,$e(o,o))});Cn.rotationTo=un;var Yt,Jn,Xr=(Yt=Kh(),Jn=Kh(),function(o,s,a,d,h,m){return oe(Yt,s,h,m),oe(Jn,a,d,m),oe(o,Yt,Jn,2*m*(1-m)),o});Cn.sqlerp=Xr;var pr,Gr=(pr=Kg.create(),function(o,s,a,d){return pr[0]=a[0],pr[3]=a[1],pr[6]=a[2],pr[1]=d[0],pr[4]=d[1],pr[7]=d[2],pr[2]=-s[0],pr[5]=-s[1],pr[8]=-s[2],$e(o,pe(o,pr))});Cn.setAxes=Gr;var Dn={};function es(o){return(es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.create=function(){var o=new Qr.ARRAY_TYPE(8);return Qr.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[4]=0,o[5]=0,o[6]=0,o[7]=0),o[3]=1,o},Dn.clone=function(o){var s=new Qr.ARRAY_TYPE(8);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s[4]=o[4],s[5]=o[5],s[6]=o[6],s[7]=o[7],s},Dn.fromValues=function(o,s,a,d,h,m,_,b){var T=new Qr.ARRAY_TYPE(8);return T[0]=o,T[1]=s,T[2]=a,T[3]=d,T[4]=h,T[5]=m,T[6]=_,T[7]=b,T},Dn.fromRotationTranslationValues=function(o,s,a,d,h,m,_){var b=new Qr.ARRAY_TYPE(8);b[0]=o,b[1]=s,b[2]=a,b[3]=d;var T=.5*h,S=.5*m,A=.5*_;return b[4]=T*d+S*a-A*s,b[5]=S*d+A*o-T*a,b[6]=A*d+T*s-S*o,b[7]=-T*o-S*s-A*a,b},Dn.fromRotationTranslation=aa,Dn.fromTranslation=function(o,s){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=.5*s[0],o[5]=.5*s[1],o[6]=.5*s[2],o[7]=0,o},Dn.fromRotation=function(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o[4]=0,o[5]=0,o[6]=0,o[7]=0,o},Dn.fromMat4=function(o,s){var a=Wr.create();Ws.getRotation(a,s);var d=new Qr.ARRAY_TYPE(3);return Ws.getTranslation(d,s),aa(o,a,d),o},Dn.copy=Aa,Dn.identity=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=0,o[5]=0,o[6]=0,o[7]=0,o},Dn.set=function(o,s,a,d,h,m,_,b,T){return o[0]=s,o[1]=a,o[2]=d,o[3]=h,o[4]=m,o[5]=_,o[6]=b,o[7]=T,o},Dn.getDual=function(o,s){return o[0]=s[4],o[1]=s[5],o[2]=s[6],o[3]=s[7],o},Dn.setDual=function(o,s){return o[4]=s[0],o[5]=s[1],o[6]=s[2],o[7]=s[3],o},Dn.getTranslation=function(o,s){var a=s[4],d=s[5],h=s[6],m=s[7],_=-s[0],b=-s[1],T=-s[2],S=s[3];return o[0]=2*(a*S+m*_+d*T-h*b),o[1]=2*(d*S+m*b+h*_-a*T),o[2]=2*(h*S+m*T+a*b-d*_),o},Dn.translate=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=.5*a[0],T=.5*a[1],S=.5*a[2],A=s[4],k=s[5],N=s[6],z=s[7];return o[0]=d,o[1]=h,o[2]=m,o[3]=_,o[4]=_*b+h*S-m*T+A,o[5]=_*T+m*b-d*S+k,o[6]=_*S+d*T-h*b+N,o[7]=-d*b-h*T-m*S+z,o},Dn.rotateX=function(o,s,a){var d=-s[0],h=-s[1],m=-s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=b*_+A*d+T*m-S*h,N=T*_+A*h+S*d-b*m,z=S*_+A*m+b*h-T*d,H=A*_-b*d-T*h-S*m;return Wr.rotateX(o,s,a),o[4]=k*(_=o[3])+H*(d=o[0])+N*(m=o[2])-z*(h=o[1]),o[5]=N*_+H*h+z*d-k*m,o[6]=z*_+H*m+k*h-N*d,o[7]=H*_-k*d-N*h-z*m,o},Dn.rotateY=function(o,s,a){var d=-s[0],h=-s[1],m=-s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=b*_+A*d+T*m-S*h,N=T*_+A*h+S*d-b*m,z=S*_+A*m+b*h-T*d,H=A*_-b*d-T*h-S*m;return Wr.rotateY(o,s,a),o[4]=k*(_=o[3])+H*(d=o[0])+N*(m=o[2])-z*(h=o[1]),o[5]=N*_+H*h+z*d-k*m,o[6]=z*_+H*m+k*h-N*d,o[7]=H*_-k*d-N*h-z*m,o},Dn.rotateZ=function(o,s,a){var d=-s[0],h=-s[1],m=-s[2],_=s[3],b=s[4],T=s[5],S=s[6],A=s[7],k=b*_+A*d+T*m-S*h,N=T*_+A*h+S*d-b*m,z=S*_+A*m+b*h-T*d,H=A*_-b*d-T*h-S*m;return Wr.rotateZ(o,s,a),o[4]=k*(_=o[3])+H*(d=o[0])+N*(m=o[2])-z*(h=o[1]),o[5]=N*_+H*h+z*d-k*m,o[6]=z*_+H*m+k*h-N*d,o[7]=H*_-k*d-N*h-z*m,o},Dn.rotateByQuatAppend=function(o,s,a){var d=a[0],h=a[1],m=a[2],_=a[3],b=s[0],T=s[1],S=s[2],A=s[3];return o[0]=b*_+A*d+T*m-S*h,o[1]=T*_+A*h+S*d-b*m,o[2]=S*_+A*m+b*h-T*d,o[3]=A*_-b*d-T*h-S*m,o[4]=(b=s[4])*_+(A=s[7])*d+(T=s[5])*m-(S=s[6])*h,o[5]=T*_+A*h+S*d-b*m,o[6]=S*_+A*m+b*h-T*d,o[7]=A*_-b*d-T*h-S*m,o},Dn.rotateByQuatPrepend=function(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=a[0],T=a[1],S=a[2],A=a[3];return o[0]=d*A+_*b+h*S-m*T,o[1]=h*A+_*T+m*b-d*S,o[2]=m*A+_*S+d*T-h*b,o[3]=_*A-d*b-h*T-m*S,o[4]=d*(A=a[7])+_*(b=a[4])+h*(S=a[6])-m*(T=a[5]),o[5]=h*A+_*T+m*b-d*S,o[6]=m*A+_*S+d*T-h*b,o[7]=_*A-d*b-h*T-m*S,o},Dn.rotateAroundAxis=function(o,s,a,d){if(Math.abs(d)<Qr.EPSILON)return Aa(o,s);var h=Math.hypot(a[0],a[1],a[2]);d*=.5;var m=Math.sin(d),_=m*a[0]/h,b=m*a[1]/h,T=m*a[2]/h,S=Math.cos(d),A=s[0],k=s[1],N=s[2],z=s[3];o[0]=A*S+z*_+k*T-N*b,o[1]=k*S+z*b+N*_-A*T,o[2]=N*S+z*T+A*b-k*_,o[3]=z*S-A*_-k*b-N*T;var H=s[4],q=s[5],X=s[6],ee=s[7];return o[4]=H*S+ee*_+q*T-X*b,o[5]=q*S+ee*b+X*_-H*T,o[6]=X*S+ee*T+H*b-q*_,o[7]=ee*S-H*_-q*b-X*T,o},Dn.add=function(o,s,a){return o[0]=s[0]+a[0],o[1]=s[1]+a[1],o[2]=s[2]+a[2],o[3]=s[3]+a[3],o[4]=s[4]+a[4],o[5]=s[5]+a[5],o[6]=s[6]+a[6],o[7]=s[7]+a[7],o},Dn.multiply=Jf,Dn.scale=function(o,s,a){return o[0]=s[0]*a,o[1]=s[1]*a,o[2]=s[2]*a,o[3]=s[3]*a,o[4]=s[4]*a,o[5]=s[5]*a,o[6]=s[6]*a,o[7]=s[7]*a,o},Dn.lerp=function(o,s,a,d){var h=1-d;return y1(s,a)<0&&(d=-d),o[0]=s[0]*h+a[0]*d,o[1]=s[1]*h+a[1]*d,o[2]=s[2]*h+a[2]*d,o[3]=s[3]*h+a[3]*d,o[4]=s[4]*h+a[4]*d,o[5]=s[5]*h+a[5]*d,o[6]=s[6]*h+a[6]*d,o[7]=s[7]*h+a[7]*d,o},Dn.invert=function(o,s){var a=Jh(s);return o[0]=-s[0]/a,o[1]=-s[1]/a,o[2]=-s[2]/a,o[3]=s[3]/a,o[4]=-s[4]/a,o[5]=-s[5]/a,o[6]=-s[6]/a,o[7]=s[7]/a,o},Dn.conjugate=function(o,s){return o[0]=-s[0],o[1]=-s[1],o[2]=-s[2],o[3]=s[3],o[4]=-s[4],o[5]=-s[5],o[6]=-s[6],o[7]=s[7],o},Dn.normalize=function(o,s){var a=Jh(s);if(a>0){a=Math.sqrt(a);var d=s[0]/a,h=s[1]/a,m=s[2]/a,_=s[3]/a,b=s[4],T=s[5],S=s[6],A=s[7],k=d*b+h*T+m*S+_*A;o[0]=d,o[1]=h,o[2]=m,o[3]=_,o[4]=(b-d*k)/a,o[5]=(T-h*k)/a,o[6]=(S-m*k)/a,o[7]=(A-_*k)/a}return o},Dn.str=function(o){return"quat2("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+")"},Dn.exactEquals=function(o,s){return o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]&&o[3]===s[3]&&o[4]===s[4]&&o[5]===s[5]&&o[6]===s[6]&&o[7]===s[7]},Dn.equals=function(o,s){var a=o[0],d=o[1],h=o[2],m=o[3],_=o[4],b=o[5],T=o[6],S=o[7],A=s[0],k=s[1],N=s[2],z=s[3],H=s[4],q=s[5],X=s[6],ee=s[7];return Math.abs(a-A)<=Qr.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(d-k)<=Qr.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(h-N)<=Qr.EPSILON*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(m-z)<=Qr.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(_-H)<=Qr.EPSILON*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(b-q)<=Qr.EPSILON*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(T-X)<=Qr.EPSILON*Math.max(1,Math.abs(T),Math.abs(X))&&Math.abs(S-ee)<=Qr.EPSILON*Math.max(1,Math.abs(S),Math.abs(ee))},Dn.sqrLen=Dn.squaredLength=Dn.len=Dn.length=Dn.dot=Dn.mul=Dn.setReal=Dn.getReal=void 0;var Qr=Ao(Oi),Wr=Ao(Cn),Ws=Ao(er);function ei(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(ei=function(d){return d?a:s})(o)}function Ao(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==es(o)&&"function"!=typeof o)return{default:o};var a=ei(s);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}function aa(o,s,a){var d=.5*a[0],h=.5*a[1],m=.5*a[2],_=s[0],b=s[1],T=s[2],S=s[3];return o[0]=_,o[1]=b,o[2]=T,o[3]=S,o[4]=d*S+h*T-m*b,o[5]=h*S+m*_-d*T,o[6]=m*S+d*b-h*_,o[7]=-d*_-h*b-m*T,o}function Aa(o,s){return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o[4]=s[4],o[5]=s[5],o[6]=s[6],o[7]=s[7],o}function Jf(o,s,a){var d=s[0],h=s[1],m=s[2],_=s[3],b=a[4],T=a[5],S=a[6],A=a[7],k=s[4],N=s[5],z=s[6],H=s[7],q=a[0],X=a[1],ee=a[2],de=a[3];return o[0]=d*de+_*q+h*ee-m*X,o[1]=h*de+_*X+m*q-d*ee,o[2]=m*de+_*ee+d*X-h*q,o[3]=_*de-d*q-h*X-m*ee,o[4]=d*A+_*b+h*S-m*T+k*de+H*q+N*ee-z*X,o[5]=h*A+_*T+m*b-d*S+N*de+H*X+z*q-k*ee,o[6]=m*A+_*S+d*T-h*b+z*de+H*ee+k*X-N*q,o[7]=_*A-d*b-h*T-m*S+H*de-k*q-N*X-z*ee,o}Dn.getReal=Wr.copy,Dn.setReal=Wr.copy,Dn.mul=Jf;var y1=Wr.dot;Dn.dot=y1;var _m=Wr.length;Dn.length=_m,Dn.len=_m;var Jh=Wr.squaredLength;Dn.squaredLength=Jh,Dn.sqrLen=Jh;var wr={};function Jg(o){return(Jg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}Object.defineProperty(wr,"__esModule",{value:!0}),wr.create=px,wr.clone=function(o){var s=new Pd.ARRAY_TYPE(2);return s[0]=o[0],s[1]=o[1],s},wr.fromValues=function(o,s){var a=new Pd.ARRAY_TYPE(2);return a[0]=o,a[1]=s,a},wr.copy=function(o,s){return o[0]=s[0],o[1]=s[1],o},wr.set=function(o,s,a){return o[0]=s,o[1]=a,o},wr.add=function(o,s,a){return o[0]=s[0]+a[0],o[1]=s[1]+a[1],o},wr.subtract=v1,wr.multiply=x1,wr.divide=mx,wr.ceil=function(o,s){return o[0]=Math.ceil(s[0]),o[1]=Math.ceil(s[1]),o},wr.floor=function(o,s){return o[0]=Math.floor(s[0]),o[1]=Math.floor(s[1]),o},wr.min=function(o,s,a){return o[0]=Math.min(s[0],a[0]),o[1]=Math.min(s[1],a[1]),o},wr.max=function(o,s,a){return o[0]=Math.max(s[0],a[0]),o[1]=Math.max(s[1],a[1]),o},wr.round=function(o,s){return o[0]=Math.round(s[0]),o[1]=Math.round(s[1]),o},wr.scale=function(o,s,a){return o[0]=s[0]*a,o[1]=s[1]*a,o},wr.scaleAndAdd=function(o,s,a,d){return o[0]=s[0]+a[0]*d,o[1]=s[1]+a[1]*d,o},wr.distance=gx,wr.squaredDistance=b1,wr.length=ym,wr.squaredLength=vm,wr.negate=function(o,s){return o[0]=-s[0],o[1]=-s[1],o},wr.inverse=function(o,s){return o[0]=1/s[0],o[1]=1/s[1],o},wr.normalize=function(o,s){var a=s[0],d=s[1],h=a*a+d*d;return h>0&&(h=1/Math.sqrt(h)),o[0]=s[0]*h,o[1]=s[1]*h,o},wr.dot=function(o,s){return o[0]*s[0]+o[1]*s[1]},wr.cross=function(o,s,a){var d=s[0]*a[1]-s[1]*a[0];return o[0]=o[1]=0,o[2]=d,o},wr.lerp=function(o,s,a,d){var h=s[0],m=s[1];return o[0]=h+d*(a[0]-h),o[1]=m+d*(a[1]-m),o},wr.random=function(o,s){s=s||1;var a=2*Pd.RANDOM()*Math.PI;return o[0]=Math.cos(a)*s,o[1]=Math.sin(a)*s,o},wr.transformMat2=function(o,s,a){var d=s[0],h=s[1];return o[0]=a[0]*d+a[2]*h,o[1]=a[1]*d+a[3]*h,o},wr.transformMat2d=function(o,s,a){var d=s[0],h=s[1];return o[0]=a[0]*d+a[2]*h+a[4],o[1]=a[1]*d+a[3]*h+a[5],o},wr.transformMat3=function(o,s,a){var d=s[0],h=s[1];return o[0]=a[0]*d+a[3]*h+a[6],o[1]=a[1]*d+a[4]*h+a[7],o},wr.transformMat4=function(o,s,a){var d=s[0],h=s[1];return o[0]=a[0]*d+a[4]*h+a[12],o[1]=a[1]*d+a[5]*h+a[13],o},wr.rotate=function(o,s,a,d){var h=s[0]-a[0],m=s[1]-a[1],_=Math.sin(d),b=Math.cos(d);return o[0]=h*b-m*_+a[0],o[1]=h*_+m*b+a[1],o},wr.angle=function(o,s){var a=o[0],d=o[1],h=s[0],m=s[1],_=Math.sqrt(a*a+d*d)*Math.sqrt(h*h+m*m);return Math.acos(Math.min(Math.max(_&&(a*h+d*m)/_,-1),1))},wr.zero=function(o){return o[0]=0,o[1]=0,o},wr.str=function(o){return"vec2("+o[0]+", "+o[1]+")"},wr.exactEquals=function(o,s){return o[0]===s[0]&&o[1]===s[1]},wr.equals=function(o,s){var a=o[0],d=o[1],h=s[0],m=s[1];return Math.abs(a-h)<=Pd.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(d-m)<=Pd.EPSILON*Math.max(1,Math.abs(d),Math.abs(m))},wr.forEach=wr.sqrLen=wr.sqrDist=wr.dist=wr.div=wr.mul=wr.sub=wr.len=void 0;var Pd=function(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==Jg(o)&&"function"!=typeof o)return{default:o};var a=fx(void 0);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}(Oi);function fx(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(fx=function(d){return d?a:s})(o)}function px(){var o=new Pd.ARRAY_TYPE(2);return Pd.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0),o}function v1(o,s,a){return o[0]=s[0]-a[0],o[1]=s[1]-a[1],o}function x1(o,s,a){return o[0]=s[0]*a[0],o[1]=s[1]*a[1],o}function mx(o,s,a){return o[0]=s[0]/a[0],o[1]=s[1]/a[1],o}function gx(o,s){return Math.hypot(s[0]-o[0],s[1]-o[1])}function b1(o,s){var a=s[0]-o[0],d=s[1]-o[1];return a*a+d*d}function ym(o){return Math.hypot(o[0],o[1])}function vm(o){var s=o[0],a=o[1];return s*s+a*a}wr.len=ym,wr.sub=v1,wr.mul=x1,wr.div=mx,wr.dist=gx,wr.sqrDist=b1,wr.sqrLen=vm;var w1=function(){var o=px();return function(s,a,d,h,m,_){var b,T;for(a||(a=2),d||(d=0),T=h?Math.min(h*a+d,s.length):s.length,b=d;b<T;b+=a)o[0]=s[b],o[1]=s[b+1],m(o,o,_),s[b]=o[0],s[b+1]=o[1];return s}}();function Qg(o){return(Qg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}wr.forEach=w1,Object.defineProperty(Ni,"__esModule",{value:!0}),f.aB=Ni.vec4=f.$=Ni.vec3=Ni.vec2=Ni.quat2=f.aw=Ni.quat=f.ae=Ni.mat4=f.bE=Ni.mat3=Ni.mat2d=f.aD=Ni.mat2=Ni.glMatrix=void 0;var _x=Ul(Oi);Ni.glMatrix=_x;var yx=Ul(xi);f.aD=Ni.mat2=yx;var xm=Ul(mi);Ni.mat2d=xm;var Ur=Ul(ai);f.bE=Ni.mat3=Ur;var nT=Ul(er);f.ae=Ni.mat4=nT;var rT=Ul(Cn);f.aw=Ni.quat=rT;var vx=Ul(Dn);Ni.quat2=vx;var T1=Ul(wr);Ni.vec2=T1;var xx=Ul(Ln);f.$=Ni.vec3=xx;var E1=Ul(cr);function bm(o){if("function"!=typeof WeakMap)return null;var s=new WeakMap,a=new WeakMap;return(bm=function(d){return d?a:s})(o)}function Ul(o,s){if(o&&o.__esModule)return o;if(null===o||"object"!==Qg(o)&&"function"!=typeof o)return{default:o};var a=bm(s);if(a&&a.has(o))return a.get(o);var d={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=h?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(d,m,_):d[m]=o[m]}return d.default=o,a&&a.set(o,d),d}f.aB=Ni.vec4=E1;var bx=wx;function wx(o,s,a,d){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=s,this.p2x=a,this.p2y=d}wx.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,s){if(void 0===s&&(s=1e-6),o<0)return 0;if(o>1)return 1;for(var a=o,d=0;d<8;d++){var h=this.sampleCurveX(a)-o;if(Math.abs(h)<s)return a;var m=this.sampleCurveDerivativeX(a);if(Math.abs(m)<1e-6)break;a-=h/m}var _=0,b=1;for(a=o,d=0;d<20&&(h=this.sampleCurveX(a),!(Math.abs(h-o)<s));d++)o>h?_=a:b=a,a=.5*(b-_)+_;return a},solve:function(o,s){return this.sampleCurveY(this.solveCurveX(o,s))}};var Tx=sa(bx),wm=Qf;function Qf(o,s){this.x=o,this.y=s}Qf.prototype={clone:function(){return new Qf(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,s){return this.clone()._rotateAround(o,s)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var s=o.x-this.x,a=o.y-this.y;return s*s+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,s){return Math.atan2(this.x*s-this.y*o,this.x*o+this.y*s)},_matMult:function(o){var s=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=s,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var s=Math.cos(o),a=Math.sin(o),d=a*this.x+s*this.y;return this.x=s*this.x-a*this.y,this.y=d,this},_rotateAround:function(o,s){var a=Math.cos(o),d=Math.sin(o),h=s.y+d*(this.x-s.x)+a*(this.y-s.y);return this.x=s.x+a*(this.x-s.x)-d*(this.y-s.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qf.convert=function(o){return o instanceof Qf?o:Array.isArray(o)?new Qf(o[0],o[1]):o};var rn=sa(wm);function Vl(o,s){if(Array.isArray(o)){if(!Array.isArray(s)||o.length!==s.length)return!1;for(let a=0;a<o.length;a++)if(!Vl(o[a],s[a]))return!1;return!0}if("object"==typeof o&&null!==o&&null!==s){if("object"!=typeof s||Object.keys(o).length!==Object.keys(s).length)return!1;for(const a in o)if(!Vl(o[a],s[a]))return!1;return!0}return o===s}const C1=Math.PI/180,Uu=180/Math.PI;function kr(o){return o*C1}function Ia(o){return o*Uu}const ep=[[0,0],[1,0],[1,1],[0,1]];function Tm(o){if(o<=0)return 0;if(o>=1)return 1;const s=o*o,a=s*o;return 4*(o<.5?a:3*(o-s)+a-.75)}function e_(o,s,a,d){const h=new Tx(o,s,a,d);return function(m){return h.solve(m)}}const Pc=e_(.25,.1,.25,1);function Dr(o,s,a){return Math.min(a,Math.max(s,o))}function tp(o,s,a){return(a=Dr((a-o)/(s-o),0,1))*a*(3-2*a)}function Qh(o,s,a){const d=a-s,h=((o-s)%d+d)%d+s;return h===s?a:h}function ef(o,s,a){if(!o.length)return a(null,[]);let d=o.length;const h=new Array(o.length);let m=null;o.forEach((_,b)=>{s(_,(T,S)=>{T&&(m=T),h[b]=S,0==--d&&a(m,h)})})}function Ex(o){const s=[];for(const a in o)s.push(o[a]);return s}function bo(o,...s){for(const a of s)for(const d in a)o[d]=a[d];return o}let Cx=1;function t_(){return Cx++}function Em(){return function o(s){return s?(s^Math.random()*(16>>s/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function np(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function n_(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Cm(o,s){o.forEach(a=>{s[a]&&(s[a]=s[a].bind(s))})}function Sm(o,s){return-1!==o.indexOf(s,o.length-s.length)}function Dm(o,s,a){const d={};for(const h in o)d[h]=s.call(this,o[h],h,o);return d}function ka(o,s,a){const d={};for(const h in o)s.call(this,o[h],h,o)&&(d[h]=o[h]);return d}function la(o){return Array.isArray(o)?o.map(la):"object"==typeof o&&o?Dm(o,la):o}const ca={};function Ns(o){ca[o]||(typeof console<"u"&&console.warn(o),ca[o]=!0)}function Rd(o,s,a){return(a.y-o.y)*(s.x-o.x)>(s.y-o.y)*(a.x-o.x)}function iT(o){let s=0;for(let a,d,h=0,m=o.length,_=m-1;h<m;_=h++)a=o[h],d=o[_],s+=(d.x-a.x)*(a.y+d.y);return s}function Nd([o,s,a]){const d=kr(s+90),h=kr(a);return{x:o*Math.cos(d)*Math.sin(h),y:o*Math.sin(d)*Math.sin(h),z:o*Math.cos(h),azimuthal:s,polar:a}}function rp(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function r_(o){const s={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,d,h,m)=>{const _=h||m;return s[d]=!_||_.toLowerCase(),""}),s["max-age"]){const a=parseInt(s["max-age"],10);isNaN(a)?delete s["max-age"]:s["max-age"]=a}return s}let S1,i_,Vu,Mm,tf,Am,s_=null;function o_(o){try{const s=self[o];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}}function nf(o,s){return[o[4*s],o[4*s+1],o[4*s+2],o[4*s+3]]}function a_(o,s,a,d){for(;s<a;){const h=s+a>>1;o[h]<d?s=h+1:a=h}return s}function l_(o,s,a,d){for(;s<a;){const h=s+a>>1;o[h]<=d?s=h+1:a=h}return s}function Sx(o){return o>0?1/(1.001-o):1+o}function Dx(o){return o>0?1-1/(1.001-o):-o}function ju(){return null==S1&&(S1=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),S1}const Oa={now:()=>void 0!==Mm?Mm:performance.now(),setNow(o){Mm=o},restoreNow(){Mm=void 0},frame(o){const s=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(o,s=0){const{width:a,height:d}=o;tf||(tf=document.createElement("canvas"));const h=tf.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(a>tf.width||d>tf.height)&&(tf.width=a,tf.height=d),h.clearRect(-s,-s,a+2*s,d+2*s),h.drawImage(o,0,0,a,d),h.getImageData(-s,-s,a+2*s,d+2*s)},resolveURL:o=>(i_||(i_=document.createElement("a")),i_.href=o,i_.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Vu&&(Vu=window.matchMedia("(prefers-reduced-motion: reduce)")),Vu.matches)},hasCanvasFingerprintNoise(){if(void 0!==Am)return Am;if(!ju())return Am=!1,!1;const o=new OffscreenCanvas(85,1),s=o.getContext("2d",{willReadFrequently:!0});let a=0;for(let h=0;h<o.width;++h)s.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,s.fillRect(h,0,1,1);const d=s.getImageData(0,0,o.width,o.height);a=0;for(let h=0;h<d.data.length;++h)if(h%4!=3&&a++!==d.data[h])return Am=!0,!0;return Am=!1,!1}};function sT(o,s){const a=o.indexOf("?");if(a<0)return`${o}?${new URLSearchParams(s).toString()}`;const d=new URLSearchParams(o.slice(a));for(const h in s)d.set(h,s[h]);return`${o.slice(0,a)}?${d.toString()}`}function c_(o,s={persistentParams:[]}){const a=o.indexOf("?");if(a<0)return o;const d=new URLSearchParams,h=new URLSearchParams(o.slice(a));for(const _ of s.persistentParams){const b=h.get(_);b&&d.set(_,b)}const m=d.toString();return`${o.slice(0,a)}${m.length>0?`?${m}`:""}`}const u_="mapbox-tiles";let D1=500,M1=50;const Mx=["language","worldview","jobid"];let Rc,A1;function oT(){try{return caches}catch{}}function d_(){const o=oT();o&&!Rc&&(Rc=o.open(u_))}let I1=1/0;const k1={supported:!1,testSupport:function(o){!O1&&Im&&(P1?Fd(o):h_=o)}};let h_,Im,O1=!1,P1=!1;const ln=typeof self<"u"?self:{};function Fd(o){const s=o.createTexture();o.bindTexture(o.TEXTURE_2D,s);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Im),o.isContextLost())return;k1.supported=!0}catch{}o.deleteTexture(s),O1=!0}ln.document&&(Im=ln.document.createElement("img"),Im.onload=function(){h_&&Fd(h_),h_=null,P1=!0},Im.onerror=function(){O1=!0,h_=null},Im.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ld={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Ld);class km extends Error{constructor(s,a,d){401===a&&Hr(d)&&(s+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(s),this.status=a,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ax=rp()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,$u=function(o,s){if(!(/^file:/.test(a=o.url)||/^file:/.test(Ax())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,h){const m=new AbortController,_=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Ax(),referrerPolicy:d.referrerPolicy,signal:m.signal});let b=!1,T=!1;const S=(A=_.url).indexOf("sku=")>0&&Hr(A);var A;"json"===d.type&&_.headers.set("Accept","application/json");const k=(z,H,q)=>{if(T)return;if(z&&"SecurityError"!==z.message&&Ns(z.toString()),H&&q)return N(H);const X=Date.now();fetch(_).then(ee=>{if(ee.ok){const de=S?ee.clone():null;return N(ee,de,X)}return h(new km(ee.statusText,ee.status,d.url))}).catch(ee=>{"AbortError"!==ee.name&&h(new Error(`${ee.message} ${d.url}`))})},N=(z,H,q)=>{("arrayBuffer"===d.type?z.arrayBuffer():"json"===d.type?z.json():z.text()).then(X=>{T||(H&&q&&function(ee,de,ue){if(d_(),!Rc)return;const fe=r_(de.headers.get("Cache-Control")||"");if(fe["no-store"])return;const be={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach((Be,Ze)=>be.headers.set(Ze,Be)),fe["max-age"]&&be.headers.set("Expires",new Date(ue+1e3*fe["max-age"]).toUTCString());const Te=be.headers.get("Expires");if(!Te||new Date(Te).getTime()-ue<42e4)return;let De=c_(ee.url,{persistentParams:Mx});if(206===de.status){const Be=ee.headers.get("Range");if(!Be)return;be.status=200,De=sT(De,{range:Be})}!function(Be,Ze){if(void 0===A1)try{new Response(new ReadableStream),A1=!0}catch{A1=!1}A1?Ze(Be.body):Be.blob().then(Ze)}(de,Be=>{const Ze=new Response(200!==(ot=de.status)&&404!==ot&&[101,103,204,205,304].includes(ot)?null:Be,be);var ot;d_(),Rc&&Rc.then(Ke=>Ke.put(De,Ze)).catch(Ke=>Ns(Ke.message))})}(_,H,q),b=!0,h(null,X,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(X=>{T||h(new Error(X.message))})};return S?function(z,H){if(d_(),!Rc)return H(null);Rc.then(q=>{let X=c_(z.url,{persistentParams:Mx});const ee=z.headers.get("Range");ee&&(X=sT(X,{range:ee})),q.match(X).then(de=>{const ue=function(fe){if(!fe)return!1;const be=new Date(fe.headers.get("Expires")||0),Te=r_(fe.headers.get("Cache-Control")||"");return be>Date.now()&&!Te["no-cache"]}(de);q.delete(X),ue&&q.put(X,de.clone()),H(null,de,ue)}).catch(H)}).catch(H)}(_,k):k(null,null),{cancel:()=>{T=!0,b||m.abort()}}}(o,s);if(rp()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,s,void 0,!0)}var a;return function(d,h){const m=new XMLHttpRequest;m.open(d.method||"GET",d.url,!0),"arrayBuffer"===d.type&&(m.responseType="arraybuffer");for(const _ in d.headers)m.setRequestHeader(_,d.headers[_]);return"json"===d.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===d.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===d.type)try{_=JSON.parse(m.response)}catch(b){return h(b)}h(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new km(m.statusText,m.status,d.url))},m.send(d.body),{cancel:()=>m.abort()}}(o,s)},Bd=function(o,s){return $u(bo(o,{type:"arrayBuffer"}),s)};function Hu(o){const s=document.createElement("a");return s.href=o,s.protocol===location.protocol&&s.host===location.host}const rf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let su,Nc;su=[],Nc=0;const ip=function(o,s){if(k1.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Nc>=cn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return su.push(m),m}Nc++;let a=!1;const d=()=>{if(!a)for(a=!0,Nc--;su.length&&Nc<cn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=su.shift(),{requestParameters:_,callback:b,cancelled:T}=m;T||(m.cancel=ip(_,b).cancel)}},h=Bd(o,(m,_,b,T)=>{d(),m?s(m):_&&(self.createImageBitmap?function(S,A){const k=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(k).then(N=>{A(null,N)}).catch(N=>{A(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(S,A)=>s(S,A,b,T)):function(S,A){const k=new Image;k.onload=()=>{A(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame(()=>{k.src=rf})},k.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Blob([new Uint8Array(S)],{type:"image/png"});k.src=S.byteLength?URL.createObjectURL(N):rf}(_,(S,A)=>s(S,A,b,T)))});return{cancel:()=>{h.cancel(),d()}}},Om="01",zd="NO_ACCESS_TOKEN",OD=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bi(o){const s=o.match(OD);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function sp(o){const s=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${s}`}const Ix="mapbox.eventData";function ts(o){if(!o)return null;const s=o.split(".");if(!s||3!==s.length)return null;try{return JSON.parse(decodeURIComponent(atob(s[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class sf{constructor(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const a=ts(cn.ACCESS_TOKEN);let d="";return d=a&&a.u?btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(+("0x"+m)))):cn.ACCESS_TOKEN||"",s?`${Ix}.${s}:${d}`:`${Ix}:${d}`}fetchEventData(){const s=o_("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid");if(s)try{const h=localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));const m=localStorage.getItem(d);m&&(this.anonId=m)}catch{Ns("Unable to read from LocalStorage")}}saveEventData(){const s=o_("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid"),h=this.anonId;if(s&&h)try{localStorage.setItem(d,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{Ns("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,a,d,h){if(!cn.EVENTS_URL)return;const m=bi(cn.EVENTS_URL);m.params.push(`access_token=${h||cn.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(s).toISOString()},b=a?bo(_,a):_,T={url:sp(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};var A;this.pendingRequest=(A=S=>{this.pendingRequest=null,d(S),this.saveEventData(),this.processRequests(h)},$u(bo(T,{method:"POST"}),A))}queueRequest(s,a){this.queue.push(s),this.processRequests(a)}}const wo=new class extends sf{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,s){cn.EVENTS_URL&&cn.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>gs(a)||Hr(a))&&this.queueRequest(Date.now(),s)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=ts(cn.ACCESS_TOKEN),a=s?s.u:cn.ACCESS_TOKEN;let d=a!==this.eventData.tokenU;n_(this.anonId)||(this.anonId=Em(),d=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(h),b=(h-this.eventData.lastSuccess)/864e5;d=d||b>=1||b<-1||m.getDate()!==_.getDate()}else d=!0;d?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:xo,skuId:Om,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=a)},o):this.processRequests()}},Pm=wo.postTurnstileEvent.bind(wo),Rm=new class extends sf{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,s,a,d){this.skuToken=s,this.errorCb=d,cn.EVENTS_URL&&(a||cn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(zd)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:s,timestamp:a}=this.queue.shift();s&&this.success[s]||(this.anonId||this.fetchEventData(),n_(this.anonId)||(this.anonId=Em()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:xo,skuId:Om,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):s&&(this.success[s]=!0)},o))}remove(){this.errorCb=null}},kx=Rm.postMapLoadEvent.bind(Rm),Fi=new class extends sf{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(o){let s=this.mapInstanceIdMap.get(o);return s||(s=Em(),this.mapInstanceIdMap.set(o,s)),s}getEventId(o){const s=this.eventIdPerMapInstanceMap.get(o)||0;return this.eventIdPerMapInstanceMap.set(o,s+1),s}postStyleLoadEvent(o,s){const{map:a,style:d,importedStyles:h}=s;if(!cn.EVENTS_URL||!o&&!cn.ACCESS_TOKEN)return;const m=this.getMapInstanceId(a),_={mapInstanceId:m,eventId:this.getEventId(m),style:d};h.length&&(_.importedStyles=h),this.queueRequest({timestamp:Date.now(),payload:_},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,payload:a}=this.queue.shift();this.postEvent(s,a,()=>{},o)}},Pr=Fi.postStyleLoadEvent.bind(Fi),Nm=new class extends sf{constructor(){super("gljs.performance")}postPerformanceEvent(o,s){cn.EVENTS_URL&&(o||cn.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,performanceData:a}=this.queue.shift(),d=function(h){const m=performance.getEntriesByType("resource"),_=performance.getEntriesByType("mark"),b=function(z){const H={};if(z)for(const q in z)if("other"!==q)for(const X of z[q]){const ee=`${q}ResolveRangeMin`,de=`${q}ResolveRangeMax`,ue=`${q}RequestCount`,fe=`${q}RequestCachedCount`;H[ee]=Math.min(H[ee]||1/0,X.startTime),H[de]=Math.max(H[de]||-1/0,X.responseEnd);const be=Te=>{void 0===H[Te]&&(H[Te]=0),++H[Te]};void 0!==X.transferSize&&0===X.transferSize&&be(fe),be(ue)}return H}(function(z,H){const q={};if(z)for(const X of z){const ee=H(X);void 0===q[ee]&&(q[ee]=[]),q[ee].push(X)}return q}(m,Oc)),T=window.devicePixelRatio,S=navigator.connection||navigator.mozConnection||navigator.webkitConnection,A=S?S.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},N=(z,H,q)=>{null!=q&&z.push({name:H,value:q.toString()})};for(const z in b)N(k.counters,z,b[z]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(N(k.counters,"interactionRangeMin",h.interactionRange[0]),N(k.counters,"interactionRangeMax",h.interactionRange[1])),_)for(const z of Object.keys(ki)){const H=ki[z],q=_.find(X=>X.name===H);q&&N(k.counters,H,q.startTime)}return N(k.counters,"visibilityHidden",h.visibilityHidden),N(k.attributes,"style",function(z){if(z)for(const H of z){const q=H.name.split("?")[0];if(Es(q)){const X=q.split("/").slice(-2);if(2===X.length)return`mapbox://styles/${X[0]}/${X[1]}`}}}(m)),N(k.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),N(k.attributes,"fogEnabled",h.fogEnabled?"true":"false"),N(k.attributes,"projection",h.projection),N(k.attributes,"zoom",h.zoom),N(k.metadata,"devicePixelRatio",T),N(k.metadata,"connectionEffectiveType",A),N(k.metadata,"navigatorUserAgent",navigator.userAgent),N(k.metadata,"screenWidth",window.screen.width),N(k.metadata,"screenHeight",window.screen.height),N(k.metadata,"windowWidth",window.innerWidth),N(k.metadata,"windowHeight",window.innerHeight),N(k.metadata,"mapWidth",h.width/T),N(k.metadata,"mapHeight",h.height/T),N(k.metadata,"webglRenderer",h.renderer),N(k.metadata,"webglVendor",h.vendor),N(k.metadata,"sdkVersion",xo),N(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(a);for(const h of d.metadata);for(const h of d.counters);for(const h of d.attributes);this.postEvent(s,d,()=>{},o)}},jl=Nm.postPerformanceEvent.bind(Nm),f_=new class extends sf{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,s,a,d){if(!cn.API_URL||!cn.SESSION_PATH)return;const h=bi(cn.API_URL+cn.SESSION_PATH);h.params.push(`sku=${s||""}`),h.params.push(`access_token=${d||cn.ACCESS_TOKEN||""}`);const m={url:sp(h),headers:{"Content-Type":"text/plain"}};var b;this.pendingRequest=(b=_=>{this.pendingRequest=null,a(_),this.saveEventData(),this.processRequests(d)},$u(bo(m,{method:"GET"}),b))}getSessionAPI(o,s,a,d){this.skuToken=s,this.errorCb=d,cn.SESSION_PATH&&cn.API_URL&&(a||cn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(zd)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:s,timestamp:a}=this.queue.shift();s&&this.success[s]||this.getSession(a,this.skuToken,d=>{d?this.errorCb(d):s&&(this.success[s]=!0)},o)}remove(){this.errorCb=null}},R1=f_.getSessionAPI.bind(f_),p_=new Set;var hl={exports:{}},aT=function(o,s){var a,d,h,m,_,b,T,S;for(d=o.length-(a=3&o.length),h=s,_=3432918353,b=461845907,S=0;S<d;)T=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24,++S,h=27492+(65535&(m=5*(65535&(h=(h^=T=(65535&(T=(T=(65535&T)*_+(((T>>>16)*_&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(T=0,a){case 3:T^=(255&o.charCodeAt(S+2))<<16;case 2:T^=(255&o.charCodeAt(S+1))<<8;case 1:h^=T=(65535&(T=(T=(65535&(T^=255&o.charCodeAt(S)))*_+(((T>>>16)*_&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return h^=o.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0},RD=function(o,s){for(var a,d=o.length,h=s^d,m=0;d>=4;)a=1540483477*(65535&(a=255&o.charCodeAt(m)|(255&o.charCodeAt(++m))<<8|(255&o.charCodeAt(++m))<<16|(255&o.charCodeAt(++m))<<24))+((1540483477*(a>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),d-=4,++m;switch(d){case 3:h^=(255&o.charCodeAt(m+2))<<16;case 2:h^=(255&o.charCodeAt(m+1))<<8;case 1:h=1540483477*(65535&(h^=255&o.charCodeAt(m)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};hl.exports=aT,hl.exports.murmur3=aT,hl.exports.murmur2=RD;var m_=sa(hl.exports);class Gu{constructor(s,...a){bo(this,a[0]||{}),this.type=s}}class Lm extends Gu{constructor(s,a={}){super("error",bo({error:s},a))}}function N1(o,s,a){a[o]&&-1!==a[o].indexOf(s)||(a[o]=a[o]||[],a[o].push(s))}function el(o,s,a){if(a&&a[o]){const d=a[o].indexOf(s);-1!==d&&a[o].splice(d,1)}}class br{on(s,a){return this._listeners=this._listeners||{},N1(s,a,this._listeners),this}off(s,a){return el(s,a,this._listeners),el(s,a,this._oneTimeListeners),this}once(s,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},N1(s,a,this._oneTimeListeners),this):new Promise(d=>this.once(s,d))}fire(s,a){const d="string"==typeof s?new Gu(s,a):s,h=d.type;if(this.listens(h)){d.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const T of m)T.call(this,d);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const T of _)el(h,T,this._oneTimeListeners),T.call(this,d);const b=this._eventedParent;b&&(bo(d,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(d))}else d instanceof Lm&&console.error(d.error);return this}listens(s){return!!(this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s))}setEventedParent(s,a){return this._eventedParent=s,this._eventedParentData=a,this}}f.G=void 0;var lT={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function F1(o){return(o=Math.round(o))<0?0:o>255?255:o}function Ox(o){return F1("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function L1(o){return(s="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:s>1?1:s;var s}function Px(o,s,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?o+(s-o)*a*6:2*a<1?s:3*a<2?o+(s-o)*(2/3-a)*6:o}try{f.G={}.parseCSSColor=function(o){var s,a=o.replace(/ /g,"").toLowerCase();if(a in lT)return lT[a].slice();if("#"===a[0])return 4===a.length?(s=parseInt(a.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:7===a.length&&(s=parseInt(a.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var d=a.indexOf("("),h=a.indexOf(")");if(-1!==d&&h+1===a.length){var m=a.substr(0,d),_=a.substr(d+1,h-(d+1)).split(","),b=1;switch(m){case"rgba":if(4!==_.length)return null;b=L1(_.pop());case"rgb":return 3!==_.length?null:[Ox(_[0]),Ox(_[1]),Ox(_[2]),b];case"hsla":if(4!==_.length)return null;b=L1(_.pop());case"hsl":if(3!==_.length)return null;var T=(parseFloat(_[0])%360+360)%360/360,S=L1(_[1]),A=L1(_[2]),k=A<=.5?A*(S+1):A+S-A*S,N=2*A-k;return[F1(255*Px(N,k,T+1/3)),F1(255*Px(N,k,T)),F1(255*Px(N,k,T-1/3)),b];default:return null}}return null}}catch{}class It{constructor(s,a,d,h=1){this.r=s,this.g=a,this.b=d,this.a=h}static parse(s){if(!s)return;if(s instanceof It)return s;if("string"!=typeof s)return;const a=f.G(s);return a?new It(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[s,a,d,h]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(s)},${Math.round(a)},${Math.round(d)},${h})`}toRenderColor(s){const{r:a,g:d,b:h,a:m}=this;return new ND(s,a,d,h,m)}}class ND{constructor(s,a,d,h,m){if(s){const _=s.image.height,b=_*_;a=0===m?0:a/m*(_-1),d=0===m?0:d/m*(_-1),h=0===m?0:h/m*(_-1);const T=Math.floor(a),S=Math.floor(d),A=Math.floor(h),k=Math.ceil(a),N=Math.ceil(d),z=Math.ceil(h),H=a-T,q=d-S,X=h-A,ee=s.image.data,de=4*(T+S*b+A*_),ue=4*(T+S*b+z*_),fe=4*(T+N*b+A*_),be=4*(T+N*b+z*_),Te=4*(k+S*b+A*_),De=4*(k+S*b+z*_),Be=4*(k+N*b+A*_),Ze=4*(k+N*b+z*_);if(de<0||Ze>=ee.length)throw new Error("out of range");this.r=dn(dn(dn(ee[de],ee[ue],X),dn(ee[fe],ee[be],X),q),dn(dn(ee[Te],ee[De],X),dn(ee[Be],ee[Ze],X),q),H)/255*m,this.g=dn(dn(dn(ee[de+1],ee[ue+1],X),dn(ee[fe+1],ee[be+1],X),q),dn(dn(ee[Te+1],ee[De+1],X),dn(ee[Be+1],ee[Ze+1],X),q),H)/255*m,this.b=dn(dn(dn(ee[de+2],ee[ue+2],X),dn(ee[fe+2],ee[be+2],X),q),dn(dn(ee[Te+2],ee[De+2],X),dn(ee[Be+2],ee[Ze+2],X),q),H)/255*m,this.a=m}else this.r=a,this.g=d,this.b=h,this.a=m}toArray(){const{r:s,g:a,b:d,a:h}=this;return 0===h?[0,0,0,0]:[255*s/h,255*a/h,255*d/h,h]}toArray01(){const{r:s,g:a,b:d,a:h}=this;return 0===h?[0,0,0,0]:[s/h,a/h,d/h,h]}toArray01Scaled(s){const{r:a,g:d,b:h,a:m}=this;return 0===m?[0,0,0]:[a/m*s,d/m*s,h/m*s]}toArray01PremultipliedAlpha(){const{r:s,g:a,b:d,a:h}=this;return[s,a,d,h]}toArray01Linear(){const{r:s,g:a,b:d,a:h}=this;return 0===h?[0,0,0,0]:[Math.pow(s/h,2.2),Math.pow(a/h,2.2),Math.pow(d/h,2.2),h]}}function dn(o,s,a){return o*(1-a)+s*a}function op(o,s,a){return o.map((d,h)=>dn(d,s[h],a))}It.black=new It(0,0,0,1),It.white=new It(1,1,1,1),It.transparent=new It(0,0,0,0),It.red=new It(1,0,0,1),It.blue=new It(0,0,1,1);var Bm=Object.freeze({__proto__:null,array:op,color:function(o,s,a){return new It(dn(o.r,s.r,a),dn(o.g,s.g,a),dn(o.b,s.b,a),dn(o.a,s.a,a))},number:dn});function af(o,...s){for(const a of s)for(const d in a)o[d]=a[d];return o}class ou extends Error{constructor(s,a){super(a),this.message=a,this.key=s}}class ap{constructor(s,a=[]){this.parent=s,this.bindings={};for(const[d,h]of a)this.bindings[d]=h}concat(s){return new ap(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Pa={kind:"null"},_n={kind:"number"},Fr={kind:"string"},si={kind:"boolean"},vn={kind:"color"},Ud={kind:"object"},qr={kind:"value"},zm={kind:"collator"},Vd={kind:"formatted"},lf={kind:"resolvedImage"};function Io(o,s){return{kind:"array",itemType:o,N:s}}function Fs(o){if("array"===o.kind){const s=Fs(o.itemType);return"number"==typeof o.N?`array<${s}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${s}>`}return o.kind}const Rx=[Pa,_n,Fr,si,vn,Vd,Ud,Io(qr),lf];function g_(o,s){if("error"===s.kind)return null;if("array"===o.kind){if("array"===s.kind&&(0===s.N&&"value"===s.itemType.kind||!g_(o.itemType,s.itemType))&&("number"!=typeof o.N||o.N===s.N))return null}else{if(o.kind===s.kind)return null;if("value"===o.kind)for(const a of Rx)if(!g_(a,s))return null}return`Expected ${Fs(o)} but found ${Fs(s)} instead.`}function Fc(o,s){return s.some(a=>a.kind===o.kind)}function cf(o,s){return s.some(a=>"null"===a?null===o:"array"===a?Array.isArray(o):"object"===a?o&&!Array.isArray(o)&&"object"==typeof o:a===typeof o)}class jd{constructor(s,a,d){this.sensitivity=s?a?"variant":"case":a?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,a){return this.collator.compare(s,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class lp{constructor(s,a,d,h,m){this.text=s.normalize?s.normalize():s,this.image=a,this.scale=d,this.fontStack=h,this.textColor=m}}class Ho{constructor(s){this.sections=s}static fromString(s){return new Ho([new lp(s,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(s=>0!==s.text.length||s.image&&0!==s.image.namePrimary.length)}static factory(s){return s instanceof Ho?s:Ho.fromString(s)}toString(){return 0===this.sections.length?"":this.sections.map(s=>s.text).join("")}serialize(){const s=["format"];for(const a of this.sections){if(a.image){s.push(["image",a.image.namePrimary]);continue}s.push(a.text);const d={};a.fontStack&&(d["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(d["font-scale"]=a.scale),a.textColor&&(d["text-color"]=["rgba"].concat(a.textColor.toRenderColor(null).toArray())),s.push(d)}return s}}class fl{constructor(s){this.namePrimary=s.namePrimary,s.nameSecondary&&(this.nameSecondary=s.nameSecondary),this.available=s.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(s,a){return s?new fl({namePrimary:s,nameSecondary:a,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function au(o,s,a,d){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof s&&s>=0&&s<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===d||"number"==typeof d&&d>=0&&d<=1?null:`Invalid rgba value [${[o,s,a,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof d?[o,s,a,d]:[o,s,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function lu(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof It||o instanceof jd||o instanceof Ho||o instanceof fl)return!0;if(Array.isArray(o)){for(const s of o)if(!lu(s))return!1;return!0}if("object"==typeof o){for(const s in o)if(!lu(o[s]))return!1;return!0}return!1}function qs(o){if(null===o)return Pa;if("string"==typeof o)return Fr;if("boolean"==typeof o)return si;if("number"==typeof o)return _n;if(o instanceof It)return vn;if(o instanceof jd)return zm;if(o instanceof Ho)return Vd;if(o instanceof fl)return lf;if(Array.isArray(o)){const s=o.length;let a;for(const d of o){const h=qs(d);if(a){if(a===h)continue;a=qr;break}a=h}return Io(a||qr,s)}return Ud}function Er(o){const s=typeof o;return null===o?"":"string"===s||"number"===s||"boolean"===s?String(o):o instanceof It||o instanceof Ho||o instanceof fl?o.toString():JSON.stringify(o)}class li{constructor(s,a){this.type=s,this.value=a}static parse(s,a){if(2!==s.length)return a.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!lu(s[1]))return a.error("invalid value");const d=s[1];let h=qs(d);const m=a.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new li(h,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof It?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Ho?this.value.serialize():this.value}}class To{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const B1={string:Fr,number:_n,boolean:si,object:Ud};class $l{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");let d,h=1;const m=s[0];if("array"===m){let b,T;if(s.length>2){const S=s[1];if("string"!=typeof S||!(S in B1)||"object"===S)return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=B1[S],h++}else b=qr;if(s.length>3){if(null!==s[2]&&("number"!=typeof s[2]||s[2]<0||s[2]!==Math.floor(s[2])))return a.error('The length argument to "array" must be a positive integer literal',2);T=s[2],h++}d=Io(b,T)}else d=B1[m];const _=[];for(;h<s.length;h++){const b=a.parse(s[h],h,qr);if(!b)return null;_.push(b)}return new $l(d,_)}evaluate(s){for(let a=0;a<this.args.length;a++){const d=this.args[a].evaluate(s);if(!g_(this.type,qs(d)))return d;if(a===this.args.length-1)throw new To(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Fs(qs(d))} but was expected to be of type ${Fs(this.type)}.`)}return null}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=this.type,a=[s.kind];if("array"===s.kind){const d=s.itemType;if("string"===d.kind||"number"===d.kind||"boolean"===d.kind){a.push(d.kind);const h=s.N;("number"==typeof h||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(d=>d.serialize()))}}class cp{constructor(s){this.type=Vd,this.sections=s}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");const d=s[1];if(!Array.isArray(d)&&"object"==typeof d)return a.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=s.length-1;++_){const b=s[_];if(m&&"object"==typeof b&&!Array.isArray(b)){m=!1;let T=null;if(b["font-scale"]&&(T=a.parse(b["font-scale"],1,_n),!T))return null;let S=null;if(b["text-font"]&&(S=a.parse(b["text-font"],1,Io(Fr)),!S))return null;let A=null;if(b["text-color"]&&(A=a.parse(b["text-color"],1,vn),!A))return null;const k=h[h.length-1];k.scale=T,k.font=S,k.textColor=A}else{const T=a.parse(s[_],1,qr);if(!T)return null;const S=T.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new cp(h)}evaluate(s){return new Ho(this.sections.map(a=>{const d=a.content.evaluate(s);return qs(d)===lf?new lp("",d,null,null,null):new lp(Er(d),null,a.scale?a.scale.evaluate(s):null,a.font?a.font.evaluate(s).join(","):null,a.textColor?a.textColor.evaluate(s):null)}))}eachChild(s){for(const a of this.sections)s(a.content),a.scale&&s(a.scale),a.font&&s(a.font),a.textColor&&s(a.textColor)}outputDefined(){return!1}serialize(){const s=["format"];for(const a of this.sections){s.push(a.content.serialize());const d={};a.scale&&(d["font-scale"]=a.scale.serialize()),a.font&&(d["text-font"]=a.font.serialize()),a.textColor&&(d["text-color"]=a.textColor.serialize()),s.push(d)}return s}}class Wu{constructor(s,a){this.type=lf,this.inputPrimary=s,this.inputSecondary=a}static parse(s,a){if(s.length<2)return a.error("Expected two or more arguments.");const d=a.parse(s[1],1,Fr);if(!d)return a.error("No image name provided.");if(2===s.length)return new Wu(d);const h=a.parse(s[2],1,Fr);return h?new Wu(d,h):a.error("Secondary image variant is not a string.")}evaluate(s){const a=fl.fromString(this.inputPrimary.evaluate(s),this.inputSecondary?this.inputSecondary.evaluate(s):void 0);return a&&s.availableImages&&(a.available=s.availableImages.indexOf(a.namePrimary)>-1,a.nameSecondary&&a.available&&s.availableImages&&(a.available=s.availableImages.indexOf(a.nameSecondary)>-1)),a}eachChild(s){s(this.inputPrimary),this.inputSecondary&&s(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function cu(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}const wi={"to-boolean":si,"to-color":vn,"to-number":_n,"to-string":Fr};class Lc{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");const d=s[0],h=[];let m=Pa;if("to-array"===d){if(!Array.isArray(s[1]))return null;const _=s[1].length;if(a.expectedType){if("array"!==a.expectedType.kind)return a.error(`Expected ${a.expectedType.kind} but found array.`);m=Io(a.expectedType.itemType,_)}else{if(!(_>0&&lu(s[1][0])))return null;m=Io(qs(s[1][0]),_)}for(let b=0;b<_;b++){const T=s[1][b];let S;if("array"===cu(T))S=a.parse(T,void 0,m.itemType);else{const A=cu(T);if(A!==m.itemType.kind)return a.error(`Expected ${m.itemType.kind} but found ${A}.`);S=a.registry.literal.parse(["literal",void 0===T?null:T],a)}if(!S)return null;h.push(S)}}else{if(("to-boolean"===d||"to-string"===d)&&2!==s.length)return a.error("Expected one argument.");m=wi[d];for(let _=1;_<s.length;_++){const b=a.parse(s[_],_,qr);if(!b)return null;h.push(b)}}return new Lc(m,h)}evaluate(s){if("boolean"===this.type.kind)return!!this.args[0].evaluate(s);if("color"===this.type.kind){let a,d;for(const h of this.args){if(a=h.evaluate(s),d=null,a instanceof It)return a;if("string"==typeof a){const m=s.parseColor(a);if(m)return m}else if(Array.isArray(a)&&(d=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:au(a[0],a[1],a[2],a[3]),!d))return new It(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new To(d||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const d of this.args){if(a=d.evaluate(s),null===a)return 0;const h=Number(a);if(!isNaN(h))return h}throw new To(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?Ho.fromString(Er(this.args[0].evaluate(s))):"resolvedImage"===this.type.kind?fl.fromString(Er(this.args[0].evaluate(s))):"array"===this.type.kind?this.args.map(a=>a.evaluate(s)):Er(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){if("formatted"===this.type.kind)return new cp([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Wu(this.args[0]).serialize();const s="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{s.push(a.serialize())}),s}}const Nx=["Unknown","Point","LineString","Polygon"];class Ra{constructor(s,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=s,this.options=a}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Nx[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(s){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:d,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*a-s[0])+this.featureDistanceData.bearing[1]*(h*a-s[1])}return 0}parseColor(s){let a=this._parseColorCache[s];return a||(a=this._parseColorCache[s]=It.parse(s)),a}getConfig(s){return this.options?this.options.get(s):null}}class tl{constructor(s,a,d,h,m){this.name=s,this.type=a,this._evaluate=d,this.args=h,this._overloadIndex=m}evaluate(s){if(!this._evaluate){const a=tl.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(s=>s.serialize()))}static parse(s,a){const d=s[0],h=tl.definitions[d];if(!h)return a.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=[];let T=null,S=-1;for(const[A,k]of _){if(Array.isArray(A)&&A.length!==s.length-1)continue;b.push(A),S++,T=new Vx(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const N=[];let z=!1;for(let H=1;H<s.length;H++){const q=s[H],X=Array.isArray(A)?A[H-1]:A.type,ee=T.parse(q,1+N.length,X);if(!ee){z=!0;break}N.push(ee)}if(!z)if(Array.isArray(A)&&A.length!==N.length)T.error(`Expected ${A.length} arguments, but found ${N.length} instead.`);else{for(let H=0;H<N.length;H++){const q=Array.isArray(A)?A[H]:A.type,X=N[H];T.concat(H+1).checkSubtype(q,X.type)}if(0===T.errors.length)return new tl(d,m,k,N,S)}}if(1===b.length)a.errors.push(...T.errors);else{const A=(b.length?b:_.map(([N])=>N)).map(FD).join(" | "),k=[];for(let N=1;N<s.length;N++){const z=a.parse(s[N],1+k.length);if(!z)return null;k.push(Fs(z.type))}a.error(`Expected arguments of type ${A}, but found (${k.join(", ")}) instead.`)}return null}static register(s,a){tl.definitions=a;for(const d in a)s[d]=tl}}function FD(o){return Array.isArray(o)?`(${o.map(Fs).join(", ")})`:`(${Fs(o.type)}...)`}class __{constructor(s,a,d){this.type=zm,this.locale=d,this.caseSensitive=s,this.diacriticSensitive=a}static parse(s,a){if(2!==s.length)return a.error("Expected one argument.");const d=s[1];if("object"!=typeof d||Array.isArray(d))return a.error("Collator options argument must be an object.");const h=a.parse(void 0!==d["case-sensitive"]&&d["case-sensitive"],1,si);if(!h)return null;const m=a.parse(void 0!==d["diacritic-sensitive"]&&d["diacritic-sensitive"],1,si);if(!m)return null;let _=null;return d.locale&&(_=a.parse(d.locale,1,Fr),!_)?null:new __(h,m,_)}evaluate(s){return new jd(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}serialize(){const s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]}}function Vr(o,s,a=0,d=o.length-1,h=Um){for(;d>a;){if(d-a>600){const T=d-a+1,S=s-a+1,A=Math.log(T),k=.5*Math.exp(2*A/3),N=.5*Math.sqrt(A*k*(T-k)/T)*(S-T/2<0?-1:1);Vr(o,s,Math.max(a,Math.floor(s-S*k/T+N)),Math.min(d,Math.floor(s+(T-S)*k/T+N)),h)}const m=o[s];let _=a,b=d;for($d(o,a,s),h(o[d],m)>0&&$d(o,a,d);_<b;){for($d(o,_,b),_++,b--;h(o[_],m)<0;)_++;for(;h(o[b],m)>0;)b--}0===h(o[a],m)?$d(o,a,b):(b++,$d(o,b,d)),b<=s&&(a=b+1),s<=b&&(d=b-1)}}function $d(o,s,a){const d=o[s];o[s]=o[a],o[a]=d}function Um(o,s){return o<s?-1:o>s?1:0}function cT(o){let s=0;for(let a,d,h=0,m=o.length,_=m-1;h<m;_=h++)a=o[h],d=o[_],s+=(d.x-a.x)*(a.y+d.y);return s}function Vm(o,s){o[0]=Math.min(o[0],s[0]),o[1]=Math.min(o[1],s[1]),o[2]=Math.max(o[2],s[0]),o[3]=Math.max(o[3],s[1])}function Hd(o,s){return!(o[0]<=s[0]||o[2]>=s[2]||o[1]<=s[1]||o[3]>=s[3])}function jm(o,s,a){const d=o[0]-s[0],h=o[1]-s[1],m=o[0]-a[0],_=o[1]-a[1];return d*_-m*h==0&&d*m<=0&&h*_<=0}function pl(o,s,a=!1){let d=!1;for(let b=0,T=s.length;b<T;b++){const S=s[b];for(let A=0,k=S.length,N=k-1;A<k;N=A++){const z=S[N],H=S[A];if(jm(o,z,H))return a;(m=z)[1]>(h=o)[1]!=(_=H)[1]>h[1]&&h[0]<(_[0]-m[0])*(h[1]-m[1])/(_[1]-m[1])+m[0]&&(d=!d)}}var h,m,_;return d}function Fx(o,s,a,d){const h=d[0]-a[0],m=d[1]-a[1],_=(o[0]-a[0])*m-h*(o[1]-a[1]),b=(s[0]-a[0])*m-h*(s[1]-a[1]);return _>0&&b<0||_<0&&b>0}function ac(o,s,a,d){return(h=[d[0]-a[0],d[1]-a[1]])[0]*(m=[s[0]-o[0],s[1]-o[1]])[1]-h[1]*m[0]!=0&&!(!Fx(o,s,a,d)||!Fx(a,d,o,s));var h,m}const ua=8192;function $n(o,s){const a=(180+o[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,h=Math.pow(2,s.z);return[Math.round(a*h*ua),Math.round(d*h*ua)]}function z1(o,s){for(let a=0;a<s.length;a++)if(pl(o,s[a]))return!0;return!1}function Qe(o,s,a){for(const d of a)for(let h=0,m=d.length,_=m-1;h<m;_=h++)if(ac(o,s,d[_],d[h]))return!0;return!1}function uf(o,s){for(let a=0;a<o.length;++a)if(!pl(o[a],s))return!1;for(let a=0;a<o.length-1;++a)if(Qe(o[a],o[a+1],s))return!1;return!0}function U1(o,s){for(let a=0;a<s.length;a++)if(uf(o,s[a]))return!0;return!1}function df(o,s,a){const d=[];for(let h=0;h<o.length;h++){const m=[];for(let _=0;_<o[h].length;_++){const b=$n(o[h][_],a);Vm(s,b),m.push(b)}d.push(m)}return d}function Lx(o,s,a){const d=[];for(let h=0;h<o.length;h++){const m=df(o[h],s,a);d.push(m)}return d}function V1(o,s,a,d){if(o[0]<a[0]||o[0]>a[2]){const h=.5*d;let m=o[0]-a[0]>h?-d:a[0]-o[0]>h?d:0;0===m&&(m=o[0]-a[2]>h?-d:a[2]-o[0]>h?d:0),o[0]+=m}Vm(s,o)}function y_(o,s,a,d){const h=Math.pow(2,d.z)*ua,m=[d.x*ua,d.y*ua],_=[];if(!o)return _;for(const b of o)for(const T of b){const S=[T.x+m[0],T.y+m[1]];V1(S,s,a,h),_.push(S)}return _}function Bx(o,s,a,d){const h=Math.pow(2,d.z)*ua,m=[d.x*ua,d.y*ua],_=[];if(!o)return _;for(const T of o){const S=[];for(const A of T){const k=[A.x+m[0],A.y+m[1]];Vm(s,k),S.push(k)}_.push(S)}if(s[2]-s[0]<=h/2){(b=s)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of _)for(const S of T)V1(S,s,a,h)}var b;return _}class Hl{constructor(s,a){this.type=si,this.geojson=s,this.geometries=a}static parse(s,a){if(2!==s.length)return a.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(lu(s[1])){const d=s[1];if("FeatureCollection"===d.type)for(let h=0;h<d.features.length;++h){const m=d.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new Hl(d,d.features[h].geometry)}else if("Feature"===d.type){const h=d.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new Hl(d,d.geometry)}else if("Polygon"===d.type||"MultiPolygon"===d.type)return new Hl(d,d)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(null!=s.geometry()&&null!=s.canonicalID()){if("Point"===s.geometryType())return function(a,d){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===d.type){const b=df(d.coordinates,m,_),T=y_(a.geometry(),h,m,_);if(!Hd(h,m))return!1;for(const S of T)if(!pl(S,b))return!1}if("MultiPolygon"===d.type){const b=Lx(d.coordinates,m,_),T=y_(a.geometry(),h,m,_);if(!Hd(h,m))return!1;for(const S of T)if(!z1(S,b))return!1}return!0}(s,this.geometries);if("LineString"===s.geometryType())return function(a,d){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===d.type){const b=df(d.coordinates,m,_),T=Bx(a.geometry(),h,m,_);if(!Hd(h,m))return!1;for(const S of T)if(!uf(S,b))return!1}if("MultiPolygon"===d.type){const b=Lx(d.coordinates,m,_),T=Bx(a.geometry(),h,m,_);if(!Hd(h,m))return!1;for(const S of T)if(!U1(S,b))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const v_={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},$m=1/298.257223563,zx=$m*(2-$m),Bc=Math.PI/180;class Hm{static fromTile(s,a,d){const h=Math.PI*(1-2*(s+.5)/Math.pow(2,a)),m=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Bc;return new Hm(m,d)}static get units(){return v_}constructor(s,a){if(void 0===s)throw new Error("No latitude given.");if(a&&!v_[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(v_).join(", ")}`);const d=6378.137*Bc*(a?v_[a]:1),h=Math.cos(s*Bc),m=1/(1-zx*(1-h*h)),_=Math.sqrt(m);this.kx=d*_*h,this.ky=d*_*m*(1-zx)}distance(s,a){const d=ml(s[0]-a[0])*this.kx,h=(s[1]-a[1])*this.ky;return Math.sqrt(d*d+h*h)}bearing(s,a){const d=ml(a[0]-s[0])*this.kx;return Math.atan2(d,(a[1]-s[1])*this.ky)/Bc}destination(s,a,d){const h=d*Bc;return this.offset(s,Math.sin(h)*a,Math.cos(h)*a)}offset(s,a,d){return[s[0]+a/this.kx,s[1]+d/this.ky]}lineDistance(s){let a=0;for(let d=0;d<s.length-1;d++)a+=this.distance(s[d],s[d+1]);return a}area(s){let a=0;for(let d=0;d<s.length;d++){const h=s[d];for(let m=0,_=h.length,b=_-1;m<_;b=m++)a+=ml(h[m][0]-h[b][0])*(h[m][1]+h[b][1])*(d?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(s,a){let d=0;if(a<=0)return s[0];for(let h=0;h<s.length-1;h++){const m=s[h],_=s[h+1],b=this.distance(m,_);if(d+=b,d>a)return Gd(m,_,(a-(d-b))/b)}return s[s.length-1]}pointToSegmentDistance(s,a,d){let[h,m]=a,_=ml(d[0]-h)*this.kx,b=(d[1]-m)*this.ky;if(0!==_||0!==b){const T=(ml(s[0]-h)*this.kx*_+(s[1]-m)*this.ky*b)/(_*_+b*b);T>1?(h=d[0],m=d[1]):T>0&&(h+=_/this.kx*T,m+=b/this.ky*T)}return _=ml(s[0]-h)*this.kx,b=(s[1]-m)*this.ky,Math.sqrt(_*_+b*b)}pointOnLine(s,a){let d=1/0,h=s[0][0],m=s[0][1],_=0,b=0;for(let T=0;T<s.length-1;T++){let S=s[T][0],A=s[T][1],k=ml(s[T+1][0]-S)*this.kx,N=(s[T+1][1]-A)*this.ky,z=0;0===k&&0===N||(z=(ml(a[0]-S)*this.kx*k+(a[1]-A)*this.ky*N)/(k*k+N*N),z>1?(S=s[T+1][0],A=s[T+1][1]):z>0&&(S+=k/this.kx*z,A+=N/this.ky*z)),k=ml(a[0]-S)*this.kx,N=(a[1]-A)*this.ky;const H=k*k+N*N;H<d&&(d=H,h=S,m=A,_=T,b=z)}return{point:[h,m],index:_,t:Math.max(0,Math.min(1,b))}}lineSlice(s,a,d){let h=this.pointOnLine(d,s),m=this.pointOnLine(d,a);if(h.index>m.index||h.index===m.index&&h.t>m.t){const S=h;h=m,m=S}const _=[h.point],b=h.index+1,T=m.index;!nl(d[b],_[0])&&b<=T&&_.push(d[b]);for(let S=b+1;S<=T;S++)_.push(d[S]);return nl(d[T],m.point)||_.push(m.point),_}lineSliceAlong(s,a,d){let h=0;const m=[];for(let _=0;_<d.length-1;_++){const b=d[_],T=d[_+1],S=this.distance(b,T);if(h+=S,h>s&&0===m.length&&m.push(Gd(b,T,(s-(h-S))/S)),h>=a)return m.push(Gd(b,T,(a-(h-S))/S)),m;h>s&&m.push(T)}return m}bufferPoint(s,a){const d=a/this.ky,h=a/this.kx;return[s[0]-h,s[1]-d,s[0]+h,s[1]+d]}bufferBBox(s,a){const d=a/this.ky,h=a/this.kx;return[s[0]-h,s[1]-d,s[2]+h,s[3]+d]}insideBBox(s,a){return ml(s[0]-a[0])>=0&&ml(s[0]-a[2])<=0&&s[1]>=a[1]&&s[1]<=a[3]}}function nl(o,s){return o[0]===s[0]&&o[1]===s[1]}function Gd(o,s,a){const d=ml(s[0]-o[0]);return[o[0]+d*a,o[1]+(s[1]-o[1])*a]}function ml(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class zc{constructor(s=[],a=((d,h)=>d<h?-1:d>h?1:0)){if(this.data=s,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(0===this.length)return;const s=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:a,compare:d}=this,h=a[s];for(;s>0;){const m=s-1>>1,_=a[m];if(d(h,_)>=0)break;a[s]=_,s=m}a[s]=h}_down(s){const{data:a,compare:d}=this,h=this.length>>1,m=a[s];for(;s<h;){let _=1+(s<<1);const b=_+1;if(b<this.length&&d(a[b],a[_])<0&&(_=b),d(a[_],m)>=0)break;a[s]=a[_],s=_}a[s]=m}}var Jt=8192;function x_(o,s){return s.dist-o.dist}const b_=100,w_=50;function uT(o){const s=[1/0,1/0,-1/0,-1/0];if(s.length!==o.length)return!1;for(let a=0;a<s.length;a++)if(s[a]!==o[a])return!1;return!0}function Na(o){return o[1]-o[0]+1}function Uc(o,s){const a=o[1]>=o[0]&&o[1]<s;return a||console.warn("Distance Expression: Index is out of range"),a}function Wd(o,s){if(o[0]>o[1])return[null,null];const a=Na(o);if(s){if(2===a)return[o,null];const d=Math.floor(a/2);return[[o[0],o[0]+d],[o[0]+d,o[1]]]}{if(1===a)return[o,null];const d=Math.floor(a/2)-1;return[[o[0],o[0]+d],[o[0]+d+1,o[1]]]}}function lc(o,s){const a=[1/0,1/0,-1/0,-1/0];if(!Uc(s,o.length))return a;for(let d=s[0];d<=s[1];++d)Vm(a,o[d]);return a}function Gm(o){const s=[1/0,1/0,-1/0,-1/0];for(let a=0;a<o.length;++a)for(let d=0;d<o[a].length;++d)Vm(s,o[a][d]);return s}function rl(o,s,a){if(uT(o)||uT(s))return NaN;let d=0,h=0;return o[2]<s[0]&&(d=s[0]-o[2]),o[0]>s[2]&&(d=o[0]-s[2]),o[1]>s[3]&&(h=o[1]-s[3]),o[3]<s[1]&&(h=s[1]-o[3]),a.distance([0,0],[d,h])}function Ui(o){return 360*o-180}function cc(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function gl(o,s){const a=Math.pow(2,s.z),d=(o.y/Jt+s.y)/a;return[Ui((o.x/Jt+s.x)/a),cc(d)]}function T_(o,s){const a=[];for(let d=0;d<o.length;++d)a.push(gl(o[d],s));return a}function Wm(o,s,a){const d=a.pointOnLine(s,o).point;return a.distance(o,d)}function up(o,s,a,d,h){const m=a.slice(d[0],d[1]+1);let _=1/0;for(let b=s[0];b<=s[1];++b)if(0===(_=Math.min(_,Wm(o[b],m,h))))return 0;return _}function Fa(o,s,a,d,h){const m=Math.min(h.pointToSegmentDistance(o,a,d),h.pointToSegmentDistance(s,a,d)),_=Math.min(h.pointToSegmentDistance(a,o,s),h.pointToSegmentDistance(d,o,s));return Math.min(m,_)}function qd(o,s,a,d,h){if(!Uc(s,o.length)||!Uc(d,a.length))return NaN;let m=1/0;for(let _=s[0];_<s[1];++_)for(let b=d[0];b<d[1];++b){if(ac(o[_],o[_+1],a[b],a[b+1]))return 0;m=Math.min(m,Fa(o[_],o[_+1],a[b],a[b+1],h))}return m}function dT(o,s,a,d,h){if(!Uc(s,o.length)||!Uc(d,a.length))return NaN;let m=1/0;for(let _=s[0];_<=s[1];++_)for(let b=d[0];b<=d[1];++b)if(0===(m=Math.min(m,h.distance(o[_],a[b]))))return m;return m}function j1(o,s,a){if(pl(o,s,!0))return 0;let d=1/0;for(const h of s){const m=h.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[m-1]&&0===(d=Math.min(d,a.pointToSegmentDistance(o,h[m-1],h[0])))||0===(d=Math.min(d,Wm(o,h,a))))return d}return d}function Ux(o,s,a,d){if(!Uc(s,o.length))return NaN;for(let m=s[0];m<=s[1];++m)if(pl(o[m],a,!0))return 0;let h=1/0;for(let m=s[0];m<s[1];++m)for(const _ of a)for(let b=0,T=_.length,S=T-1;b<T;S=b++){if(ac(o[m],o[m+1],_[S],_[b]))return 0;h=Math.min(h,Fa(o[m],o[m+1],_[S],_[b],d))}return h}function $1(o,s){for(const a of o)for(let d=0;d<=a.length-1;++d)if(pl(a[d],s,!0))return!0;return!1}function Zd(o,s,a,d=1/0){const h=Gm(o),m=Gm(s);if(d!==1/0&&rl(h,m,a)>=d)return d;if(Hd(h,m)){if($1(o,s))return 0}else if($1(s,o))return 0;let _=d;for(const b of o)for(let T=0,S=b.length,A=S-1;T<S;A=T++)for(const k of s)for(let N=0,z=k.length,H=z-1;N<z;H=N++){if(ac(b[A],b[T],k[H],k[N]))return 0;_=Math.min(_,Fa(b[A],b[T],k[H],k[N],a))}return _}function Xd(o,s,a,d,h,m,_){if(null===m||null===_)return;const b=rl(lc(d,m),lc(h,_),a);b<s&&o.push({dist:b,range1:m,range2:_})}function _l(o,s,a,d,h=1/0){let m=Math.min(d.distance(o[0],a[0][0]),h);if(0===m)return m;const _=new zc([{dist:0,range1:[0,o.length-1],range2:[0,0]}],x_),b=s?w_:b_,T=Gm(a);for(;_.length;){const S=_.pop();if(S.dist>=m)continue;const A=S.range1;if(Na(A)<=b){if(!Uc(A,o.length))return NaN;if(s){const k=Ux(o,A,a,d);if(0===(m=Math.min(m,k)))return m}else for(let k=A[0];k<=A[1];++k){const N=j1(o[k],a,d);if(0===(m=Math.min(m,N)))return m}}else{const k=Wd(A,s);if(null!==k[0]){const N=rl(lc(o,k[0]),T,d);N<m&&_.push({dist:N,range1:k[0],range2:[0,0]})}if(null!==k[1]){const N=rl(lc(o,k[1]),T,d);N<m&&_.push({dist:N,range1:k[1],range2:[0,0]})}}}return m}function qm(o,s,a,d,h,m=1/0){let _=Math.min(m,h.distance(o[0],a[0]));if(0===_)return _;const b=new zc([{dist:0,range1:[0,o.length-1],range2:[0,a.length-1]}],x_),T=s?w_:b_,S=d?w_:b_;for(;b.length;){const A=b.pop();if(A.dist>=_)continue;const k=A.range1,N=A.range2;if(Na(k)<=T&&Na(N)<=S){if(!Uc(k,o.length)||!Uc(N,a.length))return NaN;if(s&&d?_=Math.min(_,qd(o,k,a,N,h)):s||d?s&&!d?_=Math.min(_,up(a,N,o,k,h)):!s&&d&&(_=Math.min(_,up(o,k,a,N,h))):_=Math.min(_,dT(o,k,a,N,h)),0===_)return _}else{const z=Wd(k,s),H=Wd(N,d);Xd(b,_,h,o,a,z[0],H[0]),Xd(b,_,h,o,a,z[0],H[1]),Xd(b,_,h,o,a,z[1],H[0]),Xd(b,_,h,o,a,z[1],H[1])}}return _}function Zm(o,s,a,d,h=1/0){let m=h;const _=lc(o,[0,o.length-1]);for(const b of a)if(!(m!==1/0&&rl(_,lc(b,[0,b.length-1]),d)>=m)&&(m=Math.min(m,qm(o,s,b,!0,d,m)),0===m))return m;return m}function E_(o,s,a,d,h=1/0){let m=h;const _=lc(o,[0,o.length-1]);for(const b of a){if(m!==1/0&&rl(_,Gm(b),d)>=m)continue;const T=_l(o,s,b,d,m);if(isNaN(T))return T;if(0===(m=Math.min(m,T)))return m}return m}function H1(o){return"Point"===o||"MultiPoint"===o||"LineString"===o||"MultiLineString"===o||"Polygon"===o||"MultiPolygon"===o}class da{constructor(s,a){this.type=_n,this.geojson=s,this.geometries=a}static parse(s,a){if(2!==s.length)return a.error(`'distance' expression requires either one argument, but found ' ${s.length-1} instead.`);if(lu(s[1])){const d=s[1];if("FeatureCollection"===d.type){for(let h=0;h<d.features.length;++h)if(H1(d.features[h].geometry.type))return new da(d,d.features[h].geometry)}else if("Feature"===d.type){if(H1(d.geometry.type))return new da(d,d.geometry)}else if(H1(d.type))return new da(d,d)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(s){const a=s.geometry(),d=s.canonicalID();if(null!=a&&null!=d){if("Point"===s.geometryType())return function(h,m,_){const b=[];for(const S of h)for(const A of S)b.push(gl(A,m));const T=new Hm(b[0][1],"meters");return"Point"===_.type||"MultiPoint"===_.type||"LineString"===_.type?qm(b,!1,"Point"===_.type?[_.coordinates]:_.coordinates,"LineString"===_.type,T):"MultiLineString"===_.type?Zm(b,!1,_.coordinates,T):"Polygon"===_.type||"MultiPolygon"===_.type?E_(b,!1,"Polygon"===_.type?[_.coordinates]:_.coordinates,T):null}(a,d,this.geometries);if("LineString"===s.geometryType())return function(h,m,_){const b=[];for(const S of h){const A=[];for(const k of S)A.push(gl(k,m));b.push(A)}const T=new Hm(b[0][0][1],"meters");if("Point"===_.type||"MultiPoint"===_.type||"LineString"===_.type)return Zm("Point"===_.type?[_.coordinates]:_.coordinates,"LineString"===_.type,b,T);if("MultiLineString"===_.type){let S=1/0;for(let A=0;A<_.coordinates.length;A++){const k=Zm(_.coordinates[A],!0,b,T,S);if(isNaN(k))return k;if(0===(S=Math.min(S,k)))return S}return S}if("Polygon"===_.type||"MultiPolygon"===_.type){let S=1/0;for(let A=0;A<b.length;A++){const k=E_(b[A],!0,"Polygon"===_.type?[_.coordinates]:_.coordinates,T,S);if(isNaN(k))return k;if(0===(S=Math.min(S,k)))return S}return S}return null}(a,d,this.geometries);if("Polygon"===s.geometryType())return function(h,m,_){const b=[];for(const S of function(A,k){const N=A.length;if(N<=1)return[A];const z=[];let H,q;for(let X=0;X<N;X++){const ee=cT(A[X]);0!==ee&&(A[X].area=Math.abs(ee),void 0===q&&(q=ee<0),q===ee<0?(H&&z.push(H),H=[A[X]]):H.push(A[X]))}return H&&z.push(H),z}(h)){const A=[];for(let k=0;k<S.length;++k)A.push(T_(S[k],m));b.push(A)}const T=new Hm(b[0][0][0][1],"meters");if("Point"===_.type||"MultiPoint"===_.type||"LineString"===_.type)return E_("Point"===_.type?[_.coordinates]:_.coordinates,"LineString"===_.type,b,T);if("MultiLineString"===_.type){let S=1/0;for(let A=0;A<_.coordinates.length;A++){const k=E_(_.coordinates[A],!0,b,T,S);if(isNaN(k))return k;if(0===(S=Math.min(S,k)))return S}return S}return"Polygon"===_.type||"MultiPolygon"===_.type?function(S,A,k){let N=1/0;for(const z of S)for(const H of A){const q=Zd(z,H,k,N);if(isNaN(q))return q;if(0===(N=Math.min(N,q)))return N}return N}("Polygon"===_.type?[_.coordinates]:_.coordinates,b,T):null}(a,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Xm(o,s){switch(o){case"string":return Er(s);case"number":return+s;case"boolean":return!!s;case"color":return It.parse(s);case"formatted":return Ho.fromString(Er(s));case"resolvedImage":return fl.fromString(Er(s))}return s}function G1(o,s,a,d){return void 0!==d&&(o=d*Math.round(o/d)),void 0!==s&&o<s&&(o=s),void 0!==a&&o>a&&(o=a),o}class Yd{constructor(s,a,d){this.type=s,this.key=a,this.scope=d}static parse(s,a){let d=a.expectedType;if(null==d&&(d=qr),s.length<2||s.length>3)return a.error("Invalid number of arguments for 'config' expression.");const h=a.parse(s[1],1);if(!(h instanceof li))return a.error("Key name of 'config' expression must be a string literal.");if(s.length>=3){const m=a.parse(s[2],2);return m instanceof li?new Yd(d,Er(h.value),Er(m.value)):a.error("Scope of 'config' expression must be a string literal.")}return new Yd(d,Er(h.value))}evaluate(s){const a=[this.key,this.scope,s.scope].filter(Boolean).join("\x1f"),d=s.getConfig(a);if(!d)return null;const{type:h,value:m,values:_,minValue:b,maxValue:T,stepValue:S}=d,A=d.default.evaluate(s);let k=A;if(m){const N=s.scope;s.scope=(N||"").split("\x1f").slice(1).join("\x1f"),k=m.evaluate(s),s.scope=N}return h&&(k=Xm(h,k)),void 0===k||void 0===b&&void 0===T&&void 0===S||("number"==typeof k?k=G1(k,b,T,S):Array.isArray(k)&&(k=k.map(N=>"number"==typeof N?G1(N,b,T,S):N))),void 0!==m&&void 0!==k&&_&&!_.includes(k)&&(k=A,h&&(k=Xm(h,k))),(h&&h!==this.type||void 0!==k&&qs(k)!==this.type)&&(k=Xm(this.type.kind,k)),k}eachChild(){}outputDefined(){return!1}serialize(){const s=["config",this.key];return this.scope&&s.concat(this.key),s}}function Ym(o){if(o instanceof tl&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Hl||o instanceof da)return!1;let s=!0;return o.eachChild(a=>{s&&!Ym(a)&&(s=!1)}),s}function C_(o){if(o instanceof tl&&"feature-state"===o.name)return!1;let s=!0;return o.eachChild(a=>{s&&!C_(a)&&(s=!1)}),s}function Km(o){if(o instanceof Yd)return new Set([o.key]);let s=new Set;return o.eachChild(a=>{s=new Set([...s,...Km(a)])}),s}function dp(o,s){if(o instanceof tl&&s.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(d=>{a&&!dp(d,s)&&(a=!1)}),a}class Jm{constructor(s,a){this.type=a.type,this.name=s,this.boundExpression=a}static parse(s,a){if(2!==s.length||"string"!=typeof s[1])return a.error("'var' expression requires exactly one string literal argument.");const d=s[1];return a.scope.has(d)?new Jm(d,a.scope.get(d)):a.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class S_{constructor(s,a=[],d,h=new ap,m=[],_,b){this.registry=s,this.path=a,this.key=a.map(T=>`[${T}]`).join(""),this.scope=h,this.errors=m,this.expectedType=d,this._scope=_,this.options=b}parse(s,a,d,h,m={}){return a||d?this.concat(a,d,h)._parse(s,m):this._parse(s,m)}_parse(s,a){function d(h,m,_){return"assert"===_?new $l(m,[h]):"coerce"===_?new Lc(m,[h]):h}if(null!==s&&"string"!=typeof s&&"boolean"!=typeof s&&"number"!=typeof s||(s=["literal",s]),Array.isArray(s)){if(0===s.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h="string"==typeof s[0]?this.registry[s[0]]:void 0;if(h){let m=h.parse(s,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,b=m.type;if("string"!==_.kind&&"number"!==_.kind&&"boolean"!==_.kind&&"object"!==_.kind&&"array"!==_.kind||"value"!==b.kind)if("color"!==_.kind&&"formatted"!==_.kind&&"resolvedImage"!==_.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(_,b))return null}else m=d(m,_,a.typeAnnotation||"coerce");else m=d(m,_,a.typeAnnotation||"assert")}if(!(m instanceof li)&&"resolvedImage"!==m.type.kind&&Lr(m)){const _=new Ra(this._scope,this.options);try{m=new li(m.type,m.evaluate(_))}catch(b){return this.error(b.message),null}}return m}return Lc.parse(["to-array",s],this)}return this.error(void 0===s?"'undefined' value invalid. Use null instead.":"object"==typeof s?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,a,d){const h="number"==typeof s?this.path.concat(s):this.path,m=d?this.scope.concat(d):this.scope;return new S_(this.registry,h,a||null,m,this.errors,this._scope,this.options)}error(s,...a){const d=`${this.key}${a.map(h=>`[${h}]`).join("")}`;this.errors.push(new ou(d,s))}checkSubtype(s,a){const d=g_(s,a);return d&&this.error(d),d}}var Vx=S_;function Lr(o){if(o instanceof Jm)return Lr(o.boundExpression);if(o instanceof tl&&"error"===o.name||o instanceof __||o instanceof Hl||o instanceof da||o instanceof Yd)return!1;const s=o instanceof Lc||o instanceof $l;let a=!0;return o.eachChild(d=>{a=s?a&&Lr(d):a&&d instanceof li}),!!a&&Ym(o)&&dp(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function hf(o,s){const a=o.length-1;let d,h,m=0,_=a,b=0;for(;m<=_;)if(b=Math.floor((m+_)/2),d=o[b],h=o[b+1],d<=s){if(b===a||s<h)return b;m=b+1}else{if(!(d>s))throw new To("Input is not a number.");_=b-1}return 0}class hp{constructor(s,a,d){this.type=s,this.input=a,this.labels=[],this.outputs=[];for(const[h,m]of d)this.labels.push(h),this.outputs.push(m)}static parse(s,a){if(s.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return a.error("Expected an even number of arguments.");const d=a.parse(s[1],1,_n);if(!d)return null;const h=[];let m=null;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);for(let _=1;_<s.length;_+=2){const b=1===_?-1/0:s[_],T=s[_+1],S=_,A=_+1;if("number"!=typeof b)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const k=a.parse(T,A,m);if(!k)return null;m=m||k.type,h.push([b,k])}return new hp(m,d,h)}evaluate(s){const a=this.labels,d=this.outputs;if(1===a.length)return d[0].evaluate(s);const h=this.input.evaluate(s);if(h<=a[0])return d[0].evaluate(s);const m=a.length;return h>=a[m-1]?d[m-1].evaluate(s):d[hf(a,h)].evaluate(s)}eachChild(s){s(this.input);for(const a of this.outputs)s(a)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){const s=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&s.push(this.labels[a]),s.push(this.outputs[a].serialize());return s}}const Sn=4/29,uo=6/29,di=3*uo*uo,ko=uo*uo*uo,ha=Math.PI/180,Kd=180/Math.PI;function Oo(o){return o>ko?Math.pow(o,1/3):o/di+Sn}function M_(o){return o>uo?o*o*o:di*(o-Sn)}function A_(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function fp(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function jx(o){const s=fp(o.r),a=fp(o.g),d=fp(o.b),h=Oo((.4124564*s+.3575761*a+.1804375*d)/.95047),m=Oo((.2126729*s+.7151522*a+.072175*d)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Oo((.0193339*s+.119192*a+.9503041*d)/1.08883)),alpha:o.a}}function $x(o){let s=(o.l+16)/116,a=isNaN(o.a)?s:s+o.a/500,d=isNaN(o.b)?s:s-o.b/200;return s=1*M_(s),a=.95047*M_(a),d=1.08883*M_(d),new It(A_(3.2404542*a-1.5371385*s-.4985314*d),A_(-.969266*a+1.8760108*s+.041556*d),A_(.0556434*a-.2040259*s+1.0572252*d),o.alpha)}function Qm(o,s,a){const d=s-o;return o+a*(d>180||d<-180?d-360*Math.round(d/360):d)}const eg={forward:jx,reverse:$x,interpolate:function(o,s,a){return{l:dn(o.l,s.l,a),a:dn(o.a,s.a,a),b:dn(o.b,s.b,a),alpha:dn(o.alpha,s.alpha,a)}}},ff={forward:function(o){const{l:s,a,b:d}=jx(o),h=Math.atan2(d,a)*Kd;return{h:h<0?h+360:h,c:Math.sqrt(a*a+d*d),l:s,alpha:o.a}},reverse:function(o){const s=o.h*ha,a=o.c;return $x({l:o.l,a:Math.cos(s)*a,b:Math.sin(s)*a,alpha:o.alpha})},interpolate:function(o,s,a){return{h:Qm(o.h,s.h,a),c:dn(o.c,s.c,a),l:dn(o.l,s.l,a),alpha:dn(o.alpha,s.alpha,a)}}};var pp=Object.freeze({__proto__:null,hcl:ff,lab:eg});class La{constructor(s,a,d,h,m){this.type=s,this.operator=a,this.interpolation=d,this.input=h,this.labels=[],this.outputs=[];for(const[_,b]of m)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(s,a,d,h){let m=0;if("exponential"===s.name)m=Hx(a,s.base,d,h);else if("linear"===s.name)m=Hx(a,1,d,h);else if("cubic-bezier"===s.name){const _=s.controlPoints;m=new Tx(_[0],_[1],_[2],_[3]).solve(Hx(a,1,d,h))}return m}static parse(s,a){let[d,h,m,..._]=s;if(!Array.isArray(h)||0===h.length)return a.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const S=h[1];if("number"!=typeof S)return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if("cubic-bezier"!==h[0])return a.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const S=h.slice(1);if(4!==S.length||S.some(A=>"number"!=typeof A||A<0||A>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(s.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(m=a.parse(m,2,_n),!m)return null;const b=[];let T=null;"interpolate-hcl"===d||"interpolate-lab"===d?T=vn:a.expectedType&&"value"!==a.expectedType.kind&&(T=a.expectedType);for(let S=0;S<_.length;S+=2){const A=_[S],k=_[S+1],N=S+3,z=S+4;if("number"!=typeof A)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(b.length&&b[b.length-1][0]>=A)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const H=a.parse(k,z,T);if(!H)return null;T=T||H.type,b.push([A,H])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new La(T,d,h,m,b):a.error(`Type ${Fs(T)} is not interpolatable.`)}evaluate(s){const a=this.labels,d=this.outputs;if(1===a.length)return d[0].evaluate(s);const h=this.input.evaluate(s);if(h<=a[0])return d[0].evaluate(s);const m=a.length;if(h>=a[m-1])return d[m-1].evaluate(s);const _=hf(a,h),b=La.interpolationFactor(this.interpolation,h,a[_],a[_+1]),T=d[_].evaluate(s),S=d[_+1].evaluate(s);return"interpolate"===this.operator?Bm[this.type.kind.toLowerCase()](T,S,b):"interpolate-hcl"===this.operator?ff.reverse(ff.interpolate(ff.forward(T),ff.forward(S),b)):eg.reverse(eg.interpolate(eg.forward(T),eg.forward(S),b))}eachChild(s){s(this.input);for(const a of this.outputs)s(a)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){let s;s="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,s,this.input.serialize()];for(let d=0;d<this.labels.length;d++)a.push(this.labels[d],this.outputs[d].serialize());return a}}function Hx(o,s,a,d){const h=d-a,m=o-a;return 0===h?0:1===s?m/h:(Math.pow(s,m)-1)/(Math.pow(s,h)-1)}class qu{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expectected at least one argument.");let d=null;const h=a.expectedType;h&&"value"!==h.kind&&(d=h);const m=[];for(const b of s.slice(1)){const T=a.parse(b,1+m.length,d,void 0,{typeAnnotation:"omit"});if(!T)return null;d=d||T.type,m.push(T)}const _=h&&m.some(b=>g_(h,b.type));return new qu(_?qr:d,m)}evaluate(s){let a,d=null,h=0;for(const m of this.args){if(h++,d=m.evaluate(s),d&&d instanceof fl&&!d.available&&(a||(a=d),d=null,h===this.args.length))return a;if(null!==d)break}return d}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=["coalesce"];return this.eachChild(a=>{s.push(a.serialize())}),s}}class I_{constructor(s,a){this.type=a.type,this.bindings=[].concat(s),this.result=a}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const a of this.bindings)s(a[1]);s(this.result)}static parse(s,a){if(s.length<4)return a.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const d=[];for(let m=1;m<s.length-1;m+=2){const _=s[m];if("string"!=typeof _)return a.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=a.parse(s[m+1],m+1);if(!b)return null;d.push([_,b])}const h=a.parse(s[s.length-1],s.length-1,a.expectedType,d);return h?new I_(d,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const s=["let"];for(const[a,d]of this.bindings)s.push(a,d.serialize());return s.push(this.result.serialize()),s}}class mp{constructor(s,a,d){this.type=s,this.index=a,this.input=d}static parse(s,a){if(3!==s.length)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const d=a.parse(s[1],1,_n),h=a.parse(s[2],2,Io(a.expectedType||qr));return d&&h?new mp(h.type.itemType,d,h):null}evaluate(s){const a=this.index.evaluate(s),d=this.input.evaluate(s);if(a<0)throw new To(`Array index out of bounds: ${a} < 0.`);if(a>=d.length)throw new To(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a!==Math.floor(a))throw new To(`Array index must be an integer, but found ${a} instead.`);return d[a]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class k_{constructor(s,a){this.type=si,this.needle=s,this.haystack=a}static parse(s,a){if(3!==s.length)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const d=a.parse(s[1],1,qr),h=a.parse(s[2],2,qr);return d&&h?Fc(d.type,[si,Fr,_n,Pa,qr])?new k_(d,h):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(d.type)} instead`):null}evaluate(s){const a=this.needle.evaluate(s),d=this.haystack.evaluate(s);if(null==d)return!1;if(!cf(a,["boolean","string","number","null"]))throw new To(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(qs(a))} instead.`);if(!cf(d,["string","array"]))throw new To(`Expected second argument to be of type array or string, but found ${Fs(qs(d))} instead.`);return d.indexOf(a)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class gp{constructor(s,a,d){this.type=_n,this.needle=s,this.haystack=a,this.fromIndex=d}static parse(s,a){if(s.length<=2||s.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const d=a.parse(s[1],1,qr),h=a.parse(s[2],2,qr);if(!d||!h)return null;if(!Fc(d.type,[si,Fr,_n,Pa,qr]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(d.type)} instead`);if(4===s.length){const m=a.parse(s[3],3,_n);return m?new gp(d,h,m):null}return new gp(d,h)}evaluate(s){const a=this.needle.evaluate(s),d=this.haystack.evaluate(s);if(!cf(a,["boolean","string","number","null"]))throw new To(`Expected first argument to be of type boolean, string, number or null, but found ${Fs(qs(a))} instead.`);if(!cf(d,["string","array"]))throw new To(`Expected second argument to be of type array or string, but found ${Fs(qs(d))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(s);return d.indexOf(a,h)}return d.indexOf(a)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class uu{constructor(s,a,d,h,m,_){this.inputType=s,this.type=a,this.input=d,this.cases=h,this.outputs=m,this.otherwise=_}static parse(s,a){if(s.length<5)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return a.error("Expected an even number of arguments.");let d,h;a.expectedType&&"value"!==a.expectedType.kind&&(h=a.expectedType);const m={},_=[];for(let S=2;S<s.length-1;S+=2){let A=s[S];const k=s[S+1];Array.isArray(A)||(A=[A]);const N=a.concat(S);if(0===A.length)return N.error("Expected at least one branch label.");for(const H of A){if("number"!=typeof H&&"string"!=typeof H)return N.error("Branch labels must be numbers or strings.");if("number"==typeof H&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof H&&Math.floor(H)!==H)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,qs(H)))return null}else d=qs(H);if(void 0!==m[String(H)])return N.error("Branch labels must be unique.");m[String(H)]=_.length}const z=a.parse(k,S,h);if(!z)return null;h=h||z.type,_.push(z)}const b=a.parse(s[1],1,qr);if(!b)return null;const T=a.parse(s[s.length-1],s.length-1,h);return T?"value"!==b.type.kind&&a.concat(1).checkSubtype(d,b.type)?null:new uu(d,h,b,m,_,T):null}evaluate(s){const a=this.input.evaluate(s);return(qs(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),d=[],h={};for(const _ of a){const b=h[this.cases[_]];void 0===b?(h[this.cases[_]]=d.length,d.push([this.cases[_],[_]])):d[b][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,b]of d)s.push(1===b.length?m(b[0]):b.map(m)),s.push(this.outputs[_].serialize());return s.push(this.otherwise.serialize()),s}}class O_{constructor(s,a,d){this.type=s,this.branches=a,this.otherwise=d}static parse(s,a){if(s.length<4)return a.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return a.error("Expected an odd number of arguments.");let d;a.expectedType&&"value"!==a.expectedType.kind&&(d=a.expectedType);const h=[];for(let _=1;_<s.length-1;_+=2){const b=a.parse(s[_],_,si);if(!b)return null;const T=a.parse(s[_+1],_+1,d);if(!T)return null;h.push([b,T]),d=d||T.type}const m=a.parse(s[s.length-1],s.length-1,d);return m?new O_(d,h,m):null}evaluate(s){for(const[a,d]of this.branches)if(a.evaluate(s))return d.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[a,d]of this.branches)s(a),s(d);s(this.otherwise)}outputDefined(){return this.branches.every(([s,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["case"];return this.eachChild(a=>{s.push(a.serialize())}),s}}class pf{constructor(s,a,d,h){this.type=s,this.input=a,this.beginIndex=d,this.endIndex=h}static parse(s,a){if(s.length<=2||s.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const d=a.parse(s[1],1,qr),h=a.parse(s[2],2,_n);if(!d||!h)return null;if(!Fc(d.type,[Io(qr),Fr,qr]))return a.error(`Expected first argument to be of type array or string, but found ${Fs(d.type)} instead`);if(4===s.length){const m=a.parse(s[3],3,_n);return m?new pf(d.type,d,h,m):null}return new pf(d.type,d,h)}evaluate(s){const a=this.input.evaluate(s),d=this.beginIndex.evaluate(s);if(!cf(a,["string","array"]))throw new To(`Expected first argument to be of type array or string, but found ${Fs(qs(a))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(s);return a.slice(d,h)}return a.slice(d)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function mf(o,s){return"=="===o||"!="===o?"boolean"===s.kind||"string"===s.kind||"number"===s.kind||"null"===s.kind||"value"===s.kind:"string"===s.kind||"number"===s.kind||"value"===s.kind}function P_(o,s,a,d){return 0===d.compare(s,a)}function Jd(o,s,a){const d="=="!==o&&"!="!==o;return class Sq{constructor(m,_,b){this.type=si,this.lhs=m,this.rhs=_,this.collator=b,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const b=m[0];let T=_.parse(m[1],1,qr);if(!T)return null;if(!mf(b,T.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${Fs(T.type)}'.`);let S=_.parse(m[2],2,qr);if(!S)return null;if(!mf(b,S.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${Fs(S.type)}'.`);if(T.type.kind!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return _.error(`Cannot compare types '${Fs(T.type)}' and '${Fs(S.type)}'.`);d&&("value"===T.type.kind&&"value"!==S.type.kind?T=new $l(S.type,[T]):"value"!==T.type.kind&&"value"===S.type.kind&&(S=new $l(T.type,[S])));let A=null;if(4===m.length){if("string"!==T.type.kind&&"string"!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return _.error("Cannot use collator to compare non-string types.");if(A=_.parse(m[3],3,zm),!A)return null}return new Sq(T,S,A)}evaluate(m){const _=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(d&&this.hasUntypedArgument){const T=qs(_),S=qs(b);if(T.kind!==S.kind||"string"!==T.kind&&"number"!==T.kind)throw new To(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const T=qs(_),S=qs(b);if("string"!==T.kind||"string"!==S.kind)return s(m,_,b)}return this.collator?a(m,_,b,this.collator.evaluate(m)):s(m,_,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const R_=Jd("==",function(o,s,a){return s===a},P_),Go=Jd("!=",function(o,s,a){return s!==a},function(o,s,a,d){return!P_(0,s,a,d)}),_p=Jd("<",function(o,s,a){return s<a},function(o,s,a,d){return d.compare(s,a)<0}),W1=Jd(">",function(o,s,a){return s>a},function(o,s,a,d){return d.compare(s,a)>0}),hT=Jd("<=",function(o,s,a){return s<=a},function(o,s,a,d){return d.compare(s,a)<=0}),fT=Jd(">=",function(o,s,a){return s>=a},function(o,s,a,d){return d.compare(s,a)>=0});class N_{constructor(s,a,d,h,m,_){this.type=Fr,this.number=s,this.locale=a,this.currency=d,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(s,a){if(3!==s.length)return a.error("Expected two arguments.");const d=a.parse(s[1],1,_n);if(!d)return null;const h=s[2];if("object"!=typeof h||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=a.parse(h.locale,1,Fr),!m))return null;let _=null;if(h.currency&&(_=a.parse(h.currency,1,Fr),!_))return null;let b=null;if(h.unit&&(b=a.parse(h.unit,1,Fr),!b))return null;let T=null;if(h["min-fraction-digits"]&&(T=a.parse(h["min-fraction-digits"],1,_n),!T))return null;let S=null;return h["max-fraction-digits"]&&(S=a.parse(h["max-fraction-digits"],1,_n),!S)?null:new N_(d,m,_,b,T,S)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(s):void 0,unit:this.unit?this.unit.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.unit&&s(this.unit),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.unit&&(s.unit=this.unit.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]}}class Qd{constructor(s){this.type=_n,this.input=s}static parse(s,a){if(2!==s.length)return a.error(`Expected 1 argument, but found ${s.length-1} instead.`);const d=a.parse(s[1],1);return d?"array"!==d.type.kind&&"string"!==d.type.kind&&"value"!==d.type.kind?a.error(`Expected argument of type string or array, but found ${Fs(d.type)} instead.`):new Qd(d):null}evaluate(s){const a=this.input.evaluate(s);if("string"==typeof a||Array.isArray(a))return a.length;throw new To(`Expected value to be of type string or array, but found ${Fs(qs(a))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}serialize(){const s=["length"];return this.eachChild(a=>{s.push(a.serialize())}),s}}function Gx(o){return function(){o=1831565813+(o|=0)|0;let s=Math.imul(o^o>>>15,1|o);return s=s+Math.imul(s^s>>>7,61|s)^s,((s^s>>>14)>>>0)/4294967296}}const yp={"==":R_,"!=":Go,">":W1,"<":_p,">=":fT,"<=":hT,array:$l,at:mp,boolean:$l,case:O_,coalesce:qu,collator:__,format:cp,image:Wu,in:k_,"index-of":gp,interpolate:La,"interpolate-hcl":La,"interpolate-lab":La,length:Qd,let:I_,literal:li,match:uu,number:$l,"number-format":N_,object:$l,slice:pf,step:hp,string:$l,"to-boolean":Lc,"to-color":Lc,"to-number":Lc,"to-string":Lc,var:Jm,within:Hl,distance:da,config:Yd};function Wx(o,[s,a,d,h]){s=s.evaluate(o),a=a.evaluate(o),d=d.evaluate(o);const m=h?h.evaluate(o):1,_=au(s,a,d,m);if(_)throw new To(_);return new It(s/255*m,a/255*m,d/255*m,m)}function q1(o,[s,a,d,h]){s=s.evaluate(o),a=a.evaluate(o),d=d.evaluate(o);const m=h?h.evaluate(o):1,_=(A=a,k=d,N=m,"number"==typeof(S=s)&&S>=0&&S<=360?"number"==typeof A&&A>=0&&A<=100&&"number"==typeof k&&k>=0&&k<=100?void 0===N||"number"==typeof N&&N>=0&&N<=1?null:`Invalid hsla value [${[S,A,k,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof N?[S,A,k,N]:[S,A,k]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof N?[S,A,k,N]:[S,A,k]).join(", ")}]: 'h' must be between 0 and 360.`);var S,A,k,N;if(_)throw new To(_);const b=`hsla(${s}, ${a}%, ${d}%, ${m})`,T=It.parse(b);if(!T)throw new To(`Failed to parse HSLA color: ${b}`);return T}function y(o,s){return o in s}function c(o,s){const a=s[o];return void 0===a?null:a}function p(o){return{type:o}}function v(o){return{result:"success",value:o}}function w(o){return{result:"error",value:o}}function C(o,s){return!!o&&!!o.parameters&&o.parameters.indexOf(s)>-1}function M(o){return"data-driven"===o["property-type"]}function I(o){return C(o.expression,"measure-light")}function F(o){return C(o.expression,"zoom")}function B(o){return!!o.expression&&o.expression.interpolated}function j(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function Z(o){return o}function K(o,s){const a="color"===s.type,d=o.stops&&"object"==typeof o.stops[0][0],h=d||!(d||void 0!==o.property),m=o.type||(B(s)?"exponential":"interval");if(a&&((o=af({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],It.parse(S[1])])),o.default=It.parse(o.default?o.default:s.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!pp[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let _,b,T;if("exponential"===m)_=ie;else if("interval"===m)_=re;else if("categorical"===m){_=ne,b=Object.create(null);for(const S of o.stops)b[S[0]]=S[1];T=typeof o.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=se}if(d){const S={},A=[];for(let z=0;z<o.stops.length;z++){const H=o.stops[z],q=H[0].zoom;void 0===S[q]&&(S[q]={zoom:q,type:o.type,property:o.property,default:o.default,stops:[]},A.push(q)),S[q].stops.push([H[0].value,H[1]])}const k=[];for(const z of A)k.push([S[z].zoom,K(S[z],s)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:La.interpolationFactor.bind(void 0,N),zoomStops:k.map(z=>z[0]),evaluate:({zoom:z},H)=>ie({stops:k,base:o.base},s,z).evaluate(z,H)}}if(h){const S="exponential"===m?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:La.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(A=>A[0]),evaluate:({zoom:A})=>_(o,s,A,b,T)}}return{kind:"source",evaluate(S,A){const k=A&&A.properties?A.properties[o.property]:void 0;return void 0===k?J(o.default,s.default):_(o,s,k,b,T)}}}function J(o,s,a){return void 0!==o?o:void 0!==s?s:void 0!==a?a:void 0}function ne(o,s,a,d,h){return J(typeof a===h?d[a]:void 0,o.default,s.default)}function re(o,s,a){if("number"!==cu(a))return J(o.default,s.default);const d=o.stops.length;if(1===d||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[d-1][0])return o.stops[d-1][1];const h=hf(o.stops.map(m=>m[0]),a);return o.stops[h][1]}function ie(o,s,a){const d=void 0!==o.base?o.base:1;if("number"!==cu(a))return J(o.default,s.default);const h=o.stops.length;if(1===h||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[h-1][0])return o.stops[h-1][1];const m=hf(o.stops.map(A=>A[0]),a),_=function(A,k,N,z){const H=z-N,q=A-N;return 0===H?0:1===k?q/H:(Math.pow(k,q)-1)/(Math.pow(k,H)-1)}(a,d,o.stops[m][0],o.stops[m+1][0]),b=o.stops[m][1],T=o.stops[m+1][1];let S=Bm[s.type]||Z;if(o.colorSpace&&"rgb"!==o.colorSpace){const A=pp[o.colorSpace];S=(k,N)=>A.reverse(A.interpolate(A.forward(k),A.forward(N),_))}return"function"==typeof b.evaluate?{evaluate(...A){const k=b.evaluate.apply(void 0,A),N=T.evaluate.apply(void 0,A);if(void 0!==k&&void 0!==N)return S(k,N,_)}}:S(b,T,_)}function se(o,s,a){return"color"===s.type?a=It.parse(a):"formatted"===s.type?a=Ho.fromString(a.toString()):"resolvedImage"===s.type?a=fl.fromString(a.toString()):cu(a)===s.type||"enum"===s.type&&s.values[a]||(a=void 0),J(a,o.default,s.default)}tl.register(yp,{error:[{kind:"error"},[Fr],(o,[s])=>{throw new To(s.evaluate(o))}],typeof:[Fr,[qr],(o,[s])=>Fs(qs(s.evaluate(o)))],"to-rgba":[Io(_n,4),[vn],(o,[s])=>s.evaluate(o).toRenderColor(null).toArray()],rgb:[vn,[_n,_n,_n],Wx],rgba:[vn,[_n,_n,_n,_n],Wx],hsl:[vn,[_n,_n,_n],q1],hsla:[vn,[_n,_n,_n,_n],q1],has:{type:si,overloads:[[[Fr],(o,[s])=>y(s.evaluate(o),o.properties())],[[Fr,Ud],(o,[s,a])=>y(s.evaluate(o),a.evaluate(o))]]},get:{type:qr,overloads:[[[Fr],(o,[s])=>c(s.evaluate(o),o.properties())],[[Fr,Ud],(o,[s,a])=>c(s.evaluate(o),a.evaluate(o))]]},"feature-state":[qr,[Fr],(o,[s])=>c(s.evaluate(o),o.featureState||{})],properties:[Ud,[],o=>o.properties()],"geometry-type":[Fr,[],o=>o.geometryType()],id:[qr,[],o=>o.id()],zoom:[_n,[],o=>o.globals.zoom],pitch:[_n,[],o=>o.globals.pitch||0],"distance-from-center":[_n,[],o=>o.distanceFromCenter()],"measure-light":[_n,[Fr],(o,[s])=>o.measureLight(s.evaluate(o))],"heatmap-density":[_n,[],o=>o.globals.heatmapDensity||0],"line-progress":[_n,[],o=>o.globals.lineProgress||0],"raster-value":[_n,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[_n,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[_n,[],o=>o.globals.skyRadialProgress||0],accumulated:[qr,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[_n,p(_n),(o,s)=>{let a=0;for(const d of s)a+=d.evaluate(o);return a}],"*":[_n,p(_n),(o,s)=>{let a=1;for(const d of s)a*=d.evaluate(o);return a}],"-":{type:_n,overloads:[[[_n,_n],(o,[s,a])=>s.evaluate(o)-a.evaluate(o)],[[_n],(o,[s])=>-s.evaluate(o)]]},"/":[_n,[_n,_n],(o,[s,a])=>s.evaluate(o)/a.evaluate(o)],"%":[_n,[_n,_n],(o,[s,a])=>s.evaluate(o)%a.evaluate(o)],ln2:[_n,[],()=>Math.LN2],pi:[_n,[],()=>Math.PI],e:[_n,[],()=>Math.E],"^":[_n,[_n,_n],(o,[s,a])=>Math.pow(s.evaluate(o),a.evaluate(o))],sqrt:[_n,[_n],(o,[s])=>Math.sqrt(s.evaluate(o))],log10:[_n,[_n],(o,[s])=>Math.log(s.evaluate(o))/Math.LN10],ln:[_n,[_n],(o,[s])=>Math.log(s.evaluate(o))],log2:[_n,[_n],(o,[s])=>Math.log(s.evaluate(o))/Math.LN2],sin:[_n,[_n],(o,[s])=>Math.sin(s.evaluate(o))],cos:[_n,[_n],(o,[s])=>Math.cos(s.evaluate(o))],tan:[_n,[_n],(o,[s])=>Math.tan(s.evaluate(o))],asin:[_n,[_n],(o,[s])=>Math.asin(s.evaluate(o))],acos:[_n,[_n],(o,[s])=>Math.acos(s.evaluate(o))],atan:[_n,[_n],(o,[s])=>Math.atan(s.evaluate(o))],min:[_n,p(_n),(o,s)=>Math.min(...s.map(a=>a.evaluate(o)))],max:[_n,p(_n),(o,s)=>Math.max(...s.map(a=>a.evaluate(o)))],abs:[_n,[_n],(o,[s])=>Math.abs(s.evaluate(o))],round:[_n,[_n],(o,[s])=>{const a=s.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[_n,[_n],(o,[s])=>Math.floor(s.evaluate(o))],ceil:[_n,[_n],(o,[s])=>Math.ceil(s.evaluate(o))],"filter-==":[si,[Fr,qr],(o,[s,a])=>o.properties()[s.value]===a.value],"filter-id-==":[si,[qr],(o,[s])=>o.id()===s.value],"filter-type-==":[si,[Fr],(o,[s])=>o.geometryType()===s.value],"filter-<":[si,[Fr,qr],(o,[s,a])=>{const d=o.properties()[s.value],h=a.value;return typeof d==typeof h&&d<h}],"filter-id-<":[si,[qr],(o,[s])=>{const a=o.id(),d=s.value;return typeof a==typeof d&&a<d}],"filter->":[si,[Fr,qr],(o,[s,a])=>{const d=o.properties()[s.value],h=a.value;return typeof d==typeof h&&d>h}],"filter-id->":[si,[qr],(o,[s])=>{const a=o.id(),d=s.value;return typeof a==typeof d&&a>d}],"filter-<=":[si,[Fr,qr],(o,[s,a])=>{const d=o.properties()[s.value],h=a.value;return typeof d==typeof h&&d<=h}],"filter-id-<=":[si,[qr],(o,[s])=>{const a=o.id(),d=s.value;return typeof a==typeof d&&a<=d}],"filter->=":[si,[Fr,qr],(o,[s,a])=>{const d=o.properties()[s.value],h=a.value;return typeof d==typeof h&&d>=h}],"filter-id->=":[si,[qr],(o,[s])=>{const a=o.id(),d=s.value;return typeof a==typeof d&&a>=d}],"filter-has":[si,[qr],(o,[s])=>s.value in o.properties()],"filter-has-id":[si,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[si,[Io(Fr)],(o,[s])=>s.value.indexOf(o.geometryType())>=0],"filter-id-in":[si,[Io(qr)],(o,[s])=>s.value.indexOf(o.id())>=0],"filter-in-small":[si,[Fr,Io(qr)],(o,[s,a])=>a.value.indexOf(o.properties()[s.value])>=0],"filter-in-large":[si,[Fr,Io(qr)],(o,[s,a])=>function(d,h,m,_){for(;m<=_;){const b=m+_>>1;if(h[b]===d)return!0;h[b]>d?_=b-1:m=b+1}return!1}(o.properties()[s.value],a.value,0,a.value.length-1)],all:{type:si,overloads:[[[si,si],(o,[s,a])=>s.evaluate(o)&&a.evaluate(o)],[p(si),(o,s)=>{for(const a of s)if(!a.evaluate(o))return!1;return!0}]]},any:{type:si,overloads:[[[si,si],(o,[s,a])=>s.evaluate(o)||a.evaluate(o)],[p(si),(o,s)=>{for(const a of s)if(a.evaluate(o))return!0;return!1}]]},"!":[si,[si],(o,[s])=>!s.evaluate(o)],"is-supported-script":[si,[Fr],(o,[s])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(s.evaluate(o))}],upcase:[Fr,[Fr],(o,[s])=>s.evaluate(o).toUpperCase()],downcase:[Fr,[Fr],(o,[s])=>s.evaluate(o).toLowerCase()],concat:[Fr,p(qr),(o,s)=>s.map(a=>Er(a.evaluate(o))).join("")],"resolved-locale":[Fr,[zm],(o,[s])=>s.evaluate(o).resolvedLocale()],random:[_n,[_n,_n,qr],(o,s)=>{const[a,d,h]=s.map(_=>_.evaluate(o));if(a>d||a===d)return a;let m;if("string"==typeof h)m=function(_){let b=0;if(0===_.length)return b;for(let T=0;T<_.length;T++)b=(b<<5)-b+_.charCodeAt(T),b|=0;return b}(h);else{if("number"!=typeof h)throw new To(`Invalid seed input: ${h}`);m=h}return a+Gx(m)()*(d-a)}]});class ge{constructor(s,a,d,h){var m;this.expression=s,this._warningHistory={},this._evaluator=new Ra(d,h),this._defaultValue=a?"color"===(m=a).type&&(j(m.default)||Array.isArray(m.default))?new It(0,0,0,0):"color"===m.type?It.parse(m.default)||null:void 0===m.default?null:m.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(s,a,d,h,m,_,b,T){return this._evaluator.globals=s,this._evaluator.feature=a,this._evaluator.featureState=d,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(s,a,d,h,m,_,b,T){this._evaluator.globals=s,this._evaluator.feature=a||null,this._evaluator.featureState=d||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null;try{const S=this.expression.evaluate(this._evaluator);if(null==S||"number"==typeof S&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new To(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function ae(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in yp}function ce(o,s,a,d){const h=new Vx(yp,[],s?function(_){const b={color:vn,string:Fr,number:_n,enum:Fr,boolean:si,formatted:Vd,resolvedImage:lf};return"array"===_.type?Io(b[_.value]||qr,_.length):b[_.type]}(s):void 0,void 0,void 0,a,d),m=h.parse(o,void 0,void 0,void 0,s&&"string"===s.type?{typeAnnotation:"coerce"}:void 0);return m?v(new ge(m,s,a,d)):w(h.errors)}class xe{constructor(s,a,d){this.kind=s,this._styleExpression=a,this.isLightConstant=d,this.isStateDependent="constant"!==s&&!C_(a.expression),this.configDependencies=Km(a.expression)}evaluateWithoutErrorHandling(s,a,d,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(s,a,d,h,m,_)}evaluate(s,a,d,h,m,_){return this._styleExpression.evaluate(s,a,d,h,m,_)}}class ve{constructor(s,a,d,h,m){this.kind=s,this.zoomStops=d,this._styleExpression=a,this.isStateDependent="camera"!==s&&!C_(a.expression),this.isLightConstant=m,this.configDependencies=Km(a.expression),this.interpolationType=h}evaluateWithoutErrorHandling(s,a,d,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(s,a,d,h,m,_)}evaluate(s,a,d,h,m,_){return this._styleExpression.evaluate(s,a,d,h,m,_)}interpolationFactor(s,a,d){return this.interpolationType?La.interpolationFactor(this.interpolationType,s,a,d):0}}function ye(o,s,a,d){if("error"===(o=ce(o,s,a,d)).result)return o;const h=o.value.expression,m=Ym(h);if(!m&&!M(s))return w([new ou("","data expressions not supported")]);const _=dp(h,["zoom","pitch","distance-from-center"]);if(!_&&!F(s))return w([new ou("","zoom expressions not supported")]);const b=dp(h,["measure-light"]);if(!b&&!I(s))return w([new ou("","measure-light expression not supported")]);const T=s.expression&&s.expression.relaxZoomRestriction,S=Me(h);return S||_||T?S instanceof ou?w([S]):S instanceof La&&!B(s)?w([new ou("",'"interpolate" expressions cannot be used with this property')]):v(S?new ve(m?"camera":"composite",o.value,S.labels,S instanceof La?S.interpolation:void 0,b):new xe(m?"constant":"source",o.value,b)):w([new ou("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ce{constructor(s,a){this._parameters=s,this._specification=a,af(this,K(this._parameters,this._specification))}static deserialize(s){return new Ce(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Me(o){let s=null;if(o instanceof I_)s=Me(o.result);else if(o instanceof qu){for(const a of o.args)if(s=Me(a),s)break}else(o instanceof hp||o instanceof La)&&o.input instanceof tl&&"zoom"===o.input.name&&(s=o);return s instanceof ou||o.eachChild(a=>{const d=Me(a);d instanceof ou?s=d:s&&d&&s!==d&&(s=new ou("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}var Le=we,Se=3;function we(o,s,a){var d=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var h=new Int32Array(this.arrayBuffer);o=h[0],this.d=(s=h[1])+2*(a=h[2]);for(var m=0;m<this.d*this.d;m++){var _=h[Se+m],b=h[Se+m+1];d.push(_===b?null:h.subarray(_,b))}var T=h[Se+d.length+1];this.keys=h.subarray(h[Se+d.length],T),this.bboxes=h.subarray(T),this.insert=this._insertReadonly}else{this.d=s+2*a;for(var S=0;S<this.d*this.d;S++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=o,this.padding=a,this.scale=s/o,this.uid=0;var A=a/s*o;this.min=-A,this.max=o+A}we.prototype.insert=function(o,s,a,d,h){this._forEachCell(s,a,d,h,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(h)},we.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},we.prototype._insertCell=function(o,s,a,d,h,m){this.cells[h].push(m)},we.prototype.query=function(o,s,a,d,h){var m=this.min,_=this.max;if(o<=m&&s<=m&&_<=a&&_<=d&&!h)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(o,s,a,d,this._queryCell,b,{},h),b},we.prototype._queryCell=function(o,s,a,d,h,m,_,b){var T=this.cells[h];if(null!==T)for(var S=this.keys,A=this.bboxes,k=0;k<T.length;k++){var N=T[k];if(void 0===_[N]){var z=4*N;(b?b(A[z+0],A[z+1],A[z+2],A[z+3]):o<=A[z+2]&&s<=A[z+3]&&a>=A[z+0]&&d>=A[z+1])?(_[N]=!0,m.push(S[N])):_[N]=!1}}},we.prototype._forEachCell=function(o,s,a,d,h,m,_,b){for(var T=this._convertToCellCoord(o),S=this._convertToCellCoord(s),A=this._convertToCellCoord(a),k=this._convertToCellCoord(d),N=T;N<=A;N++)for(var z=S;z<=k;z++){var H=this.d*z+N;if((!b||b(this._convertFromCellCoord(N),this._convertFromCellCoord(z),this._convertFromCellCoord(N+1),this._convertFromCellCoord(z+1)))&&h.call(this,o,s,a,d,H,m,_,b))return}},we.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},we.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},we.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,s=Se+this.cells.length+1+1,a=0,d=0;d<this.cells.length;d++)a+=this.cells[d].length;var h=new Int32Array(s+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=s,_=0;_<o.length;_++){var b=o[_];h[Se+_]=m,h.set(b,m),m+=b.length}return h[Se+o.length]=m,h.set(this.keys,m),h[Se+o.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};var Ue=sa(Le);const et={};function Fe(o,s,a={}){Object.defineProperty(o,"_classRegistryKey",{value:s,writable:!1}),et[s]={klass:o,omit:a.omit||[]}}Fe(Object,"Object"),Ue.serialize=function(o,s){const a=o.toArrayBuffer();return s&&s.add(a),{buffer:a}},Ue.deserialize=function(o){return new Ue(o.buffer)},Object.defineProperty(Ue,"name",{value:"Grid"}),Fe(Ue,"Grid"),Fe(It,"Color"),Fe(Error,"Error"),Fe(Ho,"Formatted"),Fe(lp,"FormattedSection"),Fe(km,"AJAXError"),Fe(fl,"ResolvedImage"),Fe(Ce,"StylePropertyFunction"),Fe(ge,"StyleExpression",{omit:["_evaluator"]}),Fe(ve,"ZoomDependentExpression"),Fe(xe,"ZoomConstantExpression"),Fe(tl,"CompoundExpression",{omit:["_evaluate"]});for(const o in yp)et[yp[o]._classRegistryKey]||Fe(yp[o],`Expression${o}`);function Mt(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function pt(o){return self.ImageBitmap&&o instanceof ImageBitmap}function qe(o,s){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Mt(o)||pt(o))return s&&s.add(o),o;if(ArrayBuffer.isView(o)){const a=o;return s&&s.add(a.buffer),a}if(o instanceof ImageData)return s&&s.add(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const d of o)a.push(qe(d,s));return a}if(o instanceof Map){const a={$name:"Map"};for(const[d,h]of o.entries())a[d]=qe(h);return a}if(o instanceof Set){const a={$name:"Set"};let d=0;for(const h of o.values())a[++d]=qe(h);return a}if("object"==typeof o){const a=o.constructor,d=a._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const h=a.serialize?a.serialize(o,s):{};if(!a.serialize){for(const m in o)o.hasOwnProperty(m)&&(et[d].omit.indexOf(m)>=0||(h[m]=qe(o[m],s)));o instanceof Error&&(h.message=o.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==d&&(h.$name=d),h}throw new Error("can't serialize object of type "+typeof o)}function at(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Mt(o)||pt(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(at);if("object"==typeof o){const s=o.$name||"Object";if("Map"===s){const h=new Map;for(const m of Object.keys(o))"$name"!==m&&h.set(m,at(o[m]));return h}if("Set"===s){const h=new Set;for(const m of Object.keys(o))"$name"!==m&&h.add(at(o[m]));return h}const{klass:a}=et[s];if(!a)throw new Error(`can't deserialize unregistered class ${s}`);if(a.deserialize)return a.deserialize(o);const d=Object.create(a.prototype);for(const h of Object.keys(o))"$name"!==h&&(d[h]=at(o[h]));return d}throw new Error("can't deserialize object of type "+typeof o)}const Pe={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function wt(o){for(const s of o)if(sn(s.charCodeAt(0)))return!0;return!1}function Et(o){for(const s of o)if(!Qt(s.charCodeAt(0)))return!1;return!0}function Qt(o){return!(Pe.Arabic(o)||Pe["Arabic Supplement"](o)||Pe["Arabic Extended-A"](o)||Pe["Arabic Presentation Forms-A"](o)||Pe["Arabic Presentation Forms-B"](o))}function sn(o){return!(746!==o&&747!==o&&(o<4352||!(Pe["Bopomofo Extended"](o)||Pe.Bopomofo(o)||Pe["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Pe["CJK Compatibility Ideographs"](o)||Pe["CJK Compatibility"](o)||Pe["CJK Radicals Supplement"](o)||Pe["CJK Strokes"](o)||!(!Pe["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Pe["CJK Unified Ideographs Extension A"](o)||Pe["CJK Unified Ideographs"](o)||Pe["Enclosed CJK Letters and Months"](o)||Pe["Hangul Compatibility Jamo"](o)||Pe["Hangul Jamo Extended-A"](o)||Pe["Hangul Jamo Extended-B"](o)||Pe["Hangul Jamo"](o)||Pe["Hangul Syllables"](o)||Pe.Hiragana(o)||Pe["Ideographic Description Characters"](o)||Pe.Kanbun(o)||Pe["Kangxi Radicals"](o)||Pe["Katakana Phonetic Extensions"](o)||Pe.Katakana(o)&&12540!==o||!(!Pe["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Pe["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Pe["Unified Canadian Aboriginal Syllabics"](o)||Pe["Unified Canadian Aboriginal Syllabics Extended"](o)||Pe["Vertical Forms"](o)||Pe["Yijing Hexagram Symbols"](o)||Pe["Yi Syllables"](o)||Pe["Yi Radicals"](o))))}function fn(o){return!(sn(o)||(s=o,Pe["Latin-1 Supplement"](s)&&(167===s||169===s||174===s||177===s||188===s||189===s||190===s||215===s||247===s)||Pe["General Punctuation"](s)&&(8214===s||8224===s||8225===s||8240===s||8241===s||8251===s||8252===s||8258===s||8263===s||8264===s||8265===s||8273===s)||Pe["Letterlike Symbols"](s)||Pe["Number Forms"](s)||Pe["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||9003===s||s>=9085&&s<=9114||s>=9150&&s<=9165||9167===s||s>=9169&&s<=9179||s>=9186&&s<=9215)||Pe["Control Pictures"](s)&&9251!==s||Pe["Optical Character Recognition"](s)||Pe["Enclosed Alphanumerics"](s)||Pe["Geometric Shapes"](s)||Pe["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Pe["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Pe["CJK Symbols and Punctuation"](s)||Pe.Katakana(s)||Pe["Private Use Area"](s)||Pe["CJK Compatibility Forms"](s)||Pe["Small Form Variants"](s)||Pe["Halfwidth and Fullwidth Forms"](s)||8734===s||8756===s||8757===s||s>=9984&&s<=10087||s>=10102&&s<=10131||65532===s||65533===s));var s}function xt(o){return o>=1424&&o<=2303||Pe["Arabic Presentation Forms-A"](o)||Pe["Arabic Presentation Forms-B"](o)}function Bn(o,s){return!(!s&&xt(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Pe.Khmer(o))}function tr(o){for(const s of o)if(xt(s.charCodeAt(0)))return!0;return!1}const Pn="deferred",fr="loading",Cr="loaded";let Ar=null,ci="unavailable",nr=null;const Mr=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(ci="error"),Ar&&Ar(o)};function yr(){mr.fire(new Gu("pluginStateChange",{pluginStatus:ci,pluginURL:nr}))}const mr=new br,sr=function(){return ci},Sr=function(){if(ci!==Pn||!nr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ci=fr,yr(),nr&&Bd({url:nr},o=>{o?Mr(o):(ci=Cr,yr())})},Tr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ci===Cr||null!=Tr.applyArabicShaping,isLoading:()=>ci===fr,setState(o){ci=o.pluginStatus,nr=o.pluginURL},isParsed:()=>null!=Tr.applyArabicShaping&&null!=Tr.processBidirectionalText&&null!=Tr.processStyledBidirectionalText,getPluginURL:()=>nr};class Qn{constructor(s,a){this.zoom=s,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(s){return function(a,d){for(const h of a)if(!Bn(h.charCodeAt(0),d))return!1;return!0}(s,Tr.isLoaded())}}class Ls{constructor(s,a,d,h){this.property=s,this.value=a,this.expression=function(m,_,b,T){if(j(m))return new Ce(m,_);if(ae(m)||Array.isArray(m)&&m.length>0){const S=ye(m,_,b,T);if("error"===S.result)throw new Error(S.value.map(A=>`${A.key}: ${A.message}`).join(", "));return S.value}{let S=m;return"string"==typeof m&&"color"===_.type&&(S=It.parse(m)),{kind:"constant",configDependencies:new Set,evaluate:()=>S}}}(void 0===a?s.specification.default:a,s.specification,d,h)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(s,a,d){return this.property.possiblyEvaluate(this,s,a,d)}}class Cs{constructor(s,a,d){this.property=s,this.value=new Ls(s,void 0,a,d)}transitioned(s,a){return new fa(this.property,this.value,a,bo({},s.transition,this.transition),s.now)}untransitioned(){return new fa(this.property,this.value,null,{},0)}}class Wo{constructor(s,a,d){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(s){return la(this._values[s].value.value)}setValue(s,a){this._values.hasOwnProperty(s)||(this._values[s]=new Cs(this._values[s].property,this._scope,this._options)),this._values[s].value=new Ls(this._values[s].property,null===a?void 0:la(a),this._scope,this._options),this._values[s].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].value.expression.configDependencies]))}setTransitionOrValue(s,a){a&&(this._options=a);const d=this._properties.properties;if(s)for(const h in s){const m=s[h];if(Sm(h,"-transition")){const _=h.slice(0,-11);d[_]&&this.setTransition(_,m)}else d.hasOwnProperty(h)&&this.setValue(h,m)}}getTransition(s){return la(this._values[s].transition)}setTransition(s,a){this._values.hasOwnProperty(s)||(this._values[s]=new Cs(this._values[s].property)),this._values[s].transition=la(a)||void 0}serialize(){const s={};for(const a of Object.keys(this._values)){const d=this.getValue(a);void 0!==d&&(s[a]=d);const h=this.getTransition(a);void 0!==h&&(s[`${a}-transition`]=h)}return s}transitioned(s,a){const d=new Eo(this._properties);for(const h of Object.keys(this._values))d._values[h]=this._values[h].transitioned(s,a._values[h]);return d}untransitioned(){const s=new Eo(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].untransitioned();return s}}class fa{constructor(s,a,d,h,m){const _=h.delay||0,b=h.duration||0;m=m||0,this.property=s,this.value=a,this.begin=m+_,this.end=this.begin+b,s.specification.transition&&(h.delay||h.duration)&&(this.prior=d)}possiblyEvaluate(s,a,d){const h=s.now||0,m=this.value.possiblyEvaluate(s,a,d),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(s,a,d);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(s,a,d),m,Tm(b))}}return m}}class Eo{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,a,d){const h=new pa(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(s,a,d);return h}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Ba{constructor(s,a,d){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(s){return la(this._values[s].value)}setValue(s,a){this._values[s]=new Ls(this._values[s].property,null===a?void 0:la(a),this._scope,this._options),this._values[s].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].expression.configDependencies]))}serialize(){const s={};for(const a of Object.keys(this._values)){const d=this.getValue(a);void 0!==d&&(s[a]=d)}return s}possiblyEvaluate(s,a,d){const h=new pa(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(s,a,d);return h}}class qo{constructor(s,a,d){this.property=s,this.value=a,this.parameters=d}isConstant(){return"constant"===this.value.kind}constantOr(s){return"constant"===this.value.kind?this.value.value:s}evaluate(s,a,d,h){return this.property.evaluate(this.value,this.parameters,s,a,d,h)}}class pa{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class Gt{constructor(s){this.specification=s}possiblyEvaluate(s,a){return s.expression.evaluate(a)}interpolate(s,a,d){const h=Bm[this.specification.type];return h?h(s,a,d):s}}class Tn{constructor(s,a){this.specification=s,this.overrides=a}possiblyEvaluate(s,a,d,h){return new qo(this,"constant"===s.expression.kind||"camera"===s.expression.kind?{kind:"constant",value:s.expression.evaluate(a,null,{},d,h)}:s.expression,a)}interpolate(s,a,d){if("constant"!==s.value.kind||"constant"!==a.value.kind)return s;if(void 0===s.value.value||void 0===a.value.value)return new qo(this,{kind:"constant",value:void 0},s.parameters);const h=Bm[this.specification.type];return h?new qo(this,{kind:"constant",value:h(s.value.value,a.value.value,d)},s.parameters):s}evaluate(s,a,d,h,m,_){return"constant"===s.kind?s.value:s.evaluate(a,d,h,m,_)}}class il{constructor(s){this.specification=s}possiblyEvaluate(s,a,d,h){return!!s.expression.evaluate(a,null,{},d,h)}interpolate(){return!1}}class Vi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new Qn(0,{});for(const d in s){const h=s[d];h.specification.overridable&&this.overridableProperties.push(d);const m=this.defaultPropertyValues[d]=new Ls(h,void 0),_=this.defaultTransitionablePropertyValues[d]=new Cs(h);this.defaultTransitioningPropertyValues[d]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=m.possiblyEvaluate(a)}}}Fe(Tn,"DataDrivenProperty"),Fe(Gt,"DataConstantProperty"),Fe(il,"ColorRampProperty");var nt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function eh(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function du(o){if(Array.isArray(o))return o.map(du);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const s={};for(const a in o)s[a]=du(o[a]);return s}return eh(o)}function th(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const s of o.slice(1))if(!th(s)&&"boolean"!=typeof s)return!1;return!0;default:return!0}}function nh(o,s="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};th(o)||(o=xp(o));const a=o;let d=!0;try{d=function(S){if(!gf(S))return S;let A=du(S);return ng(A),A=tg(A),A}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const h=nt[`filter_${s}`],m=ce(d,h);let _=null;if("error"===m.result)throw new Error(m.value.map(S=>`${S.key}: ${S.message}`).join(", "));_=(S,A,k)=>m.value.evaluate(S,A,{},k);let b=null,T=null;if(d!==a){const S=ce(a,h);if("error"===S.result)throw new Error(S.value.map(A=>`${A.key}: ${A.message}`).join(", "));b=(A,k,N,z,H)=>S.value.evaluate(A,k,{},N,void 0,void 0,z,H),T=!Ym(S.value.expression)}return{filter:_,dynamicFilter:b||void 0,needGeometry:Z1(d),needFeature:!!T}}function tg(o){if(!Array.isArray(o))return o;const s=function(a){if(qx.has(a[0]))for(let d=1;d<a.length;d++)if(gf(a[d]))return!0;return a}(o);return!0===s?s:s.map(a=>tg(a))}function ng(o){let s=!1;const a=[];if("case"===o[0]){for(let d=1;d<o.length-1;d+=2)s=s||gf(o[d]),a.push(o[d+1]);a.push(o[o.length-1])}else if("match"===o[0]){s=s||gf(o[1]);for(let d=2;d<o.length-1;d+=2)a.push(o[d+1]);a.push(o[o.length-1])}else if("step"===o[0]){s=s||gf(o[1]);for(let d=1;d<o.length-1;d+=2)a.push(o[d+1])}s&&(o.length=0,o.push("any",...a));for(let d=1;d<o.length;d++)ng(o[d])}function gf(o){if(!Array.isArray(o))return!1;if("pitch"===(s=o[0])||"distance-from-center"===s)return!0;var s;for(let a=1;a<o.length;a++)if(gf(o[a]))return!0;return!1}const qx=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function vp(o,s){return o<s?-1:o>s?1:0}function Z1(o){if(!Array.isArray(o))return!1;if("within"===o[0]||"distance"===o[0])return!0;for(let s=1;s<o.length;s++)if(Z1(o[s]))return!0;return!1}function xp(o){if(!o)return!0;const s=o[0];return o.length<=1?"any"!==s:"=="===s?Zx(o[1],o[2],"=="):"!="===s?Xx(Zx(o[1],o[2],"==")):"<"===s||">"===s||"<="===s||">="===s?Zx(o[1],o[2],s):"any"===s?(a=o.slice(1),["any"].concat(a.map(xp))):"all"===s?["all"].concat(o.slice(1).map(xp)):"none"===s?["all"].concat(o.slice(1).map(xp).map(Xx)):"in"===s?Co(o[1],o.slice(2)):"!in"===s?Xx(Co(o[1],o.slice(2))):"has"===s?pT(o[1]):"!has"!==s||Xx(pT(o[1]));var a}function Zx(o,s,a){switch(o){case"$type":return[`filter-type-${a}`,s];case"$id":return[`filter-id-${a}`,s];default:return[`filter-${a}`,o,s]}}function Co(o,s){if(0===s.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(a=>typeof a!=typeof s[0])?["filter-in-large",o,["literal",s.sort(vp)]]:["filter-in-small",o,["literal",s]]}}function pT(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Xx(o){return["!",o]}function mT(o,s){return s?`${o}\x1f${s}`:o}const gT="-transition",gP=new Set(["fill","line","background","hillshade","raster"]);class sl extends br{constructor(s,a,d,h,m){if(super(),this.id=s.id,this.fqid=mT(this.id,d),this.type=s.type,this.scope=d,this.lut=h,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==s.type&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,"background"!==s.type&&"sky"!==s.type&&"slot"!==s.type&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),s.slot&&(this.slot=s.slot),a.layout&&(this._unevaluatedLayout=new Ba(a.layout,this.scope,m),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint)){this._transitionablePaint=new Wo(a.paint,this.scope,m);for(const _ in s.paint)this.setPaintProperty(_,s.paint[_]);for(const _ in s.layout)this.setLayoutProperty(_,s.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pa(a.paint)}}onAdd(s){}onRemove(s){}isDraped(s){return gP.has(this.type)}getLayoutProperty(s){return"visibility"===s?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,a){if("custom"===this.type&&"visibility"===s)return void(this.visibility=a);const d=this._unevaluatedLayout;d._properties.properties[s]&&(d.setValue(s,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),"visibility"===s&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(s){return Sm(s,gT)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,a){const d=this._transitionablePaint,h=d._properties.properties;if(Sm(s,gT)){const k=s.slice(0,-11);return h[k]&&d.setTransition(k,a||void 0),!1}if(!h[s])return!1;const m=d._values[s],_=m.value.isDataDriven(),b=m.value;d.setValue(s,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(s);const T=d._values[s].value,S=T.isDataDriven(),A=Sm(s,"pattern")||"line-dasharray"===s;return S||_||A||this._handleOverridablePaintPropertyUpdate(s,b,T)}_handleSpecialPaintPropertyUpdate(s){}getProgramIds(){return null}getDefaultProgramParams(s,a,d){return null}_handleOverridablePaintPropertyUpdate(s,a,d){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||"none"===this.visibility}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,a)}serialize(){return ka({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(s,a)=>!(void 0===s||"layout"===a&&!Object.keys(s).length||"paint"===a&&!Object.keys(s).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const s in this.paint._values){const a=this.paint.get(s);if(a instanceof qo&&M(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=nh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(s){this._stats&&("shadow"===s.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(s){}queryIntersectsFeature(s,a,d,h,m,_,b,T,S){}queryIntersectsMatchingFeature(s,a,d,h){}}const _P={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class uc{constructor(s,a){this._structArray=s,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ns{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,a){return s._trim(),a&&(s.isTransferred=!0,a.add(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const a=Object.create(this.prototype);return a.arrayBuffer=s.arrayBuffer,a.length=s.length,a.capacity=s.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...s){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...s){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function oi(o,s=1){let a=0,d=0;return{members:o.map(h=>{const m=_P[h.type].BYTES_PER_ELEMENT,_=a=qi(a,Math.max(s,m)),b=h.components||1;return d=Math.max(d,m),a+=m*b,{name:h.name,type:h.type,components:b,offset:_}}),size:qi(a,Math.max(d,s)),alignment:s}}function qi(o,s){return Math.ceil(o/s)*s}class Vc extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a){const d=this.length;return this.resize(d+1),this.emplace(d,s,a)}emplace(s,a,d){const h=2*s;return this.int16[h+0]=a,this.int16[h+1]=d,s}}Vc.prototype.bytesPerElement=4,Fe(Vc,"StructArrayLayout2i4");class bp extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,d){const h=this.length;return this.resize(h+1),this.emplace(h,s,a,d)}emplace(s,a,d,h){const m=3*s;return this.int16[m+0]=a,this.int16[m+1]=d,this.int16[m+2]=h,s}}bp.prototype.bytesPerElement=6,Fe(bp,"StructArrayLayout3i6");class ho extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,d,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,a,d,h)}emplace(s,a,d,h,m){const _=4*s;return this.int16[_+0]=a,this.int16[_+1]=d,this.int16[_+2]=h,this.int16[_+3]=m,s}}ho.prototype.bytesPerElement=8,Fe(ho,"StructArrayLayout4i8");class _T extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,s,a,d,h,m)}emplace(s,a,d,h,m,_){const b=5*s;return this.int16[b+0]=a,this.int16[b+1]=d,this.int16[b+2]=h,this.int16[b+3]=m,this.int16[b+4]=_,s}}_T.prototype.bytesPerElement=10,Fe(_T,"StructArrayLayout5i10");class rg extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,a,d,h,m,_,b)}emplace(s,a,d,h,m,_,b,T){const S=6*s,A=12*s,k=3*s;return this.int16[S+0]=a,this.int16[S+1]=d,this.uint8[A+4]=h,this.uint8[A+5]=m,this.uint8[A+6]=_,this.uint8[A+7]=b,this.float32[k+2]=T,s}}rg.prototype.bytesPerElement=12,Fe(rg,"StructArrayLayout2i4ub1f12");class dc extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,a,d,h)}emplace(s,a,d,h,m){const _=4*s;return this.float32[_+0]=a,this.float32[_+1]=d,this.float32[_+2]=h,this.float32[_+3]=m,s}}dc.prototype.bytesPerElement=16,Fe(dc,"StructArrayLayout4f16");class Zo extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d){const h=this.length;return this.resize(h+1),this.emplace(h,s,a,d)}emplace(s,a,d,h){const m=3*s;return this.float32[m+0]=a,this.float32[m+1]=d,this.float32[m+2]=h,s}}Zo.prototype.bytesPerElement=12,Fe(Zo,"StructArrayLayout3f12");class wp extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,s,a,d,h,m)}emplace(s,a,d,h,m,_){const b=6*s,T=3*s;return this.uint16[b+0]=a,this.uint16[b+1]=d,this.uint16[b+2]=h,this.uint16[b+3]=m,this.float32[T+2]=_,s}}wp.prototype.bytesPerElement=12,Fe(wp,"StructArrayLayout4ui1f12");class F_ extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,d,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,a,d,h)}emplace(s,a,d,h,m){const _=4*s;return this.uint16[_+0]=a,this.uint16[_+1]=d,this.uint16[_+2]=h,this.uint16[_+3]=m,s}}F_.prototype.bytesPerElement=8,Fe(F_,"StructArrayLayout4ui8");class Kx extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,s,a,d,h,m,_)}emplace(s,a,d,h,m,_,b){const T=6*s;return this.int16[T+0]=a,this.int16[T+1]=d,this.int16[T+2]=h,this.int16[T+3]=m,this.int16[T+4]=_,this.int16[T+5]=b,s}}Kx.prototype.bytesPerElement=12,Fe(Kx,"StructArrayLayout6i12");class hc extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b,T,S,A,k,N){const z=this.length;return this.resize(z+1),this.emplace(z,s,a,d,h,m,_,b,T,S,A,k,N)}emplace(s,a,d,h,m,_,b,T,S,A,k,N,z){const H=12*s;return this.int16[H+0]=a,this.int16[H+1]=d,this.int16[H+2]=h,this.int16[H+3]=m,this.uint16[H+4]=_,this.uint16[H+5]=b,this.uint16[H+6]=T,this.uint16[H+7]=S,this.int16[H+8]=A,this.int16[H+9]=k,this.int16[H+10]=N,this.int16[H+11]=z,s}}hc.prototype.bytesPerElement=24,Fe(hc,"StructArrayLayout4i4ui4i24");class Jx extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,s,a,d,h,m,_)}emplace(s,a,d,h,m,_,b){const T=10*s,S=5*s;return this.int16[T+0]=a,this.int16[T+1]=d,this.int16[T+2]=h,this.float32[S+2]=m,this.float32[S+3]=_,this.float32[S+4]=b,s}}Jx.prototype.bytesPerElement=20,Fe(Jx,"StructArrayLayout3i3f20");class Qx extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint32[1*s+0]=a,s}}Qx.prototype.bytesPerElement=4,Fe(Qx,"StructArrayLayout1ul4");class _f extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a){const d=this.length;return this.resize(d+1),this.emplace(d,s,a)}emplace(s,a,d){const h=2*s;return this.uint16[h+0]=a,this.uint16[h+1]=d,s}}_f.prototype.bytesPerElement=4,Fe(_f,"StructArrayLayout2ui4");class ig extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b,T,S,A,k,N,z){const H=this.length;return this.resize(H+1),this.emplace(H,s,a,d,h,m,_,b,T,S,A,k,N,z)}emplace(s,a,d,h,m,_,b,T,S,A,k,N,z,H){const q=20*s,X=10*s;return this.int16[q+0]=a,this.int16[q+1]=d,this.int16[q+2]=h,this.int16[q+3]=m,this.int16[q+4]=_,this.float32[X+3]=b,this.float32[X+4]=T,this.float32[X+5]=S,this.float32[X+6]=A,this.int16[q+14]=k,this.uint32[X+8]=N,this.uint16[q+18]=z,this.uint16[q+19]=H,s}}ig.prototype.bytesPerElement=40,Fe(ig,"StructArrayLayout5i4f1i1ul2ui40");class L_ extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,a,d,h,m,_,b)}emplace(s,a,d,h,m,_,b,T){const S=8*s;return this.int16[S+0]=a,this.int16[S+1]=d,this.int16[S+2]=h,this.int16[S+4]=m,this.int16[S+5]=_,this.int16[S+6]=b,this.int16[S+7]=T,s}}L_.prototype.bytesPerElement=16,Fe(L_,"StructArrayLayout3i2i2i16");class B_ extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,s,a,d,h,m)}emplace(s,a,d,h,m,_){const b=4*s,T=8*s;return this.float32[b+0]=a,this.float32[b+1]=d,this.float32[b+2]=h,this.int16[T+6]=m,this.int16[T+7]=_,s}}B_.prototype.bytesPerElement=16,Fe(B_,"StructArrayLayout2f1f2i16");class z_ extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,a,d,h)}emplace(s,a,d,h,m){const _=12*s,b=3*s;return this.uint8[_+0]=a,this.uint8[_+1]=d,this.float32[b+1]=h,this.float32[b+2]=m,s}}z_.prototype.bytesPerElement=12,Fe(z_,"StructArrayLayout2ub2f12");class fo extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,d){const h=this.length;return this.resize(h+1),this.emplace(h,s,a,d)}emplace(s,a,d,h){const m=3*s;return this.uint16[m+0]=a,this.uint16[m+1]=d,this.uint16[m+2]=h,s}}fo.prototype.bytesPerElement=6,Fe(fo,"StructArrayLayout3ui6");class Zu extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X,ee,de,ue,fe,be){const Te=this.length;return this.resize(Te+1),this.emplace(Te,s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X,ee,de,ue,fe,be)}emplace(s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X,ee,de,ue,fe,be,Te){const De=30*s,Be=15*s,Ze=60*s;return this.int16[De+0]=a,this.int16[De+1]=d,this.int16[De+2]=h,this.float32[Be+2]=m,this.float32[Be+3]=_,this.uint16[De+8]=b,this.uint16[De+9]=T,this.uint32[Be+5]=S,this.uint32[Be+6]=A,this.uint32[Be+7]=k,this.uint16[De+16]=N,this.uint16[De+17]=z,this.uint16[De+18]=H,this.float32[Be+10]=q,this.float32[Be+11]=X,this.uint8[Ze+48]=ee,this.uint8[Ze+49]=de,this.uint8[Ze+50]=ue,this.uint32[Be+13]=fe,this.int16[De+28]=be,this.uint8[Ze+58]=Te,s}}Zu.prototype.bytesPerElement=60,Fe(Zu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Br extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X,ee,de,ue,fe,be,Te,De,Be,Ze,ot,Ke,_t,Ft,yt,Wt,mt){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X,ee,de,ue,fe,be,Te,De,Be,Ze,ot,Ke,_t,Ft,yt,Wt,mt)}emplace(s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X,ee,de,ue,fe,be,Te,De,Be,Ze,ot,Ke,_t,Ft,yt,Wt,mt,Tt){const Kt=20*s,bt=40*s,Zt=80*s;return this.float32[Kt+0]=a,this.float32[Kt+1]=d,this.int16[bt+4]=h,this.int16[bt+5]=m,this.int16[bt+6]=_,this.int16[bt+7]=b,this.int16[bt+8]=T,this.int16[bt+9]=S,this.int16[bt+10]=A,this.int16[bt+11]=k,this.int16[bt+12]=N,this.uint16[bt+13]=z,this.uint16[bt+14]=H,this.uint16[bt+15]=q,this.uint16[bt+16]=X,this.uint16[bt+17]=ee,this.uint16[bt+18]=de,this.uint16[bt+19]=ue,this.uint16[bt+20]=fe,this.uint16[bt+21]=be,this.uint16[bt+22]=Te,this.uint16[bt+23]=De,this.uint16[bt+24]=Be,this.uint16[bt+25]=Ze,this.uint16[bt+26]=ot,this.uint16[bt+27]=Ke,this.uint32[Kt+14]=_t,this.float32[Kt+15]=Ft,this.float32[Kt+16]=yt,this.float32[Kt+17]=Wt,this.float32[Kt+18]=mt,this.uint8[Zt+76]=Tt,s}}Br.prototype.bytesPerElement=80,Fe(Br,"StructArrayLayout2f9i15ui1ul4f1ub80");class yf extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.float32[1*s+0]=a,s}}yf.prototype.bytesPerElement=4,Fe(yf,"StructArrayLayout1f4");class vf extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,s,a,d,h,m)}emplace(s,a,d,h,m,_){const b=5*s;return this.float32[b+0]=a,this.float32[b+1]=d,this.float32[b+2]=h,this.float32[b+3]=m,this.float32[b+4]=_,s}}vf.prototype.bytesPerElement=20,Fe(vf,"StructArrayLayout5f20");class eb extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,a,d,h,m,_,b)}emplace(s,a,d,h,m,_,b,T){const S=7*s;return this.float32[S+0]=a,this.float32[S+1]=d,this.float32[S+2]=h,this.float32[S+3]=m,this.float32[S+4]=_,this.float32[S+5]=b,this.float32[S+6]=T,s}}eb.prototype.bytesPerElement=28,Fe(eb,"StructArrayLayout7f28");class LD extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,d,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,a,d,h)}emplace(s,a,d,h,m){const _=6*s;return this.uint32[3*s+0]=a,this.uint16[_+2]=d,this.uint16[_+3]=h,this.uint16[_+4]=m,s}}LD.prototype.bytesPerElement=12,Fe(LD,"StructArrayLayout1ul3ui12");class X1 extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint16[1*s+0]=a,s}}X1.prototype.bytesPerElement=2,Fe(X1,"StructArrayLayout1ui2");class Y1 extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a){const d=this.length;return this.resize(d+1),this.emplace(d,s,a)}emplace(s,a,d){const h=2*s;return this.float32[h+0]=a,this.float32[h+1]=d,s}}Y1.prototype.bytesPerElement=8,Fe(Y1,"StructArrayLayout2f8");class yT extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X){const ee=this.length;return this.resize(ee+1),this.emplace(ee,s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X)}emplace(s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X,ee){const de=16*s;return this.float32[de+0]=a,this.float32[de+1]=d,this.float32[de+2]=h,this.float32[de+3]=m,this.float32[de+4]=_,this.float32[de+5]=b,this.float32[de+6]=T,this.float32[de+7]=S,this.float32[de+8]=A,this.float32[de+9]=k,this.float32[de+10]=N,this.float32[de+11]=z,this.float32[de+12]=H,this.float32[de+13]=q,this.float32[de+14]=X,this.float32[de+15]=ee,s}}yT.prototype.bytesPerElement=64,Fe(yT,"StructArrayLayout16f64");class K1 extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,d,h,m,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,a,d,h,m,_,b)}emplace(s,a,d,h,m,_,b,T){const S=10*s,A=5*s;return this.uint16[S+0]=a,this.uint16[S+1]=d,this.uint16[S+2]=h,this.uint16[S+3]=m,this.float32[A+2]=_,this.float32[A+3]=b,this.float32[A+4]=T,s}}K1.prototype.bytesPerElement=20,Fe(K1,"StructArrayLayout4ui3f20");class xf extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.int16[1*s+0]=a,s}}xf.prototype.bytesPerElement=2,Fe(xf,"StructArrayLayout1i2");class vT extends ns{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint8[1*s+0]=a,s}}vT.prototype.bytesPerElement=1,Fe(vT,"StructArrayLayout1ub1");class BD extends uc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}BD.prototype.size=40;class xT extends ig{get(s){return new BD(this,s)}}Fe(xT,"CollisionBoxArray");class zD extends uc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(s){this._structArray.uint8[this._pos1+49]=s}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(s){this._structArray.uint8[this._pos1+50]=s}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(s){this._structArray.uint32[this._pos4+13]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(s){this._structArray.uint8[this._pos1+58]=s}}zD.prototype.size=60;class UD extends Zu{get(s){return new zD(this,s)}}Fe(UD,"PlacedSymbolArray");class en extends uc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(s){this._structArray.uint32[this._pos4+14]=s}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(s){this._structArray.float32[this._pos4+18]=s}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}en.prototype.size=80;class gi extends Br{get(s){return new en(this,s)}}Fe(gi,"SymbolInstanceArray");class Bt extends yf{getoffsetX(s){return this.float32[1*s+0]}}Fe(Bt,"GlyphOffsetArray");class zt extends Vc{getx(s){return this.int16[2*s+0]}gety(s){return this.int16[2*s+1]}}Fe(zt,"SymbolLineVertexArray");class us extends uc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}us.prototype.size=12;class bT extends LD{get(s){return new us(this,s)}}Fe(bT,"FeatureIndexArray");class U_ extends _f{geta_centroid_pos0(s){return this.uint16[2*s+0]}geta_centroid_pos1(s){return this.uint16[2*s+1]}}Fe(U_,"FillExtrusionCentroidArray");class hu extends uc{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}hu.prototype.size=8;class tb extends ho{get(s){return new hu(this,s)}}Fe(tb,"FillExtrusionWallArray");const wT=oi([{name:"a_pos",components:2,type:"Int16"}],4),VD=oi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class _s{constructor(s=[]){this.segments=s}_prepareSegment(s,a,d,h){let m=this.segments[this.segments.length-1];return s>_s.MAX_VERTEX_ARRAY_LENGTH&&Ns(`Max vertices per segment is ${_s.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!m||m.vertexLength+s>_s.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:a,primitiveOffset:d,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}prepareSegment(s,a,d,h){return this._prepareSegment(s,a.length,d.length,h)}get(){return this.segments}destroy(){for(const s of this.segments)for(const a in s.vaos)s.vaos[a].destroy()}static simpleSegment(s,a,d,h){return new _s([{vertexOffset:s,primitiveOffset:a,vertexLength:d,primitiveLength:h,vaos:{},sortKey:0}])}}function yP(o,s){return 256*(o=Dr(Math.floor(o),0,255))+Dr(Math.floor(s),0,255)}_s.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fe(_s,"SegmentVector");const jD=oi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),$D=oi([{name:"a_dash",components:4,type:"Uint16"}]);class V_{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(s,a,d,h){this.ids.push(yl(s)),this.positions.push(a,d,h)}eachPosition(s,a){const d=yl(s);let h=0,m=this.ids.length-1;for(;h<m;){const _=h+m>>1;this.ids[_]>=d?m=_:h=_+1}for(;this.ids[h]===d;)a(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(s,a){const d=new Float64Array(s.ids),h=new Uint32Array(s.positions);return Xu(d,h,0,d.length-1),a&&(a.add(d.buffer),a.add(h.buffer)),{ids:d,positions:h}}static deserialize(s){const a=new V_;let d;a.ids=s.ids,a.positions=s.positions;for(const h of a.ids)h!==d&&a.uniqueIds.push(h),d=h;return a.indexed=!0,a}}function yl(o){const s=+o;return!isNaN(s)&&Number.MIN_SAFE_INTEGER<=s&&s<=Number.MAX_SAFE_INTEGER?s:m_(String(o))}function Xu(o,s,a,d){for(;a<d;){const h=o[a+d>>1];let m=a-1,_=d+1;for(;;){do{m++}while(o[m]<h);do{_--}while(o[_]>h);if(m>=_)break;J1(o,m,_),J1(s,3*m,3*_),J1(s,3*m+1,3*_+1),J1(s,3*m+2,3*_+2)}_-a<d-_?(Xu(o,s,a,_),a=_+1):(Xu(o,s,_+1,d),d=_)}}function J1(o,s,a){const d=o[s];o[s]=o[a],o[a]=d}Fe(V_,"FeaturePositionMap");class ma{constructor(s){this.gl=s.gl,this.initialized=!1}fetchUniformLocation(s,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(s,a),this.initialized=!0),!!this.location}set(s,a,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class fu extends ma{constructor(s){super(s),this.current=0}set(s,a,d){this.fetchUniformLocation(s,a)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class vl extends ma{constructor(s){super(s),this.current=0}set(s,a,d){this.fetchUniformLocation(s,a)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class rh extends ma{constructor(s){super(s),this.current=[0,0]}set(s,a,d){this.fetchUniformLocation(s,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class TT extends ma{constructor(s){super(s),this.current=[0,0,0]}set(s,a,d){this.fetchUniformLocation(s,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class ET extends ma{constructor(s){super(s),this.current=[0,0,0,0]}set(s,a,d){this.fetchUniformLocation(s,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class nb extends ma{constructor(s){super(s),this.current=It.transparent.toRenderColor(null)}set(s,a,d){this.fetchUniformLocation(s,a)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const CT=new Float32Array(16);class sg extends ma{constructor(s){super(s),this.current=CT}set(s,a,d){if(this.fetchUniformLocation(s,a)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let h=1;h<16;h++)if(d[h]!==this.current[h]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const rb=new Float32Array(9),vP=new Float32Array(4);class ib extends ma{constructor(s){super(s),this.current=vP}set(s,a,d){if(this.fetchUniformLocation(s,a))for(let h=0;h<4;h++)if(d[h]!==this.current[h]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}function Q1(o){return[yP(255*o.r,255*o.g),yP(255*o.b,255*o.a)]}class j_{constructor(s,a,d,h){this.value=s,this.uniformNames=a.map(m=>`u_${m}`),this.type=d,this.context=h}setUniform(s,a,d,h,m){const _=h.constantOr(this.value);a.set(s,m,_ instanceof It?_.toRenderColor(this.context.lut):_)}getBinding(s,a){return"color"===this.type?new nb(s):new vl(s)}}class og{constructor(s,a){this.uniformNames=a.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(s){this.pixelRatio=s.pixelRatio||1,this.pattern=s.tl.concat(s.br)}setUniform(s,a,d,h,m){const _="u_pattern"===m||"u_dash"===m?this.pattern:"u_pixel_ratio"===m?this.pixelRatio:null;_&&a.set(s,m,_)}getBinding(s,a){return"u_pattern"===a||"u_dash"===a?new ET(s):new vl(s)}}class ih{constructor(s,a,d,h){this.expression=s,this.type=d,this.maxValue=0,this.paintVertexAttributes=a.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===d?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(s,a,d,h,m,_,b){const T=this.paintVertexArray.length,S=this.expression.evaluate(new Qn(0,{brightness:_}),a,{},m,h,b);this.paintVertexArray.resize(s),this._setPaintValue(T,s,S,this.context)}updatePaintArray(s,a,d,h,m,_,b){const T=this.expression.evaluate({zoom:0,brightness:b},d,h,void 0,m);this._setPaintValue(s,a,T,this.context)}_setPaintValue(s,a,d,h){if("color"===this.type){const m=Q1(d.toRenderColor(h.lut));for(let _=s;_<a;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=s;m<a;m++)this.paintVertexArray.emplace(m,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pu{constructor(s,a,d,h,m,_){this.expression=s,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=d,this.useIntegerZoom=h,this.context=m,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===d?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(s,a,d,h,m,_,b){const T=this.expression.evaluate(new Qn(this.context.zoom,{brightness:_}),a,{},m,h,b),S=this.expression.evaluate(new Qn(this.context.zoom+1,{brightness:_}),a,{},m,h,b),A=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(A,s,T,S,this.context)}updatePaintArray(s,a,d,h,m,_,b){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:b},d,h,void 0,m),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},d,h,void 0,m);this._setPaintValue(s,a,T,S,this.context)}_setPaintValue(s,a,d,h,m){if("color"===this.type){const _=Q1(d.toRenderColor(m.lut)),b=Q1(d.toRenderColor(m.lut));for(let T=s;T<a;T++)this.paintVertexArray.emplace(T,_[0],_[1],b[0],b[1])}else{for(let _=s;_<a;_++)this.paintVertexArray.emplace(_,d,h);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(h))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,a,d,h,m){const _=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,b=Dr(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);a.set(s,m,b)}getBinding(s,a){return new vl(s)}}class sh{constructor(s,a,d,h,m){this.expression=s,this.layerId=m,this.paintVertexAttributes=("array"===d?$D:jD).members;for(let _=0;_<a.length;++_);this.paintVertexArray=new h}populatePaintArray(s,a,d,h){const m=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValues(m,s,a.patterns&&a.patterns[this.layerId],d)}updatePaintArray(s,a,d,h,m,_,b){this._setPaintValues(s,a,d.patterns&&d.patterns[this.layerId],_)}_setPaintValues(s,a,d,h){if(!h||!d)return;const m=h[d];if(!m)return;const{tl:_,br:b,pixelRatio:T}=m;for(let S=s;S<a;S++)this.paintVertexArray.emplace(S,_[0],_[1],b[0],b[1],T)}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ag{constructor(s,a,d=(()=>!0)){this.binders={},this._buffers=[],this.context=a;const h=[];for(const m in s.paint._values){const _=s.paint.get(m);if(!d(m)||!(_ instanceof qo&&M(_.property.specification)))continue;const b=Bs(m,s.type),T=_.value,S=_.property.specification.type,A=!!_.property.useIntegerZoom,k="line-dasharray"===m||m.endsWith("pattern"),N="line-dasharray"===m&&"constant"!==s.layout.get("line-cap").value.kind;if("constant"!==T.kind||N)if("source"===T.kind||N||k){const z=HD(m,S,"source");this.binders[m]=k?new sh(T,b,S,z,s.id):new ih(T,b,S,z),h.push(`/a_${m}`)}else{const z=HD(m,S,"composite");this.binders[m]=new pu(T,b,S,A,a,z),h.push(`/z_${m}`)}else this.binders[m]=k?new og(T.value,b):new j_(T.value,b,S,a),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(s){const a=this.binders[s];return a instanceof ih||a instanceof pu?a.maxValue:0}populatePaintArrays(s,a,d,h,m,_,b){for(const T in this.binders){const S=this.binders[T];S.context=this.context,(S instanceof ih||S instanceof pu||S instanceof sh)&&S.populatePaintArray(s,a,d,h,m,_,b)}}setConstantPatternPositions(s){for(const a in this.binders){const d=this.binders[a];d instanceof og&&d.setConstantPatternPositions(s)}}updatePaintArrays(s,a,d,h,m,_,b,T){let S=!1;const A=Object.keys(s),k=0!==A.length,N=k?A:a.uniqueIds;this.context.lut=m.lut;for(const z in this.binders){const H=this.binders[z];if(H.context=this.context,(H instanceof ih||H instanceof pu||H instanceof sh)&&(!0===H.expression.isStateDependent||!1===H.expression.isLightConstant)){const q=m.paint.get(z);H.expression=q.value;for(const X of N){const ee=s[X.toString()];a.eachPosition(X,(de,ue,fe)=>{const be=h.feature(de);H.updatePaintArray(ue,fe,be,ee,_,b,T)})}if(!k)for(const X of d.uniqueIds){const ee=s[X.toString()];d.eachPosition(X,(de,ue,fe)=>{const be=h.feature(de);H.updatePaintArray(ue,fe,be,ee,_,b,T)})}S=!0}}return S}defines(){const s=[];for(const a in this.binders){const d=this.binders[a];(d instanceof j_||d instanceof og)&&s.push(...d.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return s}getBinderAttributes(){const s=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof ih||d instanceof pu||d instanceof sh)for(let h=0;h<d.paintVertexAttributes.length;h++)s.push(d.paintVertexAttributes[h].name)}return s}getBinderUniforms(){const s=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof j_||d instanceof og||d instanceof pu)for(const h of d.uniformNames)s.push(h)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s){const a=[];for(const d in this.binders){const h=this.binders[d];if(h instanceof j_||h instanceof og||h instanceof pu)for(const m of h.uniformNames)a.push({name:m,property:d,binding:h.getBinding(s,m)})}return a}setUniforms(s,a,d,h,m){for(const{name:_,property:b,binding:T}of d)this.binders[b].setUniform(s,T,m,h.get(b),_)}updatePaintBuffers(){this._buffers=[];for(const s in this.binders){const a=this.binders[s];(a instanceof ih||a instanceof pu||a instanceof sh)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(s){for(const a in this.binders){const d=this.binders[a];(d instanceof ih||d instanceof pu||d instanceof sh)&&d.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const a=this.binders[s];(a instanceof ih||a instanceof pu||a instanceof sh)&&a.destroy()}}}class to{constructor(s,a,d=(()=>!0)){this.programConfigurations={};for(const h of s)this.programConfigurations[h.id]=new ag(h,a,d);this.needsUpload=!1,this._featureMap=new V_,this._featureMapWithoutIds=new V_,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(s,a,d,h,m,_,b,T){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(s,a,h,m,_,b,T);void 0!==a.id?this._featureMap.add(a.id,d,this._bufferOffset,s):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,s),this._idlessCounter+=1),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,a,d,h,m,_){for(const b of d)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(s,this._featureMap,this._featureMapWithoutIds,a,b,h,m,_||0)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}const lg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Bs(o,s){return lg[o]||[o.replace(`${s}-`,"").replace(/-/g,"_")]}const xP={"line-pattern":{source:wp,composite:wp},"fill-pattern":{source:wp,composite:wp},"fill-extrusion-pattern":{source:wp,composite:wp},"line-dasharray":{source:F_,composite:F_}},bP={color:{source:Y1,composite:dc},number:{source:yf,composite:Y1}};function HD(o,s,a){const d=xP[o];return d&&d[a]||bP[s][a]}Fe(j_,"ConstantBinder"),Fe(og,"PatternConstantBinder"),Fe(ih,"SourceExpressionBinder"),Fe(sh,"PatternCompositeBinder"),Fe(pu,"CompositeExpressionBinder"),Fe(ag,"ProgramConfiguration",{omit:["_buffers"]}),Fe(to,"ProgramConfigurationSet");const xl=Jt/Math.PI/2,sb=5,ST=6,ey=16383,DT=[64,32,16],Wl=-xl,ql=xl;function bf(o,s,a,d=xl){return a=kr(a),[o*Math.sin(a)*d,-s*d,o*Math.cos(a)*d]}function wf(o,s,a){return bf(Math.cos(kr(o)),Math.sin(kr(o)),s,a)}const cg=6371008.8,ob=2*Math.PI*cg;class Yr{constructor(s,a){if(isNaN(s)||isNaN(a))throw new Error(`Invalid LngLat object: (${s}, ${a})`);if(this.lng=+s,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yr(Qh(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const a=Math.PI/180,d=this.lat*a,h=s.lat*a,m=Math.sin(d)*Math.sin(h)+Math.cos(d)*Math.cos(h)*Math.cos((s.lng-this.lng)*a);return cg*Math.acos(Math.min(m,1))}toBounds(s=0){const a=360*s/40075017,d=a/Math.cos(Math.PI/180*this.lat);return new jc({lng:this.lng-d,lat:this.lat-a},{lng:this.lng+d,lat:this.lat+a})}toEcef(s){return wf(this.lat,this.lng,xl+s*xl/cg)}static convert(s){if(s instanceof Yr)return s;if(Array.isArray(s)&&(2===s.length||3===s.length))return new Yr(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&"object"==typeof s&&null!==s)return new Yr(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class jc{constructor(s,a){if(s)if(a)this.setSouthWest(s).setNorthEast(a);else if(4===s.length){const d=s;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=s;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(s){return this._ne=s instanceof Yr?new Yr(s.lng,s.lat):Yr.convert(s),this}setSouthWest(s){return this._sw=s instanceof Yr?new Yr(s.lng,s.lat):Yr.convert(s),this}extend(s){const a=this._sw,d=this._ne;let h,m;if(s instanceof Yr)h=s,m=s;else{if(!(s instanceof jc))return Array.isArray(s)?4===s.length||s.every(Array.isArray)?this.extend(jc.convert(s)):this.extend(Yr.convert(s)):"object"==typeof s&&null!==s&&s.hasOwnProperty("lat")&&(s.hasOwnProperty("lon")||s.hasOwnProperty("lng"))?this.extend(Yr.convert(s)):this;if(h=s._sw,m=s._ne,!h||!m)return this}return a||d?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),d.lng=Math.max(m.lng,d.lng),d.lat=Math.max(m.lat,d.lat)):(this._sw=new Yr(h.lng,h.lat),this._ne=new Yr(m.lng,m.lat)),this}getCenter(){return new Yr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yr(this.getWest(),this.getNorth())}getSouthEast(){return new Yr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:a,lat:d}=Yr.convert(s);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&h}static convert(s){return!s||s instanceof jc?s:new jc(s)}}var $_={};!function(a){function d(m,_,b){var T=h(256*m,256*(_=Math.pow(2,b)-_-1),b),S=h(256*(m+1),256*(_+1),b);return T[0]+","+T[1]+","+S[0]+","+S[1]}function h(m,_,b){var T=2*Math.PI*6378137/256/Math.pow(2,b);return[m*T-2*Math.PI*6378137/2,_*T-2*Math.PI*6378137/2]}a.getURL=function(m,_,b,T,S,A){return A=A||{},m+"?"+["bbox="+d(b,T,S),"format="+(A.format||"image/png"),"service="+(A.service||"WMS"),"version="+(A.version||"1.1.1"),"request="+(A.request||"GetMap"),"srs="+(A.srs||"EPSG:3857"),"width="+(A.width||256),"height="+(A.height||256),"layers="+_].join("&")},a.getTileBBox=d,a.getMercCoords=h,Object.defineProperty(a,"__esModule",{value:!0})}($_);var wP=$_;class Tf{constructor(s,a,d){this.z=s,this.x=a,this.y=d,this.key=H_(0,s,s,a,d)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,a){const d=wP.getTileBBox(this.x,this.y,this.z),h=function(m,_,b){let T,S="";for(let A=m;A>0;A--)T=1<<A-1,S+=(_&T?1:0)+(b&T?2:0);return S}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class MT{constructor(s,a){this.wrap=s,this.canonical=a,this.key=H_(s,a.z,a.z,a.x,a.y)}}class po{constructor(s,a,d,h,m){this.overscaledZ=s,this.wrap=a,this.canonical=new Tf(d,+h,+m),this.key=0===a&&s===d?this.canonical.key:H_(a,s,d,h,m)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){const a=this.canonical.z-s;return s>this.canonical.z?new po(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new po(s,this.wrap,s,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(s,a=!0){if(this.overscaledZ===s&&a)return this.key;if(s>this.canonical.z)return H_(this.wrap*+a,s,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-s;return H_(this.wrap*+a,s,s,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(s){if(s.wrap!==this.wrap)return!1;const a=this.canonical.z-s.canonical.z;return 0===s.overscaledZ||s.overscaledZ<this.overscaledZ&&s.canonical.z<this.canonical.z&&s.canonical.x===this.canonical.x>>a&&s.canonical.y===this.canonical.y>>a}children(s){if(this.overscaledZ>=s)return[new po(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,d=2*this.canonical.x,h=2*this.canonical.y;return[new po(a,this.wrap,a,d,h),new po(a,this.wrap,a,d+1,h),new po(a,this.wrap,a,d,h+1),new po(a,this.wrap,a,d+1,h+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new po(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new po(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new MT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function H_(o,s,a,d,h){const m=1<<Math.min(a,22);let _=m*(h%m)+d%m;return o&&a<22&&(_+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*_+a)+(s-a)}const i5=[o=>{let s=o.canonical.x-1,a=o.wrap;return s<0&&(s=(1<<o.canonical.z)-1,a--),new po(o.overscaledZ,a,o.canonical.z,s,o.canonical.y)},o=>{let s=o.canonical.x+1,a=o.wrap;return s===1<<o.canonical.z&&(s=0,a++),new po(o.overscaledZ,a,o.canonical.z,s,o.canonical.y)},o=>new po(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(0===o.canonical.y?1<<o.canonical.z:o.canonical.y)-1),o=>new po(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Fe(Tf,"CanonicalTileID"),Fe(po,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const s5=0,AT=25.5;function Ef(o){return ob*Math.cos(o*Math.PI/180)}function mu(o){return(180+o)/360}function fc(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function bl(o,s){return o/Ef(s)}function ga(o){return 360*o-180}function Xo(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function ab(o,s){return o*Ef(Xo(s))}const ys=85.051129;function TP(o){return Math.cos(kr(Dr(o,-ys,ys)))}function Tp(o,s){const a=Dr(s,s5,AT),d=Math.pow(2,a);return TP(o)*ob/(512*d)}function IT(o){return 1/Math.cos(o*Math.PI/180)}function lb(o,s=0){const a=Math.exp(Math.PI*(1-(o.y+s/Jt)/(1<<o.z)*2));return 80150034*a/(a*a+1)/Jt/(1<<o.z)}class Is{constructor(s,a,d=0){this.x=+s,this.y=+a,this.z=+d}static fromLngLat(s,a=0){const d=Yr.convert(s);return new Is(mu(d.lng),fc(d.lat),bl(a,d.lat))}toLngLat(){return new Yr(ga(this.x),Xo(this.y))}toAltitude(){return ab(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ob*IT(Xo(this.y))}}function kT(o,s,a,d,h,m,_,b,T){const S=(s+d)/2,A=(a+h)/2,k=new rn(S,A);b(k),function(N,z,H,q,X,ee){const de=H-X,ue=q-ee;return Math.abs((q-z)*de-(H-N)*ue)/Math.hypot(de,ue)}(k.x,k.y,m.x,m.y,_.x,_.y)>=T?(kT(o,s,a,S,A,m,k,b,T),kT(o,S,A,d,h,k,_,b,T)):o.push(_)}function ty(o,s,a){let d=o[0],h=d.x,m=d.y;s(d);const _=[d];for(let b=1;b<o.length;b++){const T=o[b],{x:S,y:A}=T;s(T),kT(_,h,m,S,A,d,T,s,a),h=S,m=A,d=T}return _}function ny(o,s,a,d){if(d(s,a)){const h=s.add(a)._mult(.5);ny(o,s,h,d),ny(o,h,a,d)}else o.push(a)}function GD(o,s){let a=o[0];const d=[a];for(let h=1;h<o.length;h++){const m=o[h];ny(d,a,m,s),a=m}return d}const G_=Math.pow(2,14)-1,cb=-G_-1;function EP(o,s){const a=Math.round(o.x*s),d=Math.round(o.y*s);return o.x=Dr(a,cb,G_),o.y=Dr(d,cb,G_),(a<o.x||a>o.x+1||d<o.y||d>o.y+1)&&Ns("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function gu(o,s,a){const d=o.loadGeometry(),h=o.extent,m=Jt/h;if(s&&a&&a.projection.isReprojectedInTileSpace){const _=1<<s.z,{scale:b,x:T,y:S,projection:A}=a,k=N=>{const z=ga((s.x+N.x/h)/_),H=Xo((s.y+N.y/h)/_),q=A.project(z,H);N.x=(q.x*b-T)*h,N.y=(q.y*b-S)*h};for(let N=0;N<d.length;N++)if(1!==o.type)d[N]=ty(d[N],k,1);else{const z=[];for(const H of d[N])H.x<0||H.x>=h||H.y<0||H.y>=h||(k(H),z.push(H));d[N]=z}}for(const _ of d)for(const b of _)EP(b,m);return d}function oh(o,s){return{type:o.type,id:o.id,properties:o.properties,geometry:s?gu(o):[]}}function ry(o,s,a,d,h){o.emplaceBack(2*s+(d+1)/2,2*a+(h+1)/2)}function iy(o,s,a){o.emplaceBack(s.x,s.y,s.z,16384*a[0],16384*a[1],16384*a[2])}class OT{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.projection=s.projection,this.layoutVertexArray=new Vc,this.indexArray=new fo,this.segments=new _s,this.programConfigurations=new to(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}updateFootprints(s,a){}populate(s,a,d,h){const m=this.layers[0],_=[];let b=null;"circle"===m.type&&(b=m.layout.get("circle-sort-key"));for(const{feature:S,id:A,index:k,sourceLayerIndex:N}of s){const z=this.layers[0]._featureFilter.needGeometry,H=oh(S,z);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),H,d))continue;const q=b?b.evaluate(H,{},d):void 0,X={id:A,properties:S.properties,type:S.type,sourceLayerIndex:N,index:k,geometry:z?H.geometry:gu(S,d,h),patterns:{},sortKey:q};_.push(X)}b&&_.sort((S,A)=>S.sortKey-A.sortKey);let T=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Kx,T=h.projection);for(const S of _){const{geometry:A,index:k,sourceLayerIndex:N}=S,z=s[k].feature;this.addFeature(S,A,k,a.availableImages,d,T,a.brightness),a.featureIndex.insert(z,A,k,N,this.index)}}update(s,a,d,h,m){const _=0!==Object.keys(s).length;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(s,a,_?this.stateDependentLayers:this.layers,d,h,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,wT.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,VD.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(s,a,d,h,m,_,b){for(const T of a)for(const S of T){const A=S.x,k=S.y;if(A<0||A>=Jt||k<0||k>=Jt)continue;if(_){const H=_.projectTilePoint(A,k,m),q=_.upVector(m,A,k),X=this.globeExtVertexArray;iy(X,H,q),iy(X,H,q),iy(X,H,q),iy(X,H,q)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),z=N.vertexLength;ry(this.layoutVertexArray,A,k,-1,-1),ry(this.layoutVertexArray,A,k,1,-1),ry(this.layoutVertexArray,A,k,1,1),ry(this.layoutVertexArray,A,k,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,d,{},h,m,b)}}function W_(o,s){for(let a=0;a<o.length;a++)if(Ki(s,o[a]))return!0;for(let a=0;a<s.length;a++)if(Ki(o,s[a]))return!0;return!!ub(o,s)}function ug(o,s,a){return!!Ki(o,s)||!!Ep(s,o,a)}function WD(o,s){if(1===o.length)return ZD(s,o[0]);for(let a=0;a<s.length;a++){const d=s[a];for(let h=0;h<d.length;h++)if(Ki(o,d[h]))return!0}for(let a=0;a<o.length;a++)if(ZD(s,o[a]))return!0;for(let a=0;a<s.length;a++)if(ub(o,s[a]))return!0;return!1}function qD(o,s,a){if(o.length>1){if(ub(o,s))return!0;for(let d=0;d<s.length;d++)if(Ep(s[d],o,a))return!0}for(let d=0;d<o.length;d++)if(Ep(o[d],s,a))return!0;return!1}function ub(o,s){if(0===o.length||0===s.length)return!1;for(let a=0;a<o.length-1;a++){const d=o[a],h=o[a+1];for(let m=0;m<s.length-1;m++)if(q_(d,h,s[m],s[m+1]))return!0}return!1}function q_(o,s,a,d){return Rd(o,a,d)!==Rd(s,a,d)&&Rd(o,s,a)!==Rd(o,s,d)}function Ep(o,s,a){const d=a*a;if(1===s.length)return o.distSqr(s[0])<d;for(let h=1;h<s.length;h++)if(Yo(o,s[h-1],s[h])<d)return!0;return!1}function Yo(o,s,a){const d=s.distSqr(a);if(0===d)return o.distSqr(s);const h=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/d;return o.distSqr(h<0?s:h>1?a:a.sub(s)._mult(h)._add(s))}function ZD(o,s){let a,d,h,m=!1;for(let _=0;_<o.length;_++){a=o[_];for(let b=0,T=a.length-1;b<a.length;T=b++)d=a[b],h=a[T],d.y>s.y!=h.y>s.y&&s.x<(h.x-d.x)*(s.y-d.y)/(h.y-d.y)+d.x&&(m=!m)}return m}function Ki(o,s){let a=!1;for(let d=0,h=o.length-1;d<o.length;h=d++){const m=o[d],_=o[h];m.y>s.y!=_.y>s.y&&s.x<(_.x-m.x)*(s.y-m.y)/(_.y-m.y)+m.x&&(a=!a)}return a}function db(o,s,a,d,h){for(const _ of o)if(s<=_.x&&a<=_.y&&d>=_.x&&h>=_.y)return!0;const m=[new rn(s,a),new rn(s,h),new rn(d,h),new rn(d,a)];if(o.length>2)for(const _ of m)if(Ki(o,_))return!0;for(let _=0;_<o.length-1;_++)if(CP(o[_],o[_+1],m))return!0;return!1}function CP(o,s,a){const d=a[0],h=a[2];if(o.x<d.x&&s.x<d.x||o.x>h.x&&s.x>h.x||o.y<d.y&&s.y<d.y||o.y>h.y&&s.y>h.y)return!1;const m=Rd(o,s,a[0]);return m!==Rd(o,s,a[1])||m!==Rd(o,s,a[2])||m!==Rd(o,s,a[3])}function dg(o,s,a,d,h,m){let _=s.y-o.y,b=o.x-s.x;if(m=m||0){const T=_*_+b*b;if(0===T)return!0;const S=Math.sqrt(T);_/=S,b/=S}return!((a.x-o.x)*_+(a.y-o.y)*b-m<0||(d.x-o.x)*_+(d.y-o.y)*b-m<0||(h.x-o.x)*_+(h.y-o.y)*b-m<0)}function _u(o,s,a,d,h,m,_){return!(dg(o,s,d,h,m,_)||dg(s,a,d,h,m,_)||dg(a,o,d,h,m,_)||dg(d,h,o,s,a,_)||dg(h,m,o,s,a,_)||dg(m,d,o,s,a,_))}function Z_(o,s,a){const d=s.paint.get(o).value;return"constant"===d.kind?d.value:a.programConfigurations.get(s.id).getMaxValue(o)}function sy(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function hb(o,s,a,d,h){if(!s[0]&&!s[1])return o;const m=rn.convert(s)._mult(h);"viewport"===a&&m._rotate(-d);const _=[];for(let b=0;b<o.length;b++)_.push(o[b].sub(m));return _}function oy(o,s,a,d){const h=rn.convert(o)._mult(d);return"viewport"===s&&h._rotate(-a),h}let PT,XD;Fe(OT,"CircleBucket",{omit:["layers"]});class RT{constructor(s,a){this.pos=s,this.dir=a}intersectsPlane(s,a,d){const h=f.$.dot(a,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((s[0]-this.pos[0])*a[0]+(s[1]-this.pos[1])*a[1]+(s[2]-this.pos[2])*a[2])/h;return d[0]=this.pos[0]+this.dir[0]*m,d[1]=this.pos[1]+this.dir[1]*m,d[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(s,a,d){if(f.$.equals(this.pos,s)||0===a)return d[0]=d[1]=d[2]=0,!1;const[h,m,_]=this.dir,b=this.pos[0]-s[0],T=this.pos[1]-s[1],S=this.pos[2]-s[2],A=h*h+m*m+_*_,k=2*(b*h+T*m+S*_),N=k*k-4*A*(b*b+T*T+S*S-a*a);if(N<0){const z=Math.max(-k/2,0),H=b+h*z,q=T+m*z,X=S+_*z,ee=Math.hypot(H,q,X);return d[0]=H*a/ee,d[1]=q*a/ee,d[2]=X*a/ee,!1}{const z=(-k-Math.sqrt(N))/(2*A);if(z<0){const H=Math.hypot(b,T,S);return d[0]=b*a/H,d[1]=T*a/H,d[2]=S*a/H,!1}return d[0]=b+h*z,d[1]=T+m*z,d[2]=S+_*z,!0}}}class NT{constructor(s,a,d,h,m){this.TL=s,this.TR=a,this.BR=d,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(s,a,d){const h=[-1,1,1],m=[1,1,1],_=[1,-1,1],b=[-1,-1,1],T=f.$.transformMat4(h,h,s),S=f.$.transformMat4(m,m,s),A=f.$.transformMat4(_,_,s),k=f.$.transformMat4(b,b,s);return new NT(T,S,A,k,a/d)}}function X_(o,s,a){let d=1/0,h=-1/0;const m=[];for(const _ of o){f.$.sub(m,_,s);const b=f.$.dot(m,a);d=Math.min(d,b),h=Math.max(h,b)}return[d,h]}function YD(o,s){let a=!0;for(let d=0;d<o.planes.length;d++){const h=o.planes[d];let m=0;for(let _=0;_<s.length;_++)m+=f.$.dot(h,s[_])+h[3]>=0;if(0===m)return 0;m!==s.length&&(a=!1)}return a?2:1}function FT(o,s){for(const a of o.projections){const d=X_(s,o.points[0],a.axis);if(a.projection[1]<d[0]||a.projection[0]>d[1])return 0}return 1}function KD(o,s){let a=0;const d=[0,0,0,0];for(let h=0;h<o.length;h++)d[0]=o[h][0],d[1]=o[h][1],d[2]=o[h][2],d[3]=1,f.aB.dot(d,s)>=0&&a++;return a}class LT{constructor(s,a){this.points=s||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=ds.fromPoints(this.points),this.projections=[],this.frustumEdges=[f.$.sub([],this.points[2],this.points[3]),f.$.sub([],this.points[0],this.points[3]),f.$.sub([],this.points[4],this.points[0]),f.$.sub([],this.points[5],this.points[1]),f.$.sub([],this.points[6],this.points[2]),f.$.sub([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const h=[0,-d[2],d[1]],m=[d[2],0,-d[0]];this.projections.push({axis:h,projection:X_(this.points,this.points[0],h)}),this.projections.push({axis:m,projection:X_(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(s,a,d,h){const m=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=f.aB.transformMat4([],S,s),k=1/A[3]/a*m;return f.aB.mul(A,A,[k,k,h?1/A[3]:k,k])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=f.$.sub([],_[S[0]],_[S[1]]),k=f.$.sub([],_[S[2]],_[S[1]]),N=f.$.normalize([],f.$.cross([],A,k)),z=-f.$.dot(N,_[S[1]]);return N.concat(z)}),T=[];for(let S=0;S<_.length;S++)T.push([_[S][0],_[S][1],_[S][2]]);return new LT(T,b)}intersectsPrecise(s,a,d){for(let h=0;h<a.length;h++)if(!KD(s,a[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!KD(s,this.planes[h]))return 0;for(const h of d)for(const m of this.frustumEdges){const _=f.$.cross([],h,m),b=f.$.length(_);if(0===b)continue;f.$.scale(_,_,1/b);const T=X_(this.points,this.points[0],_),S=X_(s,this.points[0],_);if(T[0]>S[1]||S[0]>T[1])return 0}return 1}containsPoint(s){for(const a of this.planes){const d=a[3];if(f.$.dot([a[0],a[1],a[2]],s)+d<0)return!1}return!0}}class ds{static fromPoints(s){const a=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const h of s)f.$.min(a,a,h),f.$.max(d,d,h);return new ds(a,d)}static fromTileIdAndHeight(s,a,d){const h=1<<s.canonical.z,m=s.canonical.x,_=s.canonical.y;return new ds([m/h,_/h,a],[(m+1)/h,(_+1)/h,d])}static applyTransform(s,a){const d=s.getCorners();for(let h=0;h<d.length;++h)f.$.transformMat4(d[h],d[h],a);return ds.fromPoints(d)}static applyTransformFast(s,a){const d=[a[12],a[13],a[14]],h=[...d];for(let m=0;m<3;m++)for(let _=0;_<3;_++){const b=a[4*_+m],T=b*s.min[_],S=b*s.max[_];d[m]+=Math.min(T,S),h[m]+=Math.max(T,S)}return new ds(d,h)}static projectAabbCorners(s,a){const d=s.getCorners();for(let h=0;h<d.length;++h)f.$.transformMat4(d[h],d[h],a);return d}constructor(s,a){this.min=s,this.max=a,this.center=f.$.scale([],f.$.add([],this.min,this.max),.5)}quadrant(s){const a=[s%2==0,s<2],d=f.$.clone(this.min),h=f.$.clone(this.max);for(let m=0;m<a.length;m++)d[m]=a[m]?this.min[m]:this.center[m],h[m]=a[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new ds(d,h)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}getCorners(){const s=this.min,a=this.max;return[[s[0],s[1],s[2]],[a[0],s[1],s[2]],[a[0],a[1],s[2]],[s[0],a[1],s[2]],[s[0],s[1],a[2]],[a[0],s[1],a[2]],[a[0],a[1],a[2]],[s[0],a[1],a[2]]]}intersects(s){return this.intersectsAabb(s.bounds)?YD(s,this.getCorners()):0}intersectsFlat(s){return this.intersectsAabb(s.bounds)?YD(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(s,a){return a||this.intersects(s)?FT(s,this.getCorners()):0}intersectsPreciseFlat(s,a){return a||this.intersectsFlat(s)?FT(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(s){for(let a=0;a<3;++a)if(this.min[a]>s.max[a]||s.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(s){return!(this.min[0]>s.max[0]||s.min[0]>this.max[0]||this.min[1]>s.max[1]||s.min[1]>this.max[1])}encapsulate(s){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],s.min[a]),this.max[a]=Math.max(this.max[a],s.max[a])}encapsulatePoint(s){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],s[a]),this.max[a]=Math.max(this.max[a],s[a])}closestPoint(s){return[Math.max(Math.min(this.max[0],s[0]),this.min[0]),Math.max(Math.min(this.max[1],s[1]),this.min[1]),Math.max(Math.min(this.max[2],s[2]),this.min[2])]}}Fe(ds,"Aabb");const JD=oi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ay}=JD,zs=oi([{name:"a_pos_3",components:3,type:"Int16"}]);var fb=oi([{name:"a_pos",type:"Int16",components:2}]);function pb(o){return o*xl/cg}const o5=[new ds([Wl,Wl,Wl],[ql,ql,ql]),new ds([Wl,Wl,Wl],[0,0,ql]),new ds([0,Wl,Wl],[ql,0,ql]),new ds([Wl,0,Wl],[0,ql,ql]),new ds([0,0,Wl],[ql,ql,ql])];function BT(o,s,a,d=!0){const h=f.$.scale([],o._camera.position,o.worldSize),m=[s,a,1,1];f.aB.transformMat4(m,m,o.pixelMatrixInverse),f.aB.scale(m,m,1/m[3]);const _=f.$.sub([],m,h),b=f.$.normalize([],_),T=o.globeMatrix,S=[T[12],T[13],T[14]],A=f.$.sub([],S,h),k=f.$.length(A),N=f.$.normalize([],A),z=o.worldSize/(2*Math.PI),H=f.$.dot(N,b),q=Math.asin(z/k);if(q<Math.acos(H)){if(!d)return null;const Ke=[],_t=[];f.$.scale(Ke,b,k/H),f.$.normalize(_t,f.$.sub(_t,Ke,A)),f.$.normalize(b,f.$.add(b,A,f.$.scale(b,_t,Math.tan(q)*k)))}const X=[];new RT(h,b).closestPointOnSphere(S,z,X);const ee=f.$.normalize([],nf(T,0)),de=f.$.normalize([],nf(T,1)),ue=f.$.normalize([],nf(T,2)),fe=f.$.dot(ee,X),be=f.$.dot(de,X),Te=f.$.dot(ue,X),De=Ia(Math.asin(-be/z));let Be=Ia(Math.atan2(fe,Te));Be=o.center.lng+function(Ke,_t){const Ft=(_t-Ke+180)%360-180;return Ft<-180?Ft+360:Ft}(o.center.lng,Be);const Ze=mu(Be),ot=Dr(fc(De),0,1);return new Is(Ze,ot)}class a5{constructor(s,a,d){this.a=f.$.sub([],s,d),this.b=f.$.sub([],a,d),this.center=d;const h=f.$.normalize([],this.a),m=f.$.normalize([],this.b);this.angle=Math.acos(f.$.dot(h,m))}}function ly(o,s){if(0===o.angle)return null;let a;return a=0===o.a[s]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[s]/o.a[s]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(d,h,m,_){const b=Math.sin(m);return d*(Math.sin((1-_)*m)/b)+h*(Math.sin(_*m)/b)}(o.a[s],o.b[s],o.angle,Dr(a,0,1))+o.center[s]}function Po(o){if(o.z<=1)return o5[o.z+2*o.y+o.x];const s=tM(cy(o));return ds.fromPoints(s)}function ah(o,s,a){return f.$.scale(o,o,1-a),f.$.scaleAndAdd(o,o,s,a)}function lh(o,s){const a=ol(s.zoom);if(0===a)return Po(o);const d=cy(o),h=tM(d),m=mu(d.getWest())*s.worldSize,_=mu(d.getEast())*s.worldSize,b=fc(d.getNorth())*s.worldSize,T=fc(d.getSouth())*s.worldSize,S=[m,b,0],A=[_,b,0],k=[m,T,0],N=[_,T,0],z=f.ae.invert([],s.globeMatrix);return f.$.transformMat4(S,S,z),f.$.transformMat4(A,A,z),f.$.transformMat4(k,k,z),f.$.transformMat4(N,N,z),h[0]=ah(h[0],k,a),h[1]=ah(h[1],N,a),h[2]=ah(h[2],A,a),h[3]=ah(h[3],S,a),ds.fromPoints(h)}function QD(o,s,a){for(const d of o)f.$.transformMat4(d,d,s),f.$.scale(d,d,a)}function eM(o,s,a,d){const h=s/o.worldSize,m=o.globeMatrix;if(a.z<=1){const Ze=Po(a).getCorners();return QD(Ze,m,h),ds.fromPoints(Ze)}const _=cy(a,d),b=tM(_,xl+pb(o._tileCoverLift));QD(b,m,h);const T=Number.MAX_VALUE,S=[-T,-T,-T],A=[T,T,T];if(_.contains(o.center)){for(const Ke of b)f.$.min(A,A,Ke),f.$.max(S,S,Ke);S[2]=0;const Ze=o.point,ot=[Ze.x*h,Ze.y*h,0];return f.$.min(A,A,ot),f.$.max(S,S,ot),new ds(A,S)}if(o._tileCoverLift>0){for(const Ze of b)f.$.min(A,A,Ze),f.$.max(S,S,Ze);return new ds(A,S)}const k=[m[12]*h,m[13]*h,m[14]*h],N=_.getCenter(),z=Dr(o.center.lat,-ys,ys),H=Dr(N.lat,-ys,ys),q=mu(o.center.lng),X=fc(z);let ee=q-mu(N.lng);const de=X-fc(H);ee>.5?ee-=1:ee<-.5&&(ee+=1);let ue=0;if(Math.abs(ee)>Math.abs(de))ue=ee>=0?1:3;else{ue=de>=0?0:2;const Ze=[m[4]*h,m[5]*h,m[6]*h],ot=-Math.sin(kr(de>=0?_.getSouth():_.getNorth()))*xl;f.$.scaleAndAdd(k,k,Ze,ot)}const fe=b[ue],be=b[(ue+1)%4],Te=new a5(fe,be,k),De=[ly(Te,0)||fe[0],ly(Te,1)||fe[1],ly(Te,2)||fe[2]],Be=ol(o.zoom);if(Be>0){const Ze=function({x:Ke,y:_t,z:Ft},yt,Wt,mt,Tt){const Kt=1/(1<<Ft);let bt=Ke*Kt,Zt=bt+Kt,Xt=_t*Kt,Ut=Xt+Kt,Rn=0;const Mn=(bt+Zt)/2-mt;return Mn>.5?Rn=-1:Mn<-.5&&(Rn=1),bt=((bt+Rn)*yt-(mt*=yt))*Wt+mt,Zt=((Zt+Rn)*yt-mt)*Wt+mt,Xt=(Xt*yt-(Tt*=yt))*Wt+Tt,Ut=(Ut*yt-Tt)*Wt+Tt,[[bt,Ut,0],[Zt,Ut,0],[Zt,Xt,0],[bt,Xt,0]]}(a,s,o._pixelsPerMercatorPixel,q,X);for(let Ke=0;Ke<b.length;Ke++)ah(b[Ke],Ze[Ke],Be);const ot=f.$.add([],Ze[ue],Ze[(ue+1)%4]);f.$.scale(ot,ot,.5),ah(De,ot,Be)}for(const Ze of b)f.$.min(A,A,Ze),f.$.max(S,S,Ze);return A[2]=Math.min(fe[2],be[2]),f.$.min(A,A,De),f.$.max(S,S,De),new ds(A,S)}function cy({x:o,y:s,z:a},d=!1){const h=1/(1<<a),m=new Yr(ga(o*h),s===(1<<a)-1&&d?-90:Xo((s+1)*h)),_=new Yr(ga((o+1)*h),0===s&&d?90:Xo(s*h));return new jc(m,_)}function tM(o,s=xl){const a=kr(o.getNorth()),d=kr(o.getSouth()),h=Math.cos(a),m=Math.cos(d),_=Math.sin(a),b=Math.sin(d),T=o.getWest(),S=o.getEast();return[bf(m,b,T,s),bf(m,b,S,s),bf(h,_,S,s),bf(h,_,T,s)]}function mb(o,s,a,d){const h=1<<a.z,m=(o/Jt+a.x)/h;return wf(Xo((s/Jt+a.y)/h),ga(m),d)}function zT({min:o,max:s}){return ey/Math.max(s[0]-o[0],s[1]-o[1],s[2]-o[2])}const SP=new Float64Array(16);function gb(o){const s=zT(o),a=f.ae.fromScaling(SP,[s,s,s]);return f.ae.translate(a,a,f.$.negate([],o.min))}function UT(o){const s=f.ae.fromTranslation(SP,o.min),a=1/zT(o);return f.ae.scale(s,s,[a,a,a])}function Cp(o){const s=Jt/(2*Math.PI);return o/(2*Math.PI)/s}function Li(o,s){return Jt/(512*Math.pow(2,o))*zT(Po(s))}function VT(o,s,a,d,h){const m=Cp(a),_=[o,s,-a/(2*Math.PI)],b=f.ae.identity(new Float64Array(16));return f.ae.translate(b,b,_),f.ae.scale(b,b,[m,m,m]),f.ae.rotateX(b,b,kr(-h)),f.ae.rotateY(b,b,kr(-d)),b}function ol(o){return tp(sb,ST,o)}function DP(o,s){const a=wf(s.lat,s.lng),d=function(m){const _=wf(m._center.lat,m._center.lng),b=f.$.fromValues(0,1,0);let T=f.$.cross([],b,_);const S=f.ae.fromRotation([],-m.angle,_);T=f.$.transformMat4(T,T,S),f.ae.fromRotation(S,-m._pitch,T);const A=f.$.normalize([],_);return f.$.scale(A,A,pb(m.cameraToCenterDistance/m.pixelsPerMeter)),f.$.transformMat4(A,A,S),f.$.add([],_,A)}(o),h=f.$.subtract([],d,a);return f.$.angle(h,a)}function jT(o,s){return DP(o,s)>Math.PI/2*1.01}const rr=kr(85),MP=Math.cos(rr),$T=Math.sin(rr),uy=f.ae.create(),nM=o=>{const s=[];return"map"===o.paint.get("circle-pitch-alignment")&&s.push("PITCH_WITH_MAP"),"map"===o.paint.get("circle-pitch-scale")&&s.push("SCALE_WITH_MAP"),s};function HT(o,s,a,d,h,m,_,b,T){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(T*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,A=a.projection.upVectorScale(S,a.center.lat,a.worldSize).metersToTile;for(const k of s)for(const N of k){const z=N.add(b),H=h&&a.elevation?a.elevation.exaggeration()*h.getElevationAt(z.x,z.y,!0):0,q=a.projection.projectTilePoint(z.x,z.y,S);if(H>0){const ue=a.projection.upVector(S,z.x,z.y);q.x+=ue[0]*A*H,q.y+=ue[1]*A*H,q.z+=ue[2]*A*H}const X=m?z:rM(q.x,q.y,q.z,d),ee=m?o.tilespaceRays.map(ue=>GT(ue,H)):o.queryGeometry.screenGeometry,de=f.aB.transformMat4([],[q.x,q.y,q.z,1],d);if(!_&&m?T*=de[3]/a.cameraToCenterDistance:_&&!m&&(T*=a.cameraToCenterDistance/de[3]),m){const ue=Xo((N.y/Jt+S.y)/(1<<S.z));T/=a.projection.pixelsPerMeter(ue,1)/bl(1,ue)}if(ug(ee,X,T))return!0}return!1}function rM(o,s,a,d){const h=f.aB.transformMat4([],[o,s,a,1],d);return new rn(h[0]/h[3],h[1]/h[3])}const dy=f.$.fromValues(0,0,0),_b=f.$.fromValues(0,0,1);function GT(o,s){const a=f.$.create();return dy[2]=s,o.intersectsPlane(dy,_b,a),new rn(a[0],a[1])}class iM extends OT{}function sM(o,{width:s,height:a},d,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==s*a*d)throw new RangeError("mismatched image size")}else h=new Uint8Array(s*a*d);return o.width=s,o.height=a,o.data=h,o}function oM(o,s,a){const{width:d,height:h}=s;d===o.width&&h===o.height||(yb(o,s,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,d),height:Math.min(o.height,h)},a,null),o.width=d,o.height=h,o.data=s.data)}function yb(o,s,a,d,h,m,_,b){if(0===h.width||0===h.height)return s;if(h.width>o.width||h.height>o.height||a.x>o.width-h.width||a.y>o.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>s.width||h.height>s.height||d.x>s.width-h.width||d.y>s.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const T=o.data,S=s.data,A=4===m&&b;for(let k=0;k<h.height;k++){const N=((a.y+k)*o.width+a.x)*m,z=((d.y+k)*s.width+d.x)*m;if(A)for(let H=0;H<h.width;H++){const q=N+H*m+3,X=z+H*m;S[X+0]=255,S[X+1]=255,S[X+2]=255,S[X+3]=T[q]}else if(_)for(let H=0;H<h.width;H++){const q=N+H*m,X=z+H*m,ee=T[q+3],de=new It(T[q+0]/255*ee,T[q+1]/255*ee,T[q+2]/255*ee,ee).toRenderColor(_).toArray();S[X+0]=de[0],S[X+1]=de[1],S[X+2]=de[2],S[X+3]=de[3]}else for(let H=0;H<h.width*m;H++)S[z+H]=T[N+H]}return s}Fe(iM,"HeatmapBucket",{omit:["layers"]});class Sp{constructor(s,a){sM(this,s,1,a)}resize(s){oM(this,new Sp(s),1)}clone(){return new Sp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,a,d,h,m){yb(s,a,d,h,m,1,null)}}class $c{constructor(s,a){sM(this,s,4,a)}resize(s){oM(this,new $c(s),4)}replace(s,a){a?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new $c({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,a,d,h,m,_,b){yb(s,a,d,h,m,4,_,b)}}class Zl{constructor(s,a){this.width=s.width,this.height=s.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}let vb,WT,hy,AP;function xb(o){const s={},a=o.resolution||256,d=o.clips?o.clips.length:1,h=o.image||new $c({width:a,height:d}),m=(_,b,T)=>{s[o.evaluationKey]=T;const S=o.expression.evaluate(s);S&&(h.data[_+b+0]=Math.floor(255*S.r/S.a),h.data[_+b+1]=Math.floor(255*S.g/S.a),h.data[_+b+2]=Math.floor(255*S.b/S.a),h.data[_+b+3]=Math.floor(255*S.a))};if(o.clips)for(let _=0,b=0;_<d;++_,b+=4*a)for(let T=0,S=0;T<a;T++,S+=4){const A=T/(a-1),{start:k,end:N}=o.clips[_];m(b,S,k*(1-A)+N*A)}else for(let _=0,b=0;_<a;_++,b+=4)m(0,b,_/(a-1));return h}Fe(Sp,"AlphaImage"),Fe($c,"RGBAImage");const wl=oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Y_}=wl;function K_(o,s,a=2){const d=s&&s.length,h=d?s[0]*a:o.length;let m=qT(o,0,h,a,!0);const _=[];if(!m||m.next===m.prev)return _;let b,T,S;if(d&&(m=function(A,k,N,z){const H=[];for(let q=0,X=k.length;q<X;q++){const ee=qT(A,k[q]*z,q<X-1?k[q+1]*z:A.length,z,!1);ee===ee.next&&(ee.steiner=!0),H.push(cM(ee))}H.sort(OP);for(let q=0;q<H.length;q++)N=PP(H[q],N);return N}(o,s,m,a)),o.length>80*a){b=1/0,T=1/0;let A=-1/0,k=-1/0;for(let N=a;N<h;N+=a){const z=o[N],H=o[N+1];z<b&&(b=z),H<T&&(T=H),z>A&&(A=z),H>k&&(k=H)}S=Math.max(A-b,k-T),S=0!==S?32767/S:0}return J_(m,_,a,b,T,S,0),_}function qT(o,s,a,d,h){let m;if(h===function(_,b,T,S){let A=0;for(let k=b,N=T-S;k<T;k+=S)A+=(_[N]-_[k])*(_[k+1]+_[N+1]),N=k;return A}(o,s,a,d)>0)for(let _=s;_<a;_+=d)m=hM(_/d|0,o[_],o[_+1],m);else for(let _=a-d;_>=s;_-=d)m=hM(_/d|0,o[_],o[_+1],m);return m&&fy(m,m.next)&&(_y(m),m=m.next),m}function hg(o,s){if(!o)return o;s||(s=o);let a,d=o;do{if(a=!1,d.steiner||!fy(d,d.next)&&0!==Us(d.prev,d,d.next))d=d.next;else{if(_y(d),d=s=d.prev,d===d.next)break;a=!0}}while(a||d!==s);return s}function J_(o,s,a,d,h,m,_){if(!o)return;!_&&m&&function(T,S,A,k){let N=T;do{0===N.z&&(N.z=ZT(N.x,N.y,S,A,k)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==T);N.prevZ.nextZ=null,N.prevZ=null,function(z){let H,q=1;do{let X,ee=z;z=null;let de=null;for(H=0;ee;){H++;let ue=ee,fe=0;for(let Te=0;Te<q&&(fe++,ue=ue.nextZ,ue);Te++);let be=q;for(;fe>0||be>0&&ue;)0!==fe&&(0===be||!ue||ee.z<=ue.z)?(X=ee,ee=ee.nextZ,fe--):(X=ue,ue=ue.nextZ,be--),de?de.nextZ=X:z=X,X.prevZ=de,de=X;ee=ue}de.nextZ=null,q*=2}while(H>1)}(N)}(o,d,h,m);let b=o;for(;o.prev!==o.next;){const T=o.prev,S=o.next;if(m?aM(o,d,h,m):IP(o))s.push(T.i,o.i,S.i),_y(o),o=S.next,b=S.next;else if((o=S)===b){_?1===_?J_(o=kP(hg(o),s),s,a,d,h,m,2):2===_&&lM(o,s,a,d,h,m):J_(hg(o),s,a,d,h,m,1);break}}}function IP(o){const s=o.prev,a=o,d=o.next;if(Us(s,a,d)>=0)return!1;const h=s.x,m=a.x,_=d.x,b=s.y,T=a.y,S=d.y,A=h<m?h<_?h:_:m<_?m:_,k=b<T?b<S?b:S:T<S?T:S,N=h>m?h>_?h:_:m>_?m:_,z=b>T?b>S?b:S:T>S?T:S;let H=d.next;for(;H!==s;){if(H.x>=A&&H.x<=N&&H.y>=k&&H.y<=z&&fg(h,b,m,T,_,S,H.x,H.y)&&Us(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function aM(o,s,a,d){const h=o.prev,m=o,_=o.next;if(Us(h,m,_)>=0)return!1;const b=h.x,T=m.x,S=_.x,A=h.y,k=m.y,N=_.y,z=b<T?b<S?b:S:T<S?T:S,H=A<k?A<N?A:N:k<N?k:N,q=b>T?b>S?b:S:T>S?T:S,X=A>k?A>N?A:N:k>N?k:N,ee=ZT(z,H,s,a,d),de=ZT(q,X,s,a,d);let ue=o.prevZ,fe=o.nextZ;for(;ue&&ue.z>=ee&&fe&&fe.z<=de;){if(ue.x>=z&&ue.x<=q&&ue.y>=H&&ue.y<=X&&ue!==h&&ue!==_&&fg(b,A,T,k,S,N,ue.x,ue.y)&&Us(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,fe.x>=z&&fe.x<=q&&fe.y>=H&&fe.y<=X&&fe!==h&&fe!==_&&fg(b,A,T,k,S,N,fe.x,fe.y)&&Us(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ue&&ue.z>=ee;){if(ue.x>=z&&ue.x<=q&&ue.y>=H&&ue.y<=X&&ue!==h&&ue!==_&&fg(b,A,T,k,S,N,ue.x,ue.y)&&Us(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;fe&&fe.z<=de;){if(fe.x>=z&&fe.x<=q&&fe.y>=H&&fe.y<=X&&fe!==h&&fe!==_&&fg(b,A,T,k,S,N,fe.x,fe.y)&&Us(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function kP(o,s){let a=o;do{const d=a.prev,h=a.next.next;!fy(d,h)&&XT(d,a,a.next,h)&&gy(d,h)&&gy(h,d)&&(s.push(d.i,a.i,h.i),_y(a),_y(a.next),a=o=h),a=a.next}while(a!==o);return hg(a)}function lM(o,s,a,d,h,m){let _=o;do{let b=_.next.next;for(;b!==_.prev;){if(_.i!==b.i&&uM(_,b)){let T=dM(_,b);return _=hg(_,_.next),T=hg(T,T.next),J_(_,s,a,d,h,m,0),void J_(T,s,a,d,h,m,0)}b=b.next}_=_.next}while(_!==o)}function OP(o,s){return o.x-s.x}function PP(o,s){const a=function(h,m){let _=m;const b=h.x,T=h.y;let S,A=-1/0;do{if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const q=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(q<=b&&q>A&&(A=q,S=_.x<_.next.x?_:_.next,q===b))return S}_=_.next}while(_!==m);if(!S)return null;const k=S,N=S.x,z=S.y;let H=1/0;_=S;do{if(b>=_.x&&_.x>=N&&b!==_.x&&fg(T<z?b:A,T,N,z,T<z?A:b,T,_.x,_.y)){const q=Math.abs(T-_.y)/(b-_.x);gy(_,h)&&(q<H||q===H&&(_.x>S.x||_.x===S.x&&RP(S,_)))&&(S=_,H=q)}_=_.next}while(_!==k);return S}(o,s);if(!a)return s;const d=dM(a,o);return hg(d,d.next),hg(a,a.next)}function RP(o,s){return Us(o.prev,o,s.prev)<0&&Us(s.next,o,o.next)<0}function ZT(o,s,a,d,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-a)*h|0)|o<<8))|o<<4))|o<<2))|o<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-d)*h|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function cM(o){let s=o,a=o;do{(s.x<a.x||s.x===a.x&&s.y<a.y)&&(a=s),s=s.next}while(s!==o);return a}function fg(o,s,a,d,h,m,_,b){return(h-_)*(s-b)>=(o-_)*(m-b)&&(o-_)*(d-b)>=(a-_)*(s-b)&&(a-_)*(m-b)>=(h-_)*(d-b)}function uM(o,s){return o.next.i!==s.i&&o.prev.i!==s.i&&!function(a,d){let h=a;do{if(h.i!==a.i&&h.next.i!==a.i&&h.i!==d.i&&h.next.i!==d.i&&XT(h,h.next,a,d))return!0;h=h.next}while(h!==a);return!1}(o,s)&&(gy(o,s)&&gy(s,o)&&function(a,d){let h=a,m=!1;const _=(a.x+d.x)/2,b=(a.y+d.y)/2;do{h.y>b!=h.next.y>b&&h.next.y!==h.y&&_<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==a);return m}(o,s)&&(Us(o.prev,o,s.prev)||Us(o,s.prev,s))||fy(o,s)&&Us(o.prev,o,o.next)>0&&Us(s.prev,s,s.next)>0)}function Us(o,s,a){return(s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y)}function fy(o,s){return o.x===s.x&&o.y===s.y}function XT(o,s,a,d){const h=my(Us(o,s,a)),m=my(Us(o,s,d)),_=my(Us(a,d,o)),b=my(Us(a,d,s));return h!==m&&_!==b||!(0!==h||!py(o,a,s))||!(0!==m||!py(o,d,s))||!(0!==_||!py(a,o,d))||!(0!==b||!py(a,s,d))}function py(o,s,a){return s.x<=Math.max(o.x,a.x)&&s.x>=Math.min(o.x,a.x)&&s.y<=Math.max(o.y,a.y)&&s.y>=Math.min(o.y,a.y)}function my(o){return o>0?1:o<0?-1:0}function gy(o,s){return Us(o.prev,o,o.next)<0?Us(o,s,o.next)>=0&&Us(o,o.prev,s)>=0:Us(o,s,o.prev)<0||Us(o,o.next,s)<0}function dM(o,s){const a=bb(o.i,o.x,o.y),d=bb(s.i,s.x,s.y),h=o.next,m=s.prev;return o.next=s,s.prev=o,a.next=h,h.prev=a,d.next=a,a.prev=d,m.next=d,d.prev=m,d}function hM(o,s,a,d){const h=bb(o,s,a);return d?(h.next=d.next,h.prev=d,d.next.prev=h,d.next=h):(h.prev=h,h.next=h),h}function _y(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function bb(o,s,a){return{i:o,x:s,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function YT(o,s){const a=o.length;if(a<=1)return[o];const d=[];let h,m;for(let _=0;_<a;_++){const b=iT(o[_]);0!==b&&(o[_].area=Math.abs(b),void 0===m&&(m=b<0),m===b<0?(h&&d.push(h),h=[o[_]]):h.push(o[_]))}if(h&&d.push(h),s>1)for(let _=0;_<d.length;_++)d[_].length<=s||(Vr(d[_],s,1,d[_].length-1,fM),d[_]=d[_].slice(0,s));return d}function fM(o,s){return s.area-o.area}function KT(o,s,a){const d=a.patternDependencies;let h=!1;for(const m of s){const _=m.paint.get(`${o}-pattern`);_.isConstant()||(h=!0);const b=_.constantOr(null);b&&(h=!0,d[b]=!0)}return h}function JT(o,s,a,d,h){const m=h.patternDependencies;for(const _ of s){const b=_.paint.get(`${o}-pattern`).value;if("constant"!==b.kind){let T=b.evaluate({zoom:d},a,{},h.availableImages);T=T&&T.name?T.name:T,m[T]=!0,a.patterns[_.id]=T}}return a}class QT{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vc,this.indexArray=new fo,this.indexArray2=new _f,this.programConfigurations=new to(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new _s,this.segments2=new _s,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=s.projection}updateFootprints(s,a){}populate(s,a,d,h){this.hasPattern=KT("fill",this.layers,a);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:b,id:T,index:S,sourceLayerIndex:A}of s){const k=this.layers[0]._featureFilter.needGeometry,N=oh(b,k);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),N,d))continue;const z=m?m.evaluate(N,{},d,a.availableImages):void 0,H={id:T,properties:b.properties,type:b.type,sourceLayerIndex:A,index:S,geometry:k?N.geometry:gu(b,d,h),patterns:{},sortKey:z};_.push(H)}m&&_.sort((b,T)=>b.sortKey-T.sortKey);for(const b of _){const{geometry:T,index:S,sourceLayerIndex:A}=b;if(this.hasPattern){const k=JT("fill",this.layers,b,this.zoom,a);this.patternFeatures.push(k)}else this.addFeature(b,T,S,d,{},a.availableImages,a.brightness);a.featureIndex.insert(s[S].feature,T,S,A,this.index)}}update(s,a,d,h,m){const _=0!==Object.keys(s).length;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(s,a,_?this.stateDependentLayers:this.layers,d,h,m)}addFeatures(s,a,d,h,m,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,d,h,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Y_),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,a,d,h,m,_=[],b){for(const T of YT(a,500)){let S=0;for(const q of T)S+=q.length;const A=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),k=A.vertexLength,N=[],z=[];for(const q of T){if(0===q.length)continue;q!==T[0]&&z.push(N.length/2);const X=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),ee=X.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(ee+q.length-1,ee),N.push(q[0].x),N.push(q[0].y);for(let de=1;de<q.length;de++)this.layoutVertexArray.emplaceBack(q[de].x,q[de].y),this.indexArray2.emplaceBack(ee+de-1,ee+de),N.push(q[de].x),N.push(q[de].y);X.vertexLength+=q.length,X.primitiveLength+=q.length}const H=K_(N,z);for(let q=0;q<H.length;q+=3)this.indexArray.emplaceBack(k+H[q],k+H[q+1],k+H[q+2]);A.vertexLength+=S,A.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,d,m,_,h,b)}}let pM,eE,wb,mM;Fe(QT,"FillBucket",{omit:["layers","patternFeatures"]});class ch{constructor(s,a,d,h){if(this.triangleCount=a.length/3,this.min=new rn(0,0),this.max=new rn(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===s.length)return;const[m,_]=[s[0].clone(),s[0].clone()];for(let k=1;k<s.length;++k){const N=s[k];m.x=Math.min(m.x,N.x),m.y=Math.min(m.y,N.y),_.x=Math.max(_.x,N.x),_.y=Math.max(_.y,N.y)}if(h){const k=Math.ceil(Math.max(_.x-m.x,_.y-m.y)/h);d=Math.max(d,k)}if(0===d)return;this.min=m,this.max=_;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const T=Math.max(b.x,b.y)/d;this.cellsX=Math.max(1,Math.ceil(b.x/T)),this.cellsY=Math.max(1,Math.ceil(b.y/T)),this.xScale=1/T,this.yScale=1/T;const S=[];for(let k=0;k<this.triangleCount;k++){const N=s[a[3*k+0]].sub(this.min),z=s[a[3*k+1]].sub(this.min),H=s[a[3*k+2]].sub(this.min),q=Xl(Math.floor(Math.min(N.x,z.x,H.x)),this.xScale,this.cellsX),X=Xl(Math.floor(Math.max(N.x,z.x,H.x)),this.xScale,this.cellsX),ee=Xl(Math.floor(Math.min(N.y,z.y,H.y)),this.yScale,this.cellsY),de=Xl(Math.floor(Math.max(N.y,z.y,H.y)),this.yScale,this.cellsY),ue=new rn(0,0),fe=new rn(0,0),be=new rn(0,0),Te=new rn(0,0);for(let De=ee;De<=de;++De){ue.y=fe.y=De*T,be.y=Te.y=(De+1)*T;for(let Be=q;Be<=X;++Be)ue.x=be.x=Be*T,fe.x=Te.x=(Be+1)*T,(_u(N,z,H,ue,fe,Te)||_u(N,z,H,ue,Te,be))&&S.push({cellIdx:De*this.cellsX+Be,triIdx:k})}}if(0===S.length)return;S.sort((k,N)=>k.cellIdx-N.cellIdx||k.triIdx-N.triIdx);let A=0;for(;A<S.length;){const k=S[A].cellIdx,N={start:this.payload.length,len:0};for(;A<S.length&&S[A].cellIdx===k;)++N.len,this.payload.push(S[A++].triIdx);this.cells[k]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(s,a){if(0===this.triangleCount||0===this.cells.length||s.x>this.max.x||this.min.x>s.x||s.y>this.max.y||this.min.y>s.y)return;const d=Xl(s.x-this.min.x,this.xScale,this.cellsX),h=Xl(s.y-this.min.y,this.yScale,this.cellsY),m=this.cells[h*this.cellsX+d];if(m){this._lazyInitLookup();for(let _=0;_<m.len;_++){const b=this.payload[m.start+_],T=Math.floor(b/8),S=1<<b%8;if(!(this.lookup[T]&S)&&(this.lookup[T]|=S,a.push(b),a.length===this.triangleCount))return}}}query(s,a,d){if(0===this.triangleCount||0===this.cells.length||s.x>this.max.x||this.min.x>a.x||s.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const h=Xl(s.x-this.min.x,this.xScale,this.cellsX),m=Xl(a.x-this.min.x,this.xScale,this.cellsX),_=Xl(s.y-this.min.y,this.yScale,this.cellsY),b=Xl(a.y-this.min.y,this.yScale,this.cellsY);for(let T=_;T<=b;T++)for(let S=h;S<=m;S++){const A=this.cells[T*this.cellsX+S];if(A)for(let k=0;k<A.len;k++){const N=this.payload[A.start+k],z=Math.floor(N/8),H=1<<N%8;if(!(this.lookup[z]&H)&&(this.lookup[z]|=H,d.push(N),d.length===this.triangleCount))return}}}}function Xl(o,s,a){return Math.max(0,Math.min(a-1,Math.floor(o*s)))}Fe(ch,"TriangleGridIndex");class gM{constructor(s){this.zoom=s.zoom,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[]}updateFootprints(s,a){for(const d of this.footprints)a.push({footprint:d,id:s})}populate(s,a,d,h){const m=[];for(const{feature:_,id:b,index:T,sourceLayerIndex:S}of s){const A=this.layers[0]._featureFilter.needGeometry,k=oh(_,A);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),k,d))continue;const N={id:b,properties:_.properties,type:_.type,sourceLayerIndex:S,index:T,geometry:A?k.geometry:gu(_,d,h),patterns:{}};m.push(N)}for(const _ of m){const{geometry:b,index:T,sourceLayerIndex:S}=_;this.addFeature(_,b,T,d,{},a.availableImages,a.brightness),a.featureIndex.insert(s[T].feature,b,T,S,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(s){}update(s,a,d,h,m){}destroy(){}addFeature(s,a,d,h,m,_=[],b){for(const T of YT(a,2)){const S=[],A=[],k=[],N=new rn(1/0,1/0),z=new rn(-1/0,-1/0);for(const X of T)if(0!==X.length){X!==T[0]&&k.push(A.length/2);for(let ee=0;ee<X.length;ee++)A.push(X[ee].x),A.push(X[ee].y),S.push(X[ee]),N.x=Math.min(N.x,X[ee].x),N.y=Math.min(N.y,X[ee].y),z.x=Math.max(z.x,X[ee].x),z.y=Math.max(z.y,X[ee].y)}const H=K_(A,k),q=new ch(S,H,8,256);this.footprints.push({vertices:S,indices:H,grid:q,min:N,max:z})}}}Fe(gM,"ClipBucket",{omit:["layers"]});const _M=oi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dp=oi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),l5=oi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),c5=oi([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),yM=oi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),NP=oi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:FP}=_M;var tE={},u5=wm,yy=Q_;function Q_(o,s,a,d,h){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=d,this._values=h,o.readFields(nE,this,s)}function nE(o,s,a){1==o?s.id=a.readVarint():2==o?function(d,h){for(var m=d.readVarint()+d.pos;d.pos<m;){var _=h._keys[d.readVarint()],b=h._values[d.readVarint()];h.properties[_]=b}}(a,s):3==o?s.type=a.readVarint():4==o&&(s._geometry=a.pos)}function rE(o){for(var s,a,d=0,h=0,m=o.length,_=m-1;h<m;_=h++)d+=((a=o[_]).x-(s=o[h]).x)*(s.y+a.y);return d}Q_.types=["Unknown","Point","LineString","Polygon"],Q_.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var s,a=o.readVarint()+o.pos,d=1,h=0,m=0,_=0,b=[];o.pos<a;){if(h<=0){var T=o.readVarint();d=7&T,h=T>>3}if(h--,1===d||2===d)m+=o.readSVarint(),_+=o.readSVarint(),1===d&&(s&&b.push(s),s=[]),s.push(new u5(m,_));else{if(7!==d)throw new Error("unknown command "+d);s&&s.push(s[0].clone())}}return s&&b.push(s),b},Q_.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var s=o.readVarint()+o.pos,a=1,d=0,h=0,m=0,_=1/0,b=-1/0,T=1/0,S=-1/0;o.pos<s;){if(d<=0){var A=o.readVarint();a=7&A,d=A>>3}if(d--,1===a||2===a)(h+=o.readSVarint())<_&&(_=h),h>b&&(b=h),(m+=o.readSVarint())<T&&(T=m),m>S&&(S=m);else if(7!==a)throw new Error("unknown command "+a)}return[_,T,b,S]},Q_.prototype.toGeoJSON=function(o,s,a){var d,h,m=this.extent*Math.pow(2,a),_=this.extent*o,b=this.extent*s,T=this.loadGeometry(),S=Q_.types[this.type];function A(z){for(var H=0;H<z.length;H++){var q=z[H];z[H]=[360*(q.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(d=0;d<T.length;d++)k[d]=T[d][0];A(T=k);break;case 2:for(d=0;d<T.length;d++)A(T[d]);break;case 3:for(T=function(z){var H=z.length;if(H<=1)return[z];for(var q,X,ee=[],de=0;de<H;de++){var ue=rE(z[de]);0!==ue&&(void 0===X&&(X=ue<0),X===ue<0?(q&&ee.push(q),q=[z[de]]):q.push(z[de]))}return q&&ee.push(q),ee}(T),d=0;d<T.length;d++)for(h=0;h<T[d].length;h++)A(T[d][h])}1===T.length?T=T[0]:S="Multi"+S;var N={type:"Feature",geometry:{type:S,coordinates:T},properties:this.properties};return"id"in this&&(N.id=this.id),N};var e0=yy,vy=Tb;function Tb(o,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(xy,this,s),this.length=this._features.length}function xy(o,s,a){15===o?s.version=a.readVarint():1===o?s.name=a.readString():5===o?s.extent=a.readVarint():2===o?s._features.push(a.pos):3===o?s._keys.push(a.readString()):4===o&&s._values.push(function(d){for(var h=null,m=d.readVarint()+d.pos;d.pos<m;){var _=d.readVarint()>>3;h=1===_?d.readString():2===_?d.readFloat():3===_?d.readDouble():4===_?d.readVarint64():5===_?d.readVarint():6===_?d.readSVarint():7===_?d.readBoolean():null}return h}(a))}Tb.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var s=this._pbf.readVarint()+this._pbf.pos;return new e0(this._pbf,s,this.extent,this._keys,this._values)};var Eb=vy;function t0(o,s,a){if(3===o){var d=new Eb(a,a.readVarint()+a.pos);d.length&&(s[d.name]=d)}}var by=tE.VectorTile=function(o,s){this.layers=o.readFields(t0,{},s)},pg=tE.VectorTileFeature=yy;tE.VectorTileLayer=vy;class Yu extends rn{constructor(s,a,d){super(s,a),this.z=d}}class Cb extends Yu{constructor(s,a,d,h){super(s,a,d),this.w=h}}function iE(o,s,a,d){const h=[],m=0===d?(_,b,T,S,A,k)=>{_.push(new rn(k,T+(k-b)/(S-b)*(A-T)))}:(_,b,T,S,A,k)=>{_.push(new rn(b+(k-T)/(A-T)*(S-b),k))};for(const _ of o){const b=[];for(const T of _){if(T.length<=2)continue;const S=[];for(let N=0;N<T.length-1;N++){const z=T[N].x,H=T[N].y,q=T[N+1].x,X=T[N+1].y,ee=0===d?z:H,de=0===d?q:X;ee<s?de>s&&m(S,z,H,q,X,s):ee>a?de<a&&m(S,z,H,q,X,a):S.push(T[N]),de<s&&ee>=s&&m(S,z,H,q,X,s),de>a&&ee<=a&&m(S,z,H,q,X,a)}let A=T[T.length-1];const k=0===d?A.x:A.y;k>=s&&k<=a&&S.push(A),S.length&&(A=S[S.length-1],S[0].x===A.x&&S[0].y===A.y||S.push(S[0]),b.push(S))}b.length&&h.push(b)}return h}function Sb(o,s,a,d){const h="x"===a?"y":"x",m=(d-o[a])/(s[a]-o[a]);o[h]=o[h]+(s[h]-o[h])*m,o[a]=d,o.hasOwnProperty("z")&&(o.z=dn(o.z,s.z,m)),o.hasOwnProperty("w")&&(o.w=dn(o.w,s.w,m))}function n0(o,s,a,d){const h=a,m=d;for(const _ of["x","y"]){let b=o,T=s;b[_]>=T[_]&&(b=s,T=o),b[_]<h&&T[_]>h&&Sb(b,T,_,h),b[_]<m&&T[_]>m&&Sb(T,b,_,m)}}const Db=Number.MAX_SAFE_INTEGER;function sE(o,s,a,d){return o.order<s||o.order===Db||!(o.clipMask&a)||(h=d,0!==(m=o.clipScope).length&&void 0===m.find(_=>_===h));var h,m}function Mb(o,s){return o.x-s.x||o.y-s.y}function vM(o,s){return 0===Mb(o.min,s.min)&&0===Mb(o.max,s.max)}function wy(o,s){return!(o.min.x>s.max.x||o.max.x<s.min.x||o.min.y>s.max.y||o.max.y<s.min.y)}function Ab(o,s){if(o.length!==s.length)return!1;for(let a=0;a<o.length;a++)if(o[a].sourceId!==s[a].sourceId||!vM(o[a],s[a])||o[a].order!==s[a].order||o[a].clipMask!==s[a].clipMask||!Vl(o[a].clipScope,s[a].clipScope))return!1;return!0}function xM(o,s,a){const d=1/Jt,h=1/(1<<a.canonical.z),m=(s.x*d+a.canonical.x)*h+a.wrap,_=(s.y*d+a.canonical.y)*h;return{min:new rn((o.x*d+a.canonical.x)*h+a.wrap,(o.y*d+a.canonical.y)*h),max:new rn(m,_)}}function LP(o,s,a){const d=1<<a.canonical.z,h=((s.x-a.wrap)*d-a.canonical.x)*Jt,m=(s.y*d-a.canonical.y)*Jt;return{min:new rn(((o.x-a.wrap)*d-a.canonical.x)*Jt,(o.y*d-a.canonical.y)*Jt),max:new rn(h,m)}}function r0(o,s,a,d,h,m,_){const b=o.indices,T=o.vertices,S=[];for(let A=d;A<d+h;A+=3){const k=s[a[A+0]+m],N=s[a[A+1]+m],z=s[a[A+2]+m],H=Math.min(k.x,N.x,z.x),q=Math.max(k.x,N.x,z.x),X=Math.min(k.y,N.y,z.y),ee=Math.max(k.y,N.y,z.y);S.length=0,o.grid.query(new rn(H,X),new rn(q,ee),S);for(let de=0;de<S.length;de++){const ue=S[de];if(_u(T[b[3*ue+0]],T[b[3*ue+1]],T[b[3*ue+2]],k,N,z,_))return!0}}return!1}function oE(o,s,a,d){if(!o||!a)return!1;let h=o.vertices;if(!s.canonical.equals(d.canonical)||s.wrap!==d.wrap){if(a.vertices.length<o.vertices.length)return oE(a,d,o,s);const m=s.canonical,_=d.canonical,b=Math.pow(2,_.z-m.z);h=o.vertices.map(T=>new rn((T.x+m.x*Jt)*b-_.x*Jt,(T.y+m.y*Jt)*b-_.y*Jt))}return r0(a,h,o.indices,0,o.indices.length,0,0)}function Ib(o,s,a,d){const h=Math.pow(2,d.z-a.z);return new rn((o+a.x*Jt)*h-d.x*Jt,(s+a.y*Jt)*h-d.y*Jt)}function bM(o,s){const a=[];s.footprint.grid.queryPoint(o,a);const d=s.footprint.indices,h=s.footprint.vertices;for(let m=0;m<a.length;m++){const _=a[m];if(Ki([h[d[3*_+0]],h[d[3*_+1]],h[d[3*_+2]]],o))return!0}return!1}class BP{constructor(s){this.size=s,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(s,a){const d=this.toIdx(s,a);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(s,a){return this.leaves[this.toIdx(s,a)]}toIdx(s,a){return a*this.size+s}}function zP(o,s,a,d){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(d[_])<1e-15){if(a[_]<o[_]||a[_]>s[_])return null}else{const b=1/d[_];let T=(o[_]-a[_])*b,S=(s[_]-a[_])*b;if(T>S){const A=T;T=S,S=A}if(T>h&&(h=T),S<m&&(m=S),h>m)return null}return h}function s0(o,s,a,d,h,m,_,b,T,S,A){const k=d-o,N=h-s,z=m-a,H=_-o,q=b-s,X=T-a,ee=A[1]*X-A[2]*q,de=A[2]*H-A[0]*X,ue=A[0]*q-A[1]*H,fe=k*ee+N*de+z*ue;if(Math.abs(fe)<1e-15)return null;const be=1/fe,Te=S[0]-o,De=S[1]-s,Be=S[2]-a,Ze=(Te*ee+De*de+Be*ue)*be;if(Ze<0||Ze>1)return null;const ot=De*z-Be*N,Ke=Be*k-Te*z,_t=Te*N-De*k,Ft=(A[0]*ot+A[1]*Ke+A[2]*_t)*be;return Ft<0||Ze+Ft>1?null:(H*ot+q*Ke+X*_t)*be}function wM(o,s,a){return(o-s)/(a-s)}function Ty(o,s,a,d,h,m,_,b,T){const S=1<<a,A=m-d,k=_-h,N=(o+1)/S*A+d,z=(s+0)/S*k+h,H=(s+1)/S*k+h;b[0]=(o+0)/S*A+d,b[1]=z,T[0]=N,T[1]=H}class kb{constructor(s){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=s,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(m){const _=Math.ceil(Math.log2(m.dim/8)),b=[];let T=Math.ceil(Math.pow(2,_));const S=1/T,A=(z,H,q,X,ee)=>{const de=X?1:0,ue=(z+1)*q-de,fe=H*q,be=(H+1)*q-de;ee[0]=z*q,ee[1]=fe,ee[2]=ue,ee[3]=be};let k=new BP(T);const N=[];for(let z=0;z<T*T;z++){A(z%T,Math.floor(z/T),S,!1,N);const H=Mp(N[0],N[1],m),q=Mp(N[2],N[1],m),X=Mp(N[2],N[3],m),ee=Mp(N[0],N[3],m);k.minimums.push(Math.min(H,q,X,ee)),k.maximums.push(Math.max(H,q,X,ee)),k.leaves.push(1)}for(b.push(k),T/=2;T>=1;T/=2){const z=b[b.length-1];k=new BP(T);for(let H=0;H<T*T;H++){A(H%T,Math.floor(H/T),2,!0,N);const q=z.getElevation(N[0],N[1]),X=z.getElevation(N[2],N[1]),ee=z.getElevation(N[2],N[3]),de=z.getElevation(N[0],N[3]),ue=z.isLeaf(N[0],N[1]),fe=z.isLeaf(N[2],N[1]),be=z.isLeaf(N[2],N[3]),Te=z.isLeaf(N[0],N[3]),De=Math.min(q.min,X.min,ee.min,de.min),Be=Math.max(q.max,X.max,ee.max,de.max),Ze=ue&&fe&&be&&Te;k.maximums.push(Be),k.minimums.push(De),k.leaves.push(Be-De<=5&&Ze?1:0)}b.push(k)}return b}(this.dem),d=a.length-1,h=a[d];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(a,0,0,d,0)}raycastRoot(s,a,d,h,m,_,b=1){return zP([s,a,-100],[d,h,this.maximums[0]*b],m,_)}raycast(s,a,d,h,m,_,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(s,a,d,h,m,_,b);if(null==T)return null;const S=[],A=[],k=[],N=[],z=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:H,t:q,nodex:X,nodey:ee,depth:de}=z.pop();if(this.leaves[H]){Ty(X,ee,de,s,a,d,h,k,N);const fe=1<<de,be=(X+0)/fe,Te=(X+1)/fe,De=(ee+0)/fe,Be=(ee+1)/fe,Ze=Mp(be,De,this.dem)*b,ot=Mp(Te,De,this.dem)*b,Ke=Mp(Te,Be,this.dem)*b,_t=Mp(be,Be,this.dem)*b,Ft=s0(k[0],k[1],Ze,N[0],k[1],ot,N[0],N[1],Ke,m,_),yt=s0(N[0],N[1],Ke,k[0],N[1],_t,k[0],k[1],Ze,m,_),Wt=Math.min(null!==Ft?Ft:Number.MAX_VALUE,null!==yt?yt:Number.MAX_VALUE);if(Wt!==Number.MAX_VALUE)return Wt;{const mt=f.$.scaleAndAdd([],m,_,q);if(aE(Ze,ot,_t,Ke,wM(mt[0],k[0],N[0]),wM(mt[1],k[1],N[1]))>=mt[2])return q}continue}let ue=0;for(let fe=0;fe<this._siblingOffset.length;fe++){Ty((X<<1)+this._siblingOffset[fe][0],(ee<<1)+this._siblingOffset[fe][1],de+1,s,a,d,h,k,N),k[2]=-100,N[2]=this.maximums[this.childOffsets[H]+fe]*b;const be=zP(k,N,m,_);if(null!=be){const Te=be;S[fe]=Te;let De=!1;for(let Be=0;Be<ue&&!De;Be++)Te>=S[A[Be]]&&(A.splice(Be,0,fe),De=!0);De||(A[ue]=fe),ue++}}for(let fe=0;fe<ue;fe++){const be=A[fe];z.push({idx:this.childOffsets[H]+be,t:S[be],nodex:(X<<1)+this._siblingOffset[be][0],nodey:(ee<<1)+this._siblingOffset[be][1],depth:de+1})}}return null}_addNode(s,a,d){return this.minimums.push(s),this.maximums.push(a),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(s,a,d,h,m){if(1===s[h].isLeaf(a,d))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,b=s[_];let T=0,S=0;for(let A=0;A<this._siblingOffset.length;A++){const k=2*a+this._siblingOffset[A][0],N=2*d+this._siblingOffset[A][1],z=b.getElevation(k,N),H=b.isLeaf(k,N),q=this._addNode(z.min,z.max,H);H&&(T|=1<<A),S||(S=q)}for(let A=0;A<this._siblingOffset.length;A++)T&1<<A||this._construct(s,2*a+this._siblingOffset[A][0],2*d+this._siblingOffset[A][1],_,S+A)}}function aE(o,s,a,d,h,m){return dn(dn(o,a,m),dn(s,d,m),h)}function Mp(o,s,a){const d=a.dim,h=Dr(o*d-.5,0,d-1),m=Dr(s*d-.5,0,d-1),_=Math.floor(h),b=Math.floor(m),T=Math.min(_+1,d-1),S=Math.min(b+1,d-1);return aE(a.get(_,b),a.get(T,b),a.get(_,S),a.get(T,S),h-_,m-b)}const TM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function lE(o,s,a){return(256*o*256+256*s+a)/10-1e4}function EM(o,s,a){return 256*o+s+a/256-32768}class Ap{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(s,a,d,h=!1){if(this.uid=s,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(d&&"mapbox"!==d&&"terrarium"!==d)return Ns(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const m=this.dim=a.height-2,_=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let T=0;T<m;T++)_[this._idx(-1,T)]=_[this._idx(0,T)],_[this._idx(m,T)]=_[this._idx(m-1,T)],_[this._idx(T,-1)]=_[this._idx(T,0)],_[this._idx(T,m)]=_[this._idx(T,m-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(m,-1)]=_[this._idx(m-1,0)],_[this._idx(-1,m)]=_[this._idx(0,m-1)],_[this._idx(m,m)]=_[this._idx(m-1,m-1)]}const b="terrarium"===d?EM:lE;for(let T=0;T<_.length;++T){const S=4*T;this.floatView[T]=b(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=Oa.now()}_buildQuadTree(){this._tree=new kb(this)}get(s,a,d=!1){d&&(s=Dr(s,-1,this.dim),a=Dr(a,-1,this.dim));const h=this._idx(s,a);return this.floatView[h]}set(s,a,d){const h=this._idx(s,a),m=this.floatView[h];return this.floatView[h]=d,d-m}static getUnpackVector(s){return TM[s]}_idx(s,a){if(s<-1||s>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(s+1)}static pack(s,a){const d=[0,0,0,0],h=Ap.getUnpackVector(a);let m=Math.floor((s+h[3])/h[2]);return d[2]=m%256,m=Math.floor(m/256),d[1]=m%256,m=Math.floor(m/256),d[0]=m,d}getPixels(){return new Zl({width:this.stride,height:this.stride},this.pixels)}backfillBorder(s,a,d){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let h=a*this.dim,m=a*this.dim+this.dim,_=d*this.dim,b=d*this.dim+this.dim;switch(a){case-1:h=m-1;break;case 1:m=h+1}switch(d){case-1:_=b-1;break;case 1:b=_+1}const T=-a*this.dim,S=-d*this.dim;for(let A=_;A<b;A++)for(let k=h;k<m;k++){const N=4*this._idx(k,A),z=4*this._idx(k+T,A+S);this.pixels[N+0]=s.pixels[z+0],this.pixels[N+1]=s.pixels[z+1],this.pixels[N+2]=s.pixels[z+2],this.pixels[N+3]=s.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Fe(Ap,"DEMData"),Fe(kb,"DemMinMaxQuadTree",{omit:["dem"]});class mg{constructor(s,a,d){this._demTile=s,this._dem=this._demTile.dem,this._scale=a,this._offset=d}static create(s,a,d){const h=d||s.findDEMTileFor(a);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,b=1<<a.canonical.z-_.canonical.z;return new mg(h,m.dim/Jt/b,[(a.canonical.x/b-_.canonical.x)*m.dim,(a.canonical.y/b-_.canonical.y)*m.dim])}tileCoordToPixel(s,a){const d=a*this._scale+this._offset[1],h=Math.floor(s*this._scale+this._offset[0]),m=Math.floor(d);return new rn(h,m)}getElevationAt(s,a,d,h){const m=s*this._scale+this._offset[0],_=a*this._scale+this._offset[1],b=Math.floor(m),T=Math.floor(_),S=this._dem;return h=!!h,d?dn(dn(S.get(b,T,h),S.get(b,T+1,h),_-T),dn(S.get(b+1,T,h),S.get(b+1,T+1,h),_-T),m-b):S.get(b,T,h)}getElevationAtPixel(s,a,d){return this._dem.get(s,a,!!d)}getMeterToDEM(s){return(1<<this._demTile.tileID.canonical.z)*bl(1,s)*this._dem.stride}}const Ey={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},CM=pg.types,SM=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],DM=["fill-extrusion-flood-light-ground-radius"],Ob=Math.pow(2,13),cE=Math.pow(2,15)-1,uE=new rn(0,1),Ku=2147483648;function gg(o,s,a,d,h,m,_,b){o.emplaceBack((s<<1)+_,(a<<1)+m,(Math.floor(d*Ob)<<1)+h,Math.round(b))}function uh(o,s,a,d){o.emplaceBack(s.x*Jt,s.y*Jt,a?0:1,d?1:0)}function Pb(o,s,a,d,h,m){o.emplaceBack(s.x,s.y,(a.x<<1)+d,(a.y<<1)+h,m)}function Cy(o,s,a){o.emplaceBack(s.x,s.y,s.z,16384*a[0],16384*a[1],16384*a[2])}class UP{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Sy{constructor(){this.centroidXY=new rn(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new rn(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new rn(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new rn(this.max.x-this.min.x,this.max.y-this.min.y)}}class Rb{constructor(){this.acc=new rn(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(s,a){s.min.x===Number.MAX_VALUE&&(s.min.x=s.max.x=a.x,s.min.y=s.max.y=a.y)}appendEdge(s,a,d){this.accCount++,this.acc._add(a);let h=!!this.borders;a.x<s.min.x?(s.min.x=a.x,h=!0):a.x>s.max.x&&(s.max.x=a.x,h=!0),a.y<s.min.y?(s.min.y=a.y,h=!0):a.y>s.max.y&&(s.max.y=a.y,h=!0),((0===a.x||a.x===Jt)&&a.x===d.x)!=((0===a.y||a.y===Jt)&&a.y===d.y)&&this.processBorderOverlap(a,d),h&&this.checkBorderIntersection(a,d)}checkBorderIntersection(s,a){a.x<0!=s.x<0&&this.addBorderIntersection(0,dn(a.y,s.y,(0-a.x)/(s.x-a.x))),a.x>Jt!=s.x>Jt&&this.addBorderIntersection(1,dn(a.y,s.y,(Jt-a.x)/(s.x-a.x))),a.y<0!=s.y<0&&this.addBorderIntersection(2,dn(a.x,s.x,(0-a.y)/(s.y-a.y))),a.y>Jt!=s.y>Jt&&this.addBorderIntersection(3,dn(a.x,s.x,(Jt-a.y)/(s.y-a.y)))}addBorderIntersection(s,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[s];a<d[0]&&(d[0]=a),a>d[1]&&(d[1]=a)}processBorderOverlap(s,a){if(s.x===a.x){if(s.y===a.y)return;const d=0===s.x?0:1;this.addBorderIntersection(d,a.y),this.addBorderIntersection(d,s.y)}else{const d=0===s.y?2:3;this.addBorderIntersection(d,a.x),this.addBorderIntersection(d,s.x)}}centroid(){return 0===this.accCount?new rn(0,0):new rn(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((s,a)=>s+ +(a[0]!==Number.MAX_VALUE),0):0}}function dE(o,s){const a=o.add(s)._unit(),d=Dr(o.x*a.x+o.y*a.y,-1,1);var h,m,_;return h=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(h)))/4*cE*((m=o).x*(_=s).y-m.y*_.x<0?-1:1)}const MM=[o=>o.x<0,o=>o.x>Jt,o=>o.y<0,o=>o.y>Jt];function AM(o,s,a,d){const h=[4];if(0===d)return h;a._mult(d);const m=o.sub(a),_=s.sub(a),b=[o,s,m,_];for(let T=0;T<4;T++)for(const S of b)if(MM[T](S)){h.push(T);break}return h}class Ip{constructor(s){this.vertexArray=new _T,this.indexArray=new fo,this.programConfigurations=new to(s.layers,{zoom:s.zoom,lut:s.lut},a=>DM.includes(a)),this._segments=new _s,this.hiddenByLandmarkVertexArray=new vT,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new _s}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(s,a,d,h=!1){const m=s.length;if(m>2){let _=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let T;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const S=s[0],A=s[1];T=dE(S.sub(s[m-1])._perp()._unit(),A.sub(S)._perp()._unit())}for(let S=0;S<m;S++){const A=S===m-1?0:S+1,k=s[S],N=s[A],z=s[A===m-1?0:A+1],H=N.sub(k)._perp()._unit(),q=dE(H,z.sub(N)._perp()._unit()),X=T,ee=q;if(hE(k,N,a)||h&&pc(k,a)&&pc(N,a)){T=q;continue}const de=b.vertexLength;Pb(this.vertexArray,k,N,1,1,X),Pb(this.vertexArray,k,N,1,0,X),Pb(this.vertexArray,k,N,0,1,ee),Pb(this.vertexArray,k,N,0,0,ee),b.vertexLength+=4;const ue=AM(k,N,H,d);for(const fe of ue)this._segmentToGroundQuads[_].push({id:de,region:fe}),this._segmentToRegionTriCounts[_][fe]+=2,b.primitiveLength+=2;T=q}}}prepareBorderSegments(){if(!this.hasData())return;const s=this._segments.get(),a=s.length;for(let d=0;d<a;d++)this._segmentToGroundQuads[d].sort((h,m)=>h.region-m.region);for(let d=0;d<a;d++){const h=this._segmentToGroundQuads[d],m=s[d],_=this._segmentToRegionTriCounts[d];_.reduce((T,S)=>T+S,0);let b=0;for(let T=0;T<=4;T++){const S=_[T];if(0!==S){let A=this.regionSegments[T];A||(A=this.regionSegments[T]=new _s);const k={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:S};A.get().push(k)}b+=S}for(let T=0;T<h.length;T++){const S=h[T].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(s,a,d,h,m,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,s,a,d,h,m,_)}upload(s){this.hasData()&&(this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Dp.members),this.indexBuffer=s.createIndexBuffer(this.indexArray))}uploadPaintProperties(s){this.hasData()&&this.programConfigurations.upload(s)}update(s,a,d,h,m,_){this.hasData()&&this.programConfigurations.updatePaintArrays(s,a,d,h,m,_)}updateHiddenByLandmark(s){if(!this.hasData())return;const a=s.groundVertexCount+s.groundVertexArrayOffset;if(0===s.groundVertexCount)return;const d=s.flags&Ku?1:0;for(let h=s.groundVertexArrayOffset;h<a;++h)this.hiddenByLandmarkVertexArray.emplace(h,d);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(s){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=s.createVertexBuffer(this.hiddenByLandmarkVertexArray,yM.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let s=0;s<=4;s++){const a=this.regionSegments[s];a&&a.destroy()}}}}class Nb{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=s.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new fo,this.footprintVertices=new Vc,this.footprintSegments=[],this.layoutVertexArray=new ho,this.centroidVertexArray=new U_,this.wallVertexArray=new tb,this.indexArray=new fo,this.programConfigurations=new to(s.layers,{zoom:s.zoom,lut:s.lut},a=>SM.includes(a)),this.segments=new _s,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new Ip(s),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(s,a){}populate(s,a,d,h){this.features=[],this.hasPattern=KT("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=lb(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:m,id:_,index:b,sourceLayerIndex:T}of s){const S=this.layers[0]._featureFilter.needGeometry,A=oh(m,S);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),A,d))continue;const k={id:_,sourceLayerIndex:T,index:b,geometry:S?A.geometry:gu(m,d,h),properties:m.properties,type:m.type,patterns:{}},N=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(JT("fill-extrusion",this.layers,k,this.zoom,a));else if(this.wallMode)for(const z of k.geometry)this.addFeature(k,[z],b,d,{},a.availableImages,h,a.brightness);else this.addFeature(k,k.geometry,b,d,{},a.availableImages,h,a.brightness);a.featureIndex.insert(m,k.geometry,b,T,this.index,N)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(s,a,d,h,m,_){for(const b of this.features){const{geometry:T}=b;if(this.wallMode)for(const S of T)this.addFeature(b,[S],b.index,a,d,h,m,_);else this.addFeature(b,T,b.index,a,d,h,m,_)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(s,a,d,h,m){const _=0!==Object.keys(s).length;if(_&&!this.stateDependentLayers.length)return;const b=_?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(s,a,b,d,h,m),this.groundEffect.update(s,a,b,d,h,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,FP),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.wallVertexBuffer=s.createVertexBuffer(this.wallVertexArray,c5.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=s.createVertexBuffer(this.layoutVertexExtArray,NP.members,!0)),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}uploadCentroid(s){this.groundEffect.uploadHiddenByLandmark(s),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,l5.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,a,d,h,m,_,b,T){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,A=[new rn(0,0),new rn(Jt,Jt)],k=b.projection,N="globe"===k.name,z=this.wallMode||"Polygon"===CM[s.type],H=new Rb;H.centroidDataIndex=this.centroidData.length;const q=new Sy,X=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},h)<=0,ee=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},h);let de;if(q.height=ee,q.vertexArrayOffset=this.layoutVertexArray.length,q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Kx),this.wallMode){if(N)return void Ns("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==a.length)return;de=function(ot){const Ke=ot[0].x===ot[ot.length-1].x&&ot[0].y===ot[ot.length-1].y;(function(Mn){let hn=0;const tn=Mn.length;for(let Yn=0;Yn<tn;Yn++)hn+=(Mn[(Yn+1)%tn].x-Mn[Yn].x)*(Mn[(Yn+1)%tn].y+Mn[Yn].y);return hn>=0})(ot)||(ot=ot.reverse());const Ft={isPolygon:Ke,geometry:[],joinNormals:[]},yt=[],Wt=[],mt=[];let Tt=ot.length;if(Tt<(Ke?3:2))return Ft;for(;Tt>=2&&ot[Tt-1].equals(ot[Tt-2]);)Tt--;let Kt,bt,Zt,Xt,Ut,Rn=0;for(;Rn<Tt-1&&ot[Rn].equals(ot[Rn+1]);)Rn++;Ke&&(Kt=ot[Tt-2],Ut=ot[Rn].sub(Kt)._unit()._perp());for(let Mn=Rn;Mn<Tt;Mn++){if(Zt=Mn===Tt-1?Ke?ot[Rn+1]:void 0:ot[Mn+1],Zt&&ot[Mn].equals(Zt))continue;Ut&&(Xt=Ut),Kt&&(bt=Kt),Kt=ot[Mn],Ut=Zt?Zt.sub(Kt)._unit()._perp():Xt,Xt=Xt||Ut;const hn=Xt.add(Ut);0===hn.x&&0===hn.y||hn._unit();const tn=hn.x*Ut.x+hn.y*Ut.y,Yn=0!==tn?1/tn:1/0,kn=Xt.x*Ut.y-Xt.y*Ut.x>0;let xn="miter";"miter"===xn&&Yn>2&&(xn="bevel");const or=(ur,dr,vr,zr)=>{const Ir=new rn(ur.x,ur.y),Ti=new rn(ur.x,ur.y);Ir.x-=dr.x*zr,Ir.y-=dr.y*zr,Ti.x-=dr.x*Math.max(vr,1),Ti.y-=dr.y*Math.max(vr,1),mt.push(dr),yt.push(Ir),Wt.push(Ti)};if("miter"===xn)hn._mult(Yn),or(Kt,hn,1,0);else{const ur=-Math.sqrt(Yn*Yn-1),dr=kn?ur:0,vr=kn?0:ur;bt&&or(Kt,Xt,dr,vr),Zt&&or(Kt,Ut,dr,vr)}}return Ft.geometry=[...yt,...Wt.reverse(),yt[0]],Ft.joinNormals=[...mt,...mt.reverse(),mt[mt.length-1]],Ft}(a[0]),a=[de.geometry]}const ue=(ot,Ke)=>ot<(Ke.length-1)/2||ot===Ke.length-1,fe=this.wallMode?[a]:YT(a,500);for(let ot=fe.length-1;ot>=0;ot--){const Ke=fe[ot];(0===Ke.length||(be=Ke[0]).every(_t=>_t.x<=0)||be.every(_t=>_t.x>=Jt)||be.every(_t=>_t.y<=0)||be.every(_t=>_t.y>=Jt))&&fe.splice(ot,1)}var be;let Te;if(N)Te=RM(fe,A,h);else{Te=[];for(const ot of fe)Te.push({polygon:ot,bounds:A})}const De=z?this.edgeRadius:0,Be=De>0&&this.zoom<17,Ze=(ot,Ke)=>{if(0===ot.length)return!1;const _t=ot[ot.length-1];return Ke.x===_t.x&&Ke.y===_t.y};for(const{polygon:ot,bounds:Ke}of Te){let _t=0,Ft=0;for(const Tt of ot)z&&!Tt[0].equals(Tt[Tt.length-1])&&Tt.push(Tt[0]),Ft+=z?Tt.length-1:Tt.length;const yt=this.segments.prepareSegment((z?5:4)*Ft,this.layoutVertexArray,this.indexArray);q.footprintSegIdx<0&&(q.footprintSegIdx=this.footprintSegments.length),q.polygonSegIdx<0&&(q.polygonSegIdx=this.polygonSegments.length);const Wt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},mt=new UP;if(mt.vertexOffset=this.footprintVertices.length,mt.indexOffset=3*this.footprintIndices.length,mt.ringIndices=[],z){const Tt=[],Kt=[];_t=yt.vertexLength;for(let Zt=0;Zt<ot.length;Zt++){const Xt=ot[Zt];Xt.length&&0!==Zt&&Kt.push(Tt.length/2);const Ut=[];let Rn,Mn;Rn=Xt[1].sub(Xt[0])._perp()._unit(),mt.ringIndices.push(Xt.length-1);for(let hn=1;hn<Xt.length;hn++){const tn=Xt[hn],Yn=Xt[hn===Xt.length-1?1:hn+1],kn=tn.clone();if(De){Mn=Yn.sub(tn)._perp()._unit();const xn=Rn.add(Mn)._unit(),or=De*Math.min(4,1/(Rn.x*xn.x+Rn.y*xn.y));kn.x+=or*xn.x,kn.y+=or*xn.y,kn.x=Math.round(kn.x),kn.y=Math.round(kn.y),Rn=Mn}if(!X||0!==De&&!Be||Ze(Ut,kn)||Ut.push(kn),gg(this.layoutVertexArray,kn.x,kn.y,0,0,1,1,0),this.wallMode){const xn=ue(hn,Xt);uh(this.wallVertexArray,de.joinNormals[hn],xn,de.isPolygon)}yt.vertexLength++,this.footprintVertices.emplaceBack(tn.x,tn.y),Tt.push(tn.x,tn.y),N&&Cy(this.layoutVertexExtArray,k.projectTilePoint(kn.x,kn.y,h),k.upVector(h,kn.x,kn.y))}X&&(0===De||Be)&&(0!==Ut.length&&Ze(Ut,Ut[0])&&Ut.pop(),this.groundEffect.addData(Ut,Ke,S))}const bt=K_(Tt,Kt);for(let Zt=0;Zt<bt.length;Zt+=3)this.footprintIndices.emplaceBack(mt.vertexOffset+bt[Zt+0],mt.vertexOffset+bt[Zt+1],mt.vertexOffset+bt[Zt+2]),this.indexArray.emplaceBack(_t+bt[Zt],_t+bt[Zt+2],_t+bt[Zt+1]),yt.primitiveLength++;mt.indexCount+=bt.length,mt.vertexCount+=this.footprintVertices.length-mt.vertexOffset}for(let Tt=0;Tt<ot.length;Tt++){const Kt=ot[Tt];H.startRing(q,Kt[0]);let bt=Kt.length>4&&Ju(Kt[Kt.length-2],Kt[0],Kt[1]),Zt=De?VP(Kt[Kt.length-2],Kt[0],Kt[1],De):0;const Xt=[];let Ut,Rn,Mn;Rn=Kt[1].sub(Kt[0])._perp()._unit();let hn=!0;for(let tn=1,Yn=0;tn<Kt.length;tn++){let kn=Kt[tn-1],xn=Kt[tn];const or=Kt[tn===Kt.length-1?1:tn+1];if(H.appendEdge(q,xn,kn),hE(xn,kn,Ke)){De&&(Rn=or.sub(xn)._perp()._unit(),hn=!hn);continue}const ur=xn.sub(kn)._perp(),dr=ur.x/(Math.abs(ur.x)+Math.abs(ur.y)),vr=ur.y>0?1:0,zr=kn.dist(xn);if(Yn+zr>32768&&(Yn=0),De){Mn=or.sub(xn)._perp()._unit();let ar=kM(kn,xn,or,IM(Rn,Mn),De);isNaN(ar)&&(ar=0);const ri=xn.sub(kn)._unit();kn=kn.add(ri.mult(Zt))._round(),xn=xn.add(ri.mult(-ar))._round(),Zt=ar,Rn=Mn,X&&this.zoom>=17&&(Ze(Xt,kn)||Xt.push(kn),Ze(Xt,xn)||Xt.push(xn))}const Ir=yt.vertexLength,Ti=Kt.length>4&&Ju(kn,xn,or);let Pi=OM(Yn,bt,hn);if(gg(this.layoutVertexArray,kn.x,kn.y,dr,vr,0,0,Pi),gg(this.layoutVertexArray,kn.x,kn.y,dr,vr,0,1,Pi),this.wallMode){const ar=ue(tn-1,Kt),ri=de.joinNormals[tn-1];uh(this.wallVertexArray,ri,!ar,de.isPolygon),uh(this.wallVertexArray,ri,!ar,de.isPolygon)}if(Yn+=zr,Pi=OM(Yn,Ti,!hn),bt=Ti,gg(this.layoutVertexArray,xn.x,xn.y,dr,vr,0,0,Pi),gg(this.layoutVertexArray,xn.x,xn.y,dr,vr,0,1,Pi),this.wallMode){const ar=ue(tn,Kt),ri=de.joinNormals[tn];uh(this.wallVertexArray,ri,!ar,de.isPolygon),uh(this.wallVertexArray,ri,!ar,de.isPolygon)}if(yt.vertexLength+=4,this.indexArray.emplaceBack(Ir+0,Ir+1,Ir+2),this.indexArray.emplaceBack(Ir+1,Ir+3,Ir+2),yt.primitiveLength+=2,De){const ar=_t+(1===tn?Kt.length-2:tn-2),ri=1===tn?_t:ar+1;if(this.indexArray.emplaceBack(Ir+1,ar,Ir+3),this.indexArray.emplaceBack(ar,ri,Ir+3),yt.primitiveLength+=2,void 0===Ut&&(Ut=Ir),!hE(or,Kt[tn],Ke)){const hi=tn===Kt.length-1?Ut:yt.vertexLength;this.indexArray.emplaceBack(Ir+2,Ir+3,hi),this.indexArray.emplaceBack(Ir+3,hi+1,hi),this.indexArray.emplaceBack(Ir+3,ri,hi+1),yt.primitiveLength+=3}hn=!hn}if(N){const ar=this.layoutVertexExtArray,ri=k.projectTilePoint(kn.x,kn.y,h),hi=k.projectTilePoint(xn.x,xn.y,h),Zi=k.upVector(h,kn.x,kn.y),ks=k.upVector(h,xn.x,xn.y);Cy(ar,ri,Zi),Cy(ar,ri,Zi),Cy(ar,hi,ks),Cy(ar,hi,ks)}}z&&(_t+=Kt.length-1),X&&De&&this.zoom>=17&&(0!==Xt.length&&Ze(Xt,Xt[0])&&Xt.pop(),this.groundEffect.addData(Xt,Ke,S,De>0))}this.footprintSegments.push(mt),Wt.triangleCount=this.indexArray.length-Wt.triangleArrayOffset,this.polygonSegments.push(Wt),++q.footprintSegLen,++q.polygonSegLen}if(q.vertexCount=this.layoutVertexArray.length-q.vertexArrayOffset,q.groundVertexCount=this.groundEffect.vertexArray.length-q.groundVertexArrayOffset,0!==q.vertexCount){if(q.centroidXY=H.borders?uE:this.encodeCentroid(H,q),this.centroidData.push(q),H.borders){this.featuresOnBorder.push(H);const ot=this.featuresOnBorder.length-1;for(let Ke=0;Ke<H.borders.length;Ke++)H.borders[Ke][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ke].push(ot)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,d,m,_,h,T),this.groundEffect.addPaintPropertiesData(s,d,m,_,h,T),this.maxHeight=Math.max(this.maxHeight,ee)}}sortBorders(){for(let s=0;s<this.borderFeatureIndices.length;s++)this.borderFeatureIndices[s].sort((a,d)=>this.featuresOnBorder[a].borders[s][0]-this.featuresOnBorder[d].borders[s][0])}splitToSubtiles(){const s=[];for(let b=0;b<this.centroidData.length;b++){const T=this.centroidData[b],S=+(T.min.y+T.max.y>Jt),A=2*S+(+(T.min.x+T.max.x>Jt)^S);for(let k=0;k<T.polygonSegLen;k++){const N=T.polygonSegIdx+k;s.push({centroidIdx:b,subtile:A,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const a=new fo;s.sort((b,T)=>b.triangleSegmentIdx===T.triangleSegmentIdx?b.subtile-T.subtile:b.triangleSegmentIdx-T.triangleSegmentIdx);let d=0,h=0,m=0;for(const b of s){if(b.triangleSegmentIdx!==d)break;m++}const _=s.length;for(;h!==s.length;){d=s[h].triangleSegmentIdx;let b=0,T=h,S=h;for(let A=T;A<m&&s[A].subtile===b;A++)S++;for(;T!==m;){const A=s[T];b=A.subtile;const k=this.centroidData[A.centroidIdx].min.clone(),N=this.centroidData[A.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let H=T;H<S;H++){const q=s[H],X=this.polygonSegments[q.polygonSegmentIdx],ee=this.centroidData[q.centroidIdx].min,de=this.centroidData[q.centroidIdx].max,ue=this.indexArray.uint16;for(let fe=X.triangleArrayOffset;fe<X.triangleArrayOffset+X.triangleCount;fe++)a.emplaceBack(ue[3*fe],ue[3*fe+1],ue[3*fe+2]);z.primitiveLength+=X.triangleCount,k.x=Math.min(k.x,ee.x),k.y=Math.min(k.y,ee.y),N.x=Math.max(N.x,de.x),N.y=Math.max(N.y,de.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:k,max:N}),T=S;for(let H=T;H<m&&s[H].subtile===s[T].subtile;H++)S++}h=m;for(let A=h;A<_&&s[A].triangleSegmentIdx===s[h].triangleSegmentIdx;A++)m++}a._trim(),this.indexArray=a}getVisibleSegments(s,a,d){const h=new _s;if(this.wallMode){for(const q of this.triangleSubSegments)h.segments.push(q.segment);return h}let m=0,_=0;const b=1<<s.canonical.z;if(a){const q=a.getMinMaxForTile(s);q&&(m=q.min,_=q.max)}_+=this.maxHeight;const T=s.toUnwrapped();let S;const A=[T.canonical.x/b+T.wrap,T.canonical.y/b],k=[(T.canonical.x+1)/b+T.wrap,(T.canonical.y+1)/b],N=(q,X,ee)=>[q[0]*(1-ee[0])+X[0]*ee[0],q[1]*(1-ee[1])+X[1]*ee[1]],z=[],H=[];for(const q of this.triangleSubSegments){z[0]=q.min.x/Jt,z[1]=q.min.y/Jt,H[0]=q.max.x/Jt,H[1]=q.max.y/Jt;const X=N(A,k,z),ee=N(A,k,H);if(0===new ds([X[0],X[1],m],[ee[0],ee[1],_]).intersectsPrecise(d)){S&&(h.segments.push(S),S=void 0);continue}const de=q.segment;S&&S.vertexOffset!==de.vertexOffset&&(h.segments.push(S),S=void 0),S?(S.vertexLength+=de.vertexLength,S.primitiveLength+=de.primitiveLength):S={vertexOffset:de.vertexOffset,primitiveLength:de.primitiveLength,vertexLength:de.vertexLength,primitiveOffset:de.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&h.segments.push(S),h}encodeCentroid(s,a){const d=s.centroid(),h=a.span(),m=Math.min(7,Math.round(h.x*this.tileToMeter/10)),_=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new rn(Dr(d.x,1,Jt-1)<<3|m,Dr(d.y,1,Jt-1)<<3|_)}encodeBorderCentroid(s){if(!s.borders)return new rn(0,0);const a=s.borders,d=Number.MAX_VALUE;if(a[0][0]!==d||a[1][0]!==d){const h=a[0][0]!==d?0:1;return new rn(6|(a[0][0]!==d?0:65528),(a[h][0]+a[h][1])/2<<3|6)}{const h=a[2][0]!==d?2:3;return new rn((a[h][0]+a[h][1])/2<<3|6,6|(a[2][0]!==d?0:65528))}}showCentroid(s){const a=this.centroidData[s.centroidDataIndex];a.flags&=Ku,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(s){this.groundEffect.updateHiddenByLandmark(s);const a=s.vertexArrayOffset,d=s.vertexCount+s.vertexArrayOffset,h=s.flags&Ku?uE:s.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==h.y||m!==h.x){for(let _=a;_<d;++_)this.centroidVertexArray.emplace(_,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.centroidData)this.writeCentroidToBuffer(s)}updateReplacement(s,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(s.toUnwrapped());if(Ab(this.activeReplacements,h))return;if(this.activeReplacements=h,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const m=[];for(const _ of this.activeReplacements){if(_.order<d)continue;const b=Math.pow(2,_.footprintTileId.canonical.z-s.canonical.z);for(const T of this.centroidData)if(!(T.flags&Ku||_.min.x>T.max.x||T.min.x>_.max.x||_.min.y>T.max.y||T.min.y>_.max.y))for(let S=0;S<T.footprintSegLen;S++){const A=this.footprintSegments[T.footprintSegIdx+S];if(m.length=0,jP(this.footprintVertices,A.vertexOffset,A.vertexCount,_.footprintTileId.canonical,s.canonical,m),r0(_.footprint,m,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-b)){T.flags|=Ku;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(s,a,d){let h=!1;for(let m=0;m<d.footprintSegLen;m++){const _=this.footprintSegments[d.footprintSegIdx+m];let b=0;for(const T of _.ringIndices){for(let S=b,A=T+b-1;S<T+b;A=S++){const k=this.footprintVertices.int16[2*(S+_.vertexOffset)+0],N=this.footprintVertices.int16[2*(S+_.vertexOffset)+1],z=this.footprintVertices.int16[2*(A+_.vertexOffset)+1];N>a!=z>a&&s<(this.footprintVertices.int16[2*(A+_.vertexOffset)+0]-k)*(a-N)/(z-N)+k&&(h=!h)}b=T}}return h}getHeightAtTileCoord(s,a){let d=Number.NEGATIVE_INFINITY,h=!0;const m=4*(s+Jt)*Jt+(a+Jt);if(this.partLookup.hasOwnProperty(m)){const _=this.partLookup[m];return _?{height:_.height,hidden:!!(_.flags&Ku)}:void 0}for(const _ of this.centroidData)s>_.max.x||_.min.x>s||a>_.max.y||_.min.y>a||this.footprintContainsPoint(s,a,_)&&_&&_.height>d&&(d=_.height,this.partLookup[m]=_,h=!!(_.flags&Ku));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:h};this.partLookup[m]=void 0}}function IM(o,s){const a=o.add(s)._unit();return o.x*a.x+o.y*a.y}function VP(o,s,a,d){const h=s.sub(o)._perp()._unit(),m=a.sub(s)._perp()._unit();return kM(o,s,a,IM(h,m),d)}function kM(o,s,a,d,h){const m=Math.sqrt(1-d*d);return Math.min(o.dist(s)/3,s.dist(a)/3,h*m/d)}function hE(o,s,a){return o.x<a[0].x&&s.x<a[0].x||o.x>a[1].x&&s.x>a[1].x||o.y<a[0].y&&s.y<a[0].y||o.y>a[1].y&&s.y>a[1].y}function pc(o,s){return o.x<s[0].x||o.x>s[1].x||o.y<s[0].y||o.y>s[1].y}function Ju(o,s,a){if(o.x<0||o.x>=Jt||s.x<0||s.x>=Jt||a.x<0||a.x>=Jt)return!1;const d=a.sub(s),h=d.perp(),m=o.sub(s);return(d.x*m.x+d.y*m.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function OM(o,s,a){const d=s?2|o:-3&o;return a?1|d:-2&d}function PM(){const o=Math.PI/32,s=Math.tan(o),a=cg;return a*Math.sqrt(1+2*s*s)-a}function RM(o,s,a){const d=1<<a.z,h=ga(a.x/d),m=ga((a.x+1)/d),_=Xo(a.y/d),b=Xo((a.y+1)/d);return function(T,S,A,k,N=0,z){const H=[];if(!T.length||!A||!k)return H;const q=(Te,De)=>{for(const Be of Te)H.push({polygon:Be,bounds:De})},X=Math.ceil(Math.log2(A)),ee=Math.ceil(Math.log2(k)),de=X-ee,ue=[];for(let Te=0;Te<Math.abs(de);Te++)ue.push(de>0?0:1);for(let Te=0;Te<Math.min(X,ee);Te++)ue.push(0),ue.push(1);let fe=T;if(fe=iE(fe,S[0].y-N,S[1].y+N,1),fe=iE(fe,S[0].x-N,S[1].x+N,0),!fe.length)return H;const be=[];for(ue.length?be.push({polygons:fe,bounds:S,depth:0}):q(fe,S);be.length;){const Te=be.pop(),De=Te.depth,Be=ue[De],Ze=Te.bounds[0],ot=Te.bounds[1],Ke=0===Be?Ze.x:Ze.y,_t=0===Be?ot.x:ot.y,Ft=z?z(Be,Ke,_t):.5*(Ke+_t),yt=iE(Te.polygons,Ke-N,Ft+N,Be),Wt=iE(Te.polygons,Ft-N,_t+N,Be);if(yt.length){const mt=[Ze,new rn(0===Be?Ft:ot.x,1===Be?Ft:ot.y)];ue.length>De+1?be.push({polygons:yt,bounds:mt,depth:De+1}):q(yt,mt)}if(Wt.length){const mt=[new rn(0===Be?Ft:Ze.x,1===Be?Ft:Ze.y),ot];ue.length>De+1?be.push({polygons:Wt,bounds:mt,depth:De+1}):q(Wt,mt)}}return H}(o,s,Math.ceil((m-h)/11.25),Math.ceil((_-b)/11.25),1,(T,S,A)=>{if(0===T)return.5*(S+A);{const k=Xo((a.y+S/Jt)/d);return(fc(.5*(Xo((a.y+A/Jt)/d)+k))*d-a.y)*Jt}})}function jP(o,s,a,d,h,m){const _=Math.pow(2,d.z-h.z);for(let b=0;b<a;b++){let T=o.int16[2*(b+s)+0],S=o.int16[2*(b+s)+1];T=(T+h.x*Jt)*_-d.x*Jt,S=(S+h.y*Jt)*_-d.y*Jt,m.push(new rn(T,S))}}let NM,FM;function o0(o,s){return o.x*s.x+o.y*s.y}function LM(o,s){if(1===o.length){let a=0;const d=s[a++];let h;for(;!h||d.equals(h);)if(h=s[a++],!h)return 1/0;for(;a<s.length;a++){const m=s[a],_=o[0],b=h.sub(d),T=m.sub(d),S=_.sub(d),A=o0(b,b),k=o0(b,T),N=o0(T,T),z=o0(S,b),H=o0(S,T),q=A*N-k*k,X=(N*z-k*H)/q,ee=(A*H-k*z)/q,de=d.z*(1-X-ee)+h.z*X+m.z*ee;if(isFinite(de))return de}return 1/0}{let a=1/0;for(const d of s)a=Math.min(a,d.z);return a}}function BM(o,s,a,d,h,m,_,b){const T=_*h.getElevationAt(o,s,!0,!0),S=0!==m[0],A=S?0===m[1]?_*(m[0]/7-450):_*function(k,N,z){const H=Math.floor(N[0]/8),q=Math.floor(N[1]/8),X=10*(N[0]-8*H),ee=10*(N[1]-8*q),de=k.getElevationAt(H,q,!0,!0),ue=k.getMeterToDEM(z),fe=Math.floor(.5*(X*ue-1)),be=Math.floor(.5*(ee*ue-1)),Te=k.tileCoordToPixel(H,q),De=2*fe+1,Be=2*be+1,Ze=(Kt=De,bt=Be,[(Wt=k).getElevationAtPixel(mt=Te.x-fe,Tt=Te.y-be,!0),Wt.getElevationAtPixel(mt+bt,Tt,!0),Wt.getElevationAtPixel(mt,Tt+bt,!0),Wt.getElevationAtPixel(mt+Kt,Tt+bt,!0)]),ot=Math.abs(Ze[0]-Ze[1]),Ke=Math.abs(Ze[2]-Ze[3]),_t=Math.abs(Ze[0]-Ze[2])+Math.abs(Ze[1]-Ze[3]),Ft=Math.min(.25,.5*ue*(ot+Ke)/De),yt=Math.min(.25,.5*ue*_t/Be);var Wt,mt,Tt,Kt,bt;return de+Math.max(Ft*X,yt*ee)}(h,m,b):T;return{base:T+(0===a)?-1:a,top:S?Math.max(A+d,T+a+2):T+d}}Fe(Nb,"FillExtrusionBucket",{omit:["layers","features"]}),Fe(Sy,"PartData"),Fe(UP,"FootprintSegment"),Fe(Rb,"BorderCentroidData"),Fe(Ip,"GroundEffect");const $P=oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:HP}=$P,Fb=oi([{name:"a_packed",components:4,type:"Float32"}]),{members:Cf}=Fb,Dy=oi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:zM}=Dy,UM=oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),VM=oi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),d5=oi([{name:"a_projected_pos",components:4,type:"Float32"}],4);oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const GP=oi([{name:"a_z_offset",components:1,type:"Float32"}],4),h5=oi([{name:"a_texb",components:2,type:"Uint16"}]),fE=oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),pE=oi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const WP=oi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),f5=oi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);oi([{name:"triangle",components:3,type:"Uint16"}]),oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),oi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),oi([{type:"Float32",name:"offsetX"}]),oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class mE{constructor(s,a){this.width=s,this.height=a,this.nextRow=0,this.image=new Sp({width:s,height:a}),this.positions={},this.uploaded=!1}getDash(s,a){const d=this.getKey(s,a);return this.positions[d]}trim(){const s=this.width,a=this.height=np(this.nextRow);this.image.resize({width:s,height:a})}getKey(s,a){return s.join(",")+a}getDashRanges(s,a,d){const h=[];let m=s.length%2==1?-s[s.length-1]*d:0,_=s[0]*d,b=!0;h.push({left:m,right:_,isDash:b,zeroLength:0===s[0]});let T=s[0];for(let S=1;S<s.length;S++){b=!b;const A=s[S];m=T*d,T+=A,_=T*d,h.push({left:m,right:_,isDash:b,zeroLength:0===A})}return h}addRoundDash(s,a,d){const h=a/2;for(let m=-d;m<=d;m++){const _=this.width*(this.nextRow+d+m);let b=0,T=s[b];for(let S=0;S<this.width;S++){S/T.right>1&&(T=s[++b]);const A=Math.abs(S-T.left),k=Math.abs(S-T.right),N=Math.min(A,k);let z;const H=m/d*(h+1);if(T.isDash){const q=h-Math.abs(H);z=Math.sqrt(N*N+q*q)}else z=h-Math.sqrt(N*N+H*H);this.image.data[_+S]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(s,a){for(let T=s.length-1;T>=0;--T){const S=s[T],A=s[T+1];S.zeroLength?s.splice(T,1):A&&A.isDash===S.isDash&&(A.left=S.left,s.splice(T,1))}const d=s[0],h=s[s.length-1];d.isDash===h.isDash&&(d.left=h.left-this.width,h.right=d.right+this.width);const m=this.width*this.nextRow;let _=0,b=s[_];for(let T=0;T<this.width;T++){T/b.right>1&&(b=s[++_]);const S=Math.abs(T-b.left),A=Math.abs(T-b.right),k=Math.min(S,A);this.image.data[m+T]=Math.max(0,Math.min(255,(b.isDash?k:-k)+a+128))}}addDash(s,a){const d=this.getKey(s,a);if(this.positions[d])return this.positions[d];const h="round"===a,m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return Ns("LineAtlas out of space"),null;0===s.length&&s.push(1);let b=0;for(let A=0;A<s.length;A++)s[A]<0&&(Ns("Negative value is found in line dasharray, replacing values with 0"),s[A]=0),b+=s[A];if(0!==b){const A=this.width/b,k=this.getDashRanges(s,this.width,A);h?this.addRoundDash(k,A,m):this.addRegularDash(k,"square"===a?.5*A:0)}const T=this.nextRow+m;this.nextRow+=_;const S={tl:[T,m],br:[b,0]};return this.positions[d]=S,S}}Fe(mE,"LineAtlas");const qP=pg.types,ZP=Math.cos(Math.PI/180*37.5),XP=Math.cos(Math.PI/180*5);class Lb{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.projection=s.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new rg,this.layoutVertexArray2=new dc,this.patternVertexArray=new Zo,this.indexArray=new fo,this.programConfigurations=new to(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new _s,this.maxLineLength=0,this.zOffsetVertexArray=new yf,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=s.tessellationStep?s.tessellationStep:Jt/64}updateFootprints(s,a){}populate(s,a,d,h){this.hasPattern=KT("line",this.layers,a);const m=this.layers[0].layout.get("line-sort-key"),_=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!_.isConstant()||!!_.constantOr(0);const b=[];for(const{feature:k,id:N,index:z,sourceLayerIndex:H}of s){const q=this.layers[0]._featureFilter.needGeometry,X=oh(k,q);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),X,d))continue;const ee=m?m.evaluate(X,{},d):void 0,de={id:N,properties:k.properties,type:k.type,sourceLayerIndex:H,index:z,geometry:q?X.geometry:gu(k,d,h),patterns:{},sortKey:ee};b.push(de)}m&&b.sort((k,N)=>k.sortKey-N.sortKey);const{lineAtlas:T,featureIndex:S}=a,A=this.addConstantDashes(T);for(const k of b){const{geometry:N,index:z,sourceLayerIndex:H}=k;if(A&&this.addFeatureDashes(k,T),this.hasPattern){const q=JT("line",this.layers,k,this.zoom,a);this.patternFeatures.push(q)}else this.addFeature(k,N,z,d,T.positions,a.availableImages,a.brightness);S.insert(s[z].feature,N,z,H,this.index)}}addConstantDashes(s){let a=!1;for(const d of this.layers){const h=d.paint.get("line-dasharray").value,m=d.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)a=!0;else{const _=m.value,b=h.value;if(!b)continue;s.addDash(b,_)}}return a}addFeatureDashes(s,a){const d=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let b,T;if("constant"===m.kind){if(b=m.value,!b)continue}else b=m.evaluate({zoom:d},s);T="constant"===_.kind?_.value:_.evaluate({zoom:d},s),a.addDash(b,T),s.patterns[h.id]=a.getKey(b,T)}}update(s,a,d,h,m){const _=0!==Object.keys(s).length;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(s,a,_?this.stateDependentLayers:this.layers,d,h,m)}addFeatures(s,a,d,h,m,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,d,h,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Cf)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=s.createVertexBuffer(this.patternVertexArray,zM)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,GP.members,!0)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,HP),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,a,d,h,m,_,b){const T=this.layers[0].layout,S=T.get("line-join").evaluate(s,{}),A=T.get("line-cap").evaluate(s,{}),k=T.get("line-miter-limit"),N=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const z of a)this.addLine(z,s,h,S,A,k,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,d,m,_,h,b)}addLine(s,a,d,h,m,_,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const T={zoom:this.zoom,lineProgress:void 0},S=this.layers[0].layout,A="none"===h;if(this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Te=0;Te<s.length-1;Te++)this.totalDistance+=s[Te].dist(s[Te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k="Polygon"===qP[a.type];let N=s.length;for(;N>=2&&s[N-1].equals(s[N-2]);)N--;let z=0;for(;z<N-1&&s[z].equals(s[z+1]);)z++;if(N<(k?3:2))return;"bevel"===h&&(_=1.05);const H=this.overscaling<=16?15*Jt/(512*this.overscaling):0,q=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let X,ee,de,ue,fe,be;this.e1=this.e2=-1,k&&(X=s[N-2],fe=s[z].sub(X)._unit()._perp());for(let Te=z;Te<N;Te++){if(de=Te===N-1?k?s[z+1]:void 0:s[Te+1],de&&s[Te].equals(de))continue;if(fe&&(ue=fe),X&&(ee=X),X=s[Te],this.hasZOffset){const mt=S.get("line-z-offset").value;if("constant"===mt.kind)be=mt.value;else{if(this.lineClips){const Tt=this.totalDistance/(this.lineClips.end-this.lineClips.start);T.lineProgress=(Tt*this.lineClips.start+this.distance+(ee?ee.dist(X):0))/Tt}else Ns(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),T.lineProgress=0;be=mt.evaluate(T,a)}be=be||0}fe=de?de.sub(X)._unit()._perp():ue,ue=ue||fe;const De=ee&&de;let Be=De?h:k||A?"butt":m;const Ze=ue.x*fe.x+ue.y*fe.y;if(A){const mt=function(Tt){if(Tt.patternJoinNone){const Kt=Tt.segmentPoints.length/2,bt=Tt.lineSoFar-Tt.segmentStart;for(let Zt=0;Zt<Kt;++Zt){const Xt=Tt.segmentPoints[2*Zt+1],Ut=Math.round(Tt.segmentPoints[2*Zt])+.5+.25*Xt;Tt.patternVertexArray.emplaceBack(Ut,bt,Tt.segmentStart),Tt.patternVertexArray.emplaceBack(Ut,bt,Tt.segmentStart)}Tt.segmentPoints.length=0}Tt.e1=Tt.e2=-1};if(De&&Ze<XP){this.updateDistance(ee,X),this.addCurrentVertex(X,ue,1,1,q,be),mt(this),this.addCurrentVertex(X,fe,-1,-1,q,be);continue}if(ee){if(!de){this.updateDistance(ee,X),this.addCurrentVertex(X,ue,1,1,q,be),mt(this);continue}Be="miter"}}let ot=ue.add(fe);0===ot.x&&0===ot.y||ot._unit();const Ke=ot.x*fe.x+ot.y*fe.y,_t=0!==Ke?1/Ke:1/0,Ft=2*Math.sqrt(2-2*Ke),yt=Ke<ZP&&ee&&de,Wt=ue.x*fe.y-ue.y*fe.x>0;if(yt&&Te>z){const mt=X.dist(ee);if(mt>2*H){const Tt=X.sub(X.sub(ee)._mult(H/mt)._round());this.updateDistance(ee,Tt),this.addCurrentVertex(Tt,ue,0,0,q,be),ee=Tt}}if(De&&"round"===Be&&(_t<b?Be="miter":_t<=2&&(Be="fakeround")),"miter"===Be&&_t>_&&(Be="bevel"),"bevel"===Be&&(_t>2&&(Be="flipbevel"),_t<_&&(Be="miter")),ee&&this.updateDistance(ee,X),"miter"===Be)ot._mult(_t),this.addCurrentVertex(X,ot,0,0,q,be);else if("flipbevel"===Be){if(_t>100)ot=fe.mult(-1);else{const mt=_t*ue.add(fe).mag()/ue.sub(fe).mag();ot._perp()._mult(mt*(Wt?-1:1))}this.addCurrentVertex(X,ot,0,0,q,be),this.addCurrentVertex(X,ot.mult(-1),0,0,q,be)}else if("bevel"===Be||"fakeround"===Be){const mt=-Math.sqrt(_t*_t-1),Tt=Wt?mt:0,Kt=Wt?0:mt;if(ee&&this.addCurrentVertex(X,ue,Tt,Kt,q,be),"fakeround"===Be){const bt=Math.round(180*Ft/Math.PI/20);for(let Zt=1;Zt<bt;Zt++){let Xt=Zt/bt;if(.5!==Xt){const Rn=Xt-.5;Xt+=Xt*Rn*(Xt-1)*((1.0904+Ze*(Ze*(3.55645-1.43519*Ze)-3.2452))*Rn*Rn+(.848013+Ze*(.215638*Ze-1.06021)))}const Ut=fe.sub(ue)._mult(Xt)._add(ue)._unit()._mult(Wt?-1:1);this.addHalfVertex(X,Ut.x,Ut.y,!1,Wt,0,q,be)}}de&&this.addCurrentVertex(X,fe,-Tt,-Kt,q,be)}else"butt"===Be?this.addCurrentVertex(X,ot,0,0,q,be):"square"===Be?(ee||this.addCurrentVertex(X,ot,-1,-1,q,be),this.addCurrentVertex(X,ot,0,0,q,be),ee&&this.addCurrentVertex(X,ot,1,1,q,be)):"round"===Be&&(ee&&(this.addCurrentVertex(X,ue,0,0,q,be),this.addCurrentVertex(X,ue,1,1,q,be,!0)),de&&(this.addCurrentVertex(X,fe,-1,-1,q,be,!0),this.addCurrentVertex(X,fe,0,0,q,be)));if(yt&&Te<N-1){const mt=X.dist(de);if(mt>2*H){const Tt=X.add(de.sub(X)._mult(H/mt)._round());this.updateDistance(X,Tt),this.addCurrentVertex(Tt,fe,0,0,q,be),X=Tt}}}}addVerticesTo(s,a,d,h,m,_,b,T,S,A){const k=(a.w-s.w)/this.tessellationStep|0;if(k>1){this.lineSoFar=s.w;const N=(a.x-s.x)/k,z=(a.y-s.y)/k,H=(a.z-s.z)/k,q=(a.w-s.w)/k;for(let X=1;X<k;++X)s.x+=N,s.y+=z,s.z+=H,this.lineSoFar+=q,this.addHalfVertex(s,d,h,A,!1,b,S,s.z),this.addHalfVertex(s,m,_,A,!0,-T,S,s.z)}this.lineSoFar=a.w,this.addHalfVertex(a,d,h,A,!1,b,S,a.z),this.addHalfVertex(a,m,_,A,!0,-T,S,a.z)}addCurrentVertex(s,a,d,h,m,_,b=!1){const T=a.x+a.y*d,S=a.y-a.x*d,A=a.y*h-a.x,k=-a.y-a.x*h;if(null!=_){const z=Jt+10,H=_,q=new Cb(s.x,s.y,H,this.lineSoFar),X=jM(s,-10,z),ee=this.lineSoFar;if(this.currentVertex)if(X){const de=this.currentVertexIsOutside,ue=this.currentVertex,fe=new Cb(s.x,s.y,H,this.lineSoFar);n0(ue,fe,-10,z),jM(fe,-10,z)||(de&&(this.e1=this.e2=-1,this.lineSoFar=ue.w,this.addHalfVertex(ue,T,S,b,!1,d,m,ue.z),this.addHalfVertex(ue,A,k,b,!0,-h,m,ue.z)),this.addVerticesTo(ue,fe,T,S,A,k,d,h,m,b))}else{const de=this.currentVertex;this.currentVertexIsOutside&&(n0(de,q,-10,z),this.e1=this.e2=-1,this.lineSoFar=de.w,this.addHalfVertex(de,T,S,b,!1,d,m,de.z),this.addHalfVertex(de,A,k,b,!0,-h,m,de.z)),this.addVerticesTo(de,q,T,S,A,k,d,h,m,b)}else X||(this.addHalfVertex(s,T,S,b,!1,d,m,_),this.addHalfVertex(s,A,k,b,!0,-h,m,_));this.currentVertex=q,this.currentVertexIsOutside=X,this.lineSoFar=ee}else this.addHalfVertex(s,T,S,b,!1,d,m,_),this.addHalfVertex(s,A,k,b,!0,-h,m,_)}addHalfVertex({x:s,y:a},d,h,m,_,b,T,S){this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((s<<1)+(m?1:0),(a<<1)+(_?1:0),Math.round(63*d)+128,Math.round(63*h)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),T.primitiveLength++),_?this.e2=A:this.e1=A,null!=S&&this.zOffsetVertexArray.emplaceBack(S)}updateScaledDistance(){if(this.lineClips){const s=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=s*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(s,a){this.distance+=s.dist(a),this.updateScaledDistance()}}function jM(o,s,a){return o.x<s||o.x>a||o.y<s||o.y>a}let gE,_E;function $M(o,s,a){return s*(Jt/(o.tileSize*Math.pow(2,a-o.tileID.overscaledZ)))}function HM(o,s){return 1/$M(o,1,s.tileZoom)}function yE(o,s,a,d){return o.translatePosMatrix(d||s.tileID.projMatrix,s,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}Fe(Lb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const My=o=>{const s=[];vE(o)&&s.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT");const a=o.paint.get("line-trim-offset");0===a[0]&&0===a[1]||s.push("RENDER_LINE_TRIM_OFFSET"),0!==o.paint.get("line-border-width").constantOr(1)&&s.push("RENDER_LINE_BORDER");const d="none"===o.layout.get("line-join").constantOr("miter"),h=!!o.paint.get("line-pattern").constantOr(1);return d&&h&&s.push("LINE_JOIN_NONE"),s};function vE(o){const s=o.paint.get("line-dasharray").value;return s.value||"constant"!==s.kind}class Bb{constructor(s){this._stringToNumber={},this._numberToString=[];for(let a=0;a<s.length;a++){const d=s[a];this._stringToNumber[d]=a,this._numberToString[a]=d}}encode(s){return this._stringToNumber[s]}decode(s){return this._numberToString[s]}}var YP={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(o,s,a,d,h){var m,_,b=8*h-d-1,T=(1<<b)-1,S=T>>1,A=-7,k=a?h-1:0,N=a?-1:1,z=o[s+k];for(k+=N,m=z&(1<<-A)-1,z>>=-A,A+=b;A>0;m=256*m+o[s+k],k+=N,A-=8);for(_=m&(1<<-A)-1,m>>=-A,A+=d;A>0;_=256*_+o[s+k],k+=N,A-=8);if(0===m)m=1-S;else{if(m===T)return _?NaN:1/0*(z?-1:1);_+=Math.pow(2,d),m-=S}return(z?-1:1)*_*Math.pow(2,m-d)},write:function(o,s,a,d,h,m){var _,b,T,S=8*m-h-1,A=(1<<S)-1,k=A>>1,N=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,z=d?0:m-1,H=d?1:-1,q=s<0||0===s&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(b=isNaN(s)?1:0,_=A):(_=Math.floor(Math.log(s)/Math.LN2),s*(T=Math.pow(2,-_))<1&&(_--,T*=2),(s+=_+k>=1?N/T:N*Math.pow(2,1-k))*T>=2&&(_++,T/=2),_+k>=A?(b=0,_=A):_+k>=1?(b=(s*T-1)*Math.pow(2,h),_+=k):(b=s*Math.pow(2,k-1)*Math.pow(2,h),_=0));h>=8;o[a+z]=255&b,z+=H,b/=256,h-=8);for(_=_<<h|b,S+=h;S>0;o[a+z]=255&_,z+=H,_/=256,S-=8);o[a+z-H]|=128*q}},Hc=as,zb=YP;function as(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}as.Varint=0,as.Fixed64=1,as.Bytes=2,as.Fixed32=5;var _g=4294967296,Sf=1/_g,GM=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Df(o){return o.type===as.Bytes?o.readVarint()+o.pos:o.pos+1}function WM(o,s,a){var d=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));a.realloc(d);for(var h=a.pos-1;h>=o;h--)a.buf[h+d]=a.buf[h]}function qM(o,s){for(var a=0;a<o.length;a++)s.writeVarint(o[a])}function p5(o,s){for(var a=0;a<o.length;a++)s.writeSVarint(o[a])}function m5(o,s){for(var a=0;a<o.length;a++)s.writeFloat(o[a])}function Ay(o,s){for(var a=0;a<o.length;a++)s.writeDouble(o[a])}function KP(o,s){for(var a=0;a<o.length;a++)s.writeBoolean(o[a])}function JP(o,s){for(var a=0;a<o.length;a++)s.writeFixed32(o[a])}function QP(o,s){for(var a=0;a<o.length;a++)s.writeSFixed32(o[a])}function ZM(o,s){for(var a=0;a<o.length;a++)s.writeFixed64(o[a])}function eR(o,s){for(var a=0;a<o.length;a++)s.writeSFixed64(o[a])}function Ub(o,s){return(o[s]|o[s+1]<<8|o[s+2]<<16)+16777216*o[s+3]}function a0(o,s,a){o[a]=s,o[a+1]=s>>>8,o[a+2]=s>>>16,o[a+3]=s>>>24}function XM(o,s){return(o[s]|o[s+1]<<8|o[s+2]<<16)+(o[s+3]<<24)}as.prototype={destroy:function(){this.buf=null},readFields:function(o,s,a){for(a=a||this.length;this.pos<a;){var d=this.readVarint(),h=d>>3,m=this.pos;this.type=7&d,o(h,s,this),this.pos===m&&this.skip(d)}return s},readMessage:function(o,s){return this.readFields(o,s,this.readVarint()+this.pos)},readFixed32:function(){var o=Ub(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=XM(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Ub(this.buf,this.pos)+Ub(this.buf,this.pos+4)*_g;return this.pos+=8,o},readSFixed64:function(){var o=Ub(this.buf,this.pos)+XM(this.buf,this.pos+4)*_g;return this.pos+=8,o},readFloat:function(){var o=zb.read(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=zb.read(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var s,a,d=this.buf;return s=127&(a=d[this.pos++]),a<128?s:(s|=(127&(a=d[this.pos++]))<<7,a<128?s:(s|=(127&(a=d[this.pos++]))<<14,a<128?s:(s|=(127&(a=d[this.pos++]))<<21,a<128?s:function(h,m,_){var b,T,S=_.buf;if(b=(112&(T=S[_.pos++]))>>4,T<128||(b|=(127&(T=S[_.pos++]))<<3,T<128)||(b|=(127&(T=S[_.pos++]))<<10,T<128)||(b|=(127&(T=S[_.pos++]))<<17,T<128)||(b|=(127&(T=S[_.pos++]))<<24,T<128)||(b|=(1&(T=S[_.pos++]))<<31,T<128))return function Mf(o,s,a){return a?4294967296*s+(o>>>0):4294967296*(s>>>0)+(o>>>0)}(h,b,m);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(a=d[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,s=this.pos;return this.pos=o,o-s>=12&&GM?GM.decode(this.buf.subarray(s,o)):function(a,d,h){for(var m="",_=d;_<h;){var b,T,S,A=a[_],k=null,N=A>239?4:A>223?3:A>191?2:1;if(_+N>h)break;1===N?A<128&&(k=A):2===N?128==(192&(b=a[_+1]))&&(k=(31&A)<<6|63&b)<=127&&(k=null):3===N?(T=a[_+2],128==(192&(b=a[_+1]))&&128==(192&T)&&((k=(15&A)<<12|(63&b)<<6|63&T)<=2047||k>=55296&&k<=57343)&&(k=null)):4===N&&(T=a[_+2],S=a[_+3],128==(192&(b=a[_+1]))&&128==(192&T)&&128==(192&S)&&((k=(15&A)<<18|(63&b)<<12|(63&T)<<6|63&S)<=65535||k>=1114112)&&(k=null)),null===k?(k=65533,N=1):k>65535&&(k-=65536,m+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),m+=String.fromCharCode(k),_+=N}return m}(this.buf,s,o)},readBytes:function(){var o=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,o);return this.pos=o,s},readPackedVarint:function(o,s){if(this.type!==as.Bytes)return o.push(this.readVarint(s));var a=Df(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(s));return o},readPackedSVarint:function(o){if(this.type!==as.Bytes)return o.push(this.readSVarint());var s=Df(this);for(o=o||[];this.pos<s;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==as.Bytes)return o.push(this.readBoolean());var s=Df(this);for(o=o||[];this.pos<s;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==as.Bytes)return o.push(this.readFloat());var s=Df(this);for(o=o||[];this.pos<s;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==as.Bytes)return o.push(this.readDouble());var s=Df(this);for(o=o||[];this.pos<s;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==as.Bytes)return o.push(this.readFixed32());var s=Df(this);for(o=o||[];this.pos<s;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==as.Bytes)return o.push(this.readSFixed32());var s=Df(this);for(o=o||[];this.pos<s;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==as.Bytes)return o.push(this.readFixed64());var s=Df(this);for(o=o||[];this.pos<s;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==as.Bytes)return o.push(this.readSFixed64());var s=Df(this);for(o=o||[];this.pos<s;)o.push(this.readSFixed64());return o},skip:function(o){var s=7&o;if(s===as.Varint)for(;this.buf[this.pos++]>127;);else if(s===as.Bytes)this.pos=this.readVarint()+this.pos;else if(s===as.Fixed32)this.pos+=4;else{if(s!==as.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(o,s){this.writeVarint(o<<3|s)},realloc:function(o){for(var s=this.length||16;s<this.pos+o;)s*=2;if(s!==this.length){var a=new Uint8Array(s);a.set(this.buf),this.buf=a,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),a0(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),a0(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),a0(this.buf,-1&o,this.pos),a0(this.buf,Math.floor(o*Sf),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),a0(this.buf,-1&o,this.pos),a0(this.buf,Math.floor(o*Sf),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(s,a){var d,h,m,b;if(s>=0?(d=s%4294967296|0,h=s/4294967296|0):(h=~(-s/4294967296),4294967295^(d=~(-s%4294967296))?d=d+1|0:(d=0,h=h+1|0)),s>=0x10000000000000000||s<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),m=d,(b=a).buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7),function(m,_){var b=(7&m)<<4;_.buf[_.pos++]|=b|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(h,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var s=this.pos;this.pos=function(d,h,m){for(var _,b,T=0;T<h.length;T++){if((_=h.charCodeAt(T))>55295&&_<57344){if(!b){_>56319||T+1===h.length?(d[m++]=239,d[m++]=191,d[m++]=189):b=_;continue}if(_<56320){d[m++]=239,d[m++]=191,d[m++]=189,b=_;continue}_=b-55296<<10|_-56320|65536,b=null}else b&&(d[m++]=239,d[m++]=191,d[m++]=189,b=null);_<128?d[m++]=_:(_<2048?d[m++]=_>>6|192:(_<65536?d[m++]=_>>12|224:(d[m++]=_>>18|240,d[m++]=_>>12&63|128),d[m++]=_>>6&63|128),d[m++]=63&_|128)}return m}(this.buf,o,this.pos);var a=this.pos-s;a>=128&&WM(s,a,this),this.pos=s-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),zb.write(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),zb.write(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var s=o.length;this.writeVarint(s),this.realloc(s);for(var a=0;a<s;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,s){this.pos++;var a=this.pos;o(s,this);var d=this.pos-a;d>=128&&WM(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d},writeMessage:function(o,s,a){this.writeTag(o,as.Bytes),this.writeRawMessage(s,a)},writePackedVarint:function(o,s){s.length&&this.writeMessage(o,qM,s)},writePackedSVarint:function(o,s){s.length&&this.writeMessage(o,p5,s)},writePackedBoolean:function(o,s){s.length&&this.writeMessage(o,KP,s)},writePackedFloat:function(o,s){s.length&&this.writeMessage(o,m5,s)},writePackedDouble:function(o,s){s.length&&this.writeMessage(o,Ay,s)},writePackedFixed32:function(o,s){s.length&&this.writeMessage(o,JP,s)},writePackedSFixed32:function(o,s){s.length&&this.writeMessage(o,QP,s)},writePackedFixed64:function(o,s){s.length&&this.writeMessage(o,ZM,s)},writePackedSFixed64:function(o,s){s.length&&this.writeMessage(o,eR,s)},writeBytesField:function(o,s){this.writeTag(o,as.Bytes),this.writeBytes(s)},writeFixed32Field:function(o,s){this.writeTag(o,as.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(o,s){this.writeTag(o,as.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(o,s){this.writeTag(o,as.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(o,s){this.writeTag(o,as.Fixed64),this.writeSFixed64(s)},writeVarintField:function(o,s){this.writeTag(o,as.Varint),this.writeVarint(s)},writeSVarintField:function(o,s){this.writeTag(o,as.Varint),this.writeSVarint(s)},writeStringField:function(o,s){this.writeTag(o,as.Bytes),this.writeString(s)},writeFloatField:function(o,s){this.writeTag(o,as.Fixed32),this.writeFloat(s)},writeDoubleField:function(o,s){this.writeTag(o,as.Fixed64),this.writeDouble(s)},writeBooleanField:function(o,s){this.writeVarintField(o,!!s)}};var Iy=sa(Hc);const tR=["id","tile","layer","source","sourceLayer","state"];class Vb{constructor(s,a,d,h,m){this.type="Feature",this._vectorTileFeature=s,this._z=a,this._x=d,this._y=h,this.properties=s.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of tR)void 0!==this[a]&&(s[a]=this[a]);return s}}class g5{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,a,d){const h=String(a);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][h]=this.stateChanges[s][h]||{},bo(this.stateChanges[s][h],d),null===this.deletedStates[s]){this.deletedStates[s]={};for(const m in this.state[s])m!==h&&(this.deletedStates[s][m]=null)}else if(this.deletedStates[s]&&null===this.deletedStates[s][h]){this.deletedStates[s][h]={};for(const m in this.state[s][h])d[m]||(this.deletedStates[s][h][m]=null)}else for(const m in d)this.deletedStates[s]&&this.deletedStates[s][h]&&null===this.deletedStates[s][h][m]&&delete this.deletedStates[s][h][m]}removeFeatureState(s,a,d){if(null===this.deletedStates[s])return;const h=String(a);if(this.deletedStates[s]=this.deletedStates[s]||{},d&&void 0!==a)null!==this.deletedStates[s][h]&&(this.deletedStates[s][h]=this.deletedStates[s][h]||{},this.deletedStates[s][h][d]=null);else if(void 0!==a)if(this.stateChanges[s]&&this.stateChanges[s][h])for(d in this.deletedStates[s][h]={},this.stateChanges[s][h])this.deletedStates[s][h][d]=null;else this.deletedStates[s][h]=null;else this.deletedStates[s]=null}getState(s,a){const d=String(a),h=bo({},(this.state[s]||{})[d],(this.stateChanges[s]||{})[d]);if(null===this.deletedStates[s])return{};if(this.deletedStates[s]){const m=this.deletedStates[s][a];if(null===m)return{};for(const _ in m)delete h[_]}return h}initializeTileState(s,a){s.setFeatureState(this.state,a)}coalesceChanges(s,a){const d={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),bo(this.state[h][_],this.stateChanges[h][_]),m[_]=this.state[h][_];d[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(null===this.deletedStates[h])for(const _ in this.state[h])m[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else if(this.state[h][_])for(const b of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][b];m[_]=this.state[h][_]}d[h]=d[h]||{},bo(d[h],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(const h in s)s[h].setFeatureState(d,a)}}class nR{constructor(s,a){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Ue(Jt,16,0),this.featureIndexArray=new bT,this.promoteId=a,this.is3DTile=!1}insert(s,a,d,h,m,_=0,b=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,h,m,_);const S=this.grid;for(let A=0;A<a.length;A++){const k=a[A],N=[1/0,1/0,-1/0,-1/0];for(let z=0;z<k.length;z++){const H=k[z];N[0]=Math.min(N[0],H.x),N[1]=Math.min(N[1],H.y),N[2]=Math.max(N[2],H.x),N[3]=Math.max(N[3],H.y)}0!==b&&(N[0]-=b,N[1]-=b,N[2]+=b,N[3]+=b),N[0]<Jt&&N[1]<Jt&&N[2]>=0&&N[3]>=0&&S.insert(T,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new by(new Iy(this.rawTileData)).layers,this.sourceLayerCoder=new Bb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const s in this.vtLayers)this.vtFeatures[s]=[]}return this.vtLayers}query(s,a,d,h){this.loadVTLayers();const m=s.params||{},_=nh(m.filter),b=s.tileResult,T=s.transform,S=b.bufferedTilespaceBounds,A=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(H,q,X,ee)=>db(b.bufferedTilespaceGeometry,H,q,X,ee));A.sort(_5);let k=null;T.elevation&&A.length>0&&(k=mg.create(T.elevation,this.tileID));const N={};let z;for(let H=0;H<A.length;H++){const q=A[H];if(q===z)continue;z=q;const X=this.featureIndexArray.get(q);let ee=null;if(this.is3DTile){const de=this.bucketLayerIDs[0][0],ue=a[de];if("model"!==ue.type)continue;const{queryFeature:fe,intersectionZ:be}=ue.queryIntersectsMatchingFeature(b,X.featureIndex,_,T);fe&&this.appendToResult(N,de,X.featureIndex,fe,be)}else this.loadMatchingFeature(N,X,_,m.layers,m.availableImages,a,d,h,(de,ue,fe,be=0)=>(ee||(ee=gu(de,this.tileID.canonical,s.tileTransform)),ue.queryIntersectsFeature(b,de,fe,ee,this.z,s.transform,s.pixelPosMatrix,k,be)))}return N}loadMatchingFeature(s,a,d,h,m,_,b,T,S){const{featureIndex:A,bucketIndex:k,sourceLayerIndex:N,layoutVertexArrayOffset:z}=a,H=this.bucketLayerIDs[k];if(h&&!function(de,ue){for(let fe=0;fe<de.length;fe++)if(ue.indexOf(de[fe])>=0)return!0;return!1}(h,H))return;const q=this.sourceLayerCoder.decode(N),X=this.vtLayers[q].feature(A);if(d.needGeometry){const de=oh(X,!0);if(!d.filter(new Qn(this.tileID.overscaledZ),de,this.tileID.canonical))return}else if(!d.filter(new Qn(this.tileID.overscaledZ),X))return;const ee=this.getId(X,q);for(let de=0;de<H.length;de++){const ue=H[de];if(h&&h.indexOf(ue)<0)continue;const fe=_[ue];if(!fe)continue;let be={};void 0!==ee&&T&&(be=T.getState(fe.sourceLayer||"_geojsonTileLayer",ee));const Te=!S||S(X,fe,be,z);if(!Te)continue;const De=new Vb(X,this.z,this.x,this.y,ee),Be=bo({},b[ue]);Be.paint=jb(Be.paint,fe.paint,X,be,m),Be.layout=jb(Be.layout,fe.layout,X,be,m),De.layer=Be,this.appendToResult(s,ue,A,De,Te)}}appendToResult(s,a,d,h,m){let _=s[a];void 0===_&&(_=s[a]=[]),_.push({featureIndex:d,feature:h,intersectionZ:m})}lookupSymbolFeatures(s,a,d,h,m,_,b,T){const S={};this.loadVTLayers();const A=nh(m);for(const k of s)this.loadMatchingFeature(S,{bucketIndex:d,sourceLayerIndex:h,featureIndex:k,layoutVertexArrayOffset:0},A,_,b,T,a);return S}loadFeature(s){const{featureIndex:a,sourceLayerIndex:d}=s;this.loadVTLayers();const h=this.sourceLayerCoder.decode(d),m=this.vtFeatures[h];if(m[a])return m[a];const _=this.vtLayers[h].feature(a);return m[a]=_,_}hasLayer(s){for(const a of this.bucketLayerIDs)for(const d of a)if(s===d)return!0;return!1}getId(s,a){let d=s.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[a];null!=h&&(d=s.properties[h]),"boolean"==typeof d&&(d=Number(d))}return d}}function jb(o,s,a,d,h){return Dm(o,(m,_)=>{const b=s instanceof pa?s.get(_):null;return b&&b.evaluate?b.evaluate(a,d,h):b})}function _5(o,s){return s-o}Fe(nR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var za=24;const dh=128;function YM(o,s){const{expression:a}=s;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new Qn(o+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:d,interpolationType:h}=a;let m=0;for(;m<d.length&&d[m]<=o;)m++;m=Math.max(0,m-1);let _=m;for(;_<d.length&&d[_]<o+1;)_++;_=Math.min(d.length-1,_);const b=d[m],T=d[_];return"composite"===a.kind?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:b,maxZoom:T,minSize:a.evaluate(new Qn(b)),maxSize:a.evaluate(new Qn(T)),interpolationType:h}}}function xE(o,{uSize:s,uSizeT:a},{lowerSize:d,upperSize:h}){return"source"===o.kind?d/dh:"composite"===o.kind?dn(d/dh,h/dh,a):s}function l0(o,s){let a=0,d=0;if("constant"===o.kind)d=o.layoutSize;else if("source"!==o.kind){const{interpolationType:h,minZoom:m,maxZoom:_}=o,b=h?Dr(La.interpolationFactor(h,s,m,_),0,1):0;"camera"===o.kind?d=dn(o.minSize,o.maxSize,b):a=b}return{uSizeT:a,uSize:d}}var $b=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:dh,evaluateSizeForFeature:xE,evaluateSizeForZoom:l0,getSizeData:YM});function Hb(o,s,a){return o.sections.forEach(d=>{d.text=function(h,m,_){const b=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===b?h=h.toLocaleUpperCase():"lowercase"===b&&(h=h.toLocaleLowerCase()),Tr.applyArabicShaping&&(h=Tr.applyArabicShaping(h)),h}(d.text,s,a)}),o}const c0={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function KM(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function JM(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}const bE=3;function rR(o,s,a){s.glyphs=[],1===o&&a.readMessage(QM,s)}function QM(o,s,a){if(3===o){const{id:d,bitmap:h,width:m,height:_,left:b,top:T,advance:S}=a.readMessage(u0,{});s.glyphs.push({id:d,bitmap:new Sp({width:m+2*bE,height:_+2*bE},h),metrics:{width:m,height:_,left:b,top:T,advance:S}})}else 4===o?s.ascender=a.readSVarint():5===o&&(s.descender=a.readSVarint())}function u0(o,s,a){1===o?s.id=a.readVarint():2===o?s.bitmap=a.readBytes():3===o?s.width=a.readVarint():4===o?s.height=a.readVarint():5===o?s.left=a.readSVarint():6===o?s.top=a.readSVarint():7===o&&(s.advance=a.readVarint())}const mc=bE,Vs={horizontal:1,vertical:2,horizontalOnly:3};class d0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,a){const d=new d0;return d.scale=s||1,d.fontStack=a,d}static forImage(s){const a=new d0;return a.imageName=s,a}}class ky{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,a){const d=new ky;for(let h=0;h<s.sections.length;h++){const m=s.sections[h];m.image?d.addImageSection(m):d.addTextSection(m,a)}return d}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSections(){return this.sections}getSectionIndex(s){return this.sectionIndex[s]}getCodePoint(s){return this.text.codePointAt(s)}verticalizePunctuation(s){this.text=function(a,d){let h="";for(let m=0;m<a.length;m++){const _=a.charCodeAt(m+1)||null,b=a.charCodeAt(m-1)||null;h+=!d&&(_&&fn(_)&&!c0[a[m+1]]||b&&fn(b)&&!c0[a[m-1]])||!c0[a[m]]?a[m]:c0[a[m]]}return h}(this.text,s)}trim(){let s=0;for(let d=0;d<this.text.length&&TE[this.text.charCodeAt(d)];d++)s++;let a=this.text.length;for(let d=this.text.length-1;d>=0&&d>=s&&TE[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(s,a),this.sectionIndex=this.sectionIndex.slice(s,a)}substring(s,a){const d=new ky;return d.text=this.text.substring(s,a),d.sectionIndex=this.sectionIndex.slice(s,a),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,a)=>Math.max(s,this.sections[a].scale),0)}addTextSection(s,a){this.text+=s.text,this.sections.push(d0.forText(s.scale,s.fontStack||a));const d=this.sections.length-1;for(let h=0;h<s.text.length;++h)this.sectionIndex.push(d)}addImageSection(s){const a=s.image?s.image.namePrimary:"";if(0===a.length)return void Ns("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(d0.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ns("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wE(o,s,a,d,h,m,_,b,T,S,A,k,N,z,H){const q=ky.fromFeature(o,h);k===Vs.vertical&&q.verticalizePunctuation(N);let X=[];const ee=function(Te,De,Be,Ze,ot,Ke){if(!Te)return[];const _t=[],Ft=function(Tt,Kt,bt,Zt,Xt,Ut){let Rn=0;for(let Mn=0;Mn<Tt.length();Mn++){const hn=Tt.getSection(Mn);Rn+=EE(Tt.getCodePoint(Mn),hn,Zt,Xt,Kt,Ut)}return Rn/Math.max(1,Math.ceil(Rn/bt))}(Te,De,Be,Ze,ot,Ke),yt=Te.text.indexOf("\u200b")>=0;let Wt=0;for(let Tt=0;Tt<Te.length();Tt++){const Kt=Te.getSection(Tt),bt=Te.getCodePoint(Tt);if(TE[bt]||(Wt+=EE(bt,Kt,Ze,ot,De,Ke)),Tt<Te.length()-1){const Zt=!((mt=bt)<11904||!(Pe["Bopomofo Extended"](mt)||Pe.Bopomofo(mt)||Pe["CJK Compatibility Forms"](mt)||Pe["CJK Compatibility Ideographs"](mt)||Pe["CJK Compatibility"](mt)||Pe["CJK Radicals Supplement"](mt)||Pe["CJK Strokes"](mt)||Pe["CJK Symbols and Punctuation"](mt)||Pe["CJK Unified Ideographs Extension A"](mt)||Pe["CJK Unified Ideographs"](mt)||Pe["Enclosed CJK Letters and Months"](mt)||Pe["Halfwidth and Fullwidth Forms"](mt)||Pe.Hiragana(mt)||Pe["Ideographic Description Characters"](mt)||Pe["Kangxi Radicals"](mt)||Pe["Katakana Phonetic Extensions"](mt)||Pe.Katakana(mt)||Pe["Vertical Forms"](mt)||Pe["Yi Radicals"](mt)||Pe["Yi Syllables"](mt)));(y5[bt]||Zt||Kt.imageName)&&_t.push(Af(Tt+1,Wt,Ft,_t,v5(bt,Te.getCodePoint(Tt+1),Zt&&yt),!1))}}var mt;return Gb(Af(Te.length(),Wt,Ft,_t,0,!0))}(q,S,m,s,d,z),{processBidirectionalText:de,processStyledBidirectionalText:ue}=Tr;if(de&&1===q.sections.length){const Te=de(q.toString(),ee);for(const De of Te){const Be=new ky;Be.text=De,Be.sections=q.sections;for(let Ze=0;Ze<De.length;Ze++)Be.sectionIndex.push(0);X.push(Be)}}else if(ue){const Te=ue(q.text,q.sectionIndex,ee);for(const De of Te){const Be=new ky;Be.text=De[0],Be.sectionIndex=De[1],Be.sections=q.sections,X.push(Be)}}else X=function(Te,De){const Be=[],Ze=Te.text;let ot=0;for(const Ke of De)Be.push(Te.substring(ot,Ke)),ot=Ke;return ot<Ze.length&&Be.push(Te.substring(ot,Ze.length)),Be}(q,ee);const fe=[],be={positionedLines:fe,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Te,De,Be,Ze,ot,Ke,_t,Ft,yt,Wt,mt,Tt){let Kt=0,bt=0,Zt=0;const Xt="right"===Ft?1:"left"===Ft?0:.5;let Ut=!1;for(const kn of ot){const xn=kn.getSections();for(const or of xn){if(or.imageName)continue;const ur=De[or.fontStack];if(ur&&(Ut=void 0!==ur.ascender&&void 0!==ur.descender,!Ut))break}if(!Ut)break}let Rn=0;for(const kn of ot){kn.trim();const xn=kn.getMaxScale(),or=(xn-1)*za,ur={positionedGlyphs:[],lineOffset:0};Te.positionedLines[Rn]=ur;const dr=ur.positionedGlyphs;let vr=0;if(!kn.length()){bt+=Ke,++Rn;continue}let zr=0,Ir=0;for(let Pi=0;Pi<kn.length();Pi++){const ar=kn.getSection(Pi),ri=kn.getSectionIndex(Pi),hi=kn.getCodePoint(Pi);let Zi=ar.scale,ks=null,Xs=null,Ss=null,ls=za,mo=0;const Ys=!(yt===Vs.horizontal||!mt&&!sn(hi)||mt&&(TE[hi]||(Mn=hi,Pe.Arabic(Mn)||Pe["Arabic Supplement"](Mn)||Pe["Arabic Extended-A"](Mn)||Pe["Arabic Presentation Forms-A"](Mn)||Pe["Arabic Presentation Forms-B"](Mn))));if(ar.imageName){const Ko=Ze[ar.imageName];if(!Ko)continue;Ss=ar.imageName,Te.iconsInText=Te.iconsInText||!0,Xs=Ko.paddedRect;const ji=Ko.displaySize;Zi=Zi*za/Tt,ks={width:ji[0],height:ji[1],left:0,top:-mc,advance:Ys?ji[1]:ji[0],localGlyph:!1},mo=Ut?-ks.height*Zi:xn*za-17-ji[1]*Zi,ls=ks.advance;const Yl=(Ys?ji[0]:ji[1])*Zi-za*xn;Yl>0&&Yl>vr&&(vr=Yl)}else{const Ko=Be[ar.fontStack];if(!Ko)continue;Ko[hi]&&(Xs=Ko[hi]);const ji=De[ar.fontStack];if(!ji)continue;const Yl=ji.glyphs[hi];if(!Yl)continue;if(ks=Yl.metrics,ls=8203!==hi?za:0,Ut){const wu=void 0!==ji.ascender?Math.abs(ji.ascender):0,Tu=void 0!==ji.descender?Math.abs(ji.descender):0,yc=(wu+Tu)*Zi;zr<yc&&(zr=yc,Ir=(wu-Tu)/2*Zi),mo=-wu*Zi}else mo=(xn-Zi)*za-17}Ys?(Te.verticalizable=!0,dr.push({glyph:hi,imageName:Ss,x:Kt,y:bt+mo,vertical:Ys,scale:Zi,localGlyph:ks.localGlyph,fontStack:ar.fontStack,sectionIndex:ri,metrics:ks,rect:Xs}),Kt+=ls*Zi+Wt):(dr.push({glyph:hi,imageName:Ss,x:Kt,y:bt+mo,vertical:Ys,scale:Zi,localGlyph:ks.localGlyph,fontStack:ar.fontStack,sectionIndex:ri,metrics:ks,rect:Xs}),Kt+=ks.advance*Zi+Wt)}0!==dr.length&&(Zt=Math.max(Kt-Wt,Zt),Ut?eA(dr,Xt,vr,Ir,Ke*xn/2):eA(dr,Xt,vr,0,Ke/2)),Kt=0;const Ti=Ke*xn+vr;ur.lineOffset=Math.max(vr,or),bt+=Ti,++Rn}var Mn;const hn=bt,{horizontalAlign:tn,verticalAlign:Yn}=Oy(_t);(function(kn,xn,or,ur,dr,vr){const zr=(xn-or)*dr,Ir=-vr*ur;for(const Ti of kn)for(const Pi of Ti.positionedGlyphs)Pi.x+=zr,Pi.y+=Ir})(Te.positionedLines,Xt,tn,Yn,Zt,hn),Te.top+=-Yn*hn,Te.bottom=Te.top+hn,Te.left+=-tn*Zt,Te.right=Te.left+Zt,Te.hasBaseline=Ut}(be,s,a,d,X,_,b,T,k,S,N,H),!function(Te){for(const De of Te)if(0!==De.positionedGlyphs.length)return!1;return!0}(fe)&&be}const TE={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},y5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function EE(o,s,a,d,h,m){if(s.imageName){const _=d[s.imageName];return _?_.displaySize[0]*s.scale*za/m+h:0}{const _=a[s.fontStack],b=_&&_.glyphs[o];return b?b.metrics.advance*s.scale+h:0}}function CE(o,s,a,d){const h=Math.pow(o-s,2);return d?o<s?h/2:2*h:h+Math.abs(a)*a}function v5(o,s,a){let d=0;return 10===o&&(d-=1e4),a&&(d+=150),40!==o&&65288!==o||(d+=50),41!==s&&65289!==s||(d+=50),d}function Af(o,s,a,d,h,m){let _=null,b=CE(s,a,h,m);for(const T of d){const S=CE(s-T.x,a,h,m)+T.badness;S<=b&&(_=T,b=S)}return{index:o,x:s,priorBreak:_,badness:b}}function Gb(o){return o?Gb(o.priorBreak).concat(o.index):[]}function Oy(o){let s=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:s,verticalAlign:a}}function eA(o,s,a,d,h){if(!(s||a||d||h))return;const m=o.length-1,_=o[m],b=(_.x+_.metrics.advance*_.scale)*s;for(let T=0;T<=m;T++)o[T].x-=b,o[T].y+=a+d+h}function h0(o,s,a,d){const{horizontalAlign:h,verticalAlign:m}=Oy(d),_=a[0]-o.displaySize[0]*h,b=a[1]-o.displaySize[1]*m;return{imagePrimary:o,imageSecondary:s,top:b,bottom:b+o.displaySize[1],left:_,right:_+o.displaySize[0]}}function Wb(o,s,a,d,h,m){const _=o.imagePrimary;let b;if(_.content){const X=_.content,ee=_.pixelRatio||1;b=[X[0]/ee,X[1]/ee,_.displaySize[0]-X[2]/ee,_.displaySize[1]-X[3]/ee]}const T=s.left*m,S=s.right*m;let A,k,N,z;"width"===a||"both"===a?(z=h[0]+T-d[3],k=h[0]+S+d[1]):(z=h[0]+(T+S-_.displaySize[0])/2,k=z+_.displaySize[0]);const H=s.top*m,q=s.bottom*m;return"height"===a||"both"===a?(A=h[1]+H-d[0],N=h[1]+q+d[2]):(A=h[1]+(H+q-_.displaySize[1])/2,N=A+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:A,right:k,bottom:N,left:z,collisionPadding:b}}class hh extends rn{constructor(s,a,d,h,m){super(s,a),this.angle=h,this.z=d,void 0!==m&&(this.segment=m)}clone(){return new hh(this.x,this.y,this.z,this.angle,this.segment)}}function qb(o,s,a,d,h){if(void 0===s.segment)return!0;let m=s,_=s.segment+1,b=0;for(;b>-a/2;){if(_--,_<0)return!1;b-=o[_].dist(m),m=o[_]}b+=o[_].dist(o[_+1]),_++;const T=[];let S=0;for(;b<a/2;){const A=o[_],k=o[_+1];if(!k)return!1;let N=o[_-1].angleTo(A)-A.angleTo(k);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:N}),S+=N;b-T[0].distance>d;)S-=T.shift().angleDelta;if(S>h)return!1;_++,b+=A.dist(k)}return!0}function Py(o){let s=0;for(let a=0;a<o.length-1;a++)s+=o[a].dist(o[a+1]);return s}function tA(o,s,a){return o?.6*s*a:0}function nA(o,s){return Math.max(o?o.right-o.left:0,s?s.right-s.left:0)}function rA(o,s,a,d,h,m){const _=tA(a,h,m),b=nA(a,d)*m;let T=0;const S=Py(o)/2;for(let A=0;A<o.length-1;A++){const k=o[A],N=o[A+1],z=k.dist(N);if(T+z>S){const H=(S-T)/z,q=dn(k.x,N.x,H),X=dn(k.y,N.y,H),ee=new hh(q,X,0,N.angleTo(k),A);return!_||qb(o,ee,b,_,s)?ee:void 0}T+=z}}function iR(o,s,a,d,h,m,_,b,T){const S=tA(d,m,_),A=nA(d,h),k=A*_,N=0===o[0].x||o[0].x===T||0===o[0].y||o[0].y===T;return s-k<s/4&&(s=k+s/4),iA(o,N?s/2*b%s:(A/2+2*m)*_*b%s,s,S,a,k,N,!1,T)}function iA(o,s,a,d,h,m,_,b,T){const S=m/2,A=Py(o);let k=0,N=s-a,z=[];for(let H=0;H<o.length-1;H++){const q=o[H],X=o[H+1],ee=q.dist(X),de=X.angleTo(q);for(;N+a<k+ee;){N+=a;const ue=(N-k)/ee,fe=dn(q.x,X.x,ue),be=dn(q.y,X.y,ue);if(fe>=0&&fe<T&&be>=0&&be<T&&N-S>=0&&N+S<=A){const Te=new hh(fe,be,0,de,H);d&&!qb(o,Te,m,d,h)||z.push(Te)}}k+=ee}return b||z.length||_||(z=iA(o,k/2,a,d,h,m,_,!0,T)),z}function SE(o,s,a,d,h){const m=[];for(let _=0;_<o.length;_++){const b=o[_];let T;for(let S=0;S<b.length-1;S++){let A=b[S],k=b[S+1];A.x<s&&k.x<s||(A.x<s?A=new rn(s,A.y+(s-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<s&&(k=new rn(s,A.y+(s-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<a&&k.y<a||(A.y<a?A=new rn(A.x+(a-A.y)/(k.y-A.y)*(k.x-A.x),a)._round():k.y<a&&(k=new rn(A.x+(a-A.y)/(k.y-A.y)*(k.x-A.x),a)._round()),A.x>=d&&k.x>=d||(A.x>=d?A=new rn(d,A.y+(d-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=d&&(k=new rn(d,A.y+(d-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=h&&k.y>=h||(A.y>=h?A=new rn(A.x+(h-A.y)/(k.y-A.y)*(k.x-A.x),h)._round():k.y>=h&&(k=new rn(A.x+(h-A.y)/(k.y-A.y)*(k.x-A.x),h)._round()),T&&A.equals(T[T.length-1])||(T=[A],m.push(T)),T.push(k)))))}}return m}function Zb(o){let s=0,a=0;for(const _ of o)s+=_.w*_.h,a=Math.max(a,_.w);o.sort((_,b)=>b.h-_.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),a),h:1/0}];let h=0,m=0;for(const _ of o)for(let b=d.length-1;b>=0;b--){const T=d[b];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===T.w&&_.h===T.h){const S=d.pop();b<d.length&&(d[b]=S)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(d.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:h,h:m,fill:s/(h*m)||0}}Fe(hh,"Anchor");const Ua=1;class f0{constructor(s,{pixelRatio:a,version:d,stretchX:h,stretchY:m,content:_}){this.paddedRect=s,this.pixelRatio=a,this.stretchX=h,this.stretchY=m,this.content=_,this.version=d}get tl(){return[this.paddedRect.x+Ua,this.paddedRect.y+Ua]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ua,this.paddedRect.y+this.paddedRect.h-Ua]}get displaySize(){return[(this.paddedRect.w-2*Ua)/this.pixelRatio,(this.paddedRect.h-2*Ua)/this.pixelRatio]}}class Xb{constructor(s,a,d){const h={},m={};this.haveRenderCallbacks=[];const _=[];this.addImages(s,h,_),this.addImages(a,m,_);const{w:b,h:T}=Zb(_),S=new $c({width:b||1,height:T||1});for(const A in s){const k=s[A],N=h[A].paddedRect;$c.copy(k.data,S,{x:0,y:0},{x:N.x+Ua,y:N.y+Ua},k.data,d,k.sdf)}for(const A in a){const k=a[A],N=m[A].paddedRect,z=N.x+Ua,H=N.y+Ua,q=k.data.width,X=k.data.height;$c.copy(k.data,S,{x:0,y:0},{x:z,y:H},k.data,d),$c.copy(k.data,S,{x:0,y:X-1},{x:z,y:H-1},{width:q,height:1},d),$c.copy(k.data,S,{x:0,y:0},{x:z,y:H+X},{width:q,height:1},d),$c.copy(k.data,S,{x:q-1,y:0},{x:z-1,y:H},{width:1,height:X},d),$c.copy(k.data,S,{x:0,y:0},{x:z+q,y:H},{width:1,height:X},d)}this.image=S,this.iconPositions=h,this.patternPositions=m}addImages(s,a,d){for(const h in s){const m=s[h],_={x:0,y:0,w:m.data.width+2*Ua,h:m.data.height+2*Ua};d.push(_),a[h]=new f0(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(s,a,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>s.hasImage(h,d)),s.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const h in s.getUpdatedImages(d))this.patchUpdatedImage(this.iconPositions[h],s.getImage(h,d),a),this.patchUpdatedImage(this.patternPositions[h],s.getImage(h,d),a)}patchUpdatedImage(s,a,d){if(!s||!a||s.version===a.version)return;s.version=a.version;const[h,m]=s.tl,_=!!Object.keys(this.patternPositions).length;d.update(a.data,{useMipmap:_},{x:h,y:m})}}Fe(f0,"ImagePosition"),Fe(Xb,"ImageAtlas");const Ry=1e20;function sA(o,s,a,d,h,m,_,b,T){for(let S=s;S<s+d;S++)Yb(o,a*m+S,m,h,_,b,T);for(let S=a;S<a+h;S++)Yb(o,S*m+s,1,d,_,b,T)}function Yb(o,s,a,d,h,m,_){m[0]=0,_[0]=-Ry,_[1]=Ry,h[0]=o[s];for(let b=1,T=0,S=0;b<d;b++){h[b]=o[s+b*a];const A=b*b;do{const k=m[T];S=(h[b]-h[k]+A-k*k)/(b-k)/2}while(S<=_[T]&&--T>-1);T++,m[T]=b,_[T]=S,_[T+1]=Ry}for(let b=0,T=0;b<d;b++){for(;_[T+1]<b;)T++;const S=m[T],A=b-S;o[s+b*a]=h[S]+A*A}}const yu=2,If={none:0,ideographs:1,all:2};class yg{constructor(s,a,d){this.requestManager=s,this.localGlyphMode=a,this.localFontFamily=d,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(s,a){this.urls[a]=s}getGlyphs(s,a,d){const h=[],m=this.urls[a]||cn.GLYPHS_URL;for(const _ in s)for(const b of s[_])h.push({stack:_,id:b});ef(h,({stack:_,id:b},T)=>{let S=this.entries[_];S||(S=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=S.glyphs[b];if(void 0!==A)return void T(null,{stack:_,id:b,glyph:A});if(A=this._tinySDF(S,_,b),A)return S.glyphs[b]=A,void T(null,{stack:_,id:b,glyph:A});const k=Math.floor(b/256);if(256*k>65535)return void T(new Error("glyphs > 65535 not supported"));if(S.ranges[k])return void T(null,{stack:_,id:b,glyph:A});let N=S.requests[k];N||(N=S.requests[k]=[],yg.loadGlyphRange(_,k,m,this.requestManager,(z,H)=>{if(H){S.ascender=H.ascender,S.descender=H.descender;for(const q in H.glyphs)this._doesCharSupportLocalGlyph(+q)||(S.glyphs[+q]=H.glyphs[+q]);S.ranges[k]=!0}for(const q of N)q(z,H);delete S.requests[k]})),N.push((z,H)=>{z?T(z):H&&T(null,{stack:_,id:b,glyph:H.glyphs[b]||null})})},(_,b)=>{if(_)d(_);else if(b){const T={};for(const{stack:S,id:A,glyph:k}of b)void 0===T[S]&&(T[S]={}),void 0===T[S].glyphs&&(T[S].glyphs={}),T[S].glyphs[A]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},T[S].ascender=this.entries[S].ascender,T[S].descender=this.entries[S].descender;d(null,T)}})}_doesCharSupportLocalGlyph(s){return this.localGlyphMode!==If.none&&(this.localGlyphMode===If.all?!!this.localFontFamily:!!this.localFontFamily&&(Pe["CJK Unified Ideographs"](s)||Pe["Hangul Syllables"](s)||Pe.Hiragana(s)||Pe.Katakana(s)||Pe["CJK Symbols and Punctuation"](s)||Pe["CJK Unified Ideographs Extension A"](s)||Pe["CJK Unified Ideographs Extension B"](s)))}_tinySDF(s,a,d){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(d))return;let m=s.tinySDF;if(!m){let q="400";/bold/i.test(a)?q="900":/medium/i.test(a)?q="500":/light/i.test(a)&&(q="200"),m=s.tinySDF=new yg.TinySDF({fontFamily:h,fontWeight:q,fontSize:24*yu,buffer:3*yu,radius:8*yu}),m.fontWeight=q}if(this.localGlyphs[m.fontWeight][d])return this.localGlyphs[m.fontWeight][d];const _=String.fromCodePoint(d),{data:b,width:T,height:S,glyphWidth:A,glyphHeight:k,glyphLeft:N,glyphTop:z,glyphAdvance:H}=m.draw(_);return this.localGlyphs[m.fontWeight][d]={id:d,bitmap:new Sp({width:T,height:S},b),metrics:{width:A/yu,height:k/yu,left:N/yu,top:z/yu-27,advance:H/yu,localGlyph:!0}}}}yg.loadGlyphRange=function(o,s,a,d,h){const m=256*s,_=m+255,b=d.transformRequest(d.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${m}-${_}`),Ld.Glyphs);Bd(b,(T,S)=>{if(T)h(T);else if(S){const A={},k=new Iy(S).readFields(rR,{});for(const N of k.glyphs)A[N.id]=N;h(null,{glyphs:A,ascender:k.ascender,descender:k.descender})}})},yg.TinySDF=class{constructor({fontSize:o=24,buffer:s=3,radius:a=8,cutoff:d=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}={}){this.buffer=s,this.cutoff=d,this.radius=a;const b=this.size=o+4*s,T=this._createCanvas(b),S=this.ctx=T.getContext("2d",{willReadFrequently:!0});S.font=`${_} ${m} ${o}px ${h}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(o){const s=document.createElement("canvas");return s.width=s.height=o,s}draw(o){const{width:s,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(o),_=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),T=Math.min(this.size-this.buffer,_+Math.ceil(d)),S=b+2*this.buffer,A=T+2*this.buffer,k=Math.max(S*A,0),N=new Uint8ClampedArray(k),z={data:N,width:S,height:A,glyphWidth:b,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:s};if(0===b||0===T)return z;const{ctx:H,buffer:q,gridInner:X,gridOuter:ee}=this;H.clearRect(q,q,b,T),H.fillText(o,q,q+_);const de=H.getImageData(q,q,b,T);ee.fill(Ry,0,k),X.fill(0,0,k);for(let ue=0;ue<T;ue++)for(let fe=0;fe<b;fe++){const be=de.data[4*(ue*b+fe)+3]/255;if(0===be)continue;const Te=(ue+q)*S+fe+q;if(1===be)ee[Te]=0,X[Te]=Ry;else{const De=.5-be;ee[Te]=De>0?De*De:0,X[Te]=De<0?De*De:0}}sA(ee,0,0,S,A,S,this.f,this.v,this.z),sA(X,q,q,b,T,S,this.f,this.v,this.z);for(let ue=0;ue<k;ue++){const fe=Math.sqrt(ee[ue])-Math.sqrt(X[ue]);N[ue]=Math.round(255-255*(fe/this.radius+this.cutoff))}return z}};const kf=Ua;function oA(o,s,a,d){const h=[],m=o.imagePrimary,_=m.pixelRatio,b=m.paddedRect.w-2*kf,T=m.paddedRect.h-2*kf,S=o.right-o.left,A=o.bottom-o.top,k=m.stretchX||[[0,b]],N=m.stretchY||[[0,T]],z=(Ke,_t)=>Ke+_t[1]-_t[0],H=k.reduce(z,0),q=N.reduce(z,0),X=b-H,ee=T-q;let de=0,ue=H,fe=0,be=q,Te=0,De=X,Be=0,Ze=ee;if(m.content&&d){const Ke=m.content;de=DE(k,0,Ke[0]),fe=DE(N,0,Ke[1]),ue=DE(k,Ke[0],Ke[2]),be=DE(N,Ke[1],Ke[3]),Te=Ke[0]-de,Be=Ke[1]-fe,De=Ke[2]-Ke[0]-ue,Ze=Ke[3]-Ke[1]-be}const ot=(Ke,_t,Ft,yt)=>{const Wt=Kb(Ke.stretch-de,ue,S,o.left),mt=Fy(Ke.fixed-Te,De,Ke.stretch,H),Tt=Kb(_t.stretch-fe,be,A,o.top),Kt=Fy(_t.fixed-Be,Ze,_t.stretch,q),bt=Kb(Ft.stretch-de,ue,S,o.left),Zt=Fy(Ft.fixed-Te,De,Ft.stretch,H),Xt=Kb(yt.stretch-fe,be,A,o.top),Ut=Fy(yt.fixed-Be,Ze,yt.stretch,q),Rn=new rn(Wt,Tt),Mn=new rn(bt,Tt),hn=new rn(bt,Xt),tn=new rn(Wt,Xt),Yn=new rn(mt/_,Kt/_),kn=new rn(Zt/_,Ut/_),xn=s*Math.PI/180;if(xn){const Ir=Math.sin(xn),Ti=Math.cos(xn),Pi=[Ti,-Ir,Ir,Ti];Rn._matMult(Pi),Mn._matMult(Pi),tn._matMult(Pi),hn._matMult(Pi)}const or=Ke.stretch+Ke.fixed,ur=Ft.stretch+Ft.fixed,dr=_t.stretch+_t.fixed,vr=yt.stretch+yt.fixed,zr=o.imageSecondary;return{tl:Rn,tr:Mn,bl:tn,br:hn,texPrimary:{x:m.paddedRect.x+kf+or,y:m.paddedRect.y+kf+dr,w:ur-or,h:vr-dr},texSecondary:zr?{x:zr.paddedRect.x+kf+or,y:zr.paddedRect.y+kf+dr,w:ur-or,h:vr-dr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yn,pixelOffsetBR:kn,minFontScaleX:De/_/S,minFontScaleY:Ze/_/A,isSDF:a}};if(d&&(m.stretchX||m.stretchY)){const Ke=Ny(k,X,H),_t=Ny(N,ee,q);for(let Ft=0;Ft<Ke.length-1;Ft++){const yt=Ke[Ft],Wt=Ke[Ft+1];for(let mt=0;mt<_t.length-1;mt++)h.push(ot(yt,_t[mt],Wt,_t[mt+1]))}}else h.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return h}function DE(o,s,a){let d=0;for(const h of o)d+=Math.max(s,Math.min(a,h[1]))-Math.max(s,Math.min(a,h[0]));return d}function Ny(o,s,a){const d=[{fixed:-kf,stretch:0}];for(const[h,m]of o){const _=d[d.length-1];d.push({fixed:h-_.stretch,stretch:_.stretch}),d.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return d.push({fixed:s+kf,stretch:a}),d}function Kb(o,s,a,d){return o/s*a+d}function Fy(o,s,a,d){return o-s*a/d}function aA(o,s,a,d){const h=s+o.positionedLines[d].lineOffset;return 0===d?a+h/2:a+(h+(s+o.positionedLines[d-1].lineOffset))/2}function lA(o,s=1,a=!1){let d=1/0,h=1/0,m=-1/0,_=-1/0;const b=o[0];for(let z=0;z<b.length;z++){const H=b[z];(!z||H.x<d)&&(d=H.x),(!z||H.y<h)&&(h=H.y),(!z||H.x>m)&&(m=H.x),(!z||H.y>_)&&(_=H.y)}const T=Math.min(m-d,_-h);let S=T/2;const A=new zc([],ME);if(0===T)return new rn(d,h);for(let z=d;z<m;z+=T)for(let H=h;H<_;H+=T)A.push(new vg(z+S,H+S,S,o));let k=function(z){let H=0,q=0,X=0;const ee=z[0];for(let de=0,ue=ee.length,fe=ue-1;de<ue;fe=de++){const be=ee[de],Te=ee[fe],De=be.x*Te.y-Te.x*be.y;q+=(be.x+Te.x)*De,X+=(be.y+Te.y)*De,H+=3*De}return new vg(q/H,X/H,0,z)}(o),N=A.length;for(;A.length;){const z=A.pop();(z.d>k.d||!k.d)&&(k=z,a&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,N)),z.max-k.d<=s||(S=z.h/2,A.push(new vg(z.p.x-S,z.p.y-S,S,o)),A.push(new vg(z.p.x+S,z.p.y-S,S,o)),A.push(new vg(z.p.x-S,z.p.y+S,S,o)),A.push(new vg(z.p.x+S,z.p.y+S,S,o)),N+=4)}return a&&(console.log(`num probes: ${N}`),console.log(`best distance: ${k.d}`)),k.p}function ME(o,s){return s.max-o.max}class vg{constructor(s,a,d,h){this.p=new rn(s,a),this.h=d,this.d=function(m,_){let b=!1,T=1/0;for(let S=0;S<_.length;S++){const A=_[S];for(let k=0,N=A.length,z=N-1;k<N;z=k++){const H=A[k],q=A[z];H.y>m.y!=q.y>m.y&&m.x<(q.x-H.x)*(m.y-H.y)/(q.y-H.y)+H.x&&(b=!b),T=Math.min(T,Yo(m,H,q))}}return(b?1:-1)*Math.sqrt(T)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const p0=Number.POSITIVE_INFINITY,m0=Math.sqrt(2);function AE(o,[s,a]){let d=0,h=0;if(a===p0){s<0&&(s=0);const m=s/m0;switch(o){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-s;break;case"top":h=s-7}switch(o){case"top-right":case"bottom-right":d=-m;break;case"top-left":case"bottom-left":d=m;break;case"left":d=s;break;case"right":d=-s}}else{switch(s=Math.abs(s),a=Math.abs(a),o){case"top-right":case"top-left":case"top":h=a-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-a}switch(o){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}}return[d,h]}function Ly(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function By(o,s,a,d,h,m,_,b,T,S,A,k,N,z,H){let q=m.textMaxSize.evaluate(s,{},k);void 0===q&&(q=_);const X=o.layers[0].layout,ee=X.get("icon-offset").evaluate(s,{},k),de=cA(a.horizontal)||a.vertical,ue="globe"===N.name,fe=za,be=_/fe,Te=o.tilePixelRatio*q/fe,De=(Wt=o.overscaling,o.zoom>18&&Wt>2&&(Wt>>=1),Math.max(Jt/(512*Wt),1)*X.get("symbol-spacing")),Be=X.get("text-padding")*o.tilePixelRatio,Ze=X.get("icon-padding")*o.tilePixelRatio,ot=kr(X.get("text-max-angle")),Ke="map"===X.get("text-rotation-alignment")&&"point"!==X.get("symbol-placement"),_t="map"===X.get("icon-rotation-alignment")&&"point"!==X.get("symbol-placement"),Ft=X.get("symbol-placement"),yt=De/2;var Wt;const mt=X.get("icon-text-fit").evaluate(s,{},k),Tt=X.get("icon-text-fit-padding").evaluate(s,{},k),Kt="none"!==mt;let bt;!1===o.hasAnyIconTextFit&&Kt&&(o.hasAnyIconTextFit=!0),d&&Kt&&(o.allowVerticalPlacement&&a.vertical&&(bt=Wb(d,a.vertical,mt,Tt,ee,be)),de&&(d=Wb(d,de,mt,Tt,ee,be)));const Zt=(Xt,Ut,Rn)=>{if(Ut.x<0||Ut.x>=Jt||Ut.y<0||Ut.y>=Jt)return;let Mn=null;if(ue){const{x:hn,y:tn,z:Yn}=N.projectTilePoint(Ut.x,Ut.y,Rn);Mn={anchor:new hh(hn,tn,Yn,0,void 0),up:N.upVector(Rn,Ut.x,Ut.y)}}!function(hn,tn,Yn,kn,xn,or,ur,dr,vr,zr,Ir,Ti,Pi,ar,ri,hi,Zi,ks,Xs,Ss,ls,mo,Ys,Ko,ji,Yl,wu){const Tu=hn.addToLineVertexArray(tn,kn);let yc,jp,Nf,k0,Ew,Ag,TC,EC=0,Cw=0,CC=0,SC=0,Sw=-1,Dw=-1;const _h={};let BR=m_("");const O0=Yn?Yn.anchor:tn,KA="none"!==vr.layout.get("icon-text-fit").evaluate(ls,{},ji);let JA=0,QA=0;if(void 0===vr._unevaluatedLayout.getValue("text-radial-offset")?[JA,QA]=vr.layout.get("text-offset").evaluate(ls,{},ji).map(Kl=>Kl*za):(JA=vr.layout.get("text-radial-offset").evaluate(ls,{},ji)*za,QA=p0),hn.allowVerticalPlacement&&xn.vertical){const Kl=xn.vertical;if(ri)Ag=IE(Kl),dr&&(TC=IE(dr));else{const Jl=vr.layout.get("text-rotate").evaluate(ls,{},ji)+90;Nf=Uy(zr,O0,tn,Ir,Ti,Pi,Kl,ar,Jl,hi),dr&&(k0=Uy(zr,O0,tn,Ir,Ti,Pi,dr,ks,Jl))}}if(or){const Kl=vr.layout.get("icon-rotate").evaluate(ls,{},ji),Jl=oA(or,Kl,Ys,KA),dv=dr?oA(dr,Kl,Ys,KA):void 0;jp=Uy(zr,O0,tn,Ir,Ti,Pi,or,ks,Kl),EC=4*Jl.length;const zR=hn.iconSizeData;let P0=null;"source"===zR.kind?(P0=[dh*vr.layout.get("icon-size").evaluate(ls,{},ji)],P0[0]>fh&&Ns(`${hn.layerIds[0]}: Value for "icon-size" is >= ${g0}. Reduce your "icon-size".`)):"composite"===zR.kind&&(P0=[dh*mo.compositeIconSizes[0].evaluate(ls,{},ji),dh*mo.compositeIconSizes[1].evaluate(ls,{},ji)],(P0[0]>fh||P0[1]>fh)&&Ns(`${hn.layerIds[0]}: Value for "icon-size" is >= ${g0}. Reduce your "icon-size".`)),hn.addSymbols(hn.icon,Jl,P0,Ss,Xs,ls,!1,Yn,tn,Tu.lineStartIndex,Tu.lineLength,-1,Ko,ji,Yl,wu),Sw=hn.icon.placedSymbolArray.length-1,dv&&(Cw=4*dv.length,hn.addSymbols(hn.icon,dv,P0,Ss,Xs,ls,Vs.vertical,Yn,tn,Tu.lineStartIndex,Tu.lineLength,-1,Ko,ji,Yl,wu),Dw=hn.icon.placedSymbolArray.length-1)}for(const Kl in xn.horizontal){const Jl=xn.horizontal[Kl];yc||(BR=m_(Jl.text),ri?Ew=IE(Jl):yc=Uy(zr,O0,tn,Ir,Ti,Pi,Jl,ar,vr.layout.get("text-rotate").evaluate(ls,{},ji),hi));const dv=1===Jl.positionedLines.length;if(CC+=zy(hn,Yn,tn,Jl,ur,vr,ri,ls,hi,Tu,xn.vertical?Vs.horizontal:Vs.horizontalOnly,dv?Object.keys(xn.horizontal):[Kl],_h,Sw,mo,Ko,ji,Yl),dv)break}xn.vertical&&(SC+=zy(hn,Yn,tn,xn.vertical,ur,vr,ri,ls,hi,Tu,Vs.vertical,["vertical"],_h,Dw,mo,Ko,ji,Yl));let Ig=-1;const eI=(Kl,Jl)=>Kl?Math.max(Kl,Jl):Jl;Ig=eI(Ew,Ig),Ig=eI(Ag,Ig),Ig=eI(TC,Ig);const w5=Ig>-1?1:0;hn.glyphOffsetArray.length>=65535&&Ns("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ls.sortKey&&hn.addToSortKeyRanges(hn.symbolInstances.length,ls.sortKey),hn.symbolInstances.emplaceBack(tn.x,tn.y,O0.x,O0.y,O0.z,_h.right>=0?_h.right:-1,_h.center>=0?_h.center:-1,_h.left>=0?_h.left:-1,_h.vertical>=0?_h.vertical:-1,Sw,Dw,BR,void 0!==yc?yc:hn.collisionBoxArray.length,void 0!==yc?yc+1:hn.collisionBoxArray.length,void 0!==Nf?Nf:hn.collisionBoxArray.length,void 0!==Nf?Nf+1:hn.collisionBoxArray.length,void 0!==jp?jp:hn.collisionBoxArray.length,void 0!==jp?jp+1:hn.collisionBoxArray.length,k0||hn.collisionBoxArray.length,k0?k0+1:hn.collisionBoxArray.length,Ir,CC,SC,EC,Cw,w5,0,JA,QA,Ig,0,KA?1:0)}(o,Ut,Mn,Xt,a,d,h,bt,o.layers[0],o.collisionBoxArray,s.index,s.sourceLayerIndex,o.index,Be,Ke,T,0,Ze,_t,ee,s,m,S,A,k,z,H)};if("line"===Ft)for(const Xt of SE(s.geometry,0,0,Jt,Jt)){const Ut=iR(Xt,De,ot,a.vertical||de,d,fe,Te,o.overscaling,Jt);for(const Rn of Ut)de&&sR(o,de.text,yt,Rn)||Zt(Xt,Rn,k)}else if("line-center"===Ft){for(const Xt of s.geometry)if(Xt.length>1){const Ut=rA(Xt,ot,a.vertical||de,d,fe,Te);Ut&&Zt(Xt,Ut,k)}}else if("Polygon"===s.type)for(const Xt of YT(s.geometry,0)){const Ut=lA(Xt,16);Zt(Xt[0],new hh(Ut.x,Ut.y,0,0,void 0),k)}else if("LineString"===s.type)for(const Xt of s.geometry)Zt(Xt,new hh(Xt[0].x,Xt[0].y,0,0,void 0),k);else if("Point"===s.type)for(const Xt of s.geometry)for(const Ut of Xt)Zt([Ut],new hh(Ut.x,Ut.y,0,0,void 0),k)}const g0=255,fh=g0*dh;function zy(o,s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X,ee){const de=function(be,Te,De,Be,Ze,ot,Ke,_t){const Ft=[];if(0===Te.positionedLines.length)return Ft;const yt=Be.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,Wt=function(Zt){const Xt=Zt[0],Ut=Zt[1],Rn=Xt*Ut;return Rn>0?[Xt,-Ut]:Rn<0?[-Xt,Ut]:0===Xt?[Ut,Xt]:[Ut,-Xt]}(De);let mt=Math.abs(Te.top-Te.bottom);for(const Zt of Te.positionedLines)mt-=Zt.lineOffset;const Tt=Te.positionedLines.length,Kt=mt/Tt;let bt=Te.top-De[1];for(let Zt=0;Zt<Tt;++Zt){const Xt=Te.positionedLines[Zt];bt=aA(Te,Kt,bt,Zt);for(const Ut of Xt.positionedGlyphs){if(!Ut.rect)continue;const Rn=Ut.rect||{};let Mn=mc+1,hn=!0,tn=1,Yn=0;if(Ut.imageName){const Ss=Ke[Ut.imageName];if(!Ss)continue;if(Ss.sdf){Ns("SDF images are not supported in formatted text and will be ignored.");continue}hn=!1,tn=Ss.pixelRatio,Mn=Ua/tn}const kn=(Ze||_t)&&Ut.vertical,xn=Ut.metrics.advance*Ut.scale/2,or=Ut.metrics,ur=Ut.rect;if(null===ur)continue;_t&&Te.verticalizable&&(Yn=Ut.imageName?xn-Ut.metrics.width*Ut.scale/2:0);const dr=Ze?[Ut.x+xn,Ut.y]:[0,0];let vr=[0,0],zr=[0,0],Ir=!1;Ze||(kn?(zr=[Ut.x+xn+Wt[0],Ut.y+Wt[1]-Yn],Ir=!0):vr=[Ut.x+xn+De[0],Ut.y+De[1]-Yn]);const Ti=ur.w*Ut.scale/(tn*(Ut.localGlyph?yu:1)),Pi=ur.h*Ut.scale/(tn*(Ut.localGlyph?yu:1));let ar,ri,hi,Zi;if(kn){const Ss=Ut.y-bt,ls=new rn(-xn,xn-Ss),mo=-Math.PI/2,Ys=new rn(...zr);ar=new rn(-xn+vr[0],vr[1]),ar._rotateAround(mo,ls)._add(Ys),ar.x+=-Ss+xn,ar.y-=(or.left-Mn)*Ut.scale;const Ko=Ut.imageName?or.advance*Ut.scale:za*Ut.scale,ji=String.fromCodePoint(Ut.glyph);KM(ji)?ar.x+=(1-Mn)*Ut.scale:JM(ji)?ar.x+=Ko-or.height*Ut.scale+(-Mn-1)*Ut.scale:ar.x+=Ut.imageName||or.width+2*Mn===ur.w&&or.height+2*Mn===ur.h?(Ko-Pi)/2:(Ko-(or.height+2*Mn)*Ut.scale)/2,ri=new rn(ar.x,ar.y-Ti),hi=new rn(ar.x+Pi,ar.y),Zi=new rn(ar.x+Pi,ar.y-Ti)}else{const Ss=(or.left-Mn)*Ut.scale-xn+vr[0],ls=(-or.top-Mn)*Ut.scale+vr[1],mo=Ss+Ti,Ys=ls+Pi;ar=new rn(Ss,ls),ri=new rn(mo,ls),hi=new rn(Ss,Ys),Zi=new rn(mo,Ys)}if(yt){let Ss;Ss=Ze?new rn(0,0):Ir?new rn(Wt[0],Wt[1]):new rn(De[0],De[1]),ar._rotateAround(yt,Ss),ri._rotateAround(yt,Ss),hi._rotateAround(yt,Ss),Zi._rotateAround(yt,Ss)}const ks=new rn(0,0),Xs=new rn(0,0);Ft.push({tl:ar,tr:ri,bl:hi,br:Zi,texPrimary:Rn,texSecondary:void 0,writingMode:Te.writingMode,glyphOffset:dr,sectionIndex:Ut.sectionIndex,isSDF:hn,pixelOffsetTL:ks,pixelOffsetBR:Xs,minFontScaleX:0,minFontScaleY:0})}}return Ft}(0,d,T,m,_,b,h,o.allowVerticalPlacement),ue=o.textSizeData;let fe=null;"source"===ue.kind?(fe=[dh*m.layout.get("text-size").evaluate(b,{},X)],fe[0]>fh&&Ns(`${o.layerIds[0]}: Value for "text-size" is >= ${g0}. Reduce your "text-size".`)):"composite"===ue.kind&&(fe=[dh*H.compositeTextSizes[0].evaluate(b,{},X),dh*H.compositeTextSizes[1].evaluate(b,{},X)],(fe[0]>fh||fe[1]>fh)&&Ns(`${o.layerIds[0]}: Value for "text-size" is >= ${g0}. Reduce your "text-size".`)),o.addSymbols(o.text,de,fe,T,_,b,A,s,a,S.lineStartIndex,S.lineLength,z,q,X,ee,!1);for(const be of k)N[be]=o.text.placedSymbolArray.length-1;return 4*de.length}function cA(o){for(const s in o)return o[s];return null}function Uy(o,s,a,d,h,m,_,b,T,S){let A=_.top,k=_.bottom,N=_.left,z=_.right;const H=_.collisionPadding;if(H&&(N-=H[0],A-=H[1],z+=H[2],k+=H[3]),T){const q=new rn(N,A),X=new rn(z,A),ee=new rn(N,k),de=new rn(z,k),ue=kr(T);let fe=new rn(0,0);S&&(fe=new rn(S[0],S[1])),q._rotateAround(ue,fe),X._rotateAround(ue,fe),ee._rotateAround(ue,fe),de._rotateAround(ue,fe),N=Math.min(q.x,X.x,ee.x,de.x),z=Math.max(q.x,X.x,ee.x,de.x),A=Math.min(q.y,X.y,ee.y,de.y),k=Math.max(q.y,X.y,ee.y,de.y)}return o.emplaceBack(s.x,s.y,s.z,a.x,a.y,N,A,z,k,b,d,h,m),o.length-1}function IE(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const s=o.bottom-o.top;return s>0?Math.max(10,s):null}function sR(o,s,a,d){const h=o.compareText;if(s in h){const m=h[s];for(let _=m.length-1;_>=0;_--)if(d.dist(m[_])<a)return!0}else h[s]=[];return h[s].push(d),!1}function uA(o,s){const a=o.fovAboveCenter,d=o.elevation?o.elevation.getMinElevationBelowMSL()*s:0,h=(o._camera.position[2]*o.worldSize-d)/Math.cos(o._pitch),m=Math.sin(a)*h/Math.sin(Math.max(Math.PI/2-o._pitch-a,.01)),_=Math.sin(o._pitch)*m+h;return Math.min(1.01*_,h*(1/o._horizonShift))}function kp(o,s){if(!s.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:s};const a=Math.pow(2,-o.z),d=o.x*a,h=(o.x+1)*a,m=o.y*a,_=(o.y+1)*a,b=ga(d),T=ga(h),S=Xo(m),A=Xo(_),k=s.project(b,S),N=s.project(T,S),z=s.project(T,A),H=s.project(b,A);let q=Math.min(k.x,N.x,z.x,H.x),X=Math.min(k.y,N.y,z.y,H.y),ee=Math.max(k.x,N.x,z.x,H.x),de=Math.max(k.y,N.y,z.y,H.y);const ue=a/16;function fe(Te,De,Be,Ze,ot,Ke){const _t=(Be+ot)/2,Ft=(Ze+Ke)/2,yt=s.project(ga(_t),Xo(Ft)),Wt=Math.max(0,q-yt.x,X-yt.y,yt.x-ee,yt.y-de);q=Math.min(q,yt.x),ee=Math.max(ee,yt.x),X=Math.min(X,yt.y),de=Math.max(de,yt.y),Wt>ue&&(fe(Te,yt,Be,Ze,_t,Ft),fe(yt,De,_t,Ft,ot,Ke))}fe(k,N,d,m,h,m),fe(N,z,h,m,h,_),fe(z,H,h,_,d,_),fe(H,k,d,_,d,m),q-=ue,X-=ue,ee+=ue,de+=ue;const be=1/Math.max(ee-q,de-X);return{scale:be,x:q*be,y:X*be,x2:ee*be,y2:de*be,projection:s}}function kE(o,{x:s,y:a},d=0){return new rn(((s-d)*o.scale-o.x)*Jt,(a*o.scale-o.y)*Jt)}const ti=f.ae.identity(new Float32Array(16));class W{constructor(s){this.spec=s,this.name=s.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(s,a){return{x:0,y:0,z:0}}unproject(s,a){return new Yr(0,0)}projectTilePoint(s,a,d){return{x:s,y:a,z:0}}locationPoint(s,a,d=!0){return s._coordinatePoint(s.locationCoordinate(a),d)}pixelsPerMeter(s,a){return bl(1,s)*a}pixelSpaceConversion(s,a,d){return 1}farthestPixelDistance(s){return uA(s,s.pixelsPerMeter)}pointCoordinate(s,a,d,h){const m=s.horizonLineFromTop(!1),_=new rn(a,Math.max(m,d));return s.rayIntersectionCoordinate(s.pointRayIntersection(_,h))}pointCoordinate3D(s,a,d){const h=new rn(a,d);if(s.elevation)return s.elevation.pointCoordinate(h);{const m=this.pointCoordinate(s,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(s,a){if(s.elevation&&s.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(s,a.x,a.y);const d=s.horizonLineFromTop();return a.y<d}createInversionMatrix(s,a){return ti}createTileMatrix(s,a,d){let h,m,_;const b=d.canonical,T=f.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=kp(b,this);h=1,m=S.x+d.wrap*S.scale,_=S.y,f.ae.scale(T,T,[h/S.scale,h/S.scale,s.pixelsPerMeter/a])}else h=a/s.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*d.wrap)*h,_=b.y*h;return f.ae.translate(T,T,[m,_,0]),f.ae.scale(T,T,[h/Jt,h/Jt,1]),T}upVector(s,a,d){return[0,0,1]}upVectorScale(s,a,d){return{metersToTile:1}}}class dA extends W{constructor(s){super(s),this.range=[4,7],this.center=s.center||[-96,37.5];const[a,d]=this.parallels=s.parallels||[29.5,45.5],h=Math.sin(kr(a));this.n=(h+Math.sin(kr(d)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(s,a){const{n:d,c:h,r0:m}=this,_=kr(s-this.center[0]),b=kr(a),T=Math.sqrt(h-2*d*Math.sin(b))/d;return{x:T*Math.sin(_*d),y:T*Math.cos(_*d)-m,z:0}}unproject(s,a){const{n:d,c:h,r0:m}=this,_=m+a;let b=Math.atan2(s,Math.abs(_))*Math.sign(_);_*d<0&&(b-=Math.PI*Math.sign(s)*Math.sign(_));const T=kr(this.center[0])*d;b=Qh(b,-Math.PI-T,Math.PI-T);const S=Dr(Ia(b/d)+this.center[0],-180,180),A=Math.asin(Dr((h-(s*s+_*_)*d*d)/(2*d),-1,1)),k=Dr(Ia(A),-ys,ys);return new Yr(S,k)}}const ut=1.340264,_0=-.081106,y0=893e-6,Vy=.003796,xg=Math.sqrt(3)/2;class bg extends W{project(s,a){a=a/180*Math.PI,s=s/180*Math.PI;const d=Math.asin(xg*Math.sin(a)),h=d*d,m=h*h*h;return{x:.5*(s*Math.cos(d)/(xg*(ut+3*_0*h+m*(7*y0+9*Vy*h)))/Math.PI+.5),y:1-.5*(d*(ut+_0*h+m*(y0+Vy*h))/Math.PI+1),z:0}}unproject(s,a){s=(2*s-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,h=d*d,m=h*h*h;for(let A,k,N,z=0;z<12&&(k=d*(ut+_0*h+m*(y0+Vy*h))-a,N=ut+3*_0*h+m*(7*y0+9*Vy*h),A=k/N,d=Dr(d-A,-Math.PI/3,Math.PI/3),h=d*d,m=h*h*h,!(Math.abs(A)<1e-12));++z);const _=xg*s*(ut+3*_0*h+m*(7*y0+9*Vy*h))/Math.cos(d),b=Math.asin(Math.sin(d)/xg),T=Dr(180*_/Math.PI,-180,180),S=Dr(180*b/Math.PI,-ys,ys);return new Yr(T,S)}}class OE extends W{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0}project(s,a){return{x:.5+s/360,y:.5-a/360,z:0}}unproject(s,a){const d=360*(s-.5),h=Dr(360*(.5-a),-ys,ys);return new Yr(d,h)}}const ph=Math.PI/2;function jy(o){return Math.tan((ph+o)/2)}class PE extends W{constructor(s){super(s),this.center=s.center||[0,30];const[a,d]=this.parallels=s.parallels||[30,30];let h=kr(a),m=kr(d);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);const _=Math.cos(h),b=jy(h);this.n=h===m?Math.sin(h):Math.log(_/Math.cos(m))/Math.log(jy(m)/b),this.f=_*Math.pow(jy(h),this.n)/this.n}project(s,a){a=kr(a),this.southernCenter&&(a=-a),s=kr(s-this.center[0]);const d=1e-6,{n:h,f:m}=this;m>0?a<-ph+d&&(a=-ph+d):a>ph-d&&(a=ph-d);const _=m/Math.pow(jy(a),h);let b=_*Math.sin(h*s),T=m-_*Math.cos(h*s);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(s,a){s=(2*s-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:d,f:h}=this,m=h-a,_=Math.sign(m),b=Math.sign(d)*Math.sqrt(s*s+m*m);let T=Math.atan2(s,Math.abs(m))*_;m*d<0&&(T-=Math.PI*Math.sign(s)*_);const S=Dr(Ia(T/d)+this.center[0],-180,180),A=Dr(Ia(2*Math.atan(Math.pow(h/b,1/d))-ph),-ys,ys);return new Yr(S,this.southernCenter?-A:A)}}class Jb extends W{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(s,a){return{x:mu(s),y:fc(a),z:0}}unproject(s,a){const d=ga(s),h=Xo(a);return new Yr(d,h)}}const Qb=kr(ys);class hA extends W{project(s,a){const d=(a=kr(a))*a,h=d*d;return{x:.5*((s=kr(s))*(.8707-.131979*d+h*(h*(.003971*d-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+d*(.015085+h*(.028874*d-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(s,a){s=(2*s-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,h=25,m=0,_=d*d;do{_=d*d;const S=_*_;m=(d*(1.007226+_*(.015085+S*(.028874*_-.044475-.005916*S)))-a)/(1.007226+_*(.045255+S*(.259866*_-.311325-.005916*11*S))),d=Dr(d-m,-Qb,Qb)}while(Math.abs(m)>1e-6&&--h>0);_=d*d;const b=Dr(Ia(s/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=Ia(d);return new Yr(b,T)}}const ew=kr(ys);class oR extends W{project(s,a){a=kr(a),s=kr(s);const d=Math.cos(a),h=2/Math.PI,m=Math.acos(d*Math.cos(s/2)),_=Math.sin(m)/m,b=.5*(s*h+2*d*Math.sin(s/2)/_)||0,T=.5*(a+Math.sin(a)/_)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(s,a){let d=s=(2*s-.5)*Math.PI,h=a=(2*(1-a)-1)*Math.PI,m=25;const _=1e-6;let b=0,T=0;do{const S=Math.cos(h),A=Math.sin(h),k=2*A*S,N=A*A,z=S*S,H=Math.cos(d/2),q=Math.sin(d/2),X=2*H*q,ee=q*q,de=1-z*H*H,ue=de?1/de:0,fe=de?Math.acos(S*H)*Math.sqrt(1/de):0,be=.5*(2*fe*S*q+2*d/Math.PI)-s,Te=.5*(fe*A+h)-a,De=.5*ue*(z*ee+fe*S*H*N)+1/Math.PI,Be=ue*(X*k/4-fe*A*q),Ze=.125*ue*(k*q-fe*A*z*X),ot=.5*ue*(N*H+fe*ee*S)+.5,Ke=Be*Ze-ot*De;b=(Te*Be-be*ot)/Ke,T=(be*Ze-Te*De)/Ke,d=Dr(d-b,-Math.PI,Math.PI),h=Dr(h-T,-ew,ew)}while((Math.abs(b)>_||Math.abs(T)>_)&&--m>0);return new Yr(Ia(d),Ia(h))}}class fA extends W{constructor(s){super(s),this.center=s.center||[0,0],this.parallels=s.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(kr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(s,a){const{scale:d,cosPhi:h}=this;return{x:kr(s)*h*d+.5,y:-Math.sin(kr(a))/h*d+.5,z:0}}unproject(s,a){const{scale:d,cosPhi:h}=this,m=-(a-.5)/d,_=Dr(Ia((s-.5)/d)/h,-180,180),b=Math.asin(Dr(m*h,-1,1)),T=Dr(Ia(b),-ys,ys);return new Yr(_,T)}}class aR extends Jb{constructor(s){super(s),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(s,a,d){const h=mb(s,a,d),m=gb(Po(d));return f.$.transformMat4(h,h,m),{x:h[0],y:h[1],z:h[2]}}locationPoint(s,a){const d=wf(a.lat,a.lng),h=f.$.normalize([],d),m=s.elevation?s.elevation.getAtPointOrZero(s.locationCoordinate(a),s._centerAltitude):s._centerAltitude,_=bl(1,0)*Jt*m;f.$.scaleAndAdd(d,d,h,_);const b=f.ae.identity(new Float64Array(16));return f.ae.multiply(b,s.pixelMatrix,s.globeMatrix),f.$.transformMat4(d,d,b),new rn(d[0],d[1])}pixelsPerMeter(s,a){return bl(1,0)*a}pixelSpaceConversion(s,a,d){const h=bl(1,s)*a,m=dn(bl(1,45)*a,h,d);return this.pixelsPerMeter(s,a)/m}createTileMatrix(s,a,d){const h=UT(Po(d.canonical));return f.ae.multiply(new Float64Array(16),s.globeMatrix,h)}createInversionMatrix(s,a){const{center:d}=s,h=gb(Po(a));return f.ae.rotateY(h,h,kr(d.lng)),f.ae.rotateX(h,h,kr(d.lat)),f.ae.scale(h,h,[s._pixelsPerMercatorPixel,s._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(s,a,d,h){return BT(s,a,d,!0)||new Is(0,0)}pointCoordinate3D(s,a,d){const h=this.pointCoordinate(s,a,d,0);return[h.x,h.y,h.z]}isPointAboveHorizon(s,a){return!BT(s,a.x,a.y,!1)}farthestPixelDistance(s){const a=function(h,m){const _=h.cameraToCenterDistance,b=h._centerAltitude*m,T=h._camera,S=h._camera.forward(),A=f.$.add([],f.$.scale([],S,-_),[0,0,b]),k=h.worldSize/(2*Math.PI),N=[0,0,-k],z=h.width/h.height,H=Math.tan(h.fovAboveCenter),q=f.$.scale([],T.up(),H),X=f.$.scale([],T.right(),H*z),ee=f.$.normalize([],f.$.add([],f.$.add([],S,q),X)),de=[];let ue;if(new RT(A,ee).closestPointOnSphere(N,k,de)){const fe=f.$.add([],de,N),be=f.$.sub([],fe,A);ue=Math.cos(h.fovAboveCenter)*f.$.length(be)}else{const fe=f.$.sub([],A,N),be=f.$.sub([],N,A);f.$.normalize(be,be);const Te=f.$.length(fe)-k;ue=Math.sqrt(Te*(Te+2*k));const De=Math.acos(ue/(k+Te))-Math.acos(f.$.dot(S,be));ue*=Math.cos(De)}return 1.01*ue}(s,this.pixelsPerMeter(s.center.lat,s.worldSize)),d=ol(s.zoom);if(d>0){const h=uA(s,bl(1,s.center.lat)*s.worldSize),m=s.worldSize/(2*Math.PI),_=Math.max(s.width,s.height)/s.worldSize*Math.PI;return dn(a,h+m*(1-Math.cos(_)),Math.pow(d,10))}return a}upVector(s,a,d){return mb(a,d,s,1)}upVectorScale(s){return{metersToTile:pb(zT(Po(s)))}}}function RE(o){const s=o.parallels,a=!!s&&Math.abs(s[0]+s[1])<.01;switch(o.name){case"mercator":return new Jb(o);case"equirectangular":return new OE(o);case"naturalEarth":return new hA(o);case"equalEarth":return new bg(o);case"winkelTripel":return new oR(o);case"albers":return a?new fA(o):new dA(o);case"lambertConformalConic":return a?new fA(o):new PE(o);case"globe":return new aR(o)}throw new Error(`Invalid projection name: ${o.name}`)}const lR=pg.types,cR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tw(o,s,a,d,h,m,_,b,T,S,A,k,N){const z=b?Math.min(fh,Math.round(b[0])):0,H=b?Math.min(fh,Math.round(b[1])):0;o.emplaceBack(s,a,Math.round(32*d),Math.round(32*h),m,_,(z<<1)+(T?1:0),H,16*S,16*A,256*k,256*N)}function nw(o,s,a){o.emplaceBack(s,a)}function $y(o,s,a,d,h,m,_){o.emplaceBack(s,a,d,h,m,_)}function Hy(o,s,a,d,h){o.emplaceBack(s,a,d,h),o.emplaceBack(s,a,d,h),o.emplaceBack(s,a,d,h),o.emplaceBack(s,a,d,h)}function uR(o){for(const s of o.sections)if(tr(s.text))return!0;return!1}class NE{constructor(s){this.layoutVertexArray=new hc,this.indexArray=new fo,this.programConfigurations=s,this.segments=new _s,this.dynamicLayoutVertexArray=new dc,this.opacityVertexArray=new Qx,this.placedSymbolArray=new UD,this.iconTransitioningVertexArray=new _f,this.globeExtVertexArray=new Jx,this.zOffsetVertexArray=new yf}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(s,a,d,h,m){this.isEmpty()||(d&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,UM.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,d5.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,cR,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=s.createVertexBuffer(this.iconTransitioningVertexArray,h5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,VM.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,GP.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||h)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Fe(NE,"SymbolBuffers");class Tl{constructor(s,a,d){this.layoutVertexArray=new s,this.layoutAttributes=a,this.indexArray=new d,this.segments=new _s,this.collisionVertexArray=new z_,this.collisionVertexArrayExt=new dc}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,fE.members,!0),this.collisionVertexBufferExt=s.createVertexBuffer(this.collisionVertexArrayExt,pE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Fe(Tl,"CollisionBuffers");class v0{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.lut=s.lut,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=f.ae.identity([]),this.placementViewportMatrix=f.ae.identity([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=YM(this.zoom,a["text-size"]),this.iconSizeData=YM(this.zoom,a["icon-size"]);const d=this.layers[0].layout,h=d.get("symbol-sort-key"),m=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(_=>Vs[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=s.sourceID,this.projection=s.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=d.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new NE(new to(this.layers,{zoom:this.zoom,lut:this.lut},s=>/^text/.test(s))),this.icon=new NE(new to(this.layers,{zoom:this.zoom,lut:this.lut},s=>/^icon/.test(s))),this.glyphOffsetArray=new Bt,this.lineVertexArray=new zt,this.symbolInstances=new gi}calculateGlyphDependencies(s,a,d,h,m){for(let _=0;_<s.length;_++){const b=s.codePointAt(_);if(void 0===b)break;if(a[b]=!0,h&&m&&b<=65535){const T=c0[s.charAt(_)];T&&(a[T.charCodeAt(0)]=!0)}}}updateFootprints(s,a){}updateReplacement(s,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(s.toUnwrapped(),!0);return!Ab(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(s,a,d,h){const m=this.layers[0],_=m.layout,b="globe"===this.projection.name,T=_.get("text-font"),S=_.get("text-field"),A=_.get("icon-image"),k=("constant"!==S.value.kind||S.value.value instanceof Ho&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),N="constant"!==A.value.kind||!!A.value.value||Object.keys(A.parameters).length>0,z=_.get("symbol-sort-key");if(this.features=[],!k&&!N)return;const H=a.iconDependencies,q=a.glyphDependencies,X=a.availableImages,ee=new Qn(this.zoom);for(const{feature:de,id:ue,index:fe,sourceLayerIndex:be}of s){const Te=m._featureFilter.needGeometry,De=oh(de,Te);if(!m._featureFilter.filter(ee,De,d))continue;if(Te||(De.geometry=gu(de,d,h)),b&&1!==de.type&&d.z<=5){const Ke=De.geometry,_t=.98078528056,Ft=(yt,Wt)=>{const mt=mb(yt.x,yt.y,d,1),Tt=mb(Wt.x,Wt.y,d,1);return f.$.dot(mt,Tt)<_t};for(let yt=0;yt<Ke.length;yt++)Ke[yt]=GD(Ke[yt],Ft)}let Be,Ze;if(k){const Ke=m.getValueAndResolveTokens("text-field",De,d,X),_t=Ho.factory(Ke);uR(_t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===sr()||this.hasRTLText&&Tr.isParsed())&&(Be=Hb(_t,m,De))}if(N){const Ke=m.getValueAndResolveTokens("icon-image",De,d,X);Ze=Ke instanceof fl?Ke:fl.fromString(Ke)}if(!Be&&!Ze)continue;const ot=this.sortFeaturesByKey?z.evaluate(De,{},d):void 0;if(this.features.push({id:ue,text:Be,icon:Ze,index:fe,sourceLayerIndex:be,geometry:De.geometry,properties:de.properties,type:lR[de.type],sortKey:ot}),Ze&&(H[Ze.namePrimary]=!0,Ze.nameSecondary&&(H[Ze.nameSecondary]=!0)),Be){const Ke=T.evaluate(De,{},d).join(","),_t="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Vs.vertical)>=0;for(const Ft of Be.sections)if(Ft.image)H[Ft.image.namePrimary]=!0;else{const yt=wt(Be.toString()),Wt=Ft.fontStack||Ke,mt=q[Wt]=q[Wt]||{};this.calculateGlyphDependencies(Ft.text,mt,_t,this.allowVerticalPlacement,yt)}}}"line"===_.get("symbol-placement")&&(this.features=function(de){const ue={},fe={},be=[];let Te=0;function De(Ke){be.push(de[Ke]),Te++}function Be(Ke,_t,Ft){const yt=fe[Ke];return delete fe[Ke],fe[_t]=yt,be[yt].geometry[0].pop(),be[yt].geometry[0]=be[yt].geometry[0].concat(Ft[0]),yt}function Ze(Ke,_t,Ft){const yt=ue[_t];return delete ue[_t],ue[Ke]=yt,be[yt].geometry[0].shift(),be[yt].geometry[0]=Ft[0].concat(be[yt].geometry[0]),yt}function ot(Ke,_t,Ft){const yt=Ft?_t[0][_t[0].length-1]:_t[0][0];return`${Ke}:${yt.x}:${yt.y}`}for(let Ke=0;Ke<de.length;Ke++){const _t=de[Ke],Ft=_t.geometry,yt=_t.text?_t.text.toString():null;if(!yt){De(Ke);continue}const Wt=ot(yt,Ft),mt=ot(yt,Ft,!0);if(Wt in fe&&mt in ue&&fe[Wt]!==ue[mt]){const Tt=Ze(Wt,mt,Ft),Kt=Be(Wt,mt,be[Tt].geometry);delete ue[Wt],delete fe[mt],fe[ot(yt,be[Kt].geometry,!0)]=Kt,be[Tt].geometry=null}else Wt in fe?Be(Wt,mt,Ft):mt in ue?Ze(Wt,mt,Ft):(De(Ke),ue[Wt]=Te-1,fe[mt]=Te-1)}return be.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((de,ue)=>de.sortKey-ue.sortKey)}update(s,a,d,h,m){const _=0!==Object.keys(s).length;if(_&&!this.stateDependentLayers.length)return;const b=_?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(s,a,b,d,h,m),this.icon.programConfigurations.updatePaintArrays(s,a,b,d,h,m)}updateZOffset(){const s=(m,_,b)=>{d+=_,d>m.length&&m.resize(d);for(let T=-_;T<0;T++)m.emplace(T+d,b)},a=(m,_,b)=>{h+=_,h>m.length&&m.resize(h);for(let T=-_;T<0;T++)m.emplace(T+h,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,h=0;for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,numIconVertices:S}=_,A=_.zOffset,k=S>0;if((b>0||T>0)&&(s(this.text.zOffsetVertexArray,b,A),s(this.text.zOffsetVertexArray,T,A)),k){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:z}=_;N>=0&&a(this.icon.zOffsetVertexArray,S,A),z>=0&&a(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=RE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,a){const d=this.lineVertexArray.length;if(void 0!==s.segment)for(const{x:h,y:m}of a)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(s,a,d,h,m,_,b,T,S,A,k,N,z,H,q,X){const ee=s.indexArray,de=s.layoutVertexArray,ue=s.globeExtVertexArray,fe=s.segments.prepareSegment(4*a.length,de,ee,this.canOverlap?_.sortKey:void 0),be=this.glyphOffsetArray.length,Te=fe.vertexLength,De=this.allowVerticalPlacement&&b===Vs.vertical?Math.PI/2:0,Be=_.text&&_.text.sections;for(let ot=0;ot<a.length;ot++){const{tl:Ke,tr:_t,bl:Ft,br:yt,texPrimary:Wt,texSecondary:mt,pixelOffsetTL:Tt,pixelOffsetBR:Kt,minFontScaleX:bt,minFontScaleY:Zt,glyphOffset:Xt,isSDF:Ut,sectionIndex:Rn}=a[ot],Mn=fe.vertexLength,hn=Xt[1];if(tw(de,S.x,S.y,Ke.x,hn+Ke.y,Wt.x,Wt.y,d,Ut,Tt.x,Tt.y,bt,Zt),tw(de,S.x,S.y,_t.x,hn+_t.y,Wt.x+Wt.w,Wt.y,d,Ut,Kt.x,Tt.y,bt,Zt),tw(de,S.x,S.y,Ft.x,hn+Ft.y,Wt.x,Wt.y+Wt.h,d,Ut,Tt.x,Kt.y,bt,Zt),tw(de,S.x,S.y,yt.x,hn+yt.y,Wt.x+Wt.w,Wt.y+Wt.h,d,Ut,Kt.x,Kt.y,bt,Zt),T){const{x:tn,y:Yn,z:kn}=T.anchor,[xn,or,ur]=T.up;$y(ue,tn,Yn,kn,xn,or,ur),$y(ue,tn,Yn,kn,xn,or,ur),$y(ue,tn,Yn,kn,xn,or,ur),$y(ue,tn,Yn,kn,xn,or,ur),Hy(s.dynamicLayoutVertexArray,tn,Yn,kn,De)}else Hy(s.dynamicLayoutVertexArray,S.x,S.y,S.z,De);if(X){const tn=mt||Wt;nw(s.iconTransitioningVertexArray,tn.x,tn.y),nw(s.iconTransitioningVertexArray,tn.x+tn.w,tn.y),nw(s.iconTransitioningVertexArray,tn.x,tn.y+tn.h),nw(s.iconTransitioningVertexArray,tn.x+tn.w,tn.y+tn.h)}ee.emplaceBack(Mn,Mn+1,Mn+2),ee.emplaceBack(Mn+1,Mn+2,Mn+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xt[0]),ot!==a.length-1&&Rn===a[ot+1].sectionIndex||s.programConfigurations.populatePaintArrays(de.length,_,_.index,{},z,H,q,Be&&Be[Rn])}const Ze=T?T.anchor:S;s.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,S.x,S.y,be,this.glyphOffsetArray.length-be,Te,A,k,S.segment,d?d[0]:0,d?d[1]:0,h[0],h[1],b,0,!1,0,N,0)}_commitLayoutVertex(s,a,d,h,m,_,b){s.emplaceBack(a,d,h,m,_,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(s,a,d,h,m,_,b){const T=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),S=T.vertexLength,A=b.tileAnchorX,k=b.tileAnchorY;for(let z=0;z<4;z++)d.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,a,s.padding,b.zOffset),this._commitLayoutVertex(d.layoutVertexArray,h,m,_,A,k,new rn(s.x1,s.y1)),this._commitLayoutVertex(d.layoutVertexArray,h,m,_,A,k,new rn(s.x2,s.y1)),this._commitLayoutVertex(d.layoutVertexArray,h,m,_,A,k,new rn(s.x2,s.y2)),this._commitLayoutVertex(d.layoutVertexArray,h,m,_,A,k,new rn(s.x1,s.y2)),T.vertexLength+=4;const N=d.indexArray;N.emplaceBack(S,S+1),N.emplaceBack(S+1,S+2),N.emplaceBack(S+2,S+3),N.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(s,a,d,h,m,_){for(let b=h;b<m;b++){const T=d.get(b),S=this.getSymbolInstanceTextSize(s,_,a,b);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(s,a,d,h,m,_){for(let b=h;b<m;b++){const T=d.get(b),S=this.getSymbolInstanceIconSize(s,a,_.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(s,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tl(L_,WP.members,_f),this.iconCollisionBox=new Tl(L_,WP.members,_f);const d=l0(this.iconSizeData,s),h=l0(this.textSizeData,s);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,s,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,s,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(d,s,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(d,s,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(s,a,d,h){const m=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:h),_=xE(this.textSizeData,s,m)/za;return this.tilePixelRatio*_}getSymbolInstanceIconSize(s,a,d){const h=this.icon.placedSymbolArray.get(d),m=xE(this.iconSizeData,s,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(s,a,d,h){s.emplaceBack(a,-d,-d,h),s.emplaceBack(a,d,-d,h),s.emplaceBack(a,d,d,h),s.emplaceBack(a,-d,d,h)}_updateTextDebugCollisionBoxes(s,a,d,h,m,_){for(let b=h;b<m;b++){const T=d.get(b),S=this.getSymbolInstanceTextSize(s,_,a,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,T.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(s,a,d,h,m,_){for(let b=h;b<m;b++){const T=d.get(b),S=this.getSymbolInstanceIconSize(s,a,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,T.padding,_.zOffset)}}updateCollisionDebugBuffers(s,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=l0(this.iconSizeData,s),h=l0(this.textSizeData,s);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,s,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,s,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(d,s,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._updateIconDebugCollisionBoxes(d,s,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(s,a,d,h,m,_,b,T,S){const A={};if(a<d){const{x1:k,y1:N,x2:z,y2:H,padding:q,projectedAnchorX:X,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:fe,featureIndex:be}=s.get(a);A.textBox={x1:k,y1:N,x2:z,y2:H,padding:q,projectedAnchorX:X,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:fe},A.textFeatureIndex=be}if(h<m){const{x1:k,y1:N,x2:z,y2:H,padding:q,projectedAnchorX:X,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:fe,featureIndex:be}=s.get(h);A.verticalTextBox={x1:k,y1:N,x2:z,y2:H,padding:q,projectedAnchorX:X,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:fe},A.verticalTextFeatureIndex=be}if(_<b){const{x1:k,y1:N,x2:z,y2:H,padding:q,projectedAnchorX:X,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:fe,featureIndex:be}=s.get(_);A.iconBox={x1:k,y1:N,x2:z,y2:H,padding:q,projectedAnchorX:X,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:fe},A.iconFeatureIndex=be}if(T<S){const{x1:k,y1:N,x2:z,y2:H,padding:q,projectedAnchorX:X,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:fe,featureIndex:be}=s.get(T);A.verticalIconBox={x1:k,y1:N,x2:z,y2:H,padding:q,projectedAnchorX:X,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ue,tileAnchorY:fe},A.verticalIconFeatureIndex=be}return A}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const d=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(s,a){const d=s.placedSymbolArray.get(a),h=d.vertexStartIndex+4*d.numGlyphs;for(let m=d.vertexStartIndex;m<h;m+=4)s.indexArray.emplaceBack(m,m+1,m+2),s.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(s),d=Math.cos(s),h=[],m=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const T=this.symbolInstances.get(b);h.push(0|Math.round(a*T.tileAnchorX+d*T.tileAnchorY)),m.push(T.featureIndex)}return _.sort((b,T)=>h[b]-h[T]||m[T]-m[b]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let s=0;s<this.symbolInstances.length;++s)this.symbolInstanceIndexesSortedZOffset.push(s)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((s,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(s).zOffset)}addToSortKeyRanges(s,a){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===a?d.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const d=this.symbolInstances.get(a);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=d;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&_!==m&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Fe(v0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),v0.addDynamicAttributes=Hy;class vu{constructor(s,a,d,h){this.context=s,this.format=d,this.texture=s.gl.createTexture(),this.update(a,h)}update(s,a,d){const{width:h,height:m}=s,{context:_}=this,{gl:b}=_;if(b.bindTexture(b.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!a||!1!==a.premultiply)),this.useMipmap=!(!a||!a.useMipmap),d||this.size&&this.size[0]===h&&this.size[1]===m){const{x:T,y:S}=d||{x:0,y:0};if(s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap)b.texSubImage2D(b.TEXTURE_2D,0,T,S,b.RGBA,b.UNSIGNED_BYTE,s);else{let A=this.format,k=b.UNSIGNED_BYTE;this.format===b.R32F&&(A=b.RED,k=b.FLOAT),b.texSubImage2D(b.TEXTURE_2D,0,T,S,h,m,A,k,s.data)}}else if(this.size=[h,m],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap){let T=this.format;this.format===b.R8&&(T=b.RED),b.texImage2D(b.TEXTURE_2D,0,this.format,T,b.UNSIGNED_BYTE,s)}else{let T=this.format,S=this.format,A=b.UNSIGNED_BYTE,k=!1;this.format===b.DEPTH_COMPONENT&&(T=b.DEPTH_COMPONENT16,A=b.UNSIGNED_SHORT),this.format===b.DEPTH_STENCIL&&(T=b.DEPTH24_STENCIL8,A=b.UNSIGNED_INT_24_8,k=!0),this.format===b.R8&&(S=b.RED),this.format===b.R32F&&(A=b.FLOAT,S=b.RED),!this.useMipmap&&k?b.texStorage2D(b.TEXTURE_2D,1,T,h,m):b.texImage2D(b.TEXTURE_2D,0,T,h,m,0,S,A,s.data)}this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(s,a,d=!1){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!d?s===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(s,a,d,h){const{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),a!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,a),this.magFilter=a),s!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?s===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),d!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,d),this.wrapS=d),h!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class FE{constructor(s,a){this.context=s,this.texture=a}bind(s,a){const{context:d}=this,{gl:h}=d;h.bindTexture(h.TEXTURE_2D,this.texture),s!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s),this.minFilter=s),a!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrapS=a)}}const Op=new Uint16Array(8184);for(let o=0;o<2046;o++){let s=o+2,a=0,d=0,h=0,m=0,_=0,b=0;for(1&s?h=m=_=32:a=d=b=32;(s>>=1)>1;){const S=a+h>>1,A=d+m>>1;1&s?(h=a,m=d,a=_,d=b):(a=h,d=m,h=_,m=b),_=S,b=A}const T=4*o;Op[T+0]=a,Op[T+1]=d,Op[T+2]=h,Op[T+3]=m}const mh=new Uint16Array(2178),Pp=new Uint8Array(1089),Gy=new Uint16Array(1089);function pA(o){return 0===o?-.03125:32===o?.03125:0}var rw=oi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let LE=(()=>{class o{constructor(a,d,h,m){this.id=o.uniqueIdxCounter,o.uniqueIdxCounter++,this.context=a;const _=a.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||m||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=o.uniqueIdxCounter,o.uniqueIdxCounter++;const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return o.uniqueIdxCounter=0,o})();class x0{constructor(s,a,d){this.func=s,this.mask=a,this.range=d}}x0.ReadOnly=!1,x0.ReadWrite=!0,x0.disabled=new x0(519,x0.ReadOnly,[0,1]);class zE{constructor(s,a,d,h,m,_){this.test=s,this.ref=a,this.mask=d,this.fail=h,this.depthFail=m,this.pass=_}}zE.disabled=new zE({func:519,mask:0},0,0,7680,7680,7680);class _c{constructor(s,a,d,h){this.blendFunction=s,this.blendColor=a,this.mask=d,this.blendEquation=h}}_c.Replace=[1,0,1,0],_c.disabled=new _c(_c.Replace,It.transparent,[!1,!1,!1,!1]),_c.unblended=new _c(_c.Replace,It.transparent,[!0,!0,!0,!0]),_c.alphaBlended=new _c([1,771,1,771],It.transparent,[!0,!0,!0,!0]),_c.alphaBlendedNonPremultiplied=new _c([770,771,770,771],It.transparent,[!0,!0,!0,!0]),_c.multiply=new _c([774,0,774,0],It.transparent,[!0,!0,!0,!0]);class ed{constructor(s,a,d){this.enable=s,this.mode=a,this.frontFace=d}}ed.disabled=new ed(!1,1029,2305),ed.backCCW=new ed(!0,1029,2305),ed.backCW=new ed(!0,1029,2304),ed.frontCW=new ed(!0,1028,2304),ed.frontCCW=new ed(!0,1028,2305);var dR=oi([{name:"a_index",type:"Int16",components:1}]);const UE={type:2,extent:Jt,loadGeometry:()=>[[new rn(0,0),new rn(Jt+1,0),new rn(Jt+1,Jt+1),new rn(0,Jt+1),new rn(0,0)]]};class Zy{constructor(s,a,d,h,m){this.tileID=s,this.uid=t_(),this.uses=0,this.tileSize=a,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(s){const a=s+this.timeAdded;a<Oa.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=kp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,a,d){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(h,m){const _={};if(!m)return _;for(const b of h){const T=b.layerIds.map(S=>m.getLayer(S)).filter(Boolean);if(0!==T.length){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(S=>T.filter(A=>A.id===S)[0]));for(const S of T)_[S.fqid]=b}}return _}(s.buckets,a.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof v0){if(this.hasSymbolBuckets=!0,!d)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof v0&&m.hasRTLText){this.hasRTLText=!0,Tr.isLoading()||Tr.isLoaded()||"deferred"!==sr()||Sr();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h],_=a.style.getOwnLayer(h);if(!_)continue;const b=_.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,b)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new xT}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const h in this.buckets){const m=this.buckets[h];m.uploadPending()&&m.upload(s)}const a=s.gl,d=this.imageAtlas;if(d&&!d.uploaded){const h=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new vu(s,d.image,a.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new vu(s,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new vu(s,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(s,a,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,d),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const h=a.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,a)))}queryRenderedFeatures(s,a,d,h,m,_,b,T){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:b,transform:_,params:m,tileTransform:this.tileTransform},s,a,d):{}}querySourceFeatures(s,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const h=d.loadVTLayers(),m=a?a.sourceLayer:"",_=h._geojsonTileLayer||h[m];if(!_)return;const b=nh(a&&a.filter),{z:T,x:S,y:A}=this.tileID.canonical,k={z:T,x:S,y:A};for(let N=0;N<_.length;N++){const z=_.feature(N);if(b.needGeometry){const X=oh(z,!0);if(!b.filter(new Qn(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!b.filter(new Qn(this.tileID.overscaledZ),z))continue;const H=d.getId(z,m),q=new Vb(z,T,S,A,H);q.tile=k,s.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const a=this.expirationTime;if(s.cacheControl){const d=r_(s.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const d=Date.now();let h=!1;if(this.expirationTime>d)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const m=this.expirationTime-a;m?this.expirationTime=d+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(s,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(s).length&&a&&this.updateBuckets(s,a)}updateBuckets(s,a){if(!this.latestFeatureIndex)return;const d=this.latestFeatureIndex.loadVTLayers(),h=a.style.listImages(),m=a.style.getBrightness();for(const _ in this.buckets){if(!a.style.hasLayer(_))continue;const b=this.buckets[_],T=b.layers[0].sourceLayer||"_geojsonTileLayer",S=d[T];let A={};if(s&&(A=s[T],!S||!A||0===Object.keys(A).length))continue;if(b.update(A,S,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},m),b instanceof Lb||b instanceof QT){const N=a.style.getOwnSourceCache(b.layers[0].source);a._terrain&&a._terrain.enabled&&N&&b.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(N.id,this.tileID)}const k=a&&a.style&&a.style.getOwnLayer(_);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Oa.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=Oa.now()+s}setTexture(s,a){const d=a.context,h=d.gl;this.texture=this.texture||a.getTileTexture(s.width),this.texture&&this.texture instanceof vu?this.texture.update(s,{useMipmap:!0}):(this.texture=new vu(d,s,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(s,a){const d={};for(const h of a)d[h]=!0;this.dependencies[s]=d}hasDependency(s,a){for(const d of s){const h=this.dependencies[d];if(h)for(const m of a)if(h[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const d=gu(UE,this.tileID.canonical,this.tileTransform)[0],h=new Vc,m=new X1;for(let _=0;_<d.length;_++){const{x:b,y:T}=d[_];h.emplaceBack(b,T),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(m),this._tileDebugBuffer=s.createVertexBuffer(h,fb.members),this._tileDebugSegments=_s.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(s,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const d=gu(UE,this.tileID.canonical,this.tileTransform)[0];let h,m;if(this.isRaster){const _=function(b,T){const S=kp(b,T),A=Math.pow(2,b.z);for(let X=0;X<33;X++)for(let ee=0;ee<33;ee++){const de=ga((b.x+(ee+pA(ee))/32)/A),ue=Xo((b.y+(X+pA(X))/32)/A),fe=T.project(de,ue),be=33*X+ee;mh[2*be+0]=Math.round((fe.x*S.scale-S.x)*Jt),mh[2*be+1]=Math.round((fe.y*S.scale-S.y)*Jt)}Pp.fill(0),Gy.fill(0);for(let X=2045;X>=0;X--){const ee=4*X,de=Op[ee+0],ue=Op[ee+1],fe=Op[ee+2],be=Op[ee+3],Te=de+fe>>1,De=ue+be>>1,Be=Te+De-ue,Ze=De+de-Te,ot=33*ue+de,Ke=33*be+fe,_t=33*De+Te,Ft=Math.hypot((mh[2*ot+0]+mh[2*Ke+0])/2-mh[2*_t+0],(mh[2*ot+1]+mh[2*Ke+1])/2-mh[2*_t+1])>=16;Pp[_t]=Pp[_t]||(Ft?1:0),X<1022&&(Pp[_t]=Pp[_t]||Pp[33*(ue+Ze>>1)+(de+Be>>1)]||Pp[33*(be+Ze>>1)+(fe+Be>>1)])}const k=new ho,N=new fo;let z=0;function H(X,ee){const de=33*ee+X;return 0===Gy[de]&&(k.emplaceBack(mh[2*de+0],mh[2*de+1],X*Jt/32,ee*Jt/32),Gy[de]=++z),Gy[de]-1}function q(X,ee,de,ue,fe,be){const Te=X+de>>1,De=ee+ue>>1;if(Math.abs(X-fe)+Math.abs(ee-be)>1&&Pp[33*De+Te])q(fe,be,X,ee,Te,De),q(de,ue,fe,be,Te,De);else{const Be=H(X,ee),Ze=H(de,ue),ot=H(fe,be);N.emplaceBack(Be,Ze,ot)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:k,indices:N}}(this.tileID.canonical,a);h=_.vertices,m=_.indices}else{h=new ho,m=new fo;for(const{x:b,y:T}of d)h.emplaceBack(b,T,0,0);const _=K_(h.int16,void 0,4);for(let b=0;b<_.length;b+=3)m.emplaceBack(_[b],_[b+1],_[b+2])}this._tileBoundsBuffer=s.createVertexBuffer(h,rw.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(m),this._tileBoundsSegments=_s.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugBuffers(s,a){const d=a.projection;if(!d||"globe"!==d.name||a.freezeTileCoverage)return;const h=this.tileID.canonical,m=gb(lh(h,a)),_=ol(a.zoom);let b;_>0&&(b=f.ae.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,h,a,m,b,_),this._makeGlobeTileDebugTextBuffer(s,h,a,m,b,_)}_globePoint(s,a,d,h,m,_,b){let T=mb(s,a,d);if(_){const S=1<<d.z,A=mu(h.center.lng),k=fc(h.center.lat),N=(d.x+.5)/S-A;let z=0;N>.5?z=-1:N<-.5&&(z=1);let H=(s/Jt+d.x)/S+z,q=(a/Jt+d.y)/S;H=(H-A)*h._pixelsPerMercatorPixel+A,q=(q-k)*h._pixelsPerMercatorPixel+k;const X=[H*h.worldSize,q*h.worldSize,0];f.$.transformMat4(X,X,_),T=ah(T,X,b)}return f.$.transformMat4(T,T,m)}_makeGlobeTileDebugBorderBuffer(s,a,d,h,m,_){const b=new Vc,T=new X1,S=new bp,A=(N,z,H,q,X)=>{const ee=(H-N)/(X-1),de=(q-z)/(X-1),ue=b.length;for(let fe=0;fe<X;fe++){const be=N+fe*ee,Te=z+fe*de;b.emplaceBack(be,Te);const De=this._globePoint(be,Te,a,d,h,m,_);S.emplaceBack(De[0],De[1],De[2]),T.emplaceBack(ue+fe)}},k=Jt;A(0,0,k,0,16),A(k,0,k,k,16),A(k,k,0,k,16),A(0,k,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(T),this._tileDebugBuffer=s.createVertexBuffer(b,fb.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(S,zs.members),this._tileDebugSegments=_s.simpleSegment(0,0,b.length,T.length)}_makeGlobeTileDebugTextBuffer(s,a,d,h,m,_){const b=Jt/4,T=new Vc,S=new fo,A=new bp,k=25;S.reserve(32),T.reserve(k),A.reserve(k);const N=(z,H)=>k*z+H;for(let z=0;z<k;z++){const H=z*b;for(let q=0;q<k;q++){const X=q*b;T.emplaceBack(X,H);const ee=this._globePoint(X,H,a,d,h,m,_);A.emplaceBack(ee[0],ee[1],ee[2])}}for(let z=0;z<4;z++)for(let H=0;H<4;H++){const q=N(z,H),X=N(z,H+1),ee=N(z+1,H),de=N(z+1,H+1);S.emplaceBack(q,X,ee),S.emplaceBack(ee,X,de)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(S),this._tileDebugTextBuffer=s.createVertexBuffer(T,fb.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(A,zs.members),this._tileDebugTextSegments=_s.simpleSegment(0,0,k,32)}destroy(s=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof vu&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function iw(o,s,a){var d,h;1===o?s.header_length=a.readFixed32():2===o?s.x=a.readVarint():3===o?s.y=a.readVarint():4===o?s.z=a.readVarint():5===o&&s.layers.push((d=a,h=a.readVarint()+a.pos,d.readFields(_A,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},h)))}function VE(o,s,a){var d,h;1===o?(s.delta_filter=(d=a,h=a.readVarint()+a.pos,d.readFields(x5,{block_size:0},h)),s.filter="delta_filter"):2===o?(a.readVarint(),s.filter="zigzag_filter"):3===o?(a.readVarint(),s.filter="bitshuffle_filter"):4===o&&(a.readVarint(),s.filter="byteshuffle_filter")}function x5(o,s,a){1===o&&(s.block_size=a.readVarint())}function mA(o,s,a){1===o?(a.readVarint(),s.codec="gzip_data"):2===o?(a.readVarint(),s.codec="jpeg_image"):3===o?(a.readVarint(),s.codec="webp_image"):4===o&&(a.readVarint(),s.codec="png_image")}function gA(o,s,a){var d,h;1===o?s.first_byte=a.readFixed64():2===o?s.last_byte=a.readFixed64():3===o?s.filters.push((d=a,h=a.readVarint()+a.pos,d.readFields(VE,{},h))):4===o?s.codec=function(d,h){return d.readFields(mA,{},h)}(a,a.readVarint()+a.pos):5===o?s.deprecated_offset=a.readFloat():6===o?s.deprecated_scale=a.readFloat():7===o?s.bands.push(a.readString()):8===o?s.offset=a.readDouble():9===o&&(s.scale=a.readDouble())}function _A(o,s,a){var d,h;1===o?s.version=a.readVarint():2===o?s.name=a.readString():3===o?s.units=a.readString():4===o?s.tilesize=a.readVarint():5===o?s.buffer=a.readVarint():6===o?s.pixel_format=a.readVarint():7===o&&s.data_index.push((d=a,h=a.readVarint()+a.pos,d.readFields(gA,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},h)))}function sw(o,s,a){if(2===o)d=a,h=a.readVarint()+a.pos,d.readFields(jE,s,h);else if(3===o)throw new Error("Not implemented");var d,h}function jE(o,s,a){if(1===o){let d=0;const h=a.readVarint()+a.pos;for(;a.pos<h;)s[d++]=a.readVarint()}}class Of{constructor(s){this.capacity=s,this.cache=new Map}get(s){if(!this.cache.has(s))return;const a=this.cache.get(s);return this.cache.delete(s),this.cache.set(s,a),a}put(s,a){this.cache.has(s)?this.cache.delete(s):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(s,a)}}function hR(o,s){if(4!==s.length)throw new Error(`Expected data of dimension 4 but got ${s.length}.`);let a=s[3];for(let d=2;d>=1;d--){const h=1===d?1:0,m=2===d?1:0;for(let _=0;_<s[0];_++){const b=s[1]*_;for(let T=h;T<s[1];T++){const S=s[2]*(T+b);for(let A=m;A<s[2];A++){const k=s[3]*(A+S);for(let N=0;N<s[3];N++){const z=k+N;o[z]+=o[z-a]}}}}a*=s[d]}return o}function fR(o){for(let s=0,a=o.length;s<a;s++)o[s]=o[s]>>>1^-(1&o[s]);return o}function $E(o,s){switch(s){case"uint32":return o;case"uint16":for(let a=0;a<o.length;a+=2){const d=o[a],h=o[a+1];o[a]=(240&d)>>4|(61440&d)>>8|(240&h)<<4|61440&h,o[a+1]=15&d|(3840&d)>>4|(15&h)<<8|(3840&h)<<4}return o;case"uint8":for(let a=0;a<o.length;a+=4){const d=o[a],h=o[a+1],m=o[a+2],_=o[a+3];o[a+0]=(192&d)>>6|(192&h)>>4|(192&m)>>2|192&_,o[a+1]=(48&d)>>4|(48&h)>>2|48&m|(48&_)<<2,o[a+2]=(12&d)>>2|12&h|(12&m)<<2|(12&_)<<4,o[a+3]=3&d|(3&h)<<2|(3&m)<<4|(3&_)<<6}return o;default:throw new Error(`Invalid pixel format, "${s}"`)}}var Gc=Uint8Array,gh=Uint16Array,yA=Int32Array,Rp=new Gc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wg=new Gc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),HE=new Gc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),b0=function(o,s){for(var a=new gh(31),d=0;d<31;++d)a[d]=s+=1<<o[d-1];var h=new yA(a[30]);for(d=1;d<30;++d)for(var m=a[d];m<a[d+1];++m)h[m]=m-a[d]<<5|d;return{b:a,r:h}},GE=b0(Rp,2),WE=GE.b,pR=GE.r;WE[28]=258,pR[258]=28;for(var mR=b0(wg,0).b,vA=new gh(32768),Zs=0;Zs<32768;++Zs){var w0=(43690&Zs)>>1|(21845&Zs)<<1;vA[Zs]=((65280&(w0=(61680&(w0=(52428&w0)>>2|(13107&w0)<<2))>>4|(3855&w0)<<4))>>8|(255&w0)<<8)>>1}var Xy=function(o,s,a){for(var d=o.length,h=0,m=new gh(s);h<d;++h)o[h]&&++m[o[h]-1];var _,b=new gh(s);for(h=1;h<s;++h)b[h]=b[h-1]+m[h-1]<<1;_=new gh(1<<s);var T=15-s;for(h=0;h<d;++h)if(o[h])for(var S=h<<4|o[h],A=s-o[h],k=b[o[h]-1]++<<A,N=k|(1<<A)-1;k<=N;++k)_[vA[k]>>T]=S;return _},T0=new Gc(288);for(Zs=0;Zs<144;++Zs)T0[Zs]=8;for(Zs=144;Zs<256;++Zs)T0[Zs]=9;for(Zs=256;Zs<280;++Zs)T0[Zs]=7;for(Zs=280;Zs<288;++Zs)T0[Zs]=8;var xA=new Gc(32);for(Zs=0;Zs<32;++Zs)xA[Zs]=5;var ow=Xy(T0,9),gR=Xy(xA,5),aw=function(o){for(var s=o[0],a=1;a<o.length;++a)o[a]>s&&(s=o[a]);return s},td=function(o,s,a){var d=s/8|0;return(o[d]|o[d+1]<<8)>>(7&s)&a},lw=function(o,s){var a=s/8|0;return(o[a]|o[a+1]<<8|o[a+2]<<16)>>(7&s)},_R=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],nd=function(o,s,a){var d=new Error(s||_R[o]);if(d.code=o,Error.captureStackTrace&&Error.captureStackTrace(d,nd),!a)throw d;return d},bA=new Gc(0),qE=typeof TextDecoder<"u"&&new TextDecoder;try{qE.decode(bA,{stream:!0})}catch{}const wA={gzip_data:"gzip"};class El extends Error{constructor(s){super(s),this.name="MRTError"}}const Yy={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ui={uint32:1,uint16:2,uint8:4},yR={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let ZE,XE;class Np{constructor(s=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=s}getLayer(s){const a=this.layers[s];if(!a)throw new El(`Layer '${s}' not found`);return a}getHeaderLength(s){const a=new Uint8Array(s),d=new DataView(s);if(13!==a[0])throw new El("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(s){const a=new Uint8Array(s),d=this.getHeaderLength(s);if(a.length<d)throw new El(`Expected header with length >= ${d} but got buffer of length ${a.length}`);const h=new ZE(a.subarray(0,d)).readFields(iw,{header_length:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new El(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const m of h.layers)this.layers[m.name]=new YE(m,{cacheSize:this._cacheSize});return this}createDecodingTask(s){const a=[],d=this.getLayer(s.layerName);for(let h of s.blockIndices){const m=d.dataIndex[h],_=m.first_byte-s.firstByte,b=m.last_byte-s.firstByte;if(d._blocksInProgress.has(h))continue;const T={layerName:d.name,firstByte:_,lastByte:b,pixelFormat:d.pixelFormat,blockIndex:h,blockShape:[m.bands.length].concat(d.bandShape),buffer:d.buffer,codec:m.codec.codec,filters:m.filters.map(S=>S.filter)};d._blocksInProgress.add(h),a.push(T)}return new TA(a,()=>{a.forEach(h=>d._blocksInProgress.delete(h.blockIndex))},(h,m)=>{if(a.forEach(_=>d._blocksInProgress.delete(_.blockIndex)),h)throw h;m.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class YE{constructor({version:s,name:a,units:d,tilesize:h,pixel_format:m,buffer:_,data_index:b},T){if(this.version=s,1!==this.version)throw new El(`Cannot parse raster layer encoded with MRT version ${s}`);this.name=a,this.units=d,this.tileSize=h,this.buffer=_,this.pixelFormat=Yy[m],this.dataIndex=b,this.bandShape=[h+2*_,h+2*_,ui[this.pixelFormat]],this._decodedBlocks=new Of(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return ui[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:s})=>s).flat()}processDecodedData(s){const a=s.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,s.data)}getBlockForBand(s){let a=0;switch(typeof s){case"string":for(const[d,h]of this.dataIndex.entries()){for(const[m,_]of h.bands.entries())if(_===s)return{bandIndex:a+m,blockIndex:d,blockBandIndex:m};a+=h.bands.length}break;case"number":for(const[d,h]of this.dataIndex.entries()){if(s>=a&&s<a+h.bands.length)return{bandIndex:s,blockIndex:d,blockBandIndex:s-a};a+=h.bands.length}break;default:throw new El(`Invalid band \`${JSON.stringify(s)}\`. Expected string or integer.`)}throw new El(`Band not found: ${JSON.stringify(s)}`)}getDataRange(s){let a=1/0,d=-1/0;const h=[],m=new Set;for(const _ of s){const{blockIndex:b}=this.getBlockForBand(_);if(b<0)throw new El(`Invalid band: ${JSON.stringify(_)}`);const T=this.dataIndex[b];h.includes(b)||h.push(b),m.add(b),a=Math.min(a,T.first_byte),d=Math.max(d,T.last_byte)}if(m.size>this.cacheSize)throw new El(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:d,blockIndices:h}}hasBand(s){const{blockIndex:a}=this.getBlockForBand(s);return a>=0}hasDataForBand(s){const{blockIndex:a}=this.getBlockForBand(s);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(s){const{blockIndex:a,blockBandIndex:d}=this.getBlockForBand(s),h=this._decodedBlocks.get(a.toString());if(!h)throw new El(`Data for band ${JSON.stringify(s)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[a],_=this.bandShape.reduce((S,A)=>S*A,1),b=d*_,T=h.subarray(b,b+_);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:0!==m.offset?m.offset:m.deprecated_offset,scale:0!==m.scale?m.scale:m.deprecated_scale}}}Np.setPbf=function(o){ZE=o};class TA{constructor(s,a,d){this.tasks=s,this._onCancel=a,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(s,a){this._finalized||(this._onComplete(s,a),this._finalized=!0)}}Np.performDecoding=function(o,s){const a=new Uint8Array(o);return Promise.all(s.tasks.map(d=>{const{layerName:h,firstByte:m,lastByte:_,pixelFormat:b,blockShape:T,blockIndex:S,filters:A,codec:k}=d,N=a.subarray(m,_+1),z=new Uint32Array(T[0]*T[1]*T[2]);let H;if("gzip_data"!==k)throw new El(`Unhandled codec: ${k}`);return H=function(q,X){if(!globalThis.DecompressionStream&&"gzip_data"===X)return Promise.resolve(((fe=function(De){31==De[0]&&139==De[1]&&8==De[2]||nd(6,"invalid gzip data");var Be=De[3],Ze=10;4&Be&&(Ze+=2+(De[10]|De[11]<<8));for(var ot=(Be>>3&1)+(Be>>4&1);ot>0;ot-=!De[Ze++]);return Ze+(2&Be)}(ue=q))+8>ue.length&&nd(6,"invalid gzip data"),function(De,Be,Ze,ot){var Ke=De.length;if(!Ke||Be.f&&!Be.l)return Ze||new Gc(0);var _t=!Ze,Ft=_t||2!=Be.i,yt=Be.i;_t&&(Ze=new Gc(3*Ke));var Wt,mt,Tt=function(Nf){var k0=Ze.length;if(Nf>k0){var Ew=new Gc(Math.max(2*k0,Nf));Ew.set(Ze),Ze=Ew}},Kt=Be.f||0,bt=Be.p||0,Zt=Be.b||0,Xt=Be.l,Ut=Be.d,Rn=Be.m,Mn=Be.n,hn=8*Ke;do{if(!Xt){Kt=td(De,bt,1);var tn=td(De,bt+1,3);if(bt+=3,!tn){var Yn=De[(ar=4+((bt+7)/8|0))-4]|De[ar-3]<<8,kn=ar+Yn;if(kn>Ke){yt&&nd(0);break}Ft&&Tt(Zt+Yn),Ze.set(De.subarray(ar,kn),Zt),Be.b=Zt+=Yn,Be.p=bt=8*kn,Be.f=Kt;continue}if(1==tn)Xt=ow,Ut=gR,Rn=9,Mn=5;else if(2==tn){var xn=td(De,bt,31)+257,or=td(De,bt+10,15)+4,ur=xn+td(De,bt+5,31)+1;bt+=14;for(var dr=new Gc(ur),vr=new Gc(19),zr=0;zr<or;++zr)vr[HE[zr]]=td(De,bt+3*zr,7);bt+=3*or;var Ir=aw(vr),Ti=(1<<Ir)-1,Pi=Xy(vr,Ir);for(zr=0;zr<ur;){var ar,ri=Pi[td(De,bt,Ti)];if(bt+=15&ri,(ar=ri>>4)<16)dr[zr++]=ar;else{var hi=0,Zi=0;for(16==ar?(Zi=3+td(De,bt,3),bt+=2,hi=dr[zr-1]):17==ar?(Zi=3+td(De,bt,7),bt+=3):18==ar&&(Zi=11+td(De,bt,127),bt+=7);Zi--;)dr[zr++]=hi}}var ks=dr.subarray(0,xn),Xs=dr.subarray(xn);Rn=aw(ks),Mn=aw(Xs),Xt=Xy(ks,Rn),Ut=Xy(Xs,Mn)}else nd(1);if(bt>hn){yt&&nd(0);break}}Ft&&Tt(Zt+131072);for(var Ss=(1<<Rn)-1,ls=(1<<Mn)-1,mo=bt;;mo=bt){var Ys=(hi=Xt[lw(De,bt)&Ss])>>4;if((bt+=15&hi)>hn){yt&&nd(0);break}if(hi||nd(2),Ys<256)Ze[Zt++]=Ys;else{if(256==Ys){mo=bt,Xt=null;break}var Ko=Ys-254;Ys>264&&(Ko=td(De,bt,(1<<(wu=Rp[zr=Ys-257]))-1)+WE[zr],bt+=wu);var ji=Ut[lw(De,bt)&ls],Yl=ji>>4;if(ji||nd(3),bt+=15&ji,Xs=mR[Yl],Yl>3){var wu=wg[Yl];Xs+=lw(De,bt)&(1<<wu)-1,bt+=wu}if(bt>hn){yt&&nd(0);break}Ft&&Tt(Zt+131072);var Tu=Zt+Ko;if(Zt<Xs){var yc=0-Xs,jp=Math.min(Xs,Tu);for(yc+Zt<0&&nd(3);Zt<jp;++Zt)Ze[Zt]=(void 0)[yc+Zt]}for(;Zt<Tu;++Zt)Ze[Zt]=Ze[Zt-Xs]}}Be.l=Xt,Be.p=mo,Be.b=Zt,Be.f=Kt,Xt&&(Kt=1,Be.m=Rn,Be.d=Ut,Be.n=Mn)}while(!Kt);return Zt!=Ze.length&&_t?(Wt=Ze,(null==(mt=Zt)||mt>Wt.length)&&(mt=Wt.length),new Gc(Wt.subarray(0,mt))):Ze.subarray(0,Zt)}(ue.subarray(fe,-8),{i:2},new Gc(((ee=ue)[(de=ee.length)-4]|ee[de-3]<<8|ee[de-2]<<16|ee[de-1]<<24)>>>0))));var ee,de,ue,fe;const be=wA[X];if(!be)throw new Error(`Unhandled codec: ${X}`);const Te=new globalThis.DecompressionStream(be);return new Response(new Blob([q]).stream().pipeThrough(Te)).arrayBuffer().then(De=>new Uint8Array(De))}(N,k).then(q=>(new ZE(q).readFields(sw,z),new yR[b](z.buffer))),H.then(q=>{for(let X=A.length-1;X>=0;X--)switch(A[X]){case"delta_filter":hR(q,T);break;case"zigzag_filter":fR(q);break;case"bitshuffle_filter":$E(q,b);break;default:throw new El(`Unhandled filter "${A[X]}"`)}return{layerName:h,blockIndex:S,data:q}}).catch(q=>{throw q})}))},Np.setPbf(Iy);class vR extends Zy{constructor(s,a,d,h,m){super(s,a,d,h,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(s,a){const d=a.context,h=d.gl;this.texture=this.texture||a.getTileTexture(s.width),this.texture&&this.texture instanceof vu?this.texture.update(s,{useMipmap:!1,premultiply:!1}):this.texture=new vu(d,s,h.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(s=16384,a){const d=this._mrt=new Np(30),h=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=Bd(h,(m,_,b,T)=>{if(m)a(m);else try{const S=d.getHeaderLength(_);if(S>s)return void(this.request=this.fetchHeader(S,a));d.parseHeader(_),this._isHeaderLoaded=!0;let A=0;for(const k of Object.values(d.layers))A=Math.max(A,k.dataIndex[k.dataIndex.length-1].last_byte);_.byteLength>=A&&(this.entireBuffer=_),a(null,this.entireBuffer||_,b,T)}catch(S){a(S)}}),this.request}fetchBand(s,a,d){const h=this._mrt;if(!this._isHeaderLoaded||!h)return void d(new Error("Tile header is not ready"));const m=this.actor;if(!m)return void d(new Error("Can't fetch tile band without an actor"));let _;const b=(k,N)=>{_.complete(k,N),k?d(k):(this.updateTextureDescriptor(s,a),d(null,this.textureDescriptor&&this.textureDescriptor.img))},T=(k,N)=>{if(k)return d(k);const z=m.send("decodeRasterArray",{buffer:N,task:_},b,void 0,!0);this._workQueue.push(()=>{z&&z.cancel(),_.cancel()})},S=h.getLayer(s);if(!S)return void d(new Error(`Unknown sourceLayer "${s}"`));if(S.hasDataForBand(a))return this.updateTextureDescriptor(s,a),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const A=S.getDataRange([a]);if(_=h.createDecodingTask(A),!_||_.tasks.length)if(this.flushQueues(),this.entireBuffer)T(null,this.entireBuffer.slice(A.firstByte,A.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${A.firstByte}-${A.lastByte}`}}),N=Bd(k,T);this._fetchQueue.push(()=>{N.cancel(),_.cancel()})}else d(null)}updateNeeded(s,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==s)&&"errored"!==this.state}updateTextureDescriptor(s,a){if(!this._mrt)return;const d=this._mrt.getLayer(s);if(!d||!d.hasBand(a)||!d.hasDataForBand(a))return;const{bytes:h,tileSize:m,buffer:_,offset:b,scale:T}=d.getBandView(a),S=m+2*_,A={data:h,width:S,height:S},k=this.texture;k&&k instanceof vu&&k.update(A,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:s,band:a,img:A,buffer:_,offset:b,tileSize:m,format:d.pixelFormat,mix:[T,256*T,65536*T,16777216*T]}}}class b5{constructor(s,a){this.max=s,this.onRemove=a,this.reset()}reset(){for(const s in this.data)for(const a of this.data[s])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(s,a,d){const h=s.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:a,timeout:void 0};if(void 0!==d&&(m.timeout=setTimeout(()=>{this.remove(s,m)},d)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const a=this.data[s].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),a.value}getByKey(s){const a=this.data[s];return a?a[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,a){if(!this.has(s))return this;const d=s.wrapped().key,h=void 0===a?0:this.data[d].indexOf(a),m=this.data[d][h];return this.data[d].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(m.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(s){const a=[];for(const d in this.data)for(const h of this.data[d])s(h.value)||a.push(h);for(const d of a)this.remove(d.value.tileID,d)}}class Tg extends br{constructor(s,a,d){super(),this.id=s,this._onlySymbols=d,a.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new b5(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new g5,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(s){this.map=s,this._minTileCacheSize=void 0===this._minTileCacheSize&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const a=this._tiles[s];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,a){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,a)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(s),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Ex(this._tiles).map(s=>s.tileID).sort(EA).map(s=>s.key)}getRenderableIds(s,a){const d=[];for(const h in this._tiles)this._isIdRenderable(+h,s,a)&&d.push(this._tiles[h]);return s?d.sort((h,m)=>{const _=h.tileID,b=m.tileID,T=new rn(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),S=new rn(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-b.overscaledZ||S.y-T.y||S.x-T.x}).map(h=>h.tileID.key):d.map(h=>h.tileID).sort(EA).map(h=>h.key)}hasRenderableParent(s){const a=this.findLoadedParent(s,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(s,a,d){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(a||!this._tiles[s].holdingForFade())&&(d||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)"errored"!==this._tiles[s].state&&this._reloadTile(+s,"reloading")}}_reloadTile(s,a){const d=this._tiles[s];d&&("loading"!==d.state&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,s,a)))}_tileLoaded(s,a,d,h){if(h)if(s.state="errored",404!==h.status)this._source.fire(new Lm(h,{tile:s}));else{if(this._source.fire(new Gu("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=Oa.now(),"expired"===d&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(a,s),"raster-dem"===this._source.type&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new Gu("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const a=this.getRenderableIds();for(let h=0;h<a.length;h++){const m=a[h];if(s.neighboringTiles&&s.neighboringTiles[m]){const _=this.getTileByID(m);d(s,_),d(_,s)}}function d(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-h.tileID.canonical.x;const b=m.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),S=m.tileID.key;0===_&&0===b||Math.abs(b)>1||(Math.abs(_)>1&&(1===Math.abs(_+T)?_+=T:1===Math.abs(_-T)&&(_-=T)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,_,b),h.neighboringTiles&&h.neighboringTiles[S]&&(h.neighboringTiles[S].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,a,d,h){for(const m in this._tiles){let _=this._tiles[m];if(h[m]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>d)continue;let b=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const S=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[S.key],_&&_.hasData()&&(b=S)}let T=b;for(;T.overscaledZ>a;)if(T=T.scaledTo(T.overscaledZ-1),s[T.key]){h[b.key]=b;break}}}findLoadedParent(s,a){if(s.key in this._loadedParentTiles){const d=this._loadedParentTiles[s.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=s.overscaledZ-1;d>=a;d--){const h=s.scaledTo(d),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(s){const a=this._tiles[s.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,a){a=a||this._source.tileSize;const d=Math.ceil(s.width/a)+1,h=Math.ceil(s.height/a)+1,m=Math.floor(d*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(b)}handleWrapJump(s){const a=Math.round((s-(void 0===this._prevLng?s:this._prevLng))/360);if(this._prevLng=s,a){const d={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),d[m.tileID.key]=m}this._tiles=d;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(s,a,d,h){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(s,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const m="batched-model"===this._source.type;let _;if(this.used||this.usedForTerrain){if(this._source.tileID)_=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new po(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y));else if(0!==this.tileCoverLift){const S=s.clone();S.tileCoverLift=this.tileCoverLift,_=S.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:m}),this._source.minzoom<=1&&"globe"===s.projection.name&&(_.push(new po(1,0,1,0,0)),_.push(new po(1,0,1,1,0)),_.push(new po(1,0,1,0,1)),_.push(new po(1,0,1,1,1)))}else if(_=s.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:m}),this._source.hasTile){const S=this._source.hasTile.bind(this._source);_=_.filter(A=>S(A))}}else _=[];if(_.length>0&&this.castsShadows&&h&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!CA(this._source.type)){const S=s.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),A=Math.min(S,this._source.maxzoom);if(m){const k=s.extendTileCover(_,A);for(const N of k)_.push(N)}else{const k=s.extendTileCover(_,A,h);for(const N of k)this._shadowCasterTiles[N.key]=!0,_.push(N)}}const b=this._updateRetainedTiles(_);if(CA(this._source.type)&&0!==_.length){const S={},A={},k=Object.keys(b);for(const z of k){const H=b[z],q=this._tiles[z];if(!q||q.fadeEndTime&&q.fadeEndTime<=Oa.now())continue;const X=this.findLoadedParent(H,Math.max(H.overscaledZ-Tg.maxOverzooming,this._source.minzoom));X&&(this._addTile(X.tileID),S[X.tileID.key]=X.tileID),A[z]=H}const N=_[_.length-1].overscaledZ;for(const z in this._tiles){const H=this._tiles[z];if(b[z]||!H.hasData())continue;let q=H.tileID;for(;q.overscaledZ>N;){q=q.scaledTo(q.overscaledZ-1);const X=this._tiles[q.key];if(X&&X.hasData()&&A[q.key]){b[z]=H.tileID;break}}}for(const z in S)b[z]||(this._coveredTiles[z]=!0,b[z]=S[z])}for(const S in b)this._tiles[S].clearFadeHold();const T=function(S,A){const k=[];for(const N in S)N in A||k.push(N);return k}(this._tiles,b);for(const S of T){const A=this._tiles[S];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const a={};if(0===s.length)return a;const d={},h=s.reduce((S,A)=>Math.min(S,A.overscaledZ),1/0),m=s[0].overscaledZ,_=Math.max(m-Tg.maxOverzooming,this._source.minzoom),b=Math.max(m+Tg.maxUnderzooming,this._source.minzoom),T={};for(const S of s){const A=this._addTile(S);a[S.key]=S,A.hasData()||h<this._source.maxzoom&&(T[S.key]=S)}this._retainLoadedChildren(T,h,b,a);for(const S of s){let A=this._tiles[S.key];if(A.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const N=S.children(this._source.maxzoom)[0],z=this.getTile(N);if(z&&z.hasData()){a[N.key]=N;continue}}else{const N=S.children(this._source.maxzoom);if(a[N[0].key]&&a[N[1].key]&&a[N[2].key]&&a[N[3].key])continue}let k=A.wasRequested();for(let N=S.overscaledZ-1;N>=_;--N){const z=S.scaledTo(N);if(d[z.key]||(d[z.key]=!0,A=this.getTile(z),!A&&k&&(A=this._addTile(z)),A&&(a[z.key]=z,k=A.wasRequested(),A.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const a=[];let d,h=this._tiles[s].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){d=this._loadedParentTiles[h.key];break}a.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(d=this._getLoadedTile(m),d)break;h=m}for(const m of a)this._loadedParentTiles[m]=d}}_addTile(s){let a=this._tiles[s.key];if(a)return!0!==a.isExtraShadowCaster||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),a;a=this._cache.getAndRemove(s),a&&(this._setTileReloadTimer(s.key,a),a.tileID=s,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,a)));const d=!!a;if(!d){const h=this.map?this.map.painter:null,m=this._source.tileSize*s.overscaleFactor();a="raster-array"===this._source.type?new vR(s,m,this.transform.tileZoom,h,this._isRaster):new Zy(s,m,this.transform.tileZoom,h,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,s.key,a.state))}return a?(a.uses++,this._tiles[s.key]=a,d||this._source.fire(new Gu("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(s,a){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const d=a.getExpiryTimeout();d&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},d))}_removeTile(s){const a=this._tiles[s];a&&(a.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),a.uses>0||(a.hasData()&&"reloading"!==a.state||"empty"===a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,a,d){const h=[],m=this.transform;if(!m)return h;const _="globe"===m.projection.name,b=mu(m.center.lng);for(const T in this._tiles){const S=this._tiles[T];if(d&&S.clearQueryDebugViz(),S.holdingForFade())continue;let A;if(_){const k=S.tileID.canonical;if(0===k.z){const N=[Math.abs(Dr(b,...Ky(k,-1))-b),Math.abs(Dr(b,...Ky(k,1))-b)];A=[0,2*N.indexOf(Math.min(...N))-1]}else{const N=[Math.abs(Dr(b,...Ky(k,-1))-b),Math.abs(Dr(b,...Ky(k,0))-b),Math.abs(Dr(b,...Ky(k,1))-b)];A=[N.indexOf(Math.min(...N))-1]}}else A=[0];for(const k of A){const N=s.containsTile(S,m,a,k);N&&h.push(N)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,a){const d=this.getRenderableIds(s,a).map(m=>this._tiles[m].tileID),h="globe"===this.transform.projection.name;for(const m of d)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=h?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return d}sortCoordinatesByDistance(s){const a=s.slice(),d=this.transform._camera.position,h=this.transform._camera.forward(),m={};for(const _ of a){const b=1/(1<<_.canonical.z);m[_.key]=((_.canonical.x+.5)*b+_.wrap-d[0])*h[0]+((_.canonical.y+.5)*b-d[1])*h[1]-d[2]*h[2]}return a.sort((_,b)=>m[_.key]-m[b.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(CA(this._source.type))for(const s in this._tiles){const a=this._tiles[s];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=Oa.now())return!0}return!1}setFeatureState(s,a,d){this._state.updateState(s=s||"_geojsonTileLayer",a,d)}removeFeatureState(s,a,d){this._state.removeFeatureState(s=s||"_geojsonTileLayer",a,d)}getFeatureState(s,a){return this._state.getState(s=s||"_geojsonTileLayer",a)}setDependencies(s,a,d){const h=this._tiles[s];h&&h.setDependencies(a,d)}reloadTilesForDependencies(s,a){for(const d in this._tiles)this._tiles[d].hasDependency(s,a)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(s,a))}_preloadTiles(s,a){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(s,a))};return void this._source.on("data",b)}const d=new Map,h=Array.isArray(s)?s:[s],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const b of h){const T=b.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of T)d.set(S.key,S);this.usedForTerrain&&b.updateElevation(!1)}ef(Array.from(d.values()),(b,T)=>{const S=new Zy(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,A=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),T(A,S)})},a)}}function EA(o,s){const a=Math.abs(2*o.wrap)-+(o.wrap<0),d=Math.abs(2*s.wrap)-+(s.wrap<0);return o.overscaledZ-s.overscaledZ||d-a||s.canonical.y-o.canonical.y||s.canonical.x-o.canonical.x}function CA(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function Ky(o,s){const a=1<<o.z;return[o.x/a+s,(o.x+1)/a+s]}Tg.maxOverzooming=10,Tg.maxUnderzooming=3;const xR=()=>XE||(XE={layout:gE||(gE=new Vi({"line-cap":new Tn(nt.layout_line["line-cap"]),"line-join":new Tn(nt.layout_line["line-join"]),"line-miter-limit":new Gt(nt.layout_line["line-miter-limit"]),"line-round-limit":new Gt(nt.layout_line["line-round-limit"]),"line-sort-key":new Tn(nt.layout_line["line-sort-key"]),"line-z-offset":new Tn(nt.layout_line["line-z-offset"]),visibility:new Gt(nt.layout_line.visibility)})),paint:_E||(_E=new Vi({"line-opacity":new Tn(nt.paint_line["line-opacity"]),"line-color":new Tn(nt.paint_line["line-color"]),"line-translate":new Gt(nt.paint_line["line-translate"]),"line-translate-anchor":new Gt(nt.paint_line["line-translate-anchor"]),"line-width":new Tn(nt.paint_line["line-width"]),"line-gap-width":new Tn(nt.paint_line["line-gap-width"]),"line-offset":new Tn(nt.paint_line["line-offset"]),"line-blur":new Tn(nt.paint_line["line-blur"]),"line-dasharray":new Tn(nt.paint_line["line-dasharray"]),"line-pattern":new Tn(nt.paint_line["line-pattern"]),"line-gradient":new il(nt.paint_line["line-gradient"]),"line-trim-offset":new Gt(nt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Gt(nt.paint_line["line-trim-fade-range"]),"line-trim-color":new Gt(nt.paint_line["line-trim-color"]),"line-emissive-strength":new Gt(nt.paint_line["line-emissive-strength"]),"line-border-width":new Tn(nt.paint_line["line-border-width"]),"line-border-color":new Tn(nt.paint_line["line-border-color"]),"line-occlusion-opacity":new Gt(nt.paint_line["line-occlusion-opacity"])}))},XE);class bR extends Tn{possiblyEvaluate(s,a){return a=new Qn(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(s,a)}evaluate(s,a,d,h){return a=bo({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(s,a,d,h)}}let Jy,SA,cw,Eg;function uw(o,s){return s>0?s+2*o:o}class Qy{constructor(s){this.type=s.property.overrides?s.property.overrides.runtimeType:Pa,this.defaultValue=s}evaluate(s){if(s.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(s.formattedSection))return a.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fe(Qy,"FormatSectionOverride",{omit:["defaultValue"]});const dw=()=>Eg||(Eg={layout:SA||(SA=new Vi({"symbol-placement":new Gt(nt.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt(nt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt(nt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tn(nt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt(nt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Gt(nt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Gt(nt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Gt(nt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt(nt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt(nt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tn(nt.layout_symbol["icon-size"]),"icon-text-fit":new Tn(nt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tn(nt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tn(nt.layout_symbol["icon-image"]),"icon-rotate":new Tn(nt.layout_symbol["icon-rotate"]),"icon-padding":new Gt(nt.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt(nt.layout_symbol["icon-keep-upright"]),"icon-offset":new Tn(nt.layout_symbol["icon-offset"]),"icon-anchor":new Tn(nt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt(nt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt(nt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt(nt.layout_symbol["text-rotation-alignment"]),"text-field":new Tn(nt.layout_symbol["text-field"]),"text-font":new Tn(nt.layout_symbol["text-font"]),"text-size":new Tn(nt.layout_symbol["text-size"]),"text-max-width":new Tn(nt.layout_symbol["text-max-width"]),"text-line-height":new Tn(nt.layout_symbol["text-line-height"]),"text-letter-spacing":new Tn(nt.layout_symbol["text-letter-spacing"]),"text-justify":new Tn(nt.layout_symbol["text-justify"]),"text-radial-offset":new Tn(nt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt(nt.layout_symbol["text-variable-anchor"]),"text-anchor":new Tn(nt.layout_symbol["text-anchor"]),"text-max-angle":new Gt(nt.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt(nt.layout_symbol["text-writing-mode"]),"text-rotate":new Tn(nt.layout_symbol["text-rotate"]),"text-padding":new Gt(nt.layout_symbol["text-padding"]),"text-keep-upright":new Gt(nt.layout_symbol["text-keep-upright"]),"text-transform":new Tn(nt.layout_symbol["text-transform"]),"text-offset":new Tn(nt.layout_symbol["text-offset"]),"text-allow-overlap":new Gt(nt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Gt(nt.layout_symbol["text-ignore-placement"]),"text-optional":new Gt(nt.layout_symbol["text-optional"]),visibility:new Gt(nt.layout_symbol.visibility)})),paint:cw||(cw=new Vi({"icon-opacity":new Tn(nt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Tn(nt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Tn(nt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Tn(nt.paint_symbol["text-emissive-strength"]),"icon-color":new Tn(nt.paint_symbol["icon-color"]),"icon-halo-color":new Tn(nt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tn(nt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tn(nt.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt(nt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt(nt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tn(nt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Tn(nt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Tn(nt.paint_symbol["text-occlusion-opacity"]),"text-color":new Tn(nt.paint_symbol["text-color"],{runtimeType:vn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Tn(nt.paint_symbol["text-halo-color"]),"text-halo-width":new Tn(nt.paint_symbol["text-halo-width"]),"text-halo-blur":new Tn(nt.paint_symbol["text-halo-blur"]),"text-translate":new Gt(nt.paint_symbol["text-translate"]),"text-translate-anchor":new Gt(nt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Gt(nt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Gt(nt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Gt(nt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Gt(nt.paint_symbol["icon-color-brightness-max"])}))},Eg);class Fp extends sl{constructor(s,a,d,h){super(s,dw(),a,d,h),this._colorAdjustmentMatrix=f.ae.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==s.paint&&("icon-occlusion-opacity"in s.paint||"text-occlusion-opacity"in s.paint)}recalculate(s,a){super.recalculate(s,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const h=[];for(const m of d)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(s,a,d,h){return this._saturation===s&&this._contrast===a&&this._brightnessMin===d&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(m,_,b,T){m=Dx(m),_=Sx(_);const S=f.ae.create(),A=m/3,k=1-2*A,N=[k,A,A,0,A,k,A,0,A,A,k,0,0,0,0,1],z=.5-.5*_,H=T-b;return f.ae.multiply(S,[H,0,0,0,0,H,0,0,0,0,H,0,b,b,b,1],[_,0,0,0,0,_,0,0,0,0,_,0,z,z,z,1]),f.ae.multiply(S,S,N),S}(s,a,d,h),this._saturation=s,this._contrast=a,this._brightnessMin=d,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(s,a,d,h){const m=this.layout.get(s).evaluate(a,{},d,h),_=this._unevaluatedLayout._values[s];return _.isDataDriven()||ae(_.value)||!m?m:(b=a.properties,m.replace(/{([^{}]+)}/g,(S,A)=>A in b?String(b[A]):""));var b}createBucket(s){return new v0(s)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const s of dw().paint.overridableProperties){if(!Fp.hasPaintOverride(this.layout,s))continue;const a=this.paint.get(s),d=new Qy(a),h=new ge(d,a.property.specification,this.scope,this.options);let m=null;m="constant"===a.value.kind||"source"===a.value.kind?new xe("source",h):new ve("composite",h,a.value.zoomStops,a.value._interpolationType),this.paint._values[s]=new qo(a.property,m,a.parameters)}}_handleOverridablePaintPropertyUpdate(s,a,d){return!(!this.layout||a.isDataDriven()||d.isDataDriven())&&Fp.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,a){const d=s.get("text-field"),h=dw().paint.properties[a];let m=!1;const _=b=>{for(const T of b)if(h.overrides&&h.overrides.hasOverride(T))return void(m=!0)};if("constant"===d.value.kind&&d.value.value instanceof Ho)_(d.value.value.sections);else if("source"===d.value.kind){const b=S=>{m||(S instanceof li&&qs(S.value)===Vd?_(S.value.sections):S instanceof cp?_(S.sections):S.eachChild(b))},T=d.value;T._styleExpression&&b(T._styleExpression.expression)}return m}getProgramIds(){const s=0!==this.paint.get("icon-opacity").constantOr(1),a=0!==this.paint.get("text-opacity").constantOr(1),d=[];return s&&d.push("symbolIcon"),a&&d.push("symbolSDF"),d}getDefaultProgramParams(s,a,d){return{config:new ag(this,{zoom:a,lut:d}),overrideFog:!1}}}let KE,DA,E0,JE;function ev(o,s,a,d,h,m,_,b){const T=[o,s,1,a,d,1,h,m,1],S=[_,b,1],A=f.bE.adjoint([],T),[k,N,z]=f.$.transformMat3(S,S,A);return f.bE.multiply(T,T,[k,0,0,0,N,0,0,0,z])}function QE(o,s,a,d,h,m,_,b){const T=function(S,A,k,N,z,H,q,X){const ee=ev(0,0,1,0,1,1,0,1),de=ev(S,A,k,N,z,H,q,X),ue=f.bE.adjoint([],ee);return f.bE.multiply(de,de,ue)}(o,s,a,d,h,m,_,b);return[T[2]/T[8]/Jt,T[5]/T[8]/Jt]}function tv(o){return[o[0],Math.min(Math.max(o[1],-ys),ys)]}class MA extends br{constructor(s,a,d,h){super(),this.id=s,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=a,this._dirty=!1}load(s,a){if(this._loaded=a||!1,this.fire(new Gu("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return s&&(this.coordinates=s),this._loaded=!0,void this._finishLoading();this._imageRequest=ip(this.map._requestManager.transformRequest(this.url,Ld.Image),(d,h)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new Lm(d)):h&&(this.image=h instanceof HTMLImageElement?Oa.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}setTexture(s){if(!(s.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new FE(this.map.painter.context,s.handle),this.width=s.dimensions[0],this.height=s.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Gu("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(s){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof FE||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(s){if(this.coordinates=s,this._boundsArray=void 0,this._unsupportedCoords=!1,!s.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=s[0][1],d=s[0][1];for(const m of s)m[1]>d&&(d=m[1]),m[1]<a&&(a=m[1]);const h=(d+a)/2;if(h>ys?this.onNorthPole=!0:h<-ys&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=s.map(Is.fromLngLat);this.tileID=function(_){let b=1/0,T=1/0,S=-1/0,A=-1/0;for(const q of _)b=Math.min(b,q.x),T=Math.min(T,q.y),S=Math.max(S,q.x),A=Math.max(A,q.y);const k=Math.max(S-b,A-T),N=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),z=Math.pow(2,N);let H=Math.floor((b+S)/2*z);return H>1&&(H-=1),new Tf(N,H,Math.floor((T+A)/2*z))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Gu("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(s){for(const X in this.tiles){const ee=this.tiles[X];"loaded"!==ee.state&&(ee.state="loaded",ee.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=kp(new Tf(0,0,0),this.map.transform.projection),d=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(X){const ee=X[1].x-X[0].x,de=X[1].y-X[0].y,ue=X[2].x-X[1].x,fe=X[2].y-X[1].y,be=X[3].x-X[2].x,Te=X[3].y-X[2].y,De=X[0].x-X[3].x,Be=X[0].y-X[3].y,Ze=ee*fe-ue*de,ot=ue*Te-be*fe,Ke=be*Be-De*Te,_t=De*de-ee*Be;return Ze>0&&ot>0&&Ke>0&&_t>0||Ze<0&&ot<0&&Ke<0&&_t<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=kp(this.tileID,this.map.transform.projection),[m,_,b,T]=this.coordinates.map(X=>{const ee=h.projection.project(X[0],X[1]);return kE(h,ee)._round()});this.perspectiveTransform=QE(m.x,m.y,_.x,_.y,b.x,b.y,T.x,T.y);const S=this._boundsArray=new ho;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(_.x,_.y,Jt,0),S.emplaceBack(T.x,T.y,0,Jt),S.emplaceBack(b.x,b.y,Jt,Jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=s.createVertexBuffer(S,rw.members),this.boundsSegments=_s.simpleSegment(0,0,4,2);const A=[],k=[tv((X=this.coordinates)[0]),tv(X[1]),tv(X[2]),tv(X[3])],[N,z,H,q]=function(X){let ee=X[0][0],de=ee,ue=X[0][1],fe=ue;for(let be=1;be<X.length;be++)X[be][0]<ee?ee=X[be][0]:X[be][0]>de&&(de=X[be][0]),X[be][1]<ue?ue=X[be][1]:X[be][1]>fe&&(fe=X[be][1]);return[ee,ue,de-ee,fe-ue]}(k);var X;{const X=new ho,[ee,de,ue,fe]=function(mt){let Tt=mt[0].x,Kt=Tt,bt=mt[0].y,Zt=bt;for(let Xt=1;Xt<mt.length;Xt++)mt[Xt].x<Tt?Tt=mt[Xt].x:mt[Xt].x>Kt&&(Kt=mt[Xt].x),mt[Xt].y<bt?bt=mt[Xt].y:mt[Xt].y>Zt&&(Zt=mt[Xt].y);return[Tt,bt,Kt-Tt,Zt-bt]}(d),be=mt=>[(mt.x-ee)/ue,(mt.y-de)/fe],[Te,De,Be,Ze]=d.map(be),ot=function(mt,Tt,Kt,bt,Zt,Xt,Ut,Rn){const Mn=ev(0,0,1,0,1,1,0,1),hn=ev(mt,Tt,Kt,bt,Zt,Xt,Ut,Rn),tn=f.bE.adjoint([],hn);return f.bE.multiply(Mn,Mn,tn)}(Te[0],Te[1],De[0],De[1],Be[0],Be[1],Ze[0],Ze[1]);this.elevatedGlobePerspectiveTransform=QE(Te[0],Te[1],De[0],De[1],Be[0],Be[1],Ze[0],Ze[1]);const Ke=(mt,Tt)=>{A.push(mt.lng);const Kt=Math.round((mt.lng-N)/H*Jt),bt=Math.round((mt.lat-z)/q*Jt),Zt=be(Tt),Xt=f.$.transformMat3([],[Zt[0],Zt[1],1],ot),Ut=Math.round(Xt[0]/Xt[2]*Jt),Rn=Math.round(Xt[1]/Xt[2]*Jt);X.emplaceBack(Kt,bt,Ut,Rn)},_t=d[3].x-d[0].x,Ft=d[3].y-d[0].y,yt=d[2].x-d[1].x,Wt=d[2].y-d[1].y;for(let mt=0;mt<65;mt++){const Tt=mt/64,Kt=[d[0].x+Tt*_t,d[0].y+Tt*Ft],bt=[d[1].x+Tt*yt,d[1].y+Tt*Wt],Zt=bt[0]-Kt[0],Xt=bt[1]-Kt[1];for(let Ut=0;Ut<65;Ut++){const Rn=Ut/64,Mn={x:Kt[0]+Zt*Rn,y:Kt[1]+Xt*Rn,z:0};Ke(a.projection.unproject(Mn.x,Mn.y),Mn)}}this.elevatedGlobeVertexBuffer=s.createVertexBuffer(X,rw.members)}{this.maxLongitudeTriangleSize=0;let X=[],ee=new fo;const de=(ue,fe,be)=>{ee.emplaceBack(ue,fe,be);const Te=A[ue],De=A[fe],Be=A[be],Ze=Math.min(Math.min(Te,De),Be),ot=Math.max(Math.max(Te,De),Be)-Ze;ot>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ot),X.push(Ze+ot/2)};for(let ue=0;ue<64;ue++)for(let fe=0;fe<64;fe++){const be=65*ue+fe,Te=be+1,De=be+65,Be=De+1;de(be,De,Te),de(Te,De,Be)}[X,ee]=function(ue,fe){const be=Array.from({length:ue.length},(Be,Ze)=>Ze);be.sort((Be,Ze)=>ue[Be]-ue[Ze]);const Te=[],De=new fo;for(let Be=0;Be<be.length;Be++){const Ze=be[Be];Te.push(ue[Ze]);const ot=3*Ze,Ke=ot+1;De.emplaceBack(fe.uint16[ot],fe.uint16[Ke],fe.uint16[Ke+1])}return[Te,De]}(X,ee),this.elevatedGlobeTrianglesCenterLongitudes=X,this.elevatedGlobeIndexBuffer=s.createIndexBuffer(ee)}this.elevatedGlobeSegments=_s.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,H/Jt,0,q/Jt,0,0,z,N,0])}prepare(){const s=0!==Object.keys(this.tiles).length;if(this.tileID&&!s)return;const a=this.map.painter.context,d=a.gl;!this._dirty||this.texture instanceof FE||(this.texture?this.texture.update(this.image):(this.texture=new vu(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),s&&this._prepareData(a)}loadTile(s,a){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},a(null)):(s.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(s){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let h=(m=s+180)+360*Math.round((d[0]-m)/360);var m;const _=new _s,b=(k,N)=>{_.segments.push({vertexOffset:0,primitiveOffset:k,vertexLength:a.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-h)<=T){const k=l_(d,0,d.length,h+T);return k===d.length||b(k,a_(d,k+1,d.length,h+360-T)-k),_}h<d[0]&&(h+=360);const S=a_(d,0,d.length,h-T);if(S===d.length)return b(0,d.length),_;b(0,S-0);const A=l_(d,S+1,d.length,h+T);return A!==d.length&&b(A,d.length-A),_}}const wR=(Math.pow(256,2)-1)/16907520;class AA extends sl{constructor(s,a,d,h){super(s,{layout:E0||(E0=new Vi({visibility:new Gt(nt.layout_raster.visibility)})),paint:JE||(JE=new Vi({"raster-opacity":new Gt(nt.paint_raster["raster-opacity"]),"raster-color":new il(nt.paint_raster["raster-color"]),"raster-color-mix":new Gt(nt.paint_raster["raster-color-mix"]),"raster-color-range":new Gt(nt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Gt(nt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt(nt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt(nt.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt(nt.paint_raster["raster-saturation"]),"raster-contrast":new Gt(nt.paint_raster["raster-contrast"]),"raster-resampling":new Gt(nt.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt(nt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Gt(nt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Gt(nt.paint_raster["raster-array-band"]),"raster-elevation":new Gt(nt.paint_raster["raster-elevation"])}))},a,d,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(s){return!(s&&s._source instanceof MA&&(s._source.onNorthPole||s._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(s){"raster-color"!==s&&"raster-color-range"!==s||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(s){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[d,h]=s||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(h)||d===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=xb({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,h])}}let C0,IA,kA,OA,nv;class eC extends sl{constructor(s,a,d,h){super(s,{layout:C0||(C0=new Vi({visibility:new Gt(nt["layout_raster-particle"].visibility)})),paint:IA||(IA=new Vi({"raster-particle-array-band":new Gt(nt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Gt(nt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new il(nt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Gt(nt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Gt(nt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Gt(nt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Gt(nt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Gt(nt["paint_raster-particle"]["raster-particle-elevation"])}))},a,d,h),this._updateColorRamp(),this.lastInvalidatedAt=Oa.now()}onRemove(s){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(s){return!1}_handleSpecialPaintPropertyUpdate(s){"raster-particle-color"!==s&&"raster-particle-max-speed"!==s||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===s&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const s=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=xb({expression:s,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Oa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class PA extends sl{constructor(s,a){super(s,{},a,null),this.implementation=s,s.slot&&(this.slot=s.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(s){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)}onRemove(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)}}function hw(o,s,a){const d=[0,0,1],h=f.aw.identity([]);return f.aw.rotateY(h,h,a?-kr(o)+Math.PI:kr(o)),f.aw.rotateX(h,h,-kr(s)),f.$.transformQuat(d,d,h),f.$.normalize(d,d)}function RA(o,s){const a=S0(o.projection,o.zoom,o.width,o.height),d=function(m,_,b,T,S){const A=new Yr(b.lng-180*rd,b.lat),k=new Yr(b.lng+180*rd,b.lat),N=m.project(A.lng,A.lat),z=m.project(k.lng,k.lat),H=-Math.atan2(z.y-N.y,z.x-N.x),q=Is.fromLngLat(b);q.y=Dr(q.y,-1+rd,1-rd);const X=q.toLngLat(),ee=m.project(X.lng,X.lat),de=Is.fromLngLat(X);de.x+=rd;const ue=de.toLngLat(),fe=m.project(ue.lng,ue.lat),be=FA(fe.x-ee.x,fe.y-ee.y,H),Te=Is.fromLngLat(X);Te.y+=rd;const De=Te.toLngLat(),Be=m.project(De.lng,De.lat),Ze=FA(Be.x-ee.x,Be.y-ee.y,H),ot=Math.abs(be.x)/Math.abs(Ze.y),Ke=f.ae.identity([]);f.ae.rotateZ(Ke,Ke,-H*(1-(S?0:T)));const _t=f.ae.identity([]);return f.ae.scale(_t,_t,[1,1-(1-ot)*T,1]),_t[4]=-Ze.x/Ze.y*T,f.ae.rotateZ(_t,_t,H),f.ae.multiply(_t,Ke,_t),_t}(o.projection,0,o.center,a,s),h=tC(o);return f.ae.scale(d,d,[h,h,1]),d}function tC(o){const s=o.projection,a=S0(o.projection,o.zoom,o.width,o.height),d=NA(s,o.center),h=NA(s,Yr.convert(s.center));return Math.pow(2,d*a+(1-a)*h)}function S0(o,s,a,d,h=1/0){const m=o.range;if(!m)return 0;const _=Math.min(h,Math.max(a,d)),b=Math.log(_/1024)/Math.LN2;return tp(m[0]+b,m[1]+b,s)}const rd=1/4e4;function NA(o,s){const a=Dr(s.lat,-ys,ys),d=new Yr(s.lng-180*rd,a),h=new Yr(s.lng+180*rd,a),m=o.project(d.lng,a),_=o.project(h.lng,a),b=Is.fromLngLat(d),T=Is.fromLngLat(h),S=_.x-m.x,A=_.y-m.y,k=T.x-b.x,N=T.y-b.y,z=Math.sqrt((k*k+N*N)/(S*S+A*A));return Math.log(z)/Math.LN2}function FA(o,s,a){const d=Math.cos(a),h=Math.sin(a);return{x:o*d-s*h,y:o*h+s*d}}function LA(o,s,a){f.ae.identity(o),f.ae.rotateZ(o,o,kr(s[2])),f.ae.rotateX(o,o,kr(s[0])),f.ae.rotateY(o,o,kr(s[1])),f.ae.scale(o,o,a),f.ae.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function fw(o,s,a,d,h,m,_,b){const T=[a[0]-s[0],a[1]-s[1],0],S=[d[0]-s[0],d[1]-s[1],0];if(f.$.length(T)<1e-12||f.$.length(S)<1e-12)return f.aw.identity(o);const A=f.$.cross([],T,S);f.$.normalize(A,A),f.$.subtract(S,d,s),T[2]=(m-h)*b,S[2]=(_-h)*b;const k=T;return f.$.cross(k,T,S),f.$.normalize(k,k),f.aw.rotationTo(o,A,k)}function nC(o,s,a=!1){const d=ol(s.zoom),h=function(m,_,b){const T=_.worldSize,S=[m[12],m[13],m[14]],A=Xo(S[1]/T),k=ga(S[0]/T),N=f.ae.identity([]),z=bl(1,A)*T,H=bl(1,0)*T*Tp(A,_.zoom),q=1/Cp(T);let X=H*q;if(b){const fe=S0(_.projection,_.zoom,_.width,_.height,1024);X=q*_.projection.pixelSpaceConversion(_.center.lat,T,fe)}const ee=wf(A,k);f.$.add(ee,ee,f.$.scale([],f.$.normalize([],ee),z*X*S[2]));const de=function(fe){const be=[fe[0],fe[1],fe[2]];let Te=[0,1,0];const De=f.$.cross([],Te,be);return f.$.cross(Te,be,De),0===f.$.squaredLength(Te)&&(Te=[0,1,0],f.$.cross(De,be,Te)),f.$.normalize(De,De),f.$.normalize(Te,Te),f.$.normalize(be,be),[De[0],De[1],De[2],0,Te[0],Te[1],Te[2],0,be[0],be[1],be[2],0,fe[0],fe[1],fe[2],1]}(ee);f.ae.scale(N,N,[X,X,X*z]),f.ae.translate(N,N,[-S[0],-S[1],-S[2]]);const ue=f.ae.multiply([],_.globeMatrix,de);return f.ae.multiply(ue,ue,N),f.ae.multiply(ue,ue,m),ue}(o,s,a);return d>0?function(_,b,T){const S=(H,q,X)=>{const ee=f.$.length(H),de=f.$.length(q),ue=ah(H,q,X);return f.$.scale(ue,ue,1/f.$.length(ue)*dn(ee,de,X))},A=S([_[0],_[1],_[2]],[b[0],b[1],b[2]],T),k=S([_[4],_[5],_[6]],[b[4],b[5],b[6]],T),N=S([_[8],_[9],_[10]],[b[8],b[9],b[10]],T),z=ah([_[12],_[13],_[14]],[b[12],b[13],b[14]],T);return[A[0],A[1],A[2],0,k[0],k[1],k[2],0,N[0],N[1],N[2],0,z[0],z[1],z[2],1]}(h,function(_,b){const T=b.worldSize,S=bl(1,0)*T*Tp(b.center.lat,b.zoom)/Cp(T),A=bl(1,b.center.lat)*T,k=f.ae.identity([]);return f.ae.rotateY(k,k,kr(b.center.lng)),f.ae.rotateX(k,k,kr(b.center.lat)),f.ae.translate(k,k,[0,0,xl]),f.ae.scale(k,k,[S,S,S*A]),f.ae.translate(k,k,[b.point.x-.5*T,b.point.y-.5*T,0]),f.ae.multiply(k,k,_),f.ae.multiply(k,b.globeMatrix,k)}(o,s),d):h}function BA(o,s,a,d){const h=ds.projectAabbCorners(d,a);let m=Number.MAX_VALUE,_=-1;for(let S=0;S<h.length;++S){const A=h[S];A[0]=(.5*A[0]+.5)*s.width,A[1]=(.5-.5*A[1])*s.height,A[2]<m&&(_=S,m=A[2])}const b=S=>new rn(h[S][0],h[S][1]);let T;switch(_){case 0:case 6:T=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:T=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:T=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:T=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(W_(o,T))return m}const rC=oi([{name:"a_pos_3f",components:3,type:"Float32"}]),rv=oi([{name:"a_color_3f",components:3,type:"Float32"}]),zA=oi([{name:"a_color_4f",components:4,type:"Float32"}]),UA=oi([{name:"a_uv_2f",components:2,type:"Float32"}]),TR=oi([{name:"a_normal_3f",components:3,type:"Float32"}]),iv=oi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),pw=oi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class iC{constructor(s,a,d,h){this.message=(s?`${s}: `:"")+d,h&&(this.identifier=h),null!=a&&a.__line__&&(this.line=a.__line__)}}function VA(o,s){const a=-1===o.indexOf("://");try{return new URL(o,a&&s?"http://example.com":void 0),!0}catch{return!1}}class sC{constructor(s,a){this.feature=s,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class mw{constructor(){this.instancedDataArray=new yT,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class oC{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=s.projection,this.index=s.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(s,a){}populate(s,a,d,h){this.tileToMeter=lb(d);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:b,index:T,sourceLayerIndex:S}of s){const A=b??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),k=oh(_,m);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),k,d))continue;const N={id:A,sourceLayerIndex:S,index:T,geometry:m?k.geometry:gu(_,d,h),properties:_.properties,type:_.type,patterns:{}},z=this.addFeature(N,N.geometry,k);z&&a.featureIndex.insert(_,N.geometry,T,S,this.index,this.instancesPerModel[z].instancedDataArray.length,Jt/32)}this.lookup=null}update(s,a,d,h){for(const m in this.instancesPerModel){const _=this.instancesPerModel[m];for(const b in s)_.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(_.features[_.idToFeaturesIndex[b]],s[b],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let s=!1;for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];for(const h of d.features){const m=this.layers[0],_=h.feature,b=this.canonical,T=m.paint.get("model-rotation").evaluate(_,{},b),S=m.paint.get("model-scale").evaluate(_,{},b),A=m.paint.get("model-translation").evaluate(_,{},b);f.$.exactEquals(h.rotation,T)&&f.$.exactEquals(h.scale,S)&&f.$.exactEquals(h.translation,A)||(this.evaluate(h,h.featureStates,d,!0),s=!0)}}return s}updateReplacement(s,a,d,h){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const m=a.getReplacementRegionsForTile(s.toUnwrapped(),!0);if(Ab(this.activeReplacements,m))return!1;this.activeReplacements=m;let _=!1;for(const b in this.instancesPerModel){const T=this.instancesPerModel[b],S=T.instancedDataArray;for(const A of T.features){const k=A.instancedDataOffset,N=A.instancedDataCount;for(let z=0;z<N;z++){const H=16*(z+k);let q=S.float32[H+0];q=q>Jt?q-Jt:q;const X=Math.floor(q),ee=S.float32[H+1];let de=!1;for(const ue of this.activeReplacements)if(!sE(ue,d,Ey.Model,h)&&!(ue.min.x>X||X>ue.max.x||ue.min.y>ee||ee>ue.max.y)&&(de=bM(Ib(X,ee,s.canonical,ue.footprintTileId.canonical),ue),de))break;S.float32[H]=de?q+Jt:q,_=_||de}}}return _}isEmpty(){for(const s in this.instancesPerModel)if(0!==this.instancesPerModel[s].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(s){if(!this.uploaded)for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length<0||0===d.instancedDataArray.length||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=s.createVertexBuffer(d.instancedDataArray,iv.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];0!==d.instancedDataArray.length&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const s=this.layers[0].modelManager;if(s&&this.modelUris)for(const a of this.modelUris)s.removeModel(a,"")}addFeature(s,a,d){const h=this.layers[0],m=h.layout.get("model-id").evaluate(d,{},this.canonical);if(!m)return Ns(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),m;VA(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new mw);const _=this.instancesPerModel[m],b=_.instancedDataArray,T=new sC(d,b.length);for(const S of a)for(const A of S){if(A.x<0||A.x>=Jt||A.y<0||A.y>=Jt)continue;const k=(this.lookupDim-1)/Jt,N=this.lookupDim*(A.y*k|0)+A.x*k|0;if(this.lookup){if(0!==this.lookup[N])continue;this.lookup[N]=1}this.instanceCount++;const z=b.length;b.resize(z+1),_.instancesEvaluatedElevation.push(0),b.float32[16*z]=A.x,b.float32[16*z+1]=A.y}return T.instancedDataCount=_.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(s.id&&(_.idToFeaturesIndex[s.id]=_.features.length),_.features.push(T),this.evaluate(T,{},_,!1)),m}getModelUris(){return this.modelUris}evaluate(s,a,d,h){const m=this.layers[0],_=s.feature,b=this.canonical,T=s.rotation=m.paint.get("model-rotation").evaluate(_,a,b),S=s.scale=m.paint.get("model-scale").evaluate(_,a,b),A=s.translation=m.paint.get("model-translation").evaluate(_,a,b),k=m.paint.get("model-color").evaluate(_,a,b);k.a=m.paint.get("model-color-mix-intensity").evaluate(_,a,b);const N=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),LA(N,T,S);const z=Math.round(100*k.a)+k.b/1.05;for(let H=0;H<s.instancedDataCount;++H){const q=s.instancedDataOffset+H,X=16*q,ee=d.instancedDataArray.float32;let de=0;h&&(de=ee[X+6]-d.instancesEvaluatedElevation[q]);const ue=0|ee[X+1];ee[X]=(0|ee[X])+k.r/1.05,ee[X+1]=ue+k.g/1.05,ee[X+2]=z,ee[X+3]=1/(b.z>10?this.tileToMeter:lb(b,ue)),ee[X+4]=A[0],ee[X+5]=A[1],ee[X+6]=A[2]+de,ee[X+7]=N[0],ee[X+8]=N[1],ee[X+9]=N[2],ee[X+10]=N[4],ee[X+11]=N[5],ee[X+12]=N[6],ee[X+13]=N[8],ee[X+14]=N[9],ee[X+15]=N[10],d.instancesEvaluatedElevation[q]=A[2]}}}let aC,jA;Fe(oC,"ModelBucket",{omit:["layers"]}),Fe(mw,"PerModelAttributes"),Fe(sC,"ModelFeature");const Cg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function lC(o,s,a,d,h,m,_,b,T,S=!1){const A=a.zoom,k=a.project(d),N=Tp(d.lat,A),z=1/N;f.ae.identity(o),f.ae.translate(o,o,[k.x+_[0]*z,k.y+_[1]*z,_[2]]);let H=1,q=1;const X=a.worldSize;if(S){if("mercator"===a.projection.name){let fe=0;a.elevation&&(fe=a.elevation.getAtPointOrZero(new Is(k.x/X,k.y/X),0));const be=f.aB.transformMat4([],[k.x,k.y,fe,1],a.projMatrix)[3]/a.cameraToCenterDistance;H=be,q=be*Tp(a.center.lat,A)}else if("globe"===a.projection.name){const fe=nC(o,a),be=f.ae.multiply([],a.projMatrix,fe),Te=[0,0,0,1];f.aB.transformMat4(Te,Te,be);const De=Te[3]/a.cameraToCenterDistance,Be=ol(A),Ze=a.projection.pixelsPerMeter(d.lat,X)*Tp(d.lat,A),ot=a.projection.pixelsPerMeter(a.center.lat,X)*Tp(a.center.lat,A);H=De/dn(Ze,TP(a.center.lat),Be),q=De*N/Ze,H*=ot,q*=ot}}else H=z;f.ae.scale(o,o,[H,H,q]);const ee=[...o],de=s.orientation,ue=[];if(LA(ue,[de[0]+h[0],de[1]+h[1],de[2]+h[2]],m),f.ae.multiply(o,ee,ue),b&&a.elevation){let fe=0;const be=[];if(T&&a.elevation){fe=function(Be,Ze,ot,Ke,_t){const Ft=Ze.elevation;if(!Ft)return 0;const yt=ds.projectAabbCorners(ot,Ke),Wt=bl(1,_t.lat)*Ze.worldSize,mt=function(Yn,kn){const xn=[0,0,1],or=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ur of or){const dr=Yn[ur.corners[0]],vr=Yn[ur.corners[1]],zr=Yn[ur.corners[2]],Ir=[vr[0]-dr[0],vr[1]-dr[1],kn*(vr[2]-dr[2])],Ti=f.$.cross(Ir,Ir,[zr[0]-dr[0],zr[1]-dr[1],kn*(zr[2]-dr[2])]);f.$.normalize(Ti,Ti),ur.dotProductWithUp=f.$.dot(Ti,xn)}return or.sort((ur,dr)=>ur.dotProductWithUp-dr.dotProductWithUp),or[0].corners}(yt,Wt),Tt=yt[mt[0]],Kt=yt[mt[1]],bt=yt[mt[2]],Zt=yt[mt[3]],Xt=Ft.getAtPointOrZero(new Is(Tt[0]/Ze.worldSize,Tt[1]/Ze.worldSize),0),Ut=Ft.getAtPointOrZero(new Is(Kt[0]/Ze.worldSize,Kt[1]/Ze.worldSize),0),Rn=Ft.getAtPointOrZero(new Is(bt[0]/Ze.worldSize,bt[1]/Ze.worldSize),0),Mn=Ft.getAtPointOrZero(new Is(Zt[0]/Ze.worldSize,Zt[1]/Ze.worldSize),0),hn=(Xt+Mn)/2,tn=(Ut+Rn)/2;return hn>tn?Ut<Rn?fw(Be,Kt,Zt,Tt,Ut,Mn,Xt,Wt):fw(Be,bt,Tt,Zt,Rn,Xt,Mn,Wt):Xt<Mn?fw(Be,Tt,Kt,bt,Xt,Ut,Rn,Wt):fw(Be,Zt,bt,Kt,Mn,Rn,Ut,Wt),Math.max(hn,tn)}(be,a,s.aabb,o,d);const Te=f.ae.fromQuat([],be),De=f.ae.multiply([],Te,ue);f.ae.multiply(o,ee,De)}else fe=a.elevation.getAtPointOrZero(new Is(k.x/X,k.y/X),0);0!==fe&&(o[14]+=fe)}}function Sg(o,s,a=!1){o.uploaded||(o.gfxTexture=new vu(s,o.image,a?s.gl.R8:s.gl.RGBA,{useMipmap:o.sampler.minFilter>=s.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function ER(o,s,a){o.indexBuffer=s.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=s.createVertexBuffer(o.vertexArray,rC.members,!1,!0),o.normalArray&&(o.normalBuffer=s.createVertexBuffer(o.normalArray,TR.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=s.createVertexBuffer(o.texcoordArray,UA.members,!1,!0)),o.colorArray&&(o.colorBuffer=s.createVertexBuffer(o.colorArray,(12===o.colorArray.bytesPerElement?rv:zA).members,!1,!0)),o.featureArray&&(o.pbrBuffer=s.createVertexBuffer(o.featureArray,pw.members,!0)),o.segments=_s.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const d=o.material;d.pbrMetallicRoughness.baseColorTexture&&Sg(d.pbrMetallicRoughness.baseColorTexture,s),d.pbrMetallicRoughness.metallicRoughnessTexture&&Sg(d.pbrMetallicRoughness.metallicRoughnessTexture,s),d.normalTexture&&Sg(d.normalTexture,s),d.occlusionTexture&&Sg(d.occlusionTexture,s,a),d.emissionTexture&&Sg(d.emissionTexture,s)}function cC(o,s,a){if(o.meshes)for(const d of o.meshes)ER(d,s,a);if(o.children)for(const d of o.children)cC(d,s,a)}function gw(o){if(o.meshes)for(const s of o.meshes)s.indexArray.destroy(),s.vertexArray.destroy(),s.colorArray&&s.colorArray.destroy(),s.normalArray&&s.normalArray.destroy(),s.texcoordArray&&s.texcoordArray.destroy(),s.featureArray&&s.featureArray.destroy();if(o.children)for(const s of o.children)gw(s)}function uC(o){if(o.meshes)for(const a of o.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((s=a.material).pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()));var s;if(o.children)for(const a of o.children)uC(a)}class CR{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class SR{constructor(){this.tasks={},this.taskQueue=[],Cm(["process"],this),this.invoker=new CR(this.process),this.nextId=0}add(s,a){const d=this.nextId++,h=function({type:m,isSymbolTile:_,zoom:b}){return b=b||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-b:"maybePrepare"===m&&_?400-b:500:200-b:100-b}(a);if(0===h){try{s()}finally{}return null}return this.tasks[d]={fn:s,metadata:a,priority:h,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const s=this.pick();if(null===s)return;const a=this.tasks[s];if(delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let s=null,a=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<a&&(a=m.priority,s=h)}if(null===s)return null;const d=this.taskQueue[s];return this.taskQueue.splice(s,1),d}remove(){this.invoker.remove()}}class _w{constructor(s,a,d){this.target=s,this.parent=a,this.mapId=d,this.callbacks={},this.cancelCallbacks={},Cm(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new SR}send(s,a,d,h,m=!1,_){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=_,this.callbacks[b]=d);const T=new Set;return this.target.postMessage({id:b,type:s,hasCallback:!!d,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:qe(a,T)},T),{cancel:()=>{d&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const a=s.data,d=a.id;if(d&&(!a.targetMapId||this.mapId===a.targetMapId))if("<cancel>"===a.type){const h=this.cancelCallbacks[d];delete this.cancelCallbacks[d],h&&h.cancel()}else if(a.mustQueue||rp()){const h=this.callbacks[d],m=this.scheduler.add(()=>this.processTask(d,a),h&&h.metadata||{type:"message"});m&&(this.cancelCallbacks[d]=m)}else this.processTask(d,a)}processTask(s,a){if(delete this.cancelCallbacks[s],"<response>"===a.type){const d=this.callbacks[s];delete this.callbacks[s],d&&(a.error?d(at(a.error)):d(null,at(a.data)))}else{const d=new Set,h=a.hasCallback?(_,b)=>{this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:_?qe(_):null,data:qe(b,d)},d)}:_=>{},m=at(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,m,h);else if(this.parent.getWorkerSource){const _=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,_[0],m.source,m.scope)[_[1]](m,h)}else h(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let dC=(()=>{class o{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=t_();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const _=new o.Actor(h[m],d,this.id);_.name=`Worker ${m}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,d,h){ef(this.actors,(m,_)=>{m.send(a,d,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}return o.Actor=_w,o})();var sv={workerUrl:"",workerClass:null,workerParams:void 0};function DR(){return null!=sv.workerClass?new sv.workerClass:new self.Worker(sv.workerUrl,sv.workerParams)}const Pf="mapboxgl_preloaded_worker_pool";class Rf{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Rf.workerCount;)this.workers.push(new DR);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&0===this.numActive()&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pf]}numActive(){return Object.keys(this.active).length}}let Dg;function D0(){return Dg||(Dg=new Rf),Dg}Rf.workerCount=2;let yw,Bp,bu,M0,hC,A0=null;function $A(){return rp()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Bp||cn.DRACO_URL}function HA(){if(rp()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(M0)return M0;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return M0=WebAssembly.validate(o)?cn.MESHOPT_SIMD_URL:cn.MESHOPT_URL,M0}const ov={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},MR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},I0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function av(o,s,a){const d=a.json.bufferViews.length,h=a.buffers.length;s.bufferView=d,a.json.bufferViews[d]={buffer:h,byteLength:o.byteLength},a.buffers[h]=o}const fC="KHR_draco_mesh_compression";function AR(o,s){const a=o.extensions&&o.extensions[fC];if(!a)return;const d=new bu.Decoder,h=kR(s,a.bufferView),m=new bu.Mesh;if(!d.DecodeArrayToMesh(h,h.byteLength,m))throw new Error("Failed to decode Draco mesh");const _=s.json.accessors[o.indices],b=ov[_.componentType],T=_.count*b.BYTES_PER_ELEMENT,S=bu._malloc(T);b===Uint16Array?d.GetTrianglesUInt16Array(m,T,S):d.GetTrianglesUInt32Array(m,T,S),av(bu.memory.buffer.slice(S,S+T),_,s),bu._free(S);for(const A of Object.keys(a.attributes)){const k=d.GetAttributeByUniqueId(m,a.attributes[A]),N=s.json.accessors[o.attributes[A]],z=MR[N.componentType],H=N.count*I0[N.type]*ov[N.componentType].BYTES_PER_ELEMENT,q=bu._malloc(H);d.GetAttributeDataArrayForAllPoints(m,k,bu[z],H,q),av(bu.memory.buffer.slice(q,q+H),N,s),bu._free(q)}d.destroy(),m.destroy(),delete o.extensions[fC]}const lv="EXT_meshopt_compression";function IR(o,s){if(!o.extensions||!o.extensions[lv])return;const a=o.extensions[lv],d=new Uint8Array(s.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),h=new Uint8Array(a.count*a.byteStride);hC.decodeGltfBuffer(h,a.count,a.byteStride,d,a.mode,a.filter),o.buffer=s.buffers.length,o.byteOffset=0,s.buffers[o.buffer]=h.buffer,delete o.extensions[lv]}const GA=1179937895,zp=new TextDecoder("utf8");function Mg(o,s){return new URL(o,s).href}function cv(o,s,a,d){return fetch(Mg(o.uri,d)).then(h=>h.arrayBuffer()).then(h=>{s.buffers[a]=h})}function kR(o,s){const a=o.json.bufferViews[s];return new Uint8Array(o.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function WA(o,s,a,d){if(o.uri){const h=Mg(o.uri,d);return fetch(h).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{s.images[a]=m})}if(void 0!==o.bufferView){const h=kR(s,o.bufferView),m=new Blob([h],{type:o.mimeType});return createImageBitmap(m).then(_=>{s.images[a]=_})}}function qA(o,s=0,a){const d={json:null,images:[],buffers:[]};if(new Uint32Array(o,s,1)[0]===GA){const A=new Uint32Array(o,s);let k=2;const N=(A[k++]>>2)-3,z=A[k++]>>2;if(k++,d.json=JSON.parse(zp.decode(A.subarray(k,k+z))),k+=z,k<N){const H=A[k++];k++;const q=s+(k<<2);d.buffers[0]=o.slice(q,q+H)}}else d.json=JSON.parse(zp.decode(new Uint8Array(o,s)));const{buffers:h,images:m,meshes:_,extensionsUsed:b,bufferViews:T}=d.json;let S=Promise.resolve();if(h){const A=[];for(let k=0;k<h.length;k++){const N=h[k];N.uri?A.push(cv(N,d,k,a)):d.buffers[k]||(d.buffers[k]=null)}S=Promise.all(A)}return S.then(()=>{const A=[],k=b&&b.includes(fC),N=b&&b.includes(lv);if(k&&A.push(function(){if(!bu)return yw||(yw=function(z){let H,q=null;function X(){H=new Uint8Array(q.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const de={a:{a:ee,d:function(ue,fe,be){return H.copyWithin(ue,fe,fe+be)},c:function(ue){const fe=H.length,be=Math.max(ue>>>0,Math.ceil(1.2*fe)),Te=Math.ceil((be-fe)/65536);try{return q.grow(Te),X(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,de):z.then(ue=>ue.arrayBuffer()).then(ue=>WebAssembly.instantiate(ue,de))).then(ue=>{const{Rb:fe,Qb:be,P:Te,T:De,X:Be,Ja:Ze,La:ot,Qa:Ke,Va:_t,Wa:Ft,eb:yt,jb:Wt,f:mt,e:Tt,yb:Kt,zb:bt,Ab:Zt,Bb:Xt,Db:Ut,Gb:Rn}=ue.instance.exports;q=Tt;const Mn=(()=>{let hn=0,tn=0,Yn=0,kn=0;return xn=>{Yn&&(fe(kn),fe(hn),tn+=Yn,Yn=hn=0),hn||(tn+=128,hn=be(tn));const or=xn.length+7&-8;let ur=hn;or>=tn&&(Yn=or,ur=kn=be(or));for(let dr=0;dr<xn.length;dr++)H[ur+dr]=xn[dr];return ur}})();return X(),mt(),{memory:Tt,_free:fe,_malloc:be,Mesh:class{constructor(){this.ptr=Te()}destroy(){De(this.ptr)}},Decoder:class{constructor(){this.ptr=Ze()}destroy(){Wt(this.ptr)}DecodeArrayToMesh(hn,tn,Yn){const kn=Mn(hn),xn=ot(this.ptr,kn,tn,Yn.ptr);return!!Be(xn)}GetAttributeByUniqueId(hn,tn){return{ptr:Ke(this.ptr,hn.ptr,tn)}}GetTrianglesUInt16Array(hn,tn,Yn){_t(this.ptr,hn.ptr,tn,Yn)}GetTrianglesUInt32Array(hn,tn,Yn){Ft(this.ptr,hn.ptr,tn,Yn)}GetAttributeDataArrayForAllPoints(hn,tn,Yn,kn,xn){yt(this.ptr,hn.ptr,tn.ptr,Yn,kn,xn)}},DT_INT8:Kt(),DT_UINT8:bt(),DT_INT16:Zt(),DT_UINT16:Xt(),DT_UINT32:Ut(),DT_FLOAT32:Rn()}})}(fetch($A())),yw.then(z=>{bu=z,yw=void 0}))}()),N&&A.push(function(){if(hC)return;const z=function(H){let q;const X=WebAssembly.instantiateStreaming(H,{}).then(ue=>{q=ue.instance,q.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},de={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:X,supported:!0,decodeGltfBuffer(ue,fe,be,Te,De,Be){!function(Ze,ot,Ke,_t,Ft,yt,Wt){const mt=Ze.exports.sbrk,Tt=_t+3&-4,Kt=mt(Tt*Ft),bt=mt(yt.length),Zt=new Uint8Array(Ze.exports.memory.buffer);Zt.set(yt,bt);const Xt=ot(Kt,_t,Ft,bt,yt.length);if(0===Xt&&Wt&&Wt(Kt,Tt,Ft),Ke.set(Zt.subarray(Kt,Kt+_t*Ft)),mt(Kt-mt(0)),0!==Xt)throw new Error(`Malformed buffer data: ${Xt}`)}(q,q.exports[de[De]],ue,fe,be,Te,q.exports[ee[Be]])}}}(fetch(HA()));return z.ready.then(()=>{hC=z})}()),m)for(let z=0;z<m.length;z++)A.push(WA(m[z],d,z,a));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(k&&_)for(const{primitives:z}of _)for(const H of z)AR(H,d);if(N&&_&&T)for(const z of T)IR(z,d);return d})})}function Up(o,s){const a=o.json.bufferViews[s.bufferView],d=ov[s.componentType];return new d(o.buffers[a.buffer],(s.byteOffset||0)+(a.byteOffset||0),s.count*(a.byteStride&&a.byteStride!==I0[s.type]*d.BYTES_PER_ELEMENT?a.byteStride/d.BYTES_PER_ELEMENT:I0[s.type]))}function pC(o,s,a,d){const h=ov[s.componentType],m=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),_=o.json.bufferViews[s.bufferView],b=_.byteStride?_.byteStride/h.BYTES_PER_ELEMENT:I0[s.type],T=a.float32,S=T.length/a.capacity;for(let A=0,k=0;A<s.count*b;A+=b,k+=S)for(let N=0;N<S;N++)T[k+N]=d[A+N]*m;a._trim()}function ZA(o,s,a){const d=o.indices,h=o.attributes,m={};m.indexArray=new fo;const _=s.json.accessors[d],b=_.count/3;m.indexArray.reserve(b);const T=Up(s,_);for(let N=0;N<b;N++)m.indexArray.emplaceBack(T[3*N],T[3*N+1],T[3*N+2]);m.indexArray._trim(),m.vertexArray=new Zo;const S=s.json.accessors[h.POSITION];m.vertexArray.reserve(S.count);const A=Up(s,S);for(let N=0;N<S.count;N++)m.vertexArray.emplaceBack(A[3*N],A[3*N+1],A[3*N+2]);if(m.vertexArray._trim(),m.aabb=new ds(S.min,S.max),m.centroid=function(N,z){const H=[0,0,0],q=N.length;if(q>0){for(let X=0;X<q;X++){const ee=3*N[X];H[0]+=z[ee],H[1]+=z[ee+1],H[2]+=z[ee+2]}H[0]/=q,H[1]/=q,H[2]/=q}return H}(T,A),void 0!==h.COLOR_0){const N=s.json.accessors[h.COLOR_0],z=I0[N.type],H=Up(s,N);m.colorArray=3===z?new Zo:new dc,m.colorArray.resize(N.count),pC(s,N,m.colorArray,H)}if(void 0!==h.NORMAL){m.normalArray=new Zo;const N=s.json.accessors[h.NORMAL];m.normalArray.resize(N.count);const z=Up(s,N);pC(s,N,m.normalArray,z)}if(void 0!==h.TEXCOORD_0&&a.length>0){m.texcoordArray=new Y1;const N=s.json.accessors[h.TEXCOORD_0];m.texcoordArray.resize(N.count);const z=Up(s,N);pC(s,N,m.texcoordArray,z)}if(void 0!==h._FEATURE_ID_RGBA4444){const N=s.json.accessors[h._FEATURE_ID_RGBA4444];s.json.extensionsUsed&&s.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Up(s,N))}void 0!==h._FEATURE_RGBA4444&&(m.featureData=new Uint32Array(Up(s,s.json.accessors[h._FEATURE_RGBA4444]).buffer));const k=o.material;return m.material=function(N,z){const{emissiveFactor:H=[0,0,0],alphaMode:q="OPAQUE",alphaCutoff:X=.5,normalTexture:ee,occlusionTexture:de,emissiveTexture:ue,doubleSided:fe}=N,{baseColorFactor:be=[1,1,1,1],metallicFactor:Te=1,roughnessFactor:De=1,baseColorTexture:Be,metallicRoughnessTexture:Ze}=N.pbrMetallicRoughness||{},ot=de?z[de.index]:void 0;if(de&&de.extensions&&de.extensions.KHR_texture_transform&&ot){const Ke=de.extensions.KHR_texture_transform;ot.offsetScale=[Ke.offset[0],Ke.offset[1],Ke.scale[0],Ke.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new It(...be),metallicFactor:Te,roughnessFactor:De,baseColorTexture:Be?z[Be.index]:void 0,metallicRoughnessTexture:Ze?z[Ze.index]:void 0},doubleSided:fe,emissiveFactor:H,alphaMode:q,alphaCutoff:X,normalTexture:ee?z[ee.index]:void 0,occlusionTexture:ot,emissionTexture:ue?z[ue.index]:void 0,defined:void 0===N.defined}}(void 0!==k?s.json.materials[k]:{defined:!1},a),m}function OR(o,s,a){const{matrix:d,rotation:h,translation:m,scale:_,mesh:b,extras:T,children:S}=o,A={};if(A.matrix=d||f.ae.fromRotationTranslationScale([],h||[0,0,0,1],m||[0,0,0],_||[1,1,1]),void 0!==b){A.meshes=a[b];const k=A.anchor=[0,0];for(const N of A.meshes){const{min:z,max:H}=N.aabb;k[0]+=z[0]+H[0],k[1]+=z[1]+H[1]}k[0]=Math.floor(k[0]/A.meshes.length/2),k[1]=Math.floor(k[1]/A.meshes.length/2)}if(T&&(T.id&&(A.id=T.id),T.lights&&(A.lights=function(k){if(!k.length)return[];const N=function(ee){const de=atob(ee),ue=new Uint8Array(de.length);for(let fe=0;fe<de.length;fe++)ue[fe]=de.codePointAt(fe);return ue}(k),z=[],H=N.length/24,q=new Uint16Array(N.buffer),X=new Float32Array(N.buffer);for(let ee=0;ee<H;ee++){const de=q[2*ee*6]/30,ue=q[2*ee*6+1]/30,fe=q[2*ee*6+10]/100,be=X[6*ee+1],Te=X[6*ee+2],De=X[6*ee+3],Be=X[6*ee+4],Ze=De-be,ot=Be-Te,Ke=Math.hypot(Ze,ot);z.push({pos:[be+.5*Ze,Te+.5*ot,ue],normal:[ot/Ke,-Ze/Ke,0],width:Ke,height:de,depth:fe,points:[be,Te,De,Be]})}return z}(T.lights))),S){const k=[];for(const N of S)k.push(OR(s.json.nodes[N],s,a));A.children=k}return A}function PR(o){if(0===o.vertices.length||0===o.indices.length)return null;const s=new ch(o.vertices,o.indices,8,256),[a,d]=[s.min.clone(),s.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:s,min:a,max:d}}function vw(o){if(!o.extras||!o.extras.ground)return null;const s=o.extras.ground;if(!s||!Array.isArray(s)||0===s.length)return null;const a=s[0];if(!a||!Array.isArray(a)||0===a.length)return null;const d=[];for(const _ of a){if(!Array.isArray(_)||2!==_.length)continue;const b=_[0],T=_[1];"number"==typeof b&&"number"==typeof T&&d.push(new rn(b,T))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let h=0;for(let _=0;_<d.length;_++){const b=d[_],T=d[(_+1)%d.length],S=d[(_+2)%d.length];h+=(b.x-T.x)*(S.y-T.y)-(S.x-T.x)*(b.y-T.y)}h>0&&d.reverse();const m=K_(d.flatMap(_=>[_.x,_.y]),[]);return 0===m.length?null:{vertices:d,indices:m}}function mC(o,s){const a=[],d=[];let h=0;const m=[];for(const _ of o){h=a.length;const b=_.vertexArray.float32,T=_.indexArray.uint16;for(let S=0;S<_.vertexArray.length;S++)m[0]=b[3*S+0],m[1]=b[3*S+1],m[2]=b[3*S+2],f.$.transformMat4(m,m,s),a.push(new rn(m[0],m[1]));for(let S=0;S<3*_.indexArray.length;S++)d.push(T[S]+h)}if(d.length%3!=0)return null;for(let _=0;_<d.length;_+=3){const b=a[d[_+0]],T=a[d[_+1]],S=a[d[_+2]];(b.x-T.x)*(S.y-T.y)-(S.x-T.x)*(b.y-T.y)>0&&([d[_+1],d[_+2]]=[d[_+2],d[_+1]])}return{vertices:a,indices:d}}function id(o){const a=function(T,S){const A=[];for(const k of T.json.meshes){const N=[];for(const z of k.primitives)N.push(ZA(z,T,S));A.push(N)}return A}(o,function(T,S){const A=[],k=WebGL2RenderingContext;if(T.json.textures)for(const N of T.json.textures){const z={magFilter:k.LINEAR,minFilter:k.NEAREST,wrapS:k.REPEAT,wrapT:k.REPEAT};void 0!==N.sampler&&Object.assign(z,T.json.samplers[N.sampler]),A.push({image:S[N.source],sampler:z,uploaded:!1})}return A}(o,o.images)),{scenes:d,scene:h,nodes:m}=o.json,_=d?d[h||0].nodes:m,b=[];for(const T of _)b.push(OR(m[T],o,a));return function(T,S,A){const k={},N=new Set;for(let z=0;z<T.length;z++){const H=A[S[z]];if(!H.extras)continue;const q=H.extras["mapbox:footprint:version"],X=H.extras["mapbox:footprint:id"];(q||X)&&N.add(z),"1.0.0"===q&&X&&(k[X]=z)}for(let z=0;z<T.length;z++){if(N.has(z))continue;const H=T[z],q=A[S[z]];if(!q.extras)continue;let X=null;H.id in k&&(X=mC(T[k[H.id]].meshes,H.matrix)),X||(X=vw(q)),X&&(H.footprint=PR(X))}if(N.size>0){const z=Array.from(N.values()).sort((H,q)=>H-q);for(let H=z.length-1;H>=0;H--)T.splice(z[H],1)}}(b,_,o.json.nodes),b}function RR(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const s=o.vertexArray.float32,a=o.aabb.min[0]-1,d=o.aabb.min[1]-1,h=64/(o.aabb.max[0]-a+2),m=64/(o.aabb.max[1]-d+2);for(let _=0;_<s.length;_+=3){const b=s[_+2],T=(s[_+0]-a)*h|0,S=(s[_+1]-d)*m|0;b>o.heightmap[64*S+T]&&(o.heightmap[64*S+T]=b)}}function NR(o,s){const a={};a.indexArray=new fo,a.indexArray.reserve(4*o.length),a.vertexArray=new Zo,a.vertexArray.reserve(10*o.length),a.colorArray=new dc,a.vertexArray.reserve(10*o.length);let d=0;for(const _ of o){const b=Math.min(10,Math.max(4,1.3*_.height))*s,T=[-_.normal[1],_.normal[0],0],S=Math.min(.29,.1*_.width/_.depth),A=_.width-2*_.depth*s*(S+.01),k=f.$.scaleAndAdd([],_.pos,T,A/2),N=f.$.scaleAndAdd([],_.pos,T,-A/2),z=[k[0],k[1],k[2]+_.height],H=[N[0],N[1],N[2]+_.height],q=f.$.scaleAndAdd([],_.normal,T,S);f.$.scale(q,q,b);const X=f.$.scaleAndAdd([],_.normal,T,-S);f.$.scale(X,X,b),f.$.add(q,k,q),f.$.add(X,N,X),k[2]+=.1,N[2]+=.1,a.vertexArray.emplaceBack(q[0],q[1],q[2]),a.vertexArray.emplaceBack(X[0],X[1],X[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(N[0],N[1],N[2]),a.vertexArray.emplaceBack(z[0],z[1],z[2]),a.vertexArray.emplaceBack(H[0],H[1],H[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(N[0],N[1],N[2]),a.vertexArray.emplaceBack(q[0],q[1],q[2]),a.vertexArray.emplaceBack(X[0],X[1],X[2]);const ee=A/b/2;a.colorArray.emplaceBack(-ee-S,-1,ee,.8),a.colorArray.emplaceBack(ee+S,-1,ee,.8),a.colorArray.emplaceBack(-ee,0,ee,1.3),a.colorArray.emplaceBack(ee,0,ee,1.3),a.colorArray.emplaceBack(ee+S,-.8,ee,.7),a.colorArray.emplaceBack(ee+S,-.8,ee,.7),a.colorArray.emplaceBack(0,0,ee,1.3),a.colorArray.emplaceBack(0,0,ee,1.3),a.colorArray.emplaceBack(ee+S,-1.2,ee,.8),a.colorArray.emplaceBack(ee+S,-1.2,ee,.8),a.indexArray.emplaceBack(6+d,4+d,8+d),a.indexArray.emplaceBack(7+d,9+d,5+d),a.indexArray.emplaceBack(0+d,1+d,2+d),a.indexArray.emplaceBack(1+d,3+d,2+d),d+=10}const h={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=It.white,h.pbrMetallicRoughness=m,a.material=h,a.aabb=new ds([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const XA=new Float32Array(262144),Vp=new Uint8Array(262144);function Cl(o){let s=0;if(o.meshes)for(const a of o.meshes)s=Math.max(s,a.aabb.max[2]);if(o.children)for(const a of o.children)s=Math.max(s,Cl(a));return s}function gC(o,s,a){if(o.meshes)for(const d of o.meshes)d.aabb.min[0]!==1/0&&a.insert(s,d.aabb.min[0],d.aabb.min[1],d.aabb.max[0],d.aabb.max[1]);if(o.children)for(const d of o.children)gC(d,s,a)}const _C=["","wall","door","roof","window","lamp","logo"];class yC{constructor(s){this.node=s,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:s.id,geometry:[],properties:{height:Cl(s)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ds([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let s=0;const a=new ds([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==s&&(d.transformedAabb=ds.applyTransformFast(d.aabb,this.node.matrix),a.encapsulate(d.transformedAabb)),s++;this.aabb=a}return this.aabb}}class vC{constructor(s,a,d,h,m,_){this.id=a,this.modelTraits|=Cg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=Cg.HasMapboxMeshFeatures),h&&(this.modelTraits|=Cg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const b of s)this.nodesInfo.push(new yC(b)),gC(b,_.featureIndexArray.length,_.grid),_.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,_.bucketLayerIDs.length-1,0)}updateFootprints(s,a){for(const d of this.getNodesInfo()){const h=d.node;h.footprint&&a.push({footprint:h.footprint,id:s})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(s){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const d of a){const h=d.node;this.uploaded?this.updatePbrBuffer(h):cC(h,s,!0)}for(const d of a)gw(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(s){let a=!1;if(!s.meshes)return a;for(const d of s.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),a=!0);return a}needsReEvaluation(s,a,d){const h=s.transform.projectionOptions,m=s.style.getBrightness(),_=this.brightness!==m;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||ni(d.paint.get("model-color").value,_)||ni(d.paint.get("model-color-mix-intensity").value,_)||ni(d.paint.get("model-roughness").value,_)||ni(d.paint.get("model-emissive-strength").value,_)||ni(d.paint.get("model-height-based-emissive-strength-multiplier").value,_))&&(this.projection=h,this.brightness=m,!0)}evaluateScale(s,a){if(s.transform.zoom===this.zoom)return;this.zoom=s.transform.zoom;const d=this.getNodesInfo(),h=this.id.canonical;for(const m of d){const _=m.feature;m.evaluatedScale=a.paint.get("model-scale").evaluate(_,{},h)}}evaluate(s){const a=this.getNodesInfo();for(const d of a){if(!d.node.meshes)continue;const h=d.feature,m=d.node.meshes&&d.node.meshes[0].featureData,_=d.evaluatedColor[2],b=d.evaluatedRMEA[2],T=this.id.canonical;if(d.hasTranslucentParts=!1,m){for(let S=0;S<_C.length;S++){const A=_C[S];A.length&&(h.properties.part=A);const k=s.paint.get("model-color").evaluate(h,{},T).toRenderColor(null),N=s.paint.get("model-color-mix-intensity").evaluate(h,{},T);d.evaluatedColor[S]=[k.r,k.g,k.b,N],d.evaluatedRMEA[S][0]=s.paint.get("model-roughness").evaluate(h,{},T),d.evaluatedRMEA[S][2]=s.paint.get("model-emissive-strength").evaluate(h,{},T),d.evaluatedRMEA[S][3]=k.a,d.emissionHeightBasedParams[S]=s.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},T),!d.hasTranslucentParts&&k.a<1&&(d.hasTranslucentParts=!0)}delete h.properties.part,xC(d,_!==d.evaluatedColor[2]||b!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=s.paint.get("model-emissive-strength").evaluate(h,{},T);d.evaluatedScale=s.paint.get("model-scale").evaluate(h,{},T),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(s,a,d,h){const m=s.findDEMTileFor(d);if(m&&(m.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const _=mg.create(s,d,m);if(!_)return;this.modelTraits&Cg.HasMapboxMeshFeatures&&this.updateDEM(s,_,d,h);for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const S=T.footprint.vertices;let A=_.getElevationAt(S[0].x,S[0].y,!0,!0);for(let k=1;k<S.length;k++)A=Math.min(A,_.getElevationAt(S[k].x,S[k].y,!0,!0));T.elevation=A}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=a}}updateDEM(s,a,d,h){let m=a._dem._modifiedForSources[h];if(void 0===m&&(a._dem._modifiedForSources[h]=[],m=a._dem._modifiedForSources[h]),m.includes(d.canonical))return;const _=a._dem.dim;m.push(d.canonical);let b=!1;for(const T of this.getNodesInfo()){const S=T.node;if(!S.footprint||!S.footprint.grid)continue;const A=S.footprint.grid,k=a.tileCoordToPixel(A.min.x,A.min.y),N=a.tileCoordToPixel(A.max.x,A.max.y),z=Math.min(Math.min(_-N.y,k.x),Math.min(k.y,_-N.x));if(z<0)continue;const H=Dr(z,2,5);let q=Math.max(0,k.x-H),X=Math.max(0,k.y-H),ee=Math.min(N.x+H,_-1),de=Math.min(N.y+H,_-1);for(let Te=X;Te<=de;++Te)for(let De=q;De<=ee;++De)Vp[Te*_+De]=255;let ue=0,fe=0;for(let Te=0;Te<A.cellsY;++Te)for(let De=0;De<A.cellsX;++De){if(!A.cells[Te*A.cellsX+De])continue;const Be=a.tileCoordToPixel(A.min.x+De/A.xScale,A.min.y+Te/A.yScale),Ze=a.tileCoordToPixel(A.min.x+(De+1)/A.xScale,A.min.y+(Te+1)/A.yScale);for(let ot=Be.y;ot<=Math.min(Ze.y+1,_-1);++ot)for(let Ke=Be.x;Ke<=Math.min(Ze.x+1,_-1);++Ke)255===Vp[ot*_+Ke]&&(Vp[ot*_+Ke]=0,ue+=a.getElevationAtPixel(Ke,ot),fe++)}const be=ue/fe;q=Math.max(1,k.x-H),X=Math.max(1,k.y-H),ee=Math.min(N.x+H,_-2),de=Math.min(N.y+H,_-2),b=!0;for(let Te=X;Te<=de;++Te)for(let De=q;De<=ee;++De)0===Vp[Te*_+De]&&(XA[Te*_+De]=a._dem.set(De,Te,be));for(let Te=1;Te<H;++Te){q=Math.max(1,k.x-Te),X=Math.max(1,k.y-Te),ee=Math.min(N.x+Te,_-2),de=Math.min(N.y+Te,_-2);for(let De=X;De<=de;++De)for(let Be=q;Be<=ee;++Be){const Ze=De*_+Be;if(255===Vp[Ze]){let ot=0,Ke=0,_t=-1,Ft=-1;for(let yt=-1;yt<=1;++yt)for(let Wt=-1;Wt<=1;++Wt){const mt=(De+yt)*_+Be+Wt;if(Vp[mt]>=Te)continue;const Tt=XA[mt],Kt=Math.abs(Tt);Kt>Ke&&(ot=Tt,Ke=Kt,_t=Wt,Ft=yt)}if(Ke>.1){const yt=1-(Te+.5*Math.abs(_t*Ft))/H;let Wt=a._dem.get(Be,De)+ot*yt;const mt=a._dem.get(Be+_t,De+Ft),Tt=a._dem.get(Be-_t,De-Ft,!0);(Wt-mt)*(Wt-Tt)>0&&(Wt=(mt+Tt)/2),XA[Ze]=a._dem.set(Be,De,Wt),Vp[Ze]=Te}}}}}b&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=Oa.now())}getNodesInfo(){return this.nodesInfo}destroy(){const s=this.getNodesInfo();for(const a of s)gw(a.node),uC(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(s,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(s.toUnwrapped()),h=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){const _=h[m].node;h[m].hiddenByReplacement=!!_.footprint&&!d.find(b=>b.footprint===_.footprint)}}getHeightAtTileCoord(s,a){const d=this.getNodesInfo(),h=[],m=[0,0,0],_=f.ae.identity([]);for(let b=0;b<this.nodesInfo.length;b++){const T=d[b],S=T.node.meshes[0],A=S.transformedAabb;if(s<A.min[0]||a<A.min[1]||s>A.max[0]||a>A.max[1])continue;if(!0===T.node.hidden)return{height:0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};f.ae.invert(_,T.node.matrix),m[0]=s,m[1]=a,f.$.transformMat4(m,m,_);const k=(m[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*64|0,N=64*Math.min(63,(m[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*64|0)+Math.min(63,k),z=S.heightmap[N];if(!(z<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:z,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new rn(s,a),new rn(s,a),h),h.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function ni(o,s){return!o.isLightConstant&&s}function FR(o,s,a,d,h,m,_,b){let T=(61440&s|(61440&s)>>4)>>8,S=(3840&s|(3840&s)>>4)>>4,A=240&s|(240&s)>>4;a[3]>0&&(T=dn(T,255*a[0],a[3]),S=dn(S,255*a[1],a[3]),A=dn(A,255*a[2],a[3]));const k=T<<8|S,N=A<<8|Math.floor(255*d[3]),z=function(Te){const De=Dr(Te,0,2);return Math.min(Math.round(.5*De*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],H=Dr(h[0],0,1),q=Dr(h[1],0,1),X=Dr(h[2],0,1),ee=Dr(h[3],0,1);let de,ue,fe,be;if(H!==q&&_!==m&&q!==H){const Te=_-m;ue=1/(Te*(q-H)),fe=-(m+Te*H)/(Te*(q-H));const De=Dr(h[4],-1,1);be=Math.pow(10,De),de=255*X<<8|255*ee}else de=65535,ue=0,fe=1,be=1;if(o.emplaceBack(k,N,z,de,ue,fe,be),b){const Te=b.length;b.clear();for(let De=0;De<Te;De++)b.emplaceBack(k,N,z,de,ue,fe,be)}}function xC(o,s,a){const d=o.node;let h=0;const m=a&Cg.HasMeshoptCompression;for(const _ of d.meshes){if(d.lights&&d.lightMeshIndex===h||!_.featureData)continue;_.featureArray=new K1,_.featureArray.reserve(_.featureData.length);let b=s;for(const T of _.featureData){const S=m?65535&T:T>>16&65535,A=m?T>>16&65535:65535&T,k=(15&A)<8?15&A:0,N=o.evaluatedRMEA[k],z=o.evaluatedColor[k],H=o.emissionHeightBasedParams[k];let q;if(b&&2===k&&d.lights&&(q=new K1,q.resize(10*d.lights.length)),FR(_.featureArray,S,z,N,H,_.aabb.min[2],_.aabb.max[2],q),q&&b){b=!1;const X=d.meshes[d.lightMeshIndex];X.featureArray=q,X.featureArray._trim()}}_.featureArray._trim(),h++}}function YA(o,s,a,d){const h=1<<o.z;s.lat=Xo((d/Jt+o.y)/h),s.lng=ga((a/Jt+o.x)/h)}Fe(vC,"Tiled3dModelBucket",{omit:["layers"]}),Fe(yC,"Tiled3dModelFeature");const LR={circle:class extends sl{constructor(o,s,a,d){super(o,{layout:PT||(PT=new Vi({"circle-sort-key":new Tn(nt.layout_circle["circle-sort-key"]),visibility:new Gt(nt.layout_circle.visibility)})),paint:XD||(XD=new Vi({"circle-radius":new Tn(nt.paint_circle["circle-radius"]),"circle-color":new Tn(nt.paint_circle["circle-color"]),"circle-blur":new Tn(nt.paint_circle["circle-blur"]),"circle-opacity":new Tn(nt.paint_circle["circle-opacity"]),"circle-translate":new Gt(nt.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt(nt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt(nt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt(nt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tn(nt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tn(nt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tn(nt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Gt(nt.paint_circle["circle-emissive-strength"])}))},s,a,d)}createBucket(o){return new OT(o)}queryRadius(o){const s=o;return Z_("circle-radius",this,s)+Z_("circle-stroke-width",this,s)+sy(this.paint.get("circle-translate"))}queryIntersectsFeature(o,s,a,d,h,m,_,b){const T=oy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(s,a)+this.paint.get("circle-stroke-width").evaluate(s,a);return HT(o,d,m,_,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,s,a){const d=nM(this);return{config:new ag(this,{zoom:s,lut:a}),defines:d,overrideFog:!1}}},heatmap:class extends sl{createBucket(o){return new iM(o)}constructor(o,s,a,d){super(o,{layout:vb||(vb=new Vi({visibility:new Gt(nt.layout_heatmap.visibility)})),paint:WT||(WT=new Vi({"heatmap-radius":new Tn(nt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tn(nt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt(nt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new il(nt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt(nt.paint_heatmap["heatmap-opacity"])}))},s,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Z_("heatmap-radius",this,o)}queryIntersectsFeature(o,s,a,d,h,m,_,b){const T=this.paint.get("heatmap-radius").evaluate(s,a);return HT(o,d,m,_,b,!0,!0,new rn(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,s,a){return"heatmap"===o?{config:new ag(this,{zoom:s,lut:a}),overrideFog:!1}:{}}},hillshade:class extends sl{constructor(o,s,a,d){super(o,{layout:hy||(hy=new Vi({visibility:new Gt(nt.layout_hillshade.visibility)})),paint:AP||(AP=new Vi({"hillshade-illumination-direction":new Gt(nt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt(nt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt(nt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt(nt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt(nt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt(nt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Gt(nt.paint_hillshade["hillshade-emissive-strength"])}))},s,a,d)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,s,a){return{overrideFog:!1}}},fill:class extends sl{constructor(o,s,a,d){super(o,{layout:pM||(pM=new Vi({"fill-sort-key":new Tn(nt.layout_fill["fill-sort-key"]),visibility:new Gt(nt.layout_fill.visibility)})),paint:eE||(eE=new Vi({"fill-antialias":new Gt(nt.paint_fill["fill-antialias"]),"fill-opacity":new Tn(nt.paint_fill["fill-opacity"]),"fill-color":new Tn(nt.paint_fill["fill-color"]),"fill-outline-color":new Tn(nt.paint_fill["fill-outline-color"]),"fill-translate":new Gt(nt.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt(nt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Tn(nt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Gt(nt.paint_fill["fill-emissive-strength"])}))},s,a,d)}getProgramIds(){const o=this.paint.get("fill-pattern"),s=o&&o.constantOr(1),a=[s?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(s&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(o,s,a){return{config:new ag(this,{zoom:s,lut:a}),overrideFog:!1}}recalculate(o,s){super.recalculate(o,s);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new QT(o)}queryRadius(){return sy(this.paint.get("fill-translate"))}queryIntersectsFeature(o,s,a,d,h,m){return!o.queryGeometry.isAboveHorizon&&WD(hb(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends sl{constructor(o,s,a,d){super(o,{layout:NM||(NM=new Vi({visibility:new Gt(nt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Gt(nt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:FM||(FM=new Vi({"fill-extrusion-opacity":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tn(nt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Tn(nt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tn(nt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tn(nt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Tn(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Tn(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Tn(nt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new Gt(nt["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},s,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Nb(o)}queryRadius(){return sy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,s,a,d,h,m,_,b,T){const S=oy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(s,a),k=this.paint.get("fill-extrusion-base").evaluate(s,a),N=[0,0],z=b&&m.elevation,H=m.elevation?m.elevation.exaggeration():1,q=o.tile.getBucket(this);if(z&&q instanceof Nb){const fe=q.centroidVertexArray,be=T+1;be<fe.length&&(N[0]=fe.geta_centroid_pos0(be),N[1]=fe.geta_centroid_pos1(be))}if(0===N[0]&&1===N[1])return!1;"globe"===m.projection.name&&(d=RM([d],[new rn(0,0),new rn(Jt,Jt)],o.tileID.canonical).map(fe=>fe.polygon).flat());const X=z?b:null,[ee,de]=(be=d,Te=k,De=A,Be=S,Ze=_,ot=X,Ke=N,_t=H,Ft=m.center.lat,"globe"===(fe=m).projection.name?function(Wt,mt,Tt,Kt,bt,Zt,Xt,Ut,Rn,Mn,hn){const tn=[],Yn=[],kn=Wt.projection.upVectorScale(hn,Wt.center.lat,Wt.worldSize).metersToTile,xn=[0,0,0,1],or=[0,0,0,1],ur=(vr,zr,Ir,Ti)=>{vr[0]=zr,vr[1]=Ir,vr[2]=Ti,vr[3]=1},dr=PM();Tt>0&&(Tt+=dr),Kt+=dr;for(const vr of mt){const zr=[],Ir=[];for(const Ti of vr){const Pi=Ti.x+bt.x,ar=Ti.y+bt.y,ri=Wt.projection.projectTilePoint(Pi,ar,hn),hi=Wt.projection.upVector(hn,Ti.x,Ti.y);let Zi=Tt,ks=Kt;if(Xt){const Xs=BM(Pi,ar,Tt,Kt,Xt,Ut,Rn,Mn);Zi+=Xs.base,ks+=Xs.top}0!==Tt?ur(xn,ri.x+hi[0]*kn*Zi,ri.y+hi[1]*kn*Zi,ri.z+hi[2]*kn*Zi):ur(xn,ri.x,ri.y,ri.z),ur(or,ri.x+hi[0]*kn*ks,ri.y+hi[1]*kn*ks,ri.z+hi[2]*kn*ks),f.$.transformMat4(xn,xn,Zt),f.$.transformMat4(or,or,Zt),zr.push(new Yu(xn[0],xn[1],xn[2])),Ir.push(new Yu(or[0],or[1],or[2]))}tn.push(zr),Yn.push(Ir)}return[tn,Yn]}(fe,be,Te,De,Be,Ze,ot,Ke,_t,Ft,o.tileID.canonical):ot?function(Wt,mt,Tt,Kt,bt,Zt,Xt,Ut,Rn){const Mn=[],hn=[],tn=[0,0,0,1];for(const Yn of Wt){const kn=[],xn=[];for(const or of Yn){const ur=or.x+Kt.x,dr=or.y+Kt.y,vr=BM(ur,dr,mt,Tt,Zt,Xt,Ut,Rn);tn[0]=ur,tn[1]=dr,tn[2]=vr.base,tn[3]=1,f.aB.transformMat4(tn,tn,bt),tn[3]=Math.max(tn[3],1e-5);const zr=new Yu(tn[0]/tn[3],tn[1]/tn[3],tn[2]/tn[3]);tn[0]=ur,tn[1]=dr,tn[2]=vr.top,tn[3]=1,f.aB.transformMat4(tn,tn,bt),tn[3]=Math.max(tn[3],1e-5);const Ir=new Yu(tn[0]/tn[3],tn[1]/tn[3],tn[2]/tn[3]);kn.push(zr),xn.push(Ir)}Mn.push(kn),hn.push(xn)}return[Mn,hn]}(be,Te,De,Be,Ze,ot,Ke,_t,Ft):function(Wt,mt,Tt,Kt,bt){const Zt=[],Xt=[],Ut=bt[8]*mt,Rn=bt[9]*mt,Mn=bt[10]*mt,hn=bt[11]*mt,tn=bt[8]*Tt,Yn=bt[9]*Tt,kn=bt[10]*Tt,xn=bt[11]*Tt;for(const or of Wt){const ur=[],dr=[];for(const vr of or){const zr=vr.x+Kt.x,Ir=vr.y+Kt.y,Ti=bt[0]*zr+bt[4]*Ir+bt[12],Pi=bt[1]*zr+bt[5]*Ir+bt[13],ar=bt[2]*zr+bt[6]*Ir+bt[14],ri=bt[3]*zr+bt[7]*Ir+bt[15],hi=Ti+Ut,Zi=Pi+Rn,ks=ar+Mn,Xs=Math.max(ri+hn,1e-5),Ss=Ti+tn,ls=Pi+Yn,mo=ar+kn,Ys=Math.max(ri+xn,1e-5);ur.push(new Yu(hi/Xs,Zi/Xs,ks/Xs)),dr.push(new Yu(Ss/Ys,ls/Ys,mo/Ys))}Zt.push(ur),Xt.push(dr)}return[Zt,Xt]}(be,Te,De,Be,Ze)),ue=o.queryGeometry;var fe,be,Te,De,Be,Ze,ot,Ke,_t,Ft;return function(fe,be,Te){let De=1/0;WD(Te,be)&&(De=LM(Te,be[0]));for(let Be=0;Be<be.length;Be++){const Ze=be[Be],ot=fe[Be];for(let Ke=0;Ke<Ze.length-1;Ke++){const _t=Ze[Ke],Ft=[_t,Ze[Ke+1],ot[Ke+1],ot[Ke],_t];W_(Te,Ft)&&(De=Math.min(De,LM(Te,Ft)))}}return De!==1/0&&De}(ee,de,ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},line:class extends sl{constructor(o,s,a,d){const h=xR();super(o,h,s,a,d),h.layout&&(this.layout=new pa(h.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const s=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=s._styleExpression&&s._styleExpression.expression instanceof hp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,s){super.recalculate(o,s),this.paint._values["line-floorwidth"]=(()=>{if(Jy)return Jy;const a=xR();return Jy=new bR(a.paint.properties["line-width"].specification),Jy.useIntegerZoom=!0,Jy})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Lb(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,s,a){const d=My(this);return{config:new ag(this,{zoom:s,lut:a}),defines:d,overrideFog:!1}}queryRadius(o){const s=o,a=uw(Z_("line-width",this,s),Z_("line-gap-width",this,s)),d=Z_("line-offset",this,s);return a/2+Math.abs(d)+sy(this.paint.get("line-translate"))}queryIntersectsFeature(o,s,a,d,h,m){if(o.queryGeometry.isAboveHorizon)return!1;const _=hb(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),b=o.pixelToTileUnitsFactor/2*uw(this.paint.get("line-width").evaluate(s,a),this.paint.get("line-gap-width").evaluate(s,a)),T=this.paint.get("line-offset").evaluate(s,a);return T&&(d=function(S,A){const k=[],N=new rn(0,0);for(let z=0;z<S.length;z++){const H=S[z],q=[];for(let X=0;X<H.length;X++){const ee=H[X],de=H[X+1],ue=0===X?N:ee.sub(H[X-1])._unit()._perp(),fe=X===H.length-1?N:de.sub(ee)._unit()._perp(),be=ue._add(fe)._unit();be._mult(1/(be.x*fe.x+be.y*fe.y)),q.push(be._mult(A)._add(ee))}k.push(q)}return k}(d,T*o.pixelToTileUnitsFactor)),function(S,A,k){for(let N=0;N<A.length;N++){const z=A[N];if(S.length>=3)for(let H=0;H<z.length;H++)if(Ki(S,z[H]))return!0;if(qD(S,z,k))return!0}return!1}(_,d,b)}isTileClipped(){return!0}isDraped(o){const s=this.layout.get("line-z-offset");return s.isConstant()&&!s.constantOr(0)}},symbol:Fp,background:class extends sl{constructor(o,s,a,d){super(o,{layout:KE||(KE=new Vi({visibility:new Gt(nt.layout_background.visibility)})),paint:DA||(DA=new Vi({"background-color":new Gt(nt.paint_background["background-color"]),"background-pattern":new Gt(nt.paint_background["background-pattern"]),"background-opacity":new Gt(nt.paint_background["background-opacity"]),"background-emissive-strength":new Gt(nt.paint_background["background-emissive-strength"])}))},s,a,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,s,a){return{overrideFog:!1}}},raster:AA,"raster-particle":eC,sky:class extends sl{constructor(o,s,a,d){super(o,{layout:kA||(kA=new Vi({visibility:new Gt(nt.layout_sky.visibility)})),paint:OA||(OA=new Vi({"sky-type":new Gt(nt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Gt(nt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Gt(nt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Gt(nt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Gt(nt.paint_sky["sky-gradient-radius"]),"sky-gradient":new il(nt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Gt(nt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Gt(nt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Gt(nt.paint_sky["sky-opacity"])}))},s,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=xb({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const s=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==s.azimuthal||this._lightPosition.polar!==s.polar}return!1}getCenter(o,s){if("atmosphere"===this.paint.get("sky-type")){const d=this.paint.get("sky-atmosphere-sun"),h=!d,m=o.style.light,_=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&Ns("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?hw(_.azimuthal,90-_.polar,s):hw(d[0],90-d[1],s)}const a=this.paint.get("sky-gradient-center");return hw(a[0],90-a[1],s)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}},slot:class extends sl{constructor(o,s,a,d){super(o,{paint:nv||(nv=new Vi({}))},s,null)}},model:class extends sl{constructor(o,s,a,d){super(o,{layout:aC||(aC=new Vi({visibility:new Gt(nt.layout_model.visibility),"model-id":new Tn(nt.layout_model["model-id"])})),paint:jA||(jA=new Vi({"model-opacity":new Gt(nt.paint_model["model-opacity"]),"model-rotation":new Tn(nt.paint_model["model-rotation"]),"model-scale":new Tn(nt.paint_model["model-scale"]),"model-translation":new Tn(nt.paint_model["model-translation"]),"model-color":new Tn(nt.paint_model["model-color"]),"model-color-mix-intensity":new Tn(nt.paint_model["model-color-mix-intensity"]),"model-type":new Gt(nt.paint_model["model-type"]),"model-cast-shadows":new Gt(nt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Gt(nt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Gt(nt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Tn(nt.paint_model["model-emissive-strength"]),"model-roughness":new Tn(nt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Tn(nt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Gt(nt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Gt(nt.paint_model["model-front-cutoff"])}))},s,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new oC(o)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof vC?Jt-1:0}queryIntersectsFeature(o,s,a,d,h,m){if(!this.modelManager)return!1;const _=this.modelManager,b=o.tile.getBucket(this);if(!(b&&b instanceof oC))return!1;const T=b;for(const S in T.instancesPerModel){const A=T.instancesPerModel[S],k=void 0!==s.id?s.id:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(k)){const N=A.features[A.idToFeaturesIndex[k]],z=_.getModel(S,this.scope);if(!z)return!1;let H=f.ae.create();const q=new Yr(0,0),X=T.canonical;let ee=Number.MAX_VALUE;for(let de=0;de<N.instancedDataCount;++de){const ue=16*(N.instancedDataOffset+de),fe=A.instancedDataArray.float32,be=[fe[ue+4],fe[ue+5],fe[ue+6]];YA(X,q,fe[ue],0|fe[ue+1]),lC(H,z,m,q,N.rotation,N.scale,be,!1,!1,!1),"globe"===m.projection.name&&(H=nC(H,m));const Te=f.ae.multiply([],m.projMatrix,H),De=o.queryGeometry,Be=BA(De.isPointQuery()?De.screenBounds:De.screenGeometry,m,Te,z.aabb);null!=Be&&(ee=Math.min(Be,ee))}return ee!==Number.MAX_VALUE&&ee}}return!1}_handleOverridablePaintPropertyUpdate(o,s,a){return!(!this.layout||s.isDataDriven()||a.isDataDriven()||"model-color"!==o&&"model-color-mix-intensity"!==o&&"model-rotation"!==o&&"model-scale"!==o&&"model-translation"!==o&&"model-emissive-strength"!==o)}_isPropertyZoomDependent(o){const s=this._transitionablePaint._values[o];return null!=s&&null!=s.value&&null!=s.value.expression&&s.value.expression instanceof ve}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(o,s,a,d){const h=o.tile,m=h.getBucket(this);let _=null,b=Number.MAX_VALUE;if(!(m&&m instanceof vC))return{queryFeature:_,intersectionZ:b};const T=m.getNodesInfo()[s];if(T.hiddenByReplacement||!T.node.meshes||!a.filter(new Qn(h.tileID.overscaledZ),T.feature,h.tileID.canonical))return{queryFeature:_,intersectionZ:b};const S=T.node,A=d.calculatePosMatrix(h.tileID.toUnwrapped(),d.worldSize),k=T.evaluatedScale;let N=0;d.elevation&&S.elevation&&(N=S.elevation*d.elevation.exaggeration()),f.ae.translate(A,A,[(S.anchor?S.anchor[0]:0)*(k[0]-1),(S.anchor?S.anchor[1]:0)*(k[1]-1),N]),f.ae.scale(A,A,k),f.ae.multiply(A,A,S.matrix);const z=o.queryGeometry,H=z.isPointQuery()?z.screenBounds:z.screenGeometry,q=function(ee){const de=f.ae.multiply([],A,ee.matrix),ue=f.ae.multiply(de,d.expandedFarZProjMatrix,de);for(let fe=0;fe<ee.meshes.length;++fe){const be=ee.meshes[fe];if(fe===ee.lightMeshIndex)continue;const Te=BA(H,d,ue,be.aabb);null!=Te&&(b=Math.min(Te,b))}if(ee.children)for(const fe of ee.children)q(fe)};if(q(S),b===Number.MAX_VALUE)return{queryFeature:_,intersectionZ:b};const X=new Yr(0,0);return YA(h.tileID.canonical,X,T.node.anchor[0],T.node.anchor[1]),_={type:"Feature",geometry:{type:"Point",coordinates:[X.lng,X.lat]},properties:T.feature.properties,id:T.feature.id,state:{},layer:this.serialize()},{queryFeature:_,intersectionZ:b}}},clip:class extends sl{constructor(o,s,a,d){super(o,{layout:wb||(wb=new Vi({"clip-layer-types":new Gt(nt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Gt(nt.layout_clip["clip-layer-scope"])})),paint:mM||(mM=new Vi({}))},s,a,d)}recalculate(o,s){super.recalculate(o,s)}createBucket(o){return new gM(o)}isTileClipped(){return!0}is3D(){return!0}}};Fe(TA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const xw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bw{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,d]=new Uint8Array(s,0,2);if(219!==a)throw new Error("Data does not appear to be in a KDBush format.");const h=d>>4;if(1!==h)throw new Error(`Got v${h} data when expected v1.`);const m=xw[15&d];if(!m)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(s,2,1),[b]=new Uint32Array(s,4,1);return new bw(b,_,m,s)}constructor(s,a=64,d=Float64Array,h){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=d,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const m=xw.indexOf(this.ArrayType),_=2*s*this.ArrayType.BYTES_PER_ELEMENT,b=s*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${d}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+b+T,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+_+b+T),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+b+T,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=s)}add(s,a){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=s,this.coords[this._pos++]=a,d}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return ww(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,a,d,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:_,nodeSize:b}=this,T=[0,m.length-1,0],S=[];for(;T.length;){const A=T.pop()||0,k=T.pop()||0,N=T.pop()||0;if(k-N<=b){for(let X=N;X<=k;X++){const ee=_[2*X],de=_[2*X+1];ee>=s&&ee<=d&&de>=a&&de<=h&&S.push(m[X])}continue}const z=N+k>>1,H=_[2*z],q=_[2*z+1];H>=s&&H<=d&&q>=a&&q<=h&&S.push(m[z]),(0===A?s<=H:a<=q)&&(T.push(N),T.push(z-1),T.push(1-A)),(0===A?d>=H:h>=q)&&(T.push(z+1),T.push(k),T.push(1-A))}return S}within(s,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:_}=this,b=[0,h.length-1,0],T=[],S=d*d;for(;b.length;){const A=b.pop()||0,k=b.pop()||0,N=b.pop()||0;if(k-N<=_){for(let X=N;X<=k;X++)wC(m[2*X],m[2*X+1],s,a)<=S&&T.push(h[X]);continue}const z=N+k>>1,H=m[2*z],q=m[2*z+1];wC(H,q,s,a)<=S&&T.push(h[z]),(0===A?s-d<=H:a-d<=q)&&(b.push(N),b.push(z-1),b.push(1-A)),(0===A?s+d>=H:a+d>=q)&&(b.push(z+1),b.push(k),b.push(1-A))}return T}}function ww(o,s,a,d,h,m){if(h-d<=a)return;const _=d+h>>1;Tw(o,s,_,d,h,m),ww(o,s,a,d,_-1,1-m),ww(o,s,a,_+1,h,1-m)}function Tw(o,s,a,d,h,m){for(;h>d;){if(h-d>600){const S=h-d+1,A=a-d+1,k=Math.log(S),N=.5*Math.exp(2*k/3),z=.5*Math.sqrt(k*N*(S-N)/S)*(A-S/2<0?-1:1);Tw(o,s,a,Math.max(d,Math.floor(a-A*N/S+z)),Math.min(h,Math.floor(a+(S-A)*N/S+z)),m)}const _=s[2*a+m];let b=d,T=h;for(uv(o,s,d,a),s[2*h+m]>_&&uv(o,s,d,h);b<T;){for(uv(o,s,b,T),b++,T--;s[2*b+m]<_;)b++;for(;s[2*T+m]>_;)T--}s[2*d+m]===_?uv(o,s,d,T):(T++,uv(o,s,T,h)),T<=a&&(d=T+1),a<=T&&(h=T-1)}}function uv(o,s,a,d){bC(o,a,d),bC(s,2*a,2*d),bC(s,2*a+1,2*d+1)}function bC(o,s,a){const d=o[s];o[s]=o[a],o[a]=d}function wC(o,s,a,d){const h=o-a,m=s-d;return h*h+m*m}f.A=C_,f.B=dp,f.C=It,f.D=Ym,f.E=br,f.F=tl,f.H=th,f.I=LE,f.J=j,f.K=I,f.L=function(o){const s=o.value;let a=[];if(!s)return a;const d=cu(s);return"string"!==d?(a=a.concat([new iC(o.key,s,`string expected, "${d}" found`)]),a):(VA(s,!0)||(a=a.concat([new iC(o.key,s,`invalid url "${s}"`)])),a)},f.M=class{constructor(o,s,a,d){this.id=o,this.position=null!=s?new Yr(s[0],s[1]):new Yr(0,0),this.orientation=a??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new ds([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,s){if(f.ae.multiply(o.matrix,s,o.matrix),o.meshes)for(const a of o.meshes){const d=ds.applyTransformFast(a.aabb,o.matrix);this.aabb.encapsulate(d)}if(o.children)for(const a of o.children)this._applyTransformations(a,o.matrix)}computeBoundsAndApplyParent(){const o=f.ae.identity([]);for(const s of this.nodes)this._applyTransformations(s,o)}computeModelMatrix(o,s,a,d,h,m,_=!1){lC(this.matrix,this,o.transform,this.position,s,a,d,h,m,_)}upload(o){if(!this.uploaded){for(const s of this.nodes)cC(s,o);for(const s of this.nodes)gw(s);this.uploaded=!0}}destroy(){for(const o of this.nodes)uC(o)}},f.N=nt,f.O=Wo,f.P=rn,f.Q=bo,f.R=Ld,f.S=xf,f.T=vu,f.U=Vi,f.V=iC,f.W=Gt,f.X=class{constructor(o){this.specification=o}possiblyEvaluate(o,s){return Nd(o.expression.evaluate(s))}interpolate(o,s,a){return{x:dn(o.x,s.x,a),y:dn(o.y,s.y,a),z:dn(o.z,s.z,a),azimuthal:dn(o.azimuthal,s.azimuthal,a),polar:dn(o.polar,s.polar,a)}}},f.Y=Qn,f.Z=ve,f._=Is,f.a=_c,f.a$=NT,f.a0=tp,f.a1=pa,f.a2=ol,f.a3=dn,f.a4=Jt,f.a5=op,f.a6=class{constructor(o){this.specification=o}possiblyEvaluate(o,s){return function([a,d]){const h=Nd([1,a,d]);return{x:h.x,y:h.y,z:h.z}}(o.expression.evaluate(s))}interpolate(o,s,a){return{x:dn(o.x,s.x,a),y:dn(o.y,s.y,a),z:dn(o.z,s.z,a)}}},f.a7=sg,f.a8=fu,f.a9=rh,f.aA=function(o,s,a){o[4*s+0]=a[0],o[4*s+1]=a[1],o[4*s+2]=a[2],o[4*s+3]=a[3]},f.aC=function(o,s){const{x:a,y:d}=o.point,h=VT(a,d,o.worldSize/o._pixelsPerMercatorPixel,0,0);return f.ae.multiply(h,h,UT(Po(s)))},f.aE=l0,f.aF=Vs,f.aG=xE,f.aH=function(o,s,a,d,h){const m=5*s+2;o.float32[m+0]=a,o.float32[m+1]=d,o.float32[m+2]=h},f.aI=Hy,f.aJ=Yr,f.aK=RE,f.aL=MT,f.aM=LT,f.aN=tC,f.aO=Tf,f.aP=eM,f.aQ=po,f.aR=function(o,s,a,d,h,m,_,b,T){if("globe"===T.name)return eM(o,s,new Tf(a,d,h),!1);const S=kp({z:a,x:d,y:h},T);return new ds([(m+S.x/S.scale)*s,s*(S.y/S.scale),_],[(m+S.x2/S.scale)*s,s*(S.y2/S.scale),b])},f.aS=function(o,s,a){let d=0;for(let h=0;h<2;++h)o[h]>0&&(d+=(o[h]-0)*(o[h]-0)),s[h]<0&&(d+=(0-s[h])*(0-s[h]));return d},f.aT=ys,f.aU=RT,f.aV=ST,f.aW=function(o){const s=f.ae.identity(new Float64Array(16));f.ae.multiply(s,o.pixelMatrix,o.globeMatrix);const a=[0,Wl,0],d=[0,ql,0];return f.$.transformMat4(a,a,s),f.$.transformMat4(d,d,s),[a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!jT(o,new Yr(o.center.lat,90)),d[0]>0&&d[0]<=o.width&&d[1]>0&&d[1]<=o.height&&!jT(o,new Yr(o.center.lat,-90))]},f.aX=function(o,s){const{scale:a}=o.tileTransform,d=a*Jt/(o.tileSize*Math.pow(2,s.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return f.aD.scale(new Float32Array(4),s.inverseAdjustmentMatrix,[d,d])},f.aY=S0,f.aZ=RA,f.a_=function(o){const s=RA(o,!0);return f.aD.invert([],[s[0],s[1],s[4],s[5]])},f.aa=nb,f.ab=vl,f.ac=kr,f.ad=function(o,s,a){const d=Math.sqrt(o*o+s*s+a*a),h=d>0?Math.acos(a/d)*Uu:0;let m=0!==o||0!==s?Math.atan2(-s,-o)*Uu+90:0;return m<0&&(m+=360),[d,m,h]},f.af=x0,f.ag=ed,f.ah=zE,f.ai=function(o,s){const a={};for(let d=0;d<s.length;d++){const h=s[d];h in o&&(a[h]=o[h])}return a},f.aj=jc,f.ak=mu,f.al=fc,f.am=mT,f.an=function(o){I1++,I1>M1&&(o.getActor().send("enforceCacheSizeLimit",D1),I1=0)},f.ao=Pm,f.ap=class{constructor(o){this.entries={},this.scheduler=o}request(o,s,a,d){const h=this.entries[o]=this.entries[o]||{callbacks:[]};if(h.result){const[m,_]=h.result;return this.scheduler?this.scheduler.add(()=>{d(m,_)},s):d(m,_),()=>{}}return h.callbacks.push(d),h.cancel||(h.cancel=a((m,_)=>{h.result=[m,_];for(const b of h.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,_)},s):b(m,_);setTimeout(()=>delete this.entries[o],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(m=>m!==d),h.callbacks.length||(h.cancel(),delete this.entries[o]))}}},f.aq=function(o,s,a){const d=JSON.stringify(o.request);return o.data&&(this.deduped.entries[d]={result:[null,o.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},h=>{const m=Bd(o.request,(_,b,T,S)=>{_?h(_):b&&h(null,{vectorTile:a?void 0:new by(new Iy(b)),rawData:b,cacheControl:T,expires:S})});return()=>{m.cancel(),h()}},s)},f.ar=TT,f.as=class extends ma{constructor(o){super(o),this.current=rb}set(o,s,a){if(this.fetchUniformLocation(o,s))for(let d=0;d<9;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},f.at=ET,f.au=Dr,f.av=Qh,f.ax=nf,f.ay=bl,f.az=Xo,f.b=_s,f.b$=i5,f.b0=function(o){const{x:s,y:a}=o.point,{lng:d,lat:h}=o._center;return VT(s,a,o.worldSize,d,h)},f.b1=Ia,f.b2=H_,f.b3=sb,f.b4=function(o){const s=Math.round((o+45+360)%360/90)%4;return ep[s]},f.b5=45,f.b6=Ef,f.b7=lb,f.b8=ds,f.b9=Nd,f.bA=Zy,f.bB=Zl,f.bC=function(o,s){return[Math.pow(o[0],2.2)*s,Math.pow(o[1],2.2)*s,Math.pow(o[2],2.2)*s]},f.bD=$M,f.bF=Li,f.bG=Dx,f.bH=Sx,f.bI=256,f.bJ=function(o,s){const a=[0,0,0],d=gb(Po(s.canonical));return f.$.transformMat4(a,a,d),f.$.transformMat4(a,a,o),a},f.bK=o=>({u_camera_to_center_distance:new vl(o),u_extrude_scale:new ib(o),u_device_pixel_ratio:new vl(o),u_matrix:new sg(o),u_inv_rot_matrix:new sg(o),u_merc_center:new rh(o),u_tile_id:new TT(o),u_zoom_transition:new vl(o),u_up_dir:new TT(o),u_emissive_strength:new vl(o)}),f.bL=o=>({u_matrix:new sg(o),u_pixels_to_tile_units:new ib(o),u_device_pixel_ratio:new vl(o),u_units_to_pixels:new rh(o),u_dash_image:new fu(o),u_gradient_image:new fu(o),u_image_height:new vl(o),u_texsize:new rh(o),u_tile_units_to_pixels:new vl(o),u_alpha_discard_threshold:new vl(o),u_trim_offset:new rh(o),u_trim_fade_range:new rh(o),u_trim_color:new ET(o),u_emissive_strength:new vl(o)}),f.bM=o=>({u_matrix:new sg(o),u_texsize:new rh(o),u_pixels_to_tile_units:new ib(o),u_device_pixel_ratio:new vl(o),u_image:new fu(o),u_units_to_pixels:new rh(o),u_tile_units_to_pixels:new vl(o),u_alpha_discard_threshold:new vl(o),u_trim_offset:new rh(o)}),f.bN=B_,f.bO=f5,f.bP=za,f.bQ=$b,f.bR=AE,f.bS=Oy,f.bT=nM,f.bU=(o,s,a,d,h,m)=>{const _=o.transform,b="globe"===_.projection.name;let T;if("map"===m.paint.get("circle-pitch-alignment"))if(b){const A=Li(_.zoom,s.canonical)*_._pixelsPerMercatorPixel;T=Float32Array.from([A,0,0,A])}else T=_.calculatePixelsToTileUnitsMatrix(a);else T=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(_.projection),u_matrix:o.translatePosMatrix(s.projMatrix,a,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Oa.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:uy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){S.u_inv_rot_matrix=d,S.u_merc_center=h,S.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],S.u_zoom_transition=ol(_.zoom);const A=h[0]*Jt,k=h[1]*Jt;S.u_up_dir=_.projection.upVector(new Tf(0,0,0),A,k)}return S},f.bV=My,f.bW=(o,s,a,d,h,m)=>{const _=o.transform;return{u_matrix:yE(o,s,a,d),u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:HM(s,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m}},f.bX=(o,s,a,d,h,m,_)=>{const b=o.transform,T=b.calculatePixelsToTileUnitsMatrix(s);return{u_matrix:yE(o,s,a,d),u_pixels_to_tile_units:T,u_device_pixel_ratio:m,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:vE(a)&&s.lineAtlasTexture?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:HM(s,o.transform),u_alpha_discard_threshold:0,u_trim_offset:_,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength")}},f.bY=np,f.bZ=xb,f.b_=PM,f.ba=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},f.bb=Tm,f.bc=function(o,s,a){const d=ol(a.zoom),h=o.style.map._antialias,m=s.options.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===d&&!h&&!m},f.bd=function(o){const s=o.pixelsPerMeter,a=s/bl(1,o.center.lat),d=f.ae.identity(new Float64Array(16));return f.ae.translate(d,d,[o.point.x,o.point.y,0]),f.ae.scale(d,d,[a,a,s]),Float32Array.from(d)},f.be=cy,f.bf=function(o){const s=ys-5;o=Dr(o,-s,s)/s*90;const a=Math.pow(Math.abs(Math.sin(kr(o))),3);return Math.round(a*(DT.length-1))},f.bg=function(o,s,a,d){const h=s.getNorth(),m=s.getSouth(),_=s.getWest(),b=s.getEast(),T=1<<o.z,S=b-_,A=h-m,k=S/64,N=-A/DT[a],z=[0,k,0,N,0,0,h,_,0];if(o.z>0){const H=180/d;f.bE.multiply(z,z,[H/S+1,0,0,0,H/A+1,0,-.5*H/k,.5*H/N,1])}return z[2]=T,z[5]=o.x,z[8]=o.y,z},f.bh=gb,f.bi=Po,f.bj=function(o,s,a){const d=f.ae.identity(new Float64Array(16)),h=(s/(1<<o)-.5)*Math.PI*2;return f.ae.rotateY(d,a.globeMatrix,h),Float32Array.from(d)},f.bk=ju,f.bl=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},f.bm=AA,f.bn=eC,f.bo=MA,f.bp=function(o,s){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){s(null,a)};for(let d=0;d<o.length;d++){const h=document.createElement("source");Hu(o[d])||(a.crossOrigin="Anonymous"),h.src=o[d],a.appendChild(h)}return{cancel:()=>{}}},f.bq=FE,f.br=Cm,f.bs=class{isDataAvailableAtPoint(o){const s=this._source();if(this.isUsingMockSource()||!s||o.y<0||o.y>1)return!1;const a=s.getSource().maxzoom,d=1<<a,h=Math.floor(o.x),m=Math.floor((o.x-h)*d),_=Math.floor(o.y*d),b=this.findDEMTileFor(new po(a,h,a,m,_));return!(!b||!b.dem)}getAtPointOrZero(o,s=0){return this.getAtPoint(o,s)||0}getAtPoint(o,s,a=!0){if(this.isUsingMockSource())return null;null==s&&(s=null);const d=this._source();if(!d||o.y<0||o.y>1)return s;const h=d.getSource().maxzoom,m=1<<h,_=Math.floor(o.x),b=o.x-_,T=new po(h,_,h,Math.floor(b*m),Math.floor(o.y*m)),S=this.findDEMTileFor(T);if(!S||!S.dem)return s;const A=S.dem,k=1<<S.tileID.canonical.z,N=(b*k-S.tileID.canonical.x)*A.dim,z=(o.y*k-S.tileID.canonical.y)*A.dim,H=Math.floor(N),q=Math.floor(z);return(a?this.exaggeration():1)*dn(dn(A.get(H,q),A.get(H,q+1),z-q),dn(A.get(H+1,q),A.get(H+1,q+1),z-q),N-H)}getAtTileOffset(o,s,a){const d=1<<o.canonical.z;return this.getAtPointOrZero(new Is(o.wrap+(o.canonical.x+s/Jt)/d,(o.canonical.y+a/Jt)/d))}getAtTileOffsetFunc(o,s,a,d){return h=>{const m=this.getAtTileOffset(o,h.x,h.y),_=d.upVector(o.canonical,h.x,h.y),b=d.upVectorScale(o.canonical,s,a).metersToTile;return f.$.scale(_,_,m*b),_}}getForTilePoints(o,s,a,d){if(this.isUsingMockSource())return!1;const h=mg.create(this,o,d);return!!h&&(s.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],a)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const s=this.findDEMTileFor(o);if(!s||!s.dem)return null;const a=s.dem.tree,d=s.tileID,h=1<<o.canonical.z-d.canonical.z;let m=o.canonical.x/h-d.canonical.x,_=o.canonical.y/h-d.canonical.y,b=0;for(let T=0;T<o.canonical.z-d.canonical.z&&!a.leaves[b];T++){m*=2,_*=2;const S=2*Math.floor(_)+Math.floor(m);b=a.childOffsets[b]+S,m%=1,_%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,s,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(0===o.length)return null;let s=!1,a=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const h of o){const m=this.getMinMaxForTile(h.tileID);m&&(a=Math.min(a,m.min),d=Math.max(d,m.max),s=!0)}return s?{min:a,max:d}:null}},f.bt=fb,f.bu=pb,f.bv=Vc,f.bw=fo,f.bx=Tg,f.by=dC,f.bz=D0,f.c=id,f.c$=function(o,s,a,d){return"custom"===o.type?new PA(o,s):new LR[o.type](o,s,a,d)},f.c0=Nb,f.c1=Ku,f.c2=450,f.c3=7,f.c4=wR,f.c5=vR,f.c6=256,f.c7=lh,f.c8=UT,f.c9=oi,f.cA=db,f.cB=function(o,s,a=0){return f.$.fromValues(((s.x-a)*o.scale-o.x)*Jt,(s.y*o.scale-o.y)*Jt,ab(s.z,s.y))},f.cC=function(o){let s=1/0,a=1/0,d=-1/0,h=-1/0;for(const m of o)s=Math.min(s,m.x),a=Math.min(a,m.y),d=Math.max(d,m.x),h=Math.max(h,m.y);return{min:new rn(s,a),max:new rn(d,h)}},f.cD=Ki,f.cE=ty,f.cF=xl,f.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.cH=SE,f.cI=W_,f.cJ=sE,f.cK=Ib,f.cL=bM,f.cM=Ly,f.cN=bw,f.cO=function(o){return o({pluginStatus:ci,pluginURL:nr}),mr.on("pluginStateChange",o),o},f.cP=yg,f.cQ=If,f.cR=Ax,f.cS=Mr,f.cT=gs,f.cU=c_,f.cV=m_,f.cW=la,f.cX=function(o){const s=o.indexOf("\x1f");return s>=0?o.slice(0,s):o},f.cY=function(o){return o.indexOf("\x1f")>=0},f.cZ=function(o){const s=o.indexOf("\x1f");return s>=0?o.slice(s+1):""},f.c_=function(o){const s=[],a=o.id;return void 0===a&&s.push({message:`layers.${a}: missing required property "id"`}),void 0===o.render&&s.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&s.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),s},f.ca=Zo,f.cb=vf,f.cc=1,f.cd=771,f.ce=0,f.cf=eb,f.cg=function(o,s,a,d,h){return Dr((o-s)/(a-s)*(h-d)+d,d,h)},f.ch=Gx,f.ci=Tp,f.cj=class{constructor(o,s,a,d){this.context=o,this.format=d,this.size=a,this.texture=o.gl.createTexture();const[h,m,_]=this.size,{gl:b}=o;b.bindTexture(b.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1);let T=this.format,S=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(T=b.DEPTH_COMPONENT16,S=b.UNSIGNED_SHORT),this.format===b.R8&&(d=b.RED),this.format===b.R32F&&(S=b.FLOAT,d=b.RED),b.texImage3D(b.TEXTURE_3D,0,T,h,m,_,0,d,S,s.data)}bind(o,s){const{context:a}=this,{gl:d}=a;d.bindTexture(d.TEXTURE_3D,this.texture),o!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,o),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,o),this.minFilter=o),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,s),this.wrapS=s)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},f.ck=nC,f.cl=[1,1,1],f.cm=mg,f.cn=Cg,f.co=_f,f.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new rn(1/0,1/0),max:new rn(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,s=!1){const a=xM(new rn(0,0),new rn(Jt,Jt),o),d=[];if(s&&!wy(a,this._globalClipBounds))return d;for(const h of this._activeRegions){if(h.hiddenByOverlap||!wy(a,h))continue;const m=LP(h.min,h.max,o);d.push({min:m.min,max:m.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return d}setSources(o){this._setSources(o.map(s=>({getSourceId:()=>s.cache.id,getFootprints:()=>{const a=[];for(const d of s.cache.getVisibleCoordinates()){const h=s.cache.getTile(d).buckets[s.layer];h&&h.updateFootprints(d.toUnwrapped(),a)}return a},getOrder:()=>s.order,getClipMask:()=>s.clipMask,getClipScope:()=>s.clipScope})))}_addSource(o){const s=o.getFootprints();if(0===s.length)return;const a=o.getOrder(),d=o.getClipMask(),h=o.getClipScope();for(const m of s){if(!m.footprint)continue;const _=xM(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:a,clipMask:d,clipScope:h})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((s,a)=>s.priority-a.priority||Mb(s.min,a.min)||Mb(s.max,a.max)||s.order-a.order||s.clipMask-a.clipMask||function(d,h){const m=(_,b)=>_+b;return d.length-h.length||d.reduce(m,"").localeCompare(h.reduce(m,""))}(s.clipScope,a.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let s=0;for(;!o&&s!==this._activeRegions.length;){const a=this._activeRegions[s],d=this._prevRegions[s];o=a.priority!==d.priority||!vM(a,d)||a.order!==d.order||a.clipMask!==d.clipMask||!Vl(a.clipScope,d.clipScope),++s}}if(o){++this._updateTime;for(const a of this._activeRegions)a.order!==Db&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const s=a=>{const d=this._activeRegions;if(a>=d.length)return a;const h=d[a].priority;for(;a<d.length&&d[a].priority===h;)++a;return a};if(this._sourceIds.length>1){let a=0,d=s(a);for(;a!==d;){let h=a;const m=a;for(;h!==d;){const _=this._activeRegions[h];_.hiddenByOverlap=!1;for(let b=0;b<m;b++){const T=this._activeRegions[b];if(!T.hiddenByOverlap&&_.order===Db&&wy(_,T)&&(_.hiddenByOverlap=oE(_.footprint,_.tileId,T.footprint,T.tileId),_.hiddenByOverlap))break}++h}a=d,d=s(a)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let s=o.length-1;s>=0;s--)this._addSource(o[s]);this._computeReplacement()}},f.cq=ho,f.cr=rw,f.cs=X1,f.ct=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,s){const a=new Vc,d=new fo,h=[],m=o+1+2,_=s[0]+1,b=s[0]+1+(1+s.length),T=(S,A,k)=>{let N=S===m-1?S-2:0===S?S:S-1;return N+=k?24575:0,[N,A]};for(let S=0;S<m;++S)a.emplaceBack(...T(S,0,!0));for(let S=0;S<_;++S)for(let A=0;A<m;++A)a.emplaceBack(...T(A,S,(0===A||A===m-1)&&!0));for(let S=0;S<s.length;++S){const A=s[S];for(let k=0;k<m;++k)a.emplaceBack(...T(k,A,!0))}for(let S=0;S<s.length;++S){const A=d.length,k=s[S]+1+2,N=new fo;for(let q=0;q<k-1;q++){const X=q===k-2,ee=X?m*(b-s.length+S-q):m;for(let de=0;de<m-1;de++){const ue=q*m+de;0===q||X||0===de||de===m-2?(N.emplaceBack(ue+1,ue,ue+ee),N.emplaceBack(ue+ee,ue+ee+1,ue+1)):(d.emplaceBack(ue+1,ue,ue+ee),d.emplaceBack(ue+ee,ue+ee+1,ue+1))}}const z=_s.simpleSegment(0,A,a.length,d.length-A);for(let q=0;q<N.uint16.length;q+=3)d.emplaceBack(N.uint16[q],N.uint16[q+1],N.uint16[q+2]);const H=_s.simpleSegment(0,A,a.length,d.length-A);h.push({withoutSkirts:z,withSkirts:H})}return{vertices:a,indices:d,segments:h}}_createGrid(o){const s=this._fillGridMeshWithLods(64,DT);this._gridSegments=s.segments,this._gridBuffer=o.createVertexBuffer(s.vertices,fb.members),this._gridIndexBuffer=o.createIndexBuffer(s.indices,!0)}_createPoles(o){const s=new fo;for(let _=0;_<=64;_++)s.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=o.createIndexBuffer(s,!0);const a=new vf,d=new vf,h=new vf,m=new vf;this._poleSegments=[];for(let _=0,b=0;_<sb;_++){const T=360/(1<<_);a.emplaceBack(0,-xl,0,.5,0),d.emplaceBack(0,-xl,0,.5,1),h.emplaceBack(0,-xl,0,.5,.5),m.emplaceBack(0,-xl,0,.5,.5);for(let S=0;S<=64;S++){let A=S/64,k=0;const N=dn(0,T,A),[z,H,q]=bf(MP,$T,N,xl);a.emplaceBack(z,H,q,A,k),d.emplaceBack(z,H,q,A,1-k);const X=kr(N);A=.5+.5*Math.sin(X),k=.5+.5*Math.cos(X),h.emplaceBack(z,H,q,A,k),m.emplaceBack(z,H,q,A,1-k)}this._poleSegments.push(_s.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,ay,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(d,ay,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(h,ay,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(m,ay,!1)}getGridBuffers(o,s){return[this._gridBuffer,this._gridIndexBuffer,s?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,s){return[s?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,s?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},f.cu=function(o){return p_.has(o)},f.cv=Db,f.cw=Ey,f.cx=function(o,s,a=0,d=!0){const h=new rn(a,a),m=o.sub(h),_=s.add(h),b=[m,new rn(_.x,m.y),_,new rn(m.x,_.y)];return d&&b.push(m.clone()),b},f.cy=function(o,s){const a=[];for(let d=0;d<o.length;d++){const h=Qh(d-1,-1,o.length-1),m=Qh(d+1,-1,o.length-1),_=o[d],b=o[m],T=o[h].sub(_).unit(),S=b.sub(_).unit(),A=S.angleWithSep(T.x,T.y),k=T.add(S).unit().mult(-1*s/Math.sin(A/2));a.push(_.add(k))}return a},f.cz=kE,f.d=Vl,f.d$=Np,f.d0=ka,f.d1=mr,f.d2=$u,f.d3=e_,f.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},f.d5=Pc,f.d6=IT,f.d7=wf,f.d8=function([o,s,a]){const d=Math.hypot(o,s,a),h=Math.atan2(o,a),m=.5*Math.PI-Math.acos(-s/d);return new Yr(Ia(h),Ia(m))},f.d9=ga,f.dA=function(){D0().acquire(Pf)},f.dB=function(){const o=Dg;o&&(o.isPreloaded()&&1===o.numActive()?(o.release(Pf),Dg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.dC=Rf,f.dD=function(o){const s=oT();if(!s)return;const a=s.delete(u_);o&&a.catch(o).then(()=>o())},f.dE=sv,f.dF=$A,f.dG=function(o){Bp=Oa.resolveURL(o),A0||(A0=new dC(D0(),new br)),A0.broadcast("setDracoUrl",Bp)},f.dH=HA,f.dI=function(o){M0=Oa.resolveURL(o),A0||(A0=new dC(D0(),new br)),A0.broadcast("setMeshoptUrl",M0)},f.dJ=Ex,f.dK=Fe,f.dL=Sp,f.dM=yu,f.dN=kp,f.dO=xT,f.dP=Bb,f.dQ=nR,f.dR=mE,f.dS=Dm,f.dT=Xb,f.dU=v0,f.dV=function(o,s,a,d,h,m,_,b,T,S,A){o.createArrays(),o.tilePixelRatio=Jt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const k=o.layers[0].layout,N=o.layers[0]._unevaluatedLayout._values,z={};if("composite"===o.textSizeData.kind){const{minZoom:ee,maxZoom:de}=o.textSizeData;z.compositeTextSizes=[N["text-size"].possiblyEvaluate(new Qn(ee),b),N["text-size"].possiblyEvaluate(new Qn(de),b)]}if("composite"===o.iconSizeData.kind){const{minZoom:ee,maxZoom:de}=o.iconSizeData;z.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new Qn(ee),b),N["icon-size"].possiblyEvaluate(new Qn(de),b)]}z.layoutTextSize=N["text-size"].possiblyEvaluate(new Qn(T+1),b),z.layoutIconSize=N["icon-size"].possiblyEvaluate(new Qn(T+1),b),z.textMaxSize=N["text-size"].possiblyEvaluate(new Qn(18),b);const H="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),q=k.get("text-size");let X=!1;for(const ee of o.features)if(ee.icon&&ee.icon.nameSecondary){X=!0;break}for(const ee of o.features){const de=k.get("text-font").evaluate(ee,{},b).join(","),ue=q.evaluate(ee,{},b),fe=z.layoutTextSize.evaluate(ee,{},b),be=(z.layoutIconSize.evaluate(ee,{},b),{horizontal:{},vertical:void 0}),Te=ee.text;let De,Be=[0,0];if(Te){const Ke=Te.toString(),_t=k.get("text-letter-spacing").evaluate(ee,{},b)*za,Ft=k.get("text-line-height").evaluate(ee,{},b)*za,yt=Et(Ke)?_t:0,Wt=k.get("text-anchor").evaluate(ee,{},b),mt=k.get("text-variable-anchor");if(!mt){const Xt=k.get("text-radial-offset").evaluate(ee,{},b);Be=Xt?AE(Wt,[Xt*za,p0]):k.get("text-offset").evaluate(ee,{},b).map(Ut=>Ut*za)}let Tt=H?"center":k.get("text-justify").evaluate(ee,{},b);const Kt="point"===k.get("symbol-placement"),bt=Kt?k.get("text-max-width").evaluate(ee,{},b)*za:1/0,Zt=Xt=>{o.allowVerticalPlacement&&wt(Ke)&&(be.vertical=wE(Te,s,a,h,de,bt,Ft,Wt,Xt,yt,Be,Vs.vertical,!0,fe,ue))};if(!H&&mt){const Xt="auto"===Tt?mt.map(Rn=>Ly(Rn)):[Tt];let Ut=!1;for(let Rn=0;Rn<Xt.length;Rn++){const Mn=Xt[Rn];if(!be.horizontal[Mn])if(Ut)be.horizontal[Mn]=be.horizontal[0];else{const hn=wE(Te,s,a,h,de,bt,Ft,"center",Mn,yt,Be,Vs.horizontal,!1,fe,ue);hn&&(be.horizontal[Mn]=hn,Ut=1===hn.positionedLines.length)}}Zt("left")}else{if("auto"===Tt&&(Tt=Ly(Wt)),Kt||k.get("text-writing-mode").indexOf("horizontal")>=0||!wt(Ke)){const Xt=wE(Te,s,a,h,de,bt,Ft,Wt,Tt,yt,Be,Vs.horizontal,!1,fe,ue);Xt&&(be.horizontal[Tt]=Xt)}Zt(Kt?"left":Tt)}}let Ze=!1;if(ee.icon&&ee.icon.namePrimary){const Ke=d[ee.icon.namePrimary];Ke&&(De=h0(h[ee.icon.namePrimary],ee.icon.nameSecondary?h[ee.icon.nameSecondary]:void 0,k.get("icon-offset").evaluate(ee,{},b),k.get("icon-anchor").evaluate(ee,{},b)),Ze=Ke.sdf,void 0===o.sdfIcons?o.sdfIcons=Ke.sdf:o.sdfIcons!==Ke.sdf&&Ns("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==o.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const ot=cA(be.horizontal)||be.vertical;o.iconsInText||(o.iconsInText=!!ot&&ot.iconsInText),(ot||De)&&By(o,ee,be,De,d,z,fe,0,Be,Ze,_,b,S,A,X)}m&&o.generateCollisionDebugBuffers(T,o.collisionBoxArray)},f.dW=Lb,f.dX=QT,f.dY=by,f.dZ=Iy,f.d_=Ap,f.da=cg,f.db=cn,f.dc=jT,f.dd=DP,f.de=function(o){const s=[0,0,0],a=f.ae.identity(new Float64Array(16));return f.ae.multiply(a,o.pixelMatrix,o.globeMatrix),f.$.transformMat4(s,s,a),new rn(s[0],s[1])},f.df=eo,f.dg=ki,f.dh=function(o){const s=o.navigator?o.navigator.userAgent:null;return!!function(a){if(null==s_){const d=a.navigator?a.navigator.userAgent:null;s_=!!a.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return s_}(o)&&s&&(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.di=t_,f.dj=class{constructor(o,s,a){this._transformRequestFn=o,this._customAccessToken=s,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const o=function(){let s="";for(let a=0;a<10;a++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Om,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,s){return this._transformRequestFn&&this._transformRequestFn(o,s)||{url:o}}normalizeStyleURL(o,s){if(!gs(o))return o;const a=bi(o);return a.params.push(`sdk=js-${xo}`),a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||s)}normalizeGlyphsURL(o,s){if(!gs(o))return o;const a=bi(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||s)}normalizeModelURL(o,s){if(!gs(o))return o;const a=bi(o);return a.path=`/models/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||s)}normalizeSourceURL(o,s,a,d){if(!gs(o))return o;const h=bi(o);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),a&&h.params.push(`language=${a}`),d&&h.params.push(`worldview=${d}`),this._makeAPIURL(h,this._customAccessToken||s)}normalizeSpriteURL(o,s,a,d){const h=bi(o);return gs(o)?(h.path=`/styles/v1${h.path}/sprite${s}${a}`,this._makeAPIURL(h,this._customAccessToken||d)):(h.path+=`${s}${a}`,sp(h))}normalizeTileURL(o,s,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!gs(o))return o;const d=bi(o);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||a&&"raster"!==d.authority&&512===a?"@2x":""}${k1.supported?".webp":"$1"}`),"raster"===d.authority?d.path=`/${cn.RASTER_URL_PREFIX}${d.path}`:"rasterarrays"===d.authority?d.path=`/${cn.RASTERARRAYS_URL_PREFIX}${d.path}`:"3dtiles"===d.authority?d.path=`/${cn.TILES3D_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${cn.TILE_URL_VERSION}${d.path}`);const h=this._customAccessToken||function(m){for(const _ of m){const b=_.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(d.params)||cn.ACCESS_TOKEN;return cn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,h)}canonicalizeTileURL(o,s){const a=bi(o);if(!a.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let d="mapbox://";a.path.match(/^\/raster\/v1\//)?d+=`raster/${a.path.replace(`/${cn.RASTER_URL_PREFIX}/`,"")}`:a.path.match(/^\/rasterarrays\/v1\//)?d+=`rasterarrays/${a.path.replace(`/${cn.RASTERARRAYS_URL_PREFIX}/`,"")}`:d+=`tiles/${a.path.replace(`/${cn.TILE_URL_VERSION}/`,"")}`;let h=a.params;return s&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(d+=`?${h.join("&")}`),d}canonicalizeTileset(o,s){const a=!!s&&gs(s),d=[];for(const h of o.tiles||[])Hr(h)?d.push(this.canonicalizeTileURL(h,a)):d.push(h);return d}_makeAPIURL(o,s){const a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=bi(cn.API_URL);if(o.protocol=d.protocol,o.authority=d.authority,"http"===o.protocol){const h=o.params.indexOf("secure");h>=0&&o.params.splice(h,1)}if("/"!==d.path&&(o.path=`${d.path}${o.path}`),!cn.REQUIRE_ACCESS_TOKEN)return sp(o);if(s=s||cn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===s[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(h=>-1===h.indexOf("access_token")),o.params.push(`access_token=${s||""}`),sp(o)}},f.dk=function(o,s){s?p_.add(o):p_.delete(o)},f.dl=k1,f.dm=jl,f.dn=R1,f.dp=zd,f.dq=kx,f.dr=Pr,f.ds=function(o){p_.delete(o)},f.dt=f_,f.du=Rm,f.dv=ef,f.dw=xo,f.dx=function(o,s){D1=o,M1=s},f.dy=function(o,s,a=!1){if(ci===Pn||ci===fr||ci===Cr)throw new Error("setRTLTextPlugin cannot be called multiple times.");nr=Oa.resolveURL(o),ci=Pn,Ar=s,yr(),a||Sr()},f.dz=sr,f.e=Oa,f.e0=pg,f.e1=tE,f.e2=wm,f.e3=Hc,f.e4=sa,f.e5=Bd,f.e6=function(o){let s=0;if(new Uint32Array(o,0,1)[0]!==GA){const a=new Uint32Array(o,0,7),[,,d,h,m,_]=a;s=a.byteLength+h+m+_+m,(d!==o.byteLength||s>=o.byteLength)&&Ns("Invalid b3dm header information.")}return qA(o,s)},f.e7=function(o,s){const a=id(o);for(const d of a){for(const h of d.meshes)RR(h);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(NR(d.lights,s)))}return a},f.e8=vC,f.e9=_w,f.ea=Tr,f.eb=function(o){d_(),Rc&&Rc.then(s=>{s.keys().then(a=>{for(let d=0;d<a.length-o;d++)s.delete(a[d])})})},f.f=Lm,f.g=Gu,f.h=function(o,s){return $u(bo(o,{type:"json"}),s)},f.i=ip,f.j=$c,f.k=Zb,f.l=function(o){return fetch(o).then(s=>s.arrayBuffer()).then(s=>qA(s,0,o))},f.m=f0,f.n=class extends iC{},f.o=cu,f.p=dR,f.q=af,f.r=M,f.s=B,f.t=F,f.u=eh,f.v=ae,f.w=Ns,f.x=du,f.y=ye,f.z=ce}),kc(0,function(f){function xo(Ie){const te=Ie?Ie.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function ss(Ie){if("number"==typeof Ie||"boolean"==typeof Ie||"string"==typeof Ie||null==Ie)return JSON.stringify(Ie);if(Array.isArray(Ie)){let oe="[";for(const pe of Ie)oe+=`${ss(pe)},`;return`${oe}]`}let te="{";for(const oe of Object.keys(Ie).sort())te+=`${oe}:${ss(Ie[oe])},`;return`${te}}`}function cn(Ie){let te="";for(const oe of f.cG)te+=`/${ss(Ie[oe])}`;return te}class Hr{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,oe){this._layerConfigs={},this._layers={},this.update(te,[],oe)}update(te,oe,pe){this._options=pe;for(const Ee of te)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=f.c$(Ee,this.scope,null,this._options)).compileFilter(),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of oe)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const ke=function(Ee,We){const lt={};for(let it=0;it<Ee.length;it++){const Pt=We&&We[Ee[it].id]||cn(Ee[it]);We&&(We[Ee[it].id]=Pt);let Ot=lt[Pt];Ot||(Ot=lt[Pt]=[]),Ot.push(Ee[it])}const $e=[];for(const it in lt)$e.push(lt[it]);return $e}(f.dJ(this._layerConfigs),this.keyCache);for(const Ee of ke){const We=Ee.map(un=>this._layers[un.id]),lt=We[0];if("none"===lt.visibility)continue;const $e=lt.source||"";let it=this.familiesBySource[$e];it||(it=this.familiesBySource[$e]={});const Pt=lt.sourceLayer||"_geojsonTileLayer";let Ot=it[Pt];Ot||(Ot=it[Pt]=[]),Ot.push(We)}}}const gs=1*f.dM;class Jr{constructor(te){const oe={},pe=[];for(const lt in te){const $e=te[lt],it=oe[lt]={};for(const Pt in $e.glyphs){const Ot=$e.glyphs[+Pt];if(!Ot||0===Ot.bitmap.width||0===Ot.bitmap.height)continue;const un=Ot.metrics.localGlyph?gs:1,Yt={x:0,y:0,w:Ot.bitmap.width+2*un,h:Ot.bitmap.height+2*un};pe.push(Yt),it[Pt]=Yt}}const{w:ke,h:Ee}=f.k(pe),We=new f.dL({width:ke||1,height:Ee||1});for(const lt in te){const $e=te[lt];for(const it in $e.glyphs){const Pt=$e.glyphs[+it];if(!Pt||0===Pt.bitmap.width||0===Pt.bitmap.height)continue;const Ot=oe[lt][it],un=Pt.metrics.localGlyph?gs:1;f.dL.copy(Pt.bitmap,We,{x:0,y:0},{x:Ot.x+un,y:Ot.y+un},Pt.bitmap)}}this.image=We,this.positions=oe}}f.dK(Jr,"GlyphAtlas");class ii{constructor(te){this.tileID=new f.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=f.dN(te.tileID.canonical,te.projection),this.projection=te.projection,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep}parse(te,oe,pe,ke,Ee){this.status="parsing",this.data=te,this.collisionBoxArray=new f.dO;const We=new f.dP(Object.keys(te.layers).sort()),lt=new f.dQ(this.tileID,this.promoteId);lt.bucketLayerIDs=[];const $e={},it=new f.dR(256,256),Pt={featureIndex:lt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:it,availableImages:pe,brightness:this.brightness},Ot=oe.familiesBySource[this.source];for(const Dn in Ot){const es=te.layers[Dn];if(!es)continue;let Qr=!1,Wr=!1,Ws=!1;for(const aa of Ot[Dn])"symbol"===aa[0].type?Qr=!0:Wr=!0,aa[0].is3D()&&"model"!==aa[0].type&&(Ws=!0);if(this.extraShadowCaster&&!Ws||!0===this.isSymbolTile&&!Qr||!1===this.isSymbolTile&&!Wr)continue;1===es.version&&f.w(`Vector tile source "${this.source}" layer "${Dn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ei=We.encode(Dn),Ao=[];for(let aa=0;aa<es.length;aa++){const Aa=es.feature(aa),Jf=lt.getId(Aa,Dn);Ao.push({feature:Aa,id:Jf,index:aa,sourceLayerIndex:ei})}for(const aa of Ot[Dn]){const Aa=aa[0];(!this.extraShadowCaster||Aa.is3D()&&"model"!==Aa.type)&&(void 0!==this.isSymbolTile&&"symbol"===Aa.type!==this.isSymbolTile||Aa.minzoom&&this.zoom<Math.floor(Aa.minzoom)||Aa.maxzoom&&this.zoom>=Aa.maxzoom||"none"!==Aa.visibility&&(Es(aa,this.zoom,Pt.brightness,pe),($e[Aa.id]=Aa.createBucket({index:lt.bucketLayerIDs.length,layers:aa,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ei,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ao,Pt,this.tileID.canonical,this.tileTransform),lt.bucketLayerIDs.push(aa.map(Jf=>Jf.id))))}}let un,Yt,Jn,Xr;it.trim();const pr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Gr=()=>{if(un)return this.status="done",Ee(un);if(this.extraShadowCaster)this.status="done",Ee(null,{buckets:f.dJ($e).filter(Dn=>!Dn.isEmpty()),featureIndex:lt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Pt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yt&&Jn&&Xr){const Dn=new Jr(Yt),es=new f.dT(Jn,Xr,this.lut);for(const Qr in $e){const Wr=$e[Qr];Wr instanceof f.dU?(Es(Wr.layers,this.zoom,Pt.brightness,pe),f.dV(Wr,Yt,Dn.positions,Jn,es.iconPositions,this.showCollisionBoxes,pe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Wr.hasPattern&&(Wr instanceof f.dW||Wr instanceof f.dX||Wr instanceof f.c0)&&(Es(Wr.layers,this.zoom,Pt.brightness,pe),Wr.addFeatures(Pt,this.tileID.canonical,es.patternPositions,pe,this.tileTransform,this.brightness))}this.status="done",Ee(null,{buckets:f.dJ($e).filter(Qr=>!Qr.isEmpty()),featureIndex:lt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dn.image,lineAtlas:it,imageAtlas:es,brightness:Pt.brightness})}};if(!this.extraShadowCaster){const Dn=f.dS(Pt.glyphDependencies,Wr=>Object.keys(Wr).map(Number));Object.keys(Dn).length?ke.send("getGlyphs",{uid:this.uid,stacks:Dn,scope:this.scope},(Wr,Ws)=>{un||(un=Wr,Yt=Ws,Gr())},void 0,!1,pr):Yt={};const es=Object.keys(Pt.iconDependencies);es.length?ke.send("getImages",{icons:es,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Wr,Ws)=>{un||(un=Wr,Jn=Ws,Gr())},void 0,!1,pr):Jn={};const Qr=Object.keys(Pt.patternDependencies);Qr.length?ke.send("getImages",{icons:Qr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Wr,Ws)=>{un||(un=Wr,Xr=Ws,Gr())},void 0,!1,pr):Xr={}}Gr()}}function Es(Ie,te,oe,pe){const ke=new f.Y(te,{brightness:oe});for(const Ee of Ie)Ee.recalculate(ke,pe)}class ki extends f.E{constructor(te,oe,pe,ke,Ee,We){super(),this.actor=te,this.layerIndex=oe,this.availableImages=pe,this.loadVectorData=Ee||f.aq,this.loading={},this.loaded={},this.deduped=new f.ap(te.scheduler),this.isSpriteLoaded=ke,this.scheduler=te.scheduler,this.brightness=We}loadTile(te,oe){const pe=te.uid,ke=te&&te.request,Ee=ke&&ke.collectResourceTiming,We=this.loading[pe]=new ii(te);We.abort=this.loadVectorData(te,(lt,$e)=>{const it=!this.loading[pe];if(delete this.loading[pe],it||lt||!$e)return We.status="done",it||(this.loaded[pe]=We),oe(lt);const Pt=$e.rawData,Ot={};$e.expires&&(Ot.expires=$e.expires),$e.cacheControl&&(Ot.cacheControl=$e.cacheControl),We.vectorTile=$e.vectorTile||new f.dY(new f.dZ(Pt));const un=()=>{We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,(Yt,Jn)=>{if(Yt||!Jn)return oe(Yt);const Xr={};if(Ee){const pr=xo(ke);pr.length>0&&(Xr.resourceTiming=JSON.parse(JSON.stringify(pr)))}oe(null,f.Q({rawTileData:Pt.slice(0)},Jn,Ot,Xr))})};this.isSpriteLoaded?un():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(un,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):un()}),this.loaded=this.loaded||{},this.loaded[pe]=We})}reloadTile(te,oe){const pe=this.loaded,ke=te.uid;if(pe&&pe[ke]){const Ee=pe[ke];Ee.showCollisionBoxes=te.showCollisionBoxes,Ee.projection=te.projection,Ee.brightness=te.brightness,Ee.tileTransform=f.dN(te.tileID.canonical,te.projection),Ee.extraShadowCaster=te.extraShadowCaster,Ee.lut=te.lut;const We=(lt,$e)=>{const it=Ee.reloadCallback;it&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,it)),oe(lt,$e)};"parsing"===Ee.status?Ee.reloadCallback=We:"done"===Ee.status&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,We):We())}else oe(null,void 0)}abortTile(te,oe){const pe=te.uid,ke=this.loading[pe];ke&&(ke.abort&&ke.abort(),delete this.loading[pe]),oe()}removeTile(te,oe){const pe=this.loaded,ke=te.uid;pe&&pe[ke]&&delete pe[ke],oe()}}class eo{loadTile(te,oe){const{uid:pe,encoding:ke,rawImageData:Ee,padding:We}=te,lt=ImageBitmap&&Ee instanceof ImageBitmap?this.getImageData(Ee,We):Ee;oe(null,new f.d_(pe,lt,ke,We<1))}getImageData(te,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const pe=this.offscreenCanvasContext.getImageData(-oe,-oe,te.width+2*oe,te.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),pe}}f.d$.setPbf(f.dZ);class Oc{decodeRasterArray({task:te,buffer:oe},pe){f.d$.performDecoding(oe,te).then(ke=>{pe(null,ke)},ke=>{pe(ke)})}}const sa=f.e0.prototype.toGeoJSON;let Ni=class{constructor(Ie){this._feature=Ie,this.extent=f.a4,this.type=Ie.type,this.properties=Ie.tags,"id"in Ie&&!isNaN(Ie.id)&&(this.id=parseInt(Ie.id,10))}loadGeometry(){if(1===this._feature.type){const Ie=[];for(const te of this._feature.geometry)Ie.push([new f.P(te[0],te[1])]);return Ie}{const Ie=[];for(const te of this._feature.geometry){const oe=[];for(const pe of te)oe.push(new f.P(pe[0],pe[1]));Ie.push(oe)}return Ie}}toGeoJSON(Ie,te,oe){return sa.call(this,Ie,te,oe)}},Oi=class{constructor(Ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.a4,this.length=Ie.length,this._features=Ie}feature(Ie){return new Ni(this._features[Ie])}};const lo=64/4096,Sa=128;class Nu{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],oe){for(const pe of te){const ke=pe.id;if(null==ke)continue;let Ee=this.features.get(ke);Ee&&this.updateCache(Ee,oe),pe.geometry?(Ee=xi(pe),this.updateCache(Ee,oe),this.features.set(ke,Ee)):this.features.delete(ke),this.updateCache(Ee,oe)}}updateCache(te,oe){for(const{canonical:pe,uid:ke}of Object.values(oe)){const{z:Ee,x:We,y:lt}=pe;$h(te,Math.pow(2,Ee),We,lt)&&delete oe[ke]}}getTile(te,oe,pe){const ke=Math.pow(2,te),Ee=[];for(const We of this.features.values())$h(We,ke,oe,pe)&&Ee.push(Hh(We,ke,oe,pe));return{features:Ee}}getFeatures(){return[...this.features.values()]}}function $h({minX:Ie,minY:te,maxX:oe,maxY:pe},ke,Ee,We){return Ie<(Ee+1+lo)/ke&&te<(We+1+lo)/ke&&oe>(Ee-lo)/ke&&pe>(We-lo)/ke}function xi(Ie){const{id:te,geometry:oe,properties:pe}=Ie;if(!oe)return;if("GeometryCollection"===oe.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ke,coordinates:Ee}=oe,We={id:te,type:1,geometry:[],tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},lt=We.geometry;if("Point"===ke)Zr(Ee,lt,We);else if("MultiPoint"===ke)for(const $e of Ee)Zr($e,lt,We);else if("LineString"===ke)We.type=2,Da(Ee,lt,We);else if("MultiLineString"===ke)We.type=2,Fu(Ee,lt,We);else if("Polygon"===ke)We.type=3,Fu(Ee,lt,We,!0);else{if("MultiPolygon"!==ke)throw new Error("Input data is not a valid GeoJSON object.");We.type=3;for(const $e of Ee)Fu($e,lt,We,!0)}return We}function Zr([Ie,te],oe,pe){const ke=f.ak(Ie);let Ee=f.al(te);Ee=Ee<0?0:Ee>1?1:Ee,oe.push(ke,Ee),pe.minX=Math.min(pe.minX,ke),pe.minY=Math.min(pe.minY,Ee),pe.maxX=Math.max(pe.maxX,ke),pe.maxY=Math.max(pe.maxY,Ee)}function Da(Ie,te,oe,pe=!1,ke=!1){const Ee=[];for(const We of Ie)Zr(We,Ee,oe);te.push(Ee),pe&&function(We,lt){let $e=0;for(let it=0,Pt=We.length,Ot=Pt-2;it<Pt;Ot=it,it+=2)$e+=(We[it]-We[Ot])*(We[it+1]+We[Ot+1]);if($e>0===lt)for(let it=0,Pt=We.length;it<Pt/2;it+=2){const Ot=We[it],un=We[it+1];We[it]=We[Pt-2-it],We[it+1]=We[Pt-1-it],We[Pt-2-it]=Ot,We[Pt-1-it]=un}}(Ee,ke)}function Fu(Ie,te,oe,pe=!1){for(let ke=0;ke<Ie.length;ke++)Da(Ie[ke],te,oe,pe,0===ke)}function Hh(Ie,te,oe,pe){const{id:ke,type:Ee,geometry:We,tags:lt}=Ie,$e=[];if(1===Ee)!function(it,Pt,Ot,un,Yt){for(let Jn=0;Jn<it.length;Jn+=2){const Xr=Math.round(f.a4*(it[Jn+0]*Pt-Ot)),pr=Math.round(f.a4*(it[Jn+1]*Pt-un));Yt.push([Xr,pr])}}(We,te,oe,pe,$e);else for(const it of We)Gh(it,te,oe,pe,$e);return{id:ke,type:Ee,geometry:$e,tags:lt}}function Gh(Ie,te,oe,pe,ke){const Ee=-Sa,We=f.a4+Sa;let lt;for(let $e=0;$e<Ie.length-2;$e+=2){let it=Math.round(f.a4*(Ie[$e+0]*te-oe)),Pt=Math.round(f.a4*(Ie[$e+1]*te-pe)),Ot=Math.round(f.a4*(Ie[$e+2]*te-oe)),un=Math.round(f.a4*(Ie[$e+3]*te-pe));const Yt=Ot-it,Jn=un-Pt;it<Ee&&Ot<Ee||(it<Ee?(Pt+=Math.round(Jn*((Ee-it)/Yt)),it=Ee):Ot<Ee&&(un=Pt+Math.round(Jn*((Ee-it)/Yt)),Ot=Ee),Pt<Ee&&un<Ee||(Pt<Ee?(it+=Math.round(Yt*((Ee-Pt)/Jn)),Pt=Ee):un<Ee&&(Ot=it+Math.round(Yt*((Ee-Pt)/Jn)),un=Ee),it>=We&&Ot>=We||(it>=We?(Pt+=Math.round(Jn*((We-it)/Yt)),it=We):Ot>=We&&(un=Pt+Math.round(Jn*((We-it)/Yt)),Ot=We),Pt>=We&&un>=We||(Pt>=We?(it+=Math.round(Yt*((We-Pt)/Jn)),Pt=We):un>=We&&(Ot=it+Math.round(Yt*((We-Pt)/Jn)),un=We),lt&&it===lt[lt.length-1][0]&&Pt===lt[lt.length-1][1]||(lt=[[it,Pt]],ke.push(lt)),lt.push([Ot,un])))))}}var mi={exports:{}},ru=f.e2,oa=f.e1.VectorTileFeature,hm=Wh;function Wh(Ie,te){this.options=te||{},this.features=Ie,this.length=Ie.length}function iu(Ie,te){this.id="number"==typeof Ie.id?Ie.id:void 0,this.type=Ie.type,this.rawGeometry=1===Ie.type?[Ie.geometry]:Ie.geometry,this.properties=Ie.tags,this.extent=te||4096}Wh.prototype.feature=function(Ie){return new iu(this.features[Ie],this.options.extent)},iu.prototype.loadGeometry=function(){var Ie=this.rawGeometry;this.geometry=[];for(var te=0;te<Ie.length;te++){for(var oe=Ie[te],pe=[],ke=0;ke<oe.length;ke++)pe.push(new ru(oe[ke][0],oe[ke][1]));this.geometry.push(pe)}return this.geometry},iu.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ie=this.geometry,te=1/0,oe=-1/0,pe=1/0,ke=-1/0,Ee=0;Ee<Ie.length;Ee++)for(var We=Ie[Ee],lt=0;lt<We.length;lt++){var $e=We[lt];te=Math.min(te,$e.x),oe=Math.max(oe,$e.x),pe=Math.min(pe,$e.y),ke=Math.max(ke,$e.y)}return[te,pe,oe,ke]},iu.prototype.toGeoJSON=oa.prototype.toGeoJSON;var ai=f.e3,Lu=hm;function Gs(Ie){var te=new ai;return function(oe,pe){for(var ke in oe.layers)pe.writeMessage(3,fm,oe.layers[ke])}(Ie,te),te.finish()}function fm(Ie,te){var oe;te.writeVarintField(15,Ie.version||1),te.writeStringField(1,Ie.name||""),te.writeVarintField(5,Ie.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<Ie.length;oe++)pe.feature=Ie.feature(oe),te.writeMessage(2,Yg,pe);var ke=pe.keys;for(oe=0;oe<ke.length;oe++)te.writeStringField(3,ke[oe]);var Ee=pe.values;for(oe=0;oe<Ee.length;oe++)te.writeMessage(4,At,Ee[oe])}function Yg(Ie,te){var oe=Ie.feature;void 0!==oe.id&&te.writeVarintField(1,oe.id),te.writeMessage(2,pm,Ie),te.writeVarintField(3,oe.type),te.writeMessage(4,Yi,oe)}function pm(Ie,te){var oe=Ie.feature,pe=Ie.keys,ke=Ie.values,Ee=Ie.keycache,We=Ie.valuecache;for(var lt in oe.properties){var $e=oe.properties[lt],it=Ee[lt];if(null!==$e){void 0===it&&(pe.push(lt),Ee[lt]=it=pe.length-1),te.writeVarint(it);var Pt=typeof $e;"string"!==Pt&&"boolean"!==Pt&&"number"!==Pt&&($e=JSON.stringify($e));var Ot=Pt+":"+$e,un=We[Ot];void 0===un&&(ke.push($e),We[Ot]=un=ke.length-1),te.writeVarint(un)}}}function er(Ie,te){return(te<<3)+(7&Ie)}function Cd(Ie){return Ie<<1^Ie>>31}function Yi(Ie,te){for(var oe=Ie.loadGeometry(),pe=Ie.type,ke=0,Ee=0,We=oe.length,lt=0;lt<We;lt++){var $e=oe[lt],it=1;1===pe&&(it=$e.length),te.writeVarint(er(1,it));for(var Pt=3===pe?$e.length-1:$e.length,Ot=0;Ot<Pt;Ot++){1===Ot&&1!==pe&&te.writeVarint(er(2,Pt-1));var un=$e[Ot].x-ke,Yt=$e[Ot].y-Ee;te.writeVarint(Cd(un)),te.writeVarint(Cd(Yt)),ke+=un,Ee+=Yt}3===pe&&te.writeVarint(er(7,1))}}function At(Ie,te){var oe=typeof Ie;"string"===oe?te.writeStringField(1,Ie):"boolean"===oe?te.writeBooleanField(7,Ie):"number"===oe&&(Ie%1!=0?te.writeDoubleField(3,Ie):Ie<0?te.writeSVarintField(6,Ie):te.writeVarintField(5,Ie))}mi.exports=Gs,mi.exports.fromVectorTileJs=Gs,mi.exports.fromGeojsonVt=function(Ie,te){te=te||{};var oe={};for(var pe in Ie)oe[pe]=new Lu(Ie[pe].features,te),oe[pe].name=pe,oe[pe].version=te.version,oe[pe].extent=te.extent;return Gs({layers:oe})},mi.exports.GeoJSONWrapper=Lu;var Ht=f.e4(mi.exports);const yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ie=>Ie},En=Math.fround||(ir=new Float32Array(1),Ie=>(ir[0]=+Ie,ir[0]));var ir;const hr=3,xr=5,Gi=6;class Cn{constructor(te){this.options=Object.assign(Object.create(yn),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:oe,minZoom:pe,maxZoom:ke}=this.options;oe&&console.time("total time");const Ee=`prepare ${te.length} points`;oe&&console.time(Ee),this.points=te;const We=[];for(let $e=0;$e<te.length;$e++){const it=te[$e];if(!it.geometry)continue;const[Pt,Ot]=it.geometry.coordinates,un=En(co(Pt)),Yt=En(Qa(Ot));We.push(un,Yt,1/0,$e,-1,1),this.options.reduce&&We.push(0)}let lt=this.trees[ke+1]=this._createTree(We);oe&&console.timeEnd(Ee);for(let $e=ke;$e>=pe;$e--){const it=+Date.now();lt=this.trees[$e]=this._createTree(this._cluster(lt,$e)),oe&&console.log("z%d: %d clusters in %dms",$e,lt.numItems,+Date.now()-it)}return oe&&console.timeEnd("total time"),this}getClusters(te,oe){let pe=((te[0]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,te[1]));let Ee=180===te[2]?180:((te[2]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)pe=-180,Ee=180;else if(pe>Ee){const Ot=this.getClusters([pe,ke,180,We],oe),un=this.getClusters([-180,ke,Ee,We],oe);return Ot.concat(un)}const lt=this.trees[this._limitZoom(oe)],$e=lt.range(co(pe),Qa(We),co(Ee),Qa(ke)),it=lt.data,Pt=[];for(const Ot of $e){const un=this.stride*Ot;Pt.push(it[un+xr]>1?Ln(it,un,this.clusterProps):this.points[it[un+hr]])}return Pt}getChildren(te){const oe=this._getOriginId(te),pe=this._getOriginZoom(te),ke="No cluster with the specified id.",Ee=this.trees[pe];if(!Ee)throw new Error(ke);const We=Ee.data;if(oe*this.stride>=We.length)throw new Error(ke);const lt=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),$e=Ee.within(We[oe*this.stride],We[oe*this.stride+1],lt),it=[];for(const Pt of $e){const Ot=Pt*this.stride;We[Ot+4]===te&&it.push(We[Ot+xr]>1?Ln(We,Ot,this.clusterProps):this.points[We[Ot+hr]])}if(0===it.length)throw new Error(ke);return it}getLeaves(te,oe,pe){const ke=[];return this._appendLeaves(ke,te,oe=oe||10,pe=pe||0,0),ke}getTile(te,oe,pe){const ke=this.trees[this._limitZoom(te)],Ee=Math.pow(2,te),{extent:We,radius:lt}=this.options,$e=lt/We,it=(pe-$e)/Ee,Pt=(pe+1+$e)/Ee,Ot={features:[]};return this._addTileFeatures(ke.range((oe-$e)/Ee,it,(oe+1+$e)/Ee,Pt),ke.data,oe,pe,Ee,Ot),0===oe&&this._addTileFeatures(ke.range(1-$e/Ee,it,1,Pt),ke.data,Ee,pe,Ee,Ot),oe===Ee-1&&this._addTileFeatures(ke.range(0,it,$e/Ee,Pt),ke.data,-1,pe,Ee,Ot),Ot.features.length?Ot:null}getClusterExpansionZoom(te){let oe=this._getOriginZoom(te)-1;for(;oe<=this.options.maxZoom;){const pe=this.getChildren(te);if(oe++,1!==pe.length)break;te=pe[0].properties.cluster_id}return oe}_appendLeaves(te,oe,pe,ke,Ee){const We=this.getChildren(oe);for(const lt of We){const $e=lt.properties;if($e&&$e.cluster?Ee+$e.point_count<=ke?Ee+=$e.point_count:Ee=this._appendLeaves(te,$e.cluster_id,pe,ke,Ee):Ee<ke?Ee++:te.push(lt),te.length===pe)break}return Ee}_createTree(te){const oe=new f.cN(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<te.length;pe+=this.stride)oe.add(te[pe],te[pe+1]);return oe.finish(),oe.data=te,oe}_addTileFeatures(te,oe,pe,ke,Ee,We){for(const lt of te){const $e=lt*this.stride,it=oe[$e+xr]>1;let Pt,Ot,un;if(it)Pt=os(oe,$e,this.clusterProps),Ot=oe[$e],un=oe[$e+1];else{const Xr=this.points[oe[$e+hr]];Pt=Xr.properties;const[pr,Gr]=Xr.geometry.coordinates;Ot=co(pr),un=Qa(Gr)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(Ot*Ee-pe)),Math.round(this.options.extent*(un*Ee-ke))]],tags:Pt};let Jn;Jn=it||this.options.generateId?oe[$e+hr]:this.points[oe[$e+hr]].id,void 0!==Jn&&(Yt.id=Jn),We.features.push(Yt)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,oe){const{radius:pe,extent:ke,reduce:Ee,minPoints:We}=this.options,lt=pe/(ke*Math.pow(2,oe)),$e=te.data,it=[],Pt=this.stride;for(let Ot=0;Ot<$e.length;Ot+=Pt){if($e[Ot+2]<=oe)continue;$e[Ot+2]=oe;const un=$e[Ot],Yt=$e[Ot+1],Jn=te.within($e[Ot],$e[Ot+1],lt),Xr=$e[Ot+xr];let pr=Xr;for(const Gr of Jn){const Dn=Gr*Pt;$e[Dn+2]>oe&&(pr+=$e[Dn+xr])}if(pr>Xr&&pr>=We){let Gr,Dn=un*Xr,es=Yt*Xr,Qr=-1;const Wr=(Ot/Pt<<5)+(oe+1)+this.points.length;for(const Ws of Jn){const ei=Ws*Pt;if($e[ei+2]<=oe)continue;$e[ei+2]=oe;const Ao=$e[ei+xr];Dn+=$e[ei]*Ao,es+=$e[ei+1]*Ao,$e[ei+4]=Wr,Ee&&(Gr||(Gr=this._map($e,Ot,!0),Qr=this.clusterProps.length,this.clusterProps.push(Gr)),Ee(Gr,this._map($e,ei)))}$e[Ot+4]=Wr,it.push(Dn/pr,es/pr,1/0,Wr,-1,pr),Ee&&it.push(Qr)}else{for(let Gr=0;Gr<Pt;Gr++)it.push($e[Ot+Gr]);if(pr>1)for(const Gr of Jn){const Dn=Gr*Pt;if(!($e[Dn+2]<=oe)){$e[Dn+2]=oe;for(let es=0;es<Pt;es++)it.push($e[Dn+es])}}}}return it}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,oe,pe){if(te[oe+xr]>1){const We=this.clusterProps[te[oe+Gi]];return pe?Object.assign({},We):We}const ke=this.points[te[oe+hr]].properties,Ee=this.options.map(ke);return pe&&Ee===ke?Object.assign({},Ee):Ee}}function Ln(Ie,te,oe){return{type:"Feature",id:Ie[te+hr],properties:os(Ie,te,oe),geometry:{type:"Point",coordinates:[(pe=Ie[te],360*(pe-.5)),Bu(Ie[te+1])]}};var pe}function os(Ie,te,oe){const pe=Ie[te+xr],ke=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,Ee=Ie[te+Gi],We=-1===Ee?{}:Object.assign({},oe[Ee]);return Object.assign(We,{cluster:!0,cluster_id:Ie[te+hr],point_count:pe,point_count_abbreviated:ke})}function co(Ie){return Ie/360+.5}function Qa(Ie){const te=Math.sin(Ie*Math.PI/180),oe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return oe<0?0:oe>1?1:oe}function Bu(Ie){const te=(180-360*Ie)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function As(Ie,te,oe,pe){let ke=pe;const Ee=te+(oe-te>>1);let We,lt=oe-te;const $e=Ie[te],it=Ie[te+1],Pt=Ie[oe],Ot=Ie[oe+1];for(let un=te+3;un<oe;un+=3){const Yt=sc(Ie[un],Ie[un+1],$e,it,Pt,Ot);if(Yt>ke)We=un,ke=Yt;else if(Yt===ke){const Jn=Math.abs(un-Ee);Jn<lt&&(We=un,lt=Jn)}}ke>pe&&(We-te>3&&As(Ie,te,We,pe),Ie[We+2]=ke,oe-We>3&&As(Ie,We,oe,pe))}function sc(Ie,te,oe,pe,ke,Ee){let We=ke-oe,lt=Ee-pe;if(0!==We||0!==lt){const $e=((Ie-oe)*We+(te-pe)*lt)/(We*We+lt*lt);$e>1?(oe=ke,pe=Ee):$e>0&&(oe+=We*$e,pe+=lt*$e)}return We=Ie-oe,lt=te-pe,We*We+lt*lt}function cs(Ie,te,oe,pe){const ke={id:Ie??null,type:te,geometry:oe,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===te||"MultiPoint"===te||"LineString"===te)Uo(ke,oe);else if("Polygon"===te)Uo(ke,oe[0]);else if("MultiLineString"===te)for(const Ee of oe)Uo(ke,Ee);else if("MultiPolygon"===te)for(const Ee of oe)Uo(ke,Ee[0]);return ke}function Uo(Ie,te){for(let oe=0;oe<te.length;oe+=3)Ie.minX=Math.min(Ie.minX,te[oe]),Ie.minY=Math.min(Ie.minY,te[oe+1]),Ie.maxX=Math.max(Ie.maxX,te[oe]),Ie.maxY=Math.max(Ie.maxY,te[oe+1])}function Sd(Ie,te,oe,pe){if(!te.geometry)return;const ke=te.geometry.coordinates;if(ke&&0===ke.length)return;const Ee=te.geometry.type,We=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let lt=[],$e=te.id;if(oe.promoteId?$e=te.properties[oe.promoteId]:oe.generateId&&($e=pe||0),"Point"===Ee)qh(ke,lt);else if("MultiPoint"===Ee)for(const it of ke)qh(it,lt);else if("LineString"===Ee)Dd(ke,lt,We,!1);else if("MultiLineString"===Ee){if(oe.lineMetrics){for(const it of ke)lt=[],Dd(it,lt,We,!1),Ie.push(cs($e,"LineString",lt,te.properties));return}Md(ke,lt,We,!1)}else if("Polygon"===Ee)Md(ke,lt,We,!0);else{if("MultiPolygon"!==Ee){if("GeometryCollection"===Ee){for(const it of te.geometry.geometries)Sd(Ie,{id:$e,geometry:it,properties:te.properties},oe,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const it of ke){const Pt=[];Md(it,Pt,We,!0),lt.push(Pt)}}Ie.push(cs($e,Ee,lt,te.properties))}function qh(Ie,te){te.push(Vo(Ie[0]),jo(Ie[1]),0)}function Dd(Ie,te,oe,pe){let ke,Ee,We=0;for(let $e=0;$e<Ie.length;$e++){const it=Vo(Ie[$e][0]),Pt=jo(Ie[$e][1]);te.push(it,Pt,0),$e>0&&(We+=pe?(ke*Pt-it*Ee)/2:Math.sqrt(Math.pow(it-ke,2)+Math.pow(Pt-Ee,2))),ke=it,Ee=Pt}const lt=te.length-3;te[2]=1,As(te,0,lt,oe),te[lt+2]=1,te.size=Math.abs(We),te.start=0,te.end=te.size}function Md(Ie,te,oe,pe){for(let ke=0;ke<Ie.length;ke++){const Ee=[];Dd(Ie[ke],Ee,oe,pe),te.push(Ee)}}function Vo(Ie){return Ie/360+.5}function jo(Ie){const te=Math.sin(Ie*Math.PI/180),oe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return oe<0?0:oe>1?1:oe}function cr(Ie,te,oe,pe,ke,Ee,We,lt){if(pe/=te,Ee>=(oe/=te)&&We<pe)return Ie;if(We<oe||Ee>=pe)return null;const $e=[];for(const it of Ie){const Pt=it.geometry;let Ot=it.type;const un=0===ke?it.minX:it.minY,Yt=0===ke?it.maxX:it.maxY;if(un>=oe&&Yt<pe){$e.push(it);continue}if(Yt<oe||un>=pe)continue;let Jn=[];if("Point"===Ot||"MultiPoint"===Ot)Ad(Pt,Jn,oe,pe,ke);else if("LineString"===Ot)Ma(Pt,Jn,oe,pe,ke,!1,lt.lineMetrics);else if("MultiLineString"===Ot)Zh(Pt,Jn,oe,pe,ke,!1);else if("Polygon"===Ot)Zh(Pt,Jn,oe,pe,ke,!0);else if("MultiPolygon"===Ot)for(const Xr of Pt){const pr=[];Zh(Xr,pr,oe,pe,ke,!0),pr.length&&Jn.push(pr)}if(Jn.length){if(lt.lineMetrics&&"LineString"===Ot){for(const Xr of Jn)$e.push(cs(it.id,Ot,Xr,it.tags));continue}"LineString"!==Ot&&"MultiLineString"!==Ot||(1===Jn.length?(Ot="LineString",Jn=Jn[0]):Ot="MultiLineString"),"Point"!==Ot&&"MultiPoint"!==Ot||(Ot=3===Jn.length?"Point":"MultiPoint"),$e.push(cs(it.id,Ot,Jn,it.tags))}}return $e.length?$e:null}function Ad(Ie,te,oe,pe,ke){for(let Ee=0;Ee<Ie.length;Ee+=3){const We=Ie[Ee+ke];We>=oe&&We<=pe&&ul(te,Ie[Ee],Ie[Ee+1],Ie[Ee+2])}}function Ma(Ie,te,oe,pe,ke,Ee,We){let lt=zl(Ie);const $e=0===ke?zu:mm;let it,Pt,Ot=Ie.start;for(let pr=0;pr<Ie.length-3;pr+=3){const Gr=Ie[pr],Dn=Ie[pr+1],es=Ie[pr+2],Qr=Ie[pr+3],Wr=Ie[pr+4],Ws=0===ke?Gr:Dn,ei=0===ke?Qr:Wr;let Ao=!1;We&&(it=Math.sqrt(Math.pow(Gr-Qr,2)+Math.pow(Dn-Wr,2))),Ws<oe?ei>oe&&(Pt=$e(lt,Gr,Dn,Qr,Wr,oe),We&&(lt.start=Ot+it*Pt)):Ws>pe?ei<pe&&(Pt=$e(lt,Gr,Dn,Qr,Wr,pe),We&&(lt.start=Ot+it*Pt)):ul(lt,Gr,Dn,es),ei<oe&&Ws>=oe&&(Pt=$e(lt,Gr,Dn,Qr,Wr,oe),Ao=!0),ei>pe&&Ws<=pe&&(Pt=$e(lt,Gr,Dn,Qr,Wr,pe),Ao=!0),!Ee&&Ao&&(We&&(lt.end=Ot+it*Pt),te.push(lt),lt=zl(Ie)),We&&(Ot+=it)}let un=Ie.length-3;const Yt=Ie[un],Jn=Ie[un+1],Xr=0===ke?Yt:Jn;Xr>=oe&&Xr<=pe&&ul(lt,Yt,Jn,Ie[un+2]),un=lt.length-3,Ee&&un>=3&&(lt[un]!==lt[0]||lt[un+1]!==lt[1])&&ul(lt,lt[0],lt[1],lt[2]),lt.length&&te.push(lt)}function zl(Ie){const te=[];return te.size=Ie.size,te.start=Ie.start,te.end=Ie.end,te}function Zh(Ie,te,oe,pe,ke,Ee){for(const We of Ie)Ma(We,te,oe,pe,ke,Ee,!1)}function ul(Ie,te,oe,pe){Ie.push(te,oe,pe)}function zu(Ie,te,oe,pe,ke,Ee){const We=(Ee-te)/(pe-te);return ul(Ie,Ee,oe+(ke-oe)*We,1),We}function mm(Ie,te,oe,pe,ke,Ee){const We=(Ee-oe)/(ke-oe);return ul(Ie,te+(pe-te)*We,Ee,1),We}function Id(Ie,te){const oe=[];for(let pe=0;pe<Ie.length;pe++){const ke=Ie[pe],Ee=ke.type;let We;if("Point"===Ee||"MultiPoint"===Ee||"LineString"===Ee)We=Xh(ke.geometry,te);else if("MultiLineString"===Ee||"Polygon"===Ee){We=[];for(const lt of ke.geometry)We.push(Xh(lt,te))}else if("MultiPolygon"===Ee){We=[];for(const lt of ke.geometry){const $e=[];for(const it of lt)$e.push(Xh(it,te));We.push($e)}}oe.push(cs(ke.id,Ee,We,ke.tags))}return oe}function Xh(Ie,te){const oe=[];oe.size=Ie.size,void 0!==Ie.start&&(oe.start=Ie.start,oe.end=Ie.end);for(let pe=0;pe<Ie.length;pe+=3)oe.push(Ie[pe]+te,Ie[pe+1],Ie[pe+2]);return oe}function kd(Ie,te){if(Ie.transformed)return Ie;const oe=1<<Ie.z,pe=Ie.x,ke=Ie.y;for(const Ee of Ie.features){const We=Ee.geometry,lt=Ee.type;if(Ee.geometry=[],1===lt)for(let $e=0;$e<We.length;$e+=2)Ee.geometry.push(dl(We[$e],We[$e+1],te,oe,pe,ke));else for(let $e=0;$e<We.length;$e++){const it=[];for(let Pt=0;Pt<We[$e].length;Pt+=2)it.push(dl(We[$e][Pt],We[$e][Pt+1],te,oe,pe,ke));Ee.geometry.push(it)}}return Ie.transformed=!0,Ie}function dl(Ie,te,oe,pe,ke,Ee){return[Math.round(oe*(Ie*pe-ke)),Math.round(oe*(te*pe-Ee))]}function Od(Ie,te,oe,pe,ke){const Ee=te===ke.maxZoom?0:ke.tolerance/((1<<te)*ke.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:Ie.length,source:null,x:oe,y:pe,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const lt of Ie)Yh(We,lt,Ee,ke);return We}function Yh(Ie,te,oe,pe){const ke=te.geometry,Ee=te.type,We=[];if(Ie.minX=Math.min(Ie.minX,te.minX),Ie.minY=Math.min(Ie.minY,te.minY),Ie.maxX=Math.max(Ie.maxX,te.maxX),Ie.maxY=Math.max(Ie.maxY,te.maxY),"Point"===Ee||"MultiPoint"===Ee)for(let lt=0;lt<ke.length;lt+=3)We.push(ke[lt],ke[lt+1]),Ie.numPoints++,Ie.numSimplified++;else if("LineString"===Ee)Di(We,ke,Ie,oe,!1,!1);else if("MultiLineString"===Ee||"Polygon"===Ee)for(let lt=0;lt<ke.length;lt++)Di(We,ke[lt],Ie,oe,"Polygon"===Ee,0===lt);else if("MultiPolygon"===Ee)for(let lt=0;lt<ke.length;lt++){const $e=ke[lt];for(let it=0;it<$e.length;it++)Di(We,$e[it],Ie,oe,!0,0===it)}if(We.length){let lt=te.tags||null;if("LineString"===Ee&&pe.lineMetrics){lt={};for(const it in te.tags)lt[it]=te.tags[it];lt.mapbox_clip_start=ke.start/ke.size,lt.mapbox_clip_end=ke.end/ke.size}const $e={geometry:We,type:"Polygon"===Ee||"MultiPolygon"===Ee?3:"LineString"===Ee||"MultiLineString"===Ee?2:1,tags:lt};null!==te.id&&($e.id=te.id),Ie.features.push($e)}}function Di(Ie,te,oe,pe,ke,Ee){const We=pe*pe;if(pe>0&&te.size<(ke?We:pe))return void(oe.numPoints+=te.length/3);const lt=[];for(let $e=0;$e<te.length;$e+=3)(0===pe||te[$e+2]>We)&&(oe.numSimplified++,lt.push(te[$e],te[$e+1])),oe.numPoints++;ke&&function($e,it){let Pt=0;for(let Ot=0,un=$e.length,Yt=un-2;Ot<un;Yt=Ot,Ot+=2)Pt+=($e[Ot]-$e[Yt])*($e[Ot+1]+$e[Yt+1]);if(Pt>0===it)for(let Ot=0,un=$e.length;Ot<un/2;Ot+=2){const Yt=$e[Ot],Jn=$e[Ot+1];$e[Ot]=$e[un-2-Ot],$e[Ot+1]=$e[un-1-Ot],$e[un-2-Ot]=Yt,$e[un-1-Ot]=Jn}}(lt,Ee),Ie.push(lt)}const Kg={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class oc{constructor(te,oe){const pe=(oe=this.options=function(Ee,We){for(const lt in We)Ee[lt]=We[lt];return Ee}(Object.create(Kg),oe)).debug;if(pe&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let ke=function(Ee,We){const lt=[];if("FeatureCollection"===Ee.type)for(let $e=0;$e<Ee.features.length;$e++)Sd(lt,Ee.features[$e],We,$e);else Sd(lt,"Feature"===Ee.type?Ee:{geometry:Ee},We);return lt}(te,oe);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ke=function(Ee,We){const lt=We.buffer/We.extent;let $e=Ee;const it=cr(Ee,1,-1-lt,lt,0,-1,2,We),Pt=cr(Ee,1,1-lt,2+lt,0,-1,2,We);return(it||Pt)&&($e=cr(Ee,1,-lt,1+lt,0,-1,2,We)||[],it&&($e=Id(it,1).concat($e)),Pt&&($e=$e.concat(Id(Pt,-1)))),$e}(ke,oe),ke.length&&this.splitTile(ke,0,0,0),pe&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,oe,pe,ke,Ee,We,lt){const $e=[te,oe,pe,ke],it=this.options,Pt=it.debug;for(;$e.length;){ke=$e.pop(),pe=$e.pop(),oe=$e.pop(),te=$e.pop();const Ot=1<<oe,un=$o(oe,pe,ke);let Yt=this.tiles[un];if(!Yt&&(Pt>1&&console.time("creation"),Yt=this.tiles[un]=Od(te,oe,pe,ke,it),this.tileCoords.push({z:oe,x:pe,y:ke}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,pe,ke,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));const Ao=`z${oe}`;this.stats[Ao]=(this.stats[Ao]||0)+1,this.total++}if(Yt.source=te,null==Ee){if(oe===it.indexMaxZoom||Yt.numPoints<=it.indexMaxPoints)continue}else{if(oe===it.maxZoom||oe===Ee)continue;if(null!=Ee){const Ao=Ee-oe;if(pe!==We>>Ao||ke!==lt>>Ao)continue}}if(Yt.source=null,0===te.length)continue;Pt>1&&console.time("clipping");const Jn=.5*it.buffer/it.extent,Xr=.5-Jn,pr=.5+Jn,Gr=1+Jn;let Dn=null,es=null,Qr=null,Wr=null,Ws=cr(te,Ot,pe-Jn,pe+pr,0,Yt.minX,Yt.maxX,it),ei=cr(te,Ot,pe+Xr,pe+Gr,0,Yt.minX,Yt.maxX,it);te=null,Ws&&(Dn=cr(Ws,Ot,ke-Jn,ke+pr,1,Yt.minY,Yt.maxY,it),es=cr(Ws,Ot,ke+Xr,ke+Gr,1,Yt.minY,Yt.maxY,it),Ws=null),ei&&(Qr=cr(ei,Ot,ke-Jn,ke+pr,1,Yt.minY,Yt.maxY,it),Wr=cr(ei,Ot,ke+Xr,ke+Gr,1,Yt.minY,Yt.maxY,it),ei=null),Pt>1&&console.timeEnd("clipping"),$e.push(Dn||[],oe+1,2*pe,2*ke),$e.push(es||[],oe+1,2*pe,2*ke+1),$e.push(Qr||[],oe+1,2*pe+1,2*ke),$e.push(Wr||[],oe+1,2*pe+1,2*ke+1)}}getTile(te,oe,pe){te=+te,oe=+oe,pe=+pe;const ke=this.options,{extent:Ee,debug:We}=ke;if(te<0||te>24)return null;const lt=1<<te,$e=$o(te,oe=oe+lt&lt-1,pe);if(this.tiles[$e])return kd(this.tiles[$e],Ee);We>1&&console.log("drilling down to z%d-%d-%d",te,oe,pe);let it,Pt=te,Ot=oe,un=pe;for(;!it&&Pt>0;)Pt--,Ot>>=1,un>>=1,it=this.tiles[$o(Pt,Ot,un)];return it&&it.source?(We>1&&(console.log("found parent tile z%d-%d-%d",Pt,Ot,un),console.time("drilling down")),this.splitTile(it.source,Pt,Ot,un,te,oe,pe),We>1&&console.timeEnd("drilling down"),this.tiles[$e]?kd(this.tiles[$e],Ee):null):null}}function $o(Ie,te,oe){return 32*((1<<Ie)*oe+te)+Ie}function gm(Ie,te){const oe=Ie.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const pe=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!pe)return te(null,null);const ke=new Oi(pe.features);let Ee=Ht(ke);0===Ee.byteOffset&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),te(null,{vectorTile:ke,rawData:Ee.buffer})}class Mi extends ki{constructor(te,oe,pe,ke,Ee,We){super(te,oe,pe,ke,gm,We),Ee&&(this.loadGeoJSON=Ee),this._dynamicIndex=new Nu}loadData(te,oe){const pe=te&&te.request,ke=pe&&pe.collectResourceTiming;this.loadGeoJSON(te,(Ee,We)=>{if(Ee||!We)return oe(Ee);if("object"!=typeof We)return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const $e=f.z(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===$e.result)throw new Error($e.value.map(it=>`${it.key}: ${it.message}`).join(", "));We.features=We.features.filter(it=>$e.value.evaluate({zoom:0},it))}te.dynamic?("Feature"===We.type&&(We={type:"FeatureCollection",features:[We]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(We.features,this.loaded),te.cluster&&(We.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new Cn(function({superclusterOptions:$e,clusterProperties:it}){if(!it||!$e)return $e;const Pt={},Ot={},un={accumulated:null,zoom:0},Yt={properties:null},Jn=Object.keys(it);for(const Xr of Jn){const[pr,Gr]=it[Xr],Dn=f.z(Gr),es=f.z("string"==typeof pr?[pr,["accumulated"],["get",Xr]]:pr);Pt[Xr]=Dn.value,Ot[Xr]=es.value}return $e.map=Xr=>{Yt.properties=Xr;const pr={};for(const Gr of Jn)pr[Gr]=Pt[Gr].evaluate(un,Yt);return pr},$e.reduce=(Xr,pr)=>{Yt.properties=pr;for(const Gr of Jn)un.accumulated=Xr[Gr],Xr[Gr]=Ot[Gr].evaluate(un,Yt)},$e}(te)).load(We.features):te.dynamic?this._dynamicIndex:new oc($e=We,te.geojsonVtOptions)}catch($e){return oe($e)}const lt={};if(ke){const $e=xo(pe);$e&&(lt.resourceTiming={},lt.resourceTiming[te.source]=JSON.parse(JSON.stringify($e)))}oe(null,lt)}var $e})}reloadTile(te,oe){const pe=this.loaded;return pe&&pe[te.uid]?te.partial?oe(null,void 0):super.reloadTile(te,oe):this.loadTile(te,oe)}loadGeoJSON(te,oe){if(te.request)f.h(te.request,oe);else{if("string"!=typeof te.data)return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(te.data))}catch{return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(pe){oe(pe)}}getClusterChildren(te,oe){try{oe(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(pe){oe(pe)}}getClusterLeaves(te,oe){try{oe(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(pe){oe(pe)}}}class Kh{constructor(te,oe){this.tileID=new f.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=oe}parse(te,oe,pe,ke){this.status="parsing";const Ee=new f.aQ(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),We={},lt=oe.familiesBySource[pe.source],$e=new f.dQ(Ee,pe.promoteId);return $e.bucketLayerIDs=[],$e.is3DTile=!0,f.e6(te).then(it=>{if(!it)return ke(new Error("Could not parse tile"));const Pt=f.e7(it,1/f.b7(pe.tileID.canonical)),Ot=it.json.extensionsUsed&&it.json.extensionsUsed.includes("MAPBOX_mesh_features")||it.json.asset.extras&&it.json.asset.extras.MAPBOX_mesh_features,un=it.json.extensionsUsed&&it.json.extensionsUsed.includes("EXT_meshopt_compression"),Yt=new f.Y(this.zoom,{brightness:this.brightness});for(const Jn in lt)for(const Xr of lt[Jn]){const pr=Xr[0];$e.bucketLayerIDs.push(Xr.map(Dn=>Dn.id)),pr.recalculate(Yt,[]);const Gr=new f.e8(Pt,Ee,Ot,un,this.brightness,$e);Ot||(Gr.needsUpload=!0),We[pr.fqid]=Gr,Gr.evaluate(pr)}this.status="done",ke(null,{buckets:We,featureIndex:$e})}).catch(it=>ke(new Error(it.message)))}}class Hi{constructor(te,oe,pe,ke,Ee,We){this.actor=te,this.layerIndex=oe,this.brightness=We,this.loading={},this.loaded={}}loadTile(te,oe){const pe=te.uid,ke=this.loading[pe]=new Kh(te,this.brightness);f.e5(te.request,(Ee,We)=>{const lt=!this.loading[pe];return delete this.loading[pe],lt||Ee?(ke.status="done",lt||(this.loaded[pe]=ke),oe(Ee)):We&&0!==We.byteLength?void ke.parse(We,this.layerIndex,te,($e,it)=>{ke.status="done",this.loaded=this.loaded||{},this.loaded[pe]=ke,$e||!it?oe($e):oe(null,it)}):(ke.status="done",this.loaded[pe]=ke,oe())})}reloadTile(te,oe){const pe=this.loaded,ke=te.uid;if(pe&&pe[ke]){const Ee=pe[ke];Ee.projection=te.projection,Ee.brightness=te.brightness;const We=(lt,$e)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(te,oe)),oe(lt,$e)};"parsing"===Ee.status?Ee.reloadCallback=We:"done"===Ee.status&&this.loadTile(te,oe)}}abortTile(te,oe){const pe=te.uid;this.loading[pe]&&delete this.loading[pe],oe()}removeTile(te,oe){const pe=this.loaded,ke=te.uid;pe&&pe[ke]&&delete pe[ke],oe()}}class Kf{constructor(te){this.self=te,this.actor=new f.e9(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.aK({name:"mercator"}),this.workerSourceTypes={vector:ki,geojson:Mi,"batched-model":Hi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(oe,pe)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=pe},this.self.registerRTLTextPlugin=oe=>{if(f.ea.isParsed())throw new Error("RTL text plugin already registered.");f.ea.applyArabicShaping=oe.applyArabicShaping,f.ea.processBidirectionalText=oe.processBidirectionalText,f.ea.processStyledBidirectionalText=oe.processStyledBidirectionalText}}clearCaches(te,oe,pe){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],delete this.rasterArrayWorkerSource,pe()}checkIfReady(te,oe,pe){pe()}setReferrer(te,oe){this.referrer=oe}spriteLoaded(te,{scope:oe,isLoaded:pe}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][oe]=pe,this.workerSources[te]&&this.workerSources[te][oe])for(const ke in this.workerSources[te][oe]){const Ee=this.workerSources[te][oe][ke];for(const We in Ee){const lt=Ee[We];lt instanceof ki&&(lt.isSpriteLoaded=pe,lt.fire(new f.g("isSpriteLoaded")))}}}setImages(te,{scope:oe,images:pe},ke){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][oe]=pe,this.workerSources[te]&&this.workerSources[te][oe]){for(const Ee in this.workerSources[te][oe]){const We=this.workerSources[te][oe][Ee];for(const lt in We)We[lt].availableImages=pe}ke()}else ke()}setProjection(te,oe){this.projections[te]=f.aK(oe)}setBrightness(te,oe,pe){this.brightness=oe,pe()}setLayers(te,oe,pe){this.getLayerIndex(te,oe.scope).replace(oe.layers,oe.options),pe()}updateLayers(te,oe,pe){this.getLayerIndex(te,oe.scope).update(oe.layers,oe.removedIds,oe.options),pe()}loadTile(te,oe,pe){oe.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,oe.type,oe.source,oe.scope).loadTile(oe,pe)}loadDEMTile(te,oe,pe){this.getDEMWorkerSource(te,oe.source,oe.scope).loadTile(oe,pe)}decodeRasterArray(te,oe,pe){this.getRasterArrayWorkerSource().decodeRasterArray(oe,pe)}reloadTile(te,oe,pe){oe.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,oe.type,oe.source,oe.scope).reloadTile(oe,pe)}abortTile(te,oe,pe){this.getWorkerSource(te,oe.type,oe.source,oe.scope).abortTile(oe,pe)}removeTile(te,oe,pe){this.getWorkerSource(te,oe.type,oe.source,oe.scope).removeTile(oe,pe)}removeSource(te,oe,pe){if(!(this.workerSources[te]&&this.workerSources[te][oe.scope]&&this.workerSources[te][oe.scope][oe.type]&&this.workerSources[te][oe.scope][oe.type][oe.source]))return;const ke=this.workerSources[te][oe.scope][oe.type][oe.source];delete this.workerSources[te][oe.scope][oe.type][oe.source],void 0!==ke.removeSource?ke.removeSource(oe,pe):pe()}loadWorkerSource(te,oe,pe){try{this.self.importScripts(oe.url),pe()}catch(ke){pe(ke.toString())}}syncRTLPluginState(te,oe,pe){try{f.ea.setState(oe);const ke=f.ea.getPluginURL();if(f.ea.isLoaded()&&!f.ea.isParsed()&&null!=ke){this.self.importScripts(ke);const Ee=f.ea.isParsed();pe(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ke}`),Ee)}}catch(ke){pe(ke.toString())}}setDracoUrl(te,oe){this.dracoUrl=oe}getAvailableImages(te,oe){this.availableImages[te]||(this.availableImages[te]={});let pe=this.availableImages[te][oe];return pe||(pe=[]),pe}getLayerIndex(te,oe){this.layerIndexes[te]||(this.layerIndexes[te]={});let pe=this.layerIndexes[te][oe];return pe||(pe=this.layerIndexes[te][oe]=new Hr,pe.scope=oe),pe}getWorkerSource(te,oe,pe,ke){return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][ke]||(this.workerSources[te][ke]={}),this.workerSources[te][ke][oe]||(this.workerSources[te][ke][oe]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.workerSources[te][ke][oe][pe]||(this.workerSources[te][ke][oe][pe]=new this.workerSourceTypes[oe]({send:(Ee,We,lt,$e,it,Pt)=>{this.actor.send(Ee,We,lt,te,it,Pt)},scheduler:this.actor.scheduler},this.getLayerIndex(te,ke),this.getAvailableImages(te,ke),this.isSpriteLoaded[te][ke],void 0,this.brightness)),this.workerSources[te][ke][oe][pe]}getDEMWorkerSource(te,oe,pe){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][pe]||(this.demWorkerSources[te][pe]={}),this.demWorkerSources[te][pe][oe]||(this.demWorkerSources[te][pe][oe]=new eo),this.demWorkerSources[te][pe][oe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Oc),this.rasterArrayWorkerSource}enforceCacheSizeLimit(te,oe){f.eb(oe)}getWorkerPerformanceMetrics(te,oe,pe){pe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Kf(self)),Kf}),kc(0,function(f){var xo=ss;function ss(y){return c=y,!(typeof window>"u"||typeof document>"u"||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,C=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(C);try{w=new Worker(M),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(M),v}()||!function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===v.width}()||(void 0===cn[p=c&&c.failIfMajorPerformanceCaveat]&&(cn[p]=function(v){var w,M,I,F,C=(M=v,I=document.createElement("canvas"),(F=Object.create(ss.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,I.getContext("webgl2",F));if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),!0===C.getShaderParameter(w,C.COMPILE_STATUS))}(p)),!cn[p]||document.documentMode));var c,p}var cn={};function Hr(y,c,p){const v=document.createElement(y);return null!=c&&(v.className=c),p&&p.appendChild(v),v}function gs(y,c,p){const v=document.createElementNS("http://www.w3.org/2000/svg",y);for(const w of Object.keys(c))v.setAttributeNS(null,w,String(c[w]));return p&&p.appendChild(v),v}ss.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Jr=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ii=Jr&&void 0!==Jr.userSelect?"userSelect":"WebkitUserSelect";let Es;function ki(){Jr&&ii&&(Es=Jr[ii],Jr[ii]="none")}function eo(){Jr&&ii&&(Jr[ii]=Es)}function Oc(y){y.preventDefault(),y.stopPropagation(),window.removeEventListener("click",Oc,!0)}function sa(){window.addEventListener("click",Oc,!0),window.setTimeout(()=>{window.removeEventListener("click",Oc,!0)},0)}function Ni(y,c){const p=y.getBoundingClientRect();return Sa(y,p,c)}function Oi(y,c){const p=y.getBoundingClientRect(),v=[];for(let w=0;w<c.length;w++)v.push(Sa(y,p,c[w]));return v}function lo(y){return void 0!==window.InstallTrigger&&2===y.button&&y.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function Sa(y,c,p){const v=y.offsetWidth===c.width?1:y.offsetWidth/c.width;return new f.P((p.clientX-c.left)*v,(p.clientY-c.top)*v)}class Nu{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(c,p){this._updatedSourceCaches[c]=p,this.setDirty()}discardSourceCacheUpdate(c){delete this._updatedSourceCaches[c]}updateLayer(c){const p=c.scope;this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._updatedLayers[p].add(c.id),this.setDirty()}removeLayer(c){const p=c.scope;this._removedLayers[p]=this._removedLayers[p]||{},this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._removedLayers[p][c.id]=c,this._updatedLayers[p].delete(c.id),this._updatedPaintProps.delete(c.fqid),this.setDirty()}getRemovedLayer(c){return this._removedLayers[c.scope]?this._removedLayers[c.scope][c.id]:null}discardLayerRemoval(c){this._removedLayers[c.scope]&&delete this._removedLayers[c.scope][c.id]}getLayerUpdatesByScope(){const c={};for(const p in this._updatedLayers)c[p]=c[p]||{},c[p].updatedIds=Array.from(this._updatedLayers[p].values());for(const p in this._removedLayers)c[p]=c[p]||{},c[p].removedIds=Object.keys(this._removedLayers[p]);return c}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(c){this._updatedPaintProps.add(c.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(c){this._updatedImages.add(c),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const $h={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xi{constructor(c,p,v,w,C,M){this.length=p.length,this.attributes=v,this.itemSize=p.bytesPerElement,this.dynamicDraw=w,this.instanceCount=M,this.context=c;const I=c.gl;this.buffer=I.createBuffer(),c.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||C||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,p){for(let v=0;v<this.attributes.length;v++){const w=p.attributes[this.attributes[v].name];void 0!==w&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,p,v){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],M=p.attributes[C.name];void 0!==M&&c.vertexAttribPointer(M,C.components,c[$h[C.type]],!1,this.itemSize,C.offset+this.itemSize*(v||0))}}setVertexAttribDivisor(c,p,v){for(let w=0;w<this.attributes.length;w++){const C=p.attributes[this.attributes[w].name];void 0!==C&&this.instanceCount&&this.instanceCount>0&&c.vertexAttribDivisor(C,v)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Zr{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Da extends Zr{getDefault(){return f.C.transparent}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Fu extends Zr{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Hh extends Zr{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Gh extends Zr{getDefault(){return[!0,!0,!0,!0]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class mi extends Zr{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class ru extends Zr{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class oa extends Zr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class hm extends Zr{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Wh extends Zr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}}class iu extends Zr{getDefault(){return[0,1]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class ai extends Zr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}}class Lu extends Zr{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Gs extends Zr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}}class fm extends Zr{getDefault(){const c=this.gl;return[c.ONE,c.ZERO,c.ONE,c.ZERO]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.blendFuncSeparate(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Yg extends Zr{getDefault(){return f.C.transparent}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class pm extends Zr{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(c,c),this.current=c,this.dirty=!1)}}class er extends Zr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}}class Cd extends Zr{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Yi extends Zr{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let At=class extends Zr{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class Ht extends Zr{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class yn extends Zr{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class En extends Zr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class ir extends Zr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class hr extends Zr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class xr extends Zr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Gi extends Zr{getDefault(){return null}set(c){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Cn extends Zr{getDefault(){return null}set(c){this.gl&&(c!==this.current||this.dirty)&&(this.gl.bindVertexArray(c),this.current=c,this.dirty=!1)}}class Ln extends Zr{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class os extends Zr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class co extends Zr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Qa extends Zr{constructor(c,p){super(c),this.context=c,this.parent=p}getDefault(){return null}}class Bu extends Qa{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class As extends Qa{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class sc extends Qa{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,this.attachment(),p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class cs extends As{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Uo{constructor(c,p,v,w,C){this.context=c,this.width=p,this.height=v;const M=this.framebuffer=c.gl.createFramebuffer();w&&(this.colorAttachment=new Bu(c,M)),C&&(this.depthAttachmentType=C,this.depthAttachment="renderbuffer"===C?new As(c,M):new sc(c,M))}destroy(){const c=this.context.gl;if(this.colorAttachment){const p=this.colorAttachment.get();p&&c.deleteTexture(p)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const p=this.depthAttachment.get();p&&c.deleteRenderbuffer(p)}else{const p=this.depthAttachment.get();p&&c.deleteTexture(p)}c.deleteFramebuffer(this.framebuffer)}}class Sd{constructor(c,p){this.gl=c,this.clearColor=new Da(this),this.clearDepth=new Fu(this),this.clearStencil=new Hh(this),this.colorMask=new Gh(this),this.depthMask=new mi(this),this.stencilMask=new ru(this),this.stencilFunc=new oa(this),this.stencilOp=new hm(this),this.stencilTest=new Wh(this),this.depthRange=new iu(this),this.depthTest=new ai(this),this.depthFunc=new Lu(this),this.blend=new Gs(this),this.blendFunc=new fm(this),this.blendColor=new Yg(this),this.blendEquation=new pm(this),this.cullFace=new er(this),this.cullFaceSide=new Cd(this),this.frontFace=new Yi(this),this.program=new At(this),this.activeTexture=new Ht(this),this.viewport=new yn(this),this.bindFramebuffer=new En(this),this.bindRenderbuffer=new ir(this),this.bindTexture=new hr(this),this.bindVertexBuffer=new xr(this),this.bindElementBuffer=new Gi(this),this.bindVertexArrayOES=new Cn(this),this.pixelStoreUnpack=new Ln(this),this.pixelStoreUnpackPremultiplyAlpha=new os(this),this.pixelStoreUnpackFlipY=new co(this),this.options=p?{...p}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=c.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),this.maxPointSize=c.getParameter(c.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,p,v){return new f.I(this,c,p,v)}createVertexBuffer(c,p,v,w,C){return new xi(this,c,p,v,w,C)}createRenderbuffer(c,p,v){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,c,p,v),this.bindRenderbuffer.set(null),C}createFramebuffer(c,p,v,w){return new Uo(this,c,p,v,w)}clear({color:c,depth:p,stencil:v,colorMask:w}){const C=this.gl;let M=0;c&&(M|=C.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set(w||[!0,!0,!0,!0])),void 0!==p&&(M|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),void 0!==v&&(M|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),C.clear(M)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){f.d(c.blendFunction,f.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor),c.blendEquation?this.blendEquation.set(c.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(c.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class qh{constructor(c,p,v,w){const C={width:v[0],height:v[1],data:null},M=c.gl;this.targetColorTexture=new f.T(c,C,M.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new f.T(c,C,M.RGBA,{useMipmap:!1}),this.context=c,this.updateParticleTexture(p,w),this.lastInvalidatedAt=0}updateParticleTexture(c,p){if(this.particleTextureDimension===p.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const v=this.context.gl,w=p.width*p.height;this.particleTexture0=new f.T(this.context,p,v.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new f.T(this.context,p,v.RGBA,{premultiply:!1,useMipmap:!1});const C=new f.S;C.reserve(w);for(let M=0;M<w;M++)C.emplaceBack(M);this.particleIndexBuffer=this.context.createVertexBuffer(C,f.p.members,!0),this.particleSegment=f.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=p.width}update(c){return!(this.lastInvalidatedAt<c&&(this.lastInvalidatedAt=f.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Dd extends f.E{constructor(c){super(),this.requestManager=c,this.models={"":{}},this.numModelsLoading={}}loadModel(c,p){return f.l(this.requestManager.transformRequest(p,f.R.Model).url).then(v=>{if(!v)return;const w=f.c(v),C=new f.M(c,void 0,void 0,w);return C.computeBoundsAndApplyParent(),C}).catch(v=>{if(v&&404===v.status)return null;this.fire(new f.f(new Error(`Could not load model ${c} from ${p}: ${v.message}`)))})}load(c,p){this.models[p]||(this.models[p]={});const v=Object.keys(c);this.numModelsLoading[p]=(this.numModelsLoading[p]||0)+v.length;const w=[];for(const C of v)w.push(this.loadModel(C,c[C]));Promise.allSettled(w).then(C=>{for(let M=0;M<C.length;M++){const{status:I,value:F}=C[M];"fulfilled"===I&&F&&(this.models[p][v[M]]={model:F,numReferences:1})}this.numModelsLoading[p]-=v.length,this.fire(new f.g("data",{dataType:"style"}))}).catch(C=>{this.fire(new f.f(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const c in this.numModelsLoading)if(this.numModelsLoading[c]>0)return!1;return!0}hasModel(c,p){return!!this.getModel(c,p)}getModel(c,p){return this.models[p]||(this.models[p]={}),this.models[p][c]?this.models[p][c].model:void 0}addModel(c,p,v){this.models[v]||(this.models[v]={}),this.hasModel(c,v)&&this.models[v][c].numReferences++,this.load({[c]:this.requestManager.normalizeModelURL(p)},v)}addModels(c,p){this.models[p]||(this.models[p]={});const v={};for(const w in c)this.models[p][w]={},v[w]=this.requestManager.normalizeModelURL(c[w]);this.load(v,p)}addModelsFromBucket(c,p){this.models[p]||(this.models[p]={});const v={};for(const w of c)this.hasModel(w,p)?this.models[p][w].numReferences++:v[w]=this.requestManager.normalizeModelURL(w);this.load(v,p)}removeModel(c,p){if(this.models[p]&&this.models[p][c]&&(this.models[p][c].numReferences--,0===this.models[p][c].numReferences)){const v=this.models[p][c].model;delete this.models[p][c],v.destroy()}}listModels(c){return this.models[c]||(this.models[c]={}),Object.keys(this.models[c])}upload(c,p){this.models[p]||(this.models[p]={});for(const v in this.models[p])this.models[p][v].model&&this.models[p][v].model.upload(c.context)}}function Md(y){const{userImage:c}=y;return!!(c&&c.render&&c.render())&&(y.data.replace(new Uint8Array(c.data.buffer)),!0)}class Vo extends f.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(c){this.images[c]={},this.loaded[c]=!1,this.updatedImages[c]={},this.patterns[c]={},this.callbackDispatchedThisFrame[c]={},this.atlasImage[c]=new f.j({width:1,height:1})}isLoaded(){for(const c in this.loaded)if(!this.loaded[c])return!1;return!0}setLoaded(c,p){if(this.loaded[p]!==c&&(this.loaded[p]=c,c)){for(const{ids:v,callback:w}of this.requestors)this._notify(v,p,w);this.requestors=[]}}hasImage(c,p){return!!this.getImage(c,p)}getImage(c,p){return this.images[p][c]}addImage(c,p,v){this._validate(c,v)&&(this.images[p][c]=v)}_validate(c,p){let v=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new f.f(new Error(`Image "${c}" has invalid "stretchX" value`))),v=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new f.f(new Error(`Image "${c}" has invalid "stretchY" value`))),v=!1),this._validateContent(p.content,p)||(this.fire(new f.f(new Error(`Image "${c}" has invalid "content" value`))),v=!1),v}_validateStretch(c,p){if(!c)return!0;let v=0;for(const w of c){if(w[0]<v||w[1]<w[0]||p<w[1])return!1;v=w[1]}return!0}_validateContent(c,p){return!(c&&(4!==c.length||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,p,v){v.version=this.images[p][c].version+1,this.images[p][c]=v,this.updatedImages[p][c]=!0}removeImage(c,p){const v=this.images[p][c];delete this.images[p][c],delete this.patterns[p][c],v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(c){return Object.keys(this.images[c])}getImages(c,p,v){let w=!0;const C=!!this.loaded[p];if(!C)for(const M of c)this.images[p][M]||(w=!1);C||w?this._notify(c,p,v):this.requestors.push({ids:c,scope:p,callback:v})}getUpdatedImages(c){return this.updatedImages[c]}_notify(c,p,v){const w={};for(const C of c){this.images[p][C]||this.fire(new f.g("styleimagemissing",{id:C}));const M=this.images[p][C];M?w[C]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!(!M.userImage||!M.userImage.render)}:f.w(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}v(null,w)}getPixelSize(c){const{width:p,height:v}=this.atlasImage[c];return{width:p,height:v}}getPattern(c,p,v){const w=this.patterns[p][c],C=this.getImage(c,p);if(!C)return null;if(w&&w.position.version===C.version)return w.position;if(w)w.position.version=C.version;else{const M={w:C.data.width+2,h:C.data.height+2,x:0,y:0},I=new f.m(M,C);this.patterns[p][c]={bin:M,position:I}}return this._updatePatternAtlas(p,v),this.patterns[p][c].position}bind(c,p){const v=c.gl;let w=this.atlasTexture[p];w?this.dirty&&(w.update(this.atlasImage[p]),this.dirty=!1):(w=new f.T(c,this.atlasImage[p],v.RGBA),this.atlasTexture[p]=w),w.bind(v.LINEAR,v.CLAMP_TO_EDGE)}_updatePatternAtlas(c,p){const v=[];for(const I in this.patterns[c])v.push(this.patterns[c][I].bin);const{w,h:C}=f.k(v),M=this.atlasImage[c];M.resize({width:w||1,height:C||1});for(const I in this.patterns[c]){const{bin:F}=this.patterns[c][I],B=F.x+1,j=F.y+1,Z=this.images[c][I].data,K=Z.width,J=Z.height;f.j.copy(Z,M,{x:0,y:0},{x:B,y:j},{width:K,height:J},p),f.j.copy(Z,M,{x:0,y:J-1},{x:B,y:j-1},{width:K,height:1},p),f.j.copy(Z,M,{x:0,y:0},{x:B,y:j+J},{width:K,height:1},p),f.j.copy(Z,M,{x:K-1,y:0},{x:B-1,y:j},{width:1,height:J},p),f.j.copy(Z,M,{x:0,y:0},{x:B+K,y:j},{width:1,height:J},p)}this.dirty=!0}beginFrame(){for(const c in this.images)this.callbackDispatchedThisFrame[c]={}}dispatchRenderCallbacks(c,p){for(const v of c){if(this.callbackDispatchedThisFrame[p][v])continue;this.callbackDispatchedThisFrame[p][v]=!0;const w=this.images[p][v];Md(w)&&this.updateImage(v,p,w)}}}function jo(y){const c=y.key,p=y.value,v=y.valueSpec||{},w=y.objectElementValidators||{},C=y.style,M=y.styleSpec;let I=[];const F=f.o(p);if("object"!==F)return[new f.V(c,p,`object expected, ${F} found`)];for(const B in p){const j=B.split(".")[0];let Z;w[j]?Z=w[j]:v[j]?Z=Hi:w["*"]?Z=w["*"]:v["*"]&&(Z=Hi),Z?I=I.concat(Z({key:(c&&`${c}.`)+B,value:p[B],valueSpec:v[j]||v["*"],style:C,styleSpec:M,object:p,objectKey:B},p)):I.push(new f.n(c,p[B],`unknown property "${B}"`))}for(const B in v)w[B]||v[B].required&&void 0===v[B].default&&void 0===p[B]&&I.push(new f.V(c,p,`missing required property "${B}"`));return I}function cr(y){const c=y.value,p=y.valueSpec,v=y.style,w=y.styleSpec,C=y.key,M=y.arrayElementValidator||Hi;if("array"!==f.o(c))return[new f.V(C,c,`array expected, ${f.o(c)} found`)];if(p.length&&c.length!==p.length)return[new f.V(C,c,`array length ${p.length} expected, length ${c.length} found`)];if(p["min-length"]&&c.length<p["min-length"])return[new f.V(C,c,`array length at least ${p["min-length"]} expected, length ${c.length} found`)];let I={type:p.value,values:p.values,minimum:p.minimum,maximum:p.maximum,function:void 0};w.$version<7&&(I.function=p.function),"object"===f.o(p.value)&&(I=p.value);let F=[];for(let B=0;B<c.length;B++)F=F.concat(M({array:c,arrayIndex:B,value:c[B],valueSpec:I,style:v,styleSpec:w,key:`${C}[${B}]`},!0));return F}function Ad(y){const c=y.key,p=y.value,v=y.valueSpec;let w=f.o(p);if("number"===w&&p!=p&&(w="NaN"),"number"!==w)return[new f.V(c,p,`number expected, ${w} found`)];if("minimum"in v){let C=v.minimum;if("array"===f.o(v.minimum)&&(C=v.minimum[y.arrayIndex]),p<C)return[new f.V(c,p,`${p} is less than the minimum value ${C}`)]}if("maximum"in v){let C=v.maximum;if("array"===f.o(v.maximum)&&(C=v.maximum[y.arrayIndex]),p>C)return[new f.V(c,p,`${p} is greater than the maximum value ${C}`)]}return[]}function Ma(y){const c=y.valueSpec,p=f.u(y.value.type);let v,w,C,M={};const I="categorical"!==p&&void 0===y.value.property,F=!I,B="array"===f.o(y.value.stops)&&"array"===f.o(y.value.stops[0])&&"object"===f.o(y.value.stops[0][0]),j=jo({key:y.key,value:y.value,valueSpec:y.styleSpec.function,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{stops:function(J){if("identity"===p)return[new f.V(J.key,J.value,'identity function may not have a "stops" property')];let ne=[];const re=J.value;return ne=ne.concat(cr({key:J.key,value:re,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:Z})),"array"===f.o(re)&&0===re.length&&ne.push(new f.V(J.key,re,"array must have at least one stop")),ne},default:function(J){return Hi({key:J.key,value:J.value,valueSpec:c,style:J.style,styleSpec:J.styleSpec})}}});return"identity"===p&&I&&j.push(new f.V(y.key,y.value,'missing required property "property"')),"identity"===p||y.value.stops||j.push(new f.V(y.key,y.value,'missing required property "stops"')),"exponential"===p&&y.valueSpec.expression&&!f.s(y.valueSpec)&&j.push(new f.V(y.key,y.value,"exponential functions not supported")),y.styleSpec.$version>=8&&(F&&!f.r(y.valueSpec)?j.push(new f.V(y.key,y.value,"property functions not supported")):I&&!f.t(y.valueSpec)&&j.push(new f.V(y.key,y.value,"zoom functions not supported"))),"categorical"!==p&&!B||void 0!==y.value.property||j.push(new f.V(y.key,y.value,'"property" property is required')),j;function Z(J){let ne=[];const re=J.value,ie=J.key;if("array"!==f.o(re))return[new f.V(ie,re,`array expected, ${f.o(re)} found`)];if(2!==re.length)return[new f.V(ie,re,`array length 2 expected, length ${re.length} found`)];if(B){if("object"!==f.o(re[0]))return[new f.V(ie,re,`object expected, ${f.o(re[0])} found`)];if(void 0===re[0].zoom)return[new f.V(ie,re,"object stop key must have zoom")];if(void 0===re[0].value)return[new f.V(ie,re,"object stop key must have value")];const se=f.u(re[0].zoom);if("number"!=typeof se)return[new f.V(ie,re[0].zoom,"stop zoom values must be numbers")];if(C&&C>se)return[new f.V(ie,re[0].zoom,"stop zoom values must appear in ascending order")];se!==C&&(C=se,w=void 0,M={}),ne=ne.concat(jo({key:`${ie}[0]`,value:re[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:Ad,value:K}}))}else ne=ne.concat(K({key:`${ie}[0]`,value:re[0],valueSpec:{},style:J.style,styleSpec:J.styleSpec},re));return f.v(f.x(re[1]))?ne.concat([new f.V(`${ie}[1]`,re[1],"expressions are not allowed in function stops.")]):ne.concat(Hi({key:`${ie}[1]`,value:re[1],valueSpec:c,style:J.style,styleSpec:J.styleSpec}))}function K(J,ne){const re=f.o(J.value),ie=f.u(J.value),se=null!==J.value?J.value:ne;if(v){if(re!==v)return[new f.V(J.key,se,`${re} stop domain type must match previous stop domain type ${v}`)]}else v=re;if("number"!==re&&"string"!==re&&"boolean"!==re&&"number"!=typeof ie&&"string"!=typeof ie&&"boolean"!=typeof ie)return[new f.V(J.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==re&&"categorical"!==p){let ge=`number expected, ${re} found`;return f.r(c)&&void 0===p&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new f.V(J.key,se,ge)]}return"categorical"!==p||"number"!==re||"number"==typeof ie&&isFinite(ie)&&Math.floor(ie)===ie?"categorical"!==p&&"number"===re&&"number"==typeof ie&&"number"==typeof w&&void 0!==w&&ie<w?[new f.V(J.key,se,"stop domain values must appear in ascending order")]:(w=ie,"categorical"===p&&ie in M?[new f.V(J.key,se,"stop domain values must be unique")]:(M[ie]=!0,[])):[new f.V(J.key,se,`integer expected, found ${String(ie)}`)]}}function zl(y){const c=("property"===y.expressionContext?f.y:f.z)(f.x(y.value),y.valueSpec);if("error"===c.result)return c.value.map(v=>new f.V(`${y.key}${v.key}`,y.value,v.message));const p=c.value.expression||c.value._styleExpression.expression;if("property"===y.expressionContext&&"text-font"===y.propertyKey&&!p.outputDefined())return[new f.V(y.key,y.value,`Invalid data expression for "${y.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===y.expressionContext&&"layout"===y.propertyType&&!f.A(p))return[new f.V(y.key,y.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===y.expressionContext)return Zh(p,y);if(y.expressionContext&&0===y.expressionContext.indexOf("cluster")){if(!f.B(p,["zoom","feature-state"]))return[new f.V(y.key,y.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===y.expressionContext&&!f.D(p))return[new f.V(y.key,y.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zh(y,c){const p=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(c.valueSpec&&c.valueSpec.expression)for(const w of c.valueSpec.expression.parameters)p.delete(w);if(0===p.size)return[];const v=[];return y instanceof f.F&&p.has(y.name)?[new f.V(c.key,c.value,`["${y.name}"] expression is not supported in a filter for a ${c.object.type} layer with id: ${c.object.id}`)]:(y.eachChild(w=>{v.push(...Zh(w,c))}),v)}function ul(y){const c=y.key,p=y.value,v=y.valueSpec,w=[];return Array.isArray(v.values)?-1===v.values.indexOf(f.u(p))&&w.push(new f.V(c,p,`expected one of [${v.values.join(", ")}], ${JSON.stringify(p)} found`)):-1===Object.keys(v.values).indexOf(f.u(p))&&w.push(new f.V(c,p,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(p)} found`)),w}function zu(y){return f.H(f.x(y.value))?zl(f.q({},y,{expressionContext:"filter",valueSpec:y.styleSpec[`filter_${y.layerType||"fill"}`]})):mm(y)}function mm(y){const c=y.value,p=y.key;if("array"!==f.o(c))return[new f.V(p,c,`array expected, ${f.o(c)} found`)];const v=y.styleSpec;let w,C=[];if(c.length<1)return[new f.V(p,c,"filter array must have at least 1 element")];switch(C=C.concat(ul({key:`${p}[0]`,value:c[0],valueSpec:v.filter_operator,style:y.style,styleSpec:y.styleSpec})),f.u(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&"$type"===f.u(c[1])&&C.push(new f.V(p,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":3!==c.length&&C.push(new f.V(p,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(w=f.o(c[1]),"string"!==w&&C.push(new f.V(`${p}[1]`,c[1],`string expected, ${w} found`)));for(let M=2;M<c.length;M++)w=f.o(c[M]),"$type"===f.u(c[1])?C=C.concat(ul({key:`${p}[${M}]`,value:c[M],valueSpec:v.geometry_type,style:y.style,styleSpec:y.styleSpec})):"string"!==w&&"number"!==w&&"boolean"!==w&&C.push(new f.V(`${p}[${M}]`,c[M],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let M=1;M<c.length;M++)C=C.concat(mm({key:`${p}[${M}]`,value:c[M],style:y.style,styleSpec:y.styleSpec}));break;case"has":case"!has":w=f.o(c[1]),2!==c.length?C.push(new f.V(p,c,`filter array for "${c[0]}" operator must have 2 elements`)):"string"!==w&&C.push(new f.V(`${p}[1]`,c[1],`string expected, ${w} found`))}return C}function Id(y,c){const p=y.key,v=y.style,w=y.layer,C=y.styleSpec,M=y.value,I=y.objectKey,F=C[`${c}_${y.layerType}`];if(!F)return[];const B=I.match(/^(.*)-transition$/);if("paint"===c&&B&&F[B[1]]&&F[B[1]].transition)return Hi({key:p,value:M,valueSpec:C.transition,style:v,styleSpec:C});const j=y.valueSpec||F[I];if(!j)return[new f.n(p,M,`unknown property "${I}"`)];let Z;if("string"===f.o(M)&&f.r(j)&&!j.tokens&&(Z=/^{([^}]+)}$/.exec(M))){const J=`\`{ "type": "identity", "property": ${Z?JSON.stringify(Z[1]):'"_"'} }\``;return[new f.V(p,M,`"${I}" does not support interpolation syntax\nUse an identity property function instead: ${J}.`)]}const K=[];if("symbol"===y.layerType)"text-field"!==I||!v||v.glyphs||v.imports||K.push(new f.V(p,M,'use of "text-field" requires a style "glyphs" property')),"text-font"===I&&f.J(f.x(M))&&"identity"===f.u(M.type)&&K.push(new f.V(p,M,'"text-font" does not support identity functions'));else if("model"===y.layerType&&"paint"===c&&w&&w.layout&&w.layout.hasOwnProperty("model-id")&&f.r(j)&&(f.K(j)||f.t(j))){const J=f.y(f.x(M),j),ne=J.value.expression||J.value._styleExpression.expression;ne&&!f.B(ne,["measure-light"])&&("model-emissive-strength"===I&&f.D(ne)&&f.A(ne)||K.push(new f.V(p,M,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return K.concat(Hi({key:y.key,value:M,valueSpec:j,style:v,styleSpec:C,expressionContext:"property",propertyType:c,propertyKey:I}))}function Xh(y){return Id(y,"paint")}function kd(y){return Id(y,"layout")}function dl(y){let c=[];const p=y.value,v=y.key,w=y.style,C=y.styleSpec;p.type||p.ref||c.push(new f.V(v,p,'either "type" or "ref" is required'));let M=f.u(p.type);const I=f.u(p.ref);if(p.id){const F=f.u(p.id);for(let B=0;B<y.arrayIndex;B++){const j=w.layers[B];f.u(j.id)===F&&c.push(new f.V(v,p.id,`duplicate layer id "${p.id}", previously used at line ${j.id.__line__}`))}}if("ref"in p){let F;["type","source","source-layer","filter","layout"].forEach(B=>{B in p&&c.push(new f.V(v,p[B],`"${B}" is prohibited for ref layers`))}),w.layers.forEach(B=>{f.u(B.id)===I&&(F=B)}),F?F.ref?c.push(new f.V(v,p.ref,"ref cannot reference another ref layer")):M=f.u(F.type):"string"==typeof I&&c.push(new f.V(v,p.ref,`ref layer "${I}" not found`))}else if("background"!==M&&"sky"!==M&&"slot"!==M)if(p.source){const F=w.sources&&w.sources[p.source],B=F&&f.u(F.type);F?"vector"===B&&"raster"===M?c.push(new f.V(v,p.source,`layer "${p.id}" requires a raster source`)):"raster"===B&&"raster"!==M?c.push(new f.V(v,p.source,`layer "${p.id}" requires a vector source`)):"vector"!==B||p["source-layer"]?"raster-dem"===B&&"hillshade"!==M?c.push(new f.V(v,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==B||["raster","raster-particle"].includes(M)?"line"!==M||!p.paint||!p.paint["line-gradient"]&&!p.paint["line-trim-offset"]||"geojson"===B&&F.lineMetrics?"raster-particle"===M&&"raster-array"!==B&&c.push(new f.V(v,p.source,`layer "${p.id}" requires a 'raster-array' source.`)):c.push(new f.V(v,p,`layer "${p.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new f.V(v,p.source,"raster-array source can only be used with layer type 'raster'.")):c.push(new f.V(v,p,`layer "${p.id}" must specify a "source-layer"`)):c.push(new f.V(v,p.source,`source "${p.source}" not found`))}else c.push(new f.V(v,p,'missing required property "source"'));return c=c.concat(jo({key:v,value:p,valueSpec:C.layer,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Hi({key:`${v}.type`,value:p.type,valueSpec:C.layer.type,style:y.style,styleSpec:y.styleSpec,object:p,objectKey:"type"}),filter:F=>zu(f.q({layerType:M},F)),layout:F=>jo({layer:p,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":B=>kd(f.q({layerType:M},B))}}),paint:F=>jo({layer:p,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":B=>Xh(f.q({layerType:M,layer:p},B))}})}})),c}function Od(y){const c=y.value,p=y.key,v=f.o(c);return"string"!==v?[new f.V(p,c,`string expected, ${v} found`)]:[]}const Yh={promoteId:function({key:y,value:c}){if("string"===f.o(c))return Od({key:y,value:c});{const p=[];for(const v in c)p.push(...Od({key:`${y}.${v}`,value:c[v]}));return p}}};function Di(y){const c=y.value,p=y.key,v=y.styleSpec,w=y.style;if(!c.type)return[new f.V(p,c,'"type" is required')];const C=f.u(c.type);let M=[];switch(["vector","raster","raster-dem","raster-array"].includes(C)&&(c.url||c.tiles||M.push(new f.n(p,c,'Either "url" or "tiles" is required.'))),C){case"vector":case"raster":case"raster-dem":case"raster-array":return M=M.concat(jo({key:p,value:c,valueSpec:v[`source_${C.replace("-","_")}`],style:y.style,styleSpec:v,objectElementValidators:Yh})),M;case"geojson":if(M=jo({key:p,value:c,valueSpec:v.source_geojson,style:w,styleSpec:v,objectElementValidators:Yh}),c.cluster)for(const I in c.clusterProperties){const[F,B]=c.clusterProperties[I],j="string"==typeof F?[F,["accumulated"],["get",I]]:F;M.push(...zl({key:`${p}.${I}.map`,value:B,expressionContext:"cluster-map"})),M.push(...zl({key:`${p}.${I}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return M;case"video":return jo({key:p,value:c,valueSpec:v.source_video,style:w,styleSpec:v});case"image":return jo({key:p,value:c,valueSpec:v.source_image,style:w,styleSpec:v});case"canvas":return[new f.V(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ul({key:`${p}.type`,value:c.type,valueSpec:{values:Kg(v)},style:w,styleSpec:v})}}function Kg(y){return y.source.reduce((c,p)=>{const v=y[p];return"enum"===v.type.type&&(c=c.concat(Object.keys(v.type.values))),c},[])}function oc(y){const c=y.value,p=y.styleSpec,v=p.light,w=y.style;let C=[];const M=f.o(c);if(void 0===c)return C;if("object"!==M)return C=C.concat([new f.V("light",c,`object expected, ${M} found`)]),C;for(const I in c){const F=I.match(/^(.*)-transition$/);C=C.concat(F&&v[F[1]]&&v[F[1]].transition?Hi({key:I,value:c[I],valueSpec:p.transition,style:w,styleSpec:p}):v[I]?Hi({key:I,value:c[I],valueSpec:v[I],style:w,styleSpec:p}):[new f.V(I,c[I],`unknown property "${I}"`)])}return C}function $o(y){const c=y.value;let p=[];if(!c)return p;const v=f.o(c);if("object"!==v)return p=p.concat([new f.V("light-3d",c,`object expected, ${v} found`)]),p;const w=y.styleSpec,C=w["light-3d"],M=y.key,I=y.style,F=y.style.lights;for(const Z of["type","id"])if(!(Z in c))return p=p.concat([new f.V("light-3d",c,`missing property ${Z} on light`)]),p;if(c.type&&F)for(let Z=0;Z<y.arrayIndex;Z++){const K=f.u(c.type),J=F[Z];f.u(J.type)===K&&p.push(new f.V(M,c.id,`duplicate light type "${c.type}", previously defined at line ${J.id.__line__}`))}const B=`properties_light_${c.type}`;if(!(B in w))return p=p.concat([new f.V("light-3d",c,`Invalid light type ${c.type}`)]),p;const j=w[B];for(const Z in c)if("properties"===Z){const K=c[Z],J=f.o(K);if("object"!==J)return p=p.concat([new f.V("properties",K,`object expected, ${J} found`)]),p;for(const ne in K)p=p.concat(j[ne]?Hi({key:ne,value:K[ne],valueSpec:j[ne],style:I,styleSpec:w}):[new f.n(y.key,K[ne],`unknown property "${ne}"`)])}else{const K=Z.match(/^(.*)-transition$/);p=p.concat(K&&C[K[1]]&&C[K[1]].transition?Hi({key:Z,value:c[Z],valueSpec:w.transition,style:I,styleSpec:w}):C[Z]?Hi({key:Z,value:c[Z],valueSpec:C[Z],style:I,styleSpec:w}):[new f.n(Z,c[Z],`unknown property "${Z}"`)])}return p}function gm(y){const c=y.value,p=y.key,v=y.style,w=y.styleSpec,C=w.terrain;let M=[];const I=f.o(c);if(void 0===c||"null"===I)return M;if("object"!==I)return M=M.concat([new f.V("terrain",c,`object expected, ${I} found`)]),M;for(const F in c){const B=F.match(/^(.*)-transition$/);M=M.concat(B&&C[B[1]]&&C[B[1]].transition?Hi({key:F,value:c[F],valueSpec:w.transition,style:v,styleSpec:w}):C[F]?Hi({key:F,value:c[F],valueSpec:C[F],style:v,styleSpec:w}):[new f.n(F,c[F],`unknown property "${F}"`)])}if(c.source){const F=v.sources&&v.sources[c.source],B=F&&f.u(F.type);F?"raster-dem"!==B&&M.push(new f.V(p,c.source,`terrain cannot be used with a source of type ${String(B)}, it only be used with a "raster-dem" source type`)):M.push(new f.V(p,c.source,`source "${c.source}" not found`))}else M.push(new f.V(p,c,'terrain is missing required property "source"'));return M}function Mi(y){const c=y.value,p=y.style,v=y.styleSpec,w=v.fog;let C=[];const M=f.o(c);if(void 0===c)return C;if("object"!==M)return C=C.concat([new f.V("fog",c,`object expected, ${M} found`)]),C;for(const I in c){const F=I.match(/^(.*)-transition$/);C=C.concat(F&&w[F[1]]&&w[F[1]].transition?Hi({key:I,value:c[I],valueSpec:v.transition,style:p,styleSpec:v}):w[I]?Hi({key:I,value:c[I],valueSpec:w[I],style:p,styleSpec:v}):[new f.n(I,c[I],`unknown property "${I}"`)])}return C}const Kh={"*":()=>[],array:cr,boolean:function(y){const c=y.value,p=y.key,v=f.o(c);return"boolean"!==v?[new f.V(p,c,`boolean expected, ${v} found`)]:[]},number:Ad,color:function(y){const c=y.key,p=y.value,v=f.o(p);return"string"!==v?[new f.V(c,p,`color expected, ${v} found`)]:null===f.G(p)?[new f.V(c,p,`color expected, "${p}" found`)]:[]},enum:ul,filter:zu,function:Ma,layer:dl,object:jo,source:Di,model:f.L,light:oc,"light-3d":$o,terrain:gm,fog:Mi,string:Od,formatted:function(y){return 0===Od(y).length?[]:zl(y)},resolvedImage:function(y){return 0===Od(y).length?[]:zl(y)},projection:function(y){const c=y.value,p=y.styleSpec,v=p.projection,w=y.style;let C=[];const M=f.o(c);if("object"===M)for(const I in c)C=C.concat(Hi({key:I,value:c[I],valueSpec:v[I],style:w,styleSpec:p}));else"string"!==M&&(C=C.concat([new f.V("projection",c,`object or string expected, ${M} found`)]));return C},import:function(y){const{value:c,styleSpec:p}=y,{data:v,...w}=c;Object.defineProperty(w,"__line__",{value:c.__line__,enumerable:!1});let C=jo(f.q({},y,{value:w,valueSpec:p.import}));return""===f.u(w.id)&&C.push(new f.V(`${y.key}.id`,w,"import id can't be an empty string")),v&&(C=C.concat(Ie(v,p,{key:`${y.key}.data`}))),C}};function Hi(y,c=!1){const p=y.value,v=y.valueSpec,w=y.styleSpec;if(v.expression&&f.J(f.u(p)))return Ma(y);if(v.expression&&f.v(f.x(p)))return zl(y);if(v.type&&Kh[v.type]){const C=Kh[v.type](y);return!0===c&&C.length>0&&"array"===f.o(y.value)?zl(y):C}return jo(f.q({},y,{valueSpec:v.type?w[v.type]:v}))}function Kf(y){const c=y.value,p=y.key,v=Od(y);return v.length||(-1===c.indexOf("{fontstack}")&&v.push(new f.V(p,c,'"glyphs" url must include a "{fontstack}" token')),-1===c.indexOf("{range}")&&v.push(new f.V(p,c,'"glyphs" url must include a "{range}" token'))),v}function Ie(y,c=f.N,p={}){return Hi({key:p.key||"",value:y,valueSpec:c.$root,styleSpec:c,style:y,objectElementValidators:{glyphs:Kf,"*":()=>[]}})}function te(y,c=f.N){return un(Ie(y,c))}const oe=y=>un(Di(y)),pe=y=>un(oc(y)),ke=y=>un($o(y)),Ee=y=>un(gm(y)),We=y=>un(Mi(y)),lt=y=>un(dl(y)),$e=y=>un(zu(y)),it=y=>un(Xh(y)),Pt=y=>un(kd(y)),Ot=y=>un(f.L(y));function un(y){return y.slice().sort((c,p)=>c.line&&p.line?c.line-p.line:0)}function Yt(y,c){let p=!1;if(c&&c.length)for(const v of c)v instanceof f.n?f.w(v.message):(y.fire(new f.f(new Error(v.message))),p=!0);return p}let Jn;class Xr extends f.E{constructor(c,p="flat"){super(),this._transitionable=new f.O(Jn||(Jn=new f.U({anchor:new f.W(f.N.light.anchor),position:new f.X(f.N.light.position),color:new f.W(f.N.light.color),intensity:new f.W(f.N.light.intensity)}))),this.setLight(c,p),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,p,v={}){this._validate(pe,c,v)||(this._transitionable.setTransitionOrValue(c),this.id=p)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,v){return(!v||!1!==v.validate)&&Yt(this,c.call(te,f.Q({value:p,style:{glyphs:!0,sprite:!0},styleSpec:f.N})))}}const pr=new f.U({source:new f.W(f.N.terrain.source),exaggeration:new f.W(f.N.terrain.exaggeration)});let Gr=class extends f.E{constructor(y,c,p,v){super(),this.scope=p,this._transitionable=new f.O(pr,p,v),this._transitionable.setTransitionOrValue(y,v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(y,c){this._transitionable.setTransitionOrValue(y,c)}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}getExaggeration(y){return this._transitioning.possiblyEvaluate(new f.Y(y)).get("exaggeration")}isZoomDependent(){const y=this._transitionable._values.exaggeration;return null!=y&&null!=y.value&&null!=y.value.expression&&y.value.expression instanceof f.Z}};const Dn=45,es=65,Qr=.05;function Wr(y,c,p,v){const w=f.a0(Dn,es,p),[C,M]=Ws(y,v);let I=1-Math.min(1,Math.exp((c-C)/(M-C)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*w*y.alpha}function Ws(y,c){const p=.5/Math.tan(.5*c);return[y.range[0]+p,y.range[1]+p]}function ei(y,c,p,v,w){const C=f.$.transformMat4([],[c,p,v],w.mercatorFogMatrix);return Wr(y,f.$.length(C),w.pitch,w._fov)}function Ao(y,c,p,v,w,C,M){const I=[[p,v,0],[w,v,0],[w,C,0],[p,C,0]];let F=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(const j of I){const Z=f.$.transformMat4([],j,c),K=f.$.length(Z);F=Math.min(F,K),B=Math.max(B,K)}return[Wr(y,F,M.pitch,M._fov),Wr(y,B,M.pitch,M._fov)]}const aa=new f.U({range:new f.W(f.N.fog.range),color:new f.W(f.N.fog.color),"high-color":new f.W(f.N.fog["high-color"]),"space-color":new f.W(f.N.fog["space-color"]),"horizon-blend":new f.W(f.N.fog["horizon-blend"]),"star-intensity":new f.W(f.N.fog["star-intensity"]),"vertical-range":new f.W(f.N.fog["vertical-range"])});class Aa extends f.E{constructor(c,p,v,w){super(),this._transitionable=new f.O(aa,v,new Map(w)),this.set(c,w),this._transitioning=this._transitionable.untransitioned(),this._transform=p,this.properties=new f.a1(aa),this.scope=v}get state(){const c=this._transform,p="globe"===c.projection.name,v=f.a2(c.zoom),w=this.properties.get("range"),C=[.5,3];return{range:p?[f.a3(C[0],w[0],v),f.a3(C[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,p,v={}){if(this._validate(We,c,v))return;const w=f.Q({},c);for(const C of Object.keys(f.N.fog))void 0===w[C]&&(w[C]=f.N.fog[C].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,p)}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:f.a0(Dn,es,c))*p.a}getOpacityAtLatLng(c,p){return this._transform.projection.supportsFog?function(v,w,C){const M=f._.fromLngLat(w),I=C.elevation?C.elevation.getAtPointOrZero(M):0;return ei(v,M.x,M.y,I,C)}(this.state,c,p):0}getOpacityForTile(c){if(!this._transform.projection.supportsFog)return[1,1];const p=this._transform.calculateFogTileMatrix(c.toUnwrapped());return Ao(this.state,p,0,0,f.a4,f.a4,this._transform)}getOpacityForBounds(c,p,v,w,C){return this._transform.projection.supportsFog?Ao(this.state,c,p,v,w,C,this._transform):[1,1]}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Ws(this.state,c):[0,1]}isVisibleOnFrustum(c){if(!this._transform.projection.supportsFog)return!1;const p=[4,5,6,7];for(const v of p){const w=c.points[v];let C;if(w[2]>=0)C=w;else{const M=c.points[v-4];C=f.a5(M,w,M[2]/(M[2]-w[2]))}if(ei(this.state,C[0],C[1],0,this._transform)>=Qr)return!0}return!1}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,v){return(!v||!1!==v.validate)&&Yt(this,c.call(te,f.Q({value:p,style:{glyphs:!0,sprite:!0},styleSpec:f.N})))}}class Jf extends f.E{constructor(c,p,v,w){super(),this.scope=v,this._options=c,this.properties=new f.a1(p),this._transitionable=new f.O(p,v,new Map(w)),this._transitionable.setTransitionOrValue(c.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(c){this._transitionable.setTransitionOrValue(this._options.properties,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(c,p){this._options=c,this._transitionable.setTransitionOrValue(c.properties,p)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}let y1,_m;var Jh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",wr="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Jg="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Pd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",fx="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",px="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",v1="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",x1="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",mx="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",gx="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",b1="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const ym=[];xm(Jh,ym),xm(Jg,ym),xm(wr,ym);const vm={"_prelude_fog.vertex.glsl":px,"_prelude_terrain.vertex.glsl":fx,"_prelude_shadow.vertex.glsl":gx,"_prelude_fog.fragment.glsl":v1,"_prelude_shadow.fragment.glsl":b1,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":x1,"_prelude_raster_particle.glsl":mx},w1={};Ur("",fx),Ur(v1,px),Ur(b1,gx),Ur(x1,""),Ur(mx,"");const Qg=Ur(wr,Jg),_x=Jh;var yx={background:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Ur("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ur('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Ur("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ur("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Ur("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Ur("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Ur('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Ur("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Ur("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Ur("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Ur("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ur('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Ur('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;\n#endif\n}'),symbolSDF:Ur('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Ur('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Ur("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Ur('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Pd),skyboxGradient:Ur('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Pd),skyboxCapture:Ur("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Ur('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Ur('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Ur("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Ur("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),occlusion:Ur("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function xm(y,c){const p=y.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let v of p)if(v=v.trim(),"#"===v[0]&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const C of w)c.includes(C)||c.push(C)}}function Ur(y,c){const p=/#include\s+"([^"]+)"/g,v=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=c.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map(B=>{const j=B.split(" ");return j[j.length-1]}),w=[...new Set(w)]);const C={},M=[],I=[];if(y=y.replace(p,(B,j)=>(I.push(j),"")),(c=c.replace(p,(B,j)=>(M.push(j),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let F=[...ym];xm(y,F),xm(c,F);for(const B of[...M,...I])vm[B]||console.error(`Undefined include: ${B}`),w1[B]||(w1[B]=[],xm(vm[B],w1[B])),F=[...F,...w1[B]];return{fragmentSource:y=y.replace(v,(B,j,Z,K,J)=>(C[J]=!0,"define"===j?`\n#ifndef HAS_UNIFORM_u_${J}\nin ${Z} ${K} ${J};\n#else\nuniform ${Z} ${K} u_${J};\n#endif\n`:"initialize"===j?`\n#ifdef HAS_UNIFORM_u_${J}\n    ${Z} ${K} ${J} = u_${J};\n#endif\n`:"define-attribute"===j?`\n#ifdef HAS_ATTRIBUTE_a_${J}\n    in ${Z} ${K} ${J};\n#endif\n`:"initialize-attribute"===j?"":void 0)),vertexSource:c=c.replace(v,(B,j,Z,K,J)=>{const ne="float"===K?"vec2":K,re=J.match(/color/)?"color":ne;return"define-attribute-vertex-shader-only"===j?`\n#ifdef HAS_ATTRIBUTE_a_${J}\nin ${Z} ${K} a_${J};\n#endif\n`:C[J]?"define"===j?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nin ${Z} ${ne} a_${J};\nout ${Z} ${K} ${J};\n#else\nuniform ${Z} ${K} u_${J};\n#endif\n`:"initialize"===j?"vec4"===re?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = a_${J};\n#else\n    ${Z} ${K} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = unpack_mix_${re}(a_${J}, u_${J}_t);\n#else\n    ${Z} ${K} ${J} = u_${J};\n#endif\n`:"define-attribute"===j?`\n#ifdef HAS_ATTRIBUTE_a_${J}\n    in ${Z} ${K} a_${J};\n    out ${Z} ${K} ${J};\n#endif\n`:"initialize-attribute"===j?`\n#ifdef HAS_ATTRIBUTE_a_${J}\n    ${J} = a_${J};\n#endif\n`:void 0:"define"===j?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nin ${Z} ${ne} a_${J};\n#else\nuniform ${Z} ${K} u_${J};\n#endif\n`:"define-instanced"===j?"mat4"===re?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${J}0;\nin vec4 a_${J}1;\nin vec4 a_${J}2;\nin vec4 a_${J}3;\n#else\nuniform ${Z} ${K} u_${J};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${Z} ${ne} a_${J};\n#else\nuniform ${Z} ${K} u_${J};\n#endif\n`:"initialize-attribute-custom"===j?`\n#ifdef HAS_ATTRIBUTE_a_${J}\n    ${Z} ${K} ${J} = a_${J};\n#endif\n`:"vec4"===re?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${Z} ${K} ${J} = a_${J};\n#else\n    ${Z} ${K} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${Z} ${K} ${J} = unpack_mix_${re}(a_${J}, u_${J}_t);\n#else\n    ${Z} ${K} ${J} = u_${J};\n#endif\n`}),staticAttributes:w,usedDefines:F,vertexIncludes:M,fragmentIncludes:I}}class nT{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,p,v,w,C,M,I,F){this.context=c;let B=this.boundPaintVertexBuffers.length!==w.length;for(let Z=0;!B&&Z<w.length;Z++)this.boundPaintVertexBuffers[Z]!==w[Z]&&(B=!0);let j=this.boundDynamicVertexBuffers.length!==I.length;for(let Z=0;!j&&Z<I.length;Z++)this.boundDynamicVertexBuffers[Z]!==I[Z]&&(j=!0);if(!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==v||B||j||this.boundIndexBuffer!==C||this.boundVertexOffset!==M)this.freshBind(p,v,w,C,M,I,F);else{c.bindVertexArrayOES.set(this.vao);for(const Z of I)Z&&(Z.bind(),F&&Z.instanceCount&&Z.setVertexAttribDivisor(c.gl,p,F));C&&C.dynamicDraw&&C.bind()}}freshBind(c,p,v,w,C,M,I){const F=c.numAttributes,B=this.context,j=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=M,p.enableAttributes(j,c),p.bind(),p.setVertexAttribPointers(j,c,C);for(const Z of v)Z.enableAttributes(j,c),Z.bind(),Z.setVertexAttribPointers(j,c,C);for(const Z of M)Z&&(Z.enableAttributes(j,c),Z.bind(),Z.setVertexAttribPointers(j,c,C),I&&Z.instanceCount&&Z.setVertexAttribDivisor(j,c,I));w&&w.bind(),B.currentNumAttributes=F}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function rT(y,c){const p=Math.pow(2,c.canonical.z),v=c.canonical.y;return[new f._(0,v/p).toLngLat().lat,new f._(0,(v+1)/p).toLngLat().lat]}function vx(y,c,p,v,w,C,M){const I=y.context,F=I.gl,B=p.hillshadeFBO;if(!B)return;y.prepareDrawTile();const j=y.isTileAffectedByFog(c),Z=y.getOrCreateProgram("hillshade",{overrideFog:j});I.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,B.colorAttachment.get());const K=((ie,se,ge,ae)=>{const ce=ge.paint.get("hillshade-shadow-color"),xe=ge.paint.get("hillshade-highlight-color"),ve=ge.paint.get("hillshade-accent-color"),ye=ge.paint.get("hillshade-emissive-strength");let Ce=f.ac(ge.paint.get("hillshade-illumination-direction"));if("viewport"===ge.paint.get("hillshade-illumination-anchor"))Ce-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const Le=ie.style.directionalLight.properties.get("direction"),Se=f.ad(Le.x,Le.y,Le.z);Ce=f.ac(Se[1])}const Me=!ie.options.moving;return{u_matrix:ae||ie.transform.calculateProjMatrix(se.tileID.toUnwrapped(),Me),u_image:0,u_latrange:rT(0,se.tileID),u_light:[ge.paint.get("hillshade-exaggeration"),Ce],u_shadow:ce.toRenderColor(ge.lut),u_highlight:xe.toRenderColor(ge.lut),u_emissive_strength:ye,u_accent:ve.toRenderColor(ge.lut)}})(y,p,v,y.terrain?c.projMatrix:null);y.uploadCommonUniforms(I,Z,c.toUnwrapped());const{tileBoundsBuffer:J,tileBoundsIndexBuffer:ne,tileBoundsSegments:re}=y.getTileBoundsBuffers(p);Z.draw(y,F.TRIANGLES,w,C,M,f.ag.disabled,K,v.id,J,ne,re)}function T1(y,c,p){if(!c.needsDEMTextureUpload)return;const v=y.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||y.getTileTexture(p.stride);const C=p.getPixels();c.demTexture?c.demTexture.update(C,{premultiply:!1}):c.demTexture=new f.T(v,C,w.R32F,{premultiply:!1}),c.needsDEMTextureUpload=!1}function xx(y,c,p){const v=y.context,w=v.gl;if(!c.dem)return;const C=c.dem;if(v.activeTexture.set(w.TEXTURE1),T1(y,c,C),!c.demTexture)return;c.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const M=C.dim;v.activeTexture.set(w.TEXTURE0);let I=c.hillshadeFBO;if(!I){const K=new f.T(v,{width:M,height:M,data:null},w.RGBA);K.bind(w.LINEAR,w.CLAMP_TO_EDGE),I=c.hillshadeFBO=v.createFramebuffer(M,M,!0,"renderbuffer"),I.colorAttachment.set(K.texture)}v.bindFramebuffer.set(I.framebuffer),v.viewport.set([0,0,M,M]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:B,tileBoundsSegments:j}=y.getMercatorTileBoundsBuffers(),Z=[];y.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),y.getOrCreateProgram("hillshadePrepare",{defines:Z}).draw(y,w.TRIANGLES,f.af.disabled,f.ah.disabled,f.a.unblended,f.ag.disabled,((K,J)=>{const ne=J.stride,re=f.ae.create();return f.ae.ortho(re,0,f.a4,-f.a4,0,0,1),f.ae.translate(re,re,[0,-f.a4,0]),{u_matrix:re,u_image:1,u_dimension:[ne,ne],u_zoom:K.overscaledZ}})(c.tileID,C),p.id,F,B,j),c.needsHillshadePrepare=!1}function E1(y,c,p,v,w){const C=function(I,F){if(I)return w(I);if(F){if(y.url&&F.tiles&&y.tiles&&delete y.tiles,F.variants){if(!Array.isArray(F.variants))return w(new Error("variants must be an array"));for(const j of F.variants){if(null==j||"object"!=typeof j||j.constructor!==Object)return w(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return w(new Error("capabilities must be an array"));if(1===j.capabilities.length&&"meshopt"===j.capabilities[0]){F=f.Q(F,j);break}}}const B=f.ai(f.Q(F,y),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);F.vector_layers&&(B.vectorLayers=F.vector_layers,B.vectorLayerIds=B.vectorLayers.map(j=>j.id)),F.raster_layers&&(B.rasterLayers=F.raster_layers,B.rasterLayerIds=B.rasterLayers.map(j=>j.id)),B.tiles=c.canonicalizeTileset(B,y.url),w(null,B)}},M=function(I,F,B){if(!I)return null;if(!F&&!B)return I;B=B||I.worldview_default;const j=Object.values(I.language||{});if(0===j.length)return null;const Z=Object.values(I.worldview||{});if(0===Z.length)return null;const K=j.every(ne=>ne===F),J=Z.every(ne=>ne===B);return K&&J?I:F in(I.language_options||{})||B in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(y.data,p,v);return M?f.e.frame(()=>C(null,M)):y.url?f.h(c.transformRequest(c.normalizeSourceURL(y.url,null,p,v),f.R.Source),C):f.e.frame(()=>{const{data:I,...F}=y;C(null,F)})}class bm{constructor(c,p,v){this.bounds=f.aj.convert(this.validateBounds(c)),this.minzoom=p||0,this.maxzoom=v||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const p=Math.pow(2,c.z),v=Math.floor(f.ak(this.bounds.getWest())*p),w=Math.floor(f.al(this.bounds.getNorth())*p),C=Math.ceil(f.ak(this.bounds.getEast())*p),M=Math.ceil(f.al(this.bounds.getSouth())*p);return c.x>=v&&c.x<C&&c.y>=w&&c.y<M}}class Ul extends f.E{constructor(c,p,v,w){super(),this.id=c,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.Q({type:"raster"},p),f.Q(this,f.ai(p,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new f.g("dataloading",{dataType:"source"})),this._tileJSONRequest=E1(this._options,this.map._requestManager,null,null,(p,v)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new f.f(p)):v&&(f.Q(this,v),v.bounds&&(this.tileBounds=new bm(v.bounds,this.minzoom,this.maxzoom)),f.ao(v.tiles),this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))),c&&c(p)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=f.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(c){this.cancelTileJSONRequest()}serialize(){return f.Q({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,p){const v=f.e.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);c.request=f.i(this.map._requestManager.transformRequest(w,f.R.Tile),(C,M,I,F)=>(delete c.request,c.aborted?(c.state="unloaded",p(null)):C?(c.state="errored",p(C)):M?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:I,expires:F}),c.setTexture(M,this.map.painter),c.state="loaded",f.an(this.dispatcher),void p(null)):p(null)))}abortTile(c,p){c.request&&(c.request.cancel(),delete c.request),p&&p()}unloadTile(c,p){c.texture&&c.texture instanceof f.T?(c.destroy(!0),c.texture&&c.texture instanceof f.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),p&&p()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class bx extends f.E{constructor(c,p,v,w){if(super(),this.id=c,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.Q(this,f.ai(p,["url","scheme","tileSize","promoteId"])),this._options=f.Q({type:"vector"},p),this._collectResourceTiming=!!p.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new f.ap}load(c){this._loaded=!1,this.fire(new f.g("dataloading",{dataType:"source"}));const p=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=E1(this._options,this.map._requestManager,p,v,(w,C)=>{this._tileJSONRequest=null,this._loaded=!0,w?(p&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${p}`),v&&2!==v.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new f.f(w))):C&&(f.Q(this,C),C.bounds&&(this.tileBounds=new bm(C.bounds,this.minzoom,this.maxzoom)),f.ao(C.tiles,this.map._requestManager._customAccessToken),this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))),c&&c(w)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=f.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(c){this.cancelTileJSONRequest()}serialize(){return f.Q({},this._options)}loadTile(c,p){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w=this.map._requestManager.transformRequest(v,f.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,M={request:w,data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,lut:C?{image:C.image.clone()}:null,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:f.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(M.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=p:c.request=c.actor.send("reloadTile",M,I.bind(this));else if(c.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",M,I.bind(this),void 0,!0);else{const F=f.aq.call({deduped:this._deduped},M,(B,j)=>{B||!j?I.call(this,B):(M.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},c.actor&&c.actor.send("loadTile",M,I.bind(this),void 0,!0))},!0);c.request={cancel:F}}function I(F,B){return delete c.request,c.aborted?p(null):F&&404!==F.status?p(F):(B&&B.resourceTiming&&(c.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&c.setExpiryData(B),c.loadVectorData(B,this.map.painter),f.an(this.dispatcher),p(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(c,p){c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const wx=(y,c,p)=>({u_matrix:y,u_image0:0,u_skirt_height:c,u_ground_shadow_factor:p}),Tx=(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:p,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_frustum_tl:M,u_frustum_tr:I,u_frustum_br:F,u_frustum_bl:B,u_globe_pos:j,u_globe_radius:Z,u_viewport:K,u_grid_matrix:re?Float32Array.from(re):new Float32Array(9),u_skirt_height:J,u_far_z_cutoff:ne});class wm{constructor(c=0,p=0,v=0,w=0){if(isNaN(c)||c<0||isNaN(p)||p<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=p,this.left=v,this.right=w}interpolate(c,p,v){return null!=p.top&&null!=c.top&&(this.top=f.a3(c.top,p.top,v)),null!=p.bottom&&null!=c.bottom&&(this.bottom=f.a3(c.bottom,p.bottom,v)),null!=p.left&&null!=c.left&&(this.left=f.a3(c.left,p.left,v)),null!=p.right&&null!=c.right&&(this.right=f.a3(c.right,p.right,v)),this}getCenter(c,p){const v=f.au((this.left+c-this.right)/2,0,c),w=f.au((this.top+p-this.bottom)/2,0,p);return new f.P(v,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new wm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Qf(y,c){const p=f.ax(y,3);f.ae.fromQuat(y,c),f.aA(y,3,p)}function rn(y,c){const p=f.aw.identity([]);return f.aw.rotateZ(p,p,-c),f.aw.rotateX(p,p,-y),p}function Vl(y,c){const p=[y[0],y[1],0],v=[c[0],c[1],0];if(f.$.length(p)>=1e-15){const M=f.$.normalize([],p);f.$.scale(v,M,f.$.dot(v,M)),c[0]=v[0],c[1]=v[1]}const w=f.$.cross([],c,y);if(f.$.len(w)<1e-15)return null;const C=Math.atan2(-w[1],w[0]);return rn(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),C)}class C1{constructor(c,p){this.position=c,this.orientation=p}get position(){return this._position}set position(c){if(c){const p=c instanceof f._?c:new f._(c[0],c[1],c[2]);this._renderWorldCopies&&(p.x=f.av(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(c,p){if(this.orientation=null,!this.position)return;const v=this.position,w=this._elevation?this._elevation.getAtPointOrZero(f._.fromLngLat(c)):0,C=f._.fromLngLat(c,w),M=[C.x-v.x,C.y-v.y,C.z-v.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=Vl(M,p)}setPitchBearing(c,p){this.orientation=rn(f.ac(c),f.ac(-p))}}class Uu{constructor(c,p){this._transform=f.ae.identity([]),this.orientation=p,this.position=c}get mercatorPosition(){const c=this.position;return new f._(c[0],c[1],c[2])}get position(){const c=f.ax(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var p;c&&f.aA(this._transform,3,[(p=c)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||f.aw.identity([]),c&&Qf(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,p){this._orientation=rn(c,p),Qf(this._transform,this._orientation)}forward(){const c=f.ax(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=f.ax(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=f.ax(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,p){const v=new Float64Array(16);return f.ae.invert(v,this.getWorldToCamera(c,p)),v}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(c,p,v){const w=this.position;f.$.scale(w,w,-c);const C=new Float64Array(16);return f.ae.fromScaling(C,[v,v,v]),f.ae.translate(C,C,w),C[10]*=p,C}getWorldToCamera(c,p){const v=new Float64Array(16),w=new Float64Array(4),C=this.position;return f.aw.conjugate(w,this._orientation),f.$.scale(C,C,-c),f.ae.fromQuat(v,w),f.ae.translate(v,v,C),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=p,v[9]*=p,v[10]*=p,v[11]*=p,v}getCameraToClipPerspective(c,p,v,w){const C=new Float64Array(16);return f.ae.perspective(C,c,p,v,w),C}getCameraToClipOrthographic(c,p,v,w,C,M){const I=new Float64Array(16);return f.ae.ortho(I,c,p,v,w,C,M),I}getDistanceToElevation(c,p=!1){const v=0===c?0:f.ay(c,p?f.az(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new Uu([...this.position],[...this.orientation])}}const kr={unknown:0,flipRequired:1,flipNotRequired:2},Ia=Math.tan(85*Math.PI/180);function ep(y,c,p,v,w,C,M){const I=f.ae.create();if(p)if("globe"===C.name){const F=f.aC(w,c);f.ae.multiply(I,I,F)}else{const F=f.aD.invert([],M);I[0]=F[0],I[1]=F[1],I[4]=F[2],I[5]=F[3],v||f.ae.rotateZ(I,I,w.angle)}else f.ae.multiply(I,w.labelPlaneMatrix,y);return I}function Tm(y,c,p,v,w,C,M){const I=ep(y,c,p,v,w,C,M);return"globe"===C.name&&p||(I[2]=I[6]=I[10]=I[14]=0),I}function e_(y,c,p,v,w,C,M){if(p){if("globe"===C.name){const I=ep(y,c,p,v,w,C,M);return f.ae.invert(I,I),f.ae.multiply(I,y,I),I}{const I=f.ae.clone(y),F=f.ae.identity([]);return F[0]=M[0],F[1]=M[1],F[4]=M[2],F[5]=M[3],f.ae.multiply(I,I,F),v||f.ae.rotateZ(I,I,-w.angle),I}}return w.glCoordMatrix}function Pc(y,c,p,v){const w=[y,c,p,1];p?f.aB.transformMat4(w,w,v):n_(w,w,v);const C=w[3];return w[0]/=C,w[1]/=C,w[2]/=C,w}function Dr(y,c){return Math.min(.5+y/c*.5,1.5)}function tp(y,c){const p=y[0]/y[3],v=y[1]/y[3];return p>=-c[0]&&p<=c[0]&&v>=-c[1]&&v<=c[1]}function Qh(y,c,p,v,w,C,M,I,F,B){const j=p.transform,Z=v?y.textSizeData:y.iconSizeData,K=f.aE(Z,p.transform.zoom),J="globe"===j.projection.name,ne=[256/p.width*2+1,256/p.height*2+1],re=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;re.clear();let ie=null;J&&(ie=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const se=y.lineVertexArray,ge=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,ae=p.transform.width/p.transform.height;let ce,xe=!1;for(let ve=0;ve<ge.length;ve++){const ye=ge.get(ve),{numGlyphs:Ce,writingMode:Me}=ye;if(Me!==f.aF.vertical||xe||ce===f.aF.horizontal||(xe=!0),ce=Me,(ye.hidden||Me===f.aF.vertical)&&!xe){np(Ce,re);continue}xe=!1;const Le=new f.P(ye.tileAnchorX,ye.tileAnchorY);let{x:Se,y:we,z:Ue}=j.projection.projectTilePoint(Le.x,Le.y,B.canonical);if(F){const[Qt,sn,fn]=F(Le);Se+=Qt,we+=sn,Ue+=fn}const et=[Se,we,Ue,1];if(f.aB.transformMat4(et,et,c),!tp(et,ne)){np(Ce,re);continue}const Fe=et[3],Mt=Dr(p.transform.getCameraToCenterDistance(j.projection),Fe),pt=f.aG(Z,K,ye),qe=M?pt/Mt:pt*Mt,at=Pc(Se,we,Ue,w);if(at[3]<=0){np(Ce,re);continue}let Pe={};const wt=M?null:F,Et=bo(ye,qe,!1,I,c,w,C,y.glyphOffsetArray,se,re,ie,at,Le,Pe,ae,wt,j.projection,B,M);xe=Et.useVertical,wt&&Et.needsFlipping&&(Pe={}),(Et.notEnoughRoom||xe||Et.needsFlipping&&bo(ye,qe,!0,I,c,w,C,y.glyphOffsetArray,se,re,ie,at,Le,Pe,ae,wt,j.projection,B,M).notEnoughRoom)&&np(Ce,re)}v?(y.text.dynamicLayoutVertexBuffer.updateData(re),ie&&y.text.globeExtVertexBuffer&&y.text.globeExtVertexBuffer.updateData(ie)):(y.icon.dynamicLayoutVertexBuffer.updateData(re),ie&&y.icon.globeExtVertexBuffer&&y.icon.globeExtVertexBuffer.updateData(ie))}function ef(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re){const{lineStartIndex:ie,glyphStartIndex:se,segment:ge}=I,ae=se+I.numGlyphs,ce=ie+I.lineLength,xe=c.getoffsetX(se),ve=c.getoffsetX(ae-1),ye=Em(y*xe,p,v,w,C,M,ge,ie,ce,F,B,j,Z,K,!0,J,ne,re);if(!ye)return null;const Ce=Em(y*ve,p,v,w,C,M,ge,ie,ce,F,B,j,Z,K,!0,J,ne,re);return Ce?{first:ye,last:Ce}:null}function Ex(y,c,p,v){return y===f.aF.horizontal&&Math.abs(v)>Math.abs(p)?{useVertical:!0}:y===f.aF.vertical?v>0?{needsFlipping:!0}:null:c!==kr.unknown&&(0===(w=p)||Math.abs(v/w)>Ia)?c===kr.flipRequired?{needsFlipping:!0}:null:p<0?{needsFlipping:!0}:null;var w}function bo(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie,se,ge){const ae=c/24,ce=y.lineOffsetX*ae,xe=y.lineOffsetY*ae,{lineStartIndex:ve,glyphStartIndex:ye,numGlyphs:Ce,segment:Me,writingMode:Le,flipState:Se}=y,we=ve+y.lineLength,Ue=et=>{if(j){const[qe,at,Pe]=et.up,wt=B.length;f.aH(j,wt+0,qe,at,Pe),f.aH(j,wt+1,qe,at,Pe),f.aH(j,wt+2,qe,at,Pe),f.aH(j,wt+3,qe,at,Pe)}const[Fe,Mt,pt]=et.point;f.aI(B,Fe,Mt,pt,et.angle)};if(Ce>1){const et=ef(ae,I,ce,xe,p,Z,K,y,F,C,J,re,!1,ie,se,ge);if(!et)return{notEnoughRoom:!0};if(v&&!p){let[Fe,Mt,pt]=et.first.point,[qe,at,Pe]=et.last.point;[Fe,Mt]=Pc(Fe,Mt,pt,M),[qe,at]=Pc(qe,at,Pe,M);const wt=Ex(Le,Se,(qe-Fe)*ne,at-Mt);if(y.flipState=wt&&wt.needsFlipping?kr.flipRequired:kr.flipNotRequired,wt)return wt}Ue(et.first);for(let Fe=ye+1;Fe<ye+Ce-1;Fe++){const Mt=Em(ae*I.getoffsetX(Fe),ce,xe,p,Z,K,Me,ve,we,F,C,J,re,!1,!1,ie,se,ge);if(!Mt)return B.length-=4*(Fe-ye),{notEnoughRoom:!0};Ue(Mt)}Ue(et.last)}else{if(v&&!p){const Fe=Pc(K.x,K.y,0,w),Mt=ve+Me+1,pt=new f.P(F.getx(Mt),F.gety(Mt)),qe=Pc(pt.x,pt.y,0,w),at=qe[3]>0?qe:t_(K,pt,Fe,1,w,void 0,ie,se.canonical),Pe=Ex(Le,Se,(at[0]-Fe[0])*ne,at[1]-Fe[1]);if(y.flipState=Pe&&Pe.needsFlipping?kr.flipRequired:kr.flipNotRequired,Pe)return Pe}const et=Em(ae*I.getoffsetX(ye),ce,xe,p,Z,K,Me,ve,we,F,C,J,re,!1,!1,ie,se,ge);if(!et)return{notEnoughRoom:!0};Ue(et)}return{}}function Cx(y,c,p,v,w){const{x:C,y:M,z:I}=v.projectTilePoint(y.x,y.y,c);if(!w)return Pc(C,M,I,p);const[F,B,j]=w(y);return Pc(C+F,M+B,I+j,p)}function t_(y,c,p,v,w,C,M,I){const F=Cx(y.sub(c)._unit()._add(y),I,w,M,C);return f.$.sub(F,p,F),f.$.normalize(F,F),f.$.scaleAndAdd(F,p,F,v)}function Em(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie,se){const ge=v?y-c:y+c;let ae=ge>0?1:-1,ce=0;v&&(ae*=-1,ce=Math.PI),ae<0&&(ce+=Math.PI);let xe=I+M+(ae>0?0:1)|0,ve=w,ye=w,Ce=0,Me=0;const Le=Math.abs(ge),Se=[],we=[];let Ue=C,et=Ue;const Fe=()=>t_(et,Ue,ye,Le-Ce+1,j,K,re,ie.canonical);for(;Ce+Me<=Le;){if(xe+=ae,xe<I||xe>=F)return null;if(ye=ve,et=Ue,Se.push(ye),J&&we.push(et),Ue=new f.P(B.getx(xe),B.gety(xe)),ve=Z[xe],!ve){const sn=Cx(Ue,ie.canonical,j,re,K);ve=sn[3]>0?Z[xe]=sn:Fe()}Ce+=Me,Me=f.$.distance(ye,ve)}ne&&K&&(Z[xe]&&(ve=Fe(),Me=f.$.distance(ye,ve)),Z[xe]=ve);const Mt=(Le-Ce)/Me,pt=Ue.sub(et)._mult(Mt)._add(et),qe=f.$.sub([],ve,ye),at=f.$.scaleAndAdd([],ye,qe,Mt);let Pe=[0,0,1],wt=qe[0],Et=qe[1];if(se&&(Pe=re.upVector(ie.canonical,pt.x,pt.y),0!==Pe[0]||0!==Pe[1]||1!==Pe[2])){const sn=[Pe[2],0,-Pe[0]],fn=f.$.cross([],Pe,sn);f.$.normalize(sn,sn),f.$.normalize(fn,fn),wt=f.$.dot(qe,sn),Et=f.$.dot(qe,fn)}if(p){const sn=f.$.cross([],Pe,qe);f.$.normalize(sn,sn),f.$.scaleAndAdd(at,at,sn,p*ae)}const Qt=ce+Math.atan2(Et,wt);return Se.push(at),J&&we.push(pt),{point:at,angle:Qt,path:Se,tilePath:we,up:Pe}}function np(y,c){const p=c.length,v=p+4*y;c.resize(v),c.float32.fill(-1/0,4*p,4*v)}function n_(y,c,p){const v=c[0],w=c[1];return y[0]=p[0]*v+p[4]*w+p[12],y[1]=p[1]*v+p[5]*w+p[13],y[3]=p[3]*v+p[7]*w+p[15],y}const Cm=(y,c,p)=>(1-p)*y+p*c,Sm=y=>y*y*y*y*y;class Dm{constructor(c,p,v,w,C,M,I){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=c||0,this._maxZoom=p||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(M),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new f.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new wm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Uu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const c=new Dm(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(c,p=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||v)&&this._updateCameraOnTerrain(),(c||v)&&this._constrainCamera(p),this._calcMatrices()}getProjection(){return f.ai(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=f.aK(this.projectionOptions);const v=this.getProjection(),w=!f.d(p,v);return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setOrthographicProjectionAtLowPitch(c){return this._orthographicProjectionAtLowPitch!==c&&(this._orthographicProjectionAtLowPitch=c,this._calcMatrices(),!0)}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=f.aK({name:"mercator"});const p=c!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return f.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.P(this.width,this.height)}get bearing(){return f.av(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const p=-c*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=f.aD.create(),f.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const p=f.au(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=f.ac(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const p=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(c){this._tileCoverLift!==c&&(this._tileCoverLift=c)}_updateCameraOnTerrain(){const c=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,p=this.elevation&&c===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||c===Number.NEGATIVE_INFINITY&&(!p||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const v=this._elevation;p||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&v.exaggeration()&&this._centerAltitudeValidForExaggeration!==v.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*v.exaggeration(),this._centerAltitudeValidForExaggeration=v.exaggeration()):(this._centerAltitude=c||0,this._centerAltitudeValidForExaggeration=v.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,C=0;for(let M=0;M<p.length;M++){const I=new f.P(p[M][0]*this.width,v+p[M][1]*(this.height-v)),F=c.pointCoordinate(I);if(!F)continue;const B=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);w+=F[3]*B,C+=B}return 0===C?NaN:w/C}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*p,w=this._mercatorZfromZoom(c),C=this._mercatorZfromZoom(this._maxZoom),M=Math.max(w-v,C);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let v;v=c.z<this._camera.position[2]?[p.x,p.y,p.z]:[c.x,c.y,c.z];const w=f.$.length(f.$.sub([],this._camera.position,v));return f.au(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let p=!1;if(c.orientation&&!f.aw.exactEquals(c.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(c.orientation)),c.position){const v=[c.position.x,c.position.y,c.position.z];f.$.exactEquals(v,this._camera.position)||(this._setCameraPosition(v),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,p=new C1;return p.position=new f._(c[0],c[1],c[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(c){if(!f.aw.length(c))return!1;f.aw.normalize(c,c);const p=f.$.transformQuat([],[0,0,-1],c),v=f.$.transformQuat([],[0,-1,0],c);if(v[2]<0)return!1;const w=Vl(p,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(c){const p=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;c[2]=f.au(c[2],w/v,w/p),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,p,v){this._unmodified=!1,this._edgeInsets.interpolate(c,p,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const p=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(c){const p=[new f.aL(0,c)];if(this.renderWorldCopies){const v=this.pointCoordinate(new f.P(0,0)),w=this.pointCoordinate(new f.P(this.width,0)),C=this.pointCoordinate(new f.P(this.width,this.height)),M=this.pointCoordinate(new f.P(0,this.height)),I=Math.floor(Math.min(v.x,w.x,C.x,M.x)),F=Math.floor(Math.max(v.x,w.x,C.x,M.x)),B=1;for(let j=I-B;j<=F+B;j++)0!==j&&p.push(new f.aL(j,c))}return p}isLODDisabled(c){return(!c||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(c,p,v){let w=[];const C=void 0!==v,M=!C;if(M&&this.zoom<p||C&&0===v[0]&&0===v[1])return w;const I=new Set,F=(j,Z,K,J,ne)=>{const re=f.b2(Z,j,K,J,ne);I.has(re)||(w.push(new f.aQ(j,Z,K,J,ne)),I.add(re))};for(let j=0;j<c.length;j++){const Z=c[j];if(M&&Z.canonical.z!==p)continue;const K=Z.canonical,J=Z.overscaledZ,ne=Z.wrap,re=1<<K.z,ie=K.x+1<re,se=K.x>0,ge=K.y+1<re,ae=K.y>0,ce=Z.wrap-(se?0:1),xe=Z.wrap+(ie?0:1),ve=se?K.x-1:re-1,ye=ie?K.x+1:0;if(C)v[0]<0?(F(J,xe,K.z,ye,K.y),v[1]<0&&ge&&(F(J,ne,K.z,K.x,K.y+1),F(J,xe,K.z,ye,K.y+1)),v[1]>0&&ae&&(F(J,ne,K.z,K.x,K.y-1),F(J,xe,K.z,ye,K.y-1))):v[0]>0?(F(J,ce,K.z,ve,K.y),v[1]<0&&ge&&(F(J,ne,K.z,K.x,K.y+1),F(J,ce,K.z,ve,K.y+1)),v[1]>0&&ae&&(F(J,ne,K.z,K.x,K.y-1),F(J,ce,K.z,ve,K.y-1))):v[1]<0&&ge?F(J,ne,K.z,K.x,K.y+1):ae&&F(J,ne,K.z,K.x,K.y-1);else{const Ce=Z.visibleQuadrants;1&Ce&&(F(J,ce,K.z,ve,K.y),ae&&(F(J,ne,K.z,K.x,K.y-1),F(J,ce,K.z,ve,K.y-1))),2&Ce&&(F(J,xe,K.z,ye,K.y),ae&&(F(J,ne,K.z,K.x,K.y-1),F(J,xe,K.z,ye,K.y-1))),4&Ce&&(F(J,ce,K.z,ve,K.y),ge&&(F(J,ne,K.z,K.x,K.y+1),F(J,ce,K.z,ve,K.y+1))),8&Ce&&(F(J,xe,K.z,ye,K.y),ge&&(F(J,ne,K.z,K.x,K.y+1),F(J,xe,K.z,ye,K.y+1)))}}const B=[];for(const j of w)w.some(Z=>j.isChildOf(Z))||B.push(j);if(w=B.filter(j=>!c.some(Z=>!!(j.overscaledZ<p&&Z.isChildOf(j))||j.equals(Z)||j.isChildOf(Z))),M){const j=1<<p,Z="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=[j*Z.x,j*Z.y],J=4,ne=J*J;w=w.filter(re=>{const ie=re.canonical.x+.5-K[0],se=re.canonical.y+.5-K[1];return ie*ie+se*se<ne})}return w}coveringTiles(c){let p=this.coveringZoomLevel(c);const v=p,w=this.elevation&&this.elevation.exaggeration(),C=w&&!c.isTerrainDEM,M="mercator"===this.projection.name;if(void 0!==c.minzoom&&p<c.minzoom)return[];void 0!==c.maxzoom&&p>c.maxzoom&&(p=c.maxzoom);const I=this.locationCoordinate(this.center),F=this.center.lat,B=1<<p,j=[B*I.x,B*I.y,0],Z="globe"===this.projection.name,K=!Z,J=f.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,K),ne=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=B*f.ay(1,this.center.lat),ie=this._camera.position[2]/f.ay(1,this.center.lat),se=[B*ne.x,B*ne.y,ie*(K?1:re)],ge=Z||w,ae=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),ce=this.isLODDisabled(!0)?p:0;let xe;if(this._elevation&&c.isTerrainDEM)xe=1e4*this._elevation.exaggeration();else if(this._elevation){const qe=this._elevation.getMinMaxForVisibleTiles();xe=qe?qe.max:this._centerAltitude}else xe=this._centerAltitude;const ve=c.isTerrainDEM?-xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ye=this.projection.isReprojectedInTileSpace?f.aN(this):1,Ce=qe=>{const Pe=new f._(qe.x+25e-6,qe.y,qe.z),wt=new f._(qe.x,qe.y+25e-6,qe.z),Et=qe.toLngLat(),Qt=Pe.toLngLat(),sn=wt.toLngLat(),fn=this.locationCoordinate(Et),xt=this.locationCoordinate(Qt),Bn=this.locationCoordinate(sn),tr=Math.hypot(xt.x-fn.x,xt.y-fn.y),Pn=Math.hypot(Bn.x-fn.x,Bn.y-fn.y);return Math.sqrt(tr*Pn)*ye/25e-6},Me=qe=>{const at=xe,Pe=ve;return{aabb:f.aR(this,B,0,0,0,qe,Pe,at,this.projection),zoom:0,x:0,y:0,minZ:Pe,maxZ:at,wrap:qe,fullyVisible:!1}},Le=[];let Se=[];const we=p,Ue=c.reparseOverscaled?v:p,et=(ie-this._centerAltitude)*re,Fe=qe=>{if(!this._elevation||!qe.tileID||!M)return;const at=this._elevation.getMinMaxForTile(qe.tileID),Pe=qe.aabb;at?(Pe.min[2]=at.min,Pe.max[2]=at.max,Pe.center[2]=(Pe.min[2]+Pe.max[2])/2):(qe.shouldSplit=pt(qe),qe.shouldSplit||(Pe.min[2]=Pe.max[2]=Pe.center[2]=this._centerAltitude))},Mt=(qe,at)=>{if(.707*at<qe)return 1;const Pe=at/qe;return Pe/(1.4144271570014144+(Math.pow(1.1,Pe-1.4144271570014144+1)-1)/(1.1-1)-1)},pt=qe=>{if(qe.zoom<ce)return!0;if(qe.zoom===we)return!1;if(null!=qe.shouldSplit)return qe.shouldSplit;const at=qe.aabb.distanceX(se),Pe=qe.aabb.distanceY(se);let wt=et,Et=1;if(Z){wt=qe.aabb.distanceZ(se);const Pn=Math.pow(2,qe.zoom),fr=f.az((qe.y+1)/Pn),Cr=f.az(qe.y/Pn),Ar=Math.min(Math.max(F,fr),Cr),ci=f.b6(Ar)/f.b6(F);if(Et=Ar===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ci/this._mercatorScaleRatio),this.zoom<=f.b3&&qe.zoom===we-1&&ci>=.9)return!0}else if(C&&(wt=qe.aabb.distanceZ(se)*re),this.projection.isReprojectedInTileSpace&&v<=5){const Pn=Math.pow(2,qe.zoom),fr=Ce(new f._((qe.x+.5)/Pn,(qe.y+.5)/Pn));Et=fr>.85?1:fr}if(!M){const Pn=Math.sqrt(at*at+Pe*Pe+wt*wt);let fr=(1<<we-qe.zoom)*ae*Et;return fr*=Mt(Math.max(wt,et),Pn),Pn<fr}let Qt=Number.MAX_VALUE,sn=0;const fn=qe.aabb.getCorners(),xt=[];for(const Pn of fn){f.$.sub(xt,Pn,se),Z||(C?xt[2]*=re:xt[2]=et);const fr=f.$.dot(xt,this._camera.forward());fr<Qt&&(Qt=fr,sn=Math.abs(xt[2]))}let Bn=(1<<we-qe.zoom)*ae*Et;if(Bn*=Mt(Math.max(sn,et),Qt),Qt<Bn)return!0;const tr=qe.aabb.closestPoint(j);return tr[0]===j[0]&&tr[1]===j[1]};if(this.renderWorldCopies)for(let qe=1;qe<=3;qe++)Le.push(Me(-qe)),Le.push(Me(qe));for(Le.push(Me(0));Le.length>0;){const qe=Le.pop(),at=qe.x,Pe=qe.y;let wt=qe.fullyVisible;const Et=()=>"globe"===this.projection.name&&(0===qe.y||qe.y===(1<<qe.zoom)-1);if(!wt){let Qt=ge?qe.aabb.intersects(J):qe.aabb.intersectsFlat(J);if(0===Qt&&Et()){const sn=new f.aO(qe.zoom,at,Pe);Qt=f.aP(this,B,sn,!0).intersects(J)}if(0===Qt)continue;wt=2===Qt}if(qe.zoom!==we&&pt(qe))for(let Qt=0;Qt<4;Qt++){const sn=(at<<1)+Qt%2,fn=(Pe<<1)+(Qt>>1),xt={aabb:M?qe.aabb.quadrant(Qt):f.aR(this,B,qe.zoom+1,sn,fn,qe.wrap,qe.minZ,qe.maxZ,this.projection),zoom:qe.zoom+1,x:sn,y:fn,wrap:qe.wrap,fullyVisible:wt,tileID:void 0,shouldSplit:void 0,minZ:qe.minZ,maxZ:qe.maxZ};C&&!Z&&(xt.tileID=new f.aQ(qe.zoom+1===we?Ue:qe.zoom+1,qe.wrap,qe.zoom+1,sn,fn),Fe(xt)),Le.push(xt)}else{const Qt=qe.zoom===we?Ue:qe.zoom;if(c.minzoom&&c.minzoom>Qt)continue;let sn=0;if(!wt){let tr=ge?qe.aabb.intersectsPrecise(J):qe.aabb.intersectsPreciseFlat(J);if(0===tr&&Et()){const Pn=new f.aO(qe.zoom,at,Pe);tr=f.aP(this,B,Pn,!0).intersectsPrecise(J)}if(0===tr)continue;if(c.calculateQuadrantVisibility)if(J.containsPoint(qe.aabb.center))sn=15;else for(let Pn=0;Pn<4;Pn++)0!==qe.aabb.quadrant(Pn).intersects(J)&&(sn|=1<<Pn)}const fn=j[0]-(.5+at+(qe.wrap<<qe.zoom))*(1<<p-qe.zoom),xt=j[1]-.5-Pe,Bn=qe.tileID?qe.tileID:new f.aQ(Qt,qe.wrap,qe.zoom,at,Pe);c.calculateQuadrantVisibility&&(Bn.visibleQuadrants=sn),Se.push({tileID:Bn,distanceSq:fn*fn+xt*xt})}}if(this.fogCullDistSq){const qe=this.fogCullDistSq,at=this.horizonLineFromTop();Se=Se.filter(Pe=>{const wt=[0,0,0,1],Et=[f.a4,f.a4,0,1],Qt=this.calculateFogTileMatrix(Pe.tileID.toUnwrapped());f.aB.transformMat4(wt,wt,Qt),f.aB.transformMat4(Et,Et,Qt);const sn=f.aB.min([],wt,Et),fn=f.aB.max([],wt,Et),xt=f.aS(sn,fn);if(0===xt)return!0;let Bn=!1;const tr=this._elevation;if(tr&&xt>qe&&0!==at){const Pn=this.calculateProjMatrix(Pe.tileID.toUnwrapped());let fr;c.isTerrainDEM||(fr=tr.getMinMaxForTile(Pe.tileID)),fr||(fr={min:ve,max:xe});const Cr=f.b4(this.rotation),Ar=[Cr[0]*f.a4,Cr[1]*f.a4,fr.max];f.$.transformMat4(Ar,Ar,Pn),Bn=(1-Ar[1])*this.height*.5<at}return xt<qe||Bn})}return Se.sort((qe,at)=>qe.distanceSq-at.distanceSq).map(qe=>qe.tileID)}resize(c,p){this.width=c,this.height=p,this.pixelsToGLUnits=[2/c,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const p=f.au(c.lat,-f.aT,f.aT),v=this.projection.project(c.lng,p);return new f.P(v.x*this.worldSize,v.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/f.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,p){let v,w;const C=this.centerPoint;if("globe"===this.projection.name){const I=this.worldSize;v=(p.x-C.x)/I,w=(p.y-C.y)/I}else{const I=this.pointCoordinate(p),F=this.pointCoordinate(C);v=I.x-F.x,w=I.y-F.y}const M=this.locationCoordinate(c);this.setLocation(new f._(M.x-v,M.y-w))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,p){const v=p?f.ay(p,c.lat):void 0,w=this.projection.project(c.lng,c.lat);return new f._(w.x,w.y,v)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,p){const v=p??this._centerAltitude,w=[c.x,c.y,0,1],C=[c.x,c.y,1,1];f.aB.transformMat4(w,w,this.pixelMatrixInverse),f.aB.transformMat4(C,C,this.pixelMatrixInverse);const M=C[3];f.aB.scale(w,w,1/w[3]),f.aB.scale(C,C,1/M);const I=w[2],F=C[2];return{p0:w,p1:C,t:I===F?0:(v-I)/(F-I)}}screenPointToMercatorRay(c){const p=[c.x,c.y,0,1],v=[c.x,c.y,1,1];return f.aB.transformMat4(p,p,this.pixelMatrixInverse),f.aB.transformMat4(v,v,this.pixelMatrixInverse),f.aB.scale(p,p,1/p[3]),f.aB.scale(v,v,1/v[3]),p[2]=f.ay(p[2],this._center.lat)*this.worldSize,v[2]=f.ay(v[2],this._center.lat)*this.worldSize,f.aB.scale(p,p,1/this.worldSize),f.aB.scale(v,v,1/this.worldSize),new f.aU([p[0],p[1],p[2]],f.$.normalize([],f.$.sub([],v,p)))}rayIntersectionCoordinate(c){const{p0:p,p1:v,t:w}=c,C=f.ay(p[2],this._center.lat),M=f.ay(v[2],this._center.lat);return new f._(f.a3(p[0],v[0],w)/this.worldSize,f.a3(p[1],v[1],w)/this.worldSize,f.a3(C,M,w))}pointCoordinate(c,p=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,p)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let p=this.projection.pointCoordinate3D(this,c.x,c.y);if(p)return new f._(p[0],p[1],p[2]);let v=0,w=this.horizonLineFromTop();if(c.y>w)return this.pointCoordinate(c);const C=.02*w,M=c.clone();for(let I=0;I<10&&w-v>C;I++){M.y=f.a3(v,w,.66);const F=this.projection.pointCoordinate3D(this,M.x,M.y);F?(w=M.y,p=F):v=M.y}return p?new f._(p[0],p[1],p[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=f.aV)return!this.isPointAboveHorizon(c);const p=this.pointCoordinate(c);return p.y>=0&&p.y<=1}_coordinatePoint(c,p){const v=p&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,w=[c.x*this.worldSize,c.y*this.worldSize,v+c.toAltitude(),1];return f.aB.transformMat4(w,w,this.pixelMatrix),w[3]>0?new f.P(w[0]/w[3],w[1]/w[3]):new f.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:p}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,C=this.pointLocation3D(new f.P(p,c)),M=this.pointLocation3D(new f.P(w,c)),I=this.pointLocation3D(new f.P(w,v)),F=this.pointLocation3D(new f.P(p,v));let B=Math.min(C.lng,M.lng,I.lng,F.lng),j=Math.max(C.lng,M.lng,I.lng,F.lng),Z=Math.min(C.lat,M.lat,I.lat,F.lat),K=Math.max(C.lat,M.lat,I.lat,F.lat);const J=Math.pow(2,-this.zoom)/16*270,ne="globe"===this.projection.name?1:4,re=(ie,se,ge,ae,ce)=>{const xe=(ie+ge)/2,ve=(se+ae)/2,ye=new f.P(xe,ve),{lng:Ce,lat:Me}=this.pointLocation3D(ye),Le=Math.max(0,B-Ce,Z-Me,Ce-j,Me-K);B=Math.min(B,Ce),j=Math.max(j,Ce),Z=Math.min(Z,Me),K=Math.max(K,Me),(ce<ne||Le>J)&&(re(ie,se,xe,ve,ce+1),re(xe,ve,ge,ae,ce+1))};if(re(p,c,w,c,1),re(w,c,w,v,1),re(w,v,p,v,1),re(p,v,p,c,1),"globe"===this.projection.name){const[ie,se]=f.aW(this);ie?(K=90,j=180,B=-180):se&&(Z=-90,j=180,B=-180)}return new f.aj(new f.aJ(B,Z),new f.aJ(j,K))}_getBoundsRectangular(c,p){const{top:v,left:w}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,I=new f.P(w,v),F=new f.P(M,v),B=new f.P(M,C),j=new f.P(w,C);let Z=this.pointCoordinate(I,c),K=this.pointCoordinate(F,c);const J=this.pointCoordinate(B,p),ne=this.pointCoordinate(j,p),re=(ie,se)=>(se.y-ie.y)/(se.x-ie.x);return Z.y>1&&K.y>=0?Z=new f._((1-ne.y)/re(ne,Z)+ne.x,1):Z.y<0&&K.y<=1&&(Z=new f._(-ne.y/re(ne,Z)+ne.x,0)),K.y>1&&Z.y>=0?K=new f._((1-J.y)/re(J,K)+J.x,1):K.y<0&&Z.y<=1&&(K=new f._(-J.y/re(J,K)+J.x,0)),(new f.aj).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(J))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const p=c.visibleDemTiles.reduce((v,w)=>{if(w.dem){const C=w.dem.tree;v.min=Math.min(v.min,C.minimums[0]),v.max=Math.max(v.max,C.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(p.min*c.exaggeration(),p.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,v=this.height/2-p*(1-this._horizonShift);return c?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-f.aT,this.maxLat=f.aT,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.ak(this.minLng)*this.tileSize,this.worldMaxX=f.ak(this.maxLng)*this.tileSize,this.worldMinY=f.al(this.maxLat)*this.tileSize,this.worldMaxY=f.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,p){return this.projection.createTileMatrix(this,p,c)}calculateDistanceTileData(c){const p=c.key,v=this._distanceTileDataCache;if(v[p])return v[p];const w=c.canonical,C=1/this.height,M=this.cameraWorldSize,I=M/this.zoomScale(w.z),F=(w.x+Math.pow(2,w.z)*c.wrap)*I,B=w.y*I,j=this.point;j.x*=M/this.worldSize,j.y*=M/this.worldSize;const Z=this.angle,K=Math.sin(-Z),J=-Math.cos(-Z);return v[p]={bearing:[K,J],center:[(j.x-F)*C,(j.y-B)*C],scale:I/f.a4*C},v[p]}calculateFogTileMatrix(c){const p=c.key,v=this._fogTileMatrixCache;if(v[p])return v[p];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return f.ae.multiply(w,this.worldToFogMatrix,w),v[p]=new Float32Array(w),v[p]}calculateProjMatrix(c,p=!1,v=!1){const w=c.key;let C;if(C=v?this._expandedProjMatrixCache:p?this._alignedProjMatrixCache:this._projMatrixCache,C[w])return C[w];const M=this.calculatePosMatrix(c,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:v?this.expandedFarZProjMatrix:p?this.alignedProjMatrix:this.projMatrix,f.ae.multiply(M,I,M),C[w]=new Float32Array(M),C[w]}calculatePixelsToTileUnitsMatrix(c){const p=c.tileID.key,v=this._pixelsToTileUnitsCache;if(v[p])return v[p];const w=f.aX(c,this);return v[p]=w,v[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,p=f.ae.fromScaling([],[c,c,c]);return f.ae.multiply(p,p,this.globeMatrix),p}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const p=f.ay(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(p),w=this._camera.forward(),C=f.ay(1,this._center.lat);v[2]/=C,w[2]/=C,f.$.normalize(w,w);const M=c.raycast(v,w,c.exaggeration());if(M){const I=f.$.scaleAndAdd([],v,w,M),F=new f._(I[0],I[1],f.ay(I[2],f.az(I[1]))),B=(F.z+f.$.length([F.x-v[0],F.y-v[1],F.z-v[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const p=this._elevation,v=f.ay(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),C=p.getAtPointOrZero(new f._(...w)),M=this.pixelsPerMeter/this.worldSize*C,I=this._minimumHeightOverTerrain(),F=w[2]-M;if(F<=I)if(F<0||c){const B=this.locationCoordinate(this._center,this._centerAltitude),j=[w[0],w[1],B.z-w[2]],Z=f.$.length(j);j[2]-=(I-F)/this._pixelsPerMercatorPixel;const K=f.$.length(j);if(0===K)return;f.$.scale(j,j,Z/K*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],B.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const K=this.center;return K.lat=f.au(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(K.lng=f.au(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const p=this._unmodified,{x:v,y:w}=this.point;let C=0,M=v,I=w;const F=this.width/2,B=this.height/2,j=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(w-B<j&&(I=j+B),w+B>Z&&(I=Z-B),Z-j<this.height&&(C=Math.max(C,this.height/(Z-j)),I=(Z+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,ne=this.worldSize/2-(K+J)/2;M=(v+ne+this.worldSize)%this.worldSize-ne,M-F<K&&(M=K+F),M+F>J&&(M=J-F),J-K<this.width&&(C=Math.max(C,this.width/(J-K)),M=(J+K)/2)}M===v&&I===w||(this.center=this.unproject(new f.P(M,I))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,p="globe"===this.projection.name,v=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=f.ay(1,this.center.lat)/f.ay(1,f.b5));const w=f.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C="meters"===this.projection.zAxisUnit?v:1,M=this._camera.getWorldToCamera(this.worldSize,C);let I;const F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(F[8]=2*-c.x/this.width,F[9]=2*c.y/this.height,this.isOrthographic){let Me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Le=Me*this.aspect,Se=-Le,we=-Me;Le-=c.x,Se-=c.x,Me+=c.y,we+=c.y,I=this._camera.getCameraToClipOrthographic(Se,Le,we,Me,this._nearZ,this._farZ),((Ue,et,Fe,Mt)=>{for(let pt=0;pt<16;pt++)Ue[pt]=Cm(et[pt],Fe[pt],Mt)})(I,I,F,Sm(this.pitch>=15?1:this.pitch/15))}else I=F;const B=f.ae.mul([],F,M);let j=f.ae.mul([],I,M);if(this.projection.isReprojectedInTileSpace){const Me=this.locationCoordinate(this.center),Le=f.ae.identity([]);f.ae.translate(Le,Le,[Me.x*this.worldSize,Me.y*this.worldSize,0]),f.ae.multiply(Le,Le,f.aZ(this)),f.ae.translate(Le,Le,[-Me.x*this.worldSize,-Me.y*this.worldSize,0]),f.ae.multiply(j,j,Le),f.ae.multiply(B,B,Le),this.inverseAdjustmentMatrix=f.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=f.ae.scale([],j,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=j,this.invProjMatrix=f.ae.invert(new Float64Array(16),this.projMatrix),p){const Me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Me[8]=2*-c.x/this.width,Me[9]=2*c.y/this.height,this.expandedFarZProjMatrix=f.ae.mul([],Me,M)}else this.expandedFarZProjMatrix=this.projMatrix;const Z=f.ae.invert([],I);this.frustumCorners=f.a$.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height),this.cameraFrustum=f.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!p);const K=new Float32Array(16);f.ae.identity(K),f.ae.scale(K,K,[1,-1,1]),f.ae.rotateX(K,K,this._pitch),f.ae.rotateZ(K,K,this.angle);const J=f.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=f.ae.clone(J);const ne=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;J[8]=2*-c.x/this.width,J[9]=2*(c.y+ne)/this.height,this.skyboxMatrix=f.ae.multiply(K,J,K);const re=this.point,ie=re.x,se=re.y,ge=this.width%2/2,ae=this.height%2/2,ce=Math.cos(this.angle),xe=Math.sin(this.angle),ve=ie-Math.round(ie)+ce*ge+xe*ae,ye=se-Math.round(se)+ce*ae+xe*ge,Ce=new Float64Array(j);if(f.ae.translate(Ce,Ce,[ve>.5?ve-1:ve,ye>.5?ye-1:ye,0]),this.alignedProjMatrix=Ce,j=f.ae.create(),f.ae.scale(j,j,[this.width/2,-this.height/2,1]),f.ae.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=f.ae.create(),f.ae.scale(j,j,[1,-1,1]),f.ae.translate(j,j,[-1,-1,0]),f.ae.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=f.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,B),this._calcFogMatrices(),this._distanceTileDataCache={},j=f.ae.invert(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=f.b0(this);const Me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=f.$.transformMat4(Me,Me,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,p=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,C=[c,c,p];f.$.scale(C,C,w),f.$.scale(v,v,-1),f.$.multiply(v,v,C);const M=f.ae.create();f.ae.translate(M,M,v),f.ae.scale(M,M,C),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,p,w)}_computeCameraPosition(c){const p=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-c/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*C,w.y/this.worldSize-v[1]*C,c/this.worldSize*this._centerAltitude-v[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=c[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(C=Math.min((p-v)/w,1)),this._camera.position=f.$.scaleAndAdd([],this._camera.position,c,C),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,p=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),C=f.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.ac(this._maxPitch)),I=Math.max((c[2]-C)/Math.cos(v),M),F=this._zoomFromMercatorZ(I);f.$.scaleAndAdd(c,c,p,I),this._pitch=f.au(v,f.ac(this.minPitch),f.ac(this.maxPitch)),this.angle=f.av(w,-Math.PI,Math.PI),this._setZoom(f.au(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f._(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let p=0,v=f.aV,w=0,C=1/0;for(;v-p>1e-6&&v>p;){const M=p+.5*(v-p),I=this.tileSize*Math.pow(2,M),F=this.getCameraToCenterDistance(this.projection,M,I),B=this.scaleZoom(F/(c*this.tileSize)),j=Math.abs(M-B);j<C&&(C=j,w=M),M<B?p=M:v=M}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,p){const v=Math.min(c.x,p.x),w=Math.max(c.x,p.x),C=Math.min(c.y,p.y),M=Math.max(c.y,p.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const I=[new f.P(v,C),new f.P(w,M),new f.P(v,M),new f.P(w,C)],F=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const j of I){const Z=this.pointRayIntersection(j);if(Z.t<0)return!0;const K=this.rayIntersectionCoordinate(Z);if(K.x<F||K.y<0||K.x>B||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.P(0,0),new f.P(this.width,this.height))}zoomDeltaToMovement(c,p){const v=f.$.length(f.$.sub([],this._camera.position,c)),w=this._zoomFromMercatorZ(v)+p;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const c=function([p,v,w],C){const M=[p,v,w,1];f.aB.transformMat4(M,M,C);const I=M[3]=Math.max(M[3],1e-6);return M[0]/=I,M[1]/=I,M[2]/=I,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new f.P(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.P(0,c))}}getCameraToCenterDistance(c,p=this.zoom,v=this.worldSize){const w=f.aY(c,p,this.width,this.height,1024),C=c.pixelSpaceConversion(this.center.lat,v,w);let M=.5/Math.tan(.5*this._fov)*this.height*C;return this.isOrthographic&&(M=Cm(1,M,Sm(this.pitch>=15?1:this.pitch/15))),M}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&f.ae.multiply(c,c,this.globeMatrix),c}getFrustum(c){return f.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,"meters"===this.projection.zAxisUnit)}}const ka={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},la=(y,c)=>{if(c>0&&y.terrain&&f.w("Cutoff is currently disabled on terrain"),c<=0||y.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const p=y.transform,v=Math.max(Math.abs(p._zoom-(y.minCutoffZoom-1)),1),w=p.isLODDisabled(!1)?f.a0(60,45,p.pitch):f.a0(30,15,p.pitch),C=p._farZ-p._nearZ,M=c*p.height,I=((1-(F=w))*p.cameraToCenterDistance+F*(p._farZ+M))*v;var F;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[p._nearZ,p._farZ,(I-p._nearZ)/C,(I-M-p._nearZ)/C]}}},ca={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ns{constructor(c,p){this.aabb=c,this.lastCascade=p}}class Rd{add(c,p){const v=this.receivers[c.key];void 0!==v?(v.aabb.min[0]=Math.min(v.aabb.min[0],p.min[0]),v.aabb.min[1]=Math.min(v.aabb.min[1],p.min[1]),v.aabb.min[2]=Math.min(v.aabb.min[2],p.min[2]),v.aabb.max[0]=Math.max(v.aabb.max[0],p.max[0]),v.aabb.max[1]=Math.max(v.aabb.max[1],p.max[1]),v.aabb.max[2]=Math.max(v.aabb.max[2],p.max[2])):this.receivers[c.key]=new Ns(p,null)}clear(){this.receivers={}}get(c){return this.receivers[c.key]}computeRequiredCascades(c,p,v){const w=f.b8.fromPoints(c.points);let C=0;for(const M in this.receivers){const I=this.receivers[M];if(!I||!w.intersectsAabb(I.aabb))continue;I.aabb.min=w.closestPoint(I.aabb.min),I.aabb.max=w.closestPoint(I.aabb.max);const F=I.aabb.getCorners();for(let B=0;B<v.length;B++){let j=!0;for(const Z of F){const K=[Z[0]*p,Z[1]*p,Z[2]];if(f.$.transformMat4(K,K,v[B].matrix),K[0]<-1||K[0]>1||K[1]<-1||K[1]>1){j=!1;break}}if(I.lastCascade=B,C=Math.max(C,B),j)break}}return C+1}}class iT{constructor(c){this.painter=c,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Rd,this._depthMode=new f.af(c.context.gl.LEQUAL,f.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,c.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),c.tp.registerParameter(ca,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),c.tp.registerParameter(ca,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),c.tp.registerParameter(ca,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),c.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const c of this._cascades)c.texture.destroy(),c.framebuffer.destroy();this._cascades=[]}updateShadowParameters(c,p){const v=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!p||!p.properties)return;const w=p.properties.get("shadow-intensity");if(!p.shadowsEnabled()||w<=0||(this._shadowLayerCount=v.style.order.reduce((ne,re)=>{const ie=v.style._mergedLayers[re];return ne+(ie.hasShadowPass()&&!ie.isHidden(c.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const C=v.context,M=ca.shadowMapResolution,I=ca.shadowMapResolution;if(0===this._cascades.length||ca.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ne=0;ne<ca.cascadeCount;++ne){const re=v._shadowMapDebug,ie=C.gl,se=C.createFramebuffer(M,I,re,"texture"),ge=new f.T(C,{width:M,height:I,data:null},ie.DEPTH_COMPONENT);if(se.depthAttachment.set(ge.texture),re){const ae=new f.T(C,{width:M,height:I,data:null},ie.RGBA);se.colorAttachment.set(ae.texture)}this._cascades.push({framebuffer:se,texture:ge,matrix:[],far:0,boundingSphereRadius:0,frustum:new f.aM,scale:0})}}this.shadowDirection=rp(p);let F=0;if(c.elevation){const ne=c.elevation,re=[1e4,-1e4];ne.visibleDemTiles.filter(ie=>ie.dem).forEach(ie=>{const se=ie.dem.tree;re[0]=Math.min(re[0],se.minimums[0]),re[1]=Math.max(re[1],se.maximums[0])}),1e4!==re[0]&&(F=(re[1]-re[0])*ne.exaggeration())}const B=1.5*c.cameraToCenterDistance,j=3*B,Z=new Float64Array(16);for(let ne=0;ne<this._cascades.length;++ne){const re=this._cascades[ne];let ie=c.height/50,se=1;1===ca.cascadeCount?se=j:0===ne?se=B:(ie=B,se=j);const[ge,ae]=S1(c,this.shadowDirection,ie,se,ca.shadowMapResolution,F);re.scale=c.scale,re.matrix=ge,re.boundingSphereRadius=ae,f.ae.invert(Z,re.matrix),re.frustum=f.aM.fromInvProjectionMatrix(Z,1,0,!0),re.far=se}const K=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[K].far,this._cascades[K].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ca.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ca.shadowMapResolution,this._uniformValues.u_shadowmap_0=ka.ShadowMap0,this._uniformValues.u_shadowmap_1=ka.ShadowMap0+1,this._groundShadowTiles=v.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const J=v.transform.elevation;for(const ne of this._groundShadowTiles){let re={min:0,max:0};if(J){const ie=J.getMinMaxForTile(ne);ie&&(re=ie)}this.addShadowReceiver(ne.toUnwrapped(),re.min,re.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(c){this._enabled=c}drawShadowPass(c,p){if(!this.enabled)return;const v=this.painter,w=v.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(v.transform.getFrustum(0),v.transform.worldSize,this._cascades),w.viewport.set([0,0,ca.shadowMapResolution,ca.shadowMapResolution]);for(let C=0;C<this._numCascadesToRender;++C){v.currentShadowCascade=C,w.bindFramebuffer.set(this._cascades[C].framebuffer.framebuffer),w.clear({color:f.C.white,depth:1});for(const M of c.order){const I=c._mergedLayers[M];if(!I.hasShadowPass()||I.isHidden(v.transform.zoom))continue;const F=c.getLayerSourceCache(I),B=F?p[F.id]:void 0;("model"===I.type||B&&B.length)&&v.renderLayer(v,F,I,B)}}v.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const c=this.painter,p=c.style,v=c.context,w=p.directionalLight,C=p.ambientLight;if(!w||!C)return;const M=[],I=la(c,c.longestCutoffRange);I.shouldRenderCutoff&&M.push("RENDER_CUTOFF");const F=r_(p,w,C),B=new f.af(v.gl.LEQUAL,f.af.ReadOnly,c.depthRangeFor3D);for(const j of this._groundShadowTiles){const Z=j.toUnwrapped(),K=c.isTileAffectedByFog(j),J=c.getOrCreateProgram("groundShadow",{defines:M,overrideFog:K});this.setupShadows(Z,J),c.uploadCommonUniforms(v,J,Z,null,I);const ne={u_matrix:c.transform.calculateProjMatrix(Z),u_ground_shadow_factor:F};J.draw(c,v.gl.TRIANGLES,B,f.ah.disabled,f.a.multiply,f.ag.disabled,ne,"ground_shadow",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments,{},c.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?f.a.unblended:f.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(c){const p=this.painter.transform,v=p.calculatePosMatrix(c,p.worldSize);return f.ae.multiply(v,this._cascades[this.painter.currentShadowCascade].matrix,v),Float32Array.from(v)}calculateShadowPassMatrixFromMatrix(c){return f.ae.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}setupShadows(c,p,v,w=0){if(!this.enabled)return;const C=this.painter.transform,M=this.painter.context,I=M.gl,F=this._uniformValues,B=new Float64Array(16),j=C.calculatePosMatrix(c,C.worldSize);for(let Z=0;Z<this._cascades.length;Z++)f.ae.multiply(B,this._cascades[Z].matrix,j),F[0===Z?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),M.activeTexture.set(I.TEXTURE0+ka.ShadowMap0+Z),this._cascades[Z].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!v,this.useNormalOffset){const Z=f.b7(c.canonical),K=2/C.tileSize*f.a4/ca.shadowMapResolution,J=K*this._cascades[0].boundingSphereRadius,ne=K*this._cascades[this._cascades.length-1].boundingSphereRadius,re=("vector-tile"===v?1:3)/Math.pow(2,w-c.canonical.z-(1-C.zoom+Math.floor(C.zoom)));F.u_shadow_normal_offset=[Z,J*re,ne*re],F.u_shadow_bias=[6e-5,.0012,.012]}else F.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(M,F)}setupShadowsFromMatrix(c,p,v=!1){if(!this.enabled)return;const w=this.painter.context,C=w.gl,M=this._uniformValues,I=new Float64Array(16);for(let F=0;F<ca.cascadeCount;F++)f.ae.multiply(I,this._cascades[F].matrix,c),M[0===F?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),w.activeTexture.set(C.TEXTURE0+ka.ShadowMap0+F),this._cascades[F].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=v,v){const F=ca.normalOffset;M.u_shadow_normal_offset=[1,F,F],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(w,M)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(c,p,v,w){if(w[2]>=0)return{};const C=function(F,B,j){const Z=j/(1<<F.canonical.z);return new f.b8([F.canonical.x*Z+F.wrap*j,F.canonical.y*Z+F.wrap*j,0],[(F.canonical.x+1)*Z+F.wrap*j,(F.canonical.y+1)*Z+F.wrap*j,B])}(c,p,v).getCorners(),M=p/-w[2];w[0]<0?(f.$.add(C[0],C[0],[w[0]*M,0,0]),f.$.add(C[3],C[3],[w[0]*M,0,0])):w[0]>0&&(f.$.add(C[1],C[1],[w[0]*M,0,0]),f.$.add(C[2],C[2],[w[0]*M,0,0])),w[1]<0?(f.$.add(C[0],C[0],[0,w[1]*M,0]),f.$.add(C[1],C[1],[0,w[1]*M,0])):w[1]>0&&(f.$.add(C[2],C[2],[0,w[1]*M,0]),f.$.add(C[3],C[3],[0,w[1]*M,0]));const I={};return I.vertices=C,I.planes=[Nd(C[1],C[0],C[4]),Nd(C[2],C[1],C[5]),Nd(C[3],C[2],C[6]),Nd(C[0],C[3],C[7])],I}addShadowReceiver(c,p,v){this._receivers.add(c,f.b8.fromTileIdAndHeight(c,p,v))}getMaxCascadeForTile(c){const p=this._receivers.get(c);return p&&p.lastCascade?p.lastCascade:0}}function Nd(y,c,p){const v=f.$.sub([],p,c),w=f.$.sub([],y,c),C=f.$.cross([],v,w),M=f.$.length(C);return 0===M?[0,0,1,0]:(f.$.scale(C,C,1/M),[C[0],C[1],C[2],-f.$.dot(C,c)])}function rp(y){const c=y.properties.get("direction"),p=f.ad(c.x,c.y,c.z);p[2]=f.au(p[2],0,75);const v=f.b9([p[0],p[1],p[2]]);return f.$.fromValues(v.x,v.y,v.z)}function r_(y,c,p){const v=c.properties.get("color"),w=c.properties.get("intensity"),C=c.properties.get("direction"),M=[C.x,C.y,C.z],I=p.properties.get("color"),F=p.properties.get("intensity"),B=Math.max(f.$.dot([0,0,1],M),0),j=[0,0,0];f.$.scale(j,I.toRenderColor(y.getLut(c.scope)).toArray01Linear().slice(0,3),F);const Z=[0,0,0];return f.$.scale(Z,v.toRenderColor(y.getLut(p.scope)).toArray01Linear().slice(0,3),B*w),f.ba([j[0]>0?j[0]/(j[0]+Z[0]):0,j[1]>0?j[1]/(j[1]+Z[1]):0,j[2]>0?j[2]/(j[2]+Z[2]):0])}function S1(y,c,p,v,w,C){const M=y.zoom,I=y.scale,F=y.worldSize,B=1/F,j=y.aspect,Z=Math.sqrt(1+j*j)*Math.tan(.5*y.fovX),K=Z*Z,J=v-p,ne=v+p;let re,ie;K>J/ne?(re=v,ie=v*Z):(re=.5*ne*(1+K),ie=.5*Math.sqrt(J*J+2*(v*v+p*p)*K+ne*ne*K*K));const se=y.projection.pixelsPerMeter(y.center.lat,F),ge=y._camera.getCameraToWorldMercator(),ae=[0,0,-re*B];f.$.transformMat4(ae,ae,ge);let ce=ie*B;const xe=y._edgeInsets;if(!(0===xe.left&&0===xe.top&&0===xe.right&&0===xe.bottom||xe.left===xe.right&&xe.top===xe.bottom)){const wt=y._camera.getWorldToCamera(y.worldSize,"meters"===y.projection.zAxisUnit?se:1),Et=y._camera.getCameraToClipPerspective(y._fov,y.width/y.height,p,v);Et[8]=2*-y.centerOffset.x/y.width,Et[9]=2*y.centerOffset.y/y.height;const Qt=new Float64Array(16);f.ae.mul(Qt,Et,wt);const sn=new Float64Array(16);f.ae.invert(sn,Qt);const fn=f.aM.fromInvProjectionMatrix(sn,F,M,!0);for(const xt of fn.points){const Bn=((ve=xt)[0]/=I,ve[1]/=I,ve[2]=f.ay(ve[2],y._center.lat),ve);ce=Math.max(ce,f.$.len(f.$.subtract([],ae,Bn)))}}var ve;ce*=w/(w-1);const ye=Math.acos(c[2]),Ce=Math.atan2(-c[0],-c[1]),Me=new Uu;Me.position=ae,Me.setPitchBearing(ye,Ce);const Le=Me.getWorldToCamera(F,se),Se=ce*F,we=Math.min(y._mercatorZfromZoom(17)*F*-2,-2*Se),Ue=Me.getCameraToClipOrthographic(-Se,Se,-Se,Se,we,(Se+C*se)/c[2]),et=new Float64Array(16);f.ae.multiply(et,Ue,Le);const Fe=f.$.fromValues(Math.floor(1e6*ae[0])/1e6*F,Math.floor(1e6*ae[1])/1e6*F,0),Mt=.5*w,pt=[0,0,0];f.$.transformMat4(pt,Fe,et),f.$.scale(pt,pt,Mt);const qe=[Math.floor(pt[0]),Math.floor(pt[1]),Math.floor(pt[2])],at=[0,0,0];f.$.sub(at,pt,qe),f.$.scale(at,at,-1/Mt);const Pe=new Float64Array(16);return f.ae.identity(Pe),f.ae.translate(Pe,Pe,at),f.ae.multiply(et,Pe,et),[et,Se]}function i_(y,c){return null!=y&&null!=c&&!(!y.hasData()||!c.hasData())&&null!=y.demTexture&&null!=c.demTexture&&y.tileID.key!==c.tileID.key}const Vu=new class{constructor(){this.operations={}}newMorphing(y,c,p,v,w){if(y in this.operations){const C=this.operations[y];C.to.tileID.key!==p.tileID.key&&(C.queued=p)}else this.operations[y]={startTime:v,phase:0,duration:w,from:c,to:p,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const c=this.operations[y];return{from:c.from,to:c.to,phase:c.phase}}update(y){for(const c in this.operations){const p=this.operations[c];for(p.phase=(y-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,y)){delete this.operations[c];break}}}_nextOp(y,c){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=c,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},Mm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function tf(y,c,p){if(0===c)return 0;const v=c<1&&514===p?.25/c:1;return 6*Math.pow(1.5,22-y)*Math.max(c,1)*v}function Am(y,c){const p=1<<y.z;return!c&&(0===y.x||y.x===p-1)||0===y.y||y.y===p-1}const s_=y=>({u_matrix:y});function o_(y,c,p,v,w){if(w>0){const C=f.e.now(),M=(C-y.timeAdded)/w,I=c?(C-c.timeAdded)/w:-1,F=p.getSource(),B=v.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),j=!c||Math.abs(c.tileID.overscaledZ-B)>Math.abs(y.tileID.overscaledZ-B),Z=j&&y.refreshedUponExpiration?1:f.au(j?M:1-I,0,1);return y.refreshedUponExpiration&&M>=1&&(y.refreshedUponExpiration=!1),c?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class nf extends Ul{constructor(c,p,v,w){super(c,p,v,w),this.type="raster-array",this.maxzoom=22,this._options=f.Q({type:"raster-array"},p)}triggerRepaint(c){const p=this.map.painter._terrain,v=this.map.style.getSourceCache(this.id);p&&p.enabled&&v&&p._clearRenderCacheForTile(v.id,c.tileID),this.map.triggerRepaint()}loadTile(c,p){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(v,f.R.Tile);c.requestParams=w,c.actor||(c.actor=this.dispatcher.getActor()),c.request=c.fetchHeader(void 0,(C,M,I,F)=>(delete c.request,c.aborted?(c.state="unloaded",p(null)):C?20===C.code?void 0:(c.state="errored",p(C)):(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:I,expires:F}),c.state="empty",void p(null))))}unloadTile(c,p){const v=c.texture;v&&v instanceof f.T?(c.destroy(!0),this.map.painter.saveTileTexture(v)):(c.destroy(),c.flushQueues(),c._isHeaderLoaded=!1,delete c._mrt,delete c.textureDescriptor),c.fbo&&(c.fbo.destroy(),delete c.fbo),delete c.request,delete c.requestParams,delete c.neighboringTiles,c.state="unloaded"}prepareTile(c,p,v){c._isHeaderLoaded&&("empty"!==c.state&&(c.state="reloading"),c.fetchBand(p,v,(w,C)=>{if(w)return c.state="errored",this.fire(new f.f(w)),void this.triggerRepaint(c);C&&(c.setTexture(C,this.map.painter),c.state="loaded",this.triggerRepaint(c))}))}getInitialBand(c){if(!this.rasterLayers)return 0;const p=this.rasterLayers.find(({id:C})=>C===c),v=p&&p.fields,w=v&&v.bands&&v.bands;return w?w[0]:0}getTextureDescriptor(c,p,v){if(!c)return;const w=p.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!w)return;let C=null;p instanceof f.bm?C=p.paint.get("raster-array-band"):p instanceof f.bn&&(C=p.paint.get("raster-particle-array-band"));const M=C||this.getInitialBand(w);if(null!=M)if(c.textureDescriptor){if(!c.updateNeeded(w,M)||v)return Object.assign({},c.textureDescriptor,{texture:c.texture})}else this.prepareTile(c,w,M)}}const a_={vector:bx,raster:Ul,"raster-dem":class extends Ul{constructor(y,c,p,v){super(y,c,p,v),this.type="raster-dem",this.maxzoom=22,this._options=f.Q({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(y,c){const p=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,C){w&&(y.state="errored",c(w)),C&&(y.dem=C,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",c(null))}y.request=f.i(this.map._requestManager.transformRequest(p,f.R.Tile),function(w,C,M,I){if(delete y.request,y.aborted)y.state="unloaded",c(null);else if(w)y.state="errored",c(w);else if(C){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:M,expires:I});const F=ImageBitmap&&C instanceof ImageBitmap&&f.bk(),B=1-(C.width-f.bl(C.width))/2;B<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const j=F?C:f.e.getImageData(C,B),Z={uid:y.uid,coord:y.tileID,source:this.id,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:B};y.actor&&"expired"!==y.state||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",Z,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(y){const c=y.canonical,p=Math.pow(2,c.z),v=(c.x-1+p)%p,w=0===c.x?y.wrap-1:y.wrap,C=(c.x+1+p)%p,M=c.x+1===p?y.wrap+1:y.wrap,I={};return I[new f.aQ(y.overscaledZ,w,c.z,v,c.y).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,M,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(I[new f.aQ(y.overscaledZ,w,c.z,v,c.y-1).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,y.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,M,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<p&&(I[new f.aQ(y.overscaledZ,w,c.z,v,c.y+1).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,y.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,M,c.z,C,c.y+1).key]={backfilled:!1}),I}},"raster-array":nf,geojson:class extends f.E{constructor(y,c,p,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(v),this._data=c.data,this._options=f.Q({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),void 0!==c.minzoom&&(this.minzoom=c.minzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const w=f.a4/this.tileSize;this.workerOptions=f.Q({source:this.id,scope:this.scope,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*w,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*w,extent:f.a4,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:f.a4,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*w,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter,dynamic:c.dynamic},c.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}updateData(y){if(!this._options.dynamic)return this.fire(new f.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof y&&("Feature"===y.type&&(y={type:"FeatureCollection",features:[y]}),"FeatureCollection"!==y.type))return this.fire(new f.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof y&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const c=new Map;for(const p of this._data.features)c.set(p.id,p);for(const p of y.features)c.set(p.id,p);this._data.features=[...c.values()]}else this._data=y;return this._updateWorkerData(!0),this}getClusterExpansionZoom(y,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id,scope:this.scope},c),this}getClusterChildren(y,c){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id,scope:this.scope},c),this}getClusterLeaves(y,c,p,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:y,limit:c,offset:p},v),this}_updateWorkerData(y=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.g("dataloading",{dataType:"source"})),this._loaded=!1;const c=f.Q({append:y},this.workerOptions);c.scope=this.scope;const p=this._data;"string"==typeof p?(c.request=this.map._requestManager.transformRequest(f.e.resolveURL(p),f.R.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(p),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(v,w)=>{if(this._loaded=!0,this._pendingLoad=null,v)this.fire(new f.f(v));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(C.resourceTiming=w.resourceTiming[this.id]),y&&(this._partialReload=!0),this.fire(new f.g("data",C)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(y),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(y,c){const p=y.actor?"reloadTile":"loadTile";y.actor=this.actor;const v=this.map.style?this.map.style.getLut(this.scope):null,w=this._partialReload,C={type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v?{image:v.image.clone()}:null,scope:this.scope,pixelRatio:f.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:w};y.request=this.actor.send(p,C,(M,I)=>w&&!I?(y.state="loaded",c(null)):(delete y.request,y.destroy(),y.aborted?c(null):M?c(M):(y.loadVectorData(I,this.map.painter,"reloadTile"===p),c(null))),void 0,"loadTile"===p)}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y,c){this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id,scope:this.scope}),y.destroy()}onRemove(y){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends f.bo{constructor(y,c,p,v){super(y,c,p,v),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const c of y.urls)this.urls.push(this.map._requestManager.transformRequest(c,f.R.Source).url);f.bp(this.urls,(c,p)=>{this._loaded=!0,c?this.fire(new f.f(c)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const c=this.video.seekable;y<c.start(0)||y>c.end(0)?this.fire(new f.f(new f.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const y=this.map.painter.context,c=y.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new f.T(y,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:f.bo,model:class extends f.E{constructor(y,c,p,v){super(),this.id=y,this.type="model",this.models=[],this._loaded=!1,this._options=c}load(){const y=[];for(const c in this._options.models){const p=this._options.models[c],v=f.l(this.map._requestManager.transformRequest(p.uri,f.R.Model).url).then(w=>{if(!w)return;const C=f.c(w),M=new f.M(c,p.position,p.orientation,C);M.computeBoundsAndApplyParent(),this.models.push(M)}).catch(w=>{this.fire(new f.f(new Error(`Could not load model ${c} from ${p.uri}: ${w.message}`)))});y.push(v)}return Promise.allSettled(y).then(()=>{this._loaded=!0,this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this.fire(new f.f(new Error(`Could not load models: ${c.message}`)))})}onAdd(y){this.map=y,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(y,c){}serialize(){return{type:"model"}}},"batched-model":class extends f.E{constructor(y,c,p,v){super(),this.type="batched-model",this.id=y,this.tileSize=512,this._options=c,this.tiles=this._options.tiles,this.maxzoom=c.maxzoom||19,this.minzoom=c.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=p,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(v)}onAdd(y){this.map=y,this.load()}load(y){this._loaded=!1,this.fire(new f.g("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=E1(this._options,this.map._requestManager,c,p,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&2!==p.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new f.f(v))):w&&(f.Q(this,w),w.bounds&&(this.tileBounds=new bm(w.bounds,this.minzoom,this.maxzoom)),f.ao(w.tiles,this.map._requestManager._customAccessToken),this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))),y&&y(v)})}hasTransition(){return!1}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loaded(){return this._loaded}loadTile(y,c){const p=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(p,f.R.Tile),data:void 0,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,tileSize:this.tileSize*y.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:y.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(y.actor&&"expired"!==y.state)if("loading"===y.state)y.reloadCallback=c;else{if(y.buckets){const C=Object.values(y.buckets);for(const M of C)M.dirty=!0;return void(y.state="loaded")}y.request=y.actor.send("reloadTile",v,w.bind(this))}else y.actor=this.dispatcher.getActor(),y.request=y.actor.send("loadTile",v,w.bind(this),void 0,!0);function w(C,M){return y.aborted?c(null):C&&404!==C.status?c(C):(M&&(M.resourceTiming&&(y.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&y.setExpiryData(M),y.buckets={...y.buckets,...M.buckets},M.featureIndex&&(y.latestFeatureIndex=M.featureIndex)),y.state="loaded",void c(null))}}serialize(){return f.Q({},this._options)}},canvas:class extends f.bo{constructor(y,c,p,v){super(y,c,p,v),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(C=>"number"!=typeof C))||this.fire(new f.f(new f.V(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.f(new f.V(`sources.${y}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new f.f(new f.V(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof HTMLCanvasElement||this.fire(new f.f(new f.V(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.f(new f.V(`sources.${y}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(y){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?!y&&!this._playing||this.texture instanceof f.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.T(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends f.E{constructor(y,c,p,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=c,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new bm(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),f.Q(this,f.ai(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this.map=y,this._loaded=!1,this.fire(new f.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:c,y:p,z:v}=y.canonical;return this._implementation.hasTile({x:c,y:p,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,c){const{x:p,y:v,z:w}=y.tileID.canonical,C=new AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:p,y:v,z:w},{signal:C.signal})).then(function(M){return delete y.request,y.aborted?(y.state="unloaded",c(null)):void 0===M?(y.state="errored",c(null)):null===M?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",c(null)):(I=M)instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement?(this.loadTileData(y,M),y.state="loaded",void c(null)):(y.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var I}.bind(this)).catch(M=>{20!==M.code&&(y.state="errored",c(M))}),y.request.cancel=()=>C.abort()}loadTileData(y,c){y.setTexture(c,this.map.painter)}unloadTile(y,c){if(y.texture&&y.texture instanceof f.T?(y.destroy(!0),y.texture&&y.texture instanceof f.T&&this.map.painter.saveTileTexture(y.texture)):y.destroy(),this._implementation.unloadTile){const{x:p,y:v,z:w}=y.tileID.canonical;this._implementation.unloadTile({x:p,y:v,z:w})}c&&c()}abortTile(y,c){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),c&&c()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z}))}_clearTiles(){const y=f.am(this.id,this.scope);this.map.style.clearSource(y)}_update(){this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))}}},l_=function(y,c,p,v){const w=new a_[c.type](y,c,p,v);if(w.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${w.id}`);return f.br(["load","abort","unload","serialize","prepare"],w),w};class Sx extends f.bx{constructor(c){const p={type:"raster-dem",maxzoom:c.transform.maxZoom},v=new f.by(f.bz(),null),w=l_("mock-dem",p,v,c.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,p){c.state="loaded",p(null)}}class Dx extends f.bx{constructor(c){const p=l_("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new f.by(f.bz(),null),c.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,p,v){if(c.freezeTileCoverage)return;this.transform=c;const w=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,M)=>{if(C[M.key]="",!this._tiles[M.key]){const I=new f.bA(M,this._source.tileSize*M.overscaleFactor(),c.tileZoom);I.state="loaded",this._tiles[M.key]=I}return C},{});for(const C in this._tiles)C in w||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(c){const p=this.proxyCachedFBO[c];if(void 0!==p){const v=Object.values(p);this.renderCachePool.push(...v),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ju extends f.aQ{constructor(c,p,v){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=p,this.projMatrix=v}}class Oa extends f.bs{constructor(c,p){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},c.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,C]=function(F){const B=new f.bv,j=new f.bw,Z=131;B.reserve(17161),j.reserve(33800);const K=f.a4/128,J=f.a4+K/2,ne=J+K;for(let ie=-K;ie<ne;ie+=K)for(let se=-K;se<ne;se+=K){const ge=se<0||se>J||ie<0||ie>J?24575:0,ae=f.au(Math.round(se),0,f.a4),ce=f.au(Math.round(ie),0,f.a4);B.emplaceBack(ae+ge,ce)}const re=(ie,se)=>{const ge=se*Z+ie;j.emplaceBack(ge+1,ge,ge+Z),j.emplaceBack(ge+Z,ge+Z+1,ge+1)};for(let ie=1;ie<129;ie++)for(let se=1;se<129;se++)re(se,ie);return[0,129].forEach(ie=>{for(let se=0;se<130;se++)re(se,ie),re(ie,se)}),[B,j,32768]}(),M=c.context;this.gridBuffer=M.createVertexBuffer(v,f.bt.members),this.gridIndexBuffer=M.createIndexBuffer(w),this.gridSegments=f.b.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=f.b.simpleSegment(0,0,v.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Dx(p.map),this.orthoMatrix=f.ae.create(),f.ae.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,f.a4,0,f.a4,0,1);const I=M.gl;this._overlapStencilMode=new f.ah({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Sx(p.map),this._pendingGroundEffectLayers=[]}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),this._style=c,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,p,v){if(c&&c.terrain){this._style!==c&&(this.style=c,this._evaluationZoom=void 0);const w=c.terrain.properties,C=0===c.terrain.drapeRenderMode,M=c.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=f.e.now();const I=c.terrain&&c.terrain.scope,F=w.get("source"),B=C?this._mockSourceCache:c.getSourceCache(F,I);if(!B)return void f.w(`Couldn't find terrain source "${F}".`);if(this.sourceCache=B,this._exaggeration=M?this.calculateExaggeration(p):w.get("exaggeration"),!p.projection.requiresDraping&&M&&0===this._exaggeration)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&f.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Z=this.getScaledDemTileSize();this.sourceCache.update(p,Z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),p.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0,this._previousZoom=p.zoom}else this._disable()}calculateExaggeration(c){const p=this._previousCameraAltitude,v=c.getFreeCameraOptions().position.z/c.pixelsPerMeter*c.worldSize;this._previousCameraAltitude=v;const w=null!=p?v-p:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const C=c.zoom,M=this._style.terrain;if(!this._previousUpdateTimestamp)return M.getExaggeration(C);let I=C-this._previousZoom;const F=this._previousUpdateTimestamp;let B=C;null!=this._evaluationZoom&&(B=this._evaluationZoom,Math.abs(C-B)>.5&&(I=.5*(C-B+I)),I*w<0&&(B+=I)),this._evaluationZoom=B;const j=M.getExaggeration(B),Z=j===M.getExaggeration(Math.max(0,B-.1));if(Z&&Math.abs(j-this._exaggeration)<.01)return j;let K=Math.min(.1,.00375*(this._updateTimestamp-F));return(Z||j<.1||Math.abs(I)<1e-4)&&(K=Math.min(.2,4*K)),f.a3(this._exaggeration,j,K)}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._mergedSourceCaches)this._style._mergedSourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(f._.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=p.getIds().map(F=>{const B=p.getTileByID(F).tileID;return B.projMatrix=v.calculateProjMatrix(B.toUnwrapped()),B});!function(F,B){const j=B.transform.pointCoordinate(B.transform.getCameraPoint()),Z=new f.P(j.x,j.y);F.sort((K,J)=>{if(J.overscaledZ-K.overscaledZ)return J.overscaledZ-K.overscaledZ;const ne=new f.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),re=new f.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),ie=Z.mult(1<<K.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(ne)-ie.distSqr(re)})}(w,this.painter);const C=this.proxyToSource||{};this.proxyToSource={},w.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const M=this._style._mergedSourceCaches;for(const F in M){const B=M[F];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,c[F],C),B.usedForTerrain))continue;const j=c[F];B.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[p.id]=w.map(F=>new ju(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const B=this.terrainTileForTile[F.key];if(!B)continue;const j=B.tileID.key;j in I||(this._visibleDemTiles.push(B),I[j]=j)}}_assignTerrainTiles(c){this._initializing||c.forEach(p=>{if(this.terrainTileForTile[p.key])return;const v=this._findTileCoveringTileID(p,this.sourceCache);v&&(this.terrainTileForTile[p.key]=v)})}_prepareDEMTextures(){const c=this.painter.context,p=c.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],C=w.dem;!C||w.demTexture&&!w.needsDEMTextureUpload||(c.activeTexture.set(p.TEXTURE1),T1(this.painter,w,C))}}_prepareDemTileUniforms(c,p,v,w){if(!p||null==p.demTexture)return!1;const C=c.tileID.canonical,M=Math.pow(2,p.tileID.canonical.z-C.z),I=w||"";return v[`u_dem_tl${I}`]=[C.x*M%1,C.y*M%1],v[`u_dem_scale${I}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let c=0;const p=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const C=w.dem.tree.minimums[0];return C>0&&c++,v+C},0);return c?p/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,p=c.gl;c.activeTexture.set(p.TEXTURE2);const v=this._getLoadedAreaMinimum(),[w,C]=(()=>{const I=new f.bB({width:1,height:1},new Float32Array([v]));return[p.R32F,I]})();this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(C,{premultiply:!1}):M=this._emptyDEMTexture=new f.T(c,C,w,{premultiply:!1}),M}setupElevationDraw(c,p,v){const w=this.painter.context,C=w.gl,M={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};M.u_exaggeration=this.exaggeration();let I=null,F=null,B=1;if(v&&v.morphing&&this._useVertexMorphing){const J=v.morphing.srcDemTile,ne=v.morphing.dstDemTile;B=v.morphing.phase,J&&ne&&(this._prepareDemTileUniforms(c,J,M,"_prev")&&(F=J),this._prepareDemTileUniforms(c,ne,M)&&(I=ne))}const j=J=>J&&J.demTexture&&this.painter.linearFloatFilteringSupported()?C.LINEAR:C.NEAREST;let Z=null;var K;if(this.enabled?F&&I?(Z=I.demTexture,w.activeTexture.set(C.TEXTURE4),F.demTexture.bind(j(F),C.CLAMP_TO_EDGE),M.u_dem_lerp=B):(I=this.terrainTileForTile[c.tileID.key],Z=this._prepareDemTileUniforms(c,I,M)?I.demTexture:this.emptyDEMTexture):Z=this.emptyDEMTexture,w.activeTexture.set(C.TEXTURE2),Z&&(M.u_dem_size=1===(K=Z).size[0]?1:K.size[0]-2,Z.bind(j(I),C.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(v&&v.useDepthForOcclusion,p,M),v&&v.useMeterToDem&&I){const J=(1<<I.tileID.canonical.z)*f.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=J}if(v&&v.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),p.setTerrainUniformValues(w,M),"globe"===this.painter.transform.projection.name){const J=this.globeUniformValues(this.painter.transform,c.tileID.canonical,v&&v.useDenormalizedUpVectorScale);p.setGlobeUniformValues(w,J)}}globeUniformValues(c,p,v){const w=c.projection;return{u_tile_tl_up:w.upVector(p,0,0),u_tile_tr_up:w.upVector(p,f.a4,0),u_tile_br_up:w.upVector(p,f.a4,f.a4),u_tile_bl_up:w.upVector(p,0,f.a4),u_tile_up_scale:v?f.bu(1):w.upVectorScale(p,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const p=this.painter,v=this.painter.context;0!==c.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,C,M,I,F){if("globe"===w.transform.projection.name)!function(B,j,Z,K,J){const ne=B.context,re=ne.gl;let ie,se;const ge=B.transform,ae=f.bc(B,ne,ge),ce=(Ue,et)=>{if(se===et)return;const Fe=[Mm[et],"PROJECTION_GLOBE_VIEW"];ae&&Fe.push("CUSTOM_ANTIALIASING");const Mt=B.isTileAffectedByFog(Ue);ie=B.getOrCreateProgram("globeRaster",{defines:Fe,overrideFog:Mt}),se=et},xe=B.colorModeForRenderPass(),ve=new f.af(re.LEQUAL,f.af.ReadWrite,B.depthRangeFor3D);Vu.update(J);const ye=f.bd(ge),Ce=[f.ak(ge.center.lng),f.al(ge.center.lat)],Me=B.globeSharedBuffers,Le=[ge.width*f.e.devicePixelRatio,ge.height*f.e.devicePixelRatio],Se=Float32Array.from(ge.globeMatrix),we={useDenormalizedUpVectorScale:!0};{const Ue=B.transform,et=tf(Ue.zoom,j.exaggeration(),j.sourceCache._source.tileSize);se=-1;const Fe=re.TRIANGLES;for(const Mt of K){const pt=Z.getTile(Mt),qe=f.ah.disabled,at=j.prevTerrainTileForTile[Mt.key],Pe=j.terrainTileForTile[Mt.key];i_(at,Pe)&&Vu.newMorphing(Mt.key,at,Pe,J,250),ne.activeTexture.set(re.TEXTURE0),pt.texture&&pt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);const wt=Vu.getMorphValuesForProxy(Mt.key),Et=wt?1:0;wt&&f.q(we,{morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:f.bb(wt.phase)}});const Qt=f.be(Mt.canonical),sn=f.bf(Qt.getCenter().lat),fn=f.bg(Mt.canonical,Qt,sn,Ue.worldSize/Ue._pixelsPerMercatorPixel),xt=f.bh(f.bi(Mt.canonical)),Bn=Tx(Ue.expandedFarZProjMatrix,Se,ye,xt,f.a2(Ue.zoom),Ce,Ue.frustumCorners.TL,Ue.frustumCorners.TR,Ue.frustumCorners.BR,Ue.frustumCorners.BL,Ue.globeCenterInViewSpace,Ue.globeRadius,Le,et,Ue._farZ,fn);if(ce(Mt,Et),ie&&(j.setupElevationDraw(pt,ie,we),B.uploadCommonUniforms(ne,ie,Mt.toUnwrapped()),Me)){const[tr,Pn,fr]=Me.getGridBuffers(sn,0!==et);ie.draw(B,Fe,ve,qe,xe,f.ag.backCCW,Bn,"globe_raster",tr,Pn,fr)}}}if(Me&&(B.renderDefaultNorthPole||B.renderDefaultSouthPole)){const Ue=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ae&&Ue.push("CUSTOM_ANTIALIASING"),ie=B.getOrCreateProgram("globeRaster",{defines:Ue});for(const et of K){const{x:Fe,y:Mt,z:pt}=et.canonical,qe=0===Mt,at=Mt===(1<<pt)-1,[Pe,wt,Et,Qt]=Me.getPoleBuffers(pt,!1);if(Qt&&(qe||at)){const sn=Z.getTile(et);ne.activeTexture.set(re.TEXTURE0),sn.texture&&sn.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);let fn=f.bj(pt,Fe,ge);const xt=f.bh(f.bi(et.canonical)),Bn=(tr,Pn)=>tr.draw(B,re.TRIANGLES,ve,f.ah.disabled,xe,f.ag.disabled,Tx(ge.expandedFarZProjMatrix,fn,fn,xt,0,Ce,ge.frustumCorners.TL,ge.frustumCorners.TR,ge.frustumCorners.BR,ge.frustumCorners.BL,ge.globeCenterInViewSpace,ge.globeRadius,Le,0,ge._farZ),"globe_pole_raster",Pn,Et,Qt);j.setupElevationDraw(sn,ie,we),B.uploadCommonUniforms(ne,ie,et.toUnwrapped()),qe&&B.renderDefaultNorthPole&&Bn(ie,Pe),at&&B.renderDefaultSouthPole&&(fn=f.ae.scale(f.ae.create(),fn,[1,-1,1]),Bn(ie,wt))}}}}(w,C,M,I,F);else{const B=w.context,j=B.gl;let Z,K;const J=w.shadowRenderer,ne=la(w,w.longestCutoffRange),re=xe=>{if(K===xe)return;const ve=[];ve.push(Mm[xe]),ne.shouldRenderCutoff&&ve.push("RENDER_CUTOFF"),Z=w.getOrCreateProgram("terrainRaster",{defines:ve}),K=xe},ie=w.colorModeForRenderPass(),se=new f.af(j.LEQUAL,f.af.ReadWrite,w.depthRangeFor3D);Vu.update(F);const ge=w.transform,ae=tf(ge.zoom,C.exaggeration(),C.sourceCache._source.tileSize);let ce=[0,0,0];if(J){const xe=w.style.directionalLight,ve=w.style.ambientLight;xe&&ve&&(ce=r_(w.style,xe,ve))}{K=-1;const xe=j.TRIANGLES,[ve,ye]=[C.gridIndexBuffer,C.gridSegments];for(const Ce of I){const Me=M.getTile(Ce),Le=f.ah.disabled,Se=C.prevTerrainTileForTile[Ce.key],we=C.terrainTileForTile[Ce.key];i_(Se,we)&&Vu.newMorphing(Ce.key,Se,we,F,250),B.activeTexture.set(j.TEXTURE0),Me.texture&&Me.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Ue=Vu.getMorphValuesForProxy(Ce.key),et=Ue?1:0;let Fe;Ue&&(Fe={morphing:{srcDemTile:Ue.from,dstDemTile:Ue.to,phase:f.bb(Ue.phase)}});const Mt=wx(Ce.projMatrix,Am(Ce.canonical,ge.renderWorldCopies)?ae/10:ae,ce);if(re(et),!Z)continue;C.setupElevationDraw(Me,Z,Fe);const pt=Ce.toUnwrapped();J&&J.setupShadows(pt,Z),w.uploadCommonUniforms(B,Z,pt,null,ne),Z.draw(w,xe,se,Le,ie,f.ag.backCCW,Mt,"terrain_raster",C.gridBuffer,ve,ye)}}}}(p,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const p=this.painter,v=this.painter.context,w=this.proxySourceCache,C=this.proxiedCoords[w.id],M=this._drapedRenderBatches.shift(),I=p.style.order,F=[];let B=0;for(const j of C){const Z=w.getTileByID(j.proxyTileKey),K=w.proxyCachedFBO[j.key]?w.proxyCachedFBO[j.key][c]:void 0,J=void 0!==K?w.renderCache[K]:this.pool[B++],ne=void 0!==K;if(Z.texture=J.tex,ne&&!J.dirty){F.push(Z.tileID);continue}let re;v.bindFramebuffer.set(J.fb.framebuffer),this.renderedToTile=!1,J.dirty&&(v.clear({color:f.C.transparent,stencil:0}),J.dirty=!1);for(let ie=M.start;ie<=M.end;++ie){const se=p.style._mergedLayers[I[ie]];if(se.isHidden(p.transform.zoom))continue;const ge=p.style.getLayerSourceCache(se),ae=ge?this.proxyToSource[j.key][ge.id]:[j];if(!ae)continue;const ce=ae;v.viewport.set([0,0,J.fb.width,J.fb.height]),re!==(ge?ge.id:null)&&(this._setupStencil(J,ae,se,ge),re=ge?ge.id:null),p.renderLayer(p,ge,se,ce)}if(0===this._drapedRenderBatches.length)for(const ie of this._pendingGroundEffectLayers){const se=p.style._mergedLayers[I[ie]];if(se.isHidden(p.transform.zoom))continue;const ge=p.style.getLayerSourceCache(se),ae=ge?this.proxyToSource[j.key][ge.id]:[j];if(!ae)continue;const ce=ae;v.viewport.set([0,0,J.fb.width,J.fb.height]),re!==(ge?ge.id:null)&&(this._setupStencil(J,ae,se,ge),re=ge?ge.id:null),p.renderLayer(p,ge,se,ce)}this.renderedToTile?(J.dirty=!0,F.push(Z.tileID)):ne||--B,5===B&&(B=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,p.width,p.height]),M.end+1}postRender(){}isLayerOrderingCorrect(c){const p=c.order.length;let v=-1,w=p;for(let C=0;C<p;++C)this._style.isLayerDraped(c._mergedLayers[c.order[C]])?v=Math.max(v,C):w=Math.min(w,C);return w>v}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{c=Math.min(c,p.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,p,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const M=C.tileID,I=1<<M.overscaledZ,{x:F,y:B}=M.canonical,j=F/I,Z=(F+1)/I,K=B/I,J=(B+1)/I;return{minx:j,miny:K,maxx:Z,maxy:J,t:C.dem.tree.raycastRoot(j,K,Z,J,c,p,v),tile:C}});w.sort((C,M)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const C of w){if(null==C.t)return null;const M=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,c,p,v);if(null!=M)return M}return null}_createFBO(){const c=this.painter.context,p=c.gl,v=this.drapeBufferSize;c.activeTexture.set(p.TEXTURE0);const w=new f.T(c,{width:v[0],height:v[1],data:null},p.RGBA);w.bind(p.LINEAR,p.CLAMP_TO_EDGE);const C=c.createFramebuffer(v[0],v[1],!0,null);return C.colorAttachment.set(w.texture),C.depthAttachment=new cs(c,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:C,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const p=this._style._mergedLayers[c],v=p.isHidden(this.painter.transform.zoom);return"custom"===p.type?!v&&p.shouldRedrape():!v&&p.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const v of this._style.getSources())if(v instanceof bx){c=!0;break}if(!c)return;const p={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],C=this._style.getLayerSourceCache(w);if(C&&!p[C.id]&&!w.isHidden(this.painter.transform.zoom)&&"line"===w.type&&w.widthExpression()instanceof f.Z){p[C.id]=!0;for(const M of this.proxyCoords){const I=this.proxyToSource[M.key][C.id];if(I)for(const F of I)this._clearRenderCacheForTile(C.id,F)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const v in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[v]._source instanceof Ul){c=!0;break}if(!c)return;const p={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],C=this._style.getLayerSourceCache(w);if(!C||p[C.id]||w.isHidden(this.painter.transform.zoom)||"raster"!==w.type)continue;const M=w.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const F=this.proxyToSource[I.key][C.id];if(F)for(const B of F){const j=o_(C.getTile(B),C.findLoadedParent(B,0),C,this.painter.transform,M);(1!==j.opacity||0!==j.mix)&&this._clearRenderCacheForTile(C.id,B)}}}}_setupDrapedRenderBatches(){const c=this._style.order,p=c.length;if(0===p)return;const v=[];this._pendingGroundEffectLayers=[];let w,C=0,M=this._style._mergedLayers[c[C]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++C<p;)M=this._style._mergedLayers[c[C]];for(;C<p;++C){const I=this._style._mergedLayers[c[C]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?void 0===w&&(w=C):("fill-extrusion"===I.type&&this._pendingGroundEffectLayers.push(C),void 0!==w&&(v.push({start:w,end:C-1}),w=void 0)))}if(void 0!==w&&v.push({start:w,end:C-1}),0!==v.length){const I=v[v.length-1];this._pendingGroundEffectLayers.every(F=>F>I.end)||f.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=v}_setupRenderCache(c){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const M=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let I=0;I<M.length;++I){const F=Object.values(M[I]);p.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let M=v.length-1;M>=0;M--){const I=v[M];if(p.getTileByID(I.key),void 0!==p.proxyCachedFBO[I.key]){const F=c[I.key],B=this.proxyToSource[I.key];let j=0;for(const Z in B){const K=B[Z],J=F[Z];if(!J||J.length!==K.length||K.some((ne,re)=>ne!==J[re]||w[Z]&&w[Z].hasOwnProperty(ne.key))){j=-1;break}++j}for(const Z in p.proxyCachedFBO[I.key])p.renderCache[p.proxyCachedFBO[I.key][Z]].dirty=j<0||j!==Object.values(F).length}}const C=[...this._drapedRenderBatches];C.sort((M,I)=>I.end-I.start-(M.end-M.start));for(const M of C)for(const I of v){if(p.proxyCachedFBO[I.key])continue;let F=p.renderCachePool.pop();void 0===F&&p.renderCache.length<50&&(F=p.renderCache.length,p.renderCache.push(this._createFBO())),void 0!==F&&(p.proxyCachedFBO[I.key]={},p.proxyCachedFBO[I.key][M.start]=F,p.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(c,p,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,M=C.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let I;if(v.isTileClipped())I=p.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):f.ah.disabled}_renderTileClippingMasks(c,p){const v=this.painter,w=this.painter.context,C=w.gl;v._tileClippingMaskIDs={},w.setColorMode(f.a.disabled),w.setDepthMode(f.af.disabled);const M=v.getOrCreateProgram("clippingMask");for(const I of c){const F=v._tileClippingMaskIDs[I.key]=--p;M.draw(v,C.TRIANGLES,f.af.disabled,new f.ah({func:C.ALWAYS,mask:0},F,255,C.KEEP,C.KEEP,C.REPLACE),f.a.disabled,f.ag.disabled,s_(I.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(c){const p=this.painter.transform;if(c.x<0||c.x>p.width||c.y<0||c.y>p.height)return null;const v=[c.x,c.y,1,1];f.aB.transformMat4(v,v,p.pixelMatrixInverse),f.aB.scale(v,v,1/v[3]),v[0]/=p.worldSize,v[1]/=p.worldSize;const w=p._camera.position,C=f.ay(1,p.center.lat),M=[w[0],w[1],w[2]/C,0],I=f.$.subtract([],v.slice(0,3),M);f.$.normalize(I,I);const F=this.raycast(M,I,this._exaggeration);return null!==F&&F?(f.$.scaleAndAdd(M,M,I,F),M[3]=M[2],M[2]*=C,M):null}_setupProxiedCoordsForOrtho(c,p,v){if(c.getSource()instanceof f.bo)return this._setupProxiedCoordsForImageSource(c,p,v);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords;for(let F=0;F<C.length;F++){const B=C[F],j=this._findTileCoveringTileID(B,c);if(j){const Z=this._createProxiedId(B,j,v[B.key]&&v[B.key][c.id]);w.push(Z),this.proxyToSource[B.key][c.id]=[Z]}}let M=!1;const I=new Set;for(let F=0;F<p.length;F++){const B=c.getTile(p[F]);if(!B||!B.hasData())continue;const j=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==B.tileID.canonical.z){const Z=this.proxyToSource[j.tileID.key][c.id],K=this._createProxiedId(j.tileID,B,v[j.tileID.key]&&v[j.tileID.key][c.id]);Z?Z.splice(Z.length-1,0,K):this.proxyToSource[j.tileID.key][c.id]=[K];const J=this.proxyToSource[j.tileID.key][c.id];I.has(J)||I.add(J),w.push(K),M=!0}}if(this._sourceTilesOverlap[c.id]=M,M&&this._debugParams.sortTilesHiZFirst)for(const F of I)F.sort((B,j)=>j.overscaledZ-B.overscaledZ)}_setupProxiedCoordsForImageSource(c,p,v){if(!c.getSource().loaded())return;const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords,M=c.getSource(),I=M.tileID;if(!I)return;const F=new f.P(I.x,I.y)._div(1<<I.z),B=M.coordinates.map(f._.fromLngLat).reduce((Z,K)=>(Z.min.x=Math.min(Z.min.x,K.x-F.x),Z.min.y=Math.min(Z.min.y,K.y-F.y),Z.max.x=Math.max(Z.max.x,K.x-F.x),Z.max.y=Math.max(Z.max.y,K.y-F.y),Z),{min:new f.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(Z,K)=>{const J=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),ne=Z.canonical.y/(1<<Z.canonical.z),re=f.a4/(1<<Z.canonical.z),ie=K.wrap+K.canonical.x/(1<<K.canonical.z),se=K.canonical.y/(1<<K.canonical.z);return J+re<ie+B.min.x||J>ie+B.max.x||ne+re<se+B.min.y||ne>se+B.max.y};for(let Z=0;Z<C.length;Z++){const K=C[Z];for(let J=0;J<p.length;J++){const ne=c.getTile(p[J]);if(!ne||!ne.hasData()||j(K,ne.tileID))continue;const re=this._createProxiedId(K,ne,v[K.key]&&v[K.key][c.id]),ie=this.proxyToSource[K.key][c.id];ie?ie.push(re):this.proxyToSource[K.key][c.id]=[re],w.push(re)}}}_createProxiedId(c,p,v){let w=this.orthoMatrix;if(v){const C=v.find(M=>M.key===p.tileID.key);if(C)return C}if(p.tileID.key!==c.key){const C=c.canonical.z-p.tileID.canonical.z;let M,I,F;w=f.ae.create();const B=p.tileID.wrap-c.wrap<<c.overscaledZ;C>0?(M=f.a4>>C,I=M*((p.tileID.canonical.x<<C)-c.canonical.x+B),F=M*((p.tileID.canonical.y<<C)-c.canonical.y)):(M=f.a4<<-C,I=f.a4*(p.tileID.canonical.x-(c.canonical.x+B<<-C)),F=f.a4*(p.tileID.canonical.y-(c.canonical.y<<-C))),f.ae.ortho(w,0,M,0,M,0,1),f.ae.translate(w,w,[I,F,0])}return new ju(p.tileID,c.key,w)}_findTileCoveringTileID(c,p){let v=p.getTile(c);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[p.id],C=w[c.key];if(v=C?p.getTileByID(C):null,v&&v.hasData()||null===C)return v;let M=v?v.tileID:c,I=M.overscaledZ;const F=p.getSource().minzoom,B=[];if(!C){const Z=p.getSource().maxzoom;if(c.canonical.z>=Z){const K=c.canonical.z-Z;p.getSource().reparseOverscaled?(I=Math.max(c.canonical.z+2,p.transform.tileZoom),M=new f.aQ(I,c.wrap,Z,c.canonical.x>>K,c.canonical.y>>K)):0!==K&&(I=Z,M=new f.aQ(I,c.wrap,Z,c.canonical.x>>K,c.canonical.y>>K))}M.key!==c.key&&(B.push(M.key),v=p.getTile(M))}const j=Z=>{B.forEach(K=>{w[K]=Z}),B.length=0};for(I-=1;I>=F&&(!v||!v.hasData());I--){v&&j(v.tileID.key);const Z=M.calculateScaledKey(I);if(v=p.getTileByID(Z),v&&v.hasData())break;const K=w[Z];if(null===K)break;void 0===K?B.push(Z):v=p.getTileByID(K)}return j(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,p){let v=this._tilesDirty[c];v||(v=this._tilesDirty[c]={}),v[p.key]=!0}}function sT(y,c,p){const v=function(I,F,B){const j=f.$.dot(F,I),Z=f.$.dot(B,[.2126,.7152,.0722]),K=(ne,re,ie)=>(1-ie)*ne+ie*re,J=K(1-.3*Math.min(Z,1),1,Math.min(j+1,1));return K(.92,1,Math.asin(f.au(F[2],-1,1))/Math.PI+.5)*J}(y,[0,0,1],c),w=[0,0,0];f.$.scale(w,p.slice(0,3),v);const C=[0,0,0];f.$.scale(C,c.slice(0,3),y[2]);const M=[0,0,0];return f.$.add(M,w,C),f.ba(M)}const c_=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],u_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class D1{static cacheKey(c,p,v,w){let C=`${p}${w?w.cacheKey:""}`;for(const M of v)c.usedDefines.includes(M)&&(C+=`/${M}`);return C}constructor(c,p,v,w,C,M){const I=c.gl;this.program=I.createProgram(),this.configuration=w,this.name=p,this.fixedDefines=[...M];const F=w?w.getBinderAttributes():[],B=(v.staticAttributes||[]).concat(F);let j=w?w.defines():[];j=j.concat(M.map(ie=>`#define ${ie}`));const Z="#version 300 es\n";let K=Z+j.concat("precision mediump float;",_x,Qg.fragmentSource).join("\n");for(const ie of v.fragmentIncludes)K+=`\n${vm[ie]}`;K+=`\n${v.fragmentSource}`;let J=Z+j.concat("precision highp float;",_x,Qg.vertexSource).join("\n");for(const ie of v.vertexIncludes)J+=`\n${vm[ie]}`;J+=`\n${v.vertexSource}`;const ne=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ne,K),I.compileShader(ne),I.attachShader(this.program,ne);const re=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(re,J),I.compileShader(re),I.attachShader(this.program,re),this.attributes={},this.numAttributes=B.length;for(let ie=0;ie<this.numAttributes;ie++)if(B[ie]){const se=B[ie].startsWith("a_")?B[ie]:`a_${B[ie]}`;I.bindAttribLocation(this.program,ie,se),this.attributes[se]=ie}I.linkProgram(this.program),I.deleteShader(re),I.deleteShader(ne),this.fixedUniforms=C(c),this.binderUniforms=w?w.getUniforms(c):[],(M.includes("TERRAIN")||-1!==p.indexOf("symbol")||-1!==p.indexOf("circle"))&&(this.terrainUniforms={u_dem:new f.a8(ie=c),u_dem_prev:new f.a8(ie),u_dem_tl:new f.a9(ie),u_dem_scale:new f.ab(ie),u_dem_tl_prev:new f.a9(ie),u_dem_scale_prev:new f.ab(ie),u_dem_size:new f.ab(ie),u_dem_lerp:new f.ab(ie),u_exaggeration:new f.ab(ie),u_depth:new f.a8(ie),u_depth_size_inv:new f.a9(ie),u_depth_range_unpack:new f.a9(ie),u_occluder_half_size:new f.ab(ie),u_occlusion_depth_offset:new f.ab(ie),u_meter_to_dem:new f.ab(ie),u_label_plane_matrix_inv:new f.a7(ie)}),M.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new f.ar(ie),u_tile_tr_up:new f.ar(ie),u_tile_br_up:new f.ar(ie),u_tile_bl_up:new f.ar(ie),u_tile_up_scale:new f.ab(ie)}))(c)),M.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new f.a7(ie),u_fog_range:new f.a9(ie),u_fog_color:new f.at(ie),u_fog_horizon_blend:new f.ab(ie),u_fog_vertical_limit:new f.a9(ie),u_fog_temporal_offset:new f.ab(ie),u_frustum_tl:new f.ar(ie),u_frustum_tr:new f.ar(ie),u_frustum_br:new f.ar(ie),u_frustum_bl:new f.ar(ie),u_globe_pos:new f.ar(ie),u_globe_radius:new f.ab(ie),u_globe_transition:new f.ab(ie),u_is_globe:new f.a8(ie),u_viewport:new f.a9(ie)}))(c)),M.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new f.at(ie)}))(c)),M.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new f.ar(ie),u_lighting_directional_dir:new f.ar(ie),u_lighting_directional_color:new f.ar(ie),u_ground_radiance:new f.ar(ie)}))(c)),M.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new f.a7(ie),u_light_matrix_1:new f.a7(ie),u_fade_range:new f.a9(ie),u_shadow_normal_offset:new f.ar(ie),u_shadow_intensity:new f.ab(ie),u_shadow_texel_size:new f.ab(ie),u_shadow_map_resolution:new f.ab(ie),u_shadow_direction:new f.ar(ie),u_shadow_bias:new f.ar(ie),u_shadowmap_0:new f.a8(ie),u_shadowmap_1:new f.a8(ie)}))(c))}var ie}setTerrainUniformValues(c,p){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w]&&v[w].set(this.program,w,p[w])}}setGlobeUniformValues(c,p){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w]&&v[w].set(this.program,w,p[w])}}setFogUniformValues(c,p){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w].set(this.program,w,p[w])}}setCutoffUniformValues(c,p){if(!this.cutoffUniforms)return;const v=this.cutoffUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w].set(this.program,w,p[w])}}setLightsUniformValues(c,p){if(!this.lightsUniforms)return;const v=this.lightsUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w].set(this.program,w,p[w])}}setShadowUniformValues(c,p){if(this.failedToCreate||!this.shadowUniforms)return;const v=this.shadowUniforms;c.program.set(this.program);for(const w in p)v[w].set(this.program,w,p[w])}_drawDebugWireframe(c,p,v,w,C,M,I,F,B,j){const Z=c.options.wireframe;if(!1===Z.terrain&&!1===Z.layers2D&&!1===Z.layers3D)return;const K=c.context;if(!(Z.terrain&&("terrainRaster"===this.name||"globeRaster"===this.name)||!(!Z.layers2D||c._terrain&&c._terrain.renderingToTexture)&&c_.includes(this.name)||Z.layers3D&&u_.includes(this.name)))return;const J=K.gl,ne=c.wireframeDebugCache.getLinesFromTrianglesBuffer(c.frameCounter,C,K);if(!ne)return;const re=[...this.fixedDefines];re.push("DEBUG_WIREFRAME");const ie=c.getOrCreateProgram(this.name,{config:this.configuration,defines:re});K.program.set(ie.program);const se=(ce,xe,ve)=>{if(xe[ce]&&ve[ce])for(const ye in xe[ce])ve[ce][ye]&&ve[ce][ye].set(ve.program,ye,xe[ce][ye].current)};B&&B.setUniforms(ie.program,K,ie.binderUniforms,I,{zoom:F}),se("fixedUniforms",this,ie),se("terrainUniforms",this,ie),se("globeUniforms",this,ie),se("fogUniforms",this,ie),se("lightsUniforms",this,ie),se("shadowUniforms",this,ie),ne.bind(),K.setColorMode(new f.a([J.ONE,J.ONE_MINUS_SRC_ALPHA,J.ZERO,J.ONE],f.C.transparent,[!0,!0,!0,!1])),K.setDepthMode(new f.af(p.func===J.LESS?J.LEQUAL:p.func,f.af.ReadOnly,p.range)),K.setStencilMode(f.ah.disabled);const ge=3*M.primitiveLength*2,ae=3*M.primitiveOffset*2*2;j&&j>1?J.drawElementsInstanced(J.LINES,ge,J.UNSIGNED_SHORT,ae,j):J.drawElements(J.LINES,ge,J.UNSIGNED_SHORT,ae),C.bind(),K.program.set(this.program),K.setDepthMode(p),K.setStencilMode(v),K.setColorMode(w)}draw(c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie){const se=c.context,ge=se.gl;if(this.failedToCreate)return;se.program.set(this.program),se.setDepthMode(v),se.setStencilMode(w),se.setColorMode(C),se.setCullFace(M);for(const xe of Object.keys(this.fixedUniforms))this.fixedUniforms[xe].set(this.program,xe,I[xe]);ne&&ne.setUniforms(this.program,se,this.binderUniforms,K,{zoom:J});const ae={[ge.POINTS]:1,[ge.LINES]:2,[ge.TRIANGLES]:3,[ge.LINE_STRIP]:1}[p],ce=ie&&ie>0?1:void 0;for(const xe of Z.get()){const ve=xe.vaos||(xe.vaos={});(ve[F]||(ve[F]=new nT)).bind(se,this,B,ne?ne.getPaintVertexBuffers():[],j,xe.vertexOffset,re||[],ce),ie&&ie>1?ge.drawElementsInstanced(p,xe.primitiveLength*ae,ge.UNSIGNED_SHORT,xe.primitiveOffset*ae*2,ie):j?ge.drawElements(p,xe.primitiveLength*ae,ge.UNSIGNED_SHORT,xe.primitiveOffset*ae*2):ge.drawArrays(p,xe.vertexOffset,xe.vertexLength),p===ge.TRIANGLES&&j&&this._drawDebugWireframe(c,v,w,C,j,xe,K,J,ne,ie)}}}function M1(y,c){const p=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,y.transform.tileZoom)/p,w=v*(c.tileID.canonical.x+c.tileID.wrap*p),C=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture?c.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/f.bD(c,1,y.transform.tileZoom),u_pixel_coord_upper:[w>>16,C>>16],u_pixel_coord_lower:[65535&w,65535&C]}}const Mx=f.ae.create(),Rc=(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie,se)=>{const ge=c.style.light,ae=ge.properties.get("position"),ce=[ae.x,ae.y,ae.z],xe=f.bE.create();"viewport"===ge.properties.get("anchor")&&(f.bE.fromRotation(xe,-c.transform.angle),f.$.transformMat3(ce,ce,xe));const ve=ge.properties.get("color"),ye=c.transform,Ce={u_matrix:y,u_lightpos:ce,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_vertical_gradient:+p,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mx,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:C,u_alignment:M,u_width_scale:I,u_flood_light_color:J,u_vertical_scale:ne,u_flood_light_intensity:re,u_ground_shadow_factor:ie,u_emissive_strength:se};return"globe"===ye.projection.name&&(Ce.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],Ce.u_zoom_transition=j,Ce.u_inv_rot_matrix=K,Ce.u_merc_center=Z,Ce.u_up_dir=ye.projection.upVector(new f.aO(0,0,0),Z[0]*f.a4,Z[1]*f.a4),Ce.u_height_lift=B),Ce},A1=(y,c,p,v,w)=>({u_matrix:y,u_edge_radius:c,u_alignment:p,u_width_scale:v,u_vertical_scale:w}),oT=(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re)=>{const ie=Rc(y,c,p,v,w,C,M,I,F,j,Z,K,J,ne,re,1,[0,0,0],0),se={u_height_factor:-Math.pow(2,F.overscaledZ)/B.tileSize/8};return f.Q(ie,M1(c,B),se)},d_=(y,c)=>({u_matrix:y,u_emissive_strength:c}),I1=(y,c,p,v)=>f.Q(d_(y,c),M1(p,v)),k1=(y,c,p)=>({u_matrix:y,u_world:p,u_emissive_strength:c}),h_=(y,c,p,v,w)=>f.Q(I1(y,c,p,v),{u_world:w}),Im=(y,c,p,v)=>{const w=f.a4/p.tileSize;return{u_matrix:y,u_camera_to_center_distance:c.getCameraToCenterDistance(v),u_extrude_scale:[c.pixelsToGLUnits[0]/w,c.pixelsToGLUnits[1]/w]}},O1=(y,c,p=1)=>({u_matrix:y,u_color:c.toRenderColor(null),u_overlay:0,u_overlay_scale:p}),P1=f.ae.create(),ln=(y,c,p,v,w,C,M)=>{const I=y.transform,F="globe"===I.projection.name,B=F?f.bF(I.zoom,c.canonical)*I._pixelsPerMercatorPixel:f.bD(p,1,C),j={u_matrix:c.projMatrix,u_extrude_scale:B,u_intensity:M,u_inv_rot_matrix:P1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){j.u_inv_rot_matrix=v,j.u_merc_center=w,j.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],j.u_zoom_transition=f.a2(I.zoom);const Z=w[0]*f.a4,K=w[1]*f.a4;j.u_up_dir=I.projection.upVector(new f.aO(0,0,0),Z,K)}return j};function Fd(y,[c,p,v,w],[C,M]){if(C===M)return[0,0,0,0];const I=255*(y-1)/(y*(M-C));return[c*I,p*I,v*I,w*I]}function Ld(y,c,[p,v]){return p===v?0:.5/y+(c-p)*(y-1)/(y*(v-p))}const km=(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie,se,ge,ae,ce)=>({u_matrix:y,u_normalize_matrix:c,u_globe_matrix:p,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:C,u_scale_parent:B,u_fade_t:j.mix,u_opacity:j.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:f.bG(Z.paint.get("raster-saturation")),u_contrast_factor:f.bH(Z.paint.get("raster-contrast")),u_spin_weights:Ax(Z.paint.get("raster-hue-rotate")),u_perspective_transform:K,u_raster_elevation:J,u_zoom_transition:M,u_merc_center:I,u_cutoff_params:F,u_colorization_mix:Fd(f.bI,re,se),u_colorization_offset:Ld(f.bI,ie,se),u_color_ramp:ne,u_texture_offset:[ae/(ge+2*ae),ge/(ge+2*ae)],u_texture_res:[ge+2*ae,ge+2*ae],u_emissive_strength:ce});function Ax(y){y*=Math.PI/180;const c=Math.sin(y),p=Math.cos(y);return[(2*p+1)/3,(-Math.sqrt(3)*c-p+1)/3,(Math.sqrt(3)*c-p+1)/3]}const $u=.05,Bd=(y,c,p,v,w,C,M,I,F,B,j,Z)=>({u_matrix:y,u_normalize_matrix:c,u_globe_matrix:p,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:C,u_scale_parent:B,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:Z,u_zoom_transition:M,u_merc_center:I,u_cutoff_params:F}),Hu=(y,c,p,v,w,C,M,I,F,B)=>({u_particle_texture:y,u_particle_texture_side_len:c,u_tile_offset:p,u_velocity:v,u_color_ramp:C,u_velocity_res:w,u_max_speed:M,u_uv_offset:I,u_data_scale:[255*F[0],255*F[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[$u,$u]}),rf=(y,c,p,v,w,C,M,I,F,B)=>({u_particle_texture:y,u_particle_texture_side_len:c,u_velocity:p,u_velocity_res:v,u_max_speed:w,u_speed_factor:C,u_reset_rate:M,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*F[0],255*F[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[$u,$u]}),su=f.ae.create(),Nc=(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie,se)=>{const ge=w.transform,ae={u_is_size_zoom_constant:+("constant"===y||"source"===y),u_is_size_feature_constant:+("constant"===y||"camera"===y),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ge.getCameraToCenterDistance(re),u_rotate_symbol:+p,u_aspect_ratio:ge.width/ge.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:M,u_coord_matrix:I,u_is_text:+F,u_pitch_with_map:+v,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:su,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:su,u_up_vector:[0,-1,0],u_color_adj_mat:ie,u_icon_transition:se||0};return"globe"===re.name&&(ae.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],ae.u_zoom_transition=Z,ae.u_inv_rot_matrix=J,ae.u_merc_center=K,ae.u_camera_forward=ge._camera.forward(),ae.u_ecef_origin=f.bJ(ge.globeMatrix,j.toUnwrapped()),ae.u_tile_matrix=Float32Array.from(ge.globeMatrix),ae.u_up_vector=ne),ae},ip=(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie)=>f.Q(Nc(y,c,p,v,w,C,M,I,F,B,Z,K,J,ne,re,ie),{u_gamma_scale:v?w.transform.getCameraToCenterDistance(ie)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:f.e.devicePixelRatio,u_is_halo:+j,undefined:void 0}),Om=(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re)=>f.Q(ip(y,c,p,v,w,C,M,I,!0,F,!0,j,Z,K,J,ne,re),{u_texsize_icon:B,u_texture_icon:1}),zd=(y,c,p,v)=>({u_matrix:y,u_emissive_strength:c,u_opacity:p,u_color:v}),OD=(y,c,p,v,w,C,M,I)=>f.Q(function(F,B,j,Z,K){const{width:J,height:ne}=Z.imageManager.getPixelSize(B),re=Math.pow(2,K.tileID.overscaledZ),ie=K.tileSize*Math.pow(2,Z.transform.tileZoom)/re,se=ie*(K.tileID.canonical.x+K.tileID.wrap*re),ge=ie*K.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[J,ne],u_pattern_size:j.displaySize,u_tile_units_to_pixels:1/f.bD(K,1,Z.transform.tileZoom),u_pixel_coord_upper:[se>>16,ge>>16],u_pixel_coord_lower:[65535&se,65535&ge]}}(0,C,M,v,I),{u_matrix:y,u_emissive_strength:c,u_opacity:p}),bi=new Float32Array(f.ae.identity([])),sp=(y,c,p,v,w,C,M,I,F,B,j,Z,K,J=[0,0,0],ne)=>{const re=w.style.light,ie=re.properties.get("position"),se=[-ie.x,-ie.y,ie.z],ge=f.bE.create();"viewport"===re.properties.get("anchor")&&(f.bE.fromRotation(ge,-w.transform.angle),f.$.transformMat3(se,se,ge));const ae="MASK"===j.alphaMode,ce=re.properties.get("color").toRenderColor(null),xe=K.paint.get("model-ambient-occlusion-intensity"),ve=K.paint.get("model-color").constantOr(f.C.white).toRenderColor(null),ye=K.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:y,u_lighting_matrix:c,u_normal_matrix:p,u_node_matrix:v||bi,u_lightpos:se,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:J,u_opacity:C,u_baseTextureIsAlpha:0,u_alphaMask:+ae,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:[M.r,M.g,M.b,M.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:F,u_roughnessFactor:B,u_baseColorTexture:ka.BaseColor,u_metallicRoughnessTexture:ka.MetallicRoughness,u_normalTexture:ka.Normal,u_occlusionTexture:ka.Occlusion,u_emissionTexture:ka.Emission,u_lutTexture:ka.LUT,u_color_mix:[ve.r,ve.g,ve.b,ye],u_aoIntensity:xe,u_emissive_strength:Z,u_occlusionTextureTransform:ne||[0,0,0,0]}},Ix=(y,c=bi,p=bi)=>({u_matrix:y,u_instance:c,u_node_matrix:p}),ts={fillExtrusion:y=>({u_matrix:new f.a7(y),u_lightpos:new f.ar(y),u_lightintensity:new f.ab(y),u_lightcolor:new f.ar(y),u_vertical_gradient:new f.ab(y),u_opacity:new f.ab(y),u_edge_radius:new f.ab(y),u_alignment:new f.ab(y),u_width_scale:new f.ab(y),u_ao:new f.a9(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_up_dir:new f.ar(y),u_height_lift:new f.ab(y),u_flood_light_color:new f.ar(y),u_vertical_scale:new f.ab(y),u_flood_light_intensity:new f.ab(y),u_ground_shadow_factor:new f.ar(y),u_emissive_strength:new f.ab(y)}),fillExtrusionDepth:y=>({u_matrix:new f.a7(y),u_edge_radius:new f.ab(y),u_alignment:new f.ab(y),u_width_scale:new f.ab(y),u_vertical_scale:new f.ab(y)}),fillExtrusionPattern:y=>({u_matrix:new f.a7(y),u_lightpos:new f.ar(y),u_lightintensity:new f.ab(y),u_lightcolor:new f.ar(y),u_vertical_gradient:new f.ab(y),u_height_factor:new f.ab(y),u_edge_radius:new f.ab(y),u_alignment:new f.ab(y),u_width_scale:new f.ab(y),u_ao:new f.a9(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_up_dir:new f.ar(y),u_height_lift:new f.ab(y),u_image:new f.a8(y),u_texsize:new f.a9(y),u_pixel_coord_upper:new f.a9(y),u_pixel_coord_lower:new f.a9(y),u_tile_units_to_pixels:new f.ab(y),u_opacity:new f.ab(y)}),fillExtrusionGroundEffect:y=>({u_matrix:new f.a7(y),u_opacity:new f.ab(y),u_ao_pass:new f.ab(y),u_meter_to_tile:new f.ab(y),u_ao:new f.a9(y),u_flood_light_intensity:new f.ab(y),u_flood_light_color:new f.ar(y),u_attenuation:new f.ab(y),u_edge_radius:new f.ab(y),u_fb:new f.a8(y),u_fb_size:new f.ab(y)}),fill:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y)}),fillPattern:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_image:new f.a8(y),u_texsize:new f.a9(y),u_pixel_coord_upper:new f.a9(y),u_pixel_coord_lower:new f.a9(y),u_tile_units_to_pixels:new f.ab(y)}),fillOutline:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_world:new f.a9(y)}),fillOutlinePattern:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_world:new f.a9(y),u_image:new f.a8(y),u_texsize:new f.a9(y),u_pixel_coord_upper:new f.a9(y),u_pixel_coord_lower:new f.a9(y),u_tile_units_to_pixels:new f.ab(y)}),circle:f.bK,collisionBox:y=>({u_matrix:new f.a7(y),u_camera_to_center_distance:new f.ab(y),u_extrude_scale:new f.a9(y)}),collisionCircle:y=>({u_matrix:new f.a7(y),u_inv_matrix:new f.a7(y),u_camera_to_center_distance:new f.ab(y),u_viewport_size:new f.a9(y)}),debug:y=>({u_color:new f.aa(y),u_matrix:new f.a7(y),u_overlay:new f.a8(y),u_overlay_scale:new f.ab(y)}),clippingMask:y=>({u_matrix:new f.a7(y)}),heatmap:y=>({u_extrude_scale:new f.ab(y),u_intensity:new f.ab(y),u_matrix:new f.a7(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_up_dir:new f.ar(y)}),heatmapTexture:y=>({u_image:new f.a8(y),u_color_ramp:new f.a8(y),u_opacity:new f.ab(y)}),hillshade:y=>({u_matrix:new f.a7(y),u_image:new f.a8(y),u_latrange:new f.a9(y),u_light:new f.a9(y),u_shadow:new f.aa(y),u_highlight:new f.aa(y),u_emissive_strength:new f.ab(y),u_accent:new f.aa(y)}),hillshadePrepare:y=>({u_matrix:new f.a7(y),u_image:new f.a8(y),u_dimension:new f.a9(y),u_zoom:new f.ab(y)}),line:f.bL,linePattern:f.bM,raster:y=>({u_matrix:new f.a7(y),u_normalize_matrix:new f.a7(y),u_globe_matrix:new f.a7(y),u_merc_matrix:new f.a7(y),u_grid_matrix:new f.as(y),u_tl_parent:new f.a9(y),u_scale_parent:new f.ab(y),u_fade_t:new f.ab(y),u_opacity:new f.ab(y),u_image0:new f.a8(y),u_image1:new f.a8(y),u_brightness_low:new f.ab(y),u_brightness_high:new f.ab(y),u_saturation_factor:new f.ab(y),u_contrast_factor:new f.ab(y),u_spin_weights:new f.ar(y),u_perspective_transform:new f.a9(y),u_raster_elevation:new f.ab(y),u_zoom_transition:new f.ab(y),u_merc_center:new f.a9(y),u_cutoff_params:new f.at(y),u_colorization_mix:new f.at(y),u_colorization_offset:new f.ab(y),u_color_ramp:new f.a8(y),u_texture_offset:new f.a9(y),u_texture_res:new f.a9(y),u_emissive_strength:new f.ab(y)}),rasterParticle:y=>({u_matrix:new f.a7(y),u_normalize_matrix:new f.a7(y),u_globe_matrix:new f.a7(y),u_merc_matrix:new f.a7(y),u_grid_matrix:new f.as(y),u_tl_parent:new f.a9(y),u_scale_parent:new f.ab(y),u_fade_t:new f.ab(y),u_opacity:new f.ab(y),u_image0:new f.a8(y),u_image1:new f.a8(y),u_raster_elevation:new f.ab(y),u_zoom_transition:new f.ab(y),u_merc_center:new f.a9(y),u_cutoff_params:new f.at(y)}),rasterParticleTexture:y=>({u_texture:new f.a8(y),u_opacity:new f.ab(y)}),rasterParticleDraw:y=>({u_particle_texture:new f.a8(y),u_particle_texture_side_len:new f.ab(y),u_tile_offset:new f.a9(y),u_velocity:new f.a8(y),u_color_ramp:new f.a8(y),u_velocity_res:new f.a9(y),u_max_speed:new f.ab(y),u_uv_offset:new f.a9(y),u_data_scale:new f.a9(y),u_data_offset:new f.ab(y),u_particle_pos_scale:new f.ab(y),u_particle_pos_offset:new f.a9(y)}),rasterParticleUpdate:y=>({u_particle_texture:new f.a8(y),u_particle_texture_side_len:new f.ab(y),u_velocity:new f.a8(y),u_velocity_res:new f.a9(y),u_max_speed:new f.ab(y),u_speed_factor:new f.ab(y),u_reset_rate:new f.ab(y),u_rand_seed:new f.ab(y),u_uv_offset:new f.a9(y),u_data_scale:new f.a9(y),u_data_offset:new f.ab(y),u_particle_pos_scale:new f.ab(y),u_particle_pos_offset:new f.a9(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new f.a8(y),u_is_size_feature_constant:new f.a8(y),u_size_t:new f.ab(y),u_size:new f.ab(y),u_camera_to_center_distance:new f.ab(y),u_rotate_symbol:new f.a8(y),u_aspect_ratio:new f.ab(y),u_fade_change:new f.ab(y),u_matrix:new f.a7(y),u_label_plane_matrix:new f.a7(y),u_coord_matrix:new f.a7(y),u_is_text:new f.a8(y),u_pitch_with_map:new f.a8(y),u_texsize:new f.a9(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_camera_forward:new f.ar(y),u_tile_matrix:new f.a7(y),u_up_vector:new f.ar(y),u_ecef_origin:new f.ar(y),u_texture:new f.a8(y),u_icon_transition:new f.ab(y),u_color_adj_mat:new f.a7(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new f.a8(y),u_is_size_feature_constant:new f.a8(y),u_size_t:new f.ab(y),u_size:new f.ab(y),u_camera_to_center_distance:new f.ab(y),u_rotate_symbol:new f.a8(y),u_aspect_ratio:new f.ab(y),u_fade_change:new f.ab(y),u_matrix:new f.a7(y),u_label_plane_matrix:new f.a7(y),u_coord_matrix:new f.a7(y),u_is_text:new f.a8(y),u_pitch_with_map:new f.a8(y),u_texsize:new f.a9(y),u_texture:new f.a8(y),u_gamma_scale:new f.ab(y),u_device_pixel_ratio:new f.ab(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_camera_forward:new f.ar(y),u_tile_matrix:new f.a7(y),u_up_vector:new f.ar(y),u_ecef_origin:new f.ar(y),u_is_halo:new f.a8(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new f.a8(y),u_is_size_feature_constant:new f.a8(y),u_size_t:new f.ab(y),u_size:new f.ab(y),u_camera_to_center_distance:new f.ab(y),u_rotate_symbol:new f.a8(y),u_aspect_ratio:new f.ab(y),u_fade_change:new f.ab(y),u_matrix:new f.a7(y),u_label_plane_matrix:new f.a7(y),u_coord_matrix:new f.a7(y),u_is_text:new f.a8(y),u_pitch_with_map:new f.a8(y),u_texsize:new f.a9(y),u_texsize_icon:new f.a9(y),u_texture:new f.a8(y),u_texture_icon:new f.a8(y),u_gamma_scale:new f.ab(y),u_device_pixel_ratio:new f.ab(y),u_is_halo:new f.a8(y)}),background:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_opacity:new f.ab(y),u_color:new f.aa(y)}),backgroundPattern:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_opacity:new f.ab(y),u_image:new f.a8(y),u_pattern_tl:new f.a9(y),u_pattern_br:new f.a9(y),u_texsize:new f.a9(y),u_pattern_size:new f.a9(y),u_pixel_coord_upper:new f.a9(y),u_pixel_coord_lower:new f.a9(y),u_tile_units_to_pixels:new f.ab(y)}),terrainRaster:y=>({u_matrix:new f.a7(y),u_image0:new f.a8(y),u_skirt_height:new f.ab(y),u_ground_shadow_factor:new f.ar(y)}),skybox:y=>({u_matrix:new f.a7(y),u_sun_direction:new f.ar(y),u_cubemap:new f.a8(y),u_opacity:new f.ab(y),u_temporal_offset:new f.ab(y)}),skyboxGradient:y=>({u_matrix:new f.a7(y),u_color_ramp:new f.a8(y),u_center_direction:new f.ar(y),u_radius:new f.ab(y),u_opacity:new f.ab(y),u_temporal_offset:new f.ab(y)}),skyboxCapture:y=>({u_matrix_3f:new f.as(y),u_sun_direction:new f.ar(y),u_sun_intensity:new f.ab(y),u_color_tint_r:new f.at(y),u_color_tint_m:new f.at(y),u_luminance:new f.ab(y)}),globeRaster:y=>({u_proj_matrix:new f.a7(y),u_globe_matrix:new f.a7(y),u_normalize_matrix:new f.a7(y),u_merc_matrix:new f.a7(y),u_zoom_transition:new f.ab(y),u_merc_center:new f.a9(y),u_image0:new f.a8(y),u_grid_matrix:new f.as(y),u_skirt_height:new f.ab(y),u_far_z_cutoff:new f.ab(y),u_frustum_tl:new f.ar(y),u_frustum_tr:new f.ar(y),u_frustum_br:new f.ar(y),u_frustum_bl:new f.ar(y),u_globe_pos:new f.ar(y),u_globe_radius:new f.ab(y),u_viewport:new f.a9(y)}),globeAtmosphere:y=>({u_frustum_tl:new f.ar(y),u_frustum_tr:new f.ar(y),u_frustum_br:new f.ar(y),u_frustum_bl:new f.ar(y),u_horizon:new f.ab(y),u_transition:new f.ab(y),u_fadeout_range:new f.ab(y),u_color:new f.at(y),u_high_color:new f.at(y),u_space_color:new f.at(y),u_temporal_offset:new f.ab(y),u_horizon_angle:new f.ab(y)}),model:y=>({u_matrix:new f.a7(y),u_lighting_matrix:new f.a7(y),u_normal_matrix:new f.a7(y),u_node_matrix:new f.a7(y),u_lightpos:new f.ar(y),u_lightintensity:new f.ab(y),u_lightcolor:new f.ar(y),u_camera_pos:new f.ar(y),u_opacity:new f.ab(y),u_baseColorFactor:new f.at(y),u_emissiveFactor:new f.at(y),u_metallicFactor:new f.ab(y),u_roughnessFactor:new f.ab(y),u_baseTextureIsAlpha:new f.a8(y),u_alphaMask:new f.a8(y),u_alphaCutoff:new f.ab(y),u_baseColorTexture:new f.a8(y),u_metallicRoughnessTexture:new f.a8(y),u_normalTexture:new f.a8(y),u_occlusionTexture:new f.a8(y),u_emissionTexture:new f.a8(y),u_lutTexture:new f.a8(y),u_color_mix:new f.at(y),u_aoIntensity:new f.ab(y),u_emissive_strength:new f.ab(y),u_occlusionTextureTransform:new f.at(y)}),modelDepth:y=>({u_matrix:new f.a7(y),u_instance:new f.a7(y),u_node_matrix:new f.a7(y)}),groundShadow:y=>({u_matrix:new f.a7(y),u_ground_shadow_factor:new f.ar(y)}),stars:y=>({u_matrix:new f.a7(y),u_up:new f.ar(y),u_right:new f.ar(y),u_intensity_multiplier:new f.ab(y)}),occlusion:y=>({u_matrix:new f.a7(y),u_anchorPos:new f.ar(y),u_screenSizePx:new f.a9(y),u_occluderSizePx:new f.a9(y),u_color:new f.at(y)})};function sf(y,c,p){const v=c.createTileMatrix(y,y.worldSize,p.toUnwrapped());return f.ae.multiply(new Float32Array(16),y.projMatrix,v)}function wo(y,c,p){if(c.projection.name===p.projection.name)return y.projMatrix;const v=p.clone();return v.setProjection(c.projection),sf(v,c.getProjection(),y)}function Pm(y,c,p){return c.name===p.projection.name?y.projMatrix:sf(p,c,y)}let Rm;function kx(y,c,p,v,w,C,M){const I=y.context,F=I.gl,B=y.transform,j=y.getOrCreateProgram("collisionBox"),Z=[];let K=0,J=0;for(let ce=0;ce<v.length;ce++){const xe=v[ce],ve=c.getTile(xe),ye=ve.getBucket(p);if(!ye)continue;const Ce=wo(xe,ye,B);let Me=Ce;0===w[0]&&0===w[1]||(Me=y.translatePosMatrix(Ce,ve,w,C));const Le=M?ye.textCollisionBox:ye.iconCollisionBox,Se=ye.collisionCircleArray;if(Se.length>0){const we=f.ae.create(),Ue=Me;f.ae.mul(we,ye.placementInvProjMatrix,B.glCoordMatrix),f.ae.mul(we,we,ye.placementViewportMatrix),Z.push({circleArray:Se,circleOffset:J,transform:Ue,invTransform:we,projection:ye.getProjection()}),K+=Se.length/4,J=K}Le&&(y.terrain&&y.terrain.setupElevationDraw(ve,j),j.draw(y,F.LINES,f.af.disabled,f.ah.disabled,y.colorModeForRenderPass(),f.ag.disabled,Im(Me,B,ve,ye.getProjection()),p.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,B.zoom,null,[Le.collisionVertexBuffer,Le.collisionVertexBufferExt]))}if(!M||!Z.length)return;const ne=y.getOrCreateProgram("collisionCircle"),re=new f.bN;re.resize(4*K),re._trim();let ie=0;for(const ce of Z)for(let xe=0;xe<ce.circleArray.length/4;xe++){const ve=4*xe,ye=ce.circleArray[ve+0],Ce=ce.circleArray[ve+1],Me=ce.circleArray[ve+2],Le=ce.circleArray[ve+3];re.emplace(ie++,ye,Ce,Me,Le,0),re.emplace(ie++,ye,Ce,Me,Le,1),re.emplace(ie++,ye,Ce,Me,Le,2),re.emplace(ie++,ye,Ce,Me,Le,3)}(!Rm||Rm.length<2*K)&&(Rm=function(ce){const xe=2*ce,ve=new f.bw;ve.resize(xe),ve._trim();for(let ye=0;ye<xe;ye++){const Ce=6*ye;ve.uint16[Ce+0]=4*ye+0,ve.uint16[Ce+1]=4*ye+1,ve.uint16[Ce+2]=4*ye+2,ve.uint16[Ce+3]=4*ye+2,ve.uint16[Ce+4]=4*ye+3,ve.uint16[Ce+5]=4*ye+0}return ve}(K));const se=I.createIndexBuffer(Rm,!0),ge=I.createVertexBuffer(re,f.bO.members,!0);for(const ce of Z){const xe={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ae=B).getCameraToCenterDistance(ce.projection),u_viewport_size:[ae.width,ae.height]};ne.draw(y,F.TRIANGLES,f.af.disabled,f.ah.disabled,y.colorModeForRenderPass(),f.ag.disabled,xe,p.id,ge,se,f.b.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,B.zoom)}var ae;ge.destroy(),se.destroy()}const Fi=f.ae.create();function Pr(y){const c=y._camera.getWorldToCamera(y.worldSize,1),p=f.ae.multiply([],c,y.globeMatrix);f.ae.invert(p,p);const v=[0,0,0],w=[0,1,0,0];return f.aB.transformMat4(w,w,p),v[0]=w[0],v[1]=w[1],v[2]=w[2],f.$.normalize(v,v),v}function Nm({width:y,height:c,anchor:p,textOffset:v,textScale:w},C){const{horizontalAlign:M,verticalAlign:I}=f.bS(p),F=-(M-.5)*y,B=-(I-.5)*c,j=f.bR(p,v);return new f.P((F/w+j[0])*C,(B/w+j[1])*C)}function jl(y,c,p,v,w,C,M,I,F,B,j){const Z=y.text.placedSymbolArray,K=y.text.dynamicLayoutVertexArray,J=y.icon.dynamicLayoutVertexArray,ne={},re=y.getProjection(),ie=Pm(I,re,C),se=C.elevation,ge=re.upVectorScale(I.canonical,C.center.lat,C.worldSize).metersToTile;K.clear();for(let ae=0;ae<Z.length;ae++){const ce=Z.get(ae),{tileAnchorX:xe,tileAnchorY:ve,numGlyphs:ye}=ce,Ce=ce.hidden||!ce.crossTileID||y.allowVerticalPlacement&&!ce.placedOrientation?null:v[ce.crossTileID];if(Ce){let Me=0,Le=0,Se=0;if(se){const Pe=se?se.getAtTileOffset(I,xe,ve):0,[wt,Et,Qt]=re.upVector(I.canonical,xe,ve);Me=Pe*wt*ge,Le=Pe*Et*ge,Se=Pe*Qt*ge}let[we,Ue,et,Fe]=Pc(ce.projectedAnchorX+Me,ce.projectedAnchorY+Le,ce.projectedAnchorZ+Se,p?ie:M);const Mt=Dr(C.getCameraToCenterDistance(re),Fe);let pt=w.evaluateSizeForFeature(y.textSizeData,B,ce)*Mt/f.bP;p&&(pt*=y.tilePixelRatio/F);const qe=Nm(Ce,pt);p?(({x:we,y:Ue,z:et}=re.projectTilePoint(xe+qe.x,ve+qe.y,I.canonical)),[we,Ue,et]=Pc(we+Me,Ue+Le,et+Se,M)):(c&&qe._rotate(-C.angle),we+=qe.x,Ue+=qe.y,et=0);const at=y.allowVerticalPlacement&&ce.placedOrientation===f.aF.vertical?Math.PI/2:0;for(let Pe=0;Pe<ye;Pe++)f.aI(K,we,Ue,et,at);j&&ce.associatedIconIndex>=0&&(ne[ce.associatedIconIndex]={x:we,y:Ue,z:et,angle:at})}else np(ye,K)}if(j){J.clear();const ae=y.icon.placedSymbolArray;for(let ce=0;ce<ae.length;ce++){const xe=ae.get(ce),{numGlyphs:ve}=xe,ye=ne[ce];if(xe.hidden||!ye)np(ve,J);else{const{x:Ce,y:Me,z:Le,angle:Se}=ye;for(let we=0;we<ve;we++)f.aI(J,Ce,Me,Le,Se)}}y.icon.dynamicLayoutVertexBuffer.updateData(J)}y.text.dynamicLayoutVertexBuffer.updateData(K)}function f_(y,c,p,v,w,C,M={}){const I=p.paint.get("icon-translate"),F=p.paint.get("text-translate"),B=p.paint.get("icon-translate-anchor"),j=p.paint.get("text-translate-anchor"),Z=p.layout.get("icon-rotation-alignment"),K=p.layout.get("text-rotation-alignment"),J=p.layout.get("icon-pitch-alignment"),ne=p.layout.get("text-pitch-alignment"),re=p.layout.get("icon-keep-upright"),ie=p.layout.get("text-keep-upright"),se=p.paint.get("icon-color-saturation"),ge=p.paint.get("icon-color-contrast"),ae=p.paint.get("icon-color-brightness-min"),ce=p.paint.get("icon-color-brightness-max");p.paint.get("icon-occlusion-opacity").constantOr(0),p.paint.get("text-occlusion-opacity").constantOr(0);const xe=y.context,ve=xe.gl,ye=y.transform,Ce="map"===Z,Me="map"===K,Le="map"===J,Se="map"===ne,we=void 0!==p.layout.get("symbol-sort-key").constantOr(1);let Ue=!1;const et=y.depthModeForSublayer(0,f.af.ReadOnly),Fe=[f.ak(ye.center.lng),f.al(ye.center.lat)],Mt=p.layout.get("text-variable-anchor"),pt="globe"===ye.projection.name,qe=[],at=[0,-1,0];for(const Pe of v){const wt=c.getTile(Pe),Et=wt.getBucket(p);if(!Et||"mercator"===Et.projection.name&&pt||Et.fullyClipped)continue;const Qt="globe"===Et.projection.name,sn=Qt?f.a2(ye.zoom):0,fn=Pm(Pe,Et.getProjection(),ye),xt=ye.calculatePixelsToTileUnitsMatrix(wt),Bn=Mt&&Et.hasTextData(),tr=Et.hasIconTextFit()&&Bn&&Et.hasIconData(),Pn=Et.getProjection().createInversionMatrix(ye,Pe.canonical),fr=Sr=>{ye.depthOcclusionForSymbolsAndCircles&&(p.hasInitialOcclusionOpacityProperties||y.terrain)&&(Sr.push("DEPTH_D24"),Sr.push("DEPTH_OCCLUSION"))},Cr=()=>{const Sr=Ce&&"point"!==p.layout.get("symbol-placement"),Tr=[];fr(Tr);const Qn=Sr||tr,Ls=p.paint.get("icon-image-cross-fade").constantOr(0);y.terrainRenderModeElevated()&&Le&&Tr.push("PITCH_WITH_MAP_TERRAIN"),Qt&&(Tr.push("PROJECTION_GLOBE_VIEW"),Qn&&Tr.push("PROJECTED_POS_ON_VIEWPORT")),Ls>0&&Tr.push("ICON_TRANSITION"),Et.icon.zOffsetVertexBuffer&&Tr.push("Z_OFFSET"),0===se&&0===ge&&0===ae&&1===ce||Tr.push("COLOR_ADJUSTMENT");const Cs=Et.icon.programConfigurations.get(p.id),Wo=y.getOrCreateProgram(Et.sdfIcons?"symbolSDF":"symbolIcon",{config:Cs,defines:Tr});let fa;const Eo=wt.imageAtlasTexture?wt.imageAtlasTexture.size:[0,0],Ba=Et.iconSizeData,qo=f.aE(Ba,ye.zoom),pa=Le||0!==ye.pitch,Gt=ep(fn,wt.tileID.canonical,Le,Ce,ye,Et.getProjection(),xt),Tn=e_(fn,wt.tileID.canonical,Le,Ce,ye,Et.getProjection(),xt),il=y.translatePosMatrix(Tn,wt,I,B,!0),Vi=y.translatePosMatrix(fn,wt,I,B),nt=Qn?Fi:Gt,eh=Ce&&!Le&&!Sr;let du=at;!pt&&!ye.mercatorFromTransition||Ce||(du=Pr(ye));const th=Qt?du:at;if(Et.sdfIcons&&!Et.iconsInText)fa=ip(Ba.kind,qo,eh,Le,y,Vi,nt,il,!1,Eo,!0,Pe,sn,Fe,Pn,th,Et.getProjection());else{const vp=p.getColorAdjustmentMatrix(se,ge,ae,ce);fa=Nc(Ba.kind,qo,eh,Le,y,Vi,nt,il,!1,Eo,Pe,sn,Fe,Pn,th,Et.getProjection(),vp,Ls)}const nh=wt.imageAtlasTexture?wt.imageAtlasTexture:null,tg=1!==p.layout.get("icon-size").constantOr(0)||Et.iconsNeedLinear,ng=Et.sdfIcons||y.options.rotating||y.options.zooming||tg||pa?ve.LINEAR:ve.NEAREST,gf=Et.sdfIcons&&0!==p.paint.get("icon-halo-width").constantOr(1),qx=y.terrain&&Le&&Sr?f.ae.invert(f.ae.create(),Gt):Fi;if(Sr&&Et.icon){const vp=ye.elevation,Z1=vp?vp.getAtTileOffsetFunc(Pe,ye.center.lat,ye.worldSize,Et.getProjection()):null,xp=Tm(fn,wt.tileID.canonical,Le,Ce,ye,Et.getProjection(),xt);Qh(Et,fn,y,!1,xp,Tn,Le,re,Z1,Pe)}return{program:Wo,buffers:Et.icon,uniformValues:fa,atlasTexture:nh,atlasTextureIcon:null,atlasInterpolation:ng,atlasInterpolationIcon:null,isSDF:Et.sdfIcons,hasHalo:gf,tile:wt,labelPlaneMatrixInv:qx}},Ar=()=>{const Sr=Me&&"point"!==p.layout.get("symbol-placement"),Tr=[],Qn=Sr||Mt||tr;y.terrainRenderModeElevated()&&Se&&Tr.push("PITCH_WITH_MAP_TERRAIN"),Qt&&(Tr.push("PROJECTION_GLOBE_VIEW"),Qn&&Tr.push("PROJECTED_POS_ON_VIEWPORT")),Et.text.zOffsetVertexBuffer&&Tr.push("Z_OFFSET"),fr(Tr);const Ls=Et.text.programConfigurations.get(p.id),Cs=y.getOrCreateProgram(Et.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Ls,defines:Tr});let Wo,fa=[0,0],Eo=null;const Ba=Et.textSizeData;Et.iconsInText&&(fa=wt.imageAtlasTexture?wt.imageAtlasTexture.size:[0,0],Eo=wt.imageAtlasTexture?wt.imageAtlasTexture:null,Wo=Se||0!==ye.pitch||y.options.rotating||y.options.zooming||"composite"===Ba.kind||"camera"===Ba.kind?ve.LINEAR:ve.NEAREST);const qo=wt.glyphAtlasTexture?wt.glyphAtlasTexture.size:[0,0],pa=f.aE(Ba,ye.zoom),Gt=ep(fn,wt.tileID.canonical,Se,Me,ye,Et.getProjection(),xt),Tn=e_(fn,wt.tileID.canonical,Se,Me,ye,Et.getProjection(),xt),il=y.translatePosMatrix(Tn,wt,F,j,!0),Vi=y.translatePosMatrix(fn,wt,F,j),nt=Qn?Fi:Gt,eh=Me&&!Se&&!Sr;let du=at;!pt&&!ye.mercatorFromTransition||Me||(du=Pr(ye));const th=Qt?du:at;let nh;nh=Et.iconsInText?Om(Ba.kind,pa,eh,Se,y,Vi,nt,il,qo,fa,Pe,sn,Fe,Pn,th,Et.getProjection()):ip(Ba.kind,pa,eh,Se,y,Vi,nt,il,!0,qo,!0,Pe,sn,Fe,Pn,th,Et.getProjection());const tg=wt.glyphAtlasTexture?wt.glyphAtlasTexture:null,ng=ve.LINEAR,gf=0!==p.paint.get("text-halo-width").constantOr(1),qx=y.terrain&&Se&&Sr?f.ae.invert(f.ae.create(),Gt):Fi;if(Sr&&Et.text){const vp=ye.elevation,Z1=vp?vp.getAtTileOffsetFunc(Pe,ye.center.lat,ye.worldSize,Et.getProjection()):null,xp=Tm(fn,wt.tileID.canonical,Se,Me,ye,Et.getProjection(),xt);Qh(Et,fn,y,!0,xp,Tn,Se,ie,Z1,Pe)}return{program:Cs,buffers:Et.text,uniformValues:nh,atlasTexture:tg,atlasTextureIcon:Eo,atlasInterpolation:ng,atlasInterpolationIcon:Wo,isSDF:!0,hasHalo:gf,tile:wt,labelPlaneMatrixInv:qx}},ci=Et.icon.segments.get().length,nr=Et.text.segments.get().length,Mr=ci&&!M.onlyText?Cr():null,yr=nr&&!M.onlyIcons?Ar():null,mr=p.paint.get("icon-opacity").constantOr(1),sr=p.paint.get("text-opacity").constantOr(1);if(we&&Et.canOverlap){Ue=!0;const Sr=mr&&!M.onlyText?Et.icon.segments.get():[],Tr=sr&&!M.onlyIcons?Et.text.segments.get():[];for(const Qn of Sr)qe.push({segments:new f.b([Qn]),sortKey:Qn.sortKey,state:Mr});for(const Qn of Tr)qe.push({segments:new f.b([Qn]),sortKey:Qn.sortKey,state:yr})}else M.onlyText||qe.push({segments:mr?Et.icon.segments:new f.b([]),sortKey:0,state:Mr}),M.onlyIcons||qe.push({segments:sr?Et.text.segments:new f.b([]),sortKey:0,state:yr})}Ue&&qe.sort((Pe,wt)=>Pe.sortKey-wt.sortKey);for(const Pe of qe){const wt=Pe.state;if(wt)if(y.terrain?y.terrain.setupElevationDraw(wt.tile,wt.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:wt.labelPlaneMatrixInv}):y.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,wt.program),xe.activeTexture.set(ve.TEXTURE0),wt.atlasTexture&&wt.atlasTexture.bind(wt.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),wt.atlasTextureIcon&&(xe.activeTexture.set(ve.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),y.uploadCommonLightUniforms(y.context,wt.program),wt.hasHalo){const Et=wt.uniformValues;Et.u_is_halo=1,R1(wt.buffers,Pe.segments,p,y,wt.program,et,w,C,Et,2),Et.u_is_halo=0}else{if(wt.isSDF){const Et=wt.uniformValues;wt.hasHalo&&(Et.u_is_halo=1,R1(wt.buffers,Pe.segments,p,y,wt.program,et,w,C,Et,1)),Et.u_is_halo=0}R1(wt.buffers,Pe.segments,p,y,wt.program,et,w,C,wt.uniformValues,1)}}}function R1(y,c,p,v,w,C,M,I,F,B){const j=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.iconTransitioningVertexBuffer,y.globeExtVertexBuffer,y.zOffsetVertexBuffer];w.draw(v,v.context.gl.TRIANGLES,C,M,I,f.ag.disabled,F,p.id,y.layoutVertexBuffer,y.indexBuffer,c,p.paint,v.transform.zoom,y.programConfigurations.get(p.id),j,B)}function p_(y,c,p,v,w,C,M){const I=y.context.gl,F=p.paint.get("fill-pattern"),B=F&&F.constantOr(1);let j,Z,K,J,ne;M?(Z=B&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=I.LINES):(Z=B?"fillPattern":"fill",j=I.TRIANGLES);for(const re of v){const ie=c.getTile(re);if(B&&!ie.patternsLoaded())continue;const se=ie.getBucket(p);if(!se)continue;y.prepareDrawTile();const ge=se.programConfigurations.get(p.id),ae=y.isTileAffectedByFog(re),ce=y.getOrCreateProgram(Z,{config:ge,overrideFog:ae});B&&(y.context.activeTexture.set(I.TEXTURE0),ie.imageAtlasTexture&&ie.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ge.updatePaintBuffers());const xe=F.constantOr(null);if(xe&&ie.imageAtlas){const Ce=ie.imageAtlas.patternPositions[xe.toString()];Ce&&ge.setConstantPatternPositions(Ce)}const ve=y.translatePosMatrix(re.projMatrix,ie,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor")),ye=p.paint.get("fill-emissive-strength");if(M){J=se.indexBuffer2,ne=se.segments2;const Ce=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];K="fillOutlinePattern"===Z&&B?h_(ve,ye,y,ie,Ce):k1(ve,ye,Ce)}else J=se.indexBuffer,ne=se.segments,K=B?I1(ve,ye,y,ie):d_(ve,ye);y.uploadCommonUniforms(y.context,ce,re.toUnwrapped()),ce.draw(y,j,w,y.stencilModeForClipping(re),C,f.ag.disabled,K,p.id,se.layoutVertexBuffer,J,ne,p.paint,y.transform.zoom,ge,void 0)}}function hl(y,c,p,v,w,C,M,I){p.resetLayerRenderingStats(y);const F=y.context,B=F.gl,j=y.transform,Z=p.paint.get("fill-extrusion-pattern"),K=Z.constantOr(1),J=p.paint.get("fill-extrusion-opacity"),ne=y.style.enable3dLights(),re=p.paint.get(ne&&!K?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),re],se=p.layout.get("fill-extrusion-edge-radius"),ge=se>0&&!p.paint.get("fill-extrusion-rounded-roof"),ae=ge?0:se,ce="globe"===j.projection.name?f.b_():0,xe="globe"===j.projection.name,ve=xe?f.a2(j.zoom):0,ye=[f.ak(j.center.lng),f.al(j.center.lat)],Ce=p.paint.get("fill-extrusion-flood-light-color").toRenderColor(p.lut).toArray01().slice(0,3),Me=p.paint.get("fill-extrusion-flood-light-intensity"),Le=p.paint.get("fill-extrusion-vertical-scale"),Se=0!==p.paint.get("fill-extrusion-line-width").constantOr(1),we=la(y,p.paint.get("fill-extrusion-cutoff-fade-range")),Ue=p.paint.get("fill-extrusion-emissive-strength"),et=[];xe&&et.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&et.push("FAUX_AO"),ge&&et.push("ZERO_ROOF_RADIUS"),I&&et.push("HAS_CENTROID"),Me>0&&et.push("FLOOD_LIGHT"),we.shouldRenderCutoff&&et.push("RENDER_CUTOFF"),Se&&et.push("RENDER_WALL_MODE");const Fe=(()=>{const Qt=p.paint.get("fill-extrusion-line-alignment");switch(Qt){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return f.w(`Unsupported value for fill-extrusion-line-alignment: ${Qt}`),0}})();let Mt;const pt="shadow"===y.renderPass,qe=y.shadowRenderer,at=pt&&!!qe;y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!0);let Pe=[0,0,0];if(qe){const Qt=y.style.directionalLight,sn=y.style.ambientLight;Qt&&sn&&(Pe=r_(y.style,Qt,sn)),Mt=et.concat(["SHADOWS_SINGLE_CASCADE"])}const wt=at?"fillExtrusionDepth":K?"fillExtrusionPattern":"fillExtrusion",Et=p.getLayerRenderingStats();for(const Qt of v){const sn=c.getTile(Qt),fn=sn.getBucket(p);if(!fn||fn.projection.name!==j.projection.name)continue;let xt=!1;qe&&(xt=0===qe.getMaxCascadeForTile(Qt.toUnwrapped()));const Bn=y.isTileAffectedByFog(Qt),tr=fn.programConfigurations.get(p.id),Pn=y.getOrCreateProgram(wt,{config:tr,defines:xt?Mt:et,overrideFog:Bn});if(y.terrain&&y.terrain.setupElevationDraw(sn,Pn,{useMeterToDem:!0}),!fn.centroidVertexBuffer){const yr=Pn.attributes.a_centroid_pos;void 0!==yr&&B.vertexAttrib2f(yr,0,0)}!pt&&qe&&qe.setupShadows(sn.tileID.toUnwrapped(),Pn,"vector-tile",sn.tileID.overscaledZ),K&&(y.context.activeTexture.set(B.TEXTURE0),sn.imageAtlasTexture&&sn.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),tr.updatePaintBuffers());const fr=Z.constantOr(null);if(fr&&sn.imageAtlas){const yr=sn.imageAtlas.patternPositions[fr.toString()];yr&&tr.setConstantPatternPositions(yr)}const Cr=p.paint.get("fill-extrusion-vertical-gradient"),Ar=1/fn.tileToMeter;let ci;if(pt&&qe){if(Gu(sn.tileID,fn,y))continue;const yr=qe.calculateShadowPassMatrixFromTile(sn.tileID.toUnwrapped());ci=A1(yr,ae,Fe,Ar,Le)}else{const yr=y.translatePosMatrix(Qt.expandedProjMatrix,sn,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),mr=j.projection.createInversionMatrix(j,Qt.canonical);ci=K?oT(yr,y,Cr,J,ie,ae,Fe,Ar,Qt,sn,ce,ve,ye,mr,Ce,Le):Rc(yr,y,Cr,J,ie,ae,Fe,Ar,Qt,ce,ve,ye,mr,Ce,Le,Me,Pe,Ue)}y.uploadCommonUniforms(F,Pn,Qt.toUnwrapped(),null,we);let nr=fn.segments;if("mercator"===j.projection.name&&!pt&&(nr=fn.getVisibleSegments(sn.tileID,y.terrain,y.transform.getFrustum(0)),!nr.get().length))continue;if(Et)if(pt)for(const yr of nr.get())Et.numRenderedVerticesInShadowPass+=yr.primitiveLength;else for(const yr of nr.get())Et.numRenderedVerticesInTransparentPass+=yr.primitiveLength;const Mr=[];(y.terrain||I)&&Mr.push(fn.centroidVertexBuffer),xe&&Mr.push(fn.layoutVertexExtBuffer),Se&&Mr.push(fn.wallVertexBuffer),Pn.draw(y,F.gl.TRIANGLES,w,C,M,f.ag.backCCW,ci,p.id,fn.layoutVertexBuffer,fn.indexBuffer,nr,p.paint,y.transform.zoom,tr,Mr)}y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!1)}function Fm(y,c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie,se,ge){const ae=y.context,ce=ae.gl,xe=y.transform,ve=y.transform.zoom,ye=[],Ce=la(y,p.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===B?(ye.push("CLEAR_SUBPASS"),ge&&(ye.push("CLEAR_FROM_TEXTURE"),ae.activeTexture.set(ce.TEXTURE0),ge.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):"sdf"===B&&ye.push("SDF_SUBPASS"),ie&&ye.push("HAS_CENTROID"),Ce.shouldRenderCutoff&&ye.push("RENDER_CUTOFF");const Me=p.layout.get("fill-extrusion-edge-radius"),Le=(Se,we,Ue,et,Fe)=>{const Mt=we.programConfigurations.get(p.id),pt=y.isTileAffectedByFog(Se),qe=y.getOrCreateProgram("fillExtrusionGroundEffect",{config:Mt,defines:ye,overrideFog:pt}),at=((wt,Et,Qt,sn,fn,xt,Bn,tr,Pn,fr,Cr)=>({u_matrix:Et,u_opacity:Qt,u_ao_pass:sn?1:0,u_meter_to_tile:fn,u_ao:xt,u_flood_light_intensity:Bn,u_flood_light_color:tr,u_attenuation:Pn,u_edge_radius:fr,u_fb:0,u_fb_size:Cr}))(0,et,j,F,Fe,[Z,K*Fe],J,ne,re,ve>=17?0:Me*Fe,ge?ge.size[0]:0),Pe=[];ie&&Pe.push(we.hiddenByLandmarkVertexBuffer),y.uploadCommonUniforms(ae,qe,Se.toUnwrapped(),null,Ce),qe.draw(y,ae.gl.TRIANGLES,w,C,M,I,at,p.id,we.vertexBuffer,we.indexBuffer,Ue,p.paint,ve,Mt,Pe)};for(const Se of v){const we=c.getTile(Se),Ue=we.getBucket(p);if(!Ue||Ue.projection.name!==xe.projection.name||!Ue.groundEffect||Ue.groundEffect&&!Ue.groundEffect.hasData())continue;const et=Ue.groundEffect,Fe=1/Ue.tileToMeter;{const Mt=y.translatePosMatrix(Se.projMatrix,we,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),pt=et.getDefaultSegment();Le(Se,et,pt,Mt,Fe)}if(se)for(let Mt=0;Mt<4;Mt++){const pt=f.b$[Mt](Se),qe=c.getTile(pt);if(!qe)continue;const at=qe.getBucket(p);if(!at||at.projection.name!==xe.projection.name||!at.groundEffect||at.groundEffect&&!at.groundEffect.hasData())continue;const Pe=at.groundEffect;let wt,Et;0===Mt?(wt=[-f.a4,0,0],Et=1):1===Mt?(wt=[f.a4,0,0],Et=0):2===Mt?(wt=[0,-f.a4,0],Et=3):(wt=[0,f.a4,0],Et=2);const Qt=Pe.regionSegments[Et];if(!Qt)continue;const sn=new Float32Array(16);f.ae.translate(sn,Se.projMatrix,wt),Le(Se,Pe,Qt,y.translatePosMatrix(sn,we,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Fe)}}}function PD(y,c,p,v,w,C,M){0===v.centroidVertexArray.length&&v.createCentroidsBuffer();const I=C?C.findDEMTileFor(p):null;if(!(I&&I.dem||M))return;const F=se=>new f.P(Math.ceil((se+f.c2)*f.c3),0),B=se=>{const ge=c.getSource().minzoom,ae=xe=>{const ve=c.getTileByID(xe);if(ve&&ve.hasData())return ve.getBucket(w)},ce=[0,-1,1];for(const xe of ce){if(se.overscaledZ+xe<ge)continue;const ve=ae(se.calculateScaledKey(se.overscaledZ+xe));if(ve)return ve}},j=[0,0,0],Z=(se,ge)=>(j[0]=Math.min(se.min.y,ge.min.y),j[1]=Math.max(se.max.y,ge.max.y),j[2]=f.a4-ge.min.x>se.max.x?ge.min.x-f.a4:se.max.x,j),K=(se,ge)=>(j[0]=Math.min(se.min.x,ge.min.x),j[1]=Math.max(se.max.x,ge.max.x),j[2]=f.a4-ge.min.y>se.max.y?ge.min.y-f.a4:se.max.y,j),J=[(se,ge)=>Z(se,ge),(se,ge)=>Z(ge,se),(se,ge)=>K(se,ge),(se,ge)=>K(ge,se)],ne=(se,ge,ae,ce,xe,ve,ye)=>{if(!C)return 0;const Ce=[[ve?ae:se,ve?se:ae,0],[ve?ae:ge,ve?ge:ae,0]],Me=ye<0?f.a4+ye:ye,Le=[ve?Me:(se+ge)/2,ve?(se+ge)/2:Me,0];return 0===ae&&ye<0||0!==ae&&ye>0?C.getForTilePoints(xe,[Le],!0,ce):Ce.push(Le),C.getForTilePoints(p,Ce,!0,I),Math.max(Ce[0][2],Ce[1][2],Le[2])/C.exaggeration()};for(let se=0;se<4;se++){const ge=v.borderFeatureIndices[se];if(0===ge.length)continue;const ae=f.b$[se](p),ce=B(ae);if(!(ce&&ce instanceof f.c0)||v.borderDoneWithNeighborZ[se]===ce.canonical.z)continue;0===ce.centroidVertexArray.length&&ce.createCentroidsBuffer();const xe=C?C.findDEMTileFor(ae):null;if(!(xe&&xe.dem||M))continue;const ve=(se<2?1:5)-se,ye=ce.borderDoneWithNeighborZ[ve]!==v.canonical.z,Ce=ce.borderFeatureIndices[ve];let Me=0;if(v.canonical.z!==ce.canonical.z){for(const Le of ge)v.showCentroid(v.featuresOnBorder[Le]);if(ye)for(const Le of Ce)ce.showCentroid(ce.featuresOnBorder[Le]);v.borderDoneWithNeighborZ[se]=ce.canonical.z,ce.borderDoneWithNeighborZ[ve]=v.canonical.z}for(const Le of ge){const Se=v.featuresOnBorder[Le],we=v.centroidData[Se.centroidDataIndex],Ue=Se.borders[se];let et;for(;Me<Ce.length;){et=ce.featuresOnBorder[Ce[Me]];const Fe=et.borders[ve];if(Fe[1]>Ue[0]+3||Fe[0]>Ue[0]-3)break;ce.showCentroid(et),Me++}if(et&&Me<Ce.length){const Fe=Me;let Mt=0;for(;!(et.borders[ve][0]>Ue[1]-3)&&(Mt++,++Me!==Ce.length);)et=ce.featuresOnBorder[Ce[Me]];if(et=ce.featuresOnBorder[Ce[Fe]],Mt>1){const at=et.borders[ve];Math.abs(Ue[0]-at[0])<3&&Math.abs(Ue[1]-at[1])<3&&(Mt=1,Me=Fe+1)}else if(0===Mt){v.showCentroid(Se);continue}const pt=ce.centroidData[et.centroidDataIndex];M&&1===Mt&&(((re=we).flags|(ie=pt).flags)&f.c1?(re.flags|=f.c1,ie.flags|=f.c1):(re.flags&=~f.c1,ie.flags&=~f.c1));const qe=Se.intersectsCount()>1||et.intersectsCount()>1;if(Mt>1)Me=Fe,we.centroidXY=pt.centroidXY=new f.P(0,0);else if(xe&&xe.dem&&!qe){const at=J[se](we,pt),Pe=se%2?f.a4-1:0,wt=ne(at[0],Math.min(f.a4-1,at[1]),Pe,xe,ae,se<2,at[2]);we.centroidXY=pt.centroidXY=F(wt)}else qe?we.centroidXY=pt.centroidXY=new f.P(0,0):(we.centroidXY=v.encodeBorderCentroid(Se),pt.centroidXY=ce.encodeBorderCentroid(et));v.writeCentroidToBuffer(we),ce.writeCentroidToBuffer(pt)}else v.showCentroid(Se)}v.borderDoneWithNeighborZ[se]=ce.canonical.z,ce.borderDoneWithNeighborZ[ve]=v.canonical.z}var re,ie;(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(y)}const aT=[1,0,0],RD=[0,1,0],m_=[0,0,1];function Gu(y,c,p){const v=p.transform,w=p.shadowRenderer;if(!w)return!0;const C=y.toUnwrapped(),M=v.tileSize*w._cascades[p.currentShadowCascade].scale;let I=c.maxHeight;if(v.elevation){const re=v.elevation.getMinMaxForTile(y);re&&(I+=re.max)}const F=[...w.shadowDirection];F[2]=-F[2];const B=w.computeSimplifiedTileShadowVolume(C,I,M,F);if(!B)return!1;const j=[aT,RD,m_,F,[F[0],0,F[2]],[0,F[1],F[2]]],Z="globe"===v.projection.name,K=v.scaleZoom(M),J=f.aM.fromInvProjectionMatrix(v.invProjMatrix,v.worldSize,K,!Z),ne=w.getCurrentCascadeFrustum();return 0===J.intersectsPrecise(B.vertices,B.planes,j)||0===ne.intersectsPrecise(B.vertices,B.planes,j)}function Lm(y){return[y[0]*f.c4,y[1]*f.c4,y[2]*f.c4,0]}function N1(y,c,p,v,w,C,M,I,F){const B=v.getSource(),j=p.globeSharedBuffers;if(!j)return;let Z,K,J;if(c&&(Z=v.getTile(c)),B instanceof f.bo?(K=B.texture,J=f.bj(0,0,p.transform)):Z&&c&&(K=Z.texture,J=f.bj(c.canonical.z,c.canonical.x,p.transform)),!K||!J)return;y||(J=f.ae.scale(f.ae.create(),J,[1,-1,1]));const ne=p.context,re=ne.gl,ie="nearest"===w.paint.get("raster-resampling")?re.NEAREST:re.LINEAR,se=p.colorModeForDrapableLayerRenderPass(C),ge=M.defines;ge.push("GLOBE_POLES");const ae=new f.af(re.LEQUAL,f.af.ReadWrite,p.depthRangeFor3D),ce=Float32Array.from(p.transform.expandedFarZProjMatrix),xe=Float32Array.from(f.bh(f.bi(new f.aO(0,0,0))));p.terrain&&p.terrain.prepareDrawTile(),ne.activeTexture.set(re.TEXTURE0),K.bind(ie,re.CLAMP_TO_EDGE),ne.activeTexture.set(re.TEXTURE1),K.bind(ie,re.CLAMP_TO_EDGE),K.useMipmap&&ne.extTextureFilterAnisotropic&&p.transform.pitch>20&&re.texParameterf(re.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);const[ve,ye,Ce,Me]=c?j.getPoleBuffers(c.canonical.z,!1):j.getPoleBuffers(0,!0),Le=w.paint.get("raster-elevation");let Se;y?(Se=ve,p.renderDefaultNorthPole=0!==Le):(Se=ye,p.renderDefaultSouthPole=0!==Le);const we=Lm(M.mix),Ue=(Fe=ce,Mt=xe,pt=J,qe=f.a2(p.transform.zoom),Pe=w,Et=Le,sn=we,fn=M.offset,xt=M.range,Bn=C,km(Fe,Mt,pt,new Float32Array(16),new Float32Array(9),[0,0],qe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Pe,[0,0],Et,2,sn,fn,xt,1,0,Bn)),et=p.getOrCreateProgram("raster",{defines:ge});var Fe,Mt,pt,qe,Pe,Et,sn,fn,xt,Bn;p.uploadCommonUniforms(ne,et,null),et.draw(p,re.TRIANGLES,ae,F,se,I,Ue,w.id,Se,Ce,Me)}function el(y){const c=y._nearZ,p=y.projection.farthestPixelDistance(y),v=p-c,w=.2*y.height,C=c+w;return[c,p,(C-w-c)/v,(C-c)/v]}function br(y,c,p,v){if(y)return c instanceof nf&&y instanceof f.c5?c.getTextureDescriptor(y,p,!0):{texture:y.texture,mix:Lm(v.mix),offset:v.offset,buffer:0,tileSize:1}}function lT(y,c,p){if(!y)return null;const v=c.getTextureDescriptor(y,p,!0);if(!v)return null;let{texture:w,mix:C,offset:M,tileSize:I,buffer:F,format:B}=v;if(!w||!B)return null;let j=!1;return"uint32"===B&&(j=!0,C[3]=0,C=Fd(f.c6,C,[0,p.paint.get("raster-particle-max-speed")]),M=Ld(f.c6,M,[0,p.paint.get("raster-particle-max-speed")])),{texture:w,textureOffset:[F/(I+2*F),I/(I+2*F)],tileSize:I,scalarData:j,scale:C,offset:M,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[B]]}}function F1(y){const c=y._nearZ,p=y.projection.farthestPixelDistance(y),v=p-c,w=.2*y.height,C=c+w;return[c,p,(C-w-c)/v,(C-c)/v]}const Ox=new f.C(1,0,0,1),L1=new f.C(0,1,0,1),Px=new f.C(0,0,1,1),It=new f.C(1,0,1,1),ND=new f.C(0,1,1,1);function dn(y,c,p,v,w,C,M){const I=y.context,F=y.transform,B=I.gl,j="globe"===F.projection.name,Z=j?["PROJECTION_GLOBE_VIEW"]:[];let K=f.ae.clone(p.projMatrix);if(j&&f.a2(F.zoom)>0){const we=f.c7(p.canonical,F),Ue=f.c8(we);K=f.ae.multiply(new Float32Array(16),F.globeMatrix,Ue),f.ae.multiply(K,F.projMatrix,K)}const J=f.ae.create();J[12]+=2*w/(f.e.devicePixelRatio*F.width),J[13]+=2*C/(f.e.devicePixelRatio*F.height),f.ae.multiply(K,J,K);const ne=y.getOrCreateProgram("debug",{defines:Z}),re=c.getTileByID(p.key);y.terrain&&y.terrain.setupElevationDraw(re,ne);const ie=f.af.disabled,se=f.ah.disabled,ge=y.colorModeForRenderPass();I.activeTexture.set(B.TEXTURE0),y.emptyTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),j?re._makeGlobeTileDebugBuffers(y.context,F):re._makeDebugTileBoundsBuffers(y.context,F.projection);const ce=re._tileDebugBuffer||y.debugBuffer,xe=re._tileDebugIndexBuffer||y.debugIndexBuffer,ve=re._tileDebugSegments||y.debugSegments;if(ne.draw(y,B.LINE_STRIP,ie,se,ge,f.ag.disabled,O1(K,v),"$debug",ce,xe,ve,null,null,null,[re._globeTileDebugBorderBuffer]),M){const we=re.latestRawTileData,Ue=Math.floor((we&&we.byteLength||0)/1024);let et=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(et+=` => ${p.overscaledZ}`),et+=` ${re.state}`,et+=` ${Ue}kb`,function(Fe,Mt){Fe.initDebugOverlayCanvas();const pt=Fe.debugOverlayCanvas,qe=Fe.context.gl,at=Fe.debugOverlayCanvas.getContext("2d");at.clearRect(0,0,pt.width,pt.height),at.shadowColor="white",at.shadowBlur=2,at.lineWidth=1.5,at.strokeStyle="white",at.textBaseline="top",at.font="bold 36px Open Sans, sans-serif",at.fillText(Mt,5,5),at.strokeText(Mt,5,5),Fe.debugOverlayTexture.update(pt),Fe.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}(y,et)}const ye=c.getTile(p).tileSize,Ce=512/Math.min(ye,512)*(p.overscaledZ/F.zoom)*.5,Me=re._tileDebugTextBuffer||y.debugBuffer,Le=re._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,Se=re._tileDebugTextSegments||y.debugSegments;ne.draw(y,B.TRIANGLES,ie,se,f.a.alphaBlended,f.ag.disabled,O1(K,f.C.transparent,Ce),"$debug",Me,Le,Se,null,null,null,[re._globeTileDebugTextBuffer])}function op(y,c,p,v){af(y,0,c+p/2,y.transform.width,p,v)}function Bm(y,c,p,v){af(y,c-p/2,0,p,y.transform.height,v)}function af(y,c,p,v,w,C){const M=y.context,I=M.gl;I.enable(I.SCISSOR_TEST),I.scissor(c*f.e.devicePixelRatio,p*f.e.devicePixelRatio,v*f.e.devicePixelRatio,w*f.e.devicePixelRatio),M.clear({color:C}),I.disable(I.SCISSOR_TEST)}const ou=f.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ap}=ou;function Pa(y,c,p,v){y.emplaceBack(c,p,v)}class _n{constructor(c){this.vertexArray=new f.ca,this.indices=new f.bw,Pa(this.vertexArray,-1,-1,1),Pa(this.vertexArray,1,-1,1),Pa(this.vertexArray,-1,1,1),Pa(this.vertexArray,1,1,1),Pa(this.vertexArray,-1,-1,-1),Pa(this.vertexArray,1,-1,-1),Pa(this.vertexArray,-1,1,-1),Pa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,ap),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=f.b.simpleSegment(0,0,36,12)}}function Fr(y,c,p,v,w,C){const M=y.context.gl,I=c.paint.get("sky-atmosphere-color"),F=c.paint.get("sky-atmosphere-halo-color"),B=c.paint.get("sky-atmosphere-sun-intensity"),j={u_matrix_3f:f.bE.fromMat4(f.bE.create(),v),u_sun_direction:w,u_sun_intensity:B,u_color_tint_r:[(ne=I).r,ne.g,ne.b,ne.a],u_color_tint_m:[(re=F).r,re.g,re.b,re.a],u_luminance:5e-5};var ne,re;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+C,c.skyboxTexture,0),p.draw(y,M.TRIANGLES,f.af.disabled,f.ah.disabled,f.a.unblended,f.ag.frontCW,j,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const si=f.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class vn{constructor(c){const p=new f.cb;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const v=new f.bw;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(p,si.members),this.indexBuffer=c.createIndexBuffer(v),this.segments=f.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ud=f.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class qr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class zm{constructor(c){this.colorModeAlphaBlendedWriteRGB=new f.a([f.cc,f.cd,f.cc,f.cd],f.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new f.a([f.cc,f.ce,f.cc,f.ce],f.C.transparent,[!1,!1,!1,!0]),this.params=new qr,this.updateNeeded=!0,c.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),c.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),c.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),c.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(c){const p=c.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new vn(p);const v=this.params.sizeRange,w=this.params.intensityRange,C=function(j){const Z=f.ch(30),K=[];for(let J=0;J<j;++J){const ne=2*Math.PI*Z(),re=Math.acos(1-2*Z())-.5*Math.PI;K.push(f.$.fromValues(Math.cos(re)*Math.cos(ne),Math.cos(re)*Math.sin(ne),Math.sin(re)))}return K}(this.params.starsCount),M=f.ch(300),I=new f.cf,F=new f.bw;let B=0;for(let j=0;j<C.length;++j){const Z=f.$.scale([],C[j],200),K=Math.max(0,1+.01*v*(1*M()-.5)),J=Math.max(0,1+.01*w*(1*M()-.5));I.emplaceBack(Z[0],Z[1],Z[2],-1,-1,K,J),I.emplaceBack(Z[0],Z[1],Z[2],1,-1,K,J),I.emplaceBack(Z[0],Z[1],Z[2],1,1,K,J),I.emplaceBack(Z[0],Z[1],Z[2],-1,1,K,J),F.emplaceBack(B+0,B+1,B+2),F.emplaceBack(B+0,B+2,B+3),B+=4}this.starsVx=p.createVertexBuffer(I,Ud.members),this.starsIdx=p.createIndexBuffer(F),this.starsSegments=f.b.simpleSegment(0,0,I.length,F.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(c,p){const v=c.context,w=v.gl,C=c.transform,M=new f.af(w.LEQUAL,f.af.ReadOnly,[0,1]),I=f.a2(C.zoom),F=c.style.getLut(p.scope),B=p.properties.get("color").toRenderColor(F).toArray01(),j=p.properties.get("high-color").toRenderColor(F).toArray01(),Z=p.properties.get("space-color").toRenderColor(F).toArray01PremultipliedAlpha(),K=5e-4,J=f.cg(p.properties.get("horizon-blend"),0,1,K,.25),ne=f.bc(c,v,C)&&J===K?C.worldSize/(2*Math.PI*1.025)-1:C.globeRadius,re=c.frameCounter/1e3%1,ie=f.$.length(C.globeCenterInViewSpace),se=Math.sqrt(Math.pow(ie,2)-Math.pow(ne,2)),ge=Math.acos(se/ie),ae=ce=>{const xe="globe"===C.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ce&&xe.push("ALPHA_PASS");const ve=c.getOrCreateProgram("globeAtmosphere",{defines:xe}),ye=((Me,Le,Se,we,Ue,et,Fe,Mt,pt,qe,at,Pe)=>({u_frustum_tl:Me,u_frustum_tr:Le,u_frustum_br:Se,u_frustum_bl:we,u_horizon:Ue,u_transition:et,u_fadeout_range:Fe,u_color:Mt,u_high_color:pt,u_space_color:qe,u_temporal_offset:at,u_horizon_angle:Pe}))(C.frustumCorners.TL,C.frustumCorners.TR,C.frustumCorners.BR,C.frustumCorners.BL,C.frustumCorners.horizon,I,J,B,j,Z,re,ge);c.uploadCommonUniforms(v,ve);const Ce=this.atmosphereBuffer;Ce&&ve.draw(c,w.TRIANGLES,M,f.ah.disabled,ce?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,f.ag.backCW,ye,ce?"atmosphere_glow_alpha":"atmosphere_glow",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)};ae(!1),ae(!0)}drawStars(c,p){const v=f.au(p.properties.get("star-intensity"),0,1);if(0===v)return;const w=c.context,C=w.gl,M=c.transform,I=c.getOrCreateProgram("stars"),F=f.aw.identity([]);f.aw.rotateX(F,F,-M._pitch),f.aw.rotateZ(F,F,-M.angle),f.aw.rotateX(F,F,f.ac(M._center.lat)),f.aw.rotateY(F,F,-f.ac(M._center.lng));const B=f.ae.fromQuat(new Float32Array(16),F),j=f.ae.multiply([],M.starsProjMatrix,B),Z=f.bE.fromMat4([],B),K=f.bE.invert([],Z),J=[0,1,0];f.$.transformMat3(J,J,K),f.$.scale(J,J,this.params.sizeMultiplier);const ne=[1,0,0];f.$.transformMat3(ne,ne,K),f.$.scale(ne,ne,this.params.sizeMultiplier);const re=(ie=J,se=ne,ge=v,{u_matrix:Float32Array.from(j),u_up:ie,u_right:se,u_intensity_multiplier:ge});var ie,se,ge;c.uploadCommonUniforms(w,I),this.starsVx&&this.starsIdx&&I.draw(c,C.TRIANGLES,f.af.disabled,f.ah.disabled,this.colorModeAlphaBlendedWriteRGB,f.ag.disabled,re,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Vd(y,c){const p=[...y],v=c.cameraWorldSizeForFog/c.worldSize,w=f.ae.identity([]);return f.ae.scale(w,w,[v,v,1]),f.ae.multiply(p,w,p),f.ae.multiply(p,c.worldToFogMatrix,p),p}function lf(y,c,p,v,w){const C=p.material,M=v.context,{baseColorTexture:I,metallicRoughnessTexture:F}=C.pbrMetallicRoughness,{normalTexture:B,occlusionTexture:j,emissionTexture:Z}=C;function K(J,ne,re){if(J&&(y.push(ne),M.activeTexture.set(M.gl.TEXTURE0+re),J.gfxTexture)){const{minFilter:ie,magFilter:se,wrapS:ge,wrapT:ae}=J.sampler;J.gfxTexture.bindExtraParam(ie,se,ge,ae)}}K(I,"HAS_TEXTURE_u_baseColorTexture",ka.BaseColor),K(F,"HAS_TEXTURE_u_metallicRoughnessTexture",ka.MetallicRoughness),K(B,"HAS_TEXTURE_u_normalTexture",ka.Normal),K(j,"HAS_TEXTURE_u_occlusionTexture",ka.Occlusion),K(Z,"HAS_TEXTURE_u_emissionTexture",ka.Emission),w&&(w.texture||(w.texture=new f.cj(v.context,w.image,[w.image.height,w.image.height,w.image.height],M.gl.RGBA)),M.activeTexture.set(M.gl.TEXTURE0+ka.LUT),w.texture&&w.texture.bind(M.gl.LINEAR,M.gl.CLAMP_TO_EDGE),y.push("APPLY_LUT_ON_GPU")),p.texcoordBuffer&&(y.push("HAS_ATTRIBUTE_a_uv_2f"),c.push(p.texcoordBuffer)),p.colorBuffer&&(y.push(12===p.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),c.push(p.colorBuffer)),p.normalBuffer&&(y.push("HAS_ATTRIBUTE_a_normal_3f"),c.push(p.normalBuffer)),p.pbrBuffer&&(y.push("HAS_ATTRIBUTE_a_pbr"),y.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),c.push(p.pbrBuffer)),"OPAQUE"!==C.alphaMode&&"MASK"!==C.alphaMode||y.push("UNPREMULT_TEXTURE_IN_SHADER"),C.defined||y.push("DIFFUSE_SHADED"),y.push("USE_STANDARD_DERIVATIVES")}function Io(y,c,p,v,w,C){const M=p.paint.get("model-opacity"),I=c.context,F=new f.af(c.context.gl.LEQUAL,f.af.ReadWrite,c.depthRangeFor3D),B=c.transform,j=y.mesh,Z=j.material,K=Z.pbrMetallicRoughness,J=c.style.fog;let ne;ne="pixels"===c.transform.projection.zAxisUnit?[...y.nodeModelMatrix]:f.ae.multiply([],v.zScaleMatrix,y.nodeModelMatrix),f.ae.multiply(ne,v.negCameraPosMatrix,ne);const re=f.ae.invert([],ne);f.ae.transpose(re,re);const ie=p.paint.get("model-emissive-strength").constantOr(0),se=sp(new Float32Array(y.worldViewProjection),new Float32Array(ne),new Float32Array(re),null,c,M,K.baseColorFactor.toRenderColor(null),Z.emissiveFactor,K.metallicFactor,K.roughnessFactor,Z,ie,p),ge={defines:[]},ae=[];lf(ge.defines,ae,j,c,p.lut);const ce=c.shadowRenderer;ce&&(ce.useNormalOffset=!1);let xe=null;if(J){const Ce=Vd(y.nodeModelMatrix,c.transform);if(xe=new Float32Array(Ce),"globe"!==B.projection.name){const Me=j.aabb.min,Le=j.aabb.max,[Se,we]=J.getOpacityForBounds(Ce,Me[0],Me[1],Le[0],Le[1]);ge.overrideFog=Se>=Qr||we>=Qr}}const ve=la(c,p.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&ge.defines.push("RENDER_CUTOFF");const ye=c.getOrCreateProgram("model",ge);c.uploadCommonUniforms(I,ye,null,xe,ve),"shadow"!==c.renderPass&&ce&&ce.setupShadowsFromMatrix(y.nodeModelMatrix,ye),ye.draw(c,I.gl.TRIANGLES,F,w,C,j.material.doubleSided?f.ag.disabled:f.ag.backCCW,se,p.id,j.vertexBuffer,j.indexBuffer,j.segments,p.paint,c.transform.zoom,void 0,ae)}function Fs(y,c,p,v,w,C,M){let I;I="globe"===y.projection.name?f.ck(p,y):[...p],f.ae.multiply(I,I,c.matrix);const F=f.ae.multiply([],v,I);if(c.meshes)for(const B of c.meshes){if("BLEND"!==B.material.alphaMode){M.push({mesh:B,depth:0,modelIndex:w,worldViewProjection:F,nodeModelMatrix:I});continue}const j=f.$.transformMat4([],B.centroid,F);j[2]>0&&C.push({mesh:B,depth:j[2],modelIndex:w,worldViewProjection:F,nodeModelMatrix:I})}if(c.children)for(const B of c.children)Fs(y,B,p,v,w,C,M)}function Rx(y,c,p,v){const w=p.shadowRenderer;if(!w)return;const C=w.getShadowPassDepthMode(),M=w.getShadowPassColorMode(),I=w.calculateShadowPassMatrixFromMatrix(c),F=Ix(I);p.getOrCreateProgram("modelDepth",{defines:p._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(p,p.context.gl.TRIANGLES,C,f.ah.disabled,M,f.ag.backCCW,F,v.id,y.vertexBuffer,y.indexBuffer,y.segments,v.paint,p.transform.zoom,void 0,void 0)}function g_(y,c,p){const v=c.updateZoomBasedPaintProperties(),w=function(C,M,I){let F,B,j,Z=C.terrain?C.terrain.exaggeration():0;if(C.terrain&&Z>0){const K=C.terrain,J=K.findDEMTileFor(I);J&&J.dem?F=f.cm.create(K,I,J):Z=0}if(0===Z&&(M.terrainElevationMin=0,M.terrainElevationMax=0),Z===M.validForExaggeration&&(0===Z||F&&F._demTile&&F._demTile.tileID===M.validForDEMTile.id&&F._dem._timestamp===M.validForDEMTile.timestamp))return!1;for(const K in M.instancesPerModel){const J=M.instancesPerModel[K];for(let ne=0;ne<J.instancedDataArray.length;++ne){const re=(F?Z*F.getElevationAt(0|J.instancedDataArray.float32[16*ne],0|J.instancedDataArray.float32[16*ne+1],!0,!0):0)+J.instancesEvaluatedElevation[ne];J.instancedDataArray.float32[16*ne+6]=re,B=B?Math.min(M.terrainElevationMin,re):re,j=j?Math.max(M.terrainElevationMax,re):re}}return M.terrainElevationMin=B||0,M.terrainElevationMax=j||0,M.validForExaggeration=Z,M.validForDEMTile=F&&F._demTile?{id:F._demTile.tileID,timestamp:F._dem._timestamp}:{id:void 0,timestamp:0},!0}(y,c,p);(v||w)&&(c.uploaded=!1,c.upload(y.context))}const Fc={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new f.b8([0,0,0],[f.a4,f.a4,0])};function cf(y,c){const p=1<<y.canonical.z,v=c.getFreeCameraOptions().position,w=c.elevation,C=y.canonical.x/p,M=(y.canonical.x+1)/p,I=y.canonical.y/p,F=(y.canonical.y+1)/p;let B=c._centerAltitude;if(w){const J=w.getMinMaxForTile(y);J&&J.max>B&&(B=J.max)}const j=f.au(v.x,C,M)-v.x,Z=f.au(v.y,I,F)-v.y,K=f.ay(B,c.center.lat)-v.z;return c._zoomFromMercatorZ(Math.sqrt(j*j+Z*Z+K*K))}function jd(y,c,p,v,w,C,M){const I=y.context,F="shadow"===y.renderPass,B=y.shadowRenderer,j=F&&B?B.getShadowPassDepthMode():new f.af(I.gl.LEQUAL,f.af.ReadWrite,y.depthRangeFor3D),Z=y.isTileAffectedByFog(C);if(p.meshes)for(const K of p.meshes){const J=["MODEL_POSITION_ON_GPU"],ne=[];let re,ie,se;v.instancedDataArray.length>20&&J.push("INSTANCED_ARRAYS");const ge=la(y,c.paint.get("model-cutoff-fade-range"));if(ge.shouldRenderCutoff&&J.push("RENDER_CUTOFF"),F&&B)re=y.getOrCreateProgram("modelDepth",{defines:J}),ie=Ix(M.shadowTileMatrix,M.shadowTileMatrix,Float32Array.from(p.matrix)),se=B.getShadowPassColorMode();else{lf(J,ne,K,y,c.lut),re=y.getOrCreateProgram("model",{defines:J,overrideFog:Z});const ce=K.material,xe=ce.pbrMetallicRoughness,ve=c.paint.get("model-opacity"),ye=c.paint.get("model-emissive-strength").constantOr(0);ie=sp(C.expandedProjMatrix,Float32Array.from(p.matrix),new Float32Array(16),null,y,ve,xe.baseColorFactor.toRenderColor(null),ce.emissiveFactor,xe.metallicFactor,xe.roughnessFactor,ce,ye,c,w),B&&(M.shadowUniformsInitialized?re.setShadowUniformValues(I,B.getShadowUniformValues()):(B.setupShadows(C.toUnwrapped(),re,"model-tile",C.overscaledZ),M.shadowUniformsInitialized=!0)),se=ge.shouldRenderCutoff||ve<1||"OPAQUE"!==ce.alphaMode?f.a.alphaBlended:f.a.unblended}y.uploadCommonUniforms(I,re,C.toUnwrapped(),null,ge);const ae=K.material.doubleSided?f.ag.disabled:f.ag.backCCW;if(v.instancedDataArray.length>20)ne.push(v.instancedDataBuffer),re.draw(y,I.gl.TRIANGLES,j,f.ah.disabled,se,ae,ie,c.id,K.vertexBuffer,K.indexBuffer,K.segments,c.paint,y.transform.zoom,void 0,ne,v.instancedDataArray.length);else{const ce=F?"u_instance":"u_normal_matrix";for(let xe=0;xe<v.instancedDataArray.length;++xe)ie[ce]=new Float32Array(v.instancedDataArray.arrayBuffer,64*xe,16),re.draw(y,I.gl.TRIANGLES,j,f.ah.disabled,se,ae,ie,c.id,K.vertexBuffer,K.indexBuffer,K.segments,c.paint,y.transform.zoom,void 0,ne)}}if(p.children)for(const K of p.children)jd(y,c,K,v,w,C,M)}const lp=[1,-1,1];function Ho(y,c,p,v){if(!p.modelManager)return!0;const w=p.modelManager;if(!p.shadowRenderer)return!0;const C=p.shadowRenderer,M=c.aabb;let I=!0,F=y.maxHeight;if(0===F){let j=0;for(const Z in y.instancesPerModel){const K=w.getModel(Z,v);K?j=Math.max(j,Math.max(Math.max(K.aabb.max[0],K.aabb.max[1]),K.aabb.max[2])):I=!1}F=y.maxScale*j*1.41+y.maxVerticalOffset,I&&(y.maxHeight=F)}M.max[2]=F,M.min[2]+=y.terrainElevationMin,M.max[2]+=y.terrainElevationMax,f.$.transformMat4(M.min,M.min,c.tileMatrix),f.$.transformMat4(M.max,M.max,c.tileMatrix);const B=M.intersects(C.getCurrentCascadeFrustum());return 0===p.currentShadowCascade&&(y.isInsideFirstShadowMapFrustum=2===B),0===B}function fl(y,c){const p=y.uniformValues.u_cutoff_params[0],v=y.uniformValues.u_cutoff_params[1],w=y.uniformValues.u_cutoff_params[2],C=y.uniformValues.u_cutoff_params[3];return v===p||C===w?1:f.au(((c-p)/(v-p)-w)/(C-w),0,1)}function au(y,c,p,v){if(c.pitch<20)return 1;const w=c.getWorldToCameraMatrix(),C=f.ae.multiply([],w,y),M=[...p.min,1];let I=f.aB.transformMat4([],M,C),F=I,B=I;M[1]=p.max[1],I=f.aB.transformMat4([],M,C),F=I[1]<F[1]?I:F,B=I[1]>B[1]?I:B,M[0]=p.max[0],I=f.aB.transformMat4([],M,C),F=I[1]<F[1]?I:F,B=I[1]>B[1]?I:B,M[1]=p.min[1],I=f.aB.transformMat4([],M,C),F=I[1]<F[1]?I:F,B=I[1]>B[1]?I:B;const j=f.au(v[0],0,1),Z=100*c.pixelsPerMeter*f.au(v[1],0,1),K=f.au(v[2],0,1),J=f.$.lerp([],F,B,j),ne=Math.tan(.5*c.fovX),re=-J[2]*ne;if(0===Z)return J[1]<-Math.abs(re)?K:1;const ie=(-Math.abs(re)-J[1])/Z,se=(ae,ce,xe)=>(1-xe)*ae+xe*ce,ge=f.au(se(1,K,ie),K,1);return se(1,ge,f.au((c.pitch-20)/20,0,1))}class lu{}class qs{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(c,p,v){{const Z=this._storage.get(p.id);if(Z)return Z.lastUsedFrameIdx=c,Z.buf}const w=v.gl,C=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),M=new ArrayBuffer(C),I=new Int16Array(M);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(M));const F=new f.co;for(let Z=0;Z<C/2;Z+=3){const K=I[Z],J=I[Z+1],ne=I[Z+2];F.emplaceBack(K,J),F.emplaceBack(J,ne),F.emplaceBack(ne,K)}const B=v.bindVertexArrayOES.current,j=new lu;return j.buf=new f.I(v,F),j.lastUsedFrameIdx=c,this._storage.set(p.id,j),v.bindVertexArrayOES.set(B),j.buf}update(c){for(const[p,v]of this._storage)c-v.lastUsedFrameIdx>30&&(v.buf.destroy(),this._storage.delete(p))}destroy(){for(const[c,p]of this._storage)p.buf.destroy(),this._storage.delete(c)}}class Er{constructor(c){this.occluderSize=30,this.depthOffset=-1e-4,c.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),c.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const li={symbol:function(y,c,p,v,w){if("translucent"!==y.renderPass)return;const C=f.ah.disabled,M=y.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(B,j,Z,K,J,ne,re){const ie=j.transform,se="map"===J,ge="map"===ne;for(const ae of B){const ce=K.getTile(ae),xe=ce.getBucket(Z);if(!xe||!xe.text||!xe.text.segments.get().length)continue;const ve=f.aE(xe.textSizeData,ie.zoom),ye=Pm(ae,xe.getProjection(),ie),Ce=ie.calculatePixelsToTileUnitsMatrix(ce),Me=ep(ye,ce.tileID.canonical,ge,se,ie,xe.getProjection(),Ce),Le=xe.hasIconTextFit()&&xe.hasIconData();if(ve){const Se=Math.pow(2,ie.zoom-ce.tileID.overscaledZ);jl(xe,se,ge,re,f.bQ,ie,Me,ae,Se,ve,Le)}}}(v,y,p,c,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),w);const I=0!==p.paint.get("icon-opacity").constantOr(1),F=0!==p.paint.get("text-opacity").constantOr(1);void 0!==p.layout.get("symbol-sort-key").constantOr(1)&&(I||F)?f_(y,c,p,v,C,M):(I&&f_(y,c,p,v,C,M,{onlyIcons:!0}),F&&f_(y,c,p,v,C,M,{onlyText:!0})),c.map.showCollisionBoxes&&(kx(y,c,p,v,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),kx(y,c,p,v,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(y,c,p,v){if("translucent"!==y.renderPass)return;const w=p.paint.get("circle-opacity"),C=p.paint.get("circle-stroke-width"),M=p.paint.get("circle-stroke-opacity"),I=void 0!==p.layout.get("circle-sort-key").constantOr(1),F=p.paint.get("circle-emissive-strength");if(0===w.constantOr(1)&&(0===C.constantOr(1)||0===M.constantOr(1)))return;const B=y.context,j=B.gl,Z=y.transform,K=y.depthModeForSublayer(0,f.af.ReadOnly),J=f.ah.disabled,ne=y.colorModeForDrapableLayerRenderPass(F),re="globe"===Z.projection.name,ie=[f.ak(Z.center.lng),f.al(Z.center.lat)],se=[];for(let ae=0;ae<v.length;ae++){const ce=v[ae],xe=c.getTile(ce),ve=xe.getBucket(p);if(!ve||ve.projection.name!==Z.projection.name)continue;const ye=ve.programConfigurations.get(p.id),Ce=f.bT(p),Me=y.isTileAffectedByFog(ce);re&&Ce.push("PROJECTION_GLOBE_VIEW"),Ce.push("DEPTH_D24"),y.terrain&&Z.depthOcclusionForSymbolsAndCircles&&Ce.push("DEPTH_OCCLUSION");const Le=y.getOrCreateProgram("circle",{config:ye,defines:Ce,overrideFog:Me}),Se=ve.layoutVertexBuffer,we=ve.globeExtVertexBuffer,Ue=ve.indexBuffer,et=Z.projection.createInversionMatrix(Z,ce.canonical),Fe={programConfiguration:ye,program:Le,layoutVertexBuffer:Se,globeExtVertexBuffer:we,indexBuffer:Ue,uniformValues:f.bU(y,ce,xe,et,ie,p),tile:xe};if(I){const Mt=ve.segments.get();for(const pt of Mt)se.push({segments:new f.b([pt]),sortKey:pt.sortKey,state:Fe})}else se.push({segments:ve.segments,sortKey:0,state:Fe})}I&&se.sort((ae,ce)=>ae.sortKey-ce.sortKey);const ge={useDepthForOcclusion:Z.depthOcclusionForSymbolsAndCircles};for(const ae of se){const{programConfiguration:ce,program:xe,layoutVertexBuffer:ve,globeExtVertexBuffer:ye,indexBuffer:Ce,uniformValues:Me,tile:Le}=ae.state,Se=ae.segments;y.terrain&&y.terrain.setupElevationDraw(Le,xe,ge),y.uploadCommonUniforms(B,xe,Le.tileID.toUnwrapped()),xe.draw(y,j.TRIANGLES,K,J,ne,f.ag.disabled,Me,p.id,ve,Ce,Se,p.paint,Z.zoom,ce,[ye])}},heatmap:function(y,c,p,v){if(0!==p.paint.get("heatmap-opacity"))if("offscreen"===y.renderPass){const w=y.context,C=w.gl,M=f.ah.disabled,I=new f.a([C.ONE,C.ONE,C.ONE,C.ONE],f.C.transparent,[!0,!0,!0,!0]);(function(J,ne,re,ie){const se=J.gl,ge=ne.width*ie,ae=ne.height*ie;J.activeTexture.set(se.TEXTURE1),J.viewport.set([0,0,ge,ae]);let ce=re.heatmapFbo;if(!ce||ce&&(ce.width!==ge||ce.height!==ae)){ce&&ce.destroy();const xe=se.createTexture();se.bindTexture(se.TEXTURE_2D,xe),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.LINEAR),ce=re.heatmapFbo=J.createFramebuffer(ge,ae,!0,null),function(ve,ye,Ce,Me,Le,Se){const we=ve.gl;we.texImage2D(we.TEXTURE_2D,0,ve.extRenderToTextureHalfFloat?we.RGBA16F:we.RGBA,Le,Se,0,we.RGBA,ve.extRenderToTextureHalfFloat?we.HALF_FLOAT:we.UNSIGNED_BYTE,null),Me.colorAttachment.set(Ce)}(J,0,xe,ce,ge,ae)}else se.bindTexture(se.TEXTURE_2D,ce.colorAttachment.get()),J.bindFramebuffer.set(ce.framebuffer)})(w,y,p,"globe"===y.transform.projection.name?.5:.25),w.clear({color:f.C.transparent});const F=y.transform,B="globe"===F.projection.name,j=B?["PROJECTION_GLOBE_VIEW"]:[],Z=B?f.ag.frontCCW:f.ag.disabled,K=[f.ak(F.center.lng),f.al(F.center.lat)];for(let J=0;J<v.length;J++){const ne=v[J];if(c.hasRenderableParent(ne))continue;const re=c.getTile(ne),ie=re.getBucket(p);if(!ie||ie.projection.name!==F.projection.name)continue;const se=y.isTileAffectedByFog(ne),ge=ie.programConfigurations.get(p.id),ae=y.getOrCreateProgram("heatmap",{config:ge,defines:j,overrideFog:se}),{zoom:ce}=y.transform;y.terrain&&y.terrain.setupElevationDraw(re,ae),y.uploadCommonUniforms(w,ae,ne.toUnwrapped());const xe=F.projection.createInversionMatrix(F,ne.canonical);ae.draw(y,C.TRIANGLES,f.af.disabled,M,I,Z,ln(y,ne,re,xe,K,ce,p.paint.get("heatmap-intensity")),p.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,p.paint,y.transform.zoom,ge,B?[ie.globeExtVertexBuffer]:null)}w.viewport.set([0,0,y.width,y.height])}else"translucent"===y.renderPass&&(y.context.setColorMode(y.colorModeForRenderPass()),function(w,C){const M=w.context,I=M.gl,F=C.heatmapFbo;if(!F)return;M.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,F.colorAttachment.get()),M.activeTexture.set(I.TEXTURE1);let B=C.colorRampTexture;B||(B=C.colorRampTexture=new f.T(M,C.colorRamp,I.RGBA)),B.bind(I.LINEAR,I.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,I.TRIANGLES,f.af.disabled,f.ah.disabled,w.colorModeForRenderPass(),f.ag.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(y,p))},line:function(y,c,p,v){if("translucent"!==y.renderPass)return;const w=p.paint.get("line-opacity"),C=p.paint.get("line-width");if(0===w.constantOr(1)||0===C.constantOr(1))return;const M=p.paint.get("line-emissive-strength"),I=p.paint.get("line-occlusion-opacity"),F=y.context,B=F.gl,j=p.layout.get("line-z-offset"),Z=!j.isConstant()||!!j.constantOr(0),K=Z?new f.af(y.depthOcclusion?B.GREATER:B.LEQUAL,f.af.ReadOnly,y.depthRangeFor3D):y.depthModeForSublayer(0,f.af.ReadOnly),J=y.colorModeForDrapableLayerRenderPass(M),ne=y.terrain&&y.terrain.renderingToTexture,re=ne?1:f.e.devicePixelRatio,ie=p.paint.get("line-dasharray"),se=ie.constantOr(1),ge=p.layout.get("line-cap"),ae=ie.constantOr(null),ce=ge.constantOr(null),xe=p.paint.get("line-pattern"),ve=xe.constantOr(1),ye=xe.constantOr(null),Ce=p.paint.get("line-opacity").constantOr(1);let Me=!ve&&1!==Ce||y.depthOcclusion&&I>0&&I<1;const Le=p.paint.get("line-gradient"),Se=ve?"linePattern":"line",we=f.bV(p);let Ue;if(ne&&y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(Me=!1),0!==I&&y.depthOcclusion){const Fe=p.paint._values["line-opacity"];Fe&&Fe.value&&"constant"===Fe.value.kind?Ue=Fe.value:f.w(`Occlusion opacity for layer ${p.id} is supported only when line-opacity isn't data-driven.`)}if(Z&&(y.forceTerrainMode=!0),!Z&&0!==I&&y.terrain&&!ne)return void f.w(`Occlusion opacity for layer ${p.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const et=Me&&Z?y.stencilModeFor3D():f.ah.disabled;for(const Fe of v){const Mt=c.getTile(Fe);if(ve&&!Mt.patternsLoaded())continue;const pt=Mt.getBucket(p);if(!pt)continue;y.prepareDrawTile();const qe=pt.programConfigurations.get(p.id),at=y.isTileAffectedByFog(Fe),Pe=y.getOrCreateProgram(Se,{config:qe,defines:Z?[...we,"ELEVATED"]:we,overrideFog:at});if(ye&&Mt.imageAtlas){const xt=Mt.imageAtlas.patternPositions[ye.toString()];xt&&qe.setConstantPatternPositions(xt)}if(!ve&&ae&&ce&&Mt.lineAtlas){const xt=Mt.lineAtlas.getDash(ae,ce);xt&&qe.setConstantPatternPositions(xt)}let[wt,Et]=p.paint.get("line-trim-offset");("round"===ce||"square"===ce)&&wt!==Et&&(0===wt&&(wt-=1),1===Et&&(Et+=1));const Qt=ne?Fe.projMatrix:null,sn=ve?f.bW(y,Mt,p,Qt,re,[wt,Et]):f.bX(y,Mt,p,Qt,pt.lineClipsArray.length,re,[wt,Et]);if(Le){const xt=pt.gradients[p.id];let Bn=xt.texture;if(p.gradientVersion!==xt.version){let tr=256;if(p.stepInterpolant){const Pn=c.getSource().maxzoom,fr=Fe.canonical.z===Pn?Math.ceil(1<<y.transform.maxZoom-Fe.canonical.z):1;tr=f.au(f.bY(pt.maxLineLength/f.a4*1024*fr),256,F.maxTextureSize)}xt.gradient=f.bZ({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:tr,image:xt.gradient||void 0,clips:pt.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new f.T(F,xt.gradient,B.RGBA),xt.version=p.gradientVersion,Bn=xt.texture}F.activeTexture.set(B.TEXTURE1),Bn.bind(p.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}se&&(F.activeTexture.set(B.TEXTURE0),Mt.lineAtlasTexture&&Mt.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),qe.updatePaintBuffers()),ve&&(F.activeTexture.set(B.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),qe.updatePaintBuffers()),Z&&y.terrain.setupElevationDraw(Mt,Pe),y.uploadCommonUniforms(F,Pe,Fe.toUnwrapped());const fn=xt=>{null!=Ue&&(Ue.value=Ce*I),Pe.draw(y,B.TRIANGLES,K,xt,J,f.ag.disabled,sn,p.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,p.paint,y.transform.zoom,qe,[pt.layoutVertexBuffer2,pt.patternVertexBuffer,pt.zOffsetVertexBuffer]),null!=Ue&&(Ue.value=Ce)};if(Me&&!Z){const xt=y.stencilModeForClipping(Fe).ref;0===xt&&ne&&F.clear({stencil:0});const Bn={func:B.EQUAL,mask:255};sn.u_alpha_discard_threshold=.8,fn(new f.ah(Bn,xt,255,B.KEEP,B.KEEP,B.INVERT)),sn.u_alpha_discard_threshold=0,fn(new f.ah(Bn,xt,255,B.KEEP,B.KEEP,B.KEEP))}else Me&&Z&&(sn.u_alpha_discard_threshold=.001),fn(Z?et:y.stencilModeForClipping(Fe))}Me&&(y.resetStencilClippingMasks(),ne&&F.clear({stencil:0})),0===I||y.depthOcclusion||ne||y.layersWithOcclusionOpacity.push(y.currentLayer),Z&&(y.forceTerrainMode=!1)},fill:function(y,c,p,v){const w=p.paint.get("fill-color"),C=p.paint.get("fill-opacity");if(0===C.constantOr(1))return;const M=p.paint.get("fill-emissive-strength"),I=y.colorModeForDrapableLayerRenderPass(M),F=p.paint.get("fill-pattern"),B=y.opaquePassEnabledForLayer()&&!F.constantOr(1)&&1===w.constantOr(f.C.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(y.renderPass===B){const j=y.depthModeForSublayer(1,"opaque"===y.renderPass?f.af.ReadWrite:f.af.ReadOnly);p_(y,c,p,v,j,I,!1)}if("translucent"===y.renderPass&&p.paint.get("fill-antialias")){const j=y.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,f.af.ReadOnly);p_(y,c,p,v,j,I,!0)}},"fill-extrusion":function(y,c,p,v){const w=p.paint.get("fill-extrusion-opacity"),C=y.context,M=C.gl,I=y.terrain,F=I&&I.renderingToTexture;if(0===w)return;const B=y.conflationActive&&y.style.isLayerClipped(p,c.getSource()),j=y.style.order.indexOf(p.fqid);if(B&&function(Z,K,J,ne,re){for(const ie of ne){const se=K.getTile(ie).getBucket(J);se&&(se.updateReplacement(ie,Z.replacementSource,re),se.uploadCentroid(Z.context))}}(y,c,p,v,j),I||B)for(const Z of v){const K=c.getTile(Z).getBucket(p);K&&PD(y.context,c,Z,K,p,I,B)}if("shadow"===y.renderPass&&y.shadowRenderer){const Z=y.shadowRenderer;if(I&&w<.65&&p._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof f.Z)return;const K=Z.getShadowPassDepthMode(),J=Z.getShadowPassColorMode();hl(y,c,p,v,K,f.ah.disabled,J,B)}else if("translucent"===y.renderPass){const Z=!p.paint.get("fill-extrusion-pattern").constantOr(1),K=p.paint.get("fill-extrusion-color").constantOr(f.C.white);if(!F&&0!==K.a){const J=new f.af(y.context.gl.LEQUAL,f.af.ReadWrite,y.depthRangeFor3D);1===w&&Z?hl(y,c,p,v,J,f.ah.disabled,f.a.unblended,B):(hl(y,c,p,v,J,f.ah.disabled,f.a.disabled,B),hl(y,c,p,v,J,y.stencilModeFor3D(),y.colorModeForRenderPass(),B),y.resetStencilClippingMasks())}if(y.style.enable3dLights()&&Z&&(!I&&"globe"!==y.transform.projection.name||F)){const J=p.paint.get("fill-extrusion-opacity"),ne=p.paint.get("fill-extrusion-ambient-occlusion-intensity"),re=p.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=p.paint.get("fill-extrusion-flood-light-intensity"),se=p.paint.get("fill-extrusion-flood-light-color").toRenderColor(p.lut).toArray01().slice(0,3),ge=ne>0&&re>0,ae=ie>0,ce=(ve,ye,Ce)=>(1-Ce)*ve+Ce*ye,xe=ve=>{const ye=y.depthModeForSublayer(1,f.af.ReadOnly,M.LEQUAL,!0),Ce=p.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=ce(.1,3,Ce),Le=y._showOverdrawInspector;if(!Le){const Se=new f.ah({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),we=new f.a([M.ONE,M.ONE,M.ONE,M.ONE],f.C.transparent,[!1,!1,!1,!0],M.MIN);Fm(y,c,p,v,ye,Se,we,f.ag.disabled,ve,"sdf",J,ne,re,ie,se,Me,B,!1)}{const Se=Le?f.ah.disabled:new f.ah({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),we=Le?y.colorModeForRenderPass():new f.a([M.ONE_MINUS_DST_ALPHA,M.DST_ALPHA,M.ONE,M.ONE],f.C.transparent,[!0,!0,!0,!0]);Fm(y,c,p,v,ye,Se,we,f.ag.disabled,ve,"color",J,ne,re,ie,se,Me,B,!1)}};if(F){const ve=(ye,Ce,Me)=>{const Le=y.depthModeForSublayer(1,f.af.ReadOnly,M.LEQUAL,!1),Se=p.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),we=ce(.1,3,Se);{const Ue=new f.a([M.ONE,M.ONE,M.ONE,M.ONE],f.C.transparent,[!1,!1,!1,!0]);Fm(y,c,p,v,Le,f.ah.disabled,Ue,f.ag.disabled,ye,"clear",J,ne,re,ie,se,we,B,Ce)}{const Ue=new f.ah({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),et=new f.a([M.ONE,M.ONE,M.ONE,M.ONE],f.C.transparent,[!1,!1,!1,!0],M.MIN);Fm(y,c,p,v,Le,Ue,et,f.ag.disabled,ye,"sdf",J,ne,re,ie,se,we,B,Ce)}{const Ue=ye?M.ZERO:M.ONE_MINUS_DST_ALPHA,et=new f.ah({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),Fe=new f.a([Ue,M.DST_ALPHA,M.ONE_MINUS_DST_ALPHA,M.ZERO],f.C.transparent,[!0,!0,!0,!0]);Fm(y,c,p,v,Le,et,Fe,f.ag.disabled,ye,"color",J,ne,re,ie,se,we,B,Ce)}{const Ue=new f.a([M.ONE,M.ONE,M.ONE,ye?M.ZERO:M.ONE],f.C.transparent,[!1,!1,!1,!0],ye?M.FUNC_ADD:M.MAX);Fm(y,c,p,v,Le,f.ah.disabled,Ue,f.ag.disabled,ye,"clear",J,ne,re,ie,se,we,B,Ce,Me)}};if(ge||ae){let ye;if(y.prepareDrawTile(),I){const Ce=I.drapeBufferSize[0],Me=I.drapeBufferSize[1];ye=I.framebufferCopyTexture,ye&&(!ye||ye.size[0]===Ce&&ye.size[1]===Me)||(ye&&ye.destroy(),ye=I.framebufferCopyTexture=new f.T(C,new f.j({width:Ce,height:Me}),M.RGBA)),ye.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexImage2D(M.TEXTURE_2D,0,M.RGBA,0,0,Ce,Me,0)}ge&&ve(!0,!1,ye),ae&&ve(!1,!0,ye)}}else ge&&xe(!0),ae&&xe(!1),(ge||ae)&&y.resetStencilClippingMasks()}}},hillshade:function(y,c,p,v){if("offscreen"!==y.renderPass&&"translucent"!==y.renderPass||y.style.disableElevatedTerrain)return;const w=y.context,C=y.terrain&&y.terrain.renderingToTexture,[M,I]="translucent"!==y.renderPass||C?[{},v]:y.stencilConfigForOverlap(v);for(const F of I){const B=c.getTile(F);if(B.needsHillshadePrepare&&"offscreen"===y.renderPass)xx(y,B,p);else if("translucent"===y.renderPass){const j=y.depthModeForSublayer(0,f.af.ReadOnly),Z=p.paint.get("hillshade-emissive-strength"),K=y.colorModeForDrapableLayerRenderPass(Z),J=C&&y.terrain?y.terrain.stencilModeForRTTOverlap(F):M[F.overscaledZ];vx(y,F,B,p,j,J,K)}}w.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,c,p,v,w,C){if("translucent"!==y.renderPass||0===p.paint.get("raster-opacity"))return;const M="globe"===y.transform.projection.name,I=0!==p.paint.get("raster-elevation"),F=I&&M;if(y.renderElevatedRasterBackface&&!F)return;const B=y.context,j=B.gl,Z=c.getSource(),K=function(ve,ye,Ce,Me){const Le=ye.paint.get("raster-color"),Se="raster-array"===ve.type,we=[],Ue=ye.paint.get("raster-resampling"),et=ye.paint.get("raster-color-mix");let Fe=ye.paint.get("raster-color-range");const Mt=[et[0],et[1],et[2],0],pt=et[3];let qe="nearest"===Ue?Me.NEAREST:Me.LINEAR;if(Se&&(we.push("RASTER_ARRAY"),Le||we.push("RASTER_COLOR"),"linear"===Ue&&we.push("RASTER_ARRAY_LINEAR"),qe=Me.NEAREST,!Fe&&ve.rasterLayers)){const at=ve.rasterLayers.find(({id:Pe})=>Pe===ye.sourceLayer);at&&at.fields&&at.fields.range&&(Fe=at.fields.range)}if(Fe=Fe||[0,1],Le){we.push("RASTER_COLOR"),Ce.activeTexture.set(Me.TEXTURE2),ye.updateColorRamp(Fe);let at=ye.colorRampTexture;at||(at=ye.colorRampTexture=new f.T(Ce,ye.colorRamp,Me.RGBA)),at.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}return{mix:Mt,range:Fe,offset:pt,defines:we,resampling:qe}}(Z,p,B,j);if(Z instanceof f.bo&&!v.length&&!M)return;const J=p.paint.get("raster-emissive-strength"),ne=y.colorModeForDrapableLayerRenderPass(J),re=y.terrain&&y.terrain.renderingToTexture,ie=!y.options.moving,se="nearest"===p.paint.get("raster-resampling")?j.NEAREST:j.LINEAR;if(Z instanceof f.bo&&!v.length&&(Z.onNorthPole||Z.onSouthPole)){const ve=I?y.stencilModeFor3D():f.ah.disabled;return void N1(!!Z.onNorthPole,null,y,c,p,J,K,f.ag.disabled,ve)}if(!v.length)return;const[ge,ae]=Z instanceof f.bo||re?[{},v]:y.stencilConfigForOverlap(v),ce=ae[ae.length-1].overscaledZ;F&&K.defines.push("PROJECTION_GLOBE_VIEW"),I&&K.defines.push("RENDER_CUTOFF");const xe=(ve,ye,Ce)=>{for(const Me of ve){const Le=Me.toUnwrapped(),Se=c.getTile(Me);if(re&&(!Se||!Se.hasData()))continue;B.activeTexture.set(j.TEXTURE0);const we=br(Se,Z,p,K);if(!we||!we.texture)continue;const{texture:Ue,mix:et,offset:Fe,tileSize:Mt,buffer:pt}=we;let qe,at;re?(qe=f.af.disabled,at=Me.projMatrix):I?(qe=new f.af(j.LEQUAL,f.af.ReadWrite,y.depthRangeFor3D),at=M?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(Le,ie)):(qe=y.depthModeForSublayer(Me.overscaledZ-ce,1===p.paint.get("raster-opacity")?f.af.ReadWrite:f.af.ReadOnly,j.LESS),at=y.transform.calculateProjMatrix(Le,ie));const Pe=y.terrain&&re?y.terrain.stencilModeForRTTOverlap(Me):ge[Me.overscaledZ],wt=C?0:p.paint.get("raster-fade-duration");Se.registerFadeDuration(wt);const Et=c.findLoadedParent(Me,0),Qt=o_(Se,Et,c,y.transform,wt);let sn,fn;y.terrain&&y.terrain.prepareDrawTile(),B.activeTexture.set(j.TEXTURE0),Ue.bind(se,j.CLAMP_TO_EDGE),B.activeTexture.set(j.TEXTURE1),Et?(Et.texture&&Et.texture.bind(se,j.CLAMP_TO_EDGE),sn=Math.pow(2,Et.tileID.overscaledZ-Se.tileID.overscaledZ),fn=[Se.tileID.canonical.x*sn%1,Se.tileID.canonical.y*sn%1]):Ue.bind(se,j.CLAMP_TO_EDGE),Ue.useMipmap&&B.extTextureFilterAnisotropic&&y.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const xt=y.transform;let Bn;const tr=I?el(xt):[0,0,0,0];let Pn,fr,Cr,Ar,ci,nr=0;if(F&&Z instanceof f.bo&&Z.coordinates.length>3)Pn=Float32Array.from(f.bh(f.bi(new f.aO(0,0,0)))),fr=Float32Array.from(xt.globeMatrix),Cr=Float32Array.from(f.bd(xt)),Ar=[f.ak(xt.center.lng),f.al(xt.center.lat)],Bn=Z.elevatedGlobePerspectiveTransform,ci=Z.elevatedGlobeGridMatrix||new Float32Array(9);else if(F){const sr=f.be(Me.canonical);nr=f.bf(sr.getCenter().lat),Pn=Float32Array.from(f.bh(f.bi(Me.canonical))),fr=Float32Array.from(xt.globeMatrix),Cr=Float32Array.from(f.bd(xt)),Ar=[f.ak(xt.center.lng),f.al(xt.center.lat)],Bn=[0,0],ci=Float32Array.from(f.bg(Me.canonical,sr,nr,xt.worldSize/xt._pixelsPerMercatorPixel))}else Bn=Z instanceof f.bo?Z.perspectiveTransform:[0,0],Pn=new Float32Array(16),fr=new Float32Array(9),Cr=new Float32Array(16),Ar=[0,0],ci=new Float32Array(9);const Mr=km(at,Pn,fr,Cr,ci,fn||[0,0],f.a2(y.transform.zoom),Ar,tr,sn||1,Qt,p,Bn,I?p.paint.get("raster-elevation"):0,2,et,Fe,K.range,Mt,pt,J),yr=y.isTileAffectedByFog(Me),mr=y.getOrCreateProgram("raster",{defines:K.defines,overrideFog:yr});if(y.uploadCommonUniforms(B,mr,Le),Z instanceof f.bo){const sr=Z.elevatedGlobeVertexBuffer,Sr=Z.elevatedGlobeIndexBuffer;if(re||!M)Z.boundsBuffer&&Z.boundsSegments&&mr.draw(y,j.TRIANGLES,qe,f.ah.disabled,ne,f.ag.disabled,Mr,p.id,Z.boundsBuffer,y.quadTriangleIndexBuffer,Z.boundsSegments);else if(sr&&Sr){const Tr=xt.zoom<=f.b3?Z.elevatedGlobeSegments:Z.getSegmentsForLongitude(xt.center.lng);Tr&&mr.draw(y,j.TRIANGLES,qe,f.ah.disabled,ne,ye,Mr,p.id,sr,Sr,Tr)}}else if(F){qe=new f.af(j.LEQUAL,f.af.ReadOnly,y.depthRangeFor3D);const sr=y.globeSharedBuffers;if(sr){const[Sr,Tr,Qn]=sr.getGridBuffers(nr,!1);mr.draw(y,j.TRIANGLES,qe,Ce||Pe,y.colorModeForRenderPass(),ye,Mr,p.id,Sr,Tr,Qn)}}else{const{tileBoundsBuffer:sr,tileBoundsIndexBuffer:Sr,tileBoundsSegments:Tr}=y.getTileBoundsBuffers(Se);mr.draw(y,j.TRIANGLES,qe,Pe,ne,f.ag.disabled,Mr,p.id,sr,Sr,Tr)}}if(!(Z instanceof f.bo)&&F)for(const Me of ve){const Le=Me.canonical.y===(1<<Me.canonical.z)-1;0===Me.canonical.y&&N1(!0,Me,y,c,p,J,K,ye,Ce||f.ah.disabled),Le&&N1(!1,Me,y,c,p,J,K,ye===f.ag.frontCW?f.ag.backCW:f.ag.frontCW,Ce||f.ah.disabled)}};F?xe(ae,y.renderElevatedRasterBackface?f.ag.backCW:f.ag.frontCW,y.stencilModeFor3D()):xe(ae,f.ag.disabled,void 0),y.resetStencilClippingMasks()},"raster-particle":function(y,c,p,v,w,C){"offscreen"===y.renderPass&&function(M,I,F,B){if(!B.length)return;const j=M.context,Z=j.gl,K=I.getSource();if(!(K instanceof nf))return;const J=Math.ceil(Math.sqrt(F.paint.get("raster-particle-count")));let ne=F.particlePositionRGBAImage;if(!ne||ne.width!==J){const ae=function(ce){const xe=ce*ce,ve=new Uint8Array(4*xe),ye=function(Me){return Me|=0,Me=Math.imul(2747636419^Me,2654435769),Me=Math.imul(Me^Me>>>16,2654435769),((Me=Math.imul(Me^Me>>>16,2654435769))>>>0)/4294967296},Ce=1/1.1;for(let Me=0;Me<xe;Me++){const Le=Ce*(ye(2*Me+0)+$u),Se=Ce*(ye(2*Me+1)+$u),we=255*Le%1,Ue=255*Se%1,et=we,Fe=Se-Ue/255,Mt=Ue;ve[4*Me+0]=255*(Le-we/255),ve[4*Me+1]=255*et,ve[4*Me+2]=255*Fe,ve[4*Me+3]=255*Mt}return ve}(J);ne=F.particlePositionRGBAImage=new f.j({width:J,height:J},ae)}let re=F.particleFramebuffer;re?re.width!==J&&(re.destroy(),re=F.particleFramebuffer=j.createFramebuffer(J,J,!0,null)):re=F.particleFramebuffer=j.createFramebuffer(J,J,!0,null);const ie=[];for(const ae of B){const ce=I.getTile(ae);if(!(ce instanceof f.c5))continue;const xe=lT(ce,K,F);if(!xe)continue;const ve=[ce.tileSize,ce.tileSize];let ye=F.tileFramebuffer;ye||(ye=F.tileFramebuffer=j.createFramebuffer(ve[0],ve[1],!0,null));let Ce=ce.rasterParticleState;Ce||(Ce=ce.rasterParticleState=new qh(j,ae,ve,ne));const Me=Ce.update(F.lastInvalidatedAt);Ce.particleTextureDimension!==J&&Ce.updateParticleTexture(ae,ne);const Le=Ce.targetColorTexture;Ce.targetColorTexture=Ce.backgroundColorTexture,Ce.backgroundColorTexture=Le;const Se=Ce.particleTexture0;Ce.particleTexture0=Ce.particleTexture1,Ce.particleTexture1=Se,ie.push([ae,xe,Ce,Me])}if(0===ie.length)return;const se=f.e.now(),ge=F.previousDrawTimestamp?.001*(se-F.previousDrawTimestamp):.0167;if(F.previousDrawTimestamp=se,F.hasColorMap()){j.activeTexture.set(Z.TEXTURE0+2);let ae=F.colorRampTexture;ae||(ae=F.colorRampTexture=new f.T(j,F.colorRamp,Z.RGBA)),ae.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}j.bindFramebuffer.set(F.tileFramebuffer.framebuffer),function(ae,ce,xe){const ve=ae.context,ye=ve.gl,Ce=ce.tileFramebuffer;ve.activeTexture.set(ye.TEXTURE0);const Me={u_texture:0,u_opacity:1.05*(Se=ce.paint.get("raster-particle-fade-opacity-factor"))/(Se+.05)},Le=ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Se;for(const we of xe){const[,,Ue,et]=we;Ce.colorAttachment.set(Ue.targetColorTexture.texture),ve.viewport.set([0,0,Ce.width,Ce.height]),ve.clear({color:f.C.transparent}),et&&(Ue.backgroundColorTexture.bind(ye.NEAREST,ye.CLAMP_TO_EDGE),Le.draw(ae,ye.TRIANGLES,f.af.disabled,f.ah.disabled,f.a.alphaBlended,f.ag.disabled,Me,ce.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments))}}(M,F,ie),function(ae,ce,xe,ve){const ye=ae.context,Ce=ye.gl,Me=xe.tileFramebuffer,Le="globe"===ae.transform.projection.name,Se=xe.paint.get("raster-particle-max-speed");for(const we of ve){const[Ue,et,Fe]=we;ye.activeTexture.set(Ce.TEXTURE0+0),et.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Me.colorAttachment.set(Fe.targetColorTexture.texture);const Mt=ae.getOrCreateProgram("rasterParticleDraw",{defines:et.defines,overrideFog:!1});ye.activeTexture.set(Ce.TEXTURE0+1);const pt=et.scalarData?[]:[0,1,2,3].map(Pe=>f.b$[Pe](Ue));pt.push(Ue);const qe=Ue.canonical.x,at=Ue.canonical.y;for(const Pe of pt){const wt=ce.getTile(Le?Pe.wrapped():Pe);if(!wt)continue;const Et=wt.rasterParticleState;if(!Et)continue;const Qt=Pe.canonical.x+(1<<Pe.canonical.z)*(Pe.wrap-Ue.wrap),sn=Pe.canonical.y;Et.particleTexture0.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);const fn=Hu(1,Et.particleTexture0.size[0],[Qt-qe,sn-at],0,et.texture.size,2,Se,et.textureOffset,et.scale,et.offset);Mt.draw(ae,Ce.POINTS,f.af.disabled,f.ah.disabled,f.a.alphaBlended,f.ag.disabled,fn,xe.id,Et.particleIndexBuffer,void 0,Et.particleSegment)}}}(M,I,F,ie),j.bindFramebuffer.set(F.particleFramebuffer.framebuffer),function(ae,ce,xe,ve){const ye=ae.context,Ce=ye.gl,Me=ce.paint.get("raster-particle-max-speed"),Le=ve*ce.paint.get("raster-particle-speed-factor")*.15,Se=(Ue=.01+1*ce.paint.get("raster-particle-reset-rate-factor"),Math.pow(Ue,6)),we=ce.particleFramebuffer;var Ue;ye.viewport.set([0,0,we.width,we.height]);for(const Ue of xe){const[,et,Fe]=Ue;ye.activeTexture.set(Ce.TEXTURE0+0),et.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),ye.activeTexture.set(Ce.TEXTURE0+1);const Mt=Fe.particleTexture0;Mt.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);const pt=rf(1,Mt.size[0],0,et.texture.size,Me,Le,Se,et.textureOffset,et.scale,et.offset);we.colorAttachment.set(Fe.particleTexture1.texture),ye.clear({color:f.C.transparent}),ae.getOrCreateProgram("rasterParticleUpdate",{defines:et.defines}).draw(ae,Ce.TRIANGLES,f.af.disabled,f.ah.disabled,f.a.unblended,f.ag.disabled,pt,ce.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments)}}(M,F,ie,ge)}(y,c,p,v),"translucent"===y.renderPass&&(function(M,I,F,B,j){const Z=M.context,K=Z.gl,J=I.getSource().tileSize,ne=5*(1-f.a0(f.aV,f.aV+1,M.transform.zoom))*J+F.paint.get("raster-particle-elevation"),re=!M.options.moving,ie="globe"===M.transform.projection.name;if(!B.length)return;const[se,ge]=M.stencilConfigForOverlap(B),ae=[];ie&&ae.push("PROJECTION_GLOBE_VIEW");const ce=M.stencilModeFor3D();for(const xe of ge){const ve=xe.toUnwrapped(),ye=I.getTile(xe);if(!ye.rasterParticleState)continue;const Ce=ye.rasterParticleState,Me=100;ye.registerFadeDuration(Me);const Le=I.findLoadedParent(xe,0),Se=o_(ye,Le,I,M.transform,Me);let we,Ue;M.terrain&&M.terrain.prepareDrawTile(),Z.activeTexture.set(K.TEXTURE0),Ce.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Z.activeTexture.set(K.TEXTURE1),Le&&Le.rasterParticleState?(Le.rasterParticleState.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),we=Math.pow(2,Le.tileID.overscaledZ-ye.tileID.overscaledZ),Ue=[ye.tileID.canonical.x*we%1,ye.tileID.canonical.y*we%1]):Ce.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const et=ie?Float32Array.from(M.transform.expandedFarZProjMatrix):M.transform.calculateProjMatrix(ve,re),Fe=M.transform,Mt=F1(Fe),pt=f.be(xe.canonical),qe=f.bf(pt.getCenter().lat);let at,Pe,wt,Et,Qt;ie?(at=Float32Array.from(f.bh(f.bi(xe.canonical))),Pe=Float32Array.from(Fe.globeMatrix),wt=Float32Array.from(f.bd(Fe)),Et=[f.ak(Fe.center.lng),f.al(Fe.center.lat)],Qt=Float32Array.from(f.bg(xe.canonical,pt,qe,Fe.worldSize/Fe._pixelsPerMercatorPixel))):(at=new Float32Array(16),Pe=new Float32Array(9),wt=new Float32Array(16),Et=[0,0],Qt=new Float32Array(9));const sn=Bd(et,at,Pe,wt,Qt,Ue||[0,0],f.a2(M.transform.zoom),Et,Mt,we||1,Se,ne),fn=M.isTileAffectedByFog(xe),xt=M.getOrCreateProgram("rasterParticle",{defines:ae,overrideFog:fn});if(M.uploadCommonUniforms(Z,xt,ve),ie){const Bn=new f.af(K.LEQUAL,f.af.ReadOnly,M.depthRangeFor3D),tr=0,Pn=M.globeSharedBuffers;if(Pn){const[fr,Cr,Ar]=Pn.getGridBuffers(qe,0!==tr);xt.draw(M,K.TRIANGLES,Bn,ce,f.a.alphaBlended,M.renderElevatedRasterBackface?f.ag.frontCCW:f.ag.backCCW,sn,F.id,fr,Cr,Ar)}}else{const Bn=M.depthModeForSublayer(0,f.af.ReadOnly),tr=se[xe.overscaledZ],{tileBoundsBuffer:Pn,tileBoundsIndexBuffer:fr,tileBoundsSegments:Cr}=M.getTileBoundsBuffers(ye);xt.draw(M,K.TRIANGLES,Bn,tr,f.a.alphaBlended,f.ag.disabled,sn,F.id,Pn,fr,Cr)}}M.resetStencilClippingMasks()}(y,c,p,v),y.style.map.triggerRepaint())},background:function(y,c,p,v){const w=p.paint.get("background-color"),C=p.paint.get("background-opacity"),M=p.paint.get("background-emissive-strength");if(0===C)return;const I=y.context,F=I.gl,B=y.transform,j=B.tileSize,Z=p.paint.get("background-pattern");let K;if(void 0!==Z&&(null===Z||(K=y.imageManager.getPattern(Z.toString(),p.scope,y.style.getLut(p.scope)),!K)))return;const J=!Z&&1===w.a&&1===C&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==J)return;const ne=f.ah.disabled,re=y.depthModeForSublayer(0,"opaque"===J?f.af.ReadWrite:f.af.ReadOnly),ie=y.colorModeForDrapableLayerRenderPass(M),se=Z?"backgroundPattern":"background";let ge,ae=v;ae||(ge=y.getBackgroundTiles(),ae=Object.values(ge).map(ce=>ce.tileID)),Z&&(I.activeTexture.set(F.TEXTURE0),y.imageManager.bind(y.context,p.scope));for(const ce of ae){const xe=y.isTileAffectedByFog(ce),ve=y.getOrCreateProgram(se,{overrideFog:xe}),ye=ce.toUnwrapped(),Ce=v?ce.projMatrix:y.transform.calculateProjMatrix(ye);y.prepareDrawTile();const Me=c?c.getTile(ce):ge?ge[ce.key]:new f.bA(ce,j,B.zoom,y),Le=Z?OD(Ce,M,C,y,0,p.scope,K,{tileID:ce,tileSize:j}):zd(Ce,M,C,w.toRenderColor(p.lut));y.uploadCommonUniforms(I,ve,ye);const{tileBoundsBuffer:Se,tileBoundsIndexBuffer:we,tileBoundsSegments:Ue}=y.getTileBoundsBuffers(Me);ve.draw(y,F.TRIANGLES,re,ne,ie,f.ag.disabled,Le,p.id,Se,we,Ue)}},sky:function(y,c,p){const v=y._atmosphere?f.a2(y.transform.zoom):1,w=p.paint.get("sky-opacity")*v;if(0===w)return;const C=y.context,M=p.paint.get("sky-type"),I=new f.af(C.gl.LEQUAL,f.af.ReadOnly,[0,1]),F=y.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===y.renderPass?p.needsSkyboxCapture(y)&&(function(B,j,Z,K){const J=B.context,ne=J.gl;let re=j.skyboxFbo;if(!re){re=j.skyboxFbo=J.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new _n(J),j.skyboxTexture=J.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,j.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ae=0;ae<6;++ae)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(re.framebuffer),J.viewport.set([0,0,32,32]);const ie=j.getCenter(B,!0),se=B.getOrCreateProgram("skyboxCapture"),ge=new Float64Array(16);f.ae.identity(ge),f.ae.rotateY(ge,ge,.5*-Math.PI),Fr(B,j,se,ge,ie,0),f.ae.identity(ge),f.ae.rotateY(ge,ge,.5*Math.PI),Fr(B,j,se,ge,ie,1),f.ae.identity(ge),f.ae.rotateX(ge,ge,.5*-Math.PI),Fr(B,j,se,ge,ie,2),f.ae.identity(ge),f.ae.rotateX(ge,ge,.5*Math.PI),Fr(B,j,se,ge,ie,3),f.ae.identity(ge),Fr(B,j,se,ge,ie,4),f.ae.identity(ge),f.ae.rotateY(ge,ge,Math.PI),Fr(B,j,se,ge,ie,5),J.viewport.set([0,0,B.width,B.height])}(y,p),p.markSkyboxValid(y)):"sky"===y.renderPass&&function(B,j,Z,K,J){const ne=B.context,re=ne.gl,ie=B.transform,se=B.getOrCreateProgram("skybox");ne.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,j.skyboxTexture);const ge=((ae,ce,xe,ve,ye)=>({u_matrix:ae,u_sun_direction:ce,u_cubemap:0,u_opacity:ve,u_temporal_offset:ye}))(ie.skyboxMatrix,j.getCenter(B,!1),0,K,J);B.uploadCommonUniforms(ne,se),se.draw(B,re.TRIANGLES,Z,f.ah.disabled,B.colorModeForRenderPass(),f.ag.backCW,ge,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(y,p,I,w,F):"gradient"===M&&"sky"===y.renderPass&&function(B,j,Z,K,J){const ne=B.context,re=ne.gl,ie=B.transform,se=B.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new _n(ne)),ne.activeTexture.set(re.TEXTURE0);let ge=j.colorRampTexture;ge||(ge=j.colorRampTexture=new f.T(ne,j.colorRamp,re.RGBA)),ge.bind(re.LINEAR,re.CLAMP_TO_EDGE);const ae=(ce=ie.skyboxMatrix,xe=j.getCenter(B,!1),ve=j.paint.get("sky-gradient-radius"),ye=K,Ce=J,{u_matrix:ce,u_color_ramp:0,u_center_direction:xe,u_radius:f.ac(ve),u_opacity:ye,u_temporal_offset:Ce});var ce,xe,ve,ye,Ce;B.uploadCommonUniforms(ne,se),se.draw(B,re.TRIANGLES,Z,f.ah.disabled,B.colorModeForRenderPass(),f.ag.backCW,ae,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(y,p,I,w,F)},debug:function(y,c,p,v,w,C){for(let M=0;M<p.length;M++)if(w){const B=new f.C(.8*v.r,.8*v.g,.8*v.b,1);dn(y,c,p[M],v,-1,-1,C),dn(y,c,p[M],v,-1,1,C),dn(y,c,p[M],v,1,1,C),dn(y,c,p[M],v,1,-1,C),dn(y,c,p[M],B,0,0,C)}else dn(y,c,p[M],v,0,0,C)},custom:function(y,c,p,v){const w=y.context,C=p.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||"offscreen"===y.renderPass)&&p.isDraped(c)){if("offscreen"===y.renderPass){const M=C.prerender;if(M){if(y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),"globe"===y.transform.projection.name){const I=y.transform.pointMerc;M.call(C,w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),f.a2(y.transform.zoom),[I.x,I.y],y.transform.pixelsPerMeterRatio)}else M.call(C,w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState()}}else if("translucent"===y.renderPass){if(y.terrain&&y.terrain.renderingToTexture){const I=C.renderToTile;if(I){const F=v[0].canonical,B=new f._(F.x+v[0].wrap*(1<<F.z),F.y,F.z);w.setDepthMode(f.af.disabled),w.setStencilMode(f.ah.disabled),w.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),I.call(C,w.gl,B),w.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),w.setStencilMode(f.ah.disabled);const M="3d"===C.renderingMode?new f.af(y.context.gl.LEQUAL,f.af.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,f.af.ReadOnly);if(w.setDepthMode(M),"globe"===y.transform.projection.name){const I=y.transform.pointMerc;C.render(w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),f.a2(y.transform.zoom),[I.x,I.y],y.transform.pixelsPerMeterRatio)}else C.render(w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState(),w.bindFramebuffer.set(null)}}else f.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(y,c,p,v){if("opaque"===y.renderPass)return;const w=p.paint.get("model-opacity");if(0===w)return;const C=p.paint.get("model-cast-shadows");if("shadow"===y.renderPass&&(!C||y.terrain&&w<.65&&p._transitionablePaint._values["model-opacity"].value.expression instanceof f.Z))return;const M=y.shadowRenderer,I=p.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,I||(M.enabled=!1));const F=()=>{M&&(M.useNormalOffset=!0,I||(M.enabled=!0))},B=c.getSource();if("light-beam"===y.renderPass&&"batched-model"!==B.type)return;if("vector"===B.type||"geojson"===B.type)return function(se,ge,ae,ce,xe){const ve=se.transform;if("mercator"!==ve.projection.name)return void f.w(`Drawing 3D models for ${ve.projection.name} projection is not yet implemented`);const ye=ve.getFreeCameraOptions().position;if(!se.modelManager)return;const Ce=se.modelManager;ae.modelManager=Ce;const Me=se.shadowRenderer;if(!ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Le=ae._unevaluatedLayout._values["model-id"],Se={...ae.layout.get("model-id").parameters},we=se.style.order.indexOf(ae.fqid);for(const Ue of ce){const et=ge.getTile(Ue).getBucket(ae);if(!et||et.projection.name!==ve.projection.name)continue;const Fe=et.getModelUris();Fe&&!et.modelsRequested&&(Ce.addModelsFromBucket(Fe,xe),et.modelsRequested=!0);const Mt=cf(Ue,ve);Se.zoom=Mt;const pt=Le.possiblyEvaluate(Se);if(g_(se,et,Ue),Fc.shadowUniformsInitialized=!1,Fc.useSingleShadowCascade=!!Me&&0===Me.getMaxCascadeForTile(Ue.toUnwrapped()),"shadow"===se.renderPass&&Me){if(1===se.currentShadowCascade&&et.isInsideFirstShadowMapFrustum)continue;const Pe=ve.calculatePosMatrix(Ue.toUnwrapped(),ve.worldSize);if(Fc.tileMatrix.set(Pe),Fc.shadowTileMatrix=Float32Array.from(Me.calculateShadowPassMatrixFromMatrix(Pe)),Fc.aabb.min.fill(0),Fc.aabb.max[0]=Fc.aabb.max[1]=f.a4,Fc.aabb.max[2]=0,Ho(et,Fc,se,ae.scope))continue}const qe=1<<Ue.canonical.z,at=[((ye.x-Ue.wrap)*qe-Ue.canonical.x)*f.a4,(ye.y*qe-Ue.canonical.y)*f.a4,ye.z*qe*f.a4];se.conflationActive&&Object.keys(et.instancesPerModel).length>0&&se.style.isLayerClipped(ae,ge.getSource())&&et.updateReplacement(Ue,se.replacementSource,we,xe)&&(et.uploaded=!1,et.upload(se.context));for(let Pe in et.instancesPerModel){const wt=et.instancesPerModel[Pe];wt.features.length>0&&(Pe=pt.evaluate(wt.features[0].feature,{}));const Et=Ce.getModel(Pe,xe);if(Et&&Et.uploaded)for(const Qt of Et.nodes)jd(se,ae,Qt,wt,at,Ue,Fc)}}}(y,c,p,v,"vector"===B.type?p.scope:""),void F();if(!B.loaded())return;if("batched-model"===B.type)return function(se,ge,ae,ce){ae.resetLayerRenderingStats(se);const xe=se.context,ve=se.transform,ye=se.style.fog,Ce=se.shadowRenderer;if("mercator"!==ve.projection.name)return void f.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const Me=se.transform.getFreeCameraOptions().position,Le=f.$.scale([],[Me.x,Me.y,Me.z],se.transform.worldSize);f.$.negate(Le,Le);const Se=f.ae.identity([]),we=f.ci(ve.center.lat,ve.zoom),Ue=f.ae.fromScaling([],[1,1,1/we]);f.ae.translate(Se,Se,Le);const et=ae.paint.get("model-opacity"),Fe=new f.af(xe.gl.LEQUAL,f.af.ReadWrite,se.depthRangeFor3D),Mt=new f.af(xe.gl.LEQUAL,f.af.ReadOnly,se.depthRangeFor3D),pt=new f.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),qe="shadow"===se.renderPass,at=qe&&Ce?Ce.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),Pe=ae.paint.get("model-front-cutoff"),wt=Pe[2]<1,Et=la(se,ae.paint.get("model-cutoff-fade-range")),Qt=ae.getLayerRenderingStats();(function(sn,fn,xt,Bn){const tr=sn.terrain?sn.terrain.exaggeration():0,Pn=sn.transform.zoom;for(const fr of Bn){const Cr=fn.getTile(fr).getBucket(xt);Cr&&(sn.conflationActive&&Cr.updateReplacement(fr,sn.replacementSource),Cr.evaluateScale(sn,xt),sn.terrain&&tr>0&&Cr.elevationUpdate(sn.terrain,tr,fr,xt.source),Cr.needsReEvaluation(sn,Pn,xt)&&Cr.evaluate(xt))}})(se,ge,ae,ce),function(){let sn,fn,xt;wt?(sn=ce.length-1,fn=-1,xt=-1):(sn=0,fn=ce.length,xt=1);for(let Bn=sn;Bn!==fn;Bn+=xt){const tr=ce[Bn],Pn=ge.getTile(tr).getBucket(ae);if(!Pn||!Pn.uploaded)continue;let fr=!1;Ce&&(fr=0===Ce.getMaxCascadeForTile(tr.toUnwrapped()));const Cr=ve.calculatePosMatrix(tr.toUnwrapped(),ve.worldSize),Ar=Pn.modelTraits,ci=[];for(const nr of Pn.getNodesInfo()){if(nr.hiddenByReplacement||!nr.node.meshes)continue;const Mr=nr.node;let yr=0;se.terrain&&Mr.elevation&&(yr=Mr.elevation*se.terrain.exaggeration());const mr=nr.evaluatedScale;if(mr[0]<=1&&mr[1]<=1&&mr[2]<=1&&0===(()=>{const Eo=nr.aabb;return pt.min=[...Eo.min],pt.max=[...Eo.max],pt.min[2]+=yr,pt.max[2]+=yr,f.$.transformMat4(pt.min,pt.min,Cr),f.$.transformMat4(pt.max,pt.max,Cr),pt})().intersects(at))continue;const sr=[...Cr],Sr=Mr.anchor?Mr.anchor[0]:0,Tr=Mr.anchor?Mr.anchor[1]:0;f.ae.translate(sr,sr,[Sr*(mr[0]-1),Tr*(mr[1]-1),yr]),f.$.exactEquals(mr,f.cl)||f.ae.scale(sr,sr,mr);const Qn=f.ae.multiply([],sr,Mr.matrix),Ls=f.ae.multiply([],ve.expandedFarZProjMatrix,Qn),Cs=f.ae.multiply([],ve.expandedFarZProjMatrix,sr),Wo=f.aB.transformMat4([],[Sr,Tr,yr,1],Ls)[2];Mr.hidden=!1;let fa=et;qe||(wt&&(fa*=au(sr,ve,nr.aabb,Pe)),fa*=fl(Et,Wo)),0!==fa?ci.push({nodeInfo:nr,depth:Wo,opacity:fa,wvpForNode:Ls,wvpForTile:Cs,nodeModelMatrix:Qn,tileModelMatrix:sr}):Mr.hidden=!0}qe||ci.sort((nr,Mr)=>!wt||1===nr.opacity&&1===Mr.opacity?nr.depth<Mr.depth?-1:1:1===nr.opacity?-1:1===Mr.opacity?1:nr.depth>Mr.depth?-1:1);for(const nr of ci){const Mr=nr.nodeInfo,yr=Mr.node;let mr=f.ae.multiply([],Ue,nr.tileModelMatrix);f.ae.multiply(mr,Se,mr);const sr=f.ae.invert([],mr);f.ae.transpose(sr,sr),f.ae.scale(sr,sr,lp),mr=f.ae.multiply(mr,mr,yr.matrix);const Sr="light-beam"===se.renderPass,Tr=Ar&f.cn.HasMapboxMeshFeatures,Qn=Tr?0:Mr.evaluatedRMEA[0][2];for(let Ls=0;Ls<yr.meshes.length;++Ls){const Cs=yr.meshes[Ls],Wo=Ls===yr.lightMeshIndex;let fa=nr.wvpForNode;if(Wo){if(!Sr&&!se.terrain&&se.shadowRenderer){se.currentLayer<se.firstLightBeamLayer&&(se.firstLightBeamLayer=se.currentLayer);continue}fa=nr.wvpForTile}else if(Sr)continue;const Eo={defines:[]},Ba=[];if(lf(Eo.defines,Ba,Cs,se,ae.lut),Tr||Eo.defines.push("DIFFUSE_SHADED"),fr&&Eo.defines.push("SHADOWS_SINGLE_CASCADE"),Qt&&(qe?Qt.numRenderedVerticesInShadowPass+=Cs.vertexArray.length:Qt.numRenderedVerticesInTransparentPass+=Cs.vertexArray.length),qe){Rx(Cs,nr.nodeModelMatrix,se,ae);continue}let qo=null;if(ye){const nt=Vd(nr.nodeModelMatrix,se.transform);if(qo=new Float32Array(nt),"globe"!==ve.projection.name){const eh=Cs.aabb.min,du=Cs.aabb.max,[th,nh]=ye.getOpacityForBounds(nt,eh[0],eh[1],du[0],du[1]);Eo.overrideFog=th>=Qr||nh>=Qr}}const pa=Cs.material;let Gt;pa.occlusionTexture&&pa.occlusionTexture.offsetScale&&(Gt=pa.occlusionTexture.offsetScale,Eo.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!qe&&Ce&&(Ce.useNormalOffset=!!Cs.normalBuffer);const Tn=se.getOrCreateProgram("model",Eo);!qe&&Ce&&Ce.setupShadowsFromMatrix(nr.tileModelMatrix,Tn,Ce.useNormalOffset),se.uploadCommonUniforms(xe,Tn,null,qo);const il=pa.pbrMetallicRoughness;il.metallicFactor=.9,il.roughnessFactor=.5;const Vi=sp(new Float32Array(fa),new Float32Array(mr),new Float32Array(sr),new Float32Array(yr.matrix),se,nr.opacity,il.baseColorFactor.toRenderColor(null),pa.emissiveFactor,il.metallicFactor,il.roughnessFactor,pa,Qn,ae,[0,0,0],Gt);!Wo&&(Mr.hasTranslucentParts||nr.opacity<1)&&Tn.draw(se,xe.gl.TRIANGLES,Fe,f.ah.disabled,f.a.disabled,f.ag.backCCW,Vi,ae.id,Cs.vertexBuffer,Cs.indexBuffer,Cs.segments,ae.paint,se.transform.zoom,void 0,Ba),Tn.draw(se,xe.gl.TRIANGLES,Wo?Mt:Fe,f.ah.disabled,Wo||nr.opacity<1||Mr.hasTranslucentParts?f.a.alphaBlended:f.a.unblended,f.ag.backCCW,Vi,ae.id,Cs.vertexBuffer,Cs.indexBuffer,Cs.segments,ae.paint,se.transform.zoom,void 0,Ba)}}}}()}(y,c,p,v),void F();if("model"!==B.type)return;const j=B.getModels(),Z=[],K=y.transform.getFreeCameraOptions().position,J=f.$.scale([],[K.x,K.y,K.z],y.transform.worldSize);f.$.negate(J,J);const ne=[],re=[];let ie=0;for(const se of j){const ge=p.paint.get("model-rotation").constantOr(null),ae=p.paint.get("model-scale").constantOr(null),ce=p.paint.get("model-translation").constantOr(null);se.computeModelMatrix(y,ge,ae,ce,!0,!0,!1);const xe=f.ae.identity([]),ve=f.ci(se.position.lat,y.transform.zoom),ye=f.ae.fromScaling([],[1,1,1/ve]);f.ae.translate(xe,xe,J),Z.push({zScaleMatrix:ye,negCameraPosMatrix:xe});for(const Ce of se.nodes)Fs(y.transform,Ce,se.matrix,y.transform.expandedFarZProjMatrix,ie,ne,re);ie++}if(ne.sort((se,ge)=>ge.depth-se.depth),"shadow"!==y.renderPass){if(1===w)for(const se of re)Io(se,y,p,Z[se.modelIndex],f.ah.disabled,y.colorModeForRenderPass());else{for(const se of re)Io(se,y,p,Z[se.modelIndex],f.ah.disabled,f.a.disabled);for(const se of re)Io(se,y,p,Z[se.modelIndex],y.stencilModeFor3D(),y.colorModeForRenderPass());y.resetStencilClippingMasks()}for(const se of ne)Io(se,y,p,Z[se.modelIndex],f.ah.disabled,y.colorModeForRenderPass());F()}else{for(const se of re)Rx(se.mesh,se.nodeModelMatrix,y,p);for(const se of ne)Rx(se.mesh,se.nodeModelMatrix,y,p);F()}}},To={model:function(y,c,p){const v=c.getSource();if(!v.loaded())return;if("vector"===v.type||"geojson"===v.type)return void(p.modelManager&&p.modelManager.upload(p,"vector"===v.type?y.scope:""));if("batched-model"===v.type||"model"!==v.type)return;const w=v.getModels();for(const C of w)C.upload(p.context)},raster:function(y,c,p){const v=c.getSource();if(!(v instanceof nf&&v.loaded()))return;const w=y.sourceLayer||v.rasterLayerIds&&v.rasterLayerIds[0];if(!w)return;const C=y.paint.get("raster-array-band")||v.getInitialBand(w);if(null==C)return;const M=c.getIds().map(I=>c.getTileByID(I));for(const I of M)I.updateNeeded(w,C)&&v.prepareTile(I,w,C)},"raster-particle":function(y,c,p){const v=c.getSource();if(!(v instanceof nf&&v.loaded()))return;const w=y.sourceLayer||v.rasterLayerIds&&v.rasterLayerIds[0];if(!w)return;const C=y.paint.get("raster-particle-array-band")||v.getInitialBand(w);if(null==C)return;const M=c.getIds().map(I=>c.getTileByID(I));for(const I of M)I.updateNeeded(w,C)&&v.prepareTile(I,w,C)}};class B1{constructor(c,p,v,w){this.context=new Sd(c,p),this.transform=v,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=f.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const I of C)this._debugParams.enabledLayers[I]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const I of C)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],I);this.occlusionParams=new Er(w),this.setup(),this.numSublayers=f.bx.maxUnderzooming+f.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new f.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new iT(this),this._wireframeDebugCache=new qs,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new f.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new f.T(this.context,M,c.RGBA)}updateTerrain(c,p){const v=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Oa(this,c));const w=this._terrain;this.transform.elevation=v?w:null,w.update(c,this.transform,p),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(c){const p=c.fog;if(!p||"globe"===this.transform.projection.name||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=p.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const C=v+.78*(w-v);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(c){c&&!this._terrain&&(this._terrain=new Oa(this,this.style)),this._forceTerrainMode=c}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(c,p){if(this.width=c*f.e.devicePixelRatio,this.height=p*f.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._mergedLayers[v].resize()}setup(){const c=this.context,p=new f.bv;p.emplaceBack(0,0),p.emplaceBack(f.a4,0),p.emplaceBack(0,f.a4),p.emplaceBack(f.a4,f.a4),this.tileExtentBuffer=c.createVertexBuffer(p,f.bt.members),this.tileExtentSegments=f.b.simpleSegment(0,0,4,2);const v=new f.bv;v.emplaceBack(0,0),v.emplaceBack(f.a4,0),v.emplaceBack(0,f.a4),v.emplaceBack(f.a4,f.a4),this.debugBuffer=c.createVertexBuffer(v,f.bt.members),this.debugSegments=f.b.simpleSegment(0,0,4,5);const w=new f.bv;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(w,f.bt.members),this.viewportSegments=f.b.simpleSegment(0,0,4,2);const C=new f.cq;C.emplaceBack(0,0,0,0),C.emplaceBack(f.a4,0,f.a4,0),C.emplaceBack(0,f.a4,0,f.a4),C.emplaceBack(f.a4,f.a4,f.a4,f.a4),this.mercatorBoundsBuffer=c.createVertexBuffer(C,f.cr.members),this.mercatorBoundsSegments=f.b.simpleSegment(0,0,4,2);const M=new f.bw;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(M);const I=new f.cs;for(const B of[0,1,3,2,0])I.emplaceBack(B);this.debugIndexBuffer=c.createIndexBuffer(I),this.emptyTexture=new f.T(c,new f.j({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=f.ae.create();const F=this.context.gl;this.stencilClearMode=new f.ah({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,c.TRIANGLES,f.af.disabled,this.stencilClearMode,f.a.disabled,f.ag.disabled,s_(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,p,v){if(!p||this.currentStencilSource===p.id||!c.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const F of v)if(void 0===this._tileClippingMaskIDs[F.key]){I=!0;break}if(!I)return}this.currentStencilSource=p.id;const w=this.context,C=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(f.a.disabled),w.setDepthMode(f.af.disabled);const M=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of v){const F=p.getTile(I),B=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:K}=this.getTileBoundsBuffers(F);M.draw(this,C.TRIANGLES,f.af.disabled,new f.ah({func:C.ALWAYS,mask:0},B,255,C.KEEP,C.KEEP,C.REPLACE),f.a.disabled,f.ag.disabled,s_(I.projMatrix),"$clipping",j,Z,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,p=this.context.gl;return new f.ah({func:p.NOTEQUAL,mask:255},c,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const p=this.context.gl;return new f.ah({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(c){const p=this.context.gl,v=c.sort((M,I)=>I.overscaledZ-M.overscaledZ),w=v[v.length-1].overscaledZ,C=v[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const M={};for(let I=0;I<C;I++)M[I+w]=new f.ah({func:p.GEQUAL,mask:255},I+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=C,[M,v]}return[{[w]:f.ah.disabled},v]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new f.a([c.CONSTANT_COLOR,c.ONE,c.CONSTANT_COLOR,c.ONE],new f.C(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.a.unblended:f.a.alphaBlended}colorModeForDrapableLayerRenderPass(c){const p=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&"translucent"===this.renderPass?new f.a([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.CONSTANT_ALPHA,p.ONE_MINUS_SRC_ALPHA],new f.C(0,0,0,void 0===c?0:c),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(c,p,v,w=!1){if(this.depthOcclusion)return new f.af(this.context.gl.GREATER,f.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!w)return f.af.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new f.af(v||this.context.gl.LEQUAL,p,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const c=this.context.gl,p=Math.ceil(this.width),v=Math.ceil(this.height),w=this.context.bindFramebuffer.get(),C=c.getParameter(c.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===p&&this.depthFBO.height===v||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==p&&0!==v&&(this.depthFBO=new Uo(this.context,p,v,!1,"texture"),this.depthTexture=new f.T(this.context,{width:p,height:v,data:null},c.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(w),c.bindTexture(c.TEXTURE_2D,C),this.depthFBO&&(c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.bindFramebuffer(c.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),c.blitFramebuffer(0,0,p,v,0,0,p,v,c.DEPTH_BUFFER_BIT,c.NEAREST),c.bindFramebuffer(c.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((c,p)=>c+p/this._fpsHistory.length,0))}render(c,p){const v=f.e.now();this._dt=v-this._timeStamp,this._timeStamp=v,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=c.map.repaint,this.style=c,this.options=p;const w=this.style._mergedLayers,C=this.style.order.filter(Se=>{const we=w[Se];return!(we.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[we.type]});let M=!1,I=!1;for(const Se of C){const we=w[Se];"circle"===we.type&&(M=!0),"symbol"===we.type&&(we.hasInitialOcclusionOpacityProperties?I=!0:M=!0)}const F=C.map(Se=>w[Se]),B=this.style._mergedSourceCaches;this.imageManager=c.imageManager,this.modelManager=c.modelManager,this.symbolFadeChange=c.placement.symbolFadeChange(f.e.now()),this.imageManager.beginFrame();let j=0,Z=!1;for(const Se in B){const we=B[Se];we.used&&(we.prepare(this.context),we.getSource().usedInConflation&&++j)}let K=!1;for(const Se of F)Se.isHidden(this.transform.zoom)||("clip"===Se.type&&(K=!0),this.prepareLayer(Se));const J={},ne={},re={},ie={},se={};for(const Se in B){const we=B[Se];J[Se]=we.getVisibleCoordinates(),ne[Se]=J[Se].slice().reverse(),re[Se]=we.getVisibleCoordinates(!0).reverse(),ie[Se]=we.getShadowCasterCoordinates(),se[Se]=we.sortCoordinatesByDistance(J[Se])}const ge=Se=>{const we=this.style.getLayerSourceCache(Se);return we&&we.used?we.getSource():null};if(j||K){const Se=[],we=[];let Ue=0;for(const et of F)this.isSourceForClippingOrConflation(et,ge(et))&&(Se.push(et),we.push(Ue)),Ue++;if(Se&&(K||Se.length>1)){const et=[];for(let Fe=0;Fe<Se.length;Fe++){const Mt=Se[Fe],pt=we[Fe],qe=this.style.getLayerSourceCache(Mt);if(!qe||!qe.used||!qe.getSource().usedInConflation&&"clip"!==Mt.type)continue;let at=f.cv,Pe=f.cw.None;const wt=[];if("clip"===Mt.type){at=pt;for(const Et of Mt.layout.get("clip-layer-types"))Pe|="model"===Et?f.cw.Model:"symbol"===Et?f.cw.Symbol:f.cw.FillExtrusion;for(const Et of Mt.layout.get("clip-layer-scope"))wt.push(Et)}et.push({layer:Mt.fqid,cache:qe,order:at,clipMask:Pe,clipScope:wt})}this.replacementSource.setSources(et),Z=!0}}Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Se=0;Se<F.length;Se++){const we=F[Se],Ue=we.cutoffRange();if(this.longestCutoffRange=Math.max(Ue,this.longestCutoffRange),Ue>0){const et=ge(we);et&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom)),we.minzoom&&(this.minCutoffZoom=Math.max(we.minzoom,this.minCutoffZoom))}we.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Se),this._lastOcclusionLayer=Se)}const ae=this.style&&this.style.fog;ae?(this._fogVisible=0!==ae.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(re),this.opaquePassCutoff=0);const ce=this._shadowRenderer;if(ce){ce.updateShadowParameters(this.transform,this.style.directionalLight);for(const Se in B)for(const we of J[Se]){let Ue={min:0,max:0};this.terrain&&(Ue=this.terrain.getMinMaxForTile(we)||Ue),ce.addShadowReceiver(we.toUnwrapped(),Ue.min,Ue.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new zm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!f.cu(this.context.gl))return;this.renderPass="offscreen";for(const Se of F){const we=c.getLayerSourceCache(Se);if(!Se.hasOffscreenPass()||Se.isHidden(this.transform.zoom))continue;const Ue=we?ne[we.id]:void 0;("custom"===Se.type||"raster"===Se.type||"raster-particle"===Se.type||Se.isSky()||Ue&&Ue.length)&&this.renderLayer(this,we,Se,Ue)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const xe="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),ve=(()=>{if(p.showOverdrawInspector)return f.C.black;const Se=this.style.fog;if(Se&&this.transform.projection.supportsFog){const we=this.style.getLut(Se.scope);if(!xe){const Ue=Se.properties.get("color").toRenderColor(we).toArray01();return new f.C(...Ue)}if(xe){const Ue=Se.properties.get("space-color").toRenderColor(we).toArray01();return new f.C(...Ue)}}return f.C.transparent})();if(this.context.clear({color:ve,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const Se=F[this.currentLayer],we=c.getLayerSourceCache(Se);if(Se.isSky())continue;const Ue=we?(Se.is3D()?se:ne)[we.id]:void 0;this._renderTileClippingMasks(Se,we,Ue),this.renderLayer(this,we,Se,Ue)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||f.a2(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Se=F[this.currentLayer],we=c.getLayerSourceCache(Se);Se.isSky()&&this.renderLayer(this,we,Se,we?ne[we.id]:void 0)}function ye(Se,we){let Ue;return we&&(Ue=("symbol"===Se.type?re:Se.is3D()?se:ne)[we.id]),Ue}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const Se=F[this.currentLayer];if("raster"===Se.type||"raster-particle"===Se.type){const we=c.getLayerSourceCache(Se);this.renderLayer(this,we,Se,ye(Se,we))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ce=0;ce&&(Ce=ce.getShadowCastingLayerCount());let Me=!1,Le=-1;for(let Se=0;Se<C.length;++Se){const we=F[Se];we.isHidden(this.transform.zoom)||we.is3D()&&(Le=Se)}for(I&&-1===Le&&(M=!0);this.currentLayer<C.length;){const Se=F[this.currentLayer],we=c.getLayerSourceCache(Se);if(Se.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Se)){if(Se.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(M&&!Me&&this.terrain&&!this.transform.isOrthographic&&(Me=!0,this.blitDepth()),I&&-1!==Le&&this.currentLayer===Le+1&&!this.transform.isOrthographic&&this.blitDepth(),Se.is3D()||this.terrain||this._renderTileClippingMasks(Se,we,we?J[we.id]:void 0),this.renderLayer(this,we,Se,ye(Se,we)),!this.terrain&&ce&&Ce>0&&Se.hasShadowPass()&&0==--Ce&&(ce.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ue=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ue;this.currentLayer++){const et=F[this.currentLayer];if(!et.hasLightBeamPass())continue;const Fe=c.getLayerSourceCache(et);this.renderLayer(this,Fe,et,Fe?ne[Fe.id]:void 0)}this.currentLayer=Ue,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ue=this.currentLayer;this.depthOcclusion=!0;for(const et of this.layersWithOcclusionOpacity){this.currentLayer=et;const Fe=F[this.currentLayer],Mt=c.getLayerSourceCache(Fe),pt=Mt?ne[Mt.id]:void 0;Fe.is3D()||this.terrain||this._renderTileClippingMasks(Fe,Mt,Mt?J[Mt.id]:void 0),this.renderLayer(this,Mt,Fe,pt)}this.depthOcclusion=!1,this.currentLayer=Ue,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Se=null;F.forEach(we=>{const Ue=c.getLayerSourceCache(we);Ue&&!we.isHidden(this.transform.zoom)&&Ue.getVisibleCoordinates().length&&(!Se||Se.getSource().maxzoom<Ue.getSource().maxzoom)&&(Se=Ue)}),Se&&this.options.showTileBoundaries&&li.debug(this,Se,Se.getVisibleCoordinates(),f.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&li.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new f.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Se){const we=Se.transform.padding;op(Se,Se.transform.height-(we.top||0),3,Ox),op(Se,we.bottom||0,3,L1),Bm(Se,we.left||0,3,Px),Bm(Se,Se.transform.width-(we.right||0),3,It);const Ue=Se.transform.centerPoint;var et,Fe,Mt,pt;af(et=Se,(Fe=Ue.x)-1,(Mt=Se.transform.height-Ue.y)-10,2,20,pt=ND),af(et,Fe-10,Mt-1,20,2,pt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(c){this.gpuTimingStart(c);const{unsupportedLayers:p}=this.transform.projection,v=!p||!p.includes(c.type);if(To[c.type]&&(v||this.terrain&&"custom"===c.type)){const w=this.style.getLayerSourceCache(c);To[c.type](c,w,this)}this.gpuTimingEnd()}renderLayer(c,p,v,w){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||"model"===v.type||"raster"===v.type||"raster-particle"===v.type||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes(v.type)&&(!c.terrain||"custom"!==v.type)||"clip"===v.type||li[v.type](c,p,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery,v=this.context.gl;let w=this.gpuTimers[c.id];w||(w=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:v.createQuery()}),w.calls++,v.beginQuery(p.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,p=this.context.gl,v=p.createQuery();this.deferredRenderGpuTimeQueries.push(v),p.beginQuery(c.TIME_ELAPSED_EXT,v)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const p={};for(const v in c){const w=c[v],C=this.context.extTimerQuery,M=C.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;C.deleteQueryEXT(w.query),p[v]=M}return p}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.extTimerQuery,v=this.context.gl;let w=0;for(const C of c)w+=p.getQueryParameter(C,v.QUERY_RESULT)/1e6,p.deleteQueryEXT(C);return w}translatePosMatrix(c,p,v,w,C){if(!v[0]&&!v[1])return c;const M=C?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(M){const B=Math.sin(M),j=Math.cos(M);v=[v[0]*j-v[1]*B,v[0]*B+v[1]*j]}const I=[C?v[0]:f.bD(p,v[0],this.transform.zoom),C?v[1]:f.bD(p,v[1],this.transform.zoom),0],F=new Float32Array(16);return f.ae.translate(F,c,I),F}saveTileTexture(c){const p=c.size[0],v=this._tileTextures[p];v?v.push(c):this._tileTextures[p]=[c]}getTileTexture(c){const p=this._tileTextures[c];return p&&p.length>0?p.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(c,p,v){const w=void 0===v?this.terrain&&this.terrain.renderingToTexture:v,C=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===c||"terrainRaster"===c?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||C.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||C.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?C.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):C.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&C.push("GLOBE"),!this._fogVisible||w||void 0!==p&&!p||C.push("FOG","FOG_DITHERING"),w&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(c,p){this.cache=this.cache||{};const v=p&&p.defines||[],w=p&&p.config,C=this.currentGlobalDefines(c,p&&p.overrideFog,p&&p.overrideRtt).concat(v),M=D1.cacheKey(yx[c],c,C,w);return this.cache[M]||(this.cache[M]=new D1(this.context,c,yx[c],w,ts[c],C)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(c,p){if(this.style.enable3dLights()){const v=this.style.directionalLight,w=this.style.ambientLight;if(v&&w){const C=((M,I,F)=>{const B=M.properties.get("direction"),j=M.properties.get("color").toRenderColor(F.getLut(M.scope)).toArray01(),Z=M.properties.get("intensity"),K=I.properties.get("color").toRenderColor(F.getLut(I.scope)).toArray01(),J=I.properties.get("intensity"),ne=[B.x,B.y,B.z],re=f.bC(K,J),ie=f.bC(j,Z);return{u_lighting_ambient_color:re,u_lighting_directional_dir:ne,u_lighting_directional_color:ie,u_ground_radiance:sT(ne,ie,re)}})(v,w,this.style);p.setLightsUniformValues(c,C)}}}uploadCommonUniforms(c,p,v,w,C){if(this.uploadCommonLightUniforms(c,p),this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const I=M.getOpacity(this.transform.pitch),F=((B,j,Z,K,J,ne,re,ie,se,ge,ae,ce)=>{const xe=B.transform,ve=j.properties.get("color").toRenderColor(B.style.getLut(j.scope)).toArray01();ve[3]=K;const ye=B.frameCounter/1e3%1,[Ce,Me]=j.properties.get("vertical-range");return{u_fog_matrix:Z?xe.calculateFogTileMatrix(Z):ce||B.identityMat,u_fog_range:j.getFovAdjustedRange(xe._fov),u_fog_color:ve,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ce,Me),Me],u_fog_temporal_offset:ye,u_frustum_tl:J,u_frustum_tr:ne,u_frustum_br:re,u_frustum_bl:ie,u_globe_pos:se,u_globe_radius:ge,u_viewport:ae,u_globe_transition:f.a2(xe.zoom),u_is_globe:+("globe"===xe.projection.name)}})(this,M,v,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*f.e.devicePixelRatio,this.transform.height*f.e.devicePixelRatio],w);p.setFogUniformValues(c,F)}C&&p.setCutoffUniformValues(c,C.uniformValues)}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,p=c.createTexture();return c.bindTexture(c.TEXTURE_2D,p),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,p=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)p[w.key]=c[w.key]||new f.bA(w,512,this.transform.tileZoom,this);return p}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(c,p){return!(!c.is3D()||c.minzoom&&c.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||"building"!==c.sourceLayer)&&"clip"!==c.type&&(!p||"batched-model"!==p.type))}isTileAffectedByFog(c){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let p=this._cachedTileFogOpacities[c.key];return p||(this._cachedTileFogOpacities[c.key]=p=this.style.fog.getOpacityForTile(c)),p[0]>=Qr||p[1]>=Qr}setupDepthForOcclusion(c,p,v){const w=this.context,C=w.gl,M=!!v;var I;v||(v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),w.activeTexture.set(C.TEXTURE3),c&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),v.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],v.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],v.u_occluder_half_size=.5*this.occlusionParams.occluderSize,v.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),w.activeTexture.set(C.TEXTURE0),M||p.setTerrainUniformValues(w,v)}}class $l{constructor(c,p,v,w){this.screenBounds=c,this.cameraPoint=p,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(c,p){let v,w;if(c instanceof f.P||"number"==typeof c[0]){const C=f.P.convert(c);v=[C],w=p.isPointAboveHorizon(C)}else{const C=f.P.convert(c[0]),M=f.P.convert(c[1]);v=[C,M],w=f.cx(C,M).every(I=>p.isPointAboveHorizon(I))}return new $l(v,p.getCameraPoint(),w,p)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return f.cx(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const p=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new f.P(1,1)):this.screenBounds[1],w=f.cx(p,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(w[3]=this.cameraPoint)),f.cy(w,c)}bufferedCameraGeometryGlobe(c){const p=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new f.P(1,1)):this.screenBounds[1],w=f.cx(p,v,c),C=this.cameraPoint.clone();switch(3*((C.y>p.y)+(C.y>v.y))+((C.x>p.x)+(C.x>v.x))){case 0:w[0]=C,w[4]=C.clone();break;case 1:w.splice(1,0,C);break;case 2:w[1]=C;break;case 3:w.splice(4,0,C);break;case 5:w.splice(2,0,C);break;case 6:w[3]=C;break;case 7:w.splice(3,0,C);break;case 8:w[2]=C}return w}containsTile(c,p,v,w=0){const C=c.queryPadding/p._pixelsPerMercatorPixel+1,M=v?this._bufferedCameraMercator(C,p):this._bufferedScreenMercator(C,p);let I=c.tileID.wrap+(M.unwrapped?w:0);const F=M.polygon.map(ie=>f.cz(c.tileTransform,ie,I));if(!f.cA(F,0,0,f.a4,f.a4))return;I=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const B=this.screenGeometryMercator.polygon.map(ie=>f.cB(c.tileTransform,ie,I)),j=B.map(ie=>new f.P(ie[0],ie[1])),Z=p.getFreeCameraOptions().position||new f._(0,0,0),K=f.cB(c.tileTransform,Z,I),J=B.map(ie=>{const se=f.$.sub(ie,ie,K);return f.$.normalize(se,se),new f.aU(K,se)}),ne=f.bD(c,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:J,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(re=f.cC(F),re.min.x=f.au(re.min.x,0,f.a4),re.min.y=f.au(re.min.y,0,f.a4),re.max.x=f.au(re.max.x,0,f.a4),re.max.y=f.au(re.max.y,0,f.a4),re),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:ne};var re}_bufferedScreenMercator(c,p){const v=cu(c);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w="globe"===p.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),p):{polygon:this.bufferedScreenGeometry(c).map(C=>p.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(c,p){const v=cu(c);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w="globe"===p.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),p):{polygon:this.bufferedCameraGeometry(c).map(C=>p.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(c,p){const v=function(C,M){const I=f.ae.multiply([],M.pixelMatrix,M.globeMatrix),F=[0,-f.cF,0,1],B=[0,f.cF,0,1],j=[0,0,0,1];f.aB.transformMat4(F,F,I),f.aB.transformMat4(B,B,I),f.aB.transformMat4(j,j,I);const Z=new f.P(F[0]/F[3],F[1]/F[3]),K=new f.P(B[0]/B[3],B[1]/B[3]),J=f.cD(C,Z)&&F[3]<j[3],ne=f.cD(C,K)&&B[3]<j[3];if(!J&&!ne)return null;const re=function(ye,Ce,Me){for(let Le=1;Le<ye.length;Le++){const Se=Wu(Ce.pointCoordinate3D(ye[Le-1]).x),we=Wu(Ce.pointCoordinate3D(ye[Le]).x);if(Me<0){if(Se<we)return{idx:Le,t:-Se/(we-1-Se)}}else if(we<Se)return{idx:Le,t:(1-Se)/(we+1-Se)}}return null}(C,M,J?-1:1);if(!re)return null;const{idx:ie,t:se}=re;let ge=ie>1?cp(C.slice(0,ie),M):[],ae=ie<C.length?cp(C.slice(ie),M):[];ge=ge.map(ye=>new f.P(Wu(ye.x),ye.y)),ae=ae.map(ye=>new f.P(Wu(ye.x),ye.y));const ce=[...ge];0===ce.length&&ce.push(ae[ae.length-1]);const xe=f.a3(ce[ce.length-1].y,(0===ae.length?ge[0]:ae[0]).y,se);let ve;return ve=J?[new f.P(0,xe),new f.P(0,0),new f.P(1,0),new f.P(1,xe)]:[new f.P(1,xe),new f.P(1,1),new f.P(0,1),new f.P(0,xe)],ce.push(...ve),0===ae.length?ce.push(ge[0]):ce.push(...ae),{polygon:ce.map(ye=>new f._(ye.x,ye.y)),unwrapped:!1}}(c,p);if(v)return v;const w=function(C,M){let I=!1,F=-1/0,B=0;for(let Z=0;Z<C.length-1;Z++)C[Z].x>F&&(F=C[Z].x,B=Z);for(let Z=0;Z<C.length-1;Z++){const K=(B+Z)%(C.length-1),J=C[K],ne=C[K+1];Math.abs(J.x-ne.x)>.5&&(J.x<ne.x?(J.x+=1,0===K&&(C[C.length-1].x+=1)):(ne.x+=1,K+1===C.length-1&&(C[0].x+=1)),I=!0)}const j=f.ak(M.center.lng);return I&&j<Math.abs(j-1)&&C.forEach(Z=>{Z.x-=1}),{polygon:C,unwrapped:I}}(cp(c,p).map(C=>new f.P(Wu(C.x),C.y)),p);return{polygon:w.polygon.map(C=>new f._(C.x,C.y)),unwrapped:w.unwrapped}}}function cp(y,c){return f.cE(y,p=>{const v=c.pointCoordinate3D(p);p.x=v.x,p.y=v.y},1/256)}function Wu(y){return y<0?1+y%1:y%1}function cu(y){return 100*y|0}function wi(y,c){const p=f.ae.identity([]);return f.ae.scale(p,p,[.5*y.width,.5*-y.height,1]),f.ae.translate(p,p,[1,-1,0]),f.ae.multiply(p,p,y.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(p)}function Lc(y,c,p,v,w,C,M,I=!1){const F=y.tilesIn(v,M,I);F.sort(Ra);const B=[];for(const Z of F)B.push({wrappedTileID:Z.tile.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(c,p,y._state,Z,w,C,wi(y.transform,Z.tile.tileID),I)});const j=function(Z){const K={},J={};for(const ne of Z){const re=ne.queryResults,ie=ne.wrappedTileID,se=J[ie]=J[ie]||{};for(const ge in re){const ae=re[ge],ce=se[ge]=se[ge]||{},xe=K[ge]=K[ge]||[];for(const ve of ae)ce[ve.featureIndex]||(ce[ve.featureIndex]=!0,xe.push(ve))}}return K}(B);for(const Z in j)j[Z].forEach(K=>{const J=K.feature,ne=J.layer;ne&&"background"!==ne.type&&"sky"!==ne.type&&"slot"!==ne.type&&(J.source=ne.source,ne["source-layer"]&&(J.sourceLayer=ne["source-layer"]),J.state=void 0!==J.id?y.getFeatureState(ne["source-layer"],J.id):{})});return j}function Nx(y,c){const p=y.getRenderableIds().map(C=>y.getTileByID(C)),v=[],w={};for(let C=0;C<p.length;C++){const M=p[C],I=M.tileID.canonical.key;w[I]||(w[I]=!0,M.querySourceFeatures(v,c))}return v}function Ra(y,c){const p=y.tileID,v=c.tileID;return p.overscaledZ-v.overscaledZ||p.canonical.y-v.canonical.y||p.wrap-v.wrap||p.canonical.x-v.canonical.x}class tl{constructor(c){this.style=c,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const c=!1,p=!1;for(const v in this.style._mergedLayers){const w=this.style._mergedLayers[v];if("fill-extrusion"===w.type)this.layers.push({layer:w,visible:c,visibilityChanged:p});else if("model"===w.type){const C=this.style.getLayerSource(w);C&&"batched-model"===C.type&&this.layers.push({layer:w,visible:c,visibilityChanged:p})}}}onNewFrame(c){this.layersGotHidden=!1;for(const p of this.layers){const v=p.layer;let w=!1;"fill-extrusion"===v.type?w=!v.isHidden(c)&&v.paint.get("fill-extrusion-opacity")>0:"model"===v.type&&(w=!v.isHidden(c)&&v.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!w&&p.visible,p.visible=w}}updateZOffset(c,p){this.currentBuildingBuckets=[];for(const w of this.layers){const C=w.layer,M=this.style.getLayerSourceCache(C);let I=1;"fill-extrusion"===C.type&&(I=w.visible?C.paint.get("fill-extrusion-vertical-scale"):0);let F=M?M.getTile(p):null;if(!F&&M&&p.canonical.z>M.getSource().minzoom){let B=p.scaledTo(Math.min(M.getSource().maxzoom,p.overscaledZ-1));for(;B.overscaledZ>=M.getSource().minzoom&&(F=M.getTile(B),!F&&0!==B.overscaledZ);)B=B.scaledTo(B.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:F?F.getBucket(C):null,tileID:F?F.tileID:p,verticalScale:I})}c.hasAnyZOffset=!1;let v=!1;for(let w=0;w<c.symbolInstances.length;w++){const C=c.symbolInstances.get(w),M=C.zOffset,I=this._getHeightAtTileOffset(p,C.tileAnchorX,C.tileAnchorY);C.zOffset=I!==Number.NEGATIVE_INFINITY?I:M,v||M===C.zOffset||(v=!0),c.hasAnyZOffset||0===C.zOffset||(c.hasAnyZOffset=!0)}v&&(c.zOffsetBuffersNeedUpload=!0,c.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(c,p,v,w){let C=p,M=v;if(c.canonical.z!==w.canonical.z){const I=w.canonical,F=1/(1<<c.canonical.z-I.z);C=(p+c.canonical.x*f.a4)*F-I.x*f.a4|0,M=(v+c.canonical.y*f.a4)*F-I.y*f.a4|0}return{tileX:C,tileY:M}}_getHeightAtTileOffset(c,p,v){let w,C;for(let M=0;M<this.layers.length;++M){if("fill-extrusion"!==this.layers[M].layer.type)continue;const{bucket:I,tileID:F,verticalScale:B}=this.currentBuildingBuckets[M];if(!I)continue;const{tileX:j,tileY:Z}=this._mapCoordToOverlappingTile(c,p,v,F),K=I.getHeightAtTileCoord(j,Z);K&&void 0!==K.height&&(K.hidden?w=K.height:C=Math.max(K.height*B,C||0))}if(void 0!==C)return C;for(let M=0;M<this.layers.length;++M){const I=this.layers[M];if("model"!==I.layer.type||!I.visible)continue;const{bucket:F,tileID:B}=this.currentBuildingBuckets[M];if(!F)continue;const{tileX:j,tileY:Z}=this._mapCoordToOverlappingTile(c,p,v,B),K=F.getHeightAtTileCoord(j,Z);if(K&&!K.hidden)return void 0===K.height&&void 0!==w?Math.min(K.maxHeight,w)*K.verticalScale:K.height?K.height*K.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function FD(y,c){const p={};for(const v in y)"ref"!==v&&(p[v]=y[v]);return f.cG.forEach(v=>{v in c&&(p[v]=c[v])}),p}function __(y){y=y.slice();const c=Object.create(null);for(let p=0;p<y.length;p++)c[y[p].id]=y[p];for(let p=0;p<y.length;p++)"ref"in y[p]&&(y[p]=FD(y[p],c[y[p].ref]));return y}const Vr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function $d(y,c,p){p.push({command:Vr.addSource,args:[y,c[y]]})}function Um(y,c,p){c.push({command:Vr.removeSource,args:[y]}),p[y]=!0}function cT(y,c,p,v){Um(y,p,v),$d(y,c,p)}function Vm(y,c,p){let v;for(v in y[p])if(y[p].hasOwnProperty(v)&&"data"!==v&&!f.d(y[p][v],c[p][v]))return!1;for(v in c[p])if(c[p].hasOwnProperty(v)&&"data"!==v&&!f.d(y[p][v],c[p][v]))return!1;return!0}function Hd(y,c,p,v,w,C){let M;for(M in c=c||{},y=y||{})y.hasOwnProperty(M)&&(f.d(y[M],c[M])||p.push({command:C,args:[v,M,c[M],w]}));for(M in c)c.hasOwnProperty(M)&&!y.hasOwnProperty(M)&&(f.d(y[M],c[M])||p.push({command:C,args:[v,M,c[M],w]}))}function jm(y){return y.id}function pl(y,c){return y[c.id]=c,y}class Fx{constructor(c,p){this.reset(c,p)}reset(c,p){this.points=c||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=f.au(c,0,1);let p=1,v=this._distances[p];const w=c*this.paddedLength+this.padding;for(;v<w&&p<this._distances.length;)v=this._distances[++p];const C=p-1,M=this._distances[C],I=v-M,F=I>0?(w-M)/I:0;return this.points[C].mult(1-F).add(this.points[p].mult(F))}}class ac{constructor(c,p,v){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/v),this.yCellCount=Math.ceil(p/v);for(let M=0;M<this.xCellCount*this.yCellCount;M++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=p,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,p,v,w,C){this._forEachCell(p,v,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(c,p,v,w){this._forEachCell(p-w,v-w,p+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(p),this.circles.push(v),this.circles.push(w)}_insertBoxCell(c,p,v,w,C,M){this.boxCells[C].push(M)}_insertCircleCell(c,p,v,w,C,M){this.circleCells[C].push(M)}_query(c,p,v,w,C,M){if(v<0||c>this.width||w<0||p>this.height)return!C&&[];const I=[];if(c<=0&&p<=0&&this.width<=v&&this.height<=w){if(C)return!0;for(let F=0;F<this.boxKeys.length;F++)I.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const B=this.circles[3*F],j=this.circles[3*F+1],Z=this.circles[3*F+2];I.push({key:this.circleKeys[F],x1:B-Z,y1:j-Z,x2:B+Z,y2:j+Z})}return M?I.filter(M):I}return this._forEachCell(c,p,v,w,this._queryCell,I,{hitTest:C,seenUids:{box:{},circle:{}}},M),C?I.length>0:I}_queryCircle(c,p,v,w,C){const M=c-v,I=c+v,F=p-v,B=p+v;if(I<0||M>this.width||B<0||F>this.height)return!w&&[];const j=[];return this._forEachCell(M,F,I,B,this._queryCellCircle,j,{hitTest:w,circle:{x:c,y:p,radius:v},seenUids:{box:{},circle:{}}},C),w?j.length>0:j}query(c,p,v,w,C){return this._query(c,p,v,w,!1,C)}hitTest(c,p,v,w,C){return this._query(c,p,v,w,!0,C)}hitTestCircle(c,p,v,w){return this._queryCircle(c,p,v,!0,w)}_queryCell(c,p,v,w,C,M,I,F){const B=I.seenUids,j=this.boxCells[C];if(null!==j){const K=this.bboxes;for(const J of j)if(!B.box[J]){B.box[J]=!0;const ne=4*J;if(c<=K[ne+2]&&p<=K[ne+3]&&v>=K[ne+0]&&w>=K[ne+1]&&(!F||F(this.boxKeys[J]))){if(I.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[J],x1:K[ne],y1:K[ne+1],x2:K[ne+2],y2:K[ne+3]})}}}const Z=this.circleCells[C];if(null!==Z){const K=this.circles;for(const J of Z)if(!B.circle[J]){B.circle[J]=!0;const ne=3*J;if(this._circleAndRectCollide(K[ne],K[ne+1],K[ne+2],c,p,v,w)&&(!F||F(this.circleKeys[J]))){if(I.hitTest)return M.push(!0),!0;{const re=K[ne],ie=K[ne+1],se=K[ne+2];M.push({key:this.circleKeys[J],x1:re-se,y1:ie-se,x2:re+se,y2:ie+se})}}}}}_queryCellCircle(c,p,v,w,C,M,I,F){const B=I.circle,j=I.seenUids,Z=this.boxCells[C];if(null!==Z){const J=this.bboxes;for(const ne of Z)if(!j.box[ne]){j.box[ne]=!0;const re=4*ne;if(this._circleAndRectCollide(B.x,B.y,B.radius,J[re+0],J[re+1],J[re+2],J[re+3])&&(!F||F(this.boxKeys[ne])))return M.push(!0),!0}}const K=this.circleCells[C];if(null!==K){const J=this.circles;for(const ne of K)if(!j.circle[ne]){j.circle[ne]=!0;const re=3*ne;if(this._circlesCollide(J[re],J[re+1],J[re+2],B.x,B.y,B.radius)&&(!F||F(this.circleKeys[ne])))return M.push(!0),!0}}}_forEachCell(c,p,v,w,C,M,I,F){const B=this._convertToXCellCoord(c),j=this._convertToYCellCoord(p),Z=this._convertToXCellCoord(v),K=this._convertToYCellCoord(w);for(let J=B;J<=Z;J++)for(let ne=j;ne<=K;ne++)if(C.call(this,c,p,v,w,this.xCellCount*ne+J,M,I,F))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,p,v,w,C,M){const I=w-c,F=C-p,B=v+M;return B*B>I*I+F*F}_circleAndRectCollide(c,p,v,w,C,M,I){const F=(M-w)/2,B=Math.abs(c-(w+F));if(B>F+v)return!1;const j=(I-C)/2,Z=Math.abs(p-(C+j));if(Z>j+v)return!1;if(B<=F||Z<=j)return!0;const K=B-F,J=Z-j;return K*K+J*J<=v*v}}const ua=100;class $n{constructor(c,p,v=new ac(c.width+200,c.height+200,25),w=new ac(c.width+200,c.height+200,25)){this.transform=c,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+ua,this.screenBottomBoundary=c.height+ua,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=p}placeCollisionBox(c,p,v,w,C,M,I,F){let B=v.projectedAnchorX,j=v.projectedAnchorY,Z=v.projectedAnchorZ;const K=v.elevation,J=v.tileID,ne=c.getProjection();if(K&&J){const[ve,ye,Ce]=ne.upVector(J.canonical,v.tileAnchorX,v.tileAnchorY),Me=ne.upVectorScale(J.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=ve*K*Me,j+=ye*K*Me,Z+=Ce*K*Me}const re=this.projectAndGetPerspectiveRatio(I,B,j,Z,v.tileID,"globe"===ne.name||!!K||this.transform.pitch>0,ne),ie=M*re.perspectiveRatio,se=(v.x1*p+w.x-v.padding)*ie+re.point.x,ge=(v.y1*p+w.y-v.padding)*ie+re.point.y,ae=(v.x2*p+w.x+v.padding)*ie+re.point.x,ce=(v.y2*p+w.y+v.padding)*ie+re.point.y,xe=re.perspectiveRatio<=.55||re.occluded;return!this.isInsideGrid(se,ge,ae,ce)||!C&&this.grid.hitTest(se,ge,ae,ce,F)||xe?{box:[],offscreen:!1,occluded:re.occluded}:{box:[se,ge,ae,ce],offscreen:this.isOffscreen(se,ge,ae,ce),occluded:!1}}placeCollisionCircles(c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re){const ie=[],se=this.transform.elevation,ge=c.getProjection(),ae=se?se.getAtTileOffsetFunc(re,this.transform.center.lat,this.transform.worldSize,ge):null,ce=new f.P(v.tileAnchorX,v.tileAnchorY);let{x:xe,y:ve,z:ye}=ge.projectTilePoint(ce.x,ce.y,re.canonical);if(ae){const[pt,qe,at]=ae(ce);xe+=pt,ve+=qe,ye+=at}const Ce="globe"===ge.name,Me=this.projectAndGetPerspectiveRatio(I,xe,ve,ye,re,Ce||!!se||this.transform.pitch>0,ge),{perspectiveRatio:Le}=Me,Se=(Z?M/Le:M*Le)/f.bP,we=Pc(xe,ve,ye,F),Ue=Me.signedDistanceFromCamera>0?ef(Se,C,v.lineOffsetX*Se,v.lineOffsetY*Se,!1,we,ce,v,w,F,{},se&&!Z?ae:null,Z&&!!se,ge,re,Z):null;let et=!1,Fe=!1,Mt=!0;if(Ue&&!Me.occluded){const pt=.5*J*Le+ne,qe=new f.P(-100,-100),at=new f.P(this.screenRightBoundary,this.screenBottomBoundary),Pe=new Fx,{first:wt,last:Et}=Ue,Qt=wt.path.length;let sn=[];for(let Bn=Qt-1;Bn>=1;Bn--)sn.push(wt.path[Bn]);for(let Bn=1;Bn<Et.path.length;Bn++)sn.push(Et.path[Bn]);const fn=2.5*pt;B&&(sn=sn.map(([Bn,tr,Pn],fr)=>(ae&&!Ce&&(Pn=ae(fr<Qt-1?wt.tilePath[Qt-1-fr]:Et.tilePath[fr-Qt+2])[2]),Pc(Bn,tr,Pn,B))),sn.some(Bn=>Bn[3]<=0)&&(sn=[]));let xt=[];if(sn.length>0){let Bn=1/0,tr=-1/0,Pn=1/0,fr=-1/0;for(const Cr of sn)Bn=Math.min(Bn,Cr[0]),Pn=Math.min(Pn,Cr[1]),tr=Math.max(tr,Cr[0]),fr=Math.max(fr,Cr[1]);tr>=qe.x&&Bn<=at.x&&fr>=qe.y&&Pn<=at.y&&(xt=[sn.map(Cr=>new f.P(Cr[0],Cr[1]))],(Bn<qe.x||tr>at.x||Pn<qe.y||fr>at.y)&&(xt=f.cH(xt,qe.x,qe.y,at.x,at.y)))}for(const Bn of xt){Pe.reset(Bn,.25*pt);let tr=0;tr=Pe.length<=.5*pt?1:Math.ceil(Pe.paddedLength/fn)+1;for(let Pn=0;Pn<tr;Pn++){const fr=Pn/Math.max(tr-1,1),Cr=Pe.lerp(fr),Ar=Cr.x+ua,ci=Cr.y+ua;ie.push(Ar,ci,pt,0);const nr=Ar-pt,Mr=ci-pt,yr=Ar+pt,mr=ci+pt;if(Mt=Mt&&this.isOffscreen(nr,Mr,yr,mr),Fe=Fe||this.isInsideGrid(nr,Mr,yr,mr),!p&&this.grid.hitTestCircle(Ar,ci,pt,K)&&(et=!0,!j))return{circles:[],offscreen:!1,collisionDetected:et,occluded:!1}}}}return{circles:!j&&et||!Fe?[]:ie,offscreen:Mt,collisionDetected:et,occluded:Me.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const p=[];let v=1/0,w=1/0,C=-1/0,M=-1/0;for(const j of c){const Z=new f.P(j.x+ua,j.y+ua);v=Math.min(v,Z.x),w=Math.min(w,Z.y),C=Math.max(C,Z.x),M=Math.max(M,Z.y),p.push(Z)}const I=this.grid.query(v,w,C,M).concat(this.ignoredGrid.query(v,w,C,M)),F={},B={};for(const j of I){const Z=j.key;if(void 0===F[Z.bucketInstanceId]&&(F[Z.bucketInstanceId]={}),F[Z.bucketInstanceId][Z.featureIndex])continue;const K=[new f.P(j.x1,j.y1),new f.P(j.x2,j.y1),new f.P(j.x2,j.y2),new f.P(j.x1,j.y2)];f.cI(p,K)&&(F[Z.bucketInstanceId][Z.featureIndex]=!0,void 0===B[Z.bucketInstanceId]&&(B[Z.bucketInstanceId]=[]),B[Z.bucketInstanceId].push(Z.featureIndex))}return B}insertCollisionBox(c,p,v,w,C){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:C},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,p,v,w,C){const M=p?this.ignoredGrid:this.grid,I={bucketInstanceId:v,featureIndex:w,collisionGroupID:C};for(let F=0;F<c.length;F+=4)M.insertCircle(I,c[F],c[F+1],c[F+2])}projectAndGetPerspectiveRatio(c,p,v,w,C,M,I){const F=[p,v,w,1];let B=!1;w||this.transform.pitch>0?(f.aB.transformMat4(F,F,c),this.fogState&&C&&"globe"!==I.name&&(B=function(K,J,ne,re,ie,se){const ge=se.calculateFogTileMatrix(ie),ae=[J,ne,re];return f.$.transformMat4(ae,ae,ge),Wr(K,f.$.length(ae),se.pitch,se._fov)}(this.fogState,p,v,w,C.toUnwrapped(),this.transform)>.9)):n_(F,F,c);const j=F[3];return{point:new f.P((F[0]/j+1)/2*this.transform.width+ua,(-F[1]/j+1)/2*this.transform.height+ua),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/j*.5,1.5),signedDistanceFromCamera:j,occluded:M&&F[2]>j||B}}isOffscreen(c,p,v,w){return v<ua||c>=this.screenRightBoundary||w<ua||p>this.screenBottomBoundary}isInsideGrid(c,p,v,w){return v>=0&&c<this.gridRightBoundary&&w>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const c=f.ae.identity([]);return f.ae.translate(c,c,[-100,-100,0]),c}}class z1{constructor(c,p,v,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?p:-p))):w&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class Qe{constructor(c,p,v,w,C,M=!1){this.text=new z1(c?c.text:null,p,v,C),this.icon=new z1(c?c.icon:null,p,w,C),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class uf{constructor(c,p,v,w=!1){this.text=c,this.icon=p,this.skipFade=v,this.clipped=w}}class U1{constructor(){this.invProjMatrix=f.ae.create(),this.viewportMatrix=f.ae.create(),this.circles=[]}}class df{constructor(c,p,v,w,C){this.bucketInstanceId=c,this.featureIndex=p,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=C}}class Lx{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const p=++this.maxGroupID;this.collisionGroups[c]={ID:p,predicate:v=>v.collisionGroupID===p}}return this.collisionGroups[c]}}function V1(y,c,p,v,w){const{horizontalAlign:C,verticalAlign:M}=f.bS(y),I=-(C-.5)*c,F=-(M-.5)*p,B=f.bR(y,v);return new f.P(I+B[0]*w,F+B[1]*w)}function y_(y,c,p,v,w){const C=new f.P(y,c);return p&&C._rotate(v?w:-w),C}class Bx{constructor(c,p,v,w,C,M){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new $n(this.transform,C),this.buildingIndex=M,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Lx(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,p,v,w){const C=v.getBucket(p),M=v.latestFeatureIndex;if(!C||!M||p.fqid!==C.layerIds[0])return;const I=C.layers[0].layout,F=v.collisionBoxArray,B=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),j=v.tileSize/f.a4,Z=v.tileID.toUnwrapped();this.transform.setProjection(C.projection);const K=(J=v.tileID,ne=C.getProjection(),re=this.transform,ne.name===this.projection?re.calculateProjMatrix(J.toUnwrapped()):sf(re,ne,J));var J,ne,re;const ie="map"===I.get("text-pitch-alignment"),se="map"===I.get("text-rotation-alignment");p.compileFilter();const ge=p.dynamicFilter(),ae=p.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(v),xe=Tm(K,v.tileID.canonical,ie,se,this.transform,C.getProjection(),ce);let ve=null;if(ie){const Me=e_(K,v.tileID.canonical,ie,se,this.transform,C.getProjection(),ce);ve=f.ae.multiply([],this.transform.labelPlaneMatrix,Me)}let ye=null;ge&&v.latestFeatureIndex&&(ye={unwrappedTileID:Z,dynamicFilter:ge,dynamicFilterNeedsFeature:ae,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new df(C.bucketInstanceId,M,C.sourceLayerIndex,C.index,v.tileID);const Ce={bucket:C,layout:I,posMatrix:K,textLabelPlaneMatrix:xe,labelToScreenMatrix:ve,clippingData:ye,scale:B,textPixelRatio:j,holdingForFade:v.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:f.aE(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.aE(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const Me of C.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Se,symbolInstanceEnd:we}=Me;c.push({sortKey:Le,symbolInstanceStart:Se,symbolInstanceEnd:we,parameters:Ce})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(c,p,v,w,C,M,I,F,B,j,Z,K,J,ne,re,ie,se,ge){const{textOffset0:ae,textOffset1:ce,crossTileID:xe}=K,ve=[ae,ce],ye=V1(c,v,w,ve,C),Ce=this.collisionIndex.placeCollisionBox(ne,C,p,y_(ye.x,ye.y,M,I,this.transform.angle),Z,F,B,j.predicate);if(ie){const Me=ne.getSymbolInstanceIconSize(ge,this.transform.zoom,K.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ne,Me,ie,y_(ye.x,ye.y,M,I,this.transform.angle),Z,F,B,j.predicate).box.length)return}if(Ce.box.length>0){let Me;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(Me=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:ve,width:v,height:w,anchor:c,textScale:C,prevAnchor:Me},this.markUsedJustification(ne,c,K,re),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,re,K),this.placedOrientations[xe]=re),{shift:ye,placedGlyphBoxes:Ce}}}placeLayerBucketPart(c,p,v,w){const{bucket:C,layout:M,posMatrix:I,textLabelPlaneMatrix:F,labelToScreenMatrix:B,clippingData:j,textPixelRatio:Z,holdingForFade:K,collisionBoxArray:J,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:re,collisionGroup:ie}=c.parameters,se=M.get("text-optional"),ge=M.get("icon-optional"),ae=M.get("text-allow-overlap"),ce=M.get("icon-allow-overlap"),xe="map"===M.get("text-rotation-alignment"),ve="map"===M.get("text-pitch-alignment"),ye="viewport-y"===M.get("symbol-z-order"),Ce=M.get("symbol-z-elevate");this.transform.setProjection(C.projection);let Me=ae&&(ce||!C.hasIconData()||ge),Le=ce&&(ae||!C.hasTextData()||se);!C.collisionArrays&&J&&C.deserializeCollisionBoxes(J),v&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,J);const Se=(we,Ue,et)=>{const{crossTileID:Fe,numVerticalGlyphVertices:Mt}=we;if(j){const yr={zoom:this.transform.zoom,pitch:this.transform.pitch};let mr=null;if(j.dynamicFilterNeedsFeature){const sr=this.retainedQueryData[C.bucketInstanceId];mr=j.featureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:sr.bucketIndex,sourceLayerIndex:sr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,j.dynamicFilter)(yr,mr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new f.P(we.tileAnchorX,we.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[Fe]=new uf(!1,!1,!1,!0),void p.add(Fe)}if(p.has(Fe))return;if(K)return void(this.placements[Fe]=new uf(!1,!1,!1));let pt=!1,qe=!1,at=!0,Pe=!1,wt=!1,Et=null,Qt={box:null,offscreen:null,occluded:null},sn={box:null,offscreen:null,occluded:null},fn=null,xt=null,Bn=null,tr=0,Pn=0,fr=0;et.textFeatureIndex?tr=et.textFeatureIndex:we.useRuntimeCollisionCircles&&(tr=we.featureIndex),et.verticalTextFeatureIndex&&(Pn=et.verticalTextFeatureIndex);const Cr=yr=>{yr.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const mr=this.transform.elevation;yr.elevation=we.zOffset+(mr?mr.getAtTileOffset(yr.tileID,yr.tileAnchorX,yr.tileAnchorY):0)},Ar=et.textBox;if(Ar){Cr(Ar);const yr=sr=>{let Sr=f.aF.horizontal;if(C.allowVerticalPlacement&&!sr&&this.prevPlacement){const Tr=this.prevPlacement.placedOrientations[Fe];Tr&&(this.placedOrientations[Fe]=Tr,Sr=Tr,this.markUsedOrientation(C,Sr,we))}return Sr},mr=(sr,Sr)=>{if(C.allowVerticalPlacement&&Mt>0&&et.verticalTextBox){for(const Tr of C.writingModes)if(Tr===f.aF.vertical?(Qt=Sr(),sn=Qt):Qt=sr(),Qt&&Qt.box&&Qt.box.length)break}else Qt=sr()};if(M.get("text-variable-anchor")){let sr=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Fe]){const Qn=this.prevPlacement.variableOffsets[Fe];sr.indexOf(Qn.anchor)>0&&(sr=sr.filter(Ls=>Ls!==Qn.anchor),sr.unshift(Qn.anchor))}const Sr=(Qn,Ls,Cs)=>{const Wo=C.getSymbolInstanceTextSize(ne,we,this.transform.zoom,Ue),fa=(Qn.x2-Qn.x1)*Wo+2*Qn.padding,Eo=(Qn.y2-Qn.y1)*Wo+2*Qn.padding,Ba=we.hasIconTextFit&&!ce?Ls:null;Ba&&Cr(Ba);let qo={box:[],offscreen:!1,occluded:!1};const pa=ae?2*sr.length:sr.length;for(let Gt=0;Gt<pa;++Gt){const Tn=this.attemptAnchorPlacement(sr[Gt%sr.length],Qn,fa,Eo,Wo,xe,ve,Z,I,ie,Gt>=sr.length,we,Ue,C,Cs,Ba,ne,re);if(Tn&&(qo=Tn.placedGlyphBoxes,qo&&qo.box&&qo.box.length)){pt=!0,Et=Tn.shift;break}}return qo};mr(()=>Sr(Ar,et.iconBox,f.aF.horizontal),()=>{const Qn=et.verticalTextBox;return Qn&&Cr(Qn),C.allowVerticalPlacement&&!(Qt&&Qt.box&&Qt.box.length)&&Mt>0&&Qn?Sr(Qn,et.verticalIconBox,f.aF.vertical):{box:null,offscreen:null,occluded:null}}),Qt&&(pt=Qt.box,at=Qt.offscreen,Pe=Qt.occluded);const Tr=yr(!(!Qt||!Qt.box));if(!pt&&this.prevPlacement){const Qn=this.prevPlacement.variableOffsets[Fe];Qn&&(this.variableOffsets[Fe]=Qn,this.markUsedJustification(C,Qn.anchor,we,Tr))}}else{const sr=(Sr,Tr)=>{const Qn=C.getSymbolInstanceTextSize(ne,we,this.transform.zoom,Ue),Ls=this.collisionIndex.placeCollisionBox(C,Qn,Sr,new f.P(0,0),ae,Z,I,ie.predicate);return Ls&&Ls.box&&Ls.box.length&&(this.markUsedOrientation(C,Tr,we),this.placedOrientations[Fe]=Tr),Ls};mr(()=>sr(Ar,f.aF.horizontal),()=>{const Sr=et.verticalTextBox;return C.allowVerticalPlacement&&Mt>0&&Sr?(Cr(Sr),sr(Sr,f.aF.vertical)):{box:null,offscreen:null,occluded:null}}),yr(!!(Qt&&Qt.box&&Qt.box.length))}}if(fn=Qt,pt=fn&&fn.box&&fn.box.length>0,at=fn&&fn.offscreen,Pe=fn&&fn.occluded,we.useRuntimeCollisionCircles){const yr=C.text.placedSymbolArray.get(we.centerJustifiedTextSymbolIndex>=0?we.centerJustifiedTextSymbolIndex:we.verticalPlacedTextSymbolIndex),mr=f.aG(C.textSizeData,ne,yr),sr=M.get("text-padding");xt=this.collisionIndex.placeCollisionCircles(C,ae,yr,C.lineVertexArray,C.glyphOffsetArray,mr,I,F,B,v,ve,ie.predicate,we.collisionCircleDiameter*mr/f.bP,sr,this.retainedQueryData[C.bucketInstanceId].tileID),pt=ae||xt.circles.length>0&&!xt.collisionDetected,at=at&&xt.offscreen,Pe=xt.occluded}if(et.iconFeatureIndex&&(fr=et.iconFeatureIndex),et.iconBox){const yr=mr=>{Cr(mr);const sr=we.hasIconTextFit&&Et?y_(Et.x,Et.y,xe,ve,this.transform.angle):new f.P(0,0),Sr=C.getSymbolInstanceIconSize(re,this.transform.zoom,we.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Sr,mr,sr,ce,Z,I,ie.predicate)};sn&&sn.box&&sn.box.length&&et.verticalIconBox?(Bn=yr(et.verticalIconBox),qe=Bn.box.length>0):(Bn=yr(et.iconBox),qe=Bn.box.length>0),at=at&&Bn.offscreen,wt=Bn.occluded}const ci=se||0===we.numHorizontalGlyphVertices&&0===Mt,nr=ge||0===we.numIconVertices;if(ci||nr?nr?ci||(qe=qe&&pt):pt=qe&&pt:qe=pt=qe&&pt,pt&&fn&&fn.box&&this.collisionIndex.insertCollisionBox(fn.box,M.get("text-ignore-placement"),C.bucketInstanceId,sn&&sn.box&&Pn?Pn:tr,ie.ID),qe&&Bn&&this.collisionIndex.insertCollisionBox(Bn.box,M.get("icon-ignore-placement"),C.bucketInstanceId,fr,ie.ID),xt&&(pt&&this.collisionIndex.insertCollisionCircles(xt.circles,M.get("text-ignore-placement"),C.bucketInstanceId,tr,ie.ID),v)){const yr=C.bucketInstanceId;let mr=this.collisionCircleArrays[yr];void 0===mr&&(mr=this.collisionCircleArrays[yr]=new U1);for(let sr=0;sr<xt.circles.length;sr+=4)mr.circles.push(xt.circles[sr+0]),mr.circles.push(xt.circles[sr+1]),mr.circles.push(xt.circles[sr+2]),mr.circles.push(xt.collisionDetected?1:0)}const Mr="globe"!==C.projection.name;Me=Me&&(Mr||!Pe),Le=Le&&(Mr||!wt),this.placements[Fe]=new uf(pt||Me,qe||Le,at||C.justReloaded),p.add(Fe)};if(Ce&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,this.retainedQueryData[C.bucketInstanceId].tileID),C.updateZOffset()),ye){const we=C.getSortedSymbolIndexes(this.transform.angle);for(let Ue=we.length-1;Ue>=0;--Ue){const et=we[Ue];Se(C.symbolInstances.get(et),et,C.collisionArrays[et])}C.hasAnyZOffset&&f.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){const we=C.getSortedIndexesByZOffset();for(let Ue=0;Ue<we.length;++Ue){const et=we[Ue];Se(C.symbolInstances.get(et),et,C.collisionArrays[et])}}else for(let we=c.symbolInstanceStart;we<c.symbolInstanceEnd;we++)Se(C.symbolInstances.get(we),we,C.collisionArrays[we]);if(v&&C.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[C.bucketInstanceId];f.ae.invert(we.invProjMatrix,I),we.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(c,p,v,w){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:F,crossTileID:B}=v,j=f.cM(p),Z=w===f.aF.vertical?F:"left"===j?C:"center"===j?M:"right"===j?I:-1;C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=Z>=0&&C!==Z?0:B),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=Z>=0&&M!==Z?0:B),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=Z>=0&&I!==Z?0:B),F>=0&&(c.text.placedSymbolArray.get(F).crossTileID=Z>=0&&F!==Z?0:B)}markUsedOrientation(c,p,v){const w=p===f.aF.horizontal||p===f.aF.horizontalOnly?p:0,C=p===f.aF.vertical?p:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:B}=v,j=c.text.placedSymbolArray;M>=0&&(j.get(M).placedOrientation=w),I>=0&&(j.get(I).placedOrientation=w),F>=0&&(j.get(F).placedOrientation=w),B>=0&&(j.get(B).placedOrientation=C)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let v=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const w=p?p.symbolFadeChange(c):1,C=p?p.opacities:{},M=p?p.variableOffsets:{},I=p?p.placedOrientations:{};for(const F in this.placements){const B=this.placements[F],j=C[F];j?(this.opacities[F]=new Qe(j,w,B.text,B.icon,null,B.clipped),v=v||B.text!==j.text.placed||B.icon!==j.icon.placed):(this.opacities[F]=new Qe(null,w,B.text,B.icon,B.skipFade,B.clipped),v=v||B.text||B.icon)}for(const F in C){const B=C[F];if(!this.opacities[F]){const j=new Qe(B,w,!1,!1);j.isHidden()||(this.opacities[F]=j,v=v||B.text.placed||B.icon.placed)}}for(const F in M)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=M[F]);for(const F in I)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=I[F]);v?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:c)}updateLayerOpacities(c,p,v,w){const C=new Set;for(const M of p){const I=M.getBucket(c);I&&M.latestFeatureIndex&&c.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,C,M.collisionBoxArray,v,w,M.tileID,c.scope),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,M.tileID),I.updateZOffset()))}}updateBucketOpacities(c,p,v,w,C,M,I){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const F=c.layers[0].layout,B=!!c.layers[0].dynamicFilter(),j=new Qe(null,0,!1,!1,!0),Z=F.get("text-allow-overlap"),K=F.get("icon-allow-overlap"),J=F.get("text-variable-anchor"),ne="map"===F.get("text-rotation-alignment"),re="map"===F.get("text-pitch-alignment"),ie=new Qe(null,0,Z&&(K||!c.hasIconData()||F.get("icon-optional")),K&&(Z||!c.hasTextData()||F.get("text-optional")),!0);!c.collisionArrays&&v&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(v);const se=(ae,ce,xe)=>{for(let ve=0;ve<ce/4;ve++)ae.opacityVertexArray.emplaceBack(xe)};let ge=0;C&&c.updateReplacement(M,C);for(let ae=0;ae<c.symbolInstances.length;ae++){const ce=c.symbolInstances.get(ae),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:ve,crossTileID:ye,numIconVertices:Ce,tileAnchorX:Me,tileAnchorY:Le}=ce,Se=p.has(ye);let we=this.opacities[ye];Se?we=j:we||(we=ie,this.opacities[ye]=we),p.add(ye);const Ue=xe>0||ve>0,et=Ce>0,Fe=this.placedOrientations[ye],Mt=Fe===f.aF.vertical,pt=Fe===f.aF.horizontal||Fe===f.aF.horizontalOnly;!Ue&&!et||we.isHidden()||ge++;let qe=!1;if((Ue||et)&&C)for(const at of c.activeReplacements){if(f.cJ(at,w,f.cw.Symbol,I)||at.min.x>Me||Me>at.max.x||at.min.y>Le||Le>at.max.y)continue;const Pe=f.cK(Me,Le,M.canonical,at.footprintTileId.canonical);if(qe=f.cL(Pe,at),qe)break}if(Ue){const at=qe?zc:ml(we.text);se(c.text,xe,Mt?zc:at),se(c.text,ve,pt?zc:at);const Pe=we.text.isHidden(),{leftJustifiedTextSymbolIndex:wt,centerJustifiedTextSymbolIndex:Et,rightJustifiedTextSymbolIndex:Qt,verticalPlacedTextSymbolIndex:sn}=ce,fn=c.text.placedSymbolArray,xt=Pe||Mt?1:0;wt>=0&&(fn.get(wt).hidden=xt),Et>=0&&(fn.get(Et).hidden=xt),Qt>=0&&(fn.get(Qt).hidden=xt),sn>=0&&(fn.get(sn).hidden=Pe||pt?1:0);const Bn=this.variableOffsets[ye];Bn&&this.markUsedJustification(c,Bn.anchor,ce,Fe);const tr=this.placedOrientations[ye];tr&&(this.markUsedJustification(c,"left",ce,tr),this.markUsedOrientation(c,tr,ce))}if(et){const at=qe?zc:ml(we.icon),{placedIconSymbolIndex:Pe,verticalPlacedIconSymbolIndex:wt}=ce,Et=c.icon.placedSymbolArray,Qt=we.icon.isHidden()?1:0;Pe>=0&&(se(c.icon,Ce,Mt?zc:at),Et.get(Pe).hidden=Qt),wt>=0&&(se(c.icon,ce.numVerticalIconVertices,pt?zc:at),Et.get(wt).hidden=Qt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const at=c.collisionArrays[ae];if(at){let Pe=new f.P(0,0),wt=!0;if(at.textBox||at.verticalTextBox){if(J){const Qt=this.variableOffsets[ye];Qt?(Pe=V1(Qt.anchor,Qt.width,Qt.height,Qt.textOffset,Qt.textScale),ne&&Pe._rotate(re?this.transform.angle:-this.transform.angle)):wt=!1}B&&(wt=!we.clipped),at.textBox&&Hl(c.textCollisionBox.collisionVertexArray,we.text.placed,!wt||Mt,Pe.x,Pe.y),at.verticalTextBox&&Hl(c.textCollisionBox.collisionVertexArray,we.text.placed,!wt||pt,Pe.x,Pe.y)}const Et=wt&&!(pt||!at.verticalIconBox);at.iconBox&&Hl(c.iconCollisionBox.collisionVertexArray,we.icon.placed,Et,ce.hasIconTextFit?Pe.x:0,ce.hasIconTextFit?Pe.y:0),at.verticalIconBox&&Hl(c.iconCollisionBox.collisionVertexArray,we.icon.placed,!Et,ce.hasIconTextFit?Pe.x:0,ce.hasIconTextFit?Pe.y:0)}}}if(c.fullyClipped=0===ge,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ae.invProjMatrix,c.placementViewportMatrix=ae.viewportMatrix,c.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,p){const v=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*v>c}setStale(){this.stale=!0}}function Hl(y,c,p,v,w){y.emplaceBack(c?1:0,p?1:0,v||0,w||0),y.emplaceBack(c?1:0,p?1:0,v||0,w||0),y.emplaceBack(c?1:0,p?1:0,v||0,w||0),y.emplaceBack(c?1:0,p?1:0,v||0,w||0)}const v_=Math.pow(2,25),$m=Math.pow(2,24),zx=Math.pow(2,17),Bc=Math.pow(2,16),Hm=Math.pow(2,9),nl=Math.pow(2,8),Gd=Math.pow(2,1);function ml(y){if(0===y.opacity&&!y.placed)return 0;if(1===y.opacity&&y.placed)return 4294967295;const c=y.placed?1:0,p=Math.floor(127*y.opacity);return p*v_+c*$m+p*zx+c*Bc+p*Hm+c*nl+p*Gd+c}const zc=0;class Jt{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,p,v,w,C){const M=this._bucketParts;for(;this._currentTileIndex<c.length;)if(p.getBucketParts(M,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((I,F)=>I.sortKey-F.sortKey));this._currentPartIndex<M.length;){const I=M[this._currentPartIndex];if(p.placeLayerBucketPart(I,this._seenCrossTileIDs,v,0===I.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class x_{constructor(c,p,v,w,C,M,I,F,B){this.placement=new Bx(c,C,M,I,F,B),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(c,p,v,w){const C=f.e.now(),M=()=>{const I=f.e.now()-C;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=p[c[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=F)&&(!I.maxzoom||I.maxzoom>F)){const B=I,j=B.layout.get("symbol-z-elevate"),Z=this._inProgressLayer=this._inProgressLayer||new Jt(B),K=f.am(I.source,I.scope);if(Z.continuePlacement(j?w[K]:v[K],this.placement,this._showCollisionBoxes,I,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const b_=512/f.a4/2;class w_{constructor(c,p,v){this.tileID=c,this.bucketInstanceId=v,this.index=new f.cN(p.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=c.canonical.x*f.a4,C=c.canonical.y*f.a4;for(let M=0;M<p.length;M++){const{key:I,crossTileID:F,tileAnchorX:B,tileAnchorY:j}=p.get(M),Z=Math.floor((w+B)*b_),K=Math.floor((C+j)*b_);this.index.add(Z,K),this.keys.push(I),this.crossTileIDs.push(F)}this.index.finish()}findMatches(c,p,v){const w=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),C=b_/Math.pow(2,p.canonical.z-this.tileID.canonical.z),M=p.canonical.x*f.a4,I=p.canonical.y*f.a4;for(let F=0;F<c.length;F++){const B=c.get(F);if(B.crossTileID)continue;const{key:j,tileAnchorX:Z,tileAnchorY:K}=B,J=Math.floor((M+Z)*C),ne=Math.floor((I+K)*C),re=this.index.range(J-w,ne-w,J+w,ne+w);for(const ie of re){const se=this.crossTileIDs[ie];if(this.keys[ie]===j&&!v.has(se)){v.add(se),B.crossTileID=se;break}}}}}class uT{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Na{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const p=Math.round((c-this.lng)/360);if(0!==p)for(const v in this.indexes){const w=this.indexes[v],C={};for(const M in w){const I=w[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+p),C[I.tileID.key]=I}this.indexes[v]=C}this.lng=c}addBucket(c,p,v){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let C=0;C<p.symbolInstances.length;C++)p.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const w=this.usedCrossTileIDs[c.overscaledZ];for(const C in this.indexes){const M=this.indexes[C];if(Number(C)>c.overscaledZ)for(const I in M){const F=M[I];F.tileID.isChildOf(c)&&F.findMatches(p.symbolInstances,c,w)}else{const I=M[c.scaledTo(Number(C)).key];I&&I.findMatches(p.symbolInstances,c,w)}}for(let C=0;C<p.symbolInstances.length;C++){const M=p.symbolInstances.get(C);M.crossTileID||(M.crossTileID=v.generate(),w.add(M.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new w_(c,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(c,p){for(const v of p.crossTileIDs)this.usedCrossTileIDs[c].delete(v)}removeStaleBuckets(c){let p=!1;for(const v in this.indexes){const w=this.indexes[v];for(const C in w)c[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[C]),delete w[C],p=!0)}return p}}class Uc{constructor(){this.layerIndexes={},this.crossTileIDs=new uT,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,p,v,w){let C=this.layerIndexes[c.fqid];void 0===C&&(C=this.layerIndexes[c.fqid]=new Na);let M=!1;const I={};"globe"!==w.name&&C.handleWrapJump(v);for(const F of p){const B=F.getBucket(c);B&&c.fqid===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(F.tileID,B,this.crossTileIDs)&&(M=!0),I[B.bucketInstanceId]=!0)}return C.removeStaleBuckets(I)&&(M=!0),M}pruneUnusedLayers(c){const p={};c.forEach(v=>{p[v]=!0});for(const v in this.layerIndexes)p[v]||delete this.layerIndexes[v]}}const Wd=new f.U({data:new f.W(f.N.colorTheme.data)}),lc=(y,c)=>Yt(y,c&&c.filter(p=>"source.canvas"!==p.identifier)),Gm=f.ai(Vr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),rl=f.ai(Vr,["setCenter","setZoom","setBearing","setPitch"]),Ui={version:8,layers:[],sources:{}},cc={duration:300,delay:0};class gl extends f.E{constructor(c,p={}){super(),this.map=c,this.scope=p.scope||"",this.globalId=null,this.fragments=[],this.importDepth=p.importDepth||0,this.importsCache=p.importsCache||new Map,this.resolvedImports=p.resolvedImports||new Set,this.transition=f.Q({},cc),this._buildingIndex=new tl(this),this.crossTileSymbolIndex=new Uc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=p.styleChanges||new Nu,this.dispatcher=p.dispatcher?p.dispatcher:new f.by(f.bz(),this),p.imageManager?this.imageManager=p.imageManager:(this.imageManager=new Vo,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=p.glyphManager?p.glyphManager:new f.cP(c._requestManager,p.localFontFamily?f.cQ.all:p.localIdeographFontFamily?f.cQ.ideographs:f.cQ.none,p.localFontFamily||p.localIdeographFontFamily),p.modelManager?this.modelManager=p.modelManager:(this.modelManager=new Dd(c._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=p.configOptions?p.configOptions:new Map,this._configDependentLayers=p.configDependentLayers?p.configDependentLayers:new Set,this._config=p.config,this._initialConfig=p.initialConfig,this.dispatcher.broadcast("setReferrer",f.cR());const v=this;this._rtlTextPluginCallback=gl.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,M)=>{if(f.cS(C),M&&M.every(I=>I))for(const I in v._sourceCaches){const F=v._sourceCaches[I],B=F.getSource().type;"vector"!==B&&"geojson"!==B||F.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const C=this.getOwnSource(w.sourceId);if(C&&C.vectorLayerIds)for(const M in this._layers){const I=this._layers[M];I.source===C.id&&this._validateLayer(I)}})}load(c){return c?("string"==typeof c?this.loadURL(c):this.loadJSON(c),this):this}_getGlobalId(c){if(!c)return null;if("string"==typeof c){if(f.cT(c))return c;const p=f.cU(c);if(!p.startsWith("http"))try{return new URL(p,location.href).toString()}catch{return p}return p}return`json://${f.cV(JSON.stringify(c))}`}_diffStyle(c,p,v){this.globalId=this._getGlobalId(c);const w=(C,M)=>{try{M(null,this.setState(C,v))}catch(I){M(I,!1)}};if("string"==typeof c){const C=this.map._requestManager.normalizeStyleURL(c),M=this.map._requestManager.transformRequest(C,f.R.Style);f.h(M,(I,F)=>{I?this.fire(new f.f(I)):F&&w(F,p)})}else"object"==typeof c&&w(c,p)}loadURL(c,p={}){this.fire(new f.g("dataloading",{dataType:"style"}));const v="boolean"==typeof p.validate?p.validate:!f.cT(c);this.globalId=this._getGlobalId(c),c=this.map._requestManager.normalizeStyleURL(c,p.accessToken),this.resolvedImports.add(c);const w=this.importsCache.get(c);if(w)return this._load(w,v);const C=this.map._requestManager.transformRequest(c,f.R.Style);this._request=f.h(C,(M,I)=>{if(this._request=null,M)this.fire(new f.f(M));else if(I)return this.importsCache.set(c,I),this._load(I,v)})}loadJSON(c,p={}){this.fire(new f.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(c),this._request=f.e.frame(()=>{this._request=null,this._load(c,!1!==p.validate)})}loadEmpty(){this.fire(new f.g("dataloading",{dataType:"style"})),this._load(Ui,!1)}_loadImports(c,p,v){if(this.importDepth>=4)return f.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const w=[];for(const C of c){const M=this._createFragmentStyle(C),I=new Promise(j=>{M.once("style.import.load",j),M.once("error",j)}).then(()=>this.mergeAll());if(w.push(I),this.resolvedImports.has(C.url)){M.loadEmpty();continue}const F=C.data||this.importsCache.get(C.url);F?(M.loadJSON(F,{validate:p}),this._isInternalStyle(F)&&(M.globalId=null)):C.url?M.loadURL(C.url,{validate:p}):M.loadEmpty();const B={style:M,id:C.id,config:C.config};if(v){const j=this.fragments.findIndex(({id:Z})=>Z===v);this.fragments=this.fragments.slice(0,j).concat(B).concat(this.fragments.slice(j))}else this.fragments.push(B)}return Promise.allSettled(w)}getImportGlobalIds(c=this,p=new Set){for(const v of c.fragments)v.style.globalId&&p.add(v.style.globalId),this.getImportGlobalIds(v.style,p);return[...p.values()]}_createFragmentStyle(c){const p=this.scope?f.am(c.id,this.scope):c.id;let v;const w=this._initialConfig&&this._initialConfig[p];(c.config||w)&&(v=f.Q({},c.config,w));const C=new gl(this.map,{scope:p,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:v,configOptions:this.options,configDependentLayers:this._configDependentLayers});return C.setEventedParent(this.map,{style:C}),C}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(c){return this.isRootStyle()&&(c.fragment||!!c.schema&&!1!==c.fragment)}_load(c,p){const v=c.schema;if(this._isInternalStyle(c)){const M=f.Q({},Ui,{imports:[{id:"basemap",data:c,url:""}]});return void this._load(M,p)}if(this.updateConfig(this._config,v),p&&lc(this,te(c)))return;this._loaded=!0,this.stylesheet=f.cW(c);const w=()=>{for(const B in c.sources)this.addSource(B,c.sources[B],{validate:!1,isInitialLoad:!0});c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(c.glyphs,this.scope);const M=__(this.stylesheet.layers);if(this._order=M.map(B=>B.id),this.stylesheet.light&&f.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const B=this.stylesheet.lights[0];this.light=new Xr(B.properties,B.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Xr(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const B of M){const j=f.c$(B,this.scope,this._styleColorTheme.lut,this.options);0!==j.configDependencies.size&&this._configDependentLayers.add(j.fqid),j.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j,this._serializedLayers[j.id]=j.serialize();const Z=this.getOwnLayerSourceCache(j),K=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Z&&j.canCastShadows()&&K&&(Z.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new f.g("data",{dataType:"style"}));const F=this.isRootStyle();c.imports?this._loadImports(c.imports,p).then(()=>{this._reloadImports(),this.fire(new f.g(F?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new f.g(F?"style.load":"style.import.load")))},C=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=C,C){const M=this._evaluateColorThemeData(C);this._loadColorTheme(M).then(()=>{w()}).catch(I=>{f.w(`Couldn't load color theme from the stylesheet: ${I}`),w()})}else this._styleColorTheme.lut=null,w()}isRootStyle(){return 0===this.importDepth}mergeAll(){let c,p,v,w,C,M,I,F;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(null!=j.light&&(c=j.light),j.stylesheet.lights)for(const Z of j.stylesheet.lights)"ambient"===Z.type&&null!=j.ambientLight&&(p=j.ambientLight),"directional"===Z.type&&null!=j.directionalLight&&(v=j.directionalLight);w=this._prioritizeTerrain(w,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&null!=j.fog&&(C=j.fog),null!=j.stylesheet.camera&&(F=j.stylesheet.camera),null!=j.stylesheet.projection&&(M=j.stylesheet.projection),null!=j.stylesheet.transition&&(I=j.stylesheet.transition),B[j.scope]=j._styleColorTheme}}),this.light=c,this.ambientLight=p,this.directionalLight=v,this.fog=C,this._styleColorThemeForScope=B,null===w?delete this.terrain:this.terrain=w,this.camera=F||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=f.Q({},cc,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(c){const p=v=>{for(const w of v.fragments)p(w.style);c(v)};p(this)}_prioritizeTerrain(c,p,v){const w=c&&0===c.drapeRenderMode;return null===v?p&&0===p.drapeRenderMode?p:w?c:null:null!=p&&(!c||w||p&&1===p.drapeRenderMode)?p:c}mergeTerrain(){let c;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(p=>{c=this._prioritizeTerrain(c,p.terrain,p.stylesheet.terrain)}),null===c?delete this.terrain:this.terrain=c}mergeProjection(){let c;this.forEachFragmentStyle(p=>{null!=p.stylesheet.projection&&(c=p.stylesheet.projection)}),this.projection=c||{name:"mercator"}}mergeSources(){const c={},p={},v={};this.forEachFragmentStyle(w=>{for(const C in w._sourceCaches){const M=f.am(C,w.scope);c[M]=w._sourceCaches[C]}for(const C in w._otherSourceCaches){const M=f.am(C,w.scope);p[M]=w._otherSourceCaches[C]}for(const C in w._symbolSourceCaches){const M=f.am(C,w.scope);v[M]=w._symbolSourceCaches[C]}}),this._mergedSourceCaches=c,this._mergedOtherSourceCaches=p,this._mergedSymbolSourceCaches=v}mergeLayers(){const c={},p=[],v={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(M=>{for(const I of M._order){const F=M._layers[I];if("slot"===F.type){const B=f.cX(I);if(c[B])continue;c[B]=[]}F.slot&&c[F.slot]?c[F.slot].push(F):p.push(F)}}),this._mergedOrder=[],this._clipLayerIndices=[];let w=0;const C=(M=[])=>{for(const I of M)if("slot"===I.type){const F=f.cX(I.id);c[F]&&C(c[F]),this._mergedSlots.push(F)}else{const F=f.am(I.id,I.scope);this._mergedOrder.push(F),v[F]=I,I.is3D()&&(this._has3DLayers=!0),"circle"===I.type&&(this._hasCircleLayers=!0),"symbol"===I.type&&(this._hasSymbolLayers=!0),"clip"===I.type&&this._clipLayerIndices.push(w),w++}};C(p),this._mergedOrder.sort((M,I)=>{const F=v[M],B=v[I];return F.hasInitialOcclusionOpacityProperties?B.is3D()?1:0:F.is3D()&&B.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=v,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(c){return this.stylesheet.camera=f.Q({},this.stylesheet.camera,c),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(c){return c.data?function(p,v,w){const C=f.Q({},v);for(const I of Object.keys(f.N.colorTheme))void 0===C[I]&&(C[I]=f.N.colorTheme[I].default);const M=new f.O(Wd,p,new Map(w));return M.setTransitionOrValue(C,w),M.untransitioned().possiblyEvaluate(new f.Y(0))}(this.scope,c,this.options).get("data"):null}_loadColorTheme(c){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const p=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((v,w)=>{const C="data:image/png;base64,";if(!c||0===c.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void v();let M=c;M.startsWith(C)||(M=C+M);const I="mapbox-reserved-lut",F=new Image;F.src=M,F.onerror=()=>{this._styleColorTheme.lutLoading=!1,w(new Error("Failed to load image data"))},F.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==p)return void v();this._styleColorTheme.lutLoading=!1;const{width:B,height:j,data:Z}=f.e.getImageData(F);if(j>32)return void w(new Error("The height of the image must be less than or equal to 32 pixels."));if(B!==j*j)return void w(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new f.j({width:B,height:j},Z),pixelRatio:1,sdf:!1,version:0});const K=this.imageManager.getImage(I,this.scope);K?(this._styleColorTheme.lut={image:K.data,data:c},v()):w(new Error("Missing LUT image."))}})}getLut(c){const p=this._styleColorThemeForScope[c];return p?p.lut:null}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(c){this._spriteRequest=function(p,v,w){let C,M,I;const F=f.e.devicePixelRatio>1?"@2x":"";let B=f.h(v.transformRequest(v.normalizeSpriteURL(p,F,".json"),f.R.SpriteJSON),(K,J)=>{B=null,I||(I=K,C=J,Z())}),j=f.i(v.transformRequest(v.normalizeSpriteURL(p,F,".png"),f.R.SpriteImage),(K,J)=>{j=null,I||(I=K,M=J,Z())});function Z(){if(I)w(I);else if(C&&M){const K=f.e.getImageData(M),J={};for(const ne in C){const{width:re,height:ie,x:se,y:ge,sdf:ae,pixelRatio:ce,stretchX:xe,stretchY:ve,content:ye}=C[ne],Ce=new f.j({width:re,height:ie});f.j.copy(K,Ce,{x:se,y:ge},{x:0,y:0},{width:re,height:ie},null),J[ne]={data:Ce,pixelRatio:ce,sdf:ae,stretchX:xe,stretchY:ve,content:ye}}w(null,J)}}return{cancel(){B&&(B.cancel(),B=null),j&&(j.cancel(),j=null)}}}(c,this.map._requestManager,(p,v)=>{if(this._spriteRequest=null,p)this.fire(new f.f(p));else if(v)for(const w in v)this.imageManager.addImage(w,this.scope,v[w]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new f.g("data",{dataType:"style"}))})}_validateLayer(c){const p=this.getOwnSource(c.source);if(!p)return;const v=c.sourceLayer;v&&("geojson"===p.type||p.vectorLayerIds&&-1===p.vectorLayerIds.indexOf(v))&&this.fire(new f.f(new Error(`Source layer "${v}" does not exist on source "${p.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:c}of this.fragments)if(!c.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((c,p)=>{const v=this.fragments[p];return v&&v.style&&(c.data=v.style.serialize()),c})}_serializeSources(){const c={};for(const p in this._sourceCaches){const v=this._sourceCaches[p].getSource();c[v.id]||(c[v.id]=v.serialize())}return c}_serializeLayers(c){const p=[];for(const v of c){const w=this._layers[v];w&&"custom"!==w.type&&p.push(w.serialize())}return p}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(c){return!!this.terrain&&c.isDraped(this.getLayerSourceCache(c))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(c){const p=this.getOwnLayer(c);if(p)return p;this.fire(new f.f(new Error(`The layer '${c}' does not exist in the map's style.`)))}_checkSource(c){const p=this.getOwnSource(c);if(p)return p;this.fire(new f.f(new Error(`The source '${c}' does not exist in the map's style.`)))}precompilePrograms(c,p){const v=this.map.painter;if(v)for(let w=c.minzoom||0;w<(c.maxzoom||25.5);w++){const C=c.getProgramIds();if(C)for(const M of C){const I=c.getDefaultProgramParams(M,p.zoom,this._styleColorTheme.lut);I&&(v.style=this,this.fog&&(v._fogVisible=!0,I.overrideFog=!0,v.getOrCreateProgram(M,I)),v._fogVisible=!1,I.overrideFog=!1,v.getOrCreateProgram(M,I),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(I.overrideRtt=!0,v.getOrCreateProgram(M,I)))}}}update(c){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c);const p=this.calculateLightsBrightness();c.brightness=p||0,p!==this._brightness&&(this._brightness=p,this.dispatcher.broadcast("setBrightness",p));const v=this._changes.isDirty();let w=!1;if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const I in M){const{updatedIds:F,removedIds:B}=M[I];(F||B)&&(this._updateWorkerLayers(I,F,B),w=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(c),this.light&&this.light.updateTransitions(c),this.ambientLight&&this.ambientLight.updateTransitions(c),this.directionalLight&&this.directionalLight.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._changes.reset()}const C={};for(const M in this._mergedSourceCaches){const I=this._mergedSourceCaches[M];C[M]=I.used,I.used=!1,I.tileCoverLift=0}for(const M of this._mergedOrder){const I=this._mergedLayers[M];if(I.recalculate(c,this._availableImages),!I.isHidden(c.zoom)){const F=this.getLayerSourceCache(I);F&&(F.used=!0,F.tileCoverLift=Math.max(F.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,c)}):this.precompilePrograms(I,c))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&w&&this.mergeLayers();for(const M in C){const I=this._mergedSourceCaches[M];C[M]!==I.used&&I.getSource().fire(new f.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),v&&this.fire(new f.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=this._changes.getUpdatedImages();if(c.length){for(const p in this._sourceCaches)this._sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changes.resetUpdatedImages()}}_updateWorkerLayers(c,p,v){const w=this.getFragmentStyle(c);w&&this.dispatcher.broadcast("updateLayers",{layers:p?w._serializeLayers(p):[],scope:c,removedIds:v||[],options:w.options})}setState(c,p){if(this._checkLoaded(),lc(this,te(c)))return!1;(c=f.cW(c)).layers=__(c.layers);const v=function(M,I){if(!M)return[{command:Vr.setStyle,args:[I]}];let F=[];try{if(!f.d(M.version,I.version))return[{command:Vr.setStyle,args:[I]}];if(f.d(M.center,I.center)||F.push({command:Vr.setCenter,args:[I.center]}),f.d(M.zoom,I.zoom)||F.push({command:Vr.setZoom,args:[I.zoom]}),f.d(M.bearing,I.bearing)||F.push({command:Vr.setBearing,args:[I.bearing]}),f.d(M.pitch,I.pitch)||F.push({command:Vr.setPitch,args:[I.pitch]}),f.d(M.sprite,I.sprite)||F.push({command:Vr.setSprite,args:[I.sprite]}),f.d(M.glyphs,I.glyphs)||F.push({command:Vr.setGlyphs,args:[I.glyphs]}),f.d(M.imports,I.imports)||function(J=[],ne=[],re){ne=ne||[];const ie=(J=J||[]).map(jm),se=ne.map(jm),ge=J.reduce(pl,{}),ae=ne.reduce(pl,{}),ce=ie.slice();let xe,ve,ye,Ce;for(xe=0,ve=0;xe<ie.length;xe++)ye=ie[xe],ae.hasOwnProperty(ye)?ve++:(re.push({command:Vr.removeImport,args:[ye]}),ce.splice(ce.indexOf(ye,ve),1));for(xe=0,ve=0;xe<se.length;xe++)ye=se[se.length-1-xe],ce[ce.length-1-xe]!==ye&&(ge.hasOwnProperty(ye)?(re.push({command:Vr.removeImport,args:[ye]}),ce.splice(ce.lastIndexOf(ye,ce.length-ve),1)):ve++,Ce=ce[ce.length-xe],re.push({command:Vr.addImport,args:[ae[ye],Ce]}),ce.splice(ce.length-xe,0,ye));for(const Me of ne){const Le=ge[Me.id];Le&&!f.d(Le,Me)&&re.push({command:Vr.updateImport,args:[Me.id,Me]})}}(M.imports,I.imports,F),f.d(M.transition,I.transition)||F.push({command:Vr.setTransition,args:[I.transition]}),f.d(M.light,I.light)||F.push({command:Vr.setLight,args:[I.light]}),f.d(M.fog,I.fog)||F.push({command:Vr.setFog,args:[I.fog]}),f.d(M.projection,I.projection)||F.push({command:Vr.setProjection,args:[I.projection]}),f.d(M.lights,I.lights)||F.push({command:Vr.setLights,args:[I.lights]}),f.d(M.camera,I.camera)||F.push({command:Vr.setCamera,args:[I.camera]}),!f.d(M["color-theme"],I["color-theme"]))return[{command:Vr.setStyle,args:[I]}];const B={},j=[];!function(J,ne,re,ie){let se;for(se in ne=ne||{},J=J||{})J.hasOwnProperty(se)&&(ne.hasOwnProperty(se)||Um(se,re,ie));for(se in ne){if(!ne.hasOwnProperty(se))continue;const ge=ne[se];J.hasOwnProperty(se)?f.d(J[se],ge)||("geojson"===J[se].type&&"geojson"===ge.type&&Vm(J,ne,se)?re.push({command:Vr.setGeoJSONSourceData,args:[se,ge.data]}):cT(se,ne,re,ie)):$d(se,ne,re)}}(M.sources,I.sources,j,B);const Z=[];M.layers&&M.layers.forEach(J=>{J.source&&B[J.source]?F.push({command:Vr.removeLayer,args:[J.id]}):Z.push(J)});let K=M.terrain;K&&B[K.source]&&(F.push({command:Vr.setTerrain,args:[void 0]}),K=void 0),F=F.concat(j),f.d(K,I.terrain)||F.push({command:Vr.setTerrain,args:[I.terrain]}),function(J,ne,re){ne=ne||[];const ie=(J=J||[]).map(jm),se=ne.map(jm),ge=J.reduce(pl,{}),ae=ne.reduce(pl,{}),ce=ie.slice(),xe=Object.create(null);let ve,ye,Ce,Me,Le,Se,we;for(ve=0,ye=0;ve<ie.length;ve++)Ce=ie[ve],ae.hasOwnProperty(Ce)?ye++:(re.push({command:Vr.removeLayer,args:[Ce]}),ce.splice(ce.indexOf(Ce,ye),1));for(ve=0,ye=0;ve<se.length;ve++)Ce=se[se.length-1-ve],ce[ce.length-1-ve]!==Ce&&(ge.hasOwnProperty(Ce)?(re.push({command:Vr.removeLayer,args:[Ce]}),ce.splice(ce.lastIndexOf(Ce,ce.length-ye),1)):ye++,Se=ce[ce.length-ve],re.push({command:Vr.addLayer,args:[ae[Ce],Se]}),ce.splice(ce.length-ve,0,Ce),xe[Ce]=!0);for(ve=0;ve<se.length;ve++)if(Ce=se[ve],Me=ge[Ce],Le=ae[Ce],!xe[Ce]&&!f.d(Me,Le))if(f.d(Me.source,Le.source)&&f.d(Me["source-layer"],Le["source-layer"])&&f.d(Me.type,Le.type)){for(we in Hd(Me.layout,Le.layout,re,Ce,null,Vr.setLayoutProperty),Hd(Me.paint,Le.paint,re,Ce,null,Vr.setPaintProperty),f.d(Me.slot,Le.slot)||re.push({command:Vr.setSlot,args:[Ce,Le.slot]}),f.d(Me.filter,Le.filter)||re.push({command:Vr.setFilter,args:[Ce,Le.filter]}),f.d(Me.minzoom,Le.minzoom)&&f.d(Me.maxzoom,Le.maxzoom)||re.push({command:Vr.setLayerZoomRange,args:[Ce,Le.minzoom,Le.maxzoom]}),Me)Me.hasOwnProperty(we)&&"layout"!==we&&"paint"!==we&&"filter"!==we&&"metadata"!==we&&"minzoom"!==we&&"maxzoom"!==we&&"slot"!==we&&(0===we.indexOf("paint.")?Hd(Me[we],Le[we],re,Ce,we.slice(6),Vr.setPaintProperty):f.d(Me[we],Le[we])||re.push({command:Vr.setLayerProperty,args:[Ce,we,Le[we]]}));for(we in Le)Le.hasOwnProperty(we)&&!Me.hasOwnProperty(we)&&"layout"!==we&&"paint"!==we&&"filter"!==we&&"metadata"!==we&&"minzoom"!==we&&"maxzoom"!==we&&"slot"!==we&&(0===we.indexOf("paint.")?Hd(Me[we],Le[we],re,Ce,we.slice(6),Vr.setPaintProperty):f.d(Me[we],Le[we])||re.push({command:Vr.setLayerProperty,args:[Ce,we,Le[we]]}))}else re.push({command:Vr.removeLayer,args:[Ce]}),Se=ce[ce.lastIndexOf(Ce)+1],re.push({command:Vr.addLayer,args:[Le,Se]})}(Z,I.layers,F)}catch(B){console.warn("Unable to compute style diff:",B),F=[{command:Vr.setStyle,args:[I]}]}return F}(this.serialize(),c).filter(M=>!(M.command in rl));if(0===v.length)return!1;const w=v.filter(M=>!(M.command in Gm));if(w.length>0)throw new Error(`Unimplemented: ${w.map(M=>M.command).join(", ")}.`);const C=[];return v.forEach(M=>{C.push(this[M.command].apply(this,M.args))}),p&&Promise.all(C).then(p),this.stylesheet=c,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(c,p){return this.getImage(c)?this.fire(new f.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,this.scope,p),this._afterImageUpdated(c),this)}updateImage(c,p){this.imageManager.updateImage(c,this.scope,p)}getImage(c){return this.imageManager.getImage(c,this.scope)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c,this.scope),this._afterImageUpdated(c),this):this.fire(new f.f(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(c),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new f.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(c,p,v={}){return this._checkLoaded(),this._validate(Ot,`models.${c}`,p,null,v)||(this.modelManager.addModel(c,p,this.scope),this._changes.setDirty()),this}hasModel(c){return this.modelManager.hasModel(c,this.scope)}removeModel(c){return this.hasModel(c)?(this.modelManager.removeModel(c,this.scope),this):this.fire(new f.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(c,p,v={}){if(this._checkLoaded(),void 0!==this.getOwnSource(c))throw new Error(`There is already a source with ID "${c}".`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(oe,`sources.${c}`,p,null,v))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const w=l_(c,p,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const C=M=>{const I=(M?"symbol:":"other:")+w.id,F=f.am(I,this.scope),B=this._sourceCaches[I]=new f.bx(F,w,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=B,B.onAdd(this.map)};C(!1),"vector"!==p.type&&"geojson"!==p.type||C(!0),w.onAdd&&w.onAdd(this.map),v.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(c){this._checkLoaded();const p=this.getOwnSource(c);if(!p)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===c)return this.fire(new f.f(new Error(`Source "${c}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===c)return this.fire(new f.f(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const v=this.getOwnSourceCaches(c);for(const w of v){const C=f.cX(w.id);delete this._sourceCaches[C],this._changes.discardSourceCacheUpdate(w.id),w.fire(new f.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],this.mergeSources(),p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(c,p){this._checkLoaded(),this.getOwnSource(c).setData(p),this._changes.setDirty()}getOwnSource(c){const p=this.getOwnSourceCache(c);return p&&p.getSource()}getOwnSources(){const c=[];for(const p in this._otherSourceCaches){const v=this.getOwnSourceCache(p);v&&c.push(v.getSource())}return c}areTilesLoaded(){const c=this._mergedSourceCaches;for(const p in c){const v=c[p]._tiles;for(const w in v){const C=v[w];if("loaded"!==C.state&&"errored"!==C.state)return!1}}return!0}setLights(c){if(this._checkLoaded(),!c)return delete this.ambientLight,void delete this.directionalLight;const p=this._getTransitionParameters();for(const w of c){if(this._validate(ke,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const C=this.ambientLight;C.set(w),C.updateTransitions(p)}else this.ambientLight=new Jf(w,y1||(y1=new f.U({color:new f.W(f.N.properties_light_ambient.color),intensity:new f.W(f.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const C=this.directionalLight;C.set(w),C.updateTransitions(p)}else this.directionalLight=new Jf(w,_m||(_m=new f.U({direction:new f.a6(f.N.properties_light_directional.direction),color:new f.W(f.N.properties_light_directional.color),intensity:new f.W(f.N.properties_light_directional.intensity),"cast-shadows":new f.W(f.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new f.W(f.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const v=new f.Y(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const c=this.directionalLight,p=this.ambientLight;if(!c||!p)return;const v=Z=>.2126*(Z[0]<=.03928?Z[0]/12.92:Math.pow((Z[0]+.055)/1.055,2.4))+.7152*(Z[1]<=.03928?Z[1]/12.92:Math.pow((Z[1]+.055)/1.055,2.4))+.0722*(Z[2]<=.03928?Z[2]/12.92:Math.pow((Z[2]+.055)/1.055,2.4)),w=c.properties.get("color").toRenderColor(null).toArray01(),C=c.properties.get("intensity"),M=c.properties.get("direction"),I=1-f.ad(M.x,M.y,M.z)[2]/90,F=v(w)*C*I,B=p.properties.get("color").toRenderColor(null).toArray01(),j=p.properties.get("intensity");return(F+v(B)*j)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const c=[];return this.directionalLight&&c.push(this.directionalLight.get()),this.ambientLight&&c.push(this.ambientLight.get()),c}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(c){if(!c)return this;if(f.cY(c)){const p=f.cZ(c),v=this.fragments.find(({id:C})=>C===p);if(!v)throw new Error(`Style import not found: ${c}`);const w=f.cX(c);return v.style.getFragmentStyle(w)}{const p=this.fragments.find(({id:v})=>v===c);if(!p)throw new Error(`Style import not found: ${c}`);return p.style}}getConfigProperty(c,p){const v=this.getFragmentStyle(c);if(!v)return null;const w=f.am(p,v.scope),C=v.options.get(w),M=C?C.value||C.default:null;return M?M.serialize():null}setConfigProperty(c,p,v){const w=this.getFragmentStyle(c);if(!w)return;const C=w.stylesheet.schema;if(!C||!C[p])return;const M=f.z(v);if("success"!==M.result)return void lc(this,M.value);const I=M.value.expression,F=f.am(p,w.scope),B=w.options.get(F);if(!B)return;let j;const{minValue:Z,maxValue:K,stepValue:J,type:ne,values:re}=C[p],ie=f.z(C[p].default);"success"===ie.result&&(j=ie.value.expression),j?(this.options.set(F,{...B,value:I,default:j,minValue:Z,maxValue:K,stepValue:J,type:ne,values:re}),this.updateConfigDependencies(p)):this.fire(new f.f(new Error(`No schema defined for the config option "${p}" in the "${c}" fragment.`)))}getConfig(c){const p=this.getFragmentStyle(c);if(!p)return null;const v=p.stylesheet.schema;if(!v)return null;const w={};for(const C in v){const M=f.am(C,p.scope),I=p.options.get(M),F=I?I.value||I.default:null;w[C]=F?F.serialize():null}return w}setConfig(c,p){const v=this.getFragmentStyle(c);v&&(v.updateConfig(p,v.stylesheet.schema),this.updateConfigDependencies())}getSchema(c){const p=this.getFragmentStyle(c);return p?p.stylesheet.schema:null}setSchema(c,p){const v=this.getFragmentStyle(c);v&&(v.stylesheet.schema=p,v.updateConfig(v._config,p),this.updateConfigDependencies())}updateConfig(c,p){if(this._config=c,c||p)if(p)for(const v in p){let w,C;const M=f.z(p[v].default);if("success"===M.result&&(w=M.value.expression),c&&void 0!==c[v]){const K=f.z(c[v]);"success"===K.result&&(C=K.value.expression)}const{minValue:I,maxValue:F,stepValue:B,type:j,values:Z}=p[v];if(w){const K=f.am(v,this.scope);this.options.set(K,{default:w,value:C,minValue:I,maxValue:F,stepValue:B,type:j,values:Z})}else this.fire(new f.f(new Error(`No schema defined for config option "${v}".`)))}else this.fire(new f.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(c){for(const p of this._configDependentLayers){const v=this.getLayer(p);if(v){if(c&&!v.configDependencies.has(c))continue;v.possiblyEvaluateVisibility(),this._updateLayer(v)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(p=>{if(p._styleColorTheme.colorTheme){const v=p._evaluateColorThemeData(p._styleColorTheme.colorTheme);(!p._styleColorTheme.lut&&""!==v||p._styleColorTheme.lut&&v!==p._styleColorTheme.lut.data)&&p.setColorTheme(p._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(c,p,v={}){this._checkLoaded();const w=c.id;if(this._layers[w])return void this.fire(new f.f(new Error(`Layer with id "${w}" already exists on this map`)));let C;if("custom"===c.type){if(lc(this,f.c_(c)))return;C=f.c$(c,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof c.source&&(this.addSource(w,c.source),c=f.cW(c),c=f.Q(c,{source:w})),this._validate(lt,`layers.${w}`,c,{arrayIndex:-1},v))return;C=f.c$(c,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize()}0!==C.configDependencies.size&&this._configDependentLayers.add(C.fqid);let M=this._order.length;if(p){const j=this._order.indexOf(p);if(-1===j)return void this.fire(new f.f(new Error(`Layer with id "${p}" does not exist on this map.`)));C.slot===this._layers[p].slot?M=j:f.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,w),this._layerOrderChanged=!0,this._layers[w]=C;const I=this.getOwnLayerSourceCache(C),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&C.canCastShadows()&&F&&(I.castsShadows=!0);const B=this._changes.getRemovedLayer(C);if(B&&C.source&&I&&"custom"!==C.type){this._changes.discardLayerRemoval(C);const j=f.am(C.source,C.scope);B.type!==C.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),I.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),C.scope=this.scope,this.mergeLayers()}moveLayer(c,p){this._checkLoaded();const v=this._checkLayer(c);if(!v||c===p)return;const w=this._order.indexOf(c);this._order.splice(w,1);let C=this._order.length;if(p){const M=this._order.indexOf(p);if(-1===M)return void this.fire(new f.f(new Error(`Layer with id "${p}" does not exist on this map.`)));v.slot===this._layers[p].slot?C=M:f.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,c),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(c){this._checkLoaded();const p=this._checkLayer(c);if(!p)return;p.setEventedParent(null);const v=this._order.indexOf(c);this._order.splice(v,1),delete this._layers[c],delete this._serializedLayers[c],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(p.fqid),this._changes.removeLayer(p);const w=this.getOwnLayerSourceCache(p);if(w&&w.castsShadows){let C=!1;for(const M in this._layers)if(this._layers[M].source===p.source&&this._layers[M].canCastShadows()){C=!0;break}w.castsShadows=C}p.onRemove&&p.onRemove(this.map),this.mergeLayers()}getOwnLayer(c){return this._layers[c]}hasLayer(c){return c in this._mergedLayers}hasLayerType(c){for(const p in this._layers)if(this._layers[p].type===c)return!0;return!1}setLayerZoomRange(c,p,v){this._checkLoaded();const w=this._checkLayer(c);w&&(w.minzoom===p&&w.maxzoom===v||(null!=p&&(w.minzoom=p),null!=v&&(w.maxzoom=v),this._updateLayer(w)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(c,p){this._checkLoaded();const v=this._checkLayer(c);v&&v.slot!==p&&(v.slot=p,this._updateLayer(v))}setFilter(c,p,v={}){this._checkLoaded();const w=this._checkLayer(c);if(w&&!f.d(w.filter,p))return null==p?(w.filter=void 0,void this._updateLayer(w)):void(this._validate($e,`layers.${w.id}.filter`,p,{layerType:w.type},v)||(w.filter=f.cW(p),this._updateLayer(w)))}getFilter(c){const p=this._checkLayer(c);if(p)return f.cW(p.filter)}setLayoutProperty(c,p,v,w={}){this._checkLoaded();const C=this._checkLayer(c);if(C&&!f.d(C.getLayoutProperty(p),v)){if(null!=v&&(!w||!1!==w.validate)&&lc(C,Pt.call(te,{key:`layers.${c}.layout.${p}`,layerType:C.type,objectKey:p,value:v,styleSpec:f.N,style:{glyphs:!0,sprite:!0}})))return;C.setLayoutProperty(p,v),0!==C.configDependencies.size&&this._configDependentLayers.add(C.fqid),this._updateLayer(C)}}getLayoutProperty(c,p){const v=this._checkLayer(c);if(v)return v.getLayoutProperty(p)}setPaintProperty(c,p,v,w={}){this._checkLoaded();const C=this._checkLayer(c);if(!C||f.d(C.getPaintProperty(p),v)||null!=v&&(!w||!1!==w.validate)&&lc(C,it.call(te,{key:`layers.${c}.paint.${p}`,layerType:C.type,objectKey:p,value:v,styleSpec:f.N})))return;const M=C.setPaintProperty(p,v);0!==C.configDependencies.size&&this._configDependentLayers.add(C.fqid),M&&this._updateLayer(C),this._changes.updatePaintProperties(C)}getPaintProperty(c,p){const v=this._checkLayer(c);if(v)return v.getPaintProperty(p)}setFeatureState(c,p){this._checkLoaded();const v=c.source,w=c.sourceLayer,C=this._checkSource(v);if(!C)return;const M=C.type;if("geojson"===M&&w)return void this.fire(new f.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!w)return void this.fire(new f.f(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new f.f(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(v);for(const F of I)F.setFeatureState(w,c.id,p)}removeFeatureState(c,p){this._checkLoaded();const v=c.source,w=this._checkSource(v);if(!w)return;const C=w.type,M="vector"===C?c.sourceLayer:void 0;if("vector"===C&&!M)return void this.fire(new f.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new f.f(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(v);for(const F of I)F.removeFeatureState(M,c.id,p)}getFeatureState(c){this._checkLoaded();const p=c.source,v=c.sourceLayer,w=this._checkSource(p);if(w){if("vector"!==w.type||v)return void 0===c.id&&this.fire(new f.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(p)[0].getFeatureState(v,c.id);this.fire(new f.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(c){return this.stylesheet.transition=f.Q({},this.stylesheet.transition,c),this.transition=this.stylesheet.transition,this}getTransition(){return f.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const c=this.getTerrain(),p=c&&this.terrain&&this.terrain.scope===this.scope?c:this.stylesheet.terrain;return f.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:p,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},v=>void 0!==v)}_updateLayer(c){this._changes.updateLayer(c);const p=this.getLayerSourceCache(c),v=f.am(c.source,c.scope),w=this._changes.getUpdatedSourceCaches();c.source&&!w[v]&&p&&"raster"!==p.getSource().type&&(this._changes.updateSourceCache(v,"reload"),p.pause()),c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const p=I=>"fill-extrusion"===this._mergedLayers[I].type||"model"===this._mergedLayers[I].type,v=this.order,w={},C=[];for(let I=v.length-1;I>=0;I--){const F=v[I];if(p(F)){w[F]=I;for(const B of c){const j=B[F];if(j)for(const Z of j)C.push(Z)}}}C.sort((I,F)=>F.intersectionZ-I.intersectionZ);const M=[];for(let I=v.length-1;I>=0;I--){const F=v[I];if(p(F))for(let B=C.length-1;B>=0;B--){const j=C[B].feature;if(j.layer&&w[j.layer.id]<I)break;M.push(j),C.pop()}else for(const B of c){const j=B[F];if(j)for(const Z of j)M.push(Z.feature)}}return M}queryRenderedFeatures(c,p,v){p&&p.filter&&this._validate($e,"queryRenderedFeatures.filter",p.filter,null,p),p.scope=this.scope,p.availableImages=this._availableImages,p.serializedLayers=this._serializedLayers;const w={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new f.f(new Error("parameters.layers must be an Array."))),[];for(const B of p.layers){const j=this._mergedLayers[B];if(!j)return this.fire(new f.f(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];w[j.source]=!0}}const C=[],M=p.serializedLayers||{},I=p&&p.layers?p.layers.some(B=>{const j=this.getLayer(B);return j&&j.is3D()}):this.has3DLayers(),F=$l.createFromScreenPoints(c,v);for(const B in this._mergedSourceCaches){const j=this._mergedSourceCaches[B].getSource();if(!j||j.scope!==p.scope)continue;const Z=this._mergedSourceCaches[B].getSource().id;p.layers&&!w[Z]||C.push(Lc(this._mergedSourceCaches[B],this._mergedLayers,M,F,p,v,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(B,j,Z,K,J,ne,re){const ie={},se=ne.queryRenderedSymbols(K),ge=[];for(const ae of Object.keys(se).map(Number))ge.push(re[ae]);ge.sort(Ra);for(const ae of ge){const ce=ae.featureIndex.lookupSymbolFeatures(se[ae.bucketInstanceId],j,ae.bucketIndex,ae.sourceLayerIndex,J.filter,J.layers,J.availableImages,B);for(const xe in ce){const ve=ie[xe]=ie[xe]||[],ye=ce[xe];ye.sort((Ce,Me)=>{const Le=ae.featureSortOrder;if(Le){const Se=Le.indexOf(Ce.featureIndex);return Le.indexOf(Me.featureIndex)-Se}return Me.featureIndex-Ce.featureIndex});for(const Ce of ye)ve.push(Ce)}}for(const ae in ie)ie[ae].forEach(ce=>{const xe=ce.feature,ve=Z(B[ae]);if(!ve)return;const ye=ve.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=ye});return ie}(this._mergedLayers,M,this.getLayerSourceCache.bind(this),F.screenGeometry,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(c,p){p&&p.filter&&this._validate($e,"querySourceFeatures.filter",p.filter,null,p);const v=this.getOwnSourceCaches(c);let w=[];for(const C of v)w=w.concat(Nx(C,p));return w}addSourceType(c,p,v){return gl.getSourceType(c)?v(new Error(`A source type called "${c}" already exists.`)):(gl.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},v):v(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(c,p,v={}){this._checkLoaded();const w=this.light.getLight();let C=!1;for(const I in c)if(!f.d(c[I],w[I])){C=!0;break}if(!C)return;const M=this._getTransitionParameters();this.light.setLight(c,p,v),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=f.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&f.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(c,p=1){if(this._checkLoaded(),!c)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===p&&delete this.terrain,null===c?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let v=c;const w=null==c.source;if(1===p){if(this.disableElevatedTerrain)return;if("object"==typeof v.source){const I="terrain-dem-src";this.addSource(I,v.source),v=f.cW(v),v=f.Q(v,{source:I})}const C=f.Q({},v),M={};if(this.terrain&&w){C.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(M.style=I.serialize())}if(this._validate(Ee,"terrain",C,M))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&p!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,p),this.fire(new f.g("data",{dataType:"style"}))}else{const C=this.terrain,M=C.get();for(const I of Object.keys(f.N.terrain))!v.hasOwnProperty(I)&&f.N.terrain[I].default&&(v[I]=f.N.terrain[I].default);for(const I in c)if(!f.d(c[I],M[I])){C.set(c,this.options),this.stylesheet.terrain=c;const F=this._getTransitionParameters({duration:0});C.updateTransitions(F),this.fire(new f.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const p=this.fog=new Aa(c,this.map.transform,this.scope,this.options);this.stylesheet.fog=p.get();const v=this._getTransitionParameters({duration:0});p.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog;if(!f.d(p.get(),c)){p.set(c,this.options),this.stylesheet.fog=p.get();const v=this._getTransitionParameters({duration:0});p.updateTransitions(v)}}else this._createFog(c);this._markersNeedUpdate=!0}setColorTheme(c){this._checkLoaded();const p=()=>{for(const w in this._layers)this._layers[w].lut=this._styleColorTheme.lut;for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()};if(this._styleColorTheme.colorTheme=c,!c)return this._styleColorTheme.lut=null,void p();const v=this._evaluateColorThemeData(c);this._loadColorTheme(v).then(()=>{this.fire(new f.g("colorthemeset")),p()}).catch(w=>{f.w(`Couldn't set color theme: ${w}`)})}_getTransitionParameters(c){return{now:f.e.now(),transition:f.Q(this.transition,c)}}updateDrapeFirstLayers(){if(!this.terrain)return;const c=[],p=[];for(const v of this._mergedOrder)this.isLayerDraped(this._mergedLayers[v])?c.push(v):p.push(v);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...p)}_createTerrain(c,p){const v=this.terrain=new Gr(c,p,this.scope,this.options);1===p&&(this.stylesheet.terrain=c),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const c in this._layers){const p=this._layers[c];"fill-extrusion"===p.type&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const p=this._layers[c];"symbol"===p.type&&this._updateLayer(p)}}_validate(c,p,v,w,C={}){if(C&&!1===C.validate)return!1;const M=f.Q({},this.serialize());return lc(this,c.call(te,f.Q({key:p,style:M,value:v,styleSpec:f.N},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._mergedLayers)this._mergedLayers[c].setEventedParent(null);for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles(),this._mergedSourceCaches[c].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(c){const p=this.getSourceCaches(c);for(const v of p)v.clearTiles()}clearSources(){for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles()}reloadSource(c){const p=this.getSourceCaches(c);for(const v of p)v.resume(),v.reload()}reloadSources(){for(const c of this.getSources())c.reload&&c.reload()}updateSources(c){let p;this.directionalLight&&(p=rp(this.directionalLight));for(const v in this._mergedSourceCaches)this._mergedSourceCaches[v].update(c,void 0,void 0,p)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const p=this._sourceCaches[c];p.resume(),p.reload()}}_updatePlacement(c,p,v,w,C,M,I=!1){let F=!1,B=!1;const j={},Z={};for(const K of this._mergedOrder){const J=this._mergedLayers[K];if("symbol"!==J.type)continue;const ne=f.am(J.source,J.scope);let re=j[ne];if(!re){const se=this.getLayerSourceCache(J);if(!se)continue;const ge=se.getRenderableIds(!0).map(ae=>se.getTileByID(ae));Z[ne]=ge.slice(),re=j[ne]=ge.sort((ae,ce)=>ce.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(ce.tileID)?-1:1))}const ie=this.crossTileSymbolIndex.addLayer(J,re,p.center.lng,p.projection);F=F||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||0===w,this._layerOrderChanged&&this.fire(new f.g("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.e.now(),p.zoom))&&(this.pauseablePlacement=new x_(p,this._mergedOrder,I,v,w,C,this.placement,this.fog&&p.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,Z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.e.now()),B=!0),F&&this.pauseablePlacement.placement.setStale()),B||F){this._buildingIndex.onNewFrame(p.zoom);for(let K=0;K<this._mergedOrder.length;K++){const J=this._mergedLayers[this._mergedOrder[K]];if("symbol"!==J.type)continue;const ne=this.isLayerClipped(J)&&this._clipLayerIndices.some(re=>K<re);this.placement.updateLayerOpacities(J,j[f.am(J.source,J.scope)],K,ne?M:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.e.now())}}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}addImport(c,p){this._checkLoaded();const v=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==v.findIndex(({id:C})=>C===c.id))return void this.fire(new f.f(new Error(`Import with id '${c.id}' already exists in the map's style.`)));if(!p)return v.push(c),this._loadImports([c],!0);const w=v.findIndex(({id:C})=>C===p);return-1===w&&this.fire(new f.f(new Error(`Import with id "${p}" does not exist on this map.`))),this.stylesheet.imports=v.slice(0,w).concat(c).concat(v.slice(w)),this._loadImports([c],!0,p)}updateImport(c,p){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(c);return-1===w?this:"string"==typeof p?(this.setImportUrl(c,p),this):(p.url&&p.url!==v[w].url&&this.setImportUrl(c,p.url),f.d(p.config,v[w].config)||this.setImportConfig(c,p.config),f.d(p.data,v[w].data)||this.setImportData(c,p.data),this)}moveImport(c,p){this._checkLoaded();let v=this.stylesheet.imports||[];const w=this.getImportIndex(c);if(-1===w)return this;const C=this.getImportIndex(p);if(-1===C)return this;const M=v[w],I=this.fragments[w];return v=v.filter(({id:F})=>F!==c),this.fragments=this.fragments.filter(({id:F})=>F!==c),this.stylesheet.imports=v.slice(0,C).concat(M).concat(v.slice(C)),this.fragments=this.fragments.slice(0,C).concat(I).concat(this.fragments.slice(C)),this.mergeLayers(),this}setImportUrl(c,p){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(c);if(-1===w)return this;v[w].url=p;const C=this.fragments[w];return C.style=this._createFragmentStyle(v[w]),C.style.on("style.import.load",()=>this.mergeAll()),C.style.loadURL(p),this}setImportData(c,p){this._checkLoaded();const v=this.getImportIndex(c),w=this.stylesheet.imports||[];return-1===v?this:p?(this.fragments[v].style.setState(p),this._reloadImports(),this):(delete w[v].data,this.setImportUrl(c,w[v].url))}setImportConfig(c,p){this._checkLoaded();const v=this.getImportIndex(c),w=this.stylesheet.imports||[];if(-1===v)return this;p?w[v].config=p:delete w[v].config;const C=this.fragments[v],M=C.style.stylesheet&&C.style.stylesheet.schema;return C.config=p,C.style.updateConfig(p,M),this.updateConfigDependencies(),this}removeImport(c){this._checkLoaded();const p=this.stylesheet.imports||[],v=this.getImportIndex(c);-1!==v&&(p.splice(v,1),this.fragments[v].style._remove(),this.fragments.splice(v,1),this._reloadImports())}getImportIndex(c){const p=(this.stylesheet.imports||[]).findIndex(v=>v.id===c);return-1===p&&this.fire(new f.f(new Error(`Import '${c}' does not exist in the map's style and cannot be updated.`))),p}getLayer(c){return this._mergedLayers[c]}getSources(){const c=[];for(const p in this._mergedOtherSourceCaches){const v=this._mergedOtherSourceCaches[p];v&&c.push(v.getSource())}return c}getSource(c,p){const v=this.getSourceCache(c,p);return v&&v.getSource()}getLayerSource(c){const p=this.getLayerSourceCache(c);return p&&p.getSource()}getSourceCache(c,p){const v=f.am(c,p);return this._mergedOtherSourceCaches[v]}getLayerSourceCache(c){const p=f.am(c.source,c.scope);return"symbol"===c.type?this._mergedSymbolSourceCaches[p]:this._mergedOtherSourceCaches[p]}getSourceCaches(c){if(null==c)return Object.values(this._mergedSourceCaches);const p=[];return this._mergedOtherSourceCaches[c]&&p.push(this._mergedOtherSourceCaches[c]),this._mergedSymbolSourceCaches[c]&&p.push(this._mergedSymbolSourceCaches[c]),p}updateSourceCaches(){const c=this._changes.getUpdatedSourceCaches();for(const p in c){const v=c[p];"reload"===v?this.reloadSource(p):"clear"===v&&this.clearSource(p)}}updateLayers(c){const p=this._changes.getUpdatedPaintProperties();for(const v of p){const w=this.getLayer(v);w&&w.updateTransitions(c)}}getImages(c,p,v){this.imageManager.getImages(p.icons,p.scope,v),this._updateTilesForChangedImages();const w=C=>{C&&C.setDependencies(p.tileID.key,p.type,p.icons)};w(this._otherSourceCaches[p.source]),w(this._symbolSourceCaches[p.source])}getGlyphs(c,p,v){this.glyphManager.getGlyphs(p.stacks,p.scope,v)}getResource(c,p,v){return f.d2(p,v)}getOwnSourceCache(c){return this._otherSourceCaches[c]}getOwnLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}getOwnSourceCaches(c){const p=[];return this._otherSourceCaches[c]&&p.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&p.push(this._symbolSourceCaches[c]),p}_isSourceCacheLoaded(c){const p=this.getOwnSourceCaches(c);return 0===p.length?(this.fire(new f.f(new Error(`There is no source with ID '${c}'`))),!1):p.every(v=>v.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(c,p){if(0===this._clipLayerIndices.length&&"fill-extrusion"!==c.type)return!1;const v="fill-extrusion"===c.type&&"building"===c.sourceLayer;let w=0;if(c.is3D()){if(v||p&&"batched-model"===p.type)return!0;"model"===c.type&&(w=f.cw.Model)}else"symbol"===c.type&&(w=f.cw.Symbol);for(const C of this._clipLayerIndices){const M=this._mergedLayers[this._mergedOrder[C]];if(!M)continue;const I=[];for(const F of M.layout.get("clip-layer-types"))I.push("model"===F?f.cw.Model:"symbol"===F?f.cw.Symbol:f.cw.FillExtrusion);for(const F of I)if(w&F)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(c=>{c.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function T_(y,c){let p=!1,v=null;const w=()=>{v=null,p&&(y(),v=setTimeout(w,c),p=!1)};return()=>(p=!0,v||w(),v)}gl.getSourceType=function(y){return a_[y]},gl.setSourceType=function(y,c){a_[y]=c},gl.registerForPluginStateChange=f.cO;class Wm{constructor(c){this._hashName=c&&encodeURIComponent(c),f.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=T_(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const p=up(c);if(this._hashName){const v=this._hashName;let w=!1;const C=location.hash.slice(1).split("&").map(M=>{const I=M.split("=")[0];return I===v?(w=!0,`${I}=${p}`):M}).filter(M=>M);return w||C.push(`${v}=${p}`),`#${C.join("&")}`}return`#${p}`}_getCurrentHash(){const c=location.hash.replace("#","");if(this._hashName){let p;return c.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(p=v)}),(p&&p[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(v=>isNaN(v))){const v=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(p[3]||0):c.getBearing();return c.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:v,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function up(y,c){const p=y.getCenter(),v=Math.round(100*y.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),M=Math.round(p.lng*C)/C,I=Math.round(p.lat*C)/C,F=y.getBearing(),B=y.getPitch();let j=c?`/${M}/${I}/${v}`:`${v}/${I}/${M}`;return(F||B)&&(j+="/"+Math.round(10*F)/10),B&&(j+=`/${Math.round(B)}`),j}const Fa={linearity:.3,easing:f.d3(0,0,.3,1)},qd=f.Q({deceleration:2500,maxSpeed:1400},Fa),dT=f.Q({deceleration:20,maxSpeed:1400},Fa),j1=f.Q({deceleration:1e3,maxSpeed:360},Fa),Ux=f.Q({deceleration:1e3,maxSpeed:90},Fa);class $1{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.e.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,p=f.e.now();for(;c.length>0&&p-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const p={zoom:0,bearing:0,pitch:0,pan:new f.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)p.zoom+=C.zoomDelta||0,p.bearing+=C.bearingDelta||0,p.pitch+=C.pitchDelta||0,C.panDelta&&p.pan._add(C.panDelta),C.around&&(p.around=C.around),C.pinchAround&&(p.pinchAround=C.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(p.pan.mag()){const C=Xd(p.pan.mag(),v,f.Q({},qd,c||{}));w.offset=p.pan.mult(C.amount/p.pan.mag()),w.center=this._map.transform.center,Zd(w,C)}if(p.zoom){const C=Xd(p.zoom,v,dT);w.zoom=this._map.transform.zoom+C.amount,Zd(w,C)}if(p.bearing){const C=Xd(p.bearing,v,j1);w.bearing=this._map.transform.bearing+f.au(C.amount,-179,179),Zd(w,C)}if(p.pitch){const C=Xd(p.pitch,v,Ux);w.pitch=this._map.transform.pitch+C.amount,Zd(w,C)}if(w.zoom||w.bearing){const C=void 0===p.pinchAround?p.around:p.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Zd(y,c){(!y.duration||y.duration<c.duration)&&(y.duration=c.duration,y.easing=c.easing)}function Xd(y,c,p){const{maxSpeed:v,linearity:w,deceleration:C}=p,M=f.au(y*w/(c/1e3),-v,v),I=Math.abs(M)/(C*w);return{easing:p.easing,duration:1e3*I,amount:M*(I/2)}}class _l extends f.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,v,w={}){const C=Ni(p.getCanvasContainer(),v),M=p.unproject(C);super(c,f.Q({point:C,lngLat:M,originalEvent:v},w)),this._defaultPrevented=!1,this.target=p}}class qm extends f.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,v){const w="touchend"===c?v.changedTouches:v.touches,C=Oi(p.getCanvasContainer(),w),M=C.map(F=>p.unproject(F)),I=C.reduce((F,B,j,Z)=>F.add(B.div(Z.length)),new f.P(0,0));super(c,{points:C,point:I,lngLats:M,lngLat:p.unproject(I),originalEvent:v}),this._defaultPrevented=!1}}class Zm extends f.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p){super("wheel",{originalEvent:p}),this._defaultPrevented=!1}}class E_{constructor(c,p){this._map=c,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Zm(this._map,c))}mousedown(c,p){return this._mousedownPos=p,this._firePreventable(new _l(c.type,this._map,c))}mouseup(c){this._map.fire(new _l(c.type,this._map,c))}preclick(c){const p=f.Q({},c);p.type="preclick",this._map.fire(new _l(p.type,this._map,p))}click(c,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(c),this._map.fire(new _l(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new _l(c.type,this._map,c))}mouseover(c){this._map.fire(new _l(c.type,this._map,c))}mouseout(c){this._map.fire(new _l(c.type,this._map,c))}touchstart(c){return this._firePreventable(new qm(c.type,this._map,c))}touchmove(c){this._map.fire(new qm(c.type,this._map,c))}touchend(c){this._map.fire(new qm(c.type,this._map,c))}touchcancel(c){this._map.fire(new qm(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class H1{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new _l(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _l("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new _l(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class da{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,p){this.isEnabled()&&c.shiftKey&&0===c.button&&(ki(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(c,p){if(!this._active)return;const v=p,w=this._startPos,C=this._lastPos;if(!w||!C||C.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=Hr("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const M=Math.min(w.x,v.x),I=Math.max(w.x,v.x),F=Math.min(w.y,v.y),B=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${F}px)`,this._box.style.width=I-M+"px",this._box.style.height=B-F+"px")})}mouseupWindow(c,p){if(!this._active)return;const v=this._startPos,w=p;if(v&&0===c.button){if(this.reset(),sa(),v.x!==w.x||v.y!==w.y)return this._map.fire(new f.g("boxzoomend",{originalEvent:c})),{cameraAnimation:C=>C.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),eo(),delete this._startPos,delete this._lastPos}_fireEvent(c,p){return this._map.fire(new f.g(c,{originalEvent:p}))}}function Xm(y,c){const p={};for(let v=0;v<y.length;v++)p[y[v].identifier]=c[v];return p}class G1{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,p,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const C=new f.P(0,0);for(const M of w)C._add(M);return C.div(w.length)}(p),this.touches=Xm(v,p)))}touchmove(c,p,v){if(this.aborted||!this.centroid)return;const w=Xm(v,p);for(const C in this.touches){const M=w[C];(!M||M.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(c,p,v){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Yd{constructor(c){this.singleTap=new G1(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,p,v){this.singleTap.touchstart(c,p,v)}touchmove(c,p,v){this.singleTap.touchmove(c,p,v)}touchend(c,p,v){const w=this.singleTap.touchend(c,p,v);if(w){const C=c.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(w)<30;if(C&&M||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Ym{constructor(){this._zoomIn=new Yd({numTouches:1,numTaps:2}),this._zoomOut=new Yd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,p,v){this._zoomIn.touchstart(c,p,v),this._zoomOut.touchstart(c,p,v)}touchmove(c,p,v){this._zoomIn.touchmove(c,p,v),this._zoomOut.touchmove(c,p,v)}touchend(c,p,v){const w=this._zoomIn.touchend(c,p,v),C=this._zoomOut.touchend(c,p,v);return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(w)},{originalEvent:c})}):C?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(C)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const C_={0:1,2:2};class Km{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,p){return!1}_move(c,p){return{}}mousedown(c,p){if(this._lastPoint)return;const v=lo(c);this._correctButton(c,v)&&(this._lastPoint=p,this._eventButton=v)}mousemoveWindow(c,p){const v=this._lastPoint;if(v)if(c.preventDefault(),null!=this._eventButton&&function(w,C){const M=C_[C];return void 0===w.buttons||(w.buttons&M)!==M}(c,this._eventButton))this.reset();else if(this._moved||!(p.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(v,p)}mouseupWindow(c){this._lastPoint&&lo(c)===this._eventButton&&(this._moved&&sa(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dp extends Km{mousedown(c,p){super.mousedown(c,p),this._lastPoint&&(this._active=!0)}_correctButton(c,p){return 0===p&&!c.ctrlKey}_move(c,p){return{around:p,panDelta:p.sub(c)}}}class Jm extends Km{_correctButton(c,p){return 0===p&&c.ctrlKey||2===p}_move(c,p){const v=.8*(p.x-c.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(c){c.preventDefault()}}class S_ extends Km{_correctButton(c,p){return 0===p&&c.ctrlKey||2===p}_move(c,p){const v=-.5*(p.y-c.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(c){c.preventDefault()}}class Vx{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),f.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.P(0,0)}touchstart(c,p,v){return this._calculateTransform(c,p,v)}touchmove(c,p,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length&&!f.d4())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,p,v)}}touchend(c,p,v){this._calculateTransform(c,p,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,p,v){v.length>0&&(this._active=!0);const w=Xm(v,p),C=new f.P(0,0),M=new f.P(0,0);let I=0;for(const B in w){const j=w[B],Z=this._touches[B];Z&&(C._add(j),M._add(j.sub(Z)),I++,w[B]=j)}if(this._touches=w,I<this._minTouches||!M.mag())return;const F=M.div(I);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(I),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Hr("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Lr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,p,v){return{}}touchstart(c,p,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([p[0],p[1]]))}touchmove(c,p,v){const w=this._firstTwoTouches;if(!w)return;c.preventDefault();const[C,M]=w,I=hf(v,p,C),F=hf(v,p,M);if(!I||!F)return;const B=this._aroundCenter?null:I.add(F).div(2);return this._move([I,F],B,c)}touchend(c,p,v){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,M=hf(v,p,w),I=hf(v,p,C);M&&I||(this._active&&sa(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function hf(y,c,p){for(let v=0;v<y.length;v++)if(y[v].identifier===p)return c[v]}function hp(y,c){return Math.log(y/c)/Math.LN2}class Wi extends Lr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,p){const v=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(hp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hp(this._distance,v),pinchAround:p}}}function D_(y,c){return 180*y.angleWith(c)/Math.PI}class Sn extends Lr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,p){const v=this._vector;if(this._vector=c[0].sub(c[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:D_(this._vector,v),pinchAround:p}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const p=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=D_(c,v);return Math.abs(w)<p}}function uo(y){return Math.abs(y.y)>Math.abs(y.x)}class di extends Lr{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,uo(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,p,v){const w=this._lastPoints;if(!w)return;const C=c[0].sub(w[0]),M=c[1].sub(w[1]);return this._map._cooperativeGestures&&!f.d4()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(C,M,v.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+M.y)/2*-.5})}gestureBeginsVertically(c,p,v){if(void 0!==this._valid)return this._valid;const w=c.mag()>=2,C=p.mag()>=2;if(!w&&!C)return;if(!w||!C)return null==this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const M=c.y>0==p.y>0;return uo(c)&&uo(p)&&M}}const ko={panStep:100,bearingStep:15,pitchStep:10};class ha{constructor(){const c=ko;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let p=0,v=0,w=0,C=0,M=0;switch(c.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),C=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),C=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),M=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:I=>{const F=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Kd,zoom:p?Math.round(F)+p*(c.shiftKey?2:1):F,bearing:I.getBearing()+v*this._bearingStep,pitch:I.getPitch()+w*this._pitchStep,offset:[-C*this._panStep,-M*this._panStep],center:I.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Kd(y){return y*(2-y)}const Oo=4.000244140625,M_=1/450;class A_{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._handler=p,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=M_,f.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||f.d4()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const v=f.e.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==p&&p%Oo==0?this._type="wheel":0!==p&&Math.abs(p)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=p,this._timeout=window.setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),c.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=c,this._delta-=p,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=Ni(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const B="wheel"===this._type&&Math.abs(this._delta)>Oo?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&0!==j&&(j=1/j);const Z=p(),K=Math.pow(2,Z),J="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(J*j))),"wheel"===this._type&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:p(),w=this._startZoom,C=this._easing;let M,I=!1;if("wheel"===this._type&&w&&C){const B=Math.min((f.e.now()-this._lastWheelEventTime)/200,1),j=C(B);M=f.a3(w,v,j),B<1?this._frameId||(this._frameId=!0):I=!0}else M=v,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let F=M-p();return F*this._lastDelta<0&&(F=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:F,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let p=f.d5;if(this._prevEase){const v=this._prevEase,w=(f.e.now()-v.start)/v.duration,C=v.easing(w+.01)-v.easing(w),M=.27/Math.sqrt(C*C+1e-4)*.01,I=Math.sqrt(.0729-M*M);p=f.d3(M,I,.25,1)}return this._prevEase={start:f.e.now(),duration:c,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Hr("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class fp{constructor(c,p){this._clickZoom=c,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jx{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,p){return c.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(c.shiftKey?-1:1),around:v.unproject(p)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $x{constructor(){this._tap=new Yd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,p,v){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=p[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(c,p,v))}touchmove(c,p,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=p[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,p,v)}touchend(c,p,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(c,p,v)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qm{constructor(c,p,v){this._el=c,this._mousePan=p,this._touchPan=v}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class eg{constructor(c,p,v){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=p,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ff{constructor(c,p,v,w){this._el=c,this._touchZoom=p,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const pp=y=>y.zoom||y.drag||y.pitch||y.rotate;class La extends f.g{}class Hx{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,p){const v=f.$.sub([],p,c);this.radius=f.$.length(v[2]<0?f.$.div([],v,this.constants):[v[0],v[1],0])}projectRay(c){f.$.div(c,c,this.constants),f.$.normalize(c,c),f.$.mul(c,c,this.constants);const p=f.$.scale([],c,this.radius);if(p[2]>0){const v=f.$.scale([],[0,0,1],f.$.dot(p,[0,0,1])),w=f.$.scale([],f.$.normalize([],[p[0],p[1],0]),this.radius),C=f.$.add([],p,f.$.scale([],f.$.sub([],f.$.add([],w,v),p),2));p[0]=C[0],p[1]=C[1]}return p}}function qu(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class I_{constructor(c,p){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $1(c),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Hx,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),f.br(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,C,M]of this._listeners){const I=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(C,I,M)}}destroy(){for(const[c,p,v]of this._listeners){const w=c===document?this.handleWindowEvent:this.handleEvent;c.removeEventListener(p,w,v)}}_addDefaultHandlers(c){const p=this._map,v=p.getCanvasContainer();this._add("mapEvent",new E_(p,c));const w=p.boxZoom=new da(p,c);this._add("boxZoom",w);const C=new Ym,M=new jx;p.doubleClickZoom=new fp(M,C),this._add("tapZoom",C),this._add("clickZoom",M);const I=new $x;this._add("tapDragZoom",I);const F=p.touchPitch=new di(p);this._add("touchPitch",F);const B=new Jm(c),j=new S_(c);p.dragRotate=new eg(c,B,j),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const Z=new dp(c),K=new Vx(p,c);p.dragPan=new Qm(v,Z,K),this._add("mousePan",Z),this._add("touchPan",K,["touchZoom","touchRotate"]);const J=new Sn,ne=new Wi;p.touchZoomRotate=new ff(v,ne,J,I),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),this._add("blockableMapEvent",new H1(p));const re=p.scrollZoom=new A_(p,this);this._add("scrollZoom",re,["mousePan"]);const ie=p.keyboard=new ha;this._add("keyboard",ie);for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[se]&&p[se].enable(c[se])}_add(c,p,v){this._handlers.push({handlerName:c,handler:p,allowed:v}),this._handlersById[c]=p}stop(c){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,p,v){for(const w in c)if(w!==v&&(!p||p.indexOf(w)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const p=[];for(const v of c)this._el.contains(v.target)&&p.push(v);return p}handleEvent(c,p){this._updatingCamera=!0;const v="renderFrame"===c.type,w=v?void 0:c,C={needsRenderFrame:!1},M={},I={},F=c.touches?this._getMapTouches(c.touches):void 0,B=F?Oi(this._el,F):v?void 0:Ni(this._el,c);for(const{handlerName:K,handler:J,allowed:ne}of this._handlers){if(!J.isEnabled())continue;let re;this._blockedByActive(I,ne,K)?J.reset():J[p||c.type]&&(re=J[p||c.type](c,B,F),this.mergeHandlerResult(C,M,re,K,w),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||J.isActive())&&(I[K]=J)}const j={};for(const K in this._previousActiveHandlers)I[K]||(j[K]=w);this._previousActiveHandlers=I,(Object.keys(j).length||qu(C))&&(this._changes.push([C,M,j]),this._triggerRenderFrame()),(Object.keys(I).length||qu(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=C;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(c,p,v,w,C){if(!v)return;f.Q(c,v);const M={handlerName:w,originalEvent:v.originalEvent||C};void 0!==v.zoomDelta&&(p.zoom=M),void 0!==v.panDelta&&(p.drag=M),void 0!==v.pitchDelta&&(p.pitch=M),void 0!==v.bearingDelta&&(p.rotate=M)}_applyChanges(){const c={},p={},v={};for(const[w,C,M]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new f.P(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(c.around=w.around),void 0!==w.aroundCoord&&(c.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),f.Q(p,C),f.Q(v,M);this._updateMapTransform(c,p,v),this._changes=[]}_updateMapTransform(c,p,v){const w=this._map,C=w.transform,M=ge=>[ge.x,ge.y,ge.z];if((ge=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!qu(c)){const ge=C.zoom;C.cameraElevationReference="sea",null!=this._originalZoom&&C._orthographicProjectionAtLowPitch&&"globe"!==C.projection.name&&0===C.pitch?(C.cameraElevationReference="ground",C.zoom=this._originalZoom):(C.recenterOnTerrain(),C.cameraElevationReference="ground"),ge!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&w._stop(!0),!qu(c))return void this._fireEvents(p,v,!0);let{panDelta:I,zoomDelta:F,bearingDelta:B,pitchDelta:j,around:Z,aroundCoord:K,pinchAround:J}=c;C._isCameraConstrained&&(F>0&&(F=0),C._isCameraConstrained=!1),void 0!==J&&(Z=J),(F||(ge=>p.drag&&!this._eventsInProgress.drag)())&&Z&&(this._dragOrigin=M(C.pointCoordinate3D(Z)),this._originalZoom=C.zoom,this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",w._stop(!0),Z=Z||w.transform.centerPoint,B&&(C.bearing+=B),j&&(C.pitch+=j),C._updateCameraState();const ne=[0,0,0];if(I)if("mercator"===C.projection.name){const ge=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(Z).dir),ae=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(Z.sub(I)).dir);ne[0]=ae[0]-ge[0],ne[1]=ae[1]-ge[1]}else{const ge=C.pointCoordinate(Z);if("globe"===C.projection.name){I=I.rotate(-C.angle);const ae=C._pixelsPerMercatorPixel/C.worldSize;ne[0]=-I.x*f.d6(f.az(ge.y))*ae,ne[1]=-I.y*f.d6(C.center.lat)*ae}else{const ae=C.pointCoordinate(Z.sub(I));ge&&ae&&(ne[0]=ae.x-ge.x,ne[1]=ae.y-ge.y)}}const re=C.zoom,ie=[0,0,0];if(F){const ge=M(K||C.pointCoordinate3D(Z)),ae={dir:f.$.normalize([],f.$.sub([],ge,C._camera.position))};if(ae.dir[2]<0){const ce=C.zoomDeltaToMovement(ge,F);f.$.scale(ie,ae.dir,ce)}}const se=f.$.add(ne,ne,ie);C._translateCameraConstrained(se),F&&Math.abs(C.zoom-re)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(p,v,!0)}_fireEvents(c,p,v){const w=pp(this._eventsInProgress),C=pp(c),M={};for(const j in c){const{originalEvent:Z}=c[j];this._eventsInProgress[j]||(M[`${j}start`]=Z),this._eventsInProgress[j]=c[j]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const j in M)this._fireEvent(j,M[j]);C&&this._fireEvent("move",C.originalEvent);for(const j in c){const{originalEvent:Z}=c[j];this._fireEvent(j,Z)}const I={};let F;for(const j in this._eventsInProgress){const{handlerName:Z,originalEvent:K}=this._eventsInProgress[j];this._handlersById[Z].isActive()||(delete this._eventsInProgress[j],F=p[Z]||K,I[`${j}end`]=F)}for(const j in I)this._fireEvent(j,I[j]);const B=pp(this._eventsInProgress);if(v&&(w||C)&&!B){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=K=>0!==K&&-this._bearingSnap<K&&K<this._bearingSnap;j?(Z(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:F})):(this._map.fire(new f.g("moveend",{originalEvent:F})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,p){this._map.fire(new f.g(c,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new La("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const mp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class k_ extends f.E{constructor(c,p){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,this._respectPrefersReducedMotion=!1!==p.respectPrefersReducedMotion,f.br(["_renderFrameCallback"],this)}getCenter(){return new f.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(c,p){return this.jumpTo({center:c},p)}panBy(c,p,v){return c=f.P.convert(c).mult(-1),this.panTo(this.transform.center,f.Q({offset:c},p),v)}panTo(c,p,v){return this.easeTo(f.Q({center:c},p),v)}getZoom(){return this.transform.zoom}setZoom(c,p){return this.jumpTo({zoom:c},p),this}zoomTo(c,p,v){return this.easeTo(f.Q({zoom:c},p),v)}zoomIn(c,p){return this.zoomTo(this.getZoom()+1,c,p),this}zoomOut(c,p){return this.zoomTo(this.getZoom()-1,c,p),this}getBearing(){return this.transform.bearing}setBearing(c,p){return this.jumpTo({bearing:c},p),this}getPadding(){return this.transform.padding}setPadding(c,p){return this.jumpTo({padding:c},p),this}rotateTo(c,p,v){return this.easeTo(f.Q({bearing:c},p),v)}resetNorth(c,p){return this.rotateTo(0,f.Q({duration:1e3},c),p),this}resetNorthPitch(c,p){return this.easeTo(f.Q({bearing:0,pitch:0,duration:1e3},c),p),this}snapToNorth(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this}getPitch(){return this.transform.pitch}setPitch(c,p){return this.jumpTo({pitch:c},p),this}cameraForBounds(c,p){c=f.aj.convert(c);const v=p&&p.bearing||0,w=p&&p.pitch||0,C=c.getNorthWest(),M=c.getSouthEast();return this._cameraForBounds(this.transform,C,M,v,w,p)}_extendPadding(c){const p={top:0,right:0,bottom:0,left:0};return null==c?f.Q({},p,this.transform.padding):"number"==typeof c?{top:c,bottom:c,right:c,left:c}:f.Q({},p,c)}_extendCameraOptions(c){return(c=f.Q({offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=this._extendPadding(c.padding),c}_minimumAABBFrustumDistance(c,p){const v=p.max[0]-p.min[0],w=p.max[1]-p.min[1];return v/w>c.aspect?v/(2*Math.tan(.5*c.fovX)*c.aspect):w/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,p,v,w,C,M){const I=c.clone(),F=this._extendCameraOptions(M);I.bearing=w,I.pitch=C;const B=f.aJ.convert(p),j=f.aJ.convert(v),Z=.5*(B.lat+j.lat),K=.5*(B.lng+j.lng),J=f.d7(Z,K),ne=f.$.normalize([],J),re=f.$.normalize([],f.$.cross([],ne,[0,1,0])),ie=f.$.cross([],re,ne),se=[re[0],re[1],re[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],0,0,0,0,1],ge=[J,f.d7(B.lat,B.lng),f.d7(j.lat,B.lng),f.d7(j.lat,j.lng),f.d7(B.lat,j.lng),f.d7(Z,B.lng),f.d7(Z,j.lng),f.d7(B.lat,K),f.d7(j.lat,K)];let ae=f.b8.fromPoints(ge.map(Pe=>[f.$.dot(re,Pe),f.$.dot(ie,Pe),f.$.dot(ne,Pe)]));const ce=f.$.transformMat4([],ae.center,se);0===f.$.squaredLength(ce)&&f.$.set(ce,0,0,1),f.$.normalize(ce,ce),f.$.scale(ce,ce,f.cF),I.center=f.d8(ce);const xe=I.getWorldToCameraMatrix(),ve=f.ae.invert(new Float64Array(16),xe);ae=f.b8.applyTransform(ae,f.ae.multiply([],xe,se));const ye=this._extendAABB(ae,I,F,w);if(!ye)return void f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=ye,f.$.transformMat4(ce,ce,xe);const Ce=.5*(ae.max[2]-ae.min[2]),Me=this._minimumAABBFrustumDistance(I,ae),Le=f.$.scale([],[0,0,1],Ce),Se=f.$.add(Le,ce,Le),we=Me+(0===I.pitch?0:f.$.distance(ce,Se)),Ue=I.globeCenterInViewSpace,et=f.$.sub([],ce,[Ue[0],Ue[1],Ue[2]]);f.$.normalize(et,et),f.$.scale(et,et,we);const Fe=f.$.add([],ce,et);f.$.transformMat4(Fe,Fe,ve);const Mt=f.da/f.cF,pt=f.$.length(Fe),qe=f.ay(Math.max(pt*Mt-f.da,Number.EPSILON),0),at=Math.min(I.zoomFromMercatorZAdjusted(qe),F.maxZoom);return at>.5*(f.b3+f.aV)?(I.setProjection({name:"mercator"}),I.zoom=at,this._cameraForBounds(I,p,v,w,C,M)):{center:I.center,zoom:at,bearing:w,pitch:C}}_extendAABB(c,p,v,w){const C=.5*((v.padding.left||0)+(v.padding.right||0)),M=.5*((v.padding.top||0)+(v.padding.bottom||0)),I=M,F=C,B=C,j=M,Z=p.width-(F+B),K=p.height-(I+j),J=f.$.sub([],c.max,c.min),ne=Math.min(Z/J[0],K/J[1]),re=Math.min(p.scaleZoom(p.scale*ne),v.maxZoom);if(isNaN(re))return null;const ie=p.scale/p.zoomScale(re),se=new f.b8([c.min[0]-F*ie,c.min[1]-j*ie,c.min[2]],[c.max[0]+B*ie,c.max[1]+I*ie,c.max[2]]),ge=("number"==typeof v.offset.x&&"number"==typeof v.offset.y?new f.P(v.offset.x,v.offset.y):f.P.convert(v.offset)).rotate(-f.ac(w));return se.center[0]-=ge.x*ie,se.center[1]+=ge.y*ie,se}queryTerrainElevation(c,p){const v=this.transform.elevation;return v?(p=f.Q({},{exaggerated:!0},p),v.getAtPoint(f._.fromLngLat(c),null,p.exaggerated)):null}_cameraForBounds(c,p,v,w,C,M){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,p,v,w,C,M);const I=c.clone(),F=this._extendCameraOptions(M);I.bearing=w,I.pitch=C;const B=f.aJ.convert(p),j=f.aJ.convert(v),Z=new f.aJ(B.lng,j.lat),K=new f.aJ(j.lng,B.lat),J=I.project(B),ne=I.project(j),re=this.queryTerrainElevation(B),ie=this.queryTerrainElevation(j),se=this.queryTerrainElevation(Z),ge=this.queryTerrainElevation(K),ae=[[J.x,J.y,Math.min(re||0,ie||0,se||0,ge||0)],[ne.x,ne.y,Math.max(re||0,ie||0,se||0,ge||0)]];let ce=f.b8.fromPoints(ae);const xe=I.getWorldToCameraMatrix(),ve=f.ae.invert(new Float64Array(16),xe);ce=f.b8.applyTransform(ce,xe);const ye=this._extendAABB(ce,I,F,w);if(!ye)return void f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=ye;const Ce=.5*f.$.sub([],ce.max,ce.min)[2],Me=this._minimumAABBFrustumDistance(I,ce),Le=[0,0,1,0];f.aB.transformMat4(Le,Le,xe),f.aB.normalize(Le,Le);const Se=f.$.scale([],Le,Me+Ce),we=f.$.add([],ce.center,Se);f.$.transformMat4(ce.center,ce.center,ve),f.$.transformMat4(we,we,ve);const Ue=[ce.center[0],ce.center[1],we[2]*I.pixelsPerMeter];f.$.scale(Ue,Ue,1/I.worldSize);const et=f.d9(Ue[0]),Fe=f.az(Ue[1]),Mt=Math.min(I._zoomFromMercatorZ(Ue[2]),F.maxZoom),pt=new f.aJ(et,Fe);return I.mercatorFromTransition&&Mt<.5*(f.b3+f.aV)?(I.setProjection({name:"globe"}),I.zoom=Mt,this._cameraForBounds(I,p,v,w,C,M)):{center:pt,zoom:Mt,bearing:w,pitch:C}}fitBounds(c,p,v){const w=this.cameraForBounds(c,p);return this._fitInternal(w,p,v)}fitScreenCoordinates(c,p,v,w,C){const M=f.P.convert(c),I=f.P.convert(p),F=new f.P(Math.min(M.x,I.x),Math.min(M.y,I.y)),B=new f.P(Math.max(M.x,I.x),Math.max(M.y,I.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(M,I))return this;const j=this.transform.pointLocation3D(F),Z=this.transform.pointLocation3D(B),K=this.transform.pointLocation3D(new f.P(F.x,B.y)),J=this.transform.pointLocation3D(new f.P(B.x,F.y)),ne=[Math.min(j.lng,Z.lng,K.lng,J.lng),Math.min(j.lat,Z.lat,K.lat,J.lat)],re=[Math.max(j.lng,Z.lng,K.lng,J.lng),Math.max(j.lat,Z.lat,K.lat,J.lat)],ie=w&&w.pitch?w.pitch:this.getPitch(),se=this._cameraForBounds(this.transform,ne,re,v,ie,w);return this._fitInternal(se,w,C)}_fitInternal(c,p,v){return c?(p=f.Q(c,p)).linear?this.easeTo(p,v):this.flyTo(p,v):this}jumpTo(c,p){this.stop();const v=c.preloadOnly?this.transform.clone():this.transform;let w=!1,C=!1,M=!1;if("zoom"in c&&v.zoom!==+c.zoom&&(w=!0,v.zoom=+c.zoom),void 0!==c.center&&(v.center=f.aJ.convert(c.center)),"bearing"in c&&v.bearing!==+c.bearing&&(C=!0,v.bearing=+c.bearing),"pitch"in c&&v.pitch!==+c.pitch&&(M=!0,v.pitch=+c.pitch),null!=c.padding){const I="number"==typeof c.padding?this._extendPadding(c.padding):c.padding;v.isPaddingEqual(I)||(v.padding=I)}return c.preloadOnly?(this._preloadTiles(v),this):(this.fire(new f.g("movestart",p)).fire(new f.g("move",p)),w&&this.fire(new f.g("zoomstart",p)).fire(new f.g("zoom",p)).fire(new f.g("zoomend",p)),C&&this.fire(new f.g("rotatestart",p)).fire(new f.g("rotate",p)).fire(new f.g("rotateend",p)),M&&this.fire(new f.g("pitchstart",p)).fire(new f.g("pitch",p)).fire(new f.g("pitchend",p)),this.fire(new f.g("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.w(mp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,p){const v=this.transform;if(!v.projection.supportsFreeCamera)return f.w(mp),this;this.stop();const w=v.zoom,C=v.pitch,M=v.bearing;v.setFreeCameraOptions(c);const I=w!==v.zoom,F=C!==v.pitch,B=M!==v.bearing;return this.fire(new f.g("movestart",p)).fire(new f.g("move",p)),I&&this.fire(new f.g("zoomstart",p)).fire(new f.g("zoom",p)).fire(new f.g("zoomend",p)),B&&this.fire(new f.g("rotatestart",p)).fire(new f.g("rotate",p)).fire(new f.g("rotateend",p)),F&&this.fire(new f.g("pitchstart",p)).fire(new f.g("pitch",p)).fire(new f.g("pitchend",p)),this.fire(new f.g("moveend",p)),this}easeTo(c,p){this._stop(!1,c.easeId),(!1===(c=f.Q({offset:[0,0],duration:500,easing:f.d5},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const v=this.transform,w=this.getZoom(),C=this.getBearing(),M=this.getPitch(),I=this.getPadding(),F="zoom"in c?+c.zoom:w,B="bearing"in c?this._normalizeBearing(c.bearing,C):C,j="pitch"in c?+c.pitch:M,Z=this._extendPadding(c.padding),K=f.P.convert(c.offset);let J,ne,re;if("globe"===v.projection.name){const Me=f._.fromLngLat(v.center),Le=K.rotate(-v.angle);Me.x+=Le.x/v.worldSize,Me.y+=Le.y/v.worldSize;const Se=Me.toLngLat(),we=f.aJ.convert(c.center||Se);this._normalizeCenter(we),J=v.centerPoint.add(Le),ne=new f.P(Me.x,Me.y).mult(v.worldSize),re=new f.P(f.ak(we.lng),f.al(we.lat)).mult(v.worldSize).sub(ne)}else{J=v.centerPoint.add(K);const Me=v.pointLocation(J),Le=f.aJ.convert(c.center||Me);this._normalizeCenter(Le),ne=v.project(Me),re=v.project(Le).sub(ne)}const ie=v.zoomScale(F-w);let se,ge;c.around&&(se=f.aJ.convert(c.around),ge=v.locationPoint(se));const ae=this._zooming||F!==w,ce=this._rotating||C!==B,xe=this._pitching||j!==M,ve=!v.isPaddingEqual(Z),ye=Me=>Le=>{if(ae&&(Me.zoom=f.a3(w,F,Le)),ce&&(Me.bearing=f.a3(C,B,Le)),xe&&(Me.pitch=f.a3(M,j,Le)),ve&&(Me.interpolatePadding(I,Z,Le),J=Me.centerPoint.add(K)),se)Me.setLocationAtPoint(se,ge);else{const Se=Me.zoomScale(Me.zoom-w),we=F>w?Math.min(2,ie):Math.max(.5,ie),Ue=Math.pow(we,1-Le),et=Me.unproject(ne.add(re.mult(Le*Ue)).mult(Se));Me.setLocationAtPoint(Me.renderWorldCopies?et.wrap():et,J)}return c.preloadOnly||this._fireMoveEvents(p),Me};if(c.preloadOnly){const Me=this._emulate(ye,c.duration,v);return this._preloadTiles(Me),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=ce,this._pitching=xe,this._padding=ve,this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,Ce),this._ease(ye(v),Me=>{"sea"===v.cameraElevationReference&&v.recenterOnTerrain(),this._afterEase(p,Me)},c),this}_prepareEase(c,p,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),p||v.moving||this.fire(new f.g("movestart",c)),this._zooming&&!v.zooming&&this.fire(new f.g("zoomstart",c)),this._rotating&&!v.rotating&&this.fire(new f.g("rotatestart",c)),this._pitching&&!v.pitching&&this.fire(new f.g("pitchstart",c))}_fireMoveEvents(c){this.fire(new f.g("move",c)),this._zooming&&this.fire(new f.g("zoom",c)),this._rotating&&this.fire(new f.g("rotate",c)),this._pitching&&this.fire(new f.g("pitch",c))}_afterEase(c,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new f.g("zoomend",c)),w&&this.fire(new f.g("rotateend",c)),C&&this.fire(new f.g("pitchend",c)),this.fire(new f.g("moveend",c))}flyTo(c,p){if(this._prefersReducedMotion(c)){const at=f.ai(c,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(at,p)}this.stop(),c=f.Q({offset:[0,0],speed:1.2,curve:1.42,easing:f.d5},c);const v=this.transform,w=this.getZoom(),C=this.getBearing(),M=this.getPitch(),I=this.getPadding(),F="zoom"in c?f.au(+c.zoom,v.minZoom,v.maxZoom):w,B="bearing"in c?this._normalizeBearing(c.bearing,C):C,j="pitch"in c?+c.pitch:M,Z=this._extendPadding(c.padding),K=v.zoomScale(F-w),J=f.P.convert(c.offset);let ne=v.centerPoint.add(J);const re=v.pointLocation(ne),ie=f.aJ.convert(c.center||re);this._normalizeCenter(ie);const se=v.project(re),ge=v.project(ie).sub(se);let ae=c.curve;const ce=Math.max(v.width,v.height),xe=ce/K,ve=ge.mag();if("minZoom"in c){const at=f.au(Math.min(c.minZoom,w,F),v.minZoom,v.maxZoom),Pe=ce/v.zoomScale(at-w);ae=Math.sqrt(Pe/ve*2)}const ye=ae*ae;function Ce(at){const Pe=(xe*xe-ce*ce+(at?-1:1)*ye*ye*ve*ve)/(2*(at?xe:ce)*ye*ve);return Math.log(Math.sqrt(Pe*Pe+1)-Pe)}function Me(at){return(Math.exp(at)-Math.exp(-at))/2}function Le(at){return(Math.exp(at)+Math.exp(-at))/2}const Se=Ce(0);let we=function(at){return Le(Se)/Le(Se+ae*at)},Ue=function(at){return ce*((Le(Se)*(Me(Pe=Se+ae*at)/Le(Pe))-Me(Se))/ye)/ve;var Pe},et=(Ce(1)-Se)/ae;if(Math.abs(ve)<1e-6||!isFinite(et)){if(Math.abs(ce-xe)<1e-6)return this.easeTo(c,p);const at=xe<ce?-1:1;et=Math.abs(Math.log(xe/ce))/ae,Ue=function(){return 0},we=function(Pe){return Math.exp(at*ae*Pe)}}c.duration="duration"in c?+c.duration:1e3*et/("screenSpeed"in c?+c.screenSpeed/ae:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Fe=C!==B,Mt=j!==M,pt=!v.isPaddingEqual(Z),qe=at=>Pe=>{const wt=Pe*et,Et=1/we(wt);at.zoom=1===Pe?F:w+at.scaleZoom(Et),Fe&&(at.bearing=f.a3(C,B,Pe)),Mt&&(at.pitch=f.a3(M,j,Pe)),pt&&(at.interpolatePadding(I,Z,Pe),ne=at.centerPoint.add(J));const Qt=1===Pe?ie:at.unproject(se.add(ge.mult(Ue(wt))).mult(Et));return at.setLocationAtPoint(at.renderWorldCopies?Qt.wrap():Qt,ne),at._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(p),at};if(c.preloadOnly){const at=this._emulate(qe,c.duration,v);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=Fe,this._pitching=Mt,this._padding=pt,this._prepareEase(p,!1),this._ease(qe(v),()=>this._afterEase(p),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(c){}_cancelRenderFrame(c){}_stop(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,p)}if(!c){const v=this.handlers;v&&v.stop(!1)}return this}_ease(c,p,v){!1===v.animate||0===v.duration?(c(1),p()):(this._easeStart=f.e.now(),this._easeOptions=v,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((f.e.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,p){c=f.av(c,-180,180);const v=Math.abs(c-p);return Math.abs(c-360-p)<v&&(c-=360),Math.abs(c+360-p)<v&&(c+=360),c}_normalizeCenter(c){const p=this.transform;if(p.maxBounds||"globe"!==p.projection.name&&!p.renderWorldCopies)return;const v=c.lng-p.center.lng;c.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&f.e.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,p,v){const w=Math.ceil(15*p/1e3),C=[],M=c(v.clone());for(let I=0;I<=w;I++){const F=M(I/w);C.push(F.clone())}return C}_preloadTiles(c,p){}}class gp{constructor(c={}){this.options=c,f.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const p=this.options&&this.options.compact,v=c._getUIString("AttributionControl.ToggleAttribution");this._map=c,this._container=Hr("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Hr("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",v);const w=Hr("span","mapboxgl-ctrl-icon",this._compactButton);return w.setAttribute("aria-hidden","true"),w.setAttribute("title",v),this._innerContainer=Hr("div","mapboxgl-ctrl-attrib-inner",this._container),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===p&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.db.ACCESS_TOKEN}];if(c){const v=p.reduce((w,C,M)=>(C.value&&(w+=`${C.key}=${C.value}${M<p.length-1?"&":""}`),w),"?");c.href=`${f.db.FEEDBACK_URL}/${v}#${up(this._map,!0)}`,c.rel="noopener nofollow"}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const p=this._map.style._mergedSourceCaches;for(const w in p){const C=p[w];if(C.used){const M=C.getSource();M.attribution&&c.indexOf(M.attribution)<0&&c.push(M.attribution)}}c.sort((w,C)=>w.length-C.length),c=c.filter((w,C)=>{for(let M=C+1;M<c.length;M++)if(c[M].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const v=c.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,c.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class uu{constructor(){f.br(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Hr("div","mapboxgl-ctrl");const p=Hr("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const p in c){const v=c[p].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const p=c[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class O_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const p=++this._id;return this._queue.push({callback:c,id:p,cancelled:!1}),p}remove(c){const p=this._currentlyRunning,v=p?this._queue.concat(p):this._queue;for(const w of v)if(w.id===c)return void(w.cancelled=!0)}run(c=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const v of p)if(!v.cancelled&&(v.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function pf(y,c,p){if(y=new f.aJ(y.lng,y.lat),c){const v=new f.aJ(y.lng-360,y.lat),w=new f.aJ(y.lng+360,y.lat),C=360*Math.ceil(Math.abs(y.lng-p.center.lng)/360),M=p.locationPoint(y).distSqr(c),I=c.x<0||c.y<0||c.x>p.width||c.y>p.height;p.locationPoint(v).distSqr(c)<M&&(I||Math.abs(v.lng-p.center.lng)<C)?y=v:p.locationPoint(w).distSqr(c)<M&&(I||Math.abs(w.lng-p.center.lng)<C)&&(y=w)}for(;Math.abs(y.lng-p.center.lng)>180;){const v=p.locationPoint(y);if(v.x>=0&&v.y>=0&&v.x<=p.width&&v.y<=p.height)break;y.lng>p.center.lng?y.lng-=360:y.lng+=360}return y}const mf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class P_ extends f.E{constructor(c,p){if(super(),(c instanceof HTMLElement||p)&&(c=f.Q({element:c},p)),f.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=f.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Hr("div");const C=41,M=27,I=gs("svg",{display:"block",height:C*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${C}`},this._element),F=gs("radialGradient",{id:"shadowGradient"},gs("defs",{},I));gs("stop",{offset:"10%","stop-opacity":.4},F),gs("stop",{offset:"100%","stop-opacity":.05},F),gs("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),gs("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),gs("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),gs("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=f.P.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",C=>{C.preventDefault()}),this._element.addEventListener("mousedown",C=>{C.preventDefault()});const v=this._element.classList;for(const C in mf)v.remove(`mapboxgl-marker-anchor-${C}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`);const w=c&&c.className?c.className.trim().split(/\s+/):[];v.add(...w),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=f.aJ.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const p=c.code,v=c.charCode||c.keyCode;"Space"!==p&&"Enter"!==p&&32!==v&&13!==v||this.togglePopup()}_onMapClick(c){const p=c.originalEvent.target,v=this._element;this._popup&&(p===v||v.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,p=this._pos;if(!c||!p)return!1;const v=c.unproject(p),w=c.getFreeCameraOptions();if(!w.position)return!1;const C=w.position.toLngLat();return C.distanceTo(v)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const p=this._pos;if(!p||p.x<0||p.x>c.transform.width||p.y<0||p.y>c.transform.height)return void this._clearFadeTimer();const v=c.unproject(p);let w;c._showingGlobe()&&f.dc(c.transform,this._lngLat)?w=0:(w=1-c._queryFogOpacity(v),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${mf[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${p.x}px,${p.y}px)\n        `}_calculateXYTransform(){const c=this._pos,p=this._map,v=this.getPitchAlignment();if(!p||!c||"map"!==v)return"";if(!p._showingGlobe()){const F=p.getPitch();return F?`rotateX(${F}deg)`:""}const w=f.b1(f.dd(p.transform,this._lngLat)),C=c.sub(f.de(p.transform)),M=Math.abs(C.x)+Math.abs(C.y);if(0===M)return"";const I=w/M;return`rotateX(${-C.y*I}deg) rotateY(${C.x*I}deg)`}_calculateZTransform(){const c=this._pos,p=this._map;if(!p||!c)return"";let v=0;const w=this.getRotationAlignment();if("map"===w)if(p._showingGlobe()){const C=p.project(new f.aJ(this._lngLat.lng,this._lngLat.lat+.001)),M=p.project(new f.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);v=f.b1(Math.atan2(M.y,M.x))-90}else v=-p.getBearing();else if("horizon"===w){const C=f.a0(4,6,p.getZoom()),M=f.de(p.transform);M.y+=C*p.transform.height;const I=c.sub(M),F=f.b1(Math.atan2(I.y,I.x));v=(F>90?F-270:F+90)*(1-C)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(c){cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=pf(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat),!0===c?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=f.P.convert(c),this._update(),this}addClassName(c){return this._element.classList.add(c),this}removeClassName(c){return this._element.classList.remove(c),this}toggleClassName(c){return this._element.classList.toggle(c)}_onMove(c){const p=this._map;if(!p)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const C=this._clickTolerance||p._clickTolerance;if(c.point.dist(v)<C)return;this._isDragging=!0}this._pos=c.point.sub(w),this._lngLat=p.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.g("dragstart"))),this.fire(new f.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.g("dragend")),this._state="inactive"}_addDragHandler(c){const p=this._map,v=this._pos;p&&v&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(v),this._pointerdownPos=c.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const p=this._map;return p&&(c?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Jd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},R_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Go(y=new f.P(0,0),c="bottom"){if("number"==typeof y){const p=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(c){case"top":return new f.P(0,y);case"top-left":return new f.P(p,p);case"top-right":return new f.P(-p,p);case"bottom":return new f.P(0,-y);case"bottom-left":return new f.P(p,-p);case"bottom-right":return new f.P(-p,-p);case"left":return new f.P(y,0);case"right":return new f.P(-y,0)}return new f.P(0,0)}return y instanceof f.P||Array.isArray(y)?f.P.convert(y):f.P.convert(y[c]||[0,0])}class _p{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const p=f.bb((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,p,v){this._start=this.getValue(p),this._end=c,this._startTime=p,this._endTime=p+v}}const W1={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class hT{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const fT={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},N_={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qd{constructor(c,p,v=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new Jm({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,v&&(this.mousePitch=new S_({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),f.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(c,p){this.mouseRotate.mousedown(c,p),this.mousePitch&&this.mousePitch.mousedown(c,p),ki()}move(c,p){const v=this.map,w=this.mouseRotate.mousemoveWindow(c,p),C=w&&w.bearingDelta;if(C&&v.setBearing(v.getBearing()+C),this.mousePitch){const M=this.mousePitch.mousemoveWindow(c,p),I=M&&M.pitchDelta;I&&v.setPitch(v.getPitch()+I)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){eo(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(f.Q({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),Ni(this.element,c)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,Ni(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=Oi(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=Oi(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Gx={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},yp={maxWidth:100,unit:"metric"},Wx={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:f.dw,supported:xo,setRTLTextPlugin:f.dy,getRTLTextPluginStatus:f.dz,Map:class extends k_{constructor(y){f.df.mark(f.dg.create);const c=y;if(null!=(y=f.Q({},fT,y)).minZoom&&null!=y.maxZoom&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=y.minPitch&&null!=y.maxPitch&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=y.minPitch&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=y.maxPitch&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&f.dh(window)&&(y.antialias=!1,f.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Dm(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._repaint=!!y.repaint,this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new O_,this._domRenderTaskQueue=new O_,this._controls=[],this._markers=[],this._popups=[],this._mapId=f.di(),this._locale=f.Q({},W1,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._tessellationStep=y.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=y.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _p(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new f.dj(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,this._contextCreateOptions=y.contextCreateOptions?{...y.contextCreateOptions}:{},"string"==typeof y.container){const p=document.getElementById(y.container);if(!p)throw new Error(`Container '${y.container.toString()}' not found.`);this._container=p}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&f.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),f.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new hT),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new I_(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,(y.style||!y.testMode)&&this.setStyle(y.style||f.db.DEFAULT_STYLE,{config:y.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),y.hash&&(this._hash=new Wm("string"==typeof y.hash&&y.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==c.center&&null==c.zoom||(this.transform._unmodified=!1),this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch});const p=y.bounds;p&&(this.resize(),this.fitBounds(p,f.Q({},y.fitBoundsOptions,{duration:0})))}this.resize(),y.attributionControl&&this.addControl(new gp({customAttribution:y.customAttribution})),this._logoControl=new uu,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",p=>{this._update("style"===p.dataType),this.fire(new f.g(`${p.dataType}data`,p))}),this.on("dataloading",p=>{this.fire(new f.g(`${p.dataType}dataloading`,p))})}_getMapId(){return this._mapId}addControl(y,c){if(void 0===c&&(c=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new f.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[c];return-1!==c.indexOf("bottom")?v.insertBefore(p,v.firstChild):v.appendChild(p),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new f.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(y);return c>-1&&this._controls.splice(c,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new f.g("movestart",y)).fire(new f.g("move",y)),this.fire(new f.g("resize",y)),c&&this.fire(new f.g("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(f.aj.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new f.g("zoomstart")).fire(new f.g("zoom")).fire(new f.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new f.g("zoomstart")).fire(new f.g("zoom")).fire(new f.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new f.g("pitchstart")).fire(new f.g("pitch")).fire(new f.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new f.g("pitchstart")).fire(new f.g("pitch")).fire(new f.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return"auto"===y?navigator.language:Array.isArray(y)?0===y.length?void 0:y.map(c=>"auto"===c?navigator.language:c):y}setLanguage(y){const c=this._parseLanguage(y);if(!this.style||c===this._language)return this;this._language=c,this.style.reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(y){return this._lazyInitEmptyStyle(),y?"string"==typeof y&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const y=this.transform,c=y.projection.name;let p;"globe"===c&&y.zoom>=f.aV?(y.setMercatorFromTransition(),p=!0):"mercator"===c&&y.zoom<f.aV&&(y.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,c){return this._updateProjection(y||c||{name:"mercator"})}_updateProjection(y){let c;return c="globe"===y.name&&this.transform.zoom>=f.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),c&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(y){return this.transform.locationPoint3D(f.aJ.convert(y))}unproject(y){return this.transform.pointLocation3D(f.P.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,c,p){if("mouseenter"===y||"mouseover"===y){let v=!1;const w=M=>{const I=c.filter(B=>this.getLayer(B)),F=I.length?this.queryRenderedFeatures(M.point,{layers:I}):[];F.length?v||(v=!0,p.call(this,new _l(y,this,M.originalEvent,{features:F}))):v=!1},C=()=>{v=!1};return{layers:new Set(c),listener:p,delegates:{mousemove:w,mouseout:C}}}if("mouseleave"===y||"mouseout"===y){let v=!1;const w=M=>{const I=c.filter(F=>this.getLayer(F));(I.length?this.queryRenderedFeatures(M.point,{layers:I}):[]).length?v=!0:v&&(v=!1,p.call(this,new _l(y,this,M.originalEvent)))},C=M=>{v&&(v=!1,p.call(this,new _l(y,this,M.originalEvent)))};return{layers:new Set(c),listener:p,delegates:{mousemove:w,mouseout:C}}}{const v=w=>{const C=c.filter(I=>this.getLayer(I)),M=C.length?this.queryRenderedFeatures(w.point,{layers:C}):[];M.length&&(w.features=M,p.call(this,w),delete w.features)};return{layers:new Set(c),listener:p,delegates:{[y]:v}}}}on(y,c,p){if("function"==typeof c||void 0===p)return super.on(y,c);if(Array.isArray(c)||(c=[c]),c)for(const w of c)if(!this._isValidId(w))return this;const v=this._createDelegatedListener(y,c,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(y,c,p){if("function"==typeof c||void 0===p)return super.once(y,c);if(Array.isArray(c)||(c=[c]),c)for(const w of c)if(!this._isValidId(w))return this;const v=this._createDelegatedListener(y,c,p);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(y,c,p){if("function"==typeof c||void 0===p)return super.off(y,c);const v=new Set(Array.isArray(c)?c:[c]);for(const M of v)if(!this._isValidId(M))return this;const w=(M,I)=>{if(M.size!==I.size)return!1;for(const F of M)if(!I.has(F))return!1;return!0},C=this._delegatedListeners?this._delegatedListeners[y]:void 0;return C&&(M=>{for(let I=0;I<M.length;I++){const F=M[I];if(F.listener===p&&w(F.layers,v)){for(const B in F.delegates)this.off(B,F.delegates[B]);return M.splice(I,1),this}}})(C),this}queryRenderedFeatures(y,c){if(!this.style)return[];if(void 0!==c||void 0===y||y instanceof f.P||Array.isArray(y)||(c=y,y=void 0),y=y||[[0,0],[this.transform.width,this.transform.height]],(c=c||{}).layers&&Array.isArray(c.layers))for(const p of c.layers)if(!this._isValidId(p))return[];return this.style.queryRenderedFeatures(y,c,this.transform)}querySourceFeatures(y,c){return this._isValidId(y)?this.style.querySourceFeatures(y,c):[]}isPointOnSurface(y){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&f.w(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(f.P.convert(y))}setStyle(y,c){return c=f.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c),this.style&&y&&!1!==c.diff&&c.localFontFamily===this._localFontFamily&&c.localIdeographFontFamily===this._localIdeographFontFamily&&!c.config?(this.style._diffStyle(y,(p,v)=>{p?(f.w(`Unable to perform style diff: ${String(p.message||p.error||p)}. Rebuilding the style from scratch.`),this._updateStyle(y,c)):v&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(y,c))}_getUIString(y){const c=this._locale[y];if(null==c)throw new Error(`Missing UI string '${y}'`);return c}_updateStyle(y,c){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y){const p=f.Q({},c);c&&c.config&&(p.initialConfig=c.config,delete p.config),this.style=new gl(this,p).load(y),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new gl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.w("There is no style added to the map."),!1)}_isValidId(y){return null==y?(this.fire(new f.f(new Error("IDs can't be empty."))),!1):!f.cY(y)||(this.fire(new f.f(new Error(`IDs can't contain special symbols: "${y}".`))),!1)}addSource(y,c){return this._isValidId(y)?(this._lazyInitEmptyStyle(),this.style.addSource(y,c),this._update(!0)):this}isSourceLoaded(y){return!!this._isValidId(y)&&!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(y,c,p){this._lazyInitEmptyStyle(),this.style.addSourceType(y,c,p)}removeSource(y){return this._isValidId(y)?(this.style.removeSource(y),this._updateTerrain(),this._update(!0)):this}getSource(y){return this._isValidId(y)?this.style.getOwnSource(y):null}addImage(y,c,{pixelRatio:p=1,sdf:v=!1,stretchX:w,stretchY:C,content:M}={}){if(this._lazyInitEmptyStyle(),c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap){const{width:I,height:F,data:B}=f.e.getImageData(c);this.style.addImage(y,{data:new f.j({width:I,height:F},B),pixelRatio:p,stretchX:w,stretchY:C,content:M,sdf:v,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new f.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:F}=c,B=c;this.style.addImage(y,{data:new f.j({width:I,height:F},new Uint8Array(B.data)),pixelRatio:p,stretchX:w,stretchY:C,content:M,sdf:v,version:0,userImage:B}),B.onAdd&&B.onAdd(this,y)}}updateImage(y,c){this._lazyInitEmptyStyle();const p=this.style.getImage(y);if(!p)return void this.fire(new f.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap?f.e.getImageData(c):c,{width:w,height:C,data:M}=v;if(void 0===w||void 0===C)return void this.fire(new f.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==p.data.width||C!==p.data.height)return void this.fire(new f.f(new Error(`The width and height of the updated image (${w}, ${C})\n                must be that same as the previous version of the image\n                (${p.data.width}, ${p.data.height})`)));const I=!(c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap);p.data.replace(M,I),this.style.updateImage(y,p)}hasImage(y){return y?!!this.style&&!!this.style.getImage(y):(this.fire(new f.f(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,c){f.i(this._requestManager.transformRequest(y,f.R.Image),(p,v)=>{c(p,v instanceof HTMLImageElement?f.e.getImageData(v):v)})}listImages(){return this.style.listImages()}addModel(y,c){this._lazyInitEmptyStyle(),this.style.addModel(y,c)}hasModel(y){return y?this.style.hasModel(y):(this.fire(new f.f(new Error("Missing required model id"))),!1)}removeModel(y){this.style.removeModel(y)}listModels(){return this.style.listModels()}addLayer(y,c){return this._isValidId(y.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(y,c),this._update(!0)):this}getSlot(y){const c=this.getLayer(y);return c&&c.slot||null}setSlot(y,c){return this.style.setSlot(y,c),this.style.mergeLayers(),this._update(!0)}addImport(y,c){return this.style.addImport(y,c),this}updateImport(y,c){return"string"!=typeof c&&c.id!==y?(this.removeImport(y),this.addImport(c)):(this.style.updateImport(y,c),this._update(!0))}removeImport(y){return this.style.removeImport(y),this}moveImport(y,c){return this.style.moveImport(y,c),this._update(!0)}moveLayer(y,c){return this._isValidId(y)?(this.style.moveLayer(y,c),this._update(!0)):this}removeLayer(y){return this._isValidId(y)?(this.style.removeLayer(y),this._update(!0)):this}getLayer(y){if(!this._isValidId(y))return null;const c=this.style.getOwnLayer(y);return c?"custom"===c.type?c.implementation:c.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(y,c,p){return this._isValidId(y)?(this.style.setLayerZoomRange(y,c,p),this._update(!0)):this}setFilter(y,c,p={}){return this._isValidId(y)?(this.style.setFilter(y,c,p),this._update(!0)):this}getFilter(y){return this._isValidId(y)?this.style.getFilter(y):null}setPaintProperty(y,c,p,v={}){return this._isValidId(y)?(this.style.setPaintProperty(y,c,p,v),this._update(!0)):this}getPaintProperty(y,c){return this._isValidId(y)?this.style.getPaintProperty(y,c):null}setLayoutProperty(y,c,p,v={}){return this._isValidId(y)?(this.style.setLayoutProperty(y,c,p,v),this._update(!0)):this}getLayoutProperty(y,c){return this._isValidId(y)?this.style.getLayoutProperty(y,c):null}getSchema(y){return this.style.getSchema(y)}setSchema(y,c){return this.style.setSchema(y,c),this._update(!0)}getConfig(y){return this.style.getConfig(y)}setConfig(y,c){return this.style.setConfig(y,c),this._update(!0)}getConfigProperty(y,c){return this.style.getConfigProperty(y,c)}setConfigProperty(y,c,p){return this.style.setConfigProperty(y,c,p),this._update(!0)}setLights(y){if(this._lazyInitEmptyStyle(),y&&1===y.length&&"flat"===y[0].type){const c=y[0];c.properties?this.style.setFlatLight(c.properties,c.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(y),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const y=this.style.getLights()||[];return 0===y.length&&y.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),y}setLight(y,c={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:y}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(y){return this._lazyInitEmptyStyle(),this.style.setColorTheme(y),this._update(!0)}setCamera(y){return this.style.setCamera(y),this._triggerCameraUpdate(y)}_triggerCameraUpdate(y){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===y["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.aJ.convert(y),this.transform):0}setFeatureState(y,c){return this._isValidId(y.source)?(this.style.setFeatureState(y,c),this._update()):this}removeFeatureState(y,c){return this._isValidId(y.source)?(this.style.removeFeatureState(y,c),this._update()):this}getFeatureState(y){return this._isValidId(y.source)?this.style.getFeatureState(y):null}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let p,v,w,C=this._container;for(;C&&(!v||!w);){const M=window.getComputedStyle(C).transform;M&&"none"!==M&&(p=M.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&"0"!==p[0]&&"1"!==p[0]&&(v=p[0]),p[3]&&"0"!==p[3]&&"1"!==p[3]&&(w=p[3])),C=C.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=w?Math.abs(c/w):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=Hr("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Hr("div","mapboxgl-canvas-container",y);this._canvas=Hr("canvas","mapboxgl-canvas",c),this._interactive&&(c.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=Hr("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=Hr("div",`mapboxgl-ctrl-${w}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,c){const p=f.e.devicePixelRatio||1;this._canvas.width=p*Math.ceil(y),this._canvas.height=p*Math.ceil(c),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${c}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const c=this._markers.indexOf(y);-1!==c&&this._markers.splice(c,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const c=this._popups.indexOf(y);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const y=f.Q({},xo.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._canvas.getContext("webgl2",y);c?(f.dk(c,!0),this.painter=new B1(c,this._contextCreateOptions,this.transform,this._tp),this.on("data",p=>{"source"===p.dataType&&this.painter.setTileLoadedFlag(!0)}),f.dl.testSupport(c)):this.fire(new f.f(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.g("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new f.g("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let c;this.fire(new f.g("renderstart")),++this._frameId;const p=this.painter.context.extTimerQuery,v=f.e.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(c=w.createQuery(),w.beginQuery(p.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,j=this.transform.pitch,Z=f.e.now(),K=new f.Y(B,{now:Z,fadeDuration:C,pitch:j,transition:this.style.transition});this.style.update(K)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(v),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(v);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,this.painter.replacementSource);if(I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,f.df.mark(f.dg.load),this.fire(new f.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const B=f.e.now()-v;w.endQuery(p.TIME_ELAPSED_EXT),setTimeout(()=>{const j=w.getQueryParameter(c,w.QUERY_RESULT)/1e6;w.deleteQuery(c),this.fire(new f.g("gpu-timing-frame",{cpuTime:B,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(B);this.fire(new f.g("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const B=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(B);this.fire(new f.g("gpu-timing-deferred-render",{gpuTime:j}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(F||this._repaint)this.triggerRepaint();else{const B=this.idle();if(B&&(M=this._updateAverageElevation(v,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new f.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new f.g("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,f.df.mark(f.dg.fullLoad),this._performanceMetricsCollection&&f.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const c of this._markers)y&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!y||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(y,c=!1){const p=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&p(0);const v=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(v||(c||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const w=this.transform.averageElevation;let C=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=y;const M=Math.abs(w-C);if(M>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(C),p(C);this._averageElevation.easeTo(C,y,300)}else if(M>1e-4)return this._averageElevation.jumpTo(C),p(C)}return!!this._averageElevation.isEasing(y)&&p(this._averageElevation.getValue(y))}_authenticate(){f.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,y=>{if(y&&(y.message===f.dp||401===y.status)){const c=this.painter.context.gl;f.dk(c,!1),this._logoControl instanceof uu&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&f.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const p=this.painter.context.gl,v=p.createFramebuffer();function w(C){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,C,0);const M=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,M),M}return p.bindFramebuffer(p.FRAMEBUFFER,v),this._canvasPixelComparison(w(y),c.canvasCopies.map(w),c.timeStamps)}_canvasPixelComparison(y,c,p){let v=p[1]-p[0];const w=y.length/4;for(let C=0;C<c.length;C++){const M=c[C];let I=0;for(let F=0;F<M.length;F+=4)M[F]===y[F]&&M[F+1]===y[F+1]&&M[F+2]===y[F+2]&&M[F+3]===y[F+3]&&(I+=1);v+=(p[C+2]-p[C+1])*(1-I/w)}return v}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),f.ds(this.painter.context.gl),f.dt.remove(),f.du.remove(),this._removed=!0,this.fire(new f.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=f.e.frame(c=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(c)}))}_preloadTiles(y){const c=this.style?this.style.getSourceCaches():[];return f.dv(c,(p,v)=>p._preloadTiles(y,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(y){this._showParseStatus!==y&&(this._showParseStatus=y,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(y){this._showLayers2DWireframe!==y&&(this._showLayers2DWireframe=y,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(y){this._showLayers3DWireframe!==y&&(this._showLayers3DWireframe=y,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,this._tp.refreshUI(),y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,this._tp.refreshUI(),y&&this._update())}_setCacheLimits(y,c){f.dx(y,c)}get version(){return f.dw}},NavigationControl:class{constructor(y={}){this.options=f.Q({},N_,y),this._container=Hr("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(f.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Hr("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Hr("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:c}):p.resetNorth({},{originalEvent:c}))}),this._compassIcon=Hr("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const c=y.getZoom(),p=c===y.getMaxZoom(),v=c===y.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qd(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,c){const p=Hr("button",y,this._container);return p.type="button",p.addEventListener("click",c),p}_setButtonTitle(y,c){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${c}`);y.setAttribute("aria-label",p),y.firstElementChild&&y.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends f.E{constructor(y={}){super();const c=navigator.geolocation;this.options=f.Q({geolocation:c},Gx,y),f.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=T_(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=Hr("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const c=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,y(p)};void 0!==this._supportsGeolocation?y(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(p=>c("denied"!==p.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(y){const c=this._map.getMaxBounds(),p=y.coords;return!!c&&(p.longitude<c.getWest()||p.longitude>c.getEast()||p.latitude<c.getSouth()||p.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new f.g("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(y),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(y),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new f.g("geolocate",y)),this._finish()}}_updateCamera(y){const c=new f.aJ(y.coords.longitude,y.coords.latitude),p=y.coords.accuracy,v=this._map.getBearing(),w=f.Q({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(p),w,{geolocateSource:!0})}_updateMarker(y){if(y){const c=new f.aJ(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,c=f.ay(1,y._center.lat)*y.worldSize,p=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(1===y.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===y.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new f.g("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Hr("button","mapboxgl-ctrl-geolocate",this._container),Hr("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===y){f.w("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Hr("div","mapboxgl-user-location"),this._dotElement.appendChild(Hr("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Hr("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new P_({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Hr("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new P_({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.g("trackuserlocationend")))})}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:!0===y.absolute&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&y()}).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:gp,ScaleControl:class{constructor(y={}){this.options=f.Q({},yp,y),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),f.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,c=this._map,p=c._containerHeight/2,v=c._containerWidth/2-y/2,w=c.unproject([v,p]),C=c.unproject([v+y,p]),M=w.distanceTo(C);if("imperial"===this.options.unit){const I=3.2808*M;I>5280?this._setScale(y,I/5280,"mile"):this._setScale(y,I,"foot")}else"nautical"===this.options.unit?this._setScale(y,M/1852,"nautical-mile"):M>=1e3?this._setScale(y,M/1e3,"kilometer"):this._setScale(y,M,"meter")}_setScale(y,c,p){this._map._requestDomTask(()=>{const v=function(C){const M=Math.pow(10,`${Math.floor(C)}`.length-1);let I=C/M;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(F){const B=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*B)/B}(I),M*I}(c),w=v/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==p?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:p}).format(v):`${v}&nbsp;${Wx[p]}`,this._container.style.width=y*w+"px"})}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=Hr("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y={}){this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:f.w("Full screen control 'container' must be a DOM element.")),f.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=Hr("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=Hr("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Hr("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.E{constructor(y){super(),this.options=f.Q(Object.create(Jd),y),f.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new f.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new f.g("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=f.aJ.convert(y),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const c=document.createDocumentFragment(),p=document.createElement("body");let v;for(p.innerHTML=y;v=p.firstChild,v;)c.appendChild(v);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Hr("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(y),this.options.closeButton){const p=this._closeButton=Hr("button","mapboxgl-popup-close-button",c);p.type="button",p.setAttribute("aria-label","Close popup"),p.setAttribute("aria-hidden","true"),p.innerHTML="&#215;",p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let c;return this._classList.delete(y)?c=!1:(this._classList.add(y),c=!0),this._updateClassList(),c}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const c=this._map,p=this._container,v=this._pos;if(!c||!p||!v)return"bottom";const w=p.offsetWidth,C=p.offsetHeight,M=v.x<w/2,I=v.x>c.transform.width-w/2;if(v.y+y<C)return M?"top-left":I?"top-right":"top";if(v.y>c.transform.height-C){if(M)return"bottom-left";if(I)return"bottom-right"}return M?"left":I?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),y.className=c.join(" ")}_update(y){const c=this._map,p=this._content;if(!c||!this._lngLat&&!this._trackPointer||!p)return;let v=this._container;if(v||(v=this._container=Hr("div","mapboxgl-popup",c.getContainer()),this._tip=Hr("div","mapboxgl-popup-tip",v),v.appendChild(p)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pf(this._lngLat,this._pos,c.transform)),!this._trackPointer||y){const w=this._pos=this._trackPointer&&y instanceof f.P?y:c.project(this._lngLat),C=Go(this.options.offset),M=this._anchor=this._getAnchor(C.y),I=Go(this.options.offset,M),F=w.add(I).round();c._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${mf[M]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&c._showingGlobe()){const w=f.dc(c.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(R_);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:P_,Style:gl,LngLat:f.aJ,LngLatBounds:f.aj,Point:f.P,MercatorCoordinate:f._,FreeCameraOptions:C1,Evented:f.E,config:f.db,prewarm:f.dA,clearPrewarmedResources:f.dB,get accessToken(){return f.db.ACCESS_TOKEN},set accessToken(y){f.db.ACCESS_TOKEN=y},get baseApiUrl(){return f.db.API_URL},set baseApiUrl(y){f.db.API_URL=y},get workerCount(){return f.dC.workerCount},set workerCount(y){f.dC.workerCount=y},get maxParallelImageRequests(){return f.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){f.db.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){f.dD(y)},get workerUrl(){return f.dE.workerUrl},set workerUrl(y){f.dE.workerUrl=y},get workerClass(){return f.dE.workerClass},set workerClass(y){f.dE.workerClass=y},get workerParams(){return f.dE.workerParams},set workerParams(y){f.dE.workerParams=y},get dracoUrl(){return f.dF()},set dracoUrl(y){f.dG(y)},get meshoptUrl(){return f.dH()},set meshoptUrl(y){f.dI(y)},setNow:f.e.setNow,restoreNow:f.e.restoreNow}}),Ic}()},73:()=>{"use strict";const Ed=":";Error;const er=function(At,...Ht){if(er.translate){const En=er.translate(At,Ht);At=En[0],Ht=En[1]}let yn=Yi(At[0],At.raw[0]);for(let En=1;En<At.length;En++)yn+=Ht[En-1]+Yi(At[En],At.raw[En]);return yn},Cd=":";function Yi(At,Ht){return Ht.charAt(0)===Cd?At.substring(function ru(At,Ht){for(let yn=1,En=1;yn<At.length;yn++,En++)if("\\"===Ht[En])En++;else if(At[yn]===Ed)return yn;throw new Error(`Unterminated $localize metadata block in "${Ht}".`)}(At,Ht)+1):At}globalThis.$localize=er}},Ed=>{var Ru=Ic=>Ed(Ed.s=Ic);Ru(73),Ru(504)}]);