(self.webpackChunkapp_admin=self.webpackChunkapp_admin||[]).push([[792],{513:(xh,qc,Wc)=>{"use strict";function Zu(e,n){return Object.is(e,n)}let dr=null,$f=!1,d=1;const hr=Symbol("SIGNAL");function On(e){const n=dr;return dr=e,n}const Do={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function ta(e){if($f)throw new Error("");if(null===dr)return;dr.consumerOnSignalRead(e);const n=dr.nextProducerIndex++;Jn(dr),n<dr.producerNode.length&&dr.producerNode[n]!==e&&di(dr)&&cl(dr.producerNode[n],dr.producerIndexOfThis[n]),dr.producerNode[n]!==e&&(dr.producerNode[n]=e,dr.producerIndexOfThis[n]=di(dr)?Hl(e,dr,n):0),dr.producerLastReadVersion[n]=e.version}function ya(e){if((!di(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==d)){if(!e.producerMustRecompute(e)&&!ao(e))return e.dirty=!1,void(e.lastCleanEpoch=d);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=d}}function Gl(e){if(void 0===e.liveConsumerNode)return;const n=$f;$f=!0;try{for(const t of e.liveConsumerNode)t.dirty||us(t)}finally{$f=n}}function ll(){return!1!==dr?.consumerAllowSignalWrites}function us(e){e.dirty=!0,Gl(e),e.consumerMarkedDirty?.(e)}function Di(e){return e&&(e.nextProducerIndex=0),On(e)}function Mi(e,n){if(On(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(di(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)cl(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function ao(e){Jn(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],r=e.producerLastReadVersion[n];if(r!==t.version||(ya(t),r!==t.version))return!0}return!1}function Va(e){if(Jn(e),di(e))for(let n=0;n<e.producerNode.length;n++)cl(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function Hl(e,n,t){if(ds(e),0===e.liveConsumerNode.length&&ul(e))for(let r=0;r<e.producerNode.length;r++)e.producerIndexOfThis[r]=Hl(e.producerNode[r],e,r);return e.liveConsumerIndexOfThis.push(t),e.liveConsumerNode.push(n)-1}function cl(e,n){if(ds(e),1===e.liveConsumerNode.length&&ul(e))for(let r=0;r<e.producerNode.length;r++)cl(e.producerNode[r],e.producerIndexOfThis[r]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const r=e.liveConsumerIndexOfThis[n],a=e.liveConsumerNode[n];Jn(a),a.producerIndexOfThis[r]=n}}function di(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Jn(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function ds(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function ul(e){return void 0!==e.producerNode}const dl=Symbol("UNSET"),hi=Symbol("COMPUTING"),va=Symbol("ERRORED"),hs={...Do,value:dl,dirty:!0,error:null,equal:Zu,producerMustRecompute:e=>e.value===dl||e.value===hi,producerRecomputeValue(e){if(e.value===hi)throw new Error("Detected cycle in computations.");const n=e.value;e.value=hi;const t=Di(e);let r;try{r=e.computation()}catch(a){r=va,e.error=a}finally{Mi(e,t)}n!==dl&&n!==va&&r!==va&&e.equal(n,r)?e.value=n:(e.value=r,e.version++)}};let ql=function wh(){throw new Error};function Ua(){ql()}let na=null;function Zc(e,n){ll()||Ua(),e.equal(e.value,n)||(e.value=n,function it(e){e.version++,function Ps(){d++}(),Gl(e),na?.()}(e))}const Ii={...Do,equal:Zu,value:void 0};function Pt(e){return"function"==typeof e}function qi(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Ai=qi(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,a)=>`${a+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Ft(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Rt{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const f of t)f.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Pt(r))try{r()}catch(f){n=f instanceof Ai?f.errors:[f]}const{_finalizers:a}=this;if(a){this._finalizers=null;for(const f of a)try{$o(f)}catch(_){n=n??[],_ instanceof Ai?n=[...n,..._.errors]:n.push(_)}}if(n)throw new Ai(n)}}add(n){var t;if(n&&n!==this)if(this.closed)$o(n);else{if(n instanceof Rt){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&Ft(t,n)}remove(n){const{_finalizers:t}=this;t&&Ft(t,n),n instanceof Rt&&n._removeParent(this)}}Rt.EMPTY=(()=>{const e=new Rt;return e.closed=!0,e})();const fs=Rt.EMPTY;function Pr(e){return e instanceof Rt||e&&"closed"in e&&Pt(e.remove)&&Pt(e.add)&&Pt(e.unsubscribe)}function $o(e){Pt(e)?e():e.unsubscribe()}const ps={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Sr={setTimeout(e,n,...t){const{delegate:r}=Sr;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Sr;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function ja(e){Sr.setTimeout(()=>{const{onUnhandledError:n}=ps;if(!n)throw e;n(e)})}function ki(){}const ms=$a("C",void 0,void 0);function $a(e,n,t){return{kind:e,value:n,error:t}}let ia=null;function Go(e){if(ps.useDeprecatedSynchronousErrorHandling){const n=!ia;if(n&&(ia={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=ia;if(ia=null,t)throw r}}else e()}class pn extends Rt{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Pr(n)&&n.add(this)):this.destination=Ju}static create(n,t,r){return new hl(n,t,r)}next(n){this.isStopped?Kc(function Xc(e){return $a("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Kc(function Wl(e){return $a("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Kc(ms,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Xu=Function.prototype.bind;function Qr(e,n){return Xu.call(e,n)}class ba{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){qo(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){qo(r)}else qo(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){qo(t)}}}class hl extends pn{constructor(n,t,r){let a;if(super(),Pt(n)||!n)a={next:n??void 0,error:t??void 0,complete:r??void 0};else{let f;this&&ps.useDeprecatedNextContext?(f=Object.create(n),f.unsubscribe=()=>this.unsubscribe(),a={next:n.next&&Qr(n.next,f),error:n.error&&Qr(n.error,f),complete:n.complete&&Qr(n.complete,f)}):a=n}this.destination=new ba(a)}}function qo(e){ps.useDeprecatedSynchronousErrorHandling?function Ho(e){ps.useDeprecatedSynchronousErrorHandling&&ia&&(ia.errorThrown=!0,ia.error=e)}(e):ja(e)}function Kc(e,n){const{onStoppedNotification:t}=ps;t&&Sr.setTimeout(()=>t(e,n))}const Ju={closed:!0,next:ki,error:function Ku(e){throw e},complete:ki},fl="function"==typeof Symbol&&Symbol.observable||"@@observable";function gs(e){return e}function pl(e){return 0===e.length?gs:1===e.length?e[0]:function(t){return e.reduce((r,a)=>a(r),t)}}let Fi=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,a){const f=function ra(e){return e&&e instanceof pn||function km(e){return e&&Pt(e.next)&&Pt(e.error)&&Pt(e.complete)}(e)&&Pr(e)}(t)?t:new hl(t,r,a);return Go(()=>{const{operator:_,source:T}=this;f.add(_?_.call(f,T):T?this._subscribe(f):this._trySubscribe(f))}),f}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=Rs(r))((a,f)=>{const _=new hl({next:T=>{try{t(T)}catch(D){f(D),_.unsubscribe()}},error:f,complete:a});this.subscribe(_)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[fl](){return this}pipe(...t){return pl(t)(this)}toPromise(t){return new(t=Rs(t))((r,a)=>{let f;this.subscribe(_=>f=_,_=>a(_),()=>r(f))})}}return e.create=n=>new e(n),e})();function Rs(e){var n;return null!==(n=e??ps.Promise)&&void 0!==n?n:Promise}const eo=qi(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Ci=(()=>{class e extends Fi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new Zl(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new eo}next(t){Go(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){Go(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Go(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:a,observers:f}=this;return r||a?fs:(this.currentObservers=null,f.push(t),new Rt(()=>{this.currentObservers=null,Ft(f,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:a,isStopped:f}=this;r?t.error(a):f&&t.complete()}asObservable(){const t=new Fi;return t.source=this,t}}return e.create=(n,t)=>new Zl(n,t),e})();class Zl extends Ci{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,n)}error(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==r?r:fs}}class lo extends Ci{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:r}=this;if(n)throw t;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function br(e){return Pt(e?.lift)}function ir(e){return n=>{if(br(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ve(e,n,t,r,a){return new H(e,n,t,r,a)}class H extends pn{constructor(n,t,r,a,f,_){super(n),this.onFinalize=f,this.shouldUnsubscribe=_,this._next=t?function(T){try{t(T)}catch(D){n.error(D)}}:super._next,this._error=a?function(T){try{a(T)}catch(D){n.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(T){n.error(T)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function q(e,n){return ir((t,r)=>{let a=0;t.subscribe(ve(r,f=>{r.next(e.call(n,f,a++))}))})}typeof navigator<"u"&&navigator,typeof navigator<"u"&&!/Opera/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||navigator),typeof navigator<"u"&&!/Opera|WebKit/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&navigator;const Fh="https://g.co/ng/security#xss";class wt extends Error{constructor(n,t){super(function iu(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function Yo(e){return{toString:e}.toString()}const ru="__parameters__";function nc(e,n,t){return Yo(()=>{const r=function su(e){return function(...t){if(e){const r=e(...t);for(const a in r)this[a]=r[a]}}}(n);function a(...f){if(this instanceof a)return r.apply(this,f),this;const _=new a(...f);return T.annotation=_,T;function T(D,P,L){const G=D.hasOwnProperty(ru)?D[ru]:Object.defineProperty(D,ru,{value:[]})[ru];for(;G.length<=L;)G.push(null);return(G[L]=G[L]||[]).push(_),D}}return t&&(a.prototype=Object.create(t.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a})}const Yi=globalThis;function Li(e){for(let n in e)if(e[n]===Li)return n;throw Error("Could not find renamed property on target object.")}function by(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function sr(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(sr).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function up(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const cd=Li({__forward_ref__:Li});function Oi(e){return e.__forward_ref__=Oi,e.toString=function(){return sr(this())},e}function Pn(e){return Lh(e)?e():e}function Lh(e){return"function"==typeof e&&e.hasOwnProperty(cd)&&e.__forward_ref__===Oi}function Mt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Pi(e){return{providers:e.providers||[],imports:e.imports||[]}}function Yt(e){return hd(e,pd)||hd(e,It)}function hd(e,n){return e.hasOwnProperty(n)?e[n]:null}function ks(e){return e&&(e.hasOwnProperty(Xo)||e.hasOwnProperty(jn))?e[Xo]:null}const pd=Li({\u0275prov:Li}),Xo=Li({\u0275inj:Li}),It=Li({ngInjectableDef:Li}),jn=Li({ngInjectorDef:Li});class vt{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Mt({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function vs(e){return e&&!!e.\u0275providers}const _l=Li({\u0275cmp:Li}),_d=Li({\u0275dir:Li}),yd=Li({\u0275pipe:Li}),fo=Li({\u0275mod:Li}),Rr=Li({\u0275fac:Li}),vd=Li({__NG_ELEMENT_ID__:Li}),au=Li({__NG_ENV_ID__:Li});function hn(e){return"string"==typeof e?e:null==e?"":String(e)}function Ta(e,n){throw new wt(-201,!1)}var Yn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Yn||{});let og;function Wa(){return og}function bs(e){const n=og;return og=e,n}function fp(e,n,t){const r=Yt(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Yn.Optional?null:void 0!==n?n:void Ta()}const yl={},Xn="__NG_DI_FLAG__",vl="ngTempTokenPath",E1=/\n/gm,bl="__source";let xl;function Cl(e){const n=xl;return xl=e,n}function Uh(e,n=Yn.Default){if(void 0===xl)throw new wt(-203,!1);return null===xl?fp(e,void 0,n):xl.get(e,n&Yn.Optional?null:void 0,n)}function $t(e,n=Yn.Default){return(Wa()||Uh)(Pn(e),n)}function Re(e,n=Yn.Default){return $t(e,rc(n))}function rc(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function bd(e){const n=[];for(let t=0;t<e.length;t++){const r=Pn(e[t]);if(Array.isArray(r)){if(0===r.length)throw new wt(900,!1);let a,f=Yn.Default;for(let _=0;_<r.length;_++){const T=r[_],D=sg(T);"number"==typeof D?-1===D?a=T.token:f|=D:a=T}n.push($t(a,f))}else n.push($t(r))}return n}function jh(e,n){return e[Xn]=n,e.prototype[Xn]=n,e}function sg(e){return e[Xn]}const $h=jh(nc("Optional"),8),cu=jh(nc("SkipSelf"),4);function oc(e,n){return e.hasOwnProperty(Rr)?e[Rr]:null}function uu(e,n){e.forEach(t=>Array.isArray(t)?uu(t,n):n(t))}function mp(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function Oo(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function xs(e,n,t){let r=ws(e,n);return r>=0?e[1|r]=t:(r=~r,function xd(e,n,t,r){let a=e.length;if(a==n)e.push(t,r);else if(1===a)e.push(r,e[0]),e[0]=t;else{for(a--,e.push(e[a-1],e[a]);a>n;)e[a]=e[a-2],a--;e[n]=t,e[n+1]=r}}(e,r,n,t)),r}function wd(e,n){const t=ws(e,n);if(t>=0)return e[1|t]}function ws(e,n){return function Cs(e,n,t){let r=0,a=e.length>>t;for(;a!==r;){const f=r+(a-r>>1),_=e[f<<t];if(n===_)return f<<t;_>n?a=f:r=f+1}return~(a<<t)}(e,n,1)}const Ls={},gi=[],aa=new vt(""),lg=new vt("",-1),Ko=new vt("");class Hh{get(n,t=yl){if(t===yl){const r=new Error(`NullInjectorError: No provider for ${sr(n)}!`);throw r.name="NullInjectorError",r}return t}}var qh=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(qh||{}),Bs=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Bs||{}),zs=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(zs||{});function S1(e,n,t){let r=e.length;for(;;){const a=e.indexOf(n,t);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){const f=n.length;if(a+f===r||e.charCodeAt(a+f)<=32)return a}t=a+1}}function cg(e,n,t){let r=0;for(;r<t.length;){const a=t[r];if("number"==typeof a){if(0!==a)break;r++;const f=t[r++],_=t[r++],T=t[r++];e.setAttribute(n,_,T,f)}else{const f=a,_=t[++r];Py(f)?e.setProperty(n,f,_):e.setAttribute(n,f,_),r++}}return r}function Oy(e){return 3===e||4===e||6===e}function Py(e){return 64===e.charCodeAt(0)}function Cd(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let r=0;r<n.length;r++){const a=n[r];"number"==typeof a?t=a:0===t||Wh(e,t,a,null,-1===t||2===t?n[++r]:null)}}return e}function Wh(e,n,t,r,a){let f=0,_=e.length;if(-1===n)_=-1;else for(;f<e.length;){const T=e[f++];if("number"==typeof T){if(T===n){_=-1;break}if(T>n){_=f-1;break}}}for(;f<e.length;){const T=e[f];if("number"==typeof T)break;if(T===t){if(null===r)return void(null!==a&&(e[f+1]=a));if(r===e[f+1])return void(e[f+2]=a)}f++,null!==r&&f++,null!==a&&f++}-1!==_&&(e.splice(_,0,n),f=_+1),e.splice(f++,0,t),null!==r&&e.splice(f++,0,r),null!==a&&e.splice(f++,0,a)}const sc="ng-template";function Vs(e,n,t,r){let a=0;if(r){for(;a<n.length&&"string"==typeof n[a];a+=2)if("class"===n[a]&&-1!==S1(n[a+1].toLowerCase(),t,0))return!0}else if(du(e))return!1;if(a=n.indexOf(1,a),a>-1){let f;for(;++a<n.length&&"string"==typeof(f=n[a]);)if(f.toLowerCase()===t)return!0}return!1}function du(e){return 4===e.type&&e.value!==sc}function ug(e,n,t){return n===(4!==e.type||t?e.value:sc)}function gp(e,n,t){let r=4;const a=e.attrs,f=null!==a?function ac(e){for(let n=0;n<e.length;n++)if(Oy(e[n]))return n;return e.length}(a):0;let _=!1;for(let T=0;T<n.length;T++){const D=n[T];if("number"!=typeof D){if(!_)if(4&r){if(r=2|1&r,""!==D&&!ug(e,D,t)||""===D&&1===n.length){if(Us(r))return!1;_=!0}}else if(8&r){if(null===a||!Vs(e,a,D,t)){if(Us(r))return!1;_=!0}}else{const P=n[++T],L=hu(D,a,du(e),t);if(-1===L){if(Us(r))return!1;_=!0;continue}if(""!==P){let G;if(G=L>f?"":a[L+1].toLowerCase(),2&r&&P!==G){if(Us(r))return!1;_=!0}}}}else{if(!_&&!Us(r)&&!Us(D))return!1;if(_&&Us(D))continue;_=!1,r=D|1&r}}return Us(r)||_}function Us(e){return!(1&e)}function hu(e,n,t,r){if(null===n)return-1;let a=0;if(r||!t){let f=!1;for(;a<n.length;){const _=n[a];if(_===e)return a;if(3===_||6===_)f=!0;else{if(1===_||2===_){let T=n[++a];for(;"string"==typeof T;)T=n[++a];continue}if(4===_)break;if(0===_){a+=4;continue}}a+=f?1:2}return-1}return function Zh(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const r=e[t];if("number"==typeof r)return-1;if(r===n)return t;t++}return-1}(n,e)}function Td(e,n,t=!1){for(let r=0;r<n.length;r++)if(gp(e,n[r],t))return!0;return!1}function _p(e,n){e:for(let t=0;t<n.length;t++){const r=n[t];if(e.length===r.length){for(let a=0;a<e.length;a++)if(e[a]!==r[a])continue e;return!0}}return!1}function Ed(e,n){return e?":not("+n.trim()+")":n}function Yh(e){let n=e[0],t=1,r=2,a="",f=!1;for(;t<e.length;){let _=e[t];if("string"==typeof _)if(2&r){const T=e[++t];a+="["+_+(T.length>0?'="'+T+'"':"")+"]"}else 8&r?a+="."+_:4&r&&(a+=" "+_);else""!==a&&!Us(_)&&(n+=Ed(f,a),a=""),r=_,f=f||!Us(r);t++}return""!==a&&(n+=Ed(f,a)),n}function Ti(e){return Yo(()=>{const n=Jh(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===qh.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Bs.Emulated,styles:e.styles||gi,_:null,schemas:e.schemas||null,tView:null,id:""};vp(t);const r=e.dependencies;return t.directiveDefs=Dd(r,!1),t.pipeDefs=Dd(r,!0),t.id=function Ny(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const a of t)n=Math.imul(31,n)+a.charCodeAt(0)|0;return n+=2147483648,"c"+n}(t),t})}function Kh(e){return qn(e)||jr(e)}function fu(e){return null!==e}function bi(e){return Yo(()=>({type:e.type,bootstrap:e.bootstrap||gi,declarations:e.declarations||gi,imports:e.imports||gi,exports:e.exports||gi,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function dg(e,n){if(null==e)return Ls;const t={};for(const r in e)if(e.hasOwnProperty(r)){const a=e[r];let f,_,T=zs.None;Array.isArray(a)?(T=a[0],f=a[1],_=a[2]??f):(f=a,_=a),n?(t[f]=T!==zs.None?[r,T]:r,n[f]=_):t[f]=r}return t}function Lt(e){return Yo(()=>{const n=Jh(e);return vp(n),n})}function Jo(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function qn(e){return e[_l]||null}function jr(e){return e[_d]||null}function po(e){return e[yd]||null}function Po(e,n){const t=e[fo]||null;if(!t&&!0===n)throw new Error(`Type ${sr(e)} does not have '\u0275mod' property.`);return t}function Jh(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||Ls,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||gi,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:dg(e.inputs,n),outputs:dg(e.outputs),debugInfo:null}}function vp(e){e.features?.forEach(n=>n(e))}function Dd(e,n){if(!e)return null;const t=n?po:Kh;return()=>("function"==typeof e?e():e).map(r=>t(r)).filter(fu)}function M1(...e){return{\u0275providers:pu(0,e),\u0275fromNgModule:!0}}function pu(e,...n){const t=[],r=new Set;let a;const f=_=>{t.push(_)};return uu(n,_=>{const T=_;cc(T,f,[],r)&&(a||=[],a.push(T))}),void 0!==a&&Md(a,f),t}function Md(e,n){for(let t=0;t<e.length;t++){const{ngModule:r,providers:a}=e[t];Qh(a,f=>{n(f,r)})}}function cc(e,n,t,r){if(!(e=Pn(e)))return!1;let a=null,f=ks(e);const _=!f&&qn(e);if(f||_){if(_&&!_.standalone)return!1;a=e}else{const D=e.ngModule;if(f=ks(D),!f)return!1;a=D}const T=r.has(a);if(_){if(T)return!1;if(r.add(a),_.dependencies){const D="function"==typeof _.dependencies?_.dependencies():_.dependencies;for(const P of D)cc(P,n,t,r)}}else{if(!f)return!1;{if(null!=f.imports&&!T){let P;r.add(a);try{uu(f.imports,L=>{cc(L,n,t,r)&&(P||=[],P.push(L))})}finally{}void 0!==P&&Md(P,n)}if(!T){const P=oc(a)||(()=>new a);n({provide:a,useFactory:P,deps:gi},a),n({provide:Ko,useValue:a,multi:!0},a),n({provide:aa,useValue:()=>$t(a),multi:!0},a)}const D=f.providers;if(null!=D&&!T){const P=e;Qh(D,L=>{n(L,P)})}}}return a!==e&&void 0!==e.providers}function Qh(e,n){for(let t of e)vs(t)&&(t=t.\u0275providers),Array.isArray(t)?Qh(t,n):n(t)}const mu=Li({provide:String,useValue:Li});function Id(e){return null!==e&&"object"==typeof e&&mu in e}function Da(e){return"function"==typeof e}const Ad=new vt(""),uc={},wp={};let Od;function Tl(){return void 0===Od&&(Od=new Hh),Od}class mo{}class gu extends mo{get destroyed(){return this._destroyed}constructor(n,t,r,a){super(),this.parent=t,this.source=r,this.scopes=a,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Cp(n,_=>this.processProvider(_)),this.records.set(lg,dc(void 0,this)),a.has("environment")&&this.records.set(mo,dc(void 0,this));const f=this.records.get(Ad);null!=f&&"string"==typeof f.value&&this.scopes.add(f.value),this.injectorDefTypes=new Set(this.get(Ko,gi,Yn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const n=On(null);try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),On(n)}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=Cl(this),r=bs(void 0);try{return n()}finally{Cl(t),bs(r)}}get(n,t=yl,r=Yn.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(au))return n[au](this);r=rc(r);const f=Cl(this),_=bs(void 0);try{if(!(r&Yn.SkipSelf)){let D=this.records.get(n);if(void 0===D){const P=function Pd(e){return"function"==typeof e||"object"==typeof e&&e instanceof vt}(n)&&Yt(n);D=P&&this.injectableDefInScope(P)?dc(fg(n),uc):null,this.records.set(n,D)}if(null!=D)return this.hydrate(n,D)}return(r&Yn.Self?Tl():this.parent).get(n,t=r&Yn.Optional&&t===yl?null:t)}catch(T){if("NullInjectorError"===T.name){if((T[vl]=T[vl]||[]).unshift(sr(n)),f)throw T;return function Sy(e,n,t,r){const a=e[vl];throw n[bl]&&a.unshift(n[bl]),e.message=function ag(e,n,t,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let a=sr(n);if(Array.isArray(n))a=n.map(sr).join(" -> ");else if("object"==typeof n){let f=[];for(let _ in n)if(n.hasOwnProperty(_)){let T=n[_];f.push(_+":"+("string"==typeof T?JSON.stringify(T):sr(T)))}a=`{${f.join(", ")}}`}return`${t}${r?"("+r+")":""}[${a}]: ${e.replace(E1,"\n  ")}`}("\n"+e.message,a,t,r),e.ngTokenPath=a,e[vl]=null,e}(T,n,"R3InjectorError",this.source)}throw T}finally{bs(_),Cl(f)}}resolveInjectorInitializers(){const n=On(null),t=Cl(this),r=bs(void 0);try{const f=this.get(aa,gi,Yn.Self);for(const _ of f)_()}finally{Cl(t),bs(r),On(n)}}toString(){const n=[],t=this.records;for(const r of t.keys())n.push(sr(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new wt(205,!1)}processProvider(n){let t=Da(n=Pn(n))?n:Pn(n&&n.provide);const r=function A1(e){return Id(e)?dc(void 0,e.useValue):dc(ky(e),uc)}(n);if(!Da(n)&&!0===n.multi){let a=this.records.get(t);a||(a=dc(void 0,uc,!0),a.factory=()=>bd(a.multi),this.records.set(t,a)),t=n,a.multi.push(n)}this.records.set(t,r)}hydrate(n,t){const r=On(null);try{return t.value===uc&&(t.value=wp,t.value=t.factory()),"object"==typeof t.value&&t.value&&function Fy(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{On(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;const t=Pn(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function fg(e){const n=Yt(e),t=null!==n?n.factory:oc(e);if(null!==t)return t;if(e instanceof vt)throw new wt(204,!1);if(e instanceof Function)return function I1(e){if(e.length>0)throw new wt(204,!1);const t=function fd(e){return e&&(e[pd]||e[It])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new wt(204,!1)}function ky(e,n,t){let r;if(Da(e)){const a=Pn(e);return oc(a)||fg(a)}if(Id(e))r=()=>Pn(e.useValue);else if(function bp(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...bd(e.deps||[]));else if(function ef(e){return!(!e||!e.useExisting)}(e))r=()=>$t(Pn(e.useExisting));else{const a=Pn(e&&(e.useClass||e.provide));if(!function pg(e){return!!e.deps}(e))return oc(a)||fg(a);r=()=>new a(...bd(e.deps))}return r}function dc(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function Cp(e,n){for(const t of e)Array.isArray(t)?Cp(t,n):t&&vs(t)?Cp(t.\u0275providers,n):n(t)}function Sa(e,n){e instanceof gu&&e.assertNotDestroyed();const r=Cl(e),a=bs(void 0);try{return n()}finally{Cl(r),bs(a)}}function g(){return void 0!==Wa()||null!=function wl(){return xl}()}const W=0,K=1,te=2,se=3,he=4,ce=5,ue=6,ye=7,pe=8,Se=9,xe=10,ae=11,Fe=12,ke=13,Ee=14,We=15,Ye=16,Oe=17,ze=18,Te=19,Ke=20,Xe=21,bt=22,pt=23,nt=25,Ct=1,rn=7,mn=9,on=10;var xi=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(xi||{});function An(e){return Array.isArray(e)&&"object"==typeof e[Ct]}function vn(e){return Array.isArray(e)&&!0===e[Ct]}function oi(e){return!!(4&e.flags)}function xn(e){return e.componentOffset>-1}function Mn(e){return!(1&~e.flags)}function nn(e){return!!e.template}function Bn(e){return!!(512&e[te])}class Tp{constructor(n,t,r){this.previousValue=n,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function yu(e,n,t,r){null!==n?n.applyValueToInputSignal(n,r):e[t]=r}function kr(){return O1}function O1(e){return e.type.prototype.ngOnChanges&&(e.setInput=By),pC}function pC(){const e=P1(this),n=e?.current;if(n){const t=e.previous;if(t===Ls)e.previous=n;else for(let r in n)t[r]=n[r];e.current=null,this.ngOnChanges(n)}}function By(e,n,t,r,a){const f=this.declaredInputs[r],_=P1(e)||function mC(e,n){return e[gg]=n}(e,{previous:Ls,current:null}),T=_.current||(_.current={}),D=_.previous,P=D[f];T[f]=new Tp(P&&P.currentValue,t,D===Ls),yu(e,n,a,t)}kr.ngInherit=!0;const gg="__ngSimpleChanges__";function P1(e){return e[gg]||null}const pc=function(e,n,t){};function tn(e){for(;Array.isArray(e);)e=e[W];return e}function $s(e,n){return tn(n[e])}function No(e,n){return tn(n[e.index])}function nf(e,n){return e.data[n]}function bu(e,n){return e[n]}function io(e,n){const t=n[e];return An(t)?t:t[W]}function mc(e){return!(128&~e[te])}function Gs(e,n){return null==n?null:e[n]}function Uy(e){e[Oe]=0}function jy(e){1024&e[te]||(e[te]|=1024,mc(e)&&rf(e))}function Ka(e){return!!(9216&e[te]||e[pt]?.dirty)}function _g(e){e[xe].changeDetectionScheduler?.notify(7),64&e[te]&&(e[te]|=1024),Ka(e)&&rf(e)}function rf(e){e[xe].changeDetectionScheduler?.notify(0);let n=Xi(e);for(;null!==n&&!(8192&n[te])&&(n[te]|=8192,mc(n));)n=Xi(n)}function Dp(e,n){if(!(256&~e[te]))throw new wt(911,!1);null===e[Xe]&&(e[Xe]=[]),e[Xe].push(n)}function Xi(e){const n=e[se];return vn(n)?n[se]:n}const Vn={lFrame:Ip(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let Fd=!1;function Gy(){return Vn.bindingsEnabled}function gc(){return null!==Vn.skipHydrationRootTNode}function mt(){return Vn.lFrame.lView}function fi(){return Vn.lFrame.tView}function Xt(e){return Vn.lFrame.contextLView=e,e[pe]}function Kt(e){return Vn.lFrame.contextLView=null,e}function Wi(){let e=B1();for(;null!==e&&64===e.type;)e=e.parent;return e}function B1(){return Vn.lFrame.currentTNode}function Ja(e,n){const t=Vn.lFrame;t.currentTNode=e,t.isParent=n}function Hy(){return Vn.lFrame.isParent}function qy(){Vn.lFrame.isParent=!1}function bC(){return Fd}function xC(e){Fd=e}function vo(){const e=Vn.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function ca(){return Vn.lFrame.bindingIndex++}function es(e){const n=Vn.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function xu(e,n){const t=Vn.lFrame;t.bindingIndex=t.bindingRootIndex=e,xg(n)}function xg(e){Vn.lFrame.currentDirectiveIndex=e}function U1(){return Vn.lFrame.currentQueryIndex}function Ld(e){Vn.lFrame.currentQueryIndex=e}function aM(e){const n=e[K];return 2===n.type?n.declTNode:1===n.type?e[ce]:null}function wC(e,n,t){if(t&Yn.SkipSelf){let a=n,f=e;for(;!(a=a.parent,null!==a||t&Yn.Host||(a=aM(f),null===a||(f=f[Ee],10&a.type))););if(null===a)return!1;n=a,e=f}const r=Vn.lFrame=Xy();return r.currentTNode=n,r.lView=e,!0}function wg(e){const n=Xy(),t=e[K];Vn.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function Xy(){const e=Vn.lFrame,n=null===e?null:e.child;return null===n?Ip(e):n}function Ip(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function sf(){const e=Vn.lFrame;return Vn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const yc=sf;function Ma(){const e=sf();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Fr(){return Vn.lFrame.selectedIndex}function ua(e){Vn.lFrame.selectedIndex=e}function mr(){const e=Vn.lFrame;return nf(e.tView,e.selectedIndex)}let Ky=!0;function Ap(){return Ky}function vc(e){Ky=e}function Pp(e,n){for(let t=n.directiveStart,r=n.directiveEnd;t<r;t++){const f=e.data[t].type.prototype,{ngAfterContentInit:_,ngAfterContentChecked:T,ngAfterViewInit:D,ngAfterViewChecked:P,ngOnDestroy:L}=f;_&&(e.contentHooks??=[]).push(-t,_),T&&((e.contentHooks??=[]).push(t,T),(e.contentCheckHooks??=[]).push(t,T)),D&&(e.viewHooks??=[]).push(-t,D),P&&((e.viewHooks??=[]).push(t,P),(e.viewCheckHooks??=[]).push(t,P)),null!=L&&(e.destroyHooks??=[]).push(t,L)}}function Hs(e,n,t){Vd(e,n,3,t)}function qs(e,n,t,r){(3&e[te])===t&&Vd(e,n,t,r)}function zd(e,n){let t=e[te];(3&t)===n&&(t&=16383,t+=1,e[te]=t)}function Vd(e,n,t,r){const f=r??-1,_=n.length-1;let T=0;for(let D=void 0!==r?65535&e[Oe]:0;D<_;D++)if("number"==typeof n[D+1]){if(T=n[D],null!=r&&T>=r)break}else n[D]<0&&(e[Oe]+=65536),(T<f||-1==f)&&(j1(e,t,n,D),e[Oe]=(4294901760&e[Oe])+D+2),D++}function af(e,n){pc(4,e,n);const t=On(null);try{n.call(e)}finally{On(t),pc(5,e,n)}}function j1(e,n,t,r){const a=t[r]<0,f=t[r+1],T=e[a?-t[r]:t[r]];a?e[te]>>14<e[Oe]>>16&&(3&e[te])===n&&(e[te]+=16384,af(T,f)):af(T,f)}const zn=-1;class Qa{constructor(n,t,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}const G1={};class lf{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,r){r=rc(r);const a=this.injector.get(n,G1,r);return a!==G1||t===G1?a:this.parentInjector.get(n,t,r)}}function Tg(e){return e!==zn}function da(e){return 32767&e}function ro(e,n){let t=function bc(e){return e>>16}(e),r=n;for(;t>0;)r=r[Ee],t--;return r}let $r=!0;function Eg(e){const n=$r;return $r=e,n}const H1=255,jd=5;let DC=0;const Ia={};function Rp(e,n){const t=Qy(e,n);if(-1!==t)return t;const r=n[K];r.firstCreatePass&&(e.injectorIndex=n.length,Jy(r.data,e),Jy(n,null),Jy(r.blueprint,null));const a=e0(e,n),f=e.injectorIndex;if(Tg(a)){const _=da(a),T=ro(a,n),D=T[K].data;for(let P=0;P<8;P++)n[f+P]=T[_+P]|D[_+P]}return n[f+8]=a,f}function Jy(e,n){e.push(0,0,0,0,0,0,0,0,n)}function Qy(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function e0(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,r=null,a=n;for(;null!==a;){if(r=PC(a),null===r)return zn;if(t++,a=a[Ee],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return zn}function Dg(e,n,t){!function ko(e,n,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(vd)&&(r=t[vd]),null==r&&(r=t[vd]=DC++);const a=r&H1;n.data[e+(a>>jd)]|=1<<a}(e,n,t)}function MC(e,n,t){if(t&Yn.Optional||void 0!==e)return e;Ta()}function el(e,n,t,r){if(t&Yn.Optional&&void 0===r&&(r=null),!(t&(Yn.Self|Yn.Host))){const a=e[Se],f=bs(void 0);try{return a?a.get(n,r,t&Yn.Optional):fp(n,r,t&Yn.Optional)}finally{bs(f)}}return MC(r,0,t)}function xc(e,n,t,r=Yn.Default,a){if(null!==e){if(2048&n[te]&&!(r&Yn.Self)){const _=function OC(e,n,t,r,a){let f=e,_=n;for(;null!==f&&null!==_&&2048&_[te]&&!(512&_[te]);){const T=Sg(f,_,t,r|Yn.Self,Ia);if(T!==Ia)return T;let D=f.parent;if(!D){const P=_[Ke];if(P){const L=P.get(t,Ia,r);if(L!==Ia)return L}D=PC(_),_=_[Ee]}f=D}return a}(e,n,t,r,Ia);if(_!==Ia)return _}const f=Sg(e,n,t,r,Ia);if(f!==Ia)return f}return el(n,t,r,a)}function Sg(e,n,t,r,a){const f=function dM(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(vd)?e[vd]:void 0;return"number"==typeof n?n>=0?n&H1:AC:n}(t);if("function"==typeof f){if(!wC(n,e,r))return r&Yn.Host?MC(a,0,r):el(n,t,r,a);try{let _;if(_=f(r),null!=_||r&Yn.Optional)return _;Ta()}finally{yc()}}else if("number"==typeof f){let _=null,T=Qy(e,n),D=zn,P=r&Yn.Host?n[We][ce]:null;for((-1===T||r&Yn.SkipSelf)&&(D=-1===T?e0(e,n):n[T+8],D!==zn&&IC(r,!1)?(_=n[K],T=da(D),n=ro(D,n)):T=-1);-1!==T;){const L=n[K];if(q1(f,T,L.data)){const G=t0(T,n,t,_,r,P);if(G!==Ia)return G}D=n[T+8],D!==zn&&IC(r,n[K].data[T+8]===P)&&q1(f,T,n)?(_=L,T=da(D),n=ro(D,n)):T=-1}}return a}function t0(e,n,t,r,a,f){const _=n[K],T=_.data[e+8],L=Np(T,_,t,null==r?xn(T)&&$r:r!=_&&!!(3&T.type),a&Yn.Host&&f===T);return null!==L?wu(n,_,L,T):Ia}function Np(e,n,t,r,a){const f=e.providerIndexes,_=n.data,T=1048575&f,D=e.directiveStart,L=f>>20,ie=a?T+L:e.directiveEnd;for(let oe=r?T:T+L;oe<ie;oe++){const Ce=_[oe];if(oe<D&&t===Ce||oe>=D&&Ce.type===t)return oe}if(a){const oe=_[D];if(oe&&nn(oe)&&oe.type===t)return D}return null}function wu(e,n,t,r){let a=e[t];const f=n.data;if(function TC(e){return e instanceof Qa}(a)){const _=a;_.resolving&&function rg(e,n){throw n&&n.join(" > "),new wt(-200,e)}(function ri(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():hn(e)}(f[t]));const T=Eg(_.canSeeViewProviders);_.resolving=!0;const P=_.injectImpl?bs(_.injectImpl):null;wC(e,r,Yn.Default);try{a=e[t]=_.factory(void 0,f,e,r),n.firstCreatePass&&t>=r.directiveStart&&function Op(e,n,t){const{ngOnChanges:r,ngOnInit:a,ngDoCheck:f}=n.type.prototype;if(r){const _=O1(n);(t.preOrderHooks??=[]).push(e,_),(t.preOrderCheckHooks??=[]).push(e,_)}a&&(t.preOrderHooks??=[]).push(0-e,a),f&&((t.preOrderHooks??=[]).push(e,f),(t.preOrderCheckHooks??=[]).push(e,f))}(t,f[t],n)}finally{null!==P&&bs(P),Eg(T),_.resolving=!1,yc()}}return a}function q1(e,n,t){return!!(t[n+(e>>jd)]&1<<e)}function IC(e,n){return!(e&Yn.Self||e&Yn.Host&&n)}class Zr{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,r){return xc(this._tNode,this._lView,n,rc(r),t)}}function AC(){return new Zr(Wi(),mt())}function lr(e){return Yo(()=>{const n=e.prototype.constructor,t=n[Rr]||wc(n),r=Object.prototype;let a=Object.getPrototypeOf(e.prototype).constructor;for(;a&&a!==r;){const f=a[Rr]||wc(a);if(f&&f!==t)return f;a=Object.getPrototypeOf(a)}return f=>new f})}function wc(e){return Lh(e)?()=>{const n=wc(Pn(e));return n&&n()}:oc(e)}function PC(e){const n=e[K],t=n.type;return 2===t?n.declTNode:1===t?e[ce]:null}function Zs(e){return function SC(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const r=t.length;let a=0;for(;a<r;){const f=t[a];if(Oy(f))break;if(0===f)a+=2;else if("number"==typeof f)for(a++;a<r&&"string"==typeof t[a];)a++;else{if(f===n)return t[a+1];a+=2}}}return null}(Wi(),e)}function Ui(e,n=null,t=null,r){const a=BC(e,n,t,r);return a.resolveInjectorInitializers(),a}function BC(e,n=null,t=null,r,a=new Set){const f=[t||gi,M1(e)];return r=r||("object"==typeof e?void 0:sr(e)),new gu(f,n||Tl(),r||null,a)}class or{static#e=this.THROW_IF_NOT_FOUND=yl;static#t=this.NULL=new Hh;static create(n,t){if(Array.isArray(n))return Ui({name:""},t,n,"");{const r=n.name??"";return Ui({name:r},n.parent,n.providers,r)}}static#n=this.\u0275prov=Mt({token:or,providedIn:"any",factory:()=>$t(lg)});static#i=this.__NG_ELEMENT_ID__=-1}new vt("").__NG_ELEMENT_ID__=e=>{const n=Wi();if(null===n)throw new wt(204,!1);if(2&n.type)return n.value;if(e&Yn.Optional)return null;throw new wt(204,!1)};function J1(e){return e.ngOriginalError}class ha{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&J1(n);for(;t&&J1(t);)t=J1(t);return t||null}}const El=new vt("",{providedIn:"root",factory:()=>Re(ha).handleError.bind(void 0)});let is=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=UC;static#t=this.__NG_ENV_ID__=t=>t}return e})();class VC extends is{constructor(n){super(),this._lView=n}onDestroy(n){return Dp(this._lView,n),()=>function yg(e,n){if(null===e[Xe])return;const t=e[Xe].indexOf(n);-1!==t&&e[Xe].splice(t,1)}(this._lView,n)}}function UC(){return new VC(mt())}function Og(){return Gd(Wi(),mt())}function Gd(e,n){return new wi(No(e,n))}let wi=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=Og}return e})();function nb(e){return e instanceof wi?e.nativeElement:e}let Cc=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new lo(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275prov=Mt({token:e,providedIn:"root",factory:()=>new e})}return e})();const fn=class $C extends Ci{constructor(n=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=n,g()&&(this.destroyRef=Re(is,{optional:!0})??void 0,this.pendingTasks=Re(Cc,{optional:!0})??void 0)}emit(n){const t=On(null);try{super.next(n)}finally{On(t)}}subscribe(n,t,r){let a=n,f=t||(()=>null),_=r;if(n&&"object"==typeof n){const D=n;a=D.next?.bind(D),f=D.error?.bind(D),_=D.complete?.bind(D)}this.__isAsync&&(f=this.wrapInTimeout(f),a&&(a=this.wrapInTimeout(a)),_&&(_=this.wrapInTimeout(_)));const T=super.subscribe({next:a,error:f,complete:_});return n instanceof Rt&&n.add(T),T}wrapInTimeout(n){return t=>{const r=this.pendingTasks?.add();setTimeout(()=>{n(t),void 0!==r&&this.pendingTasks?.remove(r)})}}};function GC(){return this._results[Symbol.iterator]()}class ib{static#e=Symbol.iterator;get changes(){return this._changes??=new fn}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const t=ib.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=GC)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){this.dirty=!1;const r=function to(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function Gh(e,n,t){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++){let a=e[r],f=n[r];if(t&&(a=t(a),f=t(f)),f!==a)return!1}return!0}(this._results,r,t))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function o0(e){return!(128&~e.flags)}const sb=new Map;let gM=0;const Ng="__ngContext__";function oo(e,n){An(n)?(e[Ng]=n[Te],function qC(e){sb.set(e[Te],e)}(n)):e[Ng]=n}function a0(e){return uf(e[Fe])}function KC(e){return uf(e[he])}function uf(e){for(;null!==e&&!vn(e);)e=e[he];return e}let d0;const Zd=new vt("",{providedIn:"root",factory:()=>Tc}),Tc="ng",fb=new vt(""),Yd=new vt("",{providedIn:"platform",factory:()=>"unknown"}),iT=new vt("",{providedIn:"root",factory:()=>function Cu(){if(void 0!==d0)return d0;if(typeof document<"u")return document;throw new wt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Vg=()=>null;function _0(e,n,t=!1){return Vg(e,n,t)}const hT=new vt("",{providedIn:"root",factory:()=>!1});let Hg,Wg;function Ec(){if(void 0===Hg&&(Hg=null,Yi.trustedTypes))try{Hg=Yi.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Hg}function Dc(e){return Ec()?.createHTML(e)||e}function mT(e){return function T0(){if(void 0===Wg&&(Wg=null,Yi.trustedTypes))try{Wg=Yi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Wg}()?.createScriptURL(e)||e}class df{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Fh})`}}class gT extends df{getTypeName(){return"HTML"}}class E0 extends df{getTypeName(){return"Style"}}class _T extends df{getTypeName(){return"Script"}}class AM extends df{getTypeName(){return"URL"}}class yT extends df{getTypeName(){return"ResourceURL"}}function Ys(e){return e instanceof df?e.changingThisBreaksApplicationSecurity:e}function Dl(e,n){const t=function vT(e){return e instanceof df&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${Fh})`)}return t===n}class Zg{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const t=(new window.DOMParser).parseFromString(Dc(n),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(n):(t.removeChild(t.firstChild),t)}catch{return null}}}class TT{constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){const t=this.inertDocument.createElement("template");return t.innerHTML=Dc(n),t}}const PM=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function D0(e){return(e=String(e)).match(PM)?e:"unsafe:"+e}function Su(e){const n={};for(const t of e.split(","))n[t]=!0;return n}function Yg(...e){const n={};for(const t of e)for(const r in t)t.hasOwnProperty(r)&&(n[r]=!0);return n}const DT=Su("area,br,col,hr,img,wbr"),ST=Su("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),MT=Su("rp,rt"),Db=Yg(DT,Yg(ST,Su("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Yg(MT,Su("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Yg(MT,ST)),Sb=Su("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),IT=Yg(Sb,Su("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Su("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),AT=Su("script,style,template");class kM{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let t=n.firstChild,r=!0,a=[];for(;t;)if(t.nodeType===Node.ELEMENT_NODE?r=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,r&&t.firstChild)a.push(t),t=S0(t);else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let f=LM(t);if(f){t=f;break}t=a.pop()}return this.buf.join("")}startElement(n){const t=Mb(n).toLowerCase();if(!Db.hasOwnProperty(t))return this.sanitizedSomething=!0,!AT.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const r=n.attributes;for(let a=0;a<r.length;a++){const f=r.item(a),_=f.name,T=_.toLowerCase();if(!IT.hasOwnProperty(T)){this.sanitizedSomething=!0;continue}let D=f.value;Sb[T]&&(D=D0(D)),this.buf.push(" ",_,'="',Ab(D),'"')}return this.buf.push(">"),!0}endElement(n){const t=Mb(n).toLowerCase();Db.hasOwnProperty(t)&&!DT.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(n){this.buf.push(Ab(n))}}function LM(e){const n=e.nextSibling;if(n&&e!==n.previousSibling)throw Ib(n);return n}function S0(e){const n=e.firstChild;if(n&&function FM(e,n){return(e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}(e,n))throw Ib(n);return n}function Mb(e){const n=e.nodeName;return"string"==typeof n?n:"FORM"}function Ib(e){return new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`)}const OT=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,PT=/([^\#-~ |!])/g;function Ab(e){return e.replace(/&/g,"&amp;").replace(OT,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(PT,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Xg;function Ob(e,n){let t=null;try{Xg=Xg||function Eb(e){const n=new TT(e);return function ET(){try{return!!(new window.DOMParser).parseFromString(Dc(""),"text/html")}catch{return!1}}()?new Zg(n):n}(e);let r=n?String(n):"";t=Xg.getInertBodyElement(r);let a=5,f=r;do{if(0===a)throw new Error("Failed to sanitize html because the input is unstable");a--,r=f,f=t.innerHTML,t=Xg.getInertBodyElement(r)}while(r!==f);return Dc((new kM).sanitizeChildren(M0(t)||t))}finally{if(t){const r=M0(t)||t;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function M0(e){return"content"in e&&function RT(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var tl=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(tl||{});function Bi(e){const n=Kg();return n?n.sanitize(tl.URL,e)||"":Dl(e,"URL")?Ys(e):D0(hn(e))}function Mu(e){const n=Kg();if(n)return mT(n.sanitize(tl.RESOURCE_URL,e)||"");if(Dl(e,"ResourceURL"))return mT(Ys(e));throw new wt(904,!1)}function Sl(e){return function w0(e){return Ec()?.createScriptURL(e)||e}(e[0])}function Kg(){const e=mt();return e&&e[xe].sanitizer}const BM=/^>|^->|<!--|-->|--!>|<!-$/g,zM=/(<|>)/g,VM="\u200b$1\u200b";function Aa(e){return e instanceof Function?e():e}var Jd=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Jd||{});let k0;function F0(e,n){return k0(e,n)}function hf(e,n,t,r,a){if(null!=r){let f,_=!1;vn(r)?f=r:An(r)&&(_=!0,r=r[W]);const T=tn(r);0===e&&null!==t?null==a?z0(n,t,T):os(n,t,T,a||null,!0):1===e&&null!==t?os(n,t,T,a||null,!0):2===e?function mf(e,n,t){const r=pf(e,n);r&&function Qd(e,n,t,r){e.removeChild(n,t,r)}(e,r,n,t)}(n,T,_):3===e&&n.destroyNode(T),null!=f&&function U0(e,n,t,r,a){const f=t[rn];f!==tn(t)&&hf(n,e,r,f,a);for(let T=on;T<t.length;T++){const D=t[T];Il(D[K],D,e,n,r,f)}}(n,e,f,t,a)}}function Ml(e,n){return e.createComment(function LT(e){return e.replace(BM,n=>n.replace(zM,VM))}(n))}function Qg(e,n,t){return e.createElement(n,t)}function Vb(e,n){n[xe].changeDetectionScheduler?.notify(8),Il(e,n,n[ae],2,null,null)}function Ub(e,n){const t=e[mn],r=n[se];(An(r)||n[We]!==r[se][We])&&(e[te]|=xi.HasTransplantedViews),null===t?e[mn]=[n]:t.push(n)}function L0(e,n){const t=e[mn],r=t.indexOf(n);t.splice(r,1)}function Jp(e,n){if(e.length<=on)return;const t=on+n,r=e[t];if(r){const a=r[Ye];null!==a&&a!==e&&L0(a,r),n>0&&(e[t-1][he]=r[he]);const f=Oo(e,on+n);!function HT(e,n){Vb(e,n),n[W]=null,n[ce]=null}(r[K],r);const _=f[ze];null!==_&&_.detachView(f[K]),r[se]=null,r[he]=null,r[te]&=-129}return r}function rs(e,n){if(!(256&n[te])){const t=n[ae];t.destroyNode&&Il(e,n,t,3,null,null),function WM(e){let n=e[Fe];if(!n)return e_(e[K],e);for(;n;){let t=null;if(An(n))t=n[Fe];else{const r=n[on];r&&(t=r)}if(!t){for(;n&&!n[he]&&n!==e;)An(n)&&e_(n[K],n),n=n[se];null===n&&(n=e),An(n)&&e_(n[K],n),t=n&&n[he]}n=t}}(n)}}function e_(e,n){if(256&n[te])return;const t=On(null);try{n[te]&=-129,n[te]|=256,n[pt]&&Va(n[pt]),function t_(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let r=0;r<t.length;r+=2){const a=n[t[r]];if(!(a instanceof Qa)){const f=t[r+1];if(Array.isArray(f))for(let _=0;_<f.length;_+=2){const T=a[f[_]],D=f[_+1];pc(4,T,D);try{D.call(T)}finally{pc(5,T,D)}}else{pc(4,a,f);try{f.call(a)}finally{pc(5,a,f)}}}}}(e,n),function WT(e,n){const t=e.cleanup,r=n[ye];if(null!==t)for(let f=0;f<t.length-1;f+=2)if("string"==typeof t[f]){const _=t[f+3];_>=0?r[_]():r[-_].unsubscribe(),f+=2}else t[f].call(r[t[f+1]]);null!==r&&(n[ye]=null);const a=n[Xe];if(null!==a){n[Xe]=null;for(let f=0;f<a.length;f++)(0,a[f])()}}(e,n),1===n[K].type&&n[ae].destroy();const r=n[Ye];if(null!==r&&vn(n[se])){r!==n[se]&&L0(r,n);const a=n[ze];null!==a&&a.detachView(e)}!function lb(e){sb.delete(e[Te])}(n)}finally{On(t)}}function B0(e,n,t){return function jb(e,n,t){let r=n;for(;null!==r&&168&r.type;)r=(n=r).parent;if(null===r)return t[W];{const{componentOffset:a}=r;if(a>-1){const{encapsulation:f}=e.data[r.directiveStart+a];if(f===Bs.None||f===Bs.Emulated)return null}return No(r,t)}}(e,n.parent,t)}function os(e,n,t,r,a){e.insertBefore(n,t,r,a)}function z0(e,n,t){e.appendChild(n,t)}function ff(e,n,t,r,a){null!==r?os(e,n,t,r,a):z0(e,n,t)}function pf(e,n){return e.parentNode(n)}function n_(e,n,t){return YT(e,n,t)}let $b,YT=function i_(e,n,t){return 40&e.type?No(e,t):null};function Au(e,n,t,r){const a=B0(e,r,n),f=n[ae],T=n_(r.parent||n[ce],r,n);if(null!=a)if(Array.isArray(t))for(let D=0;D<t.length;D++)ff(f,a,t[D],T,!1);else ff(f,a,t,T,!1);void 0!==$b&&$b(f,r,n,t,a)}function eh(e,n){if(null!==n){const t=n.type;if(3&t)return No(n,e);if(4&t)return V0(-1,e[n.index]);if(8&t){const r=n.child;if(null!==r)return eh(e,r);{const a=e[n.index];return vn(a)?V0(-1,a):tn(a)}}if(32&t)return F0(n,e)()||tn(e[n.index]);{const r=KT(e,n);return null!==r?Array.isArray(r)?r[0]:eh(Xi(e[We]),r):eh(e,n.next)}}return null}function KT(e,n){return null!==n?e[We][ce].projection[n.projection]:null}function V0(e,n){const t=on+e+1;if(t<n.length){const r=n[t],a=r[K].firstChild;if(null!==a)return eh(r,a)}return n[rn]}function gf(e,n,t,r,a,f,_){for(;null!=t;){if(128===t.type){t=t.next;continue}const T=r[t.index],D=t.type;if(_&&0===n&&(T&&oo(tn(T),r),t.flags|=2),32&~t.flags)if(8&D)gf(e,n,t.child,r,a,f,!1),hf(n,e,a,T,f);else if(32&D){const P=F0(t,r);let L;for(;L=P();)hf(n,e,a,L,f);hf(n,e,a,T,f)}else 16&D?Gb(e,n,r,t,a,f):hf(n,e,a,T,f);t=_?t.projectionNext:t.next}}function Il(e,n,t,r,a,f){gf(t,r,e.firstChild,n,a,f,!1)}function Gb(e,n,t,r,a,f){const _=t[We],D=_[ce].projection[r.projection];if(Array.isArray(D))for(let P=0;P<D.length;P++)hf(n,e,a,D[P],f);else{let P=D;const L=_[se];o0(r)&&(P.flags|=128),gf(e,n,P,L,a,f,!0)}}function qb(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function th(e,n,t){const{mergedAttrs:r,classes:a,styles:f}=t;null!==r&&cg(e,n,r),null!==a&&qb(e,n,a),null!==f&&function XM(e,n,t){e.setAttribute(n,"style",t)}(e,n,f)}const Kn={};function we(e=1){Ou(fi(),mt(),Fr()+e,!1)}function Ou(e,n,t,r){if(!r)if(3&~n[te]){const f=e.preOrderHooks;null!==f&&qs(n,f,0,t)}else{const f=e.preOrderCheckHooks;null!==f&&Hs(n,f,t)}ua(t)}function tt(e,n=Yn.Default){const t=mt();return null===t?$t(e,n):xc(Wi(),t,Pn(e),n)}function em(e,n,t,r,a,f){const _=On(null);try{let T=null;a&zs.SignalBased&&(T=n[r][hr]),null!==T&&void 0!==T.transformFn&&(f=T.transformFn(f)),a&zs.HasDecoratorInputTransform&&(f=e.inputTransforms[r].call(n,f)),null!==e.setInput?e.setInput(n,T,f,t,r):yu(n,T,r,f)}finally{On(_)}}function nh(e,n,t,r,a,f,_,T,D,P,L){const G=n.blueprint.slice();return G[W]=a,G[te]=204|r,(null!==P||e&&2048&e[te])&&(G[te]|=2048),Uy(G),G[se]=G[Ee]=e,G[pe]=t,G[xe]=_||e&&e[xe],G[ae]=T||e&&e[ae],G[Se]=D||e&&e[Se]||null,G[ce]=f,G[Te]=function HC(){return gM++}(),G[ue]=L,G[Ke]=P,G[We]=2==n.type?e[We]:G,G}function Mc(e,n,t,r,a){let f=e.data[n];if(null===f)f=function Wb(e,n,t,r,a){const f=B1(),_=Hy(),D=e.data[n]=function $0(e,n,t,r,a,f){let _=n?n.injectorIndex:-1,T=0;return gc()&&(T|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:_,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:T,providerIndexes:0,value:a,attrs:f,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,_?f:f&&f.parent,t,n,r,a);return null===e.firstChild&&(e.firstChild=D),null!==f&&(_?null==f.child&&null!==D.parent&&(f.child=D):null===f.next&&(f.next=D,D.prev=f)),D}(e,n,t,r,a),function Zy(){return Vn.lFrame.inI18n}()&&(f.flags|=32);else if(64&f.type){f.type=t,f.value=r,f.attrs=a;const _=function Mp(){const e=Vn.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();f.injectorIndex=null===_?-1:_.injectorIndex}return Ja(f,!0),f}function o_(e,n,t,r){if(0===t)return-1;const a=n.length;for(let f=0;f<t;f++)n.push(r),e.blueprint.push(r),e.data.push(null);return a}function _f(e,n,t,r,a){const f=Fr(),_=2&r;try{ua(-1),_&&n.length>nt&&Ou(e,n,nt,!1),pc(_?2:0,a),t(r,a)}finally{ua(f),pc(_?3:1,a)}}function tm(e,n,t){if(oi(n)){const r=On(null);try{const f=n.directiveEnd;for(let _=n.directiveStart;_<f;_++){const T=e.data[_];T.contentQueries&&T.contentQueries(1,t[_],_)}}finally{On(r)}}}function Zb(e,n,t){Gy()&&(function Ac(e,n,t,r){const a=t.directiveStart,f=t.directiveEnd;xn(t)&&function l_(e,n,t){const r=No(n,e),a=Yb(t);let _=16;t.signals?_=4096:t.onPush&&(_=64);const T=yf(e,nh(e,a,null,_,r,n,null,e[xe].rendererFactory.createRenderer(r,t),null,null,null));e[n.index]=T}(n,t,e.data[a+t.componentOffset]),e.firstCreatePass||Rp(t,n),oo(r,n);const _=t.initialInputs;for(let T=a;T<f;T++){const D=e.data[T],P=wu(n,e,T,t);oo(P,n),null!==_&&ex(0,T-a,P,D,0,_),nn(D)&&(io(t.index,n)[pe]=wu(n,e,T,t))}}(e,n,t,No(t,n)),!(64&~t.flags)&&Pu(e,n,t))}function j0(e,n,t=No){const r=n.localNames;if(null!==r){let a=n.index+1;for(let f=0;f<r.length;f+=2){const _=r[f+1],T=-1===_?t(n,e):e[_];e[a++]=T}}}function Yb(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=Xb(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function Xb(e,n,t,r,a,f,_,T,D,P,L){const G=nt+r,ie=G+a,oe=function eE(e,n){const t=[];for(let r=0;r<n;r++)t.push(r<e?null:Kn);return t}(G,ie),Ce="function"==typeof P?P():P;return oe[K]={type:e,blueprint:oe,template:t,queries:null,viewQuery:T,declTNode:n,data:oe.slice().fill(null,G),bindingStartIndex:G,expandoStartIndex:ie,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof f?f():f,pipeRegistry:"function"==typeof _?_():_,firstChild:null,schemas:D,consts:Ce,incompleteFirstPass:!1,ssrId:L}}let nE=()=>null;function s_(e,n,t,r,a){for(let f in n){if(!n.hasOwnProperty(f))continue;const _=n[f];if(void 0===_)continue;r??={};let T,D=zs.None;Array.isArray(_)?(T=_[0],D=_[1]):T=_;let P=f;if(null!==a){if(!a.hasOwnProperty(f))continue;P=a[f]}0===e?a_(r,t,P,T,D):a_(r,t,P,T)}return r}function a_(e,n,t,r,a){let f;e.hasOwnProperty(t)?(f=e[t]).push(n,r):f=e[t]=[n,r],void 0!==a&&f.push(a)}function Ts(e,n,t,r,a,f,_,T){const D=No(n,t);let L,P=n.inputs;!T&&null!=P&&(L=P[r])?(ix(e,t,L,r,a),xn(n)&&function Kb(e,n){const t=io(n,e);16&t[te]||(t[te]|=64)}(t,n.index)):3&n.type&&(r=function eI(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),a=null!=_?_(a,n.value||"",r):a,f.setProperty(D,r,a))}function im(e,n,t,r){if(Gy()){const a=null===r?null:{"":-1},f=function rE(e,n){const t=e.directiveRegistry;let r=null,a=null;if(t)for(let f=0;f<t.length;f++){const _=t[f];if(Td(n,_.selectors,!1))if(r||(r=[]),nn(_))if(null!==_.findHostDirectiveDefs){const T=[];a=a||new Map,_.findHostDirectiveDefs(_,T,a),r.unshift(...T,_),rm(e,n,T.length)}else r.unshift(_),rm(e,n,0);else a=a||new Map,_.findHostDirectiveDefs?.(_,r,a),r.push(_)}return null===r?null:[r,a]}(e,t);let _,T;null===f?_=T=null:[_,T]=f,null!==_&&Oa(e,n,t,_,a,T),a&&function tI(e,n,t){if(n){const r=e.localNames=[];for(let a=0;a<n.length;a+=2){const f=t[n[a+1]];if(null==f)throw new wt(-301,!1);r.push(n[a],f)}}}(t,r,a)}t.mergedAttrs=Cd(t.mergedAttrs,t.attrs)}function Oa(e,n,t,r,a,f){for(let P=0;P<r.length;P++)Dg(Rp(t,n),e,r[P].type);!function Jb(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,r.length);for(let P=0;P<r.length;P++){const L=r[P];L.providersResolver&&L.providersResolver(L)}let _=!1,T=!1,D=o_(e,n,r.length,null);for(let P=0;P<r.length;P++){const L=r[P];t.mergedAttrs=Cd(t.mergedAttrs,L.hostAttrs),Qb(e,t,n,D,L),om(D,L,a),null!==L.contentQueries&&(t.flags|=4),(null!==L.hostBindings||null!==L.hostAttrs||0!==L.hostVars)&&(t.flags|=64);const G=L.type.prototype;!_&&(G.ngOnChanges||G.ngOnInit||G.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),_=!0),!T&&(G.ngOnChanges||G.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),T=!0),D++}!function G0(e,n,t){const a=n.directiveEnd,f=e.data,_=n.attrs,T=[];let D=null,P=null;for(let L=n.directiveStart;L<a;L++){const G=f[L],ie=t?t.get(G):null,Ce=ie?ie.outputs:null;D=s_(0,G.inputs,L,D,ie?ie.inputs:null),P=s_(1,G.outputs,L,P,Ce);const Ae=null===D||null===_||du(n)?null:Ol(D,L,_);T.push(Ae)}null!==D&&(D.hasOwnProperty("class")&&(n.flags|=8),D.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=T,n.inputs=D,n.outputs=P}(e,t,f)}function Pu(e,n,t){const r=t.directiveStart,a=t.directiveEnd,f=t.index,_=function V1(){return Vn.lFrame.currentDirectiveIndex}();try{ua(f);for(let T=r;T<a;T++){const D=e.data[T],P=n[T];xg(T),(null!==D.hostBindings||0!==D.hostVars||null!==D.hostAttrs)&&H0(D,P)}}finally{ua(-1),xg(_)}}function H0(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function rm(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function om(e,n,t){if(t){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)t[n.exportAs[r]]=e;nn(n)&&(t[""]=e)}}function Qb(e,n,t,r,a){e.data[r]=a;const f=a.factory||(a.factory=oc(a.type)),_=new Qa(f,nn(a),tt);e.blueprint[r]=_,t[r]=_,function Ic(e,n,t,r,a){const f=a.hostBindings;if(f){let _=e.hostBindingOpCodes;null===_&&(_=e.hostBindingOpCodes=[]);const T=~n.index;(function ih(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(_)!=T&&_.push(T),_.push(t,r,f)}}(e,n,r,o_(e,t,a.hostVars,Kn),a)}function Br(e,n,t,r,a,f){const _=No(e,n);!function c_(e,n,t,r,a,f,_){if(null==f)e.removeAttribute(n,a,t);else{const T=null==_?hn(f):_(f,r||"",a);e.setAttribute(n,a,T,t)}}(n[ae],_,f,e.value,t,r,a)}function ex(e,n,t,r,a,f){const _=f[n];if(null!==_)for(let T=0;T<_.length;)em(r,t,_[T++],_[T++],_[T++],_[T++])}function Ol(e,n,t){let r=null,a=0;for(;a<t.length;){const f=t[a];if(0!==f)if(5!==f){if("number"==typeof f)break;if(e.hasOwnProperty(f)){null===r&&(r=[]);const _=e[f];for(let T=0;T<_.length;T+=3)if(_[T]===n){r.push(f,_[T+1],_[T+2],t[a+1]);break}}a+=2}else a+=2;else a+=4}return r}function oE(e,n,t,r){return[e,!0,0,n,null,r,null,t,null,null]}function tx(e,n){const t=e.contentQueries;if(null!==t){const r=On(null);try{for(let a=0;a<t.length;a+=2){const _=t[a+1];if(-1!==_){const T=e.data[_];Ld(t[a]),T.contentQueries(2,n[_],_)}}}finally{On(r)}}}function yf(e,n){return e[Fe]?e[ke][he]=n:e[Fe]=n,e[ke]=n,n}function nx(e,n,t){Ld(0);const r=On(null);try{n(e,t)}finally{On(r)}}function sE(e){return e[ye]??=[]}function aE(e){return e.cleanup??=[]}function q0(e,n){const t=e[Se],r=t?t.get(ha,null):null;r&&r.handleError(n)}function ix(e,n,t,r,a){for(let f=0;f<t.length;){const _=t[f++],T=t[f++],D=t[f++];em(e.data[_],n[_],r,T,D,a)}}function Ru(e,n,t){const r=$s(n,e);!function zb(e,n,t){e.setValue(n,t)}(e[ae],r,t)}function nI(e,n){const t=io(n,e),r=t[K];!function iI(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(r,t);const a=t[W];null!==a&&null===t[ue]&&(t[ue]=_0(a,t[Se])),rx(r,t,t[pe])}function rx(e,n,t){wg(n);try{const r=e.viewQuery;null!==r&&nx(1,r,t);const a=e.template;null!==a&&_f(e,n,a,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),n[ze]?.finishViewCreation(e),e.staticContentQueries&&tx(e,n),e.staticViewQueries&&nx(2,e.viewQuery,t);const f=e.components;null!==f&&function rI(e,n){for(let t=0;t<n.length;t++)nI(e,n[t])}(n,f)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{n[te]&=-5,Ma()}}function Lo(e,n,t,r){const a=On(null);try{const f=n.tView,D=nh(e,f,t,4096&e[te]?4096:16,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null);D[Ye]=e[n.index];const L=e[ze];return null!==L&&(D[ze]=L.createEmbeddedView(f)),rx(f,D,t),D}finally{On(a)}}function sm(e,n){const t=on+n;if(t<e.length)return e[t]}function vf(e,n){return!n||null===n.firstChild||o0(e)}function bf(e,n,t,r=!0){const a=n[K];if(function ZM(e,n,t,r){const a=on+r,f=t.length;r>0&&(t[a-1][he]=n),r<f-on?(n[he]=t[a],mp(t,on+r,n)):(t.push(n),n[he]=null),n[se]=t;const _=n[Ye];null!==_&&t!==_&&Ub(_,n);const T=n[ze];null!==T&&T.insertView(e),_g(n),n[te]|=128}(a,n,e,t),r){const _=V0(t,e),T=n[ae],D=pf(T,e[rn]);null!==D&&function qT(e,n,t,r,a,f){r[W]=a,r[ce]=n,Il(e,r,t,1,a,f)}(a,e[ce],T,n,D,_)}const f=n[ue];null!==f&&null!==f.firstChild&&(f.firstChild=null)}function W0(e,n){const t=Jp(e,n);return void 0!==t&&rs(t[K],t),t}function u_(e,n,t,r,a=!1){for(;null!==t;){if(128===t.type){t=a?t.projectionNext:t.next;continue}const f=n[t.index];null!==f&&r.push(tn(f)),vn(f)&&ox(f,r);const _=t.type;if(8&_)u_(e,n,t.child,r);else if(32&_){const T=F0(t,n);let D;for(;D=T();)r.push(D)}else if(16&_){const T=KT(n,t);if(Array.isArray(T))r.push(...T);else{const D=Xi(n[We]);u_(D[K],D,T,r,!0)}}t=a?t.projectionNext:t.next}return r}function ox(e,n){for(let t=on;t<e.length;t++){const r=e[t],a=r[K].firstChild;null!==a&&u_(r[K],r,a,n)}e[rn]!==e[W]&&n.push(e[rn])}let sx=[];const uE={...Do,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{rf(e.lView)},consumerOnSignalRead(){this.lView[pt]=this}},am={...Do,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{let n=Xi(e.lView);for(;n&&!lm(n[K]);)n=Xi(n);n&&jy(n)},consumerOnSignalRead(){this.lView[pt]=this}};function lm(e){return 2!==e.type}const d_=100;function h_(e,n=!0,t=0){const r=e[xe],a=r.rendererFactory;a.begin?.();try{!function aI(e,n){const t=bC();try{xC(!0),cx(e,n);let r=0;for(;Ka(e);){if(r===d_)throw new wt(103,!1);r++,cx(e,1)}}finally{xC(t)}}(e,t)}catch(_){throw n&&q0(e,_),_}finally{a.end?.(),r.inlineEffectRunner?.flush()}}function ax(e,n,t,r){const a=n[te];if(!(256&~a))return;n[xe].inlineEffectRunner?.flush(),wg(n);let T=!0,D=null,P=null;lm(e)?(P=function cE(e){return e[pt]??function oI(e){const n=sx.pop()??Object.create(uE);return n.lView=e,n}(e)}(n),D=Di(P)):null===function Cn(){return dr}()?(T=!1,P=function Cr(e){const n=e[pt]??Object.create(am);return n.lView=e,n}(n),D=Di(P)):n[pt]&&(Va(n[pt]),n[pt]=null);try{Uy(n),function Wy(e){return Vn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&_f(e,n,t,2,r);const L=!(3&~a);if(L){const oe=e.preOrderCheckHooks;null!==oe&&Hs(n,oe,null)}else{const oe=e.preOrderHooks;null!==oe&&qs(n,oe,0,null),zd(n,0)}if(function lx(e){for(let n=a0(e);null!==n;n=KC(n)){if(!(n[te]&xi.HasTransplantedViews))continue;const t=n[mn];for(let r=0;r<t.length;r++)jy(t[r])}}(n),nl(n,0),null!==e.contentQueries&&tx(e,n),L){const oe=e.contentCheckHooks;null!==oe&&Hs(n,oe)}else{const oe=e.contentHooks;null!==oe&&qs(n,oe,1),zd(n,1)}!function r_(e,n){const t=e.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const a=t[r];if(a<0)ua(~a);else{const f=a,_=t[++r],T=t[++r];xu(_,f),T(2,n[f])}}}finally{ua(-1)}}(e,n);const G=e.components;null!==G&&hE(n,G,0);const ie=e.viewQuery;if(null!==ie&&nx(2,ie,r),L){const oe=e.viewCheckHooks;null!==oe&&Hs(n,oe)}else{const oe=e.viewHooks;null!==oe&&qs(n,oe,2),zd(n,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[bt]){for(const oe of n[bt])oe();n[bt]=null}n[te]&=-73}catch(L){throw rf(n),L}finally{null!==P&&(Mi(P,D),T&&function sI(e){e.lView[pt]!==e&&(e.lView=null,sx.push(e))}(P)),Ma()}}function nl(e,n){for(let t=a0(e);null!==t;t=KC(t))for(let r=on;r<t.length;r++)il(t[r],n)}function lI(e,n,t){il(io(n,e),t)}function il(e,n){mc(e)&&cx(e,n)}function cx(e,n){const r=e[K],a=e[te],f=e[pt];let _=!!(0===n&&16&a);if(_||=!!(64&a&&0===n),_||=!!(1024&a),_||=!(!f?.dirty||!ao(f)),_||=!1,f&&(f.dirty=!1),e[te]&=-9217,_)ax(r,e,r.template,e[pe]);else if(8192&a){nl(e,1);const T=r.components;null!==T&&hE(e,T,1)}}function hE(e,n,t){for(let r=0;r<n.length;r++)lI(e,n[r],t)}function f_(e,n){const t=bC()?64:1088;for(e[xe].changeDetectionScheduler?.notify(n);e;){e[te]|=t;const r=Xi(e);if(Bn(e)&&!r)return e;e=r}return null}class Es{get rootNodes(){const n=this._lView,t=n[K];return u_(t,n,t.firstChild,[])}constructor(n,t,r=!0){this._lView=n,this._cdRefInjectingView=t,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[pe]}set context(n){this._lView[pe]=n}get destroyed(){return!(256&~this._lView[te])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[se];if(vn(n)){const t=n[8],r=t?t.indexOf(this):-1;r>-1&&(Jp(n,r),Oo(t,r))}this._attachedToViewContainer=!1}rs(this._lView[K],this._lView)}onDestroy(n){Dp(this._lView,n)}markForCheck(){f_(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[te]&=-129}reattach(){_g(this._lView),this._lView[te]|=128}detectChanges(){this._lView[te]|=1024,h_(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new wt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const n=Bn(this._lView),t=this._lView[Ye];null!==t&&!n&&L0(t,this._lView),Vb(this._lView[K],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new wt(902,!1);this._appRef=n;const t=Bn(this._lView),r=this._lView[Ye];null!==r&&!t&&Ub(r,this._lView),_g(this._lView)}}let li=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=ux}return e})();const fE=li,cI=class extends fE{constructor(n,t,r){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,r){const a=Lo(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:t,dehydratedView:r});return new Es(a)}};function ux(){return cm(Wi(),mt())}function cm(e,n){return 4&e.type?new cI(n,e,Gd(e,n)):null}let PE=()=>null;function ah(e,n){return PE(e,n)}class Af{}const mm=new vt("",{providedIn:"root",factory:()=>!1}),Ax=new vt("");class xI{}class Ox{}class RE{resolveComponentFactory(n){throw function Of(e){const n=Error(`No component factory found for ${sr(e)}.`);return n.ngComponent=e,n}(n)}}class dv{static#e=this.NULL=new RE}class Px{}let Oc=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function NE(){const e=mt(),t=io(Wi().index,e);return(An(t)?t:e)[ae]}()}return e})(),wI=(()=>{class e{static#e=this.\u0275prov=Mt({token:e,providedIn:"root",factory:()=>null})}return e})();const hv=new Set;function Yr(e){hv.has(e)||(hv.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function Rx(e){let n=!0;return setTimeout(()=>{n&&(n=!1,e())}),"function"==typeof Yi.requestAnimationFrame&&Yi.requestAnimationFrame(()=>{n&&(n=!1,e())}),()=>{n=!1}}function Nx(e){let n=!0;return queueMicrotask(()=>{n&&e()}),()=>{n=!1}}function kx(...e){}class ii{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new fn(!1),this.onMicrotaskEmpty=new fn(!1),this.onStable=new fn(!1),this.onError=new fn(!1),typeof Zone>"u")throw new wt(908,!1);Zone.assertZonePatched();const a=this;a._nesting=0,a._outer=a._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(a._inner=a._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(a._inner=a._inner.fork(Zone.longStackTraceZoneSpec)),a.shouldCoalesceEventChangeDetection=!r&&t,a.shouldCoalesceRunChangeDetection=r,a.callbackScheduled=!1,function kE(e){const n=()=>{!function TI(e){e.isCheckStableRunning||e.callbackScheduled||(e.callbackScheduled=!0,Zone.root.run(()=>{Rx(()=>{e.callbackScheduled=!1,Lx(e),e.isCheckStableRunning=!0,Fx(e),e.isCheckStableRunning=!1})}),Lx(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,a,f,_,T)=>{if(function FE(e){return pv(e,"__ignore_ng_zone__")}(T))return t.invokeTask(a,f,_,T);try{return Bx(e),t.invokeTask(a,f,_,T)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===f.type||e.shouldCoalesceRunChangeDetection)&&n(),fv(e)}},onInvoke:(t,r,a,f,_,T,D)=>{try{return Bx(e),t.invoke(a,f,_,T,D)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!function D_(e){return pv(e,"__scheduler_tick__")}(T)&&n(),fv(e)}},onHasTask:(t,r,a,f)=>{t.hasTask(a,f),r===a&&("microTask"==f.change?(e._hasPendingMicrotasks=f.microTask,Lx(e),Fx(e)):"macroTask"==f.change&&(e.hasPendingMacrotasks=f.macroTask))},onHandleError:(t,r,a,f)=>(t.handleError(a,f),e.runOutsideAngular(()=>e.onError.emit(f)),!1)})}(a)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ii.isInAngularZone())throw new wt(909,!1)}static assertNotInAngularZone(){if(ii.isInAngularZone())throw new wt(909,!1)}run(n,t,r){return this._inner.run(n,t,r)}runTask(n,t,r,a){const f=this._inner,_=f.scheduleEventTask("NgZoneEvent: "+a,n,T_,kx,kx);try{return f.runTask(_,t,r)}finally{f.cancelTask(_)}}runGuarded(n,t,r){return this._inner.runGuarded(n,t,r)}runOutsideAngular(n){return this._outer.run(n)}}const T_={};function Fx(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Lx(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&!0===e.callbackScheduled)}function Bx(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function fv(e){e._nesting--,Fx(e)}class E_{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new fn,this.onMicrotaskEmpty=new fn,this.onStable=new fn,this.onError=new fn}run(n,t,r){return n.apply(t,r)}runGuarded(n,t,r){return n.apply(t,r)}runOutsideAngular(n){return n()}runTask(n,t,r,a){return n.apply(t,r)}}function pv(e,n){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0]?.data?.[n]}var o=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(o||{});const i={destroy(){}};function u(e,n){!n&&function l(e){if(!g())throw new wt(-203,!1)}();const t=n?.injector??Re(or);return function Xs(e){return"browser"===(e??Re(or)).get(Yd)}(t)?(Yr("NgAfterNextRender"),function m(e,n,t,r){const a=function p(e,n){if(e instanceof Function)switch(n){case o.EarlyRead:return{earlyRead:e};case o.Write:return{write:e};case o.MixedReadWrite:return{mixedReadWrite:e};case o.Read:return{read:e}}return e}(e,r),f=n.get(C),_=f.handler??=new x,T=[],D=[],P=()=>{for(const oe of D)_.unregister(oe);L()},L=n.get(is).onDestroy(P);let G=0;const ie=(oe,Ce)=>{if(!Ce)return;const Ae=t?(...et)=>(G--,G<1&&P(),Ce(...et)):Ce,je=Sa(n,()=>new v(oe,T,Ae));_.register(je),D.push(je),G++};return ie(o.EarlyRead,a.earlyRead),ie(o.Write,a.write),ie(o.MixedReadWrite,a.mixedReadWrite),ie(o.Read,a.read),{destroy:P}}(e,t,!0,n?.phase??o.MixedReadWrite)):i}class v{constructor(n,t,r){this.phase=n,this.pipelinedArgs=t,this.callbackFn=r,this.zone=Re(ii),this.errorHandler=Re(ha,{optional:!0}),Re(Af,{optional:!0})?.notify(6)}invoke(){try{const n=this.zone.runOutsideAngular(()=>this.callbackFn.apply(null,this.pipelinedArgs));this.pipelinedArgs.splice(0,this.pipelinedArgs.length,n)}catch(n){this.errorHandler?.handleError(n)}}}class x{constructor(){this.executingCallbacks=!1,this.buckets={[o.EarlyRead]:new Set,[o.Write]:new Set,[o.MixedReadWrite]:new Set,[o.Read]:new Set},this.deferredCallbacks=new Set}register(n){(this.executingCallbacks?this.deferredCallbacks:this.buckets[n.phase]).add(n)}unregister(n){this.buckets[n.phase].delete(n),this.deferredCallbacks.delete(n)}execute(){this.executingCallbacks=!0;for(const n of Object.values(this.buckets))for(const t of n)t.invoke();this.executingCallbacks=!1;for(const n of this.deferredCallbacks)this.buckets[n.phase].add(n);this.deferredCallbacks.clear()}destroy(){for(const n of Object.values(this.buckets))n.clear();this.deferredCallbacks.clear()}}let C=(()=>{class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){const t=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const r of t)r()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=Mt({token:e,providedIn:"root",factory:()=>new e})}return e})();function fe(e,n,t){let r=t?e.styles:null,a=t?e.classes:null,f=0;if(null!==n)for(let _=0;_<n.length;_++){const T=n[_];"number"==typeof T?f=T:1==f?a=up(a,T):2==f&&(r=up(r,T+": "+n[++_]+";"))}t?e.styles=r:e.stylesWithoutHost=r,t?e.classes=a:e.classesWithoutHost=a}class _e extends dv{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=qn(n);return new Be(t,this.ngModule)}}function De(e,n){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const a=e[r];if(void 0===a)continue;const f=Array.isArray(a),_=f?a[0]:a;t.push(n?{propName:_,templateName:r,isSignal:!!((f?a[1]:zs.None)&zs.SignalBased)}:{propName:_,templateName:r})}return t}class Be extends Ox{get inputs(){const n=this.componentDef,t=n.inputTransforms,r=De(n.inputs,!0);if(null!==t)for(const a of r)t.hasOwnProperty(a.propName)&&(a.transform=t[a.propName]);return r}get outputs(){return De(this.componentDef.outputs,!1)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function Xh(e){return e.map(Yh).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,r,a){const f=On(null);try{let _=(a=a||this.ngModule)instanceof mo?a:a?.injector;_&&null!==this.componentDef.getStandaloneInjector&&(_=this.componentDef.getStandaloneInjector(_)||_);const T=_?new lf(n,_):n,D=T.get(Px,null);if(null===D)throw new wt(407,!1);const P=T.get(wI,null),ie={rendererFactory:D,sanitizer:P,inlineEffectRunner:null,afterRenderEventManager:T.get(C,null),changeDetectionScheduler:T.get(Af,null)},oe=D.createRenderer(null,this.componentDef),Ce=this.componentDef.selectors[0][0]||"div",Ae=r?function KM(e,n,t,r){const f=r.get(hT,!1)||t===Bs.ShadowDom,_=e.selectRootElement(n,f);return function tE(e){nE(e)}(_),_}(oe,r,this.componentDef.encapsulation,T):Qg(oe,Ce,function Pe(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(Ce));let je=512;this.componentDef.signals?je|=4096:this.componentDef.onPush||(je|=16);let et=null;null!==Ae&&(et=_0(Ae,T,!0));const Ze=Xb(0,null,null,1,0,null,null,null,null,null,null),Et=nh(null,Ze,null,je,null,null,ie,oe,T,null,et);let Ut,ln;wg(Et);try{const En=this.componentDef;let ui,Ni=null;En.findHostDirectiveDefs?(ui=[],Ni=new Map,En.findHostDirectiveDefs(En,ui,Ni),ui.push(En)):ui=[En];const To=function He(e,n){const t=e[K],r=nt;return e[r]=n,Mc(t,r,2,"#host",null)}(Et,Ae),Eo=function st(e,n,t,r,a,f,_){const T=a[K];!function qe(e,n,t,r){for(const a of e)n.mergedAttrs=Cd(n.mergedAttrs,a.hostAttrs);null!==n.mergedAttrs&&(fe(n,n.mergedAttrs,!0),null!==t&&th(r,t,n))}(r,e,n,_);let D=null;null!==n&&(D=_0(n,a[Se]));const P=f.rendererFactory.createRenderer(n,t);let L=16;t.signals?L=4096:t.onPush&&(L=64);const G=nh(a,Yb(t),null,L,a[e.index],e,f,P,null,null,D);return T.firstCreatePass&&rm(T,e,r.length-1),yf(a,G),a[e.index]=G}(To,Ae,En,ui,Et,ie,oe);ln=nf(Ze,nt),Ae&&function Ge(e,n,t,r){if(r)cg(e,t,["ng-version","18.1.2"]);else{const{attrs:a,classes:f}=function yp(e){const n=[],t=[];let r=1,a=2;for(;r<e.length;){let f=e[r];if("string"==typeof f)2===a?""!==f&&n.push(f,e[++r]):8===a&&t.push(f);else{if(!Us(a))break;a=f}r++}return{attrs:n,classes:t}}(n.selectors[0]);a&&cg(e,t,a),f&&f.length>0&&qb(e,t,f.join(" "))}}(oe,En,Ae,r),void 0!==t&&function Qe(e,n,t){const r=e.projection=[];for(let a=0;a<n.length;a++){const f=t[a];r.push(null!=f?Array.from(f):null)}}(ln,this.ngContentSelectors,t),Ut=function ut(e,n,t,r,a,f){const _=Wi(),T=a[K],D=No(_,a);Oa(T,a,_,t,null,r);for(let L=0;L<t.length;L++)oo(wu(a,T,_.directiveStart+L,_),a);Pu(T,a,_),D&&oo(D,a);const P=wu(a,T,_.directiveStart+_.componentOffset,_);if(e[pe]=a[pe]=P,null!==f)for(const L of f)L(P,n);return tm(T,_,a),P}(Eo,En,ui,Ni,Et,[ht]),rx(Ze,Et,null)}finally{Ma()}return new Ne(this.componentType,Ut,Gd(ln,Et),Et,ln)}finally{On(f)}}}class Ne extends xI{constructor(n,t,r,a,f){super(),this.location=r,this._rootLView=a,this._tNode=f,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new Es(a,void 0,!1),this.componentType=n}setInput(n,t){const r=this._tNode.inputs;let a;if(null!==r&&(a=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const f=this._rootLView;ix(f[K],f,a,n,t),this.previousInputValues.set(n,t),f_(io(this._tNode.index,f),1)}}get injector(){return new Zr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function ht(){const e=Wi();Pp(mt()[K],e)}let $e=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=xt}return e})();function xt(){return Dt(Wi(),mt())}const dt=$e,at=class extends dt{constructor(n,t,r){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=r}get element(){return Gd(this._hostTNode,this._hostLView)}get injector(){return new Zr(this._hostTNode,this._hostLView)}get parentInjector(){const n=e0(this._hostTNode,this._hostLView);if(Tg(n)){const t=ro(n,this._hostLView),r=da(n);return new Zr(t[K].data[r+8],t)}return new Zr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=jt(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-on}createEmbeddedView(n,t,r){let a,f;"number"==typeof r?a=r:null!=r&&(a=r.index,f=r.injector);const _=ah(this._lContainer,n.ssrId),T=n.createEmbeddedViewImpl(t||{},f,_);return this.insertImpl(T,a,vf(this._hostTNode,_)),T}createComponent(n,t,r,a,f){const _=n&&!function O(e){return"function"==typeof e}(n);let T;if(_)T=t;else{const Ce=t||{};T=Ce.index,r=Ce.injector,a=Ce.projectableNodes,f=Ce.environmentInjector||Ce.ngModuleRef}const D=_?n:new Be(qn(n)),P=r||this.parentInjector;if(!f&&null==D.ngModule){const Ae=(_?P:this.parentInjector).get(mo,null);Ae&&(f=Ae)}const L=qn(D.componentType??{}),G=ah(this._lContainer,L?.id??null),oe=D.create(P,a,G?.firstChild??null,f);return this.insertImpl(oe.hostView,T,vf(this._hostTNode,G)),oe}insert(n,t){return this.insertImpl(n,t,!0)}insertImpl(n,t,r){const a=n._lView;if(function Vy(e){return vn(e[se])}(a)){const T=this.indexOf(n);if(-1!==T)this.detach(T);else{const D=a[se],P=new at(D,D[ce],D[se]);P.detach(P.indexOf(n))}}const f=this._adjustIndex(t),_=this._lContainer;return bf(_,a,f,r),n.attachToViewContainerRef(),mp(Bt(_),f,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=jt(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),r=Jp(this._lContainer,t);r&&(Oo(Bt(this._lContainer),t),rs(r[K],r))}detach(n){const t=this._adjustIndex(n,-1),r=Jp(this._lContainer,t);return r&&null!=Oo(Bt(this._lContainer),t)?new Es(r):null}_adjustIndex(n,t=0){return n??this.length+t}};function jt(e){return e[8]}function Bt(e){return e[8]||(e[8]=[])}function Dt(e,n){let t;const r=n[e.index];return vn(r)?t=r:(t=oE(r,n,null,e),n[e.index]=t,yf(n,t)),sn(t,n,e,r),new at(t,e,n)}let sn=function gn(e,n,t,r){if(e[rn])return;let a;a=8&t.type?tn(r):function yt(e,n){const t=e[ae],r=t.createComment(""),a=No(n,e);return os(t,pf(t,a),r,function ZT(e,n){return e.nextSibling(n)}(t,a),!1),r}(n,t),e[rn]=a},Vt=()=>!1;class Ln{constructor(n){this.queryList=n,this.matches=null}clone(){return new Ln(this.queryList)}setDirty(){this.queryList.setDirty()}}class Nn{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const r=null!==n.contentQueries?n.contentQueries[0]:t.length,a=[];for(let f=0;f<r;f++){const _=t.getByIndex(f);a.push(this.queries[_.indexInDeclarationView].clone())}return new Nn(a)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==pa(n,t).matches&&this.queries[t].setDirty()}}class _i{constructor(n,t,r=null){this.flags=t,this.read=r,this.predicate="string"==typeof n?function Si(e){return e.split(",").map(n=>n.trim())}(n):n}}class yi{constructor(n=[]){this.queries=n}elementStart(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let r=0;r<this.length;r++){const a=null!==t?t.length:0,f=this.getByIndex(r).embeddedTView(n,a);f&&(f.indexInDeclarationView=r,null!==t?t.push(f):t=[f])}return null!==t?new yi(t):null}template(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class _n{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new _n(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1&~this.metadata.flags){const t=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let a=0;a<r.length;a++){const f=r[a];this.matchTNodeWithReadOption(n,t,si(t,f)),this.matchTNodeWithReadOption(n,t,Np(t,n,f,!1,!1))}else r===li?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,Np(t,n,r,!1,!1))}matchTNodeWithReadOption(n,t,r){if(null!==r){const a=this.metadata.read;if(null!==a)if(a===wi||a===$e||a===li&&4&t.type)this.addMatch(t.index,-2);else{const f=Np(t,n,a,!1,!1);null!==f&&this.addMatch(t.index,f)}else this.addMatch(t.index,r)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function si(e,n){const t=e.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===n)return t[r+1];return null}function Ri(e,n,t,r){return-1===t?function ci(e,n){return 11&e.type?Gd(e,n):4&e.type?cm(e,n):null}(n,e):-2===t?function cr(e,n,t){return t===wi?Gd(n,e):t===li?cm(n,e):t===$e?Dt(n,e):void 0}(e,n,r):wu(e,e[K],t,n)}function _r(e,n,t,r){const a=n[ze].queries[r];if(null===a.matches){const f=e.data,_=t.matches,T=[];for(let D=0;null!==_&&D<_.length;D+=2){const P=_[D];T.push(P<0?null:Ri(n,f[P],_[D+1],t.metadata.read))}a.matches=T}return a.matches}function Ji(e,n,t,r){const a=e.queries.getByIndex(t),f=a.matches;if(null!==f){const _=_r(e,n,a,t);for(let T=0;T<f.length;T+=2){const D=f[T];if(D>0)r.push(_[T/2]);else{const P=f[T+1],L=n[-D];for(let G=on;G<L.length;G++){const ie=L[G];ie[Ye]===ie[se]&&Ji(ie[K],ie,P,r)}if(null!==L[mn]){const G=L[mn];for(let ie=0;ie<G.length;ie++){const oe=G[ie];Ji(oe[K],oe,P,r)}}}}}return r}function Gr(e,n,t){const r=new ib(!(4&~t));return function QM(e,n,t,r){const a=sE(n);a.push(t),e.firstCreatePass&&aE(e).push(r,a.length-1)}(e,n,r,r.destroy),(n[ze]??=new Nn).queries.push(new Ln(r))-1}function Ds(e,n,t){null===e.queries&&(e.queries=new yi),e.queries.track(new _n(n,t))}function pa(e,n){return e.queries.getByIndex(n)}function Pa(e,n){const t=e[K],r=pa(t,n);return r.crossesNgTemplate?Ji(t,e,n,[]):_r(t,e,r,n)}function Pc(e,n){Yr("NgSignals");const t=function Vr(e){const n=Object.create(Ii);n.value=e;const t=()=>(ta(n),n.value);return t[hr]=n,t}(e),r=t[hr];return n?.equal&&(r.equal=n.equal),t.set=a=>Zc(r,a),t.update=a=>function dn(e,n){ll()||Ua(),Zc(e,n(e.value))}(r,a),t.asReadonly=zx.bind(t),t}function zx(){const e=this[hr];if(void 0===e.readonlyFn){const n=()=>this();n[hr]=e,e.readonlyFn=n}return e.readonlyFn}function Vx(e){return function lh(e){return"function"==typeof e&&void 0!==e[hr]}(e)&&"function"==typeof e.set}function Zi(e){let n=function yP(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const r=[e];for(;n;){let a;if(nn(e))a=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new wt(903,!1);a=n.\u0275dir}if(a){if(t){r.push(a);const _=e;_.inputs=GE(e.inputs),_.inputTransforms=GE(e.inputTransforms),_.declaredInputs=GE(e.declaredInputs),_.outputs=GE(e.outputs);const T=a.hostBindings;T&&Q4(e,T);const D=a.viewQuery,P=a.contentQueries;if(D&&K4(e,D),P&&J4(e,P),Y4(e,a),by(e.outputs,a.outputs),nn(a)&&a.data.animation){const L=e.data;L.animation=(L.animation||[]).concat(a.data.animation)}}const f=a.features;if(f)for(let _=0;_<f.length;_++){const T=f[_];T&&T.ngInherit&&T(e),T===Zi&&(t=!1)}}n=Object.getPrototypeOf(n)}!function X4(e){let n=0,t=null;for(let r=e.length-1;r>=0;r--){const a=e[r];a.hostVars=n+=a.hostVars,a.hostAttrs=Cd(a.hostAttrs,t=Cd(t,a.hostAttrs))}}(r)}function Y4(e,n){for(const t in n.inputs){if(!n.inputs.hasOwnProperty(t)||e.inputs.hasOwnProperty(t))continue;const r=n.inputs[t];if(void 0!==r&&(e.inputs[t]=r,e.declaredInputs[t]=n.declaredInputs[t],null!==n.inputTransforms)){const a=Array.isArray(r)?r[0]:r;if(!n.inputTransforms.hasOwnProperty(a))continue;e.inputTransforms??={},e.inputTransforms[a]=n.inputTransforms[a]}}}function GE(e){return e===Ls?{}:e===gi?[]:e}function K4(e,n){const t=e.viewQuery;e.viewQuery=t?(r,a)=>{n(r,a),t(r,a)}:n}function J4(e,n){const t=e.contentQueries;e.contentQueries=t?(r,a,f)=>{n(r,a,f),t(r,a,f)}:n}function Q4(e,n){const t=e.hostBindings;e.hostBindings=t?(r,a)=>{n(r,a),t(r,a)}:n}function qx(e){const n=e.inputConfig,t={};for(const r in n)if(n.hasOwnProperty(r)){const a=n[r];Array.isArray(a)&&a[3]&&(t[r]=a[3])}e.inputTransforms=t}class M_{}class wP{}class MI extends M_{constructor(n,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new _e(this);const a=Po(n);this._bootstrapComponents=Aa(a.bootstrap),this._r3Injector=BC(n,t,[{provide:M_,useValue:this},{provide:dv,useValue:this.componentFactoryResolver},...r],sr(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class II extends wP{constructor(n){super(),this.moduleType=n}create(n){return new MI(this.moduleType,n,[])}}class CP extends M_{constructor(n){super(),this.componentFactoryResolver=new _e(this),this.instance=null;const t=new gu([...n.providers,{provide:M_,useValue:this},{provide:dv,useValue:this.componentFactoryResolver}],n.parent||Tl(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function HE(e,n,t=null){return new CP({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}function qE(e){return!!function AI(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function ch(e,n,t){return e[n]=t}function bo(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function I_(e,n,t,r){const a=bo(e,n,t);return bo(e,n+1,r)||a}function Zx(e,n,t,r,a,f,_,T,D,P){const L=t+nt,G=n.firstCreatePass?function u5(e,n,t,r,a,f,_,T,D){const P=n.consts,L=Mc(n,e,4,_||null,T||null);im(n,t,L,Gs(P,D)),Pp(n,L);const G=L.tView=Xb(2,L,r,a,f,n.directiveRegistry,n.pipeRegistry,null,n.schemas,P,null);return null!==n.queries&&(n.queries.template(n,L),G.queries=n.queries.embeddedTView(L)),L}(L,n,e,r,a,f,_,T,D):n.data[L];Ja(G,!1);const ie=TP(n,e,G,t);Ap()&&Au(n,e,ie,G),oo(ie,e);const oe=oE(ie,e,ie,G);return e[L]=oe,yf(e,oe),function Ot(e,n,t){return Vt(e,n,t)}(oe,G,e),Mn(G)&&Zb(n,e,G),null!=D&&j0(e,G,P),G}function Jt(e,n,t,r,a,f,_,T){const D=mt(),P=fi();return Zx(D,P,e,n,t,r,a,Gs(P.consts,f),_,T),Jt}let TP=function EP(e,n,t,r){return vc(!0),n[ae].createComment("")};function Qi(e,n,t,r){const a=mt();return bo(a,ca(),n)&&(fi(),Br(mr(),a,e,n,t,r)),Qi}function Dv(e,n,t,r){return bo(e,ca(),t)?n+hn(t)+r:Kn}function Sv(e,n,t,r,a,f){const T=I_(e,function _c(){return Vn.lFrame.bindingIndex}(),t,a);return es(2),T?n+hn(t)+r+hn(a)+f:Kn}function QE(e,n){return e<<17|n<<2}function bm(e){return e>>17&32767}function UI(e){return 2|e}function O_(e){return(131068&e)>>2}function jI(e,n){return-131069&e|n<<2}function $I(e){return 1|e}function nR(e,n,t,r){const a=e[t+1],f=null===n;let _=r?bm(a):O_(a),T=!1;for(;0!==_&&(!1===T||f);){const P=e[_+1];Y5(e[_],n)&&(T=!0,e[_+1]=r?$I(P):UI(P)),_=r?bm(P):O_(P)}T&&(e[t+1]=r?UI(a):$I(a))}function Y5(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&ws(e,n)>=0}const ss={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function iR(e){return e.substring(ss.key,ss.keyEnd)}function rR(e,n){const t=ss.textEnd;return t===n?-1:(n=ss.keyEnd=function Q5(e,n,t){for(;n<t&&e.charCodeAt(n)>32;)n++;return n}(e,ss.key=n,t),Nv(e,n,t))}function Nv(e,n,t){for(;n<t&&e.charCodeAt(n)<=32;)n++;return n}function Tt(e,n,t){const r=mt();return bo(r,ca(),n)&&Ts(fi(),mr(),r,e,n,r[ae],t,!1),Tt}function GI(e,n,t,r,a){const _=a?"class":"style";ix(e,t,n.inputs[_],_,r)}function ji(e,n){return function Fu(e,n,t,r){const a=mt(),f=fi(),_=es(2);f.firstUpdatePass&&dR(f,e,_,r),n!==Kn&&bo(a,_,n)&&fR(f,f.data[Fr()],a,a[ae],e,a[_+1]=function uV(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=sr(Ys(e)))),e}(n,t),r,_)}(e,n,null,!0),ji}function Jx(e){!function Lu(e,n,t,r){const a=fi(),f=es(2);a.firstUpdatePass&&dR(a,null,f,r);const _=mt();if(t!==Kn&&bo(_,f,t)){const T=a.data[Fr()];if(mR(T,r)&&!uR(a,f)){let D=r?T.classesWithoutHost:T.stylesWithoutHost;null!==D&&(t=up(D,t||"")),GI(a,T,_,t,r)}else!function cV(e,n,t,r,a,f,_,T){a===Kn&&(a=gi);let D=0,P=0,L=0<a.length?a[0]:null,G=0<f.length?f[0]:null;for(;null!==L||null!==G;){const ie=D<a.length?a[D+1]:void 0,oe=P<f.length?f[P+1]:void 0;let Ae,Ce=null;L===G?(D+=2,P+=2,ie!==oe&&(Ce=G,Ae=oe)):null===G||null!==L&&L<G?(D+=2,Ce=L):(P+=2,Ce=G,Ae=oe),null!==Ce&&fR(e,n,t,r,Ce,Ae,_,T),L=D<a.length?a[D]:null,G=P<f.length?f[P]:null}}(a,T,_,_[ae],_[f+1],_[f+1]=function aV(e,n,t){if(null==t||""===t)return gi;const r=[],a=Ys(t);if(Array.isArray(a))for(let f=0;f<a.length;f++)e(r,a[f],!0);else if("object"==typeof a)for(const f in a)a.hasOwnProperty(f)&&e(r,f,a[f]);else"string"==typeof a&&n(r,a);return r}(e,n,t),r,f)}}(lV,dh,e,!0)}function dh(e,n){for(let t=function K5(e){return function sR(e){ss.key=0,ss.keyEnd=0,ss.value=0,ss.valueEnd=0,ss.textEnd=e.length}(e),rR(e,Nv(e,0,ss.textEnd))}(n);t>=0;t=rR(n,t))xs(e,iR(n),!0)}function uR(e,n){return n>=e.expandoStartIndex}function dR(e,n,t,r){const a=e.data;if(null===a[t+1]){const f=a[Fr()],_=uR(e,t);mR(f,r)&&null===n&&!_&&(n=!1),n=function iV(e,n,t,r){const a=function Yy(e){const n=Vn.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let f=r?n.residualClasses:n.residualStyles;if(null===a)0===(r?n.classBindings:n.styleBindings)&&(t=Qx(t=HI(null,e,n,t,r),n.attrs,r),f=null);else{const _=n.directiveStylingLast;if(-1===_||e[_]!==a)if(t=HI(a,e,n,t,r),null===f){let D=function rV(e,n,t){const r=t?n.classBindings:n.styleBindings;if(0!==O_(r))return e[bm(r)]}(e,n,r);void 0!==D&&Array.isArray(D)&&(D=HI(null,e,n,D[1],r),D=Qx(D,n.attrs,r),function oV(e,n,t,r){e[bm(t?n.classBindings:n.styleBindings)]=r}(e,n,r,D))}else f=function sV(e,n,t){let r;const a=n.directiveEnd;for(let f=1+n.directiveStylingLast;f<a;f++)r=Qx(r,e[f].hostAttrs,t);return Qx(r,n.attrs,t)}(e,n,r)}return void 0!==f&&(r?n.residualClasses=f:n.residualStyles=f),t}(a,f,n,r),function W5(e,n,t,r,a,f){let _=f?n.classBindings:n.styleBindings,T=bm(_),D=O_(_);e[r]=t;let L,P=!1;if(Array.isArray(t)?(L=t[1],(null===L||ws(t,L)>0)&&(P=!0)):L=t,a)if(0!==D){const ie=bm(e[T+1]);e[r+1]=QE(ie,T),0!==ie&&(e[ie+1]=jI(e[ie+1],r)),e[T+1]=function H5(e,n){return 131071&e|n<<17}(e[T+1],r)}else e[r+1]=QE(T,0),0!==T&&(e[T+1]=jI(e[T+1],r)),T=r;else e[r+1]=QE(D,0),0===T?T=r:e[D+1]=jI(e[D+1],r),D=r;P&&(e[r+1]=UI(e[r+1])),nR(e,L,r,!0),nR(e,L,r,!1),function Z5(e,n,t,r,a){const f=a?e.residualClasses:e.residualStyles;null!=f&&"string"==typeof n&&ws(f,n)>=0&&(t[r+1]=$I(t[r+1]))}(n,L,e,r,f),_=QE(T,D),f?n.classBindings=_:n.styleBindings=_}(a,f,n,t,_,r)}}function HI(e,n,t,r,a){let f=null;const _=t.directiveEnd;let T=t.directiveStylingLast;for(-1===T?T=t.directiveStart:T++;T<_&&(f=n[T],r=Qx(r,f.hostAttrs,a),f!==e);)T++;return null!==e&&(t.directiveStylingLast=T),r}function Qx(e,n,t){const r=t?1:2;let a=-1;if(null!==n)for(let f=0;f<n.length;f++){const _=n[f];"number"==typeof _?a=_:a===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),xs(e,_,!!t||n[++f]))}return void 0===e?null:e}function lV(e,n,t){const r=String(n);""!==r&&!r.includes(" ")&&xs(e,r,t)}function fR(e,n,t,r,a,f,_,T){if(!(3&n.type))return;const D=e.data,P=D[T+1],L=function q5(e){return!(1&~e)}(P)?pR(D,n,t,a,O_(P),_):void 0;eD(L)||(eD(f)||function G5(e){return!(2&~e)}(P)&&(f=pR(D,null,t,a,T,_)),function Hb(e,n,t,r,a){if(n)a?e.addClass(t,r):e.removeClass(t,r);else{let f=-1===r.indexOf("-")?void 0:Jd.DashCase;null==a?e.removeStyle(t,r,f):("string"==typeof a&&a.endsWith("!important")&&(a=a.slice(0,-10),f|=Jd.Important),e.setStyle(t,r,a,f))}}(r,_,$s(Fr(),t),a,f))}function pR(e,n,t,r,a,f){const _=null===n;let T;for(;a>0;){const D=e[a],P=Array.isArray(D),L=P?D[1]:D,G=null===L;let ie=t[a+1];ie===Kn&&(ie=G?gi:void 0);let oe=G?wd(ie,r):L===r?ie:void 0;if(P&&!eD(oe)&&(oe=wd(D,r)),eD(oe)&&(T=oe,_))return T;const Ce=e[a+1];a=_?bm(Ce):O_(Ce)}if(null!==n){let D=f?n.residualClasses:n.residualStyles;null!=D&&(T=wd(D,r))}return T}function eD(e){return void 0!==e}function mR(e,n){return!!(e.flags&(n?8:16))}function qI(){return mt()[We][pe]}class bV{destroy(n){}updateValue(n,t){}swap(n,t){const r=Math.min(n,t),a=Math.max(n,t),f=this.detach(a);if(a-r>1){const _=this.detach(r);this.attach(r,f),this.attach(a,_)}else this.attach(r,f)}move(n,t){this.attach(t,this.detach(n))}}function WI(e,n,t,r,a){return e===t&&Object.is(n,r)?1:Object.is(a(e,n),a(t,r))?-1:0}function ZI(e,n,t,r){return!(void 0===n||!n.has(r)||(e.attach(t,n.get(r)),n.delete(r),0))}function gR(e,n,t,r,a){if(ZI(e,n,r,t(r,a)))e.updateValue(r,a);else{const f=e.create(r,a);e.attach(r,f)}}function _R(e,n,t,r){const a=new Set;for(let f=n;f<=t;f++)a.add(r(f,e.at(f)));return a}class yR{constructor(){this.kvMap=new Map,this._vMap=void 0}has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;const t=this.kvMap.get(n);return void 0!==this._vMap&&this._vMap.has(t)?(this.kvMap.set(n,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,t){if(this.kvMap.has(n)){let r=this.kvMap.get(n);void 0===this._vMap&&(this._vMap=new Map);const a=this._vMap;for(;a.has(r);)r=a.get(r);a.set(r,t)}else this.kvMap.set(n,t)}forEach(n){for(let[t,r]of this.kvMap)if(n(r,t),void 0!==this._vMap){const a=this._vMap;for(;a.has(r);)r=a.get(r),n(r,t)}}}function ur(e,n){Yr("NgControlFlow");const t=mt(),r=ca(),a=t[r]!==Kn?t[r]:-1,f=-1!==a?tD(t,nt+a):void 0;if(bo(t,r,e)){const T=On(null);try{if(void 0!==f&&W0(f,0),-1!==e){const D=nt+e,P=tD(t,D),L=XI(t[K],D),G=ah(P,L.tView.ssrId);bf(P,Lo(t,L,n,{dehydratedView:G}),0,vf(L,G))}}finally{On(T)}}else if(void 0!==f){const T=sm(f,0);void 0!==T&&(T[pe]=n)}}class wV{constructor(n,t,r){this.lContainer=n,this.$implicit=t,this.$index=r}get $count(){return this.lContainer.length-on}}class CV{constructor(n,t,r){this.hasEmptyBlock=n,this.trackByFn=t,this.liveCollection=r}}function Nc(e,n,t,r,a,f,_,T,D,P,L,G,ie){Yr("NgControlFlow");const oe=mt(),Ce=fi(),Ae=void 0!==D,je=mt(),et=T?_.bind(je[We][pe]):_,Ze=new CV(Ae,et);je[nt+e]=Ze,Zx(oe,Ce,e+1,n,t,r,a,Gs(Ce.consts,f)),Ae&&Zx(oe,Ce,e+2,D,P,L,G,Gs(Ce.consts,ie))}class TV extends bV{constructor(n,t,r){super(),this.lContainer=n,this.hostLView=t,this.templateTNode=r,this.operationsCounter=void 0,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-on}at(n){return this.getLView(n)[pe].$implicit}attach(n,t){const r=t[ue];this.needsIndexUpdate||=n!==this.length,bf(this.lContainer,t,n,vf(this.templateTNode,r))}detach(n){return this.needsIndexUpdate||=n!==this.length-1,function EV(e,n){return Jp(e,n)}(this.lContainer,n)}create(n,t){const r=ah(this.lContainer,this.templateTNode.tView.ssrId),a=Lo(this.hostLView,this.templateTNode,new wV(this.lContainer,t,n),{dehydratedView:r});return this.operationsCounter?.recordCreate(),a}destroy(n){rs(n[K],n),this.operationsCounter?.recordDestroy()}updateValue(n,t){this.getLView(n)[pe].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[pe].$index=n}getLView(n){return function DV(e,n){return sm(e,n)}(this.lContainer,n)}}function kc(e){const n=On(null),t=Fr();try{const r=mt(),a=r[K],f=r[t],_=t+1,T=tD(r,_);if(void 0===f.liveCollection){const P=XI(a,_);f.liveCollection=new TV(T,r,P)}else f.liveCollection.reset();const D=f.liveCollection;if(function xV(e,n,t){let r,a,f=0,_=e.length-1;if(Array.isArray(n)){let D=n.length-1;for(;f<=_&&f<=D;){const P=e.at(f),L=n[f],G=WI(f,P,f,L,t);if(0!==G){G<0&&e.updateValue(f,L),f++;continue}const ie=e.at(_),oe=n[D],Ce=WI(_,ie,D,oe,t);if(0!==Ce){Ce<0&&e.updateValue(_,oe),_--,D--;continue}const Ae=t(f,P),je=t(_,ie),et=t(f,L);if(Object.is(et,je)){const Ze=t(D,oe);Object.is(Ze,Ae)?(e.swap(f,_),e.updateValue(_,oe),D--,_--):e.move(_,f),e.updateValue(f,L),f++}else if(r??=new yR,a??=_R(e,f,_,t),ZI(e,r,f,et))e.updateValue(f,L),f++,_++;else if(a.has(et))r.set(Ae,e.detach(f)),_--;else{const Ze=e.create(f,n[f]);e.attach(f,Ze),f++,_++}}for(;f<=D;)gR(e,r,t,f,n[f]),f++}else if(null!=n){const D=n[Symbol.iterator]();let P=D.next();for(;!P.done&&f<=_;){const L=e.at(f),G=P.value,ie=WI(f,L,f,G,t);if(0!==ie)ie<0&&e.updateValue(f,G),f++,P=D.next();else{r??=new yR,a??=_R(e,f,_,t);const oe=t(f,G);if(ZI(e,r,f,oe))e.updateValue(f,G),f++,_++,P=D.next();else if(a.has(oe)){const Ce=t(f,L);r.set(Ce,e.detach(f)),_--}else e.attach(f,e.create(f,G)),f++,_++,P=D.next()}}for(;!P.done;)gR(e,r,t,e.length,P.value),P=D.next()}for(;f<=_;)e.destroy(e.detach(_--));r?.forEach(D=>{e.destroy(D)})}(D,e,f.trackByFn),D.updateIndexes(),f.hasEmptyBlock){const P=ca(),L=0===D.length;if(bo(r,P,L)){const G=t+2,ie=tD(r,G);if(L){const oe=XI(a,G),Ce=ah(ie,oe.tView.ssrId);bf(ie,Lo(r,oe,void 0,{dehydratedView:Ce}),0,vf(oe,Ce))}else W0(ie,0)}}}finally{On(n)}}function tD(e,n){return e[n]}function XI(e,n){return nf(e,n)}function Q(e,n,t,r){const a=mt(),f=fi(),_=nt+e,T=a[ae],D=f.firstCreatePass?function SV(e,n,t,r,a,f){const _=n.consts,D=Mc(n,e,2,r,Gs(_,a));return im(n,t,D,Gs(_,f)),null!==D.attrs&&fe(D,D.attrs,!1),null!==D.mergedAttrs&&fe(D,D.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,D),D}(_,f,a,n,t,r):f.data[_],P=vR(f,a,D,T,n,e);a[_]=P;const L=Mn(D);return Ja(D,!0),th(T,P,D),!function yv(e){return!(32&~e.flags)}(D)&&Ap()&&Au(f,a,P,D),0===function N1(){return Vn.lFrame.elementDepthCount}()&&oo(P,a),function vg(){Vn.lFrame.elementDepthCount++}(),L&&(Zb(f,a,D),tm(f,D,a)),null!==r&&j0(a,D),Q}function J(){let e=Wi();Hy()?qy():(e=e.parent,Ja(e,!1));const n=e;(function k1(e){return Vn.skipHydrationRootTNode===e})(n)&&function yC(){Vn.skipHydrationRootTNode=null}(),function bg(){Vn.lFrame.elementDepthCount--}();const t=fi();return t.firstCreatePass&&(Pp(t,e),oi(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function EC(e){return!!(8&e.flags)}(n)&&GI(t,n,mt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function Lr(e){return!!(16&e.flags)}(n)&&GI(t,n,mt(),n.stylesWithoutHost,!1),J}function un(e,n,t,r){return Q(e,n,t,r),J(),un}let vR=(e,n,t,r,a,f)=>(vc(!0),Qg(r,a,function ns(){return Vn.lFrame.currentNamespace}()));function nD(e,n,t){const r=mt(),a=fi(),f=e+nt,_=a.firstCreatePass?function AV(e,n,t,r,a){const f=n.consts,_=Gs(f,r),T=Mc(n,e,8,"ng-container",_);return null!==_&&fe(T,_,!0),im(n,t,T,Gs(f,a)),null!==n.queries&&n.queries.elementStart(n,T),T}(f,a,r,n,t):a.data[f];Ja(_,!0);const T=bR(a,r,_,e);return r[f]=T,Ap()&&Au(a,r,T,_),oo(T,r),Mn(_)&&(Zb(a,r,_),tm(a,_,r)),null!=t&&j0(r,_),nD}function iD(){let e=Wi();const n=fi();return Hy()?qy():(e=e.parent,Ja(e,!1)),n.firstCreatePass&&(Pp(n,e),oi(e)&&n.queries.elementEnd(e)),iD}function rD(e,n,t){return nD(e,n,t),iD(),rD}let bR=(e,n,t,r)=>(vc(!0),Ml(n[ae],""));function $i(){return mt()}const P_=void 0;var NV=["en",[["a","p"],["AM","PM"],P_],[["AM","PM"],P_,P_],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],P_,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],P_,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",P_,"{1} 'at' {0}",P_],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function RV(e){const t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}];let kv={};function Na(e){const n=function kV(e){return e.toLowerCase().replace(/_/g,"-")}(e);let t=CR(n);if(t)return t;const r=n.split("-")[0];if(t=CR(r),t)return t;if("en"===r)return NV;throw new wt(701,!1)}function CR(e){return e in kv||(kv[e]=Yi.ng&&Yi.ng.common&&Yi.ng.common.locales&&Yi.ng.common.locales[e]),kv[e]}var Ir=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}(Ir||{});const Fv="en-US";let TR=Fv;let $R=(e,n,t)=>{};function At(e,n,t,r){const a=mt(),f=fi(),_=Wi();return QI(f,a,a[ae],_,e,n,r),At}function QI(e,n,t,r,a,f,_){const T=Mn(r),P=e.firstCreatePass&&aE(e),L=n[pe],G=sE(n);let ie=!0;if(3&r.type||_){const Ae=No(r,n),je=_?_(Ae):Ae,et=G.length,Ze=_?Ut=>_(tn(Ut[r.index])):r.index;let Et=null;if(!_&&T&&(Et=function xU(e,n,t,r){const a=e.cleanup;if(null!=a)for(let f=0;f<a.length-1;f+=2){const _=a[f];if(_===t&&a[f+1]===r){const T=n[ye],D=a[f+2];return T.length>D?T[D]:null}"string"==typeof _&&(f+=2)}return null}(e,n,a,r.index)),null!==Et)(Et.__ngLastListenerFn__||Et).__ngNextListenerFn__=f,Et.__ngLastListenerFn__=f,ie=!1;else{f=WR(r,n,L,f),$R(Ae,a,f);const Ut=t.listen(je,a,f);G.push(f,Ut),P&&P.push(a,Ze,et,et+1)}}else f=WR(r,n,L,f);const oe=r.outputs;let Ce;if(ie&&null!==oe&&(Ce=oe[a])){const Ae=Ce.length;if(Ae)for(let je=0;je<Ae;je+=2){const ln=n[Ce[je]][Ce[je+1]].subscribe(f),En=G.length;G.push(f,ln),P&&P.push(a,r.index,En,-(En+1))}}}function qR(e,n,t,r){const a=On(null);try{return pc(6,n,t),!1!==t(r)}catch(f){return q0(e,f),!1}finally{pc(7,n,t),On(a)}}function WR(e,n,t,r){return function a(f){if(f===Function)return r;f_(e.componentOffset>-1?io(e.index,n):n,5);let T=qR(n,t,r,f),D=a.__ngNextListenerFn__;for(;D;)T=qR(n,t,D,f)&&T,D=D.__ngNextListenerFn__;return T}}function gt(e=1){return function Bd(e){return(Vn.lFrame.contextLView=function $y(e,n){for(;e>0;)n=n[Ee],e--;return n}(e,Vn.lFrame.contextLView))[pe]}(e)}function wU(e,n){let t=null;const r=function Ry(e){const n=e.attrs;if(null!=n){const t=n.indexOf(5);if(!(1&t))return n[t+1]}return null}(e);for(let a=0;a<n.length;a++){const f=n[a];if("*"!==f){if(null===r?Td(e,f,!0):_p(r,f))return a}else t=a}return t}function lD(e){const n=mt()[We][ce];if(!n.projection){const r=n.projection=function Ea(e,n){const t=[];for(let r=0;r<e;r++)t.push(n);return t}(e?e.length:1,null),a=r.slice();let f=n.child;for(;null!==f;){if(128!==f.type){const _=e?wU(f,e):0;null!==_&&(a[_]?a[_].projectionNext=f:r[_]=f,a[_]=f)}f=f.next}}}function cD(e,n=0,t,r,a,f){const _=mt(),T=fi(),D=r?e+1:null;null!==D&&Zx(_,T,D,r,a,f,null,t);const P=Mc(T,nt+e,16,null,t||null);null===P.projection&&(P.projection=n),qy();const G=!_[ue]||gc();null===_[We][ce].projection[P.projection]&&null!==D?function CU(e,n,t){const r=nt+t,a=n.data[r],f=e[r],_=ah(f,a.tView.ssrId);bf(f,Lo(e,a,void 0,{dehydratedView:_}),0,vf(a,_))}(_,T,D):G&&32&~P.flags&&function QT(e,n,t){Gb(n[ae],0,n,t,B0(e,t,n),n_(t.parent||n[ce],t,n))}(T,_,P)}function uD(e,n,t){return e2(e,"",n,"",t),uD}function e2(e,n,t,r,a){const f=mt(),_=Dv(f,n,t,r);return _!==Kn&&Ts(fi(),mr(),f,e,_,f[ae],a,!1),e2}function er(e,n,t,r){!function so(e,n,t,r){const a=fi();if(a.firstCreatePass){const f=Wi();Ds(a,new _i(n,t,r),f.index),function Rl(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(a,e),!(2&~t)&&(a.staticContentQueries=!0)}return Gr(a,mt(),t)}(e,n,t,r)}function kl(e,n,t){!function Tr(e,n,t){const r=fi();return r.firstCreatePass&&(Ds(r,new _i(e,n,t),-1),!(2&~n)&&(r.staticViewQueries=!0)),Gr(r,mt(),n)}(e,n,t)}function pi(e){const n=mt(),t=fi(),r=U1();Ld(r+1);const a=pa(t,r);if(e.dirty&&function Nd(e){return!(4&~e[te])}(n)===!(2&~a.metadata.flags)){if(null===a.matches)e.reset([]);else{const f=Pa(n,r);e.reset(f,nb),e.notifyOnChanges()}return!0}return!1}function mi(){return function Hi(e,n){return e[ze].queries[n].queryList}(mt(),U1())}function as(e){return bu(function vC(){return Vn.lFrame.contextLView}(),nt+e)}function ge(e,n=""){const t=mt(),r=fi(),a=e+nt,f=r.firstCreatePass?Mc(r,a,1,n,null):r.data[a],_=dN(r,t,f,n,e);t[a]=_,Ap()&&Au(r,t,_,f),Ja(f,!1)}let dN=(e,n,t,r,a)=>(vc(!0),function Bb(e,n){return e.createText(n)}(n[ae],r));function Qt(e){return ol("",e,""),Qt}function ol(e,n,t){const r=mt(),a=Dv(r,e,n,t);return a!==Kn&&Ru(r,Fr(),a),ol}function n2(e,n,t,r,a){const f=mt(),_=Sv(f,e,n,t,r,a);return _!==Kn&&Ru(f,Fr(),_),n2}function Ht(e,n,t){Vx(n)&&(n=n());const r=mt();return bo(r,ca(),n)&&Ts(fi(),mr(),r,e,n,r[ae],t,!1),Ht}function Zt(e,n){const t=Vx(e);return t&&e.set(n),t}function qt(e,n){const t=mt(),r=fi(),a=Wi();return QI(r,t,t[ae],a,e,n),qt}function i2(e,n,t,r,a){if(e=Pn(e),Array.isArray(e))for(let f=0;f<e.length;f++)i2(e[f],n,t,r,a);else{const f=fi(),_=mt(),T=Wi();let D=Da(e)?e:Pn(e.provide);const P=ky(e),L=1048575&T.providerIndexes,G=T.directiveStart,ie=T.providerIndexes>>20;if(Da(e)||!e.multi){const oe=new Qa(P,a,tt),Ce=o2(D,n,a?L:L+ie,G);-1===Ce?(Dg(Rp(T,_),f,D),r2(f,e,n.length),n.push(D),T.directiveStart++,T.directiveEnd++,a&&(T.providerIndexes+=1048576),t.push(oe),_.push(oe)):(t[Ce]=oe,_[Ce]=oe)}else{const oe=o2(D,n,L+ie,G),Ce=o2(D,n,L,L+ie),je=Ce>=0&&t[Ce];if(a&&!je||!a&&!(oe>=0&&t[oe])){Dg(Rp(T,_),f,D);const et=function $U(e,n,t,r,a){const f=new Qa(e,t,tt);return f.multi=[],f.index=n,f.componentProviders=0,xN(f,a,r&&!t),f}(a?jU:UU,t.length,a,r,P);!a&&je&&(t[Ce].providerFactory=et),r2(f,e,n.length,0),n.push(D),T.directiveStart++,T.directiveEnd++,a&&(T.providerIndexes+=1048576),t.push(et),_.push(et)}else r2(f,e,oe>-1?oe:Ce,xN(t[a?Ce:oe],P,!a&&r));!a&&r&&je&&t[Ce].componentProviders++}}}function r2(e,n,t,r){const a=Da(n),f=function xp(e){return!!e.useClass}(n);if(a||f){const D=(f?Pn(n.useClass):n).prototype.ngOnDestroy;if(D){const P=e.destroyHooks||(e.destroyHooks=[]);if(!a&&n.multi){const L=P.indexOf(t);-1===L?P.push(t,[r,D]):P[L+1].push(r,D)}else P.push(t,D)}}}function xN(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function o2(e,n,t,r){for(let a=t;a<r;a++)if(n[a]===e)return a;return-1}function UU(e,n,t,r){return s2(this.multi,[])}function jU(e,n,t,r){const a=this.multi;let f;if(this.providerFactory){const _=this.providerFactory.componentProviders,T=wu(t,t[K],this.providerFactory.index,r);f=T.slice(0,_),s2(a,f);for(let D=_;D<T.length;D++)f.push(T[D])}else f=[],s2(a,f);return f}function s2(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function yr(e,n=[]){return t=>{t.providersResolver=(r,a)=>function VU(e,n,t){const r=fi();if(r.firstCreatePass){const a=nn(e);i2(t,r.data,r.blueprint,a,!0),i2(n,r.data,r.blueprint,a,!1)}}(r,a?a(e):e,n)}}let GU=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=pu(0,t.type),a=r.length>0?HE([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,a)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Mt({token:e,providedIn:"environment",factory:()=>new e($t(mo))})}return e})();function Bu(e){Yr("NgStandalone"),e.getStandaloneInjector=n=>n.get(GU).getOrCreateStandaloneInjector(e)}function Lc(e,n,t,r){return DN(mt(),vo(),e,n,t,r)}function fD(e,n,t,r,a,f){return function MN(e,n,t,r,a,f,_,T){const D=n+t;return function WE(e,n,t,r,a){const f=I_(e,n,t,r);return bo(e,n+2,a)||f}(e,D,a,f,_)?ch(e,D+3,T?r.call(T,a,f,_):r(a,f,_)):aw(e,D+3)}(mt(),vo(),e,n,t,r,a,f)}function EN(e,n,t,r,a,f,_){return function IN(e,n,t,r,a,f,_,T,D){const P=n+t;return function Rc(e,n,t,r,a,f){const _=I_(e,n,t,r);return I_(e,n+2,a,f)||_}(e,P,a,f,_,T)?ch(e,P+4,D?r.call(D,a,f,_,T):r(a,f,_,T)):aw(e,P+4)}(mt(),vo(),e,n,t,r,a,f,_)}function aw(e,n){const t=e[n];return t===Kn?void 0:t}function DN(e,n,t,r,a,f){const _=n+t;return bo(e,_,a)?ch(e,_+1,f?r.call(f,a):r(a)):aw(e,_+1)}function SN(e,n,t,r,a,f,_){const T=n+t;return I_(e,T,a,f)?ch(e,T+2,_?r.call(_,a,f):r(a,f)):aw(e,T+2)}function a2(e,n){const t=fi();let r;const a=e+nt;t.firstCreatePass?(r=function QU(e,n){if(n)for(let t=n.length-1;t>=0;t--){const r=n[t];if(e===r.name)return r}}(n,t.pipeRegistry),t.data[a]=r,r.onDestroy&&(t.destroyHooks??=[]).push(a,r.onDestroy)):r=t.data[a];const f=r.factory||(r.factory=oc(r.type)),T=bs(tt);try{const D=Eg(!1),P=f();return Eg(D),function t2(e,n,t,r){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=r}(t,mt(),a,P),P}finally{bs(T)}}function lw(e,n){return e[K].data[n].pure}function Ss(e,n){return cm(e,n)}let ZN=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const QN=new vt(""),gD=new vt("");let m2,f2=(()=>{class e{constructor(t,r,a){this._ngZone=t,this.registry=r,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,m2||(function Yj(e){m2=e}(a),a.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ii.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb()}});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1))}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,a){let f=-1;r&&r>0&&(f=setTimeout(()=>{this._callbacks=this._callbacks.filter(_=>_.timeoutId!==f),t()},r)),this._callbacks.push({doneCb:t,timeoutId:f,updateCb:a})}whenStable(t,r,a){if(a&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,a),this._runCallbacksIfReady()}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,a){return[]}static#e=this.\u0275fac=function(r){return new(r||e)($t(ii),$t(p2),$t(gD))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})(),p2=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return m2?.findTestabilityInTree(this,t,r)??null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function hw(e){return!!e&&"function"==typeof e.then}function ek(e){return!!e&&"function"==typeof e.subscribe}const g2=new vt("");let _2=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=Re(g2,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const a of this.appInits){const f=a();if(hw(f))t.push(f);else if(ek(f)){const _=new Promise((T,D)=>{f.subscribe({complete:T,error:D})});t.push(_)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(a=>{this.reject(a)}),0===t.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const _D=new vt("");function ik(e,n){return Array.isArray(n)?n.reduce(ik,e):{...e,...n}}let Bc=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Re(El),this.afterRenderEffectManager=Re(C),this.zonelessEnabled=Re(mm),this.externalTestViews=new Set,this.beforeRender=new Ci,this.afterTick=new Ci,this.componentTypes=[],this.components=[],this.isStable=Re(Cc).hasPendingTasks.pipe(q(t=>!t)),this._injector=Re(mo)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){const a=t instanceof Ox;if(!this._injector.get(_2).done)throw!a&&function lc(e){const n=qn(e)||jr(e)||po(e);return null!==n&&n.standalone}(t),new wt(405,!1);let _;_=a?t:this._injector.get(dv).resolveComponentFactory(t),this.componentTypes.push(_.componentType);const T=function Xj(e){return e.isBoundToModule}(_)?void 0:this._injector.get(M_),P=_.create(or.NULL,[],r||_.selector,T),L=P.location.nativeElement,G=P.injector.get(QN,null);return G?.registerApplication(L),P.onDestroy(()=>{this.detachView(P.hostView),yD(this.components,P),G?.unregisterApplication(L)}),this._loadComponent(P),P}tick(){this._tick(!0)}_tick(t){if(this._runningTick)throw new wt(101,!1);const r=On(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(t)}catch(a){this.internalErrorHandler(a)}finally{this._runningTick=!1,On(r),this.afterTick.next()}}detectChangesInAttachedViews(t){let r=null;this._injector.destroyed||(r=this._injector.get(Px,null,{optional:!0}));let a=0;const f=this.afterRenderEffectManager;for(;a<10;){const _=0===a;if(t||!_){this.beforeRender.next(_);for(let{_lView:T,notifyErrorHandler:D}of this._views)Jj(T,D,_,this.zonelessEnabled)}else r?.begin?.(),r?.end?.();if(a++,f.executeInternalCallbacks(),!this.allViews.some(({_lView:T})=>Ka(T))&&(f.execute(),!this.allViews.some(({_lView:T})=>Ka(T))))break}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;yD(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(_D,[]);[...this._bootstrapListeners,...r].forEach(a=>a(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>yD(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new wt(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function yD(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function Jj(e,n,t,r){(t||Ka(e))&&h_(e,n,t&&!r?0:1)}class Qj{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let ok=(()=>{class e{compileModuleSync(t){return new II(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),f=Aa(Po(t).declarations).reduce((_,T)=>{const D=qn(T);return D&&_.push(new Be(D)),_},[]);return new Qj(r,f)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),n6=(()=>{class e{constructor(){this.zone=Re(ii),this.changeDetectionScheduler=Re(Af),this.applicationRef=Re(Bc)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function y2({ngZoneFactory:e,ignoreChangesOutsideZone:n}){return e??=()=>new ii(v2()),[{provide:ii,useFactory:e},{provide:aa,multi:!0,useFactory:()=>{const t=Re(n6,{optional:!0});return()=>t.initialize()}},{provide:aa,multi:!0,useFactory:()=>{const t=Re(o6);return()=>{t.initialize()}}},{provide:El,useFactory:r6},!0===n?{provide:Ax,useValue:!0}:[]]}function r6(){const e=Re(ii),n=Re(ha);return t=>e.runOutsideAngular(()=>n.handleError(t))}function v2(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}let o6=(()=>{class e{constructor(){this.subscription=new Rt,this.initialized=!1,this.zone=Re(ii),this.pendingTasks=Re(Cc)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ii.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ii.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),fw=(()=>{class e{constructor(){this.appRef=Re(Bc),this.taskService=Re(Cc),this.ngZone=Re(ii),this.zonelessEnabled=Re(mm),this.disableScheduling=Re(Ax,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new Rt,this.cancelScheduledCallback=null,this.shouldRefreshViews=!1,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof E_||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&5===t)return;switch(t){case 3:case 2:case 0:case 4:case 5:case 1:this.shouldRefreshViews=!0}if(!this.shouldScheduleTick())return;const r=this.useMicrotaskScheduler?Nx:Rx;this.pendingRenderTaskId=this.taskService.add(),this.zoneIsDefined?Zone.root.run(()=>{this.cancelScheduledCallback=r(()=>{this.tick(this.shouldRefreshViews)})}):this.cancelScheduledCallback=r(()=>{this.tick(this.shouldRefreshViews)})}shouldScheduleTick(){return!(this.disableScheduling||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&ii.isInAngularZone())}tick(t){if(this.runningTick||this.appRef.destroyed)return;const r=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick(t)},void 0,this.schedulerTickApplyArgs)}catch(a){throw this.taskService.remove(r),a}finally{this.cleanup()}this.useMicrotaskScheduler=!0,Nx(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(r)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.shouldRefreshViews=!1,this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const hh=new vt("",{providedIn:"root",factory:()=>Re(hh,Yn.Optional|Yn.SkipSelf)||function s6(){return typeof $localize<"u"&&$localize.locale||Fv}()}),a6=new vt("",{providedIn:"root",factory:()=>"USD"}),x2=new vt("");let ck=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const a=function LE(e="zone.js",n){return"noop"===e?new E_:"zone.js"===e?new ii(n):e}(r?.ngZone,v2({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return a.run(()=>{const f=r?.ignoreChangesOutsideZone,_=function o5(e,n,t){return new MI(e,n,t)}(t.moduleType,this.injector,[...y2({ngZoneFactory:()=>a,ignoreChangesOutsideZone:f}),{provide:Af,useExisting:fw}]),T=_.injector.get(ha,null);return a.runOutsideAngular(()=>{const D=a.onError.subscribe({next:P=>{T.handleError(P)}});_.onDestroy(()=>{yD(this._modules,_),D.unsubscribe()})}),function nk(e,n,t){try{const r=t();return hw(r)?r.catch(a=>{throw n.runOutsideAngular(()=>e.handleError(a)),a}):r}catch(r){throw n.runOutsideAngular(()=>e.handleError(r)),r}}(T,a,()=>{const D=_.injector.get(_2);return D.runInitializers(),D.donePromise.then(()=>(function ER(e){"string"==typeof e&&(TR=e.toLowerCase().replace(/_/g,"-"))}(_.injector.get(hh,Fv)||Fv),this._moduleDoBootstrap(_),_))})})}bootstrapModule(t,r=[]){const a=ik({},r);return function t6(e,n,t){const r=new II(t);return Promise.resolve(r)}(0,0,t).then(f=>this.bootstrapModuleFactory(f,a))}_moduleDoBootstrap(t){const r=t.injector.get(Bc);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(a=>r.bootstrap(a));else{if(!t.instance.ngDoBootstrap)throw new wt(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new wt(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(x2,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||e)($t(or))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),wm=null;const uk=new vt("");function dk(e,n,t=[]){const r=`Platform: ${n}`,a=new vt(r);return(f=[])=>{let _=w2();if(!_||_.injector.get(uk,!1)){const T=[...t,...f,{provide:a,useValue:!0}];e?e(T):function c6(e){if(wm&&!wm.get(uk,!1))throw new wt(400,!1);(function tk(){!function ai(e){ql=e}(()=>{throw new wt(600,!1)})})(),wm=e;const n=e.get(ck);(function fk(e){e.get(fb,null)?.forEach(t=>t())})(e)}(function hk(e=[],n){return or.create({name:n,providers:[{provide:Ad,useValue:"platform"},{provide:x2,useValue:new Set([()=>wm=null])},...e]})}(T,r))}return function u6(e){const n=w2();if(!n)throw new wt(401,!1);return n}()}}function w2(){return wm?.get(ck)??null}let zc=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=h6}return e})();function h6(e){return function f6(e,n,t){if(xn(e)&&!t){const r=io(e.index,n);return new Es(r,r)}return 175&e.type?new Es(n[We],n):null}(Wi(),mt(),!(16&~e))}class yk{constructor(){}supports(n){return qE(n)}create(n){return new y6(n)}}const _6=(e,n)=>n;class y6{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||_6}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,r=this._removalsHead,a=0,f=null;for(;t||r;){const _=!r||t&&t.currentIndex<bk(r,a,f)?t:r,T=bk(_,a,f),D=_.currentIndex;if(_===r)a--,r=r._nextRemoved;else if(t=t._next,null==_.previousIndex)a++;else{f||(f=[]);const P=T-a,L=D-a;if(P!=L){for(let ie=0;ie<P;ie++){const oe=ie<f.length?f[ie]:f[ie]=0,Ce=oe+ie;L<=Ce&&Ce<P&&(f[ie]=oe+1)}f[_.previousIndex]=L-P}}T!==D&&n(_,T,D)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!qE(n))throw new wt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let a,f,_,t=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let T=0;T<this.length;T++)f=n[T],_=this._trackByFn(T,f),null!==t&&Object.is(t.trackById,_)?(r&&(t=this._verifyReinsertion(t,f,_,T)),Object.is(t.item,f)||this._addIdentityChange(t,f)):(t=this._mismatch(t,f,_,T),r=!0),t=t._next}else a=0,function l5(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let r;for(;!(r=t.next()).done;)n(r.value)}}(n,T=>{_=this._trackByFn(a,T),null!==t&&Object.is(t.trackById,_)?(r&&(t=this._verifyReinsertion(t,T,_,a)),Object.is(t.item,T)||this._addIdentityChange(t,T)):(t=this._mismatch(t,T,_,a),r=!0),t=t._next,a++}),this.length=a;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,r,a){let f;return null===n?f=this._itTail:(f=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,f,a)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,a))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,f,a)):n=this._addAfter(new v6(t,r),f,a),n}_verifyReinsertion(n,t,r,a){let f=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==f?n=this._reinsertAfter(f,n._prev,a):n.currentIndex!=a&&(n.currentIndex=a,this._addToMoves(n,a)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const a=n._prevRemoved,f=n._nextRemoved;return null===a?this._removalsHead=f:a._nextRemoved=f,null===f?this._removalsTail=a:f._prevRemoved=a,this._insertAfter(n,t,r),this._addToMoves(n,r),n}_moveAfter(n,t,r){return this._unlink(n),this._insertAfter(n,t,r),this._addToMoves(n,r),n}_addAfter(n,t,r){return this._insertAfter(n,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,r){const a=null===t?this._itHead:t._next;return n._next=a,n._prev=t,null===a?this._itTail=n:a._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new vk),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,r=n._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new vk),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class v6{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class b6{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const t=n._prevDup,r=n._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class vk{constructor(){this.map=new Map}put(n){const t=n.trackById;let r=this.map.get(t);r||(r=new b6,this.map.set(t,r)),r.add(n)}get(n,t){const a=this.map.get(n);return a?a.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function bk(e,n,t){const r=e.previousIndex;if(null===r)return r;let a=0;return t&&r<t.length&&(a=t[r]),r+n+a}function wk(){return new S2([new yk])}let S2=(()=>{class e{static#e=this.\u0275prov=Mt({token:e,providedIn:"root",factory:wk});constructor(t){this.factories=t}static create(t,r){if(null!=r){const a=r.factories.slice();t=t.concat(a)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||wk()),deps:[[e,new cu,new $h]]}}find(t){const r=this.factories.find(a=>a.supports(t));if(null!=r)return r;throw new wt(901,!1)}}return e})();const E6=dk(null,"core",[]);let D6=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(r){return new(r||e)($t(Bc))};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})();const Vk=new vt("");function zr(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function ID(e,n=NaN){return isNaN(parseFloat(e))||isNaN(Number(e))?n:Number(e)}function _w(e,n){Yr("NgSignals");const t=function Yu(e){const n=Object.create(hs);n.computation=e;const t=()=>{if(ya(n),ta(n),n.value===va)throw n.error;return n.value};return t[hr]=n,t}(e);return n?.equal&&(t[hr].equal=n.equal),t}function fh(e){const n=On(null);try{return e()}finally{On(n)}}function O2(e,n){const t=qn(e),r=n.elementInjector||Tl();return new Be(t).create(r,n.projectableNodes,n.hostElement,n.environmentInjector)}let Xk=null;function Cm(){return Xk}class m8{}const Xr=new vt("");let P2=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:()=>Re(_8),providedIn:"platform"})}return e})();const g8=new vt("");let _8=(()=>{class e extends P2{constructor(){super(),this._doc=Re(Xr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Cm().getBaseHref(this._doc)}onPopState(t){const r=Cm().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=Cm().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,a){this._history.pushState(t,r,a)}replaceState(t,r,a){this._history.replaceState(t,r,a)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function R2(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function Kk(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function Nf(e){return e&&"?"!==e[0]?"?"+e:e}let N_=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:()=>Re(Qk),providedIn:"root"})}return e})();const Jk=new vt("");let Qk=(()=>{class e extends N_{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Re(Xr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return R2(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+Nf(this._platformLocation.search),a=this._platformLocation.hash;return a&&t?`${r}${a}`:r}pushState(t,r,a,f){const _=this.prepareExternalUrl(a+Nf(f));this._platformLocation.pushState(t,r,_)}replaceState(t,r,a,f){const _=this.prepareExternalUrl(a+Nf(f));this._platformLocation.replaceState(t,r,_)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)($t(P2),$t(Jk,8))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),y8=(()=>{class e extends N_{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){const r=this._platformLocation.hash??"#";return r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=R2(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,a,f){let _=this.prepareExternalUrl(a+Nf(f));0==_.length&&(_=this._platformLocation.pathname),this._platformLocation.pushState(t,r,_)}replaceState(t,r,a,f){let _=this.prepareExternalUrl(a+Nf(f));0==_.length&&(_=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,_)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)($t(P2),$t(Jk,8))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})(),yw=(()=>{class e{constructor(t){this._subject=new fn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function x8(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(Kk(eF(r))),this._locationStrategy.onPopState(a=>{this._subject.emit({url:this.path(!0),pop:!0,state:a.state,type:a.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Nf(r))}normalize(t){return e.stripTrailingSlash(function b8(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,eF(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",a=null){this._locationStrategy.pushState(a,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Nf(r)),a)}replaceState(t,r="",a=null){this._locationStrategy.replaceState(a,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Nf(r)),a)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(a=>a(t,r))}subscribe(t,r,a){return this._subject.subscribe({next:t,error:r,complete:a})}static#e=this.normalizeQueryParams=Nf;static#t=this.joinWithSlash=R2;static#n=this.stripTrailingSlash=Kk;static#i=this.\u0275fac=function(r){return new(r||e)($t(N_))};static#r=this.\u0275prov=Mt({token:e,factory:()=>function v8(){return new yw($t(N_))}(),providedIn:"root"})}return e})();function eF(e){return e.replace(/\/index.html$/,"")}const tF={ADP:[void 0,void 0,0],AFN:[void 0,"\u060b",0],ALL:[void 0,void 0,0],AMD:[void 0,"\u058f",2],AOA:[void 0,"Kz"],ARS:[void 0,"$"],AUD:["A$","$"],AZN:[void 0,"\u20bc"],BAM:[void 0,"KM"],BBD:[void 0,"$"],BDT:[void 0,"\u09f3"],BHD:[void 0,void 0,3],BIF:[void 0,void 0,0],BMD:[void 0,"$"],BND:[void 0,"$"],BOB:[void 0,"Bs"],BRL:["R$"],BSD:[void 0,"$"],BWP:[void 0,"P"],BYN:[void 0,void 0,2],BYR:[void 0,void 0,0],BZD:[void 0,"$"],CAD:["CA$","$",2],CHF:[void 0,void 0,2],CLF:[void 0,void 0,4],CLP:[void 0,"$",0],CNY:["CN\xa5","\xa5"],COP:[void 0,"$",2],CRC:[void 0,"\u20a1",2],CUC:[void 0,"$"],CUP:[void 0,"$"],CZK:[void 0,"K\u010d",2],DJF:[void 0,void 0,0],DKK:[void 0,"kr",2],DOP:[void 0,"$"],EGP:[void 0,"E\xa3"],ESP:[void 0,"\u20a7",0],EUR:["\u20ac"],FJD:[void 0,"$"],FKP:[void 0,"\xa3"],GBP:["\xa3"],GEL:[void 0,"\u20be"],GHS:[void 0,"GH\u20b5"],GIP:[void 0,"\xa3"],GNF:[void 0,"FG",0],GTQ:[void 0,"Q"],GYD:[void 0,"$",2],HKD:["HK$","$"],HNL:[void 0,"L"],HRK:[void 0,"kn"],HUF:[void 0,"Ft",2],IDR:[void 0,"Rp",2],ILS:["\u20aa"],INR:["\u20b9"],IQD:[void 0,void 0,0],IRR:[void 0,void 0,0],ISK:[void 0,"kr",0],ITL:[void 0,void 0,0],JMD:[void 0,"$"],JOD:[void 0,void 0,3],JPY:["\xa5",void 0,0],KHR:[void 0,"\u17db"],KMF:[void 0,"CF",0],KPW:[void 0,"\u20a9",0],KRW:["\u20a9",void 0,0],KWD:[void 0,void 0,3],KYD:[void 0,"$"],KZT:[void 0,"\u20b8"],LAK:[void 0,"\u20ad",0],LBP:[void 0,"L\xa3",0],LKR:[void 0,"Rs"],LRD:[void 0,"$"],LTL:[void 0,"Lt"],LUF:[void 0,void 0,0],LVL:[void 0,"Ls"],LYD:[void 0,void 0,3],MGA:[void 0,"Ar",0],MGF:[void 0,void 0,0],MMK:[void 0,"K",0],MNT:[void 0,"\u20ae",2],MRO:[void 0,void 0,0],MUR:[void 0,"Rs",2],MXN:["MX$","$"],MYR:[void 0,"RM"],NAD:[void 0,"$"],NGN:[void 0,"\u20a6"],NIO:[void 0,"C$"],NOK:[void 0,"kr",2],NPR:[void 0,"Rs"],NZD:["NZ$","$"],OMR:[void 0,void 0,3],PHP:["\u20b1"],PKR:[void 0,"Rs",2],PLN:[void 0,"z\u0142"],PYG:[void 0,"\u20b2",0],RON:[void 0,"lei"],RSD:[void 0,void 0,0],RUB:[void 0,"\u20bd"],RWF:[void 0,"RF",0],SBD:[void 0,"$"],SEK:[void 0,"kr",2],SGD:[void 0,"$"],SHP:[void 0,"\xa3"],SLE:[void 0,void 0,2],SLL:[void 0,void 0,0],SOS:[void 0,void 0,0],SRD:[void 0,"$"],SSP:[void 0,"\xa3"],STD:[void 0,void 0,0],STN:[void 0,"Db"],SYP:[void 0,"\xa3",0],THB:[void 0,"\u0e3f"],TMM:[void 0,void 0,0],TND:[void 0,void 0,3],TOP:[void 0,"T$"],TRL:[void 0,void 0,0],TRY:[void 0,"\u20ba"],TTD:[void 0,"$"],TWD:["NT$","$",2],TZS:[void 0,void 0,2],UAH:[void 0,"\u20b4"],UGX:[void 0,void 0,0],USD:["$"],UYI:[void 0,void 0,0],UYU:[void 0,"$"],UYW:[void 0,void 0,4],UZS:[void 0,void 0,2],VEF:[void 0,"Bs",2],VND:["\u20ab",void 0,0],VUV:[void 0,void 0,0],XAF:["FCFA",void 0,0],XCD:["EC$","$"],XOF:["F\u202fCFA",void 0,0],XPF:["CFPF",void 0,0],XXX:["\xa4"],YER:[void 0,void 0,0],ZAR:[void 0,"R"],ZMK:[void 0,void 0,0],ZMW:[void 0,"ZK"],ZWD:[void 0,void 0,0]};var AD=function(e){return e[e.Decimal=0]="Decimal",e[e.Percent=1]="Percent",e[e.Currency=2]="Currency",e[e.Scientific=3]="Scientific",e}(AD||{}),Fa=function(e){return e[e.Format=0]="Format",e[e.Standalone=1]="Standalone",e}(Fa||{}),Er=function(e){return e[e.Narrow=0]="Narrow",e[e.Abbreviated=1]="Abbreviated",e[e.Wide=2]="Wide",e[e.Short=3]="Short",e}(Er||{}),Fl=function(e){return e[e.Short=0]="Short",e[e.Medium=1]="Medium",e[e.Long=2]="Long",e[e.Full=3]="Full",e}(Fl||{});const Bo={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function OD(e,n){return Uc(Na(e)[Ir.DateFormat],n)}function PD(e,n){return Uc(Na(e)[Ir.TimeFormat],n)}function RD(e,n){return Uc(Na(e)[Ir.DateTimeFormat],n)}function Vc(e,n){const t=Na(e),r=t[Ir.NumberSymbols][n];if(typeof r>"u"){if(n===Bo.CurrencyDecimal)return t[Ir.NumberSymbols][Bo.Decimal];if(n===Bo.CurrencyGroup)return t[Ir.NumberSymbols][Bo.Group]}return r}function nF(e){if(!e[Ir.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[Ir.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Uc(e,n){for(let t=n;t>-1;t--)if(typeof e[t]<"u")return e[t];throw new Error("Locale data API: locale data undefined")}function k2(e){const[n,t]=e.split(":");return{hours:+n,minutes:+t}}const k8=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ND={},F8=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var kf=function(e){return e[e.Short=0]="Short",e[e.ShortGMT=1]="ShortGMT",e[e.Long=2]="Long",e[e.Extended=3]="Extended",e}(kf||{}),tr=function(e){return e[e.FullYear=0]="FullYear",e[e.Month=1]="Month",e[e.Date=2]="Date",e[e.Hours=3]="Hours",e[e.Minutes=4]="Minutes",e[e.Seconds=5]="Seconds",e[e.FractionalSeconds=6]="FractionalSeconds",e[e.Day=7]="Day",e}(tr||{}),nr=function(e){return e[e.DayPeriods=0]="DayPeriods",e[e.Days=1]="Days",e[e.Months=2]="Months",e[e.Eras=3]="Eras",e}(nr||{});function iF(e,n,t,r){let a=function H8(e){if(sF(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[a,f=1,_=1]=e.split("-").map(T=>+T);return kD(a,f-1,_)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let r;if(r=e.match(k8))return function q8(e){const n=new Date(0);let t=0,r=0;const a=e[8]?n.setUTCFullYear:n.setFullYear,f=e[8]?n.setUTCHours:n.setHours;e[9]&&(t=Number(e[9]+e[10]),r=Number(e[9]+e[11])),a.call(n,Number(e[1]),Number(e[2])-1,Number(e[3]));const _=Number(e[4]||0)-t,T=Number(e[5]||0)-r,D=Number(e[6]||0),P=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return f.call(n,_,T,D,P),n}(r)}const n=new Date(e);if(!sF(n))throw new Error(`Unable to convert "${e}" into a date`);return n}(e);n=Ff(t,n)||n;let T,_=[];for(;n;){if(T=F8.exec(n),!T){_.push(n);break}{_=_.concat(T.slice(1));const L=_.pop();if(!L)break;n=L}}let D=a.getTimezoneOffset();r&&(D=oF(r,D),a=function G8(e,n,t){const r=t?-1:1,a=e.getTimezoneOffset();return function $8(e,n){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+n),e}(e,r*(oF(n,a)-a))}(a,r,!0));let P="";return _.forEach(L=>{const G=function j8(e){if(L2[e])return L2[e];let n;switch(e){case"G":case"GG":case"GGG":n=Ar(nr.Eras,Er.Abbreviated);break;case"GGGG":n=Ar(nr.Eras,Er.Wide);break;case"GGGGG":n=Ar(nr.Eras,Er.Narrow);break;case"y":n=zo(tr.FullYear,1,0,!1,!0);break;case"yy":n=zo(tr.FullYear,2,0,!0,!0);break;case"yyy":n=zo(tr.FullYear,3,0,!1,!0);break;case"yyyy":n=zo(tr.FullYear,4,0,!1,!0);break;case"Y":n=zD(1);break;case"YY":n=zD(2,!0);break;case"YYY":n=zD(3);break;case"YYYY":n=zD(4);break;case"M":case"L":n=zo(tr.Month,1,1);break;case"MM":case"LL":n=zo(tr.Month,2,1);break;case"MMM":n=Ar(nr.Months,Er.Abbreviated);break;case"MMMM":n=Ar(nr.Months,Er.Wide);break;case"MMMMM":n=Ar(nr.Months,Er.Narrow);break;case"LLL":n=Ar(nr.Months,Er.Abbreviated,Fa.Standalone);break;case"LLLL":n=Ar(nr.Months,Er.Wide,Fa.Standalone);break;case"LLLLL":n=Ar(nr.Months,Er.Narrow,Fa.Standalone);break;case"w":n=F2(1);break;case"ww":n=F2(2);break;case"W":n=F2(1,!0);break;case"d":n=zo(tr.Date,1);break;case"dd":n=zo(tr.Date,2);break;case"c":case"cc":n=zo(tr.Day,1);break;case"ccc":n=Ar(nr.Days,Er.Abbreviated,Fa.Standalone);break;case"cccc":n=Ar(nr.Days,Er.Wide,Fa.Standalone);break;case"ccccc":n=Ar(nr.Days,Er.Narrow,Fa.Standalone);break;case"cccccc":n=Ar(nr.Days,Er.Short,Fa.Standalone);break;case"E":case"EE":case"EEE":n=Ar(nr.Days,Er.Abbreviated);break;case"EEEE":n=Ar(nr.Days,Er.Wide);break;case"EEEEE":n=Ar(nr.Days,Er.Narrow);break;case"EEEEEE":n=Ar(nr.Days,Er.Short);break;case"a":case"aa":case"aaa":n=Ar(nr.DayPeriods,Er.Abbreviated);break;case"aaaa":n=Ar(nr.DayPeriods,Er.Wide);break;case"aaaaa":n=Ar(nr.DayPeriods,Er.Narrow);break;case"b":case"bb":case"bbb":n=Ar(nr.DayPeriods,Er.Abbreviated,Fa.Standalone,!0);break;case"bbbb":n=Ar(nr.DayPeriods,Er.Wide,Fa.Standalone,!0);break;case"bbbbb":n=Ar(nr.DayPeriods,Er.Narrow,Fa.Standalone,!0);break;case"B":case"BB":case"BBB":n=Ar(nr.DayPeriods,Er.Abbreviated,Fa.Format,!0);break;case"BBBB":n=Ar(nr.DayPeriods,Er.Wide,Fa.Format,!0);break;case"BBBBB":n=Ar(nr.DayPeriods,Er.Narrow,Fa.Format,!0);break;case"h":n=zo(tr.Hours,1,-12);break;case"hh":n=zo(tr.Hours,2,-12);break;case"H":n=zo(tr.Hours,1);break;case"HH":n=zo(tr.Hours,2);break;case"m":n=zo(tr.Minutes,1);break;case"mm":n=zo(tr.Minutes,2);break;case"s":n=zo(tr.Seconds,1);break;case"ss":n=zo(tr.Seconds,2);break;case"S":n=zo(tr.FractionalSeconds,1);break;case"SS":n=zo(tr.FractionalSeconds,2);break;case"SSS":n=zo(tr.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":n=LD(kf.Short);break;case"ZZZZZ":n=LD(kf.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=LD(kf.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":n=LD(kf.Long);break;default:return null}return L2[e]=n,n}(L);P+=G?G(a,t,D):"''"===L?"'":L.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),P}function kD(e,n,t){const r=new Date(0);return r.setFullYear(e,n,t),r.setHours(0,0,0),r}function Ff(e,n){const t=function C8(e){return Na(e)[Ir.LocaleId]}(e);if(ND[t]??={},ND[t][n])return ND[t][n];let r="";switch(n){case"shortDate":r=OD(e,Fl.Short);break;case"mediumDate":r=OD(e,Fl.Medium);break;case"longDate":r=OD(e,Fl.Long);break;case"fullDate":r=OD(e,Fl.Full);break;case"shortTime":r=PD(e,Fl.Short);break;case"mediumTime":r=PD(e,Fl.Medium);break;case"longTime":r=PD(e,Fl.Long);break;case"fullTime":r=PD(e,Fl.Full);break;case"short":const a=Ff(e,"shortTime"),f=Ff(e,"shortDate");r=FD(RD(e,Fl.Short),[a,f]);break;case"medium":const _=Ff(e,"mediumTime"),T=Ff(e,"mediumDate");r=FD(RD(e,Fl.Medium),[_,T]);break;case"long":const D=Ff(e,"longTime"),P=Ff(e,"longDate");r=FD(RD(e,Fl.Long),[D,P]);break;case"full":const L=Ff(e,"fullTime"),G=Ff(e,"fullDate");r=FD(RD(e,Fl.Full),[L,G])}return r&&(ND[t][n]=r),r}function FD(e,n){return n&&(e=e.replace(/\{([^}]+)}/g,function(t,r){return null!=n&&r in n?n[r]:t})),e}function zu(e,n,t="-",r,a){let f="";(e<0||a&&e<=0)&&(a?e=1-e:(e=-e,f=t));let _=String(e);for(;_.length<n;)_="0"+_;return r&&(_=_.slice(_.length-n)),f+_}function zo(e,n,t=0,r=!1,a=!1){return function(f,_){let T=function B8(e,n){switch(e){case tr.FullYear:return n.getFullYear();case tr.Month:return n.getMonth();case tr.Date:return n.getDate();case tr.Hours:return n.getHours();case tr.Minutes:return n.getMinutes();case tr.Seconds:return n.getSeconds();case tr.FractionalSeconds:return n.getMilliseconds();case tr.Day:return n.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,f);if((t>0||T>-t)&&(T+=t),e===tr.Hours)0===T&&-12===t&&(T=12);else if(e===tr.FractionalSeconds)return function L8(e,n){return zu(e,3).substring(0,n)}(T,n);const D=Vc(_,Bo.MinusSign);return zu(T,n,D,r,a)}}function Ar(e,n,t=Fa.Format,r=!1){return function(a,f){return function z8(e,n,t,r,a,f){switch(t){case nr.Months:return function D8(e,n,t){const r=Na(e),f=Uc([r[Ir.MonthsFormat],r[Ir.MonthsStandalone]],n);return Uc(f,t)}(n,a,r)[e.getMonth()];case nr.Days:return function E8(e,n,t){const r=Na(e),f=Uc([r[Ir.DaysFormat],r[Ir.DaysStandalone]],n);return Uc(f,t)}(n,a,r)[e.getDay()];case nr.DayPeriods:const _=e.getHours(),T=e.getMinutes();if(f){const P=function A8(e){const n=Na(e);return nF(n),(n[Ir.ExtraData][2]||[]).map(r=>"string"==typeof r?k2(r):[k2(r[0]),k2(r[1])])}(n),L=function O8(e,n,t){const r=Na(e);nF(r);const f=Uc([r[Ir.ExtraData][0],r[Ir.ExtraData][1]],n)||[];return Uc(f,t)||[]}(n,a,r),G=P.findIndex(ie=>{if(Array.isArray(ie)){const[oe,Ce]=ie,Ae=_>=oe.hours&&T>=oe.minutes,je=_<Ce.hours||_===Ce.hours&&T<Ce.minutes;if(oe.hours<Ce.hours){if(Ae&&je)return!0}else if(Ae||je)return!0}else if(ie.hours===_&&ie.minutes===T)return!0;return!1});if(-1!==G)return L[G]}return function T8(e,n,t){const r=Na(e),f=Uc([r[Ir.DayPeriodsFormat],r[Ir.DayPeriodsStandalone]],n);return Uc(f,t)}(n,a,r)[_<12?0:1];case nr.Eras:return function S8(e,n){return Uc(Na(e)[Ir.Eras],n)}(n,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${t}`)}}(a,f,e,n,t,r)}}function LD(e){return function(n,t,r){const a=-1*r,f=Vc(t,Bo.MinusSign),_=a>0?Math.floor(a/60):Math.ceil(a/60);switch(e){case kf.Short:return(a>=0?"+":"")+zu(_,2,f)+zu(Math.abs(a%60),2,f);case kf.ShortGMT:return"GMT"+(a>=0?"+":"")+zu(_,1,f);case kf.Long:return"GMT"+(a>=0?"+":"")+zu(_,2,f)+":"+zu(Math.abs(a%60),2,f);case kf.Extended:return 0===r?"Z":(a>=0?"+":"")+zu(_,2,f)+":"+zu(Math.abs(a%60),2,f);default:throw new Error(`Unknown zone width "${e}"`)}}}const V8=0,BD=4;function rF(e){const n=e.getDay(),t=0===n?-3:BD-n;return kD(e.getFullYear(),e.getMonth(),e.getDate()+t)}function F2(e,n=!1){return function(t,r){let a;if(n){const f=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,_=t.getDate();a=1+Math.floor((_+f)/7)}else{const f=rF(t),_=function U8(e){const n=kD(e,V8,1).getDay();return kD(e,0,1+(n<=BD?BD:BD+7)-n)}(f.getFullYear()),T=f.getTime()-_.getTime();a=1+Math.round(T/6048e5)}return zu(a,e,Vc(r,Bo.MinusSign))}}function zD(e,n=!1){return function(t,r){return zu(rF(t).getFullYear(),e,Vc(r,Bo.MinusSign),n)}}const L2={};function oF(e,n){e=e.replace(/:/g,"");const t=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(t)?n:t}function sF(e){return e instanceof Date&&!isNaN(e.valueOf())}const W8=/^(\d+)?\.((\d+)(-(\d+))?)?$/,aF=22,VD=".",vw="0",Z8=";",Y8=",",B2="#";function K8(e,n,t,r,a){const _=function V2(e,n="-"){const t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(Z8),a=r[0],f=r[1],_=-1!==a.indexOf(VD)?a.split(VD):[a.substring(0,a.lastIndexOf(vw)+1),a.substring(a.lastIndexOf(vw)+1)],T=_[0],D=_[1]||"";t.posPre=T.substring(0,T.indexOf(B2));for(let L=0;L<D.length;L++){const G=D.charAt(L);G===vw?t.minFrac=t.maxFrac=L+1:G===B2?t.maxFrac=L+1:t.posSuf+=G}const P=T.split(Y8);if(t.gSize=P[1]?P[1].length:0,t.lgSize=P[2]||P[1]?(P[2]||P[1]).length:0,f){const L=a.length-t.posPre.length-t.posSuf.length,G=f.indexOf(B2);t.negPre=f.substring(0,G).replace(/'/g,""),t.negSuf=f.slice(G+L).replace(/'/g,"")}else t.negPre=n+t.posPre,t.negSuf=t.posSuf;return t}(function N2(e,n){return Na(e)[Ir.NumberFormats][n]}(n,AD.Currency),Vc(n,Bo.MinusSign));return _.minFrac=function N8(e){let n;const t=tF[e];return t&&(n=t[2]),"number"==typeof n?n:2}(r),_.maxFrac=_.minFrac,function z2(e,n,t,r,a,f,_=!1){let T="",D=!1;if(isFinite(e)){let P=function t$(e){let r,a,f,_,T,n=Math.abs(e)+"",t=0;for((a=n.indexOf(VD))>-1&&(n=n.replace(VD,"")),(f=n.search(/e/i))>0?(a<0&&(a=f),a+=+n.slice(f+1),n=n.substring(0,f)):a<0&&(a=n.length),f=0;n.charAt(f)===vw;f++);if(f===(T=n.length))r=[0],a=1;else{for(T--;n.charAt(T)===vw;)T--;for(a-=f,r=[],_=0;f<=T;f++,_++)r[_]=Number(n.charAt(f))}return a>aF&&(r=r.splice(0,aF-1),t=a-1,a=1),{digits:r,exponent:t,integerLen:a}}(e);_&&(P=function e$(e){if(0===e.digits[0])return e;const n=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===n?e.digits.push(0,0):1===n&&e.digits.push(0),e.integerLen+=2),e}(P));let L=n.minInt,G=n.minFrac,ie=n.maxFrac;if(f){const Ze=f.match(W8);if(null===Ze)throw new Error(`${f} is not a valid digit info`);const Et=Ze[1],Ut=Ze[3],ln=Ze[5];null!=Et&&(L=U2(Et)),null!=Ut&&(G=U2(Ut)),null!=ln?ie=U2(ln):null!=Ut&&G>ie&&(ie=G)}!function n$(e,n,t){if(n>t)throw new Error(`The minimum number of digits after fraction (${n}) is higher than the maximum (${t}).`);let r=e.digits,a=r.length-e.integerLen;const f=Math.min(Math.max(n,a),t);let _=f+e.integerLen,T=r[_];if(_>0){r.splice(Math.max(e.integerLen,_));for(let G=_;G<r.length;G++)r[G]=0}else{a=Math.max(0,a),e.integerLen=1,r.length=Math.max(1,_=f+1),r[0]=0;for(let G=1;G<_;G++)r[G]=0}if(T>=5)if(_-1<0){for(let G=0;G>_;G--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[_-1]++;for(;a<Math.max(0,f);a++)r.push(0);let D=0!==f;const P=n+e.integerLen,L=r.reduceRight(function(G,ie,oe,Ce){return Ce[oe]=(ie+=G)<10?ie:ie-10,D&&(0===Ce[oe]&&oe>=P?Ce.pop():D=!1),ie>=10?1:0},0);L&&(r.unshift(L),e.integerLen++)}(P,G,ie);let oe=P.digits,Ce=P.integerLen;const Ae=P.exponent;let je=[];for(D=oe.every(Ze=>!Ze);Ce<L;Ce++)oe.unshift(0);for(;Ce<0;Ce++)oe.unshift(0);Ce>0?je=oe.splice(Ce,oe.length):(je=oe,oe=[0]);const et=[];for(oe.length>=n.lgSize&&et.unshift(oe.splice(-n.lgSize,oe.length).join(""));oe.length>n.gSize;)et.unshift(oe.splice(-n.gSize,oe.length).join(""));oe.length&&et.unshift(oe.join("")),T=et.join(Vc(t,r)),je.length&&(T+=Vc(t,a)+je.join("")),Ae&&(T+=Vc(t,Bo.Exponential)+"+"+Ae)}else T=Vc(t,Bo.Infinity);return T=e<0&&!D?n.negPre+T+n.negSuf:n.posPre+T+n.posSuf,T}(e,_,n,Bo.CurrencyGroup,Bo.CurrencyDecimal,a).replace("\xa4",t).replace("\xa4","").trim()}function U2(e){const n=parseInt(e);if(isNaN(n))throw new Error("Invalid integer literal when parsing "+e);return n}function uF(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const r=t.indexOf("="),[a,f]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(a.trim()===n)return decodeURIComponent(f)}return null}const $2=/\s+/,dF=[];let bw=(()=>{class e{constructor(t,r){this._ngEl=t,this._renderer=r,this.initialClasses=dF,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split($2):dF}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split($2):t}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const r of t)this._updateState(r,!0);else if(null!=t)for(const r of Object.keys(t))this._updateState(r,!!t[r]);this._applyStateDiff()}_updateState(t,r){const a=this.stateMap.get(t);void 0!==a?(a.enabled!==r&&(a.changed=!0,a.enabled=r),a.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const r=t[0],a=t[1];a.changed?(this._toggleClass(r,a.enabled),a.changed=!1):a.touched||(a.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),a.touched=!1}}_toggleClass(t,r){(t=t.trim()).length>0&&t.split($2).forEach(a=>{r?this._renderer.addClass(this._ngEl.nativeElement,a):this._renderer.removeClass(this._ngEl.nativeElement,a)})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(wi),tt(Oc))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class o${constructor(n,t,r,a){this.$implicit=n,this.ngForOf=t,this.index=r,this.count=a}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Lf=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,a){this._viewContainer=t,this._template=r,this._differs=a,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((a,f,_)=>{if(null==a.previousIndex)r.createEmbeddedView(this._template,new o$(a.item,this._ngForOf,-1,-1),null===_?void 0:_);else if(null==_)r.remove(null===f?void 0:f);else if(null!==f){const T=r.get(f);r.move(T,_),fF(T,a)}});for(let a=0,f=r.length;a<f;a++){const T=r.get(a).context;T.index=a,T.count=f,T.ngForOf=this._ngForOf}t.forEachIdentityChange(a=>{fF(r.get(a.currentIndex),a)})}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(tt($e),tt(li),tt(S2))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function fF(e,n){e.context.$implicit=n.item}let jc=(()=>{class e{constructor(t,r){this._viewContainer=t,this._context=new s$,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){pF("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){pF("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(tt($e),tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class s${constructor(){this.$implicit=null,this.ngIf=null}}function pF(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${sr(n)}'.`)}let k_=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){const r=this._viewContainerRef;if(this._viewRef&&r.remove(r.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const a=this._createContextForwardProxy();this._viewRef=r.createEmbeddedView(this.ngTemplateOutlet,a,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,r,a)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,r,a),get:(t,r,a)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,r,a)}})}static#e=this.\u0275fac=function(r){return new(r||e)(tt($e))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[kr]})}return e})();function Vu(e,n){return new wt(2100,!1)}const x$=new vt(""),w$=new vt("");let xw=(()=>{class e{constructor(t,r,a){this.locale=t,this.defaultTimezone=r,this.defaultOptions=a}transform(t,r,a,f){if(null==t||""===t||t!=t)return null;try{return iF(t,r??this.defaultOptions?.dateFormat??"mediumDate",f||this.locale,a??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(_){throw Vu()}}static#e=this.\u0275fac=function(r){return new(r||e)(tt(hh,16),tt(x$,24),tt(w$,24))};static#t=this.\u0275pipe=Jo({name:"date",type:e,pure:!0,standalone:!0})}return e})(),_F=(()=>{class e{constructor(t,r="USD"){this._locale=t,this._defaultCurrencyCode=r}transform(t,r=this._defaultCurrencyCode,a="symbol",f,_){if(!function q2(e){return!(null==e||""===e||e!=e)}(t))return null;_||=this._locale,"boolean"==typeof a&&(a=a?"symbol":"code");let T=r||this._defaultCurrencyCode;"code"!==a&&(T="symbol"===a||"symbol-narrow"===a?function P8(e,n,t="en"){const r=function M8(e){return Na(e)[Ir.Currencies]}(t)[e]||tF[e]||[],a=r[1];return"narrow"===n&&"string"==typeof a?a:r[0]||e}(T,"symbol"===a?"wide":"narrow",_):a);try{return K8(function W2(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(t),_,T,r,f)}catch(D){throw Vu()}}static#e=this.\u0275fac=function(r){return new(r||e)(tt(hh,16),tt(a6,16))};static#t=this.\u0275pipe=Jo({name:"currency",type:e,pure:!0,standalone:!0})}return e})();let yF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})();const vF="browser";function bF(e){return"server"===e}let R$=(()=>{class e{static#e=this.\u0275prov=Mt({token:e,providedIn:"root",factory:()=>function P$(e){return e===vF}(Re(Yd))?new N$(Re(Xr),window):new F$})}return e})();class N${constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n){this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){const t=function k$(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let a=r.currentNode;for(;a;){const f=a.shadowRoot;if(f){const _=f.getElementById(n)||f.querySelector(`[name="${n}"]`);if(_)return _}a=r.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.window.history.scrollRestoration=n}scrollToElement(n){const t=n.getBoundingClientRect(),r=t.left+this.window.pageXOffset,a=t.top+this.window.pageYOffset,f=this.offset();this.window.scrollTo(r-f[0],a-f[1])}}class F${setOffset(n){}getScrollPosition(){return[0,0]}scrollToPosition(n){}scrollToAnchor(n){}setHistoryScrollRestoration(n){}}class xF{}class uG extends m8{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class K2 extends uG{static makeCurrent(){!function p8(e){Xk??=e}(new K2)}onAndCancel(n,t,r){return n.addEventListener(t,r),()=>{n.removeEventListener(t,r)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function dG(){return Tw=Tw||document.querySelector("base"),Tw?Tw.getAttribute("href"):null}();return null==t?null:function hG(e){return new URL(e,document.baseURI).pathname}(t)}resetBaseElement(){Tw=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return uF(document.cookie,n)}}let Tw=null,pG=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();const GD=new vt("");let OF=(()=>{class e{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(a=>{a.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,a){return this._findPluginFor(r).addEventListener(t,r,a)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(f=>f.supports(t)),!r)throw new wt(5101,!1);return this._eventNameToPlugin.set(t,r),r}static#e=this.\u0275fac=function(r){return new(r||e)($t(GD),$t(ii))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();class J2{constructor(n){this._doc=n}}const Q2="ng-app-id";let PF=(()=>{class e{constructor(t,r,a,f={}){this.doc=t,this.appId=r,this.nonce=a,this.platformId=f,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=bF(f),this.resetHostNodes()}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.elements?.forEach(a=>a.remove()),r.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${Q2}="${this.appId}"]`);if(t?.length){const r=new Map;return t.forEach(a=>{null!=a.textContent&&r.set(a.textContent,a)}),r}return null}changeUsageCount(t,r){const a=this.styleRef;if(a.has(t)){const f=a.get(t);return f.usage+=r,f.usage}return a.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){const a=this.styleNodesInDOM,f=a?.get(r);if(f?.parentNode===t)return a.delete(r),f.removeAttribute(Q2),f;{const _=this.doc.createElement("style");return this.nonce&&_.setAttribute("nonce",this.nonce),_.textContent=r,this.platformIsServer&&_.setAttribute(Q2,this.appId),t.appendChild(_),_}}addStyleToHost(t,r){const a=this.getStyleElement(t,r),f=this.styleRef,_=f.get(r)?.elements;_?_.push(a):f.set(r,{elements:[a],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||e)($t(Xr),$t(Zd),$t(iT,8),$t(Yd))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();const eA={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},tA=/%COMP%/g,yG=new vt("",{providedIn:"root",factory:()=>!0});function NF(e,n){return n.map(t=>t.replace(tA,e))}let kF=(()=>{class e{constructor(t,r,a,f,_,T,D,P=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=a,this.removeStylesOnCompDestroy=f,this.doc=_,this.platformId=T,this.ngZone=D,this.nonce=P,this.rendererByCompId=new Map,this.platformIsServer=bF(T),this.defaultRenderer=new nA(t,_,D,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Bs.ShadowDom&&(r={...r,encapsulation:Bs.Emulated});const a=this.getOrCreateRenderer(t,r);return a instanceof LF?a.applyToHost(t):a instanceof iA&&a.applyStyles(),a}getOrCreateRenderer(t,r){const a=this.rendererByCompId;let f=a.get(r.id);if(!f){const _=this.doc,T=this.ngZone,D=this.eventManager,P=this.sharedStylesHost,L=this.removeStylesOnCompDestroy,G=this.platformIsServer;switch(r.encapsulation){case Bs.Emulated:f=new LF(D,P,r,this.appId,L,_,T,G);break;case Bs.ShadowDom:return new wG(D,P,t,r,_,T,this.nonce,G);default:f=new iA(D,P,r,L,_,T,G)}a.set(r.id,f)}return f}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||e)($t(OF),$t(PF),$t(Zd),$t(yG),$t(Xr),$t(Yd),$t(ii),$t(iT))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();class nA{constructor(n,t,r,a){this.eventManager=n,this.doc=t,this.ngZone=r,this.platformIsServer=a,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(eA[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(FF(n)?n.content:n).appendChild(t)}insertBefore(n,t,r){n&&(FF(n)?n.content:n).insertBefore(t,r)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new wt(-5104,!1);return t||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,r,a){if(a){t=a+":"+t;const f=eA[a];f?n.setAttributeNS(f,t,r):n.setAttribute(t,r)}else n.setAttribute(t,r)}removeAttribute(n,t,r){if(r){const a=eA[r];a?n.removeAttributeNS(a,t):n.removeAttribute(`${r}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,r,a){a&(Jd.DashCase|Jd.Important)?n.style.setProperty(t,r,a&Jd.Important?"important":""):n.style[t]=r}removeStyle(n,t,r){r&Jd.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,r){null!=n&&(n[t]=r)}setValue(n,t){n.nodeValue=t}listen(n,t,r){if("string"==typeof n&&!(n=Cm().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(r))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function FF(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class wG extends nA{constructor(n,t,r,a,f,_,T,D){super(n,f,_,D),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const P=NF(a.id,a.styles);for(const L of P){const G=document.createElement("style");T&&G.setAttribute("nonce",T),G.textContent=L,this.shadowRoot.appendChild(G)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,r){return super.insertBefore(this.nodeOrShadowRoot(n),t,r)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class iA extends nA{constructor(n,t,r,a,f,_,T,D){super(n,f,_,T),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=a,this.styles=D?NF(D,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class LF extends iA{constructor(n,t,r,a,f,_,T,D){const P=a+"-"+r.id;super(n,t,r,f,_,T,D,P),this.contentAttr=function vG(e){return"_ngcontent-%COMP%".replace(tA,e)}(P),this.hostAttr=function bG(e){return"_nghost-%COMP%".replace(tA,e)}(P)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const r=super.createElement(n,t);return super.setAttribute(r,this.contentAttr,""),r}}let CG=(()=>{class e extends J2{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,a){return t.addEventListener(r,a,!1),()=>this.removeEventListener(t,r,a)}removeEventListener(t,r,a){return t.removeEventListener(r,a)}static#e=this.\u0275fac=function(r){return new(r||e)($t(Xr))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})(),TG=(()=>{class e extends J2{constructor(t){super(t),this.delegate=Re(Vk,{optional:!0})}supports(t){return!!this.delegate&&this.delegate.supports(t)}addEventListener(t,r,a){return this.delegate.addEventListener(t,r,a)}removeEventListener(t,r,a){return this.delegate.removeEventListener(t,r,a)}static#e=this.\u0275fac=function(r){return new(r||e)($t(Xr))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();const BF=["alt","control","meta","shift"],EG={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},DG={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let SG=(()=>{class e extends J2{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,a){const f=e.parseEventName(r),_=e.eventCallback(f.fullKey,a,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Cm().onAndCancel(t,f.domEventName,_))}static parseEventName(t){const r=t.toLowerCase().split("."),a=r.shift();if(0===r.length||"keydown"!==a&&"keyup"!==a)return null;const f=e._normalizeKey(r.pop());let _="",T=r.indexOf("code");if(T>-1&&(r.splice(T,1),_="code."),BF.forEach(P=>{const L=r.indexOf(P);L>-1&&(r.splice(L,1),_+=P+".")}),_+=f,0!=r.length||0===f.length)return null;const D={};return D.domEventName=a,D.fullKey=_,D}static matchEventFullKeyCode(t,r){let a=EG[t.key]||t.key,f="";return r.indexOf("code.")>-1&&(a=t.code,f="code."),!(null==a||!a)&&(a=a.toLowerCase()," "===a?a="space":"."===a&&(a="dot"),BF.forEach(_=>{_!==a&&(0,DG[_])(t)&&(f+=_+".")}),f+=a,f===r)}static eventCallback(t,r,a){return f=>{e.matchEventFullKeyCode(f,t)&&a.runGuarded(()=>r(f))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(r){return new(r||e)($t(Xr))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();const OG=dk(E6,"browser",[{provide:Yd,useValue:vF},{provide:fb,useValue:function MG(){K2.makeCurrent()},multi:!0},{provide:Xr,useFactory:function AG(){return function nT(e){d0=e}(document),document},deps:[]}]),PG=new vt(""),UF=[{provide:gD,useClass:class fG{addToWindow(n){Yi.getAngularTestability=(r,a=!0)=>{const f=n.findTestabilityInTree(r,a);if(null==f)throw new wt(5103,!1);return f},Yi.getAllAngularTestabilities=()=>n.getAllTestabilities(),Yi.getAllAngularRootElements=()=>n.getAllRootElements(),Yi.frameworkStabilizers||(Yi.frameworkStabilizers=[]),Yi.frameworkStabilizers.push(r=>{const a=Yi.getAllAngularTestabilities();let f=a.length;const _=function(){f--,0==f&&r()};a.forEach(T=>{T.whenStable(_)})})}findTestabilityInTree(n,t,r){return null==t?null:n.getTestability(t)??(r?Cm().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:QN,useClass:f2,deps:[ii,p2,gD]},{provide:f2,useClass:f2,deps:[ii,p2,gD]}],jF=[{provide:Ad,useValue:"root"},{provide:ha,useFactory:function IG(){return new ha},deps:[]},{provide:GD,useClass:CG,multi:!0,deps:[Xr,ii,Yd]},{provide:GD,useClass:SG,multi:!0,deps:[Xr]},{provide:GD,useClass:TG,multi:!0},kF,PF,OF,{provide:Px,useExisting:kF},{provide:xF,useClass:pG,deps:[]},[]];let RG=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Zd,useValue:t.appId}]}}static#e=this.\u0275fac=function(r){return new(r||e)($t(PG,12))};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({providers:[...jF,...UF],imports:[yF,D6]})}return e})(),NG=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(r){return new(r||e)($t(Xr))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Ew=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:function(r){let a=null;return a=r?new(r||e):$t(BG),a},providedIn:"root"})}return e})(),BG=(()=>{class e extends Ew{constructor(t){super(),this._doc=t}sanitize(t,r){if(null==r)return null;switch(t){case tl.NONE:return r;case tl.HTML:return Dl(r,"HTML")?Ys(r):Ob(this._doc,String(r)).toString();case tl.STYLE:return Dl(r,"Style")?Ys(r):r;case tl.SCRIPT:if(Dl(r,"Script"))return Ys(r);throw new wt(5200,!1);case tl.URL:return Dl(r,"URL")?Ys(r):D0(String(r));case tl.RESOURCE_URL:if(Dl(r,"ResourceURL"))return Ys(r);throw new wt(5201,!1);default:throw new wt(5202,!1)}}bypassSecurityTrustHtml(t){return function bT(e){return new gT(e)}(t)}bypassSecurityTrustStyle(t){return function xT(e){return new E0(e)}(t)}bypassSecurityTrustScript(t){return function wT(e){return new _T(e)}(t)}bypassSecurityTrustUrl(t){return function OM(e){return new AM(e)}(t)}bypassSecurityTrustResourceUrl(t){return function CT(e){return new yT(e)}(t)}static#e=this.\u0275fac=function(r){return new(r||e)($t(Xr))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function HF(e,n,t,r,a,f,_){try{var T=e[f](_),D=T.value}catch(P){return void t(P)}T.done?n(D):Promise.resolve(D).then(r,a)}function qF(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var f=e.apply(n,t);function _(D){HF(f,r,a,_,T,"next",D)}function T(D){HF(f,r,a,_,T,"throw",D)}_(void 0)})}}function WF(e){return e&&Pt(e.schedule)}function rA(e){return e[e.length-1]}function qD(e){return Pt(rA(e))?e.pop():void 0}function Dw(e){return WF(rA(e))?e.pop():void 0}function Tm(e){return this instanceof Tm?(this.v=e,this):new Tm(e)}function KF(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function lA(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(f){t[f]=e[f]&&function(_){return new Promise(function(T,D){!function a(f,_,T,D){Promise.resolve(D).then(function(P){f({value:P,done:T})},_)}(T,D,(_=e[f](_)).done,_.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const cA=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function JF(e){return Pt(e?.then)}function QF(e){return Pt(e[fl])}function eL(e){return Symbol.asyncIterator&&Pt(e?.[Symbol.asyncIterator])}function tL(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const nL=function aH(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function iL(e){return Pt(e?.[nL])}function rL(e){return function XF(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,r=t.apply(e,n||[]),f=[];return a={},T("next"),T("throw"),T("return",function _(oe){return function(Ce){return Promise.resolve(Ce).then(oe,G)}}),a[Symbol.asyncIterator]=function(){return this},a;function T(oe,Ce){r[oe]&&(a[oe]=function(Ae){return new Promise(function(je,et){f.push([oe,Ae,je,et])>1||D(oe,Ae)})},Ce&&(a[oe]=Ce(a[oe])))}function D(oe,Ce){try{!function P(oe){oe.value instanceof Tm?Promise.resolve(oe.value.v).then(L,G):ie(f[0][2],oe)}(r[oe](Ce))}catch(Ae){ie(f[0][3],Ae)}}function L(oe){D("next",oe)}function G(oe){D("throw",oe)}function ie(oe,Ce){oe(Ce),f.shift(),f.length&&D(f[0][0],f[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:a}=yield Tm(t.read());if(a)return yield Tm(void 0);yield yield Tm(r)}}finally{t.releaseLock()}})}function oL(e){return Pt(e?.getReader)}function Ms(e){if(e instanceof Fi)return e;if(null!=e){if(QF(e))return function lH(e){return new Fi(n=>{const t=e[fl]();if(Pt(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(cA(e))return function cH(e){return new Fi(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(JF(e))return function uH(e){return new Fi(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,ja)})}(e);if(eL(e))return sL(e);if(iL(e))return function dH(e){return new Fi(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(oL(e))return function hH(e){return sL(rL(e))}(e)}throw tL(e)}function sL(e){return new Fi(n=>{(function fH(e,n){var t,r,a,f;return function ZF(e,n,t,r){return new(t||(t=Promise))(function(f,_){function T(L){try{P(r.next(L))}catch(G){_(G)}}function D(L){try{P(r.throw(L))}catch(G){_(G)}}function P(L){L.done?f(L.value):function a(f){return f instanceof t?f:new t(function(_){_(f)})}(L.value).then(T,D)}P((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=KF(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(_){a={error:_}}finally{try{r&&!r.done&&(f=t.return)&&(yield f.call(t))}finally{if(a)throw a.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Bf(e,n,t,r=0,a=!1){const f=n.schedule(function(){t(),a?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(f),!a)return f}function aL(e,n=0){return ir((t,r)=>{t.subscribe(ve(r,a=>Bf(r,e,()=>r.next(a),n),()=>Bf(r,e,()=>r.complete(),n),a=>Bf(r,e,()=>r.error(a),n)))})}function lL(e,n=0){return ir((t,r)=>{r.add(e.schedule(()=>t.subscribe(r),n))})}function cL(e,n){if(!e)throw new Error("Iterable cannot be null");return new Fi(t=>{Bf(t,n,()=>{const r=e[Symbol.asyncIterator]();Bf(t,n,()=>{r.next().then(a=>{a.done?t.complete():t.next(a.value)})},0,!0)})})}function Vo(e,n){return n?function vH(e,n){if(null!=e){if(QF(e))return function pH(e,n){return Ms(e).pipe(lL(n),aL(n))}(e,n);if(cA(e))return function gH(e,n){return new Fi(t=>{let r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}(e,n);if(JF(e))return function mH(e,n){return Ms(e).pipe(lL(n),aL(n))}(e,n);if(eL(e))return cL(e,n);if(iL(e))return function _H(e,n){return new Fi(t=>{let r;return Bf(t,n,()=>{r=e[nL](),Bf(t,n,()=>{let a,f;try{({value:a,done:f}=r.next())}catch(_){return void t.error(_)}f?t.complete():t.next(a)},0,!0)}),()=>Pt(r?.return)&&r.return()})}(e,n);if(oL(e))return function yH(e,n){return cL(rL(e),n)}(e,n)}throw tL(e)}(e,n):Ms(e)}function $n(...e){return Vo(e,Dw(e))}function Is(e,n,t=1/0){return Pt(n)?Is((r,a)=>q((f,_)=>n(r,f,a,_))(Ms(e(r,a))),t):("number"==typeof n&&(t=n),ir((r,a)=>function bH(e,n,t,r,a,f,_,T){const D=[];let P=0,L=0,G=!1;const ie=()=>{G&&!D.length&&!P&&n.complete()},oe=Ae=>P<r?Ce(Ae):D.push(Ae),Ce=Ae=>{f&&n.next(Ae),P++;let je=!1;Ms(t(Ae,L++)).subscribe(ve(n,et=>{a?.(et),f?oe(et):n.next(et)},()=>{je=!0},void 0,()=>{if(je)try{for(P--;D.length&&P<r;){const et=D.shift();_?Bf(n,_,()=>Ce(et)):Ce(et)}ie()}catch(et){n.error(et)}}))};return e.subscribe(ve(n,oe,()=>{G=!0,ie()})),()=>{T?.()}}(r,a,e,t)))}function Uv(e,n){return Pt(n)?Is(e,n,1):Is(e,1)}function Uo(e,n){return ir((t,r)=>{let a=0;t.subscribe(ve(r,f=>e.call(n,f,a++)&&r.next(f)))})}function Sw(e){return ir((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}function $c(e,n){return ir((t,r)=>{let a=null,f=0,_=!1;const T=()=>_&&!a&&r.complete();t.subscribe(ve(r,D=>{a?.unsubscribe();let P=0;const L=f++;Ms(e(D,L)).subscribe(a=ve(r,G=>r.next(n?n(D,G,L,P++):G),()=>{a=null,T()}))},()=>{_=!0,T()}))})}class WD{}class ZD{}class La{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const a=t.slice(0,r),f=a.toLowerCase(),_=t.slice(r+1).trim();this.maybeSetNormalizedName(a,f),this.headers.has(f)?this.headers.get(f).push(_):this.headers.set(f,[_])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof La?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){const t=new La;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof La?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){const t=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,t);const a=("a"===n.op?this.headers.get(t):void 0)||[];a.push(...r),this.headers.set(t,a);break;case"d":const f=n.value;if(f){let _=this.headers.get(t);if(!_)return;_=_.filter(T=>-1===f.indexOf(T)),0===_.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,_)}else this.headers.delete(t),this.normalizedNames.delete(t)}}setHeaderEntries(n,t){const r=(Array.isArray(t)?t:[t]).map(f=>f.toString()),a=n.toLowerCase();this.headers.set(a,r),this.maybeSetNormalizedName(n,a)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}}class xH{encodeKey(n){return uL(n)}encodeValue(n){return uL(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const CH=/%(\d[a-f0-9])/gi,TH={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function uL(e){return encodeURIComponent(e).replace(CH,(n,t)=>TH[t]??n)}function YD(e){return`${e}`}class Em{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new xH,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function wH(e,n){const t=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(a=>{const f=a.indexOf("="),[_,T]=-1==f?[n.decodeKey(a),""]:[n.decodeKey(a.slice(0,f)),n.decodeValue(a.slice(f+1))],D=t.get(_)||[];D.push(T),t.set(_,D)}),t}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{const r=n.fromObject[t],a=Array.isArray(r)?r.map(YD):[YD(r)];this.map.set(t,a)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){const t=[];return Object.keys(n).forEach(r=>{const a=n[r];Array.isArray(a)?a.forEach(f=>{t.push({param:r,value:f,op:"a"})}):t.push({param:r,value:a,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const t=this.encoder.encodeKey(n);return this.map.get(n).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const t=new Em({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const t=("a"===n.op?this.map.get(n.param):void 0)||[];t.push(YD(n.value)),this.map.set(n.param,t);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const a=r.indexOf(YD(n.value));-1!==a&&r.splice(a,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class EH{constructor(){this.map=new Map}set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function dL(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function hL(e){return typeof Blob<"u"&&e instanceof Blob}function fL(e){return typeof FormData<"u"&&e instanceof FormData}class Mw{constructor(n,t,r,a){let f;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function DH(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||a?(this.body=void 0!==r?r:null,f=a):f=r,f&&(this.reportProgress=!!f.reportProgress,this.withCredentials=!!f.withCredentials,f.responseType&&(this.responseType=f.responseType),f.headers&&(this.headers=f.headers),f.context&&(this.context=f.context),f.params&&(this.params=f.params),this.transferCache=f.transferCache),this.headers??=new La,this.context??=new EH,this.params){const _=this.params.toString();if(0===_.length)this.urlWithParams=t;else{const T=t.indexOf("?");this.urlWithParams=t+(-1===T?"?":T<t.length-1?"&":"")+_}}else this.params=new Em,this.urlWithParams=t}serializeBody(){return null===this.body?null:"string"==typeof this.body||dL(this.body)||hL(this.body)||fL(this.body)||function SH(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)?this.body:this.body instanceof Em?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||fL(this.body)?null:hL(this.body)?this.body.type||null:dL(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Em?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const t=n.method||this.method,r=n.url||this.url,a=n.responseType||this.responseType,f=n.transferCache??this.transferCache,_=void 0!==n.body?n.body:this.body,T=n.withCredentials??this.withCredentials,D=n.reportProgress??this.reportProgress;let P=n.headers||this.headers,L=n.params||this.params;const G=n.context??this.context;return void 0!==n.setHeaders&&(P=Object.keys(n.setHeaders).reduce((ie,oe)=>ie.set(oe,n.setHeaders[oe]),P)),n.setParams&&(L=Object.keys(n.setParams).reduce((ie,oe)=>ie.set(oe,n.setParams[oe]),L)),new Mw(t,r,_,{params:L,headers:P,context:G,reportProgress:D,responseType:a,withCredentials:T,transferCache:f})}}var Dm=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Dm||{});class uA{constructor(n,t=200,r="OK"){this.headers=n.headers||new La,this.status=void 0!==n.status?n.status:t,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class XD extends uA{constructor(n={}){super(n),this.type=Dm.ResponseHeader}clone(n={}){return new XD({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class L_ extends uA{constructor(n={}){super(n),this.type=Dm.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new L_({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class jv extends uA{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function dA(e,n){return{body:n,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache}}let zf=(()=>{class e{constructor(t){this.handler=t}request(t,r,a={}){let f;if(t instanceof Mw)f=t;else{let D,P;D=a.headers instanceof La?a.headers:new La(a.headers),a.params&&(P=a.params instanceof Em?a.params:new Em({fromObject:a.params})),f=new Mw(t,r,void 0!==a.body?a.body:null,{headers:D,context:a.context,params:P,reportProgress:a.reportProgress,responseType:a.responseType||"json",withCredentials:a.withCredentials,transferCache:a.transferCache})}const _=$n(f).pipe(Uv(D=>this.handler.handle(D)));if(t instanceof Mw||"events"===a.observe)return _;const T=_.pipe(Uo(D=>D instanceof L_));switch(a.observe||"body"){case"body":switch(f.responseType){case"arraybuffer":return T.pipe(q(D=>{if(null!==D.body&&!(D.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return D.body}));case"blob":return T.pipe(q(D=>{if(null!==D.body&&!(D.body instanceof Blob))throw new Error("Response is not a Blob.");return D.body}));case"text":return T.pipe(q(D=>{if(null!==D.body&&"string"!=typeof D.body)throw new Error("Response is not a string.");return D.body}));default:return T.pipe(q(D=>D.body))}case"response":return T;default:throw new Error(`Unreachable: unhandled observe type ${a.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new Em).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,a={}){return this.request("PATCH",t,dA(a,r))}post(t,r,a={}){return this.request("POST",t,dA(a,r))}put(t,r,a={}){return this.request("PUT",t,dA(a,r))}static#e=this.\u0275fac=function(r){return new(r||e)($t(WD))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();const AH=/^\)\]\}',?\n/;function mL(e){if(e.url)return e.url;const n="X-Request-URL".toLocaleLowerCase();return e.headers.get(n)}let hA=(()=>{class e{constructor(){this.fetchImpl=Re(PH,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Re(ii)}handle(t){return new Fi(r=>{const a=new AbortController;return this.doRequest(t,a.signal,r).then(fA,f=>r.error(new jv({error:f}))),()=>a.abort()})}doRequest(t,r,a){var f=this;return qF(function*(){const _=f.createRequestInit(t);let T;try{const Ce=f.ngZone.runOutsideAngular(()=>f.fetchImpl(t.urlWithParams,{signal:r,..._}));(function RH(e){e.then(fA,fA)})(Ce),a.next({type:Dm.Sent}),T=yield Ce}catch(Ce){return void a.error(new jv({error:Ce,status:Ce.status??0,statusText:Ce.statusText,url:t.urlWithParams,headers:Ce.headers}))}const D=new La(T.headers),P=T.statusText,L=mL(T)??t.urlWithParams;let G=T.status,ie=null;if(t.reportProgress&&a.next(new XD({headers:D,status:G,statusText:P,url:L})),T.body){const Ce=T.headers.get("content-length"),Ae=[],je=T.body.getReader();let Ze,Et,et=0;const Ut=typeof Zone<"u"&&Zone.current;yield f.ngZone.runOutsideAngular(qF(function*(){for(;;){const{done:En,value:ui}=yield je.read();if(En)break;if(Ae.push(ui),et+=ui.length,t.reportProgress){Et="text"===t.responseType?(Et??"")+(Ze??=new TextDecoder).decode(ui,{stream:!0}):void 0;const Ni=()=>a.next({type:Dm.DownloadProgress,total:Ce?+Ce:void 0,loaded:et,partialText:Et});Ut?Ut.run(Ni):Ni()}}}));const ln=f.concatChunks(Ae,et);try{const En=T.headers.get("Content-Type")??"";ie=f.parseBody(t,ln,En)}catch(En){return void a.error(new jv({error:En,headers:new La(T.headers),status:T.status,statusText:T.statusText,url:mL(T)??t.urlWithParams}))}}0===G&&(G=ie?200:0),G>=200&&G<300?(a.next(new L_({body:ie,headers:D,status:G,statusText:P,url:L})),a.complete()):a.error(new jv({error:ie,headers:D,status:G,statusText:P,url:L}))})()}parseBody(t,r,a){switch(t.responseType){case"json":const f=(new TextDecoder).decode(r).replace(AH,"");return""===f?null:JSON.parse(f);case"text":return(new TextDecoder).decode(r);case"blob":return new Blob([r],{type:a});case"arraybuffer":return r.buffer}}createRequestInit(t){const r={},a=t.withCredentials?"include":void 0;if(t.headers.forEach((f,_)=>r[f]=_.join(",")),t.headers.has("Accept")||(r.Accept="application/json, text/plain, */*"),!t.headers.has("Content-Type")){const f=t.detectContentTypeHeader();null!==f&&(r["Content-Type"]=f)}return{body:t.serializeBody(),method:t.method,headers:r,credentials:a}}concatChunks(t,r){const a=new Uint8Array(r);let f=0;for(const _ of t)a.set(_,f),f+=_.length;return a}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();class PH{}function fA(){}function gL(e,n){return n(e)}function NH(e,n){return(t,r)=>n.intercept(t,{handle:a=>e(a,r)})}const FH=new vt(""),Iw=new vt(""),_L=new vt(""),yL=new vt("",{providedIn:"root",factory:()=>!0});function LH(){let e=null;return(n,t)=>{null===e&&(e=(Re(FH,{optional:!0})??[]).reduceRight(NH,gL));const r=Re(Cc);if(Re(yL)){const f=r.add();return e(n,t).pipe(Sw(()=>r.remove(f)))}return e(n,t)}}let vL=(()=>{class e extends WD{constructor(t,r){super(),this.backend=t,this.injector=r,this.chain=null,this.pendingTasks=Re(Cc),this.contributeToStability=Re(yL)}handle(t){if(null===this.chain){const r=Array.from(new Set([...this.injector.get(Iw),...this.injector.get(_L,[])]));this.chain=r.reduceRight((a,f)=>function kH(e,n,t){return(r,a)=>Sa(t,()=>n(r,f=>e(f,a)))}(a,f,this.injector),gL)}if(this.contributeToStability){const r=this.pendingTasks.add();return this.chain(t,a=>this.backend.handle(a)).pipe(Sw(()=>this.pendingTasks.remove(r)))}return this.chain(t,r=>this.backend.handle(r))}static#e=this.\u0275fac=function(r){return new(r||e)($t(ZD),$t(mo))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();const jH=/^\)\]\}',?\n/;let xL=(()=>{class e{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new wt(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?Vo(r.\u0275loadImpl()):$n(null)).pipe($c(()=>new Fi(f=>{const _=r.build();if(_.open(t.method,t.urlWithParams),t.withCredentials&&(_.withCredentials=!0),t.headers.forEach((Ae,je)=>_.setRequestHeader(Ae,je.join(","))),t.headers.has("Accept")||_.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const Ae=t.detectContentTypeHeader();null!==Ae&&_.setRequestHeader("Content-Type",Ae)}if(t.responseType){const Ae=t.responseType.toLowerCase();_.responseType="json"!==Ae?Ae:"text"}const T=t.serializeBody();let D=null;const P=()=>{if(null!==D)return D;const Ae=_.statusText||"OK",je=new La(_.getAllResponseHeaders()),et=function $H(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(_)||t.url;return D=new XD({headers:je,status:_.status,statusText:Ae,url:et}),D},L=()=>{let{headers:Ae,status:je,statusText:et,url:Ze}=P(),Et=null;204!==je&&(Et=typeof _.response>"u"?_.responseText:_.response),0===je&&(je=Et?200:0);let Ut=je>=200&&je<300;if("json"===t.responseType&&"string"==typeof Et){const ln=Et;Et=Et.replace(jH,"");try{Et=""!==Et?JSON.parse(Et):null}catch(En){Et=ln,Ut&&(Ut=!1,Et={error:En,text:Et})}}Ut?(f.next(new L_({body:Et,headers:Ae,status:je,statusText:et,url:Ze||void 0})),f.complete()):f.error(new jv({error:Et,headers:Ae,status:je,statusText:et,url:Ze||void 0}))},G=Ae=>{const{url:je}=P(),et=new jv({error:Ae,status:_.status||0,statusText:_.statusText||"Unknown Error",url:je||void 0});f.error(et)};let ie=!1;const oe=Ae=>{ie||(f.next(P()),ie=!0);let je={type:Dm.DownloadProgress,loaded:Ae.loaded};Ae.lengthComputable&&(je.total=Ae.total),"text"===t.responseType&&_.responseText&&(je.partialText=_.responseText),f.next(je)},Ce=Ae=>{let je={type:Dm.UploadProgress,loaded:Ae.loaded};Ae.lengthComputable&&(je.total=Ae.total),f.next(je)};return _.addEventListener("load",L),_.addEventListener("error",G),_.addEventListener("timeout",G),_.addEventListener("abort",G),t.reportProgress&&(_.addEventListener("progress",oe),null!==T&&_.upload&&_.upload.addEventListener("progress",Ce)),_.send(T),f.next({type:Dm.Sent}),()=>{_.removeEventListener("error",G),_.removeEventListener("abort",G),_.removeEventListener("load",L),_.removeEventListener("timeout",G),t.reportProgress&&(_.removeEventListener("progress",oe),null!==T&&_.upload&&_.upload.removeEventListener("progress",Ce)),_.readyState!==_.DONE&&_.abort()}})))}static#e=this.\u0275fac=function(r){return new(r||e)($t(xF))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();const pA=new vt(""),wL=new vt("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),CL=new vt("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class TL{}let qH=(()=>{class e{constructor(t,r,a){this.doc=t,this.platform=r,this.cookieName=a,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=uF(t,this.cookieName),this.lastCookieString=t),this.lastToken}static#e=this.\u0275fac=function(r){return new(r||e)($t(Xr),$t(Yd),$t(wL))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();function WH(e,n){const t=e.url.toLowerCase();if(!Re(pA)||"GET"===e.method||"HEAD"===e.method||t.startsWith("http://")||t.startsWith("https://"))return n(e);const r=Re(TL).getToken(),a=Re(CL);return null!=r&&!e.headers.has(a)&&(e=e.clone({headers:e.headers.set(a,r)})),n(e)}var Sm=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(Sm||{});function ZH(...e){const n=[zf,xL,vL,{provide:WD,useExisting:vL},{provide:ZD,useFactory:()=>Re(hA,{optional:!0})??Re(xL)},{provide:Iw,useValue:WH,multi:!0},{provide:pA,useValue:!0},{provide:TL,useClass:qH}];for(const t of e)n.push(...t.\u0275providers);return function Sd(e){return{\u0275providers:e}}(n)}const EL=new vt("");function YH(){return function B_(e,n){return{\u0275kind:e,\u0275providers:n}}(Sm.LegacyInterceptors,[{provide:EL,useFactory:LH},{provide:Iw,useExisting:EL,multi:!0}])}let XH=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({providers:[ZH(YH())]})}return e})();const{isArray:s7}=Array,{getPrototypeOf:a7,prototype:l7,keys:c7}=Object;function RL(e){if(1===e.length){const n=e[0];if(s7(n))return{args:n,keys:null};if(function u7(e){return e&&"object"==typeof e&&a7(e)===l7}(n)){const t=c7(n);return{args:t.map(r=>n[r]),keys:t}}}return{args:e,keys:null}}const{isArray:d7}=Array;function mA(e){return q(n=>function h7(e,n){return d7(n)?e(...n):e(n)}(e,n))}function NL(e,n){return e.reduce((t,r,a)=>(t[r]=n[a],t),{})}function gA(...e){const n=Dw(e),t=qD(e),{args:r,keys:a}=RL(e);if(0===r.length)return Vo([],n);const f=new Fi(function f7(e,n,t=gs){return r=>{kL(n,()=>{const{length:a}=e,f=new Array(a);let _=a,T=a;for(let D=0;D<a;D++)kL(n,()=>{const P=Vo(e[D],n);let L=!1;P.subscribe(ve(r,G=>{f[D]=G,L||(L=!0,T--),T||r.next(t(f.slice()))},()=>{--_||r.complete()}))},r)},r)}}(r,n,a?_=>NL(a,_):gs));return t?f.pipe(mA(t)):f}function kL(e,n,t){e?Bf(t,e,n):n()}const JD=qi(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function $v(e=1/0){return Is(gs,e)}function Aw(...e){return function p7(){return $v(1)}()(Vo(e,Dw(e)))}function FL(e){return new Fi(n=>{Ms(e()).subscribe(n)})}function QD(e,n){const t=Pt(e)?e:()=>e,r=a=>a.error(t());return new Fi(n?a=>n.schedule(r,0,a):r)}const Ll=new Fi(e=>e.complete());function _A(){return ir((e,n)=>{let t=null;e._refCount++;const r=ve(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const a=e._connection,f=t;t=null,a&&(!f||a===f)&&a.unsubscribe(),n.unsubscribe()});e.subscribe(r),r.closed||(t=e.connect())})}class LL extends Fi{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,br(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Rt;const t=this.getSubject();n.add(this.source.subscribe(ve(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Rt.EMPTY)}return n}refCount(){return _A()(this)}}function ma(e){return e<=0?()=>Ll:ir((n,t)=>{let r=0;n.subscribe(ve(t,a=>{++r<=e&&(t.next(a),e<=r&&t.complete())}))})}function yA(...e){const n=Dw(e);return ir((t,r)=>{(n?Aw(e,t,n):Aw(e,t)).subscribe(r)})}function eS(e){return ir((n,t)=>{let r=!1;n.subscribe(ve(t,a=>{r=!0,t.next(a)},()=>{r||t.next(e),t.complete()}))})}function BL(e=g7){return ir((n,t)=>{let r=!1;n.subscribe(ve(t,a=>{r=!0,t.next(a)},()=>r?t.complete():t.error(e())))})}function g7(){return new JD}function z_(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Uo((a,f)=>e(a,f,r)):gs,ma(1),t?eS(n):BL(()=>new JD))}function As(e,n,t){const r=Pt(e)||n||t?{next:e,error:n,complete:t}:e;return r?ir((a,f)=>{var _;null===(_=r.subscribe)||void 0===_||_.call(r);let T=!0;a.subscribe(ve(f,D=>{var P;null===(P=r.next)||void 0===P||P.call(r,D),f.next(D)},()=>{var D;T=!1,null===(D=r.complete)||void 0===D||D.call(r),f.complete()},D=>{var P;T=!1,null===(P=r.error)||void 0===P||P.call(r,D),f.error(D)},()=>{var D,P;T&&(null===(D=r.unsubscribe)||void 0===D||D.call(r)),null===(P=r.finalize)||void 0===P||P.call(r)}))}):gs}function Gv(e){return ir((n,t)=>{let f,r=null,a=!1;r=n.subscribe(ve(t,void 0,void 0,_=>{f=Ms(e(_,Gv(e)(n))),r?(r.unsubscribe(),r=null,f.subscribe(t)):a=!0})),a&&(r.unsubscribe(),r=null,f.subscribe(t))})}function vA(e){return e<=0?()=>Ll:ir((n,t)=>{let r=[];n.subscribe(ve(t,a=>{r.push(a),e<r.length&&r.shift()},()=>{for(const a of r)t.next(a);t.complete()},void 0,()=>{r=null}))})}function Kr(e){return ir((n,t)=>{Ms(e).subscribe(ve(t,()=>t.complete(),ki)),!t.closed&&n.subscribe(t)})}const vi="primary",Ow=Symbol("RouteTitle");class b7{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Hv(e){return new b7(e)}function x7(e,n,t){const r=t.path.split("/");if(r.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||r.length<e.length))return null;const a={};for(let f=0;f<r.length;f++){const _=r[f],T=e[f];if(":"===_[0])a[_.substring(1)]=T;else if(_!==T.path)return null}return{consumed:e.slice(0,r.length),posParams:a}}function ph(e,n){const t=e?bA(e):void 0,r=n?bA(n):void 0;if(!t||!r||t.length!=r.length)return!1;let a;for(let f=0;f<t.length;f++)if(a=t[f],!VL(e[a],n[a]))return!1;return!0}function bA(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function VL(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),r=[...n].sort();return t.every((a,f)=>r[f]===a)}return e===n}function UL(e){return e.length>0?e[e.length-1]:null}function Mm(e){return function o7(e){return!!e&&(e instanceof Fi||Pt(e.lift)&&Pt(e.subscribe))}(e)?e:hw(e)?Vo(Promise.resolve(e)):$n(e)}const C7={exact:function GL(e,n,t){if(!U_(e.segments,n.segments)||!tS(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!GL(e.children[r],n.children[r],t))return!1;return!0},subset:HL},jL={exact:function T7(e,n){return ph(e,n)},subset:function E7(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>VL(e[t],n[t]))},ignored:()=>!0};function $L(e,n,t){return C7[t.paths](e.root,n.root,t.matrixParams)&&jL[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function HL(e,n,t){return qL(e,n,n.segments,t)}function qL(e,n,t,r){if(e.segments.length>t.length){const a=e.segments.slice(0,t.length);return!(!U_(a,t)||n.hasChildren()||!tS(a,t,r))}if(e.segments.length===t.length){if(!U_(e.segments,t)||!tS(e.segments,t,r))return!1;for(const a in n.children)if(!e.children[a]||!HL(e.children[a],n.children[a],r))return!1;return!0}{const a=t.slice(0,e.segments.length),f=t.slice(e.segments.length);return!!(U_(e.segments,a)&&tS(e.segments,a,r)&&e.children[vi])&&qL(e.children[vi],n,f,r)}}function tS(e,n,t){return n.every((r,a)=>jL[t](e[a].parameters,r.parameters))}class V_{constructor(n=new vr([],{}),t={},r=null){this.root=n,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Hv(this.queryParams),this._queryParamMap}toString(){return M7.serialize(this)}}class vr{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return iS(this)}}class Pw{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap??=Hv(this.parameters),this._parameterMap}toString(){return YL(this)}}function U_(e,n){return e.length===n.length&&e.every((t,r)=>t.path===n[r].path)}let qv=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:()=>new nS,providedIn:"root"})}return e})();class nS{parse(n){const t=new z7(n);return new V_(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${Rw(n.root,!0)}`,r=function O7(e){const n=Object.entries(e).map(([t,r])=>Array.isArray(r)?r.map(a=>`${rS(t)}=${rS(a)}`).join("&"):`${rS(t)}=${rS(r)}`).filter(t=>t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${r}${"string"==typeof n.fragment?`#${function I7(e){return encodeURI(e)}(n.fragment)}`:""}`}}const M7=new nS;function iS(e){return e.segments.map(n=>YL(n)).join("/")}function Rw(e,n){if(!e.hasChildren())return iS(e);if(n){const t=e.children[vi]?Rw(e.children[vi],!1):"",r=[];return Object.entries(e.children).forEach(([a,f])=>{a!==vi&&r.push(`${a}:${Rw(f,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function S7(e,n){let t=[];return Object.entries(e.children).forEach(([r,a])=>{r===vi&&(t=t.concat(n(a,r)))}),Object.entries(e.children).forEach(([r,a])=>{r!==vi&&(t=t.concat(n(a,r)))}),t}(e,(r,a)=>a===vi?[Rw(e.children[vi],!1)]:[`${a}:${Rw(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[vi]?`${iS(e)}/${t[0]}`:`${iS(e)}/(${t.join("//")})`}}function WL(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function rS(e){return WL(e).replace(/%3B/gi,";")}function xA(e){return WL(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function oS(e){return decodeURIComponent(e)}function ZL(e){return oS(e.replace(/\+/g,"%20"))}function YL(e){return`${xA(e.path)}${function A7(e){return Object.entries(e).map(([n,t])=>`;${xA(n)}=${xA(t)}`).join("")}(e.parameters)}`}const P7=/^[^\/()?;#]+/;function wA(e){const n=e.match(P7);return n?n[0]:""}const R7=/^[^\/()?;=#]+/,k7=/^[^=?&#]+/,L7=/^[^&#]+/;class z7{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new vr([],{}):new vr([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(r[vi]=new vr(n,t)),r}parseSegment(){const n=wA(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new wt(4009,!1);return this.capture(n),new Pw(oS(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function N7(e){const n=e.match(R7);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const a=wA(this.remaining);a&&(r=a,this.capture(r))}n[oS(t)]=oS(r)}parseQueryParam(n){const t=function F7(e){const n=e.match(k7);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const _=function B7(e){const n=e.match(L7);return n?n[0]:""}(this.remaining);_&&(r=_,this.capture(r))}const a=ZL(t),f=ZL(r);if(n.hasOwnProperty(a)){let _=n[a];Array.isArray(_)||(_=[_],n[a]=_),_.push(f)}else n[a]=f}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=wA(this.remaining),a=this.remaining[r.length];if("/"!==a&&")"!==a&&";"!==a)throw new wt(4010,!1);let f;r.indexOf(":")>-1?(f=r.slice(0,r.indexOf(":")),this.capture(f),this.capture(":")):n&&(f=vi);const _=this.parseChildren();t[f]=1===Object.keys(_).length?_[vi]:new vr([],_),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new wt(4011,!1)}}function XL(e){return e.segments.length>0?new vr([],{[vi]:e}):e}function KL(e){const n={};for(const[r,a]of Object.entries(e.children)){const f=KL(a);if(r===vi&&0===f.segments.length&&f.hasChildren())for(const[_,T]of Object.entries(f.children))n[_]=T;else(f.segments.length>0||f.hasChildren())&&(n[r]=f)}return function V7(e){if(1===e.numberOfChildren&&e.children[vi]){const n=e.children[vi];return new vr(e.segments.concat(n.segments),n.children)}return e}(new vr(e.segments,n))}function j_(e){return e instanceof V_}function JL(e){let n;const a=XL(function t(f){const _={};for(const D of f.children){const P=t(D);_[D.outlet]=P}const T=new vr(f.url,_);return f===e&&(n=T),T}(e.root));return n??a}function QL(e,n,t,r){let a=e;for(;a.parent;)a=a.parent;if(0===n.length)return CA(a,a,a,t,r);const f=function j7(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new t3(!0,0,e);let n=0,t=!1;const r=e.reduce((a,f,_)=>{if("object"==typeof f&&null!=f){if(f.outlets){const T={};return Object.entries(f.outlets).forEach(([D,P])=>{T[D]="string"==typeof P?P.split("/"):P}),[...a,{outlets:T}]}if(f.segmentPath)return[...a,f.segmentPath]}return"string"!=typeof f?[...a,f]:0===_?(f.split("/").forEach((T,D)=>{0==D&&"."===T||(0==D&&""===T?t=!0:".."===T?n++:""!=T&&a.push(T))}),a):[...a,f]},[]);return new t3(t,n,r)}(n);if(f.toRoot())return CA(a,a,new vr([],{}),t,r);const _=function $7(e,n,t){if(e.isAbsolute)return new aS(n,!0,0);if(!t)return new aS(n,!1,NaN);if(null===t.parent)return new aS(t,!0,0);const r=sS(e.commands[0])?0:1;return function G7(e,n,t){let r=e,a=n,f=t;for(;f>a;){if(f-=a,r=r.parent,!r)throw new wt(4005,!1);a=r.segments.length}return new aS(r,!1,a-f)}(t,t.segments.length-1+r,e.numberOfDoubleDots)}(f,a,e),T=_.processChildren?kw(_.segmentGroup,_.index,f.commands):n3(_.segmentGroup,_.index,f.commands);return CA(a,_.segmentGroup,T,t,r)}function sS(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Nw(e){return"object"==typeof e&&null!=e&&e.outlets}function CA(e,n,t,r,a){let _,f={};r&&Object.entries(r).forEach(([D,P])=>{f[D]=Array.isArray(P)?P.map(L=>`${L}`):`${P}`}),_=e===n?t:e3(e,n,t);const T=XL(KL(_));return new V_(T,f,a)}function e3(e,n,t){const r={};return Object.entries(e.children).forEach(([a,f])=>{r[a]=f===n?t:e3(f,n,t)}),new vr(e.segments,r)}class t3{constructor(n,t,r){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=r,n&&r.length>0&&sS(r[0]))throw new wt(4003,!1);const a=r.find(Nw);if(a&&a!==UL(r))throw new wt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class aS{constructor(n,t,r){this.segmentGroup=n,this.processChildren=t,this.index=r}}function n3(e,n,t){if(e??=new vr([],{}),0===e.segments.length&&e.hasChildren())return kw(e,n,t);const r=function q7(e,n,t){let r=0,a=n;const f={match:!1,pathIndex:0,commandIndex:0};for(;a<e.segments.length;){if(r>=t.length)return f;const _=e.segments[a],T=t[r];if(Nw(T))break;const D=`${T}`,P=r<t.length-1?t[r+1]:null;if(a>0&&void 0===D)break;if(D&&P&&"object"==typeof P&&void 0===P.outlets){if(!r3(D,P,_))return f;r+=2}else{if(!r3(D,{},_))return f;r++}a++}return{match:!0,pathIndex:a,commandIndex:r}}(e,n,t),a=t.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const f=new vr(e.segments.slice(0,r.pathIndex),{});return f.children[vi]=new vr(e.segments.slice(r.pathIndex),e.children),kw(f,0,a)}return r.match&&0===a.length?new vr(e.segments,{}):r.match&&!e.hasChildren()?TA(e,n,t):r.match?kw(e,0,a):TA(e,n,t)}function kw(e,n,t){if(0===t.length)return new vr(e.segments,{});{const r=function H7(e){return Nw(e[0])?e[0].outlets:{[vi]:e}}(t),a={};if(Object.keys(r).some(f=>f!==vi)&&e.children[vi]&&1===e.numberOfChildren&&0===e.children[vi].segments.length){const f=kw(e.children[vi],n,t);return new vr(e.segments,f.children)}return Object.entries(r).forEach(([f,_])=>{"string"==typeof _&&(_=[_]),null!==_&&(a[f]=n3(e.children[f],n,_))}),Object.entries(e.children).forEach(([f,_])=>{void 0===r[f]&&(a[f]=_)}),new vr(e.segments,a)}}function TA(e,n,t){const r=e.segments.slice(0,n);let a=0;for(;a<t.length;){const f=t[a];if(Nw(f)){const D=W7(f.outlets);return new vr(r,D)}if(0===a&&sS(t[0])){r.push(new Pw(e.segments[n].path,i3(t[0]))),a++;continue}const _=Nw(f)?f.outlets[vi]:`${f}`,T=a<t.length-1?t[a+1]:null;_&&T&&sS(T)?(r.push(new Pw(_,i3(T))),a+=2):(r.push(new Pw(_,{})),a++)}return new vr(r,{})}function W7(e){const n={};return Object.entries(e).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[t]=TA(new vr([],{}),0,r))}),n}function i3(e){const n={};return Object.entries(e).forEach(([t,r])=>n[t]=`${r}`),n}function r3(e,n,t){return e==t.path&&ph(n,t.parameters)}const Fw="imperative";var zi=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(zi||{});class mh{constructor(n,t){this.id=n,this.url=t}}class lS extends mh{constructor(n,t,r="imperative",a=null){super(n,t),this.type=zi.NavigationStart,this.navigationTrigger=r,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Vf extends mh{constructor(n,t,r){super(n,t),this.urlAfterRedirects=r,this.type=zi.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Bl=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(Bl||{}),cS=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(cS||{});class $_ extends mh{constructor(n,t,r,a){super(n,t),this.reason=r,this.code=a,this.type=zi.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Wv extends mh{constructor(n,t,r,a){super(n,t),this.reason=r,this.code=a,this.type=zi.NavigationSkipped}}class EA extends mh{constructor(n,t,r,a){super(n,t),this.error=r,this.target=a,this.type=zi.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class o3 extends mh{constructor(n,t,r,a){super(n,t),this.urlAfterRedirects=r,this.state=a,this.type=zi.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Z7 extends mh{constructor(n,t,r,a){super(n,t),this.urlAfterRedirects=r,this.state=a,this.type=zi.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Y7 extends mh{constructor(n,t,r,a,f){super(n,t),this.urlAfterRedirects=r,this.state=a,this.shouldActivate=f,this.type=zi.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class X7 extends mh{constructor(n,t,r,a){super(n,t),this.urlAfterRedirects=r,this.state=a,this.type=zi.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class K7 extends mh{constructor(n,t,r,a){super(n,t),this.urlAfterRedirects=r,this.state=a,this.type=zi.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class J7{constructor(n){this.route=n,this.type=zi.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Q7{constructor(n){this.route=n,this.type=zi.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class e9{constructor(n){this.snapshot=n,this.type=zi.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class t9{constructor(n){this.snapshot=n,this.type=zi.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class n9{constructor(n){this.snapshot=n,this.type=zi.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class i9{constructor(n){this.snapshot=n,this.type=zi.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class s3{constructor(n,t,r){this.routerEvent=n,this.position=t,this.anchor=r,this.type=zi.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class DA{}class uS{constructor(n,t){this.url=n,this.navigationBehaviorOptions=t}}function Uu(e){return e.outlet||vi}function Lw(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class c9{get injector(){return Lw(this.route?.snapshot)??this.rootInjector}set injector(n){}constructor(n){this.rootInjector=n,this.outlet=null,this.route=null,this.children=new Bw(this.rootInjector),this.attachRef=null}}let Bw=(()=>{class e{constructor(t){this.rootInjector=t,this.contexts=new Map}onChildOutletCreated(t,r){const a=this.getOrCreateContext(t);a.outlet=r,this.contexts.set(t,a)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new c9(this.rootInjector),this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(r){return new(r||e)($t(mo))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class a3{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=SA(n,this._root);return t?t.children.map(r=>r.value):[]}firstChild(n){const t=SA(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=MA(n,this._root);return t.length<2?[]:t[t.length-2].children.map(a=>a.value).filter(a=>a!==n)}pathFromRoot(n){return MA(n,this._root).map(t=>t.value)}}function SA(e,n){if(e===n.value)return n;for(const t of n.children){const r=SA(e,t);if(r)return r}return null}function MA(e,n){if(e===n.value)return[n];for(const t of n.children){const r=MA(e,t);if(r.length)return r.unshift(n),r}return[]}class ju{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function Zv(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class l3 extends a3{constructor(n,t){super(n),this.snapshot=t,IA(this,n)}toString(){return this.snapshot.toString()}}function c3(e){const n=function u9(e){const f=new hS([],{},{},"",{},vi,e,null,{});return new u3("",new ju(f,[]))}(e),t=new lo([new Pw("",{})]),r=new lo({}),a=new lo({}),f=new lo({}),_=new lo(""),T=new gh(t,r,f,_,a,vi,e,n.root);return T.snapshot=n.root,new l3(new ju(T,[]),n)}class gh{constructor(n,t,r,a,f,_,T,D){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=a,this.dataSubject=f,this.outlet=_,this.component=T,this._futureSnapshot=D,this.title=this.dataSubject?.pipe(q(P=>P[Ow]))??$n(void 0),this.url=n,this.params=t,this.queryParams=r,this.fragment=a,this.data=f}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(q(n=>Hv(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(q(n=>Hv(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function dS(e,n,t="emptyOnly"){let r;const{routeConfig:a}=e;return r=null===n||"always"!==t&&""!==a?.path&&(n.component||n.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.data,...a?.data,...e._resolvedData}},a&&h3(a)&&(r.resolve[Ow]=a.title),r}class hS{get title(){return this.data?.[Ow]}constructor(n,t,r,a,f,_,T,D,P){this.url=n,this.params=t,this.queryParams=r,this.fragment=a,this.data=f,this.outlet=_,this.component=T,this.routeConfig=D,this._resolve=P}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Hv(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Hv(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class u3 extends a3{constructor(n,t){super(t),this.url=n,IA(this,t)}toString(){return d3(this._root)}}function IA(e,n){n.value._routerState=e,n.children.forEach(t=>IA(e,t))}function d3(e){const n=e.children.length>0?` { ${e.children.map(d3).join(", ")} } `:"";return`${e.value}${n}`}function AA(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,ph(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),ph(n.params,t.params)||e.paramsSubject.next(t.params),function w7(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!ph(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),ph(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function OA(e,n){const t=ph(e.params,n.params)&&function D7(e,n){return U_(e,n)&&e.every((t,r)=>ph(t.parameters,n[r].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||OA(e.parent,n.parent))}function h3(e){return"string"==typeof e.title||null===e.title}let PA=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=vi,this.activateEvents=new fn,this.deactivateEvents=new fn,this.attachEvents=new fn,this.detachEvents=new fn,this.parentContexts=Re(Bw),this.location=Re($e),this.changeDetector=Re(zc),this.inputBinder=Re(fS,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:a}=t.name;if(r)return;this.isTrackedInParentContexts(a)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(a)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new wt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new wt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new wt(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new wt(4013,!1);this._activatedRoute=t;const a=this.location,_=t.snapshot.component,T=this.parentContexts.getOrCreateContext(this.name).children,D=new RA(t,T,a.injector);this.activated=a.createComponent(_,{index:a.length,injector:D,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Lt({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[kr]})}return e})();class RA{__ngOutletInjector(n){return new RA(this.route,this.childContexts,n)}constructor(n,t,r){this.route=n,this.childContexts=t,this.parent=r}get(n,t){return n===gh?this.route:n===Bw?this.childContexts:this.parent.get(n,t)}}const fS=new vt("");let f3=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:r}=t,a=gA([r.queryParams,r.params,r.data]).pipe($c(([f,_,T],D)=>(T={...f,..._,...T},0===D?$n(T):Promise.resolve(T)))).subscribe(f=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(t);const _=function f8(e){const n=qn(e);if(!n)return null;const t=new Be(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(_)for(const{templateName:T}of _.inputs)t.activatedComponentRef.setInput(T,f[T]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,a)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();function zw(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=n.value;const a=function h9(e,n,t){return n.children.map(r=>{for(const a of t.children)if(e.shouldReuseRoute(r.value,a.value.snapshot))return zw(e,r,a);return zw(e,r)})}(e,n,t);return new ju(r,a)}{if(e.shouldAttach(n.value)){const f=e.retrieve(n.value);if(null!==f){const _=f.route;return _.value._futureSnapshot=n.value,_.children=n.children.map(T=>zw(e,T)),_}}const r=function f9(e){return new gh(new lo(e.url),new lo(e.params),new lo(e.queryParams),new lo(e.fragment),new lo(e.data),e.outlet,e.component,e)}(n.value),a=n.children.map(f=>zw(e,f));return new ju(r,a)}}class NA{constructor(n,t){this.redirectTo=n,this.navigationBehaviorOptions=t}}const p3="ngNavigationCancelingError";function pS(e,n){const{redirectTo:t,navigationBehaviorOptions:r}=j_(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,a=m3(!1,Bl.Redirect);return a.url=t,a.navigationBehaviorOptions=r,a}function m3(e,n){const t=new Error(`NavigationCancelingError: ${e||""}`);return t[p3]=!0,t.cancellationCode=n,t}function g3(e){return!!e&&e[p3]}class g9{constructor(n,t,r,a,f){this.routeReuseStrategy=n,this.futureState=t,this.currState=r,this.forwardEvent=a,this.inputBindingEnabled=f}activate(n){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,n),AA(this.futureState.root),this.activateChildRoutes(t,r,n)}deactivateChildRoutes(n,t,r){const a=Zv(t);n.children.forEach(f=>{const _=f.value.outlet;this.deactivateRoutes(f,a[_],r),delete a[_]}),Object.values(a).forEach(f=>{this.deactivateRouteAndItsChildren(f,r)})}deactivateRoutes(n,t,r){const a=n.value,f=t?t.value:null;if(a===f)if(a.component){const _=r.getContext(a.outlet);_&&this.deactivateChildRoutes(n,t,_.children)}else this.deactivateChildRoutes(n,t,r);else f&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const r=t.getContext(n.value.outlet),a=r&&n.value.component?r.children:t,f=Zv(n);for(const _ of Object.values(f))this.deactivateRouteAndItsChildren(_,a);if(r&&r.outlet){const _=r.outlet.detach(),T=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:_,route:n,contexts:T})}}deactivateRouteAndOutlet(n,t){const r=t.getContext(n.value.outlet),a=r&&n.value.component?r.children:t,f=Zv(n);for(const _ of Object.values(f))this.deactivateRouteAndItsChildren(_,a);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,t,r){const a=Zv(t);n.children.forEach(f=>{this.activateRoutes(f,a[f.value.outlet],r),this.forwardEvent(new i9(f.value.snapshot))}),n.children.length&&this.forwardEvent(new t9(n.value.snapshot))}activateRoutes(n,t,r){const a=n.value,f=t?t.value:null;if(AA(a),a===f)if(a.component){const _=r.getOrCreateContext(a.outlet);this.activateChildRoutes(n,t,_.children)}else this.activateChildRoutes(n,t,r);else if(a.component){const _=r.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const T=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),_.children.onOutletReAttached(T.contexts),_.attachRef=T.componentRef,_.route=T.route.value,_.outlet&&_.outlet.attach(T.componentRef,T.route.value),AA(T.route.value),this.activateChildRoutes(n,null,_.children)}else _.attachRef=null,_.route=a,_.outlet&&_.outlet.activateWith(a,_.injector),this.activateChildRoutes(n,null,_.children)}else this.activateChildRoutes(n,null,r)}}class _3{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class mS{constructor(n,t){this.component=n,this.route=t}}function _9(e,n,t){const r=e._root;return Vw(r,n?n._root:null,t,[r.value])}function Yv(e,n){const t=Symbol(),r=n.get(e,t);return r===t?"function"!=typeof e||function ig(e){return null!==Yt(e)}(e)?n.get(e):e:r}function Vw(e,n,t,r,a={canDeactivateChecks:[],canActivateChecks:[]}){const f=Zv(n);return e.children.forEach(_=>{(function v9(e,n,t,r,a={canDeactivateChecks:[],canActivateChecks:[]}){const f=e.value,_=n?n.value:null,T=t?t.getContext(e.value.outlet):null;if(_&&f.routeConfig===_.routeConfig){const D=function b9(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!U_(e.url,n.url);case"pathParamsOrQueryParamsChange":return!U_(e.url,n.url)||!ph(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!OA(e,n)||!ph(e.queryParams,n.queryParams);default:return!OA(e,n)}}(_,f,f.routeConfig.runGuardsAndResolvers);D?a.canActivateChecks.push(new _3(r)):(f.data=_.data,f._resolvedData=_._resolvedData),Vw(e,n,f.component?T?T.children:null:t,r,a),D&&T&&T.outlet&&T.outlet.isActivated&&a.canDeactivateChecks.push(new mS(T.outlet.component,_))}else _&&Uw(n,T,a),a.canActivateChecks.push(new _3(r)),Vw(e,null,f.component?T?T.children:null:t,r,a)})(_,f[_.value.outlet],t,r.concat([_.value]),a),delete f[_.value.outlet]}),Object.entries(f).forEach(([_,T])=>Uw(T,t.getContext(_),a)),a}function Uw(e,n,t){const r=Zv(e),a=e.value;Object.entries(r).forEach(([f,_])=>{Uw(_,a.component?n?n.children.getContext(f):null:n,t)}),t.canDeactivateChecks.push(new mS(a.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,a))}function jw(e){return"function"==typeof e}function y3(e){return e instanceof JD||"EmptyError"===e?.name}const gS=Symbol("INITIAL_VALUE");function Xv(){return $c(e=>gA(e.map(n=>n.pipe(ma(1),yA(gS)))).pipe(q(n=>{for(const t of n)if(!0!==t){if(t===gS)return gS;if(!1===t||S9(t))return t}return!0}),Uo(n=>n!==gS),ma(1)))}function S9(e){return j_(e)||e instanceof NA}function v3(e){return function Qu(...e){return pl(e)}(As(n=>{if("boolean"!=typeof n)throw pS(0,n)}),q(n=>!0===n))}class kA{constructor(n){this.segmentGroup=n||null}}class _S extends Error{constructor(n){super(),this.urlTree=n}}function Kv(e){return QD(new kA(e))}class V9{constructor(n,t){this.urlSerializer=n,this.urlTree=t}lineralizeSegments(n,t){let r=[],a=t.root;for(;;){if(r=r.concat(a.segments),0===a.numberOfChildren)return $n(r);if(a.numberOfChildren>1||!a.children[vi])return QD(new wt(4e3,!1));a=a.children[vi]}}applyRedirectCommands(n,t,r,a,f){if("string"!=typeof t){const T=t,{queryParams:D,fragment:P,routeConfig:L,url:G,outlet:ie,params:oe,data:Ce,title:Ae}=a,je=Sa(f,()=>T({params:oe,data:Ce,queryParams:D,fragment:P,routeConfig:L,url:G,outlet:ie,title:Ae}));if(je instanceof V_)throw new _S(je);t=je}const _=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,r);if("/"===t[0])throw new _S(_);return _}applyRedirectCreateUrlTree(n,t,r,a){const f=this.createSegmentGroup(n,t.root,r,a);return new V_(f,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const r={};return Object.entries(n).forEach(([a,f])=>{if("string"==typeof f&&":"===f[0]){const T=f.substring(1);r[a]=t[T]}else r[a]=f}),r}createSegmentGroup(n,t,r,a){const f=this.createSegments(n,t.segments,r,a);let _={};return Object.entries(t.children).forEach(([T,D])=>{_[T]=this.createSegmentGroup(n,D,r,a)}),new vr(f,_)}createSegments(n,t,r,a){return t.map(f=>":"===f.path[0]?this.findPosParam(n,f,a):this.findOrReturn(f,r))}findPosParam(n,t,r){const a=r[t.path.substring(1)];if(!a)throw new wt(4001,!1);return a}findOrReturn(n,t){let r=0;for(const a of t){if(a.path===n.path)return t.splice(r),a;r++}return n}}const FA={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function U9(e,n,t,r,a){const f=LA(e,n,t);return f.matched?(r=function r9(e,n){return e.providers&&!e._injector&&(e._injector=HE(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,r),function L9(e,n,t,r){const a=n.canMatch;return a&&0!==a.length?$n(a.map(_=>{const T=Yv(_,e);return Mm(function D9(e){return e&&jw(e.canMatch)}(T)?T.canMatch(n,t):Sa(e,()=>T(n,t)))})).pipe(Xv(),v3()):$n(!0)}(r,n,t).pipe(q(_=>!0===_?f:{...FA}))):$n(f)}function LA(e,n,t){if("**"===n.path)return function j9(e){return{matched:!0,parameters:e.length>0?UL(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...FA}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const a=(n.matcher||x7)(t,e,n);if(!a)return{...FA};const f={};Object.entries(a.posParams??{}).forEach(([T,D])=>{f[T]=D.path});const _=a.consumed.length>0?{...f,...a.consumed[a.consumed.length-1].parameters}:f;return{matched:!0,consumedSegments:a.consumed,remainingSegments:t.slice(a.consumed.length),parameters:_,positionalParamSegments:a.posParams??{}}}function b3(e,n,t,r){return t.length>0&&function H9(e,n,t){return t.some(r=>yS(e,n,r)&&Uu(r)!==vi)}(e,t,r)?{segmentGroup:new vr(n,G9(r,new vr(t,e.children))),slicedSegments:[]}:0===t.length&&function q9(e,n,t){return t.some(r=>yS(e,n,r))}(e,t,r)?{segmentGroup:new vr(e.segments,$9(e,t,r,e.children)),slicedSegments:t}:{segmentGroup:new vr(e.segments,e.children),slicedSegments:t}}function $9(e,n,t,r){const a={};for(const f of t)if(yS(e,n,f)&&!r[Uu(f)]){const _=new vr([],{});a[Uu(f)]=_}return{...r,...a}}function G9(e,n){const t={};t[vi]=n;for(const r of e)if(""===r.path&&Uu(r)!==vi){const a=new vr([],{});t[Uu(r)]=a}return t}function yS(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class Y9{}class J9{constructor(n,t,r,a,f,_,T){this.injector=n,this.configLoader=t,this.rootComponentType=r,this.config=a,this.urlTree=f,this.paramsInheritanceStrategy=_,this.urlSerializer=T,this.applyRedirects=new V9(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new wt(4002,`'${n.segmentGroup}'`)}recognize(){const n=b3(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(q(({children:t,rootSnapshot:r})=>{const a=new ju(r,t),f=new u3("",a),_=function U7(e,n,t=null,r=null){return QL(JL(e),n,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return _.queryParams=this.urlTree.queryParams,f.url=this.urlSerializer.serialize(_),{state:f,tree:_}}))}match(n){const t=new hS([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),vi,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,vi,t).pipe(q(r=>({children:r,rootSnapshot:t})),Gv(r=>{if(r instanceof _S)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof kA?this.noMatchError(r):r}))}processSegmentGroup(n,t,r,a,f){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,t,r,f):this.processSegment(n,t,r,r.segments,a,!0,f).pipe(q(_=>_ instanceof ju?[_]:[]))}processChildren(n,t,r,a){const f=[];for(const _ of Object.keys(r.children))"primary"===_?f.unshift(_):f.push(_);return Vo(f).pipe(Uv(_=>{const T=r.children[_],D=function l9(e,n){const t=e.filter(r=>Uu(r)===n);return t.push(...e.filter(r=>Uu(r)!==n)),t}(t,_);return this.processSegmentGroup(n,D,T,_,a)}),function y7(e,n){return ir(function _7(e,n,t,r,a){return(f,_)=>{let T=t,D=n,P=0;f.subscribe(ve(_,L=>{const G=P++;D=T?e(D,L,G):(T=!0,L),r&&_.next(D)},a&&(()=>{T&&_.next(D),_.complete()})))}}(e,n,arguments.length>=2,!0))}((_,T)=>(_.push(...T),_)),eS(null),function v7(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Uo((a,f)=>e(a,f,r)):gs,vA(1),t?eS(n):BL(()=>new JD))}(),Is(_=>{if(null===_)return Kv(r);const T=x3(_);return function Q9(e){e.sort((n,t)=>n.value.outlet===vi?-1:t.value.outlet===vi?1:n.value.outlet.localeCompare(t.value.outlet))}(T),$n(T)}))}processSegment(n,t,r,a,f,_,T){return Vo(t).pipe(Uv(D=>this.processSegmentAgainstRoute(D._injector??n,t,D,r,a,f,_,T).pipe(Gv(P=>{if(P instanceof kA)return $n(null);throw P}))),z_(D=>!!D),Gv(D=>{if(y3(D))return function Z9(e,n,t){return 0===n.length&&!e.children[t]}(r,a,f)?$n(new Y9):Kv(r);throw D}))}processSegmentAgainstRoute(n,t,r,a,f,_,T,D){return function W9(e,n,t,r){return!!(Uu(e)===r||r!==vi&&yS(n,t,e))&&LA(n,e,t).matched}(r,a,f,_)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,a,r,f,_,D):this.allowRedirects&&T?this.expandSegmentAgainstRouteUsingRedirect(n,a,t,r,f,_,D):Kv(a):Kv(a)}expandSegmentAgainstRouteUsingRedirect(n,t,r,a,f,_,T){const{matched:D,parameters:P,consumedSegments:L,positionalParamSegments:G,remainingSegments:ie}=LA(t,a,f);if(!D)return Kv(t);"string"==typeof a.redirectTo&&"/"===a.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const oe=new hS(f,P,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,w3(a),Uu(a),a.component??a._loadedComponent??null,a,C3(a)),Ce=dS(oe,T,this.paramsInheritanceStrategy);oe.params=Object.freeze(Ce.params),oe.data=Object.freeze(Ce.data);const Ae=this.applyRedirects.applyRedirectCommands(L,a.redirectTo,G,oe,n);return this.applyRedirects.lineralizeSegments(a,Ae).pipe(Is(je=>this.processSegment(n,r,t,je.concat(ie),_,!1,T)))}matchSegmentAgainstRoute(n,t,r,a,f,_){const T=U9(t,r,a,n);return"**"===r.path&&(t.children={}),T.pipe($c(D=>D.matched?this.getChildConfig(n=r._injector??n,r,a).pipe($c(({routes:P})=>{const L=r._loadedInjector??n,{parameters:G,consumedSegments:ie,remainingSegments:oe}=D,Ce=new hS(ie,G,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,w3(r),Uu(r),r.component??r._loadedComponent??null,r,C3(r)),Ae=dS(Ce,_,this.paramsInheritanceStrategy);Ce.params=Object.freeze(Ae.params),Ce.data=Object.freeze(Ae.data);const{segmentGroup:je,slicedSegments:et}=b3(t,ie,oe,P);if(0===et.length&&je.hasChildren())return this.processChildren(L,P,je,Ce).pipe(q(Et=>new ju(Ce,Et)));if(0===P.length&&0===et.length)return $n(new ju(Ce,[]));const Ze=Uu(r)===f;return this.processSegment(L,P,je,et,Ze?vi:f,!0,Ce).pipe(q(Et=>new ju(Ce,Et instanceof ju?[Et]:[])))})):Kv(t)))}getChildConfig(n,t,r){return t.children?$n({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?$n({routes:t._loadedRoutes,injector:t._loadedInjector}):function F9(e,n,t,r){const a=n.canLoad;return void 0===a||0===a.length?$n(!0):$n(a.map(_=>{const T=Yv(_,e);return Mm(function w9(e){return e&&jw(e.canLoad)}(T)?T.canLoad(n,t):Sa(e,()=>T(n,t)))})).pipe(Xv(),v3())}(n,t,r).pipe(Is(a=>a?this.configLoader.loadChildren(n,t).pipe(As(f=>{t._loadedRoutes=f.routes,t._loadedInjector=f.injector})):function z9(e){return QD(m3(!1,Bl.GuardRejected))}())):$n({routes:[],injector:n})}}function eq(e){const n=e.value.routeConfig;return n&&""===n.path}function x3(e){const n=[],t=new Set;for(const r of e){if(!eq(r)){n.push(r);continue}const a=n.find(f=>r.value.routeConfig===f.value.routeConfig);void 0!==a?(a.children.push(...r.children),t.add(a)):n.push(r)}for(const r of t){const a=x3(r.children);n.push(new ju(r.value,a))}return n.filter(r=>!t.has(r))}function w3(e){return e.data||{}}function C3(e){return e.resolve||{}}function nq(e,n){return Is(t=>{const{targetSnapshot:r,guards:{canActivateChecks:a}}=t;if(!a.length)return $n(t);const f=new Set(a.map(D=>D.route)),_=new Set;for(const D of f)if(!_.has(D))for(const P of T3(D))_.add(P);let T=0;return Vo(_).pipe(Uv(D=>f.has(D)?function iq(e,n,t,r){const a=e.routeConfig,f=e._resolve;return void 0!==a?.title&&!h3(a)&&(f[Ow]=a.title),function rq(e,n,t,r){const a=bA(e);if(0===a.length)return $n({});const f={};return Vo(a).pipe(Is(_=>function oq(e,n,t,r){const a=Lw(n)??r,f=Yv(e,a);return Mm(f.resolve?f.resolve(n,t):Sa(a,()=>f(n,t)))}(e[_],n,t,r).pipe(z_(),As(T=>{if(T instanceof NA)throw pS(new nS,T);f[_]=T}))),vA(1),function zL(e){return q(()=>e)}(f),Gv(_=>y3(_)?Ll:QD(_)))}(f,e,n,r).pipe(q(_=>(e._resolvedData=_,e.data=dS(e,e.parent,t).resolve,null)))}(D,r,e,n):(D.data=dS(D,D.parent,e).resolve,$n(void 0))),As(()=>T++),vA(1),Is(D=>T===_.size?$n(t):Ll))})}function T3(e){const n=e.children.map(t=>T3(t)).flat();return[e,...n]}function BA(e){return $c(n=>{const t=e(n);return t?Vo(t).pipe(q(()=>n)):$n(n)})}let E3=(()=>{class e{buildTitle(t){let r,a=t.root;for(;void 0!==a;)r=this.getResolvedTitleForRoute(a)??r,a=a.children.find(f=>f.outlet===vi);return r}getResolvedTitleForRoute(t){return t.data[Ow]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:()=>Re(sq),providedIn:"root"})}return e})(),sq=(()=>{class e extends E3{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||e)($t(NG))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Jv=new vt("",{providedIn:"root",factory:()=>({})});let D3=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Ti({type:e,selectors:[["ng-component"]],standalone:!0,features:[Bu],decls:1,vars:0,template:function(r,a){1&r&&un(0,"router-outlet")},dependencies:[PA],encapsulation:2})}return e})();function zA(e){const n=e.children&&e.children.map(zA),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==vi&&(t.component=D3),t}const Qv=new vt("");let VA=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Re(ok)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return $n(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=Mm(t.loadComponent()).pipe(q(S3),As(f=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=f}),Sw(()=>{this.componentLoaders.delete(t)})),a=new LL(r,()=>new Ci).pipe(_A());return this.componentLoaders.set(t,a),a}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return $n({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const f=function aq(e,n,t,r){return Mm(e.loadChildren()).pipe(q(S3),Is(a=>a instanceof wP||Array.isArray(a)?$n(a):Vo(n.compileModuleAsync(a))),q(a=>{r&&r(e);let f,_,T=!1;return Array.isArray(a)?(_=a,!0):(f=a.create(t).injector,_=f.get(Qv,[],{optional:!0,self:!0}).flat()),{routes:_.map(zA),injector:f}}))}(r,this.compiler,t,this.onLoadEndListener).pipe(Sw(()=>{this.childrenLoaders.delete(r)})),_=new LL(f,()=>new Ci).pipe(_A());return this.childrenLoaders.set(r,_),_}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function S3(e){return function lq(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let UA=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:()=>Re(cq),providedIn:"root"})}return e})(),cq=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const M3=new vt(""),I3=new vt("");function uq(e,n,t){const r=e.get(I3),a=e.get(Xr);return e.get(ii).runOutsideAngular(()=>{if(!a.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(P=>setTimeout(P));let f;const _=new Promise(P=>{f=P}),T=a.startViewTransition(()=>(f(),function dq(e){return new Promise(n=>{u({read:()=>setTimeout(n)},{injector:e})})}(e))),{onViewTransitionCreated:D}=r;return D&&Sa(e,()=>D({transition:T,from:n,to:t})),_})}const A3=new vt("");let vS=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ci,this.transitionAbortSubject=new Ci,this.configLoader=Re(VA),this.environmentInjector=Re(mo),this.urlSerializer=Re(qv),this.rootContexts=Re(Bw),this.location=Re(yw),this.inputBindingEnabled=null!==Re(fS,{optional:!0}),this.titleStrategy=Re(E3),this.options=Re(Jv,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Re(UA),this.createViewTransition=Re(M3,{optional:!0}),this.navigationErrorHandler=Re(A3,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>$n(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=a=>this.events.next(new Q7(a)),this.configLoader.onLoadStartListener=a=>this.events.next(new J7(a))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t,r,a){return this.transitions=new lo({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Fw,restoredState:null,currentSnapshot:a.snapshot,targetSnapshot:null,currentRouterState:a,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Uo(f=>0!==f.id),q(f=>({...f,extractedUrl:this.urlHandlingStrategy.extract(f.rawUrl)})),$c(f=>{let _=!1,T=!1;return $n(f).pipe($c(D=>{if(this.navigationId>f.id)return this.cancelNavigationTransition(f,"",Bl.SupersededByNewNavigation),Ll;this.currentTransition=f,this.currentNavigation={id:D.id,initialUrl:D.rawUrl,extractedUrl:D.extractedUrl,targetBrowserUrl:"string"==typeof D.extras.browserUrl?this.urlSerializer.parse(D.extras.browserUrl):D.extras.browserUrl,trigger:D.source,extras:D.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const P=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!P&&"reload"!==(D.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const G="";return this.events.next(new Wv(D.id,this.urlSerializer.serialize(D.rawUrl),G,cS.IgnoredSameUrlNavigation)),D.resolve(!1),Ll}if(this.urlHandlingStrategy.shouldProcessUrl(D.rawUrl))return $n(D).pipe($c(G=>{const ie=this.transitions?.getValue();return this.events.next(new lS(G.id,this.urlSerializer.serialize(G.extractedUrl),G.source,G.restoredState)),ie!==this.transitions?.getValue()?Ll:Promise.resolve(G)}),function tq(e,n,t,r,a,f){return Is(_=>function X9(e,n,t,r,a,f,_="emptyOnly"){return new J9(e,n,t,r,a,_,f).recognize()}(e,n,t,r,_.extractedUrl,a,f).pipe(q(({state:T,tree:D})=>({..._,targetSnapshot:T,urlAfterRedirects:D}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),As(G=>{f.targetSnapshot=G.targetSnapshot,f.urlAfterRedirects=G.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:G.urlAfterRedirects};const ie=new o3(G.id,this.urlSerializer.serialize(G.extractedUrl),this.urlSerializer.serialize(G.urlAfterRedirects),G.targetSnapshot);this.events.next(ie)}));if(P&&this.urlHandlingStrategy.shouldProcessUrl(D.currentRawUrl)){const{id:G,extractedUrl:ie,source:oe,restoredState:Ce,extras:Ae}=D,je=new lS(G,this.urlSerializer.serialize(ie),oe,Ce);this.events.next(je);const et=c3(this.rootComponentType).snapshot;return this.currentTransition=f={...D,targetSnapshot:et,urlAfterRedirects:ie,extras:{...Ae,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=ie,$n(f)}{const G="";return this.events.next(new Wv(D.id,this.urlSerializer.serialize(D.extractedUrl),G,cS.IgnoredByUrlHandlingStrategy)),D.resolve(!1),Ll}}),As(D=>{const P=new Z7(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(P)}),q(D=>(this.currentTransition=f={...D,guards:_9(D.targetSnapshot,D.currentSnapshot,this.rootContexts)},f)),function M9(e,n){return Is(t=>{const{targetSnapshot:r,currentSnapshot:a,guards:{canActivateChecks:f,canDeactivateChecks:_}}=t;return 0===_.length&&0===f.length?$n({...t,guardsResult:!0}):function I9(e,n,t,r){return Vo(e).pipe(Is(a=>function k9(e,n,t,r,a){const f=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return f&&0!==f.length?$n(f.map(T=>{const D=Lw(n)??a,P=Yv(T,D);return Mm(function E9(e){return e&&jw(e.canDeactivate)}(P)?P.canDeactivate(e,n,t,r):Sa(D,()=>P(e,n,t,r))).pipe(z_())})).pipe(Xv()):$n(!0)}(a.component,a.route,t,n,r)),z_(a=>!0!==a,!0))}(_,r,a,e).pipe(Is(T=>T&&function x9(e){return"boolean"==typeof e}(T)?function A9(e,n,t,r){return Vo(n).pipe(Uv(a=>Aw(function P9(e,n){return null!==e&&n&&n(new e9(e)),$n(!0)}(a.route.parent,r),function O9(e,n){return null!==e&&n&&n(new n9(e)),$n(!0)}(a.route,r),function N9(e,n,t){const r=n[n.length-1],f=n.slice(0,n.length-1).reverse().map(_=>function y9(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(_)).filter(_=>null!==_).map(_=>FL(()=>$n(_.guards.map(D=>{const P=Lw(_.node)??t,L=Yv(D,P);return Mm(function T9(e){return e&&jw(e.canActivateChild)}(L)?L.canActivateChild(r,e):Sa(P,()=>L(r,e))).pipe(z_())})).pipe(Xv())));return $n(f).pipe(Xv())}(e,a.path,t),function R9(e,n,t){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return $n(!0);const a=r.map(f=>FL(()=>{const _=Lw(n)??t,T=Yv(f,_);return Mm(function C9(e){return e&&jw(e.canActivate)}(T)?T.canActivate(n,e):Sa(_,()=>T(n,e))).pipe(z_())}));return $n(a).pipe(Xv())}(e,a.route,t))),z_(a=>!0!==a,!0))}(r,f,e,n):$n(T)),q(T=>({...t,guardsResult:T})))})}(this.environmentInjector,D=>this.events.next(D)),As(D=>{if(f.guardsResult=D.guardsResult,D.guardsResult&&"boolean"!=typeof D.guardsResult)throw pS(0,D.guardsResult);const P=new Y7(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot,!!D.guardsResult);this.events.next(P)}),Uo(D=>!!D.guardsResult||(this.cancelNavigationTransition(D,"",Bl.GuardRejected),!1)),BA(D=>{if(D.guards.canActivateChecks.length)return $n(D).pipe(As(P=>{const L=new X7(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(P.urlAfterRedirects),P.targetSnapshot);this.events.next(L)}),$c(P=>{let L=!1;return $n(P).pipe(nq(this.paramsInheritanceStrategy,this.environmentInjector),As({next:()=>L=!0,complete:()=>{L||this.cancelNavigationTransition(P,"",Bl.NoDataFromResolver)}}))}),As(P=>{const L=new K7(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(P.urlAfterRedirects),P.targetSnapshot);this.events.next(L)}))}),BA(D=>{const P=L=>{const G=[];L.routeConfig?.loadComponent&&!L.routeConfig._loadedComponent&&G.push(this.configLoader.loadComponent(L.routeConfig).pipe(As(ie=>{L.component=ie}),q(()=>{})));for(const ie of L.children)G.push(...P(ie));return G};return gA(P(D.targetSnapshot.root)).pipe(eS(null),ma(1))}),BA(()=>this.afterPreactivation()),$c(()=>{const{currentSnapshot:D,targetSnapshot:P}=f,L=this.createViewTransition?.(this.environmentInjector,D.root,P.root);return L?Vo(L).pipe(q(()=>f)):$n(f)}),q(D=>{const P=function d9(e,n,t){const r=zw(e,n._root,t?t._root:void 0);return new l3(r,n)}(t.routeReuseStrategy,D.targetSnapshot,D.currentRouterState);return this.currentTransition=f={...D,targetRouterState:P},this.currentNavigation.targetRouterState=P,f}),As(()=>{this.events.next(new DA)}),((e,n,t,r)=>q(a=>(new g9(n,a.targetRouterState,a.currentRouterState,t,r).activate(e),a)))(this.rootContexts,t.routeReuseStrategy,D=>this.events.next(D),this.inputBindingEnabled),ma(1),As({next:D=>{_=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Vf(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects))),this.titleStrategy?.updateTitle(D.targetRouterState.snapshot),D.resolve(!0)},complete:()=>{_=!0}}),Kr(this.transitionAbortSubject.pipe(As(D=>{throw D}))),Sw(()=>{!_&&!T&&this.cancelNavigationTransition(f,"",Bl.SupersededByNewNavigation),this.currentTransition?.id===f.id&&(this.currentNavigation=null,this.currentTransition=null)}),Gv(D=>{if(T=!0,g3(D))this.events.next(new $_(f.id,this.urlSerializer.serialize(f.extractedUrl),D.message,D.cancellationCode)),function p9(e){return g3(e)&&j_(e.url)}(D)?this.events.next(new uS(D.url,D.navigationBehaviorOptions)):f.resolve(!1);else{const P=new EA(f.id,this.urlSerializer.serialize(f.extractedUrl),D,f.targetSnapshot??void 0);try{const L=Sa(this.environmentInjector,()=>this.navigationErrorHandler?.(P));if(L instanceof NA){const{message:G,cancellationCode:ie}=pS(0,L);this.events.next(new $_(f.id,this.urlSerializer.serialize(f.extractedUrl),G,ie)),this.events.next(new uS(L.redirectTo,L.navigationBehaviorOptions))}else{this.events.next(P);const G=t.errorHandler(D);f.resolve(!!G)}}catch(L){this.options.resolveNavigationPromiseOnError?f.resolve(!1):f.reject(L)}}return Ll}))}))}cancelNavigationTransition(t,r,a){const f=new $_(t.id,this.urlSerializer.serialize(t.extractedUrl),r,a);this.events.next(f),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function hq(e){return e!==Fw}let fq=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:()=>Re(mq),providedIn:"root"})}return e})();class pq{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let mq=(()=>{class e extends pq{static#e=this.\u0275fac=(()=>{let t;return function(a){return(t||(t=lr(e)))(a||e)}})();static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),O3=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:()=>Re(gq),providedIn:"root"})}return e})(),gq=(()=>{class e extends O3{constructor(){super(...arguments),this.location=Re(yw),this.urlSerializer=Re(qv),this.options=Re(Jv,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Re(UA),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new V_,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=c3(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(r=>{"popstate"===r.type&&t(r.url,r.state)})}handleRouterEvent(t,r){if(t instanceof lS)this.stateMemento=this.createStateMemento();else if(t instanceof Wv)this.rawUrlTree=r.initialUrl;else if(t instanceof o3){if("eager"===this.urlUpdateStrategy&&!r.extras.skipLocationChange){const a=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??a,r)}}else t instanceof DA?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):t instanceof $_&&(t.code===Bl.GuardRejected||t.code===Bl.NoDataFromResolver)?this.restoreHistory(r):t instanceof EA?this.restoreHistory(r,!0):t instanceof Vf&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,r){const a=t instanceof V_?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(a)||r.extras.replaceUrl){const _={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(a,"",_)}else{const f={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(a,"",f)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-this.browserPageId;0!==f?this.location.historyGo(f):this.currentUrlTree===t.finalUrl&&0===f&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static#e=this.\u0275fac=(()=>{let t;return function(a){return(t||(t=lr(e)))(a||e)}})();static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var $w=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}($w||{});function P3(e,n){e.events.pipe(Uo(t=>t instanceof Vf||t instanceof $_||t instanceof EA||t instanceof Wv),q(t=>t instanceof Vf||t instanceof Wv?$w.COMPLETE:t instanceof $_&&(t.code===Bl.Redirect||t.code===Bl.SupersededByNewNavigation)?$w.REDIRECTING:$w.FAILED),Uo(t=>t!==$w.REDIRECTING),ma(1)).subscribe(()=>{n()})}function _q(e){throw e}const yq={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},vq={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let cs=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=Re(ZN),this.stateManager=Re(O3),this.options=Re(Jv,{optional:!0})||{},this.pendingTasks=Re(Cc),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Re(vS),this.urlSerializer=Re(qv),this.location=Re(yw),this.urlHandlingStrategy=Re(UA),this._events=new Ci,this.errorHandler=this.options.errorHandler||_q,this.navigated=!1,this.routeReuseStrategy=Re(fq),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Re(Qv,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Re(fS,{optional:!0}),this.eventsSubscription=new Rt,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(r=>{try{const a=this.navigationTransitions.currentTransition,f=this.navigationTransitions.currentNavigation;if(null!==a&&null!==f)if(this.stateManager.handleRouterEvent(r,f),r instanceof $_&&r.code!==Bl.Redirect&&r.code!==Bl.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Vf)this.navigated=!0;else if(r instanceof uS){const _=r.navigationBehaviorOptions,T=this.urlHandlingStrategy.merge(r.url,a.currentRawUrl),D={browserUrl:a.extras.browserUrl,info:a.extras.info,skipLocationChange:a.extras.skipLocationChange,replaceUrl:a.extras.replaceUrl||"eager"===this.urlUpdateStrategy||hq(a.source),..._};this.scheduleNavigation(T,Fw,null,D,{resolve:a.resolve,reject:a.reject,promise:a.promise})}(function xq(e){return!(e instanceof DA||e instanceof uS)})(r)&&this._events.next(r)}catch(a){this.navigationTransitions.transitionAbortSubject.next(a)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Fw,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",r)},0)})}navigateToSyncWithBrowser(t,r,a){const f={replaceUrl:!0},_=a?.navigationId?a:null;if(a){const D={...a};delete D.navigationId,delete D.\u0275routerPageId,0!==Object.keys(D).length&&(f.state=D)}const T=this.parseUrl(t);this.scheduleNavigation(T,r,_,f)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(zA),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){const{relativeTo:a,queryParams:f,fragment:_,queryParamsHandling:T,preserveFragment:D}=r,P=D?this.currentUrlTree.fragment:_;let G,L=null;switch(T){case"merge":L={...this.currentUrlTree.queryParams,...f};break;case"preserve":L=this.currentUrlTree.queryParams;break;default:L=f||null}null!==L&&(L=this.removeEmptyProps(L));try{G=JL(a?a.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||"/"!==t[0][0])&&(t=[]),G=this.currentUrlTree.root}return QL(G,t,L,P??null)}navigateByUrl(t,r={skipLocationChange:!1}){const a=j_(t)?t:this.parseUrl(t),f=this.urlHandlingStrategy.merge(a,this.rawUrlTree);return this.scheduleNavigation(f,Fw,null,r)}navigate(t,r={skipLocationChange:!1}){return function bq(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new wt(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,r){let a;if(a=!0===r?{...yq}:!1===r?{...vq}:r,j_(t))return $L(this.currentUrlTree,t,a);const f=this.parseUrl(t);return $L(this.currentUrlTree,f,a)}removeEmptyProps(t){return Object.entries(t).reduce((r,[a,f])=>(null!=f&&(r[a]=f),r),{})}scheduleNavigation(t,r,a,f,_){if(this.disposed)return Promise.resolve(!1);let T,D,P;_?(T=_.resolve,D=_.reject,P=_.promise):P=new Promise((G,ie)=>{T=G,D=ie});const L=this.pendingTasks.add();return P3(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(L))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:a,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:f,resolve:T,reject:D,promise:P,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),P.catch(G=>Promise.reject(G))}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),e1=(()=>{class e{constructor(t,r,a,f,_,T){this.router=t,this.route=r,this.tabIndexAttribute=a,this.renderer=f,this.el=_,this.locationStrategy=T,this.href=null,this.onChanges=new Ci,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;const D=_.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===D||"area"===D,this.isAnchorElement?this.subscription=t.events.subscribe(P=>{P instanceof Vf&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null==t?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(this.routerLinkInput=j_(t)||Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,r,a,f,_){const T=this.urlTree;return!!(null===T||this.isAnchorElement&&(0!==t||r||a||f||_||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(T,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const t=this.urlTree;this.href=null!==t&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t)):null;const r=null===this.href?null:function Pb(e,n,t){return function Wp(e,n){return"src"===n&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===n&&("base"===e||"link"===e)?Mu:Bi}(n,t)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(t,r){const a=this.renderer,f=this.el.nativeElement;null!==r?a.setAttribute(f,t,r):a.removeAttribute(f,t)}get urlTree(){return null===this.routerLinkInput?null:j_(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(cs),tt(gh),Zs("tabindex"),tt(Oc),tt(wi),tt(N_))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,a){1&r&&At("click",function(_){return a.onClick(_.button,_.ctrlKey,_.shiftKey,_.altKey,_.metaKey)}),2&r&&Qi("target",a.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",zr],skipLocationChange:[2,"skipLocationChange","skipLocationChange",zr],replaceUrl:[2,"replaceUrl","replaceUrl",zr],routerLink:"routerLink"},standalone:!0,features:[qx,kr]})}return e})(),R3=(()=>{class e{get isActive(){return this._isActive}constructor(t,r,a,f,_){this.router=t,this.element=r,this.renderer=a,this.cdr=f,this.link=_,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new fn,this.routerEventsSubscription=t.events.subscribe(T=>{T instanceof Vf&&this.update()})}ngAfterContentInit(){$n(this.links.changes,$n(null)).pipe($v()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const t=[...this.links.toArray(),this.link].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=Vo(t).pipe($v()).subscribe(r=>{this._isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(t){const r=Array.isArray(t)?t:t.split(" ");this.classes=r.filter(a=>!!a)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const t=this.hasActiveLinks();this.classes.forEach(r=>{t?this.renderer.addClass(this.element.nativeElement,r):this.renderer.removeClass(this.element.nativeElement,r)}),t&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.isActiveChange.emit(t))})}isLinkActive(t){const r=function wq(e){return!!e.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return a=>{const f=a.urlTree;return!!f&&t.isActive(f,r)}}hasActiveLinks(){const t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static#e=this.\u0275fac=function(r){return new(r||e)(tt(cs),tt(wi),tt(Oc),tt(zc),tt(e1,8))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(r,a,f){if(1&r&&er(f,e1,5),2&r){let _;pi(_=mi())&&(a.links=_)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[kr]})}return e})();class N3{}let Cq=(()=>{class e{constructor(t,r,a,f,_){this.router=t,this.injector=a,this.preloadingStrategy=f,this.loader=_}setUpPreloading(){this.subscription=this.router.events.pipe(Uo(t=>t instanceof Vf),Uv(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const a=[];for(const f of r){f.providers&&!f._injector&&(f._injector=HE(f.providers,t,`Route: ${f.path}`));const _=f._injector??t,T=f._loadedInjector??_;(f.loadChildren&&!f._loadedRoutes&&void 0===f.canLoad||f.loadComponent&&!f._loadedComponent)&&a.push(this.preloadConfig(_,f)),(f.children||f._loadedRoutes)&&a.push(this.processRoutes(T,f.children??f._loadedRoutes))}return Vo(a).pipe($v())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let a;a=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):$n(null);const f=a.pipe(Is(_=>null===_?$n(void 0):(r._loadedRoutes=_.routes,r._loadedInjector=_.injector,this.processRoutes(_.injector??t,_.routes))));return r.loadComponent&&!r._loadedComponent?Vo([f,this.loader.loadComponent(r)]).pipe($v()):f})}static#e=this.\u0275fac=function(r){return new(r||e)($t(cs),$t(ok),$t(mo),$t(N3),$t(VA))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const jA=new vt("");let k3=(()=>{class e{constructor(t,r,a,f,_={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=a,this.zone=f,this.options=_,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},_.scrollPositionRestoration||="disabled",_.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof lS?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Vf?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Wv&&t.code===cS.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof s3&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new s3(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function Qp(){throw new Error("invalid")}()};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();function _h(e,n){return{\u0275kind:e,\u0275providers:n}}function L3(){const e=Re(or);return n=>{const t=e.get(Bc);if(n!==t.components[0])return;const r=e.get(cs),a=e.get(B3);1===e.get($A)&&r.initialNavigation(),e.get(z3,null,Yn.Optional)?.setUpPreloading(),e.get(jA,null,Yn.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),a.closed||(a.next(),a.complete(),a.unsubscribe())}}const B3=new vt("",{factory:()=>new Ci}),$A=new vt("",{providedIn:"root",factory:()=>1}),z3=new vt("");function Sq(e){return _h(0,[{provide:z3,useExisting:Cq},{provide:N3,useExisting:e}])}function Iq(e){return _h(9,[{provide:M3,useValue:uq},{provide:I3,useValue:{skipNextTransition:!!e?.skipInitialTransition,...e}}])}const V3=new vt("ROUTER_FORROOT_GUARD"),Aq=[yw,{provide:qv,useClass:nS},cs,Bw,{provide:gh,useFactory:function F3(e){return e.routerState.root},deps:[cs]},VA,[]];let U3=(()=>{class e{constructor(t){}static forRoot(t,r){return{ngModule:e,providers:[Aq,[],{provide:Qv,multi:!0,useValue:t},{provide:V3,useFactory:Nq,deps:[[cs,new $h,new cu]]},{provide:Jv,useValue:r||{}},r?.useHash?{provide:N_,useClass:y8}:{provide:N_,useClass:Qk},{provide:jA,useFactory:()=>{const e=Re(R$),n=Re(ii),t=Re(Jv),r=Re(vS),a=Re(qv);return t.scrollOffset&&e.setOffset(t.scrollOffset),new k3(a,r,e,n,t)}},r?.preloadingStrategy?Sq(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?kq(r):[],r?.bindToComponentInputs?_h(8,[f3,{provide:fS,useExisting:f3}]).\u0275providers:[],r?.enableViewTransitions?Iq().\u0275providers:[],[{provide:j3,useFactory:L3},{provide:_D,multi:!0,useExisting:j3}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Qv,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(r){return new(r||e)($t(V3,8))};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})();function Nq(e){return"guarded"}function kq(e){return["disabled"===e.initialNavigation?_h(3,[{provide:g2,multi:!0,useFactory:()=>{const n=Re(cs);return()=>{n.setUpLocationChangeListener()}}},{provide:$A,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?_h(2,[{provide:$A,useValue:0},{provide:g2,multi:!0,deps:[or],useFactory:n=>{const t=n.get(g8,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const a=n.get(cs),f=n.get(B3);P3(a,()=>{r(!0)}),n.get(vS).afterPreactivation=()=>(r(!0),f.closed?$n(void 0):f),a.initialNavigation()}))}}]).\u0275providers:[]]}const j3=new vt("");let GA=(()=>{class e{constructor(t){this.httpClient=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getProducts(){return this.httpClient.get(this.baseUrl+"api/product/products")}updateProduct(t,r){return this.httpClient.put(this.baseUrl+"api/product/products/"+t,r)}createProduct(t){return this.httpClient.post(this.baseUrl+"api/product/product",t)}updatePrices(t){return this.httpClient.put(`${this.baseUrl}api/product/products/update_prices`,{sku_price_list:t})}syncSheet(){return this.httpClient.post(this.baseUrl+"api/product/products/syncsheet",{})}static#e=this.\u0275fac=function(r){return new(r||e)($t(zf))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),$3=(()=>{class e{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=a=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Oc),tt(wi))};static#t=this.\u0275dir=Lt({type:e})}return e})(),G_=(()=>{class e extends $3{static#e=this.\u0275fac=(()=>{let t;return function(a){return(t||(t=lr(e)))(a||e)}})();static#t=this.\u0275dir=Lt({type:e,features:[Zi]})}return e})();const zl=new vt(""),Bq={provide:zl,useExisting:Oi(()=>HA),multi:!0};let HA=(()=>{class e extends G_{writeValue(t){this.setProperty("checked",t)}static#e=this.\u0275fac=(()=>{let t;return function(a){return(t||(t=lr(e)))(a||e)}})();static#t=this.\u0275dir=Lt({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,a){1&r&&At("change",function(_){return a.onChange(_.target.checked)})("blur",function(){return a.onTouched()})},features:[yr([Bq]),Zi]})}return e})();const zq={provide:zl,useExisting:Oi(()=>Os),multi:!0},Uq=new vt("");let Os=(()=>{class e extends $3{constructor(t,r,a){super(t,r),this._compositionMode=a,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Vq(){const e=Cm()?Cm().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Oc),tt(wi),tt(Uq,8))};static#t=this.\u0275dir=Lt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,a){1&r&&At("input",function(_){return a._handleInput(_.target.value)})("blur",function(){return a.onTouched()})("compositionstart",function(){return a._compositionStart()})("compositionend",function(_){return a._compositionEnd(_.target.value)})},features:[yr([zq]),Zi]})}return e})();const Js=new vt(""),Am=new vt("");function W3(e){return function Im(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}(e.value)?{required:!0}:null}function bS(e){return null}function Q3(e){return null!=e}function eB(e){return hw(e)?Vo(e):e}function tB(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function nB(e,n){return n.map(t=>t(e))}function iB(e){return e.map(n=>function $q(e){return!e.validate}(n)?n:t=>n.validate(t))}function qA(e){return null!=e?function rB(e){if(!e)return null;const n=e.filter(Q3);return 0==n.length?null:function(t){return tB(nB(t,n))}}(iB(e)):null}function WA(e){return null!=e?function oB(e){if(!e)return null;const n=e.filter(Q3);return 0==n.length?null:function(t){return function Lq(...e){const n=qD(e),{args:t,keys:r}=RL(e),a=new Fi(f=>{const{length:_}=t;if(!_)return void f.complete();const T=new Array(_);let D=_,P=_;for(let L=0;L<_;L++){let G=!1;Ms(t[L]).subscribe(ve(f,ie=>{G||(G=!0,P--),T[L]=ie},()=>D--,void 0,()=>{(!D||!G)&&(P||f.next(r?NL(r,T):T),f.complete())}))}});return n?a.pipe(mA(n)):a}(nB(t,n).map(eB)).pipe(q(tB))}}(iB(e)):null}function sB(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function ZA(e){return e?Array.isArray(e)?e:[e]:[]}function xS(e,n){return Array.isArray(e)?e.includes(n):e===n}function cB(e,n){const t=ZA(n);return ZA(e).forEach(a=>{xS(t,a)||t.push(a)}),t}function uB(e,n){return ZA(n).filter(t=>!xS(e,t))}class dB{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=qA(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=WA(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class Ba extends dB{get formDirective(){return null}get path(){return null}}class Om extends dB{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class hB{constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let ga=(()=>{class e extends hB{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Om,2))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,a){2&r&&ji("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)},features:[Zi]})}return e})(),wS=(()=>{class e extends hB{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Ba,10))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,a){2&r&&ji("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)("ng-submitted",a.isSubmitted)},features:[Zi]})}return e})();const Gw="VALID",TS="INVALID",t1="PENDING",Hw="DISABLED";class n1{}class pB extends n1{constructor(n,t){super(),this.value=n,this.source=t}}class KA extends n1{constructor(n,t){super(),this.pristine=n,this.source=t}}class JA extends n1{constructor(n,t){super(),this.touched=n,this.source=t}}class ES extends n1{constructor(n,t){super(),this.status=n,this.source=t}}function QA(e){return(DS(e)?e.validators:e)||null}function eO(e,n){return(DS(n)?n.asyncValidators:e)||null}function DS(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class tO{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=_w(()=>this.statusReactive()),this.statusReactive=Pc(void 0),this._pristine=_w(()=>this.pristineReactive()),this.pristineReactive=Pc(!0),this._touched=_w(()=>this.touchedReactive()),this.touchedReactive=Pc(!1),this._events=new Ci,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return fh(this.statusReactive)}set status(n){fh(()=>this.statusReactive.set(n))}get valid(){return this.status===Gw}get invalid(){return this.status===TS}get pending(){return this.status==t1}get disabled(){return this.status===Hw}get enabled(){return this.status!==Hw}get pristine(){return fh(this.pristineReactive)}set pristine(n){fh(()=>this.pristineReactive.set(n))}get dirty(){return!this.pristine}get touched(){return fh(this.touchedReactive)}set touched(n){fh(()=>this.touchedReactive.set(n))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(cB(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(cB(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(uB(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(uB(n,this._rawAsyncValidators))}hasValidator(n){return xS(this._rawValidators,n)}hasAsyncValidator(n){return xS(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){const t=!1===this.touched;this.touched=!0;const r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched({...n,sourceControl:r}),t&&!1!==n.emitEvent&&this._events.next(new JA(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(n))}markAsUntouched(n={}){const t=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const r=n.sourceControl??this;this._forEachChild(a=>{a.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),t&&!1!==n.emitEvent&&this._events.next(new JA(!1,r))}markAsDirty(n={}){const t=!0===this.pristine;this.pristine=!1;const r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty({...n,sourceControl:r}),t&&!1!==n.emitEvent&&this._events.next(new KA(!1,r))}markAsPristine(n={}){const t=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const r=n.sourceControl??this;this._forEachChild(a=>{a.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),t&&!1!==n.emitEvent&&this._events.next(new KA(!0,r))}markAsPending(n={}){this.status=t1;const t=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new ES(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending({...n,sourceControl:t})}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=Hw,this.errors=null,this._forEachChild(a=>{a.disable({...n,onlySelf:!0})}),this._updateValue();const r=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new pB(this.value,r)),this._events.next(new ES(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t},this),this._onDisabledChange.forEach(a=>a(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=Gw,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t},this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,t){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Gw||this.status===t1)&&this._runAsyncValidator(r,n.emitEvent)}const t=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new pB(this.value,t)),this._events.next(new ES(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity({...n,sourceControl:t})}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Hw:Gw}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,t){if(this.asyncValidator){this.status=t1,this._hasOwnPendingAsyncValidator={emitEvent:!1!==t};const r=eB(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(a=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(a,{emitEvent:t,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent,this,t.shouldHaveEmitted)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,a)=>r&&r._find(a),this)}getError(n,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,t,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new ES(this.status,t)),this._parent&&this._parent._updateControlsErrors(n,t,r)}_initObservables(){this.valueChanges=new fn,this.statusChanges=new fn}_calculateStatus(){return this._allControlsDisabled()?Hw:this.errors?TS:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(t1)?t1:this._anyControlsHaveStatus(TS)?TS:Gw}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,t){const r=!this._anyControlsDirty(),a=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,t),a&&this._events.next(new KA(this.pristine,t))}_updateTouched(n={},t){this.touched=this._anyControlsTouched(),this._events.next(new JA(this.touched,t)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,t)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){DS(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function Xq(e){return Array.isArray(e)?qA(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function Kq(e){return Array.isArray(e)?WA(e):e||null}(this._rawAsyncValidators)}}class nO extends tO{constructor(n,t,r){super(QA(t),eO(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,r={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){(function gB(e,n,t){e._forEachChild((r,a)=>{if(void 0===t[a])throw new wt(1002,"")})})(this,0,n),Object.keys(n).forEach(r=>{(function mB(e,n,t){const r=e.controls;if(!(n?Object.keys(r):r).length)throw new wt(1e3,"");if(!r[t])throw new wt(1001,"")})(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(r=>{const a=this.controls[r];a&&a.patchValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((r,a)=>{r.reset(n?n[a]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,r)=>(n[r]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&n(r,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,a)=>((r.enabled||this.disabled)&&(t[a]=r.value),t))}_reduceChildren(n,t){let r=n;return this._forEachChild((a,f)=>{r=t(r,a,f)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}const H_=new vt("CallSetDisabledState",{providedIn:"root",factory:()=>qw}),qw="always";function Ww(e,n,t=qw){iO(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function eW(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&_B(e,n)})}(e,n),function nW(e,n){const t=(r,a)=>{n.valueAccessor.writeValue(r),a&&n.viewToModelUpdate(r)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function tW(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&_B(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function Qq(e,n){if(n.valueAccessor.setDisabledState){const t=r=>{n.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function IS(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function iO(e,n){const t=function aB(e){return e._rawValidators}(e);null!==n.validator?e.setValidators(sB(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const r=function lB(e){return e._rawAsyncValidators}(e);null!==n.asyncValidator?e.setAsyncValidators(sB(r,n.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const a=()=>e.updateValueAndValidity();IS(n._rawValidators,a),IS(n._rawAsyncValidators,a)}function _B(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}const aW={provide:Ba,useExisting:Oi(()=>i1)},Zw=Promise.resolve();let i1=(()=>{class e extends Ba{get submitted(){return fh(this.submittedReactive)}constructor(t,r,a){super(),this.callSetDisabledState=a,this._submitted=_w(()=>this.submittedReactive()),this.submittedReactive=Pc(!1),this._directives=new Set,this.ngSubmit=new fn,this.form=new nO({},qA(t),WA(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Zw.then(()=>{const r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),Ww(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Zw.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Zw.then(()=>{const r=this._findContainer(t.path),a=new nO({});(function yB(e,n){iO(e,n)})(a,t),r.registerControl(t.name,a),a.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Zw.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){Zw.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),function vB(e,n){e._syncPendingControls(),n.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Js,10),tt(Am,10),tt(H_,8))};static#t=this.\u0275dir=Lt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,a){1&r&&At("submit",function(_){return a.onSubmit(_)})("reset",function(){return a.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[yr([aW]),Zi]})}return e})();function bB(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function xB(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const wB=class extends tO{constructor(n=null,t,r){super(QA(t),eO(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),DS(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=xB(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){bB(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){bB(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){xB(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},uW={provide:Om,useExisting:Oi(()=>Qs)},EB=Promise.resolve();let Qs=(()=>{class e extends Om{constructor(t,r,a,f,_,T){super(),this._changeDetectorRef=_,this.callSetDisabledState=T,this.control=new wB,this._registered=!1,this.name="",this.update=new fn,this._parent=t,this._setValidators(r),this._setAsyncValidators(a),this.valueAccessor=function sO(e,n){if(!n)return null;let t,r,a;return Array.isArray(n),n.forEach(f=>{f.constructor===Os?t=f:function oW(e){return Object.getPrototypeOf(e.constructor)===G_}(f)?r=f:a=f}),a||r||t||null}(0,f)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),function oO(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Ww(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){EB.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const r=t.isDisabled.currentValue,a=0!==r&&zr(r);EB.then(()=>{a&&!this.control.disabled?this.control.disable():!a&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?function SS(e,n){return[...n.path,e]}(t,this._parent):[t]}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Ba,9),tt(Js,10),tt(Am,10),tt(zl,10),tt(zc,8),tt(H_,8))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[yr([uW]),Zi,kr]})}return e})(),OS=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Lt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})();const dW={provide:zl,useExisting:Oi(()=>Yw),multi:!0};let Yw=(()=>{class e extends G_{writeValue(t){this.setProperty("value",t??"")}registerOnChange(t){this.onChange=r=>{t(""==r?null:parseFloat(r))}}static#e=this.\u0275fac=(()=>{let t;return function(a){return(t||(t=lr(e)))(a||e)}})();static#t=this.\u0275dir=Lt({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,a){1&r&&At("input",function(_){return a.onChange(_.target.value)})("blur",function(){return a.onTouched()})},features:[yr([dW]),Zi]})}return e})();const aO=new vt(""),bW={provide:zl,useExisting:Oi(()=>Pm),multi:!0};function OB(e,n){return null==e?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let Pm=(()=>{class e extends G_{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const a=OB(this._getOptionId(t),t);this.setProperty("value",a)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function xW(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static#e=this.\u0275fac=(()=>{let t;return function(a){return(t||(t=lr(e)))(a||e)}})();static#t=this.\u0275dir=Lt({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,a){1&r&&At("change",function(_){return a.onChange(_.target.value)})("blur",function(){return a.onTouched()})},inputs:{compareWith:"compareWith"},features:[yr([bW]),Zi]})}return e})(),r1=(()=>{class e{constructor(t,r,a){this._element=t,this._renderer=r,this._select=a,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(OB(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(tt(wi),tt(Oc),tt(Pm,9))};static#t=this.\u0275dir=Lt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();const wW={provide:zl,useExisting:Oi(()=>dO),multi:!0};function PB(e,n){return null==e?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let dO=(()=>{class e extends G_{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const a=t.map(f=>this._getOptionId(f));r=(f,_)=>{f._setSelected(a.indexOf(_.toString())>-1)}}else r=(a,f)=>{a._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const a=[],f=r.selectedOptions;if(void 0!==f){const _=f;for(let T=0;T<_.length;T++){const P=this._getOptionValue(_[T].value);a.push(P)}}else{const _=r.options;for(let T=0;T<_.length;T++){const D=_[T];if(D.selected){const P=this._getOptionValue(D.value);a.push(P)}}}this.value=a,t(a)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function CW(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static#e=this.\u0275fac=(()=>{let t;return function(a){return(t||(t=lr(e)))(a||e)}})();static#t=this.\u0275dir=Lt({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,a){1&r&&At("change",function(_){return a.onChange(_.target)})("blur",function(){return a.onTouched()})},inputs:{compareWith:"compareWith"},features:[yr([wW]),Zi]})}return e})(),o1=(()=>{class e{constructor(t,r,a){this._element=t,this._renderer=r,this._select=a,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(PB(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(PB(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(tt(wi),tt(Oc),tt(dO,9))};static#t=this.\u0275dir=Lt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})(),q_=(()=>{class e{constructor(){this._validator=bS}ngOnChanges(t){if(this.inputName in t){const r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):bS,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return null!=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Lt({type:e,features:[kr]})}return e})();const DW={provide:Js,useExisting:Oi(()=>s1),multi:!0};let s1=(()=>{class e extends q_{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=zr,this.createValidator=t=>W3}enabled(t){return t}static#e=this.\u0275fac=(()=>{let t;return function(a){return(t||(t=lr(e)))(a||e)}})();static#t=this.\u0275dir=Lt({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,a){2&r&&Qi("required",a._enabled?"":null)},inputs:{required:"required"},features:[yr([DW]),Zi]})}return e})(),jB=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),RW=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:H_,useValue:t.callSetDisabledState??qw}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({imports:[jB]})}return e})(),NW=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:aO,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:H_,useValue:t.callSetDisabledState??qw}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({imports:[jB]})}return e})();function kW(e,n){1&e&&un(0,"br")}function FW(e,n){if(1&e&&(Q(0,"div",62),ge(1),J()),2&e){const t=gt();we(),ol(" ",t.successMessage," ")}}function LW(e,n){if(1&e&&(Q(0,"div",63),ge(1),J()),2&e){const t=gt();we(),ol(" ",t.errorMessage," ")}}function BW(e,n){if(1&e){const t=$i();Q(0,"tr")(1,"td"),ge(2),J(),Q(3,"td"),ge(4),J(),Q(5,"td"),ge(6),J(),Q(7,"td"),ge(8),J(),Q(9,"td"),ge(10),J(),Q(11,"td")(12,"input",37),qt("ngModelChange",function(a){const f=Xt(t).$implicit;return Zt(f.price_sale,a)||(f.price_sale=a),Kt(a)}),J()(),Q(13,"td"),ge(14),J(),Q(15,"td")(16,"span",64),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().openEditModal(a,"update"))}),un(17,"i",65),J()()()}if(2&e){const t=n.$implicit;we(2),Qt(t.sku),we(2),Qt(t.name),we(2),Qt(t.unit),we(2),Qt(t.category),we(2),Qt(t.price_purchase),we(2),Ht("ngModel",t.price_sale),we(2),Qt(t.status)}}function zW(e,n){if(1&e){const t=$i();Q(0,"button",66),At("click",function(){return Xt(t),Kt(gt().updated_product())}),ge(1,"Guardar Cambios"),J()}2&e&&Tt("disabled",!gt().camposCompletos())}function VW(e,n){if(1&e){const t=$i();Q(0,"button",66),At("click",function(){return Xt(t),Kt(gt().created_product())}),ge(1,"Nuevo Producto"),J()}2&e&&Tt("disabled",!gt().camposCompletos())}let UW=(()=>{class e{constructor(t,r){this.productService=t,this.router=r,this.products=[],this.filteredProducts=[],this.searchText="",this.product={},this.actionTipo="",this.successMessage="",this.errorMessage=""}ngOnInit(){this.checkIfLoggedIn()?this.getProducts():this.router.navigate(["/login"])}checkIfLoggedIn(){return!!localStorage.getItem("token")}getProducts(){this.productService.getProducts().subscribe(t=>{this.products=t,this.filteredProducts=t,this.filterProducts()})}filterProducts(){this.filteredProducts=""!==this.searchText.trim()?this.products.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())):this.products}openEditModal(t,r){this.product=t,this.actionTipo=r}updated_product(){this.product.price_sale=parseFloat(this.product.price_sale),this.product.price_purchase=parseFloat(this.product.price_purchase),this.product.margen=parseFloat(this.product.margen),this.product.discount=parseFloat(this.product.discount),this.product.iva_value=parseFloat(this.product.iva_value),this.product.iva="true"===this.product.iva,this.productService.updateProduct(this.product.id,this.product).subscribe(t=>{this.successMessage="\xa1Producto actualizado correctamente!",setTimeout(()=>{this.successMessage=""},3e3)}),this.getProducts()}created_product(){this.product.price_sale=+this.product.price_sale,this.product.price_purchase=+this.product.price_purchase,this.product.iva="true"===this.product.iva,this.productService.createProduct(this.product).subscribe(t=>{}),this.getProducts()}updatePrice(){const t=this.filteredProducts.map(r=>({sku:r.sku,price_sale:r.price_sale,id:r.id}));this.productService.updatePrices(t).subscribe(r=>{this.successMessage="\xa1Precios actualizados correctamente!",setTimeout(()=>{this.successMessage=""},3e3)})}camposCompletos(){const{name:t,unit:r,category:a,sku:f,price_sale:_,image:oe,status:Ce}=this.product;return!!(t&&r&&a&&f&&_&&oe&&Ce)}syncSheet(){this.productService.syncSheet().subscribe(t=>{200===t.status||void 0===t.status?(this.successMessage="\xa1Sincronizaci\xf3n exitosa!",this.getProducts(),setTimeout(()=>{this.successMessage=""},3e3)):(this.errorMessage="Error en la sincronizaci\xf3n.",setTimeout(()=>{this.errorMessage=""},3e3))})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(GA),tt(cs))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-products"]],decls:136,vars:21,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],[1,"col-6"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","keyup","ngModel"],["type","button","data-bs-toggle","modal","data-bs-target","#editProductModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","editProductModal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","editProductModalLabel",1,"modal-title"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-10"],[1,"form-group"],["for","name"],["type","text","id","name","name","name",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-2"],["for","unit"],["id","unit","name","unit",1,"form-control",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],["value","KG"],["value","UNIT"],[1,"col-4"],["for","category"],["type","text","id","category","name","category",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-8"],["for","sku"],["type","text","id","sku","name","sku",1,"form-control",3,"ngModelChange","ngModel"],["for","price_sale"],["type","number","id","price_sale","name","price_sale",1,"form-control",3,"ngModelChange","ngModel"],["for","price_purchase"],["type","number","id","price_purchase","name","price_purchase",1,"form-control",3,"ngModelChange","ngModel"],["for","discount"],["type","number","id","discount","name","discount",1,"form-control",3,"ngModelChange","ngModel"],["for","margen"],["type","number","id","margen","name","margen",1,"form-control",3,"ngModelChange","ngModel"],["for","iva"],["id","iva","name","iva",1,"form-control",3,"ngModelChange","ngModel"],["value","true"],["value","false"],["for","iva_value"],["type","number","id","iva_value","name","iva_value",1,"form-control",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description",1,"form-control",3,"ngModelChange","ngModel"],["for","image"],["type","text","id","image","name","image",1,"form-control",3,"ngModelChange","ngModel"],["for","status"],["id","status","name","status",1,"form-control",3,"ngModelChange","ngModel"],["value","active"],["value","inactive"],["alt","Imagen del producto",1,"img-fluid",3,"src"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","class","btn btn-primary","data-bs-dismiss","modal",3,"disabled","click",4,"ngIf"],["role","alert",1,"alert","alert-success"],["role","alert",1,"alert","alert-danger"],["data-bs-toggle","modal","data-bs-target","#editProductModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-pencil-alt","fa-lg"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click","disabled"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),At("click",function(){return a.syncSheet()}),ge(4,"Sincronizar sheet"),J()(),Q(5,"div",4)(6,"input",5),qt("ngModelChange",function(_){return Zt(a.searchText,_)||(a.searchText=_),_}),At("keyup",function(){return a.filterProducts()}),J()(),Q(7,"div",2)(8,"button",6),At("click",function(){return a.openEditModal({},"new")}),ge(9,"Nuevo Producto"),J()()(),Jt(10,kW,1,0,"br",7)(11,FW,2,1,"div",8)(12,LW,2,1,"div",9),un(13,"br"),Q(14,"table",10)(15,"thead")(16,"tr")(17,"th"),ge(18,"ID"),J(),Q(19,"th"),ge(20,"Nombre"),J(),Q(21,"th"),ge(22,"Unidad"),J(),Q(23,"th"),ge(24,"Categoria"),J(),Q(25,"th"),ge(26,"Precio Compra"),J(),Q(27,"th"),ge(28,"Precio Venta"),J(),Q(29,"th"),ge(30,"Estado"),J(),Q(31,"th"),ge(32,"Acciones"),J()()(),Q(33,"tbody"),Jt(34,BW,18,7,"tr",11),J()()(),Q(35,"div",12)(36,"div",13)(37,"div",14)(38,"div",15)(39,"h5",16),ge(40,"Editar Producto"),J()(),Q(41,"div",17)(42,"div",18)(43,"div",19)(44,"div",20)(45,"div",21)(46,"label",22),ge(47,"Nombre:"),J(),Q(48,"input",23),qt("ngModelChange",function(_){return Zt(a.product.name,_)||(a.product.name=_),_}),J()()(),Q(49,"div",24)(50,"div",21)(51,"label",25),ge(52,"Unidad:"),J(),Q(53,"select",26),qt("ngModelChange",function(_){return Zt(a.product.unit,_)||(a.product.unit=_),_}),Q(54,"option",27),ge(55,"Selecciona una unidad"),J(),Q(56,"option",28),ge(57,"Kg"),J(),Q(58,"option",29),ge(59,"Unidad"),J()()()()(),Q(60,"div",19)(61,"div",30)(62,"div",21)(63,"label",31),ge(64,"Categor\xeda:"),J(),Q(65,"input",32),qt("ngModelChange",function(_){return Zt(a.product.category,_)||(a.product.category=_),_}),J()()(),Q(66,"div",33)(67,"div",21)(68,"label",34),ge(69,"SKU:"),J(),Q(70,"input",35),qt("ngModelChange",function(_){return Zt(a.product.sku,_)||(a.product.sku=_),_}),J()()()(),Q(71,"div",19)(72,"div",4)(73,"div",21)(74,"label",36),ge(75,"Precio de Venta:"),J(),Q(76,"input",37),qt("ngModelChange",function(_){return Zt(a.product.price_sale,_)||(a.product.price_sale=_),_}),J()()(),Q(77,"div",4)(78,"div",21)(79,"label",38),ge(80,"Precio de Compra:"),J(),Q(81,"input",39),qt("ngModelChange",function(_){return Zt(a.product.price_purchase,_)||(a.product.price_purchase=_),_}),J()()()(),Q(82,"div",19)(83,"div",4)(84,"div",21)(85,"label",40),ge(86,"Descuento:"),J(),Q(87,"input",41),qt("ngModelChange",function(_){return Zt(a.product.discount,_)||(a.product.discount=_),_}),J()()(),Q(88,"div",4)(89,"div",21)(90,"label",42),ge(91,"Margen:"),J(),Q(92,"input",43),qt("ngModelChange",function(_){return Zt(a.product.margen,_)||(a.product.margen=_),_}),J()()()(),Q(93,"div",19)(94,"div",4)(95,"div",21)(96,"label",44),ge(97,"IVA:"),J(),Q(98,"select",45),qt("ngModelChange",function(_){return Zt(a.product.iva,_)||(a.product.iva=_),_}),Q(99,"option",27),ge(100,"Selecciona una unidad"),J(),Q(101,"option",46),ge(102,"Si"),J(),Q(103,"option",47),ge(104,"No"),J()()()(),Q(105,"div",4)(106,"div",21)(107,"label",48),ge(108,"Valor IVA:"),J(),Q(109,"input",49),qt("ngModelChange",function(_){return Zt(a.product.iva_value,_)||(a.product.iva_value=_),_}),J()()()(),Q(110,"div",21)(111,"label",50),ge(112,"Descripci\xf3n:"),J(),Q(113,"textarea",51),qt("ngModelChange",function(_){return Zt(a.product.description,_)||(a.product.description=_),_}),J()(),Q(114,"div",19)(115,"div",4)(116,"div",21)(117,"label",52),ge(118,"Imagen:"),J(),Q(119,"input",53),qt("ngModelChange",function(_){return Zt(a.product.image,_)||(a.product.image=_),_}),J()(),Q(120,"div",21)(121,"label",54),ge(122,"Estado:"),J(),Q(123,"select",55),qt("ngModelChange",function(_){return Zt(a.product.status,_)||(a.product.status=_),_}),Q(124,"option",56),ge(125,"Activo"),J(),Q(126,"option",57),ge(127,"Inactivo"),J()()()(),Q(128,"div",4)(129,"div",33),un(130,"img",58),J()()()()(),Q(131,"div",59)(132,"button",60),ge(133,"Cerrar"),J(),Jt(134,zW,2,1,"button",61)(135,VW,2,1,"button",61),J()()()()),2&r&&(we(6),Ht("ngModel",a.searchText),we(4),Tt("ngIf",a.successMessage),we(),Tt("ngIf",a.successMessage),we(),Tt("ngIf",a.errorMessage),we(22),Tt("ngForOf",a.filteredProducts),we(14),Ht("ngModel",a.product.name),we(5),Ht("ngModel",a.product.unit),we(12),Ht("ngModel",a.product.category),we(5),Ht("ngModel",a.product.sku),we(6),Ht("ngModel",a.product.price_sale),we(5),Ht("ngModel",a.product.price_purchase),we(6),Ht("ngModel",a.product.discount),we(5),Ht("ngModel",a.product.margen),we(6),Ht("ngModel",a.product.iva),we(11),Ht("ngModel",a.product.iva_value),we(4),Ht("ngModel",a.product.description),we(6),Ht("ngModel",a.product.image),we(4),Ht("ngModel",a.product.status),we(7),Tt("src",a.product.image,Bi),we(4),Tt("ngIf","update"===a.actionTipo),we(),Tt("ngIf","new"===a.actionTipo))},dependencies:[Lf,jc,r1,o1,Os,Yw,Pm,ga,Qs]})}return e})(),hO=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getClientes(){return this.http.get(this.baseUrl+"api/customer/customers")}createCliente(t){return this.http.post(`${this.baseUrl}`,t)}updateCliente(t){return this.http.put(`${this.baseUrl}/${t._id}`,t)}deleteCliente(t){return this.http.delete(`${this.baseUrl}/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)($t(zf))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function jW(e,n){if(1&e){const t=$i();Q(0,"tr")(1,"td"),ge(2),J(),Q(3,"td"),ge(4),J(),Q(5,"td"),ge(6),J(),Q(7,"td"),ge(8),J(),Q(9,"td"),ge(10),J(),Q(11,"td"),ge(12),J(),Q(13,"td"),ge(14),J(),Q(15,"td"),ge(16),J(),Q(17,"td")(18,"div",40)(19,"div",3)(20,"button",41),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().edit_customer(a))}),un(21,"i",42),J()(),Q(22,"div",3)(23,"button",43),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().delete_customer(a))}),un(24,"i",44),J()()()()()}if(2&e){const t=n.$implicit;we(2),Qt(t.name),we(2),Qt(t.phone),we(2),Qt(t.document),we(2),Qt(t.document_type),we(2),Qt(t.address),we(2),Qt(t.restaurant_name),we(2),Qt(t.email),we(2),Qt(t.category)}}let $W=(()=>{class e{constructor(t){this.clientesService=t,this.customers=[],this.filteredCustomers=[],this.searchText="",this.selectedCustomer={},this.isNewCustomer=!0}ngOnInit(){this.getClientes()}getClientes(){this.clientesService.getClientes().subscribe(t=>{this.customers=t,this.filteredCustomers=this.customers},t=>{console.error("Error al obtener clientes:",t)})}filterCustomers(){this.filteredCustomers=this.customers.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())||t.phone.toLowerCase().includes(this.searchText.toLowerCase())||t.document.toLowerCase().includes(this.searchText.toLowerCase())||t.email.toLowerCase().includes(this.searchText.toLowerCase())||t.restaurant_name.toLowerCase().includes(this.searchText.toLowerCase())||t.status.toLowerCase().includes(this.searchText.toLowerCase())||t.category.toLowerCase().includes(this.searchText.toLowerCase()))}openEditModal(t,r){this.isNewCustomer="new"===r,this.selectedCustomer="new"===r?{}:{...t}}edit_customer(t){this.openEditModal(t,"edit")}saveCustomer(){}delete_customer(t){confirm("\xbfEst\xe1 seguro de que desea eliminar este cliente?")&&this.clientesService.deleteCliente(t._id).subscribe(()=>{this.customers=this.customers.filter(r=>r._id!==t._id),this.filterCustomers()},r=>{console.error("Error al eliminar cliente:",r)})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(hO))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-clientes"]],decls:84,vars:12,consts:[["customerForm","ngForm"],[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"col-10"],["type","text","placeholder","Buscar cliente...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"row"],[1,"container-fluid"],[1,"table"],[4,"ngFor","ngForOf"],["id","customerModal","tabindex","-1","aria-labelledby","customerModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","customerModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","phone",1,"form-label"],["type","text","id","phone","name","phone","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","document",1,"form-label"],["type","text","id","document","name","document","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","documentType",1,"form-label"],["type","text","id","documentType","name","documentType","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","address",1,"form-label"],["type","text","id","address","name","address",1,"form-control",3,"ngModelChange","ngModel"],["for","restaurantName",1,"form-label"],["type","text","id","restaurantName","name","restaurantName",1,"form-control",3,"ngModelChange","ngModel"],["for","email",1,"form-label"],["type","email","id","email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","status",1,"form-label"],["type","text","id","status","name","status",1,"form-control",3,"ngModelChange","ngModel"],["for","category",1,"form-label"],["type","text","id","category","name","category",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","justify-content-center"],["title","Edit",1,"btn","btn-primary",3,"click"],[1,"fa","fa-pencil"],["title","Delete",1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash"]],template:function(r,a){if(1&r){const f=$i();Q(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),At("click",function(){return Xt(f),Kt(a.openEditModal({},"new"))}),ge(4,"Nueva Cliente"),J()(),Q(5,"div",5)(6,"input",6),qt("ngModelChange",function(T){return Xt(f),Zt(a.searchText,T)||(a.searchText=T),Kt(T)}),At("keyup",function(){return Xt(f),Kt(a.filterCustomers())}),J()(),un(7,"br"),Q(8,"div",7)(9,"div",8)(10,"table",9)(11,"thead")(12,"tr")(13,"th"),ge(14,"Nombre"),J(),Q(15,"th"),ge(16,"Tel\xe9fono"),J(),Q(17,"th"),ge(18,"Documento"),J(),Q(19,"th"),ge(20,"Tipo de Documento"),J(),Q(21,"th"),ge(22,"Direcci\xf3n"),J(),Q(23,"th"),ge(24,"Nombre del Restaurante"),J(),Q(25,"th"),ge(26,"Email"),J(),Q(27,"th"),ge(28,"Categor\xeda"),J(),Q(29,"th"),ge(30,"Acciones"),J()()(),Q(31,"tbody"),Jt(32,jW,25,8,"tr",10),J()()()()()(),Q(33,"div",11)(34,"div",12)(35,"div",13)(36,"div",14)(37,"h5",15),ge(38),J(),un(39,"button",16),J(),Q(40,"div",17)(41,"form",null,0)(43,"div",18)(44,"label",19),ge(45,"Nombre"),J(),Q(46,"input",20),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.name,T)||(a.selectedCustomer.name=T),Kt(T)}),J()(),Q(47,"div",18)(48,"label",21),ge(49,"Tel\xe9fono"),J(),Q(50,"input",22),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.phone,T)||(a.selectedCustomer.phone=T),Kt(T)}),J()(),Q(51,"div",18)(52,"label",23),ge(53,"Documento"),J(),Q(54,"input",24),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.document,T)||(a.selectedCustomer.document=T),Kt(T)}),J()(),Q(55,"div",18)(56,"label",25),ge(57,"Tipo de Documento"),J(),Q(58,"input",26),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.document_type,T)||(a.selectedCustomer.document_type=T),Kt(T)}),J()(),Q(59,"div",18)(60,"label",27),ge(61,"Direcci\xf3n"),J(),Q(62,"input",28),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.address,T)||(a.selectedCustomer.address=T),Kt(T)}),J()(),Q(63,"div",18)(64,"label",29),ge(65,"Nombre del Restaurante"),J(),Q(66,"input",30),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.restaurant_name,T)||(a.selectedCustomer.restaurant_name=T),Kt(T)}),J()(),Q(67,"div",18)(68,"label",31),ge(69,"Email"),J(),Q(70,"input",32),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.email,T)||(a.selectedCustomer.email=T),Kt(T)}),J()(),Q(71,"div",18)(72,"label",33),ge(73,"Estado"),J(),Q(74,"input",34),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.status,T)||(a.selectedCustomer.status=T),Kt(T)}),J()(),Q(75,"div",18)(76,"label",35),ge(77,"Categor\xeda"),J(),Q(78,"input",36),qt("ngModelChange",function(T){return Xt(f),Zt(a.selectedCustomer.category,T)||(a.selectedCustomer.category=T),Kt(T)}),J()()()(),Q(79,"div",37)(80,"button",38),ge(81,"Cancelar"),J(),Q(82,"button",39),At("click",function(){return Xt(f),Kt(a.saveCustomer())}),ge(83,"Guardar"),J()()()()()}2&r&&(we(6),Ht("ngModel",a.searchText),we(26),Tt("ngForOf",a.filteredCustomers),we(6),Qt(a.isNewCustomer?"Nuevo Cliente":"Editar Cliente"),we(8),Ht("ngModel",a.selectedCustomer.name),we(4),Ht("ngModel",a.selectedCustomer.phone),we(4),Ht("ngModel",a.selectedCustomer.document),we(4),Ht("ngModel",a.selectedCustomer.document_type),we(4),Ht("ngModel",a.selectedCustomer.address),we(4),Ht("ngModel",a.selectedCustomer.restaurant_name),we(4),Ht("ngModel",a.selectedCustomer.email),we(4),Ht("ngModel",a.selectedCustomer.status),we(4),Ht("ngModel",a.selectedCustomer.category))},dependencies:[Lf,OS,Os,ga,wS,s1,Qs,i1]})}return e})(),$B=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getOrders(t){return this.http.get(this.baseUrl+"api/order/orders/"+t)}updateOrder(t,r){return this.http.post(this.baseUrl+"api/order/order/"+t,r)}createOrder(t){return this.http.post(this.baseUrl+"api/order/order",t)}getConfig(){return this.http.get(this.baseUrl+"api/config/configOrder")}deleteOrder(t){return this.http.delete(this.baseUrl+"api/order/order/"+t)}getLastOrdersByCustomerId(t){return this.http.get(this.baseUrl+"api/order/orders_latest_customer/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)($t(zf))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),GW=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}send_invoice(t){return this.http.get(this.baseUrl+"api/alegra/send_invoice/"+t)}get_invoice(t){const a=new La({Accept:"application/json","Content-Type":"application/json",Authorization:"Basic dm1kaWFnb3ZAZ21haWwuY29tOjBmZmQ1YzdiM2NiMWI5OWVjNDA0","X-Authorization":"tu-valor",Origin:"tu-origen","X-Requested-With":"XMLHttpRequest","X-HTTP-Method-Override":"POST","X-Data-Source":"tu-data-source","X-Experiment-Onb-Variant":"tu-variant","X-Experiment-Onb-Id":"tu-id","X-Request-Origin-Project":"tu-proyecto","X-School-Name":"tu-school-name","X-Regime-Name":"tu-regime-name","X-Sat-Register":"tu-sat-register"});return this.http.post("https://api.alegra.com/api/v1/invoices/215/open",{headers:a})}static#e=this.\u0275fac=function(r){return new(r||e)($t(zf))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class HW extends Rt{constructor(n,t){super()}schedule(n,t=0){return this}}const PS={setInterval(e,n,...t){const{delegate:r}=PS;return r?.setInterval?r.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=PS;return(n?.clearInterval||clearInterval)(e)},delegate:void 0};class fO extends HW{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var r;if(this.closed)return this;this.state=n;const a=this.id,f=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(f,a,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(f,this.id,t),this}requestAsyncId(n,t,r=0){return PS.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&PS.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(n,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let a,r=!1;try{this.work(n)}catch(f){r=!0,a=f||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),a}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Ft(r,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}const GB={now:()=>(GB.delegate||Date).now(),delegate:void 0};class Xw{constructor(n,t=Xw.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,r){return new this.schedulerActionCtor(this,n).schedule(r,t)}}Xw.now=GB.now;class pO extends Xw{constructor(n,t=Xw.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let r;this._active=!0;do{if(r=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,r){for(;n=t.shift();)n.unsubscribe();throw r}}}const RS=new pO(fO),qW=RS;function mO(e=0,n,t=qW){let r=-1;return null!=n&&(WF(n)?t=n:r=n),new Fi(a=>{let f=function ZW(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;f<0&&(f=0);let _=0;return t.schedule(function(){a.closed||(a.next(_++),0<=r?this.schedule(void 0,r):a.complete())},f)})}const Kw={schedule(e){let n=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:r}=Kw;r&&(n=r.requestAnimationFrame,t=r.cancelAnimationFrame);const a=n(f=>{t=void 0,e(f)});return new Rt(()=>t?.(a))},requestAnimationFrame(...e){const{delegate:n}=Kw;return(n?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:n}=Kw;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0},QW=new class JW extends pO{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:r}=this;let a;n=n||r.shift();do{if(a=n.execute(n.state,n.delay))break}while((n=r[0])&&n.id===t&&r.shift());if(this._active=!1,a){for(;(n=r[0])&&n.id===t&&r.shift();)n.unsubscribe();throw a}}}(class KW extends fO{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,r=0){return null!==r&&r>0?super.requestAsyncId(n,t,r):(n.actions.push(this),n._scheduled||(n._scheduled=Kw.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,t,r=0){var a;if(null!=r?r>0:this.delay>0)return super.recycleAsyncId(n,t,r);const{actions:f}=n;null!=t&&(null===(a=f[f.length-1])||void 0===a?void 0:a.id)!==t&&(Kw.cancelAnimationFrame(t),n._scheduled=void 0)}});let gO,eZ=1;const NS={};function HB(e){return e in NS&&(delete NS[e],!0)}const tZ={setImmediate(e){const n=eZ++;return NS[n]=!0,gO||(gO=Promise.resolve()),gO.then(()=>HB(n)&&e()),n},clearImmediate(e){HB(e)}},{setImmediate:nZ,clearImmediate:iZ}=tZ,kS={setImmediate(...e){const{delegate:n}=kS;return(n?.setImmediate||nZ)(...e)},clearImmediate(e){const{delegate:n}=kS;return(n?.clearImmediate||iZ)(e)},delegate:void 0},sZ=new class oZ extends pO{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:r}=this;let a;n=n||r.shift();do{if(a=n.execute(n.state,n.delay))break}while((n=r[0])&&n.id===t&&r.shift());if(this._active=!1,a){for(;(n=r[0])&&n.id===t&&r.shift();)n.unsubscribe();throw a}}}(class rZ extends fO{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,r=0){return null!==r&&r>0?super.requestAsyncId(n,t,r):(n.actions.push(this),n._scheduled||(n._scheduled=kS.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,t,r=0){var a;if(null!=r?r>0:this.delay>0)return super.recycleAsyncId(n,t,r);const{actions:f}=n;null!=t&&(null===(a=f[f.length-1])||void 0===a?void 0:a.id)!==t&&(kS.clearImmediate(t),n._scheduled===t&&(n._scheduled=void 0))}}),aZ=["addListener","removeListener"],lZ=["addEventListener","removeEventListener"],cZ=["on","off"];function Co(e,n,t,r){if(Pt(t)&&(r=t,t=void 0),r)return Co(e,n,t).pipe(mA(r));const[a,f]=function hZ(e){return Pt(e.addEventListener)&&Pt(e.removeEventListener)}(e)?lZ.map(_=>T=>e[_](n,T,t)):function uZ(e){return Pt(e.addListener)&&Pt(e.removeListener)}(e)?aZ.map(qB(e,n)):function dZ(e){return Pt(e.on)&&Pt(e.off)}(e)?cZ.map(qB(e,n)):[];if(!a&&cA(e))return Is(_=>Co(_,n,t))(Ms(e));if(!a)throw new TypeError("Invalid event target");return new Fi(_=>{const T=(...D)=>_.next(1<D.length?D:D[0]);return a(T),()=>f(T)})}function qB(e,n){return t=>r=>e[t](n,r)}function FS(...e){const n=Dw(e),t=function zG(e,n){return"number"==typeof rA(e)?e.pop():n}(e,1/0),r=e;return r.length?1===r.length?Ms(r[0]):$v(t)(Vo(r,n)):Ll}const fZ=["content"],pZ=["scroll"],mZ=["padding"],WB=["*"],Jw=e=>({searchTerm:e});function gZ(e,n){if(1&e&&(Q(0,"div",3),rD(1,6),J()),2&e){const t=gt();we(),Tt("ngTemplateOutlet",t.headerTemplate)("ngTemplateOutletContext",Lc(2,Jw,t.filterValue))}}function _Z(e,n){if(1&e&&(Q(0,"div",5),rD(1,6),J()),2&e){const t=gt();we(),Tt("ngTemplateOutlet",t.footerTemplate)("ngTemplateOutletContext",Lc(2,Jw,t.filterValue))}}const yZ=["searchInput"],vZ=["clearButton"],bZ=(e,n,t)=>({item:e,clear:n,label:t}),xZ=(e,n)=>({items:e,clear:n}),wZ=(e,n,t,r)=>({item:e,item$:n,index:t,searchTerm:r});function CZ(e,n){if(1&e){const t=$i();Q(0,"span",21),At("click",function(){Xt(t);const a=gt().$implicit;return Kt(gt(2).unselect(a))}),ge(1,"\xd7"),J(),un(2,"span",22)}if(2&e){const t=gt().$implicit,r=gt(2);we(2),Tt("ngItemLabel",t.label)("escape",r.escapeHTML)}}function TZ(e,n){}function EZ(e,n){if(1&e&&(Q(0,"div",20),Jt(1,CZ,3,2,"ng-template",null,1,Ss)(3,TZ,0,0,"ng-template",12),J()),2&e){const t=n.$implicit,r=as(2),a=gt(2);ji("ng-value-disabled",t.disabled),we(3),Tt("ngTemplateOutlet",a.labelTemplate||r)("ngTemplateOutletContext",fD(4,bZ,t.value,a.clearItem,t.label))}}function DZ(e,n){1&e&&Nc(0,EZ,4,8,"div",19,qI().trackByOption,!0),2&e&&kc(gt().selectedItems)}function SZ(e,n){}function MZ(e,n){if(1&e&&Jt(0,SZ,0,0,"ng-template",12),2&e){const t=gt();Tt("ngTemplateOutlet",t.multiLabelTemplate)("ngTemplateOutletContext",function sw(e,n,t,r,a){return SN(mt(),vo(),e,n,t,r,a)}(2,xZ,t.selectedValues,t.clearItem))}}function IZ(e,n){1&e&&un(0,"div",24)}function AZ(e,n){}function OZ(e,n){if(1&e&&Jt(0,IZ,1,0,"ng-template",null,2,Ss)(2,AZ,0,0,"ng-template",23),2&e){const t=as(1),r=gt();we(2),Tt("ngTemplateOutlet",r.loadingSpinnerTemplate||t)}}function PZ(e,n){1&e&&(Q(0,"span",15,3)(2,"span",25),ge(3,"\xd7"),J()()),2&e&&uD("title",gt().clearAllText)}function RZ(e,n){if(1&e&&un(0,"span",30),2&e){const t=gt().$implicit,r=gt(2);Tt("ngItemLabel",t.label)("escape",r.escapeHTML)}}function NZ(e,n){}function kZ(e,n){if(1&e){const t=$i();Q(0,"div",29),At("click",function(){const a=Xt(t).$implicit;return Kt(gt(2).toggleItem(a))})("mouseover",function(){const a=Xt(t).$implicit;return Kt(gt(2).onItemHover(a))}),Jt(1,RZ,1,2,"ng-template",null,4,Ss)(3,NZ,0,0,"ng-template",12),J()}if(2&e){const t=n.$implicit,r=as(2),a=gt(2);ji("ng-option-disabled",t.disabled)("ng-option-selected",t.selected)("ng-optgroup",t.children)("ng-option",!t.children)("ng-option-child",!!t.parent)("ng-option-marked",t===a.itemsList.markedItem),Qi("role",t.children?"group":"option")("aria-selected",t.selected)("id",null==t?null:t.htmlId),we(3),Tt("ngTemplateOutlet",t.children?a.optgroupTemplate||r:a.optionTemplate||r)("ngTemplateOutletContext",EN(17,wZ,t.value,t,t.index,a.searchTerm))}}function FZ(e,n){if(1&e&&(Q(0,"span")(1,"span",32),ge(2),J(),ge(3),J()),2&e){const t=gt(3);we(2),Qt(t.addTagText),we(),ol('"',t.searchTerm,'"')}}function LZ(e,n){}function BZ(e,n){if(1&e){const t=$i();Q(0,"div",31),At("mouseover",function(){return Xt(t),Kt(gt(2).itemsList.unmarkItem())})("click",function(){return Xt(t),Kt(gt(2).selectTag())}),Jt(1,FZ,4,2,"ng-template",null,5,Ss)(3,LZ,0,0,"ng-template",12),J()}if(2&e){const t=as(2),r=gt(2);ji("ng-option-marked",!r.itemsList.markedItem),we(3),Tt("ngTemplateOutlet",r.tagTemplate||t)("ngTemplateOutletContext",Lc(4,Jw,r.searchTerm))}}function zZ(e,n){if(1&e&&(Q(0,"div",33),ge(1),J()),2&e){const t=gt(3);we(),Qt(t.notFoundText)}}function VZ(e,n){}function UZ(e,n){if(1&e&&Jt(0,zZ,2,1,"ng-template",null,6,Ss)(2,VZ,0,0,"ng-template",12),2&e){const t=as(1),r=gt(2);we(2),Tt("ngTemplateOutlet",r.notFoundTemplate||t)("ngTemplateOutletContext",Lc(2,Jw,r.searchTerm))}}function jZ(e,n){if(1&e&&(Q(0,"div",33),ge(1),J()),2&e){const t=gt(3);we(),Qt(t.typeToSearchText)}}function $Z(e,n){}function GZ(e,n){if(1&e&&Jt(0,jZ,2,1,"ng-template",null,7,Ss)(2,$Z,0,0,"ng-template",23),2&e){const t=as(1),r=gt(2);we(2),Tt("ngTemplateOutlet",r.typeToSearchTemplate||t)}}function HZ(e,n){if(1&e&&(Q(0,"div",33),ge(1),J()),2&e){const t=gt(3);we(),Qt(t.loadingText)}}function qZ(e,n){}function WZ(e,n){if(1&e&&Jt(0,HZ,2,1,"ng-template",null,8,Ss)(2,qZ,0,0,"ng-template",12),2&e){const t=as(1),r=gt(2);we(2),Tt("ngTemplateOutlet",r.loadingTextTemplate||t)("ngTemplateOutletContext",Lc(2,Jw,r.searchTerm))}}function ZZ(e,n){if(1&e){const t=$i();Q(0,"ng-dropdown-panel",26),At("update",function(a){return Xt(t),Kt(gt().viewPortItems=a)})("scroll",function(a){return Xt(t),Kt(gt().scroll.emit(a))})("scrollToEnd",function(a){return Xt(t),Kt(gt().scrollToEnd.emit(a))})("outsideClick",function(){return Xt(t),Kt(gt().close())}),nD(1),Nc(2,kZ,4,22,"div",27,qI().trackByOption,!0),Jt(4,BZ,4,6,"div",28),iD(),Jt(5,UZ,3,4)(6,GZ,3,1)(7,WZ,3,4),J()}if(2&e){const t=gt();ji("ng-select-multiple",t.multiple),Tt("virtualScroll",t.virtualScroll)("bufferAmount",t.bufferAmount)("appendTo",t.appendTo)("position",t.dropdownPosition)("headerTemplate",t.headerTemplate)("footerTemplate",t.footerTemplate)("filterValue",t.searchTerm)("items",t.itemsList.filteredItems)("markedItem",t.itemsList.markedItem)("ngClass",t.appendTo?t.classes:null)("id",t.dropdownId),we(2),kc(t.viewPortItems),we(2),ur(t.showAddTag?4:-1),we(),ur(t.showNoItemsFound()?5:-1),we(),ur(t.showTypeToSearch()?6:-1),we(),ur(t.loading&&0===t.itemsList.filteredItems.length?7:-1)}}const ZB=/[&<>"']/g,YZ=RegExp(ZB.source),XZ={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Jr(e){return null!=e}function Qw(e){return"object"==typeof e&&Jr(e)}function LS(e){return e instanceof Function}let QZ=(()=>{class e{constructor(t){this.element=t,this.escape=!0}ngOnChanges(t){this.element.nativeElement.innerHTML=this.escape?function KZ(e){return e&&YZ.test(e)?e.replace(ZB,n=>XZ[n]):e}(this.ngItemLabel):this.ngItemLabel}static#e=this.\u0275fac=function(r){return new(r||e)(tt(wi))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ngItemLabel",""]],inputs:{ngItemLabel:"ngItemLabel",escape:"escape"},features:[kr]})}return e})(),eY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-option-tmp",""]]})}return e})(),tY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-optgroup-tmp",""]]})}return e})(),nY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-label-tmp",""]]})}return e})(),iY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-multi-label-tmp",""]]})}return e})(),rY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-header-tmp",""]]})}return e})(),oY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-footer-tmp",""]]})}return e})(),sY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-notfound-tmp",""]]})}return e})(),aY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-typetosearch-tmp",""]]})}return e})(),lY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-loadingtext-tmp",""]]})}return e})(),cY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-tag-tmp",""]]})}return e})(),uY=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(li))};static#t=this.\u0275dir=Lt({type:e,selectors:[["","ng-loadingspinner-tmp",""]]})}return e})();function YB(){return"axxxxxxxxxxx".replace(/[x]/g,()=>(16*Math.random()|0).toString(16))}const dY={"\u24b6":"A",\uff21:"A",\u00c0:"A",\u00c1:"A",\u00c2:"A",\u1ea6:"A",\u1ea4:"A",\u1eaa:"A",\u1ea8:"A",\u00c3:"A",\u0100:"A",\u0102:"A",\u1eb0:"A",\u1eae:"A",\u1eb4:"A",\u1eb2:"A",\u0226:"A",\u01e0:"A",\u00c4:"A",\u01de:"A",\u1ea2:"A",\u00c5:"A",\u01fa:"A",\u01cd:"A",\u0200:"A",\u0202:"A",\u1ea0:"A",\u1eac:"A",\u1eb6:"A",\u1e00:"A",\u0104:"A",\u023a:"A",\u2c6f:"A",\ua732:"AA",\u00c6:"AE",\u01fc:"AE",\u01e2:"AE",\ua734:"AO",\ua736:"AU",\ua738:"AV",\ua73a:"AV",\ua73c:"AY","\u24b7":"B",\uff22:"B",\u1e02:"B",\u1e04:"B",\u1e06:"B",\u0243:"B",\u0182:"B",\u0181:"B","\u24b8":"C",\uff23:"C",\u0106:"C",\u0108:"C",\u010a:"C",\u010c:"C",\u00c7:"C",\u1e08:"C",\u0187:"C",\u023b:"C",\ua73e:"C","\u24b9":"D",\uff24:"D",\u1e0a:"D",\u010e:"D",\u1e0c:"D",\u1e10:"D",\u1e12:"D",\u1e0e:"D",\u0110:"D",\u018b:"D",\u018a:"D",\u0189:"D",\ua779:"D",\u01f1:"DZ",\u01c4:"DZ",\u01f2:"Dz",\u01c5:"Dz","\u24ba":"E",\uff25:"E",\u00c8:"E",\u00c9:"E",\u00ca:"E",\u1ec0:"E",\u1ebe:"E",\u1ec4:"E",\u1ec2:"E",\u1ebc:"E",\u0112:"E",\u1e14:"E",\u1e16:"E",\u0114:"E",\u0116:"E",\u00cb:"E",\u1eba:"E",\u011a:"E",\u0204:"E",\u0206:"E",\u1eb8:"E",\u1ec6:"E",\u0228:"E",\u1e1c:"E",\u0118:"E",\u1e18:"E",\u1e1a:"E",\u0190:"E",\u018e:"E","\u24bb":"F",\uff26:"F",\u1e1e:"F",\u0191:"F",\ua77b:"F","\u24bc":"G",\uff27:"G",\u01f4:"G",\u011c:"G",\u1e20:"G",\u011e:"G",\u0120:"G",\u01e6:"G",\u0122:"G",\u01e4:"G",\u0193:"G",\ua7a0:"G",\ua77d:"G",\ua77e:"G","\u24bd":"H",\uff28:"H",\u0124:"H",\u1e22:"H",\u1e26:"H",\u021e:"H",\u1e24:"H",\u1e28:"H",\u1e2a:"H",\u0126:"H",\u2c67:"H",\u2c75:"H",\ua78d:"H","\u24be":"I",\uff29:"I",\u00cc:"I",\u00cd:"I",\u00ce:"I",\u0128:"I",\u012a:"I",\u012c:"I",\u0130:"I",\u00cf:"I",\u1e2e:"I",\u1ec8:"I",\u01cf:"I",\u0208:"I",\u020a:"I",\u1eca:"I",\u012e:"I",\u1e2c:"I",\u0197:"I","\u24bf":"J",\uff2a:"J",\u0134:"J",\u0248:"J","\u24c0":"K",\uff2b:"K",\u1e30:"K",\u01e8:"K",\u1e32:"K",\u0136:"K",\u1e34:"K",\u0198:"K",\u2c69:"K",\ua740:"K",\ua742:"K",\ua744:"K",\ua7a2:"K","\u24c1":"L",\uff2c:"L",\u013f:"L",\u0139:"L",\u013d:"L",\u1e36:"L",\u1e38:"L",\u013b:"L",\u1e3c:"L",\u1e3a:"L",\u0141:"L",\u023d:"L",\u2c62:"L",\u2c60:"L",\ua748:"L",\ua746:"L",\ua780:"L",\u01c7:"LJ",\u01c8:"Lj","\u24c2":"M",\uff2d:"M",\u1e3e:"M",\u1e40:"M",\u1e42:"M",\u2c6e:"M",\u019c:"M","\u24c3":"N",\uff2e:"N",\u01f8:"N",\u0143:"N",\u00d1:"N",\u1e44:"N",\u0147:"N",\u1e46:"N",\u0145:"N",\u1e4a:"N",\u1e48:"N",\u0220:"N",\u019d:"N",\ua790:"N",\ua7a4:"N",\u01ca:"NJ",\u01cb:"Nj","\u24c4":"O",\uff2f:"O",\u00d2:"O",\u00d3:"O",\u00d4:"O",\u1ed2:"O",\u1ed0:"O",\u1ed6:"O",\u1ed4:"O",\u00d5:"O",\u1e4c:"O",\u022c:"O",\u1e4e:"O",\u014c:"O",\u1e50:"O",\u1e52:"O",\u014e:"O",\u022e:"O",\u0230:"O",\u00d6:"O",\u022a:"O",\u1ece:"O",\u0150:"O",\u01d1:"O",\u020c:"O",\u020e:"O",\u01a0:"O",\u1edc:"O",\u1eda:"O",\u1ee0:"O",\u1ede:"O",\u1ee2:"O",\u1ecc:"O",\u1ed8:"O",\u01ea:"O",\u01ec:"O",\u00d8:"O",\u01fe:"O",\u0186:"O",\u019f:"O",\ua74a:"O",\ua74c:"O",\u01a2:"OI",\ua74e:"OO",\u0222:"OU","\u24c5":"P",\uff30:"P",\u1e54:"P",\u1e56:"P",\u01a4:"P",\u2c63:"P",\ua750:"P",\ua752:"P",\ua754:"P","\u24c6":"Q",\uff31:"Q",\ua756:"Q",\ua758:"Q",\u024a:"Q","\u24c7":"R",\uff32:"R",\u0154:"R",\u1e58:"R",\u0158:"R",\u0210:"R",\u0212:"R",\u1e5a:"R",\u1e5c:"R",\u0156:"R",\u1e5e:"R",\u024c:"R",\u2c64:"R",\ua75a:"R",\ua7a6:"R",\ua782:"R","\u24c8":"S",\uff33:"S",\u1e9e:"S",\u015a:"S",\u1e64:"S",\u015c:"S",\u1e60:"S",\u0160:"S",\u1e66:"S",\u1e62:"S",\u1e68:"S",\u0218:"S",\u015e:"S",\u2c7e:"S",\ua7a8:"S",\ua784:"S","\u24c9":"T",\uff34:"T",\u1e6a:"T",\u0164:"T",\u1e6c:"T",\u021a:"T",\u0162:"T",\u1e70:"T",\u1e6e:"T",\u0166:"T",\u01ac:"T",\u01ae:"T",\u023e:"T",\ua786:"T",\ua728:"TZ","\u24ca":"U",\uff35:"U",\u00d9:"U",\u00da:"U",\u00db:"U",\u0168:"U",\u1e78:"U",\u016a:"U",\u1e7a:"U",\u016c:"U",\u00dc:"U",\u01db:"U",\u01d7:"U",\u01d5:"U",\u01d9:"U",\u1ee6:"U",\u016e:"U",\u0170:"U",\u01d3:"U",\u0214:"U",\u0216:"U",\u01af:"U",\u1eea:"U",\u1ee8:"U",\u1eee:"U",\u1eec:"U",\u1ef0:"U",\u1ee4:"U",\u1e72:"U",\u0172:"U",\u1e76:"U",\u1e74:"U",\u0244:"U","\u24cb":"V",\uff36:"V",\u1e7c:"V",\u1e7e:"V",\u01b2:"V",\ua75e:"V",\u0245:"V",\ua760:"VY","\u24cc":"W",\uff37:"W",\u1e80:"W",\u1e82:"W",\u0174:"W",\u1e86:"W",\u1e84:"W",\u1e88:"W",\u2c72:"W","\u24cd":"X",\uff38:"X",\u1e8a:"X",\u1e8c:"X","\u24ce":"Y",\uff39:"Y",\u1ef2:"Y",\u00dd:"Y",\u0176:"Y",\u1ef8:"Y",\u0232:"Y",\u1e8e:"Y",\u0178:"Y",\u1ef6:"Y",\u1ef4:"Y",\u01b3:"Y",\u024e:"Y",\u1efe:"Y","\u24cf":"Z",\uff3a:"Z",\u0179:"Z",\u1e90:"Z",\u017b:"Z",\u017d:"Z",\u1e92:"Z",\u1e94:"Z",\u01b5:"Z",\u0224:"Z",\u2c7f:"Z",\u2c6b:"Z",\ua762:"Z","\u24d0":"a",\uff41:"a",\u1e9a:"a",\u00e0:"a",\u00e1:"a",\u00e2:"a",\u1ea7:"a",\u1ea5:"a",\u1eab:"a",\u1ea9:"a",\u00e3:"a",\u0101:"a",\u0103:"a",\u1eb1:"a",\u1eaf:"a",\u1eb5:"a",\u1eb3:"a",\u0227:"a",\u01e1:"a",\u00e4:"a",\u01df:"a",\u1ea3:"a",\u00e5:"a",\u01fb:"a",\u01ce:"a",\u0201:"a",\u0203:"a",\u1ea1:"a",\u1ead:"a",\u1eb7:"a",\u1e01:"a",\u0105:"a",\u2c65:"a",\u0250:"a",\ua733:"aa",\u00e6:"ae",\u01fd:"ae",\u01e3:"ae",\ua735:"ao",\ua737:"au",\ua739:"av",\ua73b:"av",\ua73d:"ay","\u24d1":"b",\uff42:"b",\u1e03:"b",\u1e05:"b",\u1e07:"b",\u0180:"b",\u0183:"b",\u0253:"b","\u24d2":"c",\uff43:"c",\u0107:"c",\u0109:"c",\u010b:"c",\u010d:"c",\u00e7:"c",\u1e09:"c",\u0188:"c",\u023c:"c",\ua73f:"c",\u2184:"c","\u24d3":"d",\uff44:"d",\u1e0b:"d",\u010f:"d",\u1e0d:"d",\u1e11:"d",\u1e13:"d",\u1e0f:"d",\u0111:"d",\u018c:"d",\u0256:"d",\u0257:"d",\ua77a:"d",\u01f3:"dz",\u01c6:"dz","\u24d4":"e",\uff45:"e",\u00e8:"e",\u00e9:"e",\u00ea:"e",\u1ec1:"e",\u1ebf:"e",\u1ec5:"e",\u1ec3:"e",\u1ebd:"e",\u0113:"e",\u1e15:"e",\u1e17:"e",\u0115:"e",\u0117:"e",\u00eb:"e",\u1ebb:"e",\u011b:"e",\u0205:"e",\u0207:"e",\u1eb9:"e",\u1ec7:"e",\u0229:"e",\u1e1d:"e",\u0119:"e",\u1e19:"e",\u1e1b:"e",\u0247:"e",\u025b:"e",\u01dd:"e","\u24d5":"f",\uff46:"f",\u1e1f:"f",\u0192:"f",\ua77c:"f","\u24d6":"g",\uff47:"g",\u01f5:"g",\u011d:"g",\u1e21:"g",\u011f:"g",\u0121:"g",\u01e7:"g",\u0123:"g",\u01e5:"g",\u0260:"g",\ua7a1:"g",\u1d79:"g",\ua77f:"g","\u24d7":"h",\uff48:"h",\u0125:"h",\u1e23:"h",\u1e27:"h",\u021f:"h",\u1e25:"h",\u1e29:"h",\u1e2b:"h",\u1e96:"h",\u0127:"h",\u2c68:"h",\u2c76:"h",\u0265:"h",\u0195:"hv","\u24d8":"i",\uff49:"i",\u00ec:"i",\u00ed:"i",\u00ee:"i",\u0129:"i",\u012b:"i",\u012d:"i",\u00ef:"i",\u1e2f:"i",\u1ec9:"i",\u01d0:"i",\u0209:"i",\u020b:"i",\u1ecb:"i",\u012f:"i",\u1e2d:"i",\u0268:"i",\u0131:"i","\u24d9":"j",\uff4a:"j",\u0135:"j",\u01f0:"j",\u0249:"j","\u24da":"k",\uff4b:"k",\u1e31:"k",\u01e9:"k",\u1e33:"k",\u0137:"k",\u1e35:"k",\u0199:"k",\u2c6a:"k",\ua741:"k",\ua743:"k",\ua745:"k",\ua7a3:"k","\u24db":"l",\uff4c:"l",\u0140:"l",\u013a:"l",\u013e:"l",\u1e37:"l",\u1e39:"l",\u013c:"l",\u1e3d:"l",\u1e3b:"l",\u017f:"l",\u0142:"l",\u019a:"l",\u026b:"l",\u2c61:"l",\ua749:"l",\ua781:"l",\ua747:"l",\u01c9:"lj","\u24dc":"m",\uff4d:"m",\u1e3f:"m",\u1e41:"m",\u1e43:"m",\u0271:"m",\u026f:"m","\u24dd":"n",\uff4e:"n",\u01f9:"n",\u0144:"n",\u00f1:"n",\u1e45:"n",\u0148:"n",\u1e47:"n",\u0146:"n",\u1e4b:"n",\u1e49:"n",\u019e:"n",\u0272:"n",\u0149:"n",\ua791:"n",\ua7a5:"n",\u01cc:"nj","\u24de":"o",\uff4f:"o",\u00f2:"o",\u00f3:"o",\u00f4:"o",\u1ed3:"o",\u1ed1:"o",\u1ed7:"o",\u1ed5:"o",\u00f5:"o",\u1e4d:"o",\u022d:"o",\u1e4f:"o",\u014d:"o",\u1e51:"o",\u1e53:"o",\u014f:"o",\u022f:"o",\u0231:"o",\u00f6:"o",\u022b:"o",\u1ecf:"o",\u0151:"o",\u01d2:"o",\u020d:"o",\u020f:"o",\u01a1:"o",\u1edd:"o",\u1edb:"o",\u1ee1:"o",\u1edf:"o",\u1ee3:"o",\u1ecd:"o",\u1ed9:"o",\u01eb:"o",\u01ed:"o",\u00f8:"o",\u01ff:"o",\u0254:"o",\ua74b:"o",\ua74d:"o",\u0275:"o",\u01a3:"oi",\u0223:"ou",\ua74f:"oo","\u24df":"p",\uff50:"p",\u1e55:"p",\u1e57:"p",\u01a5:"p",\u1d7d:"p",\ua751:"p",\ua753:"p",\ua755:"p","\u24e0":"q",\uff51:"q",\u024b:"q",\ua757:"q",\ua759:"q","\u24e1":"r",\uff52:"r",\u0155:"r",\u1e59:"r",\u0159:"r",\u0211:"r",\u0213:"r",\u1e5b:"r",\u1e5d:"r",\u0157:"r",\u1e5f:"r",\u024d:"r",\u027d:"r",\ua75b:"r",\ua7a7:"r",\ua783:"r","\u24e2":"s",\uff53:"s",\u00df:"s",\u015b:"s",\u1e65:"s",\u015d:"s",\u1e61:"s",\u0161:"s",\u1e67:"s",\u1e63:"s",\u1e69:"s",\u0219:"s",\u015f:"s",\u023f:"s",\ua7a9:"s",\ua785:"s",\u1e9b:"s","\u24e3":"t",\uff54:"t",\u1e6b:"t",\u1e97:"t",\u0165:"t",\u1e6d:"t",\u021b:"t",\u0163:"t",\u1e71:"t",\u1e6f:"t",\u0167:"t",\u01ad:"t",\u0288:"t",\u2c66:"t",\ua787:"t",\ua729:"tz","\u24e4":"u",\uff55:"u",\u00f9:"u",\u00fa:"u",\u00fb:"u",\u0169:"u",\u1e79:"u",\u016b:"u",\u1e7b:"u",\u016d:"u",\u00fc:"u",\u01dc:"u",\u01d8:"u",\u01d6:"u",\u01da:"u",\u1ee7:"u",\u016f:"u",\u0171:"u",\u01d4:"u",\u0215:"u",\u0217:"u",\u01b0:"u",\u1eeb:"u",\u1ee9:"u",\u1eef:"u",\u1eed:"u",\u1ef1:"u",\u1ee5:"u",\u1e73:"u",\u0173:"u",\u1e77:"u",\u1e75:"u",\u0289:"u","\u24e5":"v",\uff56:"v",\u1e7d:"v",\u1e7f:"v",\u028b:"v",\ua75f:"v",\u028c:"v",\ua761:"vy","\u24e6":"w",\uff57:"w",\u1e81:"w",\u1e83:"w",\u0175:"w",\u1e87:"w",\u1e85:"w",\u1e98:"w",\u1e89:"w",\u2c73:"w","\u24e7":"x",\uff58:"x",\u1e8b:"x",\u1e8d:"x","\u24e8":"y",\uff59:"y",\u1ef3:"y",\u00fd:"y",\u0177:"y",\u1ef9:"y",\u0233:"y",\u1e8f:"y",\u00ff:"y",\u1ef7:"y",\u1e99:"y",\u1ef5:"y",\u01b4:"y",\u024f:"y",\u1eff:"y","\u24e9":"z",\uff5a:"z",\u017a:"z",\u1e91:"z",\u017c:"z",\u017e:"z",\u1e93:"z",\u1e95:"z",\u01b6:"z",\u0225:"z",\u0240:"z",\u2c6c:"z",\ua763:"z",\u0386:"\u0391",\u0388:"\u0395",\u0389:"\u0397",\u038a:"\u0399",\u03aa:"\u0399",\u038c:"\u039f",\u038e:"\u03a5",\u03ab:"\u03a5",\u038f:"\u03a9",\u03ac:"\u03b1",\u03ad:"\u03b5",\u03ae:"\u03b7",\u03af:"\u03b9",\u03ca:"\u03b9",\u0390:"\u03b9",\u03cc:"\u03bf",\u03cd:"\u03c5",\u03cb:"\u03c5",\u03b0:"\u03c5",\u03c9:"\u03c9",\u03c2:"\u03c3"};function BS(e){return e.replace(/[^\u0000-\u007E]/g,t=>dY[t]||t)}class hY{constructor(n,t){this._ngSelect=n,this._selectionModel=t,this._items=[],this._filteredItems=[],this._markedIndex=-1}get items(){return this._items}get filteredItems(){return this._filteredItems}get markedIndex(){return this._markedIndex}get selectedItems(){return this._selectionModel.value}get markedItem(){return this._filteredItems[this._markedIndex]}get noItemsToSelect(){return this._ngSelect.hideSelected&&this._items.length===this.selectedItems.length}get maxItemsSelected(){return this._ngSelect.multiple&&this._ngSelect.maxSelectedItems<=this.selectedItems.length}get lastSelectedItem(){let n=this.selectedItems.length-1;for(;n>=0;n--){const t=this.selectedItems[n];if(!t.disabled)return t}return null}setItems(n){this._items=n.map((t,r)=>this.mapItem(t,r)),this._ngSelect.groupBy?(this._groups=this._groupBy(this._items,this._ngSelect.groupBy),this._items=this._flatten(this._groups)):(this._groups=new Map,this._groups.set(void 0,this._items)),this._filteredItems=[...this._items]}select(n){if(n.selected||this.maxItemsSelected)return;const t=this._ngSelect.multiple;t||this.clearSelected(),this._selectionModel.select(n,t,this._ngSelect.selectableGroupAsModel),this._ngSelect.hideSelected&&this._hideSelected(n)}unselect(n){n.selected&&(this._selectionModel.unselect(n,this._ngSelect.multiple),this._ngSelect.hideSelected&&Jr(n.index)&&this._ngSelect.multiple&&this._showSelected(n))}findItem(n){let t;return t=this._ngSelect.compareWith?r=>this._ngSelect.compareWith(r.value,n):this._ngSelect.bindValue?r=>!r.children&&this.resolveNested(r.value,this._ngSelect.bindValue)===n:r=>r.value===n||!r.children&&r.label&&r.label===this.resolveNested(n,this._ngSelect.bindLabel),this._items.find(r=>t(r))}addItem(n){const t=this.mapItem(n,this._items.length);return this._items.push(t),this._filteredItems.push(t),t}clearSelected(n=!1){this._selectionModel.clear(n),this._items.forEach(t=>{t.selected=n&&t.selected&&t.disabled,t.marked=!1}),this._ngSelect.hideSelected&&this.resetFilteredItems()}findByLabel(n){return n=BS(n).toLocaleLowerCase(),this.filteredItems.find(t=>BS(t.label).toLocaleLowerCase().substr(0,n.length)===n)}filter(n){if(!n)return void this.resetFilteredItems();this._filteredItems=[],n=this._ngSelect.searchFn?n:BS(n).toLocaleLowerCase();const t=this._ngSelect.searchFn||this._defaultSearchFn,r=this._ngSelect.hideSelected;for(const a of Array.from(this._groups.keys())){const f=[];for(const _ of this._groups.get(a))r&&(_.parent&&_.parent.selected||_.selected)||t(n,this._ngSelect.searchFn?_.value:_)&&f.push(_);if(f.length>0){const[_]=f.slice(-1);if(_.parent){const T=this._items.find(D=>D===_.parent);this._filteredItems.push(T)}this._filteredItems.push(...f)}}}resetFilteredItems(){this._filteredItems.length!==this._items.length&&(this._filteredItems=this._ngSelect.hideSelected&&this.selectedItems.length>0?this._items.filter(n=>!n.selected):this._items)}unmarkItem(){this._markedIndex=-1}markNextItem(){this._stepToItem(1)}markPreviousItem(){this._stepToItem(-1)}markItem(n){this._markedIndex=this._filteredItems.indexOf(n)}markSelectedOrDefault(n){if(0===this._filteredItems.length)return;const t=this._getLastMarkedIndex();this._markedIndex=t>-1?t:n?this.filteredItems.findIndex(r=>!r.disabled):-1}resolveNested(n,t){if(!Qw(n))return n;if(-1===t.indexOf("."))return n[t];{const r=t.split(".");let a=n;for(let f=0,_=r.length;f<_;++f){if(null==a)return null;a=a[r[f]]}return a}}mapItem(n,t){const r=Jr(n.$ngOptionLabel)?n.$ngOptionLabel:this.resolveNested(n,this._ngSelect.bindLabel),a=Jr(n.$ngOptionValue)?n.$ngOptionValue:n;return{index:t,label:Jr(r)?r.toString():"",value:a,disabled:n.disabled,htmlId:`${this._ngSelect.dropdownId}-${t}`}}mapSelectedItems(){const n=this._ngSelect.multiple;for(const t of this.selectedItems){const r=this._ngSelect.bindValue?this.resolveNested(t.value,this._ngSelect.bindValue):t.value,a=Jr(r)?this.findItem(r):null;this._selectionModel.unselect(t,n),this._selectionModel.select(a||t,n,this._ngSelect.selectableGroupAsModel)}this._ngSelect.hideSelected&&(this._filteredItems=this.filteredItems.filter(t=>-1===this.selectedItems.indexOf(t)))}_showSelected(n){if(this._filteredItems.push(n),n.parent){const t=n.parent;this._filteredItems.find(a=>a===t)||this._filteredItems.push(t)}else if(n.children)for(const t of n.children)t.selected=!1,this._filteredItems.push(t);this._filteredItems=[...this._filteredItems.sort((t,r)=>t.index-r.index)]}_hideSelected(n){this._filteredItems=this._filteredItems.filter(t=>t!==n),n.parent?n.parent.children.every(r=>r.selected)&&(this._filteredItems=this._filteredItems.filter(r=>r!==n.parent)):n.children&&(this._filteredItems=this.filteredItems.filter(t=>t.parent!==n))}_defaultSearchFn(n,t){return BS(t.label).toLocaleLowerCase().indexOf(n)>-1}_getNextItemIndex(n){return n>0?this._markedIndex>=this._filteredItems.length-1?0:this._markedIndex+1:this._markedIndex<=0?this._filteredItems.length-1:this._markedIndex-1}_stepToItem(n){0===this._filteredItems.length||this._filteredItems.every(t=>t.disabled)||(this._markedIndex=this._getNextItemIndex(n),this.markedItem.disabled&&this._stepToItem(n))}_getLastMarkedIndex(){if(this._ngSelect.hideSelected||this._markedIndex>-1&&void 0===this.markedItem)return-1;const n=this._filteredItems.indexOf(this.lastSelectedItem);return this.lastSelectedItem&&n<0?-1:Math.max(this.markedIndex,n)}_groupBy(n,t){const r=new Map;if(0===n.length)return r;if(Array.isArray(n[0].value[t])){for(const _ of n){const T=(_.value[t]||[]).map((D,P)=>this.mapItem(D,P));r.set(_,T)}return r}const a=LS(this._ngSelect.groupBy),f=_=>{const T=a?t(_.value):_.value[t];return Jr(T)?T:void 0};for(const _ of n){const T=f(_),D=r.get(T);D?D.push(_):r.set(T,[_])}return r}_flatten(n){const t=LS(this._ngSelect.groupBy),r=[];for(const a of Array.from(n.keys())){let f=r.length;if(void 0===a){const G=n.get(void 0)||[];r.push(...G.map(ie=>(ie.index=f++,ie)));continue}const _=Qw(a),T={label:_?"":String(a),children:void 0,parent:null,index:f++,disabled:!this._ngSelect.selectableGroup,htmlId:YB()},D=t?this._ngSelect.bindLabel:this._ngSelect.groupBy,P=this._ngSelect.groupValue||(()=>_?a.value:{[D]:a}),L=n.get(a).map(G=>(G.parent=T,G.children=void 0,G.index=f++,G));T.children=L,T.value=P(a,L.map(G=>G.value)),r.push(T),r.push(...L)}return r}}var yh=function(e){return e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Esc=27]="Esc",e[e.Space=32]="Space",e[e.ArrowUp=38]="ArrowUp",e[e.ArrowDown=40]="ArrowDown",e[e.Backspace=8]="Backspace",e}(yh||{});let XB=(()=>{class e{constructor(){this._dimensions={itemHeight:0,panelHeight:0,itemsPerViewport:0}}get dimensions(){return this._dimensions}calculateItems(t,r,a){const f=this._dimensions,_=f.itemHeight*r,D=Math.max(0,t)/_*r;let P=Math.min(r,Math.ceil(D)+(f.itemsPerViewport+1));const G=Math.max(0,P-f.itemsPerViewport);let ie=Math.min(G,Math.floor(D)),oe=f.itemHeight*Math.ceil(ie)-f.itemHeight*Math.min(ie,a);return oe=isNaN(oe)?0:oe,ie=isNaN(ie)?-1:ie,P=isNaN(P)?-1:P,ie-=a,ie=Math.max(0,ie),P+=a,P=Math.min(r,P),{topPadding:oe,scrollHeight:_,start:ie,end:P}}setDimensions(t,r){const a=Math.max(1,Math.floor(r/t));this._dimensions={itemHeight:t,panelHeight:r,itemsPerViewport:a}}getScrollTo(t,r,a){const{panelHeight:f}=this.dimensions,_=t+r,D=a+f;return f>=_&&a===t?null:_>D?a+_-D:t<=a?t:null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac})}return e})();const KB=["top","right","bottom","left"],fY=typeof requestAnimationFrame<"u"?QW:sZ;let JB=(()=>{class e{constructor(t,r,a,f,_){this._renderer=t,this._zone=r,this._panelService=a,this._document=_,this.items=[],this.position="auto",this.virtualScroll=!1,this.filterValue=null,this.update=new fn,this.scroll=new fn,this.scrollToEnd=new fn,this.outsideClick=new fn,this._destroy$=new Ci,this._scrollToEndFired=!1,this._updateScrollHeight=!1,this._lastScrollPosition=0,this._dropdown=f.nativeElement}get currentPosition(){return this._currentPosition}get itemsLength(){return this._itemsLength}set itemsLength(t){t!==this._itemsLength&&(this._itemsLength=t,this._onItemsLengthChanged())}get _startOffset(){if(this.markedItem){const{itemHeight:t,panelHeight:r}=this._panelService.dimensions,a=this.markedItem.index*t;return r>a?0:a}return 0}ngOnInit(){this._select=this._dropdown.parentElement,this._virtualPadding=this.paddingElementRef.nativeElement,this._scrollablePanel=this.scrollElementRef.nativeElement,this._contentPanel=this.contentElementRef.nativeElement,this._handleScroll(),this._handleOutsideClick(),this._appendDropdown(),this._setupMousedownListener()}ngOnChanges(t){if(t.items){const r=t.items;this._onItemsChange(r.currentValue,r.firstChange)}}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete(),this._destroy$.unsubscribe(),this.appendTo&&this._renderer.removeChild(this._dropdown.parentNode,this._dropdown)}scrollTo(t,r=!1){if(!t)return;const a=this.items.indexOf(t);if(a<0||a>=this.itemsLength)return;let f;if(this.virtualScroll){const _=this._panelService.dimensions.itemHeight;f=this._panelService.getScrollTo(a*_,_,this._lastScrollPosition)}else{const _=this._dropdown.querySelector(`#${t.htmlId}`);f=this._panelService.getScrollTo(_.offsetTop,_.clientHeight,r?_.offsetTop:this._lastScrollPosition)}Jr(f)&&(this._scrollablePanel.scrollTop=f)}scrollToTag(){const t=this._scrollablePanel;t.scrollTop=t.scrollHeight-t.clientHeight}adjustPosition(){this._updateYPosition()}_handleDropdownPosition(){this._currentPosition=this._calculateCurrentPosition(this._dropdown),KB.includes(this._currentPosition)?this._updateDropdownClass(this._currentPosition):this._updateDropdownClass("bottom"),this.appendTo&&this._updateYPosition(),this._dropdown.style.opacity="1"}_updateDropdownClass(t){KB.forEach(a=>{const f=`ng-select-${a}`;this._renderer.removeClass(this._dropdown,f),this._renderer.removeClass(this._select,f)});const r=`ng-select-${t}`;this._renderer.addClass(this._dropdown,r),this._renderer.addClass(this._select,r)}_handleScroll(){this._zone.runOutsideAngular(()=>{Co(this.scrollElementRef.nativeElement,"scroll").pipe(Kr(this._destroy$),function YW(e,n=RS){return function WW(e){return ir((n,t)=>{let r=!1,a=null,f=null,_=!1;const T=()=>{if(f?.unsubscribe(),f=null,r){r=!1;const P=a;a=null,t.next(P)}_&&t.complete()},D=()=>{f=null,_&&t.complete()};n.subscribe(ve(t,P=>{r=!0,a=P,f||Ms(e(P)).subscribe(f=ve(t,T,D))},()=>{_=!0,(!r||!f||f.closed)&&t.complete()}))})}(()=>mO(e,n))}(0,fY)).subscribe(t=>{const r=t.path||t.composedPath&&t.composedPath();r&&(0!==r.length||t.target)&&this._onContentScrolled(r&&0!==r.length?r[0].scrollTop:t.target.scrollTop)})})}_handleOutsideClick(){this._document&&this._zone.runOutsideAngular(()=>{FS(Co(this._document,"touchstart",{capture:!0}),Co(this._document,"click",{capture:!0})).pipe(Kr(this._destroy$)).subscribe(t=>this._checkToClose(t))})}_checkToClose(t){if(this._select.contains(t.target)||this._dropdown.contains(t.target))return;const r=t.path||t.composedPath&&t.composedPath();t.target&&t.target.shadowRoot&&r&&r[0]&&this._select.contains(r[0])||this._zone.run(()=>this.outsideClick.emit())}_onItemsChange(t,r){this.items=t||[],this._scrollToEndFired=!1,this.itemsLength=t.length,this.virtualScroll?this._updateItemsRange(r):(this._setVirtualHeight(),this._updateItems(r))}_updateItems(t){this.update.emit(this.items),!1!==t&&this._zone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._panelService.setDimensions(0,this._scrollablePanel.clientHeight),this._handleDropdownPosition(),this.scrollTo(this.markedItem,t)})})}_updateItemsRange(t){this._zone.runOutsideAngular(()=>{this._measureDimensions().then(()=>{t?(this._renderItemsRange(this._startOffset),this._handleDropdownPosition()):this._renderItemsRange()})})}_onContentScrolled(t){this.virtualScroll&&this._renderItemsRange(t),this._lastScrollPosition=t,this._fireScrollToEnd(t)}_updateVirtualHeight(t){this._updateScrollHeight&&(this._virtualPadding.style.height=`${t}px`,this._updateScrollHeight=!1)}_setVirtualHeight(){this._virtualPadding&&(this._virtualPadding.style.height="0px")}_onItemsLengthChanged(){this._updateScrollHeight=!0}_renderItemsRange(t=null){if(t&&this._lastScrollPosition===t)return;const r=this._panelService.calculateItems(t=t||this._scrollablePanel.scrollTop,this.itemsLength,this.bufferAmount);this._updateVirtualHeight(r.scrollHeight),this._contentPanel.style.transform=`translateY(${r.topPadding}px)`,this._zone.run(()=>{this.update.emit(this.items.slice(r.start,r.end)),this.scroll.emit({start:r.start,end:r.end})}),Jr(t)&&0===this._lastScrollPosition&&(this._scrollablePanel.scrollTop=t,this._lastScrollPosition=t)}_measureDimensions(){if(this._panelService.dimensions.itemHeight>0||0===this.itemsLength)return Promise.resolve(this._panelService.dimensions);const[t]=this.items;return this.update.emit([t]),Promise.resolve().then(()=>{const a=this._dropdown.querySelector(`#${t.htmlId}`).clientHeight;return this._virtualPadding.style.height=a*this.itemsLength+"px",this._panelService.setDimensions(a,this._scrollablePanel.clientHeight),this._panelService.dimensions})}_fireScrollToEnd(t){this._scrollToEndFired||0===t||t+this._dropdown.clientHeight>=(this.virtualScroll?this._virtualPadding:this._contentPanel).clientHeight-1&&(this._zone.run(()=>this.scrollToEnd.emit()),this._scrollToEndFired=!0)}_calculateCurrentPosition(t){if("auto"!==this.position)return this.position;const r=this._select.getBoundingClientRect(),a=document.documentElement.scrollTop||document.body.scrollTop;return r.top+window.pageYOffset+r.height+t.getBoundingClientRect().height>a+document.documentElement.clientHeight?"top":"bottom"}_appendDropdown(){if(this.appendTo){if(this._parent=document.querySelector(this.appendTo),!this._parent)throw new Error(`appendTo selector ${this.appendTo} did not found any parent element`);this._updateXPosition(),this._parent.appendChild(this._dropdown)}}_updateXPosition(){const t=this._select.getBoundingClientRect(),r=this._parent.getBoundingClientRect();this._dropdown.style.left=t.left-r.left+"px",this._dropdown.style.width=t.width+"px",this._dropdown.style.minWidth=t.width+"px"}_updateYPosition(){const t=this._select.getBoundingClientRect(),r=this._parent.getBoundingClientRect(),a=t.height;"top"===this._currentPosition?(this._dropdown.style.bottom=r.bottom-t.bottom+a+"px",this._dropdown.style.top="auto"):"bottom"===this._currentPosition&&(this._dropdown.style.top=t.top-r.top+a+"px",this._dropdown.style.bottom="auto")}_setupMousedownListener(){this._zone.runOutsideAngular(()=>{Co(this._dropdown,"mousedown").pipe(Kr(this._destroy$)).subscribe(t=>{"INPUT"!==t.target.tagName&&t.preventDefault()})})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Oc),tt(ii),tt(XB),tt(wi),tt(Xr,8))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["ng-dropdown-panel"]],viewQuery:function(r,a){if(1&r&&(kl(fZ,7,wi),kl(pZ,7,wi),kl(mZ,7,wi)),2&r){let f;pi(f=mi())&&(a.contentElementRef=f.first),pi(f=mi())&&(a.scrollElementRef=f.first),pi(f=mi())&&(a.paddingElementRef=f.first)}},inputs:{items:"items",markedItem:"markedItem",position:"position",appendTo:"appendTo",bufferAmount:"bufferAmount",virtualScroll:[2,"virtualScroll","virtualScroll",zr],headerTemplate:"headerTemplate",footerTemplate:"footerTemplate",filterValue:"filterValue"},outputs:{update:"update",scroll:"scroll",scrollToEnd:"scrollToEnd",outsideClick:"outsideClick"},features:[qx,kr],ngContentSelectors:WB,decls:9,vars:6,consts:[["scroll",""],["padding",""],["content",""],[1,"ng-dropdown-header"],["role","listbox",1,"ng-dropdown-panel-items","scroll-host"],[1,"ng-dropdown-footer"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(r,a){1&r&&(lD(),Jt(0,gZ,2,4,"div",3),Q(1,"div",4,0),un(3,"div",null,1),Q(5,"div",null,2),cD(7),J()(),Jt(8,_Z,2,4,"div",5)),2&r&&(ur(a.headerTemplate?0:-1),we(3),ji("total-padding",a.virtualScroll),we(2),ji("scrollable-content",a.virtualScroll&&a.items.length),we(3),ur(a.footerTemplate?8:-1))},dependencies:[k_],encapsulation:2,changeDetection:0})}return e})(),pY=(()=>{class e{constructor(t){this.elementRef=t,this.disabled=!1,this.stateChange$=new Ci}get label(){return(this.elementRef.nativeElement.textContent||"").trim()}ngOnChanges(t){t.disabled&&this.stateChange$.next({value:this.value,disabled:this.disabled})}ngAfterViewChecked(){this.label!==this._previousLabel&&(this._previousLabel=this.label,this.stateChange$.next({value:this.value,disabled:this.disabled,label:this.elementRef.nativeElement.innerHTML}))}ngOnDestroy(){this.stateChange$.complete()}static#e=this.\u0275fac=function(r){return new(r||e)(tt(wi))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["ng-option"]],inputs:{value:"value",disabled:[2,"disabled","disabled",zr]},features:[qx,kr],ngContentSelectors:WB,decls:1,vars:0,template:function(r,a){1&r&&(lD(),cD(0))},encapsulation:2,changeDetection:0})}return e})(),mY=(()=>{class e{constructor(){this.notFoundText="No items found",this.typeToSearchText="Type to search",this.addTagText="Add item",this.loadingText="Loading...",this.clearAllText="Clear all",this.disableVirtualScroll=!0,this.openOnEnter=!0,this.appearance="underline"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),gY=(()=>{class e{warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const QB=new vt("ng-select-selection-model");let _Y=(()=>{class e{get items(){return this._items}set items(t){this._itemsAreUsed=!0,this._items=t??[]}get compareWith(){return this._compareWith}set compareWith(t){if(null!=t&&!LS(t))throw Error("`compareWith` must be a function.");this._compareWith=t}get clearSearchOnAdd(){return Jr(this._clearSearchOnAdd)?this._clearSearchOnAdd:Jr(this.config.clearSearchOnAdd)?this.config.clearSearchOnAdd:this.closeOnSelect}set clearSearchOnAdd(t){this._clearSearchOnAdd=t}get deselectOnClick(){return Jr(this._deselectOnClick)?this._deselectOnClick:Jr(this.config.deselectOnClick)?this.config.deselectOnClick:this.multiple}set deselectOnClick(t){this._deselectOnClick=t}get disabled(){return this.readonly||this._disabled}get filtered(){return!!this.searchTerm&&this.searchable||this._isComposing}get single(){return!this.multiple}get _editableSearchTerm(){return this.editableSearchTerm&&!this.multiple}constructor(t,r,a,f,_,T,D){this.classes=t,this.autoFocus=r,this.config=a,this._cd=T,this._console=D,this.markFirst=!0,this.dropdownPosition="auto",this.loading=!1,this.closeOnSelect=!0,this.hideSelected=!1,this.selectOnTab=!1,this.bufferAmount=4,this.selectableGroup=!1,this.selectableGroupAsModel=!0,this.searchFn=null,this.trackByFn=null,this.clearOnBackspace=!0,this.labelForId=null,this.inputAttrs={},this.readonly=!1,this.searchWhileComposing=!0,this.minTermLength=0,this.editableSearchTerm=!1,this.keyDownFn=P=>!0,this.multiple=!1,this.addTag=!1,this.searchable=!0,this.clearable=!0,this.isOpen=!1,this.blurEvent=new fn,this.focusEvent=new fn,this.changeEvent=new fn,this.openEvent=new fn,this.closeEvent=new fn,this.searchEvent=new fn,this.clearEvent=new fn,this.addEvent=new fn,this.removeEvent=new fn,this.scroll=new fn,this.scrollToEnd=new fn,this.useDefaultClass=!0,this.viewPortItems=[],this.searchTerm=null,this.dropdownId=YB(),this.escapeHTML=!0,this._items=[],this._defaultLabel="label",this._pressedKeys=[],this._isComposing=!1,this._destroy$=new Ci,this._keyPress$=new Ci,this._onChange=P=>{},this._onTouched=()=>{},this.clearItem=P=>{const L=this.selectedItems.find(G=>G.value===P);this.unselect(L)},this.trackByOption=(P,L)=>this.trackByFn?this.trackByFn(L.value):L,this._mergeGlobalConfig(a),this.itemsList=new hY(this,f()),this.element=_.nativeElement}get selectedItems(){return this.itemsList.selectedItems}get selectedValues(){return this.selectedItems.map(t=>t.value)}get hasValue(){return this.selectedItems.length>0}get currentPanelPosition(){if(this.dropdownPanel)return this.dropdownPanel.currentPosition}ngOnInit(){this._handleKeyPresses(),this._setInputAttributes()}ngOnChanges(t){t.multiple&&this.itemsList.clearSelected(),t.items&&this._setItems(t.items.currentValue||[]),t.isOpen&&(this._manualOpen=Jr(t.isOpen.currentValue))}ngAfterViewInit(){this._itemsAreUsed||(this.escapeHTML=!1,this._setItemsFromNgOptions()),Jr(this.autoFocus)&&this.focus()}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}handleKeyDown(t){if(yh[t.which]){if(!1===this.keyDownFn(t))return;this.handleKeyCode(t)}else t.key&&1===t.key.length&&this._keyPress$.next(t.key.toLocaleLowerCase())}handleKeyCode(t){this.clearButton&&this.clearButton.nativeElement===t.target?this.handleKeyCodeClear(t):this.handleKeyCodeInput(t)}handleKeyCodeInput(t){switch(t.which){case yh.ArrowDown:this._handleArrowDown(t);break;case yh.ArrowUp:this._handleArrowUp(t);break;case yh.Space:this._handleSpace(t);break;case yh.Enter:this._handleEnter(t);break;case yh.Tab:this._handleTab(t);break;case yh.Esc:this.close(),t.preventDefault();break;case yh.Backspace:this._handleBackspace()}}handleKeyCodeClear(t){t.which===yh.Enter&&(this.handleClearClick(),t.preventDefault())}handleMousedown(t){const r=t.target;"INPUT"!==r.tagName&&t.preventDefault(),r.classList.contains("ng-clear-wrapper")?this.handleClearClick():r.classList.contains("ng-arrow-wrapper")?this.handleArrowClick():r.classList.contains("ng-value-icon")||(this.focused||this.focus(),this.searchable?this.open():this.toggle())}handleArrowClick(){this.isOpen?this.close():this.open()}handleClearClick(){this.hasValue&&(this.itemsList.clearSelected(!0),this._updateNgModel()),this._clearSearch(),this.focus(),this.clearEvent.emit(),this._onSelectionChanged()}clearModel(){this.clearable&&(this.itemsList.clearSelected(),this._updateNgModel())}writeValue(t){this.itemsList.clearSelected(),this._handleWriteValue(t),this._cd.markForCheck()}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this._disabled=t,this._cd.markForCheck()}toggle(){this.isOpen?this.close():this.open()}open(){this.disabled||this.isOpen||this._manualOpen||!this._isTypeahead&&!this.addTag&&this.itemsList.noItemsToSelect||(this.isOpen=!0,this.itemsList.markSelectedOrDefault(this.markFirst),this.openEvent.emit(),this.searchTerm||this.focus(),this.detectChanges())}close(){!this.isOpen||this._manualOpen||(this.isOpen=!1,this._isComposing=!1,this._editableSearchTerm?this.itemsList.resetFilteredItems():this._clearSearch(),this.itemsList.unmarkItem(),this._onTouched(),this.closeEvent.emit(),this._cd.markForCheck())}toggleItem(t){!t||t.disabled||this.disabled||(this.deselectOnClick&&t.selected?this.unselect(t):this.select(t),this._editableSearchTerm&&this._setSearchTermFromItems(),this._onSelectionChanged())}select(t){t.selected||(this.itemsList.select(t),this.clearSearchOnAdd&&!this._editableSearchTerm&&this._clearSearch(),this._updateNgModel(),this.multiple&&this.addEvent.emit(t.value)),(this.closeOnSelect||this.itemsList.noItemsToSelect)&&this.close()}focus(){this.searchInput.nativeElement.focus()}blur(){this.searchInput.nativeElement.blur()}unselect(t){t&&(this.itemsList.unselect(t),this.focus(),this._updateNgModel(),this.removeEvent.emit(t.value))}selectTag(){let t;t=LS(this.addTag)?this.addTag(this.searchTerm):this._primitive?this.searchTerm:{[this.bindLabel]:this.searchTerm};const r=a=>this._isTypeahead||!this.isOpen?this.itemsList.mapItem(a,null):this.itemsList.addItem(a);!function JZ(e){return e instanceof Promise}(t)?t&&this.select(r(t)):t.then(a=>this.select(r(a))).catch(()=>{})}showClear(){return this.clearable&&(this.hasValue||this.searchTerm)&&!this.disabled}focusOnClear(){this.blur(),this.clearButton&&this.clearButton.nativeElement.focus()}get showAddTag(){if(!this._validTerm)return!1;const t=this.searchTerm.toLowerCase().trim();return this.addTag&&!this.itemsList.filteredItems.some(r=>r.label.toLowerCase()===t)&&(!this.hideSelected&&this.isOpen||!this.selectedItems.some(r=>r.label.toLowerCase()===t))&&!this.loading}showNoItemsFound(){const t=0===this.itemsList.filteredItems.length;return(t&&!this._isTypeahead&&!this.loading||t&&this._isTypeahead&&this._validTerm&&!this.loading)&&!this.showAddTag}showTypeToSearch(){return 0===this.itemsList.filteredItems.length&&this._isTypeahead&&!this._validTerm&&!this.loading}onCompositionStart(){this._isComposing=!0}onCompositionEnd(t){this._isComposing=!1,!this.searchWhileComposing&&this.filter(t)}filter(t){this._isComposing&&!this.searchWhileComposing||(this.searchTerm=t,this._isTypeahead&&(this._validTerm||0===this.minTermLength)&&this.typeahead.next(t),this._isTypeahead||(this.itemsList.filter(this.searchTerm),this.isOpen&&this.itemsList.markSelectedOrDefault(this.markFirst)),this.searchEvent.emit({term:t,items:this.itemsList.filteredItems.map(r=>r.value)}),this.open())}onInputFocus(t){this.focused||(this._editableSearchTerm&&this._setSearchTermFromItems(),this.element.classList.add("ng-select-focused"),this.focusEvent.emit(t),this.focused=!0)}onInputBlur(t){this.element.classList.remove("ng-select-focused"),this.blurEvent.emit(t),!this.isOpen&&!this.disabled&&this._onTouched(),this._editableSearchTerm&&this._setSearchTermFromItems(),this.focused=!1}onItemHover(t){t.disabled||this.itemsList.markItem(t)}detectChanges(){this._cd.destroyed||this._cd.detectChanges()}_setSearchTermFromItems(){const t=this.selectedItems&&this.selectedItems[0];this.searchTerm=t&&t.label||null}_setItems(t){const r=t[0];this.bindLabel=this.bindLabel||this._defaultLabel,this._primitive=Jr(r)?!Qw(r):this._primitive||this.bindLabel===this._defaultLabel,this.itemsList.setItems(t),t.length>0&&this.hasValue&&this.itemsList.mapSelectedItems(),this.isOpen&&Jr(this.searchTerm)&&!this._isTypeahead&&this.itemsList.filter(this.searchTerm),(this._isTypeahead||this.isOpen)&&this.itemsList.markSelectedOrDefault(this.markFirst)}_setItemsFromNgOptions(){const t=a=>{this.items=a.map(f=>({$ngOptionValue:f.value,$ngOptionLabel:f.elementRef.nativeElement.innerHTML,disabled:f.disabled})),this.itemsList.setItems(this.items),this.hasValue&&this.itemsList.mapSelectedItems(),this.detectChanges()},r=()=>{const a=FS(this.ngOptions.changes,this._destroy$);FS(...this.ngOptions.map(f=>f.stateChange$)).pipe(Kr(a)).subscribe(f=>{const _=this.itemsList.findItem(f.value);_.disabled=f.disabled,_.label=f.label||_.label,this._cd.detectChanges()})};this.ngOptions.changes.pipe(yA(this.ngOptions),Kr(this._destroy$)).subscribe(a=>{this.bindLabel=this._defaultLabel,t(a),r()})}_isValidWriteValue(t){if(!Jr(t)||this.multiple&&""===t||Array.isArray(t)&&0===t.length)return!1;const r=a=>!(!Jr(this.compareWith)&&Qw(a)&&this.bindValue&&(this._console.warn(`Setting object(${JSON.stringify(a)}) as your model with bindValue is not allowed unless [compareWith] is used.`),1));return this.multiple?Array.isArray(t)?t.every(a=>r(a)):(this._console.warn("Multiple select ngModel should be array."),!1):r(t)}_handleWriteValue(t){if(!this._isValidWriteValue(t))return;const r=a=>{let f=this.itemsList.findItem(a);if(f)this.itemsList.select(f);else{const _=Qw(a);_||!_&&!this.bindValue?this.itemsList.select(this.itemsList.mapItem(a,null)):this.bindValue&&(f={[this.bindLabel]:null,[this.bindValue]:a},this.itemsList.select(this.itemsList.mapItem(f,null)))}};this.multiple?t.forEach(a=>r(a)):r(t)}_handleKeyPresses(){this.searchable||this._keyPress$.pipe(Kr(this._destroy$),As(t=>this._pressedKeys.push(t)),function XW(e,n=RS){return ir((t,r)=>{let a=null,f=null,_=null;const T=()=>{if(a){a.unsubscribe(),a=null;const P=f;f=null,r.next(P)}};function D(){const P=_+e,L=n.now();if(L<P)return a=this.schedule(void 0,P-L),void r.add(a);T()}t.subscribe(ve(r,P=>{f=P,_=n.now(),a||(a=n.schedule(D,e),r.add(a))},()=>{T(),r.complete()},void 0,()=>{f=a=null}))})}(200),Uo(()=>this._pressedKeys.length>0),q(()=>this._pressedKeys.join(""))).subscribe(t=>{const r=this.itemsList.findByLabel(t);r&&(this.isOpen?(this.itemsList.markItem(r),this._scrollToMarked(),this._cd.markForCheck()):this.select(r)),this._pressedKeys=[]})}_setInputAttributes(){const t=this.searchInput.nativeElement,r={type:"text",autocorrect:"off",autocapitalize:"off",autocomplete:this.labelForId?"off":this.dropdownId,...this.inputAttrs};for(const a of Object.keys(r))t.setAttribute(a,r[a])}_updateNgModel(){const t=[];for(const a of this.selectedItems)if(this.bindValue){let f=null;f=a.children?a.value[(this.groupValue?this.bindValue:this.groupBy)||this.groupBy]:this.itemsList.resolveNested(a.value,this.bindValue),t.push(f)}else t.push(a.value);const r=this.selectedItems.map(a=>a.value);this.multiple?(this._onChange(t),this.changeEvent.emit(r)):(this._onChange(Jr(t[0])?t[0]:null),this.changeEvent.emit(r[0])),this._cd.markForCheck()}_clearSearch(){this.searchTerm&&(this._changeSearch(null),this.itemsList.resetFilteredItems())}_changeSearch(t){this.searchTerm=t,this._isTypeahead&&this.typeahead.next(t)}_scrollToMarked(){!this.isOpen||!this.dropdownPanel||this.dropdownPanel.scrollTo(this.itemsList.markedItem)}_scrollToTag(){!this.isOpen||!this.dropdownPanel||this.dropdownPanel.scrollToTag()}_onSelectionChanged(){this.isOpen&&this.deselectOnClick&&this.appendTo&&(this._cd.detectChanges(),this.dropdownPanel.adjustPosition())}_handleTab(t){if(!1===this.isOpen)if(this.showClear()&&!t.shiftKey)this.focusOnClear(),t.preventDefault();else if(!this.addTag)return;this.selectOnTab?this.itemsList.markedItem?(this.toggleItem(this.itemsList.markedItem),t.preventDefault()):this.showAddTag?(this.selectTag(),t.preventDefault()):this.close():this.close()}_handleEnter(t){if(this.isOpen||this._manualOpen)this.itemsList.markedItem?this.toggleItem(this.itemsList.markedItem):this.showAddTag&&this.selectTag();else{if(!this.openOnEnter)return;this.open()}t.preventDefault()}_handleSpace(t){this.isOpen||this._manualOpen||(this.open(),t.preventDefault())}_handleArrowDown(t){this._nextItemIsTag(1)?(this.itemsList.unmarkItem(),this._scrollToTag()):(this.itemsList.markNextItem(),this._scrollToMarked()),this.open(),t.preventDefault()}_handleArrowUp(t){this.isOpen&&(this._nextItemIsTag(-1)?(this.itemsList.unmarkItem(),this._scrollToTag()):(this.itemsList.markPreviousItem(),this._scrollToMarked()),t.preventDefault())}_nextItemIsTag(t){const r=this.itemsList.markedIndex+t;return this.addTag&&this.searchTerm&&this.itemsList.markedItem&&(r<0||r===this.itemsList.filteredItems.length)}_handleBackspace(){this.searchTerm||!this.clearable||!this.clearOnBackspace||!this.hasValue||(this.multiple?this.unselect(this.itemsList.lastSelectedItem):this.clearModel())}get _isTypeahead(){return this.typeahead&&this.typeahead.observers.length>0}get _validTerm(){const t=this.searchTerm&&this.searchTerm.trim();return t&&t.length>=this.minTermLength}_mergeGlobalConfig(t){this.placeholder=this.placeholder||t.placeholder,this.notFoundText=this.notFoundText||t.notFoundText,this.typeToSearchText=this.typeToSearchText||t.typeToSearchText,this.addTagText=this.addTagText||t.addTagText,this.loadingText=this.loadingText||t.loadingText,this.clearAllText=this.clearAllText||t.clearAllText,this.virtualScroll=Jr(this.virtualScroll)?this.virtualScroll:!!Jr(t.disableVirtualScroll)&&!t.disableVirtualScroll,this.openOnEnter=Jr(this.openOnEnter)?this.openOnEnter:t.openOnEnter,this.appendTo=this.appendTo||t.appendTo,this.bindValue=this.bindValue||t.bindValue,this.bindLabel=this.bindLabel||t.bindLabel,this.appearance=this.appearance||t.appearance}static#e=this.\u0275fac=function(r){return new(r||e)(Zs("class"),Zs("autofocus"),tt(mY),tt(QB),tt(wi),tt(zc),tt(gY))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["ng-select"]],contentQueries:function(r,a,f){if(1&r&&(er(f,eY,5,li),er(f,tY,5,li),er(f,nY,5,li),er(f,iY,5,li),er(f,rY,5,li),er(f,oY,5,li),er(f,sY,5,li),er(f,aY,5,li),er(f,lY,5,li),er(f,cY,5,li),er(f,uY,5,li),er(f,pY,5)),2&r){let _;pi(_=mi())&&(a.optionTemplate=_.first),pi(_=mi())&&(a.optgroupTemplate=_.first),pi(_=mi())&&(a.labelTemplate=_.first),pi(_=mi())&&(a.multiLabelTemplate=_.first),pi(_=mi())&&(a.headerTemplate=_.first),pi(_=mi())&&(a.footerTemplate=_.first),pi(_=mi())&&(a.notFoundTemplate=_.first),pi(_=mi())&&(a.typeToSearchTemplate=_.first),pi(_=mi())&&(a.loadingTextTemplate=_.first),pi(_=mi())&&(a.tagTemplate=_.first),pi(_=mi())&&(a.loadingSpinnerTemplate=_.first),pi(_=mi())&&(a.ngOptions=_)}},viewQuery:function(r,a){if(1&r&&(kl(JB,5),kl(yZ,7),kl(vZ,5)),2&r){let f;pi(f=mi())&&(a.dropdownPanel=f.first),pi(f=mi())&&(a.searchInput=f.first),pi(f=mi())&&(a.clearButton=f.first)}},hostVars:20,hostBindings:function(r,a){1&r&&At("keydown",function(_){return a.handleKeyDown(_)}),2&r&&ji("ng-select-typeahead",a.typeahead)("ng-select-multiple",a.multiple)("ng-select-taggable",a.addTag)("ng-select-searchable",a.searchable)("ng-select-clearable",a.clearable)("ng-select-opened",a.isOpen)("ng-select",a.useDefaultClass)("ng-select-disabled",a.disabled)("ng-select-filtered",a.filtered)("ng-select-single",a.single)},inputs:{bindLabel:"bindLabel",bindValue:"bindValue",markFirst:[2,"markFirst","markFirst",zr],placeholder:"placeholder",notFoundText:"notFoundText",typeToSearchText:"typeToSearchText",addTagText:"addTagText",loadingText:"loadingText",clearAllText:"clearAllText",appearance:"appearance",dropdownPosition:"dropdownPosition",appendTo:"appendTo",loading:[2,"loading","loading",zr],closeOnSelect:[2,"closeOnSelect","closeOnSelect",zr],hideSelected:[2,"hideSelected","hideSelected",zr],selectOnTab:[2,"selectOnTab","selectOnTab",zr],openOnEnter:[2,"openOnEnter","openOnEnter",zr],maxSelectedItems:[2,"maxSelectedItems","maxSelectedItems",ID],groupBy:"groupBy",groupValue:"groupValue",bufferAmount:[2,"bufferAmount","bufferAmount",ID],virtualScroll:[2,"virtualScroll","virtualScroll",zr],selectableGroup:[2,"selectableGroup","selectableGroup",zr],selectableGroupAsModel:[2,"selectableGroupAsModel","selectableGroupAsModel",zr],searchFn:"searchFn",trackByFn:"trackByFn",clearOnBackspace:[2,"clearOnBackspace","clearOnBackspace",zr],labelForId:"labelForId",inputAttrs:"inputAttrs",tabIndex:[2,"tabIndex","tabIndex",ID],readonly:[2,"readonly","readonly",zr],searchWhileComposing:[2,"searchWhileComposing","searchWhileComposing",zr],minTermLength:[2,"minTermLength","minTermLength",ID],editableSearchTerm:[2,"editableSearchTerm","editableSearchTerm",zr],keyDownFn:"keyDownFn",typeahead:"typeahead",multiple:[2,"multiple","multiple",zr],addTag:"addTag",searchable:[2,"searchable","searchable",zr],clearable:[2,"clearable","clearable",zr],isOpen:[2,"isOpen","isOpen",zr],items:"items",compareWith:"compareWith",clearSearchOnAdd:"clearSearchOnAdd",deselectOnClick:"deselectOnClick"},outputs:{blurEvent:"blur",focusEvent:"focus",changeEvent:"change",openEvent:"open",closeEvent:"close",searchEvent:"search",clearEvent:"clear",addEvent:"add",removeEvent:"remove",scroll:"scroll",scrollToEnd:"scrollToEnd"},features:[yr([{provide:zl,useExisting:Oi(()=>e),multi:!0},XB]),qx,kr],decls:14,vars:19,consts:[["searchInput",""],["defaultLabelTemplate",""],["defaultLoadingSpinnerTemplate",""],["clearButton",""],["defaultOptionTemplate",""],["defaultTagTemplate",""],["defaultNotFoundTemplate",""],["defaultTypeToSearchTemplate",""],["defaultLoadingTextTemplate",""],[1,"ng-select-container",3,"mousedown"],[1,"ng-value-container"],[1,"ng-placeholder"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["role","combobox","aria-haspopup","listbox",1,"ng-input"],["aria-autocomplete","list",3,"input","compositionstart","compositionend","focus","blur","change","readOnly","disabled","value"],["tabindex","0",1,"ng-clear-wrapper",3,"title"],[1,"ng-arrow-wrapper"],[1,"ng-arrow"],["role","listbox","aria-label","Options list",1,"ng-dropdown-panel",3,"virtualScroll","bufferAmount","appendTo","position","headerTemplate","footerTemplate","filterValue","items","markedItem","ng-select-multiple","ngClass","id"],[1,"ng-value",3,"ng-value-disabled"],[1,"ng-value"],["aria-hidden","true",1,"ng-value-icon","left",3,"click"],[1,"ng-value-label",3,"ngItemLabel","escape"],[3,"ngTemplateOutlet"],[1,"ng-spinner-loader"],["aria-hidden","true",1,"ng-clear"],["role","listbox","aria-label","Options list",1,"ng-dropdown-panel",3,"update","scroll","scrollToEnd","outsideClick","virtualScroll","bufferAmount","appendTo","position","headerTemplate","footerTemplate","filterValue","items","markedItem","ngClass","id"],[1,"ng-option",3,"ng-option-disabled","ng-option-selected","ng-optgroup","ng-option","ng-option-child","ng-option-marked"],["role","option",1,"ng-option",3,"ng-option-marked"],[1,"ng-option",3,"click","mouseover"],[1,"ng-option-label",3,"ngItemLabel","escape"],["role","option",1,"ng-option",3,"mouseover","click"],[1,"ng-tag-label"],[1,"ng-option","ng-option-disabled"]],template:function(r,a){if(1&r){const f=$i();Q(0,"div",9),At("mousedown",function(T){return Xt(f),Kt(a.handleMousedown(T))}),Q(1,"div",10)(2,"div",11),ge(3),J(),Jt(4,DZ,2,0)(5,MZ,1,5,null,12),Q(6,"div",13)(7,"input",14,0),At("input",function(){Xt(f);const T=as(8);return Kt(a.filter(T.value))})("compositionstart",function(){return Xt(f),Kt(a.onCompositionStart())})("compositionend",function(){Xt(f);const T=as(8);return Kt(a.onCompositionEnd(T.value))})("focus",function(T){return Xt(f),Kt(a.onInputFocus(T))})("blur",function(T){return Xt(f),Kt(a.onInputBlur(T))})("change",function(T){return Xt(f),Kt(T.stopPropagation())}),J()()(),Jt(9,OZ,3,1)(10,PZ,4,1,"span",15),Q(11,"span",16),un(12,"span",17),J()(),Jt(13,ZZ,8,17,"ng-dropdown-panel",18)}2&r&&(ji("ng-appearance-outline","outline"===a.appearance)("ng-has-value",a.hasValue),we(3),Qt(a.placeholder),we(),ur(a.multiLabelTemplate&&a.multiple||!(a.selectedItems.length>0)?-1:4),we(),ur(a.multiple&&a.multiLabelTemplate&&a.selectedValues.length>0?5:-1),we(),Qi("aria-expanded",a.isOpen)("aria-owns",a.isOpen?a.dropdownId:null),we(),Tt("readOnly",!a.searchable||a.itemsList.maxItemsSelected)("disabled",a.disabled)("value",a.searchTerm?a.searchTerm:""),Qi("id",a.labelForId)("tabindex",a.tabIndex)("aria-activedescendant",a.isOpen?null==a.itemsList||null==a.itemsList.markedItem?null:a.itemsList.markedItem.htmlId:null)("aria-controls",a.isOpen?a.dropdownId:null),we(2),ur(a.loading?9:-1),we(),ur(a.showClear()?10:-1),we(3),ur(a.isOpen?13:-1))},dependencies:[bw,k_,JB,QZ],styles:['@charset "UTF-8";.ng-select{position:relative;display:block;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.ng-select div,.ng-select input,.ng-select span{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.ng-select [hidden]{display:none}.ng-select.ng-select-searchable .ng-select-container .ng-value-container .ng-input{opacity:1}.ng-select.ng-select-opened .ng-select-container{z-index:1001}.ng-select.ng-select-disabled .ng-select-container .ng-value-container .ng-placeholder,.ng-select.ng-select-disabled .ng-select-container .ng-value-container .ng-value{-webkit-user-select:none;user-select:none;cursor:default}.ng-select.ng-select-disabled .ng-arrow-wrapper{cursor:default}.ng-select.ng-select-filtered .ng-placeholder{display:none}.ng-select .ng-select-container{cursor:default;display:flex;outline:none;overflow:hidden;position:relative;width:100%}.ng-select .ng-select-container .ng-value-container{display:flex;flex:1}.ng-select .ng-select-container .ng-value-container .ng-input{opacity:0}.ng-select .ng-select-container .ng-value-container .ng-input>input{box-sizing:content-box;background:none transparent;border:0 none;box-shadow:none;outline:none;padding:0;cursor:default;width:100%}.ng-select .ng-select-container .ng-value-container .ng-input>input::-ms-clear{display:none}.ng-select .ng-select-container .ng-value-container .ng-input>input[readonly]{-webkit-user-select:none;user-select:none;width:0;padding:0}.ng-select.ng-select-single.ng-select-filtered .ng-select-container .ng-value-container .ng-value{visibility:hidden}.ng-select.ng-select-single .ng-select-container .ng-value-container,.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-value{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-value .ng-value-icon{display:none}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-input{position:absolute;left:0;width:100%}.ng-select.ng-select-multiple.ng-select-disabled>.ng-select-container .ng-value-container .ng-value .ng-value-icon{display:none}.ng-select.ng-select-multiple .ng-select-container .ng-value-container{flex-wrap:wrap}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{position:absolute}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{white-space:nowrap}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value.ng-value-disabled .ng-value-icon{display:none}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value .ng-value-icon{cursor:pointer}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-input{flex:1;z-index:2}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{z-index:1}.ng-select .ng-clear-wrapper{cursor:pointer;position:relative;width:17px;-webkit-user-select:none;user-select:none}.ng-select .ng-clear-wrapper .ng-clear{display:inline-block;font-size:18px;line-height:1;pointer-events:none}.ng-select .ng-spinner-loader{border-radius:50%;width:17px;height:17px;margin-right:5px;font-size:10px;position:relative;text-indent:-9999em;border-top:2px solid rgba(66,66,66,.2);border-right:2px solid rgba(66,66,66,.2);border-bottom:2px solid rgba(66,66,66,.2);border-left:2px solid #424242;transform:translateZ(0);animation:load8 .8s infinite linear}.ng-select .ng-spinner-loader:after{border-radius:50%;width:17px;height:17px}@-webkit-keyframes load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.ng-select .ng-arrow-wrapper{cursor:pointer;position:relative;text-align:center;-webkit-user-select:none;user-select:none}.ng-select .ng-arrow-wrapper .ng-arrow{pointer-events:none;display:inline-block;height:0;width:0;position:relative}.ng-dropdown-panel{box-sizing:border-box;position:absolute;opacity:0;width:100%;z-index:1050;-webkit-overflow-scrolling:touch}.ng-dropdown-panel .ng-dropdown-panel-items{display:block;height:auto;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;max-height:240px;overflow-y:auto}.ng-dropdown-panel .ng-dropdown-panel-items .ng-optgroup{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option{box-sizing:border-box;cursor:pointer;display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option .ng-option-label:empty:before{content:"\\200b"}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option .highlighted{font-weight:700;text-decoration:underline}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option.disabled{cursor:default}.ng-dropdown-panel .scroll-host{overflow:hidden;overflow-y:auto;position:relative;display:block;-webkit-overflow-scrolling:touch}.ng-dropdown-panel .scrollable-content{top:0;left:0;width:100%;height:100%;position:absolute}.ng-dropdown-panel .total-padding{width:1px;opacity:0}\n'],encapsulation:2,changeDetection:0})}return e})();function yY(){return new vY}class vY{constructor(){this._selected=[]}get value(){return this._selected}select(n,t,r){if(n.selected=!0,(!n.children||!t&&r)&&this._selected.push(n),t)if(n.parent){const a=n.parent.children.length,f=n.parent.children.filter(_=>_.selected).length;n.parent.selected=a===f}else n.children&&(this._setChildrenSelectedState(n.children,!0),this._removeChildren(n),this._selected=r&&this._activeChildren(n)?[...this._selected.filter(a=>a.parent!==n),n]:[...this._selected,...n.children.filter(a=>!a.disabled)])}unselect(n,t){if(this._selected=this._selected.filter(r=>r!==n),n.selected=!1,t)if(n.parent&&n.parent.selected){const r=n.parent.children;this._removeParent(n.parent),this._removeChildren(n.parent),this._selected.push(...r.filter(a=>a!==n&&!a.disabled)),n.parent.selected=!1}else n.children&&(this._setChildrenSelectedState(n.children,!1),this._removeChildren(n))}clear(n){this._selected=n?this._selected.filter(t=>t.disabled):[]}_setChildrenSelectedState(n,t){for(const r of n)r.disabled||(r.selected=t)}_removeChildren(n){this._selected=[...this._selected.filter(t=>t.parent!==n),...n.children.filter(t=>t.parent===n&&t.disabled&&t.selected)]}_removeParent(n){this._selected=this._selected.filter(t=>t!==n)}_activeChildren(n){return n.children.every(t=>!t.disabled||t.selected)}}let bY=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({providers:[{provide:QB,useValue:yY}],imports:[yF]})}return e})();function xY(e,n){1&e&&un(0,"br")}function wY(e,n){if(1&e&&(Q(0,"div",62),ge(1),J()),2&e){const t=gt();we(),ol(" ",t.successMessage," ")}}function CY(e,n){if(1&e&&(Q(0,"div",66),ge(1),un(2,"button",67),J()),2&e){const t=gt(2);we(),ol(" ",t.messageAlegra," ")}}function TY(e,n){if(1&e&&(Q(0,"div",68),ge(1),un(2,"button",67),J()),2&e){const t=gt(2);we(),ol(" ",t.messageAlegra," ")}}function EY(e,n){if(1&e&&(Q(0,"div",63),Jt(1,CY,3,1,"div",64)(2,TY,3,1,"div",65),J()),2&e){const t=gt();we(),Tt("ngIf","201"==t.statusCodeAlegra),we(),Tt("ngIf","201"!=t.statusCodeAlegra)}}function DY(e,n){if(1&e&&(Q(0,"span"),ge(1),J()),2&e){const t=gt();we(),Qt(t.sortDirection)}}function SY(e,n){if(1&e&&(Q(0,"span"),ge(1),J()),2&e){const t=gt();we(),Qt(t.sortDirection)}}function MY(e,n){if(1&e&&(Q(0,"span"),ge(1),J()),2&e){const t=gt();we(),Qt(t.sortDirection)}}function IY(e,n){if(1&e&&(Q(0,"span"),ge(1),J()),2&e){const t=gt();we(),Qt(t.sortDirection)}}function AY(e,n){if(1&e&&(Q(0,"span"),ge(1),J()),2&e){const t=gt();we(),Qt(t.sortDirection)}}function OY(e,n){if(1&e&&(Q(0,"span"),ge(1),J()),2&e){const t=gt();we(),Qt(t.sortDirection)}}function PY(e,n){if(1&e&&(Q(0,"span"),ge(1),J()),2&e){const t=gt();we(),Qt(t.sortDirection)}}function RY(e,n){if(1&e){const t=$i();Q(0,"div",2)(1,"span",74),At("click",function(){Xt(t);const a=gt().$implicit;return Kt(gt().get_invoice(a.id))}),un(2,"i",75),J()()}}function NY(e,n){if(1&e){const t=$i();Q(0,"div",2)(1,"span",76),At("click",function(){Xt(t);const a=gt().$implicit;return Kt(gt().sync_allegra(a.order_number))}),un(2,"img",77),J()()}}function kY(e,n){if(1&e){const t=$i();Q(0,"div",2)(1,"span",76),At("click",function(){Xt(t);const a=gt().$implicit;return Kt(gt().delete_order(a.id))}),un(2,"i",78),J()()}}function FY(e,n){if(1&e){const t=$i();Q(0,"tr")(1,"td"),ge(2),J(),Q(3,"td"),ge(4),J(),Q(5,"td"),ge(6),J(),Q(7,"td"),ge(8),J(),Q(9,"td"),ge(10),J(),Q(11,"td"),ge(12),a2(13,"date"),J(),Q(14,"td"),ge(15),a2(16,"currency"),J(),Q(17,"td"),ge(18),J(),Q(19,"td")(20,"div",20)(21,"div",2)(22,"span",69),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().openEditModal(a,"update"))}),un(23,"i",70),J()(),Q(24,"div",2)(25,"span",71),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().openPdfModal(a.id))}),un(26,"i",72),J()(),Jt(27,RY,3,0,"div",73)(28,NY,3,0,"div",73)(29,kY,3,0,"div",73),J()()()}if(2&e){const t=n.$implicit;we(2),Qt(t.order_number),we(2),Qt(t.customer_email),we(2),Qt(t.customer_phone),we(2),Qt(t.customer_documentNumber),we(2),Qt(t.customer_name),we(2),Qt(function PN(e,n,t,r){const a=e+nt,f=mt(),_=bu(f,a);return lw(f,a)?SN(f,vo(),n,_.transform,t,r,_):_.transform(t,r)}(13,11,t.delivery_date,"yyyy-MM-dd")),we(3),Qt(function ON(e,n,t){const r=e+nt,a=mt(),f=bu(a,r);return lw(a,r)?DN(a,vo(),n,f.transform,t,f):f.transform(t)}(16,14,t.total)),we(3),Qt(t.status),we(9),Tt("ngIf","Facturada"===t.status),we(),Tt("ngIf","Facturada"!==t.status&&"Cancelada"!==t.status),we(),Tt("ngIf","Creada"===t.status)}}function LY(e,n){if(1&e&&(Q(0,"option",79),ge(1),J()),2&e){const t=n.$implicit;Tt("value",t),we(),Qt(t)}}function BY(e,n){if(1&e&&(Q(0,"option",79),ge(1),J()),2&e){const t=n.$implicit;Tt("value",t),we(),Qt(t)}}function zY(e,n){if(1&e&&(Q(0,"option",79),ge(1),J()),2&e){const t=n.$implicit;Tt("value",t),we(),Qt(t)}}function VY(e,n){if(1&e&&(Q(0,"option",79),ge(1),J()),2&e){const t=n.$implicit;Tt("value",t),we(),Qt(t)}}function UY(e,n){if(1&e){const t=$i();Q(0,"tr")(1,"ng-select",80),qt("ngModelChange",function(a){const f=Xt(t).$implicit;return Zt(f.id,a)||(f.id=a),Kt(a)}),At("change",function(){const a=Xt(t).$implicit;return Kt(gt().onProductSelect(a))}),J(),Q(2,"td")(3,"input",81),qt("ngModelChange",function(a){const f=Xt(t).$implicit;return Zt(f.sku,a)||(f.sku=a),Kt(a)}),J()(),Q(4,"td")(5,"input",82),qt("ngModelChange",function(a){const f=Xt(t).$implicit;return Zt(f.price_sale,a)||(f.price_sale=a),Kt(a)}),J()(),Q(6,"td")(7,"input",82),qt("ngModelChange",function(a){const f=Xt(t).$implicit;return Zt(f.quantity,a)||(f.quantity=a),Kt(a)}),J()(),Q(8,"td")(9,"input",83),qt("ngModelChange",function(a){const f=Xt(t).$implicit;return Zt(f.iva,a)||(f.iva=a),Kt(a)}),J()(),Q(10,"td")(11,"input",82),qt("ngModelChange",function(a){const f=Xt(t).$implicit;return Zt(f.iva_value,a)||(f.iva_value=a),Kt(a)}),J()(),Q(12,"td")(13,"button",84),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().removeProduct(a))}),un(14,"i",85),J()()()}if(2&e){const t=n.$implicit,r=gt();we(),uD("placeholder",t.name),Tt("items",r.products)("searchable",!0),Ht("ngModel",t.id),we(2),Ht("ngModel",t.sku),we(2),Ht("ngModel",t.price_sale),we(2),Ht("ngModel",t.quantity),we(2),Ht("ngModel",t.iva),we(2),Ht("ngModel",t.iva_value)}}let jY=(()=>{class e{constructor(t,r,a,f,_,T,D){this.orderService=t,this.router=r,this.productService=a,this.clienteService=f,this.sanitizer=_,this.alegraService=T,this.datePipe=D,this.searchText="",this.order={},this.product={},this.customers=[],this.actionType="",this.successMessage="",this.failedMessage="",this.documentTypes=[],this.paymentMethods=[],this.deliverySlots=[],this.orderStatus=["Creada","Confirmada","Despachada","Entregada","Facturada","Archivada"],this.products=[],this.selectedsku="",this.messageAlegra="",this.statusCodeAlegra="",this.sortColumn="",this.sortDirection="asc"}ngOnInit(){this.checkIfLoggedIn()?(this.getOrders(),this.orderService.getConfig().subscribe(r=>{this.documentTypes=r.document_type,this.paymentMethods=r.payments_method,this.deliverySlots=r.delivery_slots}),this.obtenerProductos(),this.getCustomers()):this.router.navigate(["/login"])}checkIfLoggedIn(){return!!localStorage.getItem("token")}getOrders(){this.orders=[],this.orderService.getOrders(this.datePipe.transform(this.searchDate,"yyyy-MM-dd")||"all").subscribe(t=>{this.orders=t,this.filteredOrders=t,this.filterOrders()})}filterOrders(){this.filteredOrders=""!==this.searchText.trim()?this.orders?.filter(t=>["order_number","customer_email","customer_phone","customer_documentNumber","customer_name","delivery_date","status"].some(r=>t[r]?.toLowerCase().includes(this.searchText.toLowerCase()))):this.orders}openEditModal(t,r){this.order=t,this.actionType=r}updated_order(){const t=new Date,r=t.getFullYear(),a=t.getMonth()+1,f=t.getDate(),_=t.getHours(),T=t.getMinutes(),D=t.getSeconds(),P=`${r}-${a.toString().padStart(2,"0")}-${f.toString().padStart(2,"0")} ${_.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`;this.order.total=parseFloat(this.order.total),this.order.updated_at=P,this.orderService.updateOrder(this.order.id,this.order).subscribe(L=>{}),this.getOrders()}created_order(){const t=new Date,r=t.getFullYear(),a=t.getMonth()+1,f=t.getDate(),_=t.getHours(),T=t.getMinutes(),D=t.getSeconds(),P=`${r}-${a.toString().padStart(2,"0")}-${f.toString().padStart(2,"0")} ${_.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`;this.order.created_at=P,this.order.updated_at=P,this.order.total=parseFloat(this.order.total),this.orderService.createOrder(this.order).subscribe(L=>{}),this.getOrders()}saveOrder(){"update"===this.actionType?(this.updated_order(),this.getOrders()):"new"===this.actionType&&(this.created_order(),this.getOrders())}camposCompletos(){const{order_number:t,customer_email:r,customer_phone:a,customer_documentNumber:f,customer_documentType:_,customer_name:T,delivery_date:D,status:P}=this.order;return!!(t&&r&&a&&f&&_&&T&&D&&P)}removeProduct(t){const r=this.order.products.indexOf(t);-1!==r&&this.order.products.splice(r,1)}addProduct(){this.order.products||(this.order.products=[]),this.order.products.push({sku:"",name:"",price_sale:0,quantity:1,iva:!1,iva_value:0})}obtenerProductos(){this.productService.getProducts().subscribe(t=>{this.products=t})}openPdfModal(t){this.pdfData=this.sanitizer.bypassSecurityTrustResourceUrl("https://app.buyfrescapp.com:5000/api/order/generate_pdf/"+t)}getCustomers(){this.clienteService.getClientes().subscribe(t=>{this.customers=t})}filteredCustomers(){return this.searchText?this.customers.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())):this.customers}onCustomerSelect(){const t=this.customers.find(r=>r.id===this.selectedCustomerId);t&&(this.order.customer_name=t.name,this.order.customer_email=t.email,this.order.customer_phone=t.phone,this.order.customer_documentNumber=t.document,this.order.customer_documentType=t.document_type,this.order.deliveryAddress=t.address)}onProductSelect(t){const r=this.products.find(a=>a.id===t.id);r&&(t.name=r.name,t.sku=r.sku,t.price_sale=r.price_sale,t.iva=r.iva,t.iva_value=r.iva_value)}sync_allegra(t){this.alegraService.send_invoice(t).subscribe(r=>{"201"==r.status?(this.statusCodeAlegra="201",this.messageAlegra=r.message||"Factura creada exitosamente."):this.messageAlegra=r.error?.message||"Ocurri\xf3 un error",this.getOrders()},r=>{this.statusCodeAlegra=r.status.toString(),this.messageAlegra=r.error?.message||"Ocurri\xf3 un error",this.getOrders()})}get_invoice(t){this.alegraService.get_invoice("215").subscribe(r=>{console.log(r.text)})}delete_order(t){this.orderService.deleteOrder(t).subscribe(r=>{this.getOrders()})}sort(t){console.log(t),this.filteredOrders&&0!==this.filteredOrders.length&&(this.sortColumn===t?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),this.filteredOrders.sort((r,a)=>{const f=r[this.sortColumn],_=a[this.sortColumn];return null==f?"asc"===this.sortDirection?1:-1:null==_||f<_?"asc"===this.sortDirection?-1:1:f>_?"asc"===this.sortDirection?1:-1:0}))}static#e=this.\u0275fac=function(r){return new(r||e)(tt($B),tt(cs),tt(GA),tt(hO),tt(Ew),tt(GW),tt(xw))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-orders"]],decls:181,vars:36,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"col-5"],["type","text","placeholder","Buscar orden...",1,"form-control",3,"ngModelChange","keyup","ngModel"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["class","position-fixed top-0 end-0 p-3","style","z-index: 11",4,"ngIf"],[1,"table"],[3,"click"],[4,"ngFor","ngForOf"],["id","editOrderModal","tabindex","-1","role","dialog",1,"modal","fade","bd-example-modal-lg"],["role","document",1,"modal-dialog","modal-dialog-centered",2,"max-width","80%"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"container-fluid"],[1,"row"],[1,"col-6"],[1,"form-group"],["for","documentType"],["bindLabel","name","bindValue","id","placeholder","Escribe para buscar...",3,"ngModelChange","change","items","searchable","ngModel"],["for","order_number"],["type","text","id","order_number","name","order_number",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_email"],["type","email","id","customer_email","name","customer_email",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_phone"],["type","text","id","customer_phone","name","customer_phone",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_documentNumber"],["type","text","id","customer_documentNumber","name","customer_documentNumber",1,"form-control",3,"ngModelChange","ngModel"],["id","documentType","name","documentType",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","customer_name"],["type","text","id","customer_name","name","customer_name",1,"form-control",3,"ngModelChange","ngModel"],["for","delivery_date"],["type","date","id","delivery_date","name","delivery_date",1,"form-control",3,"ngModelChange","ngModel"],["for","status"],["id","status","name","status",1,"form-control",3,"ngModelChange","ngModel"],["for","total"],["type","number","id","total","name","total",1,"form-control",3,"ngModelChange","ngModel"],["for","deliverySlot"],["id","deliverySlot","name","deliverySlot",1,"form-control",3,"ngModelChange","ngModel"],["for","paymentMethod"],["id","paymentMethod","name","paymentMethod",1,"form-control",3,"ngModelChange","ngModel"],["for","deliveryAddress"],["type","text","id","deliveryAddress","name","deliveryAddress",1,"form-control",3,"ngModelChange","ngModel"],["for","deliveryAddressDetails"],["type","text","id","deliveryAddressDetails","name","deliveryAddressDetails",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12"],[1,"col-4"],["type","button",1,"btn","btn-primary",3,"click"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["id","pdfModal","tabindex","-1","role","dialog","aria-labelledby","pdfModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-lg"],["id","pdfModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["type","application/pdf","width","100%","height","600px",3,"src"],["id","facturaModal","tabindex","-1","role","dialog","aria-labelledby","facturaLabel","aria-hidden","true",1,"modal","fade"],["role","alert",1,"alert","alert-success"],[1,"position-fixed","top-0","end-0","p-3",2,"z-index","11"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],["data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-pencil-alt","fa-lg","text-primary"],["data-bs-toggle","modal","data-bs-target","#pdfModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-danger"],["class","col-auto",4,"ngIf"],["data-bs-toggle","modal","data-bs-target","#facturaModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-primary"],[2,"cursor","pointer",3,"click"],["src","assets/alegra.png","alt","icono",2,"width","24px","height","24px"],[1,"fas","fa-trash","fa-lg","text-danger"],[3,"value"],["bindLabel","name","bindValue","id",3,"ngModelChange","change","items","searchable","placeholder","ngModel"],["type","text",1,"form-control",3,"ngModelChange","ngModel"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],["type","checkbox",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),At("click",function(){return a.openEditModal({},"new")}),ge(4,"Nueva Orden"),J()(),Q(5,"div",4)(6,"input",5),qt("ngModelChange",function(_){return Zt(a.searchText,_)||(a.searchText=_),_}),At("keyup",function(){return a.filterOrders()}),J()(),Q(7,"div",2)(8,"input",6),qt("ngModelChange",function(_){return Zt(a.searchDate,_)||(a.searchDate=_),_}),At("change",function(){return a.getOrders()}),J()()(),Jt(9,xY,1,0,"br",7)(10,wY,2,1,"div",8)(11,EY,3,2,"div",9),un(12,"br"),Q(13,"table",10)(14,"thead")(15,"tr")(16,"th",11),At("click",function(){return a.sort("order_number")}),ge(17,"N\xfamero de Orden "),Jt(18,DY,2,1,"span",7),J(),Q(19,"th",11),At("click",function(){return a.sort("customer_email")}),ge(20,"Email del Cliente "),Jt(21,SY,2,1,"span",7),J(),Q(22,"th",11),At("click",function(){return a.sort("customer_phone")}),ge(23,"Tel\xe9fono del Cliente "),Jt(24,MY,2,1,"span",7),J(),Q(25,"th",11),At("click",function(){return a.sort("customer_documentNumber")}),ge(26,"Documento del Cliente "),Jt(27,IY,2,1,"span",7),J(),Q(28,"th",11),At("click",function(){return a.sort("customer_name")}),ge(29,"Nombre del Cliente "),Jt(30,AY,2,1,"span",7),J(),Q(31,"th",11),At("click",function(){return a.sort("delivery_date")}),ge(32,"Fecha de Entrega "),Jt(33,OY,2,1,"span",7),J(),Q(34,"th"),ge(35,"total"),J(),Q(36,"th",11),At("click",function(){return a.sort("status")}),ge(37,"Estado "),Jt(38,PY,2,1,"span",7),J(),Q(39,"th"),ge(40,"Acciones"),J()()(),Q(41,"tbody"),Jt(42,FY,30,16,"tr",12),J()()(),Q(43,"div",13)(44,"div",14)(45,"div",15)(46,"div",16)(47,"h5",17),ge(48,"Editar Orden"),J()(),Q(49,"div",18)(50,"div",19)(51,"div",20)(52,"div",21)(53,"div",22)(54,"label",23),ge(55,"Cliente:"),J(),Q(56,"ng-select",24),qt("ngModelChange",function(_){return Zt(a.selectedCustomerId,_)||(a.selectedCustomerId=_),_}),At("change",function(){return a.onCustomerSelect()}),J()()(),Q(57,"div",21)(58,"div",22)(59,"label",25),ge(60,"N\xfamero de Orden:"),J(),Q(61,"input",26),qt("ngModelChange",function(_){return Zt(a.order.order_number,_)||(a.order.order_number=_),_}),J()()(),Q(62,"div",21)(63,"div",22)(64,"label",27),ge(65,"Email del Cliente:"),J(),Q(66,"input",28),qt("ngModelChange",function(_){return Zt(a.order.customer_email,_)||(a.order.customer_email=_),_}),J()()()(),Q(67,"div",20)(68,"div",21)(69,"div",22)(70,"label",29),ge(71,"Tel\xe9fono del Cliente:"),J(),Q(72,"input",30),qt("ngModelChange",function(_){return Zt(a.order.customer_phone,_)||(a.order.customer_phone=_),_}),J()()(),Q(73,"div",21)(74,"div",22)(75,"label",31),ge(76,"N\xfamero de Documento del Cliente:"),J(),Q(77,"input",32),qt("ngModelChange",function(_){return Zt(a.order.customer_documentNumber,_)||(a.order.customer_documentNumber=_),_}),J()()()(),Q(78,"div",20)(79,"div",21)(80,"div",22)(81,"label",23),ge(82,"Tipo de Documento:"),J(),Q(83,"select",33),qt("ngModelChange",function(_){return Zt(a.order.customer_documentType,_)||(a.order.customer_documentType=_),_}),Jt(84,LY,2,2,"option",34),J()()(),Q(85,"div",21)(86,"div",22)(87,"label",35),ge(88,"Nombre del Cliente:"),J(),Q(89,"input",36),qt("ngModelChange",function(_){return Zt(a.order.customer_name,_)||(a.order.customer_name=_),_}),J()()()(),Q(90,"div",20)(91,"div",21)(92,"div",22)(93,"label",37),ge(94,"Fecha de Entrega:"),J(),Q(95,"input",38),qt("ngModelChange",function(_){return Zt(a.order.delivery_date,_)||(a.order.delivery_date=_),_}),J()()(),Q(96,"div",21)(97,"div",22)(98,"label",39),ge(99,"Estado:"),J(),Q(100,"select",40),qt("ngModelChange",function(_){return Zt(a.order.status,_)||(a.order.status=_),_}),Jt(101,BY,2,2,"option",34),J()()()(),Q(102,"div",20)(103,"div",21)(104,"div",22)(105,"label",41),ge(106,"Total:"),J(),Q(107,"input",42),qt("ngModelChange",function(_){return Zt(a.order.total,_)||(a.order.total=_),_}),J()()(),Q(108,"div",21)(109,"div",22)(110,"label",43),ge(111,"Horario de Entrega:"),J(),Q(112,"select",44),qt("ngModelChange",function(_){return Zt(a.order.deliverySlot,_)||(a.order.deliverySlot=_),_}),Jt(113,zY,2,2,"option",34),J()()()(),Q(114,"div",22)(115,"label",45),ge(116,"M\xe9todo de Pago:"),J(),Q(117,"select",46),qt("ngModelChange",function(_){return Zt(a.order.paymentMethod,_)||(a.order.paymentMethod=_),_}),Jt(118,VY,2,2,"option",34),J()(),Q(119,"div",22)(120,"label",47),ge(121,"Direcci\xf3n de Entrega:"),J(),Q(122,"input",48),qt("ngModelChange",function(_){return Zt(a.order.deliveryAddress,_)||(a.order.deliveryAddress=_),_}),J()(),Q(123,"div",22)(124,"label",49),ge(125,"Detalles de la Direcci\xf3n de Entrega:"),J(),Q(126,"input",50),qt("ngModelChange",function(_){return Zt(a.order.deliveryAddressDetails,_)||(a.order.deliveryAddressDetails=_),_}),J()(),un(127,"br")(128,"br"),Q(129,"div",20)(130,"div",51)(131,"table",10)(132,"thead")(133,"tr")(134,"th",52),ge(135,"Producto"),J(),Q(136,"th"),ge(137,"sku"),J(),Q(138,"th"),ge(139,"Precio Venta"),J(),Q(140,"th"),ge(141,"Cantidad"),J(),Q(142,"th"),ge(143,"IVA"),J(),Q(144,"th"),ge(145,"Valor IVA"),J(),Q(146,"th"),ge(147,"Acciones"),J()()(),Q(148,"tbody"),Jt(149,UY,15,9,"tr",12),J()(),Q(150,"button",53),At("click",function(){return a.addProduct()}),ge(151,"Agregar Producto"),J()()()()(),Q(152,"div",54)(153,"button",55),ge(154,"Cerrar"),J(),Q(155,"button",53),At("click",function(){return a.saveOrder()}),ge(156,"Guardar Cambios"),J()()()()(),Q(157,"div",56)(158,"div",57)(159,"div",15)(160,"div",16)(161,"h5",58),ge(162,"Remisi\xf3n"),J(),un(163,"button",59),J(),Q(164,"div",18),un(165,"iframe",60),J(),Q(166,"div",54)(167,"button",55),ge(168,"Cerrar"),J()()()()(),Q(169,"div",61)(170,"div",57)(171,"div",15)(172,"div",16)(173,"h5",58),ge(174,"Factura"),J(),un(175,"button",59),J(),Q(176,"div",18),un(177,"iframe",60),J(),Q(178,"div",54)(179,"button",55),ge(180,"Cerrar"),J()()()()()),2&r&&(we(6),Ht("ngModel",a.searchText),we(2),Ht("ngModel",a.searchDate),we(),Tt("ngIf",a.successMessage),we(),Tt("ngIf",a.successMessage),we(),Tt("ngIf",a.statusCodeAlegra),we(7),Tt("ngIf","order_number"===a.sortColumn),we(3),Tt("ngIf","customer_email"===a.sortColumn),we(3),Tt("ngIf","customer_phone"===a.sortColumn),we(3),Tt("ngIf","customer_documentNumber"===a.sortColumn),we(3),Tt("ngIf","customer_name"===a.sortColumn),we(3),Tt("ngIf","delivery_date"===a.sortColumn),we(5),Tt("ngIf","status"===a.sortColumn),we(4),Tt("ngForOf",a.filteredOrders),we(14),Tt("items",a.customers)("searchable",!0),Ht("ngModel",a.selectedCustomerId),we(5),Ht("ngModel",a.order.order_number),we(5),Ht("ngModel",a.order.customer_email),we(6),Ht("ngModel",a.order.customer_phone),we(5),Ht("ngModel",a.order.customer_documentNumber),we(6),Ht("ngModel",a.order.customer_documentType),we(),Tt("ngForOf",a.documentTypes),we(5),Ht("ngModel",a.order.customer_name),we(6),Ht("ngModel",a.order.delivery_date),we(5),Ht("ngModel",a.order.status),we(),Tt("ngForOf",a.orderStatus),we(6),Ht("ngModel",a.order.total),we(5),Ht("ngModel",a.order.deliverySlot),we(),Tt("ngForOf",a.deliverySlots),we(4),Ht("ngModel",a.order.paymentMethod),we(),Tt("ngForOf",a.paymentMethods),we(4),Ht("ngModel",a.order.deliveryAddress),we(4),Ht("ngModel",a.order.deliveryAddressDetails),we(23),Tt("ngForOf",a.order.products),we(16),Tt("src",a.pdfData,Mu),we(12),Tt("src",a.facturaData,Mu))},dependencies:[Lf,jc,r1,o1,Os,Yw,HA,Pm,ga,Qs,_Y,_F,xw]})}return e})(),a1=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/",this._username=""}login(t,r){return this.http.post(this.baseUrl+"api/user/login",{user:t,password:r}).pipe(q(a=>(a.token&&localStorage.setItem("token",a.token),a)))}logout(t){const r={headers:new La({Authorization:`Bearer ${t}`})};return this.http.post(this.baseUrl+"api/user/logout",{},r)}checkToken(t){const r={headers:new La({Authorization:`Bearer ${t}`})};return this.http.post(this.baseUrl+"api/user/check_token",{},r)}changePassword(t,r){return this.http.post(this.baseUrl+"api/user/restore",{password:r,user_id:t})}deleteAccount(t,r){return this.http.post(this.baseUrl+"api/user/delete_account",{password:r,user_email:t})}setUsername(t){this._username=t}getUsername(){return this._username}static#e=this.\u0275fac=function(r){return new(r||e)($t(zf))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),$Y=(()=>{class e{constructor(t,r){this.authService=t,this.router=r,this.username="",this.password=""}login(){""!==this.username&&""!==this.password?this.authService.login(this.username,this.password).subscribe(()=>{this.authService.setUsername(this.username),this.router.navigate(["/home"])},t=>{console.error("Error al iniciar sesi\xf3n:",t),alert("Nombre de usuario o contrase\xf1a incorrectos.")}):alert("Por favor, ingrese nombre de usuario y contrase\xf1a.")}static#e=this.\u0275fac=function(r){return new(r||e)(tt(a1),tt(cs))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-login"]],decls:14,vars:2,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-12","text-center"],["src","assets\\icon_app.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"col-12"],[1,"container-fluid"],[1,"form-group"],["type","text","id","username","placeholder","Usuario",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-primary","btn-block",3,"click"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2),un(3,"img",3),J(),Q(4,"div",4)(5,"div",5)(6,"div",6)(7,"input",7),qt("ngModelChange",function(_){return Zt(a.username,_)||(a.username=_),_}),J()(),un(8,"br"),Q(9,"div",6)(10,"input",8),qt("ngModelChange",function(_){return Zt(a.password,_)||(a.password=_),_}),J()(),un(11,"br"),Q(12,"button",9),At("click",function(){return a.login()}),ge(13,"Iniciar Sesi\xf3n"),J()()()()()),2&r&&(we(7),Ht("ngModel",a.username),we(3),Ht("ngModel",a.password))},dependencies:[Os,ga,Qs]})}return e})(),ez=(()=>{class e{constructor(t,r){this.authService=t,this.router=r,this.isLoggedIn=!1}ngOnInit(){this.checkToken()}checkToken(){const t=localStorage.getItem("token");t?this.authService.checkToken(t).subscribe(()=>{this.isLoggedIn=!0},r=>{console.error("Error al verificar el token:",r),this.isLoggedIn=!1,this.router.navigate(["/login"])}):(this.isLoggedIn=!1,this.router.navigate(["/login"]))}redirectToLogin(){this.router.navigate(["/login"])}static#e=this.\u0275fac=function(r){return new(r||e)(tt(a1),tt(cs))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-home"]],decls:38,vars:0,consts:[[1,"container","mt-5"],[1,"row"],[1,"col-md-3","mb-4"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["routerLink","/productos",1,"btn","btn-primary","btn-block"],["routerLink","/ordenes",1,"btn","btn-primary","btn-block"],["routerLink","/clientes",1,"btn","btn-primary","btn-block"],["routerLink","/reports",1,"btn","btn-primary","btn-block"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),ge(6,"Productos"),J(),Q(7,"p",6),ge(8,"Administrar productos"),J(),Q(9,"button",7),ge(10,"Ver productos"),J()()()(),Q(11,"div",2)(12,"div",3)(13,"div",4)(14,"h5",5),ge(15,"\xd3rdenes"),J(),Q(16,"p",6),ge(17,"Administrar \xf3rdenes"),J(),Q(18,"button",8),ge(19,"Ver \xf3rdenes"),J()()()(),Q(20,"div",2)(21,"div",3)(22,"div",4)(23,"h5",5),ge(24,"Clientes"),J(),Q(25,"p",6),ge(26,"Administrar clientes"),J(),Q(27,"button",9),ge(28,"Ver clientes"),J()()()(),Q(29,"div",2)(30,"div",3)(31,"div",4)(32,"h5",5),ge(33,"Reportes"),J(),Q(34,"p",6),ge(35,"Ver reportes"),J(),Q(36,"button",10),ge(37,"Ver reportes"),J()()()()()())},dependencies:[e1]})}return e})(),GY=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-reports"]],decls:38,vars:0,consts:[[1,"container","mt-5"],[1,"row"],[1,"col-md-3","mb-4"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["routerLink","/reports/picking",1,"btn","btn-primary","btn-block"],["routerLink","/reports/cotizar",1,"btn","btn-primary","btn-block"],["routerLink","/reports/integrar",1,"btn","btn-primary","btn-block"],["href","https://app.buyfrescapp.com:5000/api/order/orders/csv"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),ge(6,"Picking"),J(),Q(7,"p",6),ge(8,"Ordenes a entregar"),J(),Q(9,"button",7),ge(10,"Ver Picking"),J()()()(),Q(11,"div",2)(12,"div",3)(13,"div",4)(14,"h5",5),ge(15,"Cotizar"),J(),Q(16,"p",6),ge(17,"Cotizar productos"),J(),Q(18,"button",8),ge(19,"Cotizar"),J()()()(),Q(20,"div",2)(21,"div",3)(22,"div",4)(23,"h5",5),ge(24,"Integraci\xf3n"),J(),Q(25,"p",6),ge(26,"Integrar pedidos p\xe1gina"),J(),Q(27,"button",9),ge(28,"Integrar"),J()()()(),Q(29,"div",2)(30,"div",3)(31,"div",4)(32,"h5",5),ge(33,"Descargas"),J(),Q(34,"p",6),ge(35,"Descargar hist\xf3rico de ordenes "),J(),Q(36,"a",10),ge(37,"Ordenes en CSV"),J()()()()()())},dependencies:[e1]})}return e})();function HY(e,n){if(1&e&&(Q(0,"div",12),ge(1),J()),2&e){const t=gt();we(),Qt(t.mensajeError)}}function qY(e,n){if(1&e&&(Q(0,"div",13),ge(1),J()),2&e){const t=gt();we(),Qt(t.mensajeSuccess)}}let WY=(()=>{class e{constructor(t,r){this.route=t,this.authService=r,this.password1="",this.password2="",this.mensajeError="",this.mensajeSuccess="",this.user_id=""}ngOnInit(){this.route.params.subscribe(t=>{this.user_id=t.user_id})}restablecer(){this.password1===this.password2?this.user_id?this.authService.changePassword(this.user_id,this.password1).subscribe(()=>{this.mensajeSuccess="Se realiz\xf3 el cambio de contrase\xf1a correctamente, vuelve a intentar ingresar en la app. Gracias."},t=>{this.mensajeError="No se realiz\xf3 el cambio de contrase\xf1a, por favor intentalo m\xe1s tarde o comun\xedcate a nuestro Whatsapp 3115455042"}):this.mensajeError="No se encontr\xf3 el user_id. Por favor intenta nuevamente.":this.mensajeError="Las contrase\xf1as no coinciden."}static#e=this.\u0275fac=function(r){return new(r||e)(tt(gh),tt(a1))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-restore-password"]],decls:18,vars:4,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-auto","text-center"],["src","assets\\banner.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"col-auto"],[1,"container-fluid"],[1,"form-group"],["type","password","id","password1","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password2","placeholder","Confirmar Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn",2,"background-color","#97D700",3,"click"],["class","text-danger",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"text-danger"],[1,"text-success"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2),un(3,"img",3),J(),Q(4,"div",4)(5,"div",5),un(6,"br")(7,"br"),Q(8,"div",6)(9,"input",7),qt("ngModelChange",function(_){return Zt(a.password1,_)||(a.password1=_),_}),J()(),un(10,"br"),Q(11,"div",6)(12,"input",8),qt("ngModelChange",function(_){return Zt(a.password2,_)||(a.password2=_),_}),J()(),un(13,"br"),Q(14,"button",9),At("click",function(){return a.restablecer()}),ge(15,"Reestablecer"),J(),Jt(16,HY,2,1,"div",10)(17,qY,2,1,"div",11),J()()()()),2&r&&(we(9),Ht("ngModel",a.password1),we(3),Ht("ngModel",a.password2),we(4),Tt("ngIf",a.mensajeError),we(),Tt("ngIf",a.mensajeSuccess))},dependencies:[jc,Os,ga,Qs]})}return e})();function ZY(e,n){if(1&e&&(Q(0,"div",12),ge(1),J()),2&e){const t=gt();we(),Qt(t.mensajeError)}}function YY(e,n){if(1&e&&(Q(0,"div",13),ge(1),J()),2&e){const t=gt();we(),Qt(t.mensajeSuccess)}}let XY=(()=>{class e{constructor(t,r){this.route=t,this.authService=r,this.password="",this.mensajeError="",this.mensajeSuccess="",this.user_email="",this.route.queryParams.subscribe(a=>{this.user_email=a.user_id})}delete(){this.authService.deleteAccount(this.user_email,this.password).subscribe(()=>{this.mensajeSuccess="Se elimin\xf3 la cuenta "+this.user_email+" correctamente"},t=>{this.mensajeError="No se elimin\xf3 correctamente la cuenta, por favor comunicate con nuestro Whatsapp 3115455042"})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(gh),tt(a1))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-delete-account"]],decls:18,vars:4,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-auto","text-center"],["src","assets\\banner.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"col-auto"],[1,"container-fluid"],[1,"form-group"],["type","email","id","email","placeholder","Email",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn",2,"background-color","#97D700",3,"click"],["class","text-danger",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"text-danger"],[1,"text-success"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2),un(3,"img",3),J(),Q(4,"div",4)(5,"div",5),un(6,"br")(7,"br"),Q(8,"div",6)(9,"input",7),qt("ngModelChange",function(_){return Zt(a.user_email,_)||(a.user_email=_),_}),J()(),un(10,"br"),Q(11,"div",6)(12,"input",8),qt("ngModelChange",function(_){return Zt(a.password,_)||(a.password=_),_}),J()(),un(13,"br"),Q(14,"button",9),At("click",function(){return a.delete()}),ge(15,"Eliminar cuenta"),J(),Jt(16,ZY,2,1,"div",10)(17,YY,2,1,"div",11),J()()()()),2&r&&(we(9),Ht("ngModel",a.user_email),we(3),Ht("ngModel",a.password),we(4),Tt("ngIf",a.mensajeError),we(),Tt("ngIf",a.mensajeSuccess))},dependencies:[jc,Os,ga,Qs]})}return e})(),KY=(()=>{class e{constructor(t){this.sanitizer=t,this.fecha="",this.pdfPicking=""}generarPDF(){this.pdfPicking=this.sanitizer.bypassSecurityTrustResourceUrl("https://app.buyfrescapp.com:5000/api/reports/picking/"+this.fecha)}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Ew))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-picking"]],decls:18,vars:2,consts:[[1,"container"],[1,"row","justify-content-center","mt-5"],[1,"col-md-6"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],["type","application/pdf","width","100%","height","600px",3,"src"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3"),ge(6,"Generar Archivo PDF con Picking"),J()(),Q(7,"div",5)(8,"div",6)(9,"label",7),ge(10,"Fecha:"),J(),Q(11,"input",8),qt("ngModelChange",function(_){return Zt(a.fecha,_)||(a.fecha=_),_}),J()(),un(12,"br"),Q(13,"div",9)(14,"button",10),At("click",function(){return a.generarPDF()}),ge(15,"Generar PDF"),J()()()()()(),Q(16,"div",1),un(17,"iframe",11),J()()),2&r&&(we(11),Ht("ngModel",a.fecha),we(6),Tt("src",a.pdfPicking,Mu))},dependencies:[Os,ga,Qs]})}return e})(),JY=(()=>{class e{constructor(t){this.sanitizer=t,this.fecha="",this.pdfPicking="",this.supplier="Todos"}generarPDF(){this.pdfPicking=this.sanitizer.bypassSecurityTrustResourceUrl("https://app.buyfrescapp.com:5000/api/reports/compras/"+this.fecha+"/"+this.supplier)}static#e=this.\u0275fac=function(r){return new(r||e)(tt(Ew))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-compras"]],decls:31,vars:3,consts:[[1,"container"],[1,"row","justify-content-center","mt-5"],[1,"col-md-6"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","mt-3"],["for","proveedor"],["id","proveedor","name","proveedor",1,"form-control",3,"ngModelChange","ngModel"],["value","Todos"],["value","Angelyn"],["value","Marko"],["value","abastos"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],[1,"col-md-12"],["type","application/pdf","width","100%","height","600px",3,"src"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3"),ge(6,"Generar Archivo PDF con Compras"),J()(),Q(7,"div",5)(8,"div",6)(9,"label",7),ge(10,"Fecha:"),J(),Q(11,"input",8),qt("ngModelChange",function(_){return Zt(a.fecha,_)||(a.fecha=_),_}),J()(),Q(12,"div",9)(13,"label",10),ge(14,"Proveedor:"),J(),Q(15,"select",11),qt("ngModelChange",function(_){return Zt(a.supplier,_)||(a.supplier=_),_}),Q(16,"option",12),ge(17,"Todos"),J(),Q(18,"option",13),ge(19,"Anyelin"),J(),Q(20,"option",14),ge(21,"Marko"),J(),Q(22,"option",15),ge(23,"abastos"),J()()(),un(24,"br"),Q(25,"div",16)(26,"button",17),At("click",function(){return a.generarPDF()}),ge(27,"Generar PDF"),J()()()()()(),Q(28,"div",1)(29,"div",18),un(30,"iframe",19),J()()()),2&r&&(we(11),Ht("ngModel",a.fecha),we(4),Ht("ngModel",a.supplier),we(15),Tt("src",a.pdfPicking,Mu))},dependencies:[r1,o1,Os,Pm,ga,Qs]})}return e})(),QY=(()=>{class e{constructor(t){this.productService=t,this.fecha="",this.products=[],this.price=0,this.searchTerm=""}ngOnInit(){this.getProducts()}getProducts(){this.productService.getProducts().subscribe(t=>{this.products=t})}cotizarProducto(){}filterProducts(){}static#e=this.\u0275fac=function(r){return new(r||e)(tt(GA))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-cotizar"]],decls:14,vars:3,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-10"],["type","text","placeholder","Precio",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-2"],[1,"btn","btn-primary",3,"click"],["type","text","placeholder","Buscar producto",1,"form-control",3,"ngModelChange","input","ngModel"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"label",2),ge(3,"Fecha:"),J(),Q(4,"input",3),qt("ngModelChange",function(_){return Zt(a.fecha,_)||(a.fecha=_),_}),J()(),Q(5,"div",1)(6,"div",4)(7,"input",5),qt("ngModelChange",function(_){return Zt(a.price,_)||(a.price=_),_}),J()(),Q(8,"div",6)(9,"button",7),At("click",function(){return a.cotizarProducto()}),ge(10,"Cotizar"),J()()(),un(11,"br"),Q(12,"div",1)(13,"input",8),qt("ngModelChange",function(_){return Zt(a.products,_)||(a.products=_),_}),At("input",function(){return a.filterProducts()}),J()()()),2&r&&(we(4),Ht("ngModel",a.fecha),we(3),Ht("ngModel",a.price),we(6),Ht("ngModel",a.products))},dependencies:[Os,ga,Qs]})}return e})(),eX=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}get_order(t){return console.log(t),this.http.get(this.baseUrl+"api/woo/get_order/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)($t(zf))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function tX(e,n){if(1&e&&(Q(0,"div",7),ge(1),un(2,"button",8),J()),2&e){const t=gt();Tt("ngClass",t.alertClass),we(),ol(" ",t.message," ")}}let nX=(()=>{class e{constructor(t){this.wooService=t,this.orderNumber="",this.message="",this.alertClass=""}ngOnInit(){}sendOrder(t){this.wooService.get_order(t).subscribe(r=>{r?(this.message=r.message||"Order sent successfully",this.alertClass="alert alert-success"):(this.message=r.message||"Failed to send the order",this.alertClass="alert alert-danger")})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(eX))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-integrar"]],decls:12,vars:2,consts:[[1,"container"],[1,"row"],[1,"col-auto"],["type","text","placeholder","Enter Order Number",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"col"],["class","alert alert-dismissible fade show","role","alert",3,"ngClass",4,"ngIf"],["role","alert",1,"alert","alert-dismissible","fade","show",3,"ngClass"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"]],template:function(r,a){1&r&&(un(0,"br")(1,"br"),Q(2,"div",0)(3,"div",1)(4,"div",2)(5,"input",3),qt("ngModelChange",function(_){return Zt(a.orderNumber,_)||(a.orderNumber=_),_}),J()(),Q(6,"div",2)(7,"button",4),At("click",function(){return a.sendOrder(a.orderNumber)}),ge(8,"Sincronizar Orden"),J()()(),Q(9,"div",1)(10,"div",5),Jt(11,tX,3,2,"div",6),J()()()),2&r&&(we(5),Ht("ngModel",a.orderNumber),we(6),Tt("ngIf",a.message))},dependencies:[bw,jc,Os,ga,Qs]})}return e})(),tz=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getPurchases(){return this.http.get(this.baseUrl+"api/purchase/purchases")}getPurchase(t){return this.http.get(this.baseUrl+"api/purchase/purchase/"+t)}updatePurchase(t){return this.http.put(`${this.baseUrl}/${t._id}`,t)}deletePurchase(t){return this.http.delete(this.baseUrl+"api/purchase/purchase/"+t)}createPurchase(t){return this.http.get(this.baseUrl+"api/purchase/create/"+t)}updatePrice(t){return this.http.post(`${this.baseUrl}api/purchase/update_price`,t)}getReport(t){return`${this.baseUrl}api/purchase/purchase/report/${t}`}static#e=this.\u0275fac=function(r){return new(r||e)($t(zf))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function iX(e,n){if(1&e&&(Q(0,"div",28),ge(1),un(2,"button",29),J()),2&e){const t=gt();we(),ol(" ",t.messagePurchase," ")}}function rX(e,n){if(1&e){const t=$i();Q(0,"tr")(1,"td",30),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().navigateToPurchase(a.purchase_number))}),ge(2),J(),Q(3,"td",30),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().navigateToPurchase(a.purchase_number))}),ge(4),J(),Q(5,"td",30),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().navigateToPurchase(a.purchase_number))}),ge(6),J(),Q(7,"td",30),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().navigateToPurchase(a.purchase_number))}),ge(8),J(),Q(9,"td")(10,"div",31)(11,"div",4)(12,"span",32),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().openPdfModal(a.purchase_number))}),un(13,"i",33),J()(),Q(14,"div",4)(15,"span",34),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().delete_purchase(a.purchase_number))}),un(16,"i",35),J()()()()()}if(2&e){const t=n.$implicit;we(2),Qt(t.purchase_number),we(2),Qt(t.date),we(2),Qt(t.products.length),we(2),Qt(t.status)}}let oX=(()=>{class e{constructor(t,r,a){this.purchaseService=t,this.router=r,this.sanitizer=a,this.purchases=[],this.filteredPurchases=[],this.searchText="",this.fechaNewOrder="",this.messagePurchase="",this.statusCodePurchase=""}ngOnInit(){this.getPurchases()}navigateToPurchase(t){this.router.navigate(["/purchase",t])}filterPurchases(){this.filteredPurchases=""!==this.searchText.trim()?this.purchases.filter(t=>t.purchase_number.toLowerCase().includes(this.searchText.toLowerCase())):this.purchases}newPurchase(){this.purchaseService.createPurchase(this.fechaNewOrder).subscribe(t=>{this.getPurchases(),this.messagePurchase="Orden de compra creada exitosamente!",this.statusCodePurchase=t.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},t=>{this.messagePurchase="Fallo al crear la Orden de compra.",this.statusCodePurchase=t.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)})}getPurchases(){this.purchaseService.getPurchases().subscribe(t=>{this.purchases=t})}openPdfModal(t){this.pdfData=this.sanitizer.bypassSecurityTrustResourceUrl(this.purchaseService.getReport(t))}delete_purchase(t){this.purchaseService.deletePurchase(t).subscribe(r=>{this.getPurchases(),this.messagePurchase="Orden de compra eliminada exitosamente!",this.statusCodePurchase=r.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},r=>{this.messagePurchase="Fallo al eliminar la Orden de compra.",this.statusCodePurchase=r.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(tz),tt(cs),tt(Ew))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-purchases"]],decls:51,vars:5,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-6"],["type","text","placeholder","Buscar compra...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#newPurchase","data-bs-dismiss","modal",1,"btn","btn-primary"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","newPurchase","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","newPurchase",1,"modal-title"],[1,"modal-body"],[1,"container"],[1,"form-group"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],["id","pdfModal","tabindex","-1","role","dialog","aria-labelledby","pdfModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-lg"],["id","pdfModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["type","application/pdf","width","100%","height","600px",3,"src"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[3,"click"],[1,"row"],["data-bs-toggle","modal","data-bs-target","#pdfModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-primary"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-trash","fa-lg","text-danger"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),qt("ngModelChange",function(_){return Zt(a.searchText,_)||(a.searchText=_),_}),At("keyup",function(){return a.filterPurchases()}),J()(),Q(4,"div",4)(5,"button",5),ge(6,"Nuevo compra"),J()()(),Jt(7,iX,3,1,"div",6),Q(8,"table",7)(9,"thead")(10,"tr")(11,"th"),ge(12,"N\xfamero de Compra "),J(),Q(13,"th"),ge(14," Fecha "),J(),Q(15,"th"),ge(16," Cantidad sku"),J(),Q(17,"th"),ge(18," Estado"),J(),Q(19,"th"),ge(20," Acciones"),J()()(),Q(21,"tbody"),Jt(22,rX,17,4,"tr",8),J()()(),Q(23,"div",9)(24,"div",10)(25,"div",11)(26,"div",12)(27,"h5",13),ge(28,"Nueva compra"),J()(),Q(29,"div",14)(30,"div",15)(31,"div",16)(32,"label",17),ge(33,"Fecha:"),J(),Q(34,"input",18),qt("ngModelChange",function(_){return Zt(a.fechaNewOrder,_)||(a.fechaNewOrder=_),_}),J()(),un(35,"br"),Q(36,"div",19)(37,"button",20),At("click",function(){return a.newPurchase()}),ge(38,"Nueva Orden de compra"),J()()()()()()(),Q(39,"div",21)(40,"div",22)(41,"div",11)(42,"div",12)(43,"h5",23),ge(44,"Orden de compra"),J(),un(45,"button",24),J(),Q(46,"div",14),un(47,"iframe",25),J(),Q(48,"div",26)(49,"button",27),ge(50,"Cerrar"),J()()()()()),2&r&&(we(3),Ht("ngModel",a.searchText),we(4),Tt("ngIf",a.messagePurchase),we(15),Tt("ngForOf",a.purchases),we(12),Ht("ngModel",a.fechaNewOrder),we(13),Tt("src",a.pdfData,Mu))},dependencies:[Lf,jc,Os,ga,Qs]})}return e})();const{isArray:uX}=Array;function nz(e){return 1===e.length&&uX(e[0])?e[0]:e}function _O(...e){const n=qD(e),t=nz(e);return t.length?new Fi(r=>{let a=t.map(()=>[]),f=t.map(()=>!1);r.add(()=>{a=f=null});for(let _=0;!r.closed&&_<t.length;_++)Ms(t[_]).subscribe(ve(r,T=>{if(a[_].push(T),a.every(D=>D.length)){const D=a.map(P=>P.shift());r.next(n?n(...D):D),a.some((P,L)=>!P.length&&f[L])&&r.complete()}},()=>{f[_]=!0,!a[_].length&&r.complete()}));return()=>{a=f=null}}):Ll}function yO(...e){const n=qD(e);return ir((t,r)=>{const a=e.length,f=new Array(a);let _=e.map(()=>!1),T=!1;for(let D=0;D<a;D++)Ms(e[D]).subscribe(ve(r,P=>{f[D]=P,!T&&!_[D]&&(_[D]=!0,(T=_.every(gs))&&(_=null))},ki));t.subscribe(ve(r,D=>{if(T){const P=[D,...f];r.next(n?n(...P):P)}}))})}Math,Math,Math;const xK=["*"],KK=["dialog"],wz={animation:!0,transitionTimerDelayMs:5};let $S=(()=>{class e{constructor(){this.animation=wz.animation}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function h1(e){return"string"==typeof e}function Y_(e){return null!=e}function f1(e){return(e||document.body).getBoundingClientRect()}const GJ=()=>{},{transitionTimerDelayMs:HJ}=wz,sC=new Map,Hc=(e,n,t,r)=>{let a=r.context||{};const f=sC.get(n);if(f)switch(r.runningTransition){case"continue":return Ll;case"stop":e.run(()=>f.transition$.complete()),a=Object.assign(f.context,a),sC.delete(n)}const _=t(n,r.animation,a)||GJ;if(!r.animation||"none"===window.getComputedStyle(n).transitionProperty)return e.run(()=>_()),$n(void 0).pipe(function $J(e){return n=>new Fi(t=>n.subscribe({next:_=>e.run(()=>t.next(_)),error:_=>e.run(()=>t.error(_)),complete:()=>e.run(()=>t.complete())}))}(e));const T=new Ci,D=new Ci,P=T.pipe(function hX(...e){return n=>Aw(n,$n(...e))}(!0));sC.set(n,{transition$:T,complete:()=>{D.next(),D.complete()},context:a});const L=function VJ(e){const{transitionDelay:n,transitionDuration:t}=window.getComputedStyle(e);return 1e3*(parseFloat(n)+parseFloat(t))}(n);return e.runOutsideAngular(()=>{const G=Co(n,"transitionend").pipe(Kr(P),Uo(({target:oe})=>oe===n));(function iz(...e){return 1===(e=nz(e)).length?Ms(e[0]):new Fi(function dX(e){return n=>{let t=[];for(let r=0;t&&!n.closed&&r<e.length;r++)t.push(Ms(e[r]).subscribe(ve(n,a=>{if(t){for(let f=0;f<t.length;f++)f!==r&&t[f].unsubscribe();t=null}n.next(a)})))}}(e))})(mO(L+HJ).pipe(Kr(P)),G,D).pipe(Kr(P)).subscribe(()=>{sC.delete(n),e.run(()=>{_(),T.next(),T.complete()})})}),T.asObservable()};let Iz=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),Az=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),Rz=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),Nz=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})();typeof navigator<"u"&&navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));const Uz=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function jz(e){const n=Array.from(e.querySelectorAll(Uz)).filter(t=>-1!==t.tabIndex);return[n[0],n[n.length-1]]}new Date(1882,10,12),new Date(2174,10,25);let r4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),s4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),ZQ=(()=>{class e{constructor(){this._ngbConfig=Re($S),this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0}get animation(){return this._animation??this._ngbConfig.animation}set animation(t){this._animation=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class ey{constructor(n,t,r){this.nodes=n,this.viewRef=t,this.componentRef=r}}let YQ=(()=>{class e{constructor(){this._document=Re(Xr)}hide(){const t=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),r=this._document.body,a=r.style,{overflow:f,paddingRight:_}=a;if(t>0){const T=parseFloat(window.getComputedStyle(r).paddingRight);a.paddingRight=`${T+t}px`}return a.overflow="hidden",()=>{t>0&&(a.paddingRight=_),a.overflow=f}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),XQ=(()=>{class e{constructor(){this._nativeElement=Re(wi).nativeElement,this._zone=Re(ii)}ngOnInit(){this._zone.onStable.asObservable().pipe(ma(1)).subscribe(()=>{Hc(this._zone,this._nativeElement,(t,r)=>{r&&f1(t),t.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return Hc(this._zone,this._nativeElement,({classList:t})=>t.remove("show"),{animation:this.animation,runningTransition:"stop"})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Ti({type:e,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(r,a){2&r&&(Jx("modal-backdrop"+(a.backdropClass?" "+a.backdropClass:"")),ji("show",!a.animation)("fade",a.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},standalone:!0,features:[Bu],decls:0,vars:0,template:function(r,a){},encapsulation:2})}return e})();class a4{update(n){}close(n){}dismiss(n){}}const KQ=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","scrollable","size","windowClass","modalDialogClass"],JQ=["animation","backdropClass"];class QQ{_applyWindowOptions(n,t){KQ.forEach(r=>{Y_(t[r])&&(n[r]=t[r])})}_applyBackdropOptions(n,t){JQ.forEach(r=>{Y_(t[r])&&(n[r]=t[r])})}update(n){this._applyWindowOptions(this._windowCmptRef.instance,n),this._backdropCmptRef&&this._backdropCmptRef.instance&&this._applyBackdropOptions(this._backdropCmptRef.instance,n)}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(Kr(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(Kr(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}constructor(n,t,r,a){this._windowCmptRef=n,this._contentRef=t,this._backdropCmptRef=r,this._beforeDismiss=a,this._closed=new Ci,this._dismissed=new Ci,this._hidden=new Ci,n.instance.dismissEvent.subscribe(f=>{this.dismiss(f)}),this.result=new Promise((f,_)=>{this._resolve=f,this._reject=_}),this.result.then(null,()=>{})}close(n){this._windowCmptRef&&(this._closed.next(n),this._resolve(n),this._removeModalElements())}_dismiss(n){this._dismissed.next(n),this._reject(n),this._removeModalElements()}dismiss(n){if(this._windowCmptRef)if(this._beforeDismiss){const t=this._beforeDismiss();!function Cz(e){return e&&e.then}(t)?!1!==t&&this._dismiss(n):t.then(r=>{!1!==r&&this._dismiss(n)},()=>{})}else this._dismiss(n)}_removeModalElements(){const n=this._windowCmptRef.instance.hide(),t=this._backdropCmptRef?this._backdropCmptRef.instance.hide():$n(void 0);n.subscribe(()=>{const{nativeElement:r}=this._windowCmptRef.location;r.parentNode.removeChild(r),this._windowCmptRef.destroy(),this._contentRef?.viewRef?.destroy(),this._windowCmptRef=null,this._contentRef=null}),t.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:r}=this._backdropCmptRef.location;r.parentNode.removeChild(r),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),_O(n,t).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var $O=function(e){return e[e.BACKDROP_CLICK=0]="BACKDROP_CLICK",e[e.ESC=1]="ESC",e}($O||{});let eee=(()=>{class e{constructor(){this._document=Re(Xr),this._elRef=Re(wi),this._zone=Re(ii),this._closed$=new Ci,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new fn,this.shown=new Ci,this.hidden=new Ci}get fullscreenClass(){return!0===this.fullscreen?" modal-fullscreen":h1(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(t){this.dismissEvent.emit(t)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe(ma(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:t}=this._elRef,r={animation:this.animation,runningTransition:"stop"},_=_O(Hc(this._zone,t,()=>t.classList.remove("show"),r),Hc(this._zone,this._dialogEl.nativeElement,()=>{},r));return _.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),_}_show(){const t={animation:this.animation,runningTransition:"continue"};_O(Hc(this._zone,this._elRef.nativeElement,(f,_)=>{_&&f1(f),f.classList.add("show")},t),Hc(this._zone,this._dialogEl.nativeElement,()=>{},t)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:t}=this._elRef;this._zone.runOutsideAngular(()=>{Co(t,"keydown").pipe(Kr(this._closed$),Uo(a=>"Escape"===a.key)).subscribe(a=>{this.keyboard?requestAnimationFrame(()=>{a.defaultPrevented||this._zone.run(()=>this.dismiss($O.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let r=!1;Co(this._dialogEl.nativeElement,"mousedown").pipe(Kr(this._closed$),As(()=>r=!1),$c(()=>Co(t,"mouseup").pipe(Kr(this._closed$),ma(1))),Uo(({target:a})=>t===a)).subscribe(()=>{r=!0}),Co(t,"click").pipe(Kr(this._closed$)).subscribe(({target:a})=>{t===a&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!r&&this._zone.run(()=>this.dismiss($O.BACKDROP_CLICK))),r=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:t}=this._elRef;if(!t.contains(document.activeElement)){const r=t.querySelector("[ngbAutofocus]"),a=jz(t)[0];(r||a||t).focus()}}_restoreFocus(){const t=this._document.body,r=this._elWithFocus;let a;a=r&&r.focus&&t.contains(r)?r:t,this._zone.runOutsideAngular(()=>{setTimeout(()=>a.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&Hc(this._zone,this._elRef.nativeElement,({classList:t})=>(t.add("modal-static"),()=>t.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Ti({type:e,selectors:[["ngb-modal-window"]],viewQuery:function(r,a){if(1&r&&kl(KK,7),2&r){let f;pi(f=mi())&&(a._dialogEl=f.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(r,a){2&r&&(Qi("aria-modal",!0)("aria-labelledby",a.ariaLabelledBy)("aria-describedby",a.ariaDescribedBy),Jx("modal d-block"+(a.windowClass?" "+a.windowClass:"")),ji("fade",a.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},standalone:!0,features:[Bu],ngContentSelectors:xK,decls:4,vars:2,consts:[["dialog",""],["role","document"],[1,"modal-content"]],template:function(r,a){1&r&&(lD(),Q(0,"div",1,0)(2,"div",2),cD(3),J()()),2&r&&Jx("modal-dialog"+(a.size?" modal-"+a.size:"")+(a.centered?" modal-dialog-centered":"")+a.fullscreenClass+(a.scrollable?" modal-dialog-scrollable":"")+(a.modalDialogClass?" "+a.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}\n"],encapsulation:2})}return e})(),tee=(()=>{class e{constructor(){this._applicationRef=Re(Bc),this._injector=Re(or),this._environmentInjector=Re(mo),this._document=Re(Xr),this._scrollBar=Re(YQ),this._activeWindowCmptHasChanged=new Ci,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._modalRefs=[],this._windowCmpts=[],this._activeInstances=new fn;const t=Re(ii);this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const r=this._windowCmpts[this._windowCmpts.length-1];((e,n,t,r=!1)=>{e.runOutsideAngular(()=>{const a=Co(n,"focusin").pipe(Kr(t),q(f=>f.target));Co(n,"keydown").pipe(Kr(t),Uo(f=>"Tab"===f.key),yO(a)).subscribe(([f,_])=>{const[T,D]=jz(n);(_===T||_===n)&&f.shiftKey&&(D.focus(),f.preventDefault()),_===D&&!f.shiftKey&&(T.focus(),f.preventDefault())}),r&&Co(n,"click").pipe(Kr(t),yO(a),q(f=>f[1])).subscribe(f=>f.focus())})})(t,r.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(r.location.nativeElement)}})}_restoreScrollBar(){const t=this._scrollBarRestoreFn;t&&(this._scrollBarRestoreFn=null,t())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(t,r,a){const f=a.container instanceof HTMLElement?a.container:Y_(a.container)?this._document.querySelector(a.container):this._document.body;if(!f)throw new Error(`The specified modal container "${a.container||"body"}" was not found in the DOM.`);this._hideScrollBar();const _=new a4,T=(t=a.injector||t).get(mo,null)||this._environmentInjector,D=this._getContentRef(t,T,r,_,a);let P=!1!==a.backdrop?this._attachBackdrop(f):void 0,L=this._attachWindowComponent(f,D.nodes),G=new QQ(L,D,P,a.beforeDismiss);return this._registerModalRef(G),this._registerWindowCmpt(L),G.hidden.pipe(ma(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(this._document.body.classList.remove("modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),_.close=ie=>{G.close(ie)},_.dismiss=ie=>{G.dismiss(ie)},_.update=ie=>{G.update(ie)},G.update(a),1===this._modalRefs.length&&this._document.body.classList.add("modal-open"),P&&P.instance&&P.changeDetectorRef.detectChanges(),L.changeDetectorRef.detectChanges(),G}get activeInstances(){return this._activeInstances}dismissAll(t){this._modalRefs.forEach(r=>r.dismiss(t))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(t){let r=O2(XQ,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(r.hostView),t.appendChild(r.location.nativeElement),r}_attachWindowComponent(t,r){let a=O2(eee,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:r});return this._applicationRef.attachView(a.hostView),t.appendChild(a.location.nativeElement),a}_getContentRef(t,r,a,f,_){return a?a instanceof li?this._createFromTemplateRef(a,f):h1(a)?this._createFromString(a):this._createFromComponent(t,r,a,f,_):new ey([])}_createFromTemplateRef(t,r){const f=t.createEmbeddedView({$implicit:r,close(_){r.close(_)},dismiss(_){r.dismiss(_)}});return this._applicationRef.attachView(f),new ey([f.rootNodes],f)}_createFromString(t){const r=this._document.createTextNode(`${t}`);return new ey([[r]])}_createFromComponent(t,r,a,f,_){const D=O2(a,{environmentInjector:r,elementInjector:or.create({providers:[{provide:a4,useValue:f}],parent:t})}),P=D.location.nativeElement;return _.scrollable&&P.classList.add("component-host-scrollable"),this._applicationRef.attachView(D.hostView),new ey([[P]],D.hostView,D)}_setAriaHidden(t){const r=t.parentElement;r&&t!==this._document.body&&(Array.from(r.children).forEach(a=>{a!==t&&"SCRIPT"!==a.nodeName&&(this._ariaHiddenValues.set(a,a.getAttribute("aria-hidden")),a.setAttribute("aria-hidden","true"))}),this._setAriaHidden(r))}_revertAriaHidden(){this._ariaHiddenValues.forEach((t,r)=>{t?r.setAttribute("aria-hidden",t):r.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(t){const r=()=>{const a=this._modalRefs.indexOf(t);a>-1&&(this._modalRefs.splice(a,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(t),this._activeInstances.emit(this._modalRefs),t.result.then(r,r)}_registerWindowCmpt(t){this._windowCmpts.push(t),this._activeWindowCmptHasChanged.next(),t.onDestroy(()=>{const r=this._windowCmpts.indexOf(t);r>-1&&(this._windowCmpts.splice(r,1),this._activeWindowCmptHasChanged.next())})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),l4=(()=>{class e{constructor(){this._injector=Re(or),this._modalStack=Re(tee),this._config=Re(ZQ)}open(t,r={}){const a={...this._config,animation:this._config.animation,...r};return this._modalStack.open(this._injector,t,a)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(t){this._modalStack.dismissAll(t)}hasOpenModals(){return this._modalStack.hasOpenModals()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),c4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({providers:[l4]})}return e})(),h4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),b4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),x4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),w4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),C4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),T4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),E4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),D4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),S4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})();new vt("live announcer delay",{providedIn:"root",factory:()=>100});let M4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})(),I4=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({})}return e})();const gee=[Iz,Az,Rz,Nz,r4,s4,c4,h4,I4,b4,x4,w4,C4,T4,E4,D4,S4,M4];let _ee=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({imports:[gee,Iz,Az,Rz,Nz,r4,s4,c4,h4,I4,b4,x4,w4,C4,T4,E4,D4,S4,M4]})}return e})();const yee=e=>({"table-success":e});function vee(e,n){if(1&e){const t=$i();Q(0,"tr",7),At("click",function(){const a=Xt(t).$implicit,f=gt(),_=as(13);return Kt(f.openEditModal(_,a))}),Q(1,"td"),ge(2),J(),Q(3,"td"),ge(4),J()()}if(2&e){const t=n.$implicit;Tt("ngClass",Lc(3,yee,t.final_price_purchase>0)),we(2),Qt(t.name+" ("+t.sku+")"),we(2),Qt(t.total_quantity_ordered+" "+t.unit)}}function bee(e,n){if(1&e&&(Q(0,"div",21),ge(1),J()),2&e){const t=gt(2);we(),Qt(t.successMessage)}}function xee(e,n){if(1&e&&(Q(0,"div",22),ge(1),J()),2&e){const t=gt(2);we(),Qt(t.errorMessage)}}function wee(e,n){if(1&e&&(Q(0,"tr")(1,"td"),ge(2),J(),Q(3,"td"),ge(4),J()()),2&e){const t=n.$implicit;we(2),Qt(t.client_name),we(2),Qt(t.quantity)}}function Cee(e,n){if(1&e&&(Q(0,"div")(1,"h6",23),ge(2,"Clientes que pidieron este producto:"),J(),Q(3,"table",4)(4,"thead")(5,"tr")(6,"th"),ge(7,"Cliente"),J(),Q(8,"th"),ge(9,"Cantidad"),J()()(),Q(10,"tbody"),Jt(11,wee,5,2,"tr",24),J()()()),2&e){const t=gt(2);we(11),Tt("ngForOf",t.selectedProduct.clients)}}function Tee(e,n){if(1&e){const t=$i();Q(0,"div",8)(1,"h5",9),ge(2),J(),Q(3,"button",10),At("click",function(){return Kt(Xt(t).$implicit.dismiss("Cross click"))}),J()(),Q(4,"div",11),Jt(5,bee,2,1,"div",12)(6,xee,2,1,"div",13),Q(7,"div")(8,"label"),ge(9,"Precio de Compra sugerido:"),J(),Q(10,"span",14),ge(11),J()(),Q(12,"div")(13,"label"),ge(14,"Precio de Compra:"),J(),Q(15,"input",15),qt("ngModelChange",function(a){Xt(t);const f=gt();return Zt(f.selectedProduct.final_price_purchase,a)||(f.selectedProduct.final_price_purchase=a),Kt(a)}),J()(),Q(16,"div")(17,"label"),ge(18,"Proveedor:"),J(),Q(19,"input",16),qt("ngModelChange",function(a){Xt(t);const f=gt();return Zt(f.selectedProduct.proveedor,a)||(f.selectedProduct.proveedor=a),Kt(a)}),J()(),Jt(20,Cee,12,1,"div",17),J(),Q(21,"div",18)(22,"button",19),At("click",function(){return Kt(Xt(t).$implicit.dismiss("Cancel"))}),ge(23,"Cancelar"),J(),Q(24,"button",20),At("click",function(){const a=Xt(t).$implicit;return gt().savePrice(),Kt(a.close("Save click"))}),ge(25,"Guardar"),J()()}if(2&e){const t=gt();we(2),Qt(t.selectedProduct.name),we(3),Tt("ngIf",t.successMessage),we(),Tt("ngIf",t.errorMessage),we(5),Qt(t.selectedProduct.price_purchase),we(4),Ht("ngModel",t.selectedProduct.final_price_purchase),we(4),Ht("ngModel",t.selectedProduct.proveedor),we(),Tt("ngIf",null==t.selectedProduct.clients?null:t.selectedProduct.clients.length)}}let Eee=(()=>{class e{constructor(t,r,a){this.route=t,this.purchaseService=r,this.modalService=a,this.selectedProduct=null,this.editedPrice=null,this.purchaseNumber="",this.purchase=null,this.filteredProducts=[],this.searchTerm="",this.sortColumn="",this.sortDirection=1,this.successMessage=null,this.errorMessage=null,this.route.params.subscribe(f=>{this.purchaseNumber=f.purchaseNumber})}ngOnInit(){this.purchaseService.getPurchase(this.purchaseNumber).subscribe(t=>{this.purchase=t,this.filteredProducts=this.purchase.products})}filterProducts(){this.filteredProducts=this.purchase.products.filter(t=>t.name.toLowerCase().includes(this.searchTerm.toLowerCase()))}sortBy(t){this.sortColumn===t?this.sortDirection=-this.sortDirection:(this.sortColumn=t,this.sortDirection=1),this.filteredProducts.sort((r,a)=>r[t]<a[t]?-1*this.sortDirection:r[t]>a[t]?1*this.sortDirection:0)}openEditModal(t,r){this.selectedProduct=r,this.editedPrice=0,this.modalService.open(t),this.successMessage=null,this.errorMessage=null}savePrice(){this.purchaseService.updatePrice({sku:this.selectedProduct.sku,purchase_number:this.purchaseNumber,final_price_purchase:this.selectedProduct.final_price_purchase,proveedor:this.selectedProduct.proveedor}).subscribe(r=>{this.successMessage="Precio guardado exitosamente.",this.errorMessage=null},r=>{this.successMessage=null,this.errorMessage="Error al guardar el precio."})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(gh),tt(tz),tt(l4))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-purchase"]],decls:14,vars:2,consts:[["productModal",""],[1,"container-fluid","mt-5"],[1,"mb-3"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","ngModel"],[1,"table"],[3,"click"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"click","ngClass"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"form-control"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],["type","text",1,"form-control",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[1,"mt-3"],[4,"ngFor","ngForOf"]],template:function(r,a){if(1&r){const f=$i();Q(0,"div",1)(1,"div",2)(2,"input",3),qt("ngModelChange",function(T){return Xt(f),Zt(a.searchTerm,T)||(a.searchTerm=T),Kt(T)}),At("ngModelChange",function(){return Xt(f),Kt(a.filterProducts())}),J()(),Q(3,"table",4)(4,"thead")(5,"tr")(6,"th",5),At("click",function(){return Xt(f),Kt(a.sortBy("name"))}),ge(7,"Producto"),J(),Q(8,"th",5),At("click",function(){return Xt(f),Kt(a.sortBy("total_quantity_ordered"))}),ge(9,"Cantidad"),J()()(),Q(10,"tbody"),Jt(11,vee,5,5,"tr",6),J()()(),Jt(12,Tee,26,7,"ng-template",null,0,Ss)}2&r&&(we(2),Ht("ngModel",a.searchTerm),we(9),Tt("ngForOf",a.filteredProducts))},dependencies:[bw,Lf,jc,Os,Yw,ga,Qs],styles:[".table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}"]})}return e})(),qO=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}createAction(t){return this.http.post(`${this.baseUrl}api/action/action`,t)}getActions(){return this.http.get(`${this.baseUrl}api/action/actions`)}getAction(t){return this.http.get(`${this.baseUrl}api/action/action/${t}`)}editAction(t,r){return this.http.put(`${this.baseUrl}api/action/action/${t}`,r)}deleteAction(t){return this.http.delete(`${this.baseUrl}api/action/action/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)($t(zf))};static#t=this.\u0275prov=Mt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Dee=e=>({"table-success":e});function See(e,n){if(1&e&&(Q(0,"div",8),ge(1),un(2,"button",9),J()),2&e){const t=gt();we(),ol(" ",t.messageAction," ")}}function Mee(e,n){if(1&e){const t=$i();Q(0,"tr",10),At("click",function(){const a=Xt(t).$implicit,f=gt();return Kt("Creada"===a.status?f.navigateToaAction(a.actionNumber):f.viewAction(a))}),Q(1,"td"),ge(2),J(),Q(3,"td"),ge(4),J(),Q(5,"td"),ge(6),J()()}if(2&e){const t=n.$implicit;Tt("ngClass",Lc(6,Dee,"Completada"===t.status)),Qi("data-bs-toggle","Creada"!==t.status?"modal":null)("data-bs-target","Creada"!==t.status?"#viewModal":null),we(2),Qt(t.dateAction),we(2),Qt(t.customer.name),we(2),Qt(t.customer.address)}}function Iee(e,n){if(1&e&&(Q(0,"div",18)(1,"label"),ge(2,"N\xfamero de Pedido:"),J(),Q(3,"p"),ge(4),J()()),2&e){const t=gt(2);we(4),Qt(t.actionSelect.orderNumber)}}function Aee(e,n){if(1&e&&(Q(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14)(4,"h5",15),ge(5,"Detalles de la Acci\xf3n"),J(),un(6,"button",16),J(),Q(7,"div",17)(8,"div",18)(9,"label"),ge(10,"Fecha Ejecuci\xf3n:"),J(),Q(11,"p"),ge(12),J()(),Q(13,"div",18)(14,"label"),ge(15,"Cliente:"),J(),Q(16,"p"),ge(17),J()(),Q(18,"div",18)(19,"label"),ge(20,"Tipo de Acci\xf3n:"),J(),Q(21,"p"),ge(22),J()(),Jt(23,Iee,5,1,"div",19),Q(24,"div",18)(25,"label"),ge(26,"Manager:"),J(),Q(27,"p"),ge(28),J()(),Q(29,"div",18)(30,"label"),ge(31,"Detalle Acci\xf3n:"),J(),Q(32,"p"),ge(33),J()(),Q(34,"div",18)(35,"label"),ge(36,"Tipo Soluci\xf3n:"),J(),Q(37,"p"),ge(38),J()(),Q(39,"div",18)(40,"label"),ge(41,"Detalle Soluci\xf3n:"),J(),Q(42,"p"),ge(43),J()(),Q(44,"div",18)(45,"label"),ge(46,"Fecha Soluci\xf3n:"),J(),Q(47,"p"),ge(48),J()(),Q(49,"div",18)(50,"label"),ge(51,"Estado:"),J(),Q(52,"p"),ge(53),J()()(),Q(54,"div",20)(55,"button",21),ge(56,"Cerrar"),J()()()()()),2&e){const t=gt();we(12),Qt(t.actionSelect.dateAction),we(5),Qt(t.actionSelect.customer.name),we(5),Qt(t.actionSelect.type.name),we(),Tt("ngIf",t.actionSelect.orderNumber),we(5),Qt(t.actionSelect.manager),we(5),Qt(t.actionSelect.actionComment),we(5),Qt(t.actionSelect.solutionType),we(5),Qt(t.actionSelect.solutionComment),we(5),Qt(t.actionSelect.dateSolution),we(5),Qt(t.actionSelect.status)}}let Oee=(()=>{class e{constructor(t,r,a,f){this.actionService=t,this.router=r,this.datePipe=a,this.authService=f,this.actions=[],this.filteredActions=[],this.searchText="",this.messageAction="",this.statusCodeAction="",this.managers=["Ferney","Cata","Diago","Saco"],this.searchDate=null,this.selectedManager=null}ngOnInit(){this.getActions(),this.selectedManager=this.authService.getUsername(),this.filterDateManager()}navigateToaAction(t){this.router.navigate(["/edit_action",t])}filterActions(){this.filteredActions=""!==this.searchText.trim()?this.actions.filter(t=>t.purchase_number.toLowerCase().includes(this.searchText.toLowerCase())):this.actions}filterDateManager(){this.selectedManager=this.authService.getUsername(),this.filteredActions=this.actions.filter(t=>{const r=this.datePipe.transform(t.dateAction,"yyyy-MM-dd");return!(this.searchDate&&r!==this.searchDate||this.selectedManager&&t.manager!==this.selectedManager)})}newAction(){this.router.navigate(["/newAction"])}getActions(){this.actionService.getActions().subscribe(t=>{this.actions=t,this.filteredActions=this.actions})}delete_action(t){this.actionService.deleteAction(t).subscribe(r=>{this.getActions(),this.messageAction="Accion eliminada exitosamente!",this.statusCodeAction=r.statusCode||"200",setTimeout(()=>{this.messageAction=""},3e3)},r=>{this.messageAction="Fallo al eliminar la accion.",this.statusCodeAction=r.status||"500",setTimeout(()=>{this.messageAction=""},3e3)})}resolver(t){this.router.navigate(["/edit_action",t])}viewAction(t){this.actionSelect=t}static#e=this.\u0275fac=function(r){return new(r||e)(tt(qO),tt(cs),tt(xw),tt(a1))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-list-actionns-customers"]],decls:18,vars:4,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-6"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[3,"ngClass","click",4,"ngFor","ngForOf"],["class","modal fade","id","viewModal","tabindex","-1","aria-labelledby","viewModalLabel","aria-hidden","true",4,"ngIf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[3,"click","ngClass"],["id","viewModal","tabindex","-1","aria-labelledby","viewModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","viewModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"form-group","mb-3"],["class","form-group mb-3",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"]],template:function(r,a){1&r&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),qt("ngModelChange",function(_){return Zt(a.searchDate,_)||(a.searchDate=_),_}),At("ngModelChange",function(){return a.filterDateManager()}),J()()(),un(4,"div",1),Jt(5,See,3,1,"div",4),Q(6,"table",5)(7,"thead")(8,"tr")(9,"th"),ge(10," Fecha "),J(),Q(11,"th"),ge(12," Cliente "),J(),Q(13,"th"),ge(14," Estado"),J()()(),Q(15,"tbody"),Jt(16,Mee,7,8,"tr",6),J()()(),Jt(17,Aee,57,10,"div",7)),2&r&&(we(3),Ht("ngModel",a.searchDate),we(2),Tt("ngIf",a.messageAction),we(11),Tt("ngForOf",a.filteredActions),we(),Tt("ngIf",a.actionSelect))},dependencies:[bw,Lf,jc,Os,ga,Qs]})}return e})();var A4=Wc(247);function Pee(e,n){if(1&e){const t=$i();Q(0,"div",4)(1,"label",30),ge(2,"N\xfamero de Pedido:"),J(),Q(3,"input",31),qt("ngModelChange",function(a){Xt(t);const f=gt();return Zt(f.actionObject.orderNumber,a)||(f.actionObject.orderNumber=a),Kt(a)}),J()()}if(2&e){const t=gt();we(3),Ht("ngModel",t.actionObject.orderNumber)}}function Ree(e,n){if(1&e&&(Q(0,"option",32),ge(1),J()),2&e){const t=n.$implicit;Tt("value",t),we(),Qt(t)}}const kee=()=>({standalone:!0});function Fee(e,n){if(1&e){const t=$i();Q(0,"tr")(1,"td"),ge(2),J(),Q(3,"td"),ge(4),J(),Q(5,"td"),ge(6),J(),Q(7,"td")(8,"button",34),At("click",function(){const a=Xt(t).$implicit;return Kt(gt().selectCustomer(a))}),ge(9," Seleccionar "),J()()()}if(2&e){const t=n.$implicit;we(2),Qt(t.name),we(2),Qt(t.phone),we(2),Qt(t.email)}}function Lee(e,n){if(1&e&&(Q(0,"option",35),ge(1),J()),2&e){const t=n.$implicit;Tt("ngValue",t),we(),Qt(t.name)}}function Bee(e,n){if(1&e&&(Q(0,"option",38),ge(1),J()),2&e){const t=n.$implicit;Tt("value",t.order_number),we(),n2("",t.order_number," - ( ",t.delivery_date,")")}}function zee(e,n){if(1&e){const t=$i();Q(0,"div",2)(1,"label",36),ge(2,"N\xfamero de Pedido:"),J(),Q(3,"select",37),qt("ngModelChange",function(a){Xt(t);const f=gt();return Zt(f.newActionObject.orderNumber,a)||(f.newActionObject.orderNumber=a),Kt(a)}),Q(4,"option",23),ge(5,"Seleccione un pedido"),J(),Jt(6,Bee,2,3,"option",28),J()()}if(2&e){const t=gt();we(3),Ht("ngModel",t.newActionObject.orderNumber),we(3),Tt("ngForOf",t.orders)}}function Vee(e,n){if(1&e&&(Q(0,"option",38),ge(1),J()),2&e){const t=n.$implicit;Tt("value",t),we(),Qt(t)}}const Uee=[{path:"productos",component:UW},{path:"clientes",component:$W},{path:"ordenes",component:jY},{path:"login",component:$Y},{path:"home",component:ez},{path:"reports",component:GY},{path:"reports/picking",component:KY},{path:"reports/compras",component:JY},{path:"reports/cotizar",component:QY},{path:"reports/integrar",component:nX},{path:"delete-account",component:XY},{path:"restore/:user_id",component:WY},{path:"purchases",component:oX},{path:"purchase/:purchaseNumber",component:Eee},{path:"crm",component:Oee},{path:"edit_action/:action",component:(()=>{class e{constructor(t,r,a){this.actionService=t,this.router=r,this.route=a,this.actionObject={dateAction:"",dateSolution:"",type:"",customer:{},orderNumber:"",manager:"",status:"",actionComment:"",solutionType:"",solutionComment:"",latitude:null,longitude:null},this.solutions=[]}ngOnInit(){this.loadAction(),this.getCurrentLocation()}loadAction(){const t=this.route.snapshot.paramMap.get("action");t&&this.actionService.getAction(t).subscribe(r=>{this.actionObject=r,this.solutions=r.type.solutions,this.initializeMap()},r=>{console.error("Error al cargar la acci\xf3n:",r)})}initializeMap(){this.actionObject.customer.latitude&&this.actionObject.customer.longitude&&(this.map=new A4.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",projection:{name:"mercator"},zoom:15,center:[parseFloat(this.actionObject.customer.longitude),parseFloat(this.actionObject.customer.latitude)],accessToken:"pk.eyJ1Ijoidm1kaWFnb3YiLCJhIjoiY2x4MGtxY2NlMDFxdDJycTdrdXhvYWE4byJ9.rQb2uBaS48sEyvpbdMj14Q"}),(new A4.Marker).setLngLat([parseFloat(this.actionObject.customer.longitude),parseFloat(this.actionObject.customer.latitude)]).addTo(this.map))}getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.actionObject.latitude=t.coords.latitude,this.actionObject.longitude=t.coords.longitude},t=>{console.error("Error obteniendo la ubicaci\xf3n:",t)}):console.error("Geolocalizaci\xf3n no es soportada por el navegador")}backList(){this.router.navigate(["/crm"])}completar(){const t=(new Date).toLocaleString("en-US",{timeZone:"America/Bogota"});this.actionObject.dateSolution=new Date(t).toISOString(),this.actionObject.status="Completada",this.getCurrentLocation(),this.actionService.editAction(this.actionObject.actionNumber,this.actionObject).subscribe(r=>{this.router.navigate(["/crm"])})}static#e=this.\u0275fac=function(r){return new(r||e)(tt(qO),tt(cs),tt(gh))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-edit-action"]],decls:61,vars:12,consts:[["href",Sl`https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.css`,"rel","stylesheet"],["href",Sl`https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css`,"rel","stylesheet"],[1,"container"],[1,"mb-4"],[1,"form-group","mb-3"],["for","dateAction"],["type","text","id","dateAction","name","dateAction","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","customer"],["type","text","id","name","name","name",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","address","name","address",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","phone","name","phone",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","email","name","email",1,"form-control",3,"ngModelChange","ngModel"],["id","map",1,"map-container"],["for","type"],["type","text","id","type","name","type","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["class","form-group mb-3",4,"ngIf"],["for","manager"],["type","text","id","manager","name","manager","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","actionComment"],["type","text","id","actionComment","name","actionComment","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","solution"],["id","solution","name","solution","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["for","solutionComment"],["type","text","id","solutionComment","name","solutionComment",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],["for","orderNumber"],["type","text","id","orderNumber","name","orderNumber","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"]],template:function(r,a){1&r&&(un(0,"link",0)(1,"link",1)(2,"br")(3,"br"),Q(4,"div",2)(5,"h3",3),ge(6,"Completar acci\xf3n"),J(),Q(7,"form")(8,"div",4)(9,"label",5),ge(10,"Fecha Ejecuci\xf3n:"),J(),Q(11,"input",6),qt("ngModelChange",function(_){return Zt(a.actionObject.dateAction,_)||(a.actionObject.dateAction=_),_}),J()(),Q(12,"div",4)(13,"label",7),ge(14,"Nombre Cliente:"),J(),Q(15,"input",8),qt("ngModelChange",function(_){return Zt(a.actionObject.customer.name,_)||(a.actionObject.customer.name=_),_}),J()(),Q(16,"div",4)(17,"label",7),ge(18,"Direcci\xf3n Cliente:"),J(),Q(19,"input",9),qt("ngModelChange",function(_){return Zt(a.actionObject.customer.address,_)||(a.actionObject.customer.address=_),_}),J()(),Q(20,"div",4)(21,"label",7),ge(22,"Tel\xe9fono Cliente:"),J(),Q(23,"input",10),qt("ngModelChange",function(_){return Zt(a.actionObject.customer.phone,_)||(a.actionObject.customer.phone=_),_}),J()(),Q(24,"div",4)(25,"label",7),ge(26,"Email Cliente:"),J(),Q(27,"input",11),qt("ngModelChange",function(_){return Zt(a.actionObject.customer.email,_)||(a.actionObject.customer.email=_),_}),J()(),Q(28,"div",4),un(29,"div",12),J(),Q(30,"div",4)(31,"label",13),ge(32,"Tipo de Acci\xf3n:"),J(),Q(33,"input",14),qt("ngModelChange",function(_){return Zt(a.actionObject.type.name,_)||(a.actionObject.type.name=_),_}),J()(),Jt(34,Pee,4,1,"div",15),Q(35,"div",4)(36,"label",16),ge(37,"Manager:"),J(),Q(38,"input",17),qt("ngModelChange",function(_){return Zt(a.actionObject.manager,_)||(a.actionObject.manager=_),_}),J()(),Q(39,"div",4)(40,"label",18),ge(41,"Detalle:"),J(),Q(42,"input",19),qt("ngModelChange",function(_){return Zt(a.actionObject.actionComment,_)||(a.actionObject.actionComment=_),_}),J()(),Q(43,"div",4)(44,"label",20),ge(45,"Soluci\xf3n:"),J(),Q(46,"select",21),qt("ngModelChange",function(_){return Zt(a.actionObject.solutionType,_)||(a.actionObject.solutionType=_),_}),Q(47,"option",22),ge(48,"Seleccione una soluci\xf3n"),J(),Jt(49,Ree,2,2,"option",23),J()(),Q(50,"div",4)(51,"label",24),ge(52,"Detalle Soluci\xf3n:"),J(),Q(53,"input",25),qt("ngModelChange",function(_){return Zt(a.actionObject.solutionComment,_)||(a.actionObject.solutionComment=_),_}),J()(),Q(54,"div",26)(55,"div",27)(56,"button",28),At("click",function(){return a.completar()}),ge(57,"Completar"),J()(),Q(58,"div",27)(59,"button",29),At("click",function(){return a.backList()}),ge(60,"Regresar"),J()()()()()),2&r&&(we(11),Ht("ngModel",a.actionObject.dateAction),we(4),Ht("ngModel",a.actionObject.customer.name),we(4),Ht("ngModel",a.actionObject.customer.address),we(4),Ht("ngModel",a.actionObject.customer.phone),we(4),Ht("ngModel",a.actionObject.customer.email),we(6),Ht("ngModel",a.actionObject.type.name),we(),Tt("ngIf",a.actionObject.orderNumber),we(4),Ht("ngModel",a.actionObject.manager),we(4),Ht("ngModel",a.actionObject.actionComment),we(4),Ht("ngModel",a.actionObject.solutionType),we(3),Tt("ngForOf",a.solutions),we(4),Ht("ngModel",a.actionObject.solutionComment))},dependencies:[Lf,jc,OS,r1,o1,Os,Pm,ga,wS,s1,Qs,i1],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:400px}"]})}return e})()},{path:"newAction",component:(()=>{class e{constructor(t,r,a,f){this.actionService=t,this.customerService=r,this.orderService=a,this.router=f,this.newActionObject={dateAction:"",dateSolution:"",type:{},customer:{},orderNumber:"",manager:"",status:"Creada",actionComment:"",solutionType:"",solutionComment:"",longituted:"",latituted:""},this.customers=[],this.actionTypes=[],this.orders=[],this.managers=[],this.searchText=""}ngOnInit(){this.loadCustomers(),this.orderService.getConfig().subscribe(t=>{this.actionTypes=t.actionsType,this.managers=t.comercials})}loadCustomers(){this.customerService.getClientes().subscribe(t=>{this.customers=t},t=>{console.error("Error al cargar los clientes:",t)})}loadOrders(t){this.orderService.getLastOrdersByCustomerId(t).subscribe(r=>{this.orders=r},r=>{console.error("Error al cargar los pedidos:",r)})}selectCustomer(t){this.newActionObject.customer=t,this.loadOrders(t.email)}onTypeChange(){this.newActionObject.type.requiresOrder&&this.newActionObject.customer.id&&this.loadOrders(this.newActionObject.customer.email)}createAction(){this.newActionObject.dateAction&&this.newActionObject.type&&this.newActionObject.customer.id?this.actionService.createAction(this.newActionObject).subscribe(t=>{console.log("Acci\xf3n creada exitosamente:",t),this.router.navigate(["/crm"])},t=>{console.error("Error al crear la acci\xf3n:",t)}):alert("Por favor, completa todos los campos obligatorios.")}filteredCustomers(){if(!this.searchText)return this.customers;const t=this.searchText.toLowerCase();return this.customers.filter(r=>r.phone.toLowerCase().includes(t)||r.name.toLowerCase().includes(t)||r.email.toLowerCase().includes(t))}backList(){this.router.navigate(["/crm"])}static#e=this.\u0275fac=function(r){return new(r||e)(tt(qO),tt(hO),tt($B),tt(cs))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-new-action"]],decls:69,vars:12,consts:[[1,"container"],[1,"mb-4"],[1,"form-group","mb-3"],["for","dateAction"],["type","date","id","dateAction","name","dateAction","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","customerId"],[1,"input-group"],["type","text","id","customer","name","customer","readonly","","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","button","data-bs-toggle","modal","data-bs-target","#customerModal",1,"btn","btn-outline-secondary"],["id","customerModal","tabindex","-1","aria-labelledby","customerModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","customerModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["type","text","placeholder","Buscar cliente...",1,"form-control","mb-3",3,"ngModelChange","ngModel","ngModelOptions"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["for","type"],["id","type","name","type","required","",1,"form-control",3,"ngModelChange","change","ngModel"],["value","","disabled","","selected",""],[3,"ngValue",4,"ngFor","ngForOf"],["class","form-group mb-3",4,"ngIf"],["for","manager"],["id","manager","name","manager","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","id","actionComment","name","actionComment",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[3,"ngValue"],["for","orderNumber"],["id","orderNumber","name","orderNumber",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"]],template:function(r,a){1&r&&(un(0,"br")(1,"br"),Q(2,"div",0)(3,"h3",1),ge(4,"Nueva acci\xf3n"),J(),Q(5,"form")(6,"div",2)(7,"label",3),ge(8,"Fecha Ejecuci\xf3n:"),J(),Q(9,"input",4),qt("ngModelChange",function(_){return Zt(a.newActionObject.dateAction,_)||(a.newActionObject.dateAction=_),_}),J()(),Q(10,"div",2)(11,"label",5),ge(12,"Cliente:"),J(),Q(13,"div",6)(14,"input",7),qt("ngModelChange",function(_){return Zt(a.newActionObject.customer.name,_)||(a.newActionObject.customer.name=_),_}),J(),Q(15,"button",8),ge(16," Seleccionar Cliente "),J()()(),Q(17,"div",9)(18,"div",10)(19,"div",11)(20,"div",12)(21,"h5",13),ge(22,"Seleccionar Cliente"),J(),un(23,"button",14),J(),Q(24,"div",15)(25,"input",16),qt("ngModelChange",function(_){return Zt(a.searchText,_)||(a.searchText=_),_}),J(),Q(26,"table",17)(27,"thead")(28,"tr")(29,"th"),ge(30,"Nombre"),J(),Q(31,"th"),ge(32,"Email"),J(),Q(33,"th"),ge(34,"Tel\xe9fono"),J(),Q(35,"th"),ge(36,"Acci\xf3n"),J()()(),Q(37,"tbody"),Jt(38,Fee,10,3,"tr",18),J()()(),Q(39,"div",19)(40,"button",20),ge(41,"Cerrar"),J()()()()(),Q(42,"div",2)(43,"label",21),ge(44,"Tipo de Acci\xf3n:"),J(),Q(45,"select",22),qt("ngModelChange",function(_){return Zt(a.newActionObject.type,_)||(a.newActionObject.type=_),_}),At("change",function(){return a.onTypeChange()}),Q(46,"option",23),ge(47,"Seleccione una opci\xf3n"),J(),Jt(48,Lee,2,2,"option",24),J()(),Jt(49,zee,7,2,"div",25),Q(50,"div",2)(51,"label",26),ge(52,"Manager:"),J(),Q(53,"select",27),qt("ngModelChange",function(_){return Zt(a.newActionObject.manager,_)||(a.newActionObject.manager=_),_}),Q(54,"option",23),ge(55,"Seleccione un manager"),J(),Jt(56,Vee,2,2,"option",28),J()(),Q(57,"div",2)(58,"label",26),ge(59,"Detalle:"),J(),Q(60,"input",29),qt("ngModelChange",function(_){return Zt(a.newActionObject.actionComment,_)||(a.newActionObject.actionComment=_),_}),J()(),un(61,"br"),Q(62,"div",30)(63,"div",31)(64,"button",32),At("click",function(){return a.createAction()}),ge(65,"Crear acci\xf3n"),J()(),Q(66,"div",31)(67,"button",33),At("click",function(){return a.backList()}),ge(68,"Regresar"),J()()()()()),2&r&&(we(9),Ht("ngModel",a.newActionObject.dateAction),we(5),Ht("ngModel",a.newActionObject.customer.name),we(11),Ht("ngModel",a.searchText),Tt("ngModelOptions",function TN(e,n,t){const r=vo()+e,a=mt();return a[r]===Kn?ch(a,r,t?n.call(t):n()):function Wx(e,n){return e[n]}(a,r)}(11,kee)),we(13),Tt("ngForOf",a.filteredCustomers()),we(7),Ht("ngModel",a.newActionObject.type),we(3),Tt("ngForOf",a.actionTypes),we(),Tt("ngIf",a.newActionObject.type.requiresOrder),we(4),Ht("ngModel",a.newActionObject.manager),we(3),Tt("ngForOf",a.managers),we(4),Ht("ngModel",a.newActionObject.actionComment))},dependencies:[Lf,jc,OS,r1,o1,Os,Pm,ga,wS,s1,Qs,i1]})}return e})()},{path:"",component:ez}];let jee=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Pi({imports:[U3.forRoot(Uee,{useHash:!1}),U3]})}return e})();function $ee(e,n){if(1&e){const t=$i();Q(0,"nav",1)(1,"ul",2)(2,"li",3)(3,"a",4),ge(4,"Productos"),J()(),Q(5,"li",3)(6,"a",5),ge(7,"Clientes"),J()(),Q(8,"li",3)(9,"a",6),ge(10,"Pedidos"),J()(),Q(11,"li",3)(12,"a",7),ge(13,"Operaci\xf3n"),J()(),Q(14,"li",3)(15,"a",8),ge(16,"Proveedores"),J()(),Q(17,"li",3)(18,"a",9),ge(19,"Compras"),J()(),Q(20,"li",3)(21,"a",10),ge(22,"CRM"),J()(),Q(23,"li",3)(24,"a",11),At("click",function(){return Xt(t),Kt(gt().logout())}),ge(25,"Cerrar Sesi\xf3n"),J()()()()}}let Gee=(()=>{class e{constructor(t,r){this.authService=t,this.router=r}ngOnInit(){}isLoggedIn(){return!!localStorage.getItem("token")}logout(){const t=localStorage.getItem("token");t?this.authService.logout(t).subscribe(()=>{localStorage.removeItem("token"),this.router.navigate(["/login"])},r=>{this.router.navigate(["/login"])}):this.router.navigate(["/login"])}static#e=this.\u0275fac=function(r){return new(r||e)(tt(a1),tt(cs))};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-navigation-bar"]],decls:1,vars:1,consts:[["class","navbar","style","padding: 0;",4,"ngIf"],[1,"navbar",2,"padding","0"],[1,"nav"],[1,"nav-item"],["routerLink","/productos","routerLinkActive","active",1,"nav-link"],["routerLink","/clientes","routerLinkActive","active",1,"nav-link"],["routerLink","/ordenes","routerLinkActive","active",1,"nav-link"],["routerLink","/reports","routerLinkActive","active",1,"nav-link"],["routerLink","/suppliers","routerLinkActive","active",1,"nav-link"],["routerLink","/purchases","routerLinkActive","active",1,"nav-link"],["routerLink","/crm","routerLinkActive","active",1,"nav-link"],[1,"nav-link",3,"click"]],template:function(r,a){1&r&&Jt(0,$ee,26,0,"nav",0),2&r&&Tt("ngIf",a.isLoggedIn())},dependencies:[jc,e1,R3],styles:[".navbar[_ngcontent-%COMP%]{background-color:#333}.nav[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:0;overflow:hidden}.nav-item[_ngcontent-%COMP%]{float:left}.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;color:#fff;text-align:center;padding:14px 16px;text-decoration:none}.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#ddd;color:#000}.active[_ngcontent-%COMP%]{background-color:#4caf50}"]})}return e})(),Hee=(()=>{class e{constructor(){this.title="Admin Frescapp"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=Ti({type:e,selectors:[["app-root"]],decls:3,vars:0,template:function(r,a){1&r&&(Q(0,"div"),un(1,"app-navigation-bar"),J(),un(2,"router-outlet"))},dependencies:[PA,Gee]})}return e})(),qee=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=bi({type:e,bootstrap:[Hee]});static#n=this.\u0275inj=Pi({providers:[xw],imports:[RG,jee,RW,bY,XH,NW,_ee]})}return e})();OG().bootstrapModule(qee).catch(e=>console.error(e))},247:function(xh){xh.exports=function(){"use strict";var qc,Wc,Zu;function dr(d,hr){if(qc)if(Wc){var On="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+qc+")(sharedChunk); ("+Wc+")(sharedChunk); self.onerror = null;",Cn={};qc(Cn),Zu=hr(Cn),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Zu.workerUrl=window.URL.createObjectURL(new Blob([On],{type:"text/javascript"})))}else Wc=hr;else qc=hr}return dr(0,function(d){var hr="3.6.0";let On;const Cn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==On){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{On=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{On=o}}return On},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Cn.API_URL)return null;try{const o=new URL(Cn.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ti(o){return Cn.API_URL_REGEX.test(o)}function Or(o){return 0===o.indexOf("mapbox:")}function Do(o){return Cn.API_CDN_URL_REGEX.test(o)}function ta(o){return Cn.API_SPRITE_REGEX.test(o)}function Ps(o){return Cn.API_STYLE_REGEX.test(o)&&!ta(o)}const ya={create:"create",load:"load",fullLoad:"fullLoad"},Gl={mark(o){performance.mark(o)},measure(o,i,s){performance.measure(o,i,s)}};function ll(o){const i=o.name.split("?")[0];return Do(i)&&i.includes("mapbox-gl.js")?"javascript":Do(i)&&i.includes("mapbox-gl.css")?"css":Cn.API_FONTS_REGEX.test(i)?"fontRange":ta(i)?"sprite":Ps(i)?"style":Cn.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}function us(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Di={},Mi={};Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.setMatrixArrayType=function(o){Mi.ARRAY_TYPE=Va=o},Mi.toRadian=function(o){return o*cl},Mi.equals=function(o,i){return Math.abs(o-i)<=ao*Math.max(1,Math.abs(o),Math.abs(i))},Mi.RANDOM=Mi.ARRAY_TYPE=Mi.EPSILON=void 0;var ao=1e-6;Mi.EPSILON=ao;var Va=typeof Float32Array<"u"?Float32Array:Array;Mi.ARRAY_TYPE=Va;var Hl=Math.random;Mi.RANDOM=Hl;var cl=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var di={};function Jn(o){return(Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(di,"__esModule",{value:!0}),di.create=function(){var o=new ds.ARRAY_TYPE(4);return ds.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},di.clone=function(o){var i=new ds.ARRAY_TYPE(4);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i},di.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o},di.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o},di.fromValues=function(o,i,s,c){var u=new ds.ARRAY_TYPE(4);return u[0]=o,u[1]=i,u[2]=s,u[3]=c,u},di.set=function(o,i,s,c,u){return o[0]=i,o[1]=s,o[2]=c,o[3]=u,o},di.transpose=function(o,i){if(o===i){var s=i[1];o[1]=i[2],o[2]=s}else o[0]=i[0],o[1]=i[2],o[2]=i[1],o[3]=i[3];return o},di.invert=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=s*p-u*c;return m?(o[0]=p*(m=1/m),o[1]=-c*m,o[2]=-u*m,o[3]=s*m,o):null},di.adjoint=function(o,i){var s=i[0];return o[0]=i[3],o[1]=-i[1],o[2]=-i[2],o[3]=s,o},di.determinant=function(o){return o[0]*o[3]-o[2]*o[1]},di.multiply=Yu,di.rotate=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=Math.sin(s),x=Math.cos(s);return o[0]=c*x+p*v,o[1]=u*x+m*v,o[2]=c*-v+p*x,o[3]=u*-v+m*x,o},di.scale=function(o,i,s){var c=i[1],u=i[2],p=i[3],m=s[0],v=s[1];return o[0]=i[0]*m,o[1]=c*m,o[2]=u*v,o[3]=p*v,o},di.fromRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=s,o[2]=-s,o[3]=c,o},di.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=i[1],o},di.str=function(o){return"mat2("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},di.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},di.LDU=function(o,i,s,c){return o[2]=c[2]/c[0],s[0]=c[0],s[1]=c[1],s[3]=c[3]-o[2]*s[1],[o,i,s]},di.add=function(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o[3]=i[3]+s[3],o},di.subtract=dl,di.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},di.equals=function(o,i){var s=o[0],c=o[1],u=o[2],p=o[3],m=i[0],v=i[1],x=i[2],C=i[3];return Math.abs(s-m)<=ds.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-v)<=ds.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-x)<=ds.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(p-C)<=ds.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))},di.multiplyScalar=function(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o},di.multiplyScalarAndAdd=function(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o[3]=i[3]+s[3]*c,o},di.sub=di.mul=void 0;var ds=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Jn(o)&&"function"!=typeof o)return{default:o};var s=ul(void 0);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}(Mi);function ul(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(ul=function(c){return c?s:i})(o)}function Yu(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=s[0],x=s[1],C=s[2],S=s[3];return o[0]=c*v+p*x,o[1]=u*v+m*x,o[2]=c*C+p*S,o[3]=u*C+m*S,o}function dl(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o[3]=i[3]-s[3],o}di.mul=Yu,di.sub=dl;var hi={};function va(o){return(va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(hi,"__esModule",{value:!0}),hi.create=function(){var o=new hs.ARRAY_TYPE(6);return hs.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[4]=0,o[5]=0),o[0]=1,o[3]=1,o},hi.clone=function(o){var i=new hs.ARRAY_TYPE(6);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i},hi.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o},hi.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o[4]=0,o[5]=0,o},hi.fromValues=function(o,i,s,c,u,p){var m=new hs.ARRAY_TYPE(6);return m[0]=o,m[1]=i,m[2]=s,m[3]=c,m[4]=u,m[5]=p,m},hi.set=function(o,i,s,c,u,p,m){return o[0]=i,o[1]=s,o[2]=c,o[3]=u,o[4]=p,o[5]=m,o},hi.invert=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=i[4],v=i[5],x=s*p-c*u;return x?(o[0]=p*(x=1/x),o[1]=-c*x,o[2]=-u*x,o[3]=s*x,o[4]=(u*v-p*m)*x,o[5]=(c*m-s*v)*x,o):null},hi.determinant=function(o){return o[0]*o[3]-o[1]*o[2]},hi.multiply=ql,hi.rotate=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=i[4],x=i[5],C=Math.sin(s),S=Math.cos(s);return o[0]=c*S+p*C,o[1]=u*S+m*C,o[2]=c*-C+p*S,o[3]=u*-C+m*S,o[4]=v,o[5]=x,o},hi.scale=function(o,i,s){var c=i[1],u=i[2],p=i[3],m=i[4],v=i[5],x=s[0],C=s[1];return o[0]=i[0]*x,o[1]=c*x,o[2]=u*C,o[3]=p*C,o[4]=m,o[5]=v,o},hi.translate=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=i[4],x=i[5],C=s[0],S=s[1];return o[0]=c,o[1]=u,o[2]=p,o[3]=m,o[4]=c*C+p*S+v,o[5]=u*C+m*S+x,o},hi.fromRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=s,o[2]=-s,o[3]=c,o[4]=0,o[5]=0,o},hi.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=i[1],o[4]=0,o[5]=0,o},hi.fromTranslation=function(o,i){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o[4]=i[0],o[5]=i[1],o},hi.str=function(o){return"mat2d("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+")"},hi.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],1)},hi.add=function(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o[3]=i[3]+s[3],o[4]=i[4]+s[4],o[5]=i[5]+s[5],o},hi.subtract=Ua,hi.multiplyScalar=function(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o[4]=i[4]*s,o[5]=i[5]*s,o},hi.multiplyScalarAndAdd=function(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o[3]=i[3]+s[3]*c,o[4]=i[4]+s[4]*c,o[5]=i[5]+s[5]*c,o},hi.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]},hi.equals=function(o,i){var s=o[0],c=o[1],u=o[2],p=o[3],m=o[4],v=o[5],x=i[0],C=i[1],S=i[2],I=i[3],A=i[4],N=i[5];return Math.abs(s-x)<=hs.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(c-C)<=hs.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(u-S)<=hs.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(p-I)<=hs.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(m-A)<=hs.EPSILON*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(v-N)<=hs.EPSILON*Math.max(1,Math.abs(v),Math.abs(N))},hi.sub=hi.mul=void 0;var hs=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==va(o)&&"function"!=typeof o)return{default:o};var s=wh(void 0);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}(Mi);function wh(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(wh=function(c){return c?s:i})(o)}function ql(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=i[4],x=i[5],C=s[0],S=s[1],I=s[2],A=s[3],N=s[4],F=s[5];return o[0]=c*C+p*S,o[1]=u*C+m*S,o[2]=c*I+p*A,o[3]=u*I+m*A,o[4]=c*N+p*F+v,o[5]=u*N+m*F+x,o}function Ua(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o[3]=i[3]-s[3],o[4]=i[4]-s[4],o[5]=i[5]-s[5],o}hi.mul=ql,hi.sub=Ua;var ai={};function na(o){return(na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=function(){var o=new Vr.ARRAY_TYPE(9);return Vr.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},ai.fromMat4=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[4],o[4]=i[5],o[5]=i[6],o[6]=i[8],o[7]=i[9],o[8]=i[10],o},ai.clone=function(o){var i=new Vr.ARRAY_TYPE(9);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i},ai.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o},ai.fromValues=function(o,i,s,c,u,p,m,v,x){var C=new Vr.ARRAY_TYPE(9);return C[0]=o,C[1]=i,C[2]=s,C[3]=c,C[4]=u,C[5]=p,C[6]=m,C[7]=v,C[8]=x,C},ai.set=function(o,i,s,c,u,p,m,v,x,C){return o[0]=i,o[1]=s,o[2]=c,o[3]=u,o[4]=p,o[5]=m,o[6]=v,o[7]=x,o[8]=C,o},ai.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ai.transpose=function(o,i){if(o===i){var s=i[1],c=i[2],u=i[5];o[1]=i[3],o[2]=i[6],o[3]=s,o[5]=i[7],o[6]=c,o[7]=u}else o[0]=i[0],o[1]=i[3],o[2]=i[6],o[3]=i[1],o[4]=i[4],o[5]=i[7],o[6]=i[2],o[7]=i[5],o[8]=i[8];return o},ai.invert=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=i[4],v=i[5],x=i[6],C=i[7],S=i[8],I=S*m-v*C,A=-S*p+v*x,N=C*p-m*x,F=s*I+c*A+u*N;return F?(o[0]=I*(F=1/F),o[1]=(-S*c+u*C)*F,o[2]=(v*c-u*m)*F,o[3]=A*F,o[4]=(S*s-u*x)*F,o[5]=(-v*s+u*p)*F,o[6]=N*F,o[7]=(-C*s+c*x)*F,o[8]=(m*s-c*p)*F,o):null},ai.adjoint=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=i[4],v=i[5],x=i[6],C=i[7],S=i[8];return o[0]=m*S-v*C,o[1]=u*C-c*S,o[2]=c*v-u*m,o[3]=v*x-p*S,o[4]=s*S-u*x,o[5]=u*p-s*v,o[6]=p*C-m*x,o[7]=c*x-s*C,o[8]=s*m-c*p,o},ai.determinant=function(o){var i=o[3],s=o[4],c=o[5],u=o[6],p=o[7],m=o[8];return o[0]*(m*s-c*p)+o[1]*(-m*i+c*u)+o[2]*(p*i-s*u)},ai.multiply=Hf,ai.translate=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=i[8],A=s[0],N=s[1];return o[0]=c,o[1]=u,o[2]=p,o[3]=m,o[4]=v,o[5]=x,o[6]=A*c+N*m+C,o[7]=A*u+N*v+S,o[8]=A*p+N*x+I,o},ai.rotate=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=i[8],A=Math.sin(s),N=Math.cos(s);return o[0]=N*c+A*m,o[1]=N*u+A*v,o[2]=N*p+A*x,o[3]=N*m-A*c,o[4]=N*v-A*u,o[5]=N*x-A*p,o[6]=C,o[7]=S,o[8]=I,o},ai.scale=function(o,i,s){var c=s[0],u=s[1];return o[0]=c*i[0],o[1]=c*i[1],o[2]=c*i[2],o[3]=u*i[3],o[4]=u*i[4],o[5]=u*i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o},ai.fromTranslation=function(o,i){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=i[0],o[7]=i[1],o[8]=1,o},ai.fromRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ai.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=i[1],o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ai.fromMat2d=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=0,o[3]=i[2],o[4]=i[3],o[5]=0,o[6]=i[4],o[7]=i[5],o[8]=1,o},ai.fromQuat=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=s+s,v=c+c,x=u+u,C=s*m,S=c*m,I=c*v,A=u*m,N=u*v,F=u*x,z=p*m,V=p*v,$=p*x;return o[0]=1-I-F,o[3]=S-$,o[6]=A+V,o[1]=S+$,o[4]=1-C-F,o[7]=N-z,o[2]=A-V,o[5]=N+z,o[8]=1-C-I,o},ai.normalFromMat4=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=i[4],v=i[5],x=i[6],C=i[7],S=i[8],I=i[9],A=i[10],N=i[11],F=i[12],z=i[13],V=i[14],$=i[15],ne=s*v-c*m,ee=s*x-u*m,re=s*C-p*m,de=c*x-u*v,fe=c*C-p*v,_e=u*C-p*x,De=S*z-I*F,Pe=S*V-A*F,Be=S*$-N*F,Ne=I*V-A*z,He=I*$-N*z,st=A*$-N*V,qe=ne*st-ee*He+re*Ne+de*Be-fe*Pe+_e*De;return qe?(o[0]=(v*st-x*He+C*Ne)*(qe=1/qe),o[1]=(x*Be-m*st-C*Pe)*qe,o[2]=(m*He-v*Be+C*De)*qe,o[3]=(u*He-c*st-p*Ne)*qe,o[4]=(s*st-u*Be+p*Pe)*qe,o[5]=(c*Be-s*He-p*De)*qe,o[6]=(z*_e-V*fe+$*de)*qe,o[7]=(V*re-F*_e-$*ee)*qe,o[8]=(F*fe-z*re+$*ne)*qe,o):null},ai.projection=function(o,i,s){return o[0]=2/i,o[1]=0,o[2]=0,o[3]=0,o[4]=-2/s,o[5]=0,o[6]=-1,o[7]=1,o[8]=1,o},ai.str=function(o){return"mat3("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+", "+o[8]+")"},ai.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8])},ai.add=function(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o[3]=i[3]+s[3],o[4]=i[4]+s[4],o[5]=i[5]+s[5],o[6]=i[6]+s[6],o[7]=i[7]+s[7],o[8]=i[8]+s[8],o},ai.subtract=Zc,ai.multiplyScalar=function(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o[4]=i[4]*s,o[5]=i[5]*s,o[6]=i[6]*s,o[7]=i[7]*s,o[8]=i[8]*s,o},ai.multiplyScalarAndAdd=function(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o[3]=i[3]+s[3]*c,o[4]=i[4]+s[4]*c,o[5]=i[5]+s[5]*c,o[6]=i[6]+s[6]*c,o[7]=i[7]+s[7]*c,o[8]=i[8]+s[8]*c,o},ai.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]},ai.equals=function(o,i){var s=o[0],c=o[1],u=o[2],p=o[3],m=o[4],v=o[5],x=o[6],C=o[7],S=o[8],I=i[0],A=i[1],N=i[2],F=i[3],z=i[4],V=i[5],$=i[6],ne=i[7],ee=i[8];return Math.abs(s-I)<=Vr.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(c-A)<=Vr.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-N)<=Vr.EPSILON*Math.max(1,Math.abs(u),Math.abs(N))&&Math.abs(p-F)<=Vr.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(m-z)<=Vr.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(v-V)<=Vr.EPSILON*Math.max(1,Math.abs(v),Math.abs(V))&&Math.abs(x-$)<=Vr.EPSILON*Math.max(1,Math.abs(x),Math.abs($))&&Math.abs(C-ne)<=Vr.EPSILON*Math.max(1,Math.abs(C),Math.abs(ne))&&Math.abs(S-ee)<=Vr.EPSILON*Math.max(1,Math.abs(S),Math.abs(ee))},ai.sub=ai.mul=void 0;var Vr=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==na(o)&&"function"!=typeof o)return{default:o};var s=Gf(void 0);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}(Mi);function Gf(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(Gf=function(c){return c?s:i})(o)}function Hf(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=i[8],A=s[0],N=s[1],F=s[2],z=s[3],V=s[4],$=s[5],ne=s[6],ee=s[7],re=s[8];return o[0]=A*c+N*m+F*C,o[1]=A*u+N*v+F*S,o[2]=A*p+N*x+F*I,o[3]=z*c+V*m+$*C,o[4]=z*u+V*v+$*S,o[5]=z*p+V*x+$*I,o[6]=ne*c+ee*m+re*C,o[7]=ne*u+ee*v+re*S,o[8]=ne*p+ee*x+re*I,o}function Zc(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o[3]=i[3]-s[3],o[4]=i[4]-s[4],o[5]=i[5]-s[5],o[6]=i[6]-s[6],o[7]=i[7]-s[7],o[8]=i[8]-s[8],o}ai.mul=Hf,ai.sub=Zc;var dn={};function Yc(o){return(Yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(dn,"__esModule",{value:!0}),dn.create=function(){var o=new Ii.ARRAY_TYPE(16);return Ii.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},dn.clone=function(o){var i=new Ii.ARRAY_TYPE(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},dn.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},dn.fromValues=function(o,i,s,c,u,p,m,v,x,C,S,I,A,N,F,z){var V=new Ii.ARRAY_TYPE(16);return V[0]=o,V[1]=i,V[2]=s,V[3]=c,V[4]=u,V[5]=p,V[6]=m,V[7]=v,V[8]=x,V[9]=C,V[10]=S,V[11]=I,V[12]=A,V[13]=N,V[14]=F,V[15]=z,V},dn.set=function(o,i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V){return o[0]=i,o[1]=s,o[2]=c,o[3]=u,o[4]=p,o[5]=m,o[6]=v,o[7]=x,o[8]=C,o[9]=S,o[10]=I,o[11]=A,o[12]=N,o[13]=F,o[14]=z,o[15]=V,o},dn.identity=lt,dn.transpose=function(o,i){if(o===i){var s=i[1],c=i[2],u=i[3],p=i[6],m=i[7],v=i[11];o[1]=i[4],o[2]=i[8],o[3]=i[12],o[4]=s,o[6]=i[9],o[7]=i[13],o[8]=c,o[9]=p,o[11]=i[14],o[12]=u,o[13]=m,o[14]=v}else o[0]=i[0],o[1]=i[4],o[2]=i[8],o[3]=i[12],o[4]=i[1],o[5]=i[5],o[6]=i[9],o[7]=i[13],o[8]=i[2],o[9]=i[6],o[10]=i[10],o[11]=i[14],o[12]=i[3],o[13]=i[7],o[14]=i[11],o[15]=i[15];return o},dn.invert=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=i[4],v=i[5],x=i[6],C=i[7],S=i[8],I=i[9],A=i[10],N=i[11],F=i[12],z=i[13],V=i[14],$=i[15],ne=s*v-c*m,ee=s*x-u*m,re=s*C-p*m,de=c*x-u*v,fe=c*C-p*v,_e=u*C-p*x,De=S*z-I*F,Pe=S*V-A*F,Be=S*$-N*F,Ne=I*V-A*z,He=I*$-N*z,st=A*$-N*V,qe=ne*st-ee*He+re*Ne+de*Be-fe*Pe+_e*De;return qe?(o[0]=(v*st-x*He+C*Ne)*(qe=1/qe),o[1]=(u*He-c*st-p*Ne)*qe,o[2]=(z*_e-V*fe+$*de)*qe,o[3]=(A*fe-I*_e-N*de)*qe,o[4]=(x*Be-m*st-C*Pe)*qe,o[5]=(s*st-u*Be+p*Pe)*qe,o[6]=(V*re-F*_e-$*ee)*qe,o[7]=(S*_e-A*re+N*ee)*qe,o[8]=(m*He-v*Be+C*De)*qe,o[9]=(c*Be-s*He-p*De)*qe,o[10]=(F*fe-z*re+$*ne)*qe,o[11]=(I*re-S*fe-N*ne)*qe,o[12]=(v*Pe-m*Ne-x*De)*qe,o[13]=(s*Ne-c*Pe+u*De)*qe,o[14]=(z*ee-F*de-V*ne)*qe,o[15]=(S*de-I*ee+A*ne)*qe,o):null},dn.adjoint=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=i[4],v=i[5],x=i[6],C=i[7],S=i[8],I=i[9],A=i[10],N=i[11],F=i[12],z=i[13],V=i[14],$=i[15];return o[0]=v*(A*$-N*V)-I*(x*$-C*V)+z*(x*N-C*A),o[1]=-(c*(A*$-N*V)-I*(u*$-p*V)+z*(u*N-p*A)),o[2]=c*(x*$-C*V)-v*(u*$-p*V)+z*(u*C-p*x),o[3]=-(c*(x*N-C*A)-v*(u*N-p*A)+I*(u*C-p*x)),o[4]=-(m*(A*$-N*V)-S*(x*$-C*V)+F*(x*N-C*A)),o[5]=s*(A*$-N*V)-S*(u*$-p*V)+F*(u*N-p*A),o[6]=-(s*(x*$-C*V)-m*(u*$-p*V)+F*(u*C-p*x)),o[7]=s*(x*N-C*A)-m*(u*N-p*A)+S*(u*C-p*x),o[8]=m*(I*$-N*z)-S*(v*$-C*z)+F*(v*N-C*I),o[9]=-(s*(I*$-N*z)-S*(c*$-p*z)+F*(c*N-p*I)),o[10]=s*(v*$-C*z)-m*(c*$-p*z)+F*(c*C-p*v),o[11]=-(s*(v*N-C*I)-m*(c*N-p*I)+S*(c*C-p*v)),o[12]=-(m*(I*V-A*z)-S*(v*V-x*z)+F*(v*A-x*I)),o[13]=s*(I*V-A*z)-S*(c*V-u*z)+F*(c*A-u*I),o[14]=-(s*(v*V-x*z)-m*(c*V-u*z)+F*(c*x-u*v)),o[15]=s*(v*A-x*I)-m*(c*A-u*I)+S*(c*x-u*v),o},dn.determinant=function(o){var i=o[0],s=o[1],c=o[2],u=o[3],p=o[4],m=o[5],v=o[6],x=o[7],C=o[8],S=o[9],I=o[10],A=o[11],N=o[12],F=o[13],z=o[14],V=o[15];return(i*m-s*p)*(I*V-A*z)-(i*v-c*p)*(S*V-A*F)+(i*x-u*p)*(S*z-I*F)+(s*v-c*m)*(C*V-A*N)-(s*x-u*m)*(C*z-I*N)+(c*x-u*v)*(C*F-S*N)},dn.multiply=St,dn.translate=function(o,i,s){var c,u,p,m,v,x,C,S,I,A,N,F,z=s[0],V=s[1],$=s[2];return i===o?(o[12]=i[0]*z+i[4]*V+i[8]*$+i[12],o[13]=i[1]*z+i[5]*V+i[9]*$+i[13],o[14]=i[2]*z+i[6]*V+i[10]*$+i[14],o[15]=i[3]*z+i[7]*V+i[11]*$+i[15]):(u=i[1],p=i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=i[8],A=i[9],N=i[10],F=i[11],o[0]=c=i[0],o[1]=u,o[2]=p,o[3]=m,o[4]=v,o[5]=x,o[6]=C,o[7]=S,o[8]=I,o[9]=A,o[10]=N,o[11]=F,o[12]=c*z+v*V+I*$+i[12],o[13]=u*z+x*V+A*$+i[13],o[14]=p*z+C*V+N*$+i[14],o[15]=m*z+S*V+F*$+i[15]),o},dn.scale=function(o,i,s){var c=s[0],u=s[1],p=s[2];return o[0]=i[0]*c,o[1]=i[1]*c,o[2]=i[2]*c,o[3]=i[3]*c,o[4]=i[4]*u,o[5]=i[5]*u,o[6]=i[6]*u,o[7]=i[7]*u,o[8]=i[8]*p,o[9]=i[9]*p,o[10]=i[10]*p,o[11]=i[11]*p,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},dn.rotate=function(o,i,s,c){var u,p,m,v,x,C,S,I,A,N,F,z,V,$,ne,ee,re,de,fe,_e,De,Pe,Be,Ne,He=c[0],st=c[1],qe=c[2],ut=Math.hypot(He,st,qe);return ut<Ii.EPSILON?null:(He*=ut=1/ut,st*=ut,qe*=ut,u=Math.sin(s),p=Math.cos(s),x=i[1],C=i[2],S=i[3],A=i[5],N=i[6],F=i[7],V=i[9],$=i[10],ne=i[11],ee=He*He*(m=1-p)+p,fe=He*st*m-qe*u,_e=st*st*m+p,De=qe*st*m+He*u,Pe=He*qe*m+st*u,Be=st*qe*m-He*u,Ne=qe*qe*m+p,o[0]=(v=i[0])*ee+(I=i[4])*(re=st*He*m+qe*u)+(z=i[8])*(de=qe*He*m-st*u),o[1]=x*ee+A*re+V*de,o[2]=C*ee+N*re+$*de,o[3]=S*ee+F*re+ne*de,o[4]=v*fe+I*_e+z*De,o[5]=x*fe+A*_e+V*De,o[6]=C*fe+N*_e+$*De,o[7]=S*fe+F*_e+ne*De,o[8]=v*Pe+I*Be+z*Ne,o[9]=x*Pe+A*Be+V*Ne,o[10]=C*Pe+N*Be+$*Ne,o[11]=S*Pe+F*Be+ne*Ne,i!==o&&(o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o)},dn.rotateX=function(o,i,s){var c=Math.sin(s),u=Math.cos(s),p=i[4],m=i[5],v=i[6],x=i[7],C=i[8],S=i[9],I=i[10],A=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=p*u+C*c,o[5]=m*u+S*c,o[6]=v*u+I*c,o[7]=x*u+A*c,o[8]=C*u-p*c,o[9]=S*u-m*c,o[10]=I*u-v*c,o[11]=A*u-x*c,o},dn.rotateY=function(o,i,s){var c=Math.sin(s),u=Math.cos(s),p=i[0],m=i[1],v=i[2],x=i[3],C=i[8],S=i[9],I=i[10],A=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=p*u-C*c,o[1]=m*u-S*c,o[2]=v*u-I*c,o[3]=x*u-A*c,o[8]=p*c+C*u,o[9]=m*c+S*u,o[10]=v*c+I*u,o[11]=x*c+A*u,o},dn.rotateZ=function(o,i,s){var c=Math.sin(s),u=Math.cos(s),p=i[0],m=i[1],v=i[2],x=i[3],C=i[4],S=i[5],I=i[6],A=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=p*u+C*c,o[1]=m*u+S*c,o[2]=v*u+I*c,o[3]=x*u+A*c,o[4]=C*u-p*c,o[5]=S*u-m*c,o[6]=I*u-v*c,o[7]=A*u-x*c,o},dn.fromTranslation=function(o,i){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=i[0],o[13]=i[1],o[14]=i[2],o[15]=1,o},dn.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},dn.fromRotation=function(o,i,s){var c,u,p,m=s[0],v=s[1],x=s[2],C=Math.hypot(m,v,x);return C<Ii.EPSILON?null:(m*=C=1/C,v*=C,x*=C,c=Math.sin(i),u=Math.cos(i),o[0]=m*m*(p=1-u)+u,o[1]=v*m*p+x*c,o[2]=x*m*p-v*c,o[3]=0,o[4]=m*v*p-x*c,o[5]=v*v*p+u,o[6]=x*v*p+m*c,o[7]=0,o[8]=m*x*p+v*c,o[9]=v*x*p-m*c,o[10]=x*x*p+u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)},dn.fromXRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=c,o[6]=s,o[7]=0,o[8]=0,o[9]=-s,o[10]=c,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},dn.fromYRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=0,o[2]=-s,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=s,o[9]=0,o[10]=c,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},dn.fromZRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=s,o[2]=0,o[3]=0,o[4]=-s,o[5]=c,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},dn.fromRotationTranslation=kt,dn.fromQuat2=function(o,i){var s=new Ii.ARRAY_TYPE(3),c=-i[0],u=-i[1],p=-i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=c*c+u*u+p*p+m*m;return I>0?(s[0]=2*(v*m+S*c+x*p-C*u)/I,s[1]=2*(x*m+S*u+C*c-v*p)/I,s[2]=2*(C*m+S*p+v*u-x*c)/I):(s[0]=2*(v*m+S*c+x*p-C*u),s[1]=2*(x*m+S*u+C*c-v*p),s[2]=2*(C*m+S*p+v*u-x*c)),kt(o,i,s),o},dn.getTranslation=function(o,i){return o[0]=i[12],o[1]=i[13],o[2]=i[14],o},dn.getScaling=yn,dn.getRotation=function(o,i){var s=new Ii.ARRAY_TYPE(3);yn(s,i);var c=1/s[0],u=1/s[1],p=1/s[2],m=i[0]*c,v=i[1]*u,x=i[2]*p,C=i[4]*c,S=i[5]*u,I=i[6]*p,A=i[8]*c,N=i[9]*u,F=i[10]*p,z=m+S+F,V=0;return z>0?(V=2*Math.sqrt(z+1),o[3]=.25*V,o[0]=(I-N)/V,o[1]=(A-x)/V,o[2]=(v-C)/V):m>S&&m>F?(V=2*Math.sqrt(1+m-S-F),o[3]=(I-N)/V,o[0]=.25*V,o[1]=(v+C)/V,o[2]=(A+x)/V):S>F?(V=2*Math.sqrt(1+S-m-F),o[3]=(A-x)/V,o[0]=(v+C)/V,o[1]=.25*V,o[2]=(I+N)/V):(V=2*Math.sqrt(1+F-m-S),o[3]=(v-C)/V,o[0]=(A+x)/V,o[1]=(I+N)/V,o[2]=.25*V),o},dn.fromRotationTranslationScale=function(o,i,s,c){var u=i[0],p=i[1],m=i[2],v=i[3],x=u+u,C=p+p,S=m+m,I=u*x,A=u*C,N=u*S,F=p*C,z=p*S,V=m*S,$=v*x,ne=v*C,ee=v*S,re=c[0],de=c[1],fe=c[2];return o[0]=(1-(F+V))*re,o[1]=(A+ee)*re,o[2]=(N-ne)*re,o[3]=0,o[4]=(A-ee)*de,o[5]=(1-(I+V))*de,o[6]=(z+$)*de,o[7]=0,o[8]=(N+ne)*fe,o[9]=(z-$)*fe,o[10]=(1-(I+F))*fe,o[11]=0,o[12]=s[0],o[13]=s[1],o[14]=s[2],o[15]=1,o},dn.fromRotationTranslationScaleOrigin=function(o,i,s,c,u){var p=i[0],m=i[1],v=i[2],x=i[3],C=p+p,S=m+m,I=v+v,A=p*C,N=p*S,F=p*I,z=m*S,V=m*I,$=v*I,ne=x*C,ee=x*S,re=x*I,de=c[0],fe=c[1],_e=c[2],De=u[0],Pe=u[1],Be=u[2],Ne=(1-(z+$))*de,He=(N+re)*de,st=(F-ee)*de,qe=(N-re)*fe,ut=(1-(A+$))*fe,Ge=(V+ne)*fe,Qe=(F+ee)*_e,ht=(V-ne)*_e,$e=(1-(A+z))*_e;return o[0]=Ne,o[1]=He,o[2]=st,o[3]=0,o[4]=qe,o[5]=ut,o[6]=Ge,o[7]=0,o[8]=Qe,o[9]=ht,o[10]=$e,o[11]=0,o[12]=s[0]+De-(Ne*De+qe*Pe+Qe*Be),o[13]=s[1]+Pe-(He*De+ut*Pe+ht*Be),o[14]=s[2]+Be-(st*De+Ge*Pe+$e*Be),o[15]=1,o},dn.fromQuat=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=s+s,v=c+c,x=u+u,C=s*m,S=c*m,I=c*v,A=u*m,N=u*v,F=u*x,z=p*m,V=p*v,$=p*x;return o[0]=1-I-F,o[1]=S+$,o[2]=A-V,o[3]=0,o[4]=S-$,o[5]=1-C-F,o[6]=N+z,o[7]=0,o[8]=A+V,o[9]=N-z,o[10]=1-C-I,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},dn.frustum=function(o,i,s,c,u,p,m){var v=1/(s-i),x=1/(u-c),C=1/(p-m);return o[0]=2*p*v,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*p*x,o[6]=0,o[7]=0,o[8]=(s+i)*v,o[9]=(u+c)*x,o[10]=(m+p)*C,o[11]=-1,o[12]=0,o[13]=0,o[14]=m*p*2*C,o[15]=0,o},dn.perspectiveNO=Pt,dn.perspectiveZO=function(o,i,s,c,u){var p,m=1/Math.tan(i/2);return o[0]=m/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=m,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=u&&u!==1/0?(o[10]=u*(p=1/(c-u)),o[14]=u*c*p):(o[10]=-1,o[14]=-c),o},dn.perspectiveFromFieldOfView=function(o,i,s,c){var u=Math.tan(i.upDegrees*Math.PI/180),p=Math.tan(i.downDegrees*Math.PI/180),m=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),x=2/(m+v),C=2/(u+p);return o[0]=x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=C,o[6]=0,o[7]=0,o[8]=-(m-v)*x*.5,o[9]=(u-p)*C*.5,o[10]=c/(s-c),o[11]=-1,o[12]=0,o[13]=0,o[14]=c*s/(s-c),o[15]=0,o},dn.orthoNO=qi,dn.orthoZO=function(o,i,s,c,u,p,m){var v=1/(i-s),x=1/(c-u),C=1/(p-m);return o[0]=-2*v,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=C,o[11]=0,o[12]=(i+s)*v,o[13]=(u+c)*x,o[14]=p*C,o[15]=1,o},dn.lookAt=function(o,i,s,c){var u,p,m,v,x,C,S,I,A,N,F=i[0],z=i[1],V=i[2],$=c[0],ne=c[1],ee=c[2],re=s[0],de=s[1],fe=s[2];return Math.abs(F-re)<Ii.EPSILON&&Math.abs(z-de)<Ii.EPSILON&&Math.abs(V-fe)<Ii.EPSILON?lt(o):(S=F-re,I=z-de,A=V-fe,u=ne*(A*=N=1/Math.hypot(S,I,A))-ee*(I*=N),p=ee*(S*=N)-$*A,m=$*I-ne*S,(N=Math.hypot(u,p,m))?(u*=N=1/N,p*=N,m*=N):(u=0,p=0,m=0),v=I*m-A*p,x=A*u-S*m,C=S*p-I*u,(N=Math.hypot(v,x,C))?(v*=N=1/N,x*=N,C*=N):(v=0,x=0,C=0),o[0]=u,o[1]=v,o[2]=S,o[3]=0,o[4]=p,o[5]=x,o[6]=I,o[7]=0,o[8]=m,o[9]=C,o[10]=A,o[11]=0,o[12]=-(u*F+p*z+m*V),o[13]=-(v*F+x*z+C*V),o[14]=-(S*F+I*z+A*V),o[15]=1,o)},dn.targetTo=function(o,i,s,c){var u=i[0],p=i[1],m=i[2],v=c[0],x=c[1],C=c[2],S=u-s[0],I=p-s[1],A=m-s[2],N=S*S+I*I+A*A;N>0&&(S*=N=1/Math.sqrt(N),I*=N,A*=N);var F=x*A-C*I,z=C*S-v*A,V=v*I-x*S;return(N=F*F+z*z+V*V)>0&&(F*=N=1/Math.sqrt(N),z*=N,V*=N),o[0]=F,o[1]=z,o[2]=V,o[3]=0,o[4]=I*V-A*z,o[5]=A*F-S*V,o[6]=S*z-I*F,o[7]=0,o[8]=S,o[9]=I,o[10]=A,o[11]=0,o[12]=u,o[13]=p,o[14]=m,o[15]=1,o},dn.str=function(o){return"mat4("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+", "+o[8]+", "+o[9]+", "+o[10]+", "+o[11]+", "+o[12]+", "+o[13]+", "+o[14]+", "+o[15]+")"},dn.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15])},dn.add=function(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o[3]=i[3]+s[3],o[4]=i[4]+s[4],o[5]=i[5]+s[5],o[6]=i[6]+s[6],o[7]=i[7]+s[7],o[8]=i[8]+s[8],o[9]=i[9]+s[9],o[10]=i[10]+s[10],o[11]=i[11]+s[11],o[12]=i[12]+s[12],o[13]=i[13]+s[13],o[14]=i[14]+s[14],o[15]=i[15]+s[15],o},dn.subtract=Ai,dn.multiplyScalar=function(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o[4]=i[4]*s,o[5]=i[5]*s,o[6]=i[6]*s,o[7]=i[7]*s,o[8]=i[8]*s,o[9]=i[9]*s,o[10]=i[10]*s,o[11]=i[11]*s,o[12]=i[12]*s,o[13]=i[13]*s,o[14]=i[14]*s,o[15]=i[15]*s,o},dn.multiplyScalarAndAdd=function(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o[3]=i[3]+s[3]*c,o[4]=i[4]+s[4]*c,o[5]=i[5]+s[5]*c,o[6]=i[6]+s[6]*c,o[7]=i[7]+s[7]*c,o[8]=i[8]+s[8]*c,o[9]=i[9]+s[9]*c,o[10]=i[10]+s[10]*c,o[11]=i[11]+s[11]*c,o[12]=i[12]+s[12]*c,o[13]=i[13]+s[13]*c,o[14]=i[14]+s[14]*c,o[15]=i[15]+s[15]*c,o},dn.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},dn.equals=function(o,i){var s=o[0],c=o[1],u=o[2],p=o[3],m=o[4],v=o[5],x=o[6],C=o[7],S=o[8],I=o[9],A=o[10],N=o[11],F=o[12],z=o[13],V=o[14],$=o[15],ne=i[0],ee=i[1],re=i[2],de=i[3],fe=i[4],_e=i[5],De=i[6],Pe=i[7],Be=i[8],Ne=i[9],He=i[10],st=i[11],qe=i[12],ut=i[13],Ge=i[14],Qe=i[15];return Math.abs(s-ne)<=Ii.EPSILON*Math.max(1,Math.abs(s),Math.abs(ne))&&Math.abs(c-ee)<=Ii.EPSILON*Math.max(1,Math.abs(c),Math.abs(ee))&&Math.abs(u-re)<=Ii.EPSILON*Math.max(1,Math.abs(u),Math.abs(re))&&Math.abs(p-de)<=Ii.EPSILON*Math.max(1,Math.abs(p),Math.abs(de))&&Math.abs(m-fe)<=Ii.EPSILON*Math.max(1,Math.abs(m),Math.abs(fe))&&Math.abs(v-_e)<=Ii.EPSILON*Math.max(1,Math.abs(v),Math.abs(_e))&&Math.abs(x-De)<=Ii.EPSILON*Math.max(1,Math.abs(x),Math.abs(De))&&Math.abs(C-Pe)<=Ii.EPSILON*Math.max(1,Math.abs(C),Math.abs(Pe))&&Math.abs(S-Be)<=Ii.EPSILON*Math.max(1,Math.abs(S),Math.abs(Be))&&Math.abs(I-Ne)<=Ii.EPSILON*Math.max(1,Math.abs(I),Math.abs(Ne))&&Math.abs(A-He)<=Ii.EPSILON*Math.max(1,Math.abs(A),Math.abs(He))&&Math.abs(N-st)<=Ii.EPSILON*Math.max(1,Math.abs(N),Math.abs(st))&&Math.abs(F-qe)<=Ii.EPSILON*Math.max(1,Math.abs(F),Math.abs(qe))&&Math.abs(z-ut)<=Ii.EPSILON*Math.max(1,Math.abs(z),Math.abs(ut))&&Math.abs(V-Ge)<=Ii.EPSILON*Math.max(1,Math.abs(V),Math.abs(Ge))&&Math.abs($-Qe)<=Ii.EPSILON*Math.max(1,Math.abs($),Math.abs(Qe))},dn.sub=dn.mul=dn.ortho=dn.perspective=void 0;var Ii=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Yc(o)&&"function"!=typeof o)return{default:o};var s=it(void 0);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}(Mi);function it(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(it=function(c){return c?s:i})(o)}function lt(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function St(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=i[8],A=i[9],N=i[10],F=i[11],z=i[12],V=i[13],$=i[14],ne=i[15],ee=s[0],re=s[1],de=s[2],fe=s[3];return o[0]=ee*c+re*v+de*I+fe*z,o[1]=ee*u+re*x+de*A+fe*V,o[2]=ee*p+re*C+de*N+fe*$,o[3]=ee*m+re*S+de*F+fe*ne,o[4]=(ee=s[4])*c+(re=s[5])*v+(de=s[6])*I+(fe=s[7])*z,o[5]=ee*u+re*x+de*A+fe*V,o[6]=ee*p+re*C+de*N+fe*$,o[7]=ee*m+re*S+de*F+fe*ne,o[8]=(ee=s[8])*c+(re=s[9])*v+(de=s[10])*I+(fe=s[11])*z,o[9]=ee*u+re*x+de*A+fe*V,o[10]=ee*p+re*C+de*N+fe*$,o[11]=ee*m+re*S+de*F+fe*ne,o[12]=(ee=s[12])*c+(re=s[13])*v+(de=s[14])*I+(fe=s[15])*z,o[13]=ee*u+re*x+de*A+fe*V,o[14]=ee*p+re*C+de*N+fe*$,o[15]=ee*m+re*S+de*F+fe*ne,o}function kt(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=c+c,x=u+u,C=p+p,S=c*v,I=c*x,A=c*C,N=u*x,F=u*C,z=p*C,V=m*v,$=m*x,ne=m*C;return o[0]=1-(N+z),o[1]=I+ne,o[2]=A-$,o[3]=0,o[4]=I-ne,o[5]=1-(S+z),o[6]=F+V,o[7]=0,o[8]=A+$,o[9]=F-V,o[10]=1-(S+N),o[11]=0,o[12]=s[0],o[13]=s[1],o[14]=s[2],o[15]=1,o}function yn(o,i){var s=i[4],c=i[5],u=i[6],p=i[8],m=i[9],v=i[10];return o[0]=Math.hypot(i[0],i[1],i[2]),o[1]=Math.hypot(s,c,u),o[2]=Math.hypot(p,m,v),o}function Pt(o,i,s,c,u){var p,m=1/Math.tan(i/2);return o[0]=m/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=m,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=u&&u!==1/0?(o[10]=(u+c)*(p=1/(c-u)),o[14]=2*u*c*p):(o[10]=-1,o[14]=-2*c),o}function qi(o,i,s,c,u,p,m){var v=1/(i-s),x=1/(c-u),C=1/(p-m);return o[0]=-2*v,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*C,o[11]=0,o[12]=(i+s)*v,o[13]=(u+c)*x,o[14]=(m+p)*C,o[15]=1,o}function Ai(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o[3]=i[3]-s[3],o[4]=i[4]-s[4],o[5]=i[5]-s[5],o[6]=i[6]-s[6],o[7]=i[7]-s[7],o[8]=i[8]-s[8],o[9]=i[9]-s[9],o[10]=i[10]-s[10],o[11]=i[11]-s[11],o[12]=i[12]-s[12],o[13]=i[13]-s[13],o[14]=i[14]-s[14],o[15]=i[15]-s[15],o}dn.perspective=Pt,dn.ortho=qi,dn.mul=St,dn.sub=Ai;var Ft={},Rt={};function fs(o){return(fs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=ps,Rt.clone=function(o){var i=new Pr.ARRAY_TYPE(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i},Rt.length=Sr,Rt.fromValues=function(o,i,s){var c=new Pr.ARRAY_TYPE(3);return c[0]=o,c[1]=i,c[2]=s,c},Rt.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o},Rt.set=function(o,i,s,c){return o[0]=i,o[1]=s,o[2]=c,o},Rt.add=function(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o},Rt.subtract=ja,Rt.multiply=ki,Rt.divide=ms,Rt.ceil=function(o,i){return o[0]=Math.ceil(i[0]),o[1]=Math.ceil(i[1]),o[2]=Math.ceil(i[2]),o},Rt.floor=function(o,i){return o[0]=Math.floor(i[0]),o[1]=Math.floor(i[1]),o[2]=Math.floor(i[2]),o},Rt.min=function(o,i,s){return o[0]=Math.min(i[0],s[0]),o[1]=Math.min(i[1],s[1]),o[2]=Math.min(i[2],s[2]),o},Rt.max=function(o,i,s){return o[0]=Math.max(i[0],s[0]),o[1]=Math.max(i[1],s[1]),o[2]=Math.max(i[2],s[2]),o},Rt.round=function(o,i){return o[0]=Math.round(i[0]),o[1]=Math.round(i[1]),o[2]=Math.round(i[2]),o},Rt.scale=function(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o},Rt.scaleAndAdd=function(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o},Rt.distance=Wl,Rt.squaredDistance=Xc,Rt.squaredLength=$a,Rt.negate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o},Rt.inverse=function(o,i){return o[0]=1/i[0],o[1]=1/i[1],o[2]=1/i[2],o},Rt.normalize=function(o,i){var s=i[0],c=i[1],u=i[2],p=s*s+c*c+u*u;return p>0&&(p=1/Math.sqrt(p)),o[0]=i[0]*p,o[1]=i[1]*p,o[2]=i[2]*p,o},Rt.dot=ia,Rt.cross=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=s[0],v=s[1],x=s[2];return o[0]=u*x-p*v,o[1]=p*m-c*x,o[2]=c*v-u*m,o},Rt.lerp=function(o,i,s,c){var u=i[0],p=i[1],m=i[2];return o[0]=u+c*(s[0]-u),o[1]=p+c*(s[1]-p),o[2]=m+c*(s[2]-m),o},Rt.hermite=function(o,i,s,c,u,p){var m=p*p,v=m*(2*p-3)+1,x=m*(p-2)+p,C=m*(p-1),S=m*(3-2*p);return o[0]=i[0]*v+s[0]*x+c[0]*C+u[0]*S,o[1]=i[1]*v+s[1]*x+c[1]*C+u[1]*S,o[2]=i[2]*v+s[2]*x+c[2]*C+u[2]*S,o},Rt.bezier=function(o,i,s,c,u,p){var m=1-p,v=m*m,x=p*p,C=v*m,S=3*p*v,I=3*x*m,A=x*p;return o[0]=i[0]*C+s[0]*S+c[0]*I+u[0]*A,o[1]=i[1]*C+s[1]*S+c[1]*I+u[1]*A,o[2]=i[2]*C+s[2]*S+c[2]*I+u[2]*A,o},Rt.random=function(o,i){i=i||1;var s=2*Pr.RANDOM()*Math.PI,c=2*Pr.RANDOM()-1,u=Math.sqrt(1-c*c)*i;return o[0]=Math.cos(s)*u,o[1]=Math.sin(s)*u,o[2]=c*i,o},Rt.transformMat4=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=s[3]*c+s[7]*u+s[11]*p+s[15];return o[0]=(s[0]*c+s[4]*u+s[8]*p+s[12])/(m=m||1),o[1]=(s[1]*c+s[5]*u+s[9]*p+s[13])/m,o[2]=(s[2]*c+s[6]*u+s[10]*p+s[14])/m,o},Rt.transformMat3=function(o,i,s){var c=i[0],u=i[1],p=i[2];return o[0]=c*s[0]+u*s[3]+p*s[6],o[1]=c*s[1]+u*s[4]+p*s[7],o[2]=c*s[2]+u*s[5]+p*s[8],o},Rt.transformQuat=function(o,i,s){var c=s[0],u=s[1],p=s[2],m=i[0],v=i[1],x=i[2],C=u*x-p*v,S=p*m-c*x,I=c*v-u*m,A=u*I-p*S,N=p*C-c*I,F=c*S-u*C,z=2*s[3];return S*=z,I*=z,N*=2,F*=2,o[0]=m+(C*=z)+(A*=2),o[1]=v+S+N,o[2]=x+I+F,o},Rt.rotateX=function(o,i,s,c){var u=[],p=[];return u[0]=i[0]-s[0],u[1]=i[1]-s[1],u[2]=i[2]-s[2],p[0]=u[0],p[1]=u[1]*Math.cos(c)-u[2]*Math.sin(c),p[2]=u[1]*Math.sin(c)+u[2]*Math.cos(c),o[0]=p[0]+s[0],o[1]=p[1]+s[1],o[2]=p[2]+s[2],o},Rt.rotateY=function(o,i,s,c){var u=[],p=[];return u[0]=i[0]-s[0],u[1]=i[1]-s[1],u[2]=i[2]-s[2],p[0]=u[2]*Math.sin(c)+u[0]*Math.cos(c),p[1]=u[1],p[2]=u[2]*Math.cos(c)-u[0]*Math.sin(c),o[0]=p[0]+s[0],o[1]=p[1]+s[1],o[2]=p[2]+s[2],o},Rt.rotateZ=function(o,i,s,c){var u=[],p=[];return u[0]=i[0]-s[0],u[1]=i[1]-s[1],u[2]=i[2]-s[2],p[0]=u[0]*Math.cos(c)-u[1]*Math.sin(c),p[1]=u[0]*Math.sin(c)+u[1]*Math.cos(c),p[2]=u[2],o[0]=p[0]+s[0],o[1]=p[1]+s[1],o[2]=p[2]+s[2],o},Rt.angle=function(o,i){var s=o[0],c=o[1],u=o[2],p=i[0],m=i[1],v=i[2],x=Math.sqrt(s*s+c*c+u*u)*Math.sqrt(p*p+m*m+v*v),C=x&&ia(o,i)/x;return Math.acos(Math.min(Math.max(C,-1),1))},Rt.zero=function(o){return o[0]=0,o[1]=0,o[2]=0,o},Rt.str=function(o){return"vec3("+o[0]+", "+o[1]+", "+o[2]+")"},Rt.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]},Rt.equals=function(o,i){var s=o[0],c=o[1],u=o[2],p=i[0],m=i[1],v=i[2];return Math.abs(s-p)<=Pr.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(c-m)<=Pr.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(u-v)<=Pr.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},Rt.forEach=Rt.sqrLen=Rt.len=Rt.sqrDist=Rt.dist=Rt.div=Rt.mul=Rt.sub=void 0;var Pr=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==fs(o)&&"function"!=typeof o)return{default:o};var s=$o(void 0);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}(Mi);function $o(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return($o=function(c){return c?s:i})(o)}function ps(){var o=new Pr.ARRAY_TYPE(3);return Pr.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Sr(o){return Math.hypot(o[0],o[1],o[2])}function ja(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o}function ki(o,i,s){return o[0]=i[0]*s[0],o[1]=i[1]*s[1],o[2]=i[2]*s[2],o}function ms(o,i,s){return o[0]=i[0]/s[0],o[1]=i[1]/s[1],o[2]=i[2]/s[2],o}function Wl(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2])}function Xc(o,i){var s=i[0]-o[0],c=i[1]-o[1],u=i[2]-o[2];return s*s+c*c+u*u}function $a(o){var i=o[0],s=o[1],c=o[2];return i*i+s*s+c*c}function ia(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]}Rt.sub=ja,Rt.mul=ki,Rt.div=ms,Rt.dist=Wl,Rt.sqrDist=Xc,Rt.len=Sr,Rt.sqrLen=$a;var Go,Ho=(Go=ps(),function(o,i,s,c,u,p){var m,v;for(i||(i=3),s||(s=0),v=c?Math.min(c*i+s,o.length):o.length,m=s;m<v;m+=i)Go[0]=o[m],Go[1]=o[m+1],Go[2]=o[m+2],u(Go,Go,p),o[m]=Go[0],o[m+1]=Go[1],o[m+2]=Go[2];return o});Rt.forEach=Ho;var pn={};function Xu(o){return(Xu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(pn,"__esModule",{value:!0}),pn.create=hl,pn.clone=function(o){var i=new Qr.ARRAY_TYPE(4);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i},pn.fromValues=function(o,i,s,c){var u=new Qr.ARRAY_TYPE(4);return u[0]=o,u[1]=i,u[2]=s,u[3]=c,u},pn.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o},pn.set=function(o,i,s,c,u){return o[0]=i,o[1]=s,o[2]=c,o[3]=u,o},pn.add=function(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o[3]=i[3]+s[3],o},pn.subtract=qo,pn.multiply=Ku,pn.divide=Kc,pn.ceil=function(o,i){return o[0]=Math.ceil(i[0]),o[1]=Math.ceil(i[1]),o[2]=Math.ceil(i[2]),o[3]=Math.ceil(i[3]),o},pn.floor=function(o,i){return o[0]=Math.floor(i[0]),o[1]=Math.floor(i[1]),o[2]=Math.floor(i[2]),o[3]=Math.floor(i[3]),o},pn.min=function(o,i,s){return o[0]=Math.min(i[0],s[0]),o[1]=Math.min(i[1],s[1]),o[2]=Math.min(i[2],s[2]),o[3]=Math.min(i[3],s[3]),o},pn.max=function(o,i,s){return o[0]=Math.max(i[0],s[0]),o[1]=Math.max(i[1],s[1]),o[2]=Math.max(i[2],s[2]),o[3]=Math.max(i[3],s[3]),o},pn.round=function(o,i){return o[0]=Math.round(i[0]),o[1]=Math.round(i[1]),o[2]=Math.round(i[2]),o[3]=Math.round(i[3]),o},pn.scale=function(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o},pn.scaleAndAdd=function(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o[3]=i[3]+s[3]*c,o},pn.distance=Ju,pn.squaredDistance=fl,pn.length=gs,pn.squaredLength=Qu,pn.negate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=-i[3],o},pn.inverse=function(o,i){return o[0]=1/i[0],o[1]=1/i[1],o[2]=1/i[2],o[3]=1/i[3],o},pn.normalize=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=s*s+c*c+u*u+p*p;return m>0&&(m=1/Math.sqrt(m)),o[0]=s*m,o[1]=c*m,o[2]=u*m,o[3]=p*m,o},pn.dot=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]},pn.cross=function(o,i,s,c){var u=s[0]*c[1]-s[1]*c[0],p=s[0]*c[2]-s[2]*c[0],m=s[0]*c[3]-s[3]*c[0],v=s[1]*c[2]-s[2]*c[1],x=s[1]*c[3]-s[3]*c[1],C=s[2]*c[3]-s[3]*c[2],S=i[0],I=i[1],A=i[2],N=i[3];return o[0]=I*C-A*x+N*v,o[1]=-S*C+A*m-N*p,o[2]=S*x-I*m+N*u,o[3]=-S*v+I*p-A*u,o},pn.lerp=function(o,i,s,c){var u=i[0],p=i[1],m=i[2],v=i[3];return o[0]=u+c*(s[0]-u),o[1]=p+c*(s[1]-p),o[2]=m+c*(s[2]-m),o[3]=v+c*(s[3]-v),o},pn.random=function(o,i){var s,c,u,p,m,v;i=i||1;do{m=(s=2*Qr.RANDOM()-1)*s+(c=2*Qr.RANDOM()-1)*c}while(m>=1);do{v=(u=2*Qr.RANDOM()-1)*u+(p=2*Qr.RANDOM()-1)*p}while(v>=1);var x=Math.sqrt((1-m)/v);return o[0]=i*s,o[1]=i*c,o[2]=i*u*x,o[3]=i*p*x,o},pn.transformMat4=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3];return o[0]=s[0]*c+s[4]*u+s[8]*p+s[12]*m,o[1]=s[1]*c+s[5]*u+s[9]*p+s[13]*m,o[2]=s[2]*c+s[6]*u+s[10]*p+s[14]*m,o[3]=s[3]*c+s[7]*u+s[11]*p+s[15]*m,o},pn.transformQuat=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=s[0],v=s[1],x=s[2],C=s[3],S=C*c+v*p-x*u,I=C*u+x*c-m*p,A=C*p+m*u-v*c,N=-m*c-v*u-x*p;return o[0]=S*C+N*-m+I*-x-A*-v,o[1]=I*C+N*-v+A*-m-S*-x,o[2]=A*C+N*-x+S*-v-I*-m,o[3]=i[3],o},pn.zero=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=0,o},pn.str=function(o){return"vec4("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},pn.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},pn.equals=function(o,i){var s=o[0],c=o[1],u=o[2],p=o[3],m=i[0],v=i[1],x=i[2],C=i[3];return Math.abs(s-m)<=Qr.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-v)<=Qr.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-x)<=Qr.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(p-C)<=Qr.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))},pn.forEach=pn.sqrLen=pn.len=pn.sqrDist=pn.dist=pn.div=pn.mul=pn.sub=void 0;var Qr=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Xu(o)&&"function"!=typeof o)return{default:o};var s=ba(void 0);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}(Mi);function ba(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(ba=function(c){return c?s:i})(o)}function hl(){var o=new Qr.ARRAY_TYPE(4);return Qr.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function qo(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o[3]=i[3]-s[3],o}function Ku(o,i,s){return o[0]=i[0]*s[0],o[1]=i[1]*s[1],o[2]=i[2]*s[2],o[3]=i[3]*s[3],o}function Kc(o,i,s){return o[0]=i[0]/s[0],o[1]=i[1]/s[1],o[2]=i[2]/s[2],o[3]=i[3]/s[3],o}function Ju(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2],i[3]-o[3])}function fl(o,i){var s=i[0]-o[0],c=i[1]-o[1],u=i[2]-o[2],p=i[3]-o[3];return s*s+c*c+u*u+p*p}function gs(o){return Math.hypot(o[0],o[1],o[2],o[3])}function Qu(o){var i=o[0],s=o[1],c=o[2],u=o[3];return i*i+s*s+c*c+u*u}pn.sub=qo,pn.mul=Ku,pn.div=Kc,pn.dist=Ju,pn.sqrDist=fl,pn.len=gs,pn.sqrLen=Qu;var o,pl=(o=hl(),function(i,s,c,u,p,m){var v,x;for(s||(s=4),c||(c=0),x=u?Math.min(u*s+c,i.length):i.length,v=c;v<x;v+=s)o[0]=i[v],o[1]=i[v+1],o[2]=i[v+2],o[3]=i[v+3],p(o,o,m),i[v]=o[0],i[v+1]=o[1],i[v+2]=o[2],i[v+3]=o[3];return i});function Fi(o){return(Fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}pn.forEach=pl,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=lo,Ft.identity=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o},Ft.setAxisAngle=br,Ft.getAxisAngle=function(o,i){var s=2*Math.acos(i[3]),c=Math.sin(s/2);return c>Rs.EPSILON?(o[0]=i[0]/c,o[1]=i[1]/c,o[2]=i[2]/c):(o[0]=1,o[1]=0,o[2]=0),s},Ft.getAngle=function(o,i){var s=me(o,i);return Math.acos(2*s*s-1)},Ft.multiply=ir,Ft.rotateX=function(o,i,s){s*=.5;var c=i[0],u=i[1],p=i[2],m=i[3],v=Math.sin(s),x=Math.cos(s);return o[0]=c*x+m*v,o[1]=u*x+p*v,o[2]=p*x-u*v,o[3]=m*x-c*v,o},Ft.rotateY=function(o,i,s){s*=.5;var c=i[0],u=i[1],p=i[2],m=i[3],v=Math.sin(s),x=Math.cos(s);return o[0]=c*x-p*v,o[1]=u*x+m*v,o[2]=p*x+c*v,o[3]=m*x-u*v,o},Ft.rotateZ=function(o,i,s){s*=.5;var c=i[0],u=i[1],p=i[2],m=i[3],v=Math.sin(s),x=Math.cos(s);return o[0]=c*x+u*v,o[1]=u*x-c*v,o[2]=p*x+m*v,o[3]=m*x-p*v,o},Ft.calculateW=function(o,i){var s=i[0],c=i[1],u=i[2];return o[0]=s,o[1]=c,o[2]=u,o[3]=Math.sqrt(Math.abs(1-s*s-c*c-u*u)),o},Ft.exp=ve,Ft.ln=H,Ft.pow=function(o,i,s){return H(o,i),be(o,o,s),ve(o,o),o},Ft.slerp=q,Ft.random=function(o){var i=Rs.RANDOM(),s=Rs.RANDOM(),c=Rs.RANDOM(),u=Math.sqrt(1-i),p=Math.sqrt(i);return o[0]=u*Math.sin(2*Math.PI*s),o[1]=u*Math.cos(2*Math.PI*s),o[2]=p*Math.sin(2*Math.PI*c),o[3]=p*Math.cos(2*Math.PI*c),o},Ft.invert=function(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=s*s+c*c+u*u+p*p,v=m?1/m:0;return o[0]=-s*v,o[1]=-c*v,o[2]=-u*v,o[3]=p*v,o},Ft.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o},Ft.fromMat3=le,Ft.fromEuler=function(o,i,s,c){var u=.5*Math.PI/180;i*=u,s*=u,c*=u;var p=Math.sin(i),m=Math.cos(i),v=Math.sin(s),x=Math.cos(s),C=Math.sin(c),S=Math.cos(c);return o[0]=p*x*S-m*v*C,o[1]=m*v*S+p*x*C,o[2]=m*x*C-p*v*S,o[3]=m*x*S+p*v*C,o},Ft.str=function(o){return"quat("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},Ft.setAxes=Ft.sqlerp=Ft.rotationTo=Ft.equals=Ft.exactEquals=Ft.normalize=Ft.sqrLen=Ft.squaredLength=Ft.len=Ft.length=Ft.lerp=Ft.dot=Ft.scale=Ft.mul=Ft.add=Ft.set=Ft.copy=Ft.fromValues=Ft.clone=void 0;var Rs=Zl(Mi),km=Zl(ai),ra=Zl(Rt),eo=Zl(pn);function Ci(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(Ci=function(c){return c?s:i})(o)}function Zl(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Fi(o)&&"function"!=typeof o)return{default:o};var s=Ci(i);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}function lo(){var o=new Rs.ARRAY_TYPE(4);return Rs.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function br(o,i,s){s*=.5;var c=Math.sin(s);return o[0]=c*i[0],o[1]=c*i[1],o[2]=c*i[2],o[3]=Math.cos(s),o}function ir(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=s[0],x=s[1],C=s[2],S=s[3];return o[0]=c*S+m*v+u*C-p*x,o[1]=u*S+m*x+p*v-c*C,o[2]=p*S+m*C+c*x-u*v,o[3]=m*S-c*v-u*x-p*C,o}function ve(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=Math.sqrt(s*s+c*c+u*u),v=Math.exp(p),x=m>0?v*Math.sin(m)/m:0;return o[0]=s*x,o[1]=c*x,o[2]=u*x,o[3]=v*Math.cos(m),o}function H(o,i){var s=i[0],c=i[1],u=i[2],p=i[3],m=Math.sqrt(s*s+c*c+u*u),v=m>0?Math.atan2(m,p)/m:0;return o[0]=s*v,o[1]=c*v,o[2]=u*v,o[3]=.5*Math.log(s*s+c*c+u*u+p*p),o}function q(o,i,s,c){var u,p,m,v,x,C=i[0],S=i[1],I=i[2],A=i[3],N=s[0],F=s[1],z=s[2],V=s[3];return(p=C*N+S*F+I*z+A*V)<0&&(p=-p,N=-N,F=-F,z=-z,V=-V),1-p>Rs.EPSILON?(u=Math.acos(p),m=Math.sin(u),v=Math.sin((1-c)*u)/m,x=Math.sin(c*u)/m):(v=1-c,x=c),o[0]=v*C+x*N,o[1]=v*S+x*F,o[2]=v*I+x*z,o[3]=v*A+x*V,o}function le(o,i){var s,c=i[0]+i[4]+i[8];if(c>0)s=Math.sqrt(c+1),o[3]=.5*s,o[0]=(i[5]-i[7])*(s=.5/s),o[1]=(i[6]-i[2])*s,o[2]=(i[1]-i[3])*s;else{var u=0;i[4]>i[0]&&(u=1),i[8]>i[3*u+u]&&(u=2);var p=(u+1)%3,m=(u+2)%3;s=Math.sqrt(i[3*u+u]-i[3*p+p]-i[3*m+m]+1),o[u]=.5*s,o[3]=(i[3*p+m]-i[3*m+p])*(s=.5/s),o[p]=(i[3*p+u]+i[3*u+p])*s,o[m]=(i[3*m+u]+i[3*u+m])*s}return o}Ft.clone=eo.clone,Ft.fromValues=eo.fromValues,Ft.copy=eo.copy,Ft.set=eo.set,Ft.add=eo.add,Ft.mul=ir;var be=eo.scale;Ft.scale=be;var me=eo.dot;Ft.dot=me,Ft.lerp=eo.lerp;var Ie=eo.length;Ft.length=Ie,Ft.len=Ie;var Ue=eo.squaredLength;Ft.squaredLength=Ue,Ft.sqrLen=Ue;var Me=eo.normalize;Ft.normalize=Me,Ft.exactEquals=eo.exactEquals,Ft.equals=eo.equals;var Ve,rt,ot,Je=(Ve=ra.create(),rt=ra.fromValues(1,0,0),ot=ra.fromValues(0,1,0),function(o,i,s){var c=ra.dot(i,s);return c<-.999999?(ra.cross(Ve,rt,i),ra.len(Ve)<1e-6&&ra.cross(Ve,ot,i),ra.normalize(Ve,Ve),br(o,Ve,Math.PI),o):c>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(ra.cross(Ve,i,s),o[0]=Ve[0],o[1]=Ve[1],o[2]=Ve[2],o[3]=1+c,Me(o,o))});Ft.rotationTo=Je;var Wt,an,Wn=(Wt=lo(),an=lo(),function(o,i,s,c,u,p){return q(Wt,i,u,p),q(an,s,c,p),q(o,Wt,an,2*p*(1-p)),o});Ft.sqlerp=Wn;var Tn,Gn=(Tn=km.create(),function(o,i,s,c){return Tn[0]=s[0],Tn[3]=s[1],Tn[6]=s[2],Tn[1]=c[0],Tn[4]=c[1],Tn[7]=c[2],Tn[2]=-i[0],Tn[5]=-i[1],Tn[8]=-i[2],Me(o,le(o,Tn))});Ft.setAxes=Gn;var zt={};function Gi(o){return(Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=function(){var o=new Qn.ARRAY_TYPE(8);return Qn.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[4]=0,o[5]=0,o[6]=0,o[7]=0),o[3]=1,o},zt.clone=function(o){var i=new Qn.ARRAY_TYPE(8);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i},zt.fromValues=function(o,i,s,c,u,p,m,v){var x=new Qn.ARRAY_TYPE(8);return x[0]=o,x[1]=i,x[2]=s,x[3]=c,x[4]=u,x[5]=p,x[6]=m,x[7]=v,x},zt.fromRotationTranslationValues=function(o,i,s,c,u,p,m){var v=new Qn.ARRAY_TYPE(8);v[0]=o,v[1]=i,v[2]=s,v[3]=c;var x=.5*u,C=.5*p,S=.5*m;return v[4]=x*c+C*s-S*i,v[5]=C*c+S*o-x*s,v[6]=S*c+x*i-C*o,v[7]=-x*o-C*i-S*s,v},zt.fromRotationTranslation=co,zt.fromTranslation=function(o,i){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=.5*i[0],o[5]=.5*i[1],o[6]=.5*i[2],o[7]=0,o},zt.fromRotation=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=0,o[5]=0,o[6]=0,o[7]=0,o},zt.fromMat4=function(o,i){var s=Hn.create();ei.getRotation(s,i);var c=new Qn.ARRAY_TYPE(3);return ei.getTranslation(c,i),co(o,s,c),o},zt.copy=Wo,zt.identity=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=0,o[5]=0,o[6]=0,o[7]=0,o},zt.set=function(o,i,s,c,u,p,m,v,x){return o[0]=i,o[1]=s,o[2]=c,o[3]=u,o[4]=p,o[5]=m,o[6]=v,o[7]=x,o},zt.getDual=function(o,i){return o[0]=i[4],o[1]=i[5],o[2]=i[6],o[3]=i[7],o},zt.setDual=function(o,i){return o[4]=i[0],o[5]=i[1],o[6]=i[2],o[7]=i[3],o},zt.getTranslation=function(o,i){var s=i[4],c=i[5],u=i[6],p=i[7],m=-i[0],v=-i[1],x=-i[2],C=i[3];return o[0]=2*(s*C+p*m+c*x-u*v),o[1]=2*(c*C+p*v+u*m-s*x),o[2]=2*(u*C+p*x+s*v-c*m),o},zt.translate=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=.5*s[0],x=.5*s[1],C=.5*s[2],S=i[4],I=i[5],A=i[6],N=i[7];return o[0]=c,o[1]=u,o[2]=p,o[3]=m,o[4]=m*v+u*C-p*x+S,o[5]=m*x+p*v-c*C+I,o[6]=m*C+c*x-u*v+A,o[7]=-c*v-u*x-p*C+N,o},zt.rotateX=function(o,i,s){var c=-i[0],u=-i[1],p=-i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=v*m+S*c+x*p-C*u,A=x*m+S*u+C*c-v*p,N=C*m+S*p+v*u-x*c,F=S*m-v*c-x*u-C*p;return Hn.rotateX(o,i,s),o[4]=I*(m=o[3])+F*(c=o[0])+A*(p=o[2])-N*(u=o[1]),o[5]=A*m+F*u+N*c-I*p,o[6]=N*m+F*p+I*u-A*c,o[7]=F*m-I*c-A*u-N*p,o},zt.rotateY=function(o,i,s){var c=-i[0],u=-i[1],p=-i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=v*m+S*c+x*p-C*u,A=x*m+S*u+C*c-v*p,N=C*m+S*p+v*u-x*c,F=S*m-v*c-x*u-C*p;return Hn.rotateY(o,i,s),o[4]=I*(m=o[3])+F*(c=o[0])+A*(p=o[2])-N*(u=o[1]),o[5]=A*m+F*u+N*c-I*p,o[6]=N*m+F*p+I*u-A*c,o[7]=F*m-I*c-A*u-N*p,o},zt.rotateZ=function(o,i,s){var c=-i[0],u=-i[1],p=-i[2],m=i[3],v=i[4],x=i[5],C=i[6],S=i[7],I=v*m+S*c+x*p-C*u,A=x*m+S*u+C*c-v*p,N=C*m+S*p+v*u-x*c,F=S*m-v*c-x*u-C*p;return Hn.rotateZ(o,i,s),o[4]=I*(m=o[3])+F*(c=o[0])+A*(p=o[2])-N*(u=o[1]),o[5]=A*m+F*u+N*c-I*p,o[6]=N*m+F*p+I*u-A*c,o[7]=F*m-I*c-A*u-N*p,o},zt.rotateByQuatAppend=function(o,i,s){var c=s[0],u=s[1],p=s[2],m=s[3],v=i[0],x=i[1],C=i[2],S=i[3];return o[0]=v*m+S*c+x*p-C*u,o[1]=x*m+S*u+C*c-v*p,o[2]=C*m+S*p+v*u-x*c,o[3]=S*m-v*c-x*u-C*p,o[4]=(v=i[4])*m+(S=i[7])*c+(x=i[5])*p-(C=i[6])*u,o[5]=x*m+S*u+C*c-v*p,o[6]=C*m+S*p+v*u-x*c,o[7]=S*m-v*c-x*u-C*p,o},zt.rotateByQuatPrepend=function(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=s[0],x=s[1],C=s[2],S=s[3];return o[0]=c*S+m*v+u*C-p*x,o[1]=u*S+m*x+p*v-c*C,o[2]=p*S+m*C+c*x-u*v,o[3]=m*S-c*v-u*x-p*C,o[4]=c*(S=s[7])+m*(v=s[4])+u*(C=s[6])-p*(x=s[5]),o[5]=u*S+m*x+p*v-c*C,o[6]=p*S+m*C+c*x-u*v,o[7]=m*S-c*v-u*x-p*C,o},zt.rotateAroundAxis=function(o,i,s,c){if(Math.abs(c)<Qn.EPSILON)return Wo(o,i);var u=Math.hypot(s[0],s[1],s[2]);c*=.5;var p=Math.sin(c),m=p*s[0]/u,v=p*s[1]/u,x=p*s[2]/u,C=Math.cos(c),S=i[0],I=i[1],A=i[2],N=i[3];o[0]=S*C+N*m+I*x-A*v,o[1]=I*C+N*v+A*m-S*x,o[2]=A*C+N*x+S*v-I*m,o[3]=N*C-S*m-I*v-A*x;var F=i[4],z=i[5],V=i[6],$=i[7];return o[4]=F*C+$*m+z*x-V*v,o[5]=z*C+$*v+V*m-F*x,o[6]=V*C+$*x+F*v-z*m,o[7]=$*C-F*m-z*v-V*x,o},zt.add=function(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o[3]=i[3]+s[3],o[4]=i[4]+s[4],o[5]=i[5]+s[5],o[6]=i[6]+s[6],o[7]=i[7]+s[7],o},zt.multiply=Jc,zt.scale=function(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o[4]=i[4]*s,o[5]=i[5]*s,o[6]=i[6]*s,o[7]=i[7]*s,o},zt.lerp=function(o,i,s,c){var u=1-c;return Ch(i,s)<0&&(c=-c),o[0]=i[0]*u+s[0]*c,o[1]=i[1]*u+s[1]*c,o[2]=i[2]*u+s[2]*c,o[3]=i[3]*u+s[3]*c,o[4]=i[4]*u+s[4]*c,o[5]=i[5]*u+s[5]*c,o[6]=i[6]*u+s[6]*c,o[7]=i[7]*u+s[7]*c,o},zt.invert=function(o,i){var s=Eh(i);return o[0]=-i[0]/s,o[1]=-i[1]/s,o[2]=-i[2]/s,o[3]=i[3]/s,o[4]=-i[4]/s,o[5]=-i[5]/s,o[6]=-i[6]/s,o[7]=i[7]/s,o},zt.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o[4]=-i[4],o[5]=-i[5],o[6]=-i[6],o[7]=i[7],o},zt.normalize=function(o,i){var s=Eh(i);if(s>0){s=Math.sqrt(s);var c=i[0]/s,u=i[1]/s,p=i[2]/s,m=i[3]/s,v=i[4],x=i[5],C=i[6],S=i[7],I=c*v+u*x+p*C+m*S;o[0]=c,o[1]=u,o[2]=p,o[3]=m,o[4]=(v-c*I)/s,o[5]=(x-u*I)/s,o[6]=(C-p*I)/s,o[7]=(S-m*I)/s}return o},zt.str=function(o){return"quat2("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+")"},zt.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]},zt.equals=function(o,i){var s=o[0],c=o[1],u=o[2],p=o[3],m=o[4],v=o[5],x=o[6],C=o[7],S=i[0],I=i[1],A=i[2],N=i[3],F=i[4],z=i[5],V=i[6],$=i[7];return Math.abs(s-S)<=Qn.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(c-I)<=Qn.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(u-A)<=Qn.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(p-N)<=Qn.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(m-F)<=Qn.EPSILON*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(v-z)<=Qn.EPSILON*Math.max(1,Math.abs(v),Math.abs(z))&&Math.abs(x-V)<=Qn.EPSILON*Math.max(1,Math.abs(x),Math.abs(V))&&Math.abs(C-$)<=Qn.EPSILON*Math.max(1,Math.abs(C),Math.abs($))},zt.sqrLen=zt.squaredLength=zt.len=zt.length=zt.dot=zt.mul=zt.setReal=zt.getReal=void 0;var Qn=Ur(Mi),Hn=Ur(Ft),ei=Ur(dn);function xr(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(xr=function(c){return c?s:i})(o)}function Ur(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Gi(o)&&"function"!=typeof o)return{default:o};var s=xr(i);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}function co(o,i,s){var c=.5*s[0],u=.5*s[1],p=.5*s[2],m=i[0],v=i[1],x=i[2],C=i[3];return o[0]=m,o[1]=v,o[2]=x,o[3]=C,o[4]=c*C+u*x-p*v,o[5]=u*C+p*m-c*x,o[6]=p*C+c*v-u*m,o[7]=-c*m-u*v-p*x,o}function Wo(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o}function Jc(o,i,s){var c=i[0],u=i[1],p=i[2],m=i[3],v=s[4],x=s[5],C=s[6],S=s[7],I=i[4],A=i[5],N=i[6],F=i[7],z=s[0],V=s[1],$=s[2],ne=s[3];return o[0]=c*ne+m*z+u*$-p*V,o[1]=u*ne+m*V+p*z-c*$,o[2]=p*ne+m*$+c*V-u*z,o[3]=m*ne-c*z-u*V-p*$,o[4]=c*S+m*v+u*C-p*x+I*ne+F*z+A*$-N*V,o[5]=u*S+m*x+p*v-c*C+A*ne+F*V+N*z-I*$,o[6]=p*S+m*C+c*x-u*v+N*ne+F*$+I*V-A*z,o[7]=m*S-c*v-u*x-p*C+F*ne-I*z-A*V-N*$,o}zt.getReal=Hn.copy,zt.setReal=Hn.copy,zt.mul=Jc;var Ch=Hn.dot;zt.dot=Ch;var Th=Hn.length;zt.length=Th,zt.len=Th;var Eh=Hn.squaredLength;zt.squaredLength=Eh,zt.sqrLen=Eh;var In={};function qf(o){return(qf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(In,"__esModule",{value:!0}),In.create=Fm,In.clone=function(o){var i=new Qc.ARRAY_TYPE(2);return i[0]=o[0],i[1]=o[1],i},In.fromValues=function(o,i){var s=new Qc.ARRAY_TYPE(2);return s[0]=o,s[1]=i,s},In.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o},In.set=function(o,i,s){return o[0]=i,o[1]=s,o},In.add=function(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o},In.subtract=Lm,In.multiply=ay,In.divide=ly,In.ceil=function(o,i){return o[0]=Math.ceil(i[0]),o[1]=Math.ceil(i[1]),o},In.floor=function(o,i){return o[0]=Math.floor(i[0]),o[1]=Math.floor(i[1]),o},In.min=function(o,i,s){return o[0]=Math.min(i[0],s[0]),o[1]=Math.min(i[1],s[1]),o},In.max=function(o,i,s){return o[0]=Math.max(i[0],s[0]),o[1]=Math.max(i[1],s[1]),o},In.round=function(o,i){return o[0]=Math.round(i[0]),o[1]=Math.round(i[1]),o},In.scale=function(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o},In.scaleAndAdd=function(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o},In.distance=Bm,In.squaredDistance=zm,In.length=Dh,In.squaredLength=Wf,In.negate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o},In.inverse=function(o,i){return o[0]=1/i[0],o[1]=1/i[1],o},In.normalize=function(o,i){var s=i[0],c=i[1],u=s*s+c*c;return u>0&&(u=1/Math.sqrt(u)),o[0]=i[0]*u,o[1]=i[1]*u,o},In.dot=function(o,i){return o[0]*i[0]+o[1]*i[1]},In.cross=function(o,i,s){var c=i[0]*s[1]-i[1]*s[0];return o[0]=o[1]=0,o[2]=c,o},In.lerp=function(o,i,s,c){var u=i[0],p=i[1];return o[0]=u+c*(s[0]-u),o[1]=p+c*(s[1]-p),o},In.random=function(o,i){i=i||1;var s=2*Qc.RANDOM()*Math.PI;return o[0]=Math.cos(s)*i,o[1]=Math.sin(s)*i,o},In.transformMat2=function(o,i,s){var c=i[0],u=i[1];return o[0]=s[0]*c+s[2]*u,o[1]=s[1]*c+s[3]*u,o},In.transformMat2d=function(o,i,s){var c=i[0],u=i[1];return o[0]=s[0]*c+s[2]*u+s[4],o[1]=s[1]*c+s[3]*u+s[5],o},In.transformMat3=function(o,i,s){var c=i[0],u=i[1];return o[0]=s[0]*c+s[3]*u+s[6],o[1]=s[1]*c+s[4]*u+s[7],o},In.transformMat4=function(o,i,s){var c=i[0],u=i[1];return o[0]=s[0]*c+s[4]*u+s[12],o[1]=s[1]*c+s[5]*u+s[13],o},In.rotate=function(o,i,s,c){var u=i[0]-s[0],p=i[1]-s[1],m=Math.sin(c),v=Math.cos(c);return o[0]=u*v-p*m+s[0],o[1]=u*m+p*v+s[1],o},In.angle=function(o,i){var s=o[0],c=o[1],u=i[0],p=i[1],m=Math.sqrt(s*s+c*c)*Math.sqrt(u*u+p*p);return Math.acos(Math.min(Math.max(m&&(s*u+c*p)/m,-1),1))},In.zero=function(o){return o[0]=0,o[1]=0,o},In.str=function(o){return"vec2("+o[0]+", "+o[1]+")"},In.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]},In.equals=function(o,i){var s=o[0],c=o[1],u=i[0],p=i[1];return Math.abs(s-u)<=Qc.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(c-p)<=Qc.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},In.forEach=In.sqrLen=In.sqrDist=In.dist=In.div=In.mul=In.sub=In.len=void 0;var Qc=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==qf(o)&&"function"!=typeof o)return{default:o};var s=sy(void 0);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}(Mi);function sy(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(sy=function(c){return c?s:i})(o)}function Fm(){var o=new Qc.ARRAY_TYPE(2);return Qc.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0),o}function Lm(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o}function ay(o,i,s){return o[0]=i[0]*s[0],o[1]=i[1]*s[1],o}function ly(o,i,s){return o[0]=i[0]/s[0],o[1]=i[1]/s[1],o}function Bm(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1])}function zm(o,i){var s=i[0]-o[0],c=i[1]-o[1];return s*s+c*c}function Dh(o){return Math.hypot(o[0],o[1])}function Wf(o){var i=o[0],s=o[1];return i*i+s*s}In.len=Dh,In.sub=Lm,In.mul=ay,In.div=ly,In.dist=Bm,In.sqrDist=zm,In.sqrLen=Wf;var Zf=function(){var o=Fm();return function(i,s,c,u,p,m){var v,x;for(s||(s=2),c||(c=0),x=u?Math.min(u*s+c,i.length):i.length,v=c;v<x;v+=s)o[0]=i[v],o[1]=i[v+1],p(o,o,m),i[v]=o[0],i[v+1]=o[1];return i}}();function Yf(o){return(Yf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}In.forEach=Zf,Object.defineProperty(Di,"__esModule",{value:!0}),d.aB=Di.vec4=d.$=Di.vec3=Di.vec2=Di.quat2=d.aw=Di.quat=d.ae=Di.mat4=d.bE=Di.mat3=Di.mat2d=d.aD=Di.mat2=Di.glMatrix=void 0;var cy=Ns(Mi);Di.glMatrix=cy;var _1=Ns(di);d.aD=Di.mat2=_1;var ed=Ns(hi);Di.mat2d=ed;var Un=Ns(ai);d.bE=Di.mat3=Un;var y1=Ns(dn);d.ae=Di.mat4=y1;var uy=Ns(Ft);d.aw=Di.quat=uy;var dy=Ns(zt);Di.quat2=dy;var Vm=Ns(In);Di.vec2=Vm;var v1=Ns(Rt);d.$=Di.vec3=v1;var Um=Ns(pn);function Sh(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(Sh=function(c){return c?s:i})(o)}function Ns(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Yf(o)&&"function"!=typeof o)return{default:o};var s=Sh(i);if(s&&s.has(o))return s.get(o);var c={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in o)if("default"!==p&&Object.prototype.hasOwnProperty.call(o,p)){var m=u?Object.getOwnPropertyDescriptor(o,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=o[p]}return c.default=o,s&&s.set(o,c),c}d.aB=Di.vec4=Um;var hy=b1;function b1(o,i,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=s,this.p2y=c}b1.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(void 0===i&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var s=o,c=0;c<8;c++){var u=this.sampleCurveX(s)-o;if(Math.abs(u)<i)return s;var p=this.sampleCurveDerivativeX(s);if(Math.abs(p)<1e-6)break;s-=u/p}var m=0,v=1;for(s=o,c=0;c<20&&(u=this.sampleCurveX(s),!(Math.abs(u-o)<i));c++)o>u?m=s:v=s,s=.5*(v-m)+m;return s},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var jm=us(hy),Xf=eu;function eu(o,i){this.x=o,this.y=i}eu.prototype={clone:function(){return new eu(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,s=o.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),s=Math.sin(o),c=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,i){var s=Math.cos(o),c=Math.sin(o),u=i.y+c*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-c*(this.y-i.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},eu.convert=function(o){return o instanceof eu?o:Array.isArray(o)?new eu(o[0],o[1]):o};var _t=us(Xf);function tu(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let s=0;s<o.length;s++)if(!tu(o[s],i[s]))return!1;return!0}if("object"==typeof o&&null!==o&&null!==i){if("object"!=typeof i||Object.keys(o).length!==Object.keys(i).length)return!1;for(const s in o)if(!tu(o[s],i[s]))return!1;return!0}return o===i}const Mh=Math.PI/180,nu=180/Math.PI;function Fn(o){return o*Mh}function So(o){return o*nu}const td=[[0,0],[1,0],[1,1],[0,1]];function Kf(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,s=i*o;return 4*(o<.5?s:3*(o-i)+s-.75)}function Jf(o,i,s,c){const u=new jm(o,i,s,c);return function(p){return u.solve(p)}}const xa=Jf(.25,.1,.25,1);function Sn(o,i,s){return Math.min(s,Math.max(i,o))}function Qf(o,i,s){return(s=Sn((s-o)/(i-o),0,1))*s*(3-2*s)}function Yl(o,i,s){const c=s-i,u=((o-i)%c+c)%c+i;return u===i?s:u}function ep(o,i,s){if(!o.length)return s(null,[]);let c=o.length;const u=new Array(o.length);let p=null;o.forEach((m,v)=>{i(m,(x,C)=>{x&&(p=x),u[v]=C,0==--c&&s(p,u)})})}function nd(o){const i=[];for(const s in o)i.push(o[s]);return i}function uo(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}let fy=1;function $m(){return fy++}function Ih(){return function o(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Xl(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function tp(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function np(o,i){o.forEach(s=>{i[s]&&(i[s]=i[s].bind(i))})}function Ah(o,i){return-1!==o.indexOf(i,o.length-i.length)}function ip(o,i,s){const c={};for(const u in o)c[u]=i.call(this,o[u],u,o);return c}function qr(o,i,s){const c={};for(const u in o)i.call(this,o[u],u,o)&&(c[u]=o[u]);return c}function Zo(o){return Array.isArray(o)?o.map(Zo):"object"==typeof o&&o?ip(o,Zo):o}const ho={};function fr(o){ho[o]||(typeof console<"u"&&console.warn(o),ho[o]=!0)}function Kl(o,i,s){return(s.y-o.y)*(i.x-o.x)>(i.y-o.y)*(s.x-o.x)}function Gm(o){let i=0;for(let s,c,u=0,p=o.length,m=p-1;u<p;m=u++)s=o[u],c=o[m],i+=(c.x-s.x)*(s.y+c.y);return i}function id([o,i,s]){const c=Fn(i+90),u=Fn(s);return{x:o*Math.cos(c)*Math.sin(u),y:o*Math.sin(c)*Math.sin(u),z:o*Math.cos(u),azimuthal:i,polar:s}}function Oh(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ph(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,u,p)=>{const m=u||p;return i[c]=!m||m.toLowerCase(),""}),i["max-age"]){const s=parseInt(i["max-age"],10);isNaN(s)?delete i["max-age"]:i["max-age"]=s}return i}let py,rd,Jl,rp,Ql,op,Rh=null;function Hm(o){try{const i=self[o];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function ec(o,i){return[o[4*i],o[4*i+1],o[4*i+2],o[4*i+3]]}function sp(o,i,s,c){for(;i<s;){const u=i+s>>1;o[u]<c?i=u+1:s=u}return i}function ap(o,i,s,c){for(;i<s;){const u=i+s>>1;o[u]<=c?i=u+1:s=u}return i}function my(o){return o>0?1/(1.001-o):1+o}function tc(o){return o>0?1-1/(1.001-o):-o}function gy(){return null==py&&(py=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),py}const Mo={now:()=>void 0!==rp?rp:performance.now(),setNow(o){rp=o},restoreNow(){rp=void 0},frame(o){const i=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(o,i=0){const{width:s,height:c}=o;Ql||(Ql=document.createElement("canvas"));const u=Ql.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(s>Ql.width||c>Ql.height)&&(Ql.width=s,Ql.height=c),u.clearRect(-i,-i,s+2*i,c+2*i),u.drawImage(o,0,0,s,c),u.getImageData(-i,-i,s+2*i,c+2*i)},resolveURL:o=>(rd||(rd=document.createElement("a")),rd.href=o,rd.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Jl&&(Jl=window.matchMedia("(prefers-reduced-motion: reduce)")),Jl.matches)},hasCanvasFingerprintNoise(){if(void 0!==op)return op;if(!gy())return op=!1,!1;const o=new OffscreenCanvas(85,1),i=o.getContext("2d",{willReadFrequently:!0});let s=0;for(let u=0;u<o.width;++u)i.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,i.fillRect(u,0,1,1);const c=i.getImageData(0,0,o.width,o.height);s=0;for(let u=0;u<c.data.length;++u)if(u%4!=3&&s++!==c.data[u])return op=!0,!0;return op=!1,!1}};function qm(o,i){const s=o.indexOf("?");if(s<0)return`${o}?${new URLSearchParams(i).toString()}`;const c=new URLSearchParams(o.slice(s));for(const u in i)c.set(u,i[u]);return`${o.slice(0,s)}?${c.toString()}`}function Nh(o,i={persistentParams:[]}){const s=o.indexOf("?");if(s<0)return o;const c=new URLSearchParams,u=new URLSearchParams(o.slice(s));for(const m of i.persistentParams){const v=u.get(m);v&&c.set(m,v)}const p=c.toString();return`${o.slice(0,s)}${p.length>0?`?${p}`:""}`}const _y="mapbox-tiles";let Wm=500,Zm=50;const Ym=["language","worldview","jobid"];let ml,Xm;function x1(){try{return caches}catch{}}function lp(){const o=x1();o&&!ml&&(ml=o.open(_y))}let Km=1/0;const Jm={supported:!1,testSupport:function(o){!Fh&&kh&&(wt?od(o):cp=o)}};let cp,kh,Fh=!1,wt=!1;const iu=typeof self<"u"?self:{};function od(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,kh),o.isContextLost())return;Jm.supported=!0}catch{}o.deleteTexture(i),Fh=!0}iu.document&&(kh=iu.document.createElement("img"),kh.onload=function(){cp&&od(cp),cp=null,wt=!0},kh.onerror=function(){Fh=!0,cp=null},kh.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const sd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(sd);class Qm extends Error{constructor(i,s,c){401===s&&ti(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const yy=Oh()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,wa=function(o,i){if(!(/^file:/.test(s=o.url)||/^file:/.test(yy())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,u){const p=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:yy(),referrerPolicy:c.referrerPolicy,signal:p.signal});let v=!1,x=!1;const C=(S=m.url).indexOf("sku=")>0&&ti(S);var S;"json"===c.type&&m.headers.set("Accept","application/json");const I=(N,F,z)=>{if(x)return;if(N&&"SecurityError"!==N.message&&fr(N.toString()),F&&z)return A(F);const V=Date.now();fetch(m).then($=>{if($.ok){const ne=C?$.clone():null;return A($,ne,V)}return u(new Qm($.statusText,$.status,c.url))}).catch($=>{"AbortError"!==$.name&&u(new Error(`${$.message} ${c.url}`))})},A=(N,F,z)=>{("arrayBuffer"===c.type?N.arrayBuffer():"json"===c.type?N.json():N.text()).then(V=>{x||(F&&z&&function($,ne,ee){if(lp(),!ml)return;const re=Ph(ne.headers.get("Cache-Control")||"");if(re["no-store"])return;const de={status:ne.status,statusText:ne.statusText,headers:new Headers};ne.headers.forEach((De,Pe)=>de.headers.set(Pe,De)),re["max-age"]&&de.headers.set("Expires",new Date(ee+1e3*re["max-age"]).toUTCString());const fe=de.headers.get("Expires");if(!fe||new Date(fe).getTime()-ee<42e4)return;let _e=Nh($.url,{persistentParams:Ym});if(206===ne.status){const De=$.headers.get("Range");if(!De)return;de.status=200,_e=qm(_e,{range:De})}!function(De,Pe){if(void 0===Xm)try{new Response(new ReadableStream),Xm=!0}catch{Xm=!1}Xm?Pe(De.body):De.blob().then(Pe)}(ne,De=>{const Pe=new Response(200!==(Be=ne.status)&&404!==Be&&[101,103,204,205,304].includes(Be)?null:De,de);var Be;lp(),ml&&ml.then(Ne=>Ne.put(_e,Pe)).catch(Ne=>fr(Ne.message))})}(m,F,z),v=!0,u(null,V,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(V=>{x||u(new Error(V.message))})};return C?function(N,F){if(lp(),!ml)return F(null);ml.then(z=>{let V=Nh(N.url,{persistentParams:Ym});const $=N.headers.get("Range");$&&(V=qm(V,{range:$})),z.match(V).then(ne=>{const ee=function(re){if(!re)return!1;const de=new Date(re.headers.get("Expires")||0),fe=Ph(re.headers.get("Cache-Control")||"");return de>Date.now()&&!fe["no-cache"]}(ne);z.delete(V),ee&&z.put(V,ne.clone()),F(null,ne,ee)}).catch(F)}).catch(F)}(m,I):I(null,null),{cancel:()=>{x=!0,v||p.abort()}}}(o,i);if(Oh()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var s;return function(c,u){const p=new XMLHttpRequest;p.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(p.responseType="arraybuffer");for(const m in c.headers)p.setRequestHeader(m,c.headers[m]);return"json"===c.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===c.credentials,p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let m=p.response;if("json"===c.type)try{m=JSON.parse(p.response)}catch(v){return u(v)}u(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new Qm(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(o,i)},Yo=function(o,i){return wa(uo(o,{type:"arrayBuffer"}),i)};function ad(o){const i=document.createElement("a");return i.href=o,i.protocol===location.protocol&&i.host===location.host}const ru="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ga,ou;Ga=[],ou=0;const su=function(o,i){if(Jm.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),ou>=Cn.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Ga.push(p),p}ou++;let s=!1;const c=()=>{if(!s)for(s=!0,ou--;Ga.length&&ou<Cn.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Ga.shift(),{requestParameters:m,callback:v,cancelled:x}=p;x||(p.cancel=su(m,v).cancel)}},u=Yo(o,(p,m,v,x)=>{c(),p?i(p):m&&(self.createImageBitmap?function(C,S){const I=new Blob([new Uint8Array(C)],{type:"image/png"});createImageBitmap(I).then(A=>{S(null,A)}).catch(A=>{S(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(C,S)=>i(C,S,v,x)):function(C,S){const I=new Image;I.onload=()=>{S(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=ru})},I.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(C)],{type:"image/png"});I.src=C.byteLength?URL.createObjectURL(A):ru}(m,(C,S)=>i(C,S,v,x)))});return{cancel:()=>{u.cancel(),c()}}},nc="01",vy="NO_ACCESS_TOKEN",Yi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ca(o){const i=o.match(Yi);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function ld(o){const i=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${i}`}const Li="mapbox.eventData";function by(o){if(!o)return null;const i=o.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(atob(i[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class sr{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const s=by(Cn.ACCESS_TOKEN);let c="";return c=s&&s.u?btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(+("0x"+p)))):Cn.ACCESS_TOKEN||"",i?`${Li}.${i}:${c}`:`${Li}:${c}`}fetchEventData(){const i=Hm("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{const u=localStorage.getItem(s);u&&(this.eventData=JSON.parse(u));const p=localStorage.getItem(c);p&&(this.anonId=p)}catch{fr("Unable to read from LocalStorage")}}saveEventData(){const i=Hm("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid"),u=this.anonId;if(i&&u)try{localStorage.setItem(c,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{fr("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,s,c,u){if(!Cn.EVENTS_URL)return;const p=Ca(Cn.EVENTS_URL);p.params.push(`access_token=${u||Cn.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(i).toISOString()},v=s?uo(m,s):m,x={url:ld(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};var S;this.pendingRequest=(S=C=>{this.pendingRequest=null,c(C),this.saveEventData(),this.processRequests(u)},wa(uo(x,{method:"POST"}),S))}queueRequest(i,s){this.queue.push(i),this.processRequests(s)}}const up=new class extends sr{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,i){Cn.EVENTS_URL&&Cn.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>Or(s)||ti(s))&&this.queueRequest(Date.now(),i)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=by(Cn.ACCESS_TOKEN),s=i?i.u:Cn.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;tp(this.anonId)||(this.anonId=Ih(),c=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),m=new Date(u),v=(u-this.eventData.lastSuccess)/864e5;c=c||v>=1||v<-1||p.getDate()!==m.getDate()}else c=!0;c?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:hr,skuId:nc,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=s)},o):this.processRequests()}},xy=up.postTurnstileEvent.bind(up),cd=new class extends sr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,i,s,c){this.skuToken=i,this.errorCb=c,Cn.EVENTS_URL&&(s||Cn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(vy)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),tp(this.anonId)||(this.anonId=Ih()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:hr,skuId:nc,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o))}remove(){this.errorCb=null}},Oi=cd.postMapLoadEvent.bind(cd),Pn=new class extends sr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(o){let i=this.mapInstanceIdMap.get(o);return i||(i=Ih(),this.mapInstanceIdMap.set(o,i)),i}getEventId(o){const i=this.eventIdPerMapInstanceMap.get(o)||0;return this.eventIdPerMapInstanceMap.set(o,i+1),i}postStyleLoadEvent(o,i){const{map:s,style:c,importedStyles:u}=i;if(!Cn.EVENTS_URL||!o&&!Cn.ACCESS_TOKEN)return;const p=this.getMapInstanceId(s),m={mapInstanceId:p,eventId:this.getEventId(p),style:c};u.length&&(m.importedStyles=u),this.queueRequest({timestamp:Date.now(),payload:m},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,payload:s}=this.queue.shift();this.postEvent(i,s,()=>{},o)}},Lh=Pn.postStyleLoadEvent.bind(Pn),_s=new class extends sr{constructor(){super("gljs.performance")}postPerformanceEvent(o,i){Cn.EVENTS_URL&&(o||Cn.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:s}=this.queue.shift(),c=function(u){const p=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),v=function(N){const F={};if(N)for(const z in N)if("other"!==z)for(const V of N[z]){const $=`${z}ResolveRangeMin`,ne=`${z}ResolveRangeMax`,ee=`${z}RequestCount`,re=`${z}RequestCachedCount`;F[$]=Math.min(F[$]||1/0,V.startTime),F[ne]=Math.max(F[ne]||-1/0,V.responseEnd);const de=fe=>{void 0===F[fe]&&(F[fe]=0),++F[fe]};void 0!==V.transferSize&&0===V.transferSize&&de(re),de(ee)}return F}(function(N,F){const z={};if(N)for(const V of N){const $=F(V);void 0===z[$]&&(z[$]=[]),z[$].push(V)}return z}(p,ll)),x=window.devicePixelRatio,C=navigator.connection||navigator.mozConnection||navigator.webkitConnection,S=C?C.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},A=(N,F,z)=>{null!=z&&N.push({name:F,value:z.toString()})};for(const N in v)A(I.counters,N,v[N]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(A(I.counters,"interactionRangeMin",u.interactionRange[0]),A(I.counters,"interactionRangeMax",u.interactionRange[1])),m)for(const N of Object.keys(ya)){const F=ya[N],z=m.find(V=>V.name===F);z&&A(I.counters,F,z.startTime)}return A(I.counters,"visibilityHidden",u.visibilityHidden),A(I.attributes,"style",function(N){if(N)for(const F of N){const z=F.name.split("?")[0];if(Ps(z)){const V=z.split("/").slice(-2);if(2===V.length)return`mapbox://styles/${V[0]}/${V[1]}`}}}(p)),A(I.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),A(I.attributes,"fogEnabled",u.fogEnabled?"true":"false"),A(I.attributes,"projection",u.projection),A(I.attributes,"zoom",u.zoom),A(I.metadata,"devicePixelRatio",x),A(I.metadata,"connectionEffectiveType",S),A(I.metadata,"navigatorUserAgent",navigator.userAgent),A(I.metadata,"screenWidth",window.screen.width),A(I.metadata,"screenHeight",window.screen.height),A(I.metadata,"windowWidth",window.innerWidth),A(I.metadata,"windowHeight",window.innerHeight),A(I.metadata,"mapWidth",u.width/x),A(I.metadata,"mapHeight",u.height/x),A(I.metadata,"webglRenderer",u.renderer),A(I.metadata,"webglVendor",u.vendor),A(I.metadata,"sdkVersion",hr),A(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(s);for(const u of c.metadata);for(const u of c.counters);for(const u of c.attributes);this.postEvent(i,c,()=>{},o)}},dC=_s.postPerformanceEvent.bind(_s),Bh=new class extends sr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,i,s,c){if(!Cn.API_URL||!Cn.SESSION_PATH)return;const u=Ca(Cn.API_URL+Cn.SESSION_PATH);u.params.push(`sku=${i||""}`),u.params.push(`access_token=${c||Cn.ACCESS_TOKEN||""}`);const p={url:ld(u),headers:{"Content-Type":"text/plain"}};var v;this.pendingRequest=(v=m=>{this.pendingRequest=null,s(m),this.saveEventData(),this.processRequests(c)},wa(uo(p,{method:"GET"}),v))}getSessionAPI(o,i,s,c){this.skuToken=i,this.errorCb=c,Cn.SESSION_PATH&&Cn.API_URL&&(s||Cn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(vy)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o)}remove(){this.errorCb=null}},wy=Bh.getSessionAPI.bind(Bh),oa=new Set;var ud={exports:{}},w1=function(o,i){var s,c,u,p,m,v,x,C;for(c=o.length-(s=3&o.length),u=i,m=3432918353,v=461845907,C=0;C<c;)x=255&o.charCodeAt(C)|(255&o.charCodeAt(++C))<<8|(255&o.charCodeAt(++C))<<16|(255&o.charCodeAt(++C))<<24,++C,u=27492+(65535&(p=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*v+(((x>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(x=0,s){case 3:x^=(255&o.charCodeAt(C+2))<<16;case 2:x^=(255&o.charCodeAt(C+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&o.charCodeAt(C)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*v+(((x>>>16)*v&65535)<<16)&4294967295}return u^=o.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0},C1=function(o,i){for(var s,c=o.length,u=i^c,p=0;c>=4;)s=1540483477*(65535&(s=255&o.charCodeAt(p)|(255&o.charCodeAt(++p))<<8|(255&o.charCodeAt(++p))<<16|(255&o.charCodeAt(++p))<<24))+((1540483477*(s>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:u^=(255&o.charCodeAt(p+2))<<16;case 2:u^=(255&o.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&o.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};ud.exports=w1,ud.exports.murmur3=w1,ud.exports.murmur2=C1;var eg=us(ud.exports);class Ha{constructor(i,...s){uo(this,s[0]||{}),this.type=i}}class dp extends Ha{constructor(i,s={}){super("error",uo({error:i},s))}}function Io(o,i,s){s[o]&&-1!==s[o].indexOf(i)||(s[o]=s[o]||[],s[o].push(i))}function Rn(o,i,s){if(s&&s[o]){const c=s[o].indexOf(i);-1!==c&&s[o].splice(c,1)}}class dd{on(i,s){return this._listeners=this._listeners||{},Io(i,s,this._listeners),this}off(i,s){return Rn(i,s,this._listeners),Rn(i,s,this._oneTimeListeners),this}once(i,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Io(i,s,this._oneTimeListeners),this):new Promise(c=>this.once(i,c))}fire(i,s){const c="string"==typeof i?new Ha(i,s):i,u=c.type;if(this.listens(u)){c.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const x of p)x.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const x of m)Rn(u,x,this._oneTimeListeners),x.call(this,c);const v=this._eventedParent;v&&(uo(c,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(c))}else c instanceof dp&&console.error(c.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,s){return this._eventedParent=i,this._eventedParentData=s,this}}d.G=void 0;var T1={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function tg(o){return(o=Math.round(o))<0?0:o>255?255:o}function Cy(o){return tg("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function ng(o){return(i="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:i>1?1:i;var i}function Mt(o,i,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?o+(i-o)*s*6:2*s<1?i:3*s<2?o+(i-o)*(2/3-s)*6:o}try{d.G={}.parseCSSColor=function(o){var i,s=o.replace(/ /g,"").toLowerCase();if(s in T1)return T1[s].slice();if("#"===s[0])return 4===s.length?(i=parseInt(s.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===s.length&&(i=parseInt(s.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var c=s.indexOf("("),u=s.indexOf(")");if(-1!==c&&u+1===s.length){var p=s.substr(0,c),m=s.substr(c+1,u-(c+1)).split(","),v=1;switch(p){case"rgba":if(4!==m.length)return null;v=ng(m.pop());case"rgb":return 3!==m.length?null:[Cy(m[0]),Cy(m[1]),Cy(m[2]),v];case"hsla":if(4!==m.length)return null;v=ng(m.pop());case"hsl":if(3!==m.length)return null;var x=(parseFloat(m[0])%360+360)%360/360,C=ng(m[1]),S=ng(m[2]),I=S<=.5?S*(C+1):S+C-S*C,A=2*S-I;return[tg(255*Mt(A,I,x+1/3)),tg(255*Mt(A,I,x)),tg(255*Mt(A,I,x-1/3)),v];default:return null}}return null}}catch{}class ni{constructor(i,s,c,u=1){this.r=i,this.g=s,this.b=c,this.a=u}static parse(i){if(!i)return;if(i instanceof ni)return i;if("string"!=typeof i)return;const s=d.G(i);return s?new ni(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[i,s,c,u]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(i)},${Math.round(s)},${Math.round(c)},${u})`}toRenderColor(i){const{r:s,g:c,b:u,a:p}=this;return new Pi(i,s,c,u,p)}}class Pi{constructor(i,s,c,u,p){if(i){const m=i.image.height,v=m*m;s=0===p?0:s/p*(m-1),c=0===p?0:c/p*(m-1),u=0===p?0:u/p*(m-1);const x=Math.floor(s),C=Math.floor(c),S=Math.floor(u),I=Math.ceil(s),A=Math.ceil(c),N=Math.ceil(u),F=s-x,z=c-C,V=u-S,$=i.image.data,ne=4*(x+C*v+S*m),ee=4*(x+C*v+N*m),re=4*(x+A*v+S*m),de=4*(x+A*v+N*m),fe=4*(I+C*v+S*m),_e=4*(I+C*v+N*m),De=4*(I+A*v+S*m),Pe=4*(I+A*v+N*m);if(ne<0||Pe>=$.length)throw new Error("out of range");this.r=Yt(Yt(Yt($[ne],$[ee],V),Yt($[re],$[de],V),z),Yt(Yt($[fe],$[_e],V),Yt($[De],$[Pe],V),z),F)/255*p,this.g=Yt(Yt(Yt($[ne+1],$[ee+1],V),Yt($[re+1],$[de+1],V),z),Yt(Yt($[fe+1],$[_e+1],V),Yt($[De+1],$[Pe+1],V),z),F)/255*p,this.b=Yt(Yt(Yt($[ne+2],$[ee+2],V),Yt($[re+2],$[de+2],V),z),Yt(Yt($[fe+2],$[_e+2],V),Yt($[De+2],$[Pe+2],V),z),F)/255*p,this.a=p}else this.r=s,this.g=c,this.b=u,this.a=p}toArray(){const{r:i,g:s,b:c,a:u}=this;return 0===u?[0,0,0,0]:[255*i/u,255*s/u,255*c/u,u]}toArray01(){const{r:i,g:s,b:c,a:u}=this;return 0===u?[0,0,0,0]:[i/u,s/u,c/u,u]}toArray01Scaled(i){const{r:s,g:c,b:u,a:p}=this;return 0===p?[0,0,0]:[s/p*i,c/p*i,u/p*i]}toArray01PremultipliedAlpha(){const{r:i,g:s,b:c,a:u}=this;return[i,s,c,u]}toArray01Linear(){const{r:i,g:s,b:c,a:u}=this;return 0===u?[0,0,0,0]:[Math.pow(i/u,2.2),Math.pow(s/u,2.2),Math.pow(c/u,2.2),u]}}function Yt(o,i,s){return o*(1-s)+i*s}function ig(o,i,s){return o.map((c,u)=>Yt(c,i[u],s))}ni.black=new ni(0,0,0,1),ni.white=new ni(1,1,1,1),ni.transparent=new ni(0,0,0,0),ni.red=new ni(1,0,0,1),ni.blue=new ni(0,0,1,1);var hd=Object.freeze({__proto__:null,array:ig,color:function(o,i,s){return new ni(Yt(o.r,i.r,s),Yt(o.g,i.g,s),Yt(o.b,i.b,s),Yt(o.a,i.a,s))},number:Yt});function fd(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}class ks extends Error{constructor(i,s){super(s),this.message=s,this.key=i}}class pd{constructor(i,s=[]){this.parent=i,this.bindings={};for(const[c,u]of s)this.bindings[c]=u}concat(i){return new pd(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Xo={kind:"null"},It={kind:"number"},jn={kind:"string"},vt={kind:"boolean"},ys={kind:"color"},ic={kind:"object"},Zn={kind:"value"},md={kind:"collator"},gd={kind:"formatted"},gl={kind:"resolvedImage"};function Ao(o,i){return{kind:"array",itemType:o,N:i}}function pr(o){if("array"===o.kind){const i=pr(o.itemType);return"number"==typeof o.N?`array<${i}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${i}>`}return o.kind}const Ty=[Xo,It,jn,vt,ys,gd,ic,Ao(Zn),gl];function hp(o,i){if("error"===i.kind)return null;if("array"===o.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!hp(o.itemType,i.itemType))&&("number"!=typeof o.N||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if("value"===o.kind)for(const s of Ty)if(!hp(s,i))return null}return`Expected ${pr(o)} but found ${pr(i)} instead.`}function vs(o,i){return i.some(s=>s.kind===o.kind)}function _l(o,i){return i.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}class _d{constructor(i,s,c){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,s){return this.collator.compare(i,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yd{constructor(i,s,c,u,p){this.text=i.normalize?i.normalize():i,this.image=s,this.scale=c,this.fontStack=u,this.textColor=p}}class fo{constructor(i){this.sections=i}static fromString(i){return new fo([new yd(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.namePrimary.length)}static factory(i){return i instanceof fo?i:fo.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const s of this.sections){if(s.image){i.push(["image",s.image.namePrimary]);continue}i.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),i.push(c)}return i}}class Rr{constructor(i){this.namePrimary=i.namePrimary,i.nameSecondary&&(this.nameSecondary=i.nameSecondary),this.available=i.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(i,s){return i?new Rr({namePrimary:i,nameSecondary:s,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function vd(o,i,s,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,i,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,i,s,c]:[o,i,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function au(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof ni||o instanceof _d||o instanceof fo||o instanceof Rr)return!0;if(Array.isArray(o)){for(const i of o)if(!au(i))return!1;return!0}if("object"==typeof o){for(const i in o)if(!au(o[i]))return!1;return!0}return!1}function hn(o){if(null===o)return Xo;if("string"==typeof o)return jn;if("boolean"==typeof o)return vt;if("number"==typeof o)return It;if(o instanceof ni)return ys;if(o instanceof _d)return md;if(o instanceof fo)return gd;if(o instanceof Rr)return gl;if(Array.isArray(o)){const i=o.length;let s;for(const c of o){const u=hn(c);if(s){if(s===u)continue;s=Zn;break}s=u}return Ao(s||Zn,i)}return ic}function ri(o){const i=typeof o;return null===o?"":"string"===i||"number"===i||"boolean"===i?String(o):o instanceof ni||o instanceof fo||o instanceof Rr?o.toString():JSON.stringify(o)}class qa{constructor(i,s){this.type=i,this.value=s}static parse(i,s){if(2!==i.length)return s.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!au(i[1]))return s.error("invalid value");const c=i[1];let u=hn(c);const p=s.expectedType;return"array"!==u.kind||0!==u.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(u=p),new qa(u,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ni?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof fo?this.value.serialize():this.value}}class Nr{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const rg={string:jn,number:It,boolean:vt,object:ic};class sa{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let c,u=1;const p=i[0];if("array"===p){let v,x;if(i.length>2){const C=i[1];if("string"!=typeof C||!(C in rg)||"object"===C)return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=rg[C],u++}else v=Zn;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);x=i[2],u++}c=Ao(v,x)}else c=rg[p];const m=[];for(;u<i.length;u++){const v=s.parse(i[u],u,Zn);if(!v)return null;m.push(v)}return new sa(c,m)}evaluate(i){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(i);if(!hp(this.type,hn(c)))return c;if(s===this.args.length-1)throw new Nr(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${pr(hn(c))} but was expected to be of type ${pr(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,s=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){s.push(c.kind);const u=i.N;("number"==typeof u||this.args.length>1)&&s.push(u)}}return s.concat(this.args.map(c=>c.serialize()))}}class lu{constructor(i){this.type=gd,this.sections=i}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return s.error("First argument must be an image or text section.");const u=[];let p=!1;for(let m=1;m<=i.length-1;++m){const v=i[m];if(p&&"object"==typeof v&&!Array.isArray(v)){p=!1;let x=null;if(v["font-scale"]&&(x=s.parse(v["font-scale"],1,It),!x))return null;let C=null;if(v["text-font"]&&(C=s.parse(v["text-font"],1,Ao(jn)),!C))return null;let S=null;if(v["text-color"]&&(S=s.parse(v["text-color"],1,ys),!S))return null;const I=u[u.length-1];I.scale=x,I.font=C,I.textColor=S}else{const x=s.parse(i[m],1,Zn);if(!x)return null;const C=x.type.kind;if("string"!==C&&"value"!==C&&"null"!==C&&"resolvedImage"!==C)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new lu(u)}evaluate(i){return new fo(this.sections.map(s=>{const c=s.content.evaluate(i);return hn(c)===gl?new yd("",c,null,null,null):new yd(ri(c),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))}eachChild(i){for(const s of this.sections)i(s.content),s.scale&&i(s.scale),s.font&&i(s.font),s.textColor&&i(s.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const s of this.sections){i.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),i.push(c)}return i}}class Ta{constructor(i,s){this.type=gl,this.inputPrimary=i,this.inputSecondary=s}static parse(i,s){if(i.length<2)return s.error("Expected two or more arguments.");const c=s.parse(i[1],1,jn);if(!c)return s.error("No image name provided.");if(2===i.length)return new Ta(c);const u=s.parse(i[2],1,jn);return u?new Ta(c,u):s.error("Secondary image variant is not a string.")}evaluate(i){const s=Rr.fromString(this.inputPrimary.evaluate(i),this.inputSecondary?this.inputSecondary.evaluate(i):void 0);return s&&i.availableImages&&(s.available=i.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&i.availableImages&&(s.available=i.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(i){i(this.inputPrimary),this.inputSecondary&&i(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Yn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}const og={"to-boolean":vt,"to-color":ys,"to-number":It,"to-string":jn};class Wa{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[0],u=[];let p=Xo;if("to-array"===c){if(!Array.isArray(i[1]))return null;const m=i[1].length;if(s.expectedType){if("array"!==s.expectedType.kind)return s.error(`Expected ${s.expectedType.kind} but found array.`);p=Ao(s.expectedType.itemType,m)}else{if(!(m>0&&au(i[1][0])))return null;p=Ao(hn(i[1][0]),m)}for(let v=0;v<m;v++){const x=i[1][v];let C;if("array"===Yn(x))C=s.parse(x,void 0,p.itemType);else{const S=Yn(x);if(S!==p.itemType.kind)return s.error(`Expected ${p.itemType.kind} but found ${S}.`);C=s.registry.literal.parse(["literal",void 0===x?null:x],s)}if(!C)return null;u.push(C)}}else{if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return s.error("Expected one argument.");p=og[c];for(let m=1;m<i.length;m++){const v=s.parse(i[m],m,Zn);if(!v)return null;u.push(v)}}return new Wa(p,u)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let s,c;for(const u of this.args){if(s=u.evaluate(i),c=null,s instanceof ni)return s;if("string"==typeof s){const p=i.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:vd(s[0],s[1],s[2],s[3]),!c))return new ni(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Nr(c||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const c of this.args){if(s=c.evaluate(i),null===s)return 0;const u=Number(s);if(!isNaN(u))return u}throw new Nr(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?fo.fromString(ri(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Rr.fromString(ri(this.args[0].evaluate(i))):"array"===this.type.kind?this.args.map(s=>s.evaluate(i)):ri(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new lu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ta(this.args[0]).serialize();const i="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{i.push(s.serialize())}),i}}const bs=["Unknown","Point","LineString","Polygon"];class fp{constructor(i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=s}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?bs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-i[0])+this.featureDistanceData.bearing[1]*(u*s-i[1])}return 0}parseColor(i){let s=this._parseColorCache[i];return s||(s=this._parseColorCache[i]=ni.parse(i)),s}getConfig(i){return this.options?this.options.get(i):null}}class Fs{constructor(i,s,c,u,p){this.name=i,this.type=s,this._evaluate=c,this.args=u,this._overloadIndex=p}evaluate(i){if(!this._evaluate){const s=Fs.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,s){const c=i[0],u=Fs.definitions[c];if(!u)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=[];let x=null,C=-1;for(const[S,I]of m){if(Array.isArray(S)&&S.length!==i.length-1)continue;v.push(S),C++,x=new Ti(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const A=[];let N=!1;for(let F=1;F<i.length;F++){const z=i[F],V=Array.isArray(S)?S[F-1]:S.type,$=x.parse(z,1+A.length,V);if(!$){N=!0;break}A.push($)}if(!N)if(Array.isArray(S)&&S.length!==A.length)x.error(`Expected ${S.length} arguments, but found ${A.length} instead.`);else{for(let F=0;F<A.length;F++){const z=Array.isArray(S)?S[F]:S.type,V=A[F];x.concat(F+1).checkSubtype(z,V.type)}if(0===x.errors.length)return new Fs(c,p,I,A,C)}}if(1===v.length)s.errors.push(...x.errors);else{const S=(v.length?v:m.map(([A])=>A)).map(fC).join(" | "),I=[];for(let A=1;A<i.length;A++){const N=s.parse(i[A],1+I.length);if(!N)return null;I.push(pr(N.type))}s.error(`Expected arguments of type ${S}, but found (${I.join(", ")}) instead.`)}return null}static register(i,s){Fs.definitions=s;for(const c in s)i[c]=Fs}}function fC(o){return Array.isArray(o)?`(${o.map(pr).join(", ")})`:`(${pr(o.type)}...)`}class yl{constructor(i,s,c){this.type=md,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=s}static parse(i,s){if(2!==i.length)return s.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return s.error("Collator options argument must be an object.");const u=s.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,vt);if(!u)return null;const p=s.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,vt);if(!p)return null;let m=null;return c.locale&&(m=s.parse(c.locale,1,jn),!m)?null:new yl(u,p,m)}evaluate(i){return new _d(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function Xn(o,i,s=0,c=o.length-1,u=Ey){for(;c>s;){if(c-s>600){const x=c-s+1,C=i-s+1,S=Math.log(x),I=.5*Math.exp(2*S/3),A=.5*Math.sqrt(S*I*(x-I)/x)*(C-x/2<0?-1:1);Xn(o,i,Math.max(s,Math.floor(i-C*I/x+A)),Math.min(c,Math.floor(i+(x-C)*I/x+A)),u)}const p=o[i];let m=s,v=c;for(vl(o,s,i),u(o[c],p)>0&&vl(o,s,c);m<v;){for(vl(o,m,v),m++,v--;u(o[m],p)<0;)m++;for(;u(o[v],p)>0;)v--}0===u(o[s],p)?vl(o,s,v):(v++,vl(o,v,c)),v<=i&&(s=v+1),i<=v&&(c=v-1)}}function vl(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}function Ey(o,i){return o<i?-1:o>i?1:0}function E1(o){let i=0;for(let s,c,u=0,p=o.length,m=p-1;u<p;m=u++)s=o[u],c=o[m],i+=(c.x-s.x)*(s.y+c.y);return i}function Vh(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function bl(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function xl(o,i,s){const c=o[0]-i[0],u=o[1]-i[1],p=o[0]-s[0],m=o[1]-s[1];return c*m-p*u==0&&c*p<=0&&u*m<=0}function wl(o,i,s=!1){let c=!1;for(let v=0,x=i.length;v<x;v++){const C=i[v];for(let S=0,I=C.length,A=I-1;S<I;A=S++){const N=C[A],F=C[S];if(xl(o,N,F))return s;(p=N)[1]>(u=o)[1]!=(m=F)[1]>u[1]&&u[0]<(m[0]-p[0])*(u[1]-p[1])/(m[1]-p[1])+p[0]&&(c=!c)}}var u,p,m;return c}function Cl(o,i,s,c){const u=c[0]-s[0],p=c[1]-s[1],m=(o[0]-s[0])*p-u*(o[1]-s[1]),v=(i[0]-s[0])*p-u*(i[1]-s[1]);return m>0&&v<0||m<0&&v>0}function Uh(o,i,s,c){return(u=[c[0]-s[0],c[1]-s[1]])[0]*(p=[i[0]-o[0],i[1]-o[1]])[1]-u[1]*p[0]!=0&&!(!Cl(o,i,s,c)||!Cl(s,c,o,i));var u,p}const $t=8192;function Dy(o,i){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,u=Math.pow(2,i.z);return[Math.round(s*u*$t),Math.round(c*u*$t)]}function Re(o,i){for(let s=0;s<i.length;s++)if(wl(o,i[s]))return!0;return!1}function rc(o,i,s){for(const c of s)for(let u=0,p=c.length,m=p-1;u<p;m=u++)if(Uh(o,i,c[m],c[u]))return!0;return!1}function bd(o,i){for(let s=0;s<o.length;++s)if(!wl(o[s],i))return!1;for(let s=0;s<o.length-1;++s)if(rc(o[s],o[s+1],i))return!1;return!0}function jh(o,i){for(let s=0;s<i.length;s++)if(bd(o,i[s]))return!0;return!1}function sg(o,i,s){const c=[];for(let u=0;u<o.length;u++){const p=[];for(let m=0;m<o[u].length;m++){const v=Dy(o[u][m],s);Vh(i,v),p.push(v)}c.push(p)}return c}function Sy(o,i,s){const c=[];for(let u=0;u<o.length;u++){const p=sg(o[u],i,s);c.push(p)}return c}function ag(o,i,s,c){if(o[0]<s[0]||o[0]>s[2]){const u=.5*c;let p=o[0]-s[0]>u?-c:s[0]-o[0]>u?c:0;0===p&&(p=o[0]-s[2]>u?-c:s[2]-o[0]>u?c:0),o[0]+=p}Vh(i,o)}function pp(o,i,s,c){const u=Math.pow(2,c.z)*$t,p=[c.x*$t,c.y*$t],m=[];if(!o)return m;for(const v of o)for(const x of v){const C=[x.x+p[0],x.y+p[1]];ag(C,i,s,u),m.push(C)}return m}function $h(o,i,s,c){const u=Math.pow(2,c.z)*$t,p=[c.x*$t,c.y*$t],m=[];if(!o)return m;for(const x of o){const C=[];for(const S of x){const I=[S.x+p[0],S.y+p[1]];Vh(i,I),C.push(I)}m.push(C)}if(i[2]-i[0]<=u/2){(v=i)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const x of m)for(const C of x)ag(C,i,s,u)}var v;return m}class Za{constructor(i,s){this.type=vt,this.geojson=i,this.geometries=s}static parse(i,s){if(2!==i.length)return s.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(au(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let u=0;u<c.features.length;++u){const p=c.features[u].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Za(c,c.features[u].geometry)}else if("Feature"===c.type){const u=c.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new Za(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new Za(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(s,c){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if("Polygon"===c.type){const v=sg(c.coordinates,p,m),x=pp(s.geometry(),u,p,m);if(!bl(u,p))return!1;for(const C of x)if(!wl(C,v))return!1}if("MultiPolygon"===c.type){const v=Sy(c.coordinates,p,m),x=pp(s.geometry(),u,p,m);if(!bl(u,p))return!1;for(const C of x)if(!Re(C,v))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(s,c){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if("Polygon"===c.type){const v=sg(c.coordinates,p,m),x=$h(s.geometry(),u,p,m);if(!bl(u,p))return!1;for(const C of x)if(!bd(C,v))return!1}if("MultiPolygon"===c.type){const v=Sy(c.coordinates,p,m),x=$h(s.geometry(),u,p,m);if(!bl(u,p))return!1;for(const C of x)if(!jh(C,v))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const cu={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},My=1/298.257223563,oc=My*(2-My),Gh=Math.PI/180;class to{static fromTile(i,s,c){const u=Math.PI*(1-2*(i+.5)/Math.pow(2,s)),p=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Gh;return new to(p,c)}static get units(){return cu}constructor(i,s){if(void 0===i)throw new Error("No latitude given.");if(s&&!cu[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(cu).join(", ")}`);const c=6378.137*Gh*(s?cu[s]:1),u=Math.cos(i*Gh),p=1/(1-oc*(1-u*u)),m=Math.sqrt(p);this.kx=c*m*u,this.ky=c*m*p*(1-oc)}distance(i,s){const c=Oo(i[0]-s[0])*this.kx,u=(i[1]-s[1])*this.ky;return Math.sqrt(c*c+u*u)}bearing(i,s){const c=Oo(s[0]-i[0])*this.kx;return Math.atan2(c,(s[1]-i[1])*this.ky)/Gh}destination(i,s,c){const u=c*Gh;return this.offset(i,Math.sin(u)*s,Math.cos(u)*s)}offset(i,s,c){return[i[0]+s/this.kx,i[1]+c/this.ky]}lineDistance(i){let s=0;for(let c=0;c<i.length-1;c++)s+=this.distance(i[c],i[c+1]);return s}area(i){let s=0;for(let c=0;c<i.length;c++){const u=i[c];for(let p=0,m=u.length,v=m-1;p<m;v=p++)s+=Oo(u[p][0]-u[v][0])*(u[p][1]+u[v][1])*(c?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(i,s){let c=0;if(s<=0)return i[0];for(let u=0;u<i.length-1;u++){const p=i[u],m=i[u+1],v=this.distance(p,m);if(c+=v,c>s)return mp(p,m,(s-(c-v))/v)}return i[i.length-1]}pointToSegmentDistance(i,s,c){let[u,p]=s,m=Oo(c[0]-u)*this.kx,v=(c[1]-p)*this.ky;if(0!==m||0!==v){const x=(Oo(i[0]-u)*this.kx*m+(i[1]-p)*this.ky*v)/(m*m+v*v);x>1?(u=c[0],p=c[1]):x>0&&(u+=m/this.kx*x,p+=v/this.ky*x)}return m=Oo(i[0]-u)*this.kx,v=(i[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(i,s){let c=1/0,u=i[0][0],p=i[0][1],m=0,v=0;for(let x=0;x<i.length-1;x++){let C=i[x][0],S=i[x][1],I=Oo(i[x+1][0]-C)*this.kx,A=(i[x+1][1]-S)*this.ky,N=0;0===I&&0===A||(N=(Oo(s[0]-C)*this.kx*I+(s[1]-S)*this.ky*A)/(I*I+A*A),N>1?(C=i[x+1][0],S=i[x+1][1]):N>0&&(C+=I/this.kx*N,S+=A/this.ky*N)),I=Oo(s[0]-C)*this.kx,A=(s[1]-S)*this.ky;const F=I*I+A*A;F<c&&(c=F,u=C,p=S,m=x,v=N)}return{point:[u,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(i,s,c){let u=this.pointOnLine(c,i),p=this.pointOnLine(c,s);if(u.index>p.index||u.index===p.index&&u.t>p.t){const C=u;u=p,p=C}const m=[u.point],v=u.index+1,x=p.index;!uu(c[v],m[0])&&v<=x&&m.push(c[v]);for(let C=v+1;C<=x;C++)m.push(c[C]);return uu(c[x],p.point)||m.push(p.point),m}lineSliceAlong(i,s,c){let u=0;const p=[];for(let m=0;m<c.length-1;m++){const v=c[m],x=c[m+1],C=this.distance(v,x);if(u+=C,u>i&&0===p.length&&p.push(mp(v,x,(i-(u-C))/C)),u>=s)return p.push(mp(v,x,(s-(u-C))/C)),p;u>i&&p.push(x)}return p}bufferPoint(i,s){const c=s/this.ky,u=s/this.kx;return[i[0]-u,i[1]-c,i[0]+u,i[1]+c]}bufferBBox(i,s){const c=s/this.ky,u=s/this.kx;return[i[0]-u,i[1]-c,i[2]+u,i[3]+c]}insideBBox(i,s){return Oo(i[0]-s[0])>=0&&Oo(i[0]-s[2])<=0&&i[1]>=s[1]&&i[1]<=s[3]}}function uu(o,i){return o[0]===i[0]&&o[1]===i[1]}function mp(o,i,s){const c=Oo(i[0]-o[0]);return[o[0]+c*s,o[1]+(i[1]-o[1])*s]}function Oo(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Ea{constructor(i=[],s=((c,u)=>c<u?-1:c>u?1:0)){if(this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(0===this.length)return;const i=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:s,compare:c}=this,u=s[i];for(;i>0;){const p=i-1>>1,m=s[p];if(c(u,m)>=0)break;s[i]=m,i=p}s[i]=u}_down(i){const{data:s,compare:c}=this,u=this.length>>1,p=s[i];for(;i<u;){let m=1+(i<<1);const v=m+1;if(v<this.length&&c(s[v],s[m])<0&&(m=v),c(s[m],p)>=0)break;s[i]=s[m],i=m}s[i]=p}}var ft=8192;function D1(o,i){return i.dist-o.dist}const xd=100,Iy=50;function xs(o){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==o.length)return!1;for(let s=0;s<i.length;s++)if(i[s]!==o[s])return!1;return!0}function wd(o){return o[1]-o[0]+1}function ws(o,i){const s=o[1]>=o[0]&&o[1]<i;return s||console.warn("Distance Expression: Index is out of range"),s}function Ay(o,i){if(o[0]>o[1])return[null,null];const s=wd(o);if(i){if(2===s)return[o,null];const c=Math.floor(s/2);return[[o[0],o[0]+c],[o[0]+c,o[1]]]}{if(1===s)return[o,null];const c=Math.floor(s/2)-1;return[[o[0],o[0]+c],[o[0]+c+1,o[1]]]}}function Cs(o,i){const s=[1/0,1/0,-1/0,-1/0];if(!ws(i,o.length))return s;for(let c=i[0];c<=i[1];++c)Vh(s,o[c]);return s}function Ls(o){const i=[1/0,1/0,-1/0,-1/0];for(let s=0;s<o.length;++s)for(let c=0;c<o[s].length;++c)Vh(i,o[s][c]);return i}function gi(o,i,s){if(xs(o)||xs(i))return NaN;let c=0,u=0;return o[2]<i[0]&&(c=i[0]-o[2]),o[0]>i[2]&&(c=o[0]-i[2]),o[1]>i[3]&&(u=o[1]-i[3]),o[3]<i[1]&&(u=i[1]-o[3]),s.distance([0,0],[c,u])}function aa(o){return 360*o-180}function lg(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Ko(o,i){const s=Math.pow(2,i.z),c=(o.y/ft+i.y)/s;return[aa((o.x/ft+i.x)/s),lg(c)]}function Hh(o,i){const s=[];for(let c=0;c<o.length;++c)s.push(Ko(o[c],i));return s}function qh(o,i,s){const c=s.pointOnLine(i,o).point;return s.distance(o,c)}function Bs(o,i,s,c,u){const p=s.slice(c[0],c[1]+1);let m=1/0;for(let v=i[0];v<=i[1];++v)if(0===(m=Math.min(m,qh(o[v],p,u))))return 0;return m}function zs(o,i,s,c,u){const p=Math.min(u.pointToSegmentDistance(o,s,c),u.pointToSegmentDistance(i,s,c)),m=Math.min(u.pointToSegmentDistance(s,o,i),u.pointToSegmentDistance(c,o,i));return Math.min(p,m)}function S1(o,i,s,c,u){if(!ws(i,o.length)||!ws(c,s.length))return NaN;let p=1/0;for(let m=i[0];m<i[1];++m)for(let v=c[0];v<c[1];++v){if(Uh(o[m],o[m+1],s[v],s[v+1]))return 0;p=Math.min(p,zs(o[m],o[m+1],s[v],s[v+1],u))}return p}function cg(o,i,s,c,u){if(!ws(i,o.length)||!ws(c,s.length))return NaN;let p=1/0;for(let m=i[0];m<=i[1];++m)for(let v=c[0];v<=c[1];++v)if(0===(p=Math.min(p,u.distance(o[m],s[v]))))return p;return p}function Oy(o,i,s){if(wl(o,i,!0))return 0;let c=1/0;for(const u of i){const p=u.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[p-1]&&0===(c=Math.min(c,s.pointToSegmentDistance(o,u[p-1],u[0])))||0===(c=Math.min(c,qh(o,u,s))))return c}return c}function Py(o,i,s,c){if(!ws(i,o.length))return NaN;for(let p=i[0];p<=i[1];++p)if(wl(o[p],s,!0))return 0;let u=1/0;for(let p=i[0];p<i[1];++p)for(const m of s)for(let v=0,x=m.length,C=x-1;v<x;C=v++){if(Uh(o[p],o[p+1],m[C],m[v]))return 0;u=Math.min(u,zs(o[p],o[p+1],m[C],m[v],c))}return u}function Cd(o,i){for(const s of o)for(let c=0;c<=s.length-1;++c)if(wl(s[c],i,!0))return!0;return!1}function Wh(o,i,s,c=1/0){const u=Ls(o),p=Ls(i);if(c!==1/0&&gi(u,p,s)>=c)return c;if(bl(u,p)){if(Cd(o,i))return 0}else if(Cd(i,o))return 0;let m=c;for(const v of o)for(let x=0,C=v.length,S=C-1;x<C;S=x++)for(const I of i)for(let A=0,N=I.length,F=N-1;A<N;F=A++){if(Uh(v[S],v[x],I[F],I[A]))return 0;m=Math.min(m,zs(v[S],v[x],I[F],I[A],s))}return m}function sc(o,i,s,c,u,p,m){if(null===p||null===m)return;const v=gi(Cs(c,p),Cs(u,m),s);v<i&&o.push({dist:v,range1:p,range2:m})}function Vs(o,i,s,c,u=1/0){let p=Math.min(c.distance(o[0],s[0][0]),u);if(0===p)return p;const m=new Ea([{dist:0,range1:[0,o.length-1],range2:[0,0]}],D1),v=i?Iy:xd,x=Ls(s);for(;m.length;){const C=m.pop();if(C.dist>=p)continue;const S=C.range1;if(wd(S)<=v){if(!ws(S,o.length))return NaN;if(i){const I=Py(o,S,s,c);if(0===(p=Math.min(p,I)))return p}else for(let I=S[0];I<=S[1];++I){const A=Oy(o[I],s,c);if(0===(p=Math.min(p,A)))return p}}else{const I=Ay(S,i);if(null!==I[0]){const A=gi(Cs(o,I[0]),x,c);A<p&&m.push({dist:A,range1:I[0],range2:[0,0]})}if(null!==I[1]){const A=gi(Cs(o,I[1]),x,c);A<p&&m.push({dist:A,range1:I[1],range2:[0,0]})}}}return p}function du(o,i,s,c,u,p=1/0){let m=Math.min(p,u.distance(o[0],s[0]));if(0===m)return m;const v=new Ea([{dist:0,range1:[0,o.length-1],range2:[0,s.length-1]}],D1),x=i?Iy:xd,C=c?Iy:xd;for(;v.length;){const S=v.pop();if(S.dist>=m)continue;const I=S.range1,A=S.range2;if(wd(I)<=x&&wd(A)<=C){if(!ws(I,o.length)||!ws(A,s.length))return NaN;if(i&&c?m=Math.min(m,S1(o,I,s,A,u)):i||c?i&&!c?m=Math.min(m,Bs(s,A,o,I,u)):!i&&c&&(m=Math.min(m,Bs(o,I,s,A,u))):m=Math.min(m,cg(o,I,s,A,u)),0===m)return m}else{const N=Ay(I,i),F=Ay(A,c);sc(v,m,u,o,s,N[0],F[0]),sc(v,m,u,o,s,N[0],F[1]),sc(v,m,u,o,s,N[1],F[0]),sc(v,m,u,o,s,N[1],F[1])}}return m}function ug(o,i,s,c,u=1/0){let p=u;const m=Cs(o,[0,o.length-1]);for(const v of s)if(!(p!==1/0&&gi(m,Cs(v,[0,v.length-1]),c)>=p)&&(p=Math.min(p,du(o,i,v,!0,c,p)),0===p))return p;return p}function gp(o,i,s,c,u=1/0){let p=u;const m=Cs(o,[0,o.length-1]);for(const v of s){if(p!==1/0&&gi(m,Ls(v),c)>=p)continue;const x=Vs(o,i,v,c,p);if(isNaN(x))return x;if(0===(p=Math.min(p,x)))return p}return p}function Us(o){return"Point"===o||"MultiPoint"===o||"LineString"===o||"MultiLineString"===o||"Polygon"===o||"MultiPolygon"===o}class hu{constructor(i,s){this.type=It,this.geojson=i,this.geometries=s}static parse(i,s){if(2!==i.length)return s.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(au(i[1])){const c=i[1];if("FeatureCollection"===c.type){for(let u=0;u<c.features.length;++u)if(Us(c.features[u].geometry.type))return new hu(c,c.features[u].geometry)}else if("Feature"===c.type){if(Us(c.geometry.type))return new hu(c,c.geometry)}else if(Us(c.type))return new hu(c,c)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const s=i.geometry(),c=i.canonicalID();if(null!=s&&null!=c){if("Point"===i.geometryType())return function(u,p,m){const v=[];for(const C of u)for(const S of C)v.push(Ko(S,p));const x=new to(v[0][1],"meters");return"Point"===m.type||"MultiPoint"===m.type||"LineString"===m.type?du(v,!1,"Point"===m.type?[m.coordinates]:m.coordinates,"LineString"===m.type,x):"MultiLineString"===m.type?ug(v,!1,m.coordinates,x):"Polygon"===m.type||"MultiPolygon"===m.type?gp(v,!1,"Polygon"===m.type?[m.coordinates]:m.coordinates,x):null}(s,c,this.geometries);if("LineString"===i.geometryType())return function(u,p,m){const v=[];for(const C of u){const S=[];for(const I of C)S.push(Ko(I,p));v.push(S)}const x=new to(v[0][0][1],"meters");if("Point"===m.type||"MultiPoint"===m.type||"LineString"===m.type)return ug("Point"===m.type?[m.coordinates]:m.coordinates,"LineString"===m.type,v,x);if("MultiLineString"===m.type){let C=1/0;for(let S=0;S<m.coordinates.length;S++){const I=ug(m.coordinates[S],!0,v,x,C);if(isNaN(I))return I;if(0===(C=Math.min(C,I)))return C}return C}if("Polygon"===m.type||"MultiPolygon"===m.type){let C=1/0;for(let S=0;S<v.length;S++){const I=gp(v[S],!0,"Polygon"===m.type?[m.coordinates]:m.coordinates,x,C);if(isNaN(I))return I;if(0===(C=Math.min(C,I)))return C}return C}return null}(s,c,this.geometries);if("Polygon"===i.geometryType())return function(u,p,m){const v=[];for(const C of function(S,I){const A=S.length;if(A<=1)return[S];const N=[];let F,z;for(let V=0;V<A;V++){const $=E1(S[V]);0!==$&&(S[V].area=Math.abs($),void 0===z&&(z=$<0),z===$<0?(F&&N.push(F),F=[S[V]]):F.push(S[V]))}return F&&N.push(F),N}(u)){const S=[];for(let I=0;I<C.length;++I)S.push(Hh(C[I],p));v.push(S)}const x=new to(v[0][0][0][1],"meters");if("Point"===m.type||"MultiPoint"===m.type||"LineString"===m.type)return gp("Point"===m.type?[m.coordinates]:m.coordinates,"LineString"===m.type,v,x);if("MultiLineString"===m.type){let C=1/0;for(let S=0;S<m.coordinates.length;S++){const I=gp(m.coordinates[S],!0,v,x,C);if(isNaN(I))return I;if(0===(C=Math.min(C,I)))return C}return C}return"Polygon"===m.type||"MultiPolygon"===m.type?function(C,S,I){let A=1/0;for(const N of C)for(const F of S){const z=Wh(N,F,I,A);if(isNaN(z))return z;if(0===(A=Math.min(A,z)))return A}return A}("Polygon"===m.type?[m.coordinates]:m.coordinates,v,x):null}(s,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Td(o,i){switch(o){case"string":return ri(i);case"number":return+i;case"boolean":return!!i;case"color":return ni.parse(i);case"formatted":return fo.fromString(ri(i));case"resolvedImage":return Rr.fromString(ri(i))}return i}function Ry(o,i,s,c){return void 0!==c&&(o=c*Math.round(o/c)),void 0!==i&&o<i&&(o=i),void 0!==s&&o>s&&(o=s),o}class ac{constructor(i,s,c){this.type=i,this.key=s,this.scope=c}static parse(i,s){let c=s.expectedType;if(null==c&&(c=Zn),i.length<2||i.length>3)return s.error("Invalid number of arguments for 'config' expression.");const u=s.parse(i[1],1);if(!(u instanceof qa))return s.error("Key name of 'config' expression must be a string literal.");if(i.length>=3){const p=s.parse(i[2],2);return p instanceof qa?new ac(c,ri(u.value),ri(p.value)):s.error("Scope of 'config' expression must be a string literal.")}return new ac(c,ri(u.value))}evaluate(i){const s=[this.key,this.scope,i.scope].filter(Boolean).join("\x1f"),c=i.getConfig(s);if(!c)return null;const{type:u,value:p,values:m,minValue:v,maxValue:x,stepValue:C}=c,S=c.default.evaluate(i);let I=S;if(p){const A=i.scope;i.scope=(A||"").split("\x1f").slice(1).join("\x1f"),I=p.evaluate(i),i.scope=A}return u&&(I=Td(u,I)),void 0===I||void 0===v&&void 0===x&&void 0===C||("number"==typeof I?I=Ry(I,v,x,C):Array.isArray(I)&&(I=I.map(A=>"number"==typeof A?Ry(A,v,x,C):A))),void 0!==p&&void 0!==I&&m&&!m.includes(I)&&(I=S,u&&(I=Td(u,I))),(u&&u!==this.type||void 0!==I&&hn(I)!==this.type)&&(I=Td(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.key),i}}function Zh(o){if(o instanceof Fs&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Za||o instanceof hu)return!1;let i=!0;return o.eachChild(s=>{i&&!Zh(s)&&(i=!1)}),i}function _p(o){if(o instanceof Fs&&"feature-state"===o.name)return!1;let i=!0;return o.eachChild(s=>{i&&!_p(s)&&(i=!1)}),i}function Ed(o){if(o instanceof ac)return new Set([o.key]);let i=new Set;return o.eachChild(s=>{i=new Set([...i,...Ed(s)])}),i}function Yh(o,i){if(o instanceof Fs&&i.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!Yh(c,i)&&(s=!1)}),s}class Xh{constructor(i,s){this.type=s.type,this.name=i,this.boundExpression=s}static parse(i,s){if(2!==i.length||"string"!=typeof i[1])return s.error("'var' expression requires exactly one string literal argument.");const c=i[1];return s.scope.has(c)?new Xh(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class yp{constructor(i,s=[],c,u=new pd,p=[],m,v){this.registry=i,this.path=s,this.key=s.map(x=>`[${x}]`).join(""),this.scope=u,this.errors=p,this.expectedType=c,this._scope=m,this.options=v}parse(i,s,c,u,p={}){return s||c?this.concat(s,c,u)._parse(i,p):this._parse(i,p)}_parse(i,s){function c(u,p,m){return"assert"===m?new sa(p,[u]):"coerce"===m?new Wa(p,[u]):u}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u="string"==typeof i[0]?this.registry[i[0]]:void 0;if(u){let p=u.parse(i,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if("string"!==m.kind&&"number"!==m.kind&&"boolean"!==m.kind&&"object"!==m.kind&&"array"!==m.kind||"value"!==v.kind)if("color"!==m.kind&&"formatted"!==m.kind&&"resolvedImage"!==m.kind||"value"!==v.kind&&"string"!==v.kind){if(this.checkSubtype(m,v))return null}else p=c(p,m,s.typeAnnotation||"coerce");else p=c(p,m,s.typeAnnotation||"assert")}if(!(p instanceof qa)&&"resolvedImage"!==p.type.kind&&Kh(p)){const m=new fp(this._scope,this.options);try{p=new qa(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return Wa.parse(["to-array",i],this)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,s,c){const u="number"==typeof i?this.path.concat(i):this.path,p=c?this.scope.concat(c):this.scope;return new yp(this.registry,u,s||null,p,this.errors,this._scope,this.options)}error(i,...s){const c=`${this.key}${s.map(u=>`[${u}]`).join("")}`;this.errors.push(new ks(c,i))}checkSubtype(i,s){const c=hp(i,s);return c&&this.error(c),c}}var Ti=yp;function Kh(o){if(o instanceof Xh)return Kh(o.boundExpression);if(o instanceof Fs&&"error"===o.name||o instanceof yl||o instanceof Za||o instanceof hu||o instanceof ac)return!1;const i=o instanceof Wa||o instanceof sa;let s=!0;return o.eachChild(c=>{s=i?s&&Kh(c):s&&c instanceof qa}),!!s&&Zh(o)&&Yh(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function fu(o,i){const s=o.length-1;let c,u,p=0,m=s,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),c=o[v],u=o[v+1],c<=i){if(v===s||i<u)return v;p=v+1}else{if(!(c>i))throw new Nr("Input is not a number.");m=v-1}return 0}class bi{constructor(i,s,c){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(const[u,p]of c)this.labels.push(u),this.outputs.push(p)}static parse(i,s){if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(i[1],1,It);if(!c)return null;const u=[];let p=null;s.expectedType&&"value"!==s.expectedType.kind&&(p=s.expectedType);for(let m=1;m<i.length;m+=2){const v=1===m?-1/0:i[m],x=i[m+1],C=m,S=m+1;if("number"!=typeof v)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const I=s.parse(x,S,p);if(!I)return null;p=p||I.type,u.push([v,I])}return new bi(p,c,u)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const u=this.input.evaluate(i);if(u<=s[0])return c[0].evaluate(i);const p=s.length;return u>=s[p-1]?c[p-1].evaluate(i):c[fu(s,u)].evaluate(i)}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i}}const Jo=4/29,qn=6/29,jr=3*qn*qn,po=qn*qn*qn,lc=Math.PI/180,Po=180/Math.PI;function Jh(o){return o>po?Math.pow(o,1/3):o/jr+Jo}function vp(o){return o>qn?o*o*o:jr*(o-Jo)}function Dd(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function hg(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Ny(o){const i=hg(o.r),s=hg(o.g),c=hg(o.b),u=Jh((.4124564*i+.3575761*s+.1804375*c)/.95047),p=Jh((.2126729*i+.7151522*s+.072175*c)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-Jh((.0193339*i+.119192*s+.9503041*c)/1.08883)),alpha:o.a}}function Sd(o){let i=(o.l+16)/116,s=isNaN(o.a)?i:i+o.a/500,c=isNaN(o.b)?i:i-o.b/200;return i=1*vp(i),s=.95047*vp(s),c=1.08883*vp(c),new ni(Dd(3.2404542*s-1.5371385*i-.4985314*c),Dd(-.969266*s+1.8760108*i+.041556*c),Dd(.0556434*s-.2040259*i+1.0572252*c),o.alpha)}function M1(o,i,s){const c=i-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const pu={forward:Ny,reverse:Sd,interpolate:function(o,i,s){return{l:Yt(o.l,i.l,s),a:Yt(o.a,i.a,s),b:Yt(o.b,i.b,s),alpha:Yt(o.alpha,i.alpha,s)}}},Md={forward:function(o){const{l:i,a:s,b:c}=Ny(o),u=Math.atan2(c,s)*Po;return{h:u<0?u+360:u,c:Math.sqrt(s*s+c*c),l:i,alpha:o.a}},reverse:function(o){const i=o.h*lc,s=o.c;return Sd({l:o.l,a:Math.cos(i)*s,b:Math.sin(i)*s,alpha:o.alpha})},interpolate:function(o,i,s){return{h:M1(o.h,i.h,s),c:Yt(o.c,i.c,s),l:Yt(o.l,i.l,s),alpha:Yt(o.alpha,i.alpha,s)}}};var cc=Object.freeze({__proto__:null,hcl:Md,lab:pu});class la{constructor(i,s,c,u,p){this.type=i,this.operator=s,this.interpolation=c,this.input=u,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(i,s,c,u){let p=0;if("exponential"===i.name)p=Qh(s,i.base,c,u);else if("linear"===i.name)p=Qh(s,1,c,u);else if("cubic-bezier"===i.name){const m=i.controlPoints;p=new jm(m[0],m[1],m[2],m[3]).solve(Qh(s,1,c,u))}return p}static parse(i,s){let[c,u,p,...m]=i;if(!Array.isArray(u)||0===u.length)return s.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const C=u[1];if("number"!=typeof C)return s.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if("cubic-bezier"!==u[0])return s.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(4!==C.length||C.some(S=>"number"!=typeof S||S<0||S>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,It),!p)return null;const v=[];let x=null;"interpolate-hcl"===c||"interpolate-lab"===c?x=ys:s.expectedType&&"value"!==s.expectedType.kind&&(x=s.expectedType);for(let C=0;C<m.length;C+=2){const S=m[C],I=m[C+1],A=C+3,N=C+4;if("number"!=typeof S)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(v.length&&v[v.length-1][0]>=S)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const F=s.parse(I,N,x);if(!F)return null;x=x||F.type,v.push([S,F])}return"number"===x.kind||"color"===x.kind||"array"===x.kind&&"number"===x.itemType.kind&&"number"==typeof x.N?new la(x,c,u,p,v):s.error(`Type ${pr(x)} is not interpolatable.`)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const u=this.input.evaluate(i);if(u<=s[0])return c[0].evaluate(i);const p=s.length;if(u>=s[p-1])return c[p-1].evaluate(i);const m=fu(s,u),v=la.interpolationFactor(this.interpolation,u,s[m],s[m+1]),x=c[m].evaluate(i),C=c[m+1].evaluate(i);return"interpolate"===this.operator?hd[this.type.kind.toLowerCase()](x,C,v):"interpolate-hcl"===this.operator?Md.reverse(Md.interpolate(Md.forward(x),Md.forward(C),v)):pu.reverse(pu.interpolate(pu.forward(x),pu.forward(C),v))}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Qh(o,i,s,c){const u=c-s,p=o-s;return 0===u?0:1===i?p/u:(Math.pow(i,p)-1)/(Math.pow(i,u)-1)}class mu{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expectected at least one argument.");let c=null;const u=s.expectedType;u&&"value"!==u.kind&&(c=u);const p=[];for(const v of i.slice(1)){const x=s.parse(v,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!x)return null;c=c||x.type,p.push(x)}const m=u&&p.some(v=>hp(u,v.type));return new mu(m?Zn:c,p)}evaluate(i){let s,c=null,u=0;for(const p of this.args){if(u++,c=p.evaluate(i),c&&c instanceof Rr&&!c.available&&(s||(s=c),c=null,u===this.args.length))return s;if(null!==c)break}return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(s=>{i.push(s.serialize())}),i}}class Id{constructor(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const s of this.bindings)i(s[1]);i(this.result)}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let p=1;p<i.length-1;p+=2){const m=i[p];if("string"!=typeof m)return s.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(i[p+1],p+1);if(!v)return null;c.push([m,v])}const u=s.parse(i[i.length-1],i.length-1,s.expectedType,c);return u?new Id(c,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[s,c]of this.bindings)i.push(s,c.serialize());return i.push(this.result.serialize()),i}}class ef{constructor(i,s,c){this.type=i,this.index=s,this.input=c}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,It),u=s.parse(i[2],2,Ao(s.expectedType||Zn));return c&&u?new ef(u.type.itemType,c,u):null}evaluate(i){const s=this.index.evaluate(i),c=this.input.evaluate(i);if(s<0)throw new Nr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Nr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Nr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bp{constructor(i,s){this.type=vt,this.needle=i,this.haystack=s}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Zn),u=s.parse(i[2],2,Zn);return c&&u?vs(c.type,[vt,jn,It,Xo,Zn])?new bp(c,u):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${pr(c.type)} instead`):null}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(null==c)return!1;if(!_l(s,["boolean","string","number","null"]))throw new Nr(`Expected first argument to be of type boolean, string, number or null, but found ${pr(hn(s))} instead.`);if(!_l(c,["string","array"]))throw new Nr(`Expected second argument to be of type array or string, but found ${pr(hn(c))} instead.`);return c.indexOf(s)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Da{constructor(i,s,c){this.type=It,this.needle=i,this.haystack=s,this.fromIndex=c}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Zn),u=s.parse(i[2],2,Zn);if(!c||!u)return null;if(!vs(c.type,[vt,jn,It,Xo,Zn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${pr(c.type)} instead`);if(4===i.length){const p=s.parse(i[3],3,It);return p?new Da(c,u,p):null}return new Da(c,u)}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!_l(s,["boolean","string","number","null"]))throw new Nr(`Expected first argument to be of type boolean, string, number or null, but found ${pr(hn(s))} instead.`);if(!_l(c,["string","array"]))throw new Nr(`Expected second argument to be of type array or string, but found ${pr(hn(c))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(i);return c.indexOf(s,u)}return c.indexOf(s)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class xp{constructor(i,s,c,u,p,m){this.inputType=i,this.type=s,this.input=c,this.cases=u,this.outputs=p,this.otherwise=m}static parse(i,s){if(i.length<5)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return s.error("Expected an even number of arguments.");let c,u;s.expectedType&&"value"!==s.expectedType.kind&&(u=s.expectedType);const p={},m=[];for(let C=2;C<i.length-1;C+=2){let S=i[C];const I=i[C+1];Array.isArray(S)||(S=[S]);const A=s.concat(C);if(0===S.length)return A.error("Expected at least one branch label.");for(const F of S){if("number"!=typeof F&&"string"!=typeof F)return A.error("Branch labels must be numbers or strings.");if("number"==typeof F&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof F&&Math.floor(F)!==F)return A.error("Numeric branch labels must be integer values.");if(c){if(A.checkSubtype(c,hn(F)))return null}else c=hn(F);if(void 0!==p[String(F)])return A.error("Branch labels must be unique.");p[String(F)]=m.length}const N=s.parse(I,C,u);if(!N)return null;u=u||N.type,m.push(N)}const v=s.parse(i[1],1,Zn);if(!v)return null;const x=s.parse(i[i.length-1],i.length-1,u);return x?"value"!==v.type.kind&&s.concat(1).checkSubtype(c,v.type)?null:new xp(c,u,v,p,m,x):null}evaluate(i){const s=this.input.evaluate(i);return(hn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],u={};for(const m of s){const v=u[this.cases[m]];void 0===v?(u[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[v][1].push(m)}const p=m=>"number"===this.inputType.kind?Number(m):m;for(const[m,v]of c)i.push(1===v.length?p(v[0]):v.map(p)),i.push(this.outputs[m].serialize());return i.push(this.otherwise.serialize()),i}}class Ad{constructor(i,s,c){this.type=i,this.branches=s,this.otherwise=c}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&"value"!==s.expectedType.kind&&(c=s.expectedType);const u=[];for(let m=1;m<i.length-1;m+=2){const v=s.parse(i[m],m,vt);if(!v)return null;const x=s.parse(i[m+1],m+1,c);if(!x)return null;u.push([v,x]),c=c||x.type}const p=s.parse(i[i.length-1],i.length-1,c);return p?new Ad(c,u,p):null}evaluate(i){for(const[s,c]of this.branches)if(s.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[s,c]of this.branches)i(s),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(s=>{i.push(s.serialize())}),i}}class uc{constructor(i,s,c,u){this.type=i,this.input=s,this.beginIndex=c,this.endIndex=u}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Zn),u=s.parse(i[2],2,It);if(!c||!u)return null;if(!vs(c.type,[Ao(Zn),jn,Zn]))return s.error(`Expected first argument to be of type array or string, but found ${pr(c.type)} instead`);if(4===i.length){const p=s.parse(i[3],3,It);return p?new uc(c.type,c,u,p):null}return new uc(c.type,c,u)}evaluate(i){const s=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!_l(s,["string","array"]))throw new Nr(`Expected first argument to be of type array or string, but found ${pr(hn(s))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(i);return s.slice(c,u)}return s.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function wp(o,i){return"=="===o||"!="===o?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Od(o,i,s,c){return 0===c.compare(i,s)}function Tl(o,i,s){const c="=="!==o&&"!="!==o;return class V4{constructor(p,m,v){this.type=vt,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument="value"===p.type.kind||"value"===m.type.kind}static parse(p,m){if(3!==p.length&&4!==p.length)return m.error("Expected two or three arguments.");const v=p[0];let x=m.parse(p[1],1,Zn);if(!x)return null;if(!wp(v,x.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${pr(x.type)}'.`);let C=m.parse(p[2],2,Zn);if(!C)return null;if(!wp(v,C.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${pr(C.type)}'.`);if(x.type.kind!==C.type.kind&&"value"!==x.type.kind&&"value"!==C.type.kind)return m.error(`Cannot compare types '${pr(x.type)}' and '${pr(C.type)}'.`);c&&("value"===x.type.kind&&"value"!==C.type.kind?x=new sa(C.type,[x]):"value"!==x.type.kind&&"value"===C.type.kind&&(C=new sa(x.type,[C])));let S=null;if(4===p.length){if("string"!==x.type.kind&&"string"!==C.type.kind&&"value"!==x.type.kind&&"value"!==C.type.kind)return m.error("Cannot use collator to compare non-string types.");if(S=m.parse(p[3],3,md),!S)return null}return new V4(x,C,S)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const x=hn(m),C=hn(v);if(x.kind!==C.kind||"string"!==x.kind&&"number"!==x.kind)throw new Nr(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${x.kind}, ${C.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const x=hn(m),C=hn(v);if("string"!==x.kind||"string"!==C.kind)return i(p,m,v)}return this.collator?s(p,m,v,this.collator.evaluate(p)):i(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[o];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const mo=Tl("==",function(o,i,s){return i===s},Od),gu=Tl("!=",function(o,i,s){return i!==s},function(o,i,s,c){return!Od(0,i,s,c)}),fg=Tl("<",function(o,i,s){return i<s},function(o,i,s,c){return c.compare(i,s)<0}),I1=Tl(">",function(o,i,s){return i>s},function(o,i,s,c){return c.compare(i,s)>0}),A1=Tl("<=",function(o,i,s){return i<=s},function(o,i,s,c){return c.compare(i,s)<=0}),ky=Tl(">=",function(o,i,s){return i>=s},function(o,i,s,c){return c.compare(i,s)>=0});class dc{constructor(i,s,c,u,p,m){this.type=jn,this.number=i,this.locale=s,this.currency=c,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(i,s){if(3!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,It);if(!c)return null;const u=i[2];if("object"!=typeof u||Array.isArray(u))return s.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=s.parse(u.locale,1,jn),!p))return null;let m=null;if(u.currency&&(m=s.parse(u.currency,1,jn),!m))return null;let v=null;if(u.unit&&(v=s.parse(u.unit,1,jn),!v))return null;let x=null;if(u["min-fraction-digits"]&&(x=s.parse(u["min-fraction-digits"],1,It),!x))return null;let C=null;return u["max-fraction-digits"]&&(C=s.parse(u["max-fraction-digits"],1,It),!C)?null:new dc(c,p,m,v,x,C)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class pg{constructor(i){this.type=It,this.input=i}static parse(i,s){if(2!==i.length)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=s.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?s.error(`Expected argument of type string or array, but found ${pr(c.type)} instead.`):new pg(c):null}evaluate(i){const s=this.input.evaluate(i);if("string"==typeof s||Array.isArray(s))return s.length;throw new Nr(`Expected value to be of type string or array, but found ${pr(hn(s))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(s=>{i.push(s.serialize())}),i}}function Fy(o){return function(){o=1831565813+(o|=0)|0;let i=Math.imul(o^o>>>15,1|o);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const Pd={"==":mo,"!=":gu,">":I1,"<":fg,">=":ky,"<=":A1,array:sa,at:ef,boolean:sa,case:Ad,coalesce:mu,collator:yl,format:lu,image:Ta,in:bp,"index-of":Da,interpolate:la,"interpolate-hcl":la,"interpolate-lab":la,length:pg,let:Id,literal:qa,match:xp,number:sa,"number-format":dc,object:sa,slice:uc,step:bi,string:sa,"to-boolean":Wa,"to-color":Wa,"to-number":Wa,"to-string":Wa,var:Xh,within:Za,distance:hu,config:ac};function Cp(o,[i,s,c,u]){i=i.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const p=u?u.evaluate(o):1,m=vd(i,s,c,p);if(m)throw new Nr(m);return new ni(i/255*p,s/255*p,c/255*p,p)}function Sa(o,[i,s,c,u]){i=i.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const p=u?u.evaluate(o):1,m=(S=s,I=c,A=p,"number"==typeof(C=i)&&C>=0&&C<=360?"number"==typeof S&&S>=0&&S<=100&&"number"==typeof I&&I>=0&&I<=100?void 0===A||"number"==typeof A&&A>=0&&A<=1?null:`Invalid hsla value [${[C,S,I,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof A?[C,S,I,A]:[C,S,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof A?[C,S,I,A]:[C,S,I]).join(", ")}]: 'h' must be between 0 and 360.`);var C,S,I,A;if(m)throw new Nr(m);const v=`hsla(${i}, ${s}%, ${c}%, ${p})`,x=ni.parse(v);if(!x)throw new Nr(`Failed to parse HSLA color: ${v}`);return x}function g(o,i){return o in i}function l(o,i){const s=i[o];return void 0===s?null:s}function h(o){return{type:o}}function y(o){return{result:"success",value:o}}function b(o){return{result:"error",value:o}}function w(o,i){return!!o&&!!o.parameters&&o.parameters.indexOf(i)>-1}function E(o){return"data-driven"===o["property-type"]}function M(o){return w(o.expression,"measure-light")}function O(o){return w(o.expression,"zoom")}function R(o){return!!o.expression&&o.expression.interpolated}function k(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function B(o){return o}function U(o,i){const s="color"===i.type,c=o.stops&&"object"==typeof o.stops[0][0],u=c||!(c||void 0!==o.property),p=o.type||(R(i)?"exponential":"interval");if(s&&((o=fd({},o)).stops&&(o.stops=o.stops.map(C=>[C[0],ni.parse(C[1])])),o.default=ni.parse(o.default?o.default:i.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!cc[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let m,v,x;if("exponential"===p)m=X;else if("interval"===p)m=Y;else if("categorical"===p){m=Z,v=Object.create(null);for(const C of o.stops)v[C[0]]=C[1];x=typeof o.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);m=W}if(c){const C={},S=[];for(let N=0;N<o.stops.length;N++){const F=o.stops[N],z=F[0].zoom;void 0===C[z]&&(C[z]={zoom:z,type:o.type,property:o.property,default:o.default,stops:[]},S.push(z)),C[z].stops.push([F[0].value,F[1]])}const I=[];for(const N of S)I.push([C[N].zoom,U(C[N],i)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:la.interpolationFactor.bind(void 0,A),zoomStops:I.map(N=>N[0]),evaluate:({zoom:N},F)=>X({stops:I,base:o.base},i,N).evaluate(N,F)}}if(u){const C="exponential"===p?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:la.interpolationFactor.bind(void 0,C),zoomStops:o.stops.map(S=>S[0]),evaluate:({zoom:S})=>m(o,i,S,v,x)}}return{kind:"source",evaluate(C,S){const I=S&&S.properties?S.properties[o.property]:void 0;return void 0===I?j(o.default,i.default):m(o,i,I,v,x)}}}function j(o,i,s){return void 0!==o?o:void 0!==i?i:void 0!==s?s:void 0}function Z(o,i,s,c,u){return j(typeof s===u?c[s]:void 0,o.default,i.default)}function Y(o,i,s){if("number"!==Yn(s))return j(o.default,i.default);const c=o.stops.length;if(1===c||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const u=fu(o.stops.map(p=>p[0]),s);return o.stops[u][1]}function X(o,i,s){const c=void 0!==o.base?o.base:1;if("number"!==Yn(s))return j(o.default,i.default);const u=o.stops.length;if(1===u||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[u-1][0])return o.stops[u-1][1];const p=fu(o.stops.map(S=>S[0]),s),m=function(S,I,A,N){const F=N-A,z=S-A;return 0===F?0:1===I?z/F:(Math.pow(I,z)-1)/(Math.pow(I,F)-1)}(s,c,o.stops[p][0],o.stops[p+1][0]),v=o.stops[p][1],x=o.stops[p+1][1];let C=hd[i.type]||B;if(o.colorSpace&&"rgb"!==o.colorSpace){const S=cc[o.colorSpace];C=(I,A)=>S.reverse(S.interpolate(S.forward(I),S.forward(A),m))}return"function"==typeof v.evaluate?{evaluate(...S){const I=v.evaluate.apply(void 0,S),A=x.evaluate.apply(void 0,S);if(void 0!==I&&void 0!==A)return C(I,A,m)}}:C(v,x,m)}function W(o,i,s){return"color"===i.type?s=ni.parse(s):"formatted"===i.type?s=fo.fromString(s.toString()):"resolvedImage"===i.type?s=Rr.fromString(s.toString()):Yn(s)===i.type||"enum"===i.type&&i.values[s]||(s=void 0),j(s,o.default,i.default)}Fs.register(Pd,{error:[{kind:"error"},[jn],(o,[i])=>{throw new Nr(i.evaluate(o))}],typeof:[jn,[Zn],(o,[i])=>pr(hn(i.evaluate(o)))],"to-rgba":[Ao(It,4),[ys],(o,[i])=>i.evaluate(o).toRenderColor(null).toArray()],rgb:[ys,[It,It,It],Cp],rgba:[ys,[It,It,It,It],Cp],hsl:[ys,[It,It,It],Sa],hsla:[ys,[It,It,It,It],Sa],has:{type:vt,overloads:[[[jn],(o,[i])=>g(i.evaluate(o),o.properties())],[[jn,ic],(o,[i,s])=>g(i.evaluate(o),s.evaluate(o))]]},get:{type:Zn,overloads:[[[jn],(o,[i])=>l(i.evaluate(o),o.properties())],[[jn,ic],(o,[i,s])=>l(i.evaluate(o),s.evaluate(o))]]},"feature-state":[Zn,[jn],(o,[i])=>l(i.evaluate(o),o.featureState||{})],properties:[ic,[],o=>o.properties()],"geometry-type":[jn,[],o=>o.geometryType()],id:[Zn,[],o=>o.id()],zoom:[It,[],o=>o.globals.zoom],pitch:[It,[],o=>o.globals.pitch||0],"distance-from-center":[It,[],o=>o.distanceFromCenter()],"measure-light":[It,[jn],(o,[i])=>o.measureLight(i.evaluate(o))],"heatmap-density":[It,[],o=>o.globals.heatmapDensity||0],"line-progress":[It,[],o=>o.globals.lineProgress||0],"raster-value":[It,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[It,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[It,[],o=>o.globals.skyRadialProgress||0],accumulated:[Zn,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[It,h(It),(o,i)=>{let s=0;for(const c of i)s+=c.evaluate(o);return s}],"*":[It,h(It),(o,i)=>{let s=1;for(const c of i)s*=c.evaluate(o);return s}],"-":{type:It,overloads:[[[It,It],(o,[i,s])=>i.evaluate(o)-s.evaluate(o)],[[It],(o,[i])=>-i.evaluate(o)]]},"/":[It,[It,It],(o,[i,s])=>i.evaluate(o)/s.evaluate(o)],"%":[It,[It,It],(o,[i,s])=>i.evaluate(o)%s.evaluate(o)],ln2:[It,[],()=>Math.LN2],pi:[It,[],()=>Math.PI],e:[It,[],()=>Math.E],"^":[It,[It,It],(o,[i,s])=>Math.pow(i.evaluate(o),s.evaluate(o))],sqrt:[It,[It],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[It,[It],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[It,[It],(o,[i])=>Math.log(i.evaluate(o))],log2:[It,[It],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[It,[It],(o,[i])=>Math.sin(i.evaluate(o))],cos:[It,[It],(o,[i])=>Math.cos(i.evaluate(o))],tan:[It,[It],(o,[i])=>Math.tan(i.evaluate(o))],asin:[It,[It],(o,[i])=>Math.asin(i.evaluate(o))],acos:[It,[It],(o,[i])=>Math.acos(i.evaluate(o))],atan:[It,[It],(o,[i])=>Math.atan(i.evaluate(o))],min:[It,h(It),(o,i)=>Math.min(...i.map(s=>s.evaluate(o)))],max:[It,h(It),(o,i)=>Math.max(...i.map(s=>s.evaluate(o)))],abs:[It,[It],(o,[i])=>Math.abs(i.evaluate(o))],round:[It,[It],(o,[i])=>{const s=i.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[It,[It],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[It,[It],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[vt,[jn,Zn],(o,[i,s])=>o.properties()[i.value]===s.value],"filter-id-==":[vt,[Zn],(o,[i])=>o.id()===i.value],"filter-type-==":[vt,[jn],(o,[i])=>o.geometryType()===i.value],"filter-<":[vt,[jn,Zn],(o,[i,s])=>{const c=o.properties()[i.value],u=s.value;return typeof c==typeof u&&c<u}],"filter-id-<":[vt,[Zn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<c}],"filter->":[vt,[jn,Zn],(o,[i,s])=>{const c=o.properties()[i.value],u=s.value;return typeof c==typeof u&&c>u}],"filter-id->":[vt,[Zn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>c}],"filter-<=":[vt,[jn,Zn],(o,[i,s])=>{const c=o.properties()[i.value],u=s.value;return typeof c==typeof u&&c<=u}],"filter-id-<=":[vt,[Zn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<=c}],"filter->=":[vt,[jn,Zn],(o,[i,s])=>{const c=o.properties()[i.value],u=s.value;return typeof c==typeof u&&c>=u}],"filter-id->=":[vt,[Zn],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>=c}],"filter-has":[vt,[Zn],(o,[i])=>i.value in o.properties()],"filter-has-id":[vt,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[vt,[Ao(jn)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[vt,[Ao(Zn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[vt,[jn,Ao(Zn)],(o,[i,s])=>s.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[vt,[jn,Ao(Zn)],(o,[i,s])=>function(c,u,p,m){for(;p<=m;){const v=p+m>>1;if(u[v]===c)return!0;u[v]>c?m=v-1:p=v+1}return!1}(o.properties()[i.value],s.value,0,s.value.length-1)],all:{type:vt,overloads:[[[vt,vt],(o,[i,s])=>i.evaluate(o)&&s.evaluate(o)],[h(vt),(o,i)=>{for(const s of i)if(!s.evaluate(o))return!1;return!0}]]},any:{type:vt,overloads:[[[vt,vt],(o,[i,s])=>i.evaluate(o)||s.evaluate(o)],[h(vt),(o,i)=>{for(const s of i)if(s.evaluate(o))return!0;return!1}]]},"!":[vt,[vt],(o,[i])=>!i.evaluate(o)],"is-supported-script":[vt,[jn],(o,[i])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(i.evaluate(o))}],upcase:[jn,[jn],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[jn,[jn],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[jn,h(Zn),(o,i)=>i.map(s=>ri(s.evaluate(o))).join("")],"resolved-locale":[jn,[md],(o,[i])=>i.evaluate(o).resolvedLocale()],random:[It,[It,It,Zn],(o,i)=>{const[s,c,u]=i.map(m=>m.evaluate(o));if(s>c||s===c)return s;let p;if("string"==typeof u)p=function(m){let v=0;if(0===m.length)return v;for(let x=0;x<m.length;x++)v=(v<<5)-v+m.charCodeAt(x),v|=0;return v}(u);else{if("number"!=typeof u)throw new Nr(`Invalid seed input: ${u}`);p=u}return s+Fy(p)()*(c-s)}]});class K{constructor(i,s,c,u){var p;this.expression=i,this._warningHistory={},this._evaluator=new fp(c,u),this._defaultValue=s?"color"===(p=s).type&&(k(p.default)||Array.isArray(p.default))?new ni(0,0,0,0):"color"===p.type?ni.parse(p.default)||null:void 0===p.default?null:p.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(i,s,c,u,p,m,v,x){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(i,s,c,u,p,m,v,x){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=x||null;try{const C=this.expression.evaluate(this._evaluator);if(null==C||"number"==typeof C&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new Nr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${C.message}`)),this._defaultValue}}}function te(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in Pd}function se(o,i,s,c){const u=new Ti(Pd,[],i?function(m){const v={color:ys,string:jn,number:It,enum:jn,boolean:vt,formatted:gd,resolvedImage:gl};return"array"===m.type?Ao(v[m.value]||Zn,m.length):v[m.type]}(i):void 0,void 0,void 0,s,c),p=u.parse(o,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return p?y(new K(p,i,s,c)):b(u.errors)}class he{constructor(i,s,c){this.kind=i,this._styleExpression=s,this.isLightConstant=c,this.isStateDependent="constant"!==i&&!_p(s.expression),this.configDependencies=Ed(s.expression)}evaluateWithoutErrorHandling(i,s,c,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,u,p,m)}evaluate(i,s,c,u,p,m){return this._styleExpression.evaluate(i,s,c,u,p,m)}}class ce{constructor(i,s,c,u,p){this.kind=i,this.zoomStops=c,this._styleExpression=s,this.isStateDependent="camera"!==i&&!_p(s.expression),this.isLightConstant=p,this.configDependencies=Ed(s.expression),this.interpolationType=u}evaluateWithoutErrorHandling(i,s,c,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,u,p,m)}evaluate(i,s,c,u,p,m){return this._styleExpression.evaluate(i,s,c,u,p,m)}interpolationFactor(i,s,c){return this.interpolationType?la.interpolationFactor(this.interpolationType,i,s,c):0}}function ue(o,i,s,c){if("error"===(o=se(o,i,s,c)).result)return o;const u=o.value.expression,p=Zh(u);if(!p&&!E(i))return b([new ks("","data expressions not supported")]);const m=Yh(u,["zoom","pitch","distance-from-center"]);if(!m&&!O(i))return b([new ks("","zoom expressions not supported")]);const v=Yh(u,["measure-light"]);if(!v&&!M(i))return b([new ks("","measure-light expression not supported")]);const x=i.expression&&i.expression.relaxZoomRestriction,C=pe(u);return C||m||x?C instanceof ks?b([C]):C instanceof la&&!R(i)?b([new ks("",'"interpolate" expressions cannot be used with this property')]):y(C?new ce(p?"camera":"composite",o.value,C.labels,C instanceof la?C.interpolation:void 0,v):new he(p?"constant":"source",o.value,v)):b([new ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ye{constructor(i,s){this._parameters=i,this._specification=s,fd(this,U(this._parameters,this._specification))}static deserialize(i){return new ye(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function pe(o){let i=null;if(o instanceof Id)i=pe(o.result);else if(o instanceof mu){for(const s of o.args)if(i=pe(s),i)break}else(o instanceof bi||o instanceof la)&&o.input instanceof Fs&&"zoom"===o.input.name&&(i=o);return i instanceof ks||o.eachChild(s=>{const c=pe(s);c instanceof ks?i=c:i&&c&&i!==c&&(i=new ks("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var Se=ae,xe=3;function ae(o,i,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var u=new Int32Array(this.arrayBuffer);o=u[0],this.d=(i=u[1])+2*(s=u[2]);for(var p=0;p<this.d*this.d;p++){var m=u[xe+p],v=u[xe+p+1];c.push(m===v?null:u.subarray(m,v))}var x=u[xe+c.length+1];this.keys=u.subarray(u[xe+c.length],x),this.bboxes=u.subarray(x),this.insert=this._insertReadonly}else{this.d=i+2*s;for(var C=0;C<this.d*this.d;C++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=o,this.padding=s,this.scale=i/o,this.uid=0;var S=s/i*o;this.min=-S,this.max=o+S}ae.prototype.insert=function(o,i,s,c,u){this._forEachCell(i,s,c,u,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(u)},ae.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ae.prototype._insertCell=function(o,i,s,c,u,p){this.cells[u].push(p)},ae.prototype.query=function(o,i,s,c,u){var p=this.min,m=this.max;if(o<=p&&i<=p&&m<=s&&m<=c&&!u)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(o,i,s,c,this._queryCell,v,{},u),v},ae.prototype._queryCell=function(o,i,s,c,u,p,m,v){var x=this.cells[u];if(null!==x)for(var C=this.keys,S=this.bboxes,I=0;I<x.length;I++){var A=x[I];if(void 0===m[A]){var N=4*A;(v?v(S[N+0],S[N+1],S[N+2],S[N+3]):o<=S[N+2]&&i<=S[N+3]&&s>=S[N+0]&&c>=S[N+1])?(m[A]=!0,p.push(C[A])):m[A]=!1}}},ae.prototype._forEachCell=function(o,i,s,c,u,p,m,v){for(var x=this._convertToCellCoord(o),C=this._convertToCellCoord(i),S=this._convertToCellCoord(s),I=this._convertToCellCoord(c),A=x;A<=S;A++)for(var N=C;N<=I;N++){var F=this.d*N+A;if((!v||v(this._convertFromCellCoord(A),this._convertFromCellCoord(N),this._convertFromCellCoord(A+1),this._convertFromCellCoord(N+1)))&&u.call(this,o,i,s,c,F,p,m,v))return}},ae.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},ae.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},ae.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,i=xe+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var u=new Int32Array(i+s+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=i,m=0;m<o.length;m++){var v=o[m];u[xe+m]=p,u.set(v,p),p+=v.length}return u[xe+o.length]=p,u.set(this.keys,p),u[xe+o.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};var Fe=us(Se);const ke={};function Ee(o,i,s={}){Object.defineProperty(o,"_classRegistryKey",{value:i,writable:!1}),ke[i]={klass:o,omit:s.omit||[]}}Ee(Object,"Object"),Fe.serialize=function(o,i){const s=o.toArrayBuffer();return i&&i.add(s),{buffer:s}},Fe.deserialize=function(o){return new Fe(o.buffer)},Object.defineProperty(Fe,"name",{value:"Grid"}),Ee(Fe,"Grid"),Ee(ni,"Color"),Ee(Error,"Error"),Ee(fo,"Formatted"),Ee(yd,"FormattedSection"),Ee(Qm,"AJAXError"),Ee(Rr,"ResolvedImage"),Ee(ye,"StylePropertyFunction"),Ee(K,"StyleExpression",{omit:["_evaluator"]}),Ee(ce,"ZoomDependentExpression"),Ee(he,"ZoomConstantExpression"),Ee(Fs,"CompoundExpression",{omit:["_evaluate"]});for(const o in Pd)ke[Pd[o]._classRegistryKey]||Ee(Pd[o],`Expression${o}`);function We(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function Ye(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Oe(o,i){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(We(o)||Ye(o))return i&&i.add(o),o;if(ArrayBuffer.isView(o)){const s=o;return i&&i.add(s.buffer),s}if(o instanceof ImageData)return i&&i.add(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(Oe(c,i));return s}if(o instanceof Map){const s={$name:"Map"};for(const[c,u]of o.entries())s[c]=Oe(u);return s}if(o instanceof Set){const s={$name:"Set"};let c=0;for(const u of o.values())s[++c]=Oe(u);return s}if("object"==typeof o){const s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const u=s.serialize?s.serialize(o,i):{};if(!s.serialize){for(const p in o)o.hasOwnProperty(p)&&(ke[c].omit.indexOf(p)>=0||(u[p]=Oe(o[p],i)));o instanceof Error&&(u.message=o.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(u.$name=c),u}throw new Error("can't serialize object of type "+typeof o)}function ze(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||We(o)||Ye(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(ze);if("object"==typeof o){const i=o.$name||"Object";if("Map"===i){const u=new Map;for(const p of Object.keys(o))"$name"!==p&&u.set(p,ze(o[p]));return u}if("Set"===i){const u=new Set;for(const p of Object.keys(o))"$name"!==p&&u.add(ze(o[p]));return u}const{klass:s}=ke[i];if(!s)throw new Error(`can't deserialize unregistered class ${i}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const u of Object.keys(o))"$name"!==u&&(c[u]=ze(o[u]));return c}throw new Error("can't deserialize object of type "+typeof o)}const Te={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function Ke(o){for(const i of o)if(pt(i.charCodeAt(0)))return!0;return!1}function Xe(o){for(const i of o)if(!bt(i.charCodeAt(0)))return!1;return!0}function bt(o){return!(Te.Arabic(o)||Te["Arabic Supplement"](o)||Te["Arabic Extended-A"](o)||Te["Arabic Presentation Forms-A"](o)||Te["Arabic Presentation Forms-B"](o))}function pt(o){return!(746!==o&&747!==o&&(o<4352||!(Te["Bopomofo Extended"](o)||Te.Bopomofo(o)||Te["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Te["CJK Compatibility Ideographs"](o)||Te["CJK Compatibility"](o)||Te["CJK Radicals Supplement"](o)||Te["CJK Strokes"](o)||!(!Te["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Te["CJK Unified Ideographs Extension A"](o)||Te["CJK Unified Ideographs"](o)||Te["Enclosed CJK Letters and Months"](o)||Te["Hangul Compatibility Jamo"](o)||Te["Hangul Jamo Extended-A"](o)||Te["Hangul Jamo Extended-B"](o)||Te["Hangul Jamo"](o)||Te["Hangul Syllables"](o)||Te.Hiragana(o)||Te["Ideographic Description Characters"](o)||Te.Kanbun(o)||Te["Kangxi Radicals"](o)||Te["Katakana Phonetic Extensions"](o)||Te.Katakana(o)&&12540!==o||!(!Te["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Te["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Te["Unified Canadian Aboriginal Syllabics"](o)||Te["Unified Canadian Aboriginal Syllabics Extended"](o)||Te["Vertical Forms"](o)||Te["Yijing Hexagram Symbols"](o)||Te["Yi Syllables"](o)||Te["Yi Radicals"](o))))}function nt(o){return!(pt(o)||(i=o,Te["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||Te["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||Te["Letterlike Symbols"](i)||Te["Number Forms"](i)||Te["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||Te["Control Pictures"](i)&&9251!==i||Te["Optical Character Recognition"](i)||Te["Enclosed Alphanumerics"](i)||Te["Geometric Shapes"](i)||Te["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Te["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Te["CJK Symbols and Punctuation"](i)||Te.Katakana(i)||Te["Private Use Area"](i)||Te["CJK Compatibility Forms"](i)||Te["Small Form Variants"](i)||Te["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function Ct(o){return o>=1424&&o<=2303||Te["Arabic Presentation Forms-A"](o)||Te["Arabic Presentation Forms-B"](o)}function Gt(o,i){return!(!i&&Ct(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Te.Khmer(o))}function rn(o){for(const i of o)if(Ct(i.charCodeAt(0)))return!0;return!1}const en="deferred",mn="loading",on="loaded";let xi=null,An="unavailable",vn=null;const oi=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(An="error"),xi&&xi(o)};function xn(){Mn.fire(new Ha("pluginStateChange",{pluginStatus:An,pluginURL:vn}))}const Mn=new dd,nn=function(){return An},Bn=function(){if(An!==en||!vn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");An=mn,xn(),vn&&Yo({url:vn},o=>{o?oi(o):(An=on,xn())})},kn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>An===on||null!=kn.applyArabicShaping,isLoading:()=>An===mn,setState(o){An=o.pluginStatus,vn=o.pluginURL},isParsed:()=>null!=kn.applyArabicShaping&&null!=kn.processBidirectionalText&&null!=kn.processStyledBidirectionalText,getPluginURL:()=>vn};class cn{constructor(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(s,c){for(const u of s)if(!Gt(u.charCodeAt(0),c))return!1;return!0}(i,kn.isLoaded())}}class rr{constructor(i,s,c,u){this.property=i,this.value=s,this.expression=function(p,m,v,x){if(k(p))return new ye(p,m);if(te(p)||Array.isArray(p)&&p.length>0){const C=ue(p,m,v,x);if("error"===C.result)throw new Error(C.value.map(S=>`${S.key}: ${S.message}`).join(", "));return C.value}{let C=p;return"string"==typeof p&&"color"===m.type&&(C=ni.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>C}}}(void 0===s?i.specification.default:s,i.specification,c,u)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,s,c){return this.property.possiblyEvaluate(this,i,s,c)}}class ar{constructor(i,s,c){this.property=i,this.value=new rr(i,void 0,s,c)}transitioned(i,s){return new Wr(this.property,this.value,s,uo({},i.transition,this.transition),i.now)}untransitioned(){return new Wr(this.property,this.value,null,{},0)}}class go{constructor(i,s,c){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(i){return Zo(this._values[i].value.value)}setValue(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new ar(this._values[i].property,this._scope,this._options)),this._values[i].value=new rr(this._values[i].property,null===s?void 0:Zo(s),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,s){s&&(this._options=s);const c=this._properties.properties;if(i)for(const u in i){const p=i[u];if(Ah(u,"-transition")){const m=u.slice(0,-11);c[m]&&this.setTransition(m,p)}else c.hasOwnProperty(u)&&this.setValue(u,p)}}getTransition(i){return Zo(this._values[i].transition)}setTransition(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new ar(this._values[i].property)),this._values[i].transition=Zo(s)||void 0}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c);const u=this.getTransition(s);void 0!==u&&(i[`${s}-transition`]=u)}return i}transitioned(i,s){const c=new _o(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].transitioned(i,s._values[u]);return c}untransitioned(){const i=new _o(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].untransitioned();return i}}class Wr{constructor(i,s,c,u,p){const m=u.delay||0,v=u.duration||0;p=p||0,this.property=i,this.value=s,this.begin=p+m,this.end=this.begin+v,i.specification.transition&&(u.delay||u.duration)&&(this.prior=c)}possiblyEvaluate(i,s,c){const u=i.now||0,p=this.value.possiblyEvaluate(i,s,c),m=this.prior;if(m){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return m.possiblyEvaluate(i,s,c);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(i,s,c),p,Kf(v))}}return p}}class _o{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,s,c){const u=new yo(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(i,s,c);return u}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Ro{constructor(i,s,c){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(i){return Zo(this._values[i].value)}setValue(i,s){this._values[i]=new rr(this._values[i].property,null===s?void 0:Zo(s),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c)}return i}possiblyEvaluate(i,s,c){const u=new yo(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(i,s,c);return u}}class no{constructor(i,s,c){this.property=i,this.value=s,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,s,c,u){return this.property.evaluate(this.value,this.parameters,i,s,c,u)}}class yo{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class ct{constructor(i){this.specification=i}possiblyEvaluate(i,s){return i.expression.evaluate(s)}interpolate(i,s,c){const u=hd[this.specification.type];return u?u(i,s,c):i}}class Nt{constructor(i,s){this.specification=i,this.overrides=s}possiblyEvaluate(i,s,c,u){return new no(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(s,null,{},c,u)}:i.expression,s)}interpolate(i,s,c){if("constant"!==i.value.kind||"constant"!==s.value.kind)return i;if(void 0===i.value.value||void 0===s.value.value)return new no(this,{kind:"constant",value:void 0},i.parameters);const u=hd[this.specification.type];return u?new no(this,{kind:"constant",value:u(i.value.value,s.value.value,c)},i.parameters):i}evaluate(i,s,c,u,p,m){return"constant"===i.kind?i.value:i.evaluate(s,c,u,p,m)}}class Qo{constructor(i){this.specification=i}possiblyEvaluate(i,s,c,u){return!!i.expression.evaluate(s,null,{},c,u)}interpolate(){return!1}}class Ei{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new cn(0,{});for(const c in i){const u=i[c];u.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new rr(u,void 0),m=this.defaultTransitionablePropertyValues[c]=new ar(u);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(s)}}}Ee(Nt,"DataDrivenProperty"),Ee(ct,"DataConstantProperty"),Ee(Qo,"ColorRampProperty");var Le=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function hc(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ya(o){if(Array.isArray(o))return o.map(Ya);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const s in o)i[s]=Ya(o[s]);return i}return hc(o)}function fc(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!fc(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Xa(o,i="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};fc(o)||(o=yu(o));const s=o;let c=!0;try{c=function(C){if(!_u(C))return C;let S=Ya(C);return mg(S),S=tf(S),S}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const u=Le[`filter_${i}`],p=se(c,u);let m=null;if("error"===p.result)throw new Error(p.value.map(C=>`${C.key}: ${C.message}`).join(", "));m=(C,S,I)=>p.value.evaluate(C,S,{},I);let v=null,x=null;if(c!==s){const C=se(s,u);if("error"===C.result)throw new Error(C.value.map(S=>`${S.key}: ${S.message}`).join(", "));v=(S,I,A,N,F)=>C.value.evaluate(S,I,{},A,void 0,void 0,N,F),x=!Zh(C.value.expression)}return{filter:m,dynamicFilter:v||void 0,needGeometry:Tp(c),needFeature:!!x}}function tf(o){if(!Array.isArray(o))return o;const i=function(s){if(Ly.has(s[0]))for(let c=1;c<s.length;c++)if(_u(s[c]))return!0;return s}(o);return!0===i?i:i.map(s=>tf(s))}function mg(o){let i=!1;const s=[];if("case"===o[0]){for(let c=1;c<o.length-1;c+=2)i=i||_u(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if("match"===o[0]){i=i||_u(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if("step"===o[0]){i=i||_u(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}i&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)mg(o[c])}function _u(o){if(!Array.isArray(o))return!1;if("pitch"===(i=o[0])||"distance-from-center"===i)return!0;var i;for(let s=1;s<o.length;s++)if(_u(o[s]))return!0;return!1}const Ly=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Rd(o,i){return o<i?-1:o>i?1:0}function Tp(o){if(!Array.isArray(o))return!1;if("within"===o[0]||"distance"===o[0])return!0;for(let i=1;i<o.length;i++)if(Tp(o[i]))return!0;return!1}function yu(o){if(!o)return!0;const i=o[0];return o.length<=1?"any"!==i:"=="===i?kr(o[1],o[2],"=="):"!="===i?By(kr(o[1],o[2],"==")):"<"===i||">"===i||"<="===i||">="===i?kr(o[1],o[2],i):"any"===i?(s=o.slice(1),["any"].concat(s.map(yu))):"all"===i?["all"].concat(o.slice(1).map(yu)):"none"===i?["all"].concat(o.slice(1).map(yu).map(By)):"in"===i?O1(o[1],o.slice(2)):"!in"===i?By(O1(o[1],o.slice(2))):"has"===i?pC(o[1]):"!has"!==i||By(pC(o[1]));var s}function kr(o,i,s){switch(o){case"$type":return[`filter-type-${s}`,i];case"$id":return[`filter-id-${s}`,i];default:return[`filter-${s}`,o,i]}}function O1(o,i){if(0===i.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(s=>typeof s!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Rd)]]:["filter-in-small",o,["literal",i]]}}function pC(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function By(o){return["!",o]}function P1(o,i){return i?`${o}\x1f${i}`:o}const mC="-transition",R1=new Set(["fill","line","background","hillshade","raster"]);class js extends dd{constructor(i,s,c,u,p){if(super(),this.id=i.id,this.fqid=P1(this.id,c),this.type=i.type,this.scope=c,this.lut=u,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&"slot"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),i.slot&&(this.slot=i.slot),s.layout&&(this._unevaluatedLayout=new Ro(s.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint)){this._transitionablePaint=new go(s.paint,this.scope,p);for(const m in i.paint)this.setPaintProperty(m,i.paint[m]);for(const m in i.layout)this.setLayoutProperty(m,i.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yo(s.paint)}}onAdd(i){}onRemove(i){}isDraped(i){return R1.has(this.type)}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,s){if("custom"===this.type&&"visibility"===i)return void(this.visibility=s);const c=this._unevaluatedLayout;c._properties.properties[i]&&(c.setValue(i,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),"visibility"===i&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(i){return Ah(i,mC)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,s){const c=this._transitionablePaint,u=c._properties.properties;if(Ah(i,mC)){const I=i.slice(0,-11);return u[I]&&c.setTransition(I,s||void 0),!1}if(!u[i])return!1;const p=c._values[i],m=p.value.isDataDriven(),v=p.value;c.setValue(i,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const x=c._values[i].value,C=x.isDataDriven(),S=Ah(i,"pattern")||"line-dasharray"===i;return C||m||S||this._handleOverridablePaintPropertyUpdate(i,v,x)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,s,c){return null}_handleOverridablePaintPropertyUpdate(i,s,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,s)}serialize(){return qr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,s)=>!(void 0===i||"layout"===s&&!Object.keys(i).length||"paint"===s&&!Object.keys(i).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const i in this.paint._values){const s=this.paint.get(i);if(s instanceof no&&E(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Xa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&("shadow"===i.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,s,c,u,p,m,v,x,C){}queryIntersectsMatchingFeature(i,s,c,u){}}const pc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ep{constructor(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Vi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,s){return i._trim(),s&&(i.isTransferred=!0,s.add(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function tn(o,i=1){let s=0,c=0;return{members:o.map(u=>{const p=pc[u.type].BYTES_PER_ELEMENT,m=s=zy(s,Math.max(i,p)),v=u.components||1;return c=Math.max(c,p),s+=p*v,{name:u.name,type:u.type,components:v,offset:m}}),size:zy(s,Math.max(c,i)),alignment:i}}function zy(o,i){return Math.ceil(o/i)*i}class $s extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const u=2*i;return this.int16[u+0]=s,this.int16[u+1]=c,i}}$s.prototype.bytesPerElement=4,Ee($s,"StructArrayLayout2i4");class No extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c){const u=this.length;return this.resize(u+1),this.emplace(u,i,s,c)}emplace(i,s,c,u){const p=3*i;return this.int16[p+0]=s,this.int16[p+1]=c,this.int16[p+2]=u,i}}No.prototype.bytesPerElement=6,Ee(No,"StructArrayLayout3i6");class vu extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c,u)}emplace(i,s,c,u,p){const m=4*i;return this.int16[m+0]=s,this.int16[m+1]=c,this.int16[m+2]=u,this.int16[m+3]=p,i}}vu.prototype.bytesPerElement=8,Ee(vu,"StructArrayLayout4i8");class nf extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,u,p)}emplace(i,s,c,u,p,m){const v=5*i;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=u,this.int16[v+3]=p,this.int16[v+4]=m,i}}nf.prototype.bytesPerElement=10,Ee(nf,"StructArrayLayout5i10");class bu extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,s,c,u,p,m,v)}emplace(i,s,c,u,p,m,v,x){const C=6*i,S=12*i,I=3*i;return this.int16[C+0]=s,this.int16[C+1]=c,this.uint8[S+4]=u,this.uint8[S+5]=p,this.uint8[S+6]=m,this.uint8[S+7]=v,this.float32[I+2]=x,i}}bu.prototype.bytesPerElement=12,Ee(bu,"StructArrayLayout2i4ub1f12");class io extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c,u)}emplace(i,s,c,u,p){const m=4*i;return this.float32[m+0]=s,this.float32[m+1]=c,this.float32[m+2]=u,this.float32[m+3]=p,i}}io.prototype.bytesPerElement=16,Ee(io,"StructArrayLayout4f16");class Nd extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c){const u=this.length;return this.resize(u+1),this.emplace(u,i,s,c)}emplace(i,s,c,u){const p=3*i;return this.float32[p+0]=s,this.float32[p+1]=c,this.float32[p+2]=u,i}}Nd.prototype.bytesPerElement=12,Ee(Nd,"StructArrayLayout3f12");class mc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,u,p)}emplace(i,s,c,u,p,m){const v=6*i,x=3*i;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=u,this.uint16[v+3]=p,this.float32[x+2]=m,i}}mc.prototype.bytesPerElement=12,Ee(mc,"StructArrayLayout4ui1f12");class Vy extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c,u)}emplace(i,s,c,u,p){const m=4*i;return this.uint16[m+0]=s,this.uint16[m+1]=c,this.uint16[m+2]=u,this.uint16[m+3]=p,i}}Vy.prototype.bytesPerElement=8,Ee(Vy,"StructArrayLayout4ui8");class Gs extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,u,p,m)}emplace(i,s,c,u,p,m,v){const x=6*i;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=u,this.int16[x+3]=p,this.int16[x+4]=m,this.int16[x+5]=v,i}}Gs.prototype.bytesPerElement=12,Ee(Gs,"StructArrayLayout6i12");class Uy extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v,x,C,S,I,A){const N=this.length;return this.resize(N+1),this.emplace(N,i,s,c,u,p,m,v,x,C,S,I,A)}emplace(i,s,c,u,p,m,v,x,C,S,I,A,N){const F=12*i;return this.int16[F+0]=s,this.int16[F+1]=c,this.int16[F+2]=u,this.int16[F+3]=p,this.uint16[F+4]=m,this.uint16[F+5]=v,this.uint16[F+6]=x,this.uint16[F+7]=C,this.int16[F+8]=S,this.int16[F+9]=I,this.int16[F+10]=A,this.int16[F+11]=N,i}}Uy.prototype.bytesPerElement=24,Ee(Uy,"StructArrayLayout4i4ui4i24");class jy extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,c,u,p,m)}emplace(i,s,c,u,p,m,v){const x=10*i,C=5*i;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=u,this.float32[C+2]=p,this.float32[C+3]=m,this.float32[C+4]=v,i}}jy.prototype.bytesPerElement=20,Ee(jy,"StructArrayLayout3i3f20");class $y extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint32[1*i+0]=s,i}}$y.prototype.bytesPerElement=4,Ee($y,"StructArrayLayout1ul4");class Ka extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const u=2*i;return this.uint16[u+0]=s,this.uint16[u+1]=c,i}}Ka.prototype.bytesPerElement=4,Ee(Ka,"StructArrayLayout2ui4");class _g extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v,x,C,S,I,A,N){const F=this.length;return this.resize(F+1),this.emplace(F,i,s,c,u,p,m,v,x,C,S,I,A,N)}emplace(i,s,c,u,p,m,v,x,C,S,I,A,N,F){const z=20*i,V=10*i;return this.int16[z+0]=s,this.int16[z+1]=c,this.int16[z+2]=u,this.int16[z+3]=p,this.int16[z+4]=m,this.float32[V+3]=v,this.float32[V+4]=x,this.float32[V+5]=C,this.float32[V+6]=S,this.int16[z+14]=I,this.uint32[V+8]=A,this.uint16[z+18]=N,this.uint16[z+19]=F,i}}_g.prototype.bytesPerElement=40,Ee(_g,"StructArrayLayout5i4f1i1ul2ui40");class rf extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,s,c,u,p,m,v)}emplace(i,s,c,u,p,m,v,x){const C=8*i;return this.int16[C+0]=s,this.int16[C+1]=c,this.int16[C+2]=u,this.int16[C+4]=p,this.int16[C+5]=m,this.int16[C+6]=v,this.int16[C+7]=x,i}}rf.prototype.bytesPerElement=16,Ee(rf,"StructArrayLayout3i2i2i16");class Dp extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,u,p)}emplace(i,s,c,u,p,m){const v=4*i,x=8*i;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=u,this.int16[x+6]=p,this.int16[x+7]=m,i}}Dp.prototype.bytesPerElement=16,Ee(Dp,"StructArrayLayout2f1f2i16");class yg extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c,u)}emplace(i,s,c,u,p){const m=12*i,v=3*i;return this.uint8[m+0]=s,this.uint8[m+1]=c,this.float32[v+1]=u,this.float32[v+2]=p,i}}yg.prototype.bytesPerElement=12,Ee(yg,"StructArrayLayout2ub2f12");class Xi extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c){const u=this.length;return this.resize(u+1),this.emplace(u,i,s,c)}emplace(i,s,c,u){const p=3*i;return this.uint16[p+0]=s,this.uint16[p+1]=c,this.uint16[p+2]=u,i}}Xi.prototype.bytesPerElement=6,Ee(Xi,"StructArrayLayout3ui6");class Vn extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V,$,ne,ee,re,de){const fe=this.length;return this.resize(fe+1),this.emplace(fe,i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V,$,ne,ee,re,de)}emplace(i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V,$,ne,ee,re,de,fe){const _e=30*i,De=15*i,Pe=60*i;return this.int16[_e+0]=s,this.int16[_e+1]=c,this.int16[_e+2]=u,this.float32[De+2]=p,this.float32[De+3]=m,this.uint16[_e+8]=v,this.uint16[_e+9]=x,this.uint32[De+5]=C,this.uint32[De+6]=S,this.uint32[De+7]=I,this.uint16[_e+16]=A,this.uint16[_e+17]=N,this.uint16[_e+18]=F,this.float32[De+10]=z,this.float32[De+11]=V,this.uint8[Pe+48]=$,this.uint8[Pe+49]=ne,this.uint8[Pe+50]=ee,this.uint32[De+13]=re,this.int16[_e+28]=de,this.uint8[Pe+58]=fe,i}}Vn.prototype.bytesPerElement=60,Ee(Vn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sp extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V,$,ne,ee,re,de,fe,_e,De,Pe,Be,Ne,He,st,qe,ut,Ge){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V,$,ne,ee,re,de,fe,_e,De,Pe,Be,Ne,He,st,qe,ut,Ge)}emplace(i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V,$,ne,ee,re,de,fe,_e,De,Pe,Be,Ne,He,st,qe,ut,Ge,Qe){const ht=20*i,$e=40*i,xt=80*i;return this.float32[ht+0]=s,this.float32[ht+1]=c,this.int16[$e+4]=u,this.int16[$e+5]=p,this.int16[$e+6]=m,this.int16[$e+7]=v,this.int16[$e+8]=x,this.int16[$e+9]=C,this.int16[$e+10]=S,this.int16[$e+11]=I,this.int16[$e+12]=A,this.uint16[$e+13]=N,this.uint16[$e+14]=F,this.uint16[$e+15]=z,this.uint16[$e+16]=V,this.uint16[$e+17]=$,this.uint16[$e+18]=ne,this.uint16[$e+19]=ee,this.uint16[$e+20]=re,this.uint16[$e+21]=de,this.uint16[$e+22]=fe,this.uint16[$e+23]=_e,this.uint16[$e+24]=De,this.uint16[$e+25]=Pe,this.uint16[$e+26]=Be,this.uint16[$e+27]=Ne,this.uint32[ht+14]=He,this.float32[ht+15]=st,this.float32[ht+16]=qe,this.float32[ht+17]=ut,this.float32[ht+18]=Ge,this.uint8[xt+76]=Qe,i}}Sp.prototype.bytesPerElement=80,Ee(Sp,"StructArrayLayout2f9i15ui1ul4f1ub80");class kd extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.float32[1*i+0]=s,i}}kd.prototype.bytesPerElement=4,Ee(kd,"StructArrayLayout1f4");class Fd extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,u,p)}emplace(i,s,c,u,p,m){const v=5*i;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=u,this.float32[v+3]=p,this.float32[v+4]=m,i}}Fd.prototype.bytesPerElement=20,Ee(Fd,"StructArrayLayout5f20");class gC extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,s,c,u,p,m,v)}emplace(i,s,c,u,p,m,v,x){const C=7*i;return this.float32[C+0]=s,this.float32[C+1]=c,this.float32[C+2]=u,this.float32[C+3]=p,this.float32[C+4]=m,this.float32[C+5]=v,this.float32[C+6]=x,i}}gC.prototype.bytesPerElement=28,Ee(gC,"StructArrayLayout7f28");class N1 extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,c,u)}emplace(i,s,c,u,p){const m=6*i;return this.uint32[3*i+0]=s,this.uint16[m+2]=c,this.uint16[m+3]=u,this.uint16[m+4]=p,i}}N1.prototype.bytesPerElement=12,Ee(N1,"StructArrayLayout1ul3ui12");class vg extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint16[1*i+0]=s,i}}vg.prototype.bytesPerElement=2,Ee(vg,"StructArrayLayout1ui2");class bg extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const u=2*i;return this.float32[u+0]=s,this.float32[u+1]=c,i}}bg.prototype.bytesPerElement=8,Ee(bg,"StructArrayLayout2f8");class Gy extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V){const $=this.length;return this.resize($+1),this.emplace($,i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V)}emplace(i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V,$){const ne=16*i;return this.float32[ne+0]=s,this.float32[ne+1]=c,this.float32[ne+2]=u,this.float32[ne+3]=p,this.float32[ne+4]=m,this.float32[ne+5]=v,this.float32[ne+6]=x,this.float32[ne+7]=C,this.float32[ne+8]=S,this.float32[ne+9]=I,this.float32[ne+10]=A,this.float32[ne+11]=N,this.float32[ne+12]=F,this.float32[ne+13]=z,this.float32[ne+14]=V,this.float32[ne+15]=$,i}}Gy.prototype.bytesPerElement=64,Ee(Gy,"StructArrayLayout16f64");class gc extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,u,p,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,s,c,u,p,m,v)}emplace(i,s,c,u,p,m,v,x){const C=10*i,S=5*i;return this.uint16[C+0]=s,this.uint16[C+1]=c,this.uint16[C+2]=u,this.uint16[C+3]=p,this.float32[S+2]=m,this.float32[S+3]=v,this.float32[S+4]=x,i}}gc.prototype.bytesPerElement=20,Ee(gc,"StructArrayLayout4ui3f20");class k1 extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.int16[1*i+0]=s,i}}k1.prototype.bytesPerElement=2,Ee(k1,"StructArrayLayout1i2");class F1 extends Vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint8[1*i+0]=s,i}}F1.prototype.bytesPerElement=1,Ee(F1,"StructArrayLayout1ub1");class _C extends Ep{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_C.prototype.size=40;class L1 extends _g{get(i){return new _C(this,i)}}Ee(L1,"CollisionBoxArray");class yC extends Ep{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}yC.prototype.size=60;class mt extends Vn{get(i){return new yC(this,i)}}Ee(mt,"PlacedSymbolArray");class fi extends Ep{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}fi.prototype.size=80;class Xt extends Sp{get(i){return new fi(this,i)}}Ee(Xt,"SymbolInstanceArray");class Kt extends kd{getoffsetX(i){return this.float32[1*i+0]}}Ee(Kt,"GlyphOffsetArray");class Wi extends $s{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Ee(Wi,"SymbolLineVertexArray");class B1 extends Ep{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}B1.prototype.size=12;class Mp extends N1{get(i){return new B1(this,i)}}Ee(Mp,"FeatureIndexArray");class Ja extends Ka{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Ee(Ja,"FillExtrusionCentroidArray");class Hy extends Ep{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}Hy.prototype.size=8;class qy extends vu{get(i){return new Hy(this,i)}}Ee(qy,"FillExtrusionWallArray");const vC=tn([{name:"a_pos",components:2,type:"Int16"}],4),KO=tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ki{constructor(i=[]){this.segments=i}_prepareSegment(i,s,c,u){let p=this.segments[this.segments.length-1];return i>Ki.MAX_VERTEX_ARRAY_LENGTH&&fr(`Max vertices per segment is ${Ki.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!p||p.vertexLength+i>Ki.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:s,primitiveOffset:c,vertexLength:0,primitiveLength:0},void 0!==u&&(p.sortKey=u),this.segments.push(p)),p}prepareSegment(i,s,c,u){return this._prepareSegment(i,s.length,c.length,u)}get(){return this.segments}destroy(){for(const i of this.segments)for(const s in i.vaos)i.vaos[s].destroy()}static simpleSegment(i,s,c,u){return new Ki([{vertexOffset:i,primitiveOffset:s,vertexLength:c,primitiveLength:u,vaos:{},sortKey:0}])}}function z1(o,i){return 256*(o=Sn(Math.floor(o),0,255))+Sn(Math.floor(i),0,255)}Ki.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ee(Ki,"SegmentVector");const bC=tn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),xC=tn([{name:"a_dash",components:4,type:"Uint16"}]);class vo{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,s,c,u){this.ids.push(_c(i)),this.positions.push(s,c,u)}eachPosition(i,s){const c=_c(i);let u=0,p=this.ids.length-1;for(;u<p;){const m=u+p>>1;this.ids[m]>=c?p=m:u=m+1}for(;this.ids[u]===c;)s(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(i,s){const c=new Float64Array(i.ids),u=new Uint32Array(i.positions);return Wy(c,u,0,c.length-1),s&&(s.add(c.buffer),s.add(u.buffer)),{ids:c,positions:u}}static deserialize(i){const s=new vo;let c;s.ids=i.ids,s.positions=i.positions;for(const u of s.ids)u!==c&&s.uniqueIds.push(u),c=u;return s.indexed=!0,s}}function _c(o){const i=+o;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:eg(String(o))}function Wy(o,i,s,c){for(;s<c;){const u=o[s+c>>1];let p=s-1,m=c+1;for(;;){do{p++}while(o[p]<u);do{m--}while(o[m]>u);if(p>=m)break;ca(o,p,m),ca(i,3*p,3*m),ca(i,3*p+1,3*m+1),ca(i,3*p+2,3*m+2)}m-s<c-m?(Wy(o,i,s,m),s=m+1):(Wy(o,i,m+1,c),c=m)}}function ca(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}Ee(vo,"FeaturePositionMap");class es{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,s),this.initialized=!0),!!this.location}set(i,s,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Zy extends es{constructor(i){super(i),this.current=0}set(i,s,c){this.fetchUniformLocation(i,s)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class ts extends es{constructor(i){super(i),this.current=0}set(i,s,c){this.fetchUniformLocation(i,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class xu extends es{constructor(i){super(i),this.current=[0,0]}set(i,s,c){this.fetchUniformLocation(i,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class V1 extends es{constructor(i){super(i),this.current=[0,0,0]}set(i,s,c){this.fetchUniformLocation(i,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class xg extends es{constructor(i){super(i),this.current=[0,0,0,0]}set(i,s,c){this.fetchUniformLocation(i,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Yy extends es{constructor(i){super(i),this.current=ni.transparent.toRenderColor(null)}set(i,s,c){this.fetchUniformLocation(i,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const U1=new Float32Array(16);class Ld extends es{constructor(i){super(i),this.current=U1}set(i,s,c){if(this.fetchUniformLocation(i,s)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let u=1;u<16;u++)if(c[u]!==this.current[u]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const aM=new Float32Array(9),wC=new Float32Array(4);class wg extends es{constructor(i){super(i),this.current=wC}set(i,s,c){if(this.fetchUniformLocation(i,s))for(let u=0;u<4;u++)if(c[u]!==this.current[u]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}function Xy(o){return[z1(255*o.r,255*o.g),z1(255*o.b,255*o.a)]}class Ip{constructor(i,s,c,u){this.value=i,this.uniformNames=s.map(p=>`u_${p}`),this.type=c,this.context=u}setUniform(i,s,c,u,p){const m=u.constantOr(this.value);s.set(i,p,m instanceof ni?m.toRenderColor(this.context.lut):m)}getBinding(i,s){return"color"===this.type?new Yy(i):new ts(i)}}class sf{constructor(i,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,s,c,u,p){const m="u_pattern"===p||"u_dash"===p?this.pattern:"u_pixel_ratio"===p?this.pixelRatio:null;m&&s.set(i,p,m)}getBinding(i,s){return"u_pattern"===s||"u_dash"===s?new xg(i):new ts(i)}}class yc{constructor(i,s,c,u){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(i,s,c,u,p,m,v){const x=this.paintVertexArray.length,C=this.expression.evaluate(new cn(0,{brightness:m}),s,{},p,u,v);this.paintVertexArray.resize(i),this._setPaintValue(x,i,C,this.context)}updatePaintArray(i,s,c,u,p,m,v){const x=this.expression.evaluate({zoom:0,brightness:v},c,u,void 0,p);this._setPaintValue(i,s,x,this.context)}_setPaintValue(i,s,c,u){if("color"===this.type){const p=Xy(c.toRenderColor(u.lut));for(let m=i;m<s;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=i;p<s;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ma{constructor(i,s,c,u,p,m){this.expression=i,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=u,this.context=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,s,c,u,p,m,v){const x=this.expression.evaluate(new cn(this.context.zoom,{brightness:m}),s,{},p,u,v),C=this.expression.evaluate(new cn(this.context.zoom+1,{brightness:m}),s,{},p,u,v),S=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(S,i,x,C,this.context)}updatePaintArray(i,s,c,u,p,m,v){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:v},c,u,void 0,p),C=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},c,u,void 0,p);this._setPaintValue(i,s,x,C,this.context)}_setPaintValue(i,s,c,u,p){if("color"===this.type){const m=Xy(c.toRenderColor(p.lut)),v=Xy(c.toRenderColor(p.lut));for(let x=i;x<s;x++)this.paintVertexArray.emplace(x,m[0],m[1],v[0],v[1])}else{for(let m=i;m<s;m++)this.paintVertexArray.emplace(m,c,u);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,s,c,u,p){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=Sn(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);s.set(i,p,v)}getBinding(i,s){return new ts(i)}}class Bd{constructor(i,s,c,u,p){this.expression=i,this.layerId=p,this.paintVertexAttributes=("array"===c?xC:bC).members;for(let m=0;m<s.length;++m);this.paintVertexArray=new u}populatePaintArray(i,s,c,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(p,i,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(i,s,c,u,p,m,v){this._setPaintValues(i,s,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(i,s,c,u){if(!u||!c)return;const p=u[c];if(!p)return;const{tl:m,br:v,pixelRatio:x}=p;for(let C=i;C<s;C++)this.paintVertexArray.emplace(C,m[0],m[1],v[0],v[1],x)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fr{constructor(i,s,c=(()=>!0)){this.binders={},this._buffers=[],this.context=s;const u=[];for(const p in i.paint._values){const m=i.paint.get(p);if(!c(p)||!(m instanceof no&&E(m.property.specification)))continue;const v=lM(p,i.type),x=m.value,C=m.property.specification.type,S=!!m.property.useIntegerZoom,I="line-dasharray"===p||p.endsWith("pattern"),A="line-dasharray"===p&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==x.kind||A)if("source"===x.kind||A||I){const N=CC(p,C,"source");this.binders[p]=I?new Bd(x,v,C,N,i.id):new yc(x,v,C,N),u.push(`/a_${p}`)}else{const N=CC(p,C,"composite");this.binders[p]=new Ma(x,v,C,S,s,N),u.push(`/z_${p}`)}else this.binders[p]=I?new sf(x.value,v):new Ip(x.value,v,C,s),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(i){const s=this.binders[i];return s instanceof yc||s instanceof Ma?s.maxValue:0}populatePaintArrays(i,s,c,u,p,m,v){for(const x in this.binders){const C=this.binders[x];C.context=this.context,(C instanceof yc||C instanceof Ma||C instanceof Bd)&&C.populatePaintArray(i,s,c,u,p,m,v)}}setConstantPatternPositions(i){for(const s in this.binders){const c=this.binders[s];c instanceof sf&&c.setConstantPatternPositions(i)}}updatePaintArrays(i,s,c,u,p,m,v,x){let C=!1;const S=Object.keys(i),I=0!==S.length,A=I?S:s.uniqueIds;this.context.lut=p.lut;for(const N in this.binders){const F=this.binders[N];if(F.context=this.context,(F instanceof yc||F instanceof Ma||F instanceof Bd)&&(!0===F.expression.isStateDependent||!1===F.expression.isLightConstant)){const z=p.paint.get(N);F.expression=z.value;for(const V of A){const $=i[V.toString()];s.eachPosition(V,(ne,ee,re)=>{const de=u.feature(ne);F.updatePaintArray(ee,re,de,$,m,v,x)})}if(!I)for(const V of c.uniqueIds){const $=i[V.toString()];c.eachPosition(V,(ne,ee,re)=>{const de=u.feature(ne);F.updatePaintArray(ee,re,de,$,m,v,x)})}C=!0}}return C}defines(){const i=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Ip||c instanceof sf)&&i.push(...c.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return i}getBinderAttributes(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof yc||c instanceof Ma||c instanceof Bd)for(let u=0;u<c.paintVertexAttributes.length;u++)i.push(c.paintVertexAttributes[u].name)}return i}getBinderUniforms(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Ip||c instanceof sf||c instanceof Ma)for(const u of c.uniformNames)i.push(u)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const s=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof Ip||u instanceof sf||u instanceof Ma)for(const p of u.uniformNames)s.push({name:p,property:c,binding:u.getBinding(i,p)})}return s}setUniforms(i,s,c,u,p){for(const{name:m,property:v,binding:x}of c)this.binders[v].setUniform(i,x,p,u.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const s=this.binders[i];(s instanceof yc||s instanceof Ma||s instanceof Bd)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(i){for(const s in this.binders){const c=this.binders[s];(c instanceof yc||c instanceof Ma||c instanceof Bd)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const s=this.binders[i];(s instanceof yc||s instanceof Ma||s instanceof Bd)&&s.destroy()}}}class ua{constructor(i,s,c=(()=>!0)){this.programConfigurations={};for(const u of i)this.programConfigurations[u.id]=new Fr(u,s,c);this.needsUpload=!1,this._featureMap=new vo,this._featureMapWithoutIds=new vo,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,s,c,u,p,m,v,x){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(i,s,u,p,m,v,x);void 0!==s.id?this._featureMap.add(s.id,c,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,s,c,u,p,m){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,s,v,u,p,m||0)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const mr={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function lM(o,i){return mr[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}const cM={"line-pattern":{source:mc,composite:mc},"fill-pattern":{source:mc,composite:mc},"fill-extrusion-pattern":{source:mc,composite:mc},"line-dasharray":{source:Vy,composite:Vy}},uM={color:{source:bg,composite:io},number:{source:kd,composite:bg}};function CC(o,i,s){const c=cM[o];return c&&c[s]||uM[i][s]}Ee(Ip,"ConstantBinder"),Ee(sf,"PatternConstantBinder"),Ee(yc,"SourceExpressionBinder"),Ee(Bd,"PatternCompositeBinder"),Ee(Ma,"CompositeExpressionBinder"),Ee(Fr,"ProgramConfiguration",{omit:["_buffers"]}),Ee(ua,"ProgramConfigurationSet");const ns=ft/Math.PI/2,Ky=5,Ap=6,vc=16383,Pp=[64,32,16],Hs=-ns,qs=ns;function zd(o,i,s,c=ns){return s=Fn(s),[o*Math.sin(s)*c,-i*c,o*Math.cos(s)*c]}function Vd(o,i,s){return zd(Math.cos(Fn(o)),Math.sin(Fn(o)),i,s)}const af=6371008.8,j1=2*Math.PI*af;class zn{constructor(i,s){if(isNaN(i)||isNaN(s))throw new Error(`Invalid LngLat object: (${i}, ${s})`);if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zn(Yl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const s=Math.PI/180,c=this.lat*s,u=i.lat*s,p=Math.sin(c)*Math.sin(u)+Math.cos(c)*Math.cos(u)*Math.cos((i.lng-this.lng)*s);return af*Math.acos(Math.min(p,1))}toBounds(i=0){const s=360*i/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Qa({lng:this.lng-c,lat:this.lat-s},{lng:this.lng+c,lat:this.lat+s})}toEcef(i){return Vd(this.lat,this.lng,ns+i*ns/af)}static convert(i){if(i instanceof zn)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new zn(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new zn(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Qa{constructor(i,s){if(i)if(s)this.setSouthWest(i).setNorthEast(s);else if(4===i.length){const c=i;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=i;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(i){return this._ne=i instanceof zn?new zn(i.lng,i.lat):zn.convert(i),this}setSouthWest(i){return this._sw=i instanceof zn?new zn(i.lng,i.lat):zn.convert(i),this}extend(i){const s=this._sw,c=this._ne;let u,p;if(i instanceof zn)u=i,p=i;else{if(!(i instanceof Qa))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(Qa.convert(i)):this.extend(zn.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(zn.convert(i)):this;if(u=i._sw,p=i._ne,!u||!p)return this}return s||c?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new zn(u.lng,u.lat),this._ne=new zn(p.lng,p.lat)),this}getCenter(){return new zn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new zn(this.getWest(),this.getNorth())}getSouthEast(){return new zn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:s,lat:c}=zn.convert(i);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&u}static convert(i){return!i||i instanceof Qa?i:new Qa(i)}}var TC={};!function(s){function c(p,m,v){var x=u(256*p,256*(m=Math.pow(2,v)-m-1),v),C=u(256*(p+1),256*(m+1),v);return x[0]+","+x[1]+","+C[0]+","+C[1]}function u(p,m,v){var x=2*Math.PI*6378137/256/Math.pow(2,v);return[p*x-2*Math.PI*6378137/2,m*x-2*Math.PI*6378137/2]}s.getURL=function(p,m,v,x,C,S){return S=S||{},p+"?"+["bbox="+c(v,x,C),"format="+(S.format||"image/png"),"service="+(S.service||"WMS"),"version="+(S.version||"1.1.1"),"request="+(S.request||"GetMap"),"srs="+(S.srs||"EPSG:3857"),"width="+(S.width||256),"height="+(S.height||256),"layers="+m].join("&")},s.getTileBBox=c,s.getMercCoords=u,Object.defineProperty(s,"__esModule",{value:!0})}(TC);var $1=TC;class Ud{constructor(i,s,c){this.z=i,this.x=s,this.y=c,this.key=Cg(0,i,i,s,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,s){const c=$1.getTileBBox(this.x,this.y,this.z),u=function(p,m,v){let x,C="";for(let S=p;S>0;S--)x=1<<S-1,C+=(m&x?1:0)+(v&x?2:0);return C}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class EC{constructor(i,s){this.wrap=i,this.canonical=s,this.key=Cg(i,s.z,s.z,s.x,s.y)}}class Lr{constructor(i,s,c,u,p){this.overscaledZ=i,this.wrap=s,this.canonical=new Ud(c,+u,+p),this.key=0===s&&i===c?this.canonical.key:Cg(s,i,c,u,p)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const s=this.canonical.z-i;return i>this.canonical.z?new Lr(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lr(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(i,s=!0){if(this.overscaledZ===i&&s)return this.key;if(i>this.canonical.z)return Cg(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return Cg(this.wrap*+s,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const s=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s}children(i){if(this.overscaledZ>=i)return[new Lr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,u=2*this.canonical.y;return[new Lr(s,this.wrap,s,c,u),new Lr(s,this.wrap,s,c+1,u),new Lr(s,this.wrap,s,c,u+1),new Lr(s,this.wrap,s,c+1,u+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Lr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Lr(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new EC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Cg(o,i,s,c,u){const p=1<<Math.min(s,22);let m=p*(u%p)+c%p;return o&&s<22&&(m+=p*p*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*m+s)+(i-s)}const JO=[o=>{let i=o.canonical.x-1,s=o.wrap;return i<0&&(i=(1<<o.canonical.z)-1,s--),new Lr(o.overscaledZ,s,o.canonical.z,i,o.canonical.y)},o=>{let i=o.canonical.x+1,s=o.wrap;return i===1<<o.canonical.z&&(i=0,s++),new Lr(o.overscaledZ,s,o.canonical.z,i,o.canonical.y)},o=>new Lr(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(0===o.canonical.y?1<<o.canonical.z:o.canonical.y)-1),o=>new Lr(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Ee(Ud,"CanonicalTileID"),Ee(Lr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const G1=0,lf=25.5;function Tg(o){return j1*Math.cos(o*Math.PI/180)}function da(o){return(180+o)/360}function bc(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function ro(o,i){return o/Tg(i)}function Ws(o){return 360*o-180}function $r(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Eg(o,i){return o*Tg($r(i))}const wr=85.051129;function H1(o){return Math.cos(Fn(Sn(o,-wr,wr)))}function jd(o,i){const s=Sn(i,G1,lf),c=Math.pow(2,s);return H1(o)*j1/(512*c)}function DC(o){return 1/Math.cos(o*Math.PI/180)}function Ia(o,i=0){const s=Math.exp(Math.PI*(1-(o.y+i/ft)/(1<<o.z)*2));return 80150034*s/(s*s+1)/ft/(1<<o.z)}class ko{constructor(i,s,c=0){this.x=+i,this.y=+s,this.z=+c}static fromLngLat(i,s=0){const c=zn.convert(i);return new ko(da(c.lng),bc(c.lat),ro(s,c.lat))}toLngLat(){return new zn(Ws(this.x),$r(this.y))}toAltitude(){return Eg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/j1*DC($r(this.y))}}function Rp(o,i,s,c,u,p,m,v,x){const C=(i+c)/2,S=(s+u)/2,I=new _t(C,S);v(I),function(A,N,F,z,V,$){const ne=F-V,ee=z-$;return Math.abs((z-N)*ne-(F-A)*ee)/Math.hypot(ne,ee)}(I.x,I.y,p.x,p.y,m.x,m.y)>=x?(Rp(o,i,s,C,S,p,I,v,x),Rp(o,C,S,c,u,I,m,v,x)):o.push(m)}function Jy(o,i,s){let c=o[0],u=c.x,p=c.y;i(c);const m=[c];for(let v=1;v<o.length;v++){const x=o[v],{x:C,y:S}=x;i(x),Rp(m,u,p,C,S,c,x,i,s),u=C,p=S,c=x}return m}function Qy(o,i,s,c){if(c(i,s)){const u=i.add(s)._mult(.5);Qy(o,i,u,c),Qy(o,u,s,c)}else o.push(s)}function e0(o,i){let s=o[0];const c=[s];for(let u=1;u<o.length;u++){const p=o[u];Qy(c,s,p,i),s=p}return c}const Dg=Math.pow(2,14)-1,SC=-Dg-1;function MC(o,i){const s=Math.round(o.x*i),c=Math.round(o.y*i);return o.x=Sn(s,SC,Dg),o.y=Sn(c,SC,Dg),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&fr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function el(o,i,s){const c=o.loadGeometry(),u=o.extent,p=ft/u;if(i&&s&&s.projection.isReprojectedInTileSpace){const m=1<<i.z,{scale:v,x,y:C,projection:S}=s,I=A=>{const N=Ws((i.x+A.x/u)/m),F=$r((i.y+A.y/u)/m),z=S.project(N,F);A.x=(z.x*v-x)*u,A.y=(z.y*v-C)*u};for(let A=0;A<c.length;A++)if(1!==o.type)c[A]=Jy(c[A],I,1);else{const N=[];for(const F of c[A])F.x<0||F.x>=u||F.y<0||F.y>=u||(I(F),N.push(F));c[A]=N}}for(const m of c)for(const v of m)MC(v,p);return c}function xc(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?el(o):[]}}function Sg(o,i,s,c,u){o.emplaceBack(2*i+(c+1)/2,2*s+(u+1)/2)}function t0(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class Np{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new $s,this.indexArray=new Xi,this.segments=new Ki,this.programConfigurations=new ua(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(i,s){}populate(i,s,c,u){const p=this.layers[0],m=[];let v=null;"circle"===p.type&&(v=p.layout.get("circle-sort-key"));for(const{feature:C,id:S,index:I,sourceLayerIndex:A}of i){const N=this.layers[0]._featureFilter.needGeometry,F=xc(C,N);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),F,c))continue;const z=v?v.evaluate(F,{},c):void 0,V={id:S,properties:C.properties,type:C.type,sourceLayerIndex:A,index:I,geometry:N?F.geometry:el(C,c,u),patterns:{},sortKey:z};m.push(V)}v&&m.sort((C,S)=>C.sortKey-S.sortKey);let x=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new Gs,x=u.projection);for(const C of m){const{geometry:S,index:I,sourceLayerIndex:A}=C,N=i[I].feature;this.addFeature(C,S,I,s.availableImages,c,x,s.brightness),s.featureIndex.insert(N,S,I,A,this.index)}}update(i,s,c,u,p){const m=0!==Object.keys(i).length;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(i,s,m?this.stateDependentLayers:this.layers,c,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,vC.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,KO.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,s,c,u,p,m,v){for(const x of s)for(const C of x){const S=C.x,I=C.y;if(S<0||S>=ft||I<0||I>=ft)continue;if(m){const F=m.projectTilePoint(S,I,p),z=m.upVector(p,S,I),V=this.globeExtVertexArray;t0(V,F,z),t0(V,F,z),t0(V,F,z),t0(V,F,z)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),N=A.vertexLength;Sg(this.layoutVertexArray,S,I,-1,-1),Sg(this.layoutVertexArray,S,I,1,-1),Sg(this.layoutVertexArray,S,I,1,1),Sg(this.layoutVertexArray,S,I,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+2,N+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},u,p,v)}}function wu(o,i){for(let s=0;s<o.length;s++)if(wc(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(wc(o,i[s]))return!0;return!!$d(o,i)}function dM(o,i,s){return!!wc(o,i)||!!Zr(i,o,s)}function q1(o,i){if(1===o.length)return lr(i,o[0]);for(let s=0;s<i.length;s++){const c=i[s];for(let u=0;u<c.length;u++)if(wc(o,c[u]))return!0}for(let s=0;s<o.length;s++)if(lr(i,o[s]))return!0;for(let s=0;s<i.length;s++)if($d(o,i[s]))return!0;return!1}function IC(o,i,s){if(o.length>1){if($d(o,i))return!0;for(let c=0;c<i.length;c++)if(Zr(i[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Zr(o[c],i,s))return!0;return!1}function $d(o,i){if(0===o.length||0===i.length)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],u=o[s+1];for(let p=0;p<i.length-1;p++)if(kp(c,u,i[p],i[p+1]))return!0}return!1}function kp(o,i,s,c){return Kl(o,s,c)!==Kl(i,s,c)&&Kl(o,i,s)!==Kl(o,i,c)}function Zr(o,i,s){const c=s*s;if(1===i.length)return o.distSqr(i[0])<c;for(let u=1;u<i.length;u++)if(AC(o,i[u-1],i[u])<c)return!0;return!1}function AC(o,i,s){const c=i.distSqr(s);if(0===c)return o.distSqr(i);const u=((o.x-i.x)*(s.x-i.x)+(o.y-i.y)*(s.y-i.y))/c;return o.distSqr(u<0?i:u>1?s:s.sub(i)._mult(u)._add(i))}function lr(o,i){let s,c,u,p=!1;for(let m=0;m<o.length;m++){s=o[m];for(let v=0,x=s.length-1;v<s.length;x=v++)c=s[v],u=s[x],c.y>i.y!=u.y>i.y&&i.x<(u.x-c.x)*(i.y-c.y)/(u.y-c.y)+c.x&&(p=!p)}return p}function wc(o,i){let s=!1;for(let c=0,u=o.length-1;c<o.length;u=c++){const p=o[c],m=o[u];p.y>i.y!=m.y>i.y&&i.x<(m.x-p.x)*(i.y-p.y)/(m.y-p.y)+p.x&&(s=!s)}return s}function OC(o,i,s,c,u){for(const m of o)if(i<=m.x&&s<=m.y&&c>=m.x&&u>=m.y)return!0;const p=[new _t(i,s),new _t(i,u),new _t(c,u),new _t(c,s)];if(o.length>2)for(const m of p)if(wc(o,m))return!0;for(let m=0;m<o.length-1;m++)if(PC(o[m],o[m+1],p))return!0;return!1}function PC(o,i,s){const c=s[0],u=s[2];if(o.x<c.x&&i.x<c.x||o.x>u.x&&i.x>u.x||o.y<c.y&&i.y<c.y||o.y>u.y&&i.y>u.y)return!1;const p=Kl(o,i,s[0]);return p!==Kl(o,i,s[1])||p!==Kl(o,i,s[2])||p!==Kl(o,i,s[3])}function Zs(o,i,s,c,u,p){let m=i.y-o.y,v=o.x-i.x;if(p=p||0){const x=m*m+v*v;if(0===x)return!0;const C=Math.sqrt(x);m/=C,v/=C}return!((s.x-o.x)*m+(s.y-o.y)*v-p<0||(c.x-o.x)*m+(c.y-o.y)*v-p<0||(u.x-o.x)*m+(u.y-o.y)*v-p<0)}function W1(o,i,s,c,u,p,m){return!(Zs(o,i,c,u,p,m)||Zs(i,s,c,u,p,m)||Zs(s,o,c,u,p,m)||Zs(c,u,o,i,s,m)||Zs(u,p,o,i,s,m)||Zs(p,c,o,i,s,m))}function cf(o,i,s){const c=i.paint.get(o).value;return"constant"===c.kind?c.value:s.programConfigurations.get(i.id).getMaxValue(o)}function Fp(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Mg(o,i,s,c,u){if(!i[0]&&!i[1])return o;const p=_t.convert(i)._mult(u);"viewport"===s&&p._rotate(-c);const m=[];for(let v=0;v<o.length;v++)m.push(o[v].sub(p));return m}function Z1(o,i,s,c){const u=_t.convert(o)._mult(c);return"viewport"===i&&u._rotate(-s),u}let RC,NC;Ee(Np,"CircleBucket",{omit:["layers"]});class Y1{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,c){const u=d.$.dot(s,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1]+(i[2]-this.pos[2])*s[2])/u;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(i,s,c){if(d.$.equals(this.pos,i)||0===s)return c[0]=c[1]=c[2]=0,!1;const[u,p,m]=this.dir,v=this.pos[0]-i[0],x=this.pos[1]-i[1],C=this.pos[2]-i[2],S=u*u+p*p+m*m,I=2*(v*u+x*p+C*m),A=I*I-4*S*(v*v+x*x+C*C-s*s);if(A<0){const N=Math.max(-I/2,0),F=v+u*N,z=x+p*N,V=C+m*N,$=Math.hypot(F,z,V);return c[0]=F*s/$,c[1]=z*s/$,c[2]=V*s/$,!1}{const N=(-I-Math.sqrt(A))/(2*S);if(N<0){const F=Math.hypot(v,x,C);return c[0]=v*s/F,c[1]=x*s/F,c[2]=C*s/F,!1}return c[0]=v+u*N,c[1]=x+p*N,c[2]=C+m*N,!0}}}class n0{constructor(i,s,c,u,p){this.TL=i,this.TR=s,this.BR=c,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(i,s,c){const u=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],x=d.$.transformMat4(u,u,i),C=d.$.transformMat4(p,p,i),S=d.$.transformMat4(m,m,i),I=d.$.transformMat4(v,v,i);return new n0(x,C,S,I,s/c)}}function Ig(o,i,s){let c=1/0,u=-1/0;const p=[];for(const m of o){d.$.sub(p,m,i);const v=d.$.dot(p,s);c=Math.min(c,v),u=Math.max(u,v)}return[c,u]}function X1(o,i){let s=!0;for(let c=0;c<o.planes.length;c++){const u=o.planes[c];let p=0;for(let m=0;m<i.length;m++)p+=d.$.dot(u,i[m])+u[3]>=0;if(0===p)return 0;p!==i.length&&(s=!1)}return s?2:1}function kC(o,i){for(const s of o.projections){const c=Ig(i,o.points[0],s.axis);if(s.projection[1]<c[0]||s.projection[0]>c[1])return 0}return 1}function FC(o,i){let s=0;const c=[0,0,0,0];for(let u=0;u<o.length;u++)c[0]=o[u][0],c[1]=o[u][1],c[2]=o[u][2],c[3]=1,d.aB.dot(c,i)>=0&&s++;return s}class LC{constructor(i,s){this.points=i||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=Ui.fromPoints(this.points),this.projections=[],this.frustumEdges=[d.$.sub([],this.points[2],this.points[3]),d.$.sub([],this.points[0],this.points[3]),d.$.sub([],this.points[4],this.points[0]),d.$.sub([],this.points[5],this.points[1]),d.$.sub([],this.points[6],this.points[2]),d.$.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const u=[0,-c[2],c[1]],p=[c[2],0,-c[0]];this.projections.push({axis:u,projection:Ig(this.points,this.points[0],u)}),this.projections.push({axis:p,projection:Ig(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(i,s,c,u){const p=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const S=d.aB.transformMat4([],C,i),I=1/S[3]/s*p;return d.aB.mul(S,S,[I,I,u?1/S[3]:I,I])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const S=d.$.sub([],m[C[0]],m[C[1]]),I=d.$.sub([],m[C[2]],m[C[1]]),A=d.$.normalize([],d.$.cross([],S,I)),N=-d.$.dot(A,m[C[1]]);return A.concat(N)}),x=[];for(let C=0;C<m.length;C++)x.push([m[C][0],m[C][1],m[C][2]]);return new LC(x,v)}intersectsPrecise(i,s,c){for(let u=0;u<s.length;u++)if(!FC(i,s[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!FC(i,this.planes[u]))return 0;for(const u of c)for(const p of this.frustumEdges){const m=d.$.cross([],u,p),v=d.$.length(m);if(0===v)continue;d.$.scale(m,m,1/v);const x=Ig(this.points,this.points[0],m),C=Ig(i,this.points[0],m);if(x[0]>C[1]||C[0]>x[1])return 0}return 1}containsPoint(i){for(const s of this.planes){const c=s[3];if(d.$.dot([s[0],s[1],s[2]],i)+c<0)return!1}return!0}}class Ui{static fromPoints(i){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const u of i)d.$.min(s,s,u),d.$.max(c,c,u);return new Ui(s,c)}static fromTileIdAndHeight(i,s,c){const u=1<<i.canonical.z,p=i.canonical.x,m=i.canonical.y;return new Ui([p/u,m/u,s],[(p+1)/u,(m+1)/u,c])}static applyTransform(i,s){const c=i.getCorners();for(let u=0;u<c.length;++u)d.$.transformMat4(c[u],c[u],s);return Ui.fromPoints(c)}static applyTransformFast(i,s){const c=[s[12],s[13],s[14]],u=[...c];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=s[4*m+p],x=v*i.min[m],C=v*i.max[m];c[p]+=Math.min(x,C),u[p]+=Math.max(x,C)}return new Ui(c,u)}static projectAabbCorners(i,s){const c=i.getCorners();for(let u=0;u<c.length;++u)d.$.transformMat4(c[u],c[u],s);return c}constructor(i,s){this.min=i,this.max=s,this.center=d.$.scale([],d.$.add([],this.min,this.max),.5)}quadrant(i){const s=[i%2==0,i<2],c=d.$.clone(this.min),u=d.$.clone(this.max);for(let p=0;p<s.length;p++)c[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Ui(c,u)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,s=this.max;return[[i[0],i[1],i[2]],[s[0],i[1],i[2]],[s[0],s[1],i[2]],[i[0],s[1],i[2]],[i[0],i[1],s[2]],[s[0],i[1],s[2]],[s[0],s[1],s[2]],[i[0],s[1],s[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?X1(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?X1(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,s){return s||this.intersects(i)?kC(i,this.getCorners()):0}intersectsPreciseFlat(i,s){return s||this.intersectsFlat(i)?kC(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let s=0;s<3;++s)if(this.min[s]>i.max[s]||i.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],i.min[s]),this.max[s]=Math.max(this.max[s],i.max[s])}encapsulatePoint(i){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],i[s]),this.max[s]=Math.max(this.max[s],i[s])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Ee(Ui,"Aabb");const BC=tn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:or}=BC,hM=tn([{name:"a_pos_3",components:3,type:"Int16"}]);var Ag=tn([{name:"a_pos",type:"Int16",components:2}]);function K1(o){return o*ns/af}const zC=[new Ui([Hs,Hs,Hs],[qs,qs,qs]),new Ui([Hs,Hs,Hs],[0,0,qs]),new Ui([0,Hs,Hs],[qs,0,qs]),new Ui([Hs,0,Hs],[0,qs,qs]),new Ui([0,0,Hs],[qs,qs,qs])];function fM(o,i,s,c=!0){const u=d.$.scale([],o._camera.position,o.worldSize),p=[i,s,1,1];d.aB.transformMat4(p,p,o.pixelMatrixInverse),d.aB.scale(p,p,1/p[3]);const m=d.$.sub([],p,u),v=d.$.normalize([],m),x=o.globeMatrix,C=[x[12],x[13],x[14]],S=d.$.sub([],C,u),I=d.$.length(S),A=d.$.normalize([],S),N=o.worldSize/(2*Math.PI),F=d.$.dot(A,v),z=Math.asin(N/I);if(z<Math.acos(F)){if(!c)return null;const Ne=[],He=[];d.$.scale(Ne,v,I/F),d.$.normalize(He,d.$.sub(He,Ne,S)),d.$.normalize(v,d.$.add(v,S,d.$.scale(v,He,Math.tan(z)*I)))}const V=[];new Y1(u,v).closestPointOnSphere(C,N,V);const $=d.$.normalize([],ec(x,0)),ne=d.$.normalize([],ec(x,1)),ee=d.$.normalize([],ec(x,2)),re=d.$.dot($,V),de=d.$.dot(ne,V),fe=d.$.dot(ee,V),_e=So(Math.asin(-de/N));let De=So(Math.atan2(re,fe));De=o.center.lng+function(Ne,He){const st=(He-Ne+180)%360-180;return st<-180?st+360:st}(o.center.lng,De);const Pe=da(De),Be=Sn(bc(_e),0,1);return new ko(Pe,Be)}class J1{constructor(i,s,c){this.a=d.$.sub([],i,c),this.b=d.$.sub([],s,c),this.center=c;const u=d.$.normalize([],this.a),p=d.$.normalize([],this.b);this.angle=Math.acos(d.$.dot(u,p))}}function ha(o,i){if(0===o.angle)return null;let s;return s=0===o.a[i]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[i]/o.a[i]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,u,p,m){const v=Math.sin(p);return c*(Math.sin((1-m)*p)/v)+u*(Math.sin(m*p)/v)}(o.a[i],o.b[i],o.angle,Sn(s,0,1))+o.center[i]}function El(o){if(o.z<=1)return zC[o.z+2*o.y+o.x];const i=jC(eb(o));return Ui.fromPoints(i)}function is(o,i,s){return d.$.scale(o,o,1-s),d.$.scaleAndAdd(o,o,i,s)}function VC(o,i){const s=Hd(i.zoom);if(0===s)return El(o);const c=eb(o),u=jC(c),p=da(c.getWest())*i.worldSize,m=da(c.getEast())*i.worldSize,v=bc(c.getNorth())*i.worldSize,x=bc(c.getSouth())*i.worldSize,C=[p,v,0],S=[m,v,0],I=[p,x,0],A=[m,x,0],N=d.ae.invert([],i.globeMatrix);return d.$.transformMat4(C,C,N),d.$.transformMat4(S,S,N),d.$.transformMat4(I,I,N),d.$.transformMat4(A,A,N),u[0]=is(u[0],I,s),u[1]=is(u[1],A,s),u[2]=is(u[2],S,s),u[3]=is(u[3],C,s),Ui.fromPoints(u)}function UC(o,i,s){for(const c of o)d.$.transformMat4(c,c,i),d.$.scale(c,c,s)}function Q1(o,i,s,c){const u=i/o.worldSize,p=o.globeMatrix;if(s.z<=1){const Pe=El(s).getCorners();return UC(Pe,p,u),Ui.fromPoints(Pe)}const m=eb(s,c),v=jC(m,ns+K1(o._tileCoverLift));UC(v,p,u);const x=Number.MAX_VALUE,C=[-x,-x,-x],S=[x,x,x];if(m.contains(o.center)){for(const Ne of v)d.$.min(S,S,Ne),d.$.max(C,C,Ne);C[2]=0;const Pe=o.point,Be=[Pe.x*u,Pe.y*u,0];return d.$.min(S,S,Be),d.$.max(C,C,Be),new Ui(S,C)}if(o._tileCoverLift>0){for(const Pe of v)d.$.min(S,S,Pe),d.$.max(C,C,Pe);return new Ui(S,C)}const I=[p[12]*u,p[13]*u,p[14]*u],A=m.getCenter(),N=Sn(o.center.lat,-wr,wr),F=Sn(A.lat,-wr,wr),z=da(o.center.lng),V=bc(N);let $=z-da(A.lng);const ne=V-bc(F);$>.5?$-=1:$<-.5&&($+=1);let ee=0;if(Math.abs($)>Math.abs(ne))ee=$>=0?1:3;else{ee=ne>=0?0:2;const Pe=[p[4]*u,p[5]*u,p[6]*u],Be=-Math.sin(Fn(ne>=0?m.getSouth():m.getNorth()))*ns;d.$.scaleAndAdd(I,I,Pe,Be)}const re=v[ee],de=v[(ee+1)%4],fe=new J1(re,de,I),_e=[ha(fe,0)||re[0],ha(fe,1)||re[1],ha(fe,2)||re[2]],De=Hd(o.zoom);if(De>0){const Pe=function({x:Ne,y:He,z:st},qe,ut,Ge,Qe){const ht=1/(1<<st);let $e=Ne*ht,xt=$e+ht,dt=He*ht,at=dt+ht,jt=0;const Bt=($e+xt)/2-Ge;return Bt>.5?jt=-1:Bt<-.5&&(jt=1),$e=(($e+jt)*qe-(Ge*=qe))*ut+Ge,xt=((xt+jt)*qe-Ge)*ut+Ge,dt=(dt*qe-(Qe*=qe))*ut+Qe,at=(at*qe-Qe)*ut+Qe,[[$e,at,0],[xt,at,0],[xt,dt,0],[$e,dt,0]]}(s,i,o._pixelsPerMercatorPixel,z,V);for(let Ne=0;Ne<v.length;Ne++)is(v[Ne],Pe[Ne],De);const Be=d.$.add([],Pe[ee],Pe[(ee+1)%4]);d.$.scale(Be,Be,.5),is(_e,Be,De)}for(const Pe of v)d.$.min(S,S,Pe),d.$.max(C,C,Pe);return S[2]=Math.min(re[2],de[2]),d.$.min(S,S,_e),d.$.max(C,C,_e),new Ui(S,C)}function eb({x:o,y:i,z:s},c=!1){const u=1/(1<<s),p=new zn(Ws(o*u),i===(1<<s)-1&&c?-90:$r((i+1)*u)),m=new zn(Ws((o+1)*u),0===i&&c?90:$r(i*u));return new Qa(p,m)}function jC(o,i=ns){const s=Fn(o.getNorth()),c=Fn(o.getSouth()),u=Math.cos(s),p=Math.cos(c),m=Math.sin(s),v=Math.sin(c),x=o.getWest(),C=o.getEast();return[zd(p,v,x,i),zd(p,v,C,i),zd(u,m,C,i),zd(u,m,x,i)]}function r0(o,i,s,c){const u=1<<s.z,p=(o/ft+s.x)/u;return Vd($r((i/ft+s.y)/u),Ws(p),c)}function tb({min:o,max:i}){return vc/Math.max(i[0]-o[0],i[1]-o[1],i[2]-o[2])}const pM=new Float64Array(16);function Og(o){const i=tb(o),s=d.ae.fromScaling(pM,[i,i,i]);return d.ae.translate(s,s,d.$.negate([],o.min))}function Gd(o){const i=d.ae.fromTranslation(pM,o.min),s=1/tb(o);return d.ae.scale(i,i,[s,s,s])}function wi(o){const i=ft/(2*Math.PI);return o/(2*Math.PI)/i}function nb(o,i){return ft/(512*Math.pow(2,o))*tb(El(i))}function Cc(o,i,s,c,u){const p=wi(s),m=[o,i,-s/(2*Math.PI)],v=d.ae.identity(new Float64Array(16));return d.ae.translate(v,v,m),d.ae.scale(v,v,[p,p,p]),d.ae.rotateX(v,v,Fn(-u)),d.ae.rotateY(v,v,Fn(-c)),v}function Hd(o){return Qf(Ky,Ap,o)}function $C(o,i){const s=Vd(i.lat,i.lng),c=function(p){const m=Vd(p._center.lat,p._center.lng),v=d.$.fromValues(0,1,0);let x=d.$.cross([],v,m);const C=d.ae.fromRotation([],-p.angle,m);x=d.$.transformMat4(x,x,C),d.ae.fromRotation(C,-p._pitch,x);const S=d.$.normalize([],m);return d.$.scale(S,S,K1(p.cameraToCenterDistance/p.pixelsPerMeter)),d.$.transformMat4(S,S,C),d.$.add([],m,S)}(o),u=d.$.subtract([],c,s);return d.$.angle(u,s)}function fn(o,i){return $C(o,i)>Math.PI/2*1.01}const GC=Fn(85),ib=Math.cos(GC),Pg=Math.sin(GC),mM=d.ae.create(),rb=o=>{const i=[];return"map"===o.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===o.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i};function ob(o,i,s,c,u,p,m,v,x){if(p&&o.queryGeometry.isAboveHorizon)return!1;p&&(x*=o.pixelToTileUnitsFactor);const C=o.tileID.canonical,S=s.projection.upVectorScale(C,s.center.lat,s.worldSize).metersToTile;for(const I of i)for(const A of I){const N=A.add(v),F=u&&s.elevation?s.elevation.exaggeration()*u.getElevationAt(N.x,N.y,!0):0,z=s.projection.projectTilePoint(N.x,N.y,C);if(F>0){const ee=s.projection.upVector(C,N.x,N.y);z.x+=ee[0]*S*F,z.y+=ee[1]*S*F,z.z+=ee[2]*S*F}const V=p?N:o0(z.x,z.y,z.z,c),$=p?o.tilespaceRays.map(ee=>gM(ee,F)):o.queryGeometry.screenGeometry,ne=d.aB.transformMat4([],[z.x,z.y,z.z,1],c);if(!m&&p?x*=ne[3]/s.cameraToCenterDistance:m&&!p&&(x*=s.cameraToCenterDistance/ne[3]),p){const ee=$r((A.y/ft+C.y)/(1<<C.z));x/=s.projection.pixelsPerMeter(ee,1)/ro(1,ee)}if(dM($,V,x))return!0}return!1}function o0(o,i,s,c){const u=d.aB.transformMat4([],[o,i,s,1],c);return new _t(u[0]/u[3],u[1]/u[3])}const Rg=d.$.fromValues(0,0,0),sb=d.$.fromValues(0,0,1);function gM(o,i){const s=d.$.create();return Rg[2]=i,o.intersectsPlane(Rg,sb,s),new _t(s[0],s[1])}class HC extends Np{}function qC(o,{width:i,height:s},c,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==i*s*c)throw new RangeError("mismatched image size")}else u=new Uint8Array(i*s*c);return o.width=i,o.height=s,o.data=u,o}function ab(o,i,s){const{width:c,height:u}=i;c===o.width&&u===o.height||(lb(o,i,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,u)},s,null),o.width=c,o.height=u,o.data=i.data)}function lb(o,i,s,c,u,p,m,v){if(0===u.width||0===u.height)return i;if(u.width>o.width||u.height>o.height||s.x>o.width-u.width||s.y>o.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>i.width||u.height>i.height||c.x>i.width-u.width||c.y>i.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const x=o.data,C=i.data,S=4===p&&v;for(let I=0;I<u.height;I++){const A=((s.y+I)*o.width+s.x)*p,N=((c.y+I)*i.width+c.x)*p;if(S)for(let F=0;F<u.width;F++){const z=A+F*p+3,V=N+F*p;C[V+0]=255,C[V+1]=255,C[V+2]=255,C[V+3]=x[z]}else if(m)for(let F=0;F<u.width;F++){const z=A+F*p,V=N+F*p,$=x[z+3],ne=new ni(x[z+0]/255*$,x[z+1]/255*$,x[z+2]/255*$,$).toRenderColor(m).toArray();C[V+0]=ne[0],C[V+1]=ne[1],C[V+2]=ne[2],C[V+3]=ne[3]}else for(let F=0;F<u.width*p;F++)C[N+F]=x[A+F]}return i}Ee(HC,"HeatmapBucket",{omit:["layers"]});class qd{constructor(i,s){qC(this,i,1,s)}resize(i){ab(this,new qd(i),1)}clone(){return new qd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,u,p){lb(i,s,c,u,p,1,null)}}class gr{constructor(i,s){qC(this,i,4,s)}resize(i){ab(this,new gr(i),4)}replace(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new gr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,u,p,m,v){lb(i,s,c,u,p,4,m,v)}}class s0{constructor(i,s){this.width=i.width,this.height=i.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}let cb,Ng,_M,yM;function oo(o){const i={},s=o.resolution||256,c=o.clips?o.clips.length:1,u=o.image||new gr({width:s,height:c}),p=(m,v,x)=>{i[o.evaluationKey]=x;const C=o.expression.evaluate(i);C&&(u.data[m+v+0]=Math.floor(255*C.r/C.a),u.data[m+v+1]=Math.floor(255*C.g/C.a),u.data[m+v+2]=Math.floor(255*C.b/C.a),u.data[m+v+3]=Math.floor(255*C.a))};if(o.clips)for(let m=0,v=0;m<c;++m,v+=4*s)for(let x=0,C=0;x<s;x++,C+=4){const S=x/(s-1),{start:I,end:A}=o.clips[m];p(v,C,I*(1-S)+A*S)}else for(let m=0,v=0;m<s;m++,v+=4)p(0,v,m/(s-1));return u}Ee(qd,"AlphaImage"),Ee(gr,"RGBAImage");const Lp=tn([{name:"a_pos",components:2,type:"Int16"}],4),{members:WC}=Lp;function Bp(o,i,s=2){const c=i&&i.length,u=c?i[0]*s:o.length;let p=ZC(o,0,u,s,!0);const m=[];if(!p||p.next===p.prev)return m;let v,x,C;if(c&&(p=function(S,I,A,N){const F=[];for(let z=0,V=I.length;z<V;z++){const $=ZC(S,I[z]*N,z<V-1?I[z+1]*N:S.length,N,!1);$===$.next&&($.steiner=!0),F.push(KC($))}F.sort(xM);for(let z=0;z<F.length;z++)A=wM(F[z],A);return A}(o,i,p,s)),o.length>80*s){v=1/0,x=1/0;let S=-1/0,I=-1/0;for(let A=s;A<u;A+=s){const N=o[A],F=o[A+1];N<v&&(v=N),F<x&&(x=F),N>S&&(S=N),F>I&&(I=F)}C=Math.max(S-v,I-x),C=0!==C?32767/C:0}return kg(p,m,s,v,x,C,0),m}function ZC(o,i,s,c,u){let p;if(u===function(m,v,x,C){let S=0;for(let I=v,A=x-C;I<x;I+=C)S+=(m[A]-m[I])*(m[I+1]+m[A+1]),A=I;return S}(o,i,s,c)>0)for(let m=i;m<s;m+=c)p=QC(m/c|0,o[m],o[m+1],p);else for(let m=s-c;m>=i;m-=c)p=QC(m/c|0,o[m],o[m+1],p);return p&&Fg(p,p.next)&&(zp(p),p=p.next),p}function Wd(o,i){if(!o)return o;i||(i=o);let s,c=o;do{if(s=!1,c.steiner||!Fg(c,c.next)&&0!==Mr(c.prev,c,c.next))c=c.next;else{if(zp(c),c=i=c.prev,c===c.next)break;s=!0}}while(s||c!==i);return i}function kg(o,i,s,c,u,p,m){if(!o)return;!m&&p&&function(x,C,S,I){let A=x;do{0===A.z&&(A.z=a0(A.x,A.y,C,S,I)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next}while(A!==x);A.prevZ.nextZ=null,A.prevZ=null,function(N){let F,z=1;do{let V,$=N;N=null;let ne=null;for(F=0;$;){F++;let ee=$,re=0;for(let fe=0;fe<z&&(re++,ee=ee.nextZ,ee);fe++);let de=z;for(;re>0||de>0&&ee;)0!==re&&(0===de||!ee||$.z<=ee.z)?(V=$,$=$.nextZ,re--):(V=ee,ee=ee.nextZ,de--),ne?ne.nextZ=V:N=V,V.prevZ=ne,ne=V;$=ee}ne.nextZ=null,z*=2}while(F>1)}(A)}(o,c,u,p);let v=o;for(;o.prev!==o.next;){const x=o.prev,C=o.next;if(p?vM(o,c,u,p):YC(o))i.push(x.i,o.i,C.i),zp(o),o=C.next,v=C.next;else if((o=C)===v){m?1===m?kg(o=XC(Wd(o),i),i,s,c,u,p,2):2===m&&bM(o,i,s,c,u,p):kg(Wd(o),i,s,c,u,p,1);break}}}function YC(o){const i=o.prev,s=o,c=o.next;if(Mr(i,s,c)>=0)return!1;const u=i.x,p=s.x,m=c.x,v=i.y,x=s.y,C=c.y,S=u<p?u<m?u:m:p<m?p:m,I=v<x?v<C?v:C:x<C?x:C,A=u>p?u>m?u:m:p>m?p:m,N=v>x?v>C?v:C:x>C?x:C;let F=c.next;for(;F!==i;){if(F.x>=S&&F.x<=A&&F.y>=I&&F.y<=N&&uf(u,v,p,x,m,C,F.x,F.y)&&Mr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function vM(o,i,s,c){const u=o.prev,p=o,m=o.next;if(Mr(u,p,m)>=0)return!1;const v=u.x,x=p.x,C=m.x,S=u.y,I=p.y,A=m.y,N=v<x?v<C?v:C:x<C?x:C,F=S<I?S<A?S:A:I<A?I:A,z=v>x?v>C?v:C:x>C?x:C,V=S>I?S>A?S:A:I>A?I:A,$=a0(N,F,i,s,c),ne=a0(z,V,i,s,c);let ee=o.prevZ,re=o.nextZ;for(;ee&&ee.z>=$&&re&&re.z<=ne;){if(ee.x>=N&&ee.x<=z&&ee.y>=F&&ee.y<=V&&ee!==u&&ee!==m&&uf(v,S,x,I,C,A,ee.x,ee.y)&&Mr(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,re.x>=N&&re.x<=z&&re.y>=F&&re.y<=V&&re!==u&&re!==m&&uf(v,S,x,I,C,A,re.x,re.y)&&Mr(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;ee&&ee.z>=$;){if(ee.x>=N&&ee.x<=z&&ee.y>=F&&ee.y<=V&&ee!==u&&ee!==m&&uf(v,S,x,I,C,A,ee.x,ee.y)&&Mr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;re&&re.z<=ne;){if(re.x>=N&&re.x<=z&&re.y>=F&&re.y<=V&&re!==u&&re!==m&&uf(v,S,x,I,C,A,re.x,re.y)&&Mr(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function XC(o,i){let s=o;do{const c=s.prev,u=s.next.next;!Fg(c,u)&&ub(c,s,s.next,u)&&Bg(c,u)&&Bg(u,c)&&(i.push(c.i,s.i,u.i),zp(s),zp(s.next),s=o=u),s=s.next}while(s!==o);return Wd(s)}function bM(o,i,s,c,u,p){let m=o;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&l0(m,v)){let x=JC(m,v);return m=Wd(m,m.next),x=Wd(x,x.next),kg(m,i,s,c,u,p,0),void kg(x,i,s,c,u,p,0)}v=v.next}m=m.next}while(m!==o)}function xM(o,i){return o.x-i.x}function wM(o,i){const s=function(u,p){let m=p;const v=u.x,x=u.y;let C,S=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const z=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(z<=v&&z>S&&(S=z,C=m.x<m.next.x?m:m.next,z===v))return C}m=m.next}while(m!==p);if(!C)return null;const I=C,A=C.x,N=C.y;let F=1/0;m=C;do{if(v>=m.x&&m.x>=A&&v!==m.x&&uf(x<N?v:S,x,A,N,x<N?S:v,x,m.x,m.y)){const z=Math.abs(x-m.y)/(v-m.x);Bg(m,u)&&(z<F||z===F&&(m.x>C.x||m.x===C.x&&CM(C,m)))&&(C=m,F=z)}m=m.next}while(m!==I);return C}(o,i);if(!s)return i;const c=JC(s,o);return Wd(c,c.next),Wd(s,s.next)}function CM(o,i){return Mr(o.prev,o,i.prev)<0&&Mr(i.next,o,o.next)<0}function a0(o,i,s,c,u){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*u|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-c)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function KC(o){let i=o,s=o;do{(i.x<s.x||i.x===s.x&&i.y<s.y)&&(s=i),i=i.next}while(i!==o);return s}function uf(o,i,s,c,u,p,m,v){return(u-m)*(i-v)>=(o-m)*(p-v)&&(o-m)*(c-v)>=(s-m)*(i-v)&&(s-m)*(p-v)>=(u-m)*(c-v)}function l0(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(s,c){let u=s;do{if(u.i!==s.i&&u.next.i!==s.i&&u.i!==c.i&&u.next.i!==c.i&&ub(u,u.next,s,c))return!0;u=u.next}while(u!==s);return!1}(o,i)&&(Bg(o,i)&&Bg(i,o)&&function(s,c){let u=s,p=!1;const m=(s.x+c.x)/2,v=(s.y+c.y)/2;do{u.y>v!=u.next.y>v&&u.next.y!==u.y&&m<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next}while(u!==s);return p}(o,i)&&(Mr(o.prev,o,i.prev)||Mr(o,i.prev,i))||Fg(o,i)&&Mr(o.prev,o,o.next)>0&&Mr(i.prev,i,i.next)>0)}function Mr(o,i,s){return(i.y-o.y)*(s.x-i.x)-(i.x-o.x)*(s.y-i.y)}function Fg(o,i){return o.x===i.x&&o.y===i.y}function ub(o,i,s,c){const u=c0(Mr(o,i,s)),p=c0(Mr(o,i,c)),m=c0(Mr(s,c,o)),v=c0(Mr(s,c,i));return u!==p&&m!==v||!(0!==u||!Lg(o,s,i))||!(0!==p||!Lg(o,c,i))||!(0!==m||!Lg(s,o,c))||!(0!==v||!Lg(s,i,c))}function Lg(o,i,s){return i.x<=Math.max(o.x,s.x)&&i.x>=Math.min(o.x,s.x)&&i.y<=Math.max(o.y,s.y)&&i.y>=Math.min(o.y,s.y)}function c0(o){return o>0?1:o<0?-1:0}function Bg(o,i){return Mr(o.prev,o,o.next)<0?Mr(o,i,o.next)>=0&&Mr(o,o.prev,i)>=0:Mr(o,i,o.prev)<0||Mr(o,o.next,i)<0}function JC(o,i){const s=eT(o.i,o.x,o.y),c=eT(i.i,i.x,i.y),u=o.next,p=i.prev;return o.next=i,i.prev=o,s.next=u,u.prev=s,c.next=s,s.prev=c,p.next=c,c.prev=p,c}function QC(o,i,s,c){const u=eT(o,i,s);return c?(u.next=c.next,u.prev=c,c.next.prev=u,c.next=u):(u.prev=u,u.next=u),u}function zp(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function eT(o,i,s){return{i:o,x:i,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function zg(o,i){const s=o.length;if(s<=1)return[o];const c=[];let u,p;for(let m=0;m<s;m++){const v=Gm(o[m]);0!==v&&(o[m].area=Math.abs(v),void 0===p&&(p=v<0),p===v<0?(u&&c.push(u),u=[o[m]]):u.push(o[m]))}if(u&&c.push(u),i>1)for(let m=0;m<c.length;m++)c[m].length<=i||(Xn(c[m],i,1,c[m].length-1,TM),c[m]=c[m].slice(0,i));return c}function TM(o,i){return i.area-o.area}function db(o,i,s){const c=s.patternDependencies;let u=!1;for(const p of i){const m=p.paint.get(`${o}-pattern`);m.isConstant()||(u=!0);const v=m.constantOr(null);v&&(u=!0,c[v]=!0)}return u}function tT(o,i,s,c,u){const p=u.patternDependencies;for(const m of i){const v=m.paint.get(`${o}-pattern`).value;if("constant"!==v.kind){let x=v.evaluate({zoom:c},s,{},u.availableImages);x=x&&x.name?x.name:x,p[x]=!0,s.patterns[m.id]=x}}return s}class u0{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $s,this.indexArray=new Xi,this.indexArray2=new Ka,this.programConfigurations=new ua(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new Ki,this.segments2=new Ki,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection}updateFootprints(i,s){}populate(i,s,c,u){this.hasPattern=db("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:x,index:C,sourceLayerIndex:S}of i){const I=this.layers[0]._featureFilter.needGeometry,A=xc(v,I);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),A,c))continue;const N=p?p.evaluate(A,{},c,s.availableImages):void 0,F={id:x,properties:v.properties,type:v.type,sourceLayerIndex:S,index:C,geometry:I?A.geometry:el(v,c,u),patterns:{},sortKey:N};m.push(F)}p&&m.sort((v,x)=>v.sortKey-x.sortKey);for(const v of m){const{geometry:x,index:C,sourceLayerIndex:S}=v;if(this.hasPattern){const I=tT("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(I)}else this.addFeature(v,x,C,c,{},s.availableImages,s.brightness);s.featureIndex.insert(i[C].feature,x,C,S,this.index)}}update(i,s,c,u,p){const m=0!==Object.keys(i).length;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(i,s,m?this.stateDependentLayers:this.layers,c,u,p)}addFeatures(i,s,c,u,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,WC),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,s,c,u,p,m=[],v){for(const x of zg(s,500)){let C=0;for(const z of x)C+=z.length;const S=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),I=S.vertexLength,A=[],N=[];for(const z of x){if(0===z.length)continue;z!==x[0]&&N.push(A.length/2);const V=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),$=V.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack($+z.length-1,$),A.push(z[0].x),A.push(z[0].y);for(let ne=1;ne<z.length;ne++)this.layoutVertexArray.emplaceBack(z[ne].x,z[ne].y),this.indexArray2.emplaceBack($+ne-1,$+ne),A.push(z[ne].x),A.push(z[ne].y);V.vertexLength+=z.length,V.primitiveLength+=z.length}const F=Bp(A,N);for(let z=0;z<F.length;z+=3)this.indexArray.emplaceBack(I+F[z],I+F[z+1],I+F[z+2]);S.vertexLength+=C,S.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,p,m,u,v)}}let hb,d0,nT,Cu;Ee(u0,"FillBucket",{omit:["layers","patternFeatures"]});class Zd{constructor(i,s,c,u){if(this.triangleCount=s.length/3,this.min=new _t(0,0),this.max=new _t(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===i.length)return;const[p,m]=[i[0].clone(),i[0].clone()];for(let I=1;I<i.length;++I){const A=i[I];p.x=Math.min(p.x,A.x),p.y=Math.min(p.y,A.y),m.x=Math.max(m.x,A.x),m.y=Math.max(m.y,A.y)}if(u){const I=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/u);c=Math.max(c,I)}if(0===c)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const x=Math.max(v.x,v.y)/c;this.cellsX=Math.max(1,Math.ceil(v.x/x)),this.cellsY=Math.max(1,Math.ceil(v.y/x)),this.xScale=1/x,this.yScale=1/x;const C=[];for(let I=0;I<this.triangleCount;I++){const A=i[s[3*I+0]].sub(this.min),N=i[s[3*I+1]].sub(this.min),F=i[s[3*I+2]].sub(this.min),z=Tc(Math.floor(Math.min(A.x,N.x,F.x)),this.xScale,this.cellsX),V=Tc(Math.floor(Math.max(A.x,N.x,F.x)),this.xScale,this.cellsX),$=Tc(Math.floor(Math.min(A.y,N.y,F.y)),this.yScale,this.cellsY),ne=Tc(Math.floor(Math.max(A.y,N.y,F.y)),this.yScale,this.cellsY),ee=new _t(0,0),re=new _t(0,0),de=new _t(0,0),fe=new _t(0,0);for(let _e=$;_e<=ne;++_e){ee.y=re.y=_e*x,de.y=fe.y=(_e+1)*x;for(let De=z;De<=V;++De)ee.x=de.x=De*x,re.x=fe.x=(De+1)*x,(W1(A,N,F,ee,re,fe)||W1(A,N,F,ee,fe,de))&&C.push({cellIdx:_e*this.cellsX+De,triIdx:I})}}if(0===C.length)return;C.sort((I,A)=>I.cellIdx-A.cellIdx||I.triIdx-A.triIdx);let S=0;for(;S<C.length;){const I=C[S].cellIdx,A={start:this.payload.length,len:0};for(;S<C.length&&C[S].cellIdx===I;)++A.len,this.payload.push(C[S++].triIdx);this.cells[I]=A}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,s){if(0===this.triangleCount||0===this.cells.length||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const c=Tc(i.x-this.min.x,this.xScale,this.cellsX),u=Tc(i.y-this.min.y,this.yScale,this.cellsY),p=this.cells[u*this.cellsX+c];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],x=Math.floor(v/8),C=1<<v%8;if(!(this.lookup[x]&C)&&(this.lookup[x]|=C,s.push(v),s.length===this.triangleCount))return}}}query(i,s,c){if(0===this.triangleCount||0===this.cells.length||i.x>this.max.x||this.min.x>s.x||i.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const u=Tc(i.x-this.min.x,this.xScale,this.cellsX),p=Tc(s.x-this.min.x,this.xScale,this.cellsX),m=Tc(i.y-this.min.y,this.yScale,this.cellsY),v=Tc(s.y-this.min.y,this.yScale,this.cellsY);for(let x=m;x<=v;x++)for(let C=u;C<=p;C++){const S=this.cells[x*this.cellsX+C];if(S)for(let I=0;I<S.len;I++){const A=this.payload[S.start+I],N=Math.floor(A/8),F=1<<A%8;if(!(this.lookup[N]&F)&&(this.lookup[N]|=F,c.push(A),c.length===this.triangleCount))return}}}}function Tc(o,i,s){return Math.max(0,Math.min(s-1,Math.floor(o*i)))}Ee(Zd,"TriangleGridIndex");class fb{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(i,s){for(const c of this.footprints)s.push({footprint:c,id:i})}populate(i,s,c,u){const p=[];for(const{feature:m,id:v,index:x,sourceLayerIndex:C}of i){const S=this.layers[0]._featureFilter.needGeometry,I=xc(m,S);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),I,c))continue;const A={id:v,properties:m.properties,type:m.type,sourceLayerIndex:C,index:x,geometry:S?I.geometry:el(m,c,u),patterns:{}};p.push(A)}for(const m of p){const{geometry:v,index:x,sourceLayerIndex:C}=m;this.addFeature(m,v,x,c,{},s.availableImages,s.brightness),s.featureIndex.insert(i[x].feature,v,x,C,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(i){}update(i,s,c,u,p){}destroy(){}addFeature(i,s,c,u,p,m=[],v){for(const x of zg(s,2)){const C=[],S=[],I=[],A=new _t(1/0,1/0),N=new _t(-1/0,-1/0);for(const V of x)if(0!==V.length){V!==x[0]&&I.push(S.length/2);for(let $=0;$<V.length;$++)S.push(V[$].x),S.push(V[$].y),C.push(V[$]),A.x=Math.min(A.x,V[$].x),A.y=Math.min(A.y,V[$].y),N.x=Math.max(N.x,V[$].x),N.y=Math.max(N.y,V[$].y)}const F=Bp(S,I),z=new Zd(C,F,8,256);this.footprints.push({vertices:C,indices:F,grid:z,min:A,max:N})}}}Ee(fb,"ClipBucket",{omit:["layers"]});const Yd=tn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),QO=tn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),eP=tn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),iT=tn([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),EM=tn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),DM=tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:tP}=Yd;var pb={},h0=Xf,rT=Xd;function Xd(o,i,s,c,u){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=u,o.readFields(mb,this,i)}function mb(o,i,s){1==o?i.id=s.readVarint():2==o?function(c,u){for(var p=c.readVarint()+c.pos;c.pos<p;){var m=u._keys[c.readVarint()],v=u._values[c.readVarint()];u.properties[m]=v}}(s,i):3==o?i.type=s.readVarint():4==o&&(i._geometry=s.pos)}function Vp(o){for(var i,s,c=0,u=0,p=o.length,m=p-1;u<p;m=u++)c+=((s=o[m]).x-(i=o[u]).x)*(i.y+s.y);return c}Xd.types=["Unknown","Point","LineString","Polygon"],Xd.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,s=o.readVarint()+o.pos,c=1,u=0,p=0,m=0,v=[];o.pos<s;){if(u<=0){var x=o.readVarint();c=7&x,u=x>>3}if(u--,1===c||2===c)p+=o.readSVarint(),m+=o.readSVarint(),1===c&&(i&&v.push(i),i=[]),i.push(new h0(p,m));else{if(7!==c)throw new Error("unknown command "+c);i&&i.push(i[0].clone())}}return i&&v.push(i),v},Xd.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,s=1,c=0,u=0,p=0,m=1/0,v=-1/0,x=1/0,C=-1/0;o.pos<i;){if(c<=0){var S=o.readVarint();s=7&S,c=S>>3}if(c--,1===s||2===s)(u+=o.readSVarint())<m&&(m=u),u>v&&(v=u),(p+=o.readSVarint())<x&&(x=p),p>C&&(C=p);else if(7!==s)throw new Error("unknown command "+s)}return[m,x,v,C]},Xd.prototype.toGeoJSON=function(o,i,s){var c,u,p=this.extent*Math.pow(2,s),m=this.extent*o,v=this.extent*i,x=this.loadGeometry(),C=Xd.types[this.type];function S(N){for(var F=0;F<N.length;F++){var z=N[F];N[F]=[360*(z.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(z.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(c=0;c<x.length;c++)I[c]=x[c][0];S(x=I);break;case 2:for(c=0;c<x.length;c++)S(x[c]);break;case 3:for(x=function(N){var F=N.length;if(F<=1)return[N];for(var z,V,$=[],ne=0;ne<F;ne++){var ee=Vp(N[ne]);0!==ee&&(void 0===V&&(V=ee<0),V===ee<0?(z&&$.push(z),z=[N[ne]]):z.push(N[ne]))}return z&&$.push(z),$}(x),c=0;c<x.length;c++)for(u=0;u<x[c].length;u++)S(x[c][u])}1===x.length?x=x[0]:C="Multi"+C;var A={type:"Feature",geometry:{type:C,coordinates:x},properties:this.properties};return"id"in this&&(A.id=this.id),A};var f0=rT,p0=Up;function Up(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(m0,this,i),this.length=this._features.length}function m0(o,i,s){15===o?i.version=s.readVarint():1===o?i.name=s.readString():5===o?i.extent=s.readVarint():2===o?i._features.push(s.pos):3===o?i._keys.push(s.readString()):4===o&&i._values.push(function(c){for(var u=null,p=c.readVarint()+c.pos;c.pos<p;){var m=c.readVarint()>>3;u=1===m?c.readString():2===m?c.readFloat():3===m?c.readDouble():4===m?c.readVarint64():5===m?c.readVarint():6===m?c.readSVarint():7===m?c.readBoolean():null}return u}(s))}Up.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new f0(this._pbf,i,this.extent,this._keys,this._values)};var jp=p0;function gb(o,i,s){if(3===o){var c=new jp(s,s.readVarint()+s.pos);c.length&&(i[c.name]=c)}}var $p=pb.VectorTile=function(o,i){this.layers=o.readFields(gb,{},i)},Kd=pb.VectorTileFeature=rT;pb.VectorTileLayer=p0;class Tu extends _t{constructor(i,s,c){super(i,s),this.z=c}}class SM extends Tu{constructor(i,s,c,u){super(i,s,c),this.w=u}}function Gp(o,i,s,c){const u=[],p=0===c?(m,v,x,C,S,I)=>{m.push(new _t(I,x+(I-v)/(C-v)*(S-x)))}:(m,v,x,C,S,I)=>{m.push(new _t(v+(I-x)/(S-x)*(C-v),I))};for(const m of o){const v=[];for(const x of m){if(x.length<=2)continue;const C=[];for(let A=0;A<x.length-1;A++){const N=x[A].x,F=x[A].y,z=x[A+1].x,V=x[A+1].y,$=0===c?N:F,ne=0===c?z:V;$<i?ne>i&&p(C,N,F,z,V,i):$>s?ne<s&&p(C,N,F,z,V,s):C.push(x[A]),ne<i&&$>=i&&p(C,N,F,z,V,i),ne>s&&$<=s&&p(C,N,F,z,V,s)}let S=x[x.length-1];const I=0===c?S.x:S.y;I>=i&&I<=s&&C.push(S),C.length&&(S=C[C.length-1],C[0].x===S.x&&C[0].y===S.y||C.push(C[0]),v.push(C))}v.length&&u.push(v)}return u}function Hp(o,i,s,c){const u="x"===s?"y":"x",p=(c-o[s])/(i[s]-o[s]);o[u]=o[u]+(i[u]-o[u])*p,o[s]=c,o.hasOwnProperty("z")&&(o.z=Yt(o.z,i.z,p)),o.hasOwnProperty("w")&&(o.w=Yt(o.w,i.w,p))}function oT(o,i,s,c){const u=s,p=c;for(const m of["x","y"]){let v=o,x=i;v[m]>=x[m]&&(v=i,x=o),v[m]<u&&x[m]>u&&Hp(v,x,m,u),v[m]<p&&x[m]>p&&Hp(x,v,m,p)}}const Vg=Number.MAX_SAFE_INTEGER;function sT(o,i,s,c){return o.order<i||o.order===Vg||!(o.clipMask&s)||(u=c,0!==(p=o.clipScope).length&&void 0===p.find(m=>m===u));var u,p}function g0(o,i){return o.x-i.x||o.y-i.y}function _0(o,i){return 0===g0(o.min,i.min)&&0===g0(o.max,i.max)}function y0(o,i){return!(o.min.x>i.max.x||o.max.x<i.min.x||o.min.y>i.max.y||o.max.y<i.min.y)}function _b(o,i){if(o.length!==i.length)return!1;for(let s=0;s<o.length;s++)if(o[s].sourceId!==i[s].sourceId||!_0(o[s],i[s])||o[s].order!==i[s].order||o[s].clipMask!==i[s].clipMask||!tu(o[s].clipScope,i[s].clipScope))return!1;return!0}function aT(o,i,s){const c=1/ft,u=1/(1<<s.canonical.z),p=(i.x*c+s.canonical.x)*u+s.wrap,m=(i.y*c+s.canonical.y)*u;return{min:new _t((o.x*c+s.canonical.x)*u+s.wrap,(o.y*c+s.canonical.y)*u),max:new _t(p,m)}}function Ug(o,i,s){const c=1<<s.canonical.z,u=((i.x-s.wrap)*c-s.canonical.x)*ft,p=(i.y*c-s.canonical.y)*ft;return{min:new _t(((o.x-s.wrap)*c-s.canonical.x)*ft,(o.y*c-s.canonical.y)*ft),max:new _t(u,p)}}function yb(o,i,s,c,u,p,m){const v=o.indices,x=o.vertices,C=[];for(let S=c;S<c+u;S+=3){const I=i[s[S+0]+p],A=i[s[S+1]+p],N=i[s[S+2]+p],F=Math.min(I.x,A.x,N.x),z=Math.max(I.x,A.x,N.x),V=Math.min(I.y,A.y,N.y),$=Math.max(I.y,A.y,N.y);C.length=0,o.grid.query(new _t(F,V),new _t(z,$),C);for(let ne=0;ne<C.length;ne++){const ee=C[ne];if(W1(x[v[3*ee+0]],x[v[3*ee+1]],x[v[3*ee+2]],I,A,N,m))return!0}}return!1}function v0(o,i,s,c){if(!o||!s)return!1;let u=o.vertices;if(!i.canonical.equals(c.canonical)||i.wrap!==c.wrap){if(s.vertices.length<o.vertices.length)return v0(s,c,o,i);const p=i.canonical,m=c.canonical,v=Math.pow(2,m.z-p.z);u=o.vertices.map(x=>new _t((x.x+p.x*ft)*v-m.x*ft,(x.y+p.y*ft)*v-m.y*ft))}return yb(s,u,o.indices,0,o.indices.length,0,0)}function lT(o,i,s,c){const u=Math.pow(2,c.z-s.z);return new _t((o+s.x*ft)*u-c.x*ft,(i+s.y*ft)*u-c.y*ft)}function MM(o,i){const s=[];i.footprint.grid.queryPoint(o,s);const c=i.footprint.indices,u=i.footprint.vertices;for(let p=0;p<s.length;p++){const m=s[p];if(wc([u[c[3*m+0]],u[c[3*m+1]],u[c[3*m+2]]],o))return!0}return!1}class IM{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,s){const c=this.toIdx(i,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,s){return this.leaves[this.toIdx(i,s)]}toIdx(i,s){return s*this.size+i}}function qp(o,i,s,c){let u=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(s[m]<o[m]||s[m]>i[m])return null}else{const v=1/c[m];let x=(o[m]-s[m])*v,C=(i[m]-s[m])*v;if(x>C){const S=x;x=C,C=S}if(x>u&&(u=x),C<p&&(p=C),u>p)return null}return u}function cT(o,i,s,c,u,p,m,v,x,C,S){const I=c-o,A=u-i,N=p-s,F=m-o,z=v-i,V=x-s,$=S[1]*V-S[2]*z,ne=S[2]*F-S[0]*V,ee=S[0]*z-S[1]*F,re=I*$+A*ne+N*ee;if(Math.abs(re)<1e-15)return null;const de=1/re,fe=C[0]-o,_e=C[1]-i,De=C[2]-s,Pe=(fe*$+_e*ne+De*ee)*de;if(Pe<0||Pe>1)return null;const Be=_e*N-De*A,Ne=De*I-fe*N,He=fe*A-_e*I,st=(S[0]*Be+S[1]*Ne+S[2]*He)*de;return st<0||Pe+st>1?null:(F*Be+z*Ne+V*He)*de}function jg(o,i,s){return(o-i)/(s-i)}function b0(o,i,s,c,u,p,m,v,x){const C=1<<s,S=p-c,I=m-u,A=(o+1)/C*S+c,N=(i+0)/C*I+u,F=(i+1)/C*I+u;v[0]=(o+0)/C*S+c,v[1]=N,x[0]=A,x[1]=F}class vb{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let x=Math.ceil(Math.pow(2,m));const C=1/x,S=(N,F,z,V,$)=>{const ne=V?1:0,ee=(N+1)*z-ne,re=F*z,de=(F+1)*z-ne;$[0]=N*z,$[1]=re,$[2]=ee,$[3]=de};let I=new IM(x);const A=[];for(let N=0;N<x*x;N++){S(N%x,Math.floor(N/x),C,!1,A);const F=Eu(A[0],A[1],p),z=Eu(A[2],A[1],p),V=Eu(A[2],A[3],p),$=Eu(A[0],A[3],p);I.minimums.push(Math.min(F,z,V,$)),I.maximums.push(Math.max(F,z,V,$)),I.leaves.push(1)}for(v.push(I),x/=2;x>=1;x/=2){const N=v[v.length-1];I=new IM(x);for(let F=0;F<x*x;F++){S(F%x,Math.floor(F/x),2,!0,A);const z=N.getElevation(A[0],A[1]),V=N.getElevation(A[2],A[1]),$=N.getElevation(A[2],A[3]),ne=N.getElevation(A[0],A[3]),ee=N.isLeaf(A[0],A[1]),re=N.isLeaf(A[2],A[1]),de=N.isLeaf(A[2],A[3]),fe=N.isLeaf(A[0],A[3]),_e=Math.min(z.min,V.min,$.min,ne.min),De=Math.max(z.max,V.max,$.max,ne.max),Pe=ee&&re&&de&&fe;I.maximums.push(De),I.minimums.push(_e),I.leaves.push(De-_e<=5&&Pe?1:0)}v.push(I)}return v}(this.dem),c=s.length-1,u=s[c];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(i,s,c,u,p,m,v=1){return qp([i,s,-100],[c,u,this.maximums[0]*v],p,m)}raycast(i,s,c,u,p,m,v=1){if(!this.nodeCount)return null;const x=this.raycastRoot(i,s,c,u,p,m,v);if(null==x)return null;const C=[],S=[],I=[],A=[],N=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:F,t:z,nodex:V,nodey:$,depth:ne}=N.pop();if(this.leaves[F]){b0(V,$,ne,i,s,c,u,I,A);const re=1<<ne,de=(V+0)/re,fe=(V+1)/re,_e=($+0)/re,De=($+1)/re,Pe=Eu(de,_e,this.dem)*v,Be=Eu(fe,_e,this.dem)*v,Ne=Eu(fe,De,this.dem)*v,He=Eu(de,De,this.dem)*v,st=cT(I[0],I[1],Pe,A[0],I[1],Be,A[0],A[1],Ne,p,m),qe=cT(A[0],A[1],Ne,I[0],A[1],He,I[0],I[1],Pe,p,m),ut=Math.min(null!==st?st:Number.MAX_VALUE,null!==qe?qe:Number.MAX_VALUE);if(ut!==Number.MAX_VALUE)return ut;{const Ge=d.$.scaleAndAdd([],p,m,z);if(uT(Pe,Be,He,Ne,jg(Ge[0],I[0],A[0]),jg(Ge[1],I[1],A[1]))>=Ge[2])return z}continue}let ee=0;for(let re=0;re<this._siblingOffset.length;re++){b0((V<<1)+this._siblingOffset[re][0],($<<1)+this._siblingOffset[re][1],ne+1,i,s,c,u,I,A),I[2]=-100,A[2]=this.maximums[this.childOffsets[F]+re]*v;const de=qp(I,A,p,m);if(null!=de){const fe=de;C[re]=fe;let _e=!1;for(let De=0;De<ee&&!_e;De++)fe>=C[S[De]]&&(S.splice(De,0,re),_e=!0);_e||(S[ee]=re),ee++}}for(let re=0;re<ee;re++){const de=S[re];N.push({idx:this.childOffsets[F]+de,t:C[de],nodex:(V<<1)+this._siblingOffset[de][0],nodey:($<<1)+this._siblingOffset[de][1],depth:ne+1})}}return null}_addNode(i,s,c){return this.minimums.push(i),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,s,c,u,p){if(1===i[u].isLeaf(s,c))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=u-1,v=i[m];let x=0,C=0;for(let S=0;S<this._siblingOffset.length;S++){const I=2*s+this._siblingOffset[S][0],A=2*c+this._siblingOffset[S][1],N=v.getElevation(I,A),F=v.isLeaf(I,A),z=this._addNode(N.min,N.max,F);F&&(x|=1<<S),C||(C=z)}for(let S=0;S<this._siblingOffset.length;S++)x&1<<S||this._construct(i,2*s+this._siblingOffset[S][0],2*c+this._siblingOffset[S][1],m,C+S)}}function uT(o,i,s,c,u,p){return Yt(Yt(o,s,p),Yt(i,c,p),u)}function Eu(o,i,s){const c=s.dim,u=Sn(o*c-.5,0,c-1),p=Sn(i*c-.5,0,c-1),m=Math.floor(u),v=Math.floor(p),x=Math.min(m+1,c-1),C=Math.min(v+1,c-1);return uT(s.get(m,v),s.get(x,v),s.get(m,C),s.get(x,C),u-m,p-v)}const bb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function dT(o,i,s){return(256*o*256+256*i+s)/10-1e4}function $g(o,i,s){return 256*o+i+s/256-32768}class Gg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,s,c,u=!1){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return fr(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const p=this.dim=s.height-2,m=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let x=0;x<p;x++)m[this._idx(-1,x)]=m[this._idx(0,x)],m[this._idx(p,x)]=m[this._idx(p-1,x)],m[this._idx(x,-1)]=m[this._idx(x,0)],m[this._idx(x,p)]=m[this._idx(x,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v="terrarium"===c?$g:dT;for(let x=0;x<m.length;++x){const C=4*x;this.floatView[x]=v(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=Mo.now()}_buildQuadTree(){this._tree=new vb(this)}get(i,s,c=!1){c&&(i=Sn(i,-1,this.dim),s=Sn(s,-1,this.dim));const u=this._idx(i,s);return this.floatView[u]}set(i,s,c){const u=this._idx(i,s),p=this.floatView[u];return this.floatView[u]=c,c-p}static getUnpackVector(i){return bb[i]}_idx(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)}static pack(i,s){const c=[0,0,0,0],u=Gg.getUnpackVector(s);let p=Math.floor((i+u[3])/u[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new s0({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,s,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let u=s*this.dim,p=s*this.dim+this.dim,m=c*this.dim,v=c*this.dim+this.dim;switch(s){case-1:u=p-1;break;case 1:p=u+1}switch(c){case-1:m=v-1;break;case 1:v=m+1}const x=-s*this.dim,C=-c*this.dim;for(let S=m;S<v;S++)for(let I=u;I<p;I++){const A=4*this._idx(I,S),N=4*this._idx(I+x,S+C);this.pixels[A+0]=i.pixels[N+0],this.pixels[A+1]=i.pixels[N+1],this.pixels[A+2]=i.pixels[N+2],this.pixels[A+3]=i.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ee(Gg,"DEMData"),Ee(vb,"DemMinMaxQuadTree",{omit:["dem"]});class Du{constructor(i,s,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(i,s,c){const u=c||i.findDEMTileFor(s);if(!u||!u.dem)return;const p=u.dem,m=u.tileID,v=1<<s.canonical.z-m.canonical.z;return new Du(u,p.dim/ft/v,[(s.canonical.x/v-m.canonical.x)*p.dim,(s.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(i,s){const c=s*this._scale+this._offset[1],u=Math.floor(i*this._scale+this._offset[0]),p=Math.floor(c);return new _t(u,p)}getElevationAt(i,s,c,u){const p=i*this._scale+this._offset[0],m=s*this._scale+this._offset[1],v=Math.floor(p),x=Math.floor(m),C=this._dem;return u=!!u,c?Yt(Yt(C.get(v,x,u),C.get(v,x+1,u),m-x),Yt(C.get(v+1,x,u),C.get(v+1,x+1,u),m-x),p-v):C.get(v,x,u)}getElevationAtPixel(i,s,c){return this._dem.get(i,s,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*ro(1,i)*this._dem.stride}}const xb={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},hT=Kd.types,fT=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],x0=["fill-extrusion-flood-light-ground-radius"],wb=Math.pow(2,13),pT=Math.pow(2,15)-1,Hg=new _t(0,1),Ec=2147483648;function Dc(o,i,s,c,u,p,m,v){o.emplaceBack((i<<1)+m,(s<<1)+p,(Math.floor(c*wb)<<1)+u,Math.round(v))}function qg(o,i,s,c){o.emplaceBack(i.x*ft,i.y*ft,s?0:1,c?1:0)}function w0(o,i,s,c,u,p){o.emplaceBack(i.x,i.y,(s.x<<1)+c,(s.y<<1)+u,p)}function C0(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class Wg{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class T0{constructor(){this.centroidXY=new _t(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new _t(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new _t(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new _t(this.max.x-this.min.x,this.max.y-this.min.y)}}class Cb{constructor(){this.acc=new _t(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,s){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=s.x,i.min.y=i.max.y=s.y)}appendEdge(i,s,c){this.accCount++,this.acc._add(s);let u=!!this.borders;s.x<i.min.x?(i.min.x=s.x,u=!0):s.x>i.max.x&&(i.max.x=s.x,u=!0),s.y<i.min.y?(i.min.y=s.y,u=!0):s.y>i.max.y&&(i.max.y=s.y,u=!0),((0===s.x||s.x===ft)&&s.x===c.x)!=((0===s.y||s.y===ft)&&s.y===c.y)&&this.processBorderOverlap(s,c),u&&this.checkBorderIntersection(s,c)}checkBorderIntersection(i,s){s.x<0!=i.x<0&&this.addBorderIntersection(0,Yt(s.y,i.y,(0-s.x)/(i.x-s.x))),s.x>ft!=i.x>ft&&this.addBorderIntersection(1,Yt(s.y,i.y,(ft-s.x)/(i.x-s.x))),s.y<0!=i.y<0&&this.addBorderIntersection(2,Yt(s.x,i.x,(0-s.y)/(i.y-s.y))),s.y>ft!=i.y>ft&&this.addBorderIntersection(3,Yt(s.x,i.x,(ft-s.y)/(i.y-s.y)))}addBorderIntersection(i,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(i,s){if(i.x===s.x){if(i.y===s.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,i.x)}}centroid(){return 0===this.accCount?new _t(0,0):new _t(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,s)=>i+ +(s[0]!==Number.MAX_VALUE),0):0}}function Tb(o,i){const s=o.add(i)._unit(),c=Sn(o.x*s.x+o.y*s.y,-1,1);var u,p,m;return u=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(u)))/4*pT*((p=o).x*(m=i).y-p.y*m.x<0?-1:1)}const mT=[o=>o.x<0,o=>o.x>ft,o=>o.y<0,o=>o.y>ft];function df(o,i,s,c){const u=[4];if(0===c)return u;s._mult(c);const p=o.sub(s),m=i.sub(s),v=[o,i,p,m];for(let x=0;x<4;x++)for(const C of v)if(mT[x](C)){u.push(x);break}return u}class gT{constructor(i){this.vertexArray=new nf,this.indexArray=new Xi,this.programConfigurations=new ua(i.layers,{zoom:i.zoom,lut:i.lut},s=>x0.includes(s)),this._segments=new Ki,this.hiddenByLandmarkVertexArray=new F1,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ki}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(i,s,c,u=!1){const p=i.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let x;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const C=i[0],S=i[1];x=Tb(C.sub(i[p-1])._perp()._unit(),S.sub(C)._perp()._unit())}for(let C=0;C<p;C++){const S=C===p-1?0:C+1,I=i[C],A=i[S],N=i[S===p-1?0:S+1],F=A.sub(I)._perp()._unit(),z=Tb(F,N.sub(A)._perp()._unit()),V=x,$=z;if(Ys(I,A,s)||u&&Dl(I,s)&&Dl(A,s)){x=z;continue}const ne=v.vertexLength;w0(this.vertexArray,I,A,1,1,V),w0(this.vertexArray,I,A,1,0,V),w0(this.vertexArray,I,A,0,1,$),w0(this.vertexArray,I,A,0,0,$),v.vertexLength+=4;const ee=df(I,A,F,c);for(const re of ee)this._segmentToGroundQuads[m].push({id:ne,region:re}),this._segmentToRegionTriCounts[m][re]+=2,v.primitiveLength+=2;x=z}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),s=i.length;for(let c=0;c<s;c++)this._segmentToGroundQuads[c].sort((u,p)=>u.region-p.region);for(let c=0;c<s;c++){const u=this._segmentToGroundQuads[c],p=i[c],m=this._segmentToRegionTriCounts[c];m.reduce((x,C)=>x+C,0);let v=0;for(let x=0;x<=4;x++){const C=m[x];if(0!==C){let S=this.regionSegments[x];S||(S=this.regionSegments[x]=new Ki);const I={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:C};S.get().push(I)}v+=C}for(let x=0;x<u.length;x++){const C=u[x].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,s,c,u,p,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,s,c,u,p,m)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,QO.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,s,c,u,p,m){this.hasData()&&this.programConfigurations.updatePaintArrays(i,s,c,u,p,m)}updateHiddenByLandmark(i){if(!this.hasData())return;const s=i.groundVertexCount+i.groundVertexArrayOffset;if(0===i.groundVertexCount)return;const c=i.flags&Ec?1:0;for(let u=i.groundVertexArrayOffset;u<s;++u)this.hiddenByLandmarkVertexArray.emplace(u,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,EM.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const s=this.regionSegments[i];s&&s.destroy()}}}}class E0{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Xi,this.footprintVertices=new $s,this.footprintSegments=[],this.layoutVertexArray=new vu,this.centroidVertexArray=new Ja,this.wallVertexArray=new qy,this.indexArray=new Xi,this.programConfigurations=new ua(i.layers,{zoom:i.zoom,lut:i.lut},s=>fT.includes(s)),this.segments=new Ki,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new gT(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(i,s){}populate(i,s,c,u){this.features=[],this.hasPattern=db("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Ia(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:p,id:m,index:v,sourceLayerIndex:x}of i){const C=this.layers[0]._featureFilter.needGeometry,S=xc(p,C);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),S,c))continue;const I={id:m,sourceLayerIndex:x,index:v,geometry:C?S.geometry:el(p,c,u),properties:p.properties,type:p.type,patterns:{}},A=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(tT("fill-extrusion",this.layers,I,this.zoom,s));else if(this.wallMode)for(const N of I.geometry)this.addFeature(I,[N],v,c,{},s.availableImages,u,s.brightness);else this.addFeature(I,I.geometry,v,c,{},s.availableImages,u,s.brightness);s.featureIndex.insert(p,I.geometry,v,x,this.index,A)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,s,c,u,p,m){for(const v of this.features){const{geometry:x}=v;if(this.wallMode)for(const C of x)this.addFeature(v,[C],v.index,s,c,u,p,m);else this.addFeature(v,x,v.index,s,c,u,p,m)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(i,s,c,u,p){const m=0!==Object.keys(i).length;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(i,s,v,c,u,p),this.groundEffect.update(i,s,v,c,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,tP),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,iT.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,DM.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,eP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,s,c,u,p,m,v,x){const C=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,S=[new _t(0,0),new _t(ft,ft)],I=v.projection,A="globe"===I.name,N=this.wallMode||"Polygon"===hT[i.type],F=new Cb;F.centroidDataIndex=this.centroidData.length;const z=new T0,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},u)<=0,$=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},u);let ne;if(z.height=$,z.vertexArrayOffset=this.layoutVertexArray.length,z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Gs),this.wallMode){if(A)return void fr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==s.length)return;ne=function(Be){const Ne=Be[0].x===Be[Be.length-1].x&&Be[0].y===Be[Be.length-1].y;(function(Bt){let Dt=0;const yt=Bt.length;for(let sn=0;sn<yt;sn++)Dt+=(Bt[(sn+1)%yt].x-Bt[sn].x)*(Bt[(sn+1)%yt].y+Bt[sn].y);return Dt>=0})(Be)||(Be=Be.reverse());const st={isPolygon:Ne,geometry:[],joinNormals:[]},qe=[],ut=[],Ge=[];let Qe=Be.length;if(Qe<(Ne?3:2))return st;for(;Qe>=2&&Be[Qe-1].equals(Be[Qe-2]);)Qe--;let ht,$e,xt,dt,at,jt=0;for(;jt<Qe-1&&Be[jt].equals(Be[jt+1]);)jt++;Ne&&(ht=Be[Qe-2],at=Be[jt].sub(ht)._unit()._perp());for(let Bt=jt;Bt<Qe;Bt++){if(xt=Bt===Qe-1?Ne?Be[jt+1]:void 0:Be[Bt+1],xt&&Be[Bt].equals(xt))continue;at&&(dt=at),ht&&($e=ht),ht=Be[Bt],at=xt?xt.sub(ht)._unit()._perp():dt,dt=dt||at;const Dt=dt.add(at);0===Dt.x&&0===Dt.y||Dt._unit();const yt=Dt.x*at.x+Dt.y*at.y,sn=0!==yt?1/yt:1/0,Vt=dt.x*at.y-dt.y*at.x>0;let Ot="miter";"miter"===Ot&&sn>2&&(Ot="bevel");const gn=(wn,bn,Dn,Ln)=>{const Nn=new _t(wn.x,wn.y),_i=new _t(wn.x,wn.y);Nn.x-=bn.x*Ln,Nn.y-=bn.y*Ln,_i.x-=bn.x*Math.max(Dn,1),_i.y-=bn.y*Math.max(Dn,1),Ge.push(bn),qe.push(Nn),ut.push(_i)};if("miter"===Ot)Dt._mult(sn),gn(ht,Dt,1,0);else{const wn=-Math.sqrt(sn*sn-1),bn=Vt?wn:0,Dn=Vt?0:wn;$e&&gn(ht,dt,bn,Dn),xt&&gn(ht,at,bn,Dn)}}return st.geometry=[...qe,...ut.reverse(),qe[0]],st.joinNormals=[...Ge,...Ge.reverse(),Ge[Ge.length-1]],st}(s[0]),s=[ne.geometry]}const ee=(Be,Ne)=>Be<(Ne.length-1)/2||Be===Ne.length-1,re=this.wallMode?[s]:zg(s,500);for(let Be=re.length-1;Be>=0;Be--){const Ne=re[Be];(0===Ne.length||(de=Ne[0]).every(He=>He.x<=0)||de.every(He=>He.x>=ft)||de.every(He=>He.y<=0)||de.every(He=>He.y>=ft))&&re.splice(Be,1)}var de;let fe;if(A)fe=wT(re,S,u);else{fe=[];for(const Be of re)fe.push({polygon:Be,bounds:S})}const _e=N?this.edgeRadius:0,De=_e>0&&this.zoom<17,Pe=(Be,Ne)=>{if(0===Be.length)return!1;const He=Be[Be.length-1];return Ne.x===He.x&&Ne.y===He.y};for(const{polygon:Be,bounds:Ne}of fe){let He=0,st=0;for(const Qe of Be)N&&!Qe[0].equals(Qe[Qe.length-1])&&Qe.push(Qe[0]),st+=N?Qe.length-1:Qe.length;const qe=this.segments.prepareSegment((N?5:4)*st,this.layoutVertexArray,this.indexArray);z.footprintSegIdx<0&&(z.footprintSegIdx=this.footprintSegments.length),z.polygonSegIdx<0&&(z.polygonSegIdx=this.polygonSegments.length);const ut={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ge=new Wg;if(Ge.vertexOffset=this.footprintVertices.length,Ge.indexOffset=3*this.footprintIndices.length,Ge.ringIndices=[],N){const Qe=[],ht=[];He=qe.vertexLength;for(let xt=0;xt<Be.length;xt++){const dt=Be[xt];dt.length&&0!==xt&&ht.push(Qe.length/2);const at=[];let jt,Bt;jt=dt[1].sub(dt[0])._perp()._unit(),Ge.ringIndices.push(dt.length-1);for(let Dt=1;Dt<dt.length;Dt++){const yt=dt[Dt],sn=dt[Dt===dt.length-1?1:Dt+1],Vt=yt.clone();if(_e){Bt=sn.sub(yt)._perp()._unit();const Ot=jt.add(Bt)._unit(),gn=_e*Math.min(4,1/(jt.x*Ot.x+jt.y*Ot.y));Vt.x+=gn*Ot.x,Vt.y+=gn*Ot.y,Vt.x=Math.round(Vt.x),Vt.y=Math.round(Vt.y),jt=Bt}if(!V||0!==_e&&!De||Pe(at,Vt)||at.push(Vt),Dc(this.layoutVertexArray,Vt.x,Vt.y,0,0,1,1,0),this.wallMode){const Ot=ee(Dt,dt);qg(this.wallVertexArray,ne.joinNormals[Dt],Ot,ne.isPolygon)}qe.vertexLength++,this.footprintVertices.emplaceBack(yt.x,yt.y),Qe.push(yt.x,yt.y),A&&C0(this.layoutVertexExtArray,I.projectTilePoint(Vt.x,Vt.y,u),I.upVector(u,Vt.x,Vt.y))}V&&(0===_e||De)&&(0!==at.length&&Pe(at,at[0])&&at.pop(),this.groundEffect.addData(at,Ne,C))}const $e=Bp(Qe,ht);for(let xt=0;xt<$e.length;xt+=3)this.footprintIndices.emplaceBack(Ge.vertexOffset+$e[xt+0],Ge.vertexOffset+$e[xt+1],Ge.vertexOffset+$e[xt+2]),this.indexArray.emplaceBack(He+$e[xt],He+$e[xt+2],He+$e[xt+1]),qe.primitiveLength++;Ge.indexCount+=$e.length,Ge.vertexCount+=this.footprintVertices.length-Ge.vertexOffset}for(let Qe=0;Qe<Be.length;Qe++){const ht=Be[Qe];F.startRing(z,ht[0]);let $e=ht.length>4&&vT(ht[ht.length-2],ht[0],ht[1]),xt=_e?AM(ht[ht.length-2],ht[0],ht[1],_e):0;const dt=[];let at,jt,Bt;jt=ht[1].sub(ht[0])._perp()._unit();let Dt=!0;for(let yt=1,sn=0;yt<ht.length;yt++){let Vt=ht[yt-1],Ot=ht[yt];const gn=ht[yt===ht.length-1?1:yt+1];if(F.appendEdge(z,Ot,Vt),Ys(Ot,Vt,Ne)){_e&&(jt=gn.sub(Ot)._perp()._unit(),Dt=!Dt);continue}const wn=Ot.sub(Vt)._perp(),bn=wn.x/(Math.abs(wn.x)+Math.abs(wn.y)),Dn=wn.y>0?1:0,Ln=Vt.dist(Ot);if(sn+Ln>32768&&(sn=0),_e){Bt=gn.sub(Ot)._perp()._unit();let _n=yT(Vt,Ot,gn,_T(jt,Bt),_e);isNaN(_n)&&(_n=0);const si=Ot.sub(Vt)._unit();Vt=Vt.add(si.mult(xt))._round(),Ot=Ot.add(si.mult(-_n))._round(),xt=_n,jt=Bt,V&&this.zoom>=17&&(Pe(dt,Vt)||dt.push(Vt),Pe(dt,Ot)||dt.push(Ot))}const Nn=qe.vertexLength,_i=ht.length>4&&vT(Vt,Ot,gn);let yi=bT(sn,$e,Dt);if(Dc(this.layoutVertexArray,Vt.x,Vt.y,bn,Dn,0,0,yi),Dc(this.layoutVertexArray,Vt.x,Vt.y,bn,Dn,0,1,yi),this.wallMode){const _n=ee(yt-1,ht),si=ne.joinNormals[yt-1];qg(this.wallVertexArray,si,!_n,ne.isPolygon),qg(this.wallVertexArray,si,!_n,ne.isPolygon)}if(sn+=Ln,yi=bT(sn,_i,!Dt),$e=_i,Dc(this.layoutVertexArray,Ot.x,Ot.y,bn,Dn,0,0,yi),Dc(this.layoutVertexArray,Ot.x,Ot.y,bn,Dn,0,1,yi),this.wallMode){const _n=ee(yt,ht),si=ne.joinNormals[yt];qg(this.wallVertexArray,si,!_n,ne.isPolygon),qg(this.wallVertexArray,si,!_n,ne.isPolygon)}if(qe.vertexLength+=4,this.indexArray.emplaceBack(Nn+0,Nn+1,Nn+2),this.indexArray.emplaceBack(Nn+1,Nn+3,Nn+2),qe.primitiveLength+=2,_e){const _n=He+(1===yt?ht.length-2:yt-2),si=1===yt?He:_n+1;if(this.indexArray.emplaceBack(Nn+1,_n,Nn+3),this.indexArray.emplaceBack(_n,si,Nn+3),qe.primitiveLength+=2,void 0===at&&(at=Nn),!Ys(gn,ht[yt],Ne)){const ci=yt===ht.length-1?at:qe.vertexLength;this.indexArray.emplaceBack(Nn+2,Nn+3,ci),this.indexArray.emplaceBack(Nn+3,ci+1,ci),this.indexArray.emplaceBack(Nn+3,si,ci+1),qe.primitiveLength+=3}Dt=!Dt}if(A){const _n=this.layoutVertexExtArray,si=I.projectTilePoint(Vt.x,Vt.y,u),ci=I.projectTilePoint(Ot.x,Ot.y,u),Ri=I.upVector(u,Vt.x,Vt.y),cr=I.upVector(u,Ot.x,Ot.y);C0(_n,si,Ri),C0(_n,si,Ri),C0(_n,ci,cr),C0(_n,ci,cr)}}N&&(He+=ht.length-1),V&&_e&&this.zoom>=17&&(0!==dt.length&&Pe(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,Ne,C,_e>0))}this.footprintSegments.push(Ge),ut.triangleCount=this.indexArray.length-ut.triangleArrayOffset,this.polygonSegments.push(ut),++z.footprintSegLen,++z.polygonSegLen}if(z.vertexCount=this.layoutVertexArray.length-z.vertexArrayOffset,z.groundVertexCount=this.groundEffect.vertexArray.length-z.groundVertexArrayOffset,0!==z.vertexCount){if(z.centroidXY=F.borders?Hg:this.encodeCentroid(F,z),this.centroidData.push(z),F.borders){this.featuresOnBorder.push(F);const Be=this.featuresOnBorder.length-1;for(let Ne=0;Ne<F.borders.length;Ne++)F.borders[Ne][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ne].push(Be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,p,m,u,x),this.groundEffect.addPaintPropertiesData(i,c,p,m,u,x),this.maxHeight=Math.max(this.maxHeight,$)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((s,c)=>this.featuresOnBorder[s].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}splitToSubtiles(){const i=[];for(let v=0;v<this.centroidData.length;v++){const x=this.centroidData[v],C=+(x.min.y+x.max.y>ft),S=2*C+(+(x.min.x+x.max.x>ft)^C);for(let I=0;I<x.polygonSegLen;I++){const A=x.polygonSegIdx+I;i.push({centroidIdx:v,subtile:S,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const s=new Xi;i.sort((v,x)=>v.triangleSegmentIdx===x.triangleSegmentIdx?v.subtile-x.subtile:v.triangleSegmentIdx-x.triangleSegmentIdx);let c=0,u=0,p=0;for(const v of i){if(v.triangleSegmentIdx!==c)break;p++}const m=i.length;for(;u!==i.length;){c=i[u].triangleSegmentIdx;let v=0,x=u,C=u;for(let S=x;S<p&&i[S].subtile===v;S++)C++;for(;x!==p;){const S=i[x];v=S.subtile;const I=this.centroidData[S.centroidIdx].min.clone(),A=this.centroidData[S.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let F=x;F<C;F++){const z=i[F],V=this.polygonSegments[z.polygonSegmentIdx],$=this.centroidData[z.centroidIdx].min,ne=this.centroidData[z.centroidIdx].max,ee=this.indexArray.uint16;for(let re=V.triangleArrayOffset;re<V.triangleArrayOffset+V.triangleCount;re++)s.emplaceBack(ee[3*re],ee[3*re+1],ee[3*re+2]);N.primitiveLength+=V.triangleCount,I.x=Math.min(I.x,$.x),I.y=Math.min(I.y,$.y),A.x=Math.max(A.x,ne.x),A.y=Math.max(A.y,ne.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:I,max:A}),x=C;for(let F=x;F<p&&i[F].subtile===i[x].subtile;F++)C++}u=p;for(let S=u;S<m&&i[S].triangleSegmentIdx===i[u].triangleSegmentIdx;S++)p++}s._trim(),this.indexArray=s}getVisibleSegments(i,s,c){const u=new Ki;if(this.wallMode){for(const z of this.triangleSubSegments)u.segments.push(z.segment);return u}let p=0,m=0;const v=1<<i.canonical.z;if(s){const z=s.getMinMaxForTile(i);z&&(p=z.min,m=z.max)}m+=this.maxHeight;const x=i.toUnwrapped();let C;const S=[x.canonical.x/v+x.wrap,x.canonical.y/v],I=[(x.canonical.x+1)/v+x.wrap,(x.canonical.y+1)/v],A=(z,V,$)=>[z[0]*(1-$[0])+V[0]*$[0],z[1]*(1-$[1])+V[1]*$[1]],N=[],F=[];for(const z of this.triangleSubSegments){N[0]=z.min.x/ft,N[1]=z.min.y/ft,F[0]=z.max.x/ft,F[1]=z.max.y/ft;const V=A(S,I,N),$=A(S,I,F);if(0===new Ui([V[0],V[1],p],[$[0],$[1],m]).intersectsPrecise(c)){C&&(u.segments.push(C),C=void 0);continue}const ne=z.segment;C&&C.vertexOffset!==ne.vertexOffset&&(u.segments.push(C),C=void 0),C?(C.vertexLength+=ne.vertexLength,C.primitiveLength+=ne.primitiveLength):C={vertexOffset:ne.vertexOffset,primitiveLength:ne.primitiveLength,vertexLength:ne.vertexLength,primitiveOffset:ne.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&u.segments.push(C),u}encodeCentroid(i,s){const c=i.centroid(),u=s.span(),p=Math.min(7,Math.round(u.x*this.tileToMeter/10)),m=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new _t(Sn(c.x,1,ft-1)<<3|p,Sn(c.y,1,ft-1)<<3|m)}encodeBorderCentroid(i){if(!i.borders)return new _t(0,0);const s=i.borders,c=Number.MAX_VALUE;if(s[0][0]!==c||s[1][0]!==c){const u=s[0][0]!==c?0:1;return new _t(6|(s[0][0]!==c?0:65528),(s[u][0]+s[u][1])/2<<3|6)}{const u=s[2][0]!==c?2:3;return new _t((s[u][0]+s[u][1])/2<<3|6,6|(s[2][0]!==c?0:65528))}}showCentroid(i){const s=this.centroidData[i.centroidDataIndex];s.flags&=Ec,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const s=i.vertexArrayOffset,c=i.vertexCount+i.vertexArrayOffset,u=i.flags&Ec?Hg:i.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==u.y||p!==u.x){for(let m=s;m<c;++m)this.centroidVertexArray.emplace(m,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,s,c){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(i.toUnwrapped());if(_b(this.activeReplacements,u))return;if(this.activeReplacements=u,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<c)continue;const v=Math.pow(2,m.footprintTileId.canonical.z-i.canonical.z);for(const x of this.centroidData)if(!(x.flags&Ec||m.min.x>x.max.x||x.min.x>m.max.x||m.min.y>x.max.y||x.min.y>m.max.y))for(let C=0;C<x.footprintSegLen;C++){const S=this.footprintSegments[x.footprintSegIdx+C];if(p.length=0,OM(this.footprintVertices,S.vertexOffset,S.vertexCount,m.footprintTileId.canonical,i.canonical,p),yb(m.footprint,p,this.footprintIndices.uint16,S.indexOffset,S.indexCount,-S.vertexOffset,-v)){x.flags|=Ec;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,s,c){let u=!1;for(let p=0;p<c.footprintSegLen;p++){const m=this.footprintSegments[c.footprintSegIdx+p];let v=0;for(const x of m.ringIndices){for(let C=v,S=x+v-1;C<x+v;S=C++){const I=this.footprintVertices.int16[2*(C+m.vertexOffset)+0],A=this.footprintVertices.int16[2*(C+m.vertexOffset)+1],N=this.footprintVertices.int16[2*(S+m.vertexOffset)+1];A>s!=N>s&&i<(this.footprintVertices.int16[2*(S+m.vertexOffset)+0]-I)*(s-A)/(N-A)+I&&(u=!u)}v=x}}return u}getHeightAtTileCoord(i,s){let c=Number.NEGATIVE_INFINITY,u=!0;const p=4*(i+ft)*ft+(s+ft);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&Ec)}:void 0}for(const m of this.centroidData)i>m.max.x||m.min.x>i||s>m.max.y||m.min.y>s||this.footprintContainsPoint(i,s,m)&&m&&m.height>c&&(c=m.height,this.partLookup[p]=m,u=!!(m.flags&Ec));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:u};this.partLookup[p]=void 0}}function _T(o,i){const s=o.add(i)._unit();return o.x*s.x+o.y*s.y}function AM(o,i,s,c){const u=i.sub(o)._perp()._unit(),p=s.sub(i)._perp()._unit();return yT(o,i,s,_T(u,p),c)}function yT(o,i,s,c,u){const p=Math.sqrt(1-c*c);return Math.min(o.dist(i)/3,i.dist(s)/3,u*p/c)}function Ys(o,i,s){return o.x<s[0].x&&i.x<s[0].x||o.x>s[1].x&&i.x>s[1].x||o.y<s[0].y&&i.y<s[0].y||o.y>s[1].y&&i.y>s[1].y}function Dl(o,i){return o.x<i[0].x||o.x>i[1].x||o.y<i[0].y||o.y>i[1].y}function vT(o,i,s){if(o.x<0||o.x>=ft||i.x<0||i.x>=ft||s.x<0||s.x>=ft)return!1;const c=s.sub(i),u=c.perp(),p=o.sub(i);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function bT(o,i,s){const c=i?2|o:-3&o;return s?1|c:-2&c}function xT(){const o=Math.PI/32,i=Math.tan(o),s=af;return s*Math.sqrt(1+2*i*i)-s}function wT(o,i,s){const c=1<<s.z,u=Ws(s.x/c),p=Ws((s.x+1)/c),m=$r(s.y/c),v=$r((s.y+1)/c);return function(x,C,S,I,A=0,N){const F=[];if(!x.length||!S||!I)return F;const z=(fe,_e)=>{for(const De of fe)F.push({polygon:De,bounds:_e})},V=Math.ceil(Math.log2(S)),$=Math.ceil(Math.log2(I)),ne=V-$,ee=[];for(let fe=0;fe<Math.abs(ne);fe++)ee.push(ne>0?0:1);for(let fe=0;fe<Math.min(V,$);fe++)ee.push(0),ee.push(1);let re=x;if(re=Gp(re,C[0].y-A,C[1].y+A,1),re=Gp(re,C[0].x-A,C[1].x+A,0),!re.length)return F;const de=[];for(ee.length?de.push({polygons:re,bounds:C,depth:0}):z(re,C);de.length;){const fe=de.pop(),_e=fe.depth,De=ee[_e],Pe=fe.bounds[0],Be=fe.bounds[1],Ne=0===De?Pe.x:Pe.y,He=0===De?Be.x:Be.y,st=N?N(De,Ne,He):.5*(Ne+He),qe=Gp(fe.polygons,Ne-A,st+A,De),ut=Gp(fe.polygons,st-A,He+A,De);if(qe.length){const Ge=[Pe,new _t(0===De?st:Be.x,1===De?st:Be.y)];ee.length>_e+1?de.push({polygons:qe,bounds:Ge,depth:_e+1}):z(qe,Ge)}if(ut.length){const Ge=[new _t(0===De?st:Pe.x,1===De?st:Pe.y),Be];ee.length>_e+1?de.push({polygons:ut,bounds:Ge,depth:_e+1}):z(ut,Ge)}}return F}(o,i,Math.ceil((p-u)/11.25),Math.ceil((m-v)/11.25),1,(x,C,S)=>{if(0===x)return.5*(C+S);{const I=$r((s.y+C/ft)/c);return(bc(.5*($r((s.y+S/ft)/c)+I))*c-s.y)*ft}})}function OM(o,i,s,c,u,p){const m=Math.pow(2,c.z-u.z);for(let v=0;v<s;v++){let x=o.int16[2*(v+i)+0],C=o.int16[2*(v+i)+1];x=(x+u.x*ft)*m-c.x*ft,C=(C+u.y*ft)*m-c.y*ft,p.push(new _t(x,C))}}let CT,Eb;function Zg(o,i){return o.x*i.x+o.y*i.y}function TT(o,i){if(1===o.length){let s=0;const c=i[s++];let u;for(;!u||c.equals(u);)if(u=i[s++],!u)return 1/0;for(;s<i.length;s++){const p=i[s],m=o[0],v=u.sub(c),x=p.sub(c),C=m.sub(c),S=Zg(v,v),I=Zg(v,x),A=Zg(x,x),N=Zg(C,v),F=Zg(C,x),z=S*A-I*I,V=(A*N-I*F)/z,$=(S*F-I*N)/z,ne=c.z*(1-V-$)+u.z*V+p.z*$;if(isFinite(ne))return ne}return 1/0}{let s=1/0;for(const c of i)s=Math.min(s,c.z);return s}}function ET(o,i,s,c,u,p,m,v){const x=m*u.getElevationAt(o,i,!0,!0),C=0!==p[0],S=C?0===p[1]?m*(p[0]/7-450):m*function(I,A,N){const F=Math.floor(A[0]/8),z=Math.floor(A[1]/8),V=10*(A[0]-8*F),$=10*(A[1]-8*z),ne=I.getElevationAt(F,z,!0,!0),ee=I.getMeterToDEM(N),re=Math.floor(.5*(V*ee-1)),de=Math.floor(.5*($*ee-1)),fe=I.tileCoordToPixel(F,z),_e=2*re+1,De=2*de+1,Pe=(ht=_e,$e=De,[(ut=I).getElevationAtPixel(Ge=fe.x-re,Qe=fe.y-de,!0),ut.getElevationAtPixel(Ge+$e,Qe,!0),ut.getElevationAtPixel(Ge,Qe+$e,!0),ut.getElevationAtPixel(Ge+ht,Qe+$e,!0)]),Be=Math.abs(Pe[0]-Pe[1]),Ne=Math.abs(Pe[2]-Pe[3]),He=Math.abs(Pe[0]-Pe[2])+Math.abs(Pe[1]-Pe[3]),st=Math.min(.25,.5*ee*(Be+Ne)/_e),qe=Math.min(.25,.5*ee*He/De);var ut,Ge,Qe,ht,$e;return ne+Math.max(st*V,qe*$)}(u,p,v):x;return{base:x+(0===s)?-1:s,top:C?Math.max(S+c,x+s+2):x+c}}Ee(E0,"FillExtrusionBucket",{omit:["layers","features"]}),Ee(T0,"PartData"),Ee(Wg,"FootprintSegment"),Ee(Cb,"BorderCentroidData"),Ee(gT,"GroundEffect");const PM=tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:D0}=PM,Su=tn([{name:"a_packed",components:4,type:"Float32"}]),{members:Yg}=Su,DT=tn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:ST}=DT,MT=tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nP=tn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),iP=tn([{name:"a_projected_pos",components:4,type:"Float32"}],4);tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const RM=tn([{name:"a_z_offset",components:1,type:"Float32"}],4),Db=tn([{name:"a_texb",components:2,type:"Uint16"}]),Sb=tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),rP=tn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const NM=tn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),IT=tn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);tn([{name:"triangle",components:3,type:"Uint16"}]),tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),tn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),tn([{type:"Float32",name:"offsetX"}]),tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class AT{constructor(i,s){this.width=i,this.height=s,this.nextRow=0,this.image=new qd({width:i,height:s}),this.positions={},this.uploaded=!1}getDash(i,s){const c=this.getKey(i,s);return this.positions[c]}trim(){const i=this.width,s=this.height=Xl(this.nextRow);this.image.resize({width:i,height:s})}getKey(i,s){return i.join(",")+s}getDashRanges(i,s,c){const u=[];let p=i.length%2==1?-i[i.length-1]*c:0,m=i[0]*c,v=!0;u.push({left:p,right:m,isDash:v,zeroLength:0===i[0]});let x=i[0];for(let C=1;C<i.length;C++){v=!v;const S=i[C];p=x*c,x+=S,m=x*c,u.push({left:p,right:m,isDash:v,zeroLength:0===S})}return u}addRoundDash(i,s,c){const u=s/2;for(let p=-c;p<=c;p++){const m=this.width*(this.nextRow+c+p);let v=0,x=i[v];for(let C=0;C<this.width;C++){C/x.right>1&&(x=i[++v]);const S=Math.abs(C-x.left),I=Math.abs(C-x.right),A=Math.min(S,I);let N;const F=p/c*(u+1);if(x.isDash){const z=u-Math.abs(F);N=Math.sqrt(A*A+z*z)}else N=u-Math.sqrt(A*A+F*F);this.image.data[m+C]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(i,s){for(let x=i.length-1;x>=0;--x){const C=i[x],S=i[x+1];C.zeroLength?i.splice(x,1):S&&S.isDash===C.isDash&&(S.left=C.left,i.splice(x,1))}const c=i[0],u=i[i.length-1];c.isDash===u.isDash&&(c.left=u.left-this.width,u.right=c.right+this.width);const p=this.width*this.nextRow;let m=0,v=i[m];for(let x=0;x<this.width;x++){x/v.right>1&&(v=i[++m]);const C=Math.abs(x-v.left),S=Math.abs(x-v.right),I=Math.min(C,S);this.image.data[p+x]=Math.max(0,Math.min(255,(v.isDash?I:-I)+s+128))}}addDash(i,s){const c=this.getKey(i,s);if(this.positions[c])return this.positions[c];const u="round"===s,p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return fr("LineAtlas out of space"),null;0===i.length&&i.push(1);let v=0;for(let S=0;S<i.length;S++)i[S]<0&&(fr("Negative value is found in line dasharray, replacing values with 0"),i[S]=0),v+=i[S];if(0!==v){const S=this.width/v,I=this.getDashRanges(i,this.width,S);u?this.addRoundDash(I,S,p):this.addRegularDash(I,"square"===s?.5*S:0)}const x=this.nextRow+p;this.nextRow+=m;const C={tl:[x,p],br:[v,0]};return this.positions[c]=C,C}}Ee(AT,"LineAtlas");const kM=Kd.types,FM=Math.cos(Math.PI/180*37.5),LM=Math.cos(Math.PI/180*5);class S0{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new bu,this.layoutVertexArray2=new io,this.patternVertexArray=new Nd,this.indexArray=new Xi,this.programConfigurations=new ua(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new Ki,this.maxLineLength=0,this.zOffsetVertexArray=new kd,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:ft/64}updateFootprints(i,s){}populate(i,s,c,u){this.hasPattern=db("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);const v=[];for(const{feature:I,id:A,index:N,sourceLayerIndex:F}of i){const z=this.layers[0]._featureFilter.needGeometry,V=xc(I,z);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),V,c))continue;const $=p?p.evaluate(V,{},c):void 0,ne={id:A,properties:I.properties,type:I.type,sourceLayerIndex:F,index:N,geometry:z?V.geometry:el(I,c,u),patterns:{},sortKey:$};v.push(ne)}p&&v.sort((I,A)=>I.sortKey-A.sortKey);const{lineAtlas:x,featureIndex:C}=s,S=this.addConstantDashes(x);for(const I of v){const{geometry:A,index:N,sourceLayerIndex:F}=I;if(S&&this.addFeatureDashes(I,x),this.hasPattern){const z=tT("line",this.layers,I,this.zoom,s);this.patternFeatures.push(z)}else this.addFeature(I,A,N,c,x.positions,s.availableImages,s.brightness);C.insert(i[N].feature,A,N,F,this.index)}}addConstantDashes(i){let s=!1;for(const c of this.layers){const u=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==p.kind)s=!0;else{const m=p.value,v=u.value;if(!v)continue;i.addDash(v,m)}}return s}addFeatureDashes(i,s){const c=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===m.kind)continue;let v,x;if("constant"===p.kind){if(v=p.value,!v)continue}else v=p.evaluate({zoom:c},i);x="constant"===m.kind?m.value:m.evaluate({zoom:c},i),s.addDash(v,x),i.patterns[u.id]=s.getKey(v,x)}}update(i,s,c,u,p){const m=0!==Object.keys(i).length;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(i,s,m?this.stateDependentLayers:this.layers,c,u,p)}addFeatures(i,s,c,u,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,u,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Yg)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,ST)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,RM.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,D0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,s,c,u,p,m,v){const x=this.layers[0].layout,C=x.get("line-join").evaluate(i,{}),S=x.get("line-cap").evaluate(i,{}),I=x.get("line-miter-limit"),A=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const N of s)this.addLine(N,i,u,C,S,I,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,p,m,u,v)}addLine(i,s,c,u,p,m,v){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const x={zoom:this.zoom,lineProgress:void 0},C=this.layers[0].layout,S="none"===u;if(this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let fe=0;fe<i.length-1;fe++)this.totalDistance+=i[fe].dist(i[fe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I="Polygon"===kM[s.type];let A=i.length;for(;A>=2&&i[A-1].equals(i[A-2]);)A--;let N=0;for(;N<A-1&&i[N].equals(i[N+1]);)N++;if(A<(I?3:2))return;"bevel"===u&&(m=1.05);const F=this.overscaling<=16?15*ft/(512*this.overscaling):0,z=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let V,$,ne,ee,re,de;this.e1=this.e2=-1,I&&(V=i[A-2],re=i[N].sub(V)._unit()._perp());for(let fe=N;fe<A;fe++){if(ne=fe===A-1?I?i[N+1]:void 0:i[fe+1],ne&&i[fe].equals(ne))continue;if(re&&(ee=re),V&&($=V),V=i[fe],this.hasZOffset){const Ge=C.get("line-z-offset").value;if("constant"===Ge.kind)de=Ge.value;else{if(this.lineClips){const Qe=this.totalDistance/(this.lineClips.end-this.lineClips.start);x.lineProgress=(Qe*this.lineClips.start+this.distance+($?$.dist(V):0))/Qe}else fr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),x.lineProgress=0;de=Ge.evaluate(x,s)}de=de||0}re=ne?ne.sub(V)._unit()._perp():ee,ee=ee||re;const _e=$&&ne;let De=_e?u:I||S?"butt":p;const Pe=ee.x*re.x+ee.y*re.y;if(S){const Ge=function(Qe){if(Qe.patternJoinNone){const ht=Qe.segmentPoints.length/2,$e=Qe.lineSoFar-Qe.segmentStart;for(let xt=0;xt<ht;++xt){const dt=Qe.segmentPoints[2*xt+1],at=Math.round(Qe.segmentPoints[2*xt])+.5+.25*dt;Qe.patternVertexArray.emplaceBack(at,$e,Qe.segmentStart),Qe.patternVertexArray.emplaceBack(at,$e,Qe.segmentStart)}Qe.segmentPoints.length=0}Qe.e1=Qe.e2=-1};if(_e&&Pe<LM){this.updateDistance($,V),this.addCurrentVertex(V,ee,1,1,z,de),Ge(this),this.addCurrentVertex(V,re,-1,-1,z,de);continue}if($){if(!ne){this.updateDistance($,V),this.addCurrentVertex(V,ee,1,1,z,de),Ge(this);continue}De="miter"}}let Be=ee.add(re);0===Be.x&&0===Be.y||Be._unit();const Ne=Be.x*re.x+Be.y*re.y,He=0!==Ne?1/Ne:1/0,st=2*Math.sqrt(2-2*Ne),qe=Ne<FM&&$&&ne,ut=ee.x*re.y-ee.y*re.x>0;if(qe&&fe>N){const Ge=V.dist($);if(Ge>2*F){const Qe=V.sub(V.sub($)._mult(F/Ge)._round());this.updateDistance($,Qe),this.addCurrentVertex(Qe,ee,0,0,z,de),$=Qe}}if(_e&&"round"===De&&(He<v?De="miter":He<=2&&(De="fakeround")),"miter"===De&&He>m&&(De="bevel"),"bevel"===De&&(He>2&&(De="flipbevel"),He<m&&(De="miter")),$&&this.updateDistance($,V),"miter"===De)Be._mult(He),this.addCurrentVertex(V,Be,0,0,z,de);else if("flipbevel"===De){if(He>100)Be=re.mult(-1);else{const Ge=He*ee.add(re).mag()/ee.sub(re).mag();Be._perp()._mult(Ge*(ut?-1:1))}this.addCurrentVertex(V,Be,0,0,z,de),this.addCurrentVertex(V,Be.mult(-1),0,0,z,de)}else if("bevel"===De||"fakeround"===De){const Ge=-Math.sqrt(He*He-1),Qe=ut?Ge:0,ht=ut?0:Ge;if($&&this.addCurrentVertex(V,ee,Qe,ht,z,de),"fakeround"===De){const $e=Math.round(180*st/Math.PI/20);for(let xt=1;xt<$e;xt++){let dt=xt/$e;if(.5!==dt){const jt=dt-.5;dt+=dt*jt*(dt-1)*((1.0904+Pe*(Pe*(3.55645-1.43519*Pe)-3.2452))*jt*jt+(.848013+Pe*(.215638*Pe-1.06021)))}const at=re.sub(ee)._mult(dt)._add(ee)._unit()._mult(ut?-1:1);this.addHalfVertex(V,at.x,at.y,!1,ut,0,z,de)}}ne&&this.addCurrentVertex(V,re,-Qe,-ht,z,de)}else"butt"===De?this.addCurrentVertex(V,Be,0,0,z,de):"square"===De?($||this.addCurrentVertex(V,Be,-1,-1,z,de),this.addCurrentVertex(V,Be,0,0,z,de),$&&this.addCurrentVertex(V,Be,1,1,z,de)):"round"===De&&($&&(this.addCurrentVertex(V,ee,0,0,z,de),this.addCurrentVertex(V,ee,1,1,z,de,!0)),ne&&(this.addCurrentVertex(V,re,-1,-1,z,de,!0),this.addCurrentVertex(V,re,0,0,z,de)));if(qe&&fe<A-1){const Ge=V.dist(ne);if(Ge>2*F){const Qe=V.add(ne.sub(V)._mult(F/Ge)._round());this.updateDistance(V,Qe),this.addCurrentVertex(Qe,re,0,0,z,de),V=Qe}}}}addVerticesTo(i,s,c,u,p,m,v,x,C,S){const I=(s.w-i.w)/this.tessellationStep|0;if(I>1){this.lineSoFar=i.w;const A=(s.x-i.x)/I,N=(s.y-i.y)/I,F=(s.z-i.z)/I,z=(s.w-i.w)/I;for(let V=1;V<I;++V)i.x+=A,i.y+=N,i.z+=F,this.lineSoFar+=z,this.addHalfVertex(i,c,u,S,!1,v,C,i.z),this.addHalfVertex(i,p,m,S,!0,-x,C,i.z)}this.lineSoFar=s.w,this.addHalfVertex(s,c,u,S,!1,v,C,s.z),this.addHalfVertex(s,p,m,S,!0,-x,C,s.z)}addCurrentVertex(i,s,c,u,p,m,v=!1){const x=s.x+s.y*c,C=s.y-s.x*c,S=s.y*u-s.x,I=-s.y-s.x*u;if(null!=m){const N=ft+10,F=m,z=new SM(i.x,i.y,F,this.lineSoFar),V=Mb(i,-10,N),$=this.lineSoFar;if(this.currentVertex)if(V){const ne=this.currentVertexIsOutside,ee=this.currentVertex,re=new SM(i.x,i.y,F,this.lineSoFar);oT(ee,re,-10,N),Mb(re,-10,N)||(ne&&(this.e1=this.e2=-1,this.lineSoFar=ee.w,this.addHalfVertex(ee,x,C,v,!1,c,p,ee.z),this.addHalfVertex(ee,S,I,v,!0,-u,p,ee.z)),this.addVerticesTo(ee,re,x,C,S,I,c,u,p,v))}else{const ne=this.currentVertex;this.currentVertexIsOutside&&(oT(ne,z,-10,N),this.e1=this.e2=-1,this.lineSoFar=ne.w,this.addHalfVertex(ne,x,C,v,!1,c,p,ne.z),this.addHalfVertex(ne,S,I,v,!0,-u,p,ne.z)),this.addVerticesTo(ne,z,x,C,S,I,c,u,p,v)}else V||(this.addHalfVertex(i,x,C,v,!1,c,p,m),this.addHalfVertex(i,S,I,v,!0,-u,p,m));this.currentVertex=z,this.currentVertexIsOutside=V,this.lineSoFar=$}else this.addHalfVertex(i,x,C,v,!1,c,p,m),this.addHalfVertex(i,S,I,v,!0,-u,p,m)}addHalfVertex({x:i,y:s},c,u,p,m,v,x,C){this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((i<<1)+(p?1:0),(s<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*u)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),x.primitiveLength++),m?this.e2=S:this.e1=S,null!=C&&this.zOffsetVertexArray.emplaceBack(C)}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,s){this.distance+=i.dist(s),this.updateScaledDistance()}}function Mb(o,i,s){return o.x<i||o.x>s||o.y<i||o.y>s}let Ib,OT;function PT(o,i,s){return i*(ft/(o.tileSize*Math.pow(2,s-o.tileID.overscaledZ)))}function Ab(o,i){return 1/PT(o,1,i.tileZoom)}function Xg(o,i,s,c){return o.translatePosMatrix(c||i.tileID.projMatrix,i,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}Ee(S0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Ob=o=>{const i=[];M0(o)&&i.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const s=o.paint.get("line-trim-offset");0===s[0]&&0===s[1]||i.push("RENDER_LINE_TRIM_OFFSET"),0!==o.paint.get("line-border-width").constantOr(1)&&i.push("RENDER_LINE_BORDER");const c="none"===o.layout.get("line-join").constantOr("miter"),u=!!o.paint.get("line-pattern").constantOr(1);return c&&u&&i.push("LINE_JOIN_NONE"),i};function M0(o){const i=o.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}class RT{constructor(i){this._stringToNumber={},this._numberToString=[];for(let s=0;s<i.length;s++){const c=i[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}var tl={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(o,i,s,c,u){var p,m,v=8*u-c-1,x=(1<<v)-1,C=x>>1,S=-7,I=s?u-1:0,A=s?-1:1,N=o[i+I];for(I+=A,p=N&(1<<-S)-1,N>>=-S,S+=v;S>0;p=256*p+o[i+I],I+=A,S-=8);for(m=p&(1<<-S)-1,p>>=-S,S+=c;S>0;m=256*m+o[i+I],I+=A,S-=8);if(0===p)p=1-C;else{if(p===x)return m?NaN:1/0*(N?-1:1);m+=Math.pow(2,c),p-=C}return(N?-1:1)*m*Math.pow(2,p-c)},write:function(o,i,s,c,u,p){var m,v,x,C=8*p-u-1,S=(1<<C)-1,I=S>>1,A=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,N=c?0:p-1,F=c?1:-1,z=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(v=isNaN(i)?1:0,m=S):(m=Math.floor(Math.log(i)/Math.LN2),i*(x=Math.pow(2,-m))<1&&(m--,x*=2),(i+=m+I>=1?A/x:A*Math.pow(2,1-I))*x>=2&&(m++,x/=2),m+I>=S?(v=0,m=S):m+I>=1?(v=(i*x-1)*Math.pow(2,u),m+=I):(v=i*Math.pow(2,I-1)*Math.pow(2,u),m=0));u>=8;o[s+N]=255&v,N+=F,v/=256,u-=8);for(m=m<<u|v,C+=u;C>0;o[s+N]=255&m,N+=F,m/=256,C-=8);o[s+N-F]|=128*z}},NT=Bi,I0=tl;function Bi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Bi.Varint=0,Bi.Fixed64=1,Bi.Bytes=2,Bi.Fixed32=5;var Mu=4294967296,kT=1/Mu,FT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Sl(o){return o.type===Bi.Bytes?o.readVarint()+o.pos:o.pos+1}function Pb(o,i,s){var c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));s.realloc(c);for(var u=s.pos-1;u>=o;u--)s.buf[u+c]=s.buf[u]}function oP(o,i){for(var s=0;s<o.length;s++)i.writeVarint(o[s])}function sP(o,i){for(var s=0;s<o.length;s++)i.writeSVarint(o[s])}function Kg(o,i){for(var s=0;s<o.length;s++)i.writeFloat(o[s])}function BM(o,i){for(var s=0;s<o.length;s++)i.writeDouble(o[s])}function zM(o,i){for(var s=0;s<o.length;s++)i.writeBoolean(o[s])}function VM(o,i){for(var s=0;s<o.length;s++)i.writeFixed32(o[s])}function LT(o,i){for(var s=0;s<o.length;s++)i.writeSFixed32(o[s])}function UM(o,i){for(var s=0;s<o.length;s++)i.writeFixed64(o[s])}function jM(o,i){for(var s=0;s<o.length;s++)i.writeSFixed64(o[s])}function A0(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function Zp(o,i,s){o[s]=i,o[s+1]=i>>>8,o[s+2]=i>>>16,o[s+3]=i>>>24}function BT(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}Bi.prototype={destroy:function(){this.buf=null},readFields:function(o,i,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),u=c>>3,p=this.pos;this.type=7&c,o(u,i,this),this.pos===p&&this.skip(c)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=A0(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=BT(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=A0(this.buf,this.pos)+A0(this.buf,this.pos+4)*Mu;return this.pos+=8,o},readSFixed64:function(){var o=A0(this.buf,this.pos)+BT(this.buf,this.pos+4)*Mu;return this.pos+=8,o},readFloat:function(){var o=I0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=I0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,s,c=this.buf;return i=127&(s=c[this.pos++]),s<128?i:(i|=(127&(s=c[this.pos++]))<<7,s<128?i:(i|=(127&(s=c[this.pos++]))<<14,s<128?i:(i|=(127&(s=c[this.pos++]))<<21,s<128?i:function(u,p,m){var v,x,C=m.buf;if(v=(112&(x=C[m.pos++]))>>4,x<128||(v|=(127&(x=C[m.pos++]))<<3,x<128)||(v|=(127&(x=C[m.pos++]))<<10,x<128)||(v|=(127&(x=C[m.pos++]))<<17,x<128)||(v|=(127&(x=C[m.pos++]))<<24,x<128)||(v|=(1&(x=C[m.pos++]))<<31,x<128))return function Wp(o,i,s){return s?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}(u,v,p);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&FT?FT.decode(this.buf.subarray(i,o)):function(s,c,u){for(var p="",m=c;m<u;){var v,x,C,S=s[m],I=null,A=S>239?4:S>223?3:S>191?2:1;if(m+A>u)break;1===A?S<128&&(I=S):2===A?128==(192&(v=s[m+1]))&&(I=(31&S)<<6|63&v)<=127&&(I=null):3===A?(x=s[m+2],128==(192&(v=s[m+1]))&&128==(192&x)&&((I=(15&S)<<12|(63&v)<<6|63&x)<=2047||I>=55296&&I<=57343)&&(I=null)):4===A&&(x=s[m+2],C=s[m+3],128==(192&(v=s[m+1]))&&128==(192&x)&&128==(192&C)&&((I=(15&S)<<18|(63&v)<<12|(63&x)<<6|63&C)<=65535||I>=1114112)&&(I=null)),null===I?(I=65533,A=1):I>65535&&(I-=65536,p+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),p+=String.fromCharCode(I),m+=A}return p}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==Bi.Bytes)return o.push(this.readVarint(i));var s=Sl(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==Bi.Bytes)return o.push(this.readSVarint());var i=Sl(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Bi.Bytes)return o.push(this.readBoolean());var i=Sl(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Bi.Bytes)return o.push(this.readFloat());var i=Sl(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Bi.Bytes)return o.push(this.readDouble());var i=Sl(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Bi.Bytes)return o.push(this.readFixed32());var i=Sl(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Bi.Bytes)return o.push(this.readSFixed32());var i=Sl(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Bi.Bytes)return o.push(this.readFixed64());var i=Sl(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Bi.Bytes)return o.push(this.readSFixed64());var i=Sl(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===Bi.Varint)for(;this.buf[this.pos++]>127;);else if(i===Bi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Bi.Fixed32)this.pos+=4;else{if(i!==Bi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var s=new Uint8Array(i);s.set(this.buf),this.buf=s,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Zp(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Zp(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Zp(this.buf,-1&o,this.pos),Zp(this.buf,Math.floor(o*kT),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Zp(this.buf,-1&o,this.pos),Zp(this.buf,Math.floor(o*kT),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,s){var c,u,p,v;if(i>=0?(c=i%4294967296|0,u=i/4294967296|0):(u=~(-i/4294967296),4294967295^(c=~(-i%4294967296))?c=c+1|0:(c=0,u=u+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),p=c,(v=s).buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7),function(p,m){var v=(7&p)<<4;m.buf[m.pos++]|=v|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(u,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(c,u,p){for(var m,v,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!v){m>56319||x+1===u.length?(c[p++]=239,c[p++]=191,c[p++]=189):v=m;continue}if(m<56320){c[p++]=239,c[p++]=191,c[p++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(c[p++]=239,c[p++]=191,c[p++]=189,v=null);m<128?c[p++]=m:(m<2048?c[p++]=m>>6|192:(m<65536?c[p++]=m>>12|224:(c[p++]=m>>18|240,c[p++]=m>>12&63|128),c[p++]=m>>6&63|128),c[p++]=63&m|128)}return p}(this.buf,o,this.pos);var s=this.pos-i;s>=128&&Pb(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),I0.write(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),I0.write(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var s=0;s<i;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,i){this.pos++;var s=this.pos;o(i,this);var c=this.pos-s;c>=128&&Pb(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,i,s){this.writeTag(o,Bi.Bytes),this.writeRawMessage(i,s)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,oP,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,sP,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,zM,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,Kg,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,BM,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,VM,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,LT,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,UM,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,jM,i)},writeBytesField:function(o,i){this.writeTag(o,Bi.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,Bi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,Bi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,Bi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,Bi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,Bi.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,Bi.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,Bi.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,Bi.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,Bi.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var Jg=us(NT);const Rb=["id","tile","layer","source","sourceLayer","state"];class $M{constructor(i,s,c,u,p){this.type="Feature",this._vectorTileFeature=i,this._z=s,this._x=c,this._y=u,this.properties=i.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of Rb)void 0!==this[s]&&(i[s]=this[s]);return i}}class aP{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,s,c){const u=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][u]=this.stateChanges[i][u]||{},uo(this.stateChanges[i][u],c),null===this.deletedStates[i]){this.deletedStates[i]={};for(const p in this.state[i])p!==u&&(this.deletedStates[i][p]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][u]){this.deletedStates[i][u]={};for(const p in this.state[i][u])c[p]||(this.deletedStates[i][u][p]=null)}else for(const p in c)this.deletedStates[i]&&this.deletedStates[i][u]&&null===this.deletedStates[i][u][p]&&delete this.deletedStates[i][u][p]}removeFeatureState(i,s,c){if(null===this.deletedStates[i])return;const u=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},c&&void 0!==s)null!==this.deletedStates[i][u]&&(this.deletedStates[i][u]=this.deletedStates[i][u]||{},this.deletedStates[i][u][c]=null);else if(void 0!==s)if(this.stateChanges[i]&&this.stateChanges[i][u])for(c in this.deletedStates[i][u]={},this.stateChanges[i][u])this.deletedStates[i][u][c]=null;else this.deletedStates[i][u]=null;else this.deletedStates[i]=null}getState(i,s){const c=String(s),u=uo({},(this.state[i]||{})[c],(this.stateChanges[i]||{})[c]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const p=this.deletedStates[i][s];if(null===p)return{};for(const m in p)delete u[m]}return u}initializeTileState(i,s){i.setFeatureState(this.state,s)}coalesceChanges(i,s){const c={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),uo(this.state[u][m],this.stateChanges[u][m]),p[m]=this.state[u][m];c[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(null===this.deletedStates[u])for(const m in this.state[u])p[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(null===this.deletedStates[u][m])this.state[u][m]={};else if(this.state[u][m])for(const v of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][v];p[m]=this.state[u][m]}c[u]=c[u]||{},uo(c[u],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const u in i)i[u].setFeatureState(c,s)}}class O0{constructor(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Fe(ft,16,0),this.featureIndexArray=new Mp,this.promoteId=s,this.is3DTile=!1}insert(i,s,c,u,p,m=0,v=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,u,p,m);const C=this.grid;for(let S=0;S<s.length;S++){const I=s[S],A=[1/0,1/0,-1/0,-1/0];for(let N=0;N<I.length;N++){const F=I[N];A[0]=Math.min(A[0],F.x),A[1]=Math.min(A[1],F.y),A[2]=Math.max(A[2],F.x),A[3]=Math.max(A[3],F.y)}0!==v&&(A[0]-=v,A[1]-=v,A[2]+=v,A[3]+=v),A[0]<ft&&A[1]<ft&&A[2]>=0&&A[3]>=0&&C.insert(x,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new $p(new Jg(this.rawTileData)).layers,this.sourceLayerCoder=new RT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,s,c,u){this.loadVTLayers();const p=i.params||{},m=Xa(p.filter),v=i.tileResult,x=i.transform,C=v.bufferedTilespaceBounds,S=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(F,z,V,$)=>OC(v.bufferedTilespaceGeometry,F,z,V,$));S.sort(lP);let I=null;x.elevation&&S.length>0&&(I=Du.create(x.elevation,this.tileID));const A={};let N;for(let F=0;F<S.length;F++){const z=S[F];if(z===N)continue;N=z;const V=this.featureIndexArray.get(z);let $=null;if(this.is3DTile){const ne=this.bucketLayerIDs[0][0],ee=s[ne];if("model"!==ee.type)continue;const{queryFeature:re,intersectionZ:de}=ee.queryIntersectsMatchingFeature(v,V.featureIndex,m,x);re&&this.appendToResult(A,ne,V.featureIndex,re,de)}else this.loadMatchingFeature(A,V,m,p.layers,p.availableImages,s,c,u,(ne,ee,re,de=0)=>($||($=el(ne,this.tileID.canonical,i.tileTransform)),ee.queryIntersectsFeature(v,ne,re,$,this.z,i.transform,i.pixelPosMatrix,I,de)))}return A}loadMatchingFeature(i,s,c,u,p,m,v,x,C){const{featureIndex:S,bucketIndex:I,sourceLayerIndex:A,layoutVertexArrayOffset:N}=s,F=this.bucketLayerIDs[I];if(u&&!function(ne,ee){for(let re=0;re<ne.length;re++)if(ee.indexOf(ne[re])>=0)return!0;return!1}(u,F))return;const z=this.sourceLayerCoder.decode(A),V=this.vtLayers[z].feature(S);if(c.needGeometry){const ne=xc(V,!0);if(!c.filter(new cn(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!c.filter(new cn(this.tileID.overscaledZ),V))return;const $=this.getId(V,z);for(let ne=0;ne<F.length;ne++){const ee=F[ne];if(u&&u.indexOf(ee)<0)continue;const re=m[ee];if(!re)continue;let de={};void 0!==$&&x&&(de=x.getState(re.sourceLayer||"_geojsonTileLayer",$));const fe=!C||C(V,re,de,N);if(!fe)continue;const _e=new $M(V,this.z,this.x,this.y,$),De=uo({},v[ee]);De.paint=GM(De.paint,re.paint,V,de,p),De.layout=GM(De.layout,re.layout,V,de,p),_e.layer=De,this.appendToResult(i,ee,S,_e,fe)}}appendToResult(i,s,c,u,p){let m=i[s];void 0===m&&(m=i[s]=[]),m.push({featureIndex:c,feature:u,intersectionZ:p})}lookupSymbolFeatures(i,s,c,u,p,m,v,x){const C={};this.loadVTLayers();const S=Xa(p);for(const I of i)this.loadMatchingFeature(C,{bucketIndex:c,sourceLayerIndex:u,featureIndex:I,layoutVertexArrayOffset:0},S,m,v,x,s);return C}loadFeature(i){const{featureIndex:s,sourceLayerIndex:c}=i;this.loadVTLayers();const u=this.sourceLayerCoder.decode(c),p=this.vtFeatures[u];if(p[s])return p[s];const m=this.vtLayers[u].feature(s);return p[s]=m,m}hasLayer(i){for(const s of this.bucketLayerIDs)for(const c of s)if(i===c)return!0;return!1}getId(i,s){let c=i.id;if(this.promoteId){const u="string"==typeof this.promoteId?this.promoteId:this.promoteId[s];null!=u&&(c=i.properties[u]),"boolean"==typeof c&&(c=Number(c))}return c}}function GM(o,i,s,c,u){return ip(o,(p,m)=>{const v=i instanceof yo?i.get(m):null;return v&&v.evaluate?v.evaluate(s,c,u):v})}function lP(o,i){return i-o}Ee(O0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Fo=24;const Sc=128;function zT(o,i){const{expression:s}=i;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new cn(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:u}=s;let p=0;for(;p<c.length&&c[p]<=o;)p++;p=Math.max(0,p-1);let m=p;for(;m<c.length&&c[m]<o+1;)m++;m=Math.min(c.length-1,m);const v=c[p],x=c[m];return"composite"===s.kind?{kind:"composite",minZoom:v,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:x,minSize:s.evaluate(new cn(v)),maxSize:s.evaluate(new cn(x)),interpolationType:u}}}function P0(o,{uSize:i,uSizeT:s},{lowerSize:c,upperSize:u}){return"source"===o.kind?c/Sc:"composite"===o.kind?Yt(c/Sc,u/Sc,s):i}function Iu(o,i){let s=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:u,minZoom:p,maxZoom:m}=o,v=u?Sn(la.interpolationFactor(u,i,p,m),0,1):0;"camera"===o.kind?c=Yt(o.minSize,o.maxSize,v):s=v}return{uSizeT:s,uSize:c}}var R0=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Sc,evaluateSizeForFeature:P0,evaluateSizeForZoom:Iu,getSizeData:zT});function VT(o,i,s){return o.sections.forEach(c=>{c.text=function(u,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return"uppercase"===v?u=u.toLocaleUpperCase():"lowercase"===v&&(u=u.toLocaleLowerCase()),kn.applyArabicShaping&&(u=kn.applyArabicShaping(u)),u}(c.text,i,s)}),o}const Yp={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function UT(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function HM(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}const Nb=3;function jT(o,i,s){i.glyphs=[],1===o&&s.readMessage(Xp,i)}function Xp(o,i,s){if(3===o){const{id:c,bitmap:u,width:p,height:m,left:v,top:x,advance:C}=s.readMessage(Aa,{});i.glyphs.push({id:c,bitmap:new qd({width:p+2*Nb,height:m+2*Nb},u),metrics:{width:p,height:m,left:v,top:x,advance:C}})}else 4===o?i.ascender=s.readSVarint():5===o&&(i.descender=s.readSVarint())}function Aa(o,i,s){1===o?i.id=s.readVarint():2===o?i.bitmap=s.readBytes():3===o?i.width=s.readVarint():4===o?i.height=s.readVarint():5===o?i.left=s.readSVarint():6===o?i.top=s.readSVarint():7===o&&(i.advance=s.readVarint())}const Xs=Nb,fa={horizontal:1,vertical:2,horizontalOnly:3};class N0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,s){const c=new N0;return c.scale=i||1,c.fontStack=s,c}static forImage(i){const s=new N0;return s.imageName=i,s}}class Kp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,s){const c=new Kp;for(let u=0;u<i.sections.length;u++){const p=i.sections[u];p.image?c.addImageSection(p):c.addTextSection(p,s)}return c}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(s,c){let u="";for(let p=0;p<s.length;p++){const m=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;u+=!c&&(m&&nt(m)&&!Yp[s[p+1]]||v&&nt(v)&&!Yp[s[p-1]])||!Yp[s[p]]?s[p]:Yp[s[p]]}return u}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&kb[this.text.charCodeAt(c)];c++)i++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&kb[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(i,s),this.sectionIndex=this.sectionIndex.slice(i,s)}substring(i,s){const c=new Kp;return c.text=this.text.substring(i,s),c.sectionIndex=this.sectionIndex.slice(i,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,s)=>Math.max(i,this.sections[s].scale),0)}addTextSection(i,s){this.text+=i.text,this.sections.push(N0.forText(i.scale,i.fontStack||s));const c=this.sections.length-1;for(let u=0;u<i.text.length;++u)this.sectionIndex.push(c)}addImageSection(i){const s=i.image?i.image.namePrimary:"";if(0===s.length)return void fr("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(N0.forImage(s)),this.sectionIndex.push(this.sections.length-1)):fr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $T(o,i,s,c,u,p,m,v,x,C,S,I,A,N,F){const z=Kp.fromFeature(o,u);I===fa.vertical&&z.verticalizePunctuation(A);let V=[];const $=function(fe,_e,De,Pe,Be,Ne){if(!fe)return[];const He=[],st=function(Qe,ht,$e,xt,dt,at){let jt=0;for(let Bt=0;Bt<Qe.length();Bt++){const Dt=Qe.getSection(Bt);jt+=Fb(Qe.getCodePoint(Bt),Dt,xt,dt,ht,at)}return jt/Math.max(1,Math.ceil(jt/$e))}(fe,_e,De,Pe,Be,Ne),qe=fe.text.indexOf("\u200b")>=0;let ut=0;for(let Qe=0;Qe<fe.length();Qe++){const ht=fe.getSection(Qe),$e=fe.getCodePoint(Qe);if(kb[$e]||(ut+=Fb($e,ht,Pe,Be,_e,Ne)),Qe<fe.length()-1){const xt=!((Ge=$e)<11904||!(Te["Bopomofo Extended"](Ge)||Te.Bopomofo(Ge)||Te["CJK Compatibility Forms"](Ge)||Te["CJK Compatibility Ideographs"](Ge)||Te["CJK Compatibility"](Ge)||Te["CJK Radicals Supplement"](Ge)||Te["CJK Strokes"](Ge)||Te["CJK Symbols and Punctuation"](Ge)||Te["CJK Unified Ideographs Extension A"](Ge)||Te["CJK Unified Ideographs"](Ge)||Te["Enclosed CJK Letters and Months"](Ge)||Te["Halfwidth and Fullwidth Forms"](Ge)||Te.Hiragana(Ge)||Te["Ideographic Description Characters"](Ge)||Te["Kangxi Radicals"](Ge)||Te["Katakana Phonetic Extensions"](Ge)||Te.Katakana(Ge)||Te["Vertical Forms"](Ge)||Te["Yi Radicals"](Ge)||Te["Yi Syllables"](Ge)));(GT[$e]||xt||ht.imageName)&&He.push(k0(Qe+1,ut,st,He,Jd($e,fe.getCodePoint(Qe+1),xt&&qe),!1))}}var Ge;return F0(k0(fe.length(),ut,st,He,0,!0))}(z,C,p,i,c,N),{processBidirectionalText:ne,processStyledBidirectionalText:ee}=kn;if(ne&&1===z.sections.length){const fe=ne(z.toString(),$);for(const _e of fe){const De=new Kp;De.text=_e,De.sections=z.sections;for(let Pe=0;Pe<_e.length;Pe++)De.sectionIndex.push(0);V.push(De)}}else if(ee){const fe=ee(z.text,z.sectionIndex,$);for(const _e of fe){const De=new Kp;De.text=_e[0],De.sectionIndex=_e[1],De.sections=z.sections,V.push(De)}}else V=function(fe,_e){const De=[],Pe=fe.text;let Be=0;for(const Ne of _e)De.push(fe.substring(Be,Ne)),Be=Ne;return Be<Pe.length&&De.push(fe.substring(Be,Pe.length)),De}(z,$);const re=[],de={positionedLines:re,text:z.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,_e,De,Pe,Be,Ne,He,st,qe,ut,Ge,Qe){let ht=0,$e=0,xt=0;const dt="right"===st?1:"left"===st?0:.5;let at=!1;for(const Vt of Be){const Ot=Vt.getSections();for(const gn of Ot){if(gn.imageName)continue;const wn=_e[gn.fontStack];if(wn&&(at=void 0!==wn.ascender&&void 0!==wn.descender,!at))break}if(!at)break}let jt=0;for(const Vt of Be){Vt.trim();const Ot=Vt.getMaxScale(),gn=(Ot-1)*Fo,wn={positionedGlyphs:[],lineOffset:0};fe.positionedLines[jt]=wn;const bn=wn.positionedGlyphs;let Dn=0;if(!Vt.length()){$e+=Ne,++jt;continue}let Ln=0,Nn=0;for(let yi=0;yi<Vt.length();yi++){const _n=Vt.getSection(yi),si=Vt.getSectionIndex(yi),ci=Vt.getCodePoint(yi);let Ri=_n.scale,cr=null,_r=null,Ji=null,Hi=Fo,Gr=0;const Tr=!(qe===fa.horizontal||!Ge&&!pt(ci)||Ge&&(kb[ci]||(Bt=ci,Te.Arabic(Bt)||Te["Arabic Supplement"](Bt)||Te["Arabic Extended-A"](Bt)||Te["Arabic Presentation Forms-A"](Bt)||Te["Arabic Presentation Forms-B"](Bt))));if(_n.imageName){const so=Pe[_n.imageName];if(!so)continue;Ji=_n.imageName,fe.iconsInText=fe.iconsInText||!0,_r=so.paddedRect;const Si=so.displaySize;Ri=Ri*Fo/Qe,cr={width:Si[0],height:Si[1],left:0,top:-Xs,advance:Tr?Si[1]:Si[0],localGlyph:!1},Gr=at?-cr.height*Ri:Ot*Fo-17-Si[1]*Ri,Hi=cr.advance;const Ds=(Tr?Si[0]:Si[1])*Ri-Fo*Ot;Ds>0&&Ds>Dn&&(Dn=Ds)}else{const so=De[_n.fontStack];if(!so)continue;so[ci]&&(_r=so[ci]);const Si=_e[_n.fontStack];if(!Si)continue;const Ds=Si.glyphs[ci];if(!Ds)continue;if(cr=Ds.metrics,Hi=8203!==ci?Fo:0,at){const Rl=void 0!==Si.ascender?Math.abs(Si.ascender):0,pa=void 0!==Si.descender?Math.abs(Si.descender):0,Pa=(Rl+pa)*Ri;Ln<Pa&&(Ln=Pa,Nn=(Rl-pa)/2*Ri),Gr=-Rl*Ri}else Gr=(Ot-Ri)*Fo-17}Tr?(fe.verticalizable=!0,bn.push({glyph:ci,imageName:Ji,x:ht,y:$e+Gr,vertical:Tr,scale:Ri,localGlyph:cr.localGlyph,fontStack:_n.fontStack,sectionIndex:si,metrics:cr,rect:_r}),ht+=Hi*Ri+ut):(bn.push({glyph:ci,imageName:Ji,x:ht,y:$e+Gr,vertical:Tr,scale:Ri,localGlyph:cr.localGlyph,fontStack:_n.fontStack,sectionIndex:si,metrics:cr,rect:_r}),ht+=cr.advance*Ri+ut)}0!==bn.length&&(xt=Math.max(ht-ut,xt),at?hf(bn,dt,Dn,Nn,Ne*Ot/2):hf(bn,dt,Dn,0,Ne/2)),ht=0;const _i=Ne*Ot+Dn;wn.lineOffset=Math.max(Dn,gn),$e+=_i,++jt}var Bt;const Dt=$e,{horizontalAlign:yt,verticalAlign:sn}=Lb(He);(function(Vt,Ot,gn,wn,bn,Dn){const Ln=(Ot-gn)*bn,Nn=-Dn*wn;for(const _i of Vt)for(const yi of _i.positionedGlyphs)yi.x+=Ln,yi.y+=Nn})(fe.positionedLines,dt,yt,sn,xt,Dt),fe.top+=-sn*Dt,fe.bottom=fe.top+Dt,fe.left+=-yt*xt,fe.right=fe.left+xt,fe.hasBaseline=at}(de,i,s,c,V,m,v,x,I,C,A,F),!function(fe){for(const _e of fe)if(0!==_e.positionedGlyphs.length)return!1;return!0}(re)&&de}const kb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},GT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fb(o,i,s,c,u,p){if(i.imageName){const m=c[i.imageName];return m?m.displaySize[0]*i.scale*Fo/p+u:0}{const m=s[i.fontStack],v=m&&m.glyphs[o];return v?v.metrics.advance*i.scale+u:0}}function qM(o,i,s,c){const u=Math.pow(o-i,2);return c?o<i?u/2:2*u:u+Math.abs(s)*s}function Jd(o,i,s){let c=0;return 10===o&&(c-=1e4),s&&(c+=150),40!==o&&65288!==o||(c+=50),41!==i&&65289!==i||(c+=50),c}function k0(o,i,s,c,u,p){let m=null,v=qM(i,s,u,p);for(const x of c){const C=qM(i-x.x,s,u,p)+x.badness;C<=v&&(m=x,v=C)}return{index:o,x:i,priorBreak:m,badness:v}}function F0(o){return o?F0(o.priorBreak).concat(o.index):[]}function Lb(o){let i=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:i,verticalAlign:s}}function hf(o,i,s,c,u){if(!(i||s||c||u))return;const p=o.length-1,m=o[p],v=(m.x+m.metrics.advance*m.scale)*i;for(let x=0;x<=p;x++)o[x].x-=v,o[x].y+=s+c+u}function Bb(o,i,s,c){const{horizontalAlign:u,verticalAlign:p}=Lb(c),m=s[0]-o.displaySize[0]*u,v=s[1]-o.displaySize[1]*p;return{imagePrimary:o,imageSecondary:i,top:v,bottom:v+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function zb(o,i,s,c,u,p){const m=o.imagePrimary;let v;if(m.content){const V=m.content,$=m.pixelRatio||1;v=[V[0]/$,V[1]/$,m.displaySize[0]-V[2]/$,m.displaySize[1]-V[3]/$]}const x=i.left*p,C=i.right*p;let S,I,A,N;"width"===s||"both"===s?(N=u[0]+x-c[3],I=u[0]+C+c[1]):(N=u[0]+(x+C-m.displaySize[0])/2,I=N+m.displaySize[0]);const F=i.top*p,z=i.bottom*p;return"height"===s||"both"===s?(S=u[1]+F-c[0],A=u[1]+z+c[2]):(S=u[1]+(F+z-m.displaySize[1])/2,A=S+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:S,right:I,bottom:A,left:N,collisionPadding:v}}class Ml extends _t{constructor(i,s,c,u,p){super(i,s),this.angle=u,this.z=c,void 0!==p&&(this.segment=p)}clone(){return new Ml(this.x,this.y,this.z,this.angle,this.segment)}}function Qg(o,i,s,c,u){if(void 0===i.segment)return!0;let p=i,m=i.segment+1,v=0;for(;v>-s/2;){if(m--,m<0)return!1;v-=o[m].dist(p),p=o[m]}v+=o[m].dist(o[m+1]),m++;const x=[];let C=0;for(;v<s/2;){const S=o[m],I=o[m+1];if(!I)return!1;let A=o[m-1].angleTo(S)-S.angleTo(I);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:v,angleDelta:A}),C+=A;v-x[0].distance>c;)C-=x.shift().angleDelta;if(C>u)return!1;m++,v+=S.dist(I)}return!0}function HT(o){let i=0;for(let s=0;s<o.length-1;s++)i+=o[s].dist(o[s+1]);return i}function qT(o,i,s){return o?.6*i*s:0}function Vb(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function WM(o,i,s,c,u,p){const m=qT(s,u,p),v=Vb(s,c)*p;let x=0;const C=HT(o)/2;for(let S=0;S<o.length-1;S++){const I=o[S],A=o[S+1],N=I.dist(A);if(x+N>C){const F=(C-x)/N,z=Yt(I.x,A.x,F),V=Yt(I.y,A.y,F),$=new Ml(z,V,0,A.angleTo(I),S);return!m||Qg(o,$,v,m,i)?$:void 0}x+=N}}function ZM(o,i,s,c,u,p,m,v,x){const C=qT(c,p,m),S=Vb(c,u),I=S*m,A=0===o[0].x||o[0].x===x||0===o[0].y||o[0].y===x;return i-I<i/4&&(i=I+i/4),Ub(o,A?i/2*v%i:(S/2+2*p)*m*v%i,i,C,s,I,A,!1,x)}function Ub(o,i,s,c,u,p,m,v,x){const C=p/2,S=HT(o);let I=0,A=i-s,N=[];for(let F=0;F<o.length-1;F++){const z=o[F],V=o[F+1],$=z.dist(V),ne=V.angleTo(z);for(;A+s<I+$;){A+=s;const ee=(A-I)/$,re=Yt(z.x,V.x,ee),de=Yt(z.y,V.y,ee);if(re>=0&&re<x&&de>=0&&de<x&&A-C>=0&&A+C<=S){const fe=new Ml(re,de,0,ne,F);c&&!Qg(o,fe,p,c,u)||N.push(fe)}}I+=$}return v||N.length||m||(N=Ub(o,I/2,s,c,u,p,m,!0,x)),N}function L0(o,i,s,c,u){const p=[];for(let m=0;m<o.length;m++){const v=o[m];let x;for(let C=0;C<v.length-1;C++){let S=v[C],I=v[C+1];S.x<i&&I.x<i||(S.x<i?S=new _t(i,S.y+(i-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x<i&&(I=new _t(i,S.y+(i-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y<s&&I.y<s||(S.y<s?S=new _t(S.x+(s-S.y)/(I.y-S.y)*(I.x-S.x),s)._round():I.y<s&&(I=new _t(S.x+(s-S.y)/(I.y-S.y)*(I.x-S.x),s)._round()),S.x>=c&&I.x>=c||(S.x>=c?S=new _t(c,S.y+(c-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x>=c&&(I=new _t(c,S.y+(c-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y>=u&&I.y>=u||(S.y>=u?S=new _t(S.x+(u-S.y)/(I.y-S.y)*(I.x-S.x),u)._round():I.y>=u&&(I=new _t(S.x+(u-S.y)/(I.y-S.y)*(I.x-S.x),u)._round()),x&&S.equals(x[x.length-1])||(x=[S],p.push(x)),x.push(I)))))}}return p}function Jp(o){let i=0,s=0;for(const m of o)i+=m.w*m.h,s=Math.max(s,m.w);o.sort((m,v)=>v.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),s),h:1/0}];let u=0,p=0;for(const m of o)for(let v=c.length-1;v>=0;v--){const x=c[v];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,p=Math.max(p,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const C=c.pop();v<c.length&&(c[v]=C)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(c.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:p,fill:i/(u*p)||0}}Ee(Ml,"Anchor");const rs=1;class e_{constructor(i,{pixelRatio:s,version:c,stretchX:u,stretchY:p,content:m}){this.paddedRect=i,this.pixelRatio=s,this.stretchX=u,this.stretchY=p,this.content=m,this.version=c}get tl(){return[this.paddedRect.x+rs,this.paddedRect.y+rs]}get br(){return[this.paddedRect.x+this.paddedRect.w-rs,this.paddedRect.y+this.paddedRect.h-rs]}get displaySize(){return[(this.paddedRect.w-2*rs)/this.pixelRatio,(this.paddedRect.h-2*rs)/this.pixelRatio]}}class WT{constructor(i,s,c){const u={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(i,u,m),this.addImages(s,p,m);const{w:v,h:x}=Jp(m),C=new gr({width:v||1,height:x||1});for(const S in i){const I=i[S],A=u[S].paddedRect;gr.copy(I.data,C,{x:0,y:0},{x:A.x+rs,y:A.y+rs},I.data,c,I.sdf)}for(const S in s){const I=s[S],A=p[S].paddedRect,N=A.x+rs,F=A.y+rs,z=I.data.width,V=I.data.height;gr.copy(I.data,C,{x:0,y:0},{x:N,y:F},I.data,c),gr.copy(I.data,C,{x:0,y:V-1},{x:N,y:F-1},{width:z,height:1},c),gr.copy(I.data,C,{x:0,y:0},{x:N,y:F+V},{width:z,height:1},c),gr.copy(I.data,C,{x:z-1,y:0},{x:N-1,y:F},{width:1,height:V},c),gr.copy(I.data,C,{x:0,y:0},{x:N+z,y:F},{width:1,height:V},c)}this.image=C,this.iconPositions=u,this.patternPositions=p}addImages(i,s,c){for(const u in i){const p=i[u],m={x:0,y:0,w:p.data.width+2*rs,h:p.data.height+2*rs};c.push(m),s[u]=new e_(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(i,s,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>i.hasImage(u,c)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const u in i.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[u],i.getImage(u,c),s),this.patchUpdatedImage(this.patternPositions[u],i.getImage(u,c),s)}patchUpdatedImage(i,s,c){if(!i||!s||i.version===s.version)return;i.version=s.version;const[u,p]=i.tl,m=!!Object.keys(this.patternPositions).length;c.update(s.data,{useMipmap:m},{x:u,y:p})}}Ee(e_,"ImagePosition"),Ee(WT,"ImageAtlas");const t_=1e20;function B0(o,i,s,c,u,p,m,v,x){for(let C=i;C<i+c;C++)jb(o,s*p+C,p,u,m,v,x);for(let C=s;C<s+u;C++)jb(o,C*p+i,1,c,m,v,x)}function jb(o,i,s,c,u,p,m){p[0]=0,m[0]=-t_,m[1]=t_,u[0]=o[i];for(let v=1,x=0,C=0;v<c;v++){u[v]=o[i+v*s];const S=v*v;do{const I=p[x];C=(u[v]-u[I]+S-I*I)/(v-I)/2}while(C<=m[x]&&--x>-1);x++,p[x]=v,m[x]=C,m[x+1]=t_}for(let v=0,x=0;v<c;v++){for(;m[x+1]<v;)x++;const C=p[x],S=v-C;o[i+v*s]=u[C]+S*S}}const os=2,z0={none:0,ideographs:1,all:2};class ff{constructor(i,s,c){this.requestManager=i,this.localGlyphMode=s,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i,s){this.urls[s]=i}getGlyphs(i,s,c){const u=[],p=this.urls[s]||Cn.GLYPHS_URL;for(const m in i)for(const v of i[m])u.push({stack:m,id:v});ep(u,({stack:m,id:v},x)=>{let C=this.entries[m];C||(C=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=C.glyphs[v];if(void 0!==S)return void x(null,{stack:m,id:v,glyph:S});if(S=this._tinySDF(C,m,v),S)return C.glyphs[v]=S,void x(null,{stack:m,id:v,glyph:S});const I=Math.floor(v/256);if(256*I>65535)return void x(new Error("glyphs > 65535 not supported"));if(C.ranges[I])return void x(null,{stack:m,id:v,glyph:S});let A=C.requests[I];A||(A=C.requests[I]=[],ff.loadGlyphRange(m,I,p,this.requestManager,(N,F)=>{if(F){C.ascender=F.ascender,C.descender=F.descender;for(const z in F.glyphs)this._doesCharSupportLocalGlyph(+z)||(C.glyphs[+z]=F.glyphs[+z]);C.ranges[I]=!0}for(const z of A)z(N,F);delete C.requests[I]})),A.push((N,F)=>{N?x(N):F&&x(null,{stack:m,id:v,glyph:F.glyphs[v]||null})})},(m,v)=>{if(m)c(m);else if(v){const x={};for(const{stack:C,id:S,glyph:I}of v)void 0===x[C]&&(x[C]={}),void 0===x[C].glyphs&&(x[C].glyphs={}),x[C].glyphs[S]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[C].ascender=this.entries[C].ascender,x[C].descender=this.entries[C].descender;c(null,x)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==z0.none&&(this.localGlyphMode===z0.all?!!this.localFontFamily:!!this.localFontFamily&&(Te["CJK Unified Ideographs"](i)||Te["Hangul Syllables"](i)||Te.Hiragana(i)||Te.Katakana(i)||Te["CJK Symbols and Punctuation"](i)||Te["CJK Unified Ideographs Extension A"](i)||Te["CJK Unified Ideographs Extension B"](i)))}_tinySDF(i,s,c){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(c))return;let p=i.tinySDF;if(!p){let z="400";/bold/i.test(s)?z="900":/medium/i.test(s)?z="500":/light/i.test(s)&&(z="200"),p=i.tinySDF=new ff.TinySDF({fontFamily:u,fontWeight:z,fontSize:24*os,buffer:3*os,radius:8*os}),p.fontWeight=z}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const m=String.fromCodePoint(c),{data:v,width:x,height:C,glyphWidth:S,glyphHeight:I,glyphLeft:A,glyphTop:N,glyphAdvance:F}=p.draw(m);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new qd({width:x,height:C},v),metrics:{width:S/os,height:I/os,left:A/os,top:N/os-27,advance:F/os,localGlyph:!0}}}}ff.loadGlyphRange=function(o,i,s,c,u){const p=256*i,m=p+255,v=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${p}-${m}`),sd.Glyphs);Yo(v,(x,C)=>{if(x)u(x);else if(C){const S={},I=new Jg(C).readFields(jT,{});for(const A of I.glyphs)S[A.id]=A;u(null,{glyphs:S,ascender:I.ascender,descender:I.descender})}})},ff.TinySDF=class{constructor({fontSize:o=24,buffer:i=3,radius:s=8,cutoff:c=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=i,this.cutoff=c,this.radius=s;const v=this.size=o+4*i,x=this._createCanvas(v),C=this.ctx=x.getContext("2d",{willReadFrequently:!0});C.font=`${m} ${p} ${o}px ${u}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(o){const i=document.createElement("canvas");return i.width=i.height=o,i}draw(o){const{width:i,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(o),m=Math.ceil(s),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),x=Math.min(this.size-this.buffer,m+Math.ceil(c)),C=v+2*this.buffer,S=x+2*this.buffer,I=Math.max(C*S,0),A=new Uint8ClampedArray(I),N={data:A,width:C,height:S,glyphWidth:v,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:i};if(0===v||0===x)return N;const{ctx:F,buffer:z,gridInner:V,gridOuter:$}=this;F.clearRect(z,z,v,x),F.fillText(o,z,z+m);const ne=F.getImageData(z,z,v,x);$.fill(t_,0,I),V.fill(0,0,I);for(let ee=0;ee<x;ee++)for(let re=0;re<v;re++){const de=ne.data[4*(ee*v+re)+3]/255;if(0===de)continue;const fe=(ee+z)*C+re+z;if(1===de)$[fe]=0,V[fe]=t_;else{const _e=.5-de;$[fe]=_e>0?_e*_e:0,V[fe]=_e<0?_e*_e:0}}B0($,0,0,C,S,C,this.f,this.v,this.z),B0(V,z,z,v,x,C,this.f,this.v,this.z);for(let ee=0;ee<I;ee++){const re=Math.sqrt($[ee])-Math.sqrt(V[ee]);A[ee]=Math.round(255-255*(re/this.radius+this.cutoff))}return N}};const Qd=rs;function YM(o,i,s,c){const u=[],p=o.imagePrimary,m=p.pixelRatio,v=p.paddedRect.w-2*Qd,x=p.paddedRect.h-2*Qd,C=o.right-o.left,S=o.bottom-o.top,I=p.stretchX||[[0,v]],A=p.stretchY||[[0,x]],N=(Ne,He)=>Ne+He[1]-He[0],F=I.reduce(N,0),z=A.reduce(N,0),V=v-F,$=x-z;let ne=0,ee=F,re=0,de=z,fe=0,_e=V,De=0,Pe=$;if(p.content&&c){const Ne=p.content;ne=pf(I,0,Ne[0]),re=pf(A,0,Ne[1]),ee=pf(I,Ne[0],Ne[2]),de=pf(A,Ne[1],Ne[3]),fe=Ne[0]-ne,De=Ne[1]-re,_e=Ne[2]-Ne[0]-ee,Pe=Ne[3]-Ne[1]-de}const Be=(Ne,He,st,qe)=>{const ut=n_(Ne.stretch-ne,ee,C,o.left),Ge=i_(Ne.fixed-fe,_e,Ne.stretch,F),Qe=n_(He.stretch-re,de,S,o.top),ht=i_(He.fixed-De,Pe,He.stretch,z),$e=n_(st.stretch-ne,ee,C,o.left),xt=i_(st.fixed-fe,_e,st.stretch,F),dt=n_(qe.stretch-re,de,S,o.top),at=i_(qe.fixed-De,Pe,qe.stretch,z),jt=new _t(ut,Qe),Bt=new _t($e,Qe),Dt=new _t($e,dt),yt=new _t(ut,dt),sn=new _t(Ge/m,ht/m),Vt=new _t(xt/m,at/m),Ot=i*Math.PI/180;if(Ot){const Nn=Math.sin(Ot),_i=Math.cos(Ot),yi=[_i,-Nn,Nn,_i];jt._matMult(yi),Bt._matMult(yi),yt._matMult(yi),Dt._matMult(yi)}const gn=Ne.stretch+Ne.fixed,wn=st.stretch+st.fixed,bn=He.stretch+He.fixed,Dn=qe.stretch+qe.fixed,Ln=o.imageSecondary;return{tl:jt,tr:Bt,bl:yt,br:Dt,texPrimary:{x:p.paddedRect.x+Qd+gn,y:p.paddedRect.y+Qd+bn,w:wn-gn,h:Dn-bn},texSecondary:Ln?{x:Ln.paddedRect.x+Qd+gn,y:Ln.paddedRect.y+Qd+bn,w:wn-gn,h:Dn-bn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sn,pixelOffsetBR:Vt,minFontScaleX:_e/m/C,minFontScaleY:Pe/m/S,isSDF:s}};if(c&&(p.stretchX||p.stretchY)){const Ne=ZT(I,V,F),He=ZT(A,$,z);for(let st=0;st<Ne.length-1;st++){const qe=Ne[st],ut=Ne[st+1];for(let Ge=0;Ge<He.length-1;Ge++)u.push(Be(qe,He[Ge],ut,He[Ge+1]))}}else u.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:x+1}));return u}function pf(o,i,s){let c=0;for(const u of o)c+=Math.max(i,Math.min(s,u[1]))-Math.max(i,Math.min(s,u[0]));return c}function ZT(o,i,s){const c=[{fixed:-Qd,stretch:0}];for(const[u,p]of o){const m=c[c.length-1];c.push({fixed:u-m.stretch,stretch:m.stretch}),c.push({fixed:u-m.stretch,stretch:m.stretch+(p-u)})}return c.push({fixed:i+Qd,stretch:s}),c}function n_(o,i,s,c){return o/i*s+c}function i_(o,i,s,c){return o-i*s/c}function YT(o,i,s,c){const u=i+o.positionedLines[c].lineOffset;return 0===c?s+u/2:s+(u+(i+o.positionedLines[c-1].lineOffset))/2}function $b(o,i=1,s=!1){let c=1/0,u=1/0,p=-1/0,m=-1/0;const v=o[0];for(let N=0;N<v.length;N++){const F=v[N];(!N||F.x<c)&&(c=F.x),(!N||F.y<u)&&(u=F.y),(!N||F.x>p)&&(p=F.x),(!N||F.y>m)&&(m=F.y)}const x=Math.min(p-c,m-u);let C=x/2;const S=new Ea([],XT);if(0===x)return new _t(c,u);for(let N=c;N<p;N+=x)for(let F=u;F<m;F+=x)S.push(new Au(N+C,F+C,C,o));let I=function(N){let F=0,z=0,V=0;const $=N[0];for(let ne=0,ee=$.length,re=ee-1;ne<ee;re=ne++){const de=$[ne],fe=$[re],_e=de.x*fe.y-fe.x*de.y;z+=(de.x+fe.x)*_e,V+=(de.y+fe.y)*_e,F+=3*_e}return new Au(z/F,V/F,0,N)}(o),A=S.length;for(;S.length;){const N=S.pop();(N.d>I.d||!I.d)&&(I=N,s&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,A)),N.max-I.d<=i||(C=N.h/2,S.push(new Au(N.p.x-C,N.p.y-C,C,o)),S.push(new Au(N.p.x+C,N.p.y-C,C,o)),S.push(new Au(N.p.x-C,N.p.y+C,C,o)),S.push(new Au(N.p.x+C,N.p.y+C,C,o)),A+=4)}return s&&(console.log(`num probes: ${A}`),console.log(`best distance: ${I.d}`)),I.p}function XT(o,i){return i.max-o.max}class Au{constructor(i,s,c,u){this.p=new _t(i,s),this.h=c,this.d=function(p,m){let v=!1,x=1/0;for(let C=0;C<m.length;C++){const S=m[C];for(let I=0,A=S.length,N=A-1;I<A;N=I++){const F=S[I],z=S[N];F.y>p.y!=z.y>p.y&&p.x<(z.x-F.x)*(p.y-F.y)/(z.y-F.y)+F.x&&(v=!v),x=Math.min(x,AC(p,F,z))}}return(v?1:-1)*Math.sqrt(x)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const eh=Number.POSITIVE_INFINITY,KT=Math.sqrt(2);function V0(o,[i,s]){let c=0,u=0;if(s===eh){i<0&&(i=0);const p=i/KT;switch(o){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-i;break;case"top":u=i-7}switch(o){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=i;break;case"right":c=-i}}else{switch(i=Math.abs(i),s=Math.abs(s),o){case"top-right":case"top-left":case"top":u=s-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-s}switch(o){case"top-right":case"bottom-right":case"right":c=-i;break;case"top-left":case"bottom-left":case"left":c=i}}return[c,u]}function mf(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function JT(o,i,s,c,u,p,m,v,x,C,S,I,A,N,F){let z=p.textMaxSize.evaluate(i,{},I);void 0===z&&(z=m);const V=o.layers[0].layout,$=V.get("icon-offset").evaluate(i,{},I),ne=Gb(s.horizontal)||s.vertical,ee="globe"===A.name,re=Fo,de=m/re,fe=o.tilePixelRatio*z/re,_e=(ut=o.overscaling,o.zoom>18&&ut>2&&(ut>>=1),Math.max(ft/(512*ut),1)*V.get("symbol-spacing")),De=V.get("text-padding")*o.tilePixelRatio,Pe=V.get("icon-padding")*o.tilePixelRatio,Be=Fn(V.get("text-max-angle")),Ne="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),He="map"===V.get("icon-rotation-alignment")&&"point"!==V.get("symbol-placement"),st=V.get("symbol-placement"),qe=_e/2;var ut;const Ge=V.get("icon-text-fit").evaluate(i,{},I),Qe=V.get("icon-text-fit-padding").evaluate(i,{},I),ht="none"!==Ge;let $e;!1===o.hasAnyIconTextFit&&ht&&(o.hasAnyIconTextFit=!0),c&&ht&&(o.allowVerticalPlacement&&s.vertical&&($e=zb(c,s.vertical,Ge,Qe,$,de)),ne&&(c=zb(c,ne,Ge,Qe,$,de)));const xt=(dt,at,jt)=>{if(at.x<0||at.x>=ft||at.y<0||at.y>=ft)return;let Bt=null;if(ee){const{x:Dt,y:yt,z:sn}=A.projectTilePoint(at.x,at.y,jt);Bt={anchor:new Ml(Dt,yt,sn,0,void 0),up:A.upVector(jt,at.x,at.y)}}!function(Dt,yt,sn,Vt,Ot,gn,wn,bn,Dn,Ln,Nn,_i,yi,_n,si,ci,Ri,cr,_r,Ji,Hi,Gr,Tr,so,Si,Ds,Rl){const pa=Dt.addToLineVertexArray(yt,Vt);let Pa,lh,Pf,gm,Pc,zx,Vx,mv=0,Ux=0,jx=0,$x=0,gv=-1,Gx=-1;const ku={};let EI=eg("");const _m=sn?sn.anchor:yt,BE="none"!==Dn.layout.get("icon-text-fit").evaluate(Hi,{},Si);let zE=0,VE=0;if(void 0===Dn._unevaluatedLayout.getValue("text-radial-offset")?[zE,VE]=Dn.layout.get("text-offset").evaluate(Hi,{},Si).map(Ks=>Ks*Fo):(zE=Dn.layout.get("text-radial-offset").evaluate(Hi,{},Si)*Fo,VE=eh),Dt.allowVerticalPlacement&&Ot.vertical){const Ks=Ot.vertical;if(si)zx=Hb(Ks),bn&&(Vx=Hb(bn));else{const Ra=Dn.layout.get("text-rotate").evaluate(Hi,{},Si)+90;Pf=U0(Ln,_m,yt,Nn,_i,yi,Ks,_n,Ra,ci),bn&&(gm=U0(Ln,_m,yt,Nn,_i,yi,bn,cr,Ra))}}if(gn){const Ks=Dn.layout.get("icon-rotate").evaluate(Hi,{},Si),Ra=YM(gn,Ks,Tr,BE),S_=bn?YM(bn,Ks,Tr,BE):void 0;lh=U0(Ln,_m,yt,Nn,_i,yi,gn,cr,Ks),mv=4*Ra.length;const DI=Dt.iconSizeData;let ym=null;"source"===DI.kind?(ym=[Sc*Dn.layout.get("icon-size").evaluate(Hi,{},Si)],ym[0]>Il&&fr(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${gf}. Reduce your "icon-size".`)):"composite"===DI.kind&&(ym=[Sc*Gr.compositeIconSizes[0].evaluate(Hi,{},Si),Sc*Gr.compositeIconSizes[1].evaluate(Hi,{},Si)],(ym[0]>Il||ym[1]>Il)&&fr(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${gf}. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,Ra,ym,Ji,_r,Hi,!1,sn,yt,pa.lineStartIndex,pa.lineLength,-1,so,Si,Ds,Rl),gv=Dt.icon.placedSymbolArray.length-1,S_&&(Ux=4*S_.length,Dt.addSymbols(Dt.icon,S_,ym,Ji,_r,Hi,fa.vertical,sn,yt,pa.lineStartIndex,pa.lineLength,-1,so,Si,Ds,Rl),Gx=Dt.icon.placedSymbolArray.length-1)}for(const Ks in Ot.horizontal){const Ra=Ot.horizontal[Ks];Pa||(EI=eg(Ra.text),si?Pc=Hb(Ra):Pa=U0(Ln,_m,yt,Nn,_i,yi,Ra,_n,Dn.layout.get("text-rotate").evaluate(Hi,{},Si),ci));const S_=1===Ra.positionedLines.length;if(jx+=QT(Dt,sn,yt,Ra,wn,Dn,si,Hi,ci,pa,Ot.vertical?fa.horizontal:fa.horizontalOnly,S_?Object.keys(Ot.horizontal):[Ks],ku,gv,Gr,so,Si,Ds),S_)break}Ot.vertical&&($x+=QT(Dt,sn,yt,Ot.vertical,wn,Dn,si,Hi,ci,pa,fa.vertical,["vertical"],ku,Gx,Gr,so,Si,Ds));let Rf=-1;const UE=(Ks,Ra)=>Ks?Math.max(Ks,Ra):Ra;Rf=UE(Pc,Rf),Rf=UE(zx,Rf),Rf=UE(Vx,Rf);const jE=Rf>-1?1:0;Dt.glyphOffsetArray.length>=65535&&fr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Hi.sortKey&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,Hi.sortKey),Dt.symbolInstances.emplaceBack(yt.x,yt.y,_m.x,_m.y,_m.z,ku.right>=0?ku.right:-1,ku.center>=0?ku.center:-1,ku.left>=0?ku.left:-1,ku.vertical>=0?ku.vertical:-1,gv,Gx,EI,void 0!==Pa?Pa:Dt.collisionBoxArray.length,void 0!==Pa?Pa+1:Dt.collisionBoxArray.length,void 0!==Pf?Pf:Dt.collisionBoxArray.length,void 0!==Pf?Pf+1:Dt.collisionBoxArray.length,void 0!==lh?lh:Dt.collisionBoxArray.length,void 0!==lh?lh+1:Dt.collisionBoxArray.length,gm||Dt.collisionBoxArray.length,gm?gm+1:Dt.collisionBoxArray.length,Nn,jx,$x,mv,Ux,jE,0,zE,VE,Rf,0,BE?1:0)}(o,at,Bt,dt,s,c,u,$e,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,De,Ne,x,0,Pe,He,$,i,p,C,S,I,N,F)};if("line"===st)for(const dt of L0(i.geometry,0,0,ft,ft)){const at=ZM(dt,_e,Be,s.vertical||ne,c,re,fe,o.overscaling,ft);for(const jt of at)ne&&XM(o,ne.text,qe,jt)||xt(dt,jt,I)}else if("line-center"===st){for(const dt of i.geometry)if(dt.length>1){const at=WM(dt,Be,s.vertical||ne,c,re,fe);at&&xt(dt,at,I)}}else if("Polygon"===i.type)for(const dt of zg(i.geometry,0)){const at=$b(dt,16);xt(dt[0],new Ml(at.x,at.y,0,0,void 0),I)}else if("LineString"===i.type)for(const dt of i.geometry)xt(dt,new Ml(dt[0].x,dt[0].y,0,0,void 0),I);else if("Point"===i.type)for(const dt of i.geometry)for(const at of dt)xt([at],new Ml(at.x,at.y,0,0,void 0),I)}const gf=255,Il=gf*Sc;function QT(o,i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V,$){const ne=function(de,fe,_e,De,Pe,Be,Ne,He){const st=[];if(0===fe.positionedLines.length)return st;const qe=De.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,ut=function(xt){const dt=xt[0],at=xt[1],jt=dt*at;return jt>0?[dt,-at]:jt<0?[-dt,at]:0===dt?[at,dt]:[at,-dt]}(_e);let Ge=Math.abs(fe.top-fe.bottom);for(const xt of fe.positionedLines)Ge-=xt.lineOffset;const Qe=fe.positionedLines.length,ht=Ge/Qe;let $e=fe.top-_e[1];for(let xt=0;xt<Qe;++xt){const dt=fe.positionedLines[xt];$e=YT(fe,ht,$e,xt);for(const at of dt.positionedGlyphs){if(!at.rect)continue;const jt=at.rect||{};let Bt=Xs+1,Dt=!0,yt=1,sn=0;if(at.imageName){const Ji=Ne[at.imageName];if(!Ji)continue;if(Ji.sdf){fr("SDF images are not supported in formatted text and will be ignored.");continue}Dt=!1,yt=Ji.pixelRatio,Bt=rs/yt}const Vt=(Pe||He)&&at.vertical,Ot=at.metrics.advance*at.scale/2,gn=at.metrics,wn=at.rect;if(null===wn)continue;He&&fe.verticalizable&&(sn=at.imageName?Ot-at.metrics.width*at.scale/2:0);const bn=Pe?[at.x+Ot,at.y]:[0,0];let Dn=[0,0],Ln=[0,0],Nn=!1;Pe||(Vt?(Ln=[at.x+Ot+ut[0],at.y+ut[1]-sn],Nn=!0):Dn=[at.x+Ot+_e[0],at.y+_e[1]-sn]);const _i=wn.w*at.scale/(yt*(at.localGlyph?os:1)),yi=wn.h*at.scale/(yt*(at.localGlyph?os:1));let _n,si,ci,Ri;if(Vt){const Ji=at.y-$e,Hi=new _t(-Ot,Ot-Ji),Gr=-Math.PI/2,Tr=new _t(...Ln);_n=new _t(-Ot+Dn[0],Dn[1]),_n._rotateAround(Gr,Hi)._add(Tr),_n.x+=-Ji+Ot,_n.y-=(gn.left-Bt)*at.scale;const so=at.imageName?gn.advance*at.scale:Fo*at.scale,Si=String.fromCodePoint(at.glyph);UT(Si)?_n.x+=(1-Bt)*at.scale:HM(Si)?_n.x+=so-gn.height*at.scale+(-Bt-1)*at.scale:_n.x+=at.imageName||gn.width+2*Bt===wn.w&&gn.height+2*Bt===wn.h?(so-yi)/2:(so-(gn.height+2*Bt)*at.scale)/2,si=new _t(_n.x,_n.y-_i),ci=new _t(_n.x+yi,_n.y),Ri=new _t(_n.x+yi,_n.y-_i)}else{const Ji=(gn.left-Bt)*at.scale-Ot+Dn[0],Hi=(-gn.top-Bt)*at.scale+Dn[1],Gr=Ji+_i,Tr=Hi+yi;_n=new _t(Ji,Hi),si=new _t(Gr,Hi),ci=new _t(Ji,Tr),Ri=new _t(Gr,Tr)}if(qe){let Ji;Ji=Pe?new _t(0,0):Nn?new _t(ut[0],ut[1]):new _t(_e[0],_e[1]),_n._rotateAround(qe,Ji),si._rotateAround(qe,Ji),ci._rotateAround(qe,Ji),Ri._rotateAround(qe,Ji)}const cr=new _t(0,0),_r=new _t(0,0);st.push({tl:_n,tr:si,bl:ci,br:Ri,texPrimary:jt,texSecondary:void 0,writingMode:fe.writingMode,glyphOffset:bn,sectionIndex:at.sectionIndex,isSDF:Dt,pixelOffsetTL:cr,pixelOffsetBR:_r,minFontScaleX:0,minFontScaleY:0})}}return st}(0,c,x,p,m,v,u,o.allowVerticalPlacement),ee=o.textSizeData;let re=null;"source"===ee.kind?(re=[Sc*p.layout.get("text-size").evaluate(v,{},V)],re[0]>Il&&fr(`${o.layerIds[0]}: Value for "text-size" is >= ${gf}. Reduce your "text-size".`)):"composite"===ee.kind&&(re=[Sc*F.compositeTextSizes[0].evaluate(v,{},V),Sc*F.compositeTextSizes[1].evaluate(v,{},V)],(re[0]>Il||re[1]>Il)&&fr(`${o.layerIds[0]}: Value for "text-size" is >= ${gf}. Reduce your "text-size".`)),o.addSymbols(o.text,ne,re,x,m,v,S,i,s,C.lineStartIndex,C.lineLength,N,z,V,$,!1);for(const de of I)A[de]=o.text.placedSymbolArray.length-1;return 4*ne.length}function Gb(o){for(const i in o)return o[i];return null}function U0(o,i,s,c,u,p,m,v,x,C){let S=m.top,I=m.bottom,A=m.left,N=m.right;const F=m.collisionPadding;if(F&&(A-=F[0],S-=F[1],N+=F[2],I+=F[3]),x){const z=new _t(A,S),V=new _t(N,S),$=new _t(A,I),ne=new _t(N,I),ee=Fn(x);let re=new _t(0,0);C&&(re=new _t(C[0],C[1])),z._rotateAround(ee,re),V._rotateAround(ee,re),$._rotateAround(ee,re),ne._rotateAround(ee,re),A=Math.min(z.x,V.x,$.x,ne.x),N=Math.max(z.x,V.x,$.x,ne.x),S=Math.min(z.y,V.y,$.y,ne.y),I=Math.max(z.y,V.y,$.y,ne.y)}return o.emplaceBack(i.x,i.y,i.z,s.x,s.y,A,S,N,I,v,c,u,p),o.length-1}function Hb(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const i=o.bottom-o.top;return i>0?Math.max(10,i):null}function XM(o,i,s,c){const u=o.compareText;if(i in u){const p=u[i];for(let m=p.length-1;m>=0;m--)if(c.dist(p[m])<s)return!0}else u[i]=[];return u[i].push(c),!1}function qb(o,i){const s=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*i:0,u=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),p=Math.sin(s)*u/Math.sin(Math.max(Math.PI/2-o._pitch-s,.01)),m=Math.sin(o._pitch)*p+u;return Math.min(1.01*m,u*(1/o._horizonShift))}function th(o,i){if(!i.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:i};const s=Math.pow(2,-o.z),c=o.x*s,u=(o.x+1)*s,p=o.y*s,m=(o.y+1)*s,v=Ws(c),x=Ws(u),C=$r(p),S=$r(m),I=i.project(v,C),A=i.project(x,C),N=i.project(x,S),F=i.project(v,S);let z=Math.min(I.x,A.x,N.x,F.x),V=Math.min(I.y,A.y,N.y,F.y),$=Math.max(I.x,A.x,N.x,F.x),ne=Math.max(I.y,A.y,N.y,F.y);const ee=s/16;function re(fe,_e,De,Pe,Be,Ne){const He=(De+Be)/2,st=(Pe+Ne)/2,qe=i.project(Ws(He),$r(st)),ut=Math.max(0,z-qe.x,V-qe.y,qe.x-$,qe.y-ne);z=Math.min(z,qe.x),$=Math.max($,qe.x),V=Math.min(V,qe.y),ne=Math.max(ne,qe.y),ut>ee&&(re(fe,qe,De,Pe,He,st),re(qe,_e,He,st,Be,Ne))}re(I,A,c,p,u,p),re(A,N,u,p,u,m),re(N,F,u,m,c,m),re(F,I,c,m,c,p),z-=ee,V-=ee,$+=ee,ne+=ee;const de=1/Math.max($-z,ne-V);return{scale:de,x:z*de,y:V*de,x2:$*de,y2:ne*de,projection:i}}function Kn(o,{x:i,y:s},c=0){return new _t(((i-c)*o.scale-o.x)*ft,(s*o.scale-o.y)*ft)}const we=d.ae.identity(new Float32Array(16));class Ou{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,s){return{x:0,y:0,z:0}}unproject(i,s){return new zn(0,0)}projectTilePoint(i,s,c){return{x:i,y:s,z:0}}locationPoint(i,s,c=!0){return i._coordinatePoint(i.locationCoordinate(s),c)}pixelsPerMeter(i,s){return ro(1,i)*s}pixelSpaceConversion(i,s,c){return 1}farthestPixelDistance(i){return qb(i,i.pixelsPerMeter)}pointCoordinate(i,s,c,u){const p=i.horizonLineFromTop(!1),m=new _t(s,Math.max(p,c));return i.rayIntersectionCoordinate(i.pointRayIntersection(m,u))}pointCoordinate3D(i,s,c){const u=new _t(s,c);if(i.elevation)return i.elevation.pointCoordinate(u);{const p=this.pointCoordinate(i,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(i,s){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,s.x,s.y);const c=i.horizonLineFromTop();return s.y<c}createInversionMatrix(i,s){return we}createTileMatrix(i,s,c){let u,p,m;const v=c.canonical,x=d.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=th(v,this);u=1,p=C.x+c.wrap*C.scale,m=C.y,d.ae.scale(x,x,[u/C.scale,u/C.scale,i.pixelsPerMeter/s])}else u=s/i.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*c.wrap)*u,m=v.y*u;return d.ae.translate(x,x,[p,m,0]),d.ae.scale(x,x,[u/ft,u/ft,1]),x}upVector(i,s,c){return[0,0,1]}upVectorScale(i,s,c){return{metersToTile:1}}}class tt extends Ou{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[s,c]=this.parallels=i.parallels||[29.5,45.5],u=Math.sin(Fn(s));this.n=(u+Math.sin(Fn(c)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(i,s){const{n:c,c:u,r0:p}=this,m=Fn(i-this.center[0]),v=Fn(s),x=Math.sqrt(u-2*c*Math.sin(v))/c;return{x:x*Math.sin(m*c),y:x*Math.cos(m*c)-p,z:0}}unproject(i,s){const{n:c,c:u,r0:p}=this,m=p+s;let v=Math.atan2(i,Math.abs(m))*Math.sign(m);m*c<0&&(v-=Math.PI*Math.sign(i)*Math.sign(m));const x=Fn(this.center[0])*c;v=Yl(v,-Math.PI-x,Math.PI-x);const C=Sn(So(v/c)+this.center[0],-180,180),S=Math.asin(Sn((u-(i*i+m*m)*c*c)/(2*c),-1,1)),I=Sn(So(S),-wr,wr);return new zn(C,I)}}const Qp=1.340264,em=-.081106,r_=893e-6,nh=.003796,Mc=Math.sqrt(3)/2;class Wb extends Ou{project(i,s){s=s/180*Math.PI,i=i/180*Math.PI;const c=Math.asin(Mc*Math.sin(s)),u=c*c,p=u*u*u;return{x:.5*(i*Math.cos(c)/(Mc*(Qp+3*em*u+p*(7*r_+9*nh*u)))/Math.PI+.5),y:1-.5*(c*(Qp+em*u+p*(r_+nh*u))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,u=c*c,p=u*u*u;for(let S,I,A,N=0;N<12&&(I=c*(Qp+em*u+p*(r_+nh*u))-s,A=Qp+3*em*u+p*(7*r_+9*nh*u),S=I/A,c=Sn(c-S,-Math.PI/3,Math.PI/3),u=c*c,p=u*u*u,!(Math.abs(S)<1e-12));++N);const m=Mc*i*(Qp+3*em*u+p*(7*r_+9*nh*u))/Math.cos(c),v=Math.asin(Math.sin(c)/Mc),x=Sn(180*m/Math.PI,-180,180),C=Sn(180*v/Math.PI,-wr,wr);return new zn(x,C)}}class o_ extends Ou{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){return{x:.5+i/360,y:.5-s/360,z:0}}unproject(i,s){const c=360*(i-.5),u=Sn(360*(.5-s),-wr,wr);return new zn(c,u)}}const _f=Math.PI/2;function tm(o){return Math.tan((_f+o)/2)}class Zb extends Ou{constructor(i){super(i),this.center=i.center||[0,30];const[s,c]=this.parallels=i.parallels||[30,30];let u=Fn(s),p=Fn(c);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const m=Math.cos(u),v=tm(u);this.n=u===p?Math.sin(u):Math.log(m/Math.cos(p))/Math.log(tm(p)/v),this.f=m*Math.pow(tm(u),this.n)/this.n}project(i,s){s=Fn(s),this.southernCenter&&(s=-s),i=Fn(i-this.center[0]);const c=1e-6,{n:u,f:p}=this;p>0?s<-_f+c&&(s=-_f+c):s>_f-c&&(s=_f-c);const m=p/Math.pow(tm(s),u);let v=m*Math.sin(u*i),x=p-m*Math.cos(u*i);return v=.5*(v/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:v,y:this.southernCenter?x:1-x,z:0}}unproject(i,s){i=(2*i-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:u}=this,p=u-s,m=Math.sign(p),v=Math.sign(c)*Math.sqrt(i*i+p*p);let x=Math.atan2(i,Math.abs(p))*m;p*c<0&&(x-=Math.PI*Math.sign(i)*m);const C=Sn(So(x/c)+this.center[0],-180,180),S=Sn(So(2*Math.atan(Math.pow(u/v,1/c))-_f),-wr,wr);return new zn(C,this.southernCenter?-S:S)}}class j0 extends Ou{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,s){return{x:da(i),y:bc(s),z:0}}unproject(i,s){const c=Ws(i),u=$r(s);return new zn(c,u)}}const Yb=Fn(wr);class Xb extends Ou{project(i,s){const c=(s=Fn(s))*s,u=c*c;return{x:.5*((i=Fn(i))*(.8707-.131979*c+u*(u*(.003971*c-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+u*(.028874*c-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,u=25,p=0,m=c*c;do{m=c*c;const C=m*m;p=(c*(1.007226+m*(.015085+C*(.028874*m-.044475-.005916*C)))-s)/(1.007226+m*(.045255+C*(.259866*m-.311325-.005916*11*C))),c=Sn(c-p,-Yb,Yb)}while(Math.abs(p)>1e-6&&--u>0);m=c*c;const v=Sn(So(i/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=So(c);return new zn(v,x)}}const eE=Fn(wr);class KM extends Ou{project(i,s){s=Fn(s),i=Fn(i);const c=Math.cos(s),u=2/Math.PI,p=Math.acos(c*Math.cos(i/2)),m=Math.sin(p)/p,v=.5*(i*u+2*c*Math.sin(i/2)/m)||0,x=.5*(s+Math.sin(s)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(i,s){let c=i=(2*i-.5)*Math.PI,u=s=(2*(1-s)-1)*Math.PI,p=25;const m=1e-6;let v=0,x=0;do{const C=Math.cos(u),S=Math.sin(u),I=2*S*C,A=S*S,N=C*C,F=Math.cos(c/2),z=Math.sin(c/2),V=2*F*z,$=z*z,ne=1-N*F*F,ee=ne?1/ne:0,re=ne?Math.acos(C*F)*Math.sqrt(1/ne):0,de=.5*(2*re*C*z+2*c/Math.PI)-i,fe=.5*(re*S+u)-s,_e=.5*ee*(N*$+re*C*F*A)+1/Math.PI,De=ee*(V*I/4-re*S*z),Pe=.125*ee*(I*z-re*S*N*V),Be=.5*ee*(A*F+re*$*C)+.5,Ne=De*Pe-Be*_e;v=(fe*De-de*Be)/Ne,x=(de*Pe-fe*_e)/Ne,c=Sn(c-v,-Math.PI,Math.PI),u=Sn(u-x,-eE,eE)}while((Math.abs(v)>m||Math.abs(x)>m)&&--p>0);return new zn(So(c),So(u))}}class tE extends Ou{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Fn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){const{scale:c,cosPhi:u}=this;return{x:Fn(i)*u*c+.5,y:-Math.sin(Fn(s))/u*c+.5,z:0}}unproject(i,s){const{scale:c,cosPhi:u}=this,p=-(s-.5)/c,m=Sn(So((i-.5)/c)/u,-180,180),v=Math.asin(Sn(p*u,-1,1)),x=Sn(So(v),-wr,wr);return new zn(m,x)}}class nE extends j0{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,s,c){const u=r0(i,s,c),p=Og(El(c));return d.$.transformMat4(u,u,p),{x:u[0],y:u[1],z:u[2]}}locationPoint(i,s){const c=Vd(s.lat,s.lng),u=d.$.normalize([],c),p=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(s),i._centerAltitude):i._centerAltitude,m=ro(1,0)*ft*p;d.$.scaleAndAdd(c,c,u,m);const v=d.ae.identity(new Float64Array(16));return d.ae.multiply(v,i.pixelMatrix,i.globeMatrix),d.$.transformMat4(c,c,v),new _t(c[0],c[1])}pixelsPerMeter(i,s){return ro(1,0)*s}pixelSpaceConversion(i,s,c){const u=ro(1,i)*s,p=Yt(ro(1,45)*s,u,c);return this.pixelsPerMeter(i,s)/p}createTileMatrix(i,s,c){const u=Gd(El(c.canonical));return d.ae.multiply(new Float64Array(16),i.globeMatrix,u)}createInversionMatrix(i,s){const{center:c}=i,u=Og(El(s));return d.ae.rotateY(u,u,Fn(c.lng)),d.ae.rotateX(u,u,Fn(c.lat)),d.ae.scale(u,u,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(i,s,c,u){return fM(i,s,c,!0)||new ko(0,0)}pointCoordinate3D(i,s,c){const u=this.pointCoordinate(i,s,c,0);return[u.x,u.y,u.z]}isPointAboveHorizon(i,s){return!fM(i,s.x,s.y,!1)}farthestPixelDistance(i){const s=function(u,p){const m=u.cameraToCenterDistance,v=u._centerAltitude*p,x=u._camera,C=u._camera.forward(),S=d.$.add([],d.$.scale([],C,-m),[0,0,v]),I=u.worldSize/(2*Math.PI),A=[0,0,-I],N=u.width/u.height,F=Math.tan(u.fovAboveCenter),z=d.$.scale([],x.up(),F),V=d.$.scale([],x.right(),F*N),$=d.$.normalize([],d.$.add([],d.$.add([],C,z),V)),ne=[];let ee;if(new Y1(S,$).closestPointOnSphere(A,I,ne)){const re=d.$.add([],ne,A),de=d.$.sub([],re,S);ee=Math.cos(u.fovAboveCenter)*d.$.length(de)}else{const re=d.$.sub([],S,A),de=d.$.sub([],A,S);d.$.normalize(de,de);const fe=d.$.length(re)-I;ee=Math.sqrt(fe*(fe+2*I));const _e=Math.acos(ee/(I+fe))-Math.acos(d.$.dot(C,de));ee*=Math.cos(_e)}return 1.01*ee}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),c=Hd(i.zoom);if(c>0){const u=qb(i,ro(1,i.center.lat)*i.worldSize),p=i.worldSize/(2*Math.PI),m=Math.max(i.width,i.height)/i.worldSize*Math.PI;return Yt(s,u+p*(1-Math.cos(m)),Math.pow(c,10))}return s}upVector(i,s,c){return r0(s,c,i,1)}upVectorScale(i){return{metersToTile:K1(tb(El(i)))}}}function iE(o){const i=o.parallels,s=!!i&&Math.abs(i[0]+i[1])<.01;switch(o.name){case"mercator":return new j0(o);case"equirectangular":return new o_(o);case"naturalEarth":return new Xb(o);case"equalEarth":return new Wb(o);case"winkelTripel":return new KM(o);case"albers":return s?new tE(o):new tt(o);case"lambertConformalConic":return s?new tE(o):new Zb(o);case"globe":return new nE(o)}throw new Error(`Invalid projection name: ${o.name}`)}const JM=Kd.types,QM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $0(o,i,s,c,u,p,m,v,x,C,S,I,A){const N=v?Math.min(Il,Math.round(v[0])):0,F=v?Math.min(Il,Math.round(v[1])):0;o.emplaceBack(i,s,Math.round(32*c),Math.round(32*u),p,m,(N<<1)+(x?1:0),F,16*C,16*S,256*I,256*A)}function s_(o,i,s){o.emplaceBack(i,s)}function a_(o,i,s,c,u,p,m){o.emplaceBack(i,s,c,u,p,m)}function G0(o,i,s,c,u){o.emplaceBack(i,s,c,u),o.emplaceBack(i,s,c,u),o.emplaceBack(i,s,c,u),o.emplaceBack(i,s,c,u)}function eI(o){for(const i of o.sections)if(rn(i.text))return!0;return!1}class Ts{constructor(i){this.layoutVertexArray=new Uy,this.indexArray=new Xi,this.programConfigurations=i,this.segments=new Ki,this.dynamicLayoutVertexArray=new io,this.opacityVertexArray=new $y,this.placedSymbolArray=new mt,this.iconTransitioningVertexArray=new Ka,this.globeExtVertexArray=new jy,this.zOffsetVertexArray=new kd}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(i,s,c,u,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,MT.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,iP.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,QM,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,Db.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,nP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,RM.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||u)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ee(Ts,"SymbolBuffers");class Kb{constructor(i,s,c){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Ki,this.collisionVertexArray=new yg,this.collisionVertexArrayExt=new io}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Sb.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,rP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ee(Kb,"CollisionBuffers");class nm{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=d.ae.identity([]),this.placementViewportMatrix=d.ae.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zT(this.zoom,s["text-size"]),this.iconSizeData=zT(this.zoom,s["icon-size"]);const c=this.layers[0].layout,u=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>fa[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Ts(new ua(this.layers,{zoom:this.zoom,lut:this.lut},i=>/^text/.test(i))),this.icon=new Ts(new ua(this.layers,{zoom:this.zoom,lut:this.lut},i=>/^icon/.test(i))),this.glyphOffsetArray=new Kt,this.lineVertexArray=new Wi,this.symbolInstances=new Xt}calculateGlyphDependencies(i,s,c,u,p){for(let m=0;m<i.length;m++){const v=i.codePointAt(m);if(void 0===v)break;if(s[v]=!0,u&&p&&v<=65535){const x=Yp[i.charAt(m)];x&&(s[x.charCodeAt(0)]=!0)}}}updateFootprints(i,s){}updateReplacement(i,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!_b(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(i,s,c,u){const p=this.layers[0],m=p.layout,v="globe"===this.projection.name,x=m.get("text-font"),C=m.get("text-field"),S=m.get("icon-image"),I=("constant"!==C.value.kind||C.value.value instanceof fo&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),A="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,N=m.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const F=s.iconDependencies,z=s.glyphDependencies,V=s.availableImages,$=new cn(this.zoom);for(const{feature:ne,id:ee,index:re,sourceLayerIndex:de}of i){const fe=p._featureFilter.needGeometry,_e=xc(ne,fe);if(!p._featureFilter.filter($,_e,c))continue;if(fe||(_e.geometry=el(ne,c,u)),v&&1!==ne.type&&c.z<=5){const Ne=_e.geometry,He=.98078528056,st=(qe,ut)=>{const Ge=r0(qe.x,qe.y,c,1),Qe=r0(ut.x,ut.y,c,1);return d.$.dot(Ge,Qe)<He};for(let qe=0;qe<Ne.length;qe++)Ne[qe]=e0(Ne[qe],st)}let De,Pe;if(I){const Ne=p.getValueAndResolveTokens("text-field",_e,c,V),He=fo.factory(Ne);eI(He)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===nn()||this.hasRTLText&&kn.isParsed())&&(De=VT(He,p,_e))}if(A){const Ne=p.getValueAndResolveTokens("icon-image",_e,c,V);Pe=Ne instanceof Rr?Ne:Rr.fromString(Ne)}if(!De&&!Pe)continue;const Be=this.sortFeaturesByKey?N.evaluate(_e,{},c):void 0;if(this.features.push({id:ee,text:De,icon:Pe,index:re,sourceLayerIndex:de,geometry:_e.geometry,properties:ne.properties,type:JM[ne.type],sortKey:Be}),Pe&&(F[Pe.namePrimary]=!0,Pe.nameSecondary&&(F[Pe.nameSecondary]=!0)),De){const Ne=x.evaluate(_e,{},c).join(","),He="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fa.vertical)>=0;for(const st of De.sections)if(st.image)F[st.image.namePrimary]=!0;else{const qe=Ke(De.toString()),ut=st.fontStack||Ne,Ge=z[ut]=z[ut]||{};this.calculateGlyphDependencies(st.text,Ge,He,this.allowVerticalPlacement,qe)}}}"line"===m.get("symbol-placement")&&(this.features=function(ne){const ee={},re={},de=[];let fe=0;function _e(Ne){de.push(ne[Ne]),fe++}function De(Ne,He,st){const qe=re[Ne];return delete re[Ne],re[He]=qe,de[qe].geometry[0].pop(),de[qe].geometry[0]=de[qe].geometry[0].concat(st[0]),qe}function Pe(Ne,He,st){const qe=ee[He];return delete ee[He],ee[Ne]=qe,de[qe].geometry[0].shift(),de[qe].geometry[0]=st[0].concat(de[qe].geometry[0]),qe}function Be(Ne,He,st){const qe=st?He[0][He[0].length-1]:He[0][0];return`${Ne}:${qe.x}:${qe.y}`}for(let Ne=0;Ne<ne.length;Ne++){const He=ne[Ne],st=He.geometry,qe=He.text?He.text.toString():null;if(!qe){_e(Ne);continue}const ut=Be(qe,st),Ge=Be(qe,st,!0);if(ut in re&&Ge in ee&&re[ut]!==ee[Ge]){const Qe=Pe(ut,Ge,st),ht=De(ut,Ge,de[Qe].geometry);delete ee[ut],delete re[Ge],re[Be(qe,de[ht].geometry,!0)]=ht,de[Qe].geometry=null}else ut in re?De(ut,Ge,st):Ge in ee?Pe(ut,Ge,st):(_e(Ne),ee[ut]=fe-1,re[Ge]=fe-1)}return de.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,ee)=>ne.sortKey-ee.sortKey)}update(i,s,c,u,p){const m=0!==Object.keys(i).length;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(i,s,v,c,u,p),this.icon.programConfigurations.updatePaintArrays(i,s,v,c,u,p)}updateZOffset(){const i=(p,m,v)=>{c+=m,c>p.length&&p.resize(c);for(let x=-m;x<0;x++)p.emplace(x+c,v)},s=(p,m,v)=>{u+=m,u>p.length&&p.resize(u);for(let x=-m;x<0;x++)p.emplace(x+u,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,u=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:x,numIconVertices:C}=m,S=m.zOffset,I=C>0;if((v>0||x>0)&&(i(this.text.zOffsetVertexArray,v,S),i(this.text.zOffsetVertexArray,x,S)),I){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:N}=m;A>=0&&s(this.icon.zOffsetVertexArray,C,S),N>=0&&s(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,S)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=iE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,s){const c=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:u,y:p}of s)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,s,c,u,p,m,v,x,C,S,I,A,N,F,z,V){const $=i.indexArray,ne=i.layoutVertexArray,ee=i.globeExtVertexArray,re=i.segments.prepareSegment(4*s.length,ne,$,this.canOverlap?m.sortKey:void 0),de=this.glyphOffsetArray.length,fe=re.vertexLength,_e=this.allowVerticalPlacement&&v===fa.vertical?Math.PI/2:0,De=m.text&&m.text.sections;for(let Be=0;Be<s.length;Be++){const{tl:Ne,tr:He,bl:st,br:qe,texPrimary:ut,texSecondary:Ge,pixelOffsetTL:Qe,pixelOffsetBR:ht,minFontScaleX:$e,minFontScaleY:xt,glyphOffset:dt,isSDF:at,sectionIndex:jt}=s[Be],Bt=re.vertexLength,Dt=dt[1];if($0(ne,C.x,C.y,Ne.x,Dt+Ne.y,ut.x,ut.y,c,at,Qe.x,Qe.y,$e,xt),$0(ne,C.x,C.y,He.x,Dt+He.y,ut.x+ut.w,ut.y,c,at,ht.x,Qe.y,$e,xt),$0(ne,C.x,C.y,st.x,Dt+st.y,ut.x,ut.y+ut.h,c,at,Qe.x,ht.y,$e,xt),$0(ne,C.x,C.y,qe.x,Dt+qe.y,ut.x+ut.w,ut.y+ut.h,c,at,ht.x,ht.y,$e,xt),x){const{x:yt,y:sn,z:Vt}=x.anchor,[Ot,gn,wn]=x.up;a_(ee,yt,sn,Vt,Ot,gn,wn),a_(ee,yt,sn,Vt,Ot,gn,wn),a_(ee,yt,sn,Vt,Ot,gn,wn),a_(ee,yt,sn,Vt,Ot,gn,wn),G0(i.dynamicLayoutVertexArray,yt,sn,Vt,_e)}else G0(i.dynamicLayoutVertexArray,C.x,C.y,C.z,_e);if(V){const yt=Ge||ut;s_(i.iconTransitioningVertexArray,yt.x,yt.y),s_(i.iconTransitioningVertexArray,yt.x+yt.w,yt.y),s_(i.iconTransitioningVertexArray,yt.x,yt.y+yt.h),s_(i.iconTransitioningVertexArray,yt.x+yt.w,yt.y+yt.h)}$.emplaceBack(Bt,Bt+1,Bt+2),$.emplaceBack(Bt+1,Bt+2,Bt+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),Be!==s.length-1&&jt===s[Be+1].sectionIndex||i.programConfigurations.populatePaintArrays(ne.length,m,m.index,{},N,F,z,De&&De[jt])}const Pe=x?x.anchor:C;i.placedSymbolArray.emplaceBack(Pe.x,Pe.y,Pe.z,C.x,C.y,de,this.glyphOffsetArray.length-de,fe,S,I,C.segment,c?c[0]:0,c?c[1]:0,u[0],u[1],v,0,!1,0,A,0)}_commitLayoutVertex(i,s,c,u,p,m,v){i.emplaceBack(s,c,u,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(i,s,c,u,p,m,v){const x=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),C=x.vertexLength,S=v.tileAnchorX,I=v.tileAnchorY;for(let N=0;N<4;N++)c.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,s,i.padding,v.zOffset),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,S,I,new _t(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,S,I,new _t(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,S,I,new _t(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,S,I,new _t(i.x1,i.y2)),x.vertexLength+=4;const A=c.indexArray;A.emplaceBack(C,C+1),A.emplaceBack(C+1,C+2),A.emplaceBack(C+2,C+3),A.emplaceBack(C+3,C),x.primitiveLength+=4}_addTextDebugCollisionBoxes(i,s,c,u,p,m){for(let v=u;v<p;v++){const x=c.get(v),C=this.getSymbolInstanceTextSize(i,m,s,v);this._addCollisionDebugVertices(x,C,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(i,s,c,u,p,m){for(let v=u;v<p;v++){const x=c.get(v),C=this.getSymbolInstanceIconSize(i,s,m.placedIconSymbolIndex);this._addCollisionDebugVertices(x,C,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kb(rf,NM.members,Ka),this.iconCollisionBox=new Kb(rf,NM.members,Ka);const c=Iu(this.iconSizeData,i),u=Iu(this.textSizeData,i);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,i,s,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,i,s,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,i,s,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,i,s,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(i,s,c,u){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:u),m=P0(this.textSizeData,i,p)/Fo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(i,s,c){const u=this.icon.placedSymbolArray.get(c),p=P0(this.iconSizeData,i,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(i,s,c,u){i.emplaceBack(s,-c,-c,u),i.emplaceBack(s,c,-c,u),i.emplaceBack(s,c,c,u),i.emplaceBack(s,-c,c,u)}_updateTextDebugCollisionBoxes(i,s,c,u,p,m){for(let v=u;v<p;v++){const x=c.get(v),C=this.getSymbolInstanceTextSize(i,m,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,x.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(i,s,c,u,p,m){for(let v=u;v<p;v++){const x=c.get(v),C=this.getSymbolInstanceIconSize(i,s,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,x.padding,m.zOffset)}}updateCollisionDebugBuffers(i,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Iu(this.iconSizeData,i),u=Iu(this.textSizeData,i);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,i,s,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,i,s,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,i,s,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,i,s,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,s,c,u,p,m,v,x,C){const S={};if(s<c){const{x1:I,y1:A,x2:N,y2:F,padding:z,projectedAnchorX:V,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ee,tileAnchorY:re,featureIndex:de}=i.get(s);S.textBox={x1:I,y1:A,x2:N,y2:F,padding:z,projectedAnchorX:V,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ee,tileAnchorY:re},S.textFeatureIndex=de}if(u<p){const{x1:I,y1:A,x2:N,y2:F,padding:z,projectedAnchorX:V,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ee,tileAnchorY:re,featureIndex:de}=i.get(u);S.verticalTextBox={x1:I,y1:A,x2:N,y2:F,padding:z,projectedAnchorX:V,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ee,tileAnchorY:re},S.verticalTextFeatureIndex=de}if(m<v){const{x1:I,y1:A,x2:N,y2:F,padding:z,projectedAnchorX:V,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ee,tileAnchorY:re,featureIndex:de}=i.get(m);S.iconBox={x1:I,y1:A,x2:N,y2:F,padding:z,projectedAnchorX:V,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ee,tileAnchorY:re},S.iconFeatureIndex=de}if(x<C){const{x1:I,y1:A,x2:N,y2:F,padding:z,projectedAnchorX:V,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ee,tileAnchorY:re,featureIndex:de}=i.get(x);S.verticalIconBox={x1:I,y1:A,x2:N,y2:F,padding:z,projectedAnchorX:V,projectedAnchorY:$,projectedAnchorZ:ne,tileAnchorX:ee,tileAnchorY:re},S.verticalIconFeatureIndex=de}return S}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,s){const c=i.placedSymbolArray.get(s),u=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<u;p+=4)i.indexArray.emplaceBack(p,p+1,p+2),i.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(i),c=Math.cos(i),u=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const x=this.symbolInstances.get(v);u.push(0|Math.round(s*x.tileAnchorX+c*x.tileAnchorY)),p.push(x.featureIndex)}return m.sort((v,x)=>u[v]-u[x]||p[x]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:C}=c;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ee(nm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),nm.addDynamicAttributes=G0;class Al{constructor(i,s,c,u){this.context=i,this.format=c,this.texture=i.gl.createTexture(),this.update(s,u)}update(i,s,c){const{width:u,height:p}=i,{context:m}=this,{gl:v}=m;if(v.bindTexture(v.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||!1!==s.premultiply)),this.useMipmap=!(!s||!s.useMipmap),c||this.size&&this.size[0]===u&&this.size[1]===p){const{x,y:C}=c||{x:0,y:0};if(i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap)v.texSubImage2D(v.TEXTURE_2D,0,x,C,v.RGBA,v.UNSIGNED_BYTE,i);else{let S=this.format,I=v.UNSIGNED_BYTE;this.format===v.R32F&&(S=v.RED,I=v.FLOAT),v.texSubImage2D(v.TEXTURE_2D,0,x,C,u,p,S,I,i.data)}}else if(this.size=[u,p],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap){let x=this.format;this.format===v.R8&&(x=v.RED),v.texImage2D(v.TEXTURE_2D,0,this.format,x,v.UNSIGNED_BYTE,i)}else{let x=this.format,C=this.format,S=v.UNSIGNED_BYTE,I=!1;this.format===v.DEPTH_COMPONENT&&(x=v.DEPTH_COMPONENT16,S=v.UNSIGNED_SHORT),this.format===v.DEPTH_STENCIL&&(x=v.DEPTH24_STENCIL8,S=v.UNSIGNED_INT_24_8,I=!0),this.format===v.R8&&(C=v.RED),this.format===v.R32F&&(S=v.FLOAT,C=v.RED),!this.useMipmap&&I?v.texStorage2D(v.TEXTURE_2D,1,x,u,p):v.texImage2D(v.TEXTURE_2D,0,x,u,p,0,C,S,i.data)}this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(i,s,c=!1){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!c?i===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(i,s,c,u){const{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),this.magFilter=s),i!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?i===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),u!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class im{constructor(i,s){this.context=i,this.texture=s}bind(i,s){const{context:c}=this,{gl:u}=c;u.bindTexture(u.TEXTURE_2D,this.texture),i!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,i),this.minFilter=i),s!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,s),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,s),this.wrapS=s)}}const ih=new Uint16Array(8184);for(let o=0;o<2046;o++){let i=o+2,s=0,c=0,u=0,p=0,m=0,v=0;for(1&i?u=p=m=32:s=c=v=32;(i>>=1)>1;){const C=s+u>>1,S=c+p>>1;1&i?(u=s,p=c,s=m,c=v):(s=u,c=p,u=m,p=v),m=C,v=S}const x=4*o;ih[x+0]=s,ih[x+1]=c,ih[x+2]=u,ih[x+3]=p}const Ac=new Uint16Array(2178),Pu=new Uint8Array(1089),H0=new Uint16Array(1089);function rE(o){return 0===o?-.03125:32===o?.03125:0}var rm=tn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let tI=(()=>{class o{constructor(s,c,u,p){this.id=o.uniqueIdxCounter,o.uniqueIdxCounter++,this.context=s;const m=s.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||p||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=o.uniqueIdxCounter,o.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return o.uniqueIdxCounter=0,o})();class om{constructor(i,s,c){this.func=i,this.mask=s,this.range=c}}om.ReadOnly=!1,om.ReadWrite=!0,om.disabled=new om(519,om.ReadOnly,[0,1]);class Qb{constructor(i,s,c,u,p,m){this.test=i,this.ref=s,this.mask=c,this.fail=u,this.depthFail=p,this.pass=m}}Qb.disabled=new Qb({func:519,mask:0},0,0,7680,7680,7680);class Br{constructor(i,s,c,u){this.blendFunction=i,this.blendColor=s,this.mask=c,this.blendEquation=u}}Br.Replace=[1,0,1,0],Br.disabled=new Br(Br.Replace,ni.transparent,[!1,!1,!1,!1]),Br.unblended=new Br(Br.Replace,ni.transparent,[!0,!0,!0,!0]),Br.alphaBlended=new Br([1,771,1,771],ni.transparent,[!0,!0,!0,!0]),Br.alphaBlendedNonPremultiplied=new Br([770,771,770,771],ni.transparent,[!0,!0,!0,!0]),Br.multiply=new Br([774,0,774,0],ni.transparent,[!0,!0,!0,!0]);class Ol{constructor(i,s,c){this.enable=i,this.mode=s,this.frontFace=c}}Ol.disabled=new Ol(!1,1029,2305),Ol.backCCW=new Ol(!0,1029,2305),Ol.backCW=new Ol(!0,1029,2304),Ol.frontCW=new Ol(!0,1028,2304),Ol.frontCCW=new Ol(!0,1028,2305);var oE=tn([{name:"a_index",type:"Int16",components:1}]);const tx={type:2,extent:ft,loadGeometry:()=>[[new _t(0,0),new _t(ft+1,0),new _t(ft+1,ft+1),new _t(0,ft+1),new _t(0,0)]]};class yf{constructor(i,s,c,u,p){this.tileID=i,this.uid=$m(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(i){const s=i+this.timeAdded;s<Mo.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=th(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,s,c){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(u,p){const m={};if(!p)return m;for(const v of u){const x=v.layerIds.map(C=>p.getLayer(C)).filter(Boolean);if(0!==x.length){v.layers=x,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(C=>x.filter(S=>S.id===C)[0]));for(const C of x)m[C.fqid]=v}}return m}(i.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof nm){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof nm&&p.hasRTLText){this.hasRTLText=!0,kn.isLoading()||kn.isLoaded()||"deferred"!==nn()||Bn();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u],m=s.style.getOwnLayer(u);if(!m)continue;const v=m.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,v)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new L1}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(i)}const s=i.gl,c=this.imageAtlas;if(c&&!c.uploaded){const u=!!Object.keys(c.patternPositions).length;this.imageAtlasTexture=new Al(i,c.image,s.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Al(i,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Al(i,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(i,s,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,c),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const u=s.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,s)))}queryRenderedFeatures(i,s,c,u,p,m,v,x){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:v,transform:m,params:p,tileTransform:this.tileTransform},i,s,c):{}}querySourceFeatures(i,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const u=c.loadVTLayers(),p=s?s.sourceLayer:"",m=u._geojsonTileLayer||u[p];if(!m)return;const v=Xa(s&&s.filter),{z:x,x:C,y:S}=this.tileID.canonical,I={z:x,x:C,y:S};for(let A=0;A<m.length;A++){const N=m.feature(A);if(v.needGeometry){const V=xc(N,!0);if(!v.filter(new cn(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!v.filter(new cn(this.tileID.overscaledZ),N))continue;const F=c.getId(N,p),z=new $M(N,x,C,S,F);z.tile=I,i.push(z)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const s=this.expirationTime;if(i.cacheControl){const c=Ph(i.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const c=Date.now();let u=!1;if(this.expirationTime>c)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=c+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,s){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(i).length&&s&&this.updateBuckets(i,s)}updateBuckets(i,s){if(!this.latestFeatureIndex)return;const c=this.latestFeatureIndex.loadVTLayers(),u=s.style.listImages(),p=s.style.getBrightness();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const v=this.buckets[m],x=v.layers[0].sourceLayer||"_geojsonTileLayer",C=c[x];let S={};if(i&&(S=i[x],!C||!S||0===Object.keys(S).length))continue;if(v.update(S,C,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),v instanceof S0||v instanceof u0){const A=s.style.getOwnSourceCache(v.layers[0].source);s._terrain&&s._terrain.enabled&&A&&v.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(A.id,this.tileID)}const I=s&&s.style&&s.style.getOwnLayer(m);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Mo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Mo.now()+i}setTexture(i,s){const c=s.context,u=c.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture&&this.texture instanceof Al?this.texture.update(i,{useMipmap:!0}):(this.texture=new Al(c,i,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(i,s){const c={};for(const u of s)c[u]=!0;this.dependencies[i]=c}hasDependency(i,s){for(const c of i){const u=this.dependencies[c];if(u)for(const p of s)if(u[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const c=el(tx,this.tileID.canonical,this.tileTransform)[0],u=new $s,p=new vg;for(let m=0;m<c.length;m++){const{x:v,y:x}=c[m];u.emplaceBack(v,x),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(p),this._tileDebugBuffer=i.createVertexBuffer(u,Ag.members),this._tileDebugSegments=Ki.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(i,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const c=el(tx,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const m=function(v,x){const C=th(v,x),S=Math.pow(2,v.z);for(let V=0;V<33;V++)for(let $=0;$<33;$++){const ne=Ws((v.x+($+rE($))/32)/S),ee=$r((v.y+(V+rE(V))/32)/S),re=x.project(ne,ee),de=33*V+$;Ac[2*de+0]=Math.round((re.x*C.scale-C.x)*ft),Ac[2*de+1]=Math.round((re.y*C.scale-C.y)*ft)}Pu.fill(0),H0.fill(0);for(let V=2045;V>=0;V--){const $=4*V,ne=ih[$+0],ee=ih[$+1],re=ih[$+2],de=ih[$+3],fe=ne+re>>1,_e=ee+de>>1,De=fe+_e-ee,Pe=_e+ne-fe,Be=33*ee+ne,Ne=33*de+re,He=33*_e+fe,st=Math.hypot((Ac[2*Be+0]+Ac[2*Ne+0])/2-Ac[2*He+0],(Ac[2*Be+1]+Ac[2*Ne+1])/2-Ac[2*He+1])>=16;Pu[He]=Pu[He]||(st?1:0),V<1022&&(Pu[He]=Pu[He]||Pu[33*(ee+Pe>>1)+(ne+De>>1)]||Pu[33*(de+Pe>>1)+(re+De>>1)])}const I=new vu,A=new Xi;let N=0;function F(V,$){const ne=33*$+V;return 0===H0[ne]&&(I.emplaceBack(Ac[2*ne+0],Ac[2*ne+1],V*ft/32,$*ft/32),H0[ne]=++N),H0[ne]-1}function z(V,$,ne,ee,re,de){const fe=V+ne>>1,_e=$+ee>>1;if(Math.abs(V-re)+Math.abs($-de)>1&&Pu[33*_e+fe])z(re,de,V,$,fe,_e),z(ne,ee,re,de,fe,_e);else{const De=F(V,$),Pe=F(ne,ee),Be=F(re,de);A.emplaceBack(De,Pe,Be)}}return z(0,0,32,32,32,0),z(32,32,0,0,0,32),{vertices:I,indices:A}}(this.tileID.canonical,s);u=m.vertices,p=m.indices}else{u=new vu,p=new Xi;for(const{x:v,y:x}of c)u.emplaceBack(v,x,0,0);const m=Bp(u.int16,void 0,4);for(let v=0;v<m.length;v+=3)p.emplaceBack(m[v],m[v+1],m[v+2])}this._tileBoundsBuffer=i.createVertexBuffer(u,rm.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(p),this._tileBoundsSegments=Ki.simpleSegment(0,0,u.length,p.length)}_makeGlobeTileDebugBuffers(i,s){const c=s.projection;if(!c||"globe"!==c.name||s.freezeTileCoverage)return;const u=this.tileID.canonical,p=Og(VC(u,s)),m=Hd(s.zoom);let v;m>0&&(v=d.ae.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,u,s,p,v,m),this._makeGlobeTileDebugTextBuffer(i,u,s,p,v,m)}_globePoint(i,s,c,u,p,m,v){let x=r0(i,s,c);if(m){const C=1<<c.z,S=da(u.center.lng),I=bc(u.center.lat),A=(c.x+.5)/C-S;let N=0;A>.5?N=-1:A<-.5&&(N=1);let F=(i/ft+c.x)/C+N,z=(s/ft+c.y)/C;F=(F-S)*u._pixelsPerMercatorPixel+S,z=(z-I)*u._pixelsPerMercatorPixel+I;const V=[F*u.worldSize,z*u.worldSize,0];d.$.transformMat4(V,V,m),x=is(x,V,v)}return d.$.transformMat4(x,x,p)}_makeGlobeTileDebugBorderBuffer(i,s,c,u,p,m){const v=new $s,x=new vg,C=new No,S=(A,N,F,z,V)=>{const $=(F-A)/(V-1),ne=(z-N)/(V-1),ee=v.length;for(let re=0;re<V;re++){const de=A+re*$,fe=N+re*ne;v.emplaceBack(de,fe);const _e=this._globePoint(de,fe,s,c,u,p,m);C.emplaceBack(_e[0],_e[1],_e[2]),x.emplaceBack(ee+re)}},I=ft;S(0,0,I,0,16),S(I,0,I,I,16),S(I,I,0,I,16),S(0,I,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(x),this._tileDebugBuffer=i.createVertexBuffer(v,Ag.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(C,hM.members),this._tileDebugSegments=Ki.simpleSegment(0,0,v.length,x.length)}_makeGlobeTileDebugTextBuffer(i,s,c,u,p,m){const v=ft/4,x=new $s,C=new Xi,S=new No,I=25;C.reserve(32),x.reserve(I),S.reserve(I);const A=(N,F)=>I*N+F;for(let N=0;N<I;N++){const F=N*v;for(let z=0;z<I;z++){const V=z*v;x.emplaceBack(V,F);const $=this._globePoint(V,F,s,c,u,p,m);S.emplaceBack($[0],$[1],$[2])}}for(let N=0;N<4;N++)for(let F=0;F<4;F++){const z=A(N,F),V=A(N,F+1),$=A(N+1,F),ne=A(N+1,F+1);C.emplaceBack(z,V,$),C.emplaceBack($,V,ne)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(C),this._tileDebugTextBuffer=i.createVertexBuffer(x,Ag.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(S,hM.members),this._tileDebugTextSegments=Ki.simpleSegment(0,0,I,32)}destroy(i=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof Al&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function nx(o,i,s){var c,u;1===o?i.header_length=s.readFixed32():2===o?i.x=s.readVarint():3===o?i.y=s.readVarint():4===o?i.z=s.readVarint():5===o&&i.layers.push((c=s,u=s.readVarint()+s.pos,c.readFields(q0,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},u)))}function cP(o,i,s){var c,u;1===o?(i.delta_filter=(c=s,u=s.readVarint()+s.pos,c.readFields(sE,{block_size:0},u)),i.filter="delta_filter"):2===o?(s.readVarint(),i.filter="zigzag_filter"):3===o?(s.readVarint(),i.filter="bitshuffle_filter"):4===o&&(s.readVarint(),i.filter="byteshuffle_filter")}function sE(o,i,s){1===o&&(i.block_size=s.readVarint())}function aE(o,i,s){1===o?(s.readVarint(),i.codec="gzip_data"):2===o?(s.readVarint(),i.codec="jpeg_image"):3===o?(s.readVarint(),i.codec="webp_image"):4===o&&(s.readVarint(),i.codec="png_image")}function lE(o,i,s){var c,u;1===o?i.first_byte=s.readFixed64():2===o?i.last_byte=s.readFixed64():3===o?i.filters.push((c=s,u=s.readVarint()+s.pos,c.readFields(cP,{},u))):4===o?i.codec=function(c,u){return c.readFields(aE,{},u)}(s,s.readVarint()+s.pos):5===o?i.deprecated_offset=s.readFloat():6===o?i.deprecated_scale=s.readFloat():7===o?i.bands.push(s.readString()):8===o?i.offset=s.readDouble():9===o&&(i.scale=s.readDouble())}function q0(o,i,s){var c,u;1===o?i.version=s.readVarint():2===o?i.name=s.readString():3===o?i.units=s.readString():4===o?i.tilesize=s.readVarint():5===o?i.buffer=s.readVarint():6===o?i.pixel_format=s.readVarint():7===o&&i.data_index.push((c=s,u=s.readVarint()+s.pos,c.readFields(lE,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},u)))}function ix(o,i,s){if(2===o)c=s,u=s.readVarint()+s.pos,c.readFields(Ru,i,u);else if(3===o)throw new Error("Not implemented");var c,u}function Ru(o,i,s){if(1===o){let c=0;const u=s.readVarint()+s.pos;for(;s.pos<u;)i[c++]=s.readVarint()}}class nI{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const s=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,s),s}put(i,s){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,s)}}function iI(o,i){if(4!==i.length)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let s=i[3];for(let c=2;c>=1;c--){const u=1===c?1:0,p=2===c?1:0;for(let m=0;m<i[0];m++){const v=i[1]*m;for(let x=u;x<i[1];x++){const C=i[2]*(x+v);for(let S=p;S<i[2];S++){const I=i[3]*(S+C);for(let A=0;A<i[3];A++){const N=I+A;o[N]+=o[N-s]}}}}s*=i[c]}return o}function rx(o){for(let i=0,s=o.length;i<s;i++)o[i]=o[i]>>>1^-(1&o[i]);return o}function rI(o,i){switch(i){case"uint32":return o;case"uint16":for(let s=0;s<o.length;s+=2){const c=o[s],u=o[s+1];o[s]=(240&c)>>4|(61440&c)>>8|(240&u)<<4|61440&u,o[s+1]=15&c|(3840&c)>>4|(15&u)<<8|(3840&u)<<4}return o;case"uint8":for(let s=0;s<o.length;s+=4){const c=o[s],u=o[s+1],p=o[s+2],m=o[s+3];o[s+0]=(192&c)>>6|(192&u)>>4|(192&p)>>2|192&m,o[s+1]=(48&c)>>4|(48&u)>>2|48&p|(48&m)<<2,o[s+2]=(12&c)>>2|12&u|(12&p)<<2|(12&m)<<4,o[s+3]=3&c|(3&u)<<2|(3&p)<<4|(3&m)<<6}return o;default:throw new Error(`Invalid pixel format, "${i}"`)}}var Lo=Uint8Array,sm=Uint16Array,vf=Int32Array,bf=new Lo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),W0=new Lo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u_=new Lo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ox=function(o,i){for(var s=new sm(31),c=0;c<31;++c)s[c]=i+=1<<o[c-1];var u=new vf(s[30]);for(c=1;c<30;++c)for(var p=s[c];p<s[c+1];++p)u[p]=p-s[c]<<5|c;return{b:s,r:u}},sx=ox(bf,2),cE=sx.b,oI=sx.r;cE[28]=258,oI[258]=28;for(var sI=ox(W0,0).b,uE=new sm(32768),Cr=0;Cr<32768;++Cr){var am=(43690&Cr)>>1|(21845&Cr)<<1;uE[Cr]=((65280&(am=(61680&(am=(52428&am)>>2|(13107&am)<<2))>>4|(3855&am)<<4))>>8|(255&am)<<8)>>1}var lm=function(o,i,s){for(var c=o.length,u=0,p=new sm(i);u<c;++u)o[u]&&++p[o[u]-1];var m,v=new sm(i);for(u=1;u<i;++u)v[u]=v[u-1]+p[u-1]<<1;m=new sm(1<<i);var x=15-i;for(u=0;u<c;++u)if(o[u])for(var C=u<<4|o[u],S=i-o[u],I=v[o[u]-1]++<<S,A=I|(1<<S)-1;I<=A;++I)m[uE[I]>>x]=C;return m},d_=new Lo(288);for(Cr=0;Cr<144;++Cr)d_[Cr]=8;for(Cr=144;Cr<256;++Cr)d_[Cr]=9;for(Cr=256;Cr<280;++Cr)d_[Cr]=7;for(Cr=280;Cr<288;++Cr)d_[Cr]=8;var h_=new Lo(32);for(Cr=0;Cr<32;++Cr)h_[Cr]=5;var aI=lm(d_,9),dE=lm(h_,5),ax=function(o){for(var i=o[0],s=1;s<o.length;++s)o[s]>i&&(i=o[s]);return i},nl=function(o,i,s){var c=i/8|0;return(o[c]|o[c+1]<<8)>>(7&i)&s},lx=function(o,i){var s=i/8|0;return(o[s]|o[s+1]<<8|o[s+2]<<16)>>(7&i)},lI=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],il=function(o,i,s){var c=new Error(i||lI[o]);if(c.code=o,Error.captureStackTrace&&Error.captureStackTrace(c,il),!s)throw c;return c},cx=new Lo(0),hE=typeof TextDecoder<"u"&&new TextDecoder;try{hE.decode(cx,{stream:!0})}catch{}const f_={gzip_data:"gzip"};class Es extends Error{constructor(i){super(i),this.name="MRTError"}}const li={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},fE={uint32:1,uint16:2,uint8:4},cI={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let ux,cm;class xf{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const s=this.layers[i];if(!s)throw new Es(`Layer '${i}' not found`);return s}getHeaderLength(i){const s=new Uint8Array(i),c=new DataView(i);if(13!==s[0])throw new Es("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(i){const s=new Uint8Array(i),c=this.getHeaderLength(i);if(s.length<c)throw new Es(`Expected header with length >= ${c} but got buffer of length ${s.length}`);const u=new ux(s.subarray(0,c)).readFields(nx,{header_length:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Es(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new uI(p,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const s=[],c=this.getLayer(i.layerName);for(let u of i.blockIndices){const p=c.dataIndex[u],m=p.first_byte-i.firstByte,v=p.last_byte-i.firstByte;if(c._blocksInProgress.has(u))continue;const x={layerName:c.name,firstByte:m,lastByte:v,pixelFormat:c.pixelFormat,blockIndex:u,blockShape:[p.bands.length].concat(c.bandShape),buffer:c.buffer,codec:p.codec.codec,filters:p.filters.map(C=>C.filter)};c._blocksInProgress.add(u),s.push(x)}return new dI(s,()=>{s.forEach(u=>c._blocksInProgress.delete(u.blockIndex))},(u,p)=>{if(s.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),u)throw u;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class uI{constructor({version:i,name:s,units:c,tilesize:u,pixel_format:p,buffer:m,data_index:v},x){if(this.version=i,1!==this.version)throw new Es(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=s,this.units=c,this.tileSize=u,this.buffer=m,this.pixelFormat=li[p],this.dataIndex=v,this.bandShape=[u+2*m,u+2*m,fE[this.pixelFormat]],this._decodedBlocks=new nI(x?x.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return fE[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const s=i.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,i.data)}getBlockForBand(i){let s=0;switch(typeof i){case"string":for(const[c,u]of this.dataIndex.entries()){for(const[p,m]of u.bands.entries())if(m===i)return{bandIndex:s+p,blockIndex:c,blockBandIndex:p};s+=u.bands.length}break;case"number":for(const[c,u]of this.dataIndex.entries()){if(i>=s&&i<s+u.bands.length)return{bandIndex:i,blockIndex:c,blockBandIndex:i-s};s+=u.bands.length}break;default:throw new Es(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}throw new Es(`Band not found: ${JSON.stringify(i)}`)}getDataRange(i){let s=1/0,c=-1/0;const u=[],p=new Set;for(const m of i){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new Es(`Invalid band: ${JSON.stringify(m)}`);const x=this.dataIndex[v];u.includes(v)||u.push(v),p.add(v),s=Math.min(s,x.first_byte),c=Math.max(c,x.last_byte)}if(p.size>this.cacheSize)throw new Es(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:c,blockIndices:u}}hasBand(i){const{blockIndex:s}=this.getBlockForBand(i);return s>=0}hasDataForBand(i){const{blockIndex:s}=this.getBlockForBand(i);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(i){const{blockIndex:s,blockBandIndex:c}=this.getBlockForBand(i),u=this._decodedBlocks.get(s.toString());if(!u)throw new Es(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[s],m=this.bandShape.reduce((C,S)=>C*S,1),v=c*m,x=u.subarray(v,v+m);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:0!==p.offset?p.offset:p.deprecated_offset,scale:0!==p.scale?p.scale:p.deprecated_scale}}}xf.setPbf=function(o){ux=o};class dI{constructor(i,s,c){this.tasks=i,this._onCancel=s,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,s){this._finalized||(this._onComplete(i,s),this._finalized=!0)}}xf.performDecoding=function(o,i){const s=new Uint8Array(o);return Promise.all(i.tasks.map(c=>{const{layerName:u,firstByte:p,lastByte:m,pixelFormat:v,blockShape:x,blockIndex:C,filters:S,codec:I}=c,A=s.subarray(p,m+1),N=new Uint32Array(x[0]*x[1]*x[2]);let F;if("gzip_data"!==I)throw new Es(`Unhandled codec: ${I}`);return F=function(z,V){if(!globalThis.DecompressionStream&&"gzip_data"===V)return Promise.resolve(((re=function(_e){31==_e[0]&&139==_e[1]&&8==_e[2]||il(6,"invalid gzip data");var De=_e[3],Pe=10;4&De&&(Pe+=2+(_e[10]|_e[11]<<8));for(var Be=(De>>3&1)+(De>>4&1);Be>0;Be-=!_e[Pe++]);return Pe+(2&De)}(ee=z))+8>ee.length&&il(6,"invalid gzip data"),function(_e,De,Pe,Be){var Ne=_e.length;if(!Ne||De.f&&!De.l)return Pe||new Lo(0);var He=!Pe,st=He||2!=De.i,qe=De.i;He&&(Pe=new Lo(3*Ne));var ut,Ge,Qe=function(Pf){var gm=Pe.length;if(Pf>gm){var Pc=new Lo(Math.max(2*gm,Pf));Pc.set(Pe),Pe=Pc}},ht=De.f||0,$e=De.p||0,xt=De.b||0,dt=De.l,at=De.d,jt=De.m,Bt=De.n,Dt=8*Ne;do{if(!dt){ht=nl(_e,$e,1);var yt=nl(_e,$e+1,3);if($e+=3,!yt){var sn=_e[(_n=4+(($e+7)/8|0))-4]|_e[_n-3]<<8,Vt=_n+sn;if(Vt>Ne){qe&&il(0);break}st&&Qe(xt+sn),Pe.set(_e.subarray(_n,Vt),xt),De.b=xt+=sn,De.p=$e=8*Vt,De.f=ht;continue}if(1==yt)dt=aI,at=dE,jt=9,Bt=5;else if(2==yt){var Ot=nl(_e,$e,31)+257,gn=nl(_e,$e+10,15)+4,wn=Ot+nl(_e,$e+5,31)+1;$e+=14;for(var bn=new Lo(wn),Dn=new Lo(19),Ln=0;Ln<gn;++Ln)Dn[u_[Ln]]=nl(_e,$e+3*Ln,7);$e+=3*gn;var Nn=ax(Dn),_i=(1<<Nn)-1,yi=lm(Dn,Nn);for(Ln=0;Ln<wn;){var _n,si=yi[nl(_e,$e,_i)];if($e+=15&si,(_n=si>>4)<16)bn[Ln++]=_n;else{var ci=0,Ri=0;for(16==_n?(Ri=3+nl(_e,$e,3),$e+=2,ci=bn[Ln-1]):17==_n?(Ri=3+nl(_e,$e,7),$e+=3):18==_n&&(Ri=11+nl(_e,$e,127),$e+=7);Ri--;)bn[Ln++]=ci}}var cr=bn.subarray(0,Ot),_r=bn.subarray(Ot);jt=ax(cr),Bt=ax(_r),dt=lm(cr,jt),at=lm(_r,Bt)}else il(1);if($e>Dt){qe&&il(0);break}}st&&Qe(xt+131072);for(var Ji=(1<<jt)-1,Hi=(1<<Bt)-1,Gr=$e;;Gr=$e){var Tr=(ci=dt[lx(_e,$e)&Ji])>>4;if(($e+=15&ci)>Dt){qe&&il(0);break}if(ci||il(2),Tr<256)Pe[xt++]=Tr;else{if(256==Tr){Gr=$e,dt=null;break}var so=Tr-254;Tr>264&&(so=nl(_e,$e,(1<<(Rl=bf[Ln=Tr-257]))-1)+cE[Ln],$e+=Rl);var Si=at[lx(_e,$e)&Hi],Ds=Si>>4;if(Si||il(3),$e+=15&Si,_r=sI[Ds],Ds>3){var Rl=W0[Ds];_r+=lx(_e,$e)&(1<<Rl)-1,$e+=Rl}if($e>Dt){qe&&il(0);break}st&&Qe(xt+131072);var pa=xt+so;if(xt<_r){var Pa=0-_r,lh=Math.min(_r,pa);for(Pa+xt<0&&il(3);xt<lh;++xt)Pe[xt]=(void 0)[Pa+xt]}for(;xt<pa;++xt)Pe[xt]=Pe[xt-_r]}}De.l=dt,De.p=Gr,De.b=xt,De.f=ht,dt&&(ht=1,De.m=jt,De.d=at,De.n=Bt)}while(!ht);return xt!=Pe.length&&He?(ut=Pe,(null==(Ge=xt)||Ge>ut.length)&&(Ge=ut.length),new Lo(ut.subarray(0,Ge))):Pe.subarray(0,xt)}(ee.subarray(re,-8),{i:2},new Lo((($=ee)[(ne=$.length)-4]|$[ne-3]<<8|$[ne-2]<<16|$[ne-1]<<24)>>>0))));var $,ne,ee,re;const de=f_[V];if(!de)throw new Error(`Unhandled codec: ${V}`);const fe=new globalThis.DecompressionStream(de);return new Response(new Blob([z]).stream().pipeThrough(fe)).arrayBuffer().then(_e=>new Uint8Array(_e))}(A,I).then(z=>(new ux(z).readFields(ix,N),new cI[v](N.buffer))),F.then(z=>{for(let V=S.length-1;V>=0;V--)switch(S[V]){case"delta_filter":iI(z,x);break;case"zigzag_filter":rx(z);break;case"bitshuffle_filter":rI(z,v);break;default:throw new Es(`Unhandled filter "${S[V]}"`)}return{layerName:u,blockIndex:C,data:z}}).catch(z=>{throw z})}))},xf.setPbf(Jg);class hI extends yf{constructor(i,s,c,u,p){super(i,s,c,u,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,s){const c=s.context,u=c.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture&&this.texture instanceof Al?this.texture.update(i,{useMipmap:!1,premultiply:!1}):this.texture=new Al(c,i,u.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,s){const c=this._mrt=new xf(30),u=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=Yo(u,(p,m,v,x)=>{if(p)s(p);else try{const C=c.getHeaderLength(m);if(C>i)return void(this.request=this.fetchHeader(C,s));c.parseHeader(m),this._isHeaderLoaded=!0;let S=0;for(const I of Object.values(c.layers))S=Math.max(S,I.dataIndex[I.dataIndex.length-1].last_byte);m.byteLength>=S&&(this.entireBuffer=m),s(null,this.entireBuffer||m,v,x)}catch(C){s(C)}}),this.request}fetchBand(i,s,c){const u=this._mrt;if(!this._isHeaderLoaded||!u)return void c(new Error("Tile header is not ready"));const p=this.actor;if(!p)return void c(new Error("Can't fetch tile band without an actor"));let m;const v=(I,A)=>{m.complete(I,A),I?c(I):(this.updateTextureDescriptor(i,s),c(null,this.textureDescriptor&&this.textureDescriptor.img))},x=(I,A)=>{if(I)return c(I);const N=p.send("decodeRasterArray",{buffer:A,task:m},v,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),m.cancel()})},C=u.getLayer(i);if(!C)return void c(new Error(`Unknown sourceLayer "${i}"`));if(C.hasDataForBand(s))return this.updateTextureDescriptor(i,s),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);const S=C.getDataRange([s]);if(m=u.createDecodingTask(S),!m||m.tasks.length)if(this.flushQueues(),this.entireBuffer)x(null,this.entireBuffer.slice(S.firstByte,S.lastByte+1));else{const I=Object.assign({},this.requestParams,{headers:{Range:`bytes=${S.firstByte}-${S.lastByte}`}}),A=Yo(I,x);this._fetchQueue.push(()=>{A.cancel(),m.cancel()})}else c(null)}updateNeeded(i,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==i)&&"errored"!==this.state}updateTextureDescriptor(i,s){if(!this._mrt)return;const c=this._mrt.getLayer(i);if(!c||!c.hasBand(s)||!c.hasDataForBand(s))return;const{bytes:u,tileSize:p,buffer:m,offset:v,scale:x}=c.getBandView(s),C=p+2*m,S={data:u,width:C,height:C},I=this.texture;I&&I instanceof Al&&I.update(S,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:i,band:s,img:S,buffer:m,offset:v,tileSize:p,format:c.pixelFormat,mix:[x,256*x,65536*x,16777216*x]}}}class fI{constructor(i,s){this.max=i,this.onRemove=s,this.reset()}reset(){for(const i in this.data)for(const s of this.data[i])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(i,s,c){const u=i.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(void 0!==c&&(p.timeout=setTimeout(()=>{this.remove(i,p)},c)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const s=this.data[i].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),s.value}getByKey(i){const s=this.data[i];return s?s[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,s){if(!this.has(i))return this;const c=i.wrapped().key,u=void 0===s?0:this.data[c].indexOf(s),p=this.data[c][u];return this.data[c].splice(u,1),p.timeout&&clearTimeout(p.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(i){const s=[];for(const c in this.data)for(const u of this.data[c])i(u.value)||s.push(u);for(const c of s)this.remove(c.value.tileID,c)}}class wf extends dd{constructor(i,s,c){super(),this.id=i,this._onlySymbols=c,s.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new fI(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new aP,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const s=this._tiles[i];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,s){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,s)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(i),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return nd(this._tiles).map(i=>i.tileID).sort(pI).map(i=>i.key)}getRenderableIds(i,s){const c=[];for(const u in this._tiles)this._isIdRenderable(+u,i,s)&&c.push(this._tiles[u]);return i?c.sort((u,p)=>{const m=u.tileID,v=p.tileID,x=new _t(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),C=new _t(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||C.y-x.y||C.x-x.x}).map(u=>u.tileID.key):c.map(u=>u.tileID).sort(pI).map(u=>u.key)}hasRenderableParent(i){const s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(i,s,c){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())&&(c||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,s){const c=this._tiles[i];c&&("loading"!==c.state&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,i,s)))}_tileLoaded(i,s,c,u){if(u)if(i.state="errored",404!==u.status)this._source.fire(new dp(u,{tile:i}));else{if(this._source.fire(new Ha("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=Mo.now(),"expired"===c&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Ha("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(i.neighboringTiles&&i.neighboringTiles[p]){const m=this.getTileByID(p);c(i,m),c(m,i)}}function c(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-u.tileID.canonical.x;const v=p.tileID.canonical.y-u.tileID.canonical.y,x=Math.pow(2,u.tileID.canonical.z),C=p.tileID.key;0===m&&0===v||Math.abs(v)>1||(Math.abs(m)>1&&(1===Math.abs(m+x)?m+=x:1===Math.abs(m-x)&&(m-=x)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,m,v),u.neighboringTiles&&u.neighboringTiles[C]&&(u.neighboringTiles[C].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,s,c,u){for(const p in this._tiles){let m=this._tiles[p];if(u[p]||!m.hasData()||m.tileID.overscaledZ<=s||m.tileID.overscaledZ>c)continue;let v=m.tileID;for(;m&&m.tileID.overscaledZ>s+1;){const C=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[C.key],m&&m.hasData()&&(v=C)}let x=v;for(;x.overscaledZ>s;)if(x=x.scaledTo(x.overscaledZ-1),i[x.key]){u[v.key]=v;break}}}findLoadedParent(i,s){if(i.key in this._loadedParentTiles){const c=this._loadedParentTiles[i.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=i.overscaledZ-1;c>=s;c--){const u=i.scaledTo(c),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(i){const s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,s){s=s||this._source.tileSize;const c=Math.ceil(i.width/s)+1,u=Math.ceil(i.height/s)+1,p=Math.floor(c*u*5),m="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(i){const s=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,s){const c={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),c[p.tileID.key]=p}this._tiles=c;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(i,s,c,u){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(i,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const p="batched-model"===this._source.type;let m;if(this.used||this.usedForTerrain){if(this._source.tileID)m=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new Lr(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y));else if(0!==this.tileCoverLift){const C=i.clone();C.tileCoverLift=this.tileCoverLift,m=C.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.minzoom<=1&&"globe"===i.projection.name&&(m.push(new Lr(1,0,1,0,0)),m.push(new Lr(1,0,1,1,0)),m.push(new Lr(1,0,1,0,1)),m.push(new Lr(1,0,1,1,1)))}else if(m=i.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.hasTile){const C=this._source.hasTile.bind(this._source);m=m.filter(S=>C(S))}}else m=[];if(m.length>0&&this.castsShadows&&u&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!dx(this._source.type)){const C=i.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),S=Math.min(C,this._source.maxzoom);if(p){const I=i.extendTileCover(m,S);for(const A of I)m.push(A)}else{const I=i.extendTileCover(m,S,u);for(const A of I)this._shadowCasterTiles[A.key]=!0,m.push(A)}}const v=this._updateRetainedTiles(m);if(dx(this._source.type)&&0!==m.length){const C={},S={},I=Object.keys(v);for(const N of I){const F=v[N],z=this._tiles[N];if(!z||z.fadeEndTime&&z.fadeEndTime<=Mo.now())continue;const V=this.findLoadedParent(F,Math.max(F.overscaledZ-wf.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),C[V.tileID.key]=V.tileID),S[N]=F}const A=m[m.length-1].overscaledZ;for(const N in this._tiles){const F=this._tiles[N];if(v[N]||!F.hasData())continue;let z=F.tileID;for(;z.overscaledZ>A;){z=z.scaledTo(z.overscaledZ-1);const V=this._tiles[z.key];if(V&&V.hasData()&&S[z.key]){v[N]=F.tileID;break}}}for(const N in C)v[N]||(this._coveredTiles[N]=!0,v[N]=C[N])}for(const C in v)this._tiles[C].clearFadeHold();const x=function(C,S){const I=[];for(const A in C)A in S||I.push(A);return I}(this._tiles,v);for(const C of x){const S=this._tiles[C];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const s={};if(0===i.length)return s;const c={},u=i.reduce((C,S)=>Math.min(C,S.overscaledZ),1/0),p=i[0].overscaledZ,m=Math.max(p-wf.maxOverzooming,this._source.minzoom),v=Math.max(p+wf.maxUnderzooming,this._source.minzoom),x={};for(const C of i){const S=this._addTile(C);s[C.key]=C,S.hasData()||u<this._source.maxzoom&&(x[C.key]=C)}this._retainLoadedChildren(x,u,v,s);for(const C of i){let S=this._tiles[C.key];if(S.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const A=C.children(this._source.maxzoom)[0],N=this.getTile(A);if(N&&N.hasData()){s[A.key]=A;continue}}else{const A=C.children(this._source.maxzoom);if(s[A[0].key]&&s[A[1].key]&&s[A[2].key]&&s[A[3].key])continue}let I=S.wasRequested();for(let A=C.overscaledZ-1;A>=m;--A){const N=C.scaledTo(A);if(c[N.key]||(c[N.key]=!0,S=this.getTile(N),!S&&I&&(S=this._addTile(N)),S&&(s[N.key]=N,I=S.wasRequested(),S.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const s=[];let c,u=this._tiles[i].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){c=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;u=p}for(const p of s)this._loadedParentTiles[p]=c}}_addTile(i){let s=this._tiles[i.key];if(s)return!0!==s.isExtraShadowCaster||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),s;s=this._cache.getAndRemove(i),s&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));const c=!!s;if(!c){const u=this.map?this.map.painter:null,p=this._source.tileSize*i.overscaleFactor();s="raster-array"===this._source.type?new hI(i,p,this.transform.tileZoom,u,this._isRaster):new yf(i,p,this.transform.tileZoom,u,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))}return s?(s.uses++,this._tiles[i.key]=s,c||this._source.fire(new Ha("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(i,s){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const c=s.getExpiryTimeout();c&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},c))}_removeTile(i){const s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&"reloading"!==s.state||"empty"===s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,s,c){const u=[],p=this.transform;if(!p)return u;const m="globe"===p.projection.name,v=da(p.center.lng);for(const x in this._tiles){const C=this._tiles[x];if(c&&C.clearQueryDebugViz(),C.holdingForFade())continue;let S;if(m){const I=C.tileID.canonical;if(0===I.z){const A=[Math.abs(Sn(v,...Z0(I,-1))-v),Math.abs(Sn(v,...Z0(I,1))-v)];S=[0,2*A.indexOf(Math.min(...A))-1]}else{const A=[Math.abs(Sn(v,...Z0(I,-1))-v),Math.abs(Sn(v,...Z0(I,0))-v),Math.abs(Sn(v,...Z0(I,1))-v)];S=[A.indexOf(Math.min(...A))-1]}}else S=[0];for(const I of S){const A=i.containsTile(C,p,s,I);A&&u.push(A)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,s){const c=this.getRenderableIds(i,s).map(p=>this._tiles[p].tileID),u="globe"===this.transform.projection.name;for(const p of c)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=u?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return c}sortCoordinatesByDistance(i){const s=i.slice(),c=this.transform._camera.position,u=this.transform._camera.forward(),p={};for(const m of s){const v=1/(1<<m.canonical.z);p[m.key]=((m.canonical.x+.5)*v+m.wrap-c[0])*u[0]+((m.canonical.y+.5)*v-c[1])*u[1]-c[2]*u[2]}return s.sort((m,v)=>p[m.key]-p[v.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(dx(this._source.type))for(const i in this._tiles){const s=this._tiles[i];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=Mo.now())return!0}return!1}setFeatureState(i,s,c){this._state.updateState(i=i||"_geojsonTileLayer",s,c)}removeFeatureState(i,s,c){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,c)}getFeatureState(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)}setDependencies(i,s,c){const u=this._tiles[i];u&&u.setDependencies(s,c)}reloadTilesForDependencies(i,s){for(const c in this._tiles)this._tiles[c].hasDependency(i,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(i,s))}_preloadTiles(i,s){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(i,s))};return void this._source.on("data",v)}const c=new Map,u=Array.isArray(i)?i:[i],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of u){const x=v.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of x)c.set(C.key,C);this.usedForTerrain&&v.updateElevation(!1)}ep(Array.from(c.values()),(v,x)=>{const C=new yf(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,S=>{"raster-dem"===this._source.type&&C.dem&&this._backfillDEM(C),x(S,C)})},s)}}function pI(o,i){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*i.wrap)-+(i.wrap<0);return o.overscaledZ-i.overscaledZ||c-s||i.canonical.y-o.canonical.y||i.canonical.x-o.canonical.x}function dx(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function Z0(o,i){const s=1<<o.z;return[o.x/s+i,(o.x+1)/s+i]}wf.maxOverzooming=10,wf.maxUnderzooming=3;const pE=()=>cm||(cm={layout:Ib||(Ib=new Ei({"line-cap":new Nt(Le.layout_line["line-cap"]),"line-join":new Nt(Le.layout_line["line-join"]),"line-miter-limit":new ct(Le.layout_line["line-miter-limit"]),"line-round-limit":new ct(Le.layout_line["line-round-limit"]),"line-sort-key":new Nt(Le.layout_line["line-sort-key"]),"line-z-offset":new Nt(Le.layout_line["line-z-offset"]),visibility:new ct(Le.layout_line.visibility)})),paint:OT||(OT=new Ei({"line-opacity":new Nt(Le.paint_line["line-opacity"]),"line-color":new Nt(Le.paint_line["line-color"]),"line-translate":new ct(Le.paint_line["line-translate"]),"line-translate-anchor":new ct(Le.paint_line["line-translate-anchor"]),"line-width":new Nt(Le.paint_line["line-width"]),"line-gap-width":new Nt(Le.paint_line["line-gap-width"]),"line-offset":new Nt(Le.paint_line["line-offset"]),"line-blur":new Nt(Le.paint_line["line-blur"]),"line-dasharray":new Nt(Le.paint_line["line-dasharray"]),"line-pattern":new Nt(Le.paint_line["line-pattern"]),"line-gradient":new Qo(Le.paint_line["line-gradient"]),"line-trim-offset":new ct(Le.paint_line["line-trim-offset"]),"line-trim-fade-range":new ct(Le.paint_line["line-trim-fade-range"]),"line-trim-color":new ct(Le.paint_line["line-trim-color"]),"line-emissive-strength":new ct(Le.paint_line["line-emissive-strength"]),"line-border-width":new Nt(Le.paint_line["line-border-width"]),"line-border-color":new Nt(Le.paint_line["line-border-color"]),"line-occlusion-opacity":new ct(Le.paint_line["line-occlusion-opacity"])}))},cm);class mI extends Nt{possiblyEvaluate(i,s){return s=new cn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(i,s)}evaluate(i,s,c,u){return s=uo({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(i,s,c,u)}}let p_,Y0,um,m_;function g_(o,i){return i>0?i+2*o:o}class hx{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Xo,this.defaultValue=i}evaluate(i){if(i.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ee(hx,"FormatSectionOverride",{omit:["defaultValue"]});const Cf=()=>m_||(m_={layout:Y0||(Y0=new Ei({"symbol-placement":new ct(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new ct(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ct(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nt(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ct(Le.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ct(Le.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ct(Le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ct(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new ct(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ct(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nt(Le.layout_symbol["icon-size"]),"icon-text-fit":new Nt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nt(Le.layout_symbol["icon-image"]),"icon-rotate":new Nt(Le.layout_symbol["icon-rotate"]),"icon-padding":new ct(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new ct(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new Nt(Le.layout_symbol["icon-offset"]),"icon-anchor":new Nt(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ct(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ct(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ct(Le.layout_symbol["text-rotation-alignment"]),"text-field":new Nt(Le.layout_symbol["text-field"]),"text-font":new Nt(Le.layout_symbol["text-font"]),"text-size":new Nt(Le.layout_symbol["text-size"]),"text-max-width":new Nt(Le.layout_symbol["text-max-width"]),"text-line-height":new Nt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new Nt(Le.layout_symbol["text-letter-spacing"]),"text-justify":new Nt(Le.layout_symbol["text-justify"]),"text-radial-offset":new Nt(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ct(Le.layout_symbol["text-variable-anchor"]),"text-anchor":new Nt(Le.layout_symbol["text-anchor"]),"text-max-angle":new ct(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new ct(Le.layout_symbol["text-writing-mode"]),"text-rotate":new Nt(Le.layout_symbol["text-rotate"]),"text-padding":new ct(Le.layout_symbol["text-padding"]),"text-keep-upright":new ct(Le.layout_symbol["text-keep-upright"]),"text-transform":new Nt(Le.layout_symbol["text-transform"]),"text-offset":new Nt(Le.layout_symbol["text-offset"]),"text-allow-overlap":new ct(Le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ct(Le.layout_symbol["text-ignore-placement"]),"text-optional":new ct(Le.layout_symbol["text-optional"]),visibility:new ct(Le.layout_symbol.visibility)})),paint:um||(um=new Ei({"icon-opacity":new Nt(Le.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Nt(Le.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Nt(Le.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Nt(Le.paint_symbol["text-emissive-strength"]),"icon-color":new Nt(Le.paint_symbol["icon-color"]),"icon-halo-color":new Nt(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nt(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nt(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new ct(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new ct(Le.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Nt(Le.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Nt(Le.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Nt(Le.paint_symbol["text-occlusion-opacity"]),"text-color":new Nt(Le.paint_symbol["text-color"],{runtimeType:ys,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Nt(Le.paint_symbol["text-halo-color"]),"text-halo-width":new Nt(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new Nt(Le.paint_symbol["text-halo-blur"]),"text-translate":new ct(Le.paint_symbol["text-translate"]),"text-translate-anchor":new ct(Le.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ct(Le.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ct(Le.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ct(Le.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ct(Le.paint_symbol["icon-color-brightness-max"])}))},m_);class __ extends js{constructor(i,s,c,u){super(i,Cf(),s,c,u),this._colorAdjustmentMatrix=d.ae.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==i.paint&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,s){super.recalculate(i,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const u=[];for(const p of c)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,s,c,u){return this._saturation===i&&this._contrast===s&&this._brightnessMin===c&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(p,m,v,x){p=tc(p),m=my(m);const C=d.ae.create(),S=p/3,I=1-2*S,A=[I,S,S,0,S,I,S,0,S,S,I,0,0,0,0,1],N=.5-.5*m,F=x-v;return d.ae.multiply(C,[F,0,0,0,0,F,0,0,0,0,F,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,N,N,N,1]),d.ae.multiply(C,C,A),C}(i,s,c,u),this._saturation=i,this._contrast=s,this._brightnessMin=c,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,s,c,u){const p=this.layout.get(i).evaluate(s,{},c,u),m=this._unevaluatedLayout._values[i];return m.isDataDriven()||te(m.value)||!p?p:(v=s.properties,p.replace(/{([^{}]+)}/g,(C,S)=>S in v?String(v[S]):""));var v}createBucket(i){return new nm(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Cf().paint.overridableProperties){if(!__.hasPaintOverride(this.layout,i))continue;const s=this.paint.get(i),c=new hx(s),u=new K(c,s.property.specification,this.scope,this.options);let p=null;p="constant"===s.value.kind||"source"===s.value.kind?new he("source",u):new ce("composite",u,s.value.zoomStops,s.value._interpolationType),this.paint._values[i]=new no(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(i,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&__.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,s){const c=i.get("text-field"),u=Cf().paint.properties[s];let p=!1;const m=v=>{for(const x of v)if(u.overrides&&u.overrides.hasOverride(x))return void(p=!0)};if("constant"===c.value.kind&&c.value.value instanceof fo)m(c.value.value.sections);else if("source"===c.value.kind){const v=C=>{p||(C instanceof qa&&hn(C.value)===gd?m(C.value.sections):C instanceof lu?m(C.sections):C.eachChild(v))},x=c.value;x._styleExpression&&v(x._styleExpression.expression)}return p}getProgramIds(){const i=0!==this.paint.get("icon-opacity").constantOr(1),s=0!==this.paint.get("text-opacity").constantOr(1),c=[];return i&&c.push("symbolIcon"),s&&c.push("symbolSDF"),c}getDefaultProgramParams(i,s,c){return{config:new Fr(this,{zoom:s,lut:c}),overrideFog:!1}}}let mE,dm,fx,px;function y_(o,i,s,c,u,p,m,v){const x=[o,i,1,s,c,1,u,p,1],C=[m,v,1],S=d.bE.adjoint([],x),[I,A,N]=d.$.transformMat3(C,C,S);return d.bE.multiply(x,x,[I,0,0,0,A,0,0,0,N])}function mx(o,i,s,c,u,p,m,v){const x=function(C,S,I,A,N,F,z,V){const $=y_(0,0,1,0,1,1,0,1),ne=y_(C,S,I,A,N,F,z,V),ee=d.bE.adjoint([],$);return d.bE.multiply(ne,ne,ee)}(o,i,s,c,u,p,m,v);return[x[2]/x[8]/ft,x[5]/x[8]/ft]}function X0(o){return[o[0],Math.min(Math.max(o[1],-wr),wr)]}class gE extends dd{constructor(i,s,c,u){super(),this.id=i,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=s,this._dirty=!1}load(i,s){if(this._loaded=s||!1,this.fire(new Ha("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=su(this.map._requestManager.transformRequest(this.url,sd.Image),(c,u)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new dp(c)):u&&(this.image=u instanceof HTMLImageElement?Mo.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new im(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ha("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof im||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=i[0][1],c=i[0][1];for(const p of i)p[1]>c&&(c=p[1]),p[1]<s&&(s=p[1]);const u=(c+s)/2;if(u>wr?this.onNorthPole=!0:u<-wr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=i.map(ko.fromLngLat);this.tileID=function(m){let v=1/0,x=1/0,C=-1/0,S=-1/0;for(const z of m)v=Math.min(v,z.x),x=Math.min(x,z.y),C=Math.max(C,z.x),S=Math.max(S,z.y);const I=Math.max(C-v,S-x),A=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),N=Math.pow(2,A);let F=Math.floor((v+C)/2*N);return F>1&&(F-=1),new Ud(A,F,Math.floor((x+S)/2*N))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ha("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const V in this.tiles){const $=this.tiles[V];"loaded"!==$.state&&($.state="loaded",$.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=th(new Ud(0,0,0),this.map.transform.projection),c=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const $=V[1].x-V[0].x,ne=V[1].y-V[0].y,ee=V[2].x-V[1].x,re=V[2].y-V[1].y,de=V[3].x-V[2].x,fe=V[3].y-V[2].y,_e=V[0].x-V[3].x,De=V[0].y-V[3].y,Pe=$*re-ee*ne,Be=ee*fe-de*re,Ne=de*De-_e*fe,He=_e*ne-$*De;return Pe>0&&Be>0&&Ne>0&&He>0||Pe<0&&Be<0&&Ne<0&&He<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=th(this.tileID,this.map.transform.projection),[p,m,v,x]=this.coordinates.map(V=>{const $=u.projection.project(V[0],V[1]);return Kn(u,$)._round()});this.perspectiveTransform=mx(p.x,p.y,m.x,m.y,v.x,v.y,x.x,x.y);const C=this._boundsArray=new vu;C.emplaceBack(p.x,p.y,0,0),C.emplaceBack(m.x,m.y,ft,0),C.emplaceBack(x.x,x.y,0,ft),C.emplaceBack(v.x,v.y,ft,ft),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(C,rm.members),this.boundsSegments=Ki.simpleSegment(0,0,4,2);const S=[],I=[X0((V=this.coordinates)[0]),X0(V[1]),X0(V[2]),X0(V[3])],[A,N,F,z]=function(V){let $=V[0][0],ne=$,ee=V[0][1],re=ee;for(let de=1;de<V.length;de++)V[de][0]<$?$=V[de][0]:V[de][0]>ne&&(ne=V[de][0]),V[de][1]<ee?ee=V[de][1]:V[de][1]>re&&(re=V[de][1]);return[$,ee,ne-$,re-ee]}(I);var V;{const V=new vu,[$,ne,ee,re]=function(Ge){let Qe=Ge[0].x,ht=Qe,$e=Ge[0].y,xt=$e;for(let dt=1;dt<Ge.length;dt++)Ge[dt].x<Qe?Qe=Ge[dt].x:Ge[dt].x>ht&&(ht=Ge[dt].x),Ge[dt].y<$e?$e=Ge[dt].y:Ge[dt].y>xt&&(xt=Ge[dt].y);return[Qe,$e,ht-Qe,xt-$e]}(c),de=Ge=>[(Ge.x-$)/ee,(Ge.y-ne)/re],[fe,_e,De,Pe]=c.map(de),Be=function(Ge,Qe,ht,$e,xt,dt,at,jt){const Bt=y_(0,0,1,0,1,1,0,1),Dt=y_(Ge,Qe,ht,$e,xt,dt,at,jt),yt=d.bE.adjoint([],Dt);return d.bE.multiply(Bt,Bt,yt)}(fe[0],fe[1],_e[0],_e[1],De[0],De[1],Pe[0],Pe[1]);this.elevatedGlobePerspectiveTransform=mx(fe[0],fe[1],_e[0],_e[1],De[0],De[1],Pe[0],Pe[1]);const Ne=(Ge,Qe)=>{S.push(Ge.lng);const ht=Math.round((Ge.lng-A)/F*ft),$e=Math.round((Ge.lat-N)/z*ft),xt=de(Qe),dt=d.$.transformMat3([],[xt[0],xt[1],1],Be),at=Math.round(dt[0]/dt[2]*ft),jt=Math.round(dt[1]/dt[2]*ft);V.emplaceBack(ht,$e,at,jt)},He=c[3].x-c[0].x,st=c[3].y-c[0].y,qe=c[2].x-c[1].x,ut=c[2].y-c[1].y;for(let Ge=0;Ge<65;Ge++){const Qe=Ge/64,ht=[c[0].x+Qe*He,c[0].y+Qe*st],$e=[c[1].x+Qe*qe,c[1].y+Qe*ut],xt=$e[0]-ht[0],dt=$e[1]-ht[1];for(let at=0;at<65;at++){const jt=at/64,Bt={x:ht[0]+xt*jt,y:ht[1]+dt*jt,z:0};Ne(s.projection.unproject(Bt.x,Bt.y),Bt)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(V,rm.members)}{this.maxLongitudeTriangleSize=0;let V=[],$=new Xi;const ne=(ee,re,de)=>{$.emplaceBack(ee,re,de);const fe=S[ee],_e=S[re],De=S[de],Pe=Math.min(Math.min(fe,_e),De),Be=Math.max(Math.max(fe,_e),De)-Pe;Be>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Be),V.push(Pe+Be/2)};for(let ee=0;ee<64;ee++)for(let re=0;re<64;re++){const de=65*ee+re,fe=de+1,_e=de+65,De=_e+1;ne(de,_e,fe),ne(fe,_e,De)}[V,$]=function(ee,re){const de=Array.from({length:ee.length},(De,Pe)=>Pe);de.sort((De,Pe)=>ee[De]-ee[Pe]);const fe=[],_e=new Xi;for(let De=0;De<de.length;De++){const Pe=de[De];fe.push(ee[Pe]);const Be=3*Pe,Ne=Be+1;_e.emplaceBack(re.uint16[Be],re.uint16[Ne],re.uint16[Ne+1])}return[fe,_e]}(V,$),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=i.createIndexBuffer($)}this.elevatedGlobeSegments=Ki.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/ft,0,z/ft,0,0,N,A,0])}prepare(){const i=0!==Object.keys(this.tiles).length;if(this.tileID&&!i)return;const s=this.map.painter.context,c=s.gl;!this._dirty||this.texture instanceof im||(this.texture?this.texture.update(this.image):(this.texture=new Al(s,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(s)}loadTile(i,s){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},s(null)):(i.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let u=(p=i+180)+360*Math.round((c[0]-p)/360);var p;const m=new Ki,v=(I,A)=>{m.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:s.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},x=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-u)<=x){const I=ap(c,0,c.length,u+x);return I===c.length||v(I,sp(c,I+1,c.length,u+360-x)-I),m}u<c[0]&&(u+=360);const C=sp(c,0,c.length,u-x);if(C===c.length)return v(0,c.length),m;v(0,C-0);const S=ap(c,C+1,c.length,u+x);return S!==c.length&&v(S,c.length-S),m}}const gI=(Math.pow(256,2)-1)/16907520;class hm extends js{constructor(i,s,c,u){super(i,{layout:fx||(fx=new Ei({visibility:new ct(Le.layout_raster.visibility)})),paint:px||(px=new Ei({"raster-opacity":new ct(Le.paint_raster["raster-opacity"]),"raster-color":new Qo(Le.paint_raster["raster-color"]),"raster-color-mix":new ct(Le.paint_raster["raster-color-mix"]),"raster-color-range":new ct(Le.paint_raster["raster-color-range"]),"raster-hue-rotate":new ct(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ct(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ct(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new ct(Le.paint_raster["raster-saturation"]),"raster-contrast":new ct(Le.paint_raster["raster-contrast"]),"raster-resampling":new ct(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new ct(Le.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ct(Le.paint_raster["raster-emissive-strength"]),"raster-array-band":new ct(Le.paint_raster["raster-array-band"]),"raster-elevation":new ct(Le.paint_raster["raster-elevation"])}))},s,c,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof gE&&(i._source.onNorthPole||i._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(i){"raster-color"!==i&&"raster-color-range"!==i||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[c,u]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(u)||c===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=oo({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,u])}}let _E,yE,vE,v_,gx;class _x extends js{constructor(i,s,c,u){super(i,{layout:_E||(_E=new Ei({visibility:new ct(Le["layout_raster-particle"].visibility)})),paint:yE||(yE=new Ei({"raster-particle-array-band":new ct(Le["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ct(Le["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Qo(Le["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ct(Le["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ct(Le["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ct(Le["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ct(Le["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ct(Le["paint_raster-particle"]["raster-particle-elevation"])}))},s,c,u),this._updateColorRamp(),this.lastInvalidatedAt=Mo.now()}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){"raster-particle-color"!==i&&"raster-particle-max-speed"!==i||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===i&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=oo({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Mo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class bE extends js{constructor(i,s){super(i,{},s,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(i){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function yx(o,i,s){const c=[0,0,1],u=d.aw.identity([]);return d.aw.rotateY(u,u,s?-Fn(o)+Math.PI:Fn(o)),d.aw.rotateX(u,u,-Fn(i)),d.$.transformQuat(c,c,u),d.$.normalize(c,c)}function vx(o,i){const s=Tf(o.projection,o.zoom,o.width,o.height),c=function(p,m,v,x,C){const S=new zn(v.lng-180*rh,v.lat),I=new zn(v.lng+180*rh,v.lat),A=p.project(S.lng,S.lat),N=p.project(I.lng,I.lat),F=-Math.atan2(N.y-A.y,N.x-A.x),z=ko.fromLngLat(v);z.y=Sn(z.y,-1+rh,1-rh);const V=z.toLngLat(),$=p.project(V.lng,V.lat),ne=ko.fromLngLat(V);ne.x+=rh;const ee=ne.toLngLat(),re=p.project(ee.lng,ee.lat),de=wE(re.x-$.x,re.y-$.y,F),fe=ko.fromLngLat(V);fe.y+=rh;const _e=fe.toLngLat(),De=p.project(_e.lng,_e.lat),Pe=wE(De.x-$.x,De.y-$.y,F),Be=Math.abs(de.x)/Math.abs(Pe.y),Ne=d.ae.identity([]);d.ae.rotateZ(Ne,Ne,-F*(1-(C?0:x)));const He=d.ae.identity([]);return d.ae.scale(He,He,[1,1-(1-Be)*x,1]),He[4]=-Pe.x/Pe.y*x,d.ae.rotateZ(He,He,F),d.ae.multiply(He,Ne,He),He}(o.projection,0,o.center,s,i),u=K0(o);return d.ae.scale(c,c,[u,u,1]),c}function K0(o){const i=o.projection,s=Tf(o.projection,o.zoom,o.width,o.height),c=xE(i,o.center),u=xE(i,zn.convert(i.center));return Math.pow(2,c*s+(1-s)*u)}function Tf(o,i,s,c,u=1/0){const p=o.range;if(!p)return 0;const m=Math.min(u,Math.max(s,c)),v=Math.log(m/1024)/Math.LN2;return Qf(p[0]+v,p[1]+v,i)}const rh=1/4e4;function xE(o,i){const s=Sn(i.lat,-wr,wr),c=new zn(i.lng-180*rh,s),u=new zn(i.lng+180*rh,s),p=o.project(c.lng,s),m=o.project(u.lng,s),v=ko.fromLngLat(c),x=ko.fromLngLat(u),C=m.x-p.x,S=m.y-p.y,I=x.x-v.x,A=x.y-v.y,N=Math.sqrt((I*I+A*A)/(C*C+S*S));return Math.log(N)/Math.LN2}function wE(o,i,s){const c=Math.cos(s),u=Math.sin(s);return{x:o*c-i*u,y:o*u+i*c}}function CE(o,i,s){d.ae.identity(o),d.ae.rotateZ(o,o,Fn(i[2])),d.ae.rotateX(o,o,Fn(i[0])),d.ae.rotateY(o,o,Fn(i[1])),d.ae.scale(o,o,s),d.ae.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function J0(o,i,s,c,u,p,m,v){const x=[s[0]-i[0],s[1]-i[1],0],C=[c[0]-i[0],c[1]-i[1],0];if(d.$.length(x)<1e-12||d.$.length(C)<1e-12)return d.aw.identity(o);const S=d.$.cross([],x,C);d.$.normalize(S,S),d.$.subtract(C,c,i),x[2]=(p-u)*v,C[2]=(m-u)*v;const I=x;return d.$.cross(I,x,C),d.$.normalize(I,I),d.aw.rotationTo(o,S,I)}function bx(o,i,s=!1){const c=Hd(i.zoom),u=function(p,m,v){const x=m.worldSize,C=[p[12],p[13],p[14]],S=$r(C[1]/x),I=Ws(C[0]/x),A=d.ae.identity([]),N=ro(1,S)*x,F=ro(1,0)*x*jd(S,m.zoom),z=1/wi(x);let V=F*z;if(v){const re=Tf(m.projection,m.zoom,m.width,m.height,1024);V=z*m.projection.pixelSpaceConversion(m.center.lat,x,re)}const $=Vd(S,I);d.$.add($,$,d.$.scale([],d.$.normalize([],$),N*V*C[2]));const ne=function(re){const de=[re[0],re[1],re[2]];let fe=[0,1,0];const _e=d.$.cross([],fe,de);return d.$.cross(fe,de,_e),0===d.$.squaredLength(fe)&&(fe=[0,1,0],d.$.cross(_e,de,fe)),d.$.normalize(_e,_e),d.$.normalize(fe,fe),d.$.normalize(de,de),[_e[0],_e[1],_e[2],0,fe[0],fe[1],fe[2],0,de[0],de[1],de[2],0,re[0],re[1],re[2],1]}($);d.ae.scale(A,A,[V,V,V*N]),d.ae.translate(A,A,[-C[0],-C[1],-C[2]]);const ee=d.ae.multiply([],m.globeMatrix,ne);return d.ae.multiply(ee,ee,A),d.ae.multiply(ee,ee,p),ee}(o,i,s);return c>0?function(m,v,x){const C=(F,z,V)=>{const $=d.$.length(F),ne=d.$.length(z),ee=is(F,z,V);return d.$.scale(ee,ee,1/d.$.length(ee)*Yt($,ne,V))},S=C([m[0],m[1],m[2]],[v[0],v[1],v[2]],x),I=C([m[4],m[5],m[6]],[v[4],v[5],v[6]],x),A=C([m[8],m[9],m[10]],[v[8],v[9],v[10]],x),N=is([m[12],m[13],m[14]],[v[12],v[13],v[14]],x);return[S[0],S[1],S[2],0,I[0],I[1],I[2],0,A[0],A[1],A[2],0,N[0],N[1],N[2],1]}(u,function(m,v){const x=v.worldSize,C=ro(1,0)*x*jd(v.center.lat,v.zoom)/wi(x),S=ro(1,v.center.lat)*x,I=d.ae.identity([]);return d.ae.rotateY(I,I,Fn(v.center.lng)),d.ae.rotateX(I,I,Fn(v.center.lat)),d.ae.translate(I,I,[0,0,ns]),d.ae.scale(I,I,[C,C,C*S]),d.ae.translate(I,I,[v.point.x-.5*x,v.point.y-.5*x,0]),d.ae.multiply(I,I,m),d.ae.multiply(I,v.globeMatrix,I)}(o,i),c):u}function Q0(o,i,s,c){const u=Ui.projectAabbCorners(c,s);let p=Number.MAX_VALUE,m=-1;for(let C=0;C<u.length;++C){const S=u[C];S[0]=(.5*S[0]+.5)*i.width,S[1]=(.5-.5*S[1])*i.height,S[2]<p&&(m=C,p=S[2])}const v=C=>new _t(u[C][0],u[C][1]);let x;switch(m){case 0:case 6:x=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:x=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:x=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:x=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(wu(o,x))return p}const b_=tn([{name:"a_pos_3f",components:3,type:"Float32"}]),TE=tn([{name:"a_color_3f",components:3,type:"Float32"}]),EE=tn([{name:"a_color_4f",components:4,type:"Float32"}]),_I=tn([{name:"a_uv_2f",components:2,type:"Float32"}]),x_=tn([{name:"a_normal_3f",components:3,type:"Float32"}]),ev=tn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),uP=tn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class tv{constructor(i,s,c,u){this.message=(i?`${i}: `:"")+c,u&&(this.identifier=u),null!=s&&s.__line__&&(this.line=s.__line__)}}function xx(o,i){const s=-1===o.indexOf("://");try{return new URL(o,s&&i?"http://example.com":void 0),!0}catch{return!1}}class nv{constructor(i,s){this.feature=i,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class DE{constructor(){this.instancedDataArray=new Gy,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class iv{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=i.projection,this.index=i.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(i,s){}populate(i,s,c,u){this.tileToMeter=Ia(c);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:x,sourceLayerIndex:C}of i){const S=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),I=xc(m,p);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),I,c))continue;const A={id:S,sourceLayerIndex:C,index:x,geometry:p?I.geometry:el(m,c,u),properties:m.properties,type:m.type,patterns:{}},N=this.addFeature(A,A.geometry,I);N&&s.featureIndex.insert(m,A.geometry,x,C,this.index,this.instancesPerModel[N].instancedDataArray.length,ft/32)}this.lookup=null}update(i,s,c,u){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in i)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],i[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];for(const u of c.features){const p=this.layers[0],m=u.feature,v=this.canonical,x=p.paint.get("model-rotation").evaluate(m,{},v),C=p.paint.get("model-scale").evaluate(m,{},v),S=p.paint.get("model-translation").evaluate(m,{},v);d.$.exactEquals(u.rotation,x)&&d.$.exactEquals(u.scale,C)&&d.$.exactEquals(u.translation,S)||(this.evaluate(u,u.featureStates,c,!0),i=!0)}}return i}updateReplacement(i,s,c,u){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const p=s.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(_b(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const x=this.instancesPerModel[v],C=x.instancedDataArray;for(const S of x.features){const I=S.instancedDataOffset,A=S.instancedDataCount;for(let N=0;N<A;N++){const F=16*(N+I);let z=C.float32[F+0];z=z>ft?z-ft:z;const V=Math.floor(z),$=C.float32[F+1];let ne=!1;for(const ee of this.activeReplacements)if(!sT(ee,c,xb.Model,u)&&!(ee.min.x>V||V>ee.max.x||ee.min.y>$||$>ee.max.y)&&(ne=MM(lT(V,$,i.canonical,ee.footprintTileId.canonical),ee),ne))break;C.float32[F]=ne?z+ft:z,m=m||ne}}}return m}isEmpty(){for(const i in this.instancesPerModel)if(0!==this.instancesPerModel[i].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length<0||0===c.instancedDataArray.length||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=i.createVertexBuffer(c.instancedDataArray,ev.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];0!==c.instancedDataArray.length&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris)for(const s of this.modelUris)i.removeModel(s,"")}addFeature(i,s,c){const u=this.layers[0],p=u.layout.get("model-id").evaluate(c,{},this.canonical);if(!p)return fr(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),p;xx(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new DE);const m=this.instancesPerModel[p],v=m.instancedDataArray,x=new nv(c,v.length);for(const C of s)for(const S of C){if(S.x<0||S.x>=ft||S.y<0||S.y>=ft)continue;const I=(this.lookupDim-1)/ft,A=this.lookupDim*(S.y*I|0)+S.x*I|0;if(this.lookup){if(0!==this.lookup[A])continue;this.lookup[A]=1}this.instanceCount++;const N=v.length;v.resize(N+1),m.instancesEvaluatedElevation.push(0),v.float32[16*N]=S.x,v.float32[16*N+1]=S.y}return x.instancedDataCount=m.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(i.id&&(m.idToFeaturesIndex[i.id]=m.features.length),m.features.push(x),this.evaluate(x,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(i,s,c,u){const p=this.layers[0],m=i.feature,v=this.canonical,x=i.rotation=p.paint.get("model-rotation").evaluate(m,s,v),C=i.scale=p.paint.get("model-scale").evaluate(m,s,v),S=i.translation=p.paint.get("model-translation").evaluate(m,s,v),I=p.paint.get("model-color").evaluate(m,s,v);I.a=p.paint.get("model-color-mix-intensity").evaluate(m,s,v);const A=[];this.maxVerticalOffset<S[2]&&(this.maxVerticalOffset=S[2]),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),CE(A,x,C);const N=Math.round(100*I.a)+I.b/1.05;for(let F=0;F<i.instancedDataCount;++F){const z=i.instancedDataOffset+F,V=16*z,$=c.instancedDataArray.float32;let ne=0;u&&(ne=$[V+6]-c.instancesEvaluatedElevation[z]);const ee=0|$[V+1];$[V]=(0|$[V])+I.r/1.05,$[V+1]=ee+I.g/1.05,$[V+2]=N,$[V+3]=1/(v.z>10?this.tileToMeter:Ia(v,ee)),$[V+4]=S[0],$[V+5]=S[1],$[V+6]=S[2]+ne,$[V+7]=A[0],$[V+8]=A[1],$[V+9]=A[2],$[V+10]=A[4],$[V+11]=A[5],$[V+12]=A[6],$[V+13]=A[8],$[V+14]=A[9],$[V+15]=A[10],c.instancesEvaluatedElevation[z]=S[2]}}}let SE,wx;Ee(iv,"ModelBucket",{omit:["layers"]}),Ee(DE,"PerModelAttributes"),Ee(nv,"ModelFeature");const Ef={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function rv(o,i,s,c,u,p,m,v,x,C=!1){const S=s.zoom,I=s.project(c),A=jd(c.lat,S),N=1/A;d.ae.identity(o),d.ae.translate(o,o,[I.x+m[0]*N,I.y+m[1]*N,m[2]]);let F=1,z=1;const V=s.worldSize;if(C){if("mercator"===s.projection.name){let re=0;s.elevation&&(re=s.elevation.getAtPointOrZero(new ko(I.x/V,I.y/V),0));const de=d.aB.transformMat4([],[I.x,I.y,re,1],s.projMatrix)[3]/s.cameraToCenterDistance;F=de,z=de*jd(s.center.lat,S)}else if("globe"===s.projection.name){const re=bx(o,s),de=d.ae.multiply([],s.projMatrix,re),fe=[0,0,0,1];d.aB.transformMat4(fe,fe,de);const _e=fe[3]/s.cameraToCenterDistance,De=Hd(S),Pe=s.projection.pixelsPerMeter(c.lat,V)*jd(c.lat,S),Be=s.projection.pixelsPerMeter(s.center.lat,V)*jd(s.center.lat,S);F=_e/Yt(Pe,H1(s.center.lat),De),z=_e*A/Pe,F*=Be,z*=Be}}else F=N;d.ae.scale(o,o,[F,F,z]);const $=[...o],ne=i.orientation,ee=[];if(CE(ee,[ne[0]+u[0],ne[1]+u[1],ne[2]+u[2]],p),d.ae.multiply(o,$,ee),v&&s.elevation){let re=0;const de=[];if(x&&s.elevation){re=function(De,Pe,Be,Ne,He){const st=Pe.elevation;if(!st)return 0;const qe=Ui.projectAabbCorners(Be,Ne),ut=ro(1,He.lat)*Pe.worldSize,Ge=function(sn,Vt){const Ot=[0,0,1],gn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const wn of gn){const bn=sn[wn.corners[0]],Dn=sn[wn.corners[1]],Ln=sn[wn.corners[2]],Nn=[Dn[0]-bn[0],Dn[1]-bn[1],Vt*(Dn[2]-bn[2])],_i=d.$.cross(Nn,Nn,[Ln[0]-bn[0],Ln[1]-bn[1],Vt*(Ln[2]-bn[2])]);d.$.normalize(_i,_i),wn.dotProductWithUp=d.$.dot(_i,Ot)}return gn.sort((wn,bn)=>wn.dotProductWithUp-bn.dotProductWithUp),gn[0].corners}(qe,ut),Qe=qe[Ge[0]],ht=qe[Ge[1]],$e=qe[Ge[2]],xt=qe[Ge[3]],dt=st.getAtPointOrZero(new ko(Qe[0]/Pe.worldSize,Qe[1]/Pe.worldSize),0),at=st.getAtPointOrZero(new ko(ht[0]/Pe.worldSize,ht[1]/Pe.worldSize),0),jt=st.getAtPointOrZero(new ko($e[0]/Pe.worldSize,$e[1]/Pe.worldSize),0),Bt=st.getAtPointOrZero(new ko(xt[0]/Pe.worldSize,xt[1]/Pe.worldSize),0),Dt=(dt+Bt)/2,yt=(at+jt)/2;return Dt>yt?at<jt?J0(De,ht,xt,Qe,at,Bt,dt,ut):J0(De,$e,Qe,xt,jt,dt,Bt,ut):dt<Bt?J0(De,Qe,ht,$e,dt,at,jt,ut):J0(De,xt,$e,ht,Bt,jt,at,ut),Math.max(Dt,yt)}(de,s,i.aabb,o,c);const fe=d.ae.fromQuat([],de),_e=d.ae.multiply([],fe,ee);d.ae.multiply(o,$,_e)}else re=s.elevation.getAtPointOrZero(new ko(I.x/V,I.y/V),0);0!==re&&(o[14]+=re)}}function w_(o,i,s=!1){o.uploaded||(o.gfxTexture=new Al(i,o.image,s?i.gl.R8:i.gl.RGBA,{useMipmap:o.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function yI(o,i,s){o.indexBuffer=i.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=i.createVertexBuffer(o.vertexArray,b_.members,!1,!0),o.normalArray&&(o.normalBuffer=i.createVertexBuffer(o.normalArray,x_.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=i.createVertexBuffer(o.texcoordArray,_I.members,!1,!0)),o.colorArray&&(o.colorBuffer=i.createVertexBuffer(o.colorArray,(12===o.colorArray.bytesPerElement?TE:EE).members,!1,!0)),o.featureArray&&(o.pbrBuffer=i.createVertexBuffer(o.featureArray,uP.members,!0)),o.segments=Ki.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const c=o.material;c.pbrMetallicRoughness.baseColorTexture&&w_(c.pbrMetallicRoughness.baseColorTexture,i),c.pbrMetallicRoughness.metallicRoughnessTexture&&w_(c.pbrMetallicRoughness.metallicRoughnessTexture,i),c.normalTexture&&w_(c.normalTexture,i),c.occlusionTexture&&w_(c.occlusionTexture,i,s),c.emissionTexture&&w_(c.emissionTexture,i)}function Cx(o,i,s){if(o.meshes)for(const c of o.meshes)yI(c,i,s);if(o.children)for(const c of o.children)Cx(c,i,s)}function ov(o){if(o.meshes)for(const i of o.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(o.children)for(const i of o.children)ov(i)}function Tx(o){if(o.meshes)for(const s of o.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((i=s.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(o.children)for(const s of o.children)Tx(s)}class vI{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Ex{constructor(){this.tasks={},this.taskQueue=[],np(["process"],this),this.invoker=new vI(this.process),this.nextId=0}add(i,s){const c=this.nextId++,u=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,"message"===p?0:"maybePrepare"!==p||m?"parseTile"!==p||m?"parseTile"===p&&m?300-v:"maybePrepare"===p&&m?400-v:500:200-v:100-v}(s);if(0===u){try{i()}finally{}return null}return this.tasks[c]={fn:i,metadata:s,priority:u,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const s=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let i=null,s=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<s&&(s=p.priority,i=u)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}class ME{constructor(i,s,c){this.target=i,this.parent=s,this.mapId=c,this.callbacks={},this.cancelCallbacks={},np(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Ex}send(i,s,c,u,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[v]=c);const x=new Set;return this.target.postMessage({id:v,type:i,hasCallback:!!c,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:Oe(s,x)},x),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(i){const s=i.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if("<cancel>"===s.type){const u=this.cancelCallbacks[c];delete this.cancelCallbacks[c],u&&u.cancel()}else if(s.mustQueue||Oh()){const u=this.callbacks[c],p=this.scheduler.add(()=>this.processTask(c,s),u&&u.metadata||{type:"message"});p&&(this.cancelCallbacks[c]=p)}else this.processTask(c,s)}processTask(i,s){if(delete this.cancelCallbacks[i],"<response>"===s.type){const c=this.callbacks[i];delete this.callbacks[i],c&&(s.error?c(ze(s.error)):c(null,ze(s.data)))}else{const c=new Set,u=s.hasCallback?(m,v)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?Oe(m):null,data:Oe(v,c)},c)}:m=>{},p=ze(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,p,u);else if(this.parent.getWorkerSource){const m=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,m[0],p.source,p.scope)[m[1]](p,u)}else u(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Dx=(()=>{class o{constructor(s,c){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=$m();const u=this.workerPool.acquire(this.id);for(let p=0;p<u.length;p++){const m=new o.Actor(u[p],c,this.id);m.name=`Worker ${p}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,c,u){ep(this.actors,(p,m)=>{p.send(s,c,m)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}return o.Actor=ME,o})();var C_={workerUrl:"",workerClass:null,workerParams:void 0};function Df(){return null!=C_.workerClass?new C_.workerClass:new self.Worker(C_.workerUrl,C_.workerParams)}const Sf="mapboxgl_preloaded_worker_pool";class Mf{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Mf.workerCount;)this.workers.push(new Df);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&0===this.numActive()&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Sf]}numActive(){return Object.keys(this.active).length}}let If;function sv(){return If||(If=new Mf),If}Mf.workerCount=2;let Nu,av,Pl,fm,Sx,pm=null;function IE(){return Oh()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:av||Cn.DRACO_URL}function Mx(){if(Oh()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(fm)return fm;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return fm=WebAssembly.validate(o)?Cn.MESHOPT_SIMD_URL:Cn.MESHOPT_URL,fm}const lv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},AE={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},sh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function OE(o,i,s){const c=s.json.bufferViews.length,u=s.buffers.length;i.bufferView=c,s.json.bufferViews[c]={buffer:u,byteLength:o.byteLength},s.buffers[u]=o}const Ix="KHR_draco_mesh_compression";function PE(o,i){const s=o.extensions&&o.extensions[Ix];if(!s)return;const c=new Pl.Decoder,u=Ax(i,s.bufferView),p=new Pl.Mesh;if(!c.DecodeArrayToMesh(u,u.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=i.json.accessors[o.indices],v=lv[m.componentType],x=m.count*v.BYTES_PER_ELEMENT,C=Pl._malloc(x);v===Uint16Array?c.GetTrianglesUInt16Array(p,x,C):c.GetTrianglesUInt32Array(p,x,C),OE(Pl.memory.buffer.slice(C,C+x),m,i),Pl._free(C);for(const S of Object.keys(s.attributes)){const I=c.GetAttributeByUniqueId(p,s.attributes[S]),A=i.json.accessors[o.attributes[S]],N=AE[A.componentType],F=A.count*sh[A.type]*lv[A.componentType].BYTES_PER_ELEMENT,z=Pl._malloc(F);c.GetAttributeDataArrayForAllPoints(p,I,Pl[N],F,z),OE(Pl.memory.buffer.slice(z,z+F),A,i),Pl._free(z)}c.destroy(),p.destroy(),delete o.extensions[Ix]}const cv="EXT_meshopt_compression";function bI(o,i){if(!o.extensions||!o.extensions[cv])return;const s=o.extensions[cv],c=new Uint8Array(i.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),u=new Uint8Array(s.count*s.byteStride);Sx.decodeGltfBuffer(u,s.count,s.byteStride,c,s.mode,s.filter),o.buffer=i.buffers.length,o.byteOffset=0,i.buffers[o.buffer]=u.buffer,delete o.extensions[cv]}const ah=1179937895,Af=new TextDecoder("utf8");function mm(o,i){return new URL(o,i).href}function dP(o,i,s,c){return fetch(mm(o.uri,c)).then(u=>u.arrayBuffer()).then(u=>{i.buffers[s]=u})}function Ax(o,i){const s=o.json.bufferViews[i];return new Uint8Array(o.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function xI(o,i,s,c){if(o.uri){const u=mm(o.uri,c);return fetch(u).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{i.images[s]=p})}if(void 0!==o.bufferView){const u=Ax(i,o.bufferView),p=new Blob([u],{type:o.mimeType});return createImageBitmap(p).then(m=>{i.images[s]=m})}}function Ox(o,i=0,s){const c={json:null,images:[],buffers:[]};if(new Uint32Array(o,i,1)[0]===ah){const S=new Uint32Array(o,i);let I=2;const A=(S[I++]>>2)-3,N=S[I++]>>2;if(I++,c.json=JSON.parse(Af.decode(S.subarray(I,I+N))),I+=N,I<A){const F=S[I++];I++;const z=i+(I<<2);c.buffers[0]=o.slice(z,z+F)}}else c.json=JSON.parse(Af.decode(new Uint8Array(o,i)));const{buffers:u,images:p,meshes:m,extensionsUsed:v,bufferViews:x}=c.json;let C=Promise.resolve();if(u){const S=[];for(let I=0;I<u.length;I++){const A=u[I];A.uri?S.push(dP(A,c,I,s)):c.buffers[I]||(c.buffers[I]=null)}C=Promise.all(S)}return C.then(()=>{const S=[],I=v&&v.includes(Ix),A=v&&v.includes(cv);if(I&&S.push(function(){if(!Pl)return Nu||(Nu=function(N){let F,z=null;function V(){F=new Uint8Array(z.buffer)}function $(){throw new Error("Unexpected Draco error.")}const ne={a:{a:$,d:function(ee,re,de){return F.copyWithin(ee,re,re+de)},c:function(ee){const re=F.length,de=Math.max(ee>>>0,Math.ceil(1.2*re)),fe=Math.ceil((de-re)/65536);try{return z.grow(fe),V(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,ne):N.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,ne))).then(ee=>{const{Rb:re,Qb:de,P:fe,T:_e,X:De,Ja:Pe,La:Be,Qa:Ne,Va:He,Wa:st,eb:qe,jb:ut,f:Ge,e:Qe,yb:ht,zb:$e,Ab:xt,Bb:dt,Db:at,Gb:jt}=ee.instance.exports;z=Qe;const Bt=(()=>{let Dt=0,yt=0,sn=0,Vt=0;return Ot=>{sn&&(re(Vt),re(Dt),yt+=sn,sn=Dt=0),Dt||(yt+=128,Dt=de(yt));const gn=Ot.length+7&-8;let wn=Dt;gn>=yt&&(sn=gn,wn=Vt=de(gn));for(let bn=0;bn<Ot.length;bn++)F[wn+bn]=Ot[bn];return wn}})();return V(),Ge(),{memory:Qe,_free:re,_malloc:de,Mesh:class{constructor(){this.ptr=fe()}destroy(){_e(this.ptr)}},Decoder:class{constructor(){this.ptr=Pe()}destroy(){ut(this.ptr)}DecodeArrayToMesh(Dt,yt,sn){const Vt=Bt(Dt),Ot=Be(this.ptr,Vt,yt,sn.ptr);return!!De(Ot)}GetAttributeByUniqueId(Dt,yt){return{ptr:Ne(this.ptr,Dt.ptr,yt)}}GetTrianglesUInt16Array(Dt,yt,sn){He(this.ptr,Dt.ptr,yt,sn)}GetTrianglesUInt32Array(Dt,yt,sn){st(this.ptr,Dt.ptr,yt,sn)}GetAttributeDataArrayForAllPoints(Dt,yt,sn,Vt,Ot){qe(this.ptr,Dt.ptr,yt.ptr,sn,Vt,Ot)}},DT_INT8:ht(),DT_UINT8:$e(),DT_INT16:xt(),DT_UINT16:dt(),DT_UINT32:at(),DT_FLOAT32:jt()}})}(fetch(IE())),Nu.then(N=>{Pl=N,Nu=void 0}))}()),A&&S.push(function(){if(Sx)return;const N=function(F){let z;const V=WebAssembly.instantiateStreaming(F,{}).then(ee=>{z=ee.instance,z.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ne={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(ee,re,de,fe,_e,De){!function(Pe,Be,Ne,He,st,qe,ut){const Ge=Pe.exports.sbrk,Qe=He+3&-4,ht=Ge(Qe*st),$e=Ge(qe.length),xt=new Uint8Array(Pe.exports.memory.buffer);xt.set(qe,$e);const dt=Be(ht,He,st,$e,qe.length);if(0===dt&&ut&&ut(ht,Qe,st),Ne.set(xt.subarray(ht,ht+He*st)),Ge(ht-Ge(0)),0!==dt)throw new Error(`Malformed buffer data: ${dt}`)}(z,z.exports[ne[_e]],ee,re,de,fe,z.exports[$[De]])}}}(fetch(Mx()));return N.ready.then(()=>{Sx=N})}()),p)for(let N=0;N<p.length;N++)S.push(xI(p[N],c,N,s));return(S.length?Promise.all(S):Promise.resolve()).then(()=>{if(I&&m)for(const{primitives:N}of m)for(const F of N)PE(F,c);if(A&&m&&x)for(const N of x)bI(N,c);return c})})}function Of(o,i){const s=o.json.bufferViews[i.bufferView],c=lv[i.componentType];return new c(o.buffers[s.buffer],(i.byteOffset||0)+(s.byteOffset||0),i.count*(s.byteStride&&s.byteStride!==sh[i.type]*c.BYTES_PER_ELEMENT?s.byteStride/c.BYTES_PER_ELEMENT:sh[i.type]))}function uv(o,i,s,c){const u=lv[i.componentType],p=function(S){switch(S){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),m=o.json.bufferViews[i.bufferView],v=m.byteStride?m.byteStride/u.BYTES_PER_ELEMENT:sh[i.type],x=s.float32,C=x.length/s.capacity;for(let S=0,I=0;S<i.count*v;S+=v,I+=C)for(let A=0;A<C;A++)x[I+A]=c[S+A]*p;s._trim()}function hP(o,i,s){const c=o.indices,u=o.attributes,p={};p.indexArray=new Xi;const m=i.json.accessors[c],v=m.count/3;p.indexArray.reserve(v);const x=Of(i,m);for(let A=0;A<v;A++)p.indexArray.emplaceBack(x[3*A],x[3*A+1],x[3*A+2]);p.indexArray._trim(),p.vertexArray=new Nd;const C=i.json.accessors[u.POSITION];p.vertexArray.reserve(C.count);const S=Of(i,C);for(let A=0;A<C.count;A++)p.vertexArray.emplaceBack(S[3*A],S[3*A+1],S[3*A+2]);if(p.vertexArray._trim(),p.aabb=new Ui(C.min,C.max),p.centroid=function(A,N){const F=[0,0,0],z=A.length;if(z>0){for(let V=0;V<z;V++){const $=3*A[V];F[0]+=N[$],F[1]+=N[$+1],F[2]+=N[$+2]}F[0]/=z,F[1]/=z,F[2]/=z}return F}(x,S),void 0!==u.COLOR_0){const A=i.json.accessors[u.COLOR_0],N=sh[A.type],F=Of(i,A);p.colorArray=3===N?new Nd:new io,p.colorArray.resize(A.count),uv(i,A,p.colorArray,F)}if(void 0!==u.NORMAL){p.normalArray=new Nd;const A=i.json.accessors[u.NORMAL];p.normalArray.resize(A.count);const N=Of(i,A);uv(i,A,p.normalArray,N)}if(void 0!==u.TEXCOORD_0&&s.length>0){p.texcoordArray=new bg;const A=i.json.accessors[u.TEXCOORD_0];p.texcoordArray.resize(A.count);const N=Of(i,A);uv(i,A,p.texcoordArray,N)}if(void 0!==u._FEATURE_ID_RGBA4444){const A=i.json.accessors[u._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Of(i,A))}void 0!==u._FEATURE_RGBA4444&&(p.featureData=new Uint32Array(Of(i,i.json.accessors[u._FEATURE_RGBA4444]).buffer));const I=o.material;return p.material=function(A,N){const{emissiveFactor:F=[0,0,0],alphaMode:z="OPAQUE",alphaCutoff:V=.5,normalTexture:$,occlusionTexture:ne,emissiveTexture:ee,doubleSided:re}=A,{baseColorFactor:de=[1,1,1,1],metallicFactor:fe=1,roughnessFactor:_e=1,baseColorTexture:De,metallicRoughnessTexture:Pe}=A.pbrMetallicRoughness||{},Be=ne?N[ne.index]:void 0;if(ne&&ne.extensions&&ne.extensions.KHR_texture_transform&&Be){const Ne=ne.extensions.KHR_texture_transform;Be.offsetScale=[Ne.offset[0],Ne.offset[1],Ne.scale[0],Ne.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ni(...de),metallicFactor:fe,roughnessFactor:_e,baseColorTexture:De?N[De.index]:void 0,metallicRoughnessTexture:Pe?N[Pe.index]:void 0},doubleSided:re,emissiveFactor:F,alphaMode:z,alphaCutoff:V,normalTexture:$?N[$.index]:void 0,occlusionTexture:Be,emissionTexture:ee?N[ee.index]:void 0,defined:void 0===A.defined}}(void 0!==I?i.json.materials[I]:{defined:!1},s),p}function RE(o,i,s){const{matrix:c,rotation:u,translation:p,scale:m,mesh:v,extras:x,children:C}=o,S={};if(S.matrix=c||d.ae.fromRotationTranslationScale([],u||[0,0,0,1],p||[0,0,0],m||[1,1,1]),void 0!==v){S.meshes=s[v];const I=S.anchor=[0,0];for(const A of S.meshes){const{min:N,max:F}=A.aabb;I[0]+=N[0]+F[0],I[1]+=N[1]+F[1]}I[0]=Math.floor(I[0]/S.meshes.length/2),I[1]=Math.floor(I[1]/S.meshes.length/2)}if(x&&(x.id&&(S.id=x.id),x.lights&&(S.lights=function(I){if(!I.length)return[];const A=function($){const ne=atob($),ee=new Uint8Array(ne.length);for(let re=0;re<ne.length;re++)ee[re]=ne.codePointAt(re);return ee}(I),N=[],F=A.length/24,z=new Uint16Array(A.buffer),V=new Float32Array(A.buffer);for(let $=0;$<F;$++){const ne=z[2*$*6]/30,ee=z[2*$*6+1]/30,re=z[2*$*6+10]/100,de=V[6*$+1],fe=V[6*$+2],_e=V[6*$+3],De=V[6*$+4],Pe=_e-de,Be=De-fe,Ne=Math.hypot(Pe,Be);N.push({pos:[de+.5*Pe,fe+.5*Be,ee],normal:[Be/Ne,-Pe/Ne,0],width:Ne,height:ne,depth:re,points:[de,fe,_e,De]})}return N}(x.lights))),C){const I=[];for(const A of C)I.push(RE(i.json.nodes[A],i,s));S.children=I}return S}function dv(o){if(0===o.vertices.length||0===o.indices.length)return null;const i=new Zd(o.vertices,o.indices,8,256),[s,c]=[i.min.clone(),i.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:i,min:s,max:c}}function Px(o){if(!o.extras||!o.extras.ground)return null;const i=o.extras.ground;if(!i||!Array.isArray(i)||0===i.length)return null;const s=i[0];if(!s||!Array.isArray(s)||0===s.length)return null;const c=[];for(const m of s){if(!Array.isArray(m)||2!==m.length)continue;const v=m[0],x=m[1];"number"==typeof v&&"number"==typeof x&&c.push(new _t(v,x))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let u=0;for(let m=0;m<c.length;m++){const v=c[m],x=c[(m+1)%c.length],C=c[(m+2)%c.length];u+=(v.x-x.x)*(C.y-x.y)-(C.x-x.x)*(v.y-x.y)}u>0&&c.reverse();const p=Bp(c.flatMap(m=>[m.x,m.y]),[]);return 0===p.length?null:{vertices:c,indices:p}}function Oc(o,i){const s=[],c=[];let u=0;const p=[];for(const m of o){u=s.length;const v=m.vertexArray.float32,x=m.indexArray.uint16;for(let C=0;C<m.vertexArray.length;C++)p[0]=v[3*C+0],p[1]=v[3*C+1],p[2]=v[3*C+2],d.$.transformMat4(p,p,i),s.push(new _t(p[0],p[1]));for(let C=0;C<3*m.indexArray.length;C++)c.push(x[C]+u)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const v=s[c[m+0]],x=s[c[m+1]],C=s[c[m+2]];(v.x-x.x)*(C.y-x.y)-(C.x-x.x)*(v.y-x.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:s,indices:c}}function NE(o){const s=function(x,C){const S=[];for(const I of x.json.meshes){const A=[];for(const N of I.primitives)A.push(hP(N,x,C));S.push(A)}return S}(o,function(x,C){const S=[],I=WebGL2RenderingContext;if(x.json.textures)for(const A of x.json.textures){const N={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};void 0!==A.sampler&&Object.assign(N,x.json.samplers[A.sampler]),S.push({image:C[A.source],sampler:N,uploaded:!1})}return S}(o,o.images)),{scenes:c,scene:u,nodes:p}=o.json,m=c?c[u||0].nodes:p,v=[];for(const x of m)v.push(RE(p[x],o,s));return function(x,C,S){const I={},A=new Set;for(let N=0;N<x.length;N++){const F=S[C[N]];if(!F.extras)continue;const z=F.extras["mapbox:footprint:version"],V=F.extras["mapbox:footprint:id"];(z||V)&&A.add(N),"1.0.0"===z&&V&&(I[V]=N)}for(let N=0;N<x.length;N++){if(A.has(N))continue;const F=x[N],z=S[C[N]];if(!z.extras)continue;let V=null;F.id in I&&(V=Oc(x[I[F.id]].meshes,F.matrix)),V||(V=Px(z)),V&&(F.footprint=dv(V))}if(A.size>0){const N=Array.from(A.values()).sort((F,z)=>F-z);for(let F=N.length-1;F>=0;F--)x.splice(N[F],1)}}(v,m,o.json.nodes),v}function wI(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const i=o.vertexArray.float32,s=o.aabb.min[0]-1,c=o.aabb.min[1]-1,u=64/(o.aabb.max[0]-s+2),p=64/(o.aabb.max[1]-c+2);for(let m=0;m<i.length;m+=3){const v=i[m+2],x=(i[m+0]-s)*u|0,C=(i[m+1]-c)*p|0;v>o.heightmap[64*C+x]&&(o.heightmap[64*C+x]=v)}}function fP(o,i){const s={};s.indexArray=new Xi,s.indexArray.reserve(4*o.length),s.vertexArray=new Nd,s.vertexArray.reserve(10*o.length),s.colorArray=new io,s.vertexArray.reserve(10*o.length);let c=0;for(const m of o){const v=Math.min(10,Math.max(4,1.3*m.height))*i,x=[-m.normal[1],m.normal[0],0],C=Math.min(.29,.1*m.width/m.depth),S=m.width-2*m.depth*i*(C+.01),I=d.$.scaleAndAdd([],m.pos,x,S/2),A=d.$.scaleAndAdd([],m.pos,x,-S/2),N=[I[0],I[1],I[2]+m.height],F=[A[0],A[1],A[2]+m.height],z=d.$.scaleAndAdd([],m.normal,x,C);d.$.scale(z,z,v);const V=d.$.scaleAndAdd([],m.normal,x,-C);d.$.scale(V,V,v),d.$.add(z,I,z),d.$.add(V,A,V),I[2]+=.1,A[2]+=.1,s.vertexArray.emplaceBack(z[0],z[1],z[2]),s.vertexArray.emplaceBack(V[0],V[1],V[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(A[0],A[1],A[2]),s.vertexArray.emplaceBack(N[0],N[1],N[2]),s.vertexArray.emplaceBack(F[0],F[1],F[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(A[0],A[1],A[2]),s.vertexArray.emplaceBack(z[0],z[1],z[2]),s.vertexArray.emplaceBack(V[0],V[1],V[2]);const $=S/v/2;s.colorArray.emplaceBack(-$-C,-1,$,.8),s.colorArray.emplaceBack($+C,-1,$,.8),s.colorArray.emplaceBack(-$,0,$,1.3),s.colorArray.emplaceBack($,0,$,1.3),s.colorArray.emplaceBack($+C,-.8,$,.7),s.colorArray.emplaceBack($+C,-.8,$,.7),s.colorArray.emplaceBack(0,0,$,1.3),s.colorArray.emplaceBack(0,0,$,1.3),s.colorArray.emplaceBack($+C,-1.2,$,.8),s.colorArray.emplaceBack($+C,-1.2,$,.8),s.indexArray.emplaceBack(6+c,4+c,8+c),s.indexArray.emplaceBack(7+c,9+c,5+c),s.indexArray.emplaceBack(0+c,1+c,2+c),s.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const u={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=ni.white,u.pbrMetallicRoughness=p,s.material=u,s.aabb=new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const hv=new Float32Array(262144),Yr=new Uint8Array(262144);function Rx(o){let i=0;if(o.meshes)for(const s of o.meshes)i=Math.max(i,s.aabb.max[2]);if(o.children)for(const s of o.children)i=Math.max(i,Rx(s));return i}function Nx(o,i,s){if(o.meshes)for(const c of o.meshes)c.aabb.min[0]!==1/0&&s.insert(i,c.aabb.min[0],c.aabb.min[1],c.aabb.max[0],c.aabb.max[1]);if(o.children)for(const c of o.children)Nx(c,i,s)}const kx=["","wall","door","roof","window","lamp","logo"];class CI{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:i.id,geometry:[],properties:{height:Rx(i)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const s=new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==i&&(c.transformedAabb=Ui.applyTransformFast(c.aabb,this.node.matrix),s.encapsulate(c.transformedAabb)),i++;this.aabb=s}return this.aabb}}class ii{constructor(i,s,c,u,p,m){this.id=s,this.modelTraits|=Ef.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=Ef.HasMapboxMeshFeatures),u&&(this.modelTraits|=Ef.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const v of i)this.nodesInfo.push(new CI(v)),Nx(v,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(i,s){for(const c of this.getNodesInfo()){const u=c.node;u.footprint&&s.push({footprint:u.footprint,id:i})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const c of s){const u=c.node;this.uploaded?this.updatePbrBuffer(u):Cx(u,i,!0)}for(const c of s)ov(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let s=!1;if(!i.meshes)return s;for(const c of i.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),s=!0);return s}needsReEvaluation(i,s,c){const u=i.transform.projectionOptions,p=i.style.getBrightness(),m=this.brightness!==p;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||T_(c.paint.get("model-color").value,m)||T_(c.paint.get("model-color-mix-intensity").value,m)||T_(c.paint.get("model-roughness").value,m)||T_(c.paint.get("model-emissive-strength").value,m)||T_(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=u,this.brightness=p,!0)}evaluateScale(i,s){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const c=this.getNodesInfo(),u=this.id.canonical;for(const p of c){const m=p.feature;p.evaluatedScale=s.paint.get("model-scale").evaluate(m,{},u)}}evaluate(i){const s=this.getNodesInfo();for(const c of s){if(!c.node.meshes)continue;const u=c.feature,p=c.node.meshes&&c.node.meshes[0].featureData,m=c.evaluatedColor[2],v=c.evaluatedRMEA[2],x=this.id.canonical;if(c.hasTranslucentParts=!1,p){for(let C=0;C<kx.length;C++){const S=kx[C];S.length&&(u.properties.part=S);const I=i.paint.get("model-color").evaluate(u,{},x).toRenderColor(null),A=i.paint.get("model-color-mix-intensity").evaluate(u,{},x);c.evaluatedColor[C]=[I.r,I.g,I.b,A],c.evaluatedRMEA[C][0]=i.paint.get("model-roughness").evaluate(u,{},x),c.evaluatedRMEA[C][2]=i.paint.get("model-emissive-strength").evaluate(u,{},x),c.evaluatedRMEA[C][3]=I.a,c.emissionHeightBasedParams[C]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},x),!c.hasTranslucentParts&&I.a<1&&(c.hasTranslucentParts=!0)}delete u.properties.part,TI(c,m!==c.evaluatedColor[2]||v!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(u,{},x);c.evaluatedScale=i.paint.get("model-scale").evaluate(u,{},x),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,s,c,u){const p=i.findDEMTileFor(c);if(p&&(p.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=Du.create(i,c,p);if(!m)return;this.modelTraits&Ef.HasMapboxMeshFeatures&&this.updateDEM(i,m,c,u);for(const v of this.getNodesInfo()){const x=v.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const C=x.footprint.vertices;let S=m.getElevationAt(C[0].x,C[0].y,!0,!0);for(let I=1;I<C.length;I++)S=Math.min(S,m.getElevationAt(C[I].x,C[I].y,!0,!0));x.elevation=S}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=s}}updateDEM(i,s,c,u){let p=s._dem._modifiedForSources[u];if(void 0===p&&(s._dem._modifiedForSources[u]=[],p=s._dem._modifiedForSources[u]),p.includes(c.canonical))return;const m=s._dem.dim;p.push(c.canonical);let v=!1;for(const x of this.getNodesInfo()){const C=x.node;if(!C.footprint||!C.footprint.grid)continue;const S=C.footprint.grid,I=s.tileCoordToPixel(S.min.x,S.min.y),A=s.tileCoordToPixel(S.max.x,S.max.y),N=Math.min(Math.min(m-A.y,I.x),Math.min(I.y,m-A.x));if(N<0)continue;const F=Sn(N,2,5);let z=Math.max(0,I.x-F),V=Math.max(0,I.y-F),$=Math.min(A.x+F,m-1),ne=Math.min(A.y+F,m-1);for(let fe=V;fe<=ne;++fe)for(let _e=z;_e<=$;++_e)Yr[fe*m+_e]=255;let ee=0,re=0;for(let fe=0;fe<S.cellsY;++fe)for(let _e=0;_e<S.cellsX;++_e){if(!S.cells[fe*S.cellsX+_e])continue;const De=s.tileCoordToPixel(S.min.x+_e/S.xScale,S.min.y+fe/S.yScale),Pe=s.tileCoordToPixel(S.min.x+(_e+1)/S.xScale,S.min.y+(fe+1)/S.yScale);for(let Be=De.y;Be<=Math.min(Pe.y+1,m-1);++Be)for(let Ne=De.x;Ne<=Math.min(Pe.x+1,m-1);++Ne)255===Yr[Be*m+Ne]&&(Yr[Be*m+Ne]=0,ee+=s.getElevationAtPixel(Ne,Be),re++)}const de=ee/re;z=Math.max(1,I.x-F),V=Math.max(1,I.y-F),$=Math.min(A.x+F,m-2),ne=Math.min(A.y+F,m-2),v=!0;for(let fe=V;fe<=ne;++fe)for(let _e=z;_e<=$;++_e)0===Yr[fe*m+_e]&&(hv[fe*m+_e]=s._dem.set(_e,fe,de));for(let fe=1;fe<F;++fe){z=Math.max(1,I.x-fe),V=Math.max(1,I.y-fe),$=Math.min(A.x+fe,m-2),ne=Math.min(A.y+fe,m-2);for(let _e=V;_e<=ne;++_e)for(let De=z;De<=$;++De){const Pe=_e*m+De;if(255===Yr[Pe]){let Be=0,Ne=0,He=-1,st=-1;for(let qe=-1;qe<=1;++qe)for(let ut=-1;ut<=1;++ut){const Ge=(_e+qe)*m+De+ut;if(Yr[Ge]>=fe)continue;const Qe=hv[Ge],ht=Math.abs(Qe);ht>Ne&&(Be=Qe,Ne=ht,He=ut,st=qe)}if(Ne>.1){const qe=1-(fe+.5*Math.abs(He*st))/F;let ut=s._dem.get(De,_e)+Be*qe;const Ge=s._dem.get(De+He,_e+st),Qe=s._dem.get(De-He,_e-st,!0);(ut-Ge)*(ut-Qe)>0&&(ut=(Ge+Qe)/2),hv[Pe]=s._dem.set(De,_e,ut),Yr[Pe]=fe}}}}}v&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=Mo.now())}getNodesInfo(){return this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const s of i)ov(s.node),Tx(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(i.toUnwrapped()),u=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const m=u[p].node;u[p].hiddenByReplacement=!!m.footprint&&!c.find(v=>v.footprint===m.footprint)}}getHeightAtTileCoord(i,s){const c=this.getNodesInfo(),u=[],p=[0,0,0],m=d.ae.identity([]);for(let v=0;v<this.nodesInfo.length;v++){const x=c[v],C=x.node.meshes[0],S=C.transformedAabb;if(i<S.min[0]||s<S.min[1]||i>S.max[0]||s>S.max[1])continue;if(!0===x.node.hidden)return{height:0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};d.ae.invert(m,x.node.matrix),p[0]=i,p[1]=s,d.$.transformMat4(p,p,m);const I=(p[0]-C.aabb.min[0])/(C.aabb.max[0]-C.aabb.min[0])*64|0,A=64*Math.min(63,(p[1]-C.aabb.min[1])/(C.aabb.max[1]-C.aabb.min[1])*64|0)+Math.min(63,I),N=C.heightmap[A];if(!(N<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:N,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new _t(i,s),new _t(i,s),u),u.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function T_(o,i){return!o.isLightConstant&&i}function Fx(o,i,s,c,u,p,m,v){let x=(61440&i|(61440&i)>>4)>>8,C=(3840&i|(3840&i)>>4)>>4,S=240&i|(240&i)>>4;s[3]>0&&(x=Yt(x,255*s[0],s[3]),C=Yt(C,255*s[1],s[3]),S=Yt(S,255*s[2],s[3]));const I=x<<8|C,A=S<<8|Math.floor(255*c[3]),N=function(fe){const _e=Sn(fe,0,2);return Math.min(Math.round(.5*_e*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],F=Sn(u[0],0,1),z=Sn(u[1],0,1),V=Sn(u[2],0,1),$=Sn(u[3],0,1);let ne,ee,re,de;if(F!==z&&m!==p&&z!==F){const fe=m-p;ee=1/(fe*(z-F)),re=-(p+fe*F)/(fe*(z-F));const _e=Sn(u[4],-1,1);de=Math.pow(10,_e),ne=255*V<<8|255*$}else ne=65535,ee=0,re=1,de=1;if(o.emplaceBack(I,A,N,ne,ee,re,de),v){const fe=v.length;v.clear();for(let _e=0;_e<fe;_e++)v.emplaceBack(I,A,N,ne,ee,re,de)}}function TI(o,i,s){const c=o.node;let u=0;const p=s&Ef.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===u||!m.featureData)continue;m.featureArray=new gc,m.featureArray.reserve(m.featureData.length);let v=i;for(const x of m.featureData){const C=p?65535&x:x>>16&65535,S=p?x>>16&65535:65535&x,I=(15&S)<8?15&S:0,A=o.evaluatedRMEA[I],N=o.evaluatedColor[I],F=o.emissionHeightBasedParams[I];let z;if(v&&2===I&&c.lights&&(z=new gc,z.resize(10*c.lights.length)),Fx(m.featureArray,C,N,A,F,m.aabb.min[2],m.aabb.max[2],z),z&&v){v=!1;const V=c.meshes[c.lightMeshIndex];V.featureArray=z,V.featureArray._trim()}}m.featureArray._trim(),u++}}function kE(o,i,s,c){const u=1<<o.z;i.lat=$r((c/ft+o.y)/u),i.lng=Ws((s/ft+o.x)/u)}Ee(ii,"Tiled3dModelBucket",{omit:["layers"]}),Ee(CI,"Tiled3dModelFeature");const Lx={circle:class extends js{constructor(o,i,s,c){super(o,{layout:RC||(RC=new Ei({"circle-sort-key":new Nt(Le.layout_circle["circle-sort-key"]),visibility:new ct(Le.layout_circle.visibility)})),paint:NC||(NC=new Ei({"circle-radius":new Nt(Le.paint_circle["circle-radius"]),"circle-color":new Nt(Le.paint_circle["circle-color"]),"circle-blur":new Nt(Le.paint_circle["circle-blur"]),"circle-opacity":new Nt(Le.paint_circle["circle-opacity"]),"circle-translate":new ct(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new ct(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ct(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ct(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nt(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nt(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nt(Le.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ct(Le.paint_circle["circle-emissive-strength"])}))},i,s,c)}createBucket(o){return new Np(o)}queryRadius(o){const i=o;return cf("circle-radius",this,i)+cf("circle-stroke-width",this,i)+Fp(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,s,c,u,p,m,v){const x=Z1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(i,s)+this.paint.get("circle-stroke-width").evaluate(i,s);return ob(o,c,p,m,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),x,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,i,s){const c=rb(this);return{config:new Fr(this,{zoom:i,lut:s}),defines:c,overrideFog:!1}}},heatmap:class extends js{createBucket(o){return new HC(o)}constructor(o,i,s,c){super(o,{layout:cb||(cb=new Ei({visibility:new ct(Le.layout_heatmap.visibility)})),paint:Ng||(Ng=new Ei({"heatmap-radius":new Nt(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nt(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ct(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qo(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ct(Le.paint_heatmap["heatmap-opacity"])}))},i,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=oo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return cf("heatmap-radius",this,o)}queryIntersectsFeature(o,i,s,c,u,p,m,v){const x=this.paint.get("heatmap-radius").evaluate(i,s);return ob(o,c,p,m,v,!0,!0,new _t(0,0),x)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,i,s){return"heatmap"===o?{config:new Fr(this,{zoom:i,lut:s}),overrideFog:!1}:{}}},hillshade:class extends js{constructor(o,i,s,c){super(o,{layout:_M||(_M=new Ei({visibility:new ct(Le.layout_hillshade.visibility)})),paint:yM||(yM=new Ei({"hillshade-illumination-direction":new ct(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ct(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ct(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ct(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ct(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ct(Le.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ct(Le.paint_hillshade["hillshade-emissive-strength"])}))},i,s,c)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,i,s){return{overrideFog:!1}}},fill:class extends js{constructor(o,i,s,c){super(o,{layout:hb||(hb=new Ei({"fill-sort-key":new Nt(Le.layout_fill["fill-sort-key"]),visibility:new ct(Le.layout_fill.visibility)})),paint:d0||(d0=new Ei({"fill-antialias":new ct(Le.paint_fill["fill-antialias"]),"fill-opacity":new Nt(Le.paint_fill["fill-opacity"]),"fill-color":new Nt(Le.paint_fill["fill-color"]),"fill-outline-color":new Nt(Le.paint_fill["fill-outline-color"]),"fill-translate":new ct(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new ct(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nt(Le.paint_fill["fill-pattern"]),"fill-emissive-strength":new ct(Le.paint_fill["fill-emissive-strength"])}))},i,s,c)}getProgramIds(){const o=this.paint.get("fill-pattern"),i=o&&o.constantOr(1),s=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(o,i,s){return{config:new Fr(this,{zoom:i,lut:s}),overrideFog:!1}}recalculate(o,i){super.recalculate(o,i);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new u0(o)}queryRadius(){return Fp(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,s,c,u,p){return!o.queryGeometry.isAboveHorizon&&q1(Mg(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends js{constructor(o,i,s,c){super(o,{layout:CT||(CT=new Ei({visibility:new ct(Le["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ct(Le["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Eb||(Eb=new Ei({"fill-extrusion-opacity":new ct(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nt(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ct(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ct(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nt(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Nt(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nt(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ct(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ct(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ct(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ct(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ct(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ct(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ct(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ct(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Nt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Nt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ct(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ct(Le["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ct(Le["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ct(Le["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ct(Le["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Nt(Le["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new ct(Le["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},i,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new E0(o)}queryRadius(){return Fp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,i,s,c,u,p,m,v,x){const C=Z1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(i,s),I=this.paint.get("fill-extrusion-base").evaluate(i,s),A=[0,0],N=v&&p.elevation,F=p.elevation?p.elevation.exaggeration():1,z=o.tile.getBucket(this);if(N&&z instanceof E0){const re=z.centroidVertexArray,de=x+1;de<re.length&&(A[0]=re.geta_centroid_pos0(de),A[1]=re.geta_centroid_pos1(de))}if(0===A[0]&&1===A[1])return!1;"globe"===p.projection.name&&(c=wT([c],[new _t(0,0),new _t(ft,ft)],o.tileID.canonical).map(re=>re.polygon).flat());const V=N?v:null,[$,ne]=(de=c,fe=I,_e=S,De=C,Pe=m,Be=V,Ne=A,He=F,st=p.center.lat,"globe"===(re=p).projection.name?function(ut,Ge,Qe,ht,$e,xt,dt,at,jt,Bt,Dt){const yt=[],sn=[],Vt=ut.projection.upVectorScale(Dt,ut.center.lat,ut.worldSize).metersToTile,Ot=[0,0,0,1],gn=[0,0,0,1],wn=(Dn,Ln,Nn,_i)=>{Dn[0]=Ln,Dn[1]=Nn,Dn[2]=_i,Dn[3]=1},bn=xT();Qe>0&&(Qe+=bn),ht+=bn;for(const Dn of Ge){const Ln=[],Nn=[];for(const _i of Dn){const yi=_i.x+$e.x,_n=_i.y+$e.y,si=ut.projection.projectTilePoint(yi,_n,Dt),ci=ut.projection.upVector(Dt,_i.x,_i.y);let Ri=Qe,cr=ht;if(dt){const _r=ET(yi,_n,Qe,ht,dt,at,jt,Bt);Ri+=_r.base,cr+=_r.top}0!==Qe?wn(Ot,si.x+ci[0]*Vt*Ri,si.y+ci[1]*Vt*Ri,si.z+ci[2]*Vt*Ri):wn(Ot,si.x,si.y,si.z),wn(gn,si.x+ci[0]*Vt*cr,si.y+ci[1]*Vt*cr,si.z+ci[2]*Vt*cr),d.$.transformMat4(Ot,Ot,xt),d.$.transformMat4(gn,gn,xt),Ln.push(new Tu(Ot[0],Ot[1],Ot[2])),Nn.push(new Tu(gn[0],gn[1],gn[2]))}yt.push(Ln),sn.push(Nn)}return[yt,sn]}(re,de,fe,_e,De,Pe,Be,Ne,He,st,o.tileID.canonical):Be?function(ut,Ge,Qe,ht,$e,xt,dt,at,jt){const Bt=[],Dt=[],yt=[0,0,0,1];for(const sn of ut){const Vt=[],Ot=[];for(const gn of sn){const wn=gn.x+ht.x,bn=gn.y+ht.y,Dn=ET(wn,bn,Ge,Qe,xt,dt,at,jt);yt[0]=wn,yt[1]=bn,yt[2]=Dn.base,yt[3]=1,d.aB.transformMat4(yt,yt,$e),yt[3]=Math.max(yt[3],1e-5);const Ln=new Tu(yt[0]/yt[3],yt[1]/yt[3],yt[2]/yt[3]);yt[0]=wn,yt[1]=bn,yt[2]=Dn.top,yt[3]=1,d.aB.transformMat4(yt,yt,$e),yt[3]=Math.max(yt[3],1e-5);const Nn=new Tu(yt[0]/yt[3],yt[1]/yt[3],yt[2]/yt[3]);Vt.push(Ln),Ot.push(Nn)}Bt.push(Vt),Dt.push(Ot)}return[Bt,Dt]}(de,fe,_e,De,Pe,Be,Ne,He,st):function(ut,Ge,Qe,ht,$e){const xt=[],dt=[],at=$e[8]*Ge,jt=$e[9]*Ge,Bt=$e[10]*Ge,Dt=$e[11]*Ge,yt=$e[8]*Qe,sn=$e[9]*Qe,Vt=$e[10]*Qe,Ot=$e[11]*Qe;for(const gn of ut){const wn=[],bn=[];for(const Dn of gn){const Ln=Dn.x+ht.x,Nn=Dn.y+ht.y,_i=$e[0]*Ln+$e[4]*Nn+$e[12],yi=$e[1]*Ln+$e[5]*Nn+$e[13],_n=$e[2]*Ln+$e[6]*Nn+$e[14],si=$e[3]*Ln+$e[7]*Nn+$e[15],ci=_i+at,Ri=yi+jt,cr=_n+Bt,_r=Math.max(si+Dt,1e-5),Ji=_i+yt,Hi=yi+sn,Gr=_n+Vt,Tr=Math.max(si+Ot,1e-5);wn.push(new Tu(ci/_r,Ri/_r,cr/_r)),bn.push(new Tu(Ji/Tr,Hi/Tr,Gr/Tr))}xt.push(wn),dt.push(bn)}return[xt,dt]}(de,fe,_e,De,Pe)),ee=o.queryGeometry;var re,de,fe,_e,De,Pe,Be,Ne,He,st;return function(re,de,fe){let _e=1/0;q1(fe,de)&&(_e=TT(fe,de[0]));for(let De=0;De<de.length;De++){const Pe=de[De],Be=re[De];for(let Ne=0;Ne<Pe.length-1;Ne++){const He=Pe[Ne],st=[He,Pe[Ne+1],Be[Ne+1],Be[Ne],He];wu(fe,st)&&(_e=Math.min(_e,TT(fe,st)))}}return _e!==1/0&&_e}($,ne,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends js{constructor(o,i,s,c){const u=pE();super(o,u,i,s,c),u.layout&&(this.layout=new yo(u.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof bi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=(()=>{if(p_)return p_;const s=pE();return p_=new mI(s.paint.properties["line-width"].specification),p_.useIntegerZoom=!0,p_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new S0(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,i,s){const c=Ob(this);return{config:new Fr(this,{zoom:i,lut:s}),defines:c,overrideFog:!1}}queryRadius(o){const i=o,s=g_(cf("line-width",this,i),cf("line-gap-width",this,i)),c=cf("line-offset",this,i);return s/2+Math.abs(c)+Fp(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,s,c,u,p){if(o.queryGeometry.isAboveHorizon)return!1;const m=Mg(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),v=o.pixelToTileUnitsFactor/2*g_(this.paint.get("line-width").evaluate(i,s),this.paint.get("line-gap-width").evaluate(i,s)),x=this.paint.get("line-offset").evaluate(i,s);return x&&(c=function(C,S){const I=[],A=new _t(0,0);for(let N=0;N<C.length;N++){const F=C[N],z=[];for(let V=0;V<F.length;V++){const $=F[V],ne=F[V+1],ee=0===V?A:$.sub(F[V-1])._unit()._perp(),re=V===F.length-1?A:ne.sub($)._unit()._perp(),de=ee._add(re)._unit();de._mult(1/(de.x*re.x+de.y*re.y)),z.push(de._mult(S)._add($))}I.push(z)}return I}(c,x*o.pixelToTileUnitsFactor)),function(C,S,I){for(let A=0;A<S.length;A++){const N=S[A];if(C.length>=3)for(let F=0;F<N.length;F++)if(wc(C,N[F]))return!0;if(IC(C,N,I))return!0}return!1}(m,c,v)}isTileClipped(){return!0}isDraped(o){const i=this.layout.get("line-z-offset");return i.isConstant()&&!i.constantOr(0)}},symbol:__,background:class extends js{constructor(o,i,s,c){super(o,{layout:mE||(mE=new Ei({visibility:new ct(Le.layout_background.visibility)})),paint:dm||(dm=new Ei({"background-color":new ct(Le.paint_background["background-color"]),"background-pattern":new ct(Le.paint_background["background-pattern"]),"background-opacity":new ct(Le.paint_background["background-opacity"]),"background-emissive-strength":new ct(Le.paint_background["background-emissive-strength"])}))},i,s,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,i,s){return{overrideFog:!1}}},raster:hm,"raster-particle":_x,sky:class extends js{constructor(o,i,s,c){super(o,{layout:vE||(vE=new Ei({visibility:new ct(Le.layout_sky.visibility)})),paint:v_||(v_=new Ei({"sky-type":new ct(Le.paint_sky["sky-type"]),"sky-atmosphere-sun":new ct(Le.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ct(Le.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ct(Le.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ct(Le.paint_sky["sky-gradient-radius"]),"sky-gradient":new Qo(Le.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ct(Le.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ct(Le.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ct(Le.paint_sky["sky-opacity"])}))},i,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=oo({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(o,i){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),u=!c,p=o.style.light,m=p.properties.get("position");return u&&"viewport"===p.properties.get("anchor")&&fr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?yx(m.azimuthal,90-m.polar,i):yx(c[0],90-c[1],i)}const s=this.paint.get("sky-gradient-center");return yx(s[0],90-s[1],i)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}},slot:class extends js{constructor(o,i,s,c){super(o,{paint:gx||(gx=new Ei({}))},i,null)}},model:class extends js{constructor(o,i,s,c){super(o,{layout:SE||(SE=new Ei({visibility:new ct(Le.layout_model.visibility),"model-id":new Nt(Le.layout_model["model-id"])})),paint:wx||(wx=new Ei({"model-opacity":new ct(Le.paint_model["model-opacity"]),"model-rotation":new Nt(Le.paint_model["model-rotation"]),"model-scale":new Nt(Le.paint_model["model-scale"]),"model-translation":new Nt(Le.paint_model["model-translation"]),"model-color":new Nt(Le.paint_model["model-color"]),"model-color-mix-intensity":new Nt(Le.paint_model["model-color-mix-intensity"]),"model-type":new ct(Le.paint_model["model-type"]),"model-cast-shadows":new ct(Le.paint_model["model-cast-shadows"]),"model-receive-shadows":new ct(Le.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ct(Le.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Nt(Le.paint_model["model-emissive-strength"]),"model-roughness":new Nt(Le.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Nt(Le.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ct(Le.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ct(Le.paint_model["model-front-cutoff"])}))},i,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new iv(o)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof ii?ft-1:0}queryIntersectsFeature(o,i,s,c,u,p){if(!this.modelManager)return!1;const m=this.modelManager,v=o.tile.getBucket(this);if(!(v&&v instanceof iv))return!1;const x=v;for(const C in x.instancesPerModel){const S=x.instancesPerModel[C],I=void 0!==i.id?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(I)){const A=S.features[S.idToFeaturesIndex[I]],N=m.getModel(C,this.scope);if(!N)return!1;let F=d.ae.create();const z=new zn(0,0),V=x.canonical;let $=Number.MAX_VALUE;for(let ne=0;ne<A.instancedDataCount;++ne){const ee=16*(A.instancedDataOffset+ne),re=S.instancedDataArray.float32,de=[re[ee+4],re[ee+5],re[ee+6]];kE(V,z,re[ee],0|re[ee+1]),rv(F,N,p,z,A.rotation,A.scale,de,!1,!1,!1),"globe"===p.projection.name&&(F=bx(F,p));const fe=d.ae.multiply([],p.projMatrix,F),_e=o.queryGeometry,De=Q0(_e.isPointQuery()?_e.screenBounds:_e.screenGeometry,p,fe,N.aabb);null!=De&&($=Math.min(De,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(o,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven()||"model-color"!==o&&"model-color-mix-intensity"!==o&&"model-rotation"!==o&&"model-scale"!==o&&"model-translation"!==o&&"model-emissive-strength"!==o)}_isPropertyZoomDependent(o){const i=this._transitionablePaint._values[o];return null!=i&&null!=i.value&&null!=i.value.expression&&i.value.expression instanceof ce}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(o,i,s,c){const u=o.tile,p=u.getBucket(this);let m=null,v=Number.MAX_VALUE;if(!(p&&p instanceof ii))return{queryFeature:m,intersectionZ:v};const x=p.getNodesInfo()[i];if(x.hiddenByReplacement||!x.node.meshes||!s.filter(new cn(u.tileID.overscaledZ),x.feature,u.tileID.canonical))return{queryFeature:m,intersectionZ:v};const C=x.node,S=c.calculatePosMatrix(u.tileID.toUnwrapped(),c.worldSize),I=x.evaluatedScale;let A=0;c.elevation&&C.elevation&&(A=C.elevation*c.elevation.exaggeration()),d.ae.translate(S,S,[(C.anchor?C.anchor[0]:0)*(I[0]-1),(C.anchor?C.anchor[1]:0)*(I[1]-1),A]),d.ae.scale(S,S,I),d.ae.multiply(S,S,C.matrix);const N=o.queryGeometry,F=N.isPointQuery()?N.screenBounds:N.screenGeometry,z=function($){const ne=d.ae.multiply([],S,$.matrix),ee=d.ae.multiply(ne,c.expandedFarZProjMatrix,ne);for(let re=0;re<$.meshes.length;++re){const de=$.meshes[re];if(re===$.lightMeshIndex)continue;const fe=Q0(F,c,ee,de.aabb);null!=fe&&(v=Math.min(fe,v))}if($.children)for(const re of $.children)z(re)};if(z(C),v===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:v};const V=new zn(0,0);return kE(u.tileID.canonical,V,x.node.anchor[0],x.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[V.lng,V.lat]},properties:x.feature.properties,id:x.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:v}}},clip:class extends js{constructor(o,i,s,c){super(o,{layout:nT||(nT=new Ei({"clip-layer-types":new ct(Le.layout_clip["clip-layer-types"]),"clip-layer-scope":new ct(Le.layout_clip["clip-layer-scope"])})),paint:Cu||(Cu=new Ei({}))},i,s,c)}recalculate(o,i){super.recalculate(o,i)}createBucket(o){return new fb(o)}isTileClipped(){return!0}is3D(){return!0}}};Ee(dI,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const Bx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class fv{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(i,0,2);if(219!==s)throw new Error("Data does not appear to be in a KDBush format.");const u=c>>4;if(1!==u)throw new Error(`Got v${u} data when expected v1.`);const p=Bx[15&c];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(i,2,1),[v]=new Uint32Array(i,4,1);return new fv(v,m,p,i)}constructor(i,s=64,c=Float64Array,u){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const p=Bx.indexOf(this.ArrayType),m=2*i*this.ArrayType.BYTES_PER_ELEMENT,v=i*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+v+x,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+x),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+v+x,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=i)}add(i,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=i,this.coords[this._pos++]=s,c}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return E_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,s,c,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,x=[0,p.length-1,0],C=[];for(;x.length;){const S=x.pop()||0,I=x.pop()||0,A=x.pop()||0;if(I-A<=v){for(let V=A;V<=I;V++){const $=m[2*V],ne=m[2*V+1];$>=i&&$<=c&&ne>=s&&ne<=u&&C.push(p[V])}continue}const N=A+I>>1,F=m[2*N],z=m[2*N+1];F>=i&&F<=c&&z>=s&&z<=u&&C.push(p[N]),(0===S?i<=F:s<=z)&&(x.push(A),x.push(N-1),x.push(1-S)),(0===S?c>=F:u>=z)&&(x.push(N+1),x.push(I),x.push(1-S))}return C}within(i,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:m}=this,v=[0,u.length-1,0],x=[],C=c*c;for(;v.length;){const S=v.pop()||0,I=v.pop()||0,A=v.pop()||0;if(I-A<=m){for(let V=A;V<=I;V++)LE(p[2*V],p[2*V+1],i,s)<=C&&x.push(u[V]);continue}const N=A+I>>1,F=p[2*N],z=p[2*N+1];LE(F,z,i,s)<=C&&x.push(u[N]),(0===S?i-c<=F:s-c<=z)&&(v.push(A),v.push(N-1),v.push(1-S)),(0===S?i+c>=F:s+c>=z)&&(v.push(N+1),v.push(I),v.push(1-S))}return x}}function E_(o,i,s,c,u,p){if(u-c<=s)return;const m=c+u>>1;FE(o,i,m,c,u,p),E_(o,i,s,c,m-1,1-p),E_(o,i,s,m+1,u,1-p)}function FE(o,i,s,c,u,p){for(;u>c;){if(u-c>600){const C=u-c+1,S=s-c+1,I=Math.log(C),A=.5*Math.exp(2*I/3),N=.5*Math.sqrt(I*A*(C-A)/C)*(S-C/2<0?-1:1);FE(o,i,s,Math.max(c,Math.floor(s-S*A/C+N)),Math.min(u,Math.floor(s+(C-S)*A/C+N)),p)}const m=i[2*s+p];let v=c,x=u;for(D_(o,i,c,s),i[2*u+p]>m&&D_(o,i,c,u);v<x;){for(D_(o,i,v,x),v++,x--;i[2*v+p]<m;)v++;for(;i[2*x+p]>m;)x--}i[2*c+p]===m?D_(o,i,c,x):(x++,D_(o,i,x,u)),x<=s&&(c=x+1),s<=x&&(u=x-1)}}function D_(o,i,s,c){pv(o,s,c),pv(i,2*s,2*c),pv(i,2*s+1,2*c+1)}function pv(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}function LE(o,i,s,c){const u=o-s,p=i-c;return u*u+p*p}d.A=_p,d.B=Yh,d.C=ni,d.D=Zh,d.E=dd,d.F=Fs,d.H=fc,d.I=tI,d.J=k,d.K=M,d.L=function(o){const i=o.value;let s=[];if(!i)return s;const c=Yn(i);return"string"!==c?(s=s.concat([new tv(o.key,i,`string expected, "${c}" found`)]),s):(xx(i,!0)||(s=s.concat([new tv(o.key,i,`invalid url "${i}"`)])),s)},d.M=class{constructor(o,i,s,c){this.id=o,this.position=null!=i?new zn(i[0],i[1]):new zn(0,0),this.orientation=s??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,i){if(d.ae.multiply(o.matrix,i,o.matrix),o.meshes)for(const s of o.meshes){const c=Ui.applyTransformFast(s.aabb,o.matrix);this.aabb.encapsulate(c)}if(o.children)for(const s of o.children)this._applyTransformations(s,o.matrix)}computeBoundsAndApplyParent(){const o=d.ae.identity([]);for(const i of this.nodes)this._applyTransformations(i,o)}computeModelMatrix(o,i,s,c,u,p,m=!1){rv(this.matrix,this,o.transform,this.position,i,s,c,u,p,m)}upload(o){if(!this.uploaded){for(const i of this.nodes)Cx(i,o);for(const i of this.nodes)ov(i);this.uploaded=!0}}destroy(){for(const o of this.nodes)Tx(o)}},d.N=Le,d.O=go,d.P=_t,d.Q=uo,d.R=sd,d.S=k1,d.T=Al,d.U=Ei,d.V=tv,d.W=ct,d.X=class{constructor(o){this.specification=o}possiblyEvaluate(o,i){return id(o.expression.evaluate(i))}interpolate(o,i,s){return{x:Yt(o.x,i.x,s),y:Yt(o.y,i.y,s),z:Yt(o.z,i.z,s),azimuthal:Yt(o.azimuthal,i.azimuthal,s),polar:Yt(o.polar,i.polar,s)}}},d.Y=cn,d.Z=ce,d._=ko,d.a=Br,d.a$=n0,d.a0=Qf,d.a1=yo,d.a2=Hd,d.a3=Yt,d.a4=ft,d.a5=ig,d.a6=class{constructor(o){this.specification=o}possiblyEvaluate(o,i){return function([s,c]){const u=id([1,s,c]);return{x:u.x,y:u.y,z:u.z}}(o.expression.evaluate(i))}interpolate(o,i,s){return{x:Yt(o.x,i.x,s),y:Yt(o.y,i.y,s),z:Yt(o.z,i.z,s)}}},d.a7=Ld,d.a8=Zy,d.a9=xu,d.aA=function(o,i,s){o[4*i+0]=s[0],o[4*i+1]=s[1],o[4*i+2]=s[2],o[4*i+3]=s[3]},d.aC=function(o,i){const{x:s,y:c}=o.point,u=Cc(s,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return d.ae.multiply(u,u,Gd(El(i)))},d.aE=Iu,d.aF=fa,d.aG=P0,d.aH=function(o,i,s,c,u){const p=5*i+2;o.float32[p+0]=s,o.float32[p+1]=c,o.float32[p+2]=u},d.aI=G0,d.aJ=zn,d.aK=iE,d.aL=EC,d.aM=LC,d.aN=K0,d.aO=Ud,d.aP=Q1,d.aQ=Lr,d.aR=function(o,i,s,c,u,p,m,v,x){if("globe"===x.name)return Q1(o,i,new Ud(s,c,u),!1);const C=th({z:s,x:c,y:u},x);return new Ui([(p+C.x/C.scale)*i,i*(C.y/C.scale),m],[(p+C.x2/C.scale)*i,i*(C.y2/C.scale),v])},d.aS=function(o,i,s){let c=0;for(let u=0;u<2;++u)o[u]>0&&(c+=(o[u]-0)*(o[u]-0)),i[u]<0&&(c+=(0-i[u])*(0-i[u]));return c},d.aT=wr,d.aU=Y1,d.aV=Ap,d.aW=function(o){const i=d.ae.identity(new Float64Array(16));d.ae.multiply(i,o.pixelMatrix,o.globeMatrix);const s=[0,Hs,0],c=[0,qs,0];return d.$.transformMat4(s,s,i),d.$.transformMat4(c,c,i),[s[0]>0&&s[0]<=o.width&&s[1]>0&&s[1]<=o.height&&!fn(o,new zn(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!fn(o,new zn(o.center.lat,-90))]},d.aX=function(o,i){const{scale:s}=o.tileTransform,c=s*ft/(o.tileSize*Math.pow(2,i.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return d.aD.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[c,c])},d.aY=Tf,d.aZ=vx,d.a_=function(o){const i=vx(o,!0);return d.aD.invert([],[i[0],i[1],i[4],i[5]])},d.aa=Yy,d.ab=ts,d.ac=Fn,d.ad=function(o,i,s){const c=Math.sqrt(o*o+i*i+s*s),u=c>0?Math.acos(s/c)*nu:0;let p=0!==o||0!==i?Math.atan2(-i,-o)*nu+90:0;return p<0&&(p+=360),[c,p,u]},d.af=om,d.ag=Ol,d.ah=Qb,d.ai=function(o,i){const s={};for(let c=0;c<i.length;c++){const u=i[c];u in o&&(s[u]=o[u])}return s},d.aj=Qa,d.ak=da,d.al=bc,d.am=P1,d.an=function(o){Km++,Km>Zm&&(o.getActor().send("enforceCacheSizeLimit",Wm),Km=0)},d.ao=xy,d.ap=class{constructor(o){this.entries={},this.scheduler=o}request(o,i,s,c){const u=this.entries[o]=this.entries[o]||{callbacks:[]};if(u.result){const[p,m]=u.result;return this.scheduler?this.scheduler.add(()=>{c(p,m)},i):c(p,m),()=>{}}return u.callbacks.push(c),u.cancel||(u.cancel=s((p,m)=>{u.result=[p,m];for(const v of u.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},i):v(p,m);setTimeout(()=>delete this.entries[o],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==c),u.callbacks.length||(u.cancel(),delete this.entries[o]))}}},d.aq=function(o,i,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},u=>{const p=Yo(o.request,(m,v,x,C)=>{m?u(m):v&&u(null,{vectorTile:s?void 0:new $p(new Jg(v)),rawData:v,cacheControl:x,expires:C})});return()=>{p.cancel(),u()}},i)},d.ar=V1,d.as=class extends es{constructor(o){super(o),this.current=aM}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},d.at=xg,d.au=Sn,d.av=Yl,d.ax=ec,d.ay=ro,d.az=$r,d.b=Ki,d.b$=JO,d.b0=function(o){const{x:i,y:s}=o.point,{lng:c,lat:u}=o._center;return Cc(i,s,o.worldSize,c,u)},d.b1=So,d.b2=Cg,d.b3=Ky,d.b4=function(o){const i=Math.round((o+45+360)%360/90)%4;return td[i]},d.b5=45,d.b6=Tg,d.b7=Ia,d.b8=Ui,d.b9=id,d.bA=yf,d.bB=s0,d.bC=function(o,i){return[Math.pow(o[0],2.2)*i,Math.pow(o[1],2.2)*i,Math.pow(o[2],2.2)*i]},d.bD=PT,d.bF=nb,d.bG=tc,d.bH=my,d.bI=256,d.bJ=function(o,i){const s=[0,0,0],c=Og(El(i.canonical));return d.$.transformMat4(s,s,c),d.$.transformMat4(s,s,o),s},d.bK=o=>({u_camera_to_center_distance:new ts(o),u_extrude_scale:new wg(o),u_device_pixel_ratio:new ts(o),u_matrix:new Ld(o),u_inv_rot_matrix:new Ld(o),u_merc_center:new xu(o),u_tile_id:new V1(o),u_zoom_transition:new ts(o),u_up_dir:new V1(o),u_emissive_strength:new ts(o)}),d.bL=o=>({u_matrix:new Ld(o),u_pixels_to_tile_units:new wg(o),u_device_pixel_ratio:new ts(o),u_units_to_pixels:new xu(o),u_dash_image:new Zy(o),u_gradient_image:new Zy(o),u_image_height:new ts(o),u_texsize:new xu(o),u_tile_units_to_pixels:new ts(o),u_alpha_discard_threshold:new ts(o),u_trim_offset:new xu(o),u_trim_fade_range:new xu(o),u_trim_color:new xg(o),u_emissive_strength:new ts(o)}),d.bM=o=>({u_matrix:new Ld(o),u_texsize:new xu(o),u_pixels_to_tile_units:new wg(o),u_device_pixel_ratio:new ts(o),u_image:new Zy(o),u_units_to_pixels:new xu(o),u_tile_units_to_pixels:new ts(o),u_alpha_discard_threshold:new ts(o),u_trim_offset:new xu(o)}),d.bN=Dp,d.bO=IT,d.bP=Fo,d.bQ=R0,d.bR=V0,d.bS=Lb,d.bT=rb,d.bU=(o,i,s,c,u,p)=>{const m=o.transform,v="globe"===m.projection.name;let x;if("map"===p.paint.get("circle-pitch-alignment"))if(v){const S=nb(m.zoom,i.canonical)*m._pixelsPerMercatorPixel;x=Float32Array.from([S,0,0,S])}else x=m.calculatePixelsToTileUnitsMatrix(s);else x=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(m.projection),u_matrix:o.translatePosMatrix(i.projMatrix,s,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Mo.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:mM,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){C.u_inv_rot_matrix=c,C.u_merc_center=u,C.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],C.u_zoom_transition=Hd(m.zoom);const S=u[0]*ft,I=u[1]*ft;C.u_up_dir=m.projection.upVector(new Ud(0,0,0),S,I)}return C},d.bV=Ob,d.bW=(o,i,s,c,u,p)=>{const m=o.transform;return{u_matrix:Xg(o,i,s,c),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:Ab(i,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p}},d.bX=(o,i,s,c,u,p,m)=>{const v=o.transform,x=v.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:Xg(o,i,s,c),u_pixels_to_tile_units:x,u_device_pixel_ratio:p,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:M0(s)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ab(i,o.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength")}},d.bY=Xl,d.bZ=oo,d.b_=xT,d.ba=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},d.bb=Kf,d.bc=function(o,i,s){const c=Hd(s.zoom),u=o.style.map._antialias,p=i.options.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===c&&!u&&!p},d.bd=function(o){const i=o.pixelsPerMeter,s=i/ro(1,o.center.lat),c=d.ae.identity(new Float64Array(16));return d.ae.translate(c,c,[o.point.x,o.point.y,0]),d.ae.scale(c,c,[s,s,i]),Float32Array.from(c)},d.be=eb,d.bf=function(o){const i=wr-5;o=Sn(o,-i,i)/i*90;const s=Math.pow(Math.abs(Math.sin(Fn(o))),3);return Math.round(s*(Pp.length-1))},d.bg=function(o,i,s,c){const u=i.getNorth(),p=i.getSouth(),m=i.getWest(),v=i.getEast(),x=1<<o.z,C=v-m,S=u-p,I=C/64,A=-S/Pp[s],N=[0,I,0,A,0,0,u,m,0];if(o.z>0){const F=180/c;d.bE.multiply(N,N,[F/C+1,0,0,0,F/S+1,0,-.5*F/I,.5*F/A,1])}return N[2]=x,N[5]=o.x,N[8]=o.y,N},d.bh=Og,d.bi=El,d.bj=function(o,i,s){const c=d.ae.identity(new Float64Array(16)),u=(i/(1<<o)-.5)*Math.PI*2;return d.ae.rotateY(c,s.globeMatrix,u),Float32Array.from(c)},d.bk=gy,d.bl=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},d.bm=hm,d.bn=_x,d.bo=gE,d.bp=function(o,i){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){i(null,s)};for(let c=0;c<o.length;c++){const u=document.createElement("source");ad(o[c])||(s.crossOrigin="Anonymous"),u.src=o[c],s.appendChild(u)}return{cancel:()=>{}}},d.bq=im,d.br=np,d.bs=class{isDataAvailableAtPoint(o){const i=this._source();if(this.isUsingMockSource()||!i||o.y<0||o.y>1)return!1;const s=i.getSource().maxzoom,c=1<<s,u=Math.floor(o.x),p=Math.floor((o.x-u)*c),m=Math.floor(o.y*c),v=this.findDEMTileFor(new Lr(s,u,s,p,m));return!(!v||!v.dem)}getAtPointOrZero(o,i=0){return this.getAtPoint(o,i)||0}getAtPoint(o,i,s=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const c=this._source();if(!c||o.y<0||o.y>1)return i;const u=c.getSource().maxzoom,p=1<<u,m=Math.floor(o.x),v=o.x-m,x=new Lr(u,m,u,Math.floor(v*p),Math.floor(o.y*p)),C=this.findDEMTileFor(x);if(!C||!C.dem)return i;const S=C.dem,I=1<<C.tileID.canonical.z,A=(v*I-C.tileID.canonical.x)*S.dim,N=(o.y*I-C.tileID.canonical.y)*S.dim,F=Math.floor(A),z=Math.floor(N);return(s?this.exaggeration():1)*Yt(Yt(S.get(F,z),S.get(F,z+1),N-z),Yt(S.get(F+1,z),S.get(F+1,z+1),N-z),A-F)}getAtTileOffset(o,i,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new ko(o.wrap+(o.canonical.x+i/ft)/c,(o.canonical.y+s/ft)/c))}getAtTileOffsetFunc(o,i,s,c){return u=>{const p=this.getAtTileOffset(o,u.x,u.y),m=c.upVector(o.canonical,u.x,u.y),v=c.upVectorScale(o.canonical,i,s).metersToTile;return d.$.scale(m,m,p*v),m}}getForTilePoints(o,i,s,c){if(this.isUsingMockSource())return!1;const u=Du.create(this,o,c);return!!u&&(i.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(o);if(!i||!i.dem)return null;const s=i.dem.tree,c=i.tileID,u=1<<o.canonical.z-c.canonical.z;let p=o.canonical.x/u-c.canonical.x,m=o.canonical.y/u-c.canonical.y,v=0;for(let x=0;x<o.canonical.z-c.canonical.z&&!s.leaves[v];x++){p*=2,m*=2;const C=2*Math.floor(m)+Math.floor(p);v=s.childOffsets[v]+C,p%=1,m%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,i,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(0===o.length)return null;let i=!1,s=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const u of o){const p=this.getMinMaxForTile(u.tileID);p&&(s=Math.min(s,p.min),c=Math.max(c,p.max),i=!0)}return i?{min:s,max:c}:null}},d.bt=Ag,d.bu=K1,d.bv=$s,d.bw=Xi,d.bx=wf,d.by=Dx,d.bz=sv,d.c=NE,d.c$=function(o,i,s,c){return"custom"===o.type?new bE(o,i):new Lx[o.type](o,i,s,c)},d.c0=E0,d.c1=Ec,d.c2=450,d.c3=7,d.c4=gI,d.c5=hI,d.c6=256,d.c7=VC,d.c8=Gd,d.c9=tn,d.cA=OC,d.cB=function(o,i,s=0){return d.$.fromValues(((i.x-s)*o.scale-o.x)*ft,(i.y*o.scale-o.y)*ft,Eg(i.z,i.y))},d.cC=function(o){let i=1/0,s=1/0,c=-1/0,u=-1/0;for(const p of o)i=Math.min(i,p.x),s=Math.min(s,p.y),c=Math.max(c,p.x),u=Math.max(u,p.y);return{min:new _t(i,s),max:new _t(c,u)}},d.cD=wc,d.cE=Jy,d.cF=ns,d.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.cH=L0,d.cI=wu,d.cJ=sT,d.cK=lT,d.cL=MM,d.cM=mf,d.cN=fv,d.cO=function(o){return o({pluginStatus:An,pluginURL:vn}),Mn.on("pluginStateChange",o),o},d.cP=ff,d.cQ=z0,d.cR=yy,d.cS=oi,d.cT=Or,d.cU=Nh,d.cV=eg,d.cW=Zo,d.cX=function(o){const i=o.indexOf("\x1f");return i>=0?o.slice(0,i):o},d.cY=function(o){return o.indexOf("\x1f")>=0},d.cZ=function(o){const i=o.indexOf("\x1f");return i>=0?o.slice(i+1):""},d.c_=function(o){const i=[],s=o.id;return void 0===s&&i.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&i.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&i.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),i},d.ca=Nd,d.cb=Fd,d.cc=1,d.cd=771,d.ce=0,d.cf=gC,d.cg=function(o,i,s,c,u){return Sn((o-i)/(s-i)*(u-c)+c,c,u)},d.ch=Fy,d.ci=jd,d.cj=class{constructor(o,i,s,c){this.context=o,this.format=c,this.size=s,this.texture=o.gl.createTexture();const[u,p,m]=this.size,{gl:v}=o;v.bindTexture(v.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1);let x=this.format,C=v.UNSIGNED_BYTE;this.format===v.DEPTH_COMPONENT&&(x=v.DEPTH_COMPONENT16,C=v.UNSIGNED_SHORT),this.format===v.R8&&(c=v.RED),this.format===v.R32F&&(C=v.FLOAT,c=v.RED),v.texImage3D(v.TEXTURE_3D,0,x,u,p,m,0,c,C,i.data)}bind(o,i){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_3D,this.texture),o!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,o),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,o),this.minFilter=o),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},d.ck=bx,d.cl=[1,1,1],d.cm=Du,d.cn=Ef,d.co=Ka,d.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new _t(1/0,1/0),max:new _t(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,i=!1){const s=aT(new _t(0,0),new _t(ft,ft),o),c=[];if(i&&!y0(s,this._globalClipBounds))return c;for(const u of this._activeRegions){if(u.hiddenByOverlap||!y0(s,u))continue;const p=Ug(u.min,u.max,o);c.push({min:p.min,max:p.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return c}setSources(o){this._setSources(o.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const s=[];for(const c of i.cache.getVisibleCoordinates()){const u=i.cache.getTile(c).buckets[i.layer];u&&u.updateFootprints(c.toUnwrapped(),s)}return s},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(o){const i=o.getFootprints();if(0===i.length)return;const s=o.getOrder(),c=o.getClipMask(),u=o.getClipScope();for(const p of i){if(!p.footprint)continue;const m=aT(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:s,clipMask:c,clipScope:u})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,s)=>i.priority-s.priority||g0(i.min,s.min)||g0(i.max,s.max)||i.order-s.order||i.clipMask-s.clipMask||function(c,u){const p=(m,v)=>m+v;return c.length-u.length||c.reduce(p,"").localeCompare(u.reduce(p,""))}(i.clipScope,s.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let i=0;for(;!o&&i!==this._activeRegions.length;){const s=this._activeRegions[i],c=this._prevRegions[i];o=s.priority!==c.priority||!_0(s,c)||s.order!==c.order||s.clipMask!==c.clipMask||!tu(s.clipScope,c.clipScope),++i}}if(o){++this._updateTime;for(const s of this._activeRegions)s.order!==Vg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const i=s=>{const c=this._activeRegions;if(s>=c.length)return s;const u=c[s].priority;for(;s<c.length&&c[s].priority===u;)++s;return s};if(this._sourceIds.length>1){let s=0,c=i(s);for(;s!==c;){let u=s;const p=s;for(;u!==c;){const m=this._activeRegions[u];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const x=this._activeRegions[v];if(!x.hiddenByOverlap&&m.order===Vg&&y0(m,x)&&(m.hiddenByOverlap=v0(m.footprint,m.tileId,x.footprint,x.tileId),m.hiddenByOverlap))break}++u}s=c,c=i(s)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=o.length-1;i>=0;i--)this._addSource(o[i]);this._computeReplacement()}},d.cq=vu,d.cr=rm,d.cs=vg,d.ct=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,i){const s=new $s,c=new Xi,u=[],p=o+1+2,m=i[0]+1,v=i[0]+1+(1+i.length),x=(C,S,I)=>{let A=C===p-1?C-2:0===C?C:C-1;return A+=I?24575:0,[A,S]};for(let C=0;C<p;++C)s.emplaceBack(...x(C,0,!0));for(let C=0;C<m;++C)for(let S=0;S<p;++S)s.emplaceBack(...x(S,C,(0===S||S===p-1)&&!0));for(let C=0;C<i.length;++C){const S=i[C];for(let I=0;I<p;++I)s.emplaceBack(...x(I,S,!0))}for(let C=0;C<i.length;++C){const S=c.length,I=i[C]+1+2,A=new Xi;for(let z=0;z<I-1;z++){const V=z===I-2,$=V?p*(v-i.length+C-z):p;for(let ne=0;ne<p-1;ne++){const ee=z*p+ne;0===z||V||0===ne||ne===p-2?(A.emplaceBack(ee+1,ee,ee+$),A.emplaceBack(ee+$,ee+$+1,ee+1)):(c.emplaceBack(ee+1,ee,ee+$),c.emplaceBack(ee+$,ee+$+1,ee+1))}}const N=Ki.simpleSegment(0,S,s.length,c.length-S);for(let z=0;z<A.uint16.length;z+=3)c.emplaceBack(A.uint16[z],A.uint16[z+1],A.uint16[z+2]);const F=Ki.simpleSegment(0,S,s.length,c.length-S);u.push({withoutSkirts:N,withSkirts:F})}return{vertices:s,indices:c,segments:u}}_createGrid(o){const i=this._fillGridMeshWithLods(64,Pp);this._gridSegments=i.segments,this._gridBuffer=o.createVertexBuffer(i.vertices,Ag.members),this._gridIndexBuffer=o.createIndexBuffer(i.indices,!0)}_createPoles(o){const i=new Xi;for(let m=0;m<=64;m++)i.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=o.createIndexBuffer(i,!0);const s=new Fd,c=new Fd,u=new Fd,p=new Fd;this._poleSegments=[];for(let m=0,v=0;m<Ky;m++){const x=360/(1<<m);s.emplaceBack(0,-ns,0,.5,0),c.emplaceBack(0,-ns,0,.5,1),u.emplaceBack(0,-ns,0,.5,.5),p.emplaceBack(0,-ns,0,.5,.5);for(let C=0;C<=64;C++){let S=C/64,I=0;const A=Yt(0,x,S),[N,F,z]=zd(ib,Pg,A,ns);s.emplaceBack(N,F,z,S,I),c.emplaceBack(N,F,z,S,1-I);const V=Fn(A);S=.5+.5*Math.sin(V),I=.5+.5*Math.cos(V),u.emplaceBack(N,F,z,S,I),p.emplaceBack(N,F,z,S,1-I)}this._poleSegments.push(Ki.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,or,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,or,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(u,or,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(p,or,!1)}getGridBuffers(o,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},d.cu=function(o){return oa.has(o)},d.cv=Vg,d.cw=xb,d.cx=function(o,i,s=0,c=!0){const u=new _t(s,s),p=o.sub(u),m=i.add(u),v=[p,new _t(m.x,p.y),m,new _t(p.x,m.y)];return c&&v.push(p.clone()),v},d.cy=function(o,i){const s=[];for(let c=0;c<o.length;c++){const u=Yl(c-1,-1,o.length-1),p=Yl(c+1,-1,o.length-1),m=o[c],v=o[p],x=o[u].sub(m).unit(),C=v.sub(m).unit(),S=C.angleWithSep(x.x,x.y),I=x.add(C).unit().mult(-1*i/Math.sin(S/2));s.push(m.add(I))}return s},d.cz=Kn,d.d=tu,d.d$=xf,d.d0=qr,d.d1=Mn,d.d2=wa,d.d3=Jf,d.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},d.d5=xa,d.d6=DC,d.d7=Vd,d.d8=function([o,i,s]){const c=Math.hypot(o,i,s),u=Math.atan2(o,s),p=.5*Math.PI-Math.acos(-i/c);return new zn(So(u),So(p))},d.d9=Ws,d.dA=function(){sv().acquire(Sf)},d.dB=function(){const o=If;o&&(o.isPreloaded()&&1===o.numActive()?(o.release(Sf),If=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.dC=Mf,d.dD=function(o){const i=x1();if(!i)return;const s=i.delete(_y);o&&s.catch(o).then(()=>o())},d.dE=C_,d.dF=IE,d.dG=function(o){av=Mo.resolveURL(o),pm||(pm=new Dx(sv(),new dd)),pm.broadcast("setDracoUrl",av)},d.dH=Mx,d.dI=function(o){fm=Mo.resolveURL(o),pm||(pm=new Dx(sv(),new dd)),pm.broadcast("setMeshoptUrl",fm)},d.dJ=nd,d.dK=Ee,d.dL=qd,d.dM=os,d.dN=th,d.dO=L1,d.dP=RT,d.dQ=O0,d.dR=AT,d.dS=ip,d.dT=WT,d.dU=nm,d.dV=function(o,i,s,c,u,p,m,v,x,C,S){o.createArrays(),o.tilePixelRatio=ft/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const I=o.layers[0].layout,A=o.layers[0]._unevaluatedLayout._values,N={};if("composite"===o.textSizeData.kind){const{minZoom:$,maxZoom:ne}=o.textSizeData;N.compositeTextSizes=[A["text-size"].possiblyEvaluate(new cn($),v),A["text-size"].possiblyEvaluate(new cn(ne),v)]}if("composite"===o.iconSizeData.kind){const{minZoom:$,maxZoom:ne}=o.iconSizeData;N.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new cn($),v),A["icon-size"].possiblyEvaluate(new cn(ne),v)]}N.layoutTextSize=A["text-size"].possiblyEvaluate(new cn(x+1),v),N.layoutIconSize=A["icon-size"].possiblyEvaluate(new cn(x+1),v),N.textMaxSize=A["text-size"].possiblyEvaluate(new cn(18),v);const F="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),z=I.get("text-size");let V=!1;for(const $ of o.features)if($.icon&&$.icon.nameSecondary){V=!0;break}for(const $ of o.features){const ne=I.get("text-font").evaluate($,{},v).join(","),ee=z.evaluate($,{},v),re=N.layoutTextSize.evaluate($,{},v),de=(N.layoutIconSize.evaluate($,{},v),{horizontal:{},vertical:void 0}),fe=$.text;let _e,De=[0,0];if(fe){const Ne=fe.toString(),He=I.get("text-letter-spacing").evaluate($,{},v)*Fo,st=I.get("text-line-height").evaluate($,{},v)*Fo,qe=Xe(Ne)?He:0,ut=I.get("text-anchor").evaluate($,{},v),Ge=I.get("text-variable-anchor");if(!Ge){const dt=I.get("text-radial-offset").evaluate($,{},v);De=dt?V0(ut,[dt*Fo,eh]):I.get("text-offset").evaluate($,{},v).map(at=>at*Fo)}let Qe=F?"center":I.get("text-justify").evaluate($,{},v);const ht="point"===I.get("symbol-placement"),$e=ht?I.get("text-max-width").evaluate($,{},v)*Fo:1/0,xt=dt=>{o.allowVerticalPlacement&&Ke(Ne)&&(de.vertical=$T(fe,i,s,u,ne,$e,st,ut,dt,qe,De,fa.vertical,!0,re,ee))};if(!F&&Ge){const dt="auto"===Qe?Ge.map(jt=>mf(jt)):[Qe];let at=!1;for(let jt=0;jt<dt.length;jt++){const Bt=dt[jt];if(!de.horizontal[Bt])if(at)de.horizontal[Bt]=de.horizontal[0];else{const Dt=$T(fe,i,s,u,ne,$e,st,"center",Bt,qe,De,fa.horizontal,!1,re,ee);Dt&&(de.horizontal[Bt]=Dt,at=1===Dt.positionedLines.length)}}xt("left")}else{if("auto"===Qe&&(Qe=mf(ut)),ht||I.get("text-writing-mode").indexOf("horizontal")>=0||!Ke(Ne)){const dt=$T(fe,i,s,u,ne,$e,st,ut,Qe,qe,De,fa.horizontal,!1,re,ee);dt&&(de.horizontal[Qe]=dt)}xt(ht?"left":Qe)}}let Pe=!1;if($.icon&&$.icon.namePrimary){const Ne=c[$.icon.namePrimary];Ne&&(_e=Bb(u[$.icon.namePrimary],$.icon.nameSecondary?u[$.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate($,{},v),I.get("icon-anchor").evaluate($,{},v)),Pe=Ne.sdf,void 0===o.sdfIcons?o.sdfIcons=Ne.sdf:o.sdfIcons!==Ne.sdf&&fr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==o.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Be=Gb(de.horizontal)||de.vertical;o.iconsInText||(o.iconsInText=!!Be&&Be.iconsInText),(Be||_e)&&JT(o,$,de,_e,c,N,re,0,De,Pe,m,v,C,S,V)}p&&o.generateCollisionDebugBuffers(x,o.collisionBoxArray)},d.dW=S0,d.dX=u0,d.dY=$p,d.dZ=Jg,d.d_=Gg,d.da=af,d.db=Cn,d.dc=fn,d.dd=$C,d.de=function(o){const i=[0,0,0],s=d.ae.identity(new Float64Array(16));return d.ae.multiply(s,o.pixelMatrix,o.globeMatrix),d.$.transformMat4(i,i,s),new _t(i[0],i[1])},d.df=Gl,d.dg=ya,d.dh=function(o){const i=o.navigator?o.navigator.userAgent:null;return!!function(s){if(null==Rh){const c=s.navigator?s.navigator.userAgent:null;Rh=!!s.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Rh}(o)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},d.di=$m,d.dj=class{constructor(o,i,s){this._transformRequestFn=o,this._customAccessToken=i,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let i="";for(let s=0;s<10;s++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",nc,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,i){return this._transformRequestFn&&this._transformRequestFn(o,i)||{url:o}}normalizeStyleURL(o,i){if(!Or(o))return o;const s=Ca(o);return s.params.push(`sdk=js-${hr}`),s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeGlyphsURL(o,i){if(!Or(o))return o;const s=Ca(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeModelURL(o,i){if(!Or(o))return o;const s=Ca(o);return s.path=`/models/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeSourceURL(o,i,s,c){if(!Or(o))return o;const u=Ca(o);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),s&&u.params.push(`language=${s}`),c&&u.params.push(`worldview=${c}`),this._makeAPIURL(u,this._customAccessToken||i)}normalizeSpriteURL(o,i,s,c){const u=Ca(o);return Or(o)?(u.path=`/styles/v1${u.path}/sprite${i}${s}`,this._makeAPIURL(u,this._customAccessToken||c)):(u.path+=`${i}${s}`,ld(u))}normalizeTileURL(o,i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Or(o))return o;const c=Ca(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||s&&"raster"!==c.authority&&512===s?"@2x":""}${Jm.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${Cn.RASTER_URL_PREFIX}${c.path}`:"rasterarrays"===c.authority?c.path=`/${Cn.RASTERARRAYS_URL_PREFIX}${c.path}`:"3dtiles"===c.authority?c.path=`/${Cn.TILES3D_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${Cn.TILE_URL_VERSION}${c.path}`);const u=this._customAccessToken||function(p){for(const m of p){const v=m.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(c.params)||Cn.ACCESS_TOKEN;return Cn.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,u)}canonicalizeTileURL(o,i){const s=Ca(o);if(!s.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${Cn.RASTER_URL_PREFIX}/`,"")}`:s.path.match(/^\/rasterarrays\/v1\//)?c+=`rasterarrays/${s.path.replace(`/${Cn.RASTERARRAYS_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${Cn.TILE_URL_VERSION}/`,"")}`;let u=s.params;return i&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(c+=`?${u.join("&")}`),c}canonicalizeTileset(o,i){const s=!!i&&Or(i),c=[];for(const u of o.tiles||[])ti(u)?c.push(this.canonicalizeTileURL(u,s)):c.push(u);return c}_makeAPIURL(o,i){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=Ca(Cn.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const u=o.params.indexOf("secure");u>=0&&o.params.splice(u,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!Cn.REQUIRE_ACCESS_TOKEN)return ld(o);if(i=i||Cn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(u=>-1===u.indexOf("access_token")),o.params.push(`access_token=${i||""}`),ld(o)}},d.dk=function(o,i){i?oa.add(o):oa.delete(o)},d.dl=Jm,d.dm=dC,d.dn=wy,d.dp=vy,d.dq=Oi,d.dr=Lh,d.ds=function(o){oa.delete(o)},d.dt=Bh,d.du=cd,d.dv=ep,d.dw=hr,d.dx=function(o,i){Wm=o,Zm=i},d.dy=function(o,i,s=!1){if(An===en||An===mn||An===on)throw new Error("setRTLTextPlugin cannot be called multiple times.");vn=Mo.resolveURL(o),An=en,xi=i,xn(),s||Bn()},d.dz=nn,d.e=Mo,d.e0=Kd,d.e1=pb,d.e2=Xf,d.e3=NT,d.e4=us,d.e5=Yo,d.e6=function(o){let i=0;if(new Uint32Array(o,0,1)[0]!==ah){const s=new Uint32Array(o,0,7),[,,c,u,p,m]=s;i=s.byteLength+u+p+m+p,(c!==o.byteLength||i>=o.byteLength)&&fr("Invalid b3dm header information.")}return Ox(o,i)},d.e7=function(o,i){const s=NE(o);for(const c of s){for(const u of c.meshes)wI(u);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(fP(c.lights,i)))}return s},d.e8=ii,d.e9=ME,d.ea=kn,d.eb=function(o){lp(),ml&&ml.then(i=>{i.keys().then(s=>{for(let c=0;c<s.length-o;c++)i.delete(s[c])})})},d.f=dp,d.g=Ha,d.h=function(o,i){return wa(uo(o,{type:"json"}),i)},d.i=su,d.j=gr,d.k=Jp,d.l=function(o){return fetch(o).then(i=>i.arrayBuffer()).then(i=>Ox(i,0,o))},d.m=e_,d.n=class extends tv{},d.o=Yn,d.p=oE,d.q=fd,d.r=E,d.s=R,d.t=O,d.u=hc,d.v=te,d.w=fr,d.x=Ya,d.y=ue,d.z=se}),dr(0,function(d){function hr(ve){const H=ve?ve.url.toString():void 0;return H?performance.getEntriesByName(H):[]}function On(ve){if("number"==typeof ve||"boolean"==typeof ve||"string"==typeof ve||null==ve)return JSON.stringify(ve);if(Array.isArray(ve)){let q="[";for(const le of ve)q+=`${On(le)},`;return`${q}]`}let H="{";for(const q of Object.keys(ve).sort())H+=`${q}:${On(ve[q])},`;return`${H}}`}function Cn(ve){let H="";for(const q of d.cG)H+=`/${On(ve[q])}`;return H}class ti{constructor(H){this.keyCache={},this._layers={},this._layerConfigs={},H&&this.replace(H)}replace(H,q){this._layerConfigs={},this._layers={},this.update(H,[],q)}update(H,q,le){this._options=le;for(const me of H)this._layerConfigs[me.id]=me,(this._layers[me.id]=d.c$(me,this.scope,null,this._options)).compileFilter(),this.keyCache[me.id]&&delete this.keyCache[me.id];for(const me of q)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const be=function(me,Ie){const Ue={};for(let Ve=0;Ve<me.length;Ve++){const rt=Ie&&Ie[me[Ve].id]||Cn(me[Ve]);Ie&&(Ie[me[Ve].id]=rt);let ot=Ue[rt];ot||(ot=Ue[rt]=[]),ot.push(me[Ve])}const Me=[];for(const Ve in Ue)Me.push(Ue[Ve]);return Me}(d.dJ(this._layerConfigs),this.keyCache);for(const me of be){const Ie=me.map(Je=>this._layers[Je.id]),Ue=Ie[0];if("none"===Ue.visibility)continue;const Me=Ue.source||"";let Ve=this.familiesBySource[Me];Ve||(Ve=this.familiesBySource[Me]={});const rt=Ue.sourceLayer||"_geojsonTileLayer";let ot=Ve[rt];ot||(ot=Ve[rt]=[]),ot.push(Ie)}}}const Or=1*d.dM;class Do{constructor(H){const q={},le=[];for(const Ue in H){const Me=H[Ue],Ve=q[Ue]={};for(const rt in Me.glyphs){const ot=Me.glyphs[+rt];if(!ot||0===ot.bitmap.width||0===ot.bitmap.height)continue;const Je=ot.metrics.localGlyph?Or:1,Wt={x:0,y:0,w:ot.bitmap.width+2*Je,h:ot.bitmap.height+2*Je};le.push(Wt),Ve[rt]=Wt}}const{w:be,h:me}=d.k(le),Ie=new d.dL({width:be||1,height:me||1});for(const Ue in H){const Me=H[Ue];for(const Ve in Me.glyphs){const rt=Me.glyphs[+Ve];if(!rt||0===rt.bitmap.width||0===rt.bitmap.height)continue;const ot=q[Ue][Ve],Je=rt.metrics.localGlyph?Or:1;d.dL.copy(rt.bitmap,Ie,{x:0,y:0},{x:ot.x+Je,y:ot.y+Je},rt.bitmap)}}this.image=Ie,this.positions=q}}d.dK(Do,"GlyphAtlas");class ta{constructor(H){this.tileID=new d.aQ(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.lut=H.lut,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.scope=H.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.promoteId=H.promoteId,this.isSymbolTile=H.isSymbolTile,this.tileTransform=d.dN(H.tileID.canonical,H.projection),this.projection=H.projection,this.brightness=H.brightness,this.extraShadowCaster=!!H.extraShadowCaster,this.tessellationStep=H.tessellationStep}parse(H,q,le,be,me){this.status="parsing",this.data=H,this.collisionBoxArray=new d.dO;const Ie=new d.dP(Object.keys(H.layers).sort()),Ue=new d.dQ(this.tileID,this.promoteId);Ue.bucketLayerIDs=[];const Me={},Ve=new d.dR(256,256),rt={featureIndex:Ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ve,availableImages:le,brightness:this.brightness},ot=q.familiesBySource[this.source];for(const zt in ot){const Gi=H.layers[zt];if(!Gi)continue;let Qn=!1,Hn=!1,ei=!1;for(const co of ot[zt])"symbol"===co[0].type?Qn=!0:Hn=!0,co[0].is3D()&&"model"!==co[0].type&&(ei=!0);if(this.extraShadowCaster&&!ei||!0===this.isSymbolTile&&!Qn||!1===this.isSymbolTile&&!Hn)continue;1===Gi.version&&d.w(`Vector tile source "${this.source}" layer "${zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xr=Ie.encode(zt),Ur=[];for(let co=0;co<Gi.length;co++){const Wo=Gi.feature(co),Jc=Ue.getId(Wo,zt);Ur.push({feature:Wo,id:Jc,index:co,sourceLayerIndex:xr})}for(const co of ot[zt]){const Wo=co[0];(!this.extraShadowCaster||Wo.is3D()&&"model"!==Wo.type)&&(void 0!==this.isSymbolTile&&"symbol"===Wo.type!==this.isSymbolTile||Wo.minzoom&&this.zoom<Math.floor(Wo.minzoom)||Wo.maxzoom&&this.zoom>=Wo.maxzoom||"none"!==Wo.visibility&&(Ps(co,this.zoom,rt.brightness,le),(Me[Wo.id]=Wo.createBucket({index:Ue.bucketLayerIDs.length,layers:co,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ur,rt,this.tileID.canonical,this.tileTransform),Ue.bucketLayerIDs.push(co.map(Jc=>Jc.id))))}}let Je,Wt,an,Wn;Ve.trim();const Tn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Gn=()=>{if(Je)return this.status="done",me(Je);if(this.extraShadowCaster)this.status="done",me(null,{buckets:d.dJ(Me).filter(zt=>!zt.isEmpty()),featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:rt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Wt&&an&&Wn){const zt=new Do(Wt),Gi=new d.dT(an,Wn,this.lut);for(const Qn in Me){const Hn=Me[Qn];Hn instanceof d.dU?(Ps(Hn.layers,this.zoom,rt.brightness,le),d.dV(Hn,Wt,zt.positions,an,Gi.iconPositions,this.showCollisionBoxes,le,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Hn.hasPattern&&(Hn instanceof d.dW||Hn instanceof d.dX||Hn instanceof d.c0)&&(Ps(Hn.layers,this.zoom,rt.brightness,le),Hn.addFeatures(rt,this.tileID.canonical,Gi.patternPositions,le,this.tileTransform,this.brightness))}this.status="done",me(null,{buckets:d.dJ(Me).filter(Qn=>!Qn.isEmpty()),featureIndex:Ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zt.image,lineAtlas:Ve,imageAtlas:Gi,brightness:rt.brightness})}};if(!this.extraShadowCaster){const zt=d.dS(rt.glyphDependencies,Hn=>Object.keys(Hn).map(Number));Object.keys(zt).length?be.send("getGlyphs",{uid:this.uid,stacks:zt,scope:this.scope},(Hn,ei)=>{Je||(Je=Hn,Wt=ei,Gn())},void 0,!1,Tn):Wt={};const Gi=Object.keys(rt.iconDependencies);Gi.length?be.send("getImages",{icons:Gi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Hn,ei)=>{Je||(Je=Hn,an=ei,Gn())},void 0,!1,Tn):an={};const Qn=Object.keys(rt.patternDependencies);Qn.length?be.send("getImages",{icons:Qn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Hn,ei)=>{Je||(Je=Hn,Wn=ei,Gn())},void 0,!1,Tn):Wn={}}Gn()}}function Ps(ve,H,q,le){const be=new d.Y(H,{brightness:q});for(const me of ve)me.recalculate(be,le)}class ya extends d.E{constructor(H,q,le,be,me,Ie){super(),this.actor=H,this.layerIndex=q,this.availableImages=le,this.loadVectorData=me||d.aq,this.loading={},this.loaded={},this.deduped=new d.ap(H.scheduler),this.isSpriteLoaded=be,this.scheduler=H.scheduler,this.brightness=Ie}loadTile(H,q){const le=H.uid,be=H&&H.request,me=be&&be.collectResourceTiming,Ie=this.loading[le]=new ta(H);Ie.abort=this.loadVectorData(H,(Ue,Me)=>{const Ve=!this.loading[le];if(delete this.loading[le],Ve||Ue||!Me)return Ie.status="done",Ve||(this.loaded[le]=Ie),q(Ue);const rt=Me.rawData,ot={};Me.expires&&(ot.expires=Me.expires),Me.cacheControl&&(ot.cacheControl=Me.cacheControl),Ie.vectorTile=Me.vectorTile||new d.dY(new d.dZ(rt));const Je=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,(Wt,an)=>{if(Wt||!an)return q(Wt);const Wn={};if(me){const Tn=hr(be);Tn.length>0&&(Wn.resourceTiming=JSON.parse(JSON.stringify(Tn)))}q(null,d.Q({rawTileData:rt.slice(0)},an,ot,Wn))})};this.isSpriteLoaded?Je():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Je,{type:"parseTile",isSymbolTile:H.isSymbolTile,zoom:H.tileZoom}):Je()}),this.loaded=this.loaded||{},this.loaded[le]=Ie})}reloadTile(H,q){const le=this.loaded,be=H.uid;if(le&&le[be]){const me=le[be];me.showCollisionBoxes=H.showCollisionBoxes,me.projection=H.projection,me.brightness=H.brightness,me.tileTransform=d.dN(H.tileID.canonical,H.projection),me.extraShadowCaster=H.extraShadowCaster,me.lut=H.lut;const Ie=(Ue,Me)=>{const Ve=me.reloadCallback;Ve&&(delete me.reloadCallback,me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,Ve)),q(Ue,Me)};"parsing"===me.status?me.reloadCallback=Ie:"done"===me.status&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,Ie):Ie())}else q(null,void 0)}abortTile(H,q){const le=H.uid,be=this.loading[le];be&&(be.abort&&be.abort(),delete this.loading[le]),q()}removeTile(H,q){const le=this.loaded,be=H.uid;le&&le[be]&&delete le[be],q()}}class Gl{loadTile(H,q){const{uid:le,encoding:be,rawImageData:me,padding:Ie}=H,Ue=ImageBitmap&&me instanceof ImageBitmap?this.getImageData(me,Ie):me;q(null,new d.d_(le,Ue,be,Ie<1))}getImageData(H,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const le=this.offscreenCanvasContext.getImageData(-q,-q,H.width+2*q,H.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}d.d$.setPbf(d.dZ);class ll{decodeRasterArray({task:H,buffer:q},le){d.d$.performDecoding(q,H).then(be=>{le(null,be)},be=>{le(be)})}}const us=d.e0.prototype.toGeoJSON;let Di=class{constructor(ve){this._feature=ve,this.extent=d.a4,this.type=ve.type,this.properties=ve.tags,"id"in ve&&!isNaN(ve.id)&&(this.id=parseInt(ve.id,10))}loadGeometry(){if(1===this._feature.type){const ve=[];for(const H of this._feature.geometry)ve.push([new d.P(H[0],H[1])]);return ve}{const ve=[];for(const H of this._feature.geometry){const q=[];for(const le of H)q.push(new d.P(le[0],le[1]));ve.push(q)}return ve}}toGeoJSON(ve,H,q){return us.call(this,ve,H,q)}},Mi=class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.a4,this.length=ve.length,this._features=ve}feature(ve){return new Di(this._features[ve])}};const ao=64/4096,Va=128;class Hl{constructor(){this.features=new Map}clear(){this.features.clear()}load(H=[],q){for(const le of H){const be=le.id;if(null==be)continue;let me=this.features.get(be);me&&this.updateCache(me,q),le.geometry?(me=di(le),this.updateCache(me,q),this.features.set(be,me)):this.features.delete(be),this.updateCache(me,q)}}updateCache(H,q){for(const{canonical:le,uid:be}of Object.values(q)){const{z:me,x:Ie,y:Ue}=le;cl(H,Math.pow(2,me),Ie,Ue)&&delete q[be]}}getTile(H,q,le){const be=Math.pow(2,H),me=[];for(const Ie of this.features.values())cl(Ie,be,q,le)&&me.push(Yu(Ie,be,q,le));return{features:me}}getFeatures(){return[...this.features.values()]}}function cl({minX:ve,minY:H,maxX:q,maxY:le},be,me,Ie){return ve<(me+1+ao)/be&&H<(Ie+1+ao)/be&&q>(me-ao)/be&&le>(Ie-ao)/be}function di(ve){const{id:H,geometry:q,properties:le}=ve;if(!q)return;if("GeometryCollection"===q.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:be,coordinates:me}=q,Ie={id:H,type:1,geometry:[],tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ue=Ie.geometry;if("Point"===be)Jn(me,Ue,Ie);else if("MultiPoint"===be)for(const Me of me)Jn(Me,Ue,Ie);else if("LineString"===be)Ie.type=2,ds(me,Ue,Ie);else if("MultiLineString"===be)Ie.type=2,ul(me,Ue,Ie);else if("Polygon"===be)Ie.type=3,ul(me,Ue,Ie,!0);else{if("MultiPolygon"!==be)throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(const Me of me)ul(Me,Ue,Ie,!0)}return Ie}function Jn([ve,H],q,le){const be=d.ak(ve);let me=d.al(H);me=me<0?0:me>1?1:me,q.push(be,me),le.minX=Math.min(le.minX,be),le.minY=Math.min(le.minY,me),le.maxX=Math.max(le.maxX,be),le.maxY=Math.max(le.maxY,me)}function ds(ve,H,q,le=!1,be=!1){const me=[];for(const Ie of ve)Jn(Ie,me,q);H.push(me),le&&function(Ie,Ue){let Me=0;for(let Ve=0,rt=Ie.length,ot=rt-2;Ve<rt;ot=Ve,Ve+=2)Me+=(Ie[Ve]-Ie[ot])*(Ie[Ve+1]+Ie[ot+1]);if(Me>0===Ue)for(let Ve=0,rt=Ie.length;Ve<rt/2;Ve+=2){const ot=Ie[Ve],Je=Ie[Ve+1];Ie[Ve]=Ie[rt-2-Ve],Ie[Ve+1]=Ie[rt-1-Ve],Ie[rt-2-Ve]=ot,Ie[rt-1-Ve]=Je}}(me,be)}function ul(ve,H,q,le=!1){for(let be=0;be<ve.length;be++)ds(ve[be],H,q,le,0===be)}function Yu(ve,H,q,le){const{id:be,type:me,geometry:Ie,tags:Ue}=ve,Me=[];if(1===me)!function(Ve,rt,ot,Je,Wt){for(let an=0;an<Ve.length;an+=2){const Wn=Math.round(d.a4*(Ve[an+0]*rt-ot)),Tn=Math.round(d.a4*(Ve[an+1]*rt-Je));Wt.push([Wn,Tn])}}(Ie,H,q,le,Me);else for(const Ve of Ie)dl(Ve,H,q,le,Me);return{id:be,type:me,geometry:Me,tags:Ue}}function dl(ve,H,q,le,be){const me=-Va,Ie=d.a4+Va;let Ue;for(let Me=0;Me<ve.length-2;Me+=2){let Ve=Math.round(d.a4*(ve[Me+0]*H-q)),rt=Math.round(d.a4*(ve[Me+1]*H-le)),ot=Math.round(d.a4*(ve[Me+2]*H-q)),Je=Math.round(d.a4*(ve[Me+3]*H-le));const Wt=ot-Ve,an=Je-rt;Ve<me&&ot<me||(Ve<me?(rt+=Math.round(an*((me-Ve)/Wt)),Ve=me):ot<me&&(Je=rt+Math.round(an*((me-Ve)/Wt)),ot=me),rt<me&&Je<me||(rt<me?(Ve+=Math.round(Wt*((me-rt)/an)),rt=me):Je<me&&(ot=Ve+Math.round(Wt*((me-rt)/an)),Je=me),Ve>=Ie&&ot>=Ie||(Ve>=Ie?(rt+=Math.round(an*((Ie-Ve)/Wt)),Ve=Ie):ot>=Ie&&(Je=rt+Math.round(an*((Ie-Ve)/Wt)),ot=Ie),rt>=Ie&&Je>=Ie||(rt>=Ie?(Ve+=Math.round(Wt*((Ie-rt)/an)),rt=Ie):Je>=Ie&&(ot=Ve+Math.round(Wt*((Ie-rt)/an)),Je=Ie),Ue&&Ve===Ue[Ue.length-1][0]&&rt===Ue[Ue.length-1][1]||(Ue=[[Ve,rt]],be.push(Ue)),Ue.push([ot,Je])))))}}var hi={exports:{}},va=d.e2,hs=d.e1.VectorTileFeature,wh=ql;function ql(ve,H){this.options=H||{},this.features=ve,this.length=ve.length}function Ua(ve,H){this.id="number"==typeof ve.id?ve.id:void 0,this.type=ve.type,this.rawGeometry=1===ve.type?[ve.geometry]:ve.geometry,this.properties=ve.tags,this.extent=H||4096}ql.prototype.feature=function(ve){return new Ua(this.features[ve],this.options.extent)},Ua.prototype.loadGeometry=function(){var ve=this.rawGeometry;this.geometry=[];for(var H=0;H<ve.length;H++){for(var q=ve[H],le=[],be=0;be<q.length;be++)le.push(new va(q[be][0],q[be][1]));this.geometry.push(le)}return this.geometry},Ua.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ve=this.geometry,H=1/0,q=-1/0,le=1/0,be=-1/0,me=0;me<ve.length;me++)for(var Ie=ve[me],Ue=0;Ue<Ie.length;Ue++){var Me=Ie[Ue];H=Math.min(H,Me.x),q=Math.max(q,Me.x),le=Math.min(le,Me.y),be=Math.max(be,Me.y)}return[H,le,q,be]},Ua.prototype.toGeoJSON=hs.prototype.toGeoJSON;var ai=d.e3,na=wh;function Vr(ve){var H=new ai;return function(q,le){for(var be in q.layers)le.writeMessage(3,Gf,q.layers[be])}(ve,H),H.finish()}function Gf(ve,H){var q;H.writeVarintField(15,ve.version||1),H.writeStringField(1,ve.name||""),H.writeVarintField(5,ve.extent||4096);var le={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<ve.length;q++)le.feature=ve.feature(q),H.writeMessage(2,Hf,le);var be=le.keys;for(q=0;q<be.length;q++)H.writeStringField(3,be[q]);var me=le.values;for(q=0;q<me.length;q++)H.writeMessage(4,it,me[q])}function Hf(ve,H){var q=ve.feature;void 0!==q.id&&H.writeVarintField(1,q.id),H.writeMessage(2,Zc,ve),H.writeVarintField(3,q.type),H.writeMessage(4,Ii,q)}function Zc(ve,H){var q=ve.feature,le=ve.keys,be=ve.values,me=ve.keycache,Ie=ve.valuecache;for(var Ue in q.properties){var Me=q.properties[Ue],Ve=me[Ue];if(null!==Me){void 0===Ve&&(le.push(Ue),me[Ue]=Ve=le.length-1),H.writeVarint(Ve);var rt=typeof Me;"string"!==rt&&"boolean"!==rt&&"number"!==rt&&(Me=JSON.stringify(Me));var ot=rt+":"+Me,Je=Ie[ot];void 0===Je&&(be.push(Me),Ie[ot]=Je=be.length-1),H.writeVarint(Je)}}}function dn(ve,H){return(H<<3)+(7&ve)}function Yc(ve){return ve<<1^ve>>31}function Ii(ve,H){for(var q=ve.loadGeometry(),le=ve.type,be=0,me=0,Ie=q.length,Ue=0;Ue<Ie;Ue++){var Me=q[Ue],Ve=1;1===le&&(Ve=Me.length),H.writeVarint(dn(1,Ve));for(var rt=3===le?Me.length-1:Me.length,ot=0;ot<rt;ot++){1===ot&&1!==le&&H.writeVarint(dn(2,rt-1));var Je=Me[ot].x-be,Wt=Me[ot].y-me;H.writeVarint(Yc(Je)),H.writeVarint(Yc(Wt)),be+=Je,me+=Wt}3===le&&H.writeVarint(dn(7,1))}}function it(ve,H){var q=typeof ve;"string"===q?H.writeStringField(1,ve):"boolean"===q?H.writeBooleanField(7,ve):"number"===q&&(ve%1!=0?H.writeDoubleField(3,ve):ve<0?H.writeSVarintField(6,ve):H.writeVarintField(5,ve))}hi.exports=Vr,hi.exports.fromVectorTileJs=Vr,hi.exports.fromGeojsonVt=function(ve,H){H=H||{};var q={};for(var le in ve)q[le]=new na(ve[le].features,H),q[le].name=le,q[le].version=H.version,q[le].extent=H.extent;return Vr({layers:q})},hi.exports.GeoJSONWrapper=na;var lt=d.e4(hi.exports);const St={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},kt=Math.fround||(yn=new Float32Array(1),ve=>(yn[0]=+ve,yn[0]));var yn;const Pt=3,qi=5,Ai=6;class Ft{constructor(H){this.options=Object.assign(Object.create(St),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:q,minZoom:le,maxZoom:be}=this.options;q&&console.time("total time");const me=`prepare ${H.length} points`;q&&console.time(me),this.points=H;const Ie=[];for(let Me=0;Me<H.length;Me++){const Ve=H[Me];if(!Ve.geometry)continue;const[rt,ot]=Ve.geometry.coordinates,Je=kt(Pr(rt)),Wt=kt($o(ot));Ie.push(Je,Wt,1/0,Me,-1,1),this.options.reduce&&Ie.push(0)}let Ue=this.trees[be+1]=this._createTree(Ie);q&&console.timeEnd(me);for(let Me=be;Me>=le;Me--){const Ve=+Date.now();Ue=this.trees[Me]=this._createTree(this._cluster(Ue,Me)),q&&console.log("z%d: %d clusters in %dms",Me,Ue.numItems,+Date.now()-Ve)}return q&&console.timeEnd("total time"),this}getClusters(H,q){let le=((H[0]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,H[1]));let me=180===H[2]?180:((H[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)le=-180,me=180;else if(le>me){const ot=this.getClusters([le,be,180,Ie],q),Je=this.getClusters([-180,be,me,Ie],q);return ot.concat(Je)}const Ue=this.trees[this._limitZoom(q)],Me=Ue.range(Pr(le),$o(Ie),Pr(me),$o(be)),Ve=Ue.data,rt=[];for(const ot of Me){const Je=this.stride*ot;rt.push(Ve[Je+qi]>1?Rt(Ve,Je,this.clusterProps):this.points[Ve[Je+Pt]])}return rt}getChildren(H){const q=this._getOriginId(H),le=this._getOriginZoom(H),be="No cluster with the specified id.",me=this.trees[le];if(!me)throw new Error(be);const Ie=me.data;if(q*this.stride>=Ie.length)throw new Error(be);const Ue=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Me=me.within(Ie[q*this.stride],Ie[q*this.stride+1],Ue),Ve=[];for(const rt of Me){const ot=rt*this.stride;Ie[ot+4]===H&&Ve.push(Ie[ot+qi]>1?Rt(Ie,ot,this.clusterProps):this.points[Ie[ot+Pt]])}if(0===Ve.length)throw new Error(be);return Ve}getLeaves(H,q,le){const be=[];return this._appendLeaves(be,H,q=q||10,le=le||0,0),be}getTile(H,q,le){const be=this.trees[this._limitZoom(H)],me=Math.pow(2,H),{extent:Ie,radius:Ue}=this.options,Me=Ue/Ie,Ve=(le-Me)/me,rt=(le+1+Me)/me,ot={features:[]};return this._addTileFeatures(be.range((q-Me)/me,Ve,(q+1+Me)/me,rt),be.data,q,le,me,ot),0===q&&this._addTileFeatures(be.range(1-Me/me,Ve,1,rt),be.data,me,le,me,ot),q===me-1&&this._addTileFeatures(be.range(0,Ve,Me/me,rt),be.data,-1,le,me,ot),ot.features.length?ot:null}getClusterExpansionZoom(H){let q=this._getOriginZoom(H)-1;for(;q<=this.options.maxZoom;){const le=this.getChildren(H);if(q++,1!==le.length)break;H=le[0].properties.cluster_id}return q}_appendLeaves(H,q,le,be,me){const Ie=this.getChildren(q);for(const Ue of Ie){const Me=Ue.properties;if(Me&&Me.cluster?me+Me.point_count<=be?me+=Me.point_count:me=this._appendLeaves(H,Me.cluster_id,le,be,me):me<be?me++:H.push(Ue),H.length===le)break}return me}_createTree(H){const q=new d.cN(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<H.length;le+=this.stride)q.add(H[le],H[le+1]);return q.finish(),q.data=H,q}_addTileFeatures(H,q,le,be,me,Ie){for(const Ue of H){const Me=Ue*this.stride,Ve=q[Me+qi]>1;let rt,ot,Je;if(Ve)rt=fs(q,Me,this.clusterProps),ot=q[Me],Je=q[Me+1];else{const Wn=this.points[q[Me+Pt]];rt=Wn.properties;const[Tn,Gn]=Wn.geometry.coordinates;ot=Pr(Tn),Je=$o(Gn)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(ot*me-le)),Math.round(this.options.extent*(Je*me-be))]],tags:rt};let an;an=Ve||this.options.generateId?q[Me+Pt]:this.points[q[Me+Pt]].id,void 0!==an&&(Wt.id=an),Ie.features.push(Wt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,q){const{radius:le,extent:be,reduce:me,minPoints:Ie}=this.options,Ue=le/(be*Math.pow(2,q)),Me=H.data,Ve=[],rt=this.stride;for(let ot=0;ot<Me.length;ot+=rt){if(Me[ot+2]<=q)continue;Me[ot+2]=q;const Je=Me[ot],Wt=Me[ot+1],an=H.within(Me[ot],Me[ot+1],Ue),Wn=Me[ot+qi];let Tn=Wn;for(const Gn of an){const zt=Gn*rt;Me[zt+2]>q&&(Tn+=Me[zt+qi])}if(Tn>Wn&&Tn>=Ie){let Gn,zt=Je*Wn,Gi=Wt*Wn,Qn=-1;const Hn=(ot/rt<<5)+(q+1)+this.points.length;for(const ei of an){const xr=ei*rt;if(Me[xr+2]<=q)continue;Me[xr+2]=q;const Ur=Me[xr+qi];zt+=Me[xr]*Ur,Gi+=Me[xr+1]*Ur,Me[xr+4]=Hn,me&&(Gn||(Gn=this._map(Me,ot,!0),Qn=this.clusterProps.length,this.clusterProps.push(Gn)),me(Gn,this._map(Me,xr)))}Me[ot+4]=Hn,Ve.push(zt/Tn,Gi/Tn,1/0,Hn,-1,Tn),me&&Ve.push(Qn)}else{for(let Gn=0;Gn<rt;Gn++)Ve.push(Me[ot+Gn]);if(Tn>1)for(const Gn of an){const zt=Gn*rt;if(!(Me[zt+2]<=q)){Me[zt+2]=q;for(let Gi=0;Gi<rt;Gi++)Ve.push(Me[zt+Gi])}}}}return Ve}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,q,le){if(H[q+qi]>1){const Ie=this.clusterProps[H[q+Ai]];return le?Object.assign({},Ie):Ie}const be=this.points[H[q+Pt]].properties,me=this.options.map(be);return le&&me===be?Object.assign({},me):me}}function Rt(ve,H,q){return{type:"Feature",id:ve[H+Pt],properties:fs(ve,H,q),geometry:{type:"Point",coordinates:[(le=ve[H],360*(le-.5)),ps(ve[H+1])]}};var le}function fs(ve,H,q){const le=ve[H+qi],be=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,me=ve[H+Ai],Ie=-1===me?{}:Object.assign({},q[me]);return Object.assign(Ie,{cluster:!0,cluster_id:ve[H+Pt],point_count:le,point_count_abbreviated:be})}function Pr(ve){return ve/360+.5}function $o(ve){const H=Math.sin(ve*Math.PI/180),q=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return q<0?0:q>1?1:q}function ps(ve){const H=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function Sr(ve,H,q,le){let be=le;const me=H+(q-H>>1);let Ie,Ue=q-H;const Me=ve[H],Ve=ve[H+1],rt=ve[q],ot=ve[q+1];for(let Je=H+3;Je<q;Je+=3){const Wt=ja(ve[Je],ve[Je+1],Me,Ve,rt,ot);if(Wt>be)Ie=Je,be=Wt;else if(Wt===be){const an=Math.abs(Je-me);an<Ue&&(Ie=Je,Ue=an)}}be>le&&(Ie-H>3&&Sr(ve,H,Ie,le),ve[Ie+2]=be,q-Ie>3&&Sr(ve,Ie,q,le))}function ja(ve,H,q,le,be,me){let Ie=be-q,Ue=me-le;if(0!==Ie||0!==Ue){const Me=((ve-q)*Ie+(H-le)*Ue)/(Ie*Ie+Ue*Ue);Me>1?(q=be,le=me):Me>0&&(q+=Ie*Me,le+=Ue*Me)}return Ie=ve-q,Ue=H-le,Ie*Ie+Ue*Ue}function ki(ve,H,q,le){const be={id:ve??null,type:H,geometry:q,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===H||"MultiPoint"===H||"LineString"===H)ms(be,q);else if("Polygon"===H)ms(be,q[0]);else if("MultiLineString"===H)for(const me of q)ms(be,me);else if("MultiPolygon"===H)for(const me of q)ms(be,me[0]);return be}function ms(ve,H){for(let q=0;q<H.length;q+=3)ve.minX=Math.min(ve.minX,H[q]),ve.minY=Math.min(ve.minY,H[q+1]),ve.maxX=Math.max(ve.maxX,H[q]),ve.maxY=Math.max(ve.maxY,H[q+1])}function Wl(ve,H,q,le){if(!H.geometry)return;const be=H.geometry.coordinates;if(be&&0===be.length)return;const me=H.geometry.type,Ie=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2);let Ue=[],Me=H.id;if(q.promoteId?Me=H.properties[q.promoteId]:q.generateId&&(Me=le||0),"Point"===me)Xc(be,Ue);else if("MultiPoint"===me)for(const Ve of be)Xc(Ve,Ue);else if("LineString"===me)$a(be,Ue,Ie,!1);else if("MultiLineString"===me){if(q.lineMetrics){for(const Ve of be)Ue=[],$a(Ve,Ue,Ie,!1),ve.push(ki(Me,"LineString",Ue,H.properties));return}ia(be,Ue,Ie,!1)}else if("Polygon"===me)ia(be,Ue,Ie,!0);else{if("MultiPolygon"!==me){if("GeometryCollection"===me){for(const Ve of H.geometry.geometries)Wl(ve,{id:Me,geometry:Ve,properties:H.properties},q,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ve of be){const rt=[];ia(Ve,rt,Ie,!0),Ue.push(rt)}}ve.push(ki(Me,me,Ue,H.properties))}function Xc(ve,H){H.push(Go(ve[0]),Ho(ve[1]),0)}function $a(ve,H,q,le){let be,me,Ie=0;for(let Me=0;Me<ve.length;Me++){const Ve=Go(ve[Me][0]),rt=Ho(ve[Me][1]);H.push(Ve,rt,0),Me>0&&(Ie+=le?(be*rt-Ve*me)/2:Math.sqrt(Math.pow(Ve-be,2)+Math.pow(rt-me,2))),be=Ve,me=rt}const Ue=H.length-3;H[2]=1,Sr(H,0,Ue,q),H[Ue+2]=1,H.size=Math.abs(Ie),H.start=0,H.end=H.size}function ia(ve,H,q,le){for(let be=0;be<ve.length;be++){const me=[];$a(ve[be],me,q,le),H.push(me)}}function Go(ve){return ve/360+.5}function Ho(ve){const H=Math.sin(ve*Math.PI/180),q=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return q<0?0:q>1?1:q}function pn(ve,H,q,le,be,me,Ie,Ue){if(le/=H,me>=(q/=H)&&Ie<le)return ve;if(Ie<q||me>=le)return null;const Me=[];for(const Ve of ve){const rt=Ve.geometry;let ot=Ve.type;const Je=0===be?Ve.minX:Ve.minY,Wt=0===be?Ve.maxX:Ve.maxY;if(Je>=q&&Wt<le){Me.push(Ve);continue}if(Wt<q||Je>=le)continue;let an=[];if("Point"===ot||"MultiPoint"===ot)Xu(rt,an,q,le,be);else if("LineString"===ot)Qr(rt,an,q,le,be,!1,Ue.lineMetrics);else if("MultiLineString"===ot)hl(rt,an,q,le,be,!1);else if("Polygon"===ot)hl(rt,an,q,le,be,!0);else if("MultiPolygon"===ot)for(const Wn of rt){const Tn=[];hl(Wn,Tn,q,le,be,!0),Tn.length&&an.push(Tn)}if(an.length){if(Ue.lineMetrics&&"LineString"===ot){for(const Wn of an)Me.push(ki(Ve.id,ot,Wn,Ve.tags));continue}"LineString"!==ot&&"MultiLineString"!==ot||(1===an.length?(ot="LineString",an=an[0]):ot="MultiLineString"),"Point"!==ot&&"MultiPoint"!==ot||(ot=3===an.length?"Point":"MultiPoint"),Me.push(ki(Ve.id,ot,an,Ve.tags))}}return Me.length?Me:null}function Xu(ve,H,q,le,be){for(let me=0;me<ve.length;me+=3){const Ie=ve[me+be];Ie>=q&&Ie<=le&&qo(H,ve[me],ve[me+1],ve[me+2])}}function Qr(ve,H,q,le,be,me,Ie){let Ue=ba(ve);const Me=0===be?Ku:Kc;let Ve,rt,ot=ve.start;for(let Tn=0;Tn<ve.length-3;Tn+=3){const Gn=ve[Tn],zt=ve[Tn+1],Gi=ve[Tn+2],Qn=ve[Tn+3],Hn=ve[Tn+4],ei=0===be?Gn:zt,xr=0===be?Qn:Hn;let Ur=!1;Ie&&(Ve=Math.sqrt(Math.pow(Gn-Qn,2)+Math.pow(zt-Hn,2))),ei<q?xr>q&&(rt=Me(Ue,Gn,zt,Qn,Hn,q),Ie&&(Ue.start=ot+Ve*rt)):ei>le?xr<le&&(rt=Me(Ue,Gn,zt,Qn,Hn,le),Ie&&(Ue.start=ot+Ve*rt)):qo(Ue,Gn,zt,Gi),xr<q&&ei>=q&&(rt=Me(Ue,Gn,zt,Qn,Hn,q),Ur=!0),xr>le&&ei<=le&&(rt=Me(Ue,Gn,zt,Qn,Hn,le),Ur=!0),!me&&Ur&&(Ie&&(Ue.end=ot+Ve*rt),H.push(Ue),Ue=ba(ve)),Ie&&(ot+=Ve)}let Je=ve.length-3;const Wt=ve[Je],an=ve[Je+1],Wn=0===be?Wt:an;Wn>=q&&Wn<=le&&qo(Ue,Wt,an,ve[Je+2]),Je=Ue.length-3,me&&Je>=3&&(Ue[Je]!==Ue[0]||Ue[Je+1]!==Ue[1])&&qo(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&H.push(Ue)}function ba(ve){const H=[];return H.size=ve.size,H.start=ve.start,H.end=ve.end,H}function hl(ve,H,q,le,be,me){for(const Ie of ve)Qr(Ie,H,q,le,be,me,!1)}function qo(ve,H,q,le){ve.push(H,q,le)}function Ku(ve,H,q,le,be,me){const Ie=(me-H)/(le-H);return qo(ve,me,q+(be-q)*Ie,1),Ie}function Kc(ve,H,q,le,be,me){const Ie=(me-q)/(be-q);return qo(ve,H+(le-H)*Ie,me,1),Ie}function Ju(ve,H){const q=[];for(let le=0;le<ve.length;le++){const be=ve[le],me=be.type;let Ie;if("Point"===me||"MultiPoint"===me||"LineString"===me)Ie=fl(be.geometry,H);else if("MultiLineString"===me||"Polygon"===me){Ie=[];for(const Ue of be.geometry)Ie.push(fl(Ue,H))}else if("MultiPolygon"===me){Ie=[];for(const Ue of be.geometry){const Me=[];for(const Ve of Ue)Me.push(fl(Ve,H));Ie.push(Me)}}q.push(ki(be.id,me,Ie,be.tags))}return q}function fl(ve,H){const q=[];q.size=ve.size,void 0!==ve.start&&(q.start=ve.start,q.end=ve.end);for(let le=0;le<ve.length;le+=3)q.push(ve[le]+H,ve[le+1],ve[le+2]);return q}function gs(ve,H){if(ve.transformed)return ve;const q=1<<ve.z,le=ve.x,be=ve.y;for(const me of ve.features){const Ie=me.geometry,Ue=me.type;if(me.geometry=[],1===Ue)for(let Me=0;Me<Ie.length;Me+=2)me.geometry.push(Qu(Ie[Me],Ie[Me+1],H,q,le,be));else for(let Me=0;Me<Ie.length;Me++){const Ve=[];for(let rt=0;rt<Ie[Me].length;rt+=2)Ve.push(Qu(Ie[Me][rt],Ie[Me][rt+1],H,q,le,be));me.geometry.push(Ve)}}return ve.transformed=!0,ve}function Qu(ve,H,q,le,be,me){return[Math.round(q*(ve*le-be)),Math.round(q*(H*le-me))]}function pl(ve,H,q,le,be){const me=H===be.maxZoom?0:be.tolerance/((1<<H)*be.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:ve.length,source:null,x:q,y:le,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ue of ve)Fi(Ie,Ue,me,be);return Ie}function Fi(ve,H,q,le){const be=H.geometry,me=H.type,Ie=[];if(ve.minX=Math.min(ve.minX,H.minX),ve.minY=Math.min(ve.minY,H.minY),ve.maxX=Math.max(ve.maxX,H.maxX),ve.maxY=Math.max(ve.maxY,H.maxY),"Point"===me||"MultiPoint"===me)for(let Ue=0;Ue<be.length;Ue+=3)Ie.push(be[Ue],be[Ue+1]),ve.numPoints++,ve.numSimplified++;else if("LineString"===me)Rs(Ie,be,ve,q,!1,!1);else if("MultiLineString"===me||"Polygon"===me)for(let Ue=0;Ue<be.length;Ue++)Rs(Ie,be[Ue],ve,q,"Polygon"===me,0===Ue);else if("MultiPolygon"===me)for(let Ue=0;Ue<be.length;Ue++){const Me=be[Ue];for(let Ve=0;Ve<Me.length;Ve++)Rs(Ie,Me[Ve],ve,q,!0,0===Ve)}if(Ie.length){let Ue=H.tags||null;if("LineString"===me&&le.lineMetrics){Ue={};for(const Ve in H.tags)Ue[Ve]=H.tags[Ve];Ue.mapbox_clip_start=be.start/be.size,Ue.mapbox_clip_end=be.end/be.size}const Me={geometry:Ie,type:"Polygon"===me||"MultiPolygon"===me?3:"LineString"===me||"MultiLineString"===me?2:1,tags:Ue};null!==H.id&&(Me.id=H.id),ve.features.push(Me)}}function Rs(ve,H,q,le,be,me){const Ie=le*le;if(le>0&&H.size<(be?Ie:le))return void(q.numPoints+=H.length/3);const Ue=[];for(let Me=0;Me<H.length;Me+=3)(0===le||H[Me+2]>Ie)&&(q.numSimplified++,Ue.push(H[Me],H[Me+1])),q.numPoints++;be&&function(Me,Ve){let rt=0;for(let ot=0,Je=Me.length,Wt=Je-2;ot<Je;Wt=ot,ot+=2)rt+=(Me[ot]-Me[Wt])*(Me[ot+1]+Me[Wt+1]);if(rt>0===Ve)for(let ot=0,Je=Me.length;ot<Je/2;ot+=2){const Wt=Me[ot],an=Me[ot+1];Me[ot]=Me[Je-2-ot],Me[ot+1]=Me[Je-1-ot],Me[Je-2-ot]=Wt,Me[Je-1-ot]=an}}(Ue,me),ve.push(Ue)}const km={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ra{constructor(H,q){const le=(q=this.options=function(me,Ie){for(const Ue in Ie)me[Ue]=Ie[Ue];return me}(Object.create(km),q)).debug;if(le&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");let be=function(me,Ie){const Ue=[];if("FeatureCollection"===me.type)for(let Me=0;Me<me.features.length;Me++)Wl(Ue,me.features[Me],Ie,Me);else Wl(Ue,"Feature"===me.type?me:{geometry:me},Ie);return Ue}(H,q);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),be=function(me,Ie){const Ue=Ie.buffer/Ie.extent;let Me=me;const Ve=pn(me,1,-1-Ue,Ue,0,-1,2,Ie),rt=pn(me,1,1-Ue,2+Ue,0,-1,2,Ie);return(Ve||rt)&&(Me=pn(me,1,-Ue,1+Ue,0,-1,2,Ie)||[],Ve&&(Me=Ju(Ve,1).concat(Me)),rt&&(Me=Me.concat(Ju(rt,-1)))),Me}(be,q),be.length&&this.splitTile(be,0,0,0),le&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,q,le,be,me,Ie,Ue){const Me=[H,q,le,be],Ve=this.options,rt=Ve.debug;for(;Me.length;){be=Me.pop(),le=Me.pop(),q=Me.pop(),H=Me.pop();const ot=1<<q,Je=eo(q,le,be);let Wt=this.tiles[Je];if(!Wt&&(rt>1&&console.time("creation"),Wt=this.tiles[Je]=pl(H,q,le,be,Ve),this.tileCoords.push({z:q,x:le,y:be}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,le,be,Wt.numFeatures,Wt.numPoints,Wt.numSimplified),console.timeEnd("creation"));const Ur=`z${q}`;this.stats[Ur]=(this.stats[Ur]||0)+1,this.total++}if(Wt.source=H,null==me){if(q===Ve.indexMaxZoom||Wt.numPoints<=Ve.indexMaxPoints)continue}else{if(q===Ve.maxZoom||q===me)continue;if(null!=me){const Ur=me-q;if(le!==Ie>>Ur||be!==Ue>>Ur)continue}}if(Wt.source=null,0===H.length)continue;rt>1&&console.time("clipping");const an=.5*Ve.buffer/Ve.extent,Wn=.5-an,Tn=.5+an,Gn=1+an;let zt=null,Gi=null,Qn=null,Hn=null,ei=pn(H,ot,le-an,le+Tn,0,Wt.minX,Wt.maxX,Ve),xr=pn(H,ot,le+Wn,le+Gn,0,Wt.minX,Wt.maxX,Ve);H=null,ei&&(zt=pn(ei,ot,be-an,be+Tn,1,Wt.minY,Wt.maxY,Ve),Gi=pn(ei,ot,be+Wn,be+Gn,1,Wt.minY,Wt.maxY,Ve),ei=null),xr&&(Qn=pn(xr,ot,be-an,be+Tn,1,Wt.minY,Wt.maxY,Ve),Hn=pn(xr,ot,be+Wn,be+Gn,1,Wt.minY,Wt.maxY,Ve),xr=null),rt>1&&console.timeEnd("clipping"),Me.push(zt||[],q+1,2*le,2*be),Me.push(Gi||[],q+1,2*le,2*be+1),Me.push(Qn||[],q+1,2*le+1,2*be),Me.push(Hn||[],q+1,2*le+1,2*be+1)}}getTile(H,q,le){H=+H,q=+q,le=+le;const be=this.options,{extent:me,debug:Ie}=be;if(H<0||H>24)return null;const Ue=1<<H,Me=eo(H,q=q+Ue&Ue-1,le);if(this.tiles[Me])return gs(this.tiles[Me],me);Ie>1&&console.log("drilling down to z%d-%d-%d",H,q,le);let Ve,rt=H,ot=q,Je=le;for(;!Ve&&rt>0;)rt--,ot>>=1,Je>>=1,Ve=this.tiles[eo(rt,ot,Je)];return Ve&&Ve.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",rt,ot,Je),console.time("drilling down")),this.splitTile(Ve.source,rt,ot,Je,H,q,le),Ie>1&&console.timeEnd("drilling down"),this.tiles[Me]?gs(this.tiles[Me],me):null):null}}function eo(ve,H,q){return 32*((1<<ve)*q+H)+ve}function Ci(ve,H){const q=ve.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const le=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!le)return H(null,null);const be=new Mi(le.features);let me=lt(be);0===me.byteOffset&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),H(null,{vectorTile:be,rawData:me.buffer})}class Zl extends ya{constructor(H,q,le,be,me,Ie){super(H,q,le,be,Ci,Ie),me&&(this.loadGeoJSON=me),this._dynamicIndex=new Hl}loadData(H,q){const le=H&&H.request,be=le&&le.collectResourceTiming;this.loadGeoJSON(H,(me,Ie)=>{if(me||!Ie)return q(me);if("object"!=typeof Ie)return q(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{try{if(H.filter){const Me=d.z(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Me.result)throw new Error(Me.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));Ie.features=Ie.features.filter(Ve=>Me.value.evaluate({zoom:0},Ve))}H.dynamic?("Feature"===Ie.type&&(Ie={type:"FeatureCollection",features:[Ie]}),H.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),H.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=H.cluster?new Ft(function({superclusterOptions:Me,clusterProperties:Ve}){if(!Ve||!Me)return Me;const rt={},ot={},Je={accumulated:null,zoom:0},Wt={properties:null},an=Object.keys(Ve);for(const Wn of an){const[Tn,Gn]=Ve[Wn],zt=d.z(Gn),Gi=d.z("string"==typeof Tn?[Tn,["accumulated"],["get",Wn]]:Tn);rt[Wn]=zt.value,ot[Wn]=Gi.value}return Me.map=Wn=>{Wt.properties=Wn;const Tn={};for(const Gn of an)Tn[Gn]=rt[Gn].evaluate(Je,Wt);return Tn},Me.reduce=(Wn,Tn)=>{Wt.properties=Tn;for(const Gn of an)Je.accumulated=Wn[Gn],Wn[Gn]=ot[Gn].evaluate(Je,Wt)},Me}(H)).load(Ie.features):H.dynamic?this._dynamicIndex:new ra(Me=Ie,H.geojsonVtOptions)}catch(Me){return q(Me)}const Ue={};if(be){const Me=hr(le);Me&&(Ue.resourceTiming={},Ue.resourceTiming[H.source]=JSON.parse(JSON.stringify(Me)))}q(null,Ue)}var Me})}reloadTile(H,q){const le=this.loaded;return le&&le[H.uid]?H.partial?q(null,void 0):super.reloadTile(H,q):this.loadTile(H,q)}loadGeoJSON(H,q){if(H.request)d.h(H.request,q);else{if("string"!=typeof H.data)return q(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(H.data))}catch{return q(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(H,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(le){q(le)}}getClusterChildren(H,q){try{q(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(le){q(le)}}getClusterLeaves(H,q){try{q(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(le){q(le)}}}class lo{constructor(H,q){this.tileID=new d.aQ(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=H.projection,this.brightness=q}parse(H,q,le,be){this.status="parsing";const me=new d.aQ(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),Ie={},Ue=q.familiesBySource[le.source],Me=new d.dQ(me,le.promoteId);return Me.bucketLayerIDs=[],Me.is3DTile=!0,d.e6(H).then(Ve=>{if(!Ve)return be(new Error("Could not parse tile"));const rt=d.e7(Ve,1/d.b7(le.tileID.canonical)),ot=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ve.json.asset.extras&&Ve.json.asset.extras.MAPBOX_mesh_features,Je=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("EXT_meshopt_compression"),Wt=new d.Y(this.zoom,{brightness:this.brightness});for(const an in Ue)for(const Wn of Ue[an]){const Tn=Wn[0];Me.bucketLayerIDs.push(Wn.map(zt=>zt.id)),Tn.recalculate(Wt,[]);const Gn=new d.e8(rt,me,ot,Je,this.brightness,Me);ot||(Gn.needsUpload=!0),Ie[Tn.fqid]=Gn,Gn.evaluate(Tn)}this.status="done",be(null,{buckets:Ie,featureIndex:Me})}).catch(Ve=>be(new Error(Ve.message)))}}class br{constructor(H,q,le,be,me,Ie){this.actor=H,this.layerIndex=q,this.brightness=Ie,this.loading={},this.loaded={}}loadTile(H,q){const le=H.uid,be=this.loading[le]=new lo(H,this.brightness);d.e5(H.request,(me,Ie)=>{const Ue=!this.loading[le];return delete this.loading[le],Ue||me?(be.status="done",Ue||(this.loaded[le]=be),q(me)):Ie&&0!==Ie.byteLength?void be.parse(Ie,this.layerIndex,H,(Me,Ve)=>{be.status="done",this.loaded=this.loaded||{},this.loaded[le]=be,Me||!Ve?q(Me):q(null,Ve)}):(be.status="done",this.loaded[le]=be,q())})}reloadTile(H,q){const le=this.loaded,be=H.uid;if(le&&le[be]){const me=le[be];me.projection=H.projection,me.brightness=H.brightness;const Ie=(Ue,Me)=>{me.reloadCallback&&(delete me.reloadCallback,this.loadTile(H,q)),q(Ue,Me)};"parsing"===me.status?me.reloadCallback=Ie:"done"===me.status&&this.loadTile(H,q)}}abortTile(H,q){const le=H.uid;this.loading[le]&&delete this.loading[le],q()}removeTile(H,q){const le=this.loaded,be=H.uid;le&&le[be]&&delete le[be],q()}}class ir{constructor(H){this.self=H,this.actor=new d.e9(H,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.aK({name:"mercator"}),this.workerSourceTypes={vector:ya,geojson:Zl,"batched-model":br},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,le)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=le},this.self.registerRTLTextPlugin=q=>{if(d.ea.isParsed())throw new Error("RTL text plugin already registered.");d.ea.applyArabicShaping=q.applyArabicShaping,d.ea.processBidirectionalText=q.processBidirectionalText,d.ea.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(H,q,le){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H],delete this.rasterArrayWorkerSource,le()}checkIfReady(H,q,le){le()}setReferrer(H,q){this.referrer=q}spriteLoaded(H,{scope:q,isLoaded:le}){if(this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={}),this.isSpriteLoaded[H][q]=le,this.workerSources[H]&&this.workerSources[H][q])for(const be in this.workerSources[H][q]){const me=this.workerSources[H][q][be];for(const Ie in me){const Ue=me[Ie];Ue instanceof ya&&(Ue.isSpriteLoaded=le,Ue.fire(new d.g("isSpriteLoaded")))}}}setImages(H,{scope:q,images:le},be){if(this.availableImages[H]||(this.availableImages[H]={}),this.availableImages[H][q]=le,this.workerSources[H]&&this.workerSources[H][q]){for(const me in this.workerSources[H][q]){const Ie=this.workerSources[H][q][me];for(const Ue in Ie)Ie[Ue].availableImages=le}be()}else be()}setProjection(H,q){this.projections[H]=d.aK(q)}setBrightness(H,q,le){this.brightness=q,le()}setLayers(H,q,le){this.getLayerIndex(H,q.scope).replace(q.layers,q.options),le()}updateLayers(H,q,le){this.getLayerIndex(H,q.scope).update(q.layers,q.removedIds,q.options),le()}loadTile(H,q,le){q.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,q.type,q.source,q.scope).loadTile(q,le)}loadDEMTile(H,q,le){this.getDEMWorkerSource(H,q.source,q.scope).loadTile(q,le)}decodeRasterArray(H,q,le){this.getRasterArrayWorkerSource().decodeRasterArray(q,le)}reloadTile(H,q,le){q.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,q.type,q.source,q.scope).reloadTile(q,le)}abortTile(H,q,le){this.getWorkerSource(H,q.type,q.source,q.scope).abortTile(q,le)}removeTile(H,q,le){this.getWorkerSource(H,q.type,q.source,q.scope).removeTile(q,le)}removeSource(H,q,le){if(!(this.workerSources[H]&&this.workerSources[H][q.scope]&&this.workerSources[H][q.scope][q.type]&&this.workerSources[H][q.scope][q.type][q.source]))return;const be=this.workerSources[H][q.scope][q.type][q.source];delete this.workerSources[H][q.scope][q.type][q.source],void 0!==be.removeSource?be.removeSource(q,le):le()}loadWorkerSource(H,q,le){try{this.self.importScripts(q.url),le()}catch(be){le(be.toString())}}syncRTLPluginState(H,q,le){try{d.ea.setState(q);const be=d.ea.getPluginURL();if(d.ea.isLoaded()&&!d.ea.isParsed()&&null!=be){this.self.importScripts(be);const me=d.ea.isParsed();le(me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),me)}}catch(be){le(be.toString())}}setDracoUrl(H,q){this.dracoUrl=q}getAvailableImages(H,q){this.availableImages[H]||(this.availableImages[H]={});let le=this.availableImages[H][q];return le||(le=[]),le}getLayerIndex(H,q){this.layerIndexes[H]||(this.layerIndexes[H]={});let le=this.layerIndexes[H][q];return le||(le=this.layerIndexes[H][q]=new ti,le.scope=q),le}getWorkerSource(H,q,le,be){return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][be]||(this.workerSources[H][be]={}),this.workerSources[H][be][q]||(this.workerSources[H][be][q]={}),this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={}),this.workerSources[H][be][q][le]||(this.workerSources[H][be][q][le]=new this.workerSourceTypes[q]({send:(me,Ie,Ue,Me,Ve,rt)=>{this.actor.send(me,Ie,Ue,H,Ve,rt)},scheduler:this.actor.scheduler},this.getLayerIndex(H,be),this.getAvailableImages(H,be),this.isSpriteLoaded[H][be],void 0,this.brightness)),this.workerSources[H][be][q][le]}getDEMWorkerSource(H,q,le){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][le]||(this.demWorkerSources[H][le]={}),this.demWorkerSources[H][le][q]||(this.demWorkerSources[H][le][q]=new Gl),this.demWorkerSources[H][le][q]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new ll),this.rasterArrayWorkerSource}enforceCacheSizeLimit(H,q){d.eb(q)}getWorkerPerformanceMetrics(H,q,le){le(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ir(self)),ir}),dr(0,function(d){var hr=On;function On(g){return l=g,!(typeof window>"u"||typeof document>"u"||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,w=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(w);try{b=new Worker(E),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(E),y}()||!function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var w=b.getImageData(0,0,1,1);return w&&w.width===y.width}()||(void 0===Cn[h=l&&l.failIfMajorPerformanceCaveat]&&(Cn[h]=function(y){var b,E,M,O,w=(E=y,M=document.createElement("canvas"),(O=Object.create(On.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,M.getContext("webgl2",O));if(!w)return!1;try{b=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!b||w.isContextLost())&&(w.shaderSource(b,"void main() {}"),w.compileShader(b),!0===w.getShaderParameter(b,w.COMPILE_STATUS))}(h)),!Cn[h]||document.documentMode));var l,h}var Cn={};function ti(g,l,h){const y=document.createElement(g);return null!=l&&(y.className=l),h&&h.appendChild(y),y}function Or(g,l,h){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(l))y.setAttributeNS(null,b,String(l[b]));return h&&h.appendChild(y),y}On.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Do=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ta=Do&&void 0!==Do.userSelect?"userSelect":"WebkitUserSelect";let Ps;function ya(){Do&&ta&&(Ps=Do[ta],Do[ta]="none")}function Gl(){Do&&ta&&(Do[ta]=Ps)}function ll(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",ll,!0)}function us(){window.addEventListener("click",ll,!0),window.setTimeout(()=>{window.removeEventListener("click",ll,!0)},0)}function Di(g,l){const h=g.getBoundingClientRect();return Va(g,h,l)}function Mi(g,l){const h=g.getBoundingClientRect(),y=[];for(let b=0;b<l.length;b++)y.push(Va(g,h,l[b]));return y}function ao(g){return void 0!==window.InstallTrigger&&2===g.button&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function Va(g,l,h){const y=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new d.P((h.clientX-l.left)*y,(h.clientY-l.top)*y)}class Hl{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,h){this._updatedSourceCaches[l]=h,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const h=l.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(l.id),this.setDirty()}removeLayer(l){const h=l.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][l.id]=l,this._updatedLayers[h].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const h in this._updatedLayers)l[h]=l[h]||{},l[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)l[h]=l[h]||{},l[h].removedIds=Object.keys(this._removedLayers[h]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const cl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class di{constructor(l,h,y,b,w,E){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=b,this.instanceCount=E,this.context=l;const M=l.gl;this.buffer=M.createBuffer(),l.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||w||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let y=0;y<this.attributes.length;y++){const b=h.attributes[this.attributes[y].name];void 0!==b&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,h,y){for(let b=0;b<this.attributes.length;b++){const w=this.attributes[b],E=h.attributes[w.name];void 0!==E&&l.vertexAttribPointer(E,w.components,l[cl[w.type]],!1,this.itemSize,w.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(l,h,y){for(let b=0;b<this.attributes.length;b++){const w=h.attributes[this.attributes[b].name];void 0!==w&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(w,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ds extends Jn{getDefault(){return d.C.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class ul extends Jn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Yu extends Jn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class dl extends Jn{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class hi extends Jn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class va extends Jn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class hs extends Jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class wh extends Jn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class ql extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class Ua extends Jn{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class ai extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class na extends Jn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Vr extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class Gf extends Jn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Hf extends Jn{getDefault(){return d.C.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Zc extends Jn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class dn extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class Yc extends Jn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Ii extends Jn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let it=class extends Jn{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class lt extends Jn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class St extends Jn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class kt extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class yn extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Pt extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class qi extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ai extends Jn{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ft extends Jn{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class Rt extends Jn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class fs extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Pr extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class $o extends Jn{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class ps extends $o{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Sr extends $o{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ja extends $o{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class ki extends Sr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ms{constructor(l,h,y,b,w){this.context=l,this.width=h,this.height=y;const E=this.framebuffer=l.gl.createFramebuffer();b&&(this.colorAttachment=new ps(l,E)),w&&(this.depthAttachmentType=w,this.depthAttachment="renderbuffer"===w?new Sr(l,E):new ja(l,E))}destroy(){const l=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&l.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const h=this.depthAttachment.get();h&&l.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&l.deleteTexture(h)}l.deleteFramebuffer(this.framebuffer)}}class Wl{constructor(l,h){this.gl=l,this.clearColor=new ds(this),this.clearDepth=new ul(this),this.clearStencil=new Yu(this),this.colorMask=new dl(this),this.depthMask=new hi(this),this.stencilMask=new va(this),this.stencilFunc=new hs(this),this.stencilOp=new wh(this),this.stencilTest=new ql(this),this.depthRange=new Ua(this),this.depthTest=new ai(this),this.depthFunc=new na(this),this.blend=new Vr(this),this.blendFunc=new Gf(this),this.blendColor=new Hf(this),this.blendEquation=new Zc(this),this.cullFace=new dn(this),this.cullFaceSide=new Yc(this),this.frontFace=new Ii(this),this.program=new it(this),this.activeTexture=new lt(this),this.viewport=new St(this),this.bindFramebuffer=new kt(this),this.bindRenderbuffer=new yn(this),this.bindTexture=new Pt(this),this.bindVertexBuffer=new qi(this),this.bindElementBuffer=new Ai(this),this.bindVertexArrayOES=new Ft(this),this.pixelStoreUnpack=new Rt(this),this.pixelStoreUnpackPremultiplyAlpha=new fs(this),this.pixelStoreUnpackFlipY=new Pr(this),this.options=h?{...h}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h,y){return new d.I(this,l,h,y)}createVertexBuffer(l,h,y,b,w){return new di(this,l,h,y,b,w)}createRenderbuffer(l,h,y){const b=this.gl,w=b.createRenderbuffer();return this.bindRenderbuffer.set(w),b.renderbufferStorage(b.RENDERBUFFER,l,h,y),this.bindRenderbuffer.set(null),w}createFramebuffer(l,h,y,b){return new ms(this,l,h,y,b)}clear({color:l,depth:h,stencil:y,colorMask:b}){const w=this.gl;let E=0;l&&(E|=w.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(b||[!0,!0,!0,!0])),void 0!==h&&(E|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==y&&(E|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),w.clear(E)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){d.d(l.blendFunction,d.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Xc{constructor(l,h,y,b){const w={width:y[0],height:y[1],data:null},E=l.gl;this.targetColorTexture=new d.T(l,w,E.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new d.T(l,w,E.RGBA,{useMipmap:!1}),this.context=l,this.updateParticleTexture(h,b),this.lastInvalidatedAt=0}updateParticleTexture(l,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,b=h.width*h.height;this.particleTexture0=new d.T(this.context,h,y.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new d.T(this.context,h,y.RGBA,{premultiply:!1,useMipmap:!1});const w=new d.S;w.reserve(b);for(let E=0;E<b;E++)w.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(w,d.p.members,!0),this.particleSegment=d.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=d.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class $a extends d.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,h){return d.l(this.requestManager.transformRequest(h,d.R.Model).url).then(y=>{if(!y)return;const b=d.c(y),w=new d.M(l,void 0,void 0,b);return w.computeBoundsAndApplyParent(),w}).catch(y=>{if(y&&404===y.status)return null;this.fire(new d.f(new Error(`Could not load model ${l} from ${h}: ${y.message}`)))})}load(l,h){this.models[h]||(this.models[h]={});const y=Object.keys(l);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+y.length;const b=[];for(const w of y)b.push(this.loadModel(w,l[w]));Promise.allSettled(b).then(w=>{for(let E=0;E<w.length;E++){const{status:M,value:O}=w[E];"fulfilled"===M&&O&&(this.models[h][y[E]]={model:O,numReferences:1})}this.numModelsLoading[h]-=y.length,this.fire(new d.g("data",{dataType:"style"}))}).catch(w=>{this.fire(new d.f(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,h){return!!this.getModel(l,h)}getModel(l,h){return this.models[h]||(this.models[h]={}),this.models[h][l]?this.models[h][l].model:void 0}addModel(l,h,y){this.models[y]||(this.models[y]={}),this.hasModel(l,y)&&this.models[y][l].numReferences++,this.load({[l]:this.requestManager.normalizeModelURL(h)},y)}addModels(l,h){this.models[h]||(this.models[h]={});const y={};for(const b in l)this.models[h][b]={},y[b]=this.requestManager.normalizeModelURL(l[b]);this.load(y,h)}addModelsFromBucket(l,h){this.models[h]||(this.models[h]={});const y={};for(const b of l)this.hasModel(b,h)?this.models[h][b].numReferences++:y[b]=this.requestManager.normalizeModelURL(b);this.load(y,h)}removeModel(l,h){if(this.models[h]&&this.models[h][l]&&(this.models[h][l].numReferences--,0===this.models[h][l].numReferences)){const y=this.models[h][l].model;delete this.models[h][l],y.destroy()}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,h){this.models[h]||(this.models[h]={});for(const y in this.models[h])this.models[h][y].model&&this.models[h][y].model.upload(l.context)}}function ia(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class Go extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new d.j({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,h){if(this.loaded[h]!==l&&(this.loaded[h]=l,l)){for(const{ids:y,callback:b}of this.requestors)this._notify(y,h,b);this.requestors=[]}}hasImage(l,h){return!!this.getImage(l,h)}getImage(l,h){return this.images[h][l]}addImage(l,h,y){this._validate(l,y)&&(this.images[h][l]=y)}_validate(l,h){let y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new d.f(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new d.f(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new d.f(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,h){if(!l)return!0;let y=0;for(const b of l){if(b[0]<y||b[1]<b[0]||h<b[1])return!1;y=b[1]}return!0}_validateContent(l,h){return!(l&&(4!==l.length||l[0]<0||h.data.width<l[0]||l[1]<0||h.data.height<l[1]||l[2]<0||h.data.width<l[2]||l[3]<0||h.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,h,y){y.version=this.images[h][l].version+1,this.images[h][l]=y,this.updatedImages[h][l]=!0}removeImage(l,h){const y=this.images[h][l];delete this.images[h][l],delete this.patterns[h][l],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,h,y){let b=!0;const w=!!this.loaded[h];if(!w)for(const E of l)this.images[h][E]||(b=!1);w||b?this._notify(l,h,y):this.requestors.push({ids:l,scope:h,callback:y})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,h,y){const b={};for(const w of l){this.images[h][w]||this.fire(new d.g("styleimagemissing",{id:w}));const E=this.images[h][w];E?b[w]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!(!E.userImage||!E.userImage.render)}:d.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,b)}getPixelSize(l){const{width:h,height:y}=this.atlasImage[l];return{width:h,height:y}}getPattern(l,h,y){const b=this.patterns[h][l],w=this.getImage(l,h);if(!w)return null;if(b&&b.position.version===w.version)return b.position;if(b)b.position.version=w.version;else{const E={w:w.data.width+2,h:w.data.height+2,x:0,y:0},M=new d.m(E,w);this.patterns[h][l]={bin:E,position:M}}return this._updatePatternAtlas(h,y),this.patterns[h][l].position}bind(l,h){const y=l.gl;let b=this.atlasTexture[h];b?this.dirty&&(b.update(this.atlasImage[h]),this.dirty=!1):(b=new d.T(l,this.atlasImage[h],y.RGBA),this.atlasTexture[h]=b),b.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(l,h){const y=[];for(const M in this.patterns[l])y.push(this.patterns[l][M].bin);const{w:b,h:w}=d.k(y),E=this.atlasImage[l];E.resize({width:b||1,height:w||1});for(const M in this.patterns[l]){const{bin:O}=this.patterns[l][M],R=O.x+1,k=O.y+1,B=this.images[l][M].data,U=B.width,j=B.height;d.j.copy(B,E,{x:0,y:0},{x:R,y:k},{width:U,height:j},h),d.j.copy(B,E,{x:0,y:j-1},{x:R,y:k-1},{width:U,height:1},h),d.j.copy(B,E,{x:0,y:0},{x:R,y:k+j},{width:U,height:1},h),d.j.copy(B,E,{x:U-1,y:0},{x:R-1,y:k},{width:1,height:j},h),d.j.copy(B,E,{x:0,y:0},{x:R+U,y:k},{width:1,height:j},h)}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,h){for(const y of l){if(this.callbackDispatchedThisFrame[h][y])continue;this.callbackDispatchedThisFrame[h][y]=!0;const b=this.images[h][y];ia(b)&&this.updateImage(y,h,b)}}}function Ho(g){const l=g.key,h=g.value,y=g.valueSpec||{},b=g.objectElementValidators||{},w=g.style,E=g.styleSpec;let M=[];const O=d.o(h);if("object"!==O)return[new d.V(l,h,`object expected, ${O} found`)];for(const R in h){const k=R.split(".")[0];let B;b[k]?B=b[k]:y[k]?B=br:b["*"]?B=b["*"]:y["*"]&&(B=br),B?M=M.concat(B({key:(l&&`${l}.`)+R,value:h[R],valueSpec:y[k]||y["*"],style:w,styleSpec:E,object:h,objectKey:R},h)):M.push(new d.n(l,h[R],`unknown property "${R}"`))}for(const R in y)b[R]||y[R].required&&void 0===y[R].default&&void 0===h[R]&&M.push(new d.V(l,h,`missing required property "${R}"`));return M}function pn(g){const l=g.value,h=g.valueSpec,y=g.style,b=g.styleSpec,w=g.key,E=g.arrayElementValidator||br;if("array"!==d.o(l))return[new d.V(w,l,`array expected, ${d.o(l)} found`)];if(h.length&&l.length!==h.length)return[new d.V(w,l,`array length ${h.length} expected, length ${l.length} found`)];if(h["min-length"]&&l.length<h["min-length"])return[new d.V(w,l,`array length at least ${h["min-length"]} expected, length ${l.length} found`)];let M={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};b.$version<7&&(M.function=h.function),"object"===d.o(h.value)&&(M=h.value);let O=[];for(let R=0;R<l.length;R++)O=O.concat(E({array:l,arrayIndex:R,value:l[R],valueSpec:M,style:y,styleSpec:b,key:`${w}[${R}]`},!0));return O}function Xu(g){const l=g.key,h=g.value,y=g.valueSpec;let b=d.o(h);if("number"===b&&h!=h&&(b="NaN"),"number"!==b)return[new d.V(l,h,`number expected, ${b} found`)];if("minimum"in y){let w=y.minimum;if("array"===d.o(y.minimum)&&(w=y.minimum[g.arrayIndex]),h<w)return[new d.V(l,h,`${h} is less than the minimum value ${w}`)]}if("maximum"in y){let w=y.maximum;if("array"===d.o(y.maximum)&&(w=y.maximum[g.arrayIndex]),h>w)return[new d.V(l,h,`${h} is greater than the maximum value ${w}`)]}return[]}function Qr(g){const l=g.valueSpec,h=d.u(g.value.type);let y,b,w,E={};const M="categorical"!==h&&void 0===g.value.property,O=!M,R="array"===d.o(g.value.stops)&&"array"===d.o(g.value.stops[0])&&"object"===d.o(g.value.stops[0][0]),k=Ho({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(j){if("identity"===h)return[new d.V(j.key,j.value,'identity function may not have a "stops" property')];let Z=[];const Y=j.value;return Z=Z.concat(pn({key:j.key,value:Y,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:B})),"array"===d.o(Y)&&0===Y.length&&Z.push(new d.V(j.key,Y,"array must have at least one stop")),Z},default:function(j){return br({key:j.key,value:j.value,valueSpec:l,style:j.style,styleSpec:j.styleSpec})}}});return"identity"===h&&M&&k.push(new d.V(g.key,g.value,'missing required property "property"')),"identity"===h||g.value.stops||k.push(new d.V(g.key,g.value,'missing required property "stops"')),"exponential"===h&&g.valueSpec.expression&&!d.s(g.valueSpec)&&k.push(new d.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(O&&!d.r(g.valueSpec)?k.push(new d.V(g.key,g.value,"property functions not supported")):M&&!d.t(g.valueSpec)&&k.push(new d.V(g.key,g.value,"zoom functions not supported"))),"categorical"!==h&&!R||void 0!==g.value.property||k.push(new d.V(g.key,g.value,'"property" property is required')),k;function B(j){let Z=[];const Y=j.value,X=j.key;if("array"!==d.o(Y))return[new d.V(X,Y,`array expected, ${d.o(Y)} found`)];if(2!==Y.length)return[new d.V(X,Y,`array length 2 expected, length ${Y.length} found`)];if(R){if("object"!==d.o(Y[0]))return[new d.V(X,Y,`object expected, ${d.o(Y[0])} found`)];if(void 0===Y[0].zoom)return[new d.V(X,Y,"object stop key must have zoom")];if(void 0===Y[0].value)return[new d.V(X,Y,"object stop key must have value")];const W=d.u(Y[0].zoom);if("number"!=typeof W)return[new d.V(X,Y[0].zoom,"stop zoom values must be numbers")];if(w&&w>W)return[new d.V(X,Y[0].zoom,"stop zoom values must appear in ascending order")];W!==w&&(w=W,b=void 0,E={}),Z=Z.concat(Ho({key:`${X}[0]`,value:Y[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Xu,value:U}}))}else Z=Z.concat(U({key:`${X}[0]`,value:Y[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},Y));return d.v(d.x(Y[1]))?Z.concat([new d.V(`${X}[1]`,Y[1],"expressions are not allowed in function stops.")]):Z.concat(br({key:`${X}[1]`,value:Y[1],valueSpec:l,style:j.style,styleSpec:j.styleSpec}))}function U(j,Z){const Y=d.o(j.value),X=d.u(j.value),W=null!==j.value?j.value:Z;if(y){if(Y!==y)return[new d.V(j.key,W,`${Y} stop domain type must match previous stop domain type ${y}`)]}else y=Y;if("number"!==Y&&"string"!==Y&&"boolean"!==Y&&"number"!=typeof X&&"string"!=typeof X&&"boolean"!=typeof X)return[new d.V(j.key,W,"stop domain value must be a number, string, or boolean")];if("number"!==Y&&"categorical"!==h){let K=`number expected, ${Y} found`;return d.r(l)&&void 0===h&&(K+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new d.V(j.key,W,K)]}return"categorical"!==h||"number"!==Y||"number"==typeof X&&isFinite(X)&&Math.floor(X)===X?"categorical"!==h&&"number"===Y&&"number"==typeof X&&"number"==typeof b&&void 0!==b&&X<b?[new d.V(j.key,W,"stop domain values must appear in ascending order")]:(b=X,"categorical"===h&&X in E?[new d.V(j.key,W,"stop domain values must be unique")]:(E[X]=!0,[])):[new d.V(j.key,W,`integer expected, found ${String(X)}`)]}}function ba(g){const l=("property"===g.expressionContext?d.y:d.z)(d.x(g.value),g.valueSpec);if("error"===l.result)return l.value.map(y=>new d.V(`${g.key}${y.key}`,g.value,y.message));const h=l.value.expression||l.value._styleExpression.expression;if("property"===g.expressionContext&&"text-font"===g.propertyKey&&!h.outputDefined())return[new d.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===g.expressionContext&&"layout"===g.propertyType&&!d.A(h))return[new d.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===g.expressionContext)return hl(h,g);if(g.expressionContext&&0===g.expressionContext.indexOf("cluster")){if(!d.B(h,["zoom","feature-state"]))return[new d.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===g.expressionContext&&!d.D(h))return[new d.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hl(g,l){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const b of l.valueSpec.expression.parameters)h.delete(b);if(0===h.size)return[];const y=[];return g instanceof d.F&&h.has(g.name)?[new d.V(l.key,l.value,`["${g.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(g.eachChild(b=>{y.push(...hl(b,l))}),y)}function qo(g){const l=g.key,h=g.value,y=g.valueSpec,b=[];return Array.isArray(y.values)?-1===y.values.indexOf(d.u(h))&&b.push(new d.V(l,h,`expected one of [${y.values.join(", ")}], ${JSON.stringify(h)} found`)):-1===Object.keys(y.values).indexOf(d.u(h))&&b.push(new d.V(l,h,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(h)} found`)),b}function Ku(g){return d.H(d.x(g.value))?ba(d.q({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):Kc(g)}function Kc(g){const l=g.value,h=g.key;if("array"!==d.o(l))return[new d.V(h,l,`array expected, ${d.o(l)} found`)];const y=g.styleSpec;let b,w=[];if(l.length<1)return[new d.V(h,l,"filter array must have at least 1 element")];switch(w=w.concat(qo({key:`${h}[0]`,value:l[0],valueSpec:y.filter_operator,style:g.style,styleSpec:g.styleSpec})),d.u(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&"$type"===d.u(l[1])&&w.push(new d.V(h,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":3!==l.length&&w.push(new d.V(h,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(b=d.o(l[1]),"string"!==b&&w.push(new d.V(`${h}[1]`,l[1],`string expected, ${b} found`)));for(let E=2;E<l.length;E++)b=d.o(l[E]),"$type"===d.u(l[1])?w=w.concat(qo({key:`${h}[${E}]`,value:l[E],valueSpec:y.geometry_type,style:g.style,styleSpec:g.styleSpec})):"string"!==b&&"number"!==b&&"boolean"!==b&&w.push(new d.V(`${h}[${E}]`,l[E],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let E=1;E<l.length;E++)w=w.concat(Kc({key:`${h}[${E}]`,value:l[E],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":b=d.o(l[1]),2!==l.length?w.push(new d.V(h,l,`filter array for "${l[0]}" operator must have 2 elements`)):"string"!==b&&w.push(new d.V(`${h}[1]`,l[1],`string expected, ${b} found`))}return w}function Ju(g,l){const h=g.key,y=g.style,b=g.layer,w=g.styleSpec,E=g.value,M=g.objectKey,O=w[`${l}_${g.layerType}`];if(!O)return[];const R=M.match(/^(.*)-transition$/);if("paint"===l&&R&&O[R[1]]&&O[R[1]].transition)return br({key:h,value:E,valueSpec:w.transition,style:y,styleSpec:w});const k=g.valueSpec||O[M];if(!k)return[new d.n(h,E,`unknown property "${M}"`)];let B;if("string"===d.o(E)&&d.r(k)&&!k.tokens&&(B=/^{([^}]+)}$/.exec(E))){const j=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new d.V(h,E,`"${M}" does not support interpolation syntax\nUse an identity property function instead: ${j}.`)]}const U=[];if("symbol"===g.layerType)"text-field"!==M||!y||y.glyphs||y.imports||U.push(new d.V(h,E,'use of "text-field" requires a style "glyphs" property')),"text-font"===M&&d.J(d.x(E))&&"identity"===d.u(E.type)&&U.push(new d.V(h,E,'"text-font" does not support identity functions'));else if("model"===g.layerType&&"paint"===l&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&d.r(k)&&(d.K(k)||d.t(k))){const j=d.y(d.x(E),k),Z=j.value.expression||j.value._styleExpression.expression;Z&&!d.B(Z,["measure-light"])&&("model-emissive-strength"===M&&d.D(Z)&&d.A(Z)||U.push(new d.V(h,E,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(br({key:g.key,value:E,valueSpec:k,style:y,styleSpec:w,expressionContext:"property",propertyType:l,propertyKey:M}))}function fl(g){return Ju(g,"paint")}function gs(g){return Ju(g,"layout")}function Qu(g){let l=[];const h=g.value,y=g.key,b=g.style,w=g.styleSpec;h.type||h.ref||l.push(new d.V(y,h,'either "type" or "ref" is required'));let E=d.u(h.type);const M=d.u(h.ref);if(h.id){const O=d.u(h.id);for(let R=0;R<g.arrayIndex;R++){const k=b.layers[R];d.u(k.id)===O&&l.push(new d.V(y,h.id,`duplicate layer id "${h.id}", previously used at line ${k.id.__line__}`))}}if("ref"in h){let O;["type","source","source-layer","filter","layout"].forEach(R=>{R in h&&l.push(new d.V(y,h[R],`"${R}" is prohibited for ref layers`))}),b.layers.forEach(R=>{d.u(R.id)===M&&(O=R)}),O?O.ref?l.push(new d.V(y,h.ref,"ref cannot reference another ref layer")):E=d.u(O.type):"string"==typeof M&&l.push(new d.V(y,h.ref,`ref layer "${M}" not found`))}else if("background"!==E&&"sky"!==E&&"slot"!==E)if(h.source){const O=b.sources&&b.sources[h.source],R=O&&d.u(O.type);O?"vector"===R&&"raster"===E?l.push(new d.V(y,h.source,`layer "${h.id}" requires a raster source`)):"raster"===R&&"raster"!==E?l.push(new d.V(y,h.source,`layer "${h.id}" requires a vector source`)):"vector"!==R||h["source-layer"]?"raster-dem"===R&&"hillshade"!==E?l.push(new d.V(y,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==R||["raster","raster-particle"].includes(E)?"line"!==E||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||"geojson"===R&&O.lineMetrics?"raster-particle"===E&&"raster-array"!==R&&l.push(new d.V(y,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):l.push(new d.V(y,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new d.V(y,h.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new d.V(y,h,`layer "${h.id}" must specify a "source-layer"`)):l.push(new d.V(y,h.source,`source "${h.source}" not found`))}else l.push(new d.V(y,h,'missing required property "source"'));return l=l.concat(Ho({key:y,value:h,valueSpec:w.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>br({key:`${y}.type`,value:h.type,valueSpec:w.layer.type,style:g.style,styleSpec:g.styleSpec,object:h,objectKey:"type"}),filter:O=>Ku(d.q({layerType:E},O)),layout:O=>Ho({layer:h,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":R=>gs(d.q({layerType:E},R))}}),paint:O=>Ho({layer:h,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":R=>fl(d.q({layerType:E,layer:h},R))}})}})),l}function pl(g){const l=g.value,h=g.key,y=d.o(l);return"string"!==y?[new d.V(h,l,`string expected, ${y} found`)]:[]}const Fi={promoteId:function({key:g,value:l}){if("string"===d.o(l))return pl({key:g,value:l});{const h=[];for(const y in l)h.push(...pl({key:`${g}.${y}`,value:l[y]}));return h}}};function Rs(g){const l=g.value,h=g.key,y=g.styleSpec,b=g.style;if(!l.type)return[new d.V(h,l,'"type" is required')];const w=d.u(l.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(l.url||l.tiles||E.push(new d.n(h,l,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Ho({key:h,value:l,valueSpec:y[`source_${w.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:Fi})),E;case"geojson":if(E=Ho({key:h,value:l,valueSpec:y.source_geojson,style:b,styleSpec:y,objectElementValidators:Fi}),l.cluster)for(const M in l.clusterProperties){const[O,R]=l.clusterProperties[M],k="string"==typeof O?[O,["accumulated"],["get",M]]:O;E.push(...ba({key:`${h}.${M}.map`,value:R,expressionContext:"cluster-map"})),E.push(...ba({key:`${h}.${M}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return E;case"video":return Ho({key:h,value:l,valueSpec:y.source_video,style:b,styleSpec:y});case"image":return Ho({key:h,value:l,valueSpec:y.source_image,style:b,styleSpec:y});case"canvas":return[new d.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qo({key:`${h}.type`,value:l.type,valueSpec:{values:km(y)},style:b,styleSpec:y})}}function km(g){return g.source.reduce((l,h)=>{const y=g[h];return"enum"===y.type.type&&(l=l.concat(Object.keys(y.type.values))),l},[])}function ra(g){const l=g.value,h=g.styleSpec,y=h.light,b=g.style;let w=[];const E=d.o(l);if(void 0===l)return w;if("object"!==E)return w=w.concat([new d.V("light",l,`object expected, ${E} found`)]),w;for(const M in l){const O=M.match(/^(.*)-transition$/);w=w.concat(O&&y[O[1]]&&y[O[1]].transition?br({key:M,value:l[M],valueSpec:h.transition,style:b,styleSpec:h}):y[M]?br({key:M,value:l[M],valueSpec:y[M],style:b,styleSpec:h}):[new d.V(M,l[M],`unknown property "${M}"`)])}return w}function eo(g){const l=g.value;let h=[];if(!l)return h;const y=d.o(l);if("object"!==y)return h=h.concat([new d.V("light-3d",l,`object expected, ${y} found`)]),h;const b=g.styleSpec,w=b["light-3d"],E=g.key,M=g.style,O=g.style.lights;for(const B of["type","id"])if(!(B in l))return h=h.concat([new d.V("light-3d",l,`missing property ${B} on light`)]),h;if(l.type&&O)for(let B=0;B<g.arrayIndex;B++){const U=d.u(l.type),j=O[B];d.u(j.type)===U&&h.push(new d.V(E,l.id,`duplicate light type "${l.type}", previously defined at line ${j.id.__line__}`))}const R=`properties_light_${l.type}`;if(!(R in b))return h=h.concat([new d.V("light-3d",l,`Invalid light type ${l.type}`)]),h;const k=b[R];for(const B in l)if("properties"===B){const U=l[B],j=d.o(U);if("object"!==j)return h=h.concat([new d.V("properties",U,`object expected, ${j} found`)]),h;for(const Z in U)h=h.concat(k[Z]?br({key:Z,value:U[Z],valueSpec:k[Z],style:M,styleSpec:b}):[new d.n(g.key,U[Z],`unknown property "${Z}"`)])}else{const U=B.match(/^(.*)-transition$/);h=h.concat(U&&w[U[1]]&&w[U[1]].transition?br({key:B,value:l[B],valueSpec:b.transition,style:M,styleSpec:b}):w[B]?br({key:B,value:l[B],valueSpec:w[B],style:M,styleSpec:b}):[new d.n(B,l[B],`unknown property "${B}"`)])}return h}function Ci(g){const l=g.value,h=g.key,y=g.style,b=g.styleSpec,w=b.terrain;let E=[];const M=d.o(l);if(void 0===l||"null"===M)return E;if("object"!==M)return E=E.concat([new d.V("terrain",l,`object expected, ${M} found`)]),E;for(const O in l){const R=O.match(/^(.*)-transition$/);E=E.concat(R&&w[R[1]]&&w[R[1]].transition?br({key:O,value:l[O],valueSpec:b.transition,style:y,styleSpec:b}):w[O]?br({key:O,value:l[O],valueSpec:w[O],style:y,styleSpec:b}):[new d.n(O,l[O],`unknown property "${O}"`)])}if(l.source){const O=y.sources&&y.sources[l.source],R=O&&d.u(O.type);O?"raster-dem"!==R&&E.push(new d.V(h,l.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):E.push(new d.V(h,l.source,`source "${l.source}" not found`))}else E.push(new d.V(h,l,'terrain is missing required property "source"'));return E}function Zl(g){const l=g.value,h=g.style,y=g.styleSpec,b=y.fog;let w=[];const E=d.o(l);if(void 0===l)return w;if("object"!==E)return w=w.concat([new d.V("fog",l,`object expected, ${E} found`)]),w;for(const M in l){const O=M.match(/^(.*)-transition$/);w=w.concat(O&&b[O[1]]&&b[O[1]].transition?br({key:M,value:l[M],valueSpec:y.transition,style:h,styleSpec:y}):b[M]?br({key:M,value:l[M],valueSpec:b[M],style:h,styleSpec:y}):[new d.n(M,l[M],`unknown property "${M}"`)])}return w}const lo={"*":()=>[],array:pn,boolean:function(g){const l=g.value,h=g.key,y=d.o(l);return"boolean"!==y?[new d.V(h,l,`boolean expected, ${y} found`)]:[]},number:Xu,color:function(g){const l=g.key,h=g.value,y=d.o(h);return"string"!==y?[new d.V(l,h,`color expected, ${y} found`)]:null===d.G(h)?[new d.V(l,h,`color expected, "${h}" found`)]:[]},enum:qo,filter:Ku,function:Qr,layer:Qu,object:Ho,source:Rs,model:d.L,light:ra,"light-3d":eo,terrain:Ci,fog:Zl,string:pl,formatted:function(g){return 0===pl(g).length?[]:ba(g)},resolvedImage:function(g){return 0===pl(g).length?[]:ba(g)},projection:function(g){const l=g.value,h=g.styleSpec,y=h.projection,b=g.style;let w=[];const E=d.o(l);if("object"===E)for(const M in l)w=w.concat(br({key:M,value:l[M],valueSpec:y[M],style:b,styleSpec:h}));else"string"!==E&&(w=w.concat([new d.V("projection",l,`object or string expected, ${E} found`)]));return w},import:function(g){const{value:l,styleSpec:h}=g,{data:y,...b}=l;Object.defineProperty(b,"__line__",{value:l.__line__,enumerable:!1});let w=Ho(d.q({},g,{value:b,valueSpec:h.import}));return""===d.u(b.id)&&w.push(new d.V(`${g.key}.id`,b,"import id can't be an empty string")),y&&(w=w.concat(ve(y,h,{key:`${g.key}.data`}))),w}};function br(g,l=!1){const h=g.value,y=g.valueSpec,b=g.styleSpec;if(y.expression&&d.J(d.u(h)))return Qr(g);if(y.expression&&d.v(d.x(h)))return ba(g);if(y.type&&lo[y.type]){const w=lo[y.type](g);return!0===l&&w.length>0&&"array"===d.o(g.value)?ba(g):w}return Ho(d.q({},g,{valueSpec:y.type?b[y.type]:y}))}function ir(g){const l=g.value,h=g.key,y=pl(g);return y.length||(-1===l.indexOf("{fontstack}")&&y.push(new d.V(h,l,'"glyphs" url must include a "{fontstack}" token')),-1===l.indexOf("{range}")&&y.push(new d.V(h,l,'"glyphs" url must include a "{range}" token'))),y}function ve(g,l=d.N,h={}){return br({key:h.key||"",value:g,valueSpec:l.$root,styleSpec:l,style:g,objectElementValidators:{glyphs:ir,"*":()=>[]}})}function H(g,l=d.N){return Je(ve(g,l))}const q=g=>Je(Rs(g)),le=g=>Je(ra(g)),be=g=>Je(eo(g)),me=g=>Je(Ci(g)),Ie=g=>Je(Zl(g)),Ue=g=>Je(Qu(g)),Me=g=>Je(Ku(g)),Ve=g=>Je(fl(g)),rt=g=>Je(gs(g)),ot=g=>Je(d.L(g));function Je(g){return g.slice().sort((l,h)=>l.line&&h.line?l.line-h.line:0)}function Wt(g,l){let h=!1;if(l&&l.length)for(const y of l)y instanceof d.n?d.w(y.message):(g.fire(new d.f(new Error(y.message))),h=!0);return h}let an;class Wn extends d.E{constructor(l,h="flat"){super(),this._transitionable=new d.O(an||(an=new d.U({anchor:new d.W(d.N.light.anchor),position:new d.X(d.N.light.position),color:new d.W(d.N.light.color),intensity:new d.W(d.N.light.intensity)}))),this.setLight(l,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,h,y={}){this._validate(le,l,y)||(this._transitionable.setTransitionOrValue(l),this.id=h)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||!1!==y.validate)&&Wt(this,l.call(H,d.Q({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.N})))}}const Tn=new d.U({source:new d.W(d.N.terrain.source),exaggeration:new d.W(d.N.terrain.exaggeration)});let Gn=class extends d.E{constructor(g,l,h,y){super(),this.scope=h,this._transitionable=new d.O(Tn,h,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new d.Y(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return null!=g&&null!=g.value&&null!=g.value.expression&&g.value.expression instanceof d.Z}};const zt=45,Gi=65,Qn=.05;function Hn(g,l,h,y){const b=d.a0(zt,Gi,h),[w,E]=ei(g,y);let M=1-Math.min(1,Math.exp((l-w)/(E-w)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*b*g.alpha}function ei(g,l){const h=.5/Math.tan(.5*l);return[g.range[0]+h,g.range[1]+h]}function xr(g,l,h,y,b){const w=d.$.transformMat4([],[l,h,y],b.mercatorFogMatrix);return Hn(g,d.$.length(w),b.pitch,b._fov)}function Ur(g,l,h,y,b,w,E){const M=[[h,y,0],[b,y,0],[b,w,0],[h,w,0]];let O=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const k of M){const B=d.$.transformMat4([],k,l),U=d.$.length(B);O=Math.min(O,U),R=Math.max(R,U)}return[Hn(g,O,E.pitch,E._fov),Hn(g,R,E.pitch,E._fov)]}const co=new d.U({range:new d.W(d.N.fog.range),color:new d.W(d.N.fog.color),"high-color":new d.W(d.N.fog["high-color"]),"space-color":new d.W(d.N.fog["space-color"]),"horizon-blend":new d.W(d.N.fog["horizon-blend"]),"star-intensity":new d.W(d.N.fog["star-intensity"]),"vertical-range":new d.W(d.N.fog["vertical-range"])});class Wo extends d.E{constructor(l,h,y,b){super(),this._transitionable=new d.O(co,y,new Map(b)),this.set(l,b),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new d.a1(co),this.scope=y}get state(){const l=this._transform,h="globe"===l.projection.name,y=d.a2(l.zoom),b=this.properties.get("range"),w=[.5,3];return{range:h?[d.a3(w[0],b[0],y),d.a3(w[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,h,y={}){if(this._validate(Ie,l,y))return;const b=d.Q({},l);for(const w of Object.keys(d.N.fog))void 0===b[w]&&(b[w]=d.N.fog[w].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.a0(zt,Gi,l))*h.a}getOpacityAtLatLng(l,h){return this._transform.projection.supportsFog?function(y,b,w){const E=d._.fromLngLat(b),M=w.elevation?w.elevation.getAtPointOrZero(E):0;return xr(y,E.x,E.y,M,w)}(this.state,l,h):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Ur(this.state,h,0,0,d.a4,d.a4,this._transform)}getOpacityForBounds(l,h,y,b,w){return this._transform.projection.supportsFog?Ur(this.state,l,h,y,b,w,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?ei(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const y of h){const b=l.points[y];let w;if(b[2]>=0)w=b;else{const E=l.points[y-4];w=d.a5(E,b,E[2]/(E[2]-b[2]))}if(xr(this.state,w[0],w[1],0,this._transform)>=Qn)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||!1!==y.validate)&&Wt(this,l.call(H,d.Q({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.N})))}}class Jc extends d.E{constructor(l,h,y,b){super(),this.scope=y,this._options=l,this.properties=new d.a1(h),this._transitionable=new d.O(h,y,new Map(b)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,h){this._options=l,this._transitionable.setTransitionOrValue(l.properties,h)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}let Ch,Th;var Eh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",In="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",qf="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Qc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",sy="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",Fm="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Lm="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",ay="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",ly="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Bm="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",zm="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Dh=[];ed(Eh,Dh),ed(qf,Dh),ed(In,Dh);const Wf={"_prelude_fog.vertex.glsl":Fm,"_prelude_terrain.vertex.glsl":sy,"_prelude_shadow.vertex.glsl":Bm,"_prelude_fog.fragment.glsl":Lm,"_prelude_shadow.fragment.glsl":zm,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":ay,"_prelude_raster_particle.glsl":ly},Zf={};Un("",sy),Un(Lm,Fm),Un(zm,Bm),Un(ay,""),Un(ly,"");const Yf=Un(In,qf),cy=Eh;var _1={background:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Un("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Un("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Un("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Un("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Un("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Un('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Un("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Un("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Un("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Un("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Un('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Un('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;\n#endif\n}'),symbolSDF:Un('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Un('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Un("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Un('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Qc),skyboxGradient:Un('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Qc),skyboxCapture:Un("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Un('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Un('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Un("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Un("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),occlusion:Un("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function ed(g,l){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let y of h)if(y=y.trim(),"#"===y[0]&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const w of b)l.includes(w)||l.push(w)}}function Un(g,l){const h=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(R=>{const k=R.split(" ");return k[k.length-1]}),b=[...new Set(b)]);const w={},E=[],M=[];if(g=g.replace(h,(R,k)=>(M.push(k),"")),(l=l.replace(h,(R,k)=>(E.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...Dh];ed(g,O),ed(l,O);for(const R of[...E,...M])Wf[R]||console.error(`Undefined include: ${R}`),Zf[R]||(Zf[R]=[],ed(Wf[R],Zf[R])),O=[...O,...Zf[R]];return{fragmentSource:g=g.replace(y,(R,k,B,U,j)=>(w[j]=!0,"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nin ${B} ${U} ${j};\n#else\nuniform ${B} ${U} u_${j};\n#endif\n`:"initialize"===k?`\n#ifdef HAS_UNIFORM_u_${j}\n    ${B} ${U} ${j} = u_${j};\n#endif\n`:"define-attribute"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\n    in ${B} ${U} ${j};\n#endif\n`:"initialize-attribute"===k?"":void 0)),vertexSource:l=l.replace(y,(R,k,B,U,j)=>{const Z="float"===U?"vec2":U,Y=j.match(/color/)?"color":Z;return"define-attribute-vertex-shader-only"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\nin ${B} ${U} a_${j};\n#endif\n`:w[j]?"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nin ${B} ${Z} a_${j};\nout ${B} ${U} ${j};\n#else\nuniform ${B} ${U} u_${j};\n#endif\n`:"initialize"===k?"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = a_${j};\n#else\n    ${B} ${U} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = unpack_mix_${Y}(a_${j}, u_${j}_t);\n#else\n    ${B} ${U} ${j} = u_${j};\n#endif\n`:"define-attribute"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\n    in ${B} ${U} a_${j};\n    out ${B} ${U} ${j};\n#endif\n`:"initialize-attribute"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\n    ${j} = a_${j};\n#endif\n`:void 0:"define"===k?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nin ${B} ${Z} a_${j};\n#else\nuniform ${B} ${U} u_${j};\n#endif\n`:"define-instanced"===k?"mat4"===Y?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${j}0;\nin vec4 a_${j}1;\nin vec4 a_${j}2;\nin vec4 a_${j}3;\n#else\nuniform ${B} ${U} u_${j};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${B} ${Z} a_${j};\n#else\nuniform ${B} ${U} u_${j};\n#endif\n`:"initialize-attribute-custom"===k?`\n#ifdef HAS_ATTRIBUTE_a_${j}\n    ${B} ${U} ${j} = a_${j};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${B} ${U} ${j} = a_${j};\n#else\n    ${B} ${U} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${B} ${U} ${j} = unpack_mix_${Y}(a_${j}, u_${j}_t);\n#else\n    ${B} ${U} ${j} = u_${j};\n#endif\n`}),staticAttributes:b,usedDefines:O,vertexIncludes:E,fragmentIncludes:M}}class y1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,h,y,b,w,E,M,O){this.context=l;let R=this.boundPaintVertexBuffers.length!==b.length;for(let B=0;!R&&B<b.length;B++)this.boundPaintVertexBuffers[B]!==b[B]&&(R=!0);let k=this.boundDynamicVertexBuffers.length!==M.length;for(let B=0;!k&&B<M.length;B++)this.boundDynamicVertexBuffers[B]!==M[B]&&(k=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||R||k||this.boundIndexBuffer!==w||this.boundVertexOffset!==E)this.freshBind(h,y,b,w,E,M,O);else{l.bindVertexArrayOES.set(this.vao);for(const B of M)B&&(B.bind(),O&&B.instanceCount&&B.setVertexAttribDivisor(l.gl,h,O));w&&w.dynamicDraw&&w.bind()}}freshBind(l,h,y,b,w,E,M){const O=l.numAttributes,R=this.context,k=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=E,h.enableAttributes(k,l),h.bind(),h.setVertexAttribPointers(k,l,w);for(const B of y)B.enableAttributes(k,l),B.bind(),B.setVertexAttribPointers(k,l,w);for(const B of E)B&&(B.enableAttributes(k,l),B.bind(),B.setVertexAttribPointers(k,l,w),M&&B.instanceCount&&B.setVertexAttribDivisor(k,l,M));b&&b.bind(),R.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function uy(g,l){const h=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new d._(0,y/h).toLngLat().lat,new d._(0,(y+1)/h).toLngLat().lat]}function dy(g,l,h,y,b,w,E){const M=g.context,O=M.gl,R=h.hillshadeFBO;if(!R)return;g.prepareDrawTile();const k=g.isTileAffectedByFog(l),B=g.getOrCreateProgram("hillshade",{overrideFog:k});M.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,R.colorAttachment.get());const U=((X,W,K,te)=>{const se=K.paint.get("hillshade-shadow-color"),he=K.paint.get("hillshade-highlight-color"),ce=K.paint.get("hillshade-accent-color"),ue=K.paint.get("hillshade-emissive-strength");let ye=d.ac(K.paint.get("hillshade-illumination-direction"));if("viewport"===K.paint.get("hillshade-illumination-anchor"))ye-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){const Se=X.style.directionalLight.properties.get("direction"),xe=d.ad(Se.x,Se.y,Se.z);ye=d.ac(xe[1])}const pe=!X.options.moving;return{u_matrix:te||X.transform.calculateProjMatrix(W.tileID.toUnwrapped(),pe),u_image:0,u_latrange:uy(0,W.tileID),u_light:[K.paint.get("hillshade-exaggeration"),ye],u_shadow:se.toRenderColor(K.lut),u_highlight:he.toRenderColor(K.lut),u_emissive_strength:ue,u_accent:ce.toRenderColor(K.lut)}})(g,h,y,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(M,B,l.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:Y}=g.getTileBoundsBuffers(h);B.draw(g,O.TRIANGLES,b,w,E,d.ag.disabled,U,y.id,j,Z,Y)}function Vm(g,l,h){if(!l.needsDEMTextureUpload)return;const y=g.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(h.stride);const w=h.getPixels();l.demTexture?l.demTexture.update(w,{premultiply:!1}):l.demTexture=new d.T(y,w,b.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function v1(g,l,h){const y=g.context,b=y.gl;if(!l.dem)return;const w=l.dem;if(y.activeTexture.set(b.TEXTURE1),Vm(g,l,w),!l.demTexture)return;l.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const E=w.dim;y.activeTexture.set(b.TEXTURE0);let M=l.hillshadeFBO;if(!M){const U=new d.T(y,{width:E,height:E,data:null},b.RGBA);U.bind(b.LINEAR,b.CLAMP_TO_EDGE),M=l.hillshadeFBO=y.createFramebuffer(E,E,!0,"renderbuffer"),M.colorAttachment.set(U.texture)}y.bindFramebuffer.set(M.framebuffer),y.viewport.set([0,0,E,E]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:R,tileBoundsSegments:k}=g.getMercatorTileBoundsBuffers(),B=[];g.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(g,b.TRIANGLES,d.af.disabled,d.ah.disabled,d.a.unblended,d.ag.disabled,((U,j)=>{const Z=j.stride,Y=d.ae.create();return d.ae.ortho(Y,0,d.a4,-d.a4,0,0,1),d.ae.translate(Y,Y,[0,-d.a4,0]),{u_matrix:Y,u_image:1,u_dimension:[Z,Z],u_zoom:U.overscaledZ}})(l.tileID,w),h.id,O,R,k),l.needsHillshadePrepare=!1}function Um(g,l,h,y,b){const w=function(M,O){if(M)return b(M);if(O){if(g.url&&O.tiles&&g.tiles&&delete g.tiles,O.variants){if(!Array.isArray(O.variants))return b(new Error("variants must be an array"));for(const k of O.variants){if(null==k||"object"!=typeof k||k.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return b(new Error("capabilities must be an array"));if(1===k.capabilities.length&&"meshopt"===k.capabilities[0]){O=d.Q(O,k);break}}}const R=d.ai(d.Q(O,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);O.vector_layers&&(R.vectorLayers=O.vector_layers,R.vectorLayerIds=R.vectorLayers.map(k=>k.id)),O.raster_layers&&(R.rasterLayers=O.raster_layers,R.rasterLayerIds=R.rasterLayers.map(k=>k.id)),R.tiles=l.canonicalizeTileset(R,g.url),b(null,R)}},E=function(M,O,R){if(!M)return null;if(!O&&!R)return M;R=R||M.worldview_default;const k=Object.values(M.language||{});if(0===k.length)return null;const B=Object.values(M.worldview||{});if(0===B.length)return null;const U=k.every(Z=>Z===O),j=B.every(Z=>Z===R);return U&&j?M:O in(M.language_options||{})||R in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(g.data,h,y);return E?d.e.frame(()=>w(null,E)):g.url?d.h(l.transformRequest(l.normalizeSourceURL(g.url,null,h,y),d.R.Source),w):d.e.frame(()=>{const{data:M,...O}=g;w(null,O)})}class Sh{constructor(l,h,y){this.bounds=d.aj.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),y=Math.floor(d.ak(this.bounds.getWest())*h),b=Math.floor(d.al(this.bounds.getNorth())*h),w=Math.ceil(d.ak(this.bounds.getEast())*h),E=Math.ceil(d.al(this.bounds.getSouth())*h);return l.x>=y&&l.x<w&&l.y>=b&&l.y<E}}class Ns extends d.E{constructor(l,h,y,b){super(),this.id=l,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.Q({type:"raster"},h),d.Q(this,d.ai(h,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new d.g("dataloading",{dataType:"source"})),this._tileJSONRequest=Um(this._options,this.map._requestManager,null,null,(h,y)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new d.f(h)):y&&(d.Q(this,y),y.bounds&&(this.tileBounds=new Sh(y.bounds,this.minzoom,this.maxzoom)),d.ao(y.tiles),this.fire(new d.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(h)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=d.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return d.Q({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,h){const y=d.e.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);l.request=d.i(this.map._requestManager.transformRequest(b,d.R.Tile),(w,E,M,O)=>(delete l.request,l.aborted?(l.state="unloaded",h(null)):w?(l.state="errored",h(w)):E?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:M,expires:O}),l.setTexture(E,this.map.painter),l.state="loaded",d.an(this.dispatcher),void h(null)):h(null)))}abortTile(l,h){l.request&&(l.request.cancel(),delete l.request),h&&h()}unloadTile(l,h){l.texture&&l.texture instanceof d.T?(l.destroy(!0),l.texture&&l.texture instanceof d.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class hy extends d.E{constructor(l,h,y,b){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.Q(this,d.ai(h,["url","scheme","tileSize","promoteId"])),this._options=d.Q({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new d.ap}load(l){this._loaded=!1,this.fire(new d.g("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=Um(this._options,this.map._requestManager,h,y,(b,w)=>{this._tileJSONRequest=null,this._loaded=!0,b?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),y&&2!==y.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new d.f(b))):w&&(d.Q(this,w),w.bounds&&(this.tileBounds=new Sh(w.bounds,this.minzoom,this.maxzoom)),d.ao(w.tiles,this.map._requestManager._customAccessToken),this.fire(new d.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(b)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=d.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return d.Q({},this._options)}loadTile(l,h){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),b=this.map._requestManager.transformRequest(y,d.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,E={request:b,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,lut:w?{image:w.image.clone()}:null,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:d.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(E.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=h:l.request=l.actor.send("reloadTile",E,M.bind(this));else if(l.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",E,M.bind(this),void 0,!0);else{const O=d.aq.call({deduped:this._deduped},E,(R,k)=>{R||!k?M.call(this,R):(E.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},l.actor&&l.actor.send("loadTile",E,M.bind(this),void 0,!0))},!0);l.request={cancel:O}}function M(O,R){return delete l.request,l.aborted?h(null):O&&404!==O.status?h(O):(R&&R.resourceTiming&&(l.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&l.setExpiryData(R),l.loadVectorData(R,this.map.painter),d.an(this.dispatcher),h(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,h){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const b1=(g,l,h)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:h}),jm=(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:h,u_zoom_transition:b,u_merc_center:w,u_image0:0,u_frustum_tl:E,u_frustum_tr:M,u_frustum_br:O,u_frustum_bl:R,u_globe_pos:k,u_globe_radius:B,u_viewport:U,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:Z});class Xf{constructor(l=0,h=0,y=0,b=0){if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=y,this.right=b}interpolate(l,h,y){return null!=h.top&&null!=l.top&&(this.top=d.a3(l.top,h.top,y)),null!=h.bottom&&null!=l.bottom&&(this.bottom=d.a3(l.bottom,h.bottom,y)),null!=h.left&&null!=l.left&&(this.left=d.a3(l.left,h.left,y)),null!=h.right&&null!=l.right&&(this.right=d.a3(l.right,h.right,y)),this}getCenter(l,h){const y=d.au((this.left+l-this.right)/2,0,l),b=d.au((this.top+h-this.bottom)/2,0,h);return new d.P(y,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Xf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function eu(g,l){const h=d.ax(g,3);d.ae.fromQuat(g,l),d.aA(g,3,h)}function _t(g,l){const h=d.aw.identity([]);return d.aw.rotateZ(h,h,-l),d.aw.rotateX(h,h,-g),h}function tu(g,l){const h=[g[0],g[1],0],y=[l[0],l[1],0];if(d.$.length(h)>=1e-15){const E=d.$.normalize([],h);d.$.scale(y,E,d.$.dot(y,E)),l[0]=y[0],l[1]=y[1]}const b=d.$.cross([],l,g);if(d.$.len(b)<1e-15)return null;const w=Math.atan2(-b[1],b[0]);return _t(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),w)}class Mh{constructor(l,h){this.position=l,this.orientation=h}get position(){return this._position}set position(l){if(l){const h=l instanceof d._?l:new d._(l[0],l[1],l[2]);this._renderWorldCopies&&(h.x=d.av(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(l,h){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(d._.fromLngLat(l)):0,w=d._.fromLngLat(l,b),E=[w.x-y.x,w.y-y.y,w.z-y.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=tu(E,h)}setPitchBearing(l,h){this.orientation=_t(d.ac(l),d.ac(-h))}}class nu{constructor(l,h){this._transform=d.ae.identity([]),this.orientation=h,this.position=l}get mercatorPosition(){const l=this.position;return new d._(l[0],l[1],l[2])}get position(){const l=d.ax(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var h;l&&d.aA(this._transform,3,[(h=l)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||d.aw.identity([]),l&&eu(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,h){this._orientation=_t(l,h),eu(this._transform,this._orientation)}forward(){const l=d.ax(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=d.ax(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=d.ax(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,h){const y=new Float64Array(16);return d.ae.invert(y,this.getWorldToCamera(l,h)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,h,y){const b=this.position;d.$.scale(b,b,-l);const w=new Float64Array(16);return d.ae.fromScaling(w,[y,y,y]),d.ae.translate(w,w,b),w[10]*=h,w}getWorldToCamera(l,h){const y=new Float64Array(16),b=new Float64Array(4),w=this.position;return d.aw.conjugate(b,this._orientation),d.$.scale(w,w,-l),d.ae.fromQuat(y,b),d.ae.translate(y,y,w),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=h,y[9]*=h,y[10]*=h,y[11]*=h,y}getCameraToClipPerspective(l,h,y,b){const w=new Float64Array(16);return d.ae.perspective(w,l,h,y,b),w}getCameraToClipOrthographic(l,h,y,b,w,E){const M=new Float64Array(16);return d.ae.ortho(M,l,h,y,b,w,E),M}getDistanceToElevation(l,h=!1){const y=0===l?0:d.ay(l,h?d.az(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new nu([...this.position],[...this.orientation])}}const Fn={unknown:0,flipRequired:1,flipNotRequired:2},So=Math.tan(85*Math.PI/180);function td(g,l,h,y,b,w,E){const M=d.ae.create();if(h)if("globe"===w.name){const O=d.aC(b,l);d.ae.multiply(M,M,O)}else{const O=d.aD.invert([],E);M[0]=O[0],M[1]=O[1],M[4]=O[2],M[5]=O[3],y||d.ae.rotateZ(M,M,b.angle)}else d.ae.multiply(M,b.labelPlaneMatrix,g);return M}function Kf(g,l,h,y,b,w,E){const M=td(g,l,h,y,b,w,E);return"globe"===w.name&&h||(M[2]=M[6]=M[10]=M[14]=0),M}function Jf(g,l,h,y,b,w,E){if(h){if("globe"===w.name){const M=td(g,l,h,y,b,w,E);return d.ae.invert(M,M),d.ae.multiply(M,g,M),M}{const M=d.ae.clone(g),O=d.ae.identity([]);return O[0]=E[0],O[1]=E[1],O[4]=E[2],O[5]=E[3],d.ae.multiply(M,M,O),y||d.ae.rotateZ(M,M,-b.angle),M}}return b.glCoordMatrix}function xa(g,l,h,y){const b=[g,l,h,1];h?d.aB.transformMat4(b,b,y):tp(b,b,y);const w=b[3];return b[0]/=w,b[1]/=w,b[2]/=w,b}function Sn(g,l){return Math.min(.5+g/l*.5,1.5)}function Qf(g,l){const h=g[0]/g[3],y=g[1]/g[3];return h>=-l[0]&&h<=l[0]&&y>=-l[1]&&y<=l[1]}function Yl(g,l,h,y,b,w,E,M,O,R){const k=h.transform,B=y?g.textSizeData:g.iconSizeData,U=d.aE(B,h.transform.zoom),j="globe"===k.projection.name,Z=[256/h.width*2+1,256/h.height*2+1],Y=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Y.clear();let X=null;j&&(X=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const W=g.lineVertexArray,K=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,te=h.transform.width/h.transform.height;let se,he=!1;for(let ce=0;ce<K.length;ce++){const ue=K.get(ce),{numGlyphs:ye,writingMode:pe}=ue;if(pe!==d.aF.vertical||he||se===d.aF.horizontal||(he=!0),se=pe,(ue.hidden||pe===d.aF.vertical)&&!he){Xl(ye,Y);continue}he=!1;const Se=new d.P(ue.tileAnchorX,ue.tileAnchorY);let{x:xe,y:ae,z:Fe}=k.projection.projectTilePoint(Se.x,Se.y,R.canonical);if(O){const[bt,pt,nt]=O(Se);xe+=bt,ae+=pt,Fe+=nt}const ke=[xe,ae,Fe,1];if(d.aB.transformMat4(ke,ke,l),!Qf(ke,Z)){Xl(ye,Y);continue}const Ee=ke[3],We=Sn(h.transform.getCameraToCenterDistance(k.projection),Ee),Ye=d.aG(B,U,ue),Oe=E?Ye/We:Ye*We,ze=xa(xe,ae,Fe,b);if(ze[3]<=0){Xl(ye,Y);continue}let Te={};const Ke=E?null:O,Xe=uo(ue,Oe,!1,M,l,b,w,g.glyphOffsetArray,W,Y,X,ze,Se,Te,te,Ke,k.projection,R,E);he=Xe.useVertical,Ke&&Xe.needsFlipping&&(Te={}),(Xe.notEnoughRoom||he||Xe.needsFlipping&&uo(ue,Oe,!0,M,l,b,w,g.glyphOffsetArray,W,Y,X,ze,Se,Te,te,Ke,k.projection,R,E).notEnoughRoom)&&Xl(ye,Y)}y?(g.text.dynamicLayoutVertexBuffer.updateData(Y),X&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(X)):(g.icon.dynamicLayoutVertexBuffer.updateData(Y),X&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(X))}function ep(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y){const{lineStartIndex:X,glyphStartIndex:W,segment:K}=M,te=W+M.numGlyphs,se=X+M.lineLength,he=l.getoffsetX(W),ce=l.getoffsetX(te-1),ue=Ih(g*he,h,y,b,w,E,K,X,se,O,R,k,B,U,!0,j,Z,Y);if(!ue)return null;const ye=Ih(g*ce,h,y,b,w,E,K,X,se,O,R,k,B,U,!0,j,Z,Y);return ye?{first:ue,last:ye}:null}function nd(g,l,h,y){return g===d.aF.horizontal&&Math.abs(y)>Math.abs(h)?{useVertical:!0}:g===d.aF.vertical?y>0?{needsFlipping:!0}:null:l!==Fn.unknown&&(0===(b=h)||Math.abs(y/b)>So)?l===Fn.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var b}function uo(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X,W,K){const te=l/24,se=g.lineOffsetX*te,he=g.lineOffsetY*te,{lineStartIndex:ce,glyphStartIndex:ue,numGlyphs:ye,segment:pe,writingMode:Se,flipState:xe}=g,ae=ce+g.lineLength,Fe=ke=>{if(k){const[Oe,ze,Te]=ke.up,Ke=R.length;d.aH(k,Ke+0,Oe,ze,Te),d.aH(k,Ke+1,Oe,ze,Te),d.aH(k,Ke+2,Oe,ze,Te),d.aH(k,Ke+3,Oe,ze,Te)}const[Ee,We,Ye]=ke.point;d.aI(R,Ee,We,Ye,ke.angle)};if(ye>1){const ke=ep(te,M,se,he,h,B,U,g,O,w,j,Y,!1,X,W,K);if(!ke)return{notEnoughRoom:!0};if(y&&!h){let[Ee,We,Ye]=ke.first.point,[Oe,ze,Te]=ke.last.point;[Ee,We]=xa(Ee,We,Ye,E),[Oe,ze]=xa(Oe,ze,Te,E);const Ke=nd(Se,xe,(Oe-Ee)*Z,ze-We);if(g.flipState=Ke&&Ke.needsFlipping?Fn.flipRequired:Fn.flipNotRequired,Ke)return Ke}Fe(ke.first);for(let Ee=ue+1;Ee<ue+ye-1;Ee++){const We=Ih(te*M.getoffsetX(Ee),se,he,h,B,U,pe,ce,ae,O,w,j,Y,!1,!1,X,W,K);if(!We)return R.length-=4*(Ee-ue),{notEnoughRoom:!0};Fe(We)}Fe(ke.last)}else{if(y&&!h){const Ee=xa(U.x,U.y,0,b),We=ce+pe+1,Ye=new d.P(O.getx(We),O.gety(We)),Oe=xa(Ye.x,Ye.y,0,b),ze=Oe[3]>0?Oe:$m(U,Ye,Ee,1,b,void 0,X,W.canonical),Te=nd(Se,xe,(ze[0]-Ee[0])*Z,ze[1]-Ee[1]);if(g.flipState=Te&&Te.needsFlipping?Fn.flipRequired:Fn.flipNotRequired,Te)return Te}const ke=Ih(te*M.getoffsetX(ue),se,he,h,B,U,pe,ce,ae,O,w,j,Y,!1,!1,X,W,K);if(!ke)return{notEnoughRoom:!0};Fe(ke)}return{}}function fy(g,l,h,y,b){const{x:w,y:E,z:M}=y.projectTilePoint(g.x,g.y,l);if(!b)return xa(w,E,M,h);const[O,R,k]=b(g);return xa(w+O,E+R,M+k,h)}function $m(g,l,h,y,b,w,E,M){const O=fy(g.sub(l)._unit()._add(g),M,b,E,w);return d.$.sub(O,h,O),d.$.normalize(O,O),d.$.scaleAndAdd(O,h,O,y)}function Ih(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X,W){const K=y?g-l:g+l;let te=K>0?1:-1,se=0;y&&(te*=-1,se=Math.PI),te<0&&(se+=Math.PI);let he=M+E+(te>0?0:1)|0,ce=b,ue=b,ye=0,pe=0;const Se=Math.abs(K),xe=[],ae=[];let Fe=w,ke=Fe;const Ee=()=>$m(ke,Fe,ue,Se-ye+1,k,U,Y,X.canonical);for(;ye+pe<=Se;){if(he+=te,he<M||he>=O)return null;if(ue=ce,ke=Fe,xe.push(ue),j&&ae.push(ke),Fe=new d.P(R.getx(he),R.gety(he)),ce=B[he],!ce){const pt=fy(Fe,X.canonical,k,Y,U);ce=pt[3]>0?B[he]=pt:Ee()}ye+=pe,pe=d.$.distance(ue,ce)}Z&&U&&(B[he]&&(ce=Ee(),pe=d.$.distance(ue,ce)),B[he]=ce);const We=(Se-ye)/pe,Ye=Fe.sub(ke)._mult(We)._add(ke),Oe=d.$.sub([],ce,ue),ze=d.$.scaleAndAdd([],ue,Oe,We);let Te=[0,0,1],Ke=Oe[0],Xe=Oe[1];if(W&&(Te=Y.upVector(X.canonical,Ye.x,Ye.y),0!==Te[0]||0!==Te[1]||1!==Te[2])){const pt=[Te[2],0,-Te[0]],nt=d.$.cross([],Te,pt);d.$.normalize(pt,pt),d.$.normalize(nt,nt),Ke=d.$.dot(Oe,pt),Xe=d.$.dot(Oe,nt)}if(h){const pt=d.$.cross([],Te,Oe);d.$.normalize(pt,pt),d.$.scaleAndAdd(ze,ze,pt,h*te)}const bt=se+Math.atan2(Xe,Ke);return xe.push(ze),j&&ae.push(Ye),{point:ze,angle:bt,path:xe,tilePath:ae,up:Te}}function Xl(g,l){const h=l.length,y=h+4*g;l.resize(y),l.float32.fill(-1/0,4*h,4*y)}function tp(g,l,h){const y=l[0],b=l[1];return g[0]=h[0]*y+h[4]*b+h[12],g[1]=h[1]*y+h[5]*b+h[13],g[3]=h[3]*y+h[7]*b+h[15],g}const np=(g,l,h)=>(1-h)*g+h*l,Ah=g=>g*g*g*g*g;class ip{constructor(l,h,y,b,w,E,M){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=b??60,this.setProjection(E),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new d.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Xf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new nu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new ip(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(l,h=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||y)&&this._updateCameraOnTerrain(),(l||y)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return d.ai(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=d.aK(this.projectionOptions);const y=this.getProjection(),b=!d.d(h,y);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=d.aK({name:"mercator"});const h=l!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return d.av(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const h=-l*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=d.aD.create(),d.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const h=d.au(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=d.ac(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,w=0;for(let E=0;E<h.length;E++){const M=new d.P(h[E][0]*this.width,y+h[E][1]*(this.height-y)),O=l.pointCoordinate(M);if(!O)continue;const R=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);b+=O[3]*R,w+=R}return 0===w?NaN:b/w}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const l=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*h,b=this._mercatorZfromZoom(l),w=this._mercatorZfromZoom(this._maxZoom),E=Math.max(b-y,w);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let y;y=l.z<this._camera.position[2]?[h.x,h.y,h.z]:[l.x,l.y,l.z];const b=d.$.length(d.$.sub([],this._camera.position,y));return d.au(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let h=!1;if(l.orientation&&!d.aw.exactEquals(l.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(l.orientation)),l.position){const y=[l.position.x,l.position.y,l.position.z];d.$.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,h=new Mh;return h.position=new d._(l[0],l[1],l[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(l){if(!d.aw.length(l))return!1;d.aw.normalize(l,l);const h=d.$.transformQuat([],[0,0,-1],l),y=d.$.transformQuat([],[0,-1,0],l);if(y[2]<0)return!1;const b=tu(h,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(l){const h=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;l[2]=d.au(l[2],b/y,b/h),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,y){this._unmodified=!1,this._edgeInsets.interpolate(l,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(l){const h=[new d.aL(0,l)];if(this.renderWorldCopies){const y=this.pointCoordinate(new d.P(0,0)),b=this.pointCoordinate(new d.P(this.width,0)),w=this.pointCoordinate(new d.P(this.width,this.height)),E=this.pointCoordinate(new d.P(0,this.height)),M=Math.floor(Math.min(y.x,b.x,w.x,E.x)),O=Math.floor(Math.max(y.x,b.x,w.x,E.x)),R=1;for(let k=M-R;k<=O+R;k++)0!==k&&h.push(new d.aL(k,l))}return h}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,h,y){let b=[];const w=void 0!==y,E=!w;if(E&&this.zoom<h||w&&0===y[0]&&0===y[1])return b;const M=new Set,O=(k,B,U,j,Z)=>{const Y=d.b2(B,k,U,j,Z);M.has(Y)||(b.push(new d.aQ(k,B,U,j,Z)),M.add(Y))};for(let k=0;k<l.length;k++){const B=l[k];if(E&&B.canonical.z!==h)continue;const U=B.canonical,j=B.overscaledZ,Z=B.wrap,Y=1<<U.z,X=U.x+1<Y,W=U.x>0,K=U.y+1<Y,te=U.y>0,se=B.wrap-(W?0:1),he=B.wrap+(X?0:1),ce=W?U.x-1:Y-1,ue=X?U.x+1:0;if(w)y[0]<0?(O(j,he,U.z,ue,U.y),y[1]<0&&K&&(O(j,Z,U.z,U.x,U.y+1),O(j,he,U.z,ue,U.y+1)),y[1]>0&&te&&(O(j,Z,U.z,U.x,U.y-1),O(j,he,U.z,ue,U.y-1))):y[0]>0?(O(j,se,U.z,ce,U.y),y[1]<0&&K&&(O(j,Z,U.z,U.x,U.y+1),O(j,se,U.z,ce,U.y+1)),y[1]>0&&te&&(O(j,Z,U.z,U.x,U.y-1),O(j,se,U.z,ce,U.y-1))):y[1]<0&&K?O(j,Z,U.z,U.x,U.y+1):te&&O(j,Z,U.z,U.x,U.y-1);else{const ye=B.visibleQuadrants;1&ye&&(O(j,se,U.z,ce,U.y),te&&(O(j,Z,U.z,U.x,U.y-1),O(j,se,U.z,ce,U.y-1))),2&ye&&(O(j,he,U.z,ue,U.y),te&&(O(j,Z,U.z,U.x,U.y-1),O(j,he,U.z,ue,U.y-1))),4&ye&&(O(j,se,U.z,ce,U.y),K&&(O(j,Z,U.z,U.x,U.y+1),O(j,se,U.z,ce,U.y+1))),8&ye&&(O(j,he,U.z,ue,U.y),K&&(O(j,Z,U.z,U.x,U.y+1),O(j,he,U.z,ue,U.y+1)))}}const R=[];for(const k of b)b.some(B=>k.isChildOf(B))||R.push(k);if(b=R.filter(k=>!l.some(B=>!!(k.overscaledZ<h&&B.isChildOf(k))||k.equals(B)||k.isChildOf(B))),E){const k=1<<h,B="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[k*B.x,k*B.y],j=4,Z=j*j;b=b.filter(Y=>{const X=Y.canonical.x+.5-U[0],W=Y.canonical.y+.5-U[1];return X*X+W*W<Z})}return b}coveringTiles(l){let h=this.coveringZoomLevel(l);const y=h,b=this.elevation&&this.elevation.exaggeration(),w=b&&!l.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==l.minzoom&&h<l.minzoom)return[];void 0!==l.maxzoom&&h>l.maxzoom&&(h=l.maxzoom);const M=this.locationCoordinate(this.center),O=this.center.lat,R=1<<h,k=[R*M.x,R*M.y,0],B="globe"===this.projection.name,U=!B,j=d.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,U),Z=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=R*d.ay(1,this.center.lat),X=this._camera.position[2]/d.ay(1,this.center.lat),W=[R*Z.x,R*Z.y,X*(U?1:Y)],K=B||b,te=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),se=this.isLODDisabled(!0)?h:0;let he;if(this._elevation&&l.isTerrainDEM)he=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();he=Oe?Oe.max:this._centerAltitude}else he=this._centerAltitude;const ce=l.isTerrainDEM?-he:this._elevation?this._elevation.getMinElevationBelowMSL():0,ue=this.projection.isReprojectedInTileSpace?d.aN(this):1,ye=Oe=>{const Te=new d._(Oe.x+25e-6,Oe.y,Oe.z),Ke=new d._(Oe.x,Oe.y+25e-6,Oe.z),Xe=Oe.toLngLat(),bt=Te.toLngLat(),pt=Ke.toLngLat(),nt=this.locationCoordinate(Xe),Ct=this.locationCoordinate(bt),Gt=this.locationCoordinate(pt),rn=Math.hypot(Ct.x-nt.x,Ct.y-nt.y),en=Math.hypot(Gt.x-nt.x,Gt.y-nt.y);return Math.sqrt(rn*en)*ue/25e-6},pe=Oe=>{const ze=he,Te=ce;return{aabb:d.aR(this,R,0,0,0,Oe,Te,ze,this.projection),zoom:0,x:0,y:0,minZ:Te,maxZ:ze,wrap:Oe,fullyVisible:!1}},Se=[];let xe=[];const ae=h,Fe=l.reparseOverscaled?y:h,ke=(X-this._centerAltitude)*Y,Ee=Oe=>{if(!this._elevation||!Oe.tileID||!E)return;const ze=this._elevation.getMinMaxForTile(Oe.tileID),Te=Oe.aabb;ze?(Te.min[2]=ze.min,Te.max[2]=ze.max,Te.center[2]=(Te.min[2]+Te.max[2])/2):(Oe.shouldSplit=Ye(Oe),Oe.shouldSplit||(Te.min[2]=Te.max[2]=Te.center[2]=this._centerAltitude))},We=(Oe,ze)=>{if(.707*ze<Oe)return 1;const Te=ze/Oe;return Te/(1.4144271570014144+(Math.pow(1.1,Te-1.4144271570014144+1)-1)/(1.1-1)-1)},Ye=Oe=>{if(Oe.zoom<se)return!0;if(Oe.zoom===ae)return!1;if(null!=Oe.shouldSplit)return Oe.shouldSplit;const ze=Oe.aabb.distanceX(W),Te=Oe.aabb.distanceY(W);let Ke=ke,Xe=1;if(B){Ke=Oe.aabb.distanceZ(W);const en=Math.pow(2,Oe.zoom),mn=d.az((Oe.y+1)/en),on=d.az(Oe.y/en),xi=Math.min(Math.max(O,mn),on),An=d.b6(xi)/d.b6(O);if(Xe=xi===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,An/this._mercatorScaleRatio),this.zoom<=d.b3&&Oe.zoom===ae-1&&An>=.9)return!0}else if(w&&(Ke=Oe.aabb.distanceZ(W)*Y),this.projection.isReprojectedInTileSpace&&y<=5){const en=Math.pow(2,Oe.zoom),mn=ye(new d._((Oe.x+.5)/en,(Oe.y+.5)/en));Xe=mn>.85?1:mn}if(!E){const en=Math.sqrt(ze*ze+Te*Te+Ke*Ke);let mn=(1<<ae-Oe.zoom)*te*Xe;return mn*=We(Math.max(Ke,ke),en),en<mn}let bt=Number.MAX_VALUE,pt=0;const nt=Oe.aabb.getCorners(),Ct=[];for(const en of nt){d.$.sub(Ct,en,W),B||(w?Ct[2]*=Y:Ct[2]=ke);const mn=d.$.dot(Ct,this._camera.forward());mn<bt&&(bt=mn,pt=Math.abs(Ct[2]))}let Gt=(1<<ae-Oe.zoom)*te*Xe;if(Gt*=We(Math.max(pt,ke),bt),bt<Gt)return!0;const rn=Oe.aabb.closestPoint(k);return rn[0]===k[0]&&rn[1]===k[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Se.push(pe(-Oe)),Se.push(pe(Oe));for(Se.push(pe(0));Se.length>0;){const Oe=Se.pop(),ze=Oe.x,Te=Oe.y;let Ke=Oe.fullyVisible;const Xe=()=>"globe"===this.projection.name&&(0===Oe.y||Oe.y===(1<<Oe.zoom)-1);if(!Ke){let bt=K?Oe.aabb.intersects(j):Oe.aabb.intersectsFlat(j);if(0===bt&&Xe()){const pt=new d.aO(Oe.zoom,ze,Te);bt=d.aP(this,R,pt,!0).intersects(j)}if(0===bt)continue;Ke=2===bt}if(Oe.zoom!==ae&&Ye(Oe))for(let bt=0;bt<4;bt++){const pt=(ze<<1)+bt%2,nt=(Te<<1)+(bt>>1),Ct={aabb:E?Oe.aabb.quadrant(bt):d.aR(this,R,Oe.zoom+1,pt,nt,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:pt,y:nt,wrap:Oe.wrap,fullyVisible:Ke,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};w&&!B&&(Ct.tileID=new d.aQ(Oe.zoom+1===ae?Fe:Oe.zoom+1,Oe.wrap,Oe.zoom+1,pt,nt),Ee(Ct)),Se.push(Ct)}else{const bt=Oe.zoom===ae?Fe:Oe.zoom;if(l.minzoom&&l.minzoom>bt)continue;let pt=0;if(!Ke){let rn=K?Oe.aabb.intersectsPrecise(j):Oe.aabb.intersectsPreciseFlat(j);if(0===rn&&Xe()){const en=new d.aO(Oe.zoom,ze,Te);rn=d.aP(this,R,en,!0).intersectsPrecise(j)}if(0===rn)continue;if(l.calculateQuadrantVisibility)if(j.containsPoint(Oe.aabb.center))pt=15;else for(let en=0;en<4;en++)0!==Oe.aabb.quadrant(en).intersects(j)&&(pt|=1<<en)}const nt=k[0]-(.5+ze+(Oe.wrap<<Oe.zoom))*(1<<h-Oe.zoom),Ct=k[1]-.5-Te,Gt=Oe.tileID?Oe.tileID:new d.aQ(bt,Oe.wrap,Oe.zoom,ze,Te);l.calculateQuadrantVisibility&&(Gt.visibleQuadrants=pt),xe.push({tileID:Gt,distanceSq:nt*nt+Ct*Ct})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,ze=this.horizonLineFromTop();xe=xe.filter(Te=>{const Ke=[0,0,0,1],Xe=[d.a4,d.a4,0,1],bt=this.calculateFogTileMatrix(Te.tileID.toUnwrapped());d.aB.transformMat4(Ke,Ke,bt),d.aB.transformMat4(Xe,Xe,bt);const pt=d.aB.min([],Ke,Xe),nt=d.aB.max([],Ke,Xe),Ct=d.aS(pt,nt);if(0===Ct)return!0;let Gt=!1;const rn=this._elevation;if(rn&&Ct>Oe&&0!==ze){const en=this.calculateProjMatrix(Te.tileID.toUnwrapped());let mn;l.isTerrainDEM||(mn=rn.getMinMaxForTile(Te.tileID)),mn||(mn={min:ce,max:he});const on=d.b4(this.rotation),xi=[on[0]*d.a4,on[1]*d.a4,mn.max];d.$.transformMat4(xi,xi,en),Gt=(1-xi[1])*this.height*.5<ze}return Ct<Oe||Gt})}return xe.sort((Oe,ze)=>Oe.distanceSq-ze.distanceSq).map(Oe=>Oe.tileID)}resize(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const h=d.au(l.lat,-d.aT,d.aT),y=this.projection.project(l.lng,h);return new d.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/d.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,h){let y,b;const w=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;y=(h.x-w.x)/M,b=(h.y-w.y)/M}else{const M=this.pointCoordinate(h),O=this.pointCoordinate(w);y=M.x-O.x,b=M.y-O.y}const E=this.locationCoordinate(l);this.setLocation(new d._(E.x-y,E.y-b))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,h){const y=h?d.ay(h,l.lat):void 0,b=this.projection.project(l.lng,l.lat);return new d._(b.x,b.y,y)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,h){const y=h??this._centerAltitude,b=[l.x,l.y,0,1],w=[l.x,l.y,1,1];d.aB.transformMat4(b,b,this.pixelMatrixInverse),d.aB.transformMat4(w,w,this.pixelMatrixInverse);const E=w[3];d.aB.scale(b,b,1/b[3]),d.aB.scale(w,w,1/E);const M=b[2],O=w[2];return{p0:b,p1:w,t:M===O?0:(y-M)/(O-M)}}screenPointToMercatorRay(l){const h=[l.x,l.y,0,1],y=[l.x,l.y,1,1];return d.aB.transformMat4(h,h,this.pixelMatrixInverse),d.aB.transformMat4(y,y,this.pixelMatrixInverse),d.aB.scale(h,h,1/h[3]),d.aB.scale(y,y,1/y[3]),h[2]=d.ay(h[2],this._center.lat)*this.worldSize,y[2]=d.ay(y[2],this._center.lat)*this.worldSize,d.aB.scale(h,h,1/this.worldSize),d.aB.scale(y,y,1/this.worldSize),new d.aU([h[0],h[1],h[2]],d.$.normalize([],d.$.sub([],y,h)))}rayIntersectionCoordinate(l){const{p0:h,p1:y,t:b}=l,w=d.ay(h[2],this._center.lat),E=d.ay(y[2],this._center.lat);return new d._(d.a3(h[0],y[0],b)/this.worldSize,d.a3(h[1],y[1],b)/this.worldSize,d.a3(w,E,b))}pointCoordinate(l,h=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,h)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let h=this.projection.pointCoordinate3D(this,l.x,l.y);if(h)return new d._(h[0],h[1],h[2]);let y=0,b=this.horizonLineFromTop();if(l.y>b)return this.pointCoordinate(l);const w=.02*b,E=l.clone();for(let M=0;M<10&&b-y>w;M++){E.y=d.a3(y,b,.66);const O=this.projection.pointCoordinate3D(this,E.x,E.y);O?(b=E.y,h=O):y=E.y}return h?new d._(h[0],h[1],h[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=d.aV)return!this.isPointAboveHorizon(l);const h=this.pointCoordinate(l);return h.y>=0&&h.y<=1}_coordinatePoint(l,h){const y=h&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,b=[l.x*this.worldSize,l.y*this.worldSize,y+l.toAltitude(),1];return d.aB.transformMat4(b,b,this.pixelMatrix),b[3]>0?new d.P(b[0]/b[3],b[1]/b[3]):new d.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:h}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,w=this.pointLocation3D(new d.P(h,l)),E=this.pointLocation3D(new d.P(b,l)),M=this.pointLocation3D(new d.P(b,y)),O=this.pointLocation3D(new d.P(h,y));let R=Math.min(w.lng,E.lng,M.lng,O.lng),k=Math.max(w.lng,E.lng,M.lng,O.lng),B=Math.min(w.lat,E.lat,M.lat,O.lat),U=Math.max(w.lat,E.lat,M.lat,O.lat);const j=Math.pow(2,-this.zoom)/16*270,Z="globe"===this.projection.name?1:4,Y=(X,W,K,te,se)=>{const he=(X+K)/2,ce=(W+te)/2,ue=new d.P(he,ce),{lng:ye,lat:pe}=this.pointLocation3D(ue),Se=Math.max(0,R-ye,B-pe,ye-k,pe-U);R=Math.min(R,ye),k=Math.max(k,ye),B=Math.min(B,pe),U=Math.max(U,pe),(se<Z||Se>j)&&(Y(X,W,he,ce,se+1),Y(he,ce,K,te,se+1))};if(Y(h,l,b,l,1),Y(b,l,b,y,1),Y(b,y,h,y,1),Y(h,y,h,l,1),"globe"===this.projection.name){const[X,W]=d.aW(this);X?(U=90,k=180,R=-180):W&&(B=-90,k=180,R=-180)}return new d.aj(new d.aJ(R,B),new d.aJ(k,U))}_getBoundsRectangular(l,h){const{top:y,left:b}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,M=new d.P(b,y),O=new d.P(E,y),R=new d.P(E,w),k=new d.P(b,w);let B=this.pointCoordinate(M,l),U=this.pointCoordinate(O,l);const j=this.pointCoordinate(R,h),Z=this.pointCoordinate(k,h),Y=(X,W)=>(W.y-X.y)/(W.x-X.x);return B.y>1&&U.y>=0?B=new d._((1-Z.y)/Y(Z,B)+Z.x,1):B.y<0&&U.y<=1&&(B=new d._(-Z.y/Y(Z,B)+Z.x,0)),U.y>1&&B.y>=0?U=new d._((1-j.y)/Y(j,U)+j.x,1):U.y<0&&B.y<=1&&(U=new d._(-j.y/Y(j,U)+j.x,0)),(new d.aj).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=l.visibleDemTiles.reduce((y,b)=>{if(b.dem){const w=b.dem.tree;y.min=Math.min(y.min,w.minimums[0]),y.max=Math.max(y.max,w.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*l.exaggeration(),h.max*l.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-h*(1-this._horizonShift);return l?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-d.aT,this.maxLat=d.aT,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.ak(this.minLng)*this.tileSize,this.worldMaxX=d.ak(this.maxLng)*this.tileSize,this.worldMinY=d.al(this.maxLat)*this.tileSize,this.worldMaxY=d.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,h){return this.projection.createTileMatrix(this,h,l)}calculateDistanceTileData(l){const h=l.key,y=this._distanceTileDataCache;if(y[h])return y[h];const b=l.canonical,w=1/this.height,E=this.cameraWorldSize,M=E/this.zoomScale(b.z),O=(b.x+Math.pow(2,b.z)*l.wrap)*M,R=b.y*M,k=this.point;k.x*=E/this.worldSize,k.y*=E/this.worldSize;const B=this.angle,U=Math.sin(-B),j=-Math.cos(-B);return y[h]={bearing:[U,j],center:[(k.x-O)*w,(k.y-R)*w],scale:M/d.a4*w},y[h]}calculateFogTileMatrix(l){const h=l.key,y=this._fogTileMatrixCache;if(y[h])return y[h];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return d.ae.multiply(b,this.worldToFogMatrix,b),y[h]=new Float32Array(b),y[h]}calculateProjMatrix(l,h=!1,y=!1){const b=l.key;let w;if(w=y?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,w[b])return w[b];const E=this.calculatePosMatrix(l,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,d.ae.multiply(E,M,E),w[b]=new Float32Array(E),w[b]}calculatePixelsToTileUnitsMatrix(l){const h=l.tileID.key,y=this._pixelsToTileUnitsCache;if(y[h])return y[h];const b=d.aX(l,this);return y[h]=b,y[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const l=1/this.worldSize,h=d.ae.fromScaling([],[l,l,l]);return d.ae.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const l=this._elevation;this._updateCameraState();const h=d.ay(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(h),b=this._camera.forward(),w=d.ay(1,this._center.lat);y[2]/=w,b[2]/=w,d.$.normalize(b,b);const E=l.raycast(y,b,l.exaggeration());if(E){const M=d.$.scaleAndAdd([],y,b,E),O=new d._(M[0],M[1],d.ay(M[2],d.az(M[1]))),R=(O.z+d.$.length([O.x-y[0],O.y-y[1],O.z-y[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const h=this._elevation,y=d.ay(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),w=h.getAtPointOrZero(new d._(...b)),E=this.pixelsPerMeter/this.worldSize*w,M=this._minimumHeightOverTerrain(),O=b[2]-E;if(O<=M)if(O<0||l){const R=this.locationCoordinate(this._center,this._centerAltitude),k=[b[0],b[1],R.z-b[2]],B=d.$.length(k);k[2]-=(M-O)/this._pixelsPerMercatorPixel;const U=d.$.length(k);if(0===U)return;d.$.scale(k,k,B/U*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],R.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const U=this.center;return U.lat=d.au(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(U.lng=d.au(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const h=this._unmodified,{x:y,y:b}=this.point;let w=0,E=y,M=b;const O=this.width/2,R=this.height/2,k=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(b-R<k&&(M=k+R),b+R>B&&(M=B-R),B-k<this.height&&(w=Math.max(w,this.height/(B-k)),M=(B+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,Z=this.worldSize/2-(U+j)/2;E=(y+Z+this.worldSize)%this.worldSize-Z,E-O<U&&(E=U+O),E+O>j&&(E=j-O),j-U<this.width&&(w=Math.max(w,this.width/(j-U)),E=(j+U)/2)}E===y&&M===b||(this.center=this.unproject(new d.P(E,M))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,h="globe"===this.projection.name,y=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=d.ay(1,this.center.lat)/d.ay(1,d.b5));const b=d.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?y:1,E=this._camera.getWorldToCamera(this.worldSize,w);let M;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-l.x/this.width,O[9]=2*l.y/this.height,this.isOrthographic){let pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=pe*this.aspect,xe=-Se,ae=-pe;Se-=l.x,xe-=l.x,pe+=l.y,ae+=l.y,M=this._camera.getCameraToClipOrthographic(xe,Se,ae,pe,this._nearZ,this._farZ),((Fe,ke,Ee,We)=>{for(let Ye=0;Ye<16;Ye++)Fe[Ye]=np(ke[Ye],Ee[Ye],We)})(M,M,O,Ah(this.pitch>=15?1:this.pitch/15))}else M=O;const R=d.ae.mul([],O,E);let k=d.ae.mul([],M,E);if(this.projection.isReprojectedInTileSpace){const pe=this.locationCoordinate(this.center),Se=d.ae.identity([]);d.ae.translate(Se,Se,[pe.x*this.worldSize,pe.y*this.worldSize,0]),d.ae.multiply(Se,Se,d.aZ(this)),d.ae.translate(Se,Se,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),d.ae.multiply(k,k,Se),d.ae.multiply(R,R,Se),this.inverseAdjustmentMatrix=d.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=d.ae.scale([],k,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=k,this.invProjMatrix=d.ae.invert(new Float64Array(16),this.projMatrix),h){const pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);pe[8]=2*-l.x/this.width,pe[9]=2*l.y/this.height,this.expandedFarZProjMatrix=d.ae.mul([],pe,E)}else this.expandedFarZProjMatrix=this.projMatrix;const B=d.ae.invert([],M);this.frustumCorners=d.a$.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=d.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const U=new Float32Array(16);d.ae.identity(U),d.ae.scale(U,U,[1,-1,1]),d.ae.rotateX(U,U,this._pitch),d.ae.rotateZ(U,U,this.angle);const j=d.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=d.ae.clone(j);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-l.x/this.width,j[9]=2*(l.y+Z)/this.height,this.skyboxMatrix=d.ae.multiply(U,j,U);const Y=this.point,X=Y.x,W=Y.y,K=this.width%2/2,te=this.height%2/2,se=Math.cos(this.angle),he=Math.sin(this.angle),ce=X-Math.round(X)+se*K+he*te,ue=W-Math.round(W)+se*te+he*K,ye=new Float64Array(k);if(d.ae.translate(ye,ye,[ce>.5?ce-1:ce,ue>.5?ue-1:ue,0]),this.alignedProjMatrix=ye,k=d.ae.create(),d.ae.scale(k,k,[this.width/2,-this.height/2,1]),d.ae.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=d.ae.create(),d.ae.scale(k,k,[1,-1,1]),d.ae.translate(k,k,[-1,-1,0]),d.ae.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=d.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},k=d.ae.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.b0(this);const pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.$.transformMat4(pe,pe,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,w=[l,l,h];d.$.scale(w,w,b),d.$.scale(y,y,-1),d.$.multiply(y,y,w);const E=d.ae.create();d.ae.translate(E,E,y),d.ae.scale(E,E,w),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,h,b)}_computeCameraPosition(l){const h=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-l/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*w,b.y/this.worldSize-y[1]*w,l/this.worldSize*this._centerAltitude-y[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=l[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(w=Math.min((h-y)/b,1)),this._camera.position=d.$.scaleAndAdd([],this._camera.position,l,w),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,h=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),w=d.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.ac(this._maxPitch)),M=Math.max((l[2]-w)/Math.cos(y),E),O=this._zoomFromMercatorZ(M);d.$.scaleAndAdd(l,l,h,M),this._pitch=d.au(y,d.ac(this.minPitch),d.ac(this.maxPitch)),this.angle=d.av(b,-Math.PI,Math.PI),this._setZoom(d.au(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d._(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let h=0,y=d.aV,b=0,w=1/0;for(;y-h>1e-6&&y>h;){const E=h+.5*(y-h),M=this.tileSize*Math.pow(2,E),O=this.getCameraToCenterDistance(this.projection,E,M),R=this.scaleZoom(O/(l*this.tileSize)),k=Math.abs(E-R);k<w&&(w=k,b=E),E<R?h=E:y=E}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,h){const y=Math.min(l.x,h.x),b=Math.max(l.x,h.x),w=Math.min(l.y,h.y),E=Math.max(l.y,h.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new d.P(y,w),new d.P(b,E),new d.P(y,E),new d.P(b,w)],O=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const k of M){const B=this.pointRayIntersection(k);if(B.t<0)return!0;const U=this.rayIntersectionCoordinate(B);if(U.x<O||U.y<0||U.x>R||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.P(0,0),new d.P(this.width,this.height))}zoomDeltaToMovement(l,h){const y=d.$.length(d.$.sub([],this._camera.position,l)),b=this._zoomFromMercatorZ(y)+h;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if("globe"===this.projection.name){const l=function([h,y,b],w){const E=[h,y,b,1];d.aB.transformMat4(E,E,w);const M=E[3]=Math.max(E[3],1e-6);return E[0]/=M,E[1]/=M,E[2]/=M,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,l))}}getCameraToCenterDistance(l,h=this.zoom,y=this.worldSize){const b=d.aY(l,h,this.width,this.height,1024),w=l.pixelSpaceConversion(this.center.lat,y,b);let E=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(E=np(1,E,Ah(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&d.ae.multiply(l,l,this.globeMatrix),l}getFrustum(l){return d.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,"meters"===this.projection.zAxisUnit)}}const qr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Zo=(g,l)=>{if(l>0&&g.terrain&&d.w("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=g.transform,y=Math.max(Math.abs(h._zoom-(g.minCutoffZoom-1)),1),b=h.isLODDisabled(!1)?d.a0(60,45,h.pitch):d.a0(30,15,h.pitch),w=h._farZ-h._nearZ,E=l*h.height,M=((1-(O=b))*h.cameraToCenterDistance+O*(h._farZ+E))*y;var O;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(M-h._nearZ)/w,(M-E-h._nearZ)/w]}}},ho={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class fr{constructor(l,h){this.aabb=l,this.lastCascade=h}}class Kl{add(l,h){const y=this.receivers[l.key];void 0!==y?(y.aabb.min[0]=Math.min(y.aabb.min[0],h.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],h.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],h.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],h.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],h.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],h.max[2])):this.receivers[l.key]=new fr(h,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,h,y){const b=d.b8.fromPoints(l.points);let w=0;for(const E in this.receivers){const M=this.receivers[E];if(!M||!b.intersectsAabb(M.aabb))continue;M.aabb.min=b.closestPoint(M.aabb.min),M.aabb.max=b.closestPoint(M.aabb.max);const O=M.aabb.getCorners();for(let R=0;R<y.length;R++){let k=!0;for(const B of O){const U=[B[0]*h,B[1]*h,B[2]];if(d.$.transformMat4(U,U,y[R].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){k=!1;break}}if(M.lastCascade=R,w=Math.max(w,R),k)break}}return w+1}}class Gm{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Kl,this._depthMode=new d.af(l.context.gl.LEQUAL,d.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(ho,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(ho,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(ho,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,h){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const b=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||b<=0||(this._shadowLayerCount=y.style.order.reduce((Z,Y)=>{const X=y.style._mergedLayers[Y];return Z+(X.hasShadowPass()&&!X.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=y.context,E=ho.shadowMapResolution,M=ho.shadowMapResolution;if(0===this._cascades.length||ho.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<ho.cascadeCount;++Z){const Y=y._shadowMapDebug,X=w.gl,W=w.createFramebuffer(E,M,Y,"texture"),K=new d.T(w,{width:E,height:M,data:null},X.DEPTH_COMPONENT);if(W.depthAttachment.set(K.texture),Y){const te=new d.T(w,{width:E,height:M,data:null},X.RGBA);W.colorAttachment.set(te.texture)}this._cascades.push({framebuffer:W,texture:K,matrix:[],far:0,boundingSphereRadius:0,frustum:new d.aM,scale:0})}}this.shadowDirection=Oh(h);let O=0;if(l.elevation){const Z=l.elevation,Y=[1e4,-1e4];Z.visibleDemTiles.filter(X=>X.dem).forEach(X=>{const W=X.dem.tree;Y[0]=Math.min(Y[0],W.minimums[0]),Y[1]=Math.max(Y[1],W.maximums[0])}),1e4!==Y[0]&&(O=(Y[1]-Y[0])*Z.exaggeration())}const R=1.5*l.cameraToCenterDistance,k=3*R,B=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const Y=this._cascades[Z];let X=l.height/50,W=1;1===ho.cascadeCount?W=k:0===Z?W=R:(X=R,W=k);const[K,te]=py(l,this.shadowDirection,X,W,ho.shadowMapResolution,O);Y.scale=l.scale,Y.matrix=K,Y.boundingSphereRadius=te,d.ae.invert(B,Y.matrix),Y.frustum=d.aM.fromInvProjectionMatrix(B,1,0,!0),Y.far=W}const U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ho.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ho.shadowMapResolution,this._uniformValues.u_shadowmap_0=qr.ShadowMap0,this._uniformValues.u_shadowmap_1=qr.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=y.transform.elevation;for(const Z of this._groundShadowTiles){let Y={min:0,max:0};if(j){const X=j.getMinMaxForTile(Z);X&&(Y=X)}this.addShadowReceiver(Z.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,h){if(!this.enabled)return;const y=this.painter,b=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),b.viewport.set([0,0,ho.shadowMapResolution,ho.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){y.currentShadowCascade=w,b.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),b.clear({color:d.C.white,depth:1});for(const E of l.order){const M=l._mergedLayers[E];if(!M.hasShadowPass()||M.isHidden(y.transform.zoom))continue;const O=l.getLayerSourceCache(M),R=O?h[O.id]:void 0;("model"===M.type||R&&R.length)&&y.renderLayer(y,O,M,R)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,h=l.style,y=l.context,b=h.directionalLight,w=h.ambientLight;if(!b||!w)return;const E=[],M=Zo(l,l.longestCutoffRange);M.shouldRenderCutoff&&E.push("RENDER_CUTOFF");const O=Ph(h,b,w),R=new d.af(y.gl.LEQUAL,d.af.ReadOnly,l.depthRangeFor3D);for(const k of this._groundShadowTiles){const B=k.toUnwrapped(),U=l.isTileAffectedByFog(k),j=l.getOrCreateProgram("groundShadow",{defines:E,overrideFog:U});this.setupShadows(B,j),l.uploadCommonUniforms(y,j,B,null,M);const Z={u_matrix:l.transform.calculateProjMatrix(B),u_ground_shadow_factor:O};j.draw(l,y.gl.TRIANGLES,R,d.ah.disabled,d.a.multiply,d.ag.disabled,Z,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?d.a.unblended:d.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const h=this.painter.transform,y=h.calculatePosMatrix(l,h.worldSize);return d.ae.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(l){return d.ae.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,h,y,b=0){if(!this.enabled)return;const w=this.painter.transform,E=this.painter.context,M=E.gl,O=this._uniformValues,R=new Float64Array(16),k=w.calculatePosMatrix(l,w.worldSize);for(let B=0;B<this._cascades.length;B++)d.ae.multiply(R,this._cascades[B].matrix,k),O[0===B?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),E.activeTexture.set(M.TEXTURE0+qr.ShadowMap0+B),this._cascades[B].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const B=d.b7(l.canonical),U=2/w.tileSize*d.a4/ho.shadowMapResolution,j=U*this._cascades[0].boundingSphereRadius,Z=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Y=("vector-tile"===y?1:3)/Math.pow(2,b-l.canonical.z-(1-w.zoom+Math.floor(w.zoom)));O.u_shadow_normal_offset=[B,j*Y,Z*Y],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(E,O)}setupShadowsFromMatrix(l,h,y=!1){if(!this.enabled)return;const b=this.painter.context,w=b.gl,E=this._uniformValues,M=new Float64Array(16);for(let O=0;O<ho.cascadeCount;O++)d.ae.multiply(M,this._cascades[O].matrix,l),E[0===O?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),b.activeTexture.set(w.TEXTURE0+qr.ShadowMap0+O),this._cascades[O].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=y,y){const O=ho.normalOffset;E.u_shadow_normal_offset=[1,O,O],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(b,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,h,y,b){if(b[2]>=0)return{};const w=function(O,R,k){const B=k/(1<<O.canonical.z);return new d.b8([O.canonical.x*B+O.wrap*k,O.canonical.y*B+O.wrap*k,0],[(O.canonical.x+1)*B+O.wrap*k,(O.canonical.y+1)*B+O.wrap*k,R])}(l,h,y).getCorners(),E=h/-b[2];b[0]<0?(d.$.add(w[0],w[0],[b[0]*E,0,0]),d.$.add(w[3],w[3],[b[0]*E,0,0])):b[0]>0&&(d.$.add(w[1],w[1],[b[0]*E,0,0]),d.$.add(w[2],w[2],[b[0]*E,0,0])),b[1]<0?(d.$.add(w[0],w[0],[0,b[1]*E,0]),d.$.add(w[1],w[1],[0,b[1]*E,0])):b[1]>0&&(d.$.add(w[2],w[2],[0,b[1]*E,0]),d.$.add(w[3],w[3],[0,b[1]*E,0]));const M={};return M.vertices=w,M.planes=[id(w[1],w[0],w[4]),id(w[2],w[1],w[5]),id(w[3],w[2],w[6]),id(w[0],w[3],w[7])],M}addShadowReceiver(l,h,y){this._receivers.add(l,d.b8.fromTileIdAndHeight(l,h,y))}getMaxCascadeForTile(l){const h=this._receivers.get(l);return h&&h.lastCascade?h.lastCascade:0}}function id(g,l,h){const y=d.$.sub([],h,l),b=d.$.sub([],g,l),w=d.$.cross([],y,b),E=d.$.length(w);return 0===E?[0,0,1,0]:(d.$.scale(w,w,1/E),[w[0],w[1],w[2],-d.$.dot(w,l)])}function Oh(g){const l=g.properties.get("direction"),h=d.ad(l.x,l.y,l.z);h[2]=d.au(h[2],0,75);const y=d.b9([h[0],h[1],h[2]]);return d.$.fromValues(y.x,y.y,y.z)}function Ph(g,l,h){const y=l.properties.get("color"),b=l.properties.get("intensity"),w=l.properties.get("direction"),E=[w.x,w.y,w.z],M=h.properties.get("color"),O=h.properties.get("intensity"),R=Math.max(d.$.dot([0,0,1],E),0),k=[0,0,0];d.$.scale(k,M.toRenderColor(g.getLut(l.scope)).toArray01Linear().slice(0,3),O);const B=[0,0,0];return d.$.scale(B,y.toRenderColor(g.getLut(h.scope)).toArray01Linear().slice(0,3),R*b),d.ba([k[0]>0?k[0]/(k[0]+B[0]):0,k[1]>0?k[1]/(k[1]+B[1]):0,k[2]>0?k[2]/(k[2]+B[2]):0])}function py(g,l,h,y,b,w){const E=g.zoom,M=g.scale,O=g.worldSize,R=1/O,k=g.aspect,B=Math.sqrt(1+k*k)*Math.tan(.5*g.fovX),U=B*B,j=y-h,Z=y+h;let Y,X;U>j/Z?(Y=y,X=y*B):(Y=.5*Z*(1+U),X=.5*Math.sqrt(j*j+2*(y*y+h*h)*U+Z*Z*U*U));const W=g.projection.pixelsPerMeter(g.center.lat,O),K=g._camera.getCameraToWorldMercator(),te=[0,0,-Y*R];d.$.transformMat4(te,te,K);let se=X*R;const he=g._edgeInsets;if(!(0===he.left&&0===he.top&&0===he.right&&0===he.bottom||he.left===he.right&&he.top===he.bottom)){const Ke=g._camera.getWorldToCamera(g.worldSize,"meters"===g.projection.zAxisUnit?W:1),Xe=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,h,y);Xe[8]=2*-g.centerOffset.x/g.width,Xe[9]=2*g.centerOffset.y/g.height;const bt=new Float64Array(16);d.ae.mul(bt,Xe,Ke);const pt=new Float64Array(16);d.ae.invert(pt,bt);const nt=d.aM.fromInvProjectionMatrix(pt,O,E,!0);for(const Ct of nt.points){const Gt=((ce=Ct)[0]/=M,ce[1]/=M,ce[2]=d.ay(ce[2],g._center.lat),ce);se=Math.max(se,d.$.len(d.$.subtract([],te,Gt)))}}var ce;se*=b/(b-1);const ue=Math.acos(l[2]),ye=Math.atan2(-l[0],-l[1]),pe=new nu;pe.position=te,pe.setPitchBearing(ue,ye);const Se=pe.getWorldToCamera(O,W),xe=se*O,ae=Math.min(g._mercatorZfromZoom(17)*O*-2,-2*xe),Fe=pe.getCameraToClipOrthographic(-xe,xe,-xe,xe,ae,(xe+w*W)/l[2]),ke=new Float64Array(16);d.ae.multiply(ke,Fe,Se);const Ee=d.$.fromValues(Math.floor(1e6*te[0])/1e6*O,Math.floor(1e6*te[1])/1e6*O,0),We=.5*b,Ye=[0,0,0];d.$.transformMat4(Ye,Ee,ke),d.$.scale(Ye,Ye,We);const Oe=[Math.floor(Ye[0]),Math.floor(Ye[1]),Math.floor(Ye[2])],ze=[0,0,0];d.$.sub(ze,Ye,Oe),d.$.scale(ze,ze,-1/We);const Te=new Float64Array(16);return d.ae.identity(Te),d.ae.translate(Te,Te,ze),d.ae.multiply(ke,Te,ke),[ke,xe]}function rd(g,l){return null!=g&&null!=l&&!(!g.hasData()||!l.hasData())&&null!=g.demTexture&&null!=l.demTexture&&g.tileID.key!==l.tileID.key}const Jl=new class{constructor(){this.operations={}}newMorphing(g,l,h,y,b){if(g in this.operations){const w=this.operations[g];w.to.tileID.key!==h.tileID.key&&(w.queued=h)}else this.operations[g]={startTime:y,phase:0,duration:b,from:l,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const h=this.operations[l];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},rp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ql(g,l,h){if(0===l)return 0;const y=l<1&&514===h?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*y}function op(g,l){const h=1<<g.z;return!l&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const Rh=g=>({u_matrix:g});function Hm(g,l,h,y,b){if(b>0){const w=d.e.now(),E=(w-g.timeAdded)/b,M=l?(w-l.timeAdded)/b:-1,O=h.getSource(),R=y.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),k=!l||Math.abs(l.tileID.overscaledZ-R)>Math.abs(g.tileID.overscaledZ-R),B=k&&g.refreshedUponExpiration?1:d.au(k?E:1-M,0,1);return g.refreshedUponExpiration&&E>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class ec extends Ns{constructor(l,h,y,b){super(l,h,y,b),this.type="raster-array",this.maxzoom=22,this._options=d.Q({type:"raster-array"},h)}triggerRepaint(l){const h=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);h&&h.enabled&&y&&h._clearRenderCacheForTile(y.id,l.tileID),this.map.triggerRepaint()}loadTile(l,h){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(y,d.R.Tile);l.requestParams=b,l.actor||(l.actor=this.dispatcher.getActor()),l.request=l.fetchHeader(void 0,(w,E,M,O)=>(delete l.request,l.aborted?(l.state="unloaded",h(null)):w?20===w.code?void 0:(l.state="errored",h(w)):(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:M,expires:O}),l.state="empty",void h(null))))}unloadTile(l,h){const y=l.texture;y&&y instanceof d.T?(l.destroy(!0),this.map.painter.saveTileTexture(y)):(l.destroy(),l.flushQueues(),l._isHeaderLoaded=!1,delete l._mrt,delete l.textureDescriptor),l.fbo&&(l.fbo.destroy(),delete l.fbo),delete l.request,delete l.requestParams,delete l.neighboringTiles,l.state="unloaded"}prepareTile(l,h,y){l._isHeaderLoaded&&("empty"!==l.state&&(l.state="reloading"),l.fetchBand(h,y,(b,w)=>{if(b)return l.state="errored",this.fire(new d.f(b)),void this.triggerRepaint(l);w&&(l.setTexture(w,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:w})=>w===l),y=h&&h.fields,b=y&&y.bands&&y.bands;return b?b[0]:0}getTextureDescriptor(l,h,y){if(!l)return;const b=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let w=null;h instanceof d.bm?w=h.paint.get("raster-array-band"):h instanceof d.bn&&(w=h.paint.get("raster-particle-array-band"));const E=w||this.getInitialBand(b);if(null!=E)if(l.textureDescriptor){if(!l.updateNeeded(b,E)||y)return Object.assign({},l.textureDescriptor,{texture:l.texture})}else this.prepareTile(l,b,E)}}const sp={vector:hy,raster:Ns,"raster-dem":class extends Ns{constructor(g,l,h,y){super(g,l,h,y),this.type="raster-dem",this.maxzoom=22,this._options=d.Q({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,w){b&&(g.state="errored",l(b)),w&&(g.dem=w,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=d.i(this.map._requestManager.transformRequest(h,d.R.Tile),function(b,w,E,M){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(b)g.state="errored",l(b);else if(w){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:E,expires:M});const O=ImageBitmap&&w instanceof ImageBitmap&&d.bk(),R=1-(w.width-d.bl(w.width))/2;R<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const k=O?w:d.e.getImageData(w,R),B={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:R};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",B,y.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const l=g.canonical,h=Math.pow(2,l.z),y=(l.x-1+h)%h,b=0===l.x?g.wrap-1:g.wrap,w=(l.x+1+h)%h,E=l.x+1===h?g.wrap+1:g.wrap,M={};return M[new d.aQ(g.overscaledZ,b,l.z,y,l.y).key]={backfilled:!1},M[new d.aQ(g.overscaledZ,E,l.z,w,l.y).key]={backfilled:!1},l.y>0&&(M[new d.aQ(g.overscaledZ,b,l.z,y,l.y-1).key]={backfilled:!1},M[new d.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},M[new d.aQ(g.overscaledZ,E,l.z,w,l.y-1).key]={backfilled:!1}),l.y+1<h&&(M[new d.aQ(g.overscaledZ,b,l.z,y,l.y+1).key]={backfilled:!1},M[new d.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},M[new d.aQ(g.overscaledZ,E,l.z,w,l.y+1).key]={backfilled:!1}),M}},"raster-array":ec,geojson:class extends d.E{constructor(g,l,h,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(y),this._data=l.data,this._options=d.Q({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),void 0!==l.minzoom&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const b=d.a4/this.tileSize;this.workerOptions=d.Q({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*b,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*b,extent:d.a4,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:d.a4,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*b,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new d.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof g&&("Feature"===g.type&&(g={type:"FeatureCollection",features:[g]}),"FeatureCollection"!==g.type))return this.fire(new d.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof g&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const l=new Map;for(const h of this._data.features)l.set(h.id,h);for(const h of g.features)l.set(h.id,h);this._data.features=[...l.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,h,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:h},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.g("dataloading",{dataType:"source"})),this._loaded=!1;const l=d.Q({append:g},this.workerOptions);l.scope=this.scope;const h=this._data;"string"==typeof h?(l.request=this.map._requestManager.transformRequest(d.e.resolveURL(h),d.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(y,b)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new d.f(y));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(w.resourceTiming=b.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new d.g("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,b=this._partialReload,w={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y?{image:y.image.clone()}:null,scope:this.scope,pixelRatio:d.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:b};g.request=this.actor.send(h,w,(E,M)=>b&&!M?(g.state="loaded",l(null)):(delete g.request,g.destroy(),g.aborted?l(null):E?l(E):(g.loadVectorData(M,this.map.painter,"reloadTile"===h),l(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,l){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends d.bo{constructor(g,l,h,y){super(g,l,h,y),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,d.R.Source).url);d.bp(this.urls,(l,h)=>{this._loaded=!0,l?this.fire(new d.f(l)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new d.f(new d.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:d.bo,model:class extends d.E{constructor(g,l,h,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const h=this._options.models[l],y=d.l(this.map._requestManager.transformRequest(h.uri,d.R.Model).url).then(b=>{if(!b)return;const w=d.c(b),E=new d.M(l,h.position,h.orientation,w);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(b=>{this.fire(new d.f(new Error(`Could not load model ${l} from ${h.uri}: ${b.message}`)))});g.push(y)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new d.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new d.f(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends d.E{constructor(g,l,h,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new d.g("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Um(this._options,this.map._requestManager,l,h,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new d.f(y))):b&&(d.Q(this,b),b.bounds&&(this.tileBounds=new Sh(b.bounds,this.minzoom,this.maxzoom)),d.ao(b.tiles,this.map._requestManager._customAccessToken),this.fire(new d.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.g("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(h,d.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&"expired"!==g.state)if("loading"===g.state)g.reloadCallback=l;else{if(g.buckets){const w=Object.values(g.buckets);for(const E of w)E.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,b.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,b.bind(this),void 0,!0);function b(w,E){return g.aborted?l(null):w&&404!==w.status?l(w):(E&&(E.resourceTiming&&(g.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(E),g.buckets={...g.buckets,...E.buckets},E.featureIndex&&(g.latestFeatureIndex=E.featureIndex)),g.state="loaded",void l(null))}}serialize(){return d.Q({},this._options)}},canvas:class extends d.bo{constructor(g,l,h,y){super(g,l,h,y),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(w=>"number"!=typeof w))||this.fire(new d.f(new d.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.f(new d.V(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new d.f(new d.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof HTMLCanvasElement||this.fire(new d.f(new d.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.f(new d.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof d.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends d.E{constructor(g,l,h,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=l,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Sh(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),d.Q(this,d.ai(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new d.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:h,z:y}=g.canonical;return this._implementation.hasTile({x:l,y:h,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:h,y,z:b}=g.tileID.canonical,w=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y,z:b},{signal:w.signal})).then(function(E){return delete g.request,g.aborted?(g.state="unloaded",l(null)):void 0===E?(g.state="errored",l(null)):null===E?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):(M=E)instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement?(this.loadTileData(g,E),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var M}.bind(this)).catch(E=>{20!==E.code&&(g.state="errored",l(E))}),g.request.cancel=()=>w.abort()}loadTileData(g,l){g.setTexture(l,this.map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof d.T?(g.destroy(!0),g.texture&&g.texture instanceof d.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:h,y,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:h,y,z:b})}l&&l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=d.am(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new d.g("data",{dataType:"source",sourceDataType:"content"}))}}},ap=function(g,l,h,y){const b=new sp[l.type](g,l,h,y);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return d.br(["load","abort","unload","serialize","prepare"],b),b};class my extends d.bx{constructor(l){const h={type:"raster-dem",maxzoom:l.transform.maxZoom},y=new d.by(d.bz(),null),b=ap("mock-dem",h,y,l.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,h){l.state="loaded",h(null)}}class tc extends d.bx{constructor(l){const h=ap("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new d.by(d.bz(),null),l.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,h,y){if(l.freezeTileCoverage)return;this.transform=l;const b=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,E)=>{if(w[E.key]="",!this._tiles[E.key]){const M=new d.bA(E,this._source.tileSize*E.overscaleFactor(),l.tileZoom);M.state="loaded",this._tiles[E.key]=M}return w},{});for(const w in this._tiles)w in b||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(l){const h=this.proxyCachedFBO[l];if(void 0!==h){const y=Object.values(h);this.renderCachePool.push(...y),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gy extends d.aQ{constructor(l,h,y){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=h,this.projMatrix=y}}class Mo extends d.bs{constructor(l,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,w]=function(O){const R=new d.bv,k=new d.bw,B=131;R.reserve(17161),k.reserve(33800);const U=d.a4/128,j=d.a4+U/2,Z=j+U;for(let X=-U;X<Z;X+=U)for(let W=-U;W<Z;W+=U){const K=W<0||W>j||X<0||X>j?24575:0,te=d.au(Math.round(W),0,d.a4),se=d.au(Math.round(X),0,d.a4);R.emplaceBack(te+K,se)}const Y=(X,W)=>{const K=W*B+X;k.emplaceBack(K+1,K,K+B),k.emplaceBack(K+B,K+B+1,K+1)};for(let X=1;X<129;X++)for(let W=1;W<129;W++)Y(W,X);return[0,129].forEach(X=>{for(let W=0;W<130;W++)Y(W,X),Y(X,W)}),[R,k,32768]}(),E=l.context;this.gridBuffer=E.createVertexBuffer(y,d.bt.members),this.gridIndexBuffer=E.createIndexBuffer(b),this.gridSegments=d.b.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=d.b.simpleSegment(0,0,y.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new tc(h.map),this.orthoMatrix=d.ae.create(),d.ae.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,d.a4,0,d.a4,0,1);const M=E.gl;this._overlapStencilMode=new d.ah({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new my(h.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,h,y){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const b=l.terrain.properties,w=0===l.terrain.drapeRenderMode,E=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=d.e.now();const M=l.terrain&&l.terrain.scope,O=b.get("source"),R=w?this._mockSourceCache:l.getSourceCache(O,M);if(!R)return void d.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=R,this._exaggeration=E?this.calculateExaggeration(h):b.get("exaggeration"),!h.projection.requiresDraping&&E&&0===this._exaggeration)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&d.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(h,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),h.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(l){const h=this._previousCameraAltitude,y=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=y;const b=null!=h?y-h:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const w=l.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(w);let M=w-this._previousZoom;const O=this._previousUpdateTimestamp;let R=w;null!=this._evaluationZoom&&(R=this._evaluationZoom,Math.abs(w-R)>.5&&(M=.5*(w-R+M)),M*b<0&&(R+=M)),this._evaluationZoom=R;const k=E.getExaggeration(R),B=k===E.getExaggeration(Math.max(0,R-.1));if(B&&Math.abs(k-this._exaggeration)<.01)return k;let U=Math.min(.1,.00375*(this._updateTimestamp-O));return(B||k<.1||Math.abs(M)<1e-4)&&(U=Math.min(.2,4*U)),d.a3(this._exaggeration,k,U)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=0===y._centerAltitude&&-1===this.getAtPointOrZero(d._.fromLngLat(y.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=h.getIds().map(O=>{const R=h.getTileByID(O).tileID;return R.projMatrix=y.calculateProjMatrix(R.toUnwrapped()),R});!function(O,R){const k=R.transform.pointCoordinate(R.transform.getCameraPoint()),B=new d.P(k.x,k.y);O.sort((U,j)=>{if(j.overscaledZ-U.overscaledZ)return j.overscaledZ-U.overscaledZ;const Z=new d.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Y=new d.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),X=B.mult(1<<U.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(Z)-X.distSqr(Y)})}(b,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},b.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const O in E){const R=E[O];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,l[O],w),R.usedForTerrain))continue;const k=l[O];R.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[h.id]=b.map(O=>new gy(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const R=this.terrainTileForTile[O.key];if(!R)continue;const k=R.tileID.key;k in M||(this._visibleDemTiles.push(R),M[k]=k)}}_assignTerrainTiles(l){this._initializing||l.forEach(h=>{if(this.terrainTileForTile[h.key])return;const y=this._findTileCoveringTileID(h,this.sourceCache);y&&(this.terrainTileForTile[h.key]=y)})}_prepareDEMTextures(){const l=this.painter.context,h=l.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],w=b.dem;!w||b.demTexture&&!b.needsDEMTextureUpload||(l.activeTexture.set(h.TEXTURE1),Vm(this.painter,b,w))}}_prepareDemTileUniforms(l,h,y,b){if(!h||null==h.demTexture)return!1;const w=l.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-w.z),M=b||"";return y[`u_dem_tl${M}`]=[w.x*E%1,w.y*E%1],y[`u_dem_scale${M}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const h=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const w=b.dem.tree.minimums[0];return w>0&&l++,y+w},0);return l?h/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,h=l.gl;l.activeTexture.set(h.TEXTURE2);const y=this._getLoadedAreaMinimum(),[b,w]=(()=>{const M=new d.bB({width:1,height:1},new Float32Array([y]));return[h.R32F,M]})();this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(w,{premultiply:!1}):E=this._emptyDEMTexture=new d.T(l,w,b,{premultiply:!1}),E}setupElevationDraw(l,h,y){const b=this.painter.context,w=b.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let M=null,O=null,R=1;if(y&&y.morphing&&this._useVertexMorphing){const j=y.morphing.srcDemTile,Z=y.morphing.dstDemTile;R=y.morphing.phase,j&&Z&&(this._prepareDemTileUniforms(l,j,E,"_prev")&&(O=j),this._prepareDemTileUniforms(l,Z,E)&&(M=Z))}const k=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let B=null;var U;if(this.enabled?O&&M?(B=M.demTexture,b.activeTexture.set(w.TEXTURE4),O.demTexture.bind(k(O),w.CLAMP_TO_EDGE),E.u_dem_lerp=R):(M=this.terrainTileForTile[l.tileID.key],B=this._prepareDemTileUniforms(l,M,E)?M.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,b.activeTexture.set(w.TEXTURE2),B&&(E.u_dem_size=1===(U=B).size[0]?1:U.size[0]-2,B.bind(k(M),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,h,E),y&&y.useMeterToDem&&M){const j=(1<<M.tileID.canonical.z)*d.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=j}if(y&&y.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),h.setTerrainUniformValues(b,E),"globe"===this.painter.transform.projection.name){const j=this.globeUniformValues(this.painter.transform,l.tileID.canonical,y&&y.useDenormalizedUpVectorScale);h.setGlobeUniformValues(b,j)}}globeUniformValues(l,h,y){const b=l.projection;return{u_tile_tl_up:b.upVector(h,0,0),u_tile_tr_up:b.upVector(h,d.a4,0),u_tile_br_up:b.upVector(h,d.a4,d.a4),u_tile_bl_up:b.upVector(h,0,d.a4),u_tile_up_scale:y?d.bu(1):b.upVectorScale(h,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const h=this.painter,y=this.painter.context;0!==l.length&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,w,E,M,O){if("globe"===b.transform.projection.name)!function(R,k,B,U,j){const Z=R.context,Y=Z.gl;let X,W;const K=R.transform,te=d.bc(R,Z,K),se=(Fe,ke)=>{if(W===ke)return;const Ee=[rp[ke],"PROJECTION_GLOBE_VIEW"];te&&Ee.push("CUSTOM_ANTIALIASING");const We=R.isTileAffectedByFog(Fe);X=R.getOrCreateProgram("globeRaster",{defines:Ee,overrideFog:We}),W=ke},he=R.colorModeForRenderPass(),ce=new d.af(Y.LEQUAL,d.af.ReadWrite,R.depthRangeFor3D);Jl.update(j);const ue=d.bd(K),ye=[d.ak(K.center.lng),d.al(K.center.lat)],pe=R.globeSharedBuffers,Se=[K.width*d.e.devicePixelRatio,K.height*d.e.devicePixelRatio],xe=Float32Array.from(K.globeMatrix),ae={useDenormalizedUpVectorScale:!0};{const Fe=R.transform,ke=Ql(Fe.zoom,k.exaggeration(),k.sourceCache._source.tileSize);W=-1;const Ee=Y.TRIANGLES;for(const We of U){const Ye=B.getTile(We),Oe=d.ah.disabled,ze=k.prevTerrainTileForTile[We.key],Te=k.terrainTileForTile[We.key];rd(ze,Te)&&Jl.newMorphing(We.key,ze,Te,j,250),Z.activeTexture.set(Y.TEXTURE0),Ye.texture&&Ye.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const Ke=Jl.getMorphValuesForProxy(We.key),Xe=Ke?1:0;Ke&&d.q(ae,{morphing:{srcDemTile:Ke.from,dstDemTile:Ke.to,phase:d.bb(Ke.phase)}});const bt=d.be(We.canonical),pt=d.bf(bt.getCenter().lat),nt=d.bg(We.canonical,bt,pt,Fe.worldSize/Fe._pixelsPerMercatorPixel),Ct=d.bh(d.bi(We.canonical)),Gt=jm(Fe.expandedFarZProjMatrix,xe,ue,Ct,d.a2(Fe.zoom),ye,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,Se,ke,Fe._farZ,nt);if(se(We,Xe),X&&(k.setupElevationDraw(Ye,X,ae),R.uploadCommonUniforms(Z,X,We.toUnwrapped()),pe)){const[rn,en,mn]=pe.getGridBuffers(pt,0!==ke);X.draw(R,Ee,ce,Oe,he,d.ag.backCCW,Gt,"globe_raster",rn,en,mn)}}}if(pe&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const Fe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&Fe.push("CUSTOM_ANTIALIASING"),X=R.getOrCreateProgram("globeRaster",{defines:Fe});for(const ke of U){const{x:Ee,y:We,z:Ye}=ke.canonical,Oe=0===We,ze=We===(1<<Ye)-1,[Te,Ke,Xe,bt]=pe.getPoleBuffers(Ye,!1);if(bt&&(Oe||ze)){const pt=B.getTile(ke);Z.activeTexture.set(Y.TEXTURE0),pt.texture&&pt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let nt=d.bj(Ye,Ee,K);const Ct=d.bh(d.bi(ke.canonical)),Gt=(rn,en)=>rn.draw(R,Y.TRIANGLES,ce,d.ah.disabled,he,d.ag.disabled,jm(K.expandedFarZProjMatrix,nt,nt,Ct,0,ye,K.frustumCorners.TL,K.frustumCorners.TR,K.frustumCorners.BR,K.frustumCorners.BL,K.globeCenterInViewSpace,K.globeRadius,Se,0,K._farZ),"globe_pole_raster",en,Xe,bt);k.setupElevationDraw(pt,X,ae),R.uploadCommonUniforms(Z,X,ke.toUnwrapped()),Oe&&R.renderDefaultNorthPole&&Gt(X,Te),ze&&R.renderDefaultSouthPole&&(nt=d.ae.scale(d.ae.create(),nt,[1,-1,1]),Gt(X,Ke))}}}}(b,w,E,M,O);else{const R=b.context,k=R.gl;let B,U;const j=b.shadowRenderer,Z=Zo(b,b.longestCutoffRange),Y=he=>{if(U===he)return;const ce=[];ce.push(rp[he]),Z.shouldRenderCutoff&&ce.push("RENDER_CUTOFF"),B=b.getOrCreateProgram("terrainRaster",{defines:ce}),U=he},X=b.colorModeForRenderPass(),W=new d.af(k.LEQUAL,d.af.ReadWrite,b.depthRangeFor3D);Jl.update(O);const K=b.transform,te=Ql(K.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let se=[0,0,0];if(j){const he=b.style.directionalLight,ce=b.style.ambientLight;he&&ce&&(se=Ph(b.style,he,ce))}{U=-1;const he=k.TRIANGLES,[ce,ue]=[w.gridIndexBuffer,w.gridSegments];for(const ye of M){const pe=E.getTile(ye),Se=d.ah.disabled,xe=w.prevTerrainTileForTile[ye.key],ae=w.terrainTileForTile[ye.key];rd(xe,ae)&&Jl.newMorphing(ye.key,xe,ae,O,250),R.activeTexture.set(k.TEXTURE0),pe.texture&&pe.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Fe=Jl.getMorphValuesForProxy(ye.key),ke=Fe?1:0;let Ee;Fe&&(Ee={morphing:{srcDemTile:Fe.from,dstDemTile:Fe.to,phase:d.bb(Fe.phase)}});const We=b1(ye.projMatrix,op(ye.canonical,K.renderWorldCopies)?te/10:te,se);if(Y(ke),!B)continue;w.setupElevationDraw(pe,B,Ee);const Ye=ye.toUnwrapped();j&&j.setupShadows(Ye,B),b.uploadCommonUniforms(R,B,Ye,null,Z),B.draw(b,he,W,Se,X,d.ag.backCCW,We,"terrain_raster",w.gridBuffer,ce,ue)}}}}(h,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const h=this.painter,y=this.painter.context,b=this.proxySourceCache,w=this.proxiedCoords[b.id],E=this._drapedRenderBatches.shift(),M=h.style.order,O=[];let R=0;for(const k of w){const B=b.getTileByID(k.proxyTileKey),U=b.proxyCachedFBO[k.key]?b.proxyCachedFBO[k.key][l]:void 0,j=void 0!==U?b.renderCache[U]:this.pool[R++],Z=void 0!==U;if(B.texture=j.tex,Z&&!j.dirty){O.push(B.tileID);continue}let Y;y.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(y.clear({color:d.C.transparent,stencil:0}),j.dirty=!1);for(let X=E.start;X<=E.end;++X){const W=h.style._mergedLayers[M[X]];if(W.isHidden(h.transform.zoom))continue;const K=h.style.getLayerSourceCache(W),te=K?this.proxyToSource[k.key][K.id]:[k];if(!te)continue;const se=te;y.viewport.set([0,0,j.fb.width,j.fb.height]),Y!==(K?K.id:null)&&(this._setupStencil(j,te,W,K),Y=K?K.id:null),h.renderLayer(h,K,W,se)}if(0===this._drapedRenderBatches.length)for(const X of this._pendingGroundEffectLayers){const W=h.style._mergedLayers[M[X]];if(W.isHidden(h.transform.zoom))continue;const K=h.style.getLayerSourceCache(W),te=K?this.proxyToSource[k.key][K.id]:[k];if(!te)continue;const se=te;y.viewport.set([0,0,j.fb.width,j.fb.height]),Y!==(K?K.id:null)&&(this._setupStencil(j,te,W,K),Y=K?K.id:null),h.renderLayer(h,K,W,se)}this.renderedToTile?(j.dirty=!0,O.push(B.tileID)):Z||--R,5===R&&(R=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}isLayerOrderingCorrect(l){const h=l.order.length;let y=-1,b=h;for(let w=0;w<h;++w)this._style.isLayerDraped(l._mergedLayers[l.order[w]])?y=Math.max(y,w):b=Math.min(b,w);return b>y}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{l=Math.min(l,h.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,h,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const E=w.tileID,M=1<<E.overscaledZ,{x:O,y:R}=E.canonical,k=O/M,B=(O+1)/M,U=R/M,j=(R+1)/M;return{minx:k,miny:U,maxx:B,maxy:j,t:w.dem.tree.raycastRoot(k,U,B,j,l,h,y),tile:w}});b.sort((w,E)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const w of b){if(null==w.t)return null;const E=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,l,h,y);if(null!=E)return E}return null}_createFBO(){const l=this.painter.context,h=l.gl,y=this.drapeBufferSize;l.activeTexture.set(h.TEXTURE0);const b=new d.T(l,{width:y[0],height:y[1],data:null},h.RGBA);b.bind(h.LINEAR,h.CLAMP_TO_EDGE);const w=l.createFramebuffer(y[0],y[1],!0,null);return w.colorAttachment.set(b.texture),w.depthAttachment=new ki(l,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:w,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const h=this._style._mergedLayers[l],y=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!y&&h.shouldRedrape():!y&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const y of this._style.getSources())if(y instanceof hy){l=!0;break}if(!l)return;const h={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],w=this._style.getLayerSourceCache(b);if(w&&!h[w.id]&&!b.isHidden(this.painter.transform.zoom)&&"line"===b.type&&b.widthExpression()instanceof d.Z){h[w.id]=!0;for(const E of this.proxyCoords){const M=this.proxyToSource[E.key][w.id];if(M)for(const O of M)this._clearRenderCacheForTile(w.id,O)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof Ns){l=!0;break}if(!l)return;const h={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],w=this._style.getLayerSourceCache(b);if(!w||h[w.id]||b.isHidden(this.painter.transform.zoom)||"raster"!==b.type)continue;const E=b.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const O=this.proxyToSource[M.key][w.id];if(O)for(const R of O){const k=Hm(w.getTile(R),w.findLoadedParent(R,0),w,this.painter.transform,E);(1!==k.opacity||0!==k.mix)&&this._clearRenderCacheForTile(w.id,R)}}}}_setupDrapedRenderBatches(){const l=this._style.order,h=l.length;if(0===h)return;const y=[];this._pendingGroundEffectLayers=[];let b,w=0,E=this._style._mergedLayers[l[w]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++w<h;)E=this._style._mergedLayers[l[w]];for(;w<h;++w){const M=this._style._mergedLayers[l[w]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===b&&(b=w):("fill-extrusion"===M.type&&this._pendingGroundEffectLayers.push(w),void 0!==b&&(y.push({start:b,end:w-1}),b=void 0)))}if(void 0!==b&&y.push({start:b,end:w-1}),0!==y.length){const M=y[y.length-1];this._pendingGroundEffectLayers.every(O=>O>M.end)||d.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(l){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let M=0;M<E.length;++M){const O=Object.values(E[M]);h.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let E=y.length-1;E>=0;E--){const M=y[E];if(h.getTileByID(M.key),void 0!==h.proxyCachedFBO[M.key]){const O=l[M.key],R=this.proxyToSource[M.key];let k=0;for(const B in R){const U=R[B],j=O[B];if(!j||j.length!==U.length||U.some((Z,Y)=>Z!==j[Y]||b[B]&&b[B].hasOwnProperty(Z.key))){k=-1;break}++k}for(const B in h.proxyCachedFBO[M.key])h.renderCache[h.proxyCachedFBO[M.key][B]].dirty=k<0||k!==Object.values(O).length}}const w=[...this._drapedRenderBatches];w.sort((E,M)=>M.end-M.start-(E.end-E.start));for(const E of w)for(const M of y){if(h.proxyCachedFBO[M.key])continue;let O=h.renderCachePool.pop();void 0===O&&h.renderCache.length<50&&(O=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==O&&(h.proxyCachedFBO[M.key]={},h.proxyCachedFBO[M.key][E.start]=O,h.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(l,h,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,E=w.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let M;if(y.isTileClipped())M=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):d.ah.disabled}_renderTileClippingMasks(l,h){const y=this.painter,b=this.painter.context,w=b.gl;y._tileClippingMaskIDs={},b.setColorMode(d.a.disabled),b.setDepthMode(d.af.disabled);const E=y.getOrCreateProgram("clippingMask");for(const M of l){const O=y._tileClippingMaskIDs[M.key]=--h;E.draw(y,w.TRIANGLES,d.af.disabled,new d.ah({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),d.a.disabled,d.ag.disabled,Rh(M.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(l){const h=this.painter.transform;if(l.x<0||l.x>h.width||l.y<0||l.y>h.height)return null;const y=[l.x,l.y,1,1];d.aB.transformMat4(y,y,h.pixelMatrixInverse),d.aB.scale(y,y,1/y[3]),y[0]/=h.worldSize,y[1]/=h.worldSize;const b=h._camera.position,w=d.ay(1,h.center.lat),E=[b[0],b[1],b[2]/w,0],M=d.$.subtract([],y.slice(0,3),E);d.$.normalize(M,M);const O=this.raycast(E,M,this._exaggeration);return null!==O&&O?(d.$.scaleAndAdd(E,E,M,O),E[3]=E[2],E[2]*=w,E):null}_setupProxiedCoordsForOrtho(l,h,y){if(l.getSource()instanceof d.bo)return this._setupProxiedCoordsForImageSource(l,h,y);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const b=this.proxiedCoords[l.id]=[],w=this.proxyCoords;for(let O=0;O<w.length;O++){const R=w[O],k=this._findTileCoveringTileID(R,l);if(k){const B=this._createProxiedId(R,k,y[R.key]&&y[R.key][l.id]);b.push(B),this.proxyToSource[R.key][l.id]=[B]}}let E=!1;const M=new Set;for(let O=0;O<h.length;O++){const R=l.getTile(h[O]);if(!R||!R.hasData())continue;const k=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==R.tileID.canonical.z){const B=this.proxyToSource[k.tileID.key][l.id],U=this._createProxiedId(k.tileID,R,y[k.tileID.key]&&y[k.tileID.key][l.id]);B?B.splice(B.length-1,0,U):this.proxyToSource[k.tileID.key][l.id]=[U];const j=this.proxyToSource[k.tileID.key][l.id];M.has(j)||M.add(j),b.push(U),E=!0}}if(this._sourceTilesOverlap[l.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const O of M)O.sort((R,k)=>k.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(l,h,y){if(!l.getSource().loaded())return;const b=this.proxiedCoords[l.id]=[],w=this.proxyCoords,E=l.getSource(),M=E.tileID;if(!M)return;const O=new d.P(M.x,M.y)._div(1<<M.z),R=E.coordinates.map(d._.fromLngLat).reduce((B,U)=>(B.min.x=Math.min(B.min.x,U.x-O.x),B.min.y=Math.min(B.min.y,U.y-O.y),B.max.x=Math.max(B.max.x,U.x-O.x),B.max.y=Math.max(B.max.y,U.y-O.y),B),{min:new d.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(B,U)=>{const j=B.wrap+B.canonical.x/(1<<B.canonical.z),Z=B.canonical.y/(1<<B.canonical.z),Y=d.a4/(1<<B.canonical.z),X=U.wrap+U.canonical.x/(1<<U.canonical.z),W=U.canonical.y/(1<<U.canonical.z);return j+Y<X+R.min.x||j>X+R.max.x||Z+Y<W+R.min.y||Z>W+R.max.y};for(let B=0;B<w.length;B++){const U=w[B];for(let j=0;j<h.length;j++){const Z=l.getTile(h[j]);if(!Z||!Z.hasData()||k(U,Z.tileID))continue;const Y=this._createProxiedId(U,Z,y[U.key]&&y[U.key][l.id]),X=this.proxyToSource[U.key][l.id];X?X.push(Y):this.proxyToSource[U.key][l.id]=[Y],b.push(Y)}}}_createProxiedId(l,h,y){let b=this.orthoMatrix;if(y){const w=y.find(E=>E.key===h.tileID.key);if(w)return w}if(h.tileID.key!==l.key){const w=l.canonical.z-h.tileID.canonical.z;let E,M,O;b=d.ae.create();const R=h.tileID.wrap-l.wrap<<l.overscaledZ;w>0?(E=d.a4>>w,M=E*((h.tileID.canonical.x<<w)-l.canonical.x+R),O=E*((h.tileID.canonical.y<<w)-l.canonical.y)):(E=d.a4<<-w,M=d.a4*(h.tileID.canonical.x-(l.canonical.x+R<<-w)),O=d.a4*(h.tileID.canonical.y-(l.canonical.y<<-w))),d.ae.ortho(b,0,E,0,E,0,1),d.ae.translate(b,b,[M,O,0])}return new gy(h.tileID,l.key,b)}_findTileCoveringTileID(l,h){let y=h.getTile(l);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[h.id],w=b[l.key];if(y=w?h.getTileByID(w):null,y&&y.hasData()||null===w)return y;let E=y?y.tileID:l,M=E.overscaledZ;const O=h.getSource().minzoom,R=[];if(!w){const B=h.getSource().maxzoom;if(l.canonical.z>=B){const U=l.canonical.z-B;h.getSource().reparseOverscaled?(M=Math.max(l.canonical.z+2,h.transform.tileZoom),E=new d.aQ(M,l.wrap,B,l.canonical.x>>U,l.canonical.y>>U)):0!==U&&(M=B,E=new d.aQ(M,l.wrap,B,l.canonical.x>>U,l.canonical.y>>U))}E.key!==l.key&&(R.push(E.key),y=h.getTile(E))}const k=B=>{R.forEach(U=>{b[U]=B}),R.length=0};for(M-=1;M>=O&&(!y||!y.hasData());M--){y&&k(y.tileID.key);const B=E.calculateScaledKey(M);if(y=h.getTileByID(B),y&&y.hasData())break;const U=b[B];if(null===U)break;void 0===U?R.push(B):y=h.getTileByID(U)}return k(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,h){let y=this._tilesDirty[l];y||(y=this._tilesDirty[l]={}),y[h.key]=!0}}function qm(g,l,h){const y=function(M,O,R){const k=d.$.dot(O,M),B=d.$.dot(R,[.2126,.7152,.0722]),U=(Z,Y,X)=>(1-X)*Z+X*Y,j=U(1-.3*Math.min(B,1),1,Math.min(k+1,1));return U(.92,1,Math.asin(d.au(O[2],-1,1))/Math.PI+.5)*j}(g,[0,0,1],l),b=[0,0,0];d.$.scale(b,h.slice(0,3),y);const w=[0,0,0];d.$.scale(w,l.slice(0,3),g[2]);const E=[0,0,0];return d.$.add(E,b,w),d.ba(E)}const Nh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],_y=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Wm{static cacheKey(l,h,y,b){let w=`${h}${b?b.cacheKey:""}`;for(const E of y)l.usedDefines.includes(E)&&(w+=`/${E}`);return w}constructor(l,h,y,b,w,E){const M=l.gl;this.program=M.createProgram(),this.configuration=b,this.name=h,this.fixedDefines=[...E];const O=b?b.getBinderAttributes():[],R=(y.staticAttributes||[]).concat(O);let k=b?b.defines():[];k=k.concat(E.map(X=>`#define ${X}`));const B="#version 300 es\n";let U=B+k.concat("precision mediump float;",cy,Yf.fragmentSource).join("\n");for(const X of y.fragmentIncludes)U+=`\n${Wf[X]}`;U+=`\n${y.fragmentSource}`;let j=B+k.concat("precision highp float;",cy,Yf.vertexSource).join("\n");for(const X of y.vertexIncludes)j+=`\n${Wf[X]}`;j+=`\n${y.vertexSource}`;const Z=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Z,U),M.compileShader(Z),M.attachShader(this.program,Z);const Y=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Y,j),M.compileShader(Y),M.attachShader(this.program,Y),this.attributes={},this.numAttributes=R.length;for(let X=0;X<this.numAttributes;X++)if(R[X]){const W=R[X].startsWith("a_")?R[X]:`a_${R[X]}`;M.bindAttribLocation(this.program,X,W),this.attributes[W]=X}M.linkProgram(this.program),M.deleteShader(Y),M.deleteShader(Z),this.fixedUniforms=w(l),this.binderUniforms=b?b.getUniforms(l):[],(E.includes("TERRAIN")||-1!==h.indexOf("symbol")||-1!==h.indexOf("circle"))&&(this.terrainUniforms={u_dem:new d.a8(X=l),u_dem_prev:new d.a8(X),u_dem_tl:new d.a9(X),u_dem_scale:new d.ab(X),u_dem_tl_prev:new d.a9(X),u_dem_scale_prev:new d.ab(X),u_dem_size:new d.ab(X),u_dem_lerp:new d.ab(X),u_exaggeration:new d.ab(X),u_depth:new d.a8(X),u_depth_size_inv:new d.a9(X),u_depth_range_unpack:new d.a9(X),u_occluder_half_size:new d.ab(X),u_occlusion_depth_offset:new d.ab(X),u_meter_to_dem:new d.ab(X),u_label_plane_matrix_inv:new d.a7(X)}),E.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new d.ar(X),u_tile_tr_up:new d.ar(X),u_tile_br_up:new d.ar(X),u_tile_bl_up:new d.ar(X),u_tile_up_scale:new d.ab(X)}))(l)),E.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new d.a7(X),u_fog_range:new d.a9(X),u_fog_color:new d.at(X),u_fog_horizon_blend:new d.ab(X),u_fog_vertical_limit:new d.a9(X),u_fog_temporal_offset:new d.ab(X),u_frustum_tl:new d.ar(X),u_frustum_tr:new d.ar(X),u_frustum_br:new d.ar(X),u_frustum_bl:new d.ar(X),u_globe_pos:new d.ar(X),u_globe_radius:new d.ab(X),u_globe_transition:new d.ab(X),u_is_globe:new d.a8(X),u_viewport:new d.a9(X)}))(l)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new d.at(X)}))(l)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new d.ar(X),u_lighting_directional_dir:new d.ar(X),u_lighting_directional_color:new d.ar(X),u_ground_radiance:new d.ar(X)}))(l)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new d.a7(X),u_light_matrix_1:new d.a7(X),u_fade_range:new d.a9(X),u_shadow_normal_offset:new d.ar(X),u_shadow_intensity:new d.ab(X),u_shadow_texel_size:new d.ab(X),u_shadow_map_resolution:new d.ab(X),u_shadow_direction:new d.ar(X),u_shadow_bias:new d.ar(X),u_shadowmap_0:new d.a8(X),u_shadowmap_1:new d.a8(X)}))(l))}var X}setTerrainUniformValues(l,h){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in h)y[b]&&y[b].set(this.program,b,h[b])}}setGlobeUniformValues(l,h){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in h)y[b]&&y[b].set(this.program,b,h[b])}}setFogUniformValues(l,h){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in h)y[b].set(this.program,b,h[b])}}setCutoffUniformValues(l,h){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in h)y[b].set(this.program,b,h[b])}}setLightsUniformValues(l,h){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in h)y[b].set(this.program,b,h[b])}}setShadowUniformValues(l,h){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;l.program.set(this.program);for(const b in h)y[b].set(this.program,b,h[b])}_drawDebugWireframe(l,h,y,b,w,E,M,O,R,k){const B=l.options.wireframe;if(!1===B.terrain&&!1===B.layers2D&&!1===B.layers3D)return;const U=l.context;if(!(B.terrain&&("terrainRaster"===this.name||"globeRaster"===this.name)||!(!B.layers2D||l._terrain&&l._terrain.renderingToTexture)&&Nh.includes(this.name)||B.layers3D&&_y.includes(this.name)))return;const j=U.gl,Z=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,w,U);if(!Z)return;const Y=[...this.fixedDefines];Y.push("DEBUG_WIREFRAME");const X=l.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});U.program.set(X.program);const W=(se,he,ce)=>{if(he[se]&&ce[se])for(const ue in he[se])ce[se][ue]&&ce[se][ue].set(ce.program,ue,he[se][ue].current)};R&&R.setUniforms(X.program,U,X.binderUniforms,M,{zoom:O}),W("fixedUniforms",this,X),W("terrainUniforms",this,X),W("globeUniforms",this,X),W("fogUniforms",this,X),W("lightsUniforms",this,X),W("shadowUniforms",this,X),Z.bind(),U.setColorMode(new d.a([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],d.C.transparent,[!0,!0,!0,!1])),U.setDepthMode(new d.af(h.func===j.LESS?j.LEQUAL:h.func,d.af.ReadOnly,h.range)),U.setStencilMode(d.ah.disabled);const K=3*E.primitiveLength*2,te=3*E.primitiveOffset*2*2;k&&k>1?j.drawElementsInstanced(j.LINES,K,j.UNSIGNED_SHORT,te,k):j.drawElements(j.LINES,K,j.UNSIGNED_SHORT,te),w.bind(),U.program.set(this.program),U.setDepthMode(h),U.setStencilMode(y),U.setColorMode(b)}draw(l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X){const W=l.context,K=W.gl;if(this.failedToCreate)return;W.program.set(this.program),W.setDepthMode(y),W.setStencilMode(b),W.setColorMode(w),W.setCullFace(E);for(const he of Object.keys(this.fixedUniforms))this.fixedUniforms[he].set(this.program,he,M[he]);Z&&Z.setUniforms(this.program,W,this.binderUniforms,U,{zoom:j});const te={[K.POINTS]:1,[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[h],se=X&&X>0?1:void 0;for(const he of B.get()){const ce=he.vaos||(he.vaos={});(ce[O]||(ce[O]=new y1)).bind(W,this,R,Z?Z.getPaintVertexBuffers():[],k,he.vertexOffset,Y||[],se),X&&X>1?K.drawElementsInstanced(h,he.primitiveLength*te,K.UNSIGNED_SHORT,he.primitiveOffset*te*2,X):k?K.drawElements(h,he.primitiveLength*te,K.UNSIGNED_SHORT,he.primitiveOffset*te*2):K.drawArrays(h,he.vertexOffset,he.vertexLength),h===K.TRIANGLES&&k&&this._drawDebugWireframe(l,y,b,w,k,he,U,j,Z,X)}}}function Zm(g,l){const h=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,g.transform.tileZoom)/h,b=y*(l.tileID.canonical.x+l.tileID.wrap*h),w=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/d.bD(l,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w]}}const Ym=d.ae.create(),ml=(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X,W)=>{const K=l.style.light,te=K.properties.get("position"),se=[te.x,te.y,te.z],he=d.bE.create();"viewport"===K.properties.get("anchor")&&(d.bE.fromRotation(he,-l.transform.angle),d.$.transformMat3(se,se,he));const ce=K.properties.get("color"),ue=l.transform,ye={u_matrix:g,u_lightpos:se,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_vertical_gradient:+h,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ym,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:w,u_alignment:E,u_width_scale:M,u_flood_light_color:j,u_vertical_scale:Z,u_flood_light_intensity:Y,u_ground_shadow_factor:X,u_emissive_strength:W};return"globe"===ue.projection.name&&(ye.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],ye.u_zoom_transition=k,ye.u_inv_rot_matrix=U,ye.u_merc_center=B,ye.u_up_dir=ue.projection.upVector(new d.aO(0,0,0),B[0]*d.a4,B[1]*d.a4),ye.u_height_lift=R),ye},Xm=(g,l,h,y,b)=>({u_matrix:g,u_edge_radius:l,u_alignment:h,u_width_scale:y,u_vertical_scale:b}),x1=(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y)=>{const X=ml(g,l,h,y,b,w,E,M,O,k,B,U,j,Z,Y,1,[0,0,0],0),W={u_height_factor:-Math.pow(2,O.overscaledZ)/R.tileSize/8};return d.Q(X,Zm(l,R),W)},lp=(g,l)=>({u_matrix:g,u_emissive_strength:l}),Km=(g,l,h,y)=>d.Q(lp(g,l),Zm(h,y)),Jm=(g,l,h)=>({u_matrix:g,u_world:h,u_emissive_strength:l}),cp=(g,l,h,y,b)=>d.Q(Km(g,l,h,y),{u_world:b}),kh=(g,l,h,y)=>{const b=d.a4/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(y),u_extrude_scale:[l.pixelsToGLUnits[0]/b,l.pixelsToGLUnits[1]/b]}},Fh=(g,l,h=1)=>({u_matrix:g,u_color:l.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),wt=d.ae.create(),iu=(g,l,h,y,b,w,E)=>{const M=g.transform,O="globe"===M.projection.name,R=O?d.bF(M.zoom,l.canonical)*M._pixelsPerMercatorPixel:d.bD(h,1,w),k={u_matrix:l.projMatrix,u_extrude_scale:R,u_intensity:E,u_inv_rot_matrix:wt,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){k.u_inv_rot_matrix=y,k.u_merc_center=b,k.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],k.u_zoom_transition=d.a2(M.zoom);const B=b[0]*d.a4,U=b[1]*d.a4;k.u_up_dir=M.projection.upVector(new d.aO(0,0,0),B,U)}return k};function od(g,[l,h,y,b],[w,E]){if(w===E)return[0,0,0,0];const M=255*(g-1)/(g*(E-w));return[l*M,h*M,y*M,b*M]}function sd(g,l,[h,y]){return h===y?0:.5/g+(l-h)*(g-1)/(g*(y-h))}const Qm=(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X,W,K,te,se)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:w,u_scale_parent:R,u_fade_t:k.mix,u_opacity:k.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:d.bG(B.paint.get("raster-saturation")),u_contrast_factor:d.bH(B.paint.get("raster-contrast")),u_spin_weights:yy(B.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:j,u_zoom_transition:E,u_merc_center:M,u_cutoff_params:O,u_colorization_mix:od(d.bI,Y,W),u_colorization_offset:sd(d.bI,X,W),u_color_ramp:Z,u_texture_offset:[te/(K+2*te),K/(K+2*te)],u_texture_res:[K+2*te,K+2*te],u_emissive_strength:se});function yy(g){g*=Math.PI/180;const l=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}const wa=.05,Yo=(g,l,h,y,b,w,E,M,O,R,k,B)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:w,u_scale_parent:R,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:E,u_merc_center:M,u_cutoff_params:O}),ad=(g,l,h,y,b,w,E,M,O,R)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_tile_offset:h,u_velocity:y,u_color_ramp:w,u_velocity_res:b,u_max_speed:E,u_uv_offset:M,u_data_scale:[255*O[0],255*O[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[wa,wa]}),ru=(g,l,h,y,b,w,E,M,O,R)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_velocity:h,u_velocity_res:y,u_max_speed:b,u_speed_factor:w,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*O[0],255*O[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[wa,wa]}),Ga=d.ae.create(),ou=(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X,W)=>{const K=b.transform,te={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:K.getCameraToCenterDistance(Y),u_rotate_symbol:+h,u_aspect_ratio:K.width/K.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+O,u_pitch_with_map:+y,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ga,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ga,u_up_vector:[0,-1,0],u_color_adj_mat:X,u_icon_transition:W||0};return"globe"===Y.name&&(te.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],te.u_zoom_transition=B,te.u_inv_rot_matrix=j,te.u_merc_center=U,te.u_camera_forward=K._camera.forward(),te.u_ecef_origin=d.bJ(K.globeMatrix,k.toUnwrapped()),te.u_tile_matrix=Float32Array.from(K.globeMatrix),te.u_up_vector=Z),te},su=(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X)=>d.Q(ou(g,l,h,y,b,w,E,M,O,R,B,U,j,Z,Y,X),{u_gamma_scale:y?b.transform.getCameraToCenterDistance(X)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:d.e.devicePixelRatio,u_is_halo:+k,undefined:void 0}),nc=(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y)=>d.Q(su(g,l,h,y,b,w,E,M,!0,O,!0,k,B,U,j,Z,Y),{u_texsize_icon:R,u_texture_icon:1}),vy=(g,l,h,y)=>({u_matrix:g,u_emissive_strength:l,u_opacity:h,u_color:y}),Yi=(g,l,h,y,b,w,E,M)=>d.Q(function(O,R,k,B,U){const{width:j,height:Z}=B.imageManager.getPixelSize(R),Y=Math.pow(2,U.tileID.overscaledZ),X=U.tileSize*Math.pow(2,B.transform.tileZoom)/Y,W=X*(U.tileID.canonical.x+U.tileID.wrap*Y),K=X*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[j,Z],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/d.bD(U,1,B.transform.tileZoom),u_pixel_coord_upper:[W>>16,K>>16],u_pixel_coord_lower:[65535&W,65535&K]}}(0,w,E,y,M),{u_matrix:g,u_emissive_strength:l,u_opacity:h}),Ca=new Float32Array(d.ae.identity([])),ld=(g,l,h,y,b,w,E,M,O,R,k,B,U,j=[0,0,0],Z)=>{const Y=b.style.light,X=Y.properties.get("position"),W=[-X.x,-X.y,X.z],K=d.bE.create();"viewport"===Y.properties.get("anchor")&&(d.bE.fromRotation(K,-b.transform.angle),d.$.transformMat3(W,W,K));const te="MASK"===k.alphaMode,se=Y.properties.get("color").toRenderColor(null),he=U.paint.get("model-ambient-occlusion-intensity"),ce=U.paint.get("model-color").constantOr(d.C.white).toRenderColor(null),ue=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:h,u_node_matrix:y||Ca,u_lightpos:W,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[se.r,se.g,se.b],u_camera_pos:j,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+te,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:O,u_roughnessFactor:R,u_baseColorTexture:qr.BaseColor,u_metallicRoughnessTexture:qr.MetallicRoughness,u_normalTexture:qr.Normal,u_occlusionTexture:qr.Occlusion,u_emissionTexture:qr.Emission,u_lutTexture:qr.LUT,u_color_mix:[ce.r,ce.g,ce.b,ue],u_aoIntensity:he,u_emissive_strength:B,u_occlusionTextureTransform:Z||[0,0,0,0]}},Li=(g,l=Ca,h=Ca)=>({u_matrix:g,u_instance:l,u_node_matrix:h}),by={fillExtrusion:g=>({u_matrix:new d.a7(g),u_lightpos:new d.ar(g),u_lightintensity:new d.ab(g),u_lightcolor:new d.ar(g),u_vertical_gradient:new d.ab(g),u_opacity:new d.ab(g),u_edge_radius:new d.ab(g),u_alignment:new d.ab(g),u_width_scale:new d.ab(g),u_ao:new d.a9(g),u_tile_id:new d.ar(g),u_zoom_transition:new d.ab(g),u_inv_rot_matrix:new d.a7(g),u_merc_center:new d.a9(g),u_up_dir:new d.ar(g),u_height_lift:new d.ab(g),u_flood_light_color:new d.ar(g),u_vertical_scale:new d.ab(g),u_flood_light_intensity:new d.ab(g),u_ground_shadow_factor:new d.ar(g),u_emissive_strength:new d.ab(g)}),fillExtrusionDepth:g=>({u_matrix:new d.a7(g),u_edge_radius:new d.ab(g),u_alignment:new d.ab(g),u_width_scale:new d.ab(g),u_vertical_scale:new d.ab(g)}),fillExtrusionPattern:g=>({u_matrix:new d.a7(g),u_lightpos:new d.ar(g),u_lightintensity:new d.ab(g),u_lightcolor:new d.ar(g),u_vertical_gradient:new d.ab(g),u_height_factor:new d.ab(g),u_edge_radius:new d.ab(g),u_alignment:new d.ab(g),u_width_scale:new d.ab(g),u_ao:new d.a9(g),u_tile_id:new d.ar(g),u_zoom_transition:new d.ab(g),u_inv_rot_matrix:new d.a7(g),u_merc_center:new d.a9(g),u_up_dir:new d.ar(g),u_height_lift:new d.ab(g),u_image:new d.a8(g),u_texsize:new d.a9(g),u_pixel_coord_upper:new d.a9(g),u_pixel_coord_lower:new d.a9(g),u_tile_units_to_pixels:new d.ab(g),u_opacity:new d.ab(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new d.a7(g),u_opacity:new d.ab(g),u_ao_pass:new d.ab(g),u_meter_to_tile:new d.ab(g),u_ao:new d.a9(g),u_flood_light_intensity:new d.ab(g),u_flood_light_color:new d.ar(g),u_attenuation:new d.ab(g),u_edge_radius:new d.ab(g),u_fb:new d.a8(g),u_fb_size:new d.ab(g)}),fill:g=>({u_matrix:new d.a7(g),u_emissive_strength:new d.ab(g)}),fillPattern:g=>({u_matrix:new d.a7(g),u_emissive_strength:new d.ab(g),u_image:new d.a8(g),u_texsize:new d.a9(g),u_pixel_coord_upper:new d.a9(g),u_pixel_coord_lower:new d.a9(g),u_tile_units_to_pixels:new d.ab(g)}),fillOutline:g=>({u_matrix:new d.a7(g),u_emissive_strength:new d.ab(g),u_world:new d.a9(g)}),fillOutlinePattern:g=>({u_matrix:new d.a7(g),u_emissive_strength:new d.ab(g),u_world:new d.a9(g),u_image:new d.a8(g),u_texsize:new d.a9(g),u_pixel_coord_upper:new d.a9(g),u_pixel_coord_lower:new d.a9(g),u_tile_units_to_pixels:new d.ab(g)}),circle:d.bK,collisionBox:g=>({u_matrix:new d.a7(g),u_camera_to_center_distance:new d.ab(g),u_extrude_scale:new d.a9(g)}),collisionCircle:g=>({u_matrix:new d.a7(g),u_inv_matrix:new d.a7(g),u_camera_to_center_distance:new d.ab(g),u_viewport_size:new d.a9(g)}),debug:g=>({u_color:new d.aa(g),u_matrix:new d.a7(g),u_overlay:new d.a8(g),u_overlay_scale:new d.ab(g)}),clippingMask:g=>({u_matrix:new d.a7(g)}),heatmap:g=>({u_extrude_scale:new d.ab(g),u_intensity:new d.ab(g),u_matrix:new d.a7(g),u_inv_rot_matrix:new d.a7(g),u_merc_center:new d.a9(g),u_tile_id:new d.ar(g),u_zoom_transition:new d.ab(g),u_up_dir:new d.ar(g)}),heatmapTexture:g=>({u_image:new d.a8(g),u_color_ramp:new d.a8(g),u_opacity:new d.ab(g)}),hillshade:g=>({u_matrix:new d.a7(g),u_image:new d.a8(g),u_latrange:new d.a9(g),u_light:new d.a9(g),u_shadow:new d.aa(g),u_highlight:new d.aa(g),u_emissive_strength:new d.ab(g),u_accent:new d.aa(g)}),hillshadePrepare:g=>({u_matrix:new d.a7(g),u_image:new d.a8(g),u_dimension:new d.a9(g),u_zoom:new d.ab(g)}),line:d.bL,linePattern:d.bM,raster:g=>({u_matrix:new d.a7(g),u_normalize_matrix:new d.a7(g),u_globe_matrix:new d.a7(g),u_merc_matrix:new d.a7(g),u_grid_matrix:new d.as(g),u_tl_parent:new d.a9(g),u_scale_parent:new d.ab(g),u_fade_t:new d.ab(g),u_opacity:new d.ab(g),u_image0:new d.a8(g),u_image1:new d.a8(g),u_brightness_low:new d.ab(g),u_brightness_high:new d.ab(g),u_saturation_factor:new d.ab(g),u_contrast_factor:new d.ab(g),u_spin_weights:new d.ar(g),u_perspective_transform:new d.a9(g),u_raster_elevation:new d.ab(g),u_zoom_transition:new d.ab(g),u_merc_center:new d.a9(g),u_cutoff_params:new d.at(g),u_colorization_mix:new d.at(g),u_colorization_offset:new d.ab(g),u_color_ramp:new d.a8(g),u_texture_offset:new d.a9(g),u_texture_res:new d.a9(g),u_emissive_strength:new d.ab(g)}),rasterParticle:g=>({u_matrix:new d.a7(g),u_normalize_matrix:new d.a7(g),u_globe_matrix:new d.a7(g),u_merc_matrix:new d.a7(g),u_grid_matrix:new d.as(g),u_tl_parent:new d.a9(g),u_scale_parent:new d.ab(g),u_fade_t:new d.ab(g),u_opacity:new d.ab(g),u_image0:new d.a8(g),u_image1:new d.a8(g),u_raster_elevation:new d.ab(g),u_zoom_transition:new d.ab(g),u_merc_center:new d.a9(g),u_cutoff_params:new d.at(g)}),rasterParticleTexture:g=>({u_texture:new d.a8(g),u_opacity:new d.ab(g)}),rasterParticleDraw:g=>({u_particle_texture:new d.a8(g),u_particle_texture_side_len:new d.ab(g),u_tile_offset:new d.a9(g),u_velocity:new d.a8(g),u_color_ramp:new d.a8(g),u_velocity_res:new d.a9(g),u_max_speed:new d.ab(g),u_uv_offset:new d.a9(g),u_data_scale:new d.a9(g),u_data_offset:new d.ab(g),u_particle_pos_scale:new d.ab(g),u_particle_pos_offset:new d.a9(g)}),rasterParticleUpdate:g=>({u_particle_texture:new d.a8(g),u_particle_texture_side_len:new d.ab(g),u_velocity:new d.a8(g),u_velocity_res:new d.a9(g),u_max_speed:new d.ab(g),u_speed_factor:new d.ab(g),u_reset_rate:new d.ab(g),u_rand_seed:new d.ab(g),u_uv_offset:new d.a9(g),u_data_scale:new d.a9(g),u_data_offset:new d.ab(g),u_particle_pos_scale:new d.ab(g),u_particle_pos_offset:new d.a9(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new d.a8(g),u_is_size_feature_constant:new d.a8(g),u_size_t:new d.ab(g),u_size:new d.ab(g),u_camera_to_center_distance:new d.ab(g),u_rotate_symbol:new d.a8(g),u_aspect_ratio:new d.ab(g),u_fade_change:new d.ab(g),u_matrix:new d.a7(g),u_label_plane_matrix:new d.a7(g),u_coord_matrix:new d.a7(g),u_is_text:new d.a8(g),u_pitch_with_map:new d.a8(g),u_texsize:new d.a9(g),u_tile_id:new d.ar(g),u_zoom_transition:new d.ab(g),u_inv_rot_matrix:new d.a7(g),u_merc_center:new d.a9(g),u_camera_forward:new d.ar(g),u_tile_matrix:new d.a7(g),u_up_vector:new d.ar(g),u_ecef_origin:new d.ar(g),u_texture:new d.a8(g),u_icon_transition:new d.ab(g),u_color_adj_mat:new d.a7(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new d.a8(g),u_is_size_feature_constant:new d.a8(g),u_size_t:new d.ab(g),u_size:new d.ab(g),u_camera_to_center_distance:new d.ab(g),u_rotate_symbol:new d.a8(g),u_aspect_ratio:new d.ab(g),u_fade_change:new d.ab(g),u_matrix:new d.a7(g),u_label_plane_matrix:new d.a7(g),u_coord_matrix:new d.a7(g),u_is_text:new d.a8(g),u_pitch_with_map:new d.a8(g),u_texsize:new d.a9(g),u_texture:new d.a8(g),u_gamma_scale:new d.ab(g),u_device_pixel_ratio:new d.ab(g),u_tile_id:new d.ar(g),u_zoom_transition:new d.ab(g),u_inv_rot_matrix:new d.a7(g),u_merc_center:new d.a9(g),u_camera_forward:new d.ar(g),u_tile_matrix:new d.a7(g),u_up_vector:new d.ar(g),u_ecef_origin:new d.ar(g),u_is_halo:new d.a8(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new d.a8(g),u_is_size_feature_constant:new d.a8(g),u_size_t:new d.ab(g),u_size:new d.ab(g),u_camera_to_center_distance:new d.ab(g),u_rotate_symbol:new d.a8(g),u_aspect_ratio:new d.ab(g),u_fade_change:new d.ab(g),u_matrix:new d.a7(g),u_label_plane_matrix:new d.a7(g),u_coord_matrix:new d.a7(g),u_is_text:new d.a8(g),u_pitch_with_map:new d.a8(g),u_texsize:new d.a9(g),u_texsize_icon:new d.a9(g),u_texture:new d.a8(g),u_texture_icon:new d.a8(g),u_gamma_scale:new d.ab(g),u_device_pixel_ratio:new d.ab(g),u_is_halo:new d.a8(g)}),background:g=>({u_matrix:new d.a7(g),u_emissive_strength:new d.ab(g),u_opacity:new d.ab(g),u_color:new d.aa(g)}),backgroundPattern:g=>({u_matrix:new d.a7(g),u_emissive_strength:new d.ab(g),u_opacity:new d.ab(g),u_image:new d.a8(g),u_pattern_tl:new d.a9(g),u_pattern_br:new d.a9(g),u_texsize:new d.a9(g),u_pattern_size:new d.a9(g),u_pixel_coord_upper:new d.a9(g),u_pixel_coord_lower:new d.a9(g),u_tile_units_to_pixels:new d.ab(g)}),terrainRaster:g=>({u_matrix:new d.a7(g),u_image0:new d.a8(g),u_skirt_height:new d.ab(g),u_ground_shadow_factor:new d.ar(g)}),skybox:g=>({u_matrix:new d.a7(g),u_sun_direction:new d.ar(g),u_cubemap:new d.a8(g),u_opacity:new d.ab(g),u_temporal_offset:new d.ab(g)}),skyboxGradient:g=>({u_matrix:new d.a7(g),u_color_ramp:new d.a8(g),u_center_direction:new d.ar(g),u_radius:new d.ab(g),u_opacity:new d.ab(g),u_temporal_offset:new d.ab(g)}),skyboxCapture:g=>({u_matrix_3f:new d.as(g),u_sun_direction:new d.ar(g),u_sun_intensity:new d.ab(g),u_color_tint_r:new d.at(g),u_color_tint_m:new d.at(g),u_luminance:new d.ab(g)}),globeRaster:g=>({u_proj_matrix:new d.a7(g),u_globe_matrix:new d.a7(g),u_normalize_matrix:new d.a7(g),u_merc_matrix:new d.a7(g),u_zoom_transition:new d.ab(g),u_merc_center:new d.a9(g),u_image0:new d.a8(g),u_grid_matrix:new d.as(g),u_skirt_height:new d.ab(g),u_far_z_cutoff:new d.ab(g),u_frustum_tl:new d.ar(g),u_frustum_tr:new d.ar(g),u_frustum_br:new d.ar(g),u_frustum_bl:new d.ar(g),u_globe_pos:new d.ar(g),u_globe_radius:new d.ab(g),u_viewport:new d.a9(g)}),globeAtmosphere:g=>({u_frustum_tl:new d.ar(g),u_frustum_tr:new d.ar(g),u_frustum_br:new d.ar(g),u_frustum_bl:new d.ar(g),u_horizon:new d.ab(g),u_transition:new d.ab(g),u_fadeout_range:new d.ab(g),u_color:new d.at(g),u_high_color:new d.at(g),u_space_color:new d.at(g),u_temporal_offset:new d.ab(g),u_horizon_angle:new d.ab(g)}),model:g=>({u_matrix:new d.a7(g),u_lighting_matrix:new d.a7(g),u_normal_matrix:new d.a7(g),u_node_matrix:new d.a7(g),u_lightpos:new d.ar(g),u_lightintensity:new d.ab(g),u_lightcolor:new d.ar(g),u_camera_pos:new d.ar(g),u_opacity:new d.ab(g),u_baseColorFactor:new d.at(g),u_emissiveFactor:new d.at(g),u_metallicFactor:new d.ab(g),u_roughnessFactor:new d.ab(g),u_baseTextureIsAlpha:new d.a8(g),u_alphaMask:new d.a8(g),u_alphaCutoff:new d.ab(g),u_baseColorTexture:new d.a8(g),u_metallicRoughnessTexture:new d.a8(g),u_normalTexture:new d.a8(g),u_occlusionTexture:new d.a8(g),u_emissionTexture:new d.a8(g),u_lutTexture:new d.a8(g),u_color_mix:new d.at(g),u_aoIntensity:new d.ab(g),u_emissive_strength:new d.ab(g),u_occlusionTextureTransform:new d.at(g)}),modelDepth:g=>({u_matrix:new d.a7(g),u_instance:new d.a7(g),u_node_matrix:new d.a7(g)}),groundShadow:g=>({u_matrix:new d.a7(g),u_ground_shadow_factor:new d.ar(g)}),stars:g=>({u_matrix:new d.a7(g),u_up:new d.ar(g),u_right:new d.ar(g),u_intensity_multiplier:new d.ab(g)}),occlusion:g=>({u_matrix:new d.a7(g),u_anchorPos:new d.ar(g),u_screenSizePx:new d.a9(g),u_occluderSizePx:new d.a9(g),u_color:new d.at(g)})};function sr(g,l,h){const y=l.createTileMatrix(g,g.worldSize,h.toUnwrapped());return d.ae.multiply(new Float32Array(16),g.projMatrix,y)}function up(g,l,h){if(l.projection.name===h.projection.name)return g.projMatrix;const y=h.clone();return y.setProjection(l.projection),sr(y,l.getProjection(),g)}function xy(g,l,h){return l.name===h.projection.name?g.projMatrix:sr(h,l,g)}let cd;function Oi(g,l,h,y,b,w,E){const M=g.context,O=M.gl,R=g.transform,k=g.getOrCreateProgram("collisionBox"),B=[];let U=0,j=0;for(let se=0;se<y.length;se++){const he=y[se],ce=l.getTile(he),ue=ce.getBucket(h);if(!ue)continue;const ye=up(he,ue,R);let pe=ye;0===b[0]&&0===b[1]||(pe=g.translatePosMatrix(ye,ce,b,w));const Se=E?ue.textCollisionBox:ue.iconCollisionBox,xe=ue.collisionCircleArray;if(xe.length>0){const ae=d.ae.create(),Fe=pe;d.ae.mul(ae,ue.placementInvProjMatrix,R.glCoordMatrix),d.ae.mul(ae,ae,ue.placementViewportMatrix),B.push({circleArray:xe,circleOffset:j,transform:Fe,invTransform:ae,projection:ue.getProjection()}),U+=xe.length/4,j=U}Se&&(g.terrain&&g.terrain.setupElevationDraw(ce,k),k.draw(g,O.LINES,d.af.disabled,d.ah.disabled,g.colorModeForRenderPass(),d.ag.disabled,kh(pe,R,ce,ue.getProjection()),h.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,R.zoom,null,[Se.collisionVertexBuffer,Se.collisionVertexBufferExt]))}if(!E||!B.length)return;const Z=g.getOrCreateProgram("collisionCircle"),Y=new d.bN;Y.resize(4*U),Y._trim();let X=0;for(const se of B)for(let he=0;he<se.circleArray.length/4;he++){const ce=4*he,ue=se.circleArray[ce+0],ye=se.circleArray[ce+1],pe=se.circleArray[ce+2],Se=se.circleArray[ce+3];Y.emplace(X++,ue,ye,pe,Se,0),Y.emplace(X++,ue,ye,pe,Se,1),Y.emplace(X++,ue,ye,pe,Se,2),Y.emplace(X++,ue,ye,pe,Se,3)}(!cd||cd.length<2*U)&&(cd=function(se){const he=2*se,ce=new d.bw;ce.resize(he),ce._trim();for(let ue=0;ue<he;ue++){const ye=6*ue;ce.uint16[ye+0]=4*ue+0,ce.uint16[ye+1]=4*ue+1,ce.uint16[ye+2]=4*ue+2,ce.uint16[ye+3]=4*ue+2,ce.uint16[ye+4]=4*ue+3,ce.uint16[ye+5]=4*ue+0}return ce}(U));const W=M.createIndexBuffer(cd,!0),K=M.createVertexBuffer(Y,d.bO.members,!0);for(const se of B){const he={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(te=R).getCameraToCenterDistance(se.projection),u_viewport_size:[te.width,te.height]};Z.draw(g,O.TRIANGLES,d.af.disabled,d.ah.disabled,g.colorModeForRenderPass(),d.ag.disabled,he,h.id,K,W,d.b.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,R.zoom)}var te;K.destroy(),W.destroy()}const Pn=d.ae.create();function Lh(g){const l=g._camera.getWorldToCamera(g.worldSize,1),h=d.ae.multiply([],l,g.globeMatrix);d.ae.invert(h,h);const y=[0,0,0],b=[0,1,0,0];return d.aB.transformMat4(b,b,h),y[0]=b[0],y[1]=b[1],y[2]=b[2],d.$.normalize(y,y),y}function _s({width:g,height:l,anchor:h,textOffset:y,textScale:b},w){const{horizontalAlign:E,verticalAlign:M}=d.bS(h),O=-(E-.5)*g,R=-(M-.5)*l,k=d.bR(h,y);return new d.P((O/b+k[0])*w,(R/b+k[1])*w)}function dC(g,l,h,y,b,w,E,M,O,R,k){const B=g.text.placedSymbolArray,U=g.text.dynamicLayoutVertexArray,j=g.icon.dynamicLayoutVertexArray,Z={},Y=g.getProjection(),X=xy(M,Y,w),W=w.elevation,K=Y.upVectorScale(M.canonical,w.center.lat,w.worldSize).metersToTile;U.clear();for(let te=0;te<B.length;te++){const se=B.get(te),{tileAnchorX:he,tileAnchorY:ce,numGlyphs:ue}=se,ye=se.hidden||!se.crossTileID||g.allowVerticalPlacement&&!se.placedOrientation?null:y[se.crossTileID];if(ye){let pe=0,Se=0,xe=0;if(W){const Te=W?W.getAtTileOffset(M,he,ce):0,[Ke,Xe,bt]=Y.upVector(M.canonical,he,ce);pe=Te*Ke*K,Se=Te*Xe*K,xe=Te*bt*K}let[ae,Fe,ke,Ee]=xa(se.projectedAnchorX+pe,se.projectedAnchorY+Se,se.projectedAnchorZ+xe,h?X:E);const We=Sn(w.getCameraToCenterDistance(Y),Ee);let Ye=b.evaluateSizeForFeature(g.textSizeData,R,se)*We/d.bP;h&&(Ye*=g.tilePixelRatio/O);const Oe=_s(ye,Ye);h?(({x:ae,y:Fe,z:ke}=Y.projectTilePoint(he+Oe.x,ce+Oe.y,M.canonical)),[ae,Fe,ke]=xa(ae+pe,Fe+Se,ke+xe,E)):(l&&Oe._rotate(-w.angle),ae+=Oe.x,Fe+=Oe.y,ke=0);const ze=g.allowVerticalPlacement&&se.placedOrientation===d.aF.vertical?Math.PI/2:0;for(let Te=0;Te<ue;Te++)d.aI(U,ae,Fe,ke,ze);k&&se.associatedIconIndex>=0&&(Z[se.associatedIconIndex]={x:ae,y:Fe,z:ke,angle:ze})}else Xl(ue,U)}if(k){j.clear();const te=g.icon.placedSymbolArray;for(let se=0;se<te.length;se++){const he=te.get(se),{numGlyphs:ce}=he,ue=Z[se];if(he.hidden||!ue)Xl(ce,j);else{const{x:ye,y:pe,z:Se,angle:xe}=ue;for(let ae=0;ae<ce;ae++)d.aI(j,ye,pe,Se,xe)}}g.icon.dynamicLayoutVertexBuffer.updateData(j)}g.text.dynamicLayoutVertexBuffer.updateData(U)}function Bh(g,l,h,y,b,w,E={}){const M=h.paint.get("icon-translate"),O=h.paint.get("text-translate"),R=h.paint.get("icon-translate-anchor"),k=h.paint.get("text-translate-anchor"),B=h.layout.get("icon-rotation-alignment"),U=h.layout.get("text-rotation-alignment"),j=h.layout.get("icon-pitch-alignment"),Z=h.layout.get("text-pitch-alignment"),Y=h.layout.get("icon-keep-upright"),X=h.layout.get("text-keep-upright"),W=h.paint.get("icon-color-saturation"),K=h.paint.get("icon-color-contrast"),te=h.paint.get("icon-color-brightness-min"),se=h.paint.get("icon-color-brightness-max");h.paint.get("icon-occlusion-opacity").constantOr(0),h.paint.get("text-occlusion-opacity").constantOr(0);const he=g.context,ce=he.gl,ue=g.transform,ye="map"===B,pe="map"===U,Se="map"===j,xe="map"===Z,ae=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let Fe=!1;const ke=g.depthModeForSublayer(0,d.af.ReadOnly),Ee=[d.ak(ue.center.lng),d.al(ue.center.lat)],We=h.layout.get("text-variable-anchor"),Ye="globe"===ue.projection.name,Oe=[],ze=[0,-1,0];for(const Te of y){const Ke=l.getTile(Te),Xe=Ke.getBucket(h);if(!Xe||"mercator"===Xe.projection.name&&Ye||Xe.fullyClipped)continue;const bt="globe"===Xe.projection.name,pt=bt?d.a2(ue.zoom):0,nt=xy(Te,Xe.getProjection(),ue),Ct=ue.calculatePixelsToTileUnitsMatrix(Ke),Gt=We&&Xe.hasTextData(),rn=Xe.hasIconTextFit()&&Gt&&Xe.hasIconData(),en=Xe.getProjection().createInversionMatrix(ue,Te.canonical),mn=Bn=>{ue.depthOcclusionForSymbolsAndCircles&&(h.hasInitialOcclusionOpacityProperties||g.terrain)&&(Bn.push("DEPTH_D24"),Bn.push("DEPTH_OCCLUSION"))},on=()=>{const Bn=ye&&"point"!==h.layout.get("symbol-placement"),kn=[];mn(kn);const cn=Bn||rn,rr=h.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&Se&&kn.push("PITCH_WITH_MAP_TERRAIN"),bt&&(kn.push("PROJECTION_GLOBE_VIEW"),cn&&kn.push("PROJECTED_POS_ON_VIEWPORT")),rr>0&&kn.push("ICON_TRANSITION"),Xe.icon.zOffsetVertexBuffer&&kn.push("Z_OFFSET"),0===W&&0===K&&0===te&&1===se||kn.push("COLOR_ADJUSTMENT");const ar=Xe.icon.programConfigurations.get(h.id),go=g.getOrCreateProgram(Xe.sdfIcons?"symbolSDF":"symbolIcon",{config:ar,defines:kn});let Wr;const _o=Ke.imageAtlasTexture?Ke.imageAtlasTexture.size:[0,0],Ro=Xe.iconSizeData,no=d.aE(Ro,ue.zoom),yo=Se||0!==ue.pitch,ct=td(nt,Ke.tileID.canonical,Se,ye,ue,Xe.getProjection(),Ct),Nt=Jf(nt,Ke.tileID.canonical,Se,ye,ue,Xe.getProjection(),Ct),Qo=g.translatePosMatrix(Nt,Ke,M,R,!0),Ei=g.translatePosMatrix(nt,Ke,M,R),Le=cn?Pn:ct,hc=ye&&!Se&&!Bn;let Ya=ze;!Ye&&!ue.mercatorFromTransition||ye||(Ya=Lh(ue));const fc=bt?Ya:ze;if(Xe.sdfIcons&&!Xe.iconsInText)Wr=su(Ro.kind,no,hc,Se,g,Ei,Le,Qo,!1,_o,!0,Te,pt,Ee,en,fc,Xe.getProjection());else{const Rd=h.getColorAdjustmentMatrix(W,K,te,se);Wr=ou(Ro.kind,no,hc,Se,g,Ei,Le,Qo,!1,_o,Te,pt,Ee,en,fc,Xe.getProjection(),Rd,rr)}const Xa=Ke.imageAtlasTexture?Ke.imageAtlasTexture:null,tf=1!==h.layout.get("icon-size").constantOr(0)||Xe.iconsNeedLinear,mg=Xe.sdfIcons||g.options.rotating||g.options.zooming||tf||yo?ce.LINEAR:ce.NEAREST,_u=Xe.sdfIcons&&0!==h.paint.get("icon-halo-width").constantOr(1),Ly=g.terrain&&Se&&Bn?d.ae.invert(d.ae.create(),ct):Pn;if(Bn&&Xe.icon){const Rd=ue.elevation,Tp=Rd?Rd.getAtTileOffsetFunc(Te,ue.center.lat,ue.worldSize,Xe.getProjection()):null,yu=Kf(nt,Ke.tileID.canonical,Se,ye,ue,Xe.getProjection(),Ct);Yl(Xe,nt,g,!1,yu,Nt,Se,Y,Tp,Te)}return{program:go,buffers:Xe.icon,uniformValues:Wr,atlasTexture:Xa,atlasTextureIcon:null,atlasInterpolation:mg,atlasInterpolationIcon:null,isSDF:Xe.sdfIcons,hasHalo:_u,tile:Ke,labelPlaneMatrixInv:Ly}},xi=()=>{const Bn=pe&&"point"!==h.layout.get("symbol-placement"),kn=[],cn=Bn||We||rn;g.terrainRenderModeElevated()&&xe&&kn.push("PITCH_WITH_MAP_TERRAIN"),bt&&(kn.push("PROJECTION_GLOBE_VIEW"),cn&&kn.push("PROJECTED_POS_ON_VIEWPORT")),Xe.text.zOffsetVertexBuffer&&kn.push("Z_OFFSET"),mn(kn);const rr=Xe.text.programConfigurations.get(h.id),ar=g.getOrCreateProgram(Xe.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:rr,defines:kn});let go,Wr=[0,0],_o=null;const Ro=Xe.textSizeData;Xe.iconsInText&&(Wr=Ke.imageAtlasTexture?Ke.imageAtlasTexture.size:[0,0],_o=Ke.imageAtlasTexture?Ke.imageAtlasTexture:null,go=xe||0!==ue.pitch||g.options.rotating||g.options.zooming||"composite"===Ro.kind||"camera"===Ro.kind?ce.LINEAR:ce.NEAREST);const no=Ke.glyphAtlasTexture?Ke.glyphAtlasTexture.size:[0,0],yo=d.aE(Ro,ue.zoom),ct=td(nt,Ke.tileID.canonical,xe,pe,ue,Xe.getProjection(),Ct),Nt=Jf(nt,Ke.tileID.canonical,xe,pe,ue,Xe.getProjection(),Ct),Qo=g.translatePosMatrix(Nt,Ke,O,k,!0),Ei=g.translatePosMatrix(nt,Ke,O,k),Le=cn?Pn:ct,hc=pe&&!xe&&!Bn;let Ya=ze;!Ye&&!ue.mercatorFromTransition||pe||(Ya=Lh(ue));const fc=bt?Ya:ze;let Xa;Xa=Xe.iconsInText?nc(Ro.kind,yo,hc,xe,g,Ei,Le,Qo,no,Wr,Te,pt,Ee,en,fc,Xe.getProjection()):su(Ro.kind,yo,hc,xe,g,Ei,Le,Qo,!0,no,!0,Te,pt,Ee,en,fc,Xe.getProjection());const tf=Ke.glyphAtlasTexture?Ke.glyphAtlasTexture:null,mg=ce.LINEAR,_u=0!==h.paint.get("text-halo-width").constantOr(1),Ly=g.terrain&&xe&&Bn?d.ae.invert(d.ae.create(),ct):Pn;if(Bn&&Xe.text){const Rd=ue.elevation,Tp=Rd?Rd.getAtTileOffsetFunc(Te,ue.center.lat,ue.worldSize,Xe.getProjection()):null,yu=Kf(nt,Ke.tileID.canonical,xe,pe,ue,Xe.getProjection(),Ct);Yl(Xe,nt,g,!0,yu,Nt,xe,X,Tp,Te)}return{program:ar,buffers:Xe.text,uniformValues:Xa,atlasTexture:tf,atlasTextureIcon:_o,atlasInterpolation:mg,atlasInterpolationIcon:go,isSDF:!0,hasHalo:_u,tile:Ke,labelPlaneMatrixInv:Ly}},An=Xe.icon.segments.get().length,vn=Xe.text.segments.get().length,oi=An&&!E.onlyText?on():null,xn=vn&&!E.onlyIcons?xi():null,Mn=h.paint.get("icon-opacity").constantOr(1),nn=h.paint.get("text-opacity").constantOr(1);if(ae&&Xe.canOverlap){Fe=!0;const Bn=Mn&&!E.onlyText?Xe.icon.segments.get():[],kn=nn&&!E.onlyIcons?Xe.text.segments.get():[];for(const cn of Bn)Oe.push({segments:new d.b([cn]),sortKey:cn.sortKey,state:oi});for(const cn of kn)Oe.push({segments:new d.b([cn]),sortKey:cn.sortKey,state:xn})}else E.onlyText||Oe.push({segments:Mn?Xe.icon.segments:new d.b([]),sortKey:0,state:oi}),E.onlyIcons||Oe.push({segments:nn?Xe.text.segments:new d.b([]),sortKey:0,state:xn})}Fe&&Oe.sort((Te,Ke)=>Te.sortKey-Ke.sortKey);for(const Te of Oe){const Ke=Te.state;if(Ke)if(g.terrain?g.terrain.setupElevationDraw(Ke.tile,Ke.program,{useDepthForOcclusion:ue.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ke.labelPlaneMatrixInv}):g.setupDepthForOcclusion(ue.depthOcclusionForSymbolsAndCircles,Ke.program),he.activeTexture.set(ce.TEXTURE0),Ke.atlasTexture&&Ke.atlasTexture.bind(Ke.atlasInterpolation,ce.CLAMP_TO_EDGE,!0),Ke.atlasTextureIcon&&(he.activeTexture.set(ce.TEXTURE1),Ke.atlasTextureIcon&&Ke.atlasTextureIcon.bind(Ke.atlasInterpolationIcon,ce.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,Ke.program),Ke.hasHalo){const Xe=Ke.uniformValues;Xe.u_is_halo=1,wy(Ke.buffers,Te.segments,h,g,Ke.program,ke,b,w,Xe,2),Xe.u_is_halo=0}else{if(Ke.isSDF){const Xe=Ke.uniformValues;Ke.hasHalo&&(Xe.u_is_halo=1,wy(Ke.buffers,Te.segments,h,g,Ke.program,ke,b,w,Xe,1)),Xe.u_is_halo=0}wy(Ke.buffers,Te.segments,h,g,Ke.program,ke,b,w,Ke.uniformValues,1)}}}function wy(g,l,h,y,b,w,E,M,O,R){const k=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];b.draw(y,y.context.gl.TRIANGLES,w,E,M,d.ag.disabled,O,h.id,g.layoutVertexBuffer,g.indexBuffer,l,h.paint,y.transform.zoom,g.programConfigurations.get(h.id),k,R)}function oa(g,l,h,y,b,w,E){const M=g.context.gl,O=h.paint.get("fill-pattern"),R=O&&O.constantOr(1);let k,B,U,j,Z;E?(B=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=M.LINES):(B=R?"fillPattern":"fill",k=M.TRIANGLES);for(const Y of y){const X=l.getTile(Y);if(R&&!X.patternsLoaded())continue;const W=X.getBucket(h);if(!W)continue;g.prepareDrawTile();const K=W.programConfigurations.get(h.id),te=g.isTileAffectedByFog(Y),se=g.getOrCreateProgram(B,{config:K,overrideFog:te});R&&(g.context.activeTexture.set(M.TEXTURE0),X.imageAtlasTexture&&X.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),K.updatePaintBuffers());const he=O.constantOr(null);if(he&&X.imageAtlas){const ye=X.imageAtlas.patternPositions[he.toString()];ye&&K.setConstantPatternPositions(ye)}const ce=g.translatePosMatrix(Y.projMatrix,X,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ue=h.paint.get("fill-emissive-strength");if(E){j=W.indexBuffer2,Z=W.segments2;const ye=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];U="fillOutlinePattern"===B&&R?cp(ce,ue,g,X,ye):Jm(ce,ue,ye)}else j=W.indexBuffer,Z=W.segments,U=R?Km(ce,ue,g,X):lp(ce,ue);g.uploadCommonUniforms(g.context,se,Y.toUnwrapped()),se.draw(g,k,b,g.stencilModeForClipping(Y),w,d.ag.disabled,U,h.id,W.layoutVertexBuffer,j,Z,h.paint,g.transform.zoom,K,void 0)}}function ud(g,l,h,y,b,w,E,M){h.resetLayerRenderingStats(g);const O=g.context,R=O.gl,k=g.transform,B=h.paint.get("fill-extrusion-pattern"),U=B.constantOr(1),j=h.paint.get("fill-extrusion-opacity"),Z=g.style.enable3dLights(),Y=h.paint.get(Z&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y],W=h.layout.get("fill-extrusion-edge-radius"),K=W>0&&!h.paint.get("fill-extrusion-rounded-roof"),te=K?0:W,se="globe"===k.projection.name?d.b_():0,he="globe"===k.projection.name,ce=he?d.a2(k.zoom):0,ue=[d.ak(k.center.lng),d.al(k.center.lat)],ye=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),pe=h.paint.get("fill-extrusion-flood-light-intensity"),Se=h.paint.get("fill-extrusion-vertical-scale"),xe=0!==h.paint.get("fill-extrusion-line-width").constantOr(1),ae=Zo(g,h.paint.get("fill-extrusion-cutoff-fade-range")),Fe=h.paint.get("fill-extrusion-emissive-strength"),ke=[];he&&ke.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&ke.push("FAUX_AO"),K&&ke.push("ZERO_ROOF_RADIUS"),M&&ke.push("HAS_CENTROID"),pe>0&&ke.push("FLOOD_LIGHT"),ae.shouldRenderCutoff&&ke.push("RENDER_CUTOFF"),xe&&ke.push("RENDER_WALL_MODE");const Ee=(()=>{const bt=h.paint.get("fill-extrusion-line-alignment");switch(bt){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return d.w(`Unsupported value for fill-extrusion-line-alignment: ${bt}`),0}})();let We;const Ye="shadow"===g.renderPass,Oe=g.shadowRenderer,ze=Ye&&!!Oe;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Te=[0,0,0];if(Oe){const bt=g.style.directionalLight,pt=g.style.ambientLight;bt&&pt&&(Te=Ph(g.style,bt,pt)),We=ke.concat(["SHADOWS_SINGLE_CASCADE"])}const Ke=ze?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",Xe=h.getLayerRenderingStats();for(const bt of y){const pt=l.getTile(bt),nt=pt.getBucket(h);if(!nt||nt.projection.name!==k.projection.name)continue;let Ct=!1;Oe&&(Ct=0===Oe.getMaxCascadeForTile(bt.toUnwrapped()));const Gt=g.isTileAffectedByFog(bt),rn=nt.programConfigurations.get(h.id),en=g.getOrCreateProgram(Ke,{config:rn,defines:Ct?We:ke,overrideFog:Gt});if(g.terrain&&g.terrain.setupElevationDraw(pt,en,{useMeterToDem:!0}),!nt.centroidVertexBuffer){const xn=en.attributes.a_centroid_pos;void 0!==xn&&R.vertexAttrib2f(xn,0,0)}!Ye&&Oe&&Oe.setupShadows(pt.tileID.toUnwrapped(),en,"vector-tile",pt.tileID.overscaledZ),U&&(g.context.activeTexture.set(R.TEXTURE0),pt.imageAtlasTexture&&pt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),rn.updatePaintBuffers());const mn=B.constantOr(null);if(mn&&pt.imageAtlas){const xn=pt.imageAtlas.patternPositions[mn.toString()];xn&&rn.setConstantPatternPositions(xn)}const on=h.paint.get("fill-extrusion-vertical-gradient"),xi=1/nt.tileToMeter;let An;if(Ye&&Oe){if(Ha(pt.tileID,nt,g))continue;const xn=Oe.calculateShadowPassMatrixFromTile(pt.tileID.toUnwrapped());An=Xm(xn,te,Ee,xi,Se)}else{const xn=g.translatePosMatrix(bt.expandedProjMatrix,pt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Mn=k.projection.createInversionMatrix(k,bt.canonical);An=U?x1(xn,g,on,j,X,te,Ee,xi,bt,pt,se,ce,ue,Mn,ye,Se):ml(xn,g,on,j,X,te,Ee,xi,bt,se,ce,ue,Mn,ye,Se,pe,Te,Fe)}g.uploadCommonUniforms(O,en,bt.toUnwrapped(),null,ae);let vn=nt.segments;if("mercator"===k.projection.name&&!Ye&&(vn=nt.getVisibleSegments(pt.tileID,g.terrain,g.transform.getFrustum(0)),!vn.get().length))continue;if(Xe)if(Ye)for(const xn of vn.get())Xe.numRenderedVerticesInShadowPass+=xn.primitiveLength;else for(const xn of vn.get())Xe.numRenderedVerticesInTransparentPass+=xn.primitiveLength;const oi=[];(g.terrain||M)&&oi.push(nt.centroidVertexBuffer),he&&oi.push(nt.layoutVertexExtBuffer),xe&&oi.push(nt.wallVertexBuffer),en.draw(g,O.gl.TRIANGLES,b,w,E,d.ag.backCCW,An,h.id,nt.layoutVertexBuffer,nt.indexBuffer,vn,h.paint,g.transform.zoom,rn,oi)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function zh(g,l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X,W,K){const te=g.context,se=te.gl,he=g.transform,ce=g.transform.zoom,ue=[],ye=Zo(g,h.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===R?(ue.push("CLEAR_SUBPASS"),K&&(ue.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(se.TEXTURE0),K.bind(se.LINEAR,se.CLAMP_TO_EDGE))):"sdf"===R&&ue.push("SDF_SUBPASS"),X&&ue.push("HAS_CENTROID"),ye.shouldRenderCutoff&&ue.push("RENDER_CUTOFF");const pe=h.layout.get("fill-extrusion-edge-radius"),Se=(xe,ae,Fe,ke,Ee)=>{const We=ae.programConfigurations.get(h.id),Ye=g.isTileAffectedByFog(xe),Oe=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:We,defines:ue,overrideFog:Ye}),ze=((Ke,Xe,bt,pt,nt,Ct,Gt,rn,en,mn,on)=>({u_matrix:Xe,u_opacity:bt,u_ao_pass:pt?1:0,u_meter_to_tile:nt,u_ao:Ct,u_flood_light_intensity:Gt,u_flood_light_color:rn,u_attenuation:en,u_edge_radius:mn,u_fb:0,u_fb_size:on}))(0,ke,k,O,Ee,[B,U*Ee],j,Z,Y,ce>=17?0:pe*Ee,K?K.size[0]:0),Te=[];X&&Te.push(ae.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(te,Oe,xe.toUnwrapped(),null,ye),Oe.draw(g,te.gl.TRIANGLES,b,w,E,M,ze,h.id,ae.vertexBuffer,ae.indexBuffer,Fe,h.paint,ce,We,Te)};for(const xe of y){const ae=l.getTile(xe),Fe=ae.getBucket(h);if(!Fe||Fe.projection.name!==he.projection.name||!Fe.groundEffect||Fe.groundEffect&&!Fe.groundEffect.hasData())continue;const ke=Fe.groundEffect,Ee=1/Fe.tileToMeter;{const We=g.translatePosMatrix(xe.projMatrix,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ye=ke.getDefaultSegment();Se(xe,ke,Ye,We,Ee)}if(W)for(let We=0;We<4;We++){const Ye=d.b$[We](xe),Oe=l.getTile(Ye);if(!Oe)continue;const ze=Oe.getBucket(h);if(!ze||ze.projection.name!==he.projection.name||!ze.groundEffect||ze.groundEffect&&!ze.groundEffect.hasData())continue;const Te=ze.groundEffect;let Ke,Xe;0===We?(Ke=[-d.a4,0,0],Xe=1):1===We?(Ke=[d.a4,0,0],Xe=0):2===We?(Ke=[0,-d.a4,0],Xe=3):(Ke=[0,d.a4,0],Xe=2);const bt=Te.regionSegments[Xe];if(!bt)continue;const pt=new Float32Array(16);d.ae.translate(pt,xe.projMatrix,Ke),Se(xe,Te,bt,g.translatePosMatrix(pt,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ee)}}}function hC(g,l,h,y,b,w,E){0===y.centroidVertexArray.length&&y.createCentroidsBuffer();const M=w?w.findDEMTileFor(h):null;if(!(M&&M.dem||E))return;const O=W=>new d.P(Math.ceil((W+d.c2)*d.c3),0),R=W=>{const K=l.getSource().minzoom,te=he=>{const ce=l.getTileByID(he);if(ce&&ce.hasData())return ce.getBucket(b)},se=[0,-1,1];for(const he of se){if(W.overscaledZ+he<K)continue;const ce=te(W.calculateScaledKey(W.overscaledZ+he));if(ce)return ce}},k=[0,0,0],B=(W,K)=>(k[0]=Math.min(W.min.y,K.min.y),k[1]=Math.max(W.max.y,K.max.y),k[2]=d.a4-K.min.x>W.max.x?K.min.x-d.a4:W.max.x,k),U=(W,K)=>(k[0]=Math.min(W.min.x,K.min.x),k[1]=Math.max(W.max.x,K.max.x),k[2]=d.a4-K.min.y>W.max.y?K.min.y-d.a4:W.max.y,k),j=[(W,K)=>B(W,K),(W,K)=>B(K,W),(W,K)=>U(W,K),(W,K)=>U(K,W)],Z=(W,K,te,se,he,ce,ue)=>{if(!w)return 0;const ye=[[ce?te:W,ce?W:te,0],[ce?te:K,ce?K:te,0]],pe=ue<0?d.a4+ue:ue,Se=[ce?pe:(W+K)/2,ce?(W+K)/2:pe,0];return 0===te&&ue<0||0!==te&&ue>0?w.getForTilePoints(he,[Se],!0,se):ye.push(Se),w.getForTilePoints(h,ye,!0,M),Math.max(ye[0][2],ye[1][2],Se[2])/w.exaggeration()};for(let W=0;W<4;W++){const K=y.borderFeatureIndices[W];if(0===K.length)continue;const te=d.b$[W](h),se=R(te);if(!(se&&se instanceof d.c0)||y.borderDoneWithNeighborZ[W]===se.canonical.z)continue;0===se.centroidVertexArray.length&&se.createCentroidsBuffer();const he=w?w.findDEMTileFor(te):null;if(!(he&&he.dem||E))continue;const ce=(W<2?1:5)-W,ue=se.borderDoneWithNeighborZ[ce]!==y.canonical.z,ye=se.borderFeatureIndices[ce];let pe=0;if(y.canonical.z!==se.canonical.z){for(const Se of K)y.showCentroid(y.featuresOnBorder[Se]);if(ue)for(const Se of ye)se.showCentroid(se.featuresOnBorder[Se]);y.borderDoneWithNeighborZ[W]=se.canonical.z,se.borderDoneWithNeighborZ[ce]=y.canonical.z}for(const Se of K){const xe=y.featuresOnBorder[Se],ae=y.centroidData[xe.centroidDataIndex],Fe=xe.borders[W];let ke;for(;pe<ye.length;){ke=se.featuresOnBorder[ye[pe]];const Ee=ke.borders[ce];if(Ee[1]>Fe[0]+3||Ee[0]>Fe[0]-3)break;se.showCentroid(ke),pe++}if(ke&&pe<ye.length){const Ee=pe;let We=0;for(;!(ke.borders[ce][0]>Fe[1]-3)&&(We++,++pe!==ye.length);)ke=se.featuresOnBorder[ye[pe]];if(ke=se.featuresOnBorder[ye[Ee]],We>1){const ze=ke.borders[ce];Math.abs(Fe[0]-ze[0])<3&&Math.abs(Fe[1]-ze[1])<3&&(We=1,pe=Ee+1)}else if(0===We){y.showCentroid(xe);continue}const Ye=se.centroidData[ke.centroidDataIndex];E&&1===We&&(((Y=ae).flags|(X=Ye).flags)&d.c1?(Y.flags|=d.c1,X.flags|=d.c1):(Y.flags&=~d.c1,X.flags&=~d.c1));const Oe=xe.intersectsCount()>1||ke.intersectsCount()>1;if(We>1)pe=Ee,ae.centroidXY=Ye.centroidXY=new d.P(0,0);else if(he&&he.dem&&!Oe){const ze=j[W](ae,Ye),Te=W%2?d.a4-1:0,Ke=Z(ze[0],Math.min(d.a4-1,ze[1]),Te,he,te,W<2,ze[2]);ae.centroidXY=Ye.centroidXY=O(Ke)}else Oe?ae.centroidXY=Ye.centroidXY=new d.P(0,0):(ae.centroidXY=y.encodeBorderCentroid(xe),Ye.centroidXY=se.encodeBorderCentroid(ke));y.writeCentroidToBuffer(ae),se.writeCentroidToBuffer(Ye)}else y.showCentroid(xe)}y.borderDoneWithNeighborZ[W]=se.canonical.z,se.borderDoneWithNeighborZ[ce]=y.canonical.z}var Y,X;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&0!==y.centroidVertexArray.length)&&y.uploadCentroid(g)}const w1=[1,0,0],C1=[0,1,0],eg=[0,0,1];function Ha(g,l,h){const y=h.transform,b=h.shadowRenderer;if(!b)return!0;const w=g.toUnwrapped(),E=y.tileSize*b._cascades[h.currentShadowCascade].scale;let M=l.maxHeight;if(y.elevation){const Y=y.elevation.getMinMaxForTile(g);Y&&(M+=Y.max)}const O=[...b.shadowDirection];O[2]=-O[2];const R=b.computeSimplifiedTileShadowVolume(w,M,E,O);if(!R)return!1;const k=[w1,C1,eg,O,[O[0],0,O[2]],[0,O[1],O[2]]],B="globe"===y.projection.name,U=y.scaleZoom(E),j=d.aM.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,U,!B),Z=b.getCurrentCascadeFrustum();return 0===j.intersectsPrecise(R.vertices,R.planes,k)||0===Z.intersectsPrecise(R.vertices,R.planes,k)}function dp(g){return[g[0]*d.c4,g[1]*d.c4,g[2]*d.c4,0]}function Io(g,l,h,y,b,w,E,M,O){const R=y.getSource(),k=h.globeSharedBuffers;if(!k)return;let B,U,j;if(l&&(B=y.getTile(l)),R instanceof d.bo?(U=R.texture,j=d.bj(0,0,h.transform)):B&&l&&(U=B.texture,j=d.bj(l.canonical.z,l.canonical.x,h.transform)),!U||!j)return;g||(j=d.ae.scale(d.ae.create(),j,[1,-1,1]));const Z=h.context,Y=Z.gl,X="nearest"===b.paint.get("raster-resampling")?Y.NEAREST:Y.LINEAR,W=h.colorModeForDrapableLayerRenderPass(w),K=E.defines;K.push("GLOBE_POLES");const te=new d.af(Y.LEQUAL,d.af.ReadWrite,h.depthRangeFor3D),se=Float32Array.from(h.transform.expandedFarZProjMatrix),he=Float32Array.from(d.bh(d.bi(new d.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),Z.activeTexture.set(Y.TEXTURE0),U.bind(X,Y.CLAMP_TO_EDGE),Z.activeTexture.set(Y.TEXTURE1),U.bind(X,Y.CLAMP_TO_EDGE),U.useMipmap&&Z.extTextureFilterAnisotropic&&h.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[ce,ue,ye,pe]=l?k.getPoleBuffers(l.canonical.z,!1):k.getPoleBuffers(0,!0),Se=b.paint.get("raster-elevation");let xe;g?(xe=ce,h.renderDefaultNorthPole=0!==Se):(xe=ue,h.renderDefaultSouthPole=0!==Se);const ae=dp(E.mix),Fe=(Ee=se,We=he,Ye=j,Oe=d.a2(h.transform.zoom),Te=b,Xe=Se,pt=ae,nt=E.offset,Ct=E.range,Gt=w,Qm(Ee,We,Ye,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Te,[0,0],Xe,2,pt,nt,Ct,1,0,Gt)),ke=h.getOrCreateProgram("raster",{defines:K});var Ee,We,Ye,Oe,Te,Xe,pt,nt,Ct,Gt;h.uploadCommonUniforms(Z,ke,null),ke.draw(h,Y.TRIANGLES,te,O,W,M,Fe,b.id,xe,ye,pe)}function Rn(g){const l=g._nearZ,h=g.projection.farthestPixelDistance(g),y=h-l,b=.2*g.height,w=l+b;return[l,h,(w-b-l)/y,(w-l)/y]}function dd(g,l,h,y){if(g)return l instanceof ec&&g instanceof d.c5?l.getTextureDescriptor(g,h,!0):{texture:g.texture,mix:dp(y.mix),offset:y.offset,buffer:0,tileSize:1}}function T1(g,l,h){if(!g)return null;const y=l.getTextureDescriptor(g,h,!0);if(!y)return null;let{texture:b,mix:w,offset:E,tileSize:M,buffer:O,format:R}=y;if(!b||!R)return null;let k=!1;return"uint32"===R&&(k=!0,w[3]=0,w=od(d.c6,w,[0,h.paint.get("raster-particle-max-speed")]),E=sd(d.c6,E,[0,h.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[O/(M+2*O),M/(M+2*O)],tileSize:M,scalarData:k,scale:w,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function tg(g){const l=g._nearZ,h=g.projection.farthestPixelDistance(g),y=h-l,b=.2*g.height,w=l+b;return[l,h,(w-b-l)/y,(w-l)/y]}const Cy=new d.C(1,0,0,1),ng=new d.C(0,1,0,1),Mt=new d.C(0,0,1,1),ni=new d.C(1,0,1,1),Pi=new d.C(0,1,1,1);function Yt(g,l,h,y,b,w,E){const M=g.context,O=g.transform,R=M.gl,k="globe"===O.projection.name,B=k?["PROJECTION_GLOBE_VIEW"]:[];let U=d.ae.clone(h.projMatrix);if(k&&d.a2(O.zoom)>0){const ae=d.c7(h.canonical,O),Fe=d.c8(ae);U=d.ae.multiply(new Float32Array(16),O.globeMatrix,Fe),d.ae.multiply(U,O.projMatrix,U)}const j=d.ae.create();j[12]+=2*b/(d.e.devicePixelRatio*O.width),j[13]+=2*w/(d.e.devicePixelRatio*O.height),d.ae.multiply(U,j,U);const Z=g.getOrCreateProgram("debug",{defines:B}),Y=l.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(Y,Z);const X=d.af.disabled,W=d.ah.disabled,K=g.colorModeForRenderPass();M.activeTexture.set(R.TEXTURE0),g.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),k?Y._makeGlobeTileDebugBuffers(g.context,O):Y._makeDebugTileBoundsBuffers(g.context,O.projection);const se=Y._tileDebugBuffer||g.debugBuffer,he=Y._tileDebugIndexBuffer||g.debugIndexBuffer,ce=Y._tileDebugSegments||g.debugSegments;if(Z.draw(g,R.LINE_STRIP,X,W,K,d.ag.disabled,Fh(U,y),"$debug",se,he,ce,null,null,null,[Y._globeTileDebugBorderBuffer]),E){const ae=Y.latestRawTileData,Fe=Math.floor((ae&&ae.byteLength||0)/1024);let ke=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ke+=` => ${h.overscaledZ}`),ke+=` ${Y.state}`,ke+=` ${Fe}kb`,function(Ee,We){Ee.initDebugOverlayCanvas();const Ye=Ee.debugOverlayCanvas,Oe=Ee.context.gl,ze=Ee.debugOverlayCanvas.getContext("2d");ze.clearRect(0,0,Ye.width,Ye.height),ze.shadowColor="white",ze.shadowBlur=2,ze.lineWidth=1.5,ze.strokeStyle="white",ze.textBaseline="top",ze.font="bold 36px Open Sans, sans-serif",ze.fillText(We,5,5),ze.strokeText(We,5,5),Ee.debugOverlayTexture.update(Ye),Ee.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(g,ke)}const ue=l.getTile(h).tileSize,ye=512/Math.min(ue,512)*(h.overscaledZ/O.zoom)*.5,pe=Y._tileDebugTextBuffer||g.debugBuffer,Se=Y._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,xe=Y._tileDebugTextSegments||g.debugSegments;Z.draw(g,R.TRIANGLES,X,W,d.a.alphaBlended,d.ag.disabled,Fh(U,d.C.transparent,ye),"$debug",pe,Se,xe,null,null,null,[Y._globeTileDebugTextBuffer])}function ig(g,l,h,y){fd(g,0,l+h/2,g.transform.width,h,y)}function hd(g,l,h,y){fd(g,l-h/2,0,h,g.transform.height,y)}function fd(g,l,h,y,b,w){const E=g.context,M=E.gl;M.enable(M.SCISSOR_TEST),M.scissor(l*d.e.devicePixelRatio,h*d.e.devicePixelRatio,y*d.e.devicePixelRatio,b*d.e.devicePixelRatio),E.clear({color:w}),M.disable(M.SCISSOR_TEST)}const ks=d.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pd}=ks;function Xo(g,l,h,y){g.emplaceBack(l,h,y)}class It{constructor(l){this.vertexArray=new d.ca,this.indices=new d.bw,Xo(this.vertexArray,-1,-1,1),Xo(this.vertexArray,1,-1,1),Xo(this.vertexArray,-1,1,1),Xo(this.vertexArray,1,1,1),Xo(this.vertexArray,-1,-1,-1),Xo(this.vertexArray,1,-1,-1),Xo(this.vertexArray,-1,1,-1),Xo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,pd),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=d.b.simpleSegment(0,0,36,12)}}function jn(g,l,h,y,b,w){const E=g.context.gl,M=l.paint.get("sky-atmosphere-color"),O=l.paint.get("sky-atmosphere-halo-color"),R=l.paint.get("sky-atmosphere-sun-intensity"),k={u_matrix_3f:d.bE.fromMat4(d.bE.create(),y),u_sun_direction:b,u_sun_intensity:R,u_color_tint_r:[(Z=M).r,Z.g,Z.b,Z.a],u_color_tint_m:[(Y=O).r,Y.g,Y.b,Y.a],u_luminance:5e-5};var Z,Y;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+w,l.skyboxTexture,0),h.draw(g,E.TRIANGLES,d.af.disabled,d.ah.disabled,d.a.unblended,d.ag.frontCW,k,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const vt=d.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ys{constructor(l){const h=new d.cb;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const y=new d.bw;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(h,vt.members),this.indexBuffer=l.createIndexBuffer(y),this.segments=d.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ic=d.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Zn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class md{constructor(l){this.colorModeAlphaBlendedWriteRGB=new d.a([d.cc,d.cd,d.cc,d.cd],d.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new d.a([d.cc,d.ce,d.cc,d.ce],d.C.transparent,[!1,!1,!1,!0]),this.params=new Zn,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const h=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ys(h);const y=this.params.sizeRange,b=this.params.intensityRange,w=function(k){const B=d.ch(30),U=[];for(let j=0;j<k;++j){const Z=2*Math.PI*B(),Y=Math.acos(1-2*B())-.5*Math.PI;U.push(d.$.fromValues(Math.cos(Y)*Math.cos(Z),Math.cos(Y)*Math.sin(Z),Math.sin(Y)))}return U}(this.params.starsCount),E=d.ch(300),M=new d.cf,O=new d.bw;let R=0;for(let k=0;k<w.length;++k){const B=d.$.scale([],w[k],200),U=Math.max(0,1+.01*y*(1*E()-.5)),j=Math.max(0,1+.01*b*(1*E()-.5));M.emplaceBack(B[0],B[1],B[2],-1,-1,U,j),M.emplaceBack(B[0],B[1],B[2],1,-1,U,j),M.emplaceBack(B[0],B[1],B[2],1,1,U,j),M.emplaceBack(B[0],B[1],B[2],-1,1,U,j),O.emplaceBack(R+0,R+1,R+2),O.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=h.createVertexBuffer(M,ic.members),this.starsIdx=h.createIndexBuffer(O),this.starsSegments=d.b.simpleSegment(0,0,M.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,h){const y=l.context,b=y.gl,w=l.transform,E=new d.af(b.LEQUAL,d.af.ReadOnly,[0,1]),M=d.a2(w.zoom),O=l.style.getLut(h.scope),R=h.properties.get("color").toRenderColor(O).toArray01(),k=h.properties.get("high-color").toRenderColor(O).toArray01(),B=h.properties.get("space-color").toRenderColor(O).toArray01PremultipliedAlpha(),U=5e-4,j=d.cg(h.properties.get("horizon-blend"),0,1,U,.25),Z=d.bc(l,y,w)&&j===U?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,Y=l.frameCounter/1e3%1,X=d.$.length(w.globeCenterInViewSpace),W=Math.sqrt(Math.pow(X,2)-Math.pow(Z,2)),K=Math.acos(W/X),te=se=>{const he="globe"===w.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];se&&he.push("ALPHA_PASS");const ce=l.getOrCreateProgram("globeAtmosphere",{defines:he}),ue=((pe,Se,xe,ae,Fe,ke,Ee,We,Ye,Oe,ze,Te)=>({u_frustum_tl:pe,u_frustum_tr:Se,u_frustum_br:xe,u_frustum_bl:ae,u_horizon:Fe,u_transition:ke,u_fadeout_range:Ee,u_color:We,u_high_color:Ye,u_space_color:Oe,u_temporal_offset:ze,u_horizon_angle:Te}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,M,j,R,k,B,Y,K);l.uploadCommonUniforms(y,ce);const ye=this.atmosphereBuffer;ye&&ce.draw(l,b.TRIANGLES,E,d.ah.disabled,se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,d.ag.backCW,ue,se?"atmosphere_glow_alpha":"atmosphere_glow",ye.vertexBuffer,ye.indexBuffer,ye.segments)};te(!1),te(!0)}drawStars(l,h){const y=d.au(h.properties.get("star-intensity"),0,1);if(0===y)return;const b=l.context,w=b.gl,E=l.transform,M=l.getOrCreateProgram("stars"),O=d.aw.identity([]);d.aw.rotateX(O,O,-E._pitch),d.aw.rotateZ(O,O,-E.angle),d.aw.rotateX(O,O,d.ac(E._center.lat)),d.aw.rotateY(O,O,-d.ac(E._center.lng));const R=d.ae.fromQuat(new Float32Array(16),O),k=d.ae.multiply([],E.starsProjMatrix,R),B=d.bE.fromMat4([],R),U=d.bE.invert([],B),j=[0,1,0];d.$.transformMat3(j,j,U),d.$.scale(j,j,this.params.sizeMultiplier);const Z=[1,0,0];d.$.transformMat3(Z,Z,U),d.$.scale(Z,Z,this.params.sizeMultiplier);const Y=(X=j,W=Z,K=y,{u_matrix:Float32Array.from(k),u_up:X,u_right:W,u_intensity_multiplier:K});var X,W,K;l.uploadCommonUniforms(b,M),this.starsVx&&this.starsIdx&&M.draw(l,w.TRIANGLES,d.af.disabled,d.ah.disabled,this.colorModeAlphaBlendedWriteRGB,d.ag.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function gd(g,l){const h=[...g],y=l.cameraWorldSizeForFog/l.worldSize,b=d.ae.identity([]);return d.ae.scale(b,b,[y,y,1]),d.ae.multiply(h,b,h),d.ae.multiply(h,l.worldToFogMatrix,h),h}function gl(g,l,h,y,b){const w=h.material,E=y.context,{baseColorTexture:M,metallicRoughnessTexture:O}=w.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:k,emissionTexture:B}=w;function U(j,Z,Y){if(j&&(g.push(Z),E.activeTexture.set(E.gl.TEXTURE0+Y),j.gfxTexture)){const{minFilter:X,magFilter:W,wrapS:K,wrapT:te}=j.sampler;j.gfxTexture.bindExtraParam(X,W,K,te)}}U(M,"HAS_TEXTURE_u_baseColorTexture",qr.BaseColor),U(O,"HAS_TEXTURE_u_metallicRoughnessTexture",qr.MetallicRoughness),U(R,"HAS_TEXTURE_u_normalTexture",qr.Normal),U(k,"HAS_TEXTURE_u_occlusionTexture",qr.Occlusion),U(B,"HAS_TEXTURE_u_emissionTexture",qr.Emission),b&&(b.texture||(b.texture=new d.cj(y.context,b.image,[b.image.height,b.image.height,b.image.height],E.gl.RGBA)),E.activeTexture.set(E.gl.TEXTURE0+qr.LUT),b.texture&&b.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(h.texcoordBuffer)),h.colorBuffer&&(g.push(12===h.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(h.colorBuffer)),h.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(h.normalBuffer)),h.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(h.pbrBuffer)),"OPAQUE"!==w.alphaMode&&"MASK"!==w.alphaMode||g.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function Ao(g,l,h,y,b,w){const E=h.paint.get("model-opacity"),M=l.context,O=new d.af(l.context.gl.LEQUAL,d.af.ReadWrite,l.depthRangeFor3D),R=l.transform,k=g.mesh,B=k.material,U=B.pbrMetallicRoughness,j=l.style.fog;let Z;Z="pixels"===l.transform.projection.zAxisUnit?[...g.nodeModelMatrix]:d.ae.multiply([],y.zScaleMatrix,g.nodeModelMatrix),d.ae.multiply(Z,y.negCameraPosMatrix,Z);const Y=d.ae.invert([],Z);d.ae.transpose(Y,Y);const X=h.paint.get("model-emissive-strength").constantOr(0),W=ld(new Float32Array(g.worldViewProjection),new Float32Array(Z),new Float32Array(Y),null,l,E,U.baseColorFactor.toRenderColor(null),B.emissiveFactor,U.metallicFactor,U.roughnessFactor,B,X,h),K={defines:[]},te=[];gl(K.defines,te,k,l,h.lut);const se=l.shadowRenderer;se&&(se.useNormalOffset=!1);let he=null;if(j){const ye=gd(g.nodeModelMatrix,l.transform);if(he=new Float32Array(ye),"globe"!==R.projection.name){const pe=k.aabb.min,Se=k.aabb.max,[xe,ae]=j.getOpacityForBounds(ye,pe[0],pe[1],Se[0],Se[1]);K.overrideFog=xe>=Qn||ae>=Qn}}const ce=Zo(l,h.paint.get("model-cutoff-fade-range"));ce.shouldRenderCutoff&&K.defines.push("RENDER_CUTOFF");const ue=l.getOrCreateProgram("model",K);l.uploadCommonUniforms(M,ue,null,he,ce),"shadow"!==l.renderPass&&se&&se.setupShadowsFromMatrix(g.nodeModelMatrix,ue),ue.draw(l,M.gl.TRIANGLES,O,b,w,k.material.doubleSided?d.ag.disabled:d.ag.backCCW,W,h.id,k.vertexBuffer,k.indexBuffer,k.segments,h.paint,l.transform.zoom,void 0,te)}function pr(g,l,h,y,b,w,E){let M;M="globe"===g.projection.name?d.ck(h,g):[...h],d.ae.multiply(M,M,l.matrix);const O=d.ae.multiply([],y,M);if(l.meshes)for(const R of l.meshes){if("BLEND"!==R.material.alphaMode){E.push({mesh:R,depth:0,modelIndex:b,worldViewProjection:O,nodeModelMatrix:M});continue}const k=d.$.transformMat4([],R.centroid,O);k[2]>0&&w.push({mesh:R,depth:k[2],modelIndex:b,worldViewProjection:O,nodeModelMatrix:M})}if(l.children)for(const R of l.children)pr(g,R,h,y,b,w,E)}function Ty(g,l,h,y){const b=h.shadowRenderer;if(!b)return;const w=b.getShadowPassDepthMode(),E=b.getShadowPassColorMode(),M=b.calculateShadowPassMatrixFromMatrix(l),O=Li(M);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,w,d.ah.disabled,E,d.ag.backCCW,O,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,h.transform.zoom,void 0,void 0)}function hp(g,l,h){const y=l.updateZoomBasedPaintProperties(),b=function(w,E,M){let O,R,k,B=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&B>0){const U=w.terrain,j=U.findDEMTileFor(M);j&&j.dem?O=d.cm.create(U,M,j):B=0}if(0===B&&(E.terrainElevationMin=0,E.terrainElevationMax=0),B===E.validForExaggeration&&(0===B||O&&O._demTile&&O._demTile.tileID===E.validForDEMTile.id&&O._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const U in E.instancesPerModel){const j=E.instancesPerModel[U];for(let Z=0;Z<j.instancedDataArray.length;++Z){const Y=(O?B*O.getElevationAt(0|j.instancedDataArray.float32[16*Z],0|j.instancedDataArray.float32[16*Z+1],!0,!0):0)+j.instancesEvaluatedElevation[Z];j.instancedDataArray.float32[16*Z+6]=Y,R=R?Math.min(E.terrainElevationMin,Y):Y,k=k?Math.max(E.terrainElevationMax,Y):Y}}return E.terrainElevationMin=R||0,E.terrainElevationMax=k||0,E.validForExaggeration=B,E.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,h);(y||b)&&(l.uploaded=!1,l.upload(g.context))}const vs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new d.b8([0,0,0],[d.a4,d.a4,0])};function _l(g,l){const h=1<<g.canonical.z,y=l.getFreeCameraOptions().position,b=l.elevation,w=g.canonical.x/h,E=(g.canonical.x+1)/h,M=g.canonical.y/h,O=(g.canonical.y+1)/h;let R=l._centerAltitude;if(b){const j=b.getMinMaxForTile(g);j&&j.max>R&&(R=j.max)}const k=d.au(y.x,w,E)-y.x,B=d.au(y.y,M,O)-y.y,U=d.ay(R,l.center.lat)-y.z;return l._zoomFromMercatorZ(Math.sqrt(k*k+B*B+U*U))}function _d(g,l,h,y,b,w,E){const M=g.context,O="shadow"===g.renderPass,R=g.shadowRenderer,k=O&&R?R.getShadowPassDepthMode():new d.af(M.gl.LEQUAL,d.af.ReadWrite,g.depthRangeFor3D),B=g.isTileAffectedByFog(w);if(h.meshes)for(const U of h.meshes){const j=["MODEL_POSITION_ON_GPU"],Z=[];let Y,X,W;y.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const K=Zo(g,l.paint.get("model-cutoff-fade-range"));if(K.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),O&&R)Y=g.getOrCreateProgram("modelDepth",{defines:j}),X=Li(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(h.matrix)),W=R.getShadowPassColorMode();else{gl(j,Z,U,g,l.lut),Y=g.getOrCreateProgram("model",{defines:j,overrideFog:B});const se=U.material,he=se.pbrMetallicRoughness,ce=l.paint.get("model-opacity"),ue=l.paint.get("model-emissive-strength").constantOr(0);X=ld(w.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,g,ce,he.baseColorFactor.toRenderColor(null),se.emissiveFactor,he.metallicFactor,he.roughnessFactor,se,ue,l,b),R&&(E.shadowUniformsInitialized?Y.setShadowUniformValues(M,R.getShadowUniformValues()):(R.setupShadows(w.toUnwrapped(),Y,"model-tile",w.overscaledZ),E.shadowUniformsInitialized=!0)),W=K.shouldRenderCutoff||ce<1||"OPAQUE"!==se.alphaMode?d.a.alphaBlended:d.a.unblended}g.uploadCommonUniforms(M,Y,w.toUnwrapped(),null,K);const te=U.material.doubleSided?d.ag.disabled:d.ag.backCCW;if(y.instancedDataArray.length>20)Z.push(y.instancedDataBuffer),Y.draw(g,M.gl.TRIANGLES,k,d.ah.disabled,W,te,X,l.id,U.vertexBuffer,U.indexBuffer,U.segments,l.paint,g.transform.zoom,void 0,Z,y.instancedDataArray.length);else{const se=O?"u_instance":"u_normal_matrix";for(let he=0;he<y.instancedDataArray.length;++he)X[se]=new Float32Array(y.instancedDataArray.arrayBuffer,64*he,16),Y.draw(g,M.gl.TRIANGLES,k,d.ah.disabled,W,te,X,l.id,U.vertexBuffer,U.indexBuffer,U.segments,l.paint,g.transform.zoom,void 0,Z)}}if(h.children)for(const U of h.children)_d(g,l,U,y,b,w,E)}const yd=[1,-1,1];function fo(g,l,h,y){if(!h.modelManager)return!0;const b=h.modelManager;if(!h.shadowRenderer)return!0;const w=h.shadowRenderer,E=l.aabb;let M=!0,O=g.maxHeight;if(0===O){let k=0;for(const B in g.instancesPerModel){const U=b.getModel(B,y);U?k=Math.max(k,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):M=!1}O=g.maxScale*k*1.41+g.maxVerticalOffset,M&&(g.maxHeight=O)}E.max[2]=O,E.min[2]+=g.terrainElevationMin,E.max[2]+=g.terrainElevationMax,d.$.transformMat4(E.min,E.min,l.tileMatrix),d.$.transformMat4(E.max,E.max,l.tileMatrix);const R=E.intersects(w.getCurrentCascadeFrustum());return 0===h.currentShadowCascade&&(g.isInsideFirstShadowMapFrustum=2===R),0===R}function Rr(g,l){const h=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],b=g.uniformValues.u_cutoff_params[2],w=g.uniformValues.u_cutoff_params[3];return y===h||w===b?1:d.au(((l-h)/(y-h)-b)/(w-b),0,1)}function vd(g,l,h,y){if(l.pitch<20)return 1;const b=l.getWorldToCameraMatrix(),w=d.ae.multiply([],b,g),E=[...h.min,1];let M=d.aB.transformMat4([],E,w),O=M,R=M;E[1]=h.max[1],M=d.aB.transformMat4([],E,w),O=M[1]<O[1]?M:O,R=M[1]>R[1]?M:R,E[0]=h.max[0],M=d.aB.transformMat4([],E,w),O=M[1]<O[1]?M:O,R=M[1]>R[1]?M:R,E[1]=h.min[1],M=d.aB.transformMat4([],E,w),O=M[1]<O[1]?M:O,R=M[1]>R[1]?M:R;const k=d.au(y[0],0,1),B=100*l.pixelsPerMeter*d.au(y[1],0,1),U=d.au(y[2],0,1),j=d.$.lerp([],O,R,k),Z=Math.tan(.5*l.fovX),Y=-j[2]*Z;if(0===B)return j[1]<-Math.abs(Y)?U:1;const X=(-Math.abs(Y)-j[1])/B,W=(te,se,he)=>(1-he)*te+he*se,K=d.au(W(1,U,X),U,1);return W(1,K,d.au((l.pitch-20)/20,0,1))}class au{}class hn{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,h,y){{const B=this._storage.get(h.id);if(B)return B.lastUsedFrameIdx=l,B.buf}const b=y.gl,w=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),E=new ArrayBuffer(w),M=new Int16Array(E);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const O=new d.co;for(let B=0;B<w/2;B+=3){const U=M[B],j=M[B+1],Z=M[B+2];O.emplaceBack(U,j),O.emplaceBack(j,Z),O.emplaceBack(Z,U)}const R=y.bindVertexArrayOES.current,k=new au;return k.buf=new d.I(y,O),k.lastUsedFrameIdx=l,this._storage.set(h.id,k),y.bindVertexArrayOES.set(R),k.buf}update(l){for(const[h,y]of this._storage)l-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(h))}destroy(){for(const[l,h]of this._storage)h.buf.destroy(),this._storage.delete(l)}}class ri{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const qa={symbol:function(g,l,h,y,b){if("translucent"!==g.renderPass)return;const w=d.ah.disabled,E=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(R,k,B,U,j,Z,Y){const X=k.transform,W="map"===j,K="map"===Z;for(const te of R){const se=U.getTile(te),he=se.getBucket(B);if(!he||!he.text||!he.text.segments.get().length)continue;const ce=d.aE(he.textSizeData,X.zoom),ue=xy(te,he.getProjection(),X),ye=X.calculatePixelsToTileUnitsMatrix(se),pe=td(ue,se.tileID.canonical,K,W,X,he.getProjection(),ye),Se=he.hasIconTextFit()&&he.hasIconData();if(ce){const xe=Math.pow(2,X.zoom-se.tileID.overscaledZ);dC(he,W,K,Y,d.bQ,X,pe,te,xe,ce,Se)}}}(y,g,h,l,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),b);const M=0!==h.paint.get("icon-opacity").constantOr(1),O=0!==h.paint.get("text-opacity").constantOr(1);void 0!==h.layout.get("symbol-sort-key").constantOr(1)&&(M||O)?Bh(g,l,h,y,w,E):(M&&Bh(g,l,h,y,w,E,{onlyIcons:!0}),O&&Bh(g,l,h,y,w,E,{onlyText:!0})),l.map.showCollisionBoxes&&(Oi(g,l,h,y,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Oi(g,l,h,y,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,h,y){if("translucent"!==g.renderPass)return;const b=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),M=void 0!==h.layout.get("circle-sort-key").constantOr(1),O=h.paint.get("circle-emissive-strength");if(0===b.constantOr(1)&&(0===w.constantOr(1)||0===E.constantOr(1)))return;const R=g.context,k=R.gl,B=g.transform,U=g.depthModeForSublayer(0,d.af.ReadOnly),j=d.ah.disabled,Z=g.colorModeForDrapableLayerRenderPass(O),Y="globe"===B.projection.name,X=[d.ak(B.center.lng),d.al(B.center.lat)],W=[];for(let te=0;te<y.length;te++){const se=y[te],he=l.getTile(se),ce=he.getBucket(h);if(!ce||ce.projection.name!==B.projection.name)continue;const ue=ce.programConfigurations.get(h.id),ye=d.bT(h),pe=g.isTileAffectedByFog(se);Y&&ye.push("PROJECTION_GLOBE_VIEW"),ye.push("DEPTH_D24"),g.terrain&&B.depthOcclusionForSymbolsAndCircles&&ye.push("DEPTH_OCCLUSION");const Se=g.getOrCreateProgram("circle",{config:ue,defines:ye,overrideFog:pe}),xe=ce.layoutVertexBuffer,ae=ce.globeExtVertexBuffer,Fe=ce.indexBuffer,ke=B.projection.createInversionMatrix(B,se.canonical),Ee={programConfiguration:ue,program:Se,layoutVertexBuffer:xe,globeExtVertexBuffer:ae,indexBuffer:Fe,uniformValues:d.bU(g,se,he,ke,X,h),tile:he};if(M){const We=ce.segments.get();for(const Ye of We)W.push({segments:new d.b([Ye]),sortKey:Ye.sortKey,state:Ee})}else W.push({segments:ce.segments,sortKey:0,state:Ee})}M&&W.sort((te,se)=>te.sortKey-se.sortKey);const K={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const te of W){const{programConfiguration:se,program:he,layoutVertexBuffer:ce,globeExtVertexBuffer:ue,indexBuffer:ye,uniformValues:pe,tile:Se}=te.state,xe=te.segments;g.terrain&&g.terrain.setupElevationDraw(Se,he,K),g.uploadCommonUniforms(R,he,Se.tileID.toUnwrapped()),he.draw(g,k.TRIANGLES,U,j,Z,d.ag.disabled,pe,h.id,ce,ye,xe,h.paint,B.zoom,se,[ue])}},heatmap:function(g,l,h,y){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const b=g.context,w=b.gl,E=d.ah.disabled,M=new d.a([w.ONE,w.ONE,w.ONE,w.ONE],d.C.transparent,[!0,!0,!0,!0]);(function(j,Z,Y,X){const W=j.gl,K=Z.width*X,te=Z.height*X;j.activeTexture.set(W.TEXTURE1),j.viewport.set([0,0,K,te]);let se=Y.heatmapFbo;if(!se||se&&(se.width!==K||se.height!==te)){se&&se.destroy();const he=W.createTexture();W.bindTexture(W.TEXTURE_2D,he),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),se=Y.heatmapFbo=j.createFramebuffer(K,te,!0,null),function(ce,ue,ye,pe,Se,xe){const ae=ce.gl;ae.texImage2D(ae.TEXTURE_2D,0,ce.extRenderToTextureHalfFloat?ae.RGBA16F:ae.RGBA,Se,xe,0,ae.RGBA,ce.extRenderToTextureHalfFloat?ae.HALF_FLOAT:ae.UNSIGNED_BYTE,null),pe.colorAttachment.set(ye)}(j,0,he,se,K,te)}else W.bindTexture(W.TEXTURE_2D,se.colorAttachment.get()),j.bindFramebuffer.set(se.framebuffer)})(b,g,h,"globe"===g.transform.projection.name?.5:.25),b.clear({color:d.C.transparent});const O=g.transform,R="globe"===O.projection.name,k=R?["PROJECTION_GLOBE_VIEW"]:[],B=R?d.ag.frontCCW:d.ag.disabled,U=[d.ak(O.center.lng),d.al(O.center.lat)];for(let j=0;j<y.length;j++){const Z=y[j];if(l.hasRenderableParent(Z))continue;const Y=l.getTile(Z),X=Y.getBucket(h);if(!X||X.projection.name!==O.projection.name)continue;const W=g.isTileAffectedByFog(Z),K=X.programConfigurations.get(h.id),te=g.getOrCreateProgram("heatmap",{config:K,defines:k,overrideFog:W}),{zoom:se}=g.transform;g.terrain&&g.terrain.setupElevationDraw(Y,te),g.uploadCommonUniforms(b,te,Z.toUnwrapped());const he=O.projection.createInversionMatrix(O,Z.canonical);te.draw(g,w.TRIANGLES,d.af.disabled,E,M,B,iu(g,Z,Y,he,U,se,h.paint.get("heatmap-intensity")),h.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,h.paint,g.transform.zoom,K,R?[X.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,w){const E=b.context,M=E.gl,O=w.heatmapFbo;if(!O)return;E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,O.colorAttachment.get()),E.activeTexture.set(M.TEXTURE1);let R=w.colorRampTexture;R||(R=w.colorRampTexture=new d.T(E,w.colorRamp,M.RGBA)),R.bind(M.LINEAR,M.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,M.TRIANGLES,d.af.disabled,d.ah.disabled,b.colorModeForRenderPass(),d.ag.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,w.paint,b.transform.zoom)}(g,h))},line:function(g,l,h,y){if("translucent"!==g.renderPass)return;const b=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(0===b.constantOr(1)||0===w.constantOr(1))return;const E=h.paint.get("line-emissive-strength"),M=h.paint.get("line-occlusion-opacity"),O=g.context,R=O.gl,k=h.layout.get("line-z-offset"),B=!k.isConstant()||!!k.constantOr(0),U=B?new d.af(g.depthOcclusion?R.GREATER:R.LEQUAL,d.af.ReadOnly,g.depthRangeFor3D):g.depthModeForSublayer(0,d.af.ReadOnly),j=g.colorModeForDrapableLayerRenderPass(E),Z=g.terrain&&g.terrain.renderingToTexture,Y=Z?1:d.e.devicePixelRatio,X=h.paint.get("line-dasharray"),W=X.constantOr(1),K=h.layout.get("line-cap"),te=X.constantOr(null),se=K.constantOr(null),he=h.paint.get("line-pattern"),ce=he.constantOr(1),ue=he.constantOr(null),ye=h.paint.get("line-opacity").constantOr(1);let pe=!ce&&1!==ye||g.depthOcclusion&&M>0&&M<1;const Se=h.paint.get("line-gradient"),xe=ce?"linePattern":"line",ae=d.bV(h);let Fe;if(Z&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(pe=!1),0!==M&&g.depthOcclusion){const Ee=h.paint._values["line-opacity"];Ee&&Ee.value&&"constant"===Ee.value.kind?Fe=Ee.value:d.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(B&&(g.forceTerrainMode=!0),!B&&0!==M&&g.terrain&&!Z)return void d.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const ke=pe&&B?g.stencilModeFor3D():d.ah.disabled;for(const Ee of y){const We=l.getTile(Ee);if(ce&&!We.patternsLoaded())continue;const Ye=We.getBucket(h);if(!Ye)continue;g.prepareDrawTile();const Oe=Ye.programConfigurations.get(h.id),ze=g.isTileAffectedByFog(Ee),Te=g.getOrCreateProgram(xe,{config:Oe,defines:B?[...ae,"ELEVATED"]:ae,overrideFog:ze});if(ue&&We.imageAtlas){const Ct=We.imageAtlas.patternPositions[ue.toString()];Ct&&Oe.setConstantPatternPositions(Ct)}if(!ce&&te&&se&&We.lineAtlas){const Ct=We.lineAtlas.getDash(te,se);Ct&&Oe.setConstantPatternPositions(Ct)}let[Ke,Xe]=h.paint.get("line-trim-offset");("round"===se||"square"===se)&&Ke!==Xe&&(0===Ke&&(Ke-=1),1===Xe&&(Xe+=1));const bt=Z?Ee.projMatrix:null,pt=ce?d.bW(g,We,h,bt,Y,[Ke,Xe]):d.bX(g,We,h,bt,Ye.lineClipsArray.length,Y,[Ke,Xe]);if(Se){const Ct=Ye.gradients[h.id];let Gt=Ct.texture;if(h.gradientVersion!==Ct.version){let rn=256;if(h.stepInterpolant){const en=l.getSource().maxzoom,mn=Ee.canonical.z===en?Math.ceil(1<<g.transform.maxZoom-Ee.canonical.z):1;rn=d.au(d.bY(Ye.maxLineLength/d.a4*1024*mn),256,O.maxTextureSize)}Ct.gradient=d.bZ({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:rn,image:Ct.gradient||void 0,clips:Ye.lineClipsArray}),Ct.texture?Ct.texture.update(Ct.gradient):Ct.texture=new d.T(O,Ct.gradient,R.RGBA),Ct.version=h.gradientVersion,Gt=Ct.texture}O.activeTexture.set(R.TEXTURE1),Gt.bind(h.stepInterpolant?R.NEAREST:R.LINEAR,R.CLAMP_TO_EDGE)}W&&(O.activeTexture.set(R.TEXTURE0),We.lineAtlasTexture&&We.lineAtlasTexture.bind(R.LINEAR,R.REPEAT),Oe.updatePaintBuffers()),ce&&(O.activeTexture.set(R.TEXTURE0),We.imageAtlasTexture&&We.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Oe.updatePaintBuffers()),B&&g.terrain.setupElevationDraw(We,Te),g.uploadCommonUniforms(O,Te,Ee.toUnwrapped());const nt=Ct=>{null!=Fe&&(Fe.value=ye*M),Te.draw(g,R.TRIANGLES,U,Ct,j,d.ag.disabled,pt,h.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,h.paint,g.transform.zoom,Oe,[Ye.layoutVertexBuffer2,Ye.patternVertexBuffer,Ye.zOffsetVertexBuffer]),null!=Fe&&(Fe.value=ye)};if(pe&&!B){const Ct=g.stencilModeForClipping(Ee).ref;0===Ct&&Z&&O.clear({stencil:0});const Gt={func:R.EQUAL,mask:255};pt.u_alpha_discard_threshold=.8,nt(new d.ah(Gt,Ct,255,R.KEEP,R.KEEP,R.INVERT)),pt.u_alpha_discard_threshold=0,nt(new d.ah(Gt,Ct,255,R.KEEP,R.KEEP,R.KEEP))}else pe&&B&&(pt.u_alpha_discard_threshold=.001),nt(B?ke:g.stencilModeForClipping(Ee))}pe&&(g.resetStencilClippingMasks(),Z&&O.clear({stencil:0})),0===M||g.depthOcclusion||Z||g.layersWithOcclusionOpacity.push(g.currentLayer),B&&(g.forceTerrainMode=!1)},fill:function(g,l,h,y){const b=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(0===w.constantOr(1))return;const E=h.paint.get("fill-emissive-strength"),M=g.colorModeForDrapableLayerRenderPass(E),O=h.paint.get("fill-pattern"),R=g.opaquePassEnabledForLayer()&&!O.constantOr(1)&&1===b.constantOr(d.C.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(g.renderPass===R){const k=g.depthModeForSublayer(1,"opaque"===g.renderPass?d.af.ReadWrite:d.af.ReadOnly);oa(g,l,h,y,k,M,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const k=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,d.af.ReadOnly);oa(g,l,h,y,k,M,!0)}},"fill-extrusion":function(g,l,h,y){const b=h.paint.get("fill-extrusion-opacity"),w=g.context,E=w.gl,M=g.terrain,O=M&&M.renderingToTexture;if(0===b)return;const R=g.conflationActive&&g.style.isLayerClipped(h,l.getSource()),k=g.style.order.indexOf(h.fqid);if(R&&function(B,U,j,Z,Y){for(const X of Z){const W=U.getTile(X).getBucket(j);W&&(W.updateReplacement(X,B.replacementSource,Y),W.uploadCentroid(B.context))}}(g,l,h,y,k),M||R)for(const B of y){const U=l.getTile(B).getBucket(h);U&&hC(g.context,l,B,U,h,M,R)}if("shadow"===g.renderPass&&g.shadowRenderer){const B=g.shadowRenderer;if(M&&b<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof d.Z)return;const U=B.getShadowPassDepthMode(),j=B.getShadowPassColorMode();ud(g,l,h,y,U,d.ah.disabled,j,R)}else if("translucent"===g.renderPass){const B=!h.paint.get("fill-extrusion-pattern").constantOr(1),U=h.paint.get("fill-extrusion-color").constantOr(d.C.white);if(!O&&0!==U.a){const j=new d.af(g.context.gl.LEQUAL,d.af.ReadWrite,g.depthRangeFor3D);1===b&&B?ud(g,l,h,y,j,d.ah.disabled,d.a.unblended,R):(ud(g,l,h,y,j,d.ah.disabled,d.a.disabled,R),ud(g,l,h,y,j,g.stencilModeFor3D(),g.colorModeForRenderPass(),R),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&B&&(!M&&"globe"!==g.transform.projection.name||O)){const j=h.paint.get("fill-extrusion-opacity"),Z=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=h.paint.get("fill-extrusion-flood-light-intensity"),W=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),K=Z>0&&Y>0,te=X>0,se=(ce,ue,ye)=>(1-ye)*ce+ye*ue,he=ce=>{const ue=g.depthModeForSublayer(1,d.af.ReadOnly,E.LEQUAL,!0),ye=h.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),pe=se(.1,3,ye),Se=g._showOverdrawInspector;if(!Se){const xe=new d.ah({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),ae=new d.a([E.ONE,E.ONE,E.ONE,E.ONE],d.C.transparent,[!1,!1,!1,!0],E.MIN);zh(g,l,h,y,ue,xe,ae,d.ag.disabled,ce,"sdf",j,Z,Y,X,W,pe,R,!1)}{const xe=Se?d.ah.disabled:new d.ah({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),ae=Se?g.colorModeForRenderPass():new d.a([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],d.C.transparent,[!0,!0,!0,!0]);zh(g,l,h,y,ue,xe,ae,d.ag.disabled,ce,"color",j,Z,Y,X,W,pe,R,!1)}};if(O){const ce=(ue,ye,pe)=>{const Se=g.depthModeForSublayer(1,d.af.ReadOnly,E.LEQUAL,!1),xe=h.paint.get(ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ae=se(.1,3,xe);{const Fe=new d.a([E.ONE,E.ONE,E.ONE,E.ONE],d.C.transparent,[!1,!1,!1,!0]);zh(g,l,h,y,Se,d.ah.disabled,Fe,d.ag.disabled,ue,"clear",j,Z,Y,X,W,ae,R,ye)}{const Fe=new d.ah({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),ke=new d.a([E.ONE,E.ONE,E.ONE,E.ONE],d.C.transparent,[!1,!1,!1,!0],E.MIN);zh(g,l,h,y,Se,Fe,ke,d.ag.disabled,ue,"sdf",j,Z,Y,X,W,ae,R,ye)}{const Fe=ue?E.ZERO:E.ONE_MINUS_DST_ALPHA,ke=new d.ah({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Ee=new d.a([Fe,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],d.C.transparent,[!0,!0,!0,!0]);zh(g,l,h,y,Se,ke,Ee,d.ag.disabled,ue,"color",j,Z,Y,X,W,ae,R,ye)}{const Fe=new d.a([E.ONE,E.ONE,E.ONE,ue?E.ZERO:E.ONE],d.C.transparent,[!1,!1,!1,!0],ue?E.FUNC_ADD:E.MAX);zh(g,l,h,y,Se,d.ah.disabled,Fe,d.ag.disabled,ue,"clear",j,Z,Y,X,W,ae,R,ye,pe)}};if(K||te){let ue;if(g.prepareDrawTile(),M){const ye=M.drapeBufferSize[0],pe=M.drapeBufferSize[1];ue=M.framebufferCopyTexture,ue&&(!ue||ue.size[0]===ye&&ue.size[1]===pe)||(ue&&ue.destroy(),ue=M.framebufferCopyTexture=new d.T(w,new d.j({width:ye,height:pe}),E.RGBA)),ue.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,ye,pe,0)}K&&ce(!0,!1,ue),te&&ce(!1,!0,ue)}}else K&&he(!0),te&&he(!1),(K||te)&&g.resetStencilClippingMasks()}}},hillshade:function(g,l,h,y){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass||g.style.disableElevatedTerrain)return;const b=g.context,w=g.terrain&&g.terrain.renderingToTexture,[E,M]="translucent"!==g.renderPass||w?[{},y]:g.stencilConfigForOverlap(y);for(const O of M){const R=l.getTile(O);if(R.needsHillshadePrepare&&"offscreen"===g.renderPass)v1(g,R,h);else if("translucent"===g.renderPass){const k=g.depthModeForSublayer(0,d.af.ReadOnly),B=h.paint.get("hillshade-emissive-strength"),U=g.colorModeForDrapableLayerRenderPass(B),j=w&&g.terrain?g.terrain.stencilModeForRTTOverlap(O):E[O.overscaledZ];dy(g,O,R,h,k,j,U)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,h,y,b,w){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity"))return;const E="globe"===g.transform.projection.name,M=0!==h.paint.get("raster-elevation"),O=M&&E;if(g.renderElevatedRasterBackface&&!O)return;const R=g.context,k=R.gl,B=l.getSource(),U=function(ce,ue,ye,pe){const Se=ue.paint.get("raster-color"),xe="raster-array"===ce.type,ae=[],Fe=ue.paint.get("raster-resampling"),ke=ue.paint.get("raster-color-mix");let Ee=ue.paint.get("raster-color-range");const We=[ke[0],ke[1],ke[2],0],Ye=ke[3];let Oe="nearest"===Fe?pe.NEAREST:pe.LINEAR;if(xe&&(ae.push("RASTER_ARRAY"),Se||ae.push("RASTER_COLOR"),"linear"===Fe&&ae.push("RASTER_ARRAY_LINEAR"),Oe=pe.NEAREST,!Ee&&ce.rasterLayers)){const ze=ce.rasterLayers.find(({id:Te})=>Te===ue.sourceLayer);ze&&ze.fields&&ze.fields.range&&(Ee=ze.fields.range)}if(Ee=Ee||[0,1],Se){ae.push("RASTER_COLOR"),ye.activeTexture.set(pe.TEXTURE2),ue.updateColorRamp(Ee);let ze=ue.colorRampTexture;ze||(ze=ue.colorRampTexture=new d.T(ye,ue.colorRamp,pe.RGBA)),ze.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}return{mix:We,range:Ee,offset:Ye,defines:ae,resampling:Oe}}(B,h,R,k);if(B instanceof d.bo&&!y.length&&!E)return;const j=h.paint.get("raster-emissive-strength"),Z=g.colorModeForDrapableLayerRenderPass(j),Y=g.terrain&&g.terrain.renderingToTexture,X=!g.options.moving,W="nearest"===h.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;if(B instanceof d.bo&&!y.length&&(B.onNorthPole||B.onSouthPole)){const ce=M?g.stencilModeFor3D():d.ah.disabled;return void Io(!!B.onNorthPole,null,g,l,h,j,U,d.ag.disabled,ce)}if(!y.length)return;const[K,te]=B instanceof d.bo||Y?[{},y]:g.stencilConfigForOverlap(y),se=te[te.length-1].overscaledZ;O&&U.defines.push("PROJECTION_GLOBE_VIEW"),M&&U.defines.push("RENDER_CUTOFF");const he=(ce,ue,ye)=>{for(const pe of ce){const Se=pe.toUnwrapped(),xe=l.getTile(pe);if(Y&&(!xe||!xe.hasData()))continue;R.activeTexture.set(k.TEXTURE0);const ae=dd(xe,B,h,U);if(!ae||!ae.texture)continue;const{texture:Fe,mix:ke,offset:Ee,tileSize:We,buffer:Ye}=ae;let Oe,ze;Y?(Oe=d.af.disabled,ze=pe.projMatrix):M?(Oe=new d.af(k.LEQUAL,d.af.ReadWrite,g.depthRangeFor3D),ze=E?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Se,X)):(Oe=g.depthModeForSublayer(pe.overscaledZ-se,1===h.paint.get("raster-opacity")?d.af.ReadWrite:d.af.ReadOnly,k.LESS),ze=g.transform.calculateProjMatrix(Se,X));const Te=g.terrain&&Y?g.terrain.stencilModeForRTTOverlap(pe):K[pe.overscaledZ],Ke=w?0:h.paint.get("raster-fade-duration");xe.registerFadeDuration(Ke);const Xe=l.findLoadedParent(pe,0),bt=Hm(xe,Xe,l,g.transform,Ke);let pt,nt;g.terrain&&g.terrain.prepareDrawTile(),R.activeTexture.set(k.TEXTURE0),Fe.bind(W,k.CLAMP_TO_EDGE),R.activeTexture.set(k.TEXTURE1),Xe?(Xe.texture&&Xe.texture.bind(W,k.CLAMP_TO_EDGE),pt=Math.pow(2,Xe.tileID.overscaledZ-xe.tileID.overscaledZ),nt=[xe.tileID.canonical.x*pt%1,xe.tileID.canonical.y*pt%1]):Fe.bind(W,k.CLAMP_TO_EDGE),Fe.useMipmap&&R.extTextureFilterAnisotropic&&g.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Ct=g.transform;let Gt;const rn=M?Rn(Ct):[0,0,0,0];let en,mn,on,xi,An,vn=0;if(O&&B instanceof d.bo&&B.coordinates.length>3)en=Float32Array.from(d.bh(d.bi(new d.aO(0,0,0)))),mn=Float32Array.from(Ct.globeMatrix),on=Float32Array.from(d.bd(Ct)),xi=[d.ak(Ct.center.lng),d.al(Ct.center.lat)],Gt=B.elevatedGlobePerspectiveTransform,An=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const nn=d.be(pe.canonical);vn=d.bf(nn.getCenter().lat),en=Float32Array.from(d.bh(d.bi(pe.canonical))),mn=Float32Array.from(Ct.globeMatrix),on=Float32Array.from(d.bd(Ct)),xi=[d.ak(Ct.center.lng),d.al(Ct.center.lat)],Gt=[0,0],An=Float32Array.from(d.bg(pe.canonical,nn,vn,Ct.worldSize/Ct._pixelsPerMercatorPixel))}else Gt=B instanceof d.bo?B.perspectiveTransform:[0,0],en=new Float32Array(16),mn=new Float32Array(9),on=new Float32Array(16),xi=[0,0],An=new Float32Array(9);const oi=Qm(ze,en,mn,on,An,nt||[0,0],d.a2(g.transform.zoom),xi,rn,pt||1,bt,h,Gt,M?h.paint.get("raster-elevation"):0,2,ke,Ee,U.range,We,Ye,j),xn=g.isTileAffectedByFog(pe),Mn=g.getOrCreateProgram("raster",{defines:U.defines,overrideFog:xn});if(g.uploadCommonUniforms(R,Mn,Se),B instanceof d.bo){const nn=B.elevatedGlobeVertexBuffer,Bn=B.elevatedGlobeIndexBuffer;if(Y||!E)B.boundsBuffer&&B.boundsSegments&&Mn.draw(g,k.TRIANGLES,Oe,d.ah.disabled,Z,d.ag.disabled,oi,h.id,B.boundsBuffer,g.quadTriangleIndexBuffer,B.boundsSegments);else if(nn&&Bn){const kn=Ct.zoom<=d.b3?B.elevatedGlobeSegments:B.getSegmentsForLongitude(Ct.center.lng);kn&&Mn.draw(g,k.TRIANGLES,Oe,d.ah.disabled,Z,ue,oi,h.id,nn,Bn,kn)}}else if(O){Oe=new d.af(k.LEQUAL,d.af.ReadOnly,g.depthRangeFor3D);const nn=g.globeSharedBuffers;if(nn){const[Bn,kn,cn]=nn.getGridBuffers(vn,!1);Mn.draw(g,k.TRIANGLES,Oe,ye||Te,g.colorModeForRenderPass(),ue,oi,h.id,Bn,kn,cn)}}else{const{tileBoundsBuffer:nn,tileBoundsIndexBuffer:Bn,tileBoundsSegments:kn}=g.getTileBoundsBuffers(xe);Mn.draw(g,k.TRIANGLES,Oe,Te,Z,d.ag.disabled,oi,h.id,nn,Bn,kn)}}if(!(B instanceof d.bo)&&O)for(const pe of ce){const Se=pe.canonical.y===(1<<pe.canonical.z)-1;0===pe.canonical.y&&Io(!0,pe,g,l,h,j,U,ue,ye||d.ah.disabled),Se&&Io(!1,pe,g,l,h,j,U,ue===d.ag.frontCW?d.ag.backCW:d.ag.frontCW,ye||d.ah.disabled)}};O?he(te,g.renderElevatedRasterBackface?d.ag.backCW:d.ag.frontCW,g.stencilModeFor3D()):he(te,d.ag.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,l,h,y,b,w){"offscreen"===g.renderPass&&function(E,M,O,R){if(!R.length)return;const k=E.context,B=k.gl,U=M.getSource();if(!(U instanceof ec))return;const j=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let Z=O.particlePositionRGBAImage;if(!Z||Z.width!==j){const te=function(se){const he=se*se,ce=new Uint8Array(4*he),ue=function(pe){return pe|=0,pe=Math.imul(2747636419^pe,2654435769),pe=Math.imul(pe^pe>>>16,2654435769),((pe=Math.imul(pe^pe>>>16,2654435769))>>>0)/4294967296},ye=1/1.1;for(let pe=0;pe<he;pe++){const Se=ye*(ue(2*pe+0)+wa),xe=ye*(ue(2*pe+1)+wa),ae=255*Se%1,Fe=255*xe%1,ke=ae,Ee=xe-Fe/255,We=Fe;ce[4*pe+0]=255*(Se-ae/255),ce[4*pe+1]=255*ke,ce[4*pe+2]=255*Ee,ce[4*pe+3]=255*We}return ce}(j);Z=O.particlePositionRGBAImage=new d.j({width:j,height:j},te)}let Y=O.particleFramebuffer;Y?Y.width!==j&&(Y.destroy(),Y=O.particleFramebuffer=k.createFramebuffer(j,j,!0,null)):Y=O.particleFramebuffer=k.createFramebuffer(j,j,!0,null);const X=[];for(const te of R){const se=M.getTile(te);if(!(se instanceof d.c5))continue;const he=T1(se,U,O);if(!he)continue;const ce=[se.tileSize,se.tileSize];let ue=O.tileFramebuffer;ue||(ue=O.tileFramebuffer=k.createFramebuffer(ce[0],ce[1],!0,null));let ye=se.rasterParticleState;ye||(ye=se.rasterParticleState=new Xc(k,te,ce,Z));const pe=ye.update(O.lastInvalidatedAt);ye.particleTextureDimension!==j&&ye.updateParticleTexture(te,Z);const Se=ye.targetColorTexture;ye.targetColorTexture=ye.backgroundColorTexture,ye.backgroundColorTexture=Se;const xe=ye.particleTexture0;ye.particleTexture0=ye.particleTexture1,ye.particleTexture1=xe,X.push([te,he,ye,pe])}if(0===X.length)return;const W=d.e.now(),K=O.previousDrawTimestamp?.001*(W-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=W,O.hasColorMap()){k.activeTexture.set(B.TEXTURE0+2);let te=O.colorRampTexture;te||(te=O.colorRampTexture=new d.T(k,O.colorRamp,B.RGBA)),te.bind(B.LINEAR,B.CLAMP_TO_EDGE)}k.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(te,se,he){const ce=te.context,ue=ce.gl,ye=se.tileFramebuffer;ce.activeTexture.set(ue.TEXTURE0);const pe={u_texture:0,u_opacity:1.05*(xe=se.paint.get("raster-particle-fade-opacity-factor"))/(xe+.05)},Se=te.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var xe;for(const ae of he){const[,,Fe,ke]=ae;ye.colorAttachment.set(Fe.targetColorTexture.texture),ce.viewport.set([0,0,ye.width,ye.height]),ce.clear({color:d.C.transparent}),ke&&(Fe.backgroundColorTexture.bind(ue.NEAREST,ue.CLAMP_TO_EDGE),Se.draw(te,ue.TRIANGLES,d.af.disabled,d.ah.disabled,d.a.alphaBlended,d.ag.disabled,pe,se.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments))}}(E,O,X),function(te,se,he,ce){const ue=te.context,ye=ue.gl,pe=he.tileFramebuffer,Se="globe"===te.transform.projection.name,xe=he.paint.get("raster-particle-max-speed");for(const ae of ce){const[Fe,ke,Ee]=ae;ue.activeTexture.set(ye.TEXTURE0+0),ke.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),pe.colorAttachment.set(Ee.targetColorTexture.texture);const We=te.getOrCreateProgram("rasterParticleDraw",{defines:ke.defines,overrideFog:!1});ue.activeTexture.set(ye.TEXTURE0+1);const Ye=ke.scalarData?[]:[0,1,2,3].map(Te=>d.b$[Te](Fe));Ye.push(Fe);const Oe=Fe.canonical.x,ze=Fe.canonical.y;for(const Te of Ye){const Ke=se.getTile(Se?Te.wrapped():Te);if(!Ke)continue;const Xe=Ke.rasterParticleState;if(!Xe)continue;const bt=Te.canonical.x+(1<<Te.canonical.z)*(Te.wrap-Fe.wrap),pt=Te.canonical.y;Xe.particleTexture0.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const nt=ad(1,Xe.particleTexture0.size[0],[bt-Oe,pt-ze],0,ke.texture.size,2,xe,ke.textureOffset,ke.scale,ke.offset);We.draw(te,ye.POINTS,d.af.disabled,d.ah.disabled,d.a.alphaBlended,d.ag.disabled,nt,he.id,Xe.particleIndexBuffer,void 0,Xe.particleSegment)}}}(E,M,O,X),k.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(te,se,he,ce){const ue=te.context,ye=ue.gl,pe=se.paint.get("raster-particle-max-speed"),Se=ce*se.paint.get("raster-particle-speed-factor")*.15,xe=(Fe=.01+1*se.paint.get("raster-particle-reset-rate-factor"),Math.pow(Fe,6)),ae=se.particleFramebuffer;var Fe;ue.viewport.set([0,0,ae.width,ae.height]);for(const Fe of he){const[,ke,Ee]=Fe;ue.activeTexture.set(ye.TEXTURE0+0),ke.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),ue.activeTexture.set(ye.TEXTURE0+1);const We=Ee.particleTexture0;We.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const Ye=ru(1,We.size[0],0,ke.texture.size,pe,Se,xe,ke.textureOffset,ke.scale,ke.offset);ae.colorAttachment.set(Ee.particleTexture1.texture),ue.clear({color:d.C.transparent}),te.getOrCreateProgram("rasterParticleUpdate",{defines:ke.defines}).draw(te,ye.TRIANGLES,d.af.disabled,d.ah.disabled,d.a.unblended,d.ag.disabled,Ye,se.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments)}}(E,O,X,K)}(g,l,h,y),"translucent"===g.renderPass&&(function(E,M,O,R,k){const B=E.context,U=B.gl,j=M.getSource().tileSize,Z=5*(1-d.a0(d.aV,d.aV+1,E.transform.zoom))*j+O.paint.get("raster-particle-elevation"),Y=!E.options.moving,X="globe"===E.transform.projection.name;if(!R.length)return;const[W,K]=E.stencilConfigForOverlap(R),te=[];X&&te.push("PROJECTION_GLOBE_VIEW");const se=E.stencilModeFor3D();for(const he of K){const ce=he.toUnwrapped(),ue=M.getTile(he);if(!ue.rasterParticleState)continue;const ye=ue.rasterParticleState,pe=100;ue.registerFadeDuration(pe);const Se=M.findLoadedParent(he,0),xe=Hm(ue,Se,M,E.transform,pe);let ae,Fe;E.terrain&&E.terrain.prepareDrawTile(),B.activeTexture.set(U.TEXTURE0),ye.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),B.activeTexture.set(U.TEXTURE1),Se&&Se.rasterParticleState?(Se.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),ae=Math.pow(2,Se.tileID.overscaledZ-ue.tileID.overscaledZ),Fe=[ue.tileID.canonical.x*ae%1,ue.tileID.canonical.y*ae%1]):ye.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ke=X?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(ce,Y),Ee=E.transform,We=tg(Ee),Ye=d.be(he.canonical),Oe=d.bf(Ye.getCenter().lat);let ze,Te,Ke,Xe,bt;X?(ze=Float32Array.from(d.bh(d.bi(he.canonical))),Te=Float32Array.from(Ee.globeMatrix),Ke=Float32Array.from(d.bd(Ee)),Xe=[d.ak(Ee.center.lng),d.al(Ee.center.lat)],bt=Float32Array.from(d.bg(he.canonical,Ye,Oe,Ee.worldSize/Ee._pixelsPerMercatorPixel))):(ze=new Float32Array(16),Te=new Float32Array(9),Ke=new Float32Array(16),Xe=[0,0],bt=new Float32Array(9));const pt=Yo(ke,ze,Te,Ke,bt,Fe||[0,0],d.a2(E.transform.zoom),Xe,We,ae||1,xe,Z),nt=E.isTileAffectedByFog(he),Ct=E.getOrCreateProgram("rasterParticle",{defines:te,overrideFog:nt});if(E.uploadCommonUniforms(B,Ct,ce),X){const Gt=new d.af(U.LEQUAL,d.af.ReadOnly,E.depthRangeFor3D),rn=0,en=E.globeSharedBuffers;if(en){const[mn,on,xi]=en.getGridBuffers(Oe,0!==rn);Ct.draw(E,U.TRIANGLES,Gt,se,d.a.alphaBlended,E.renderElevatedRasterBackface?d.ag.frontCCW:d.ag.backCCW,pt,O.id,mn,on,xi)}}else{const Gt=E.depthModeForSublayer(0,d.af.ReadOnly),rn=W[he.overscaledZ],{tileBoundsBuffer:en,tileBoundsIndexBuffer:mn,tileBoundsSegments:on}=E.getTileBoundsBuffers(ue);Ct.draw(E,U.TRIANGLES,Gt,rn,d.a.alphaBlended,d.ag.disabled,pt,O.id,en,mn,on)}}E.resetStencilClippingMasks()}(g,l,h,y),g.style.map.triggerRepaint())},background:function(g,l,h,y){const b=h.paint.get("background-color"),w=h.paint.get("background-opacity"),E=h.paint.get("background-emissive-strength");if(0===w)return;const M=g.context,O=M.gl,R=g.transform,k=R.tileSize,B=h.paint.get("background-pattern");let U;if(void 0!==B&&(null===B||(U=g.imageManager.getPattern(B.toString(),h.scope,g.style.getLut(h.scope)),!U)))return;const j=!B&&1===b.a&&1===w&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==j)return;const Z=d.ah.disabled,Y=g.depthModeForSublayer(0,"opaque"===j?d.af.ReadWrite:d.af.ReadOnly),X=g.colorModeForDrapableLayerRenderPass(E),W=B?"backgroundPattern":"background";let K,te=y;te||(K=g.getBackgroundTiles(),te=Object.values(K).map(se=>se.tileID)),B&&(M.activeTexture.set(O.TEXTURE0),g.imageManager.bind(g.context,h.scope));for(const se of te){const he=g.isTileAffectedByFog(se),ce=g.getOrCreateProgram(W,{overrideFog:he}),ue=se.toUnwrapped(),ye=y?se.projMatrix:g.transform.calculateProjMatrix(ue);g.prepareDrawTile();const pe=l?l.getTile(se):K?K[se.key]:new d.bA(se,k,R.zoom,g),Se=B?Yi(ye,E,w,g,0,h.scope,U,{tileID:se,tileSize:k}):vy(ye,E,w,b.toRenderColor(h.lut));g.uploadCommonUniforms(M,ce,ue);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:ae,tileBoundsSegments:Fe}=g.getTileBoundsBuffers(pe);ce.draw(g,O.TRIANGLES,Y,Z,X,d.ag.disabled,Se,h.id,xe,ae,Fe)}},sky:function(g,l,h){const y=g._atmosphere?d.a2(g.transform.zoom):1,b=h.paint.get("sky-opacity")*y;if(0===b)return;const w=g.context,E=h.paint.get("sky-type"),M=new d.af(w.gl.LEQUAL,d.af.ReadOnly,[0,1]),O=g.frameCounter/1e3%1;"atmosphere"===E?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(R,k,B,U){const j=R.context,Z=j.gl;let Y=k.skyboxFbo;if(!Y){Y=k.skyboxFbo=j.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new It(j),k.skyboxTexture=j.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,k.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let te=0;te<6;++te)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(Y.framebuffer),j.viewport.set([0,0,32,32]);const X=k.getCenter(R,!0),W=R.getOrCreateProgram("skyboxCapture"),K=new Float64Array(16);d.ae.identity(K),d.ae.rotateY(K,K,.5*-Math.PI),jn(R,k,W,K,X,0),d.ae.identity(K),d.ae.rotateY(K,K,.5*Math.PI),jn(R,k,W,K,X,1),d.ae.identity(K),d.ae.rotateX(K,K,.5*-Math.PI),jn(R,k,W,K,X,2),d.ae.identity(K),d.ae.rotateX(K,K,.5*Math.PI),jn(R,k,W,K,X,3),d.ae.identity(K),jn(R,k,W,K,X,4),d.ae.identity(K),d.ae.rotateY(K,K,Math.PI),jn(R,k,W,K,X,5),j.viewport.set([0,0,R.width,R.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(R,k,B,U,j){const Z=R.context,Y=Z.gl,X=R.transform,W=R.getOrCreateProgram("skybox");Z.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,k.skyboxTexture);const K=((te,se,he,ce,ue)=>({u_matrix:te,u_sun_direction:se,u_cubemap:0,u_opacity:ce,u_temporal_offset:ue}))(X.skyboxMatrix,k.getCenter(R,!1),0,U,j);R.uploadCommonUniforms(Z,W),W.draw(R,Y.TRIANGLES,B,d.ah.disabled,R.colorModeForRenderPass(),d.ag.backCW,K,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(g,h,M,b,O):"gradient"===E&&"sky"===g.renderPass&&function(R,k,B,U,j){const Z=R.context,Y=Z.gl,X=R.transform,W=R.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new It(Z)),Z.activeTexture.set(Y.TEXTURE0);let K=k.colorRampTexture;K||(K=k.colorRampTexture=new d.T(Z,k.colorRamp,Y.RGBA)),K.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const te=(se=X.skyboxMatrix,he=k.getCenter(R,!1),ce=k.paint.get("sky-gradient-radius"),ue=U,ye=j,{u_matrix:se,u_color_ramp:0,u_center_direction:he,u_radius:d.ac(ce),u_opacity:ue,u_temporal_offset:ye});var se,he,ce,ue,ye;R.uploadCommonUniforms(Z,W),W.draw(R,Y.TRIANGLES,B,d.ah.disabled,R.colorModeForRenderPass(),d.ag.backCW,te,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(g,h,M,b,O)},debug:function(g,l,h,y,b,w){for(let E=0;E<h.length;E++)if(b){const R=new d.C(.8*y.r,.8*y.g,.8*y.b,1);Yt(g,l,h[E],y,-1,-1,w),Yt(g,l,h[E],y,-1,1,w),Yt(g,l,h[E],y,1,1,w),Yt(g,l,h[E],y,1,-1,w),Yt(g,l,h[E],R,0,0,w)}else Yt(g,l,h[E],y,0,0,w)},custom:function(g,l,h,y){const b=g.context,w=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&h.isDraped(l)){if("offscreen"===g.renderPass){const E=w.prerender;if(E){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const M=g.transform.pointMerc;E.call(w,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),d.a2(g.transform.zoom),[M.x,M.y],g.transform.pixelsPerMeterRatio)}else E.call(w,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const M=w.renderToTile;if(M){const O=y[0].canonical,R=new d._(O.x+y[0].wrap*(1<<O.z),O.y,O.z);b.setDepthMode(d.af.disabled),b.setStencilMode(d.ah.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),M.call(w,b.gl,R),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(d.ah.disabled);const E="3d"===w.renderingMode?new d.af(g.context.gl.LEQUAL,d.af.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,d.af.ReadOnly);if(b.setDepthMode(E),"globe"===g.transform.projection.name){const M=g.transform.pointMerc;w.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),d.a2(g.transform.zoom),[M.x,M.y],g.transform.pixelsPerMeterRatio)}else w.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else d.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,h,y){if("opaque"===g.renderPass)return;const b=h.paint.get("model-opacity");if(0===b)return;const w=h.paint.get("model-cast-shadows");if("shadow"===g.renderPass&&(!w||g.terrain&&b<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof d.Z))return;const E=g.shadowRenderer,M=h.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,M||(E.enabled=!1));const O=()=>{E&&(E.useNormalOffset=!0,M||(E.enabled=!0))},R=l.getSource();if("light-beam"===g.renderPass&&"batched-model"!==R.type)return;if("vector"===R.type||"geojson"===R.type)return function(W,K,te,se,he){const ce=W.transform;if("mercator"!==ce.projection.name)return void d.w(`Drawing 3D models for ${ce.projection.name} projection is not yet implemented`);const ue=ce.getFreeCameraOptions().position;if(!W.modelManager)return;const ye=W.modelManager;te.modelManager=ye;const pe=W.shadowRenderer;if(!te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Se=te._unevaluatedLayout._values["model-id"],xe={...te.layout.get("model-id").parameters},ae=W.style.order.indexOf(te.fqid);for(const Fe of se){const ke=K.getTile(Fe).getBucket(te);if(!ke||ke.projection.name!==ce.projection.name)continue;const Ee=ke.getModelUris();Ee&&!ke.modelsRequested&&(ye.addModelsFromBucket(Ee,he),ke.modelsRequested=!0);const We=_l(Fe,ce);xe.zoom=We;const Ye=Se.possiblyEvaluate(xe);if(hp(W,ke,Fe),vs.shadowUniformsInitialized=!1,vs.useSingleShadowCascade=!!pe&&0===pe.getMaxCascadeForTile(Fe.toUnwrapped()),"shadow"===W.renderPass&&pe){if(1===W.currentShadowCascade&&ke.isInsideFirstShadowMapFrustum)continue;const Te=ce.calculatePosMatrix(Fe.toUnwrapped(),ce.worldSize);if(vs.tileMatrix.set(Te),vs.shadowTileMatrix=Float32Array.from(pe.calculateShadowPassMatrixFromMatrix(Te)),vs.aabb.min.fill(0),vs.aabb.max[0]=vs.aabb.max[1]=d.a4,vs.aabb.max[2]=0,fo(ke,vs,W,te.scope))continue}const Oe=1<<Fe.canonical.z,ze=[((ue.x-Fe.wrap)*Oe-Fe.canonical.x)*d.a4,(ue.y*Oe-Fe.canonical.y)*d.a4,ue.z*Oe*d.a4];W.conflationActive&&Object.keys(ke.instancesPerModel).length>0&&W.style.isLayerClipped(te,K.getSource())&&ke.updateReplacement(Fe,W.replacementSource,ae,he)&&(ke.uploaded=!1,ke.upload(W.context));for(let Te in ke.instancesPerModel){const Ke=ke.instancesPerModel[Te];Ke.features.length>0&&(Te=Ye.evaluate(Ke.features[0].feature,{}));const Xe=ye.getModel(Te,he);if(Xe&&Xe.uploaded)for(const bt of Xe.nodes)_d(W,te,bt,Ke,ze,Fe,vs)}}}(g,l,h,y,"vector"===R.type?h.scope:""),void O();if(!R.loaded())return;if("batched-model"===R.type)return function(W,K,te,se){te.resetLayerRenderingStats(W);const he=W.context,ce=W.transform,ue=W.style.fog,ye=W.shadowRenderer;if("mercator"!==ce.projection.name)return void d.w(`Drawing 3D landmark models for ${ce.projection.name} projection is not yet implemented`);const pe=W.transform.getFreeCameraOptions().position,Se=d.$.scale([],[pe.x,pe.y,pe.z],W.transform.worldSize);d.$.negate(Se,Se);const xe=d.ae.identity([]),ae=d.ci(ce.center.lat,ce.zoom),Fe=d.ae.fromScaling([],[1,1,1/ae]);d.ae.translate(xe,xe,Se);const ke=te.paint.get("model-opacity"),Ee=new d.af(he.gl.LEQUAL,d.af.ReadWrite,W.depthRangeFor3D),We=new d.af(he.gl.LEQUAL,d.af.ReadOnly,W.depthRangeFor3D),Ye=new d.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Oe="shadow"===W.renderPass,ze=Oe&&ye?ye.getCurrentCascadeFrustum():ce.getFrustum(ce.scaleZoom(ce.worldSize)),Te=te.paint.get("model-front-cutoff"),Ke=Te[2]<1,Xe=Zo(W,te.paint.get("model-cutoff-fade-range")),bt=te.getLayerRenderingStats();(function(pt,nt,Ct,Gt){const rn=pt.terrain?pt.terrain.exaggeration():0,en=pt.transform.zoom;for(const mn of Gt){const on=nt.getTile(mn).getBucket(Ct);on&&(pt.conflationActive&&on.updateReplacement(mn,pt.replacementSource),on.evaluateScale(pt,Ct),pt.terrain&&rn>0&&on.elevationUpdate(pt.terrain,rn,mn,Ct.source),on.needsReEvaluation(pt,en,Ct)&&on.evaluate(Ct))}})(W,K,te,se),function(){let pt,nt,Ct;Ke?(pt=se.length-1,nt=-1,Ct=-1):(pt=0,nt=se.length,Ct=1);for(let Gt=pt;Gt!==nt;Gt+=Ct){const rn=se[Gt],en=K.getTile(rn).getBucket(te);if(!en||!en.uploaded)continue;let mn=!1;ye&&(mn=0===ye.getMaxCascadeForTile(rn.toUnwrapped()));const on=ce.calculatePosMatrix(rn.toUnwrapped(),ce.worldSize),xi=en.modelTraits,An=[];for(const vn of en.getNodesInfo()){if(vn.hiddenByReplacement||!vn.node.meshes)continue;const oi=vn.node;let xn=0;W.terrain&&oi.elevation&&(xn=oi.elevation*W.terrain.exaggeration());const Mn=vn.evaluatedScale;if(Mn[0]<=1&&Mn[1]<=1&&Mn[2]<=1&&0===(()=>{const _o=vn.aabb;return Ye.min=[..._o.min],Ye.max=[..._o.max],Ye.min[2]+=xn,Ye.max[2]+=xn,d.$.transformMat4(Ye.min,Ye.min,on),d.$.transformMat4(Ye.max,Ye.max,on),Ye})().intersects(ze))continue;const nn=[...on],Bn=oi.anchor?oi.anchor[0]:0,kn=oi.anchor?oi.anchor[1]:0;d.ae.translate(nn,nn,[Bn*(Mn[0]-1),kn*(Mn[1]-1),xn]),d.$.exactEquals(Mn,d.cl)||d.ae.scale(nn,nn,Mn);const cn=d.ae.multiply([],nn,oi.matrix),rr=d.ae.multiply([],ce.expandedFarZProjMatrix,cn),ar=d.ae.multiply([],ce.expandedFarZProjMatrix,nn),go=d.aB.transformMat4([],[Bn,kn,xn,1],rr)[2];oi.hidden=!1;let Wr=ke;Oe||(Ke&&(Wr*=vd(nn,ce,vn.aabb,Te)),Wr*=Rr(Xe,go)),0!==Wr?An.push({nodeInfo:vn,depth:go,opacity:Wr,wvpForNode:rr,wvpForTile:ar,nodeModelMatrix:cn,tileModelMatrix:nn}):oi.hidden=!0}Oe||An.sort((vn,oi)=>!Ke||1===vn.opacity&&1===oi.opacity?vn.depth<oi.depth?-1:1:1===vn.opacity?-1:1===oi.opacity?1:vn.depth>oi.depth?-1:1);for(const vn of An){const oi=vn.nodeInfo,xn=oi.node;let Mn=d.ae.multiply([],Fe,vn.tileModelMatrix);d.ae.multiply(Mn,xe,Mn);const nn=d.ae.invert([],Mn);d.ae.transpose(nn,nn),d.ae.scale(nn,nn,yd),Mn=d.ae.multiply(Mn,Mn,xn.matrix);const Bn="light-beam"===W.renderPass,kn=xi&d.cn.HasMapboxMeshFeatures,cn=kn?0:oi.evaluatedRMEA[0][2];for(let rr=0;rr<xn.meshes.length;++rr){const ar=xn.meshes[rr],go=rr===xn.lightMeshIndex;let Wr=vn.wvpForNode;if(go){if(!Bn&&!W.terrain&&W.shadowRenderer){W.currentLayer<W.firstLightBeamLayer&&(W.firstLightBeamLayer=W.currentLayer);continue}Wr=vn.wvpForTile}else if(Bn)continue;const _o={defines:[]},Ro=[];if(gl(_o.defines,Ro,ar,W,te.lut),kn||_o.defines.push("DIFFUSE_SHADED"),mn&&_o.defines.push("SHADOWS_SINGLE_CASCADE"),bt&&(Oe?bt.numRenderedVerticesInShadowPass+=ar.vertexArray.length:bt.numRenderedVerticesInTransparentPass+=ar.vertexArray.length),Oe){Ty(ar,vn.nodeModelMatrix,W,te);continue}let no=null;if(ue){const Le=gd(vn.nodeModelMatrix,W.transform);if(no=new Float32Array(Le),"globe"!==ce.projection.name){const hc=ar.aabb.min,Ya=ar.aabb.max,[fc,Xa]=ue.getOpacityForBounds(Le,hc[0],hc[1],Ya[0],Ya[1]);_o.overrideFog=fc>=Qn||Xa>=Qn}}const yo=ar.material;let ct;yo.occlusionTexture&&yo.occlusionTexture.offsetScale&&(ct=yo.occlusionTexture.offsetScale,_o.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Oe&&ye&&(ye.useNormalOffset=!!ar.normalBuffer);const Nt=W.getOrCreateProgram("model",_o);!Oe&&ye&&ye.setupShadowsFromMatrix(vn.tileModelMatrix,Nt,ye.useNormalOffset),W.uploadCommonUniforms(he,Nt,null,no);const Qo=yo.pbrMetallicRoughness;Qo.metallicFactor=.9,Qo.roughnessFactor=.5;const Ei=ld(new Float32Array(Wr),new Float32Array(Mn),new Float32Array(nn),new Float32Array(xn.matrix),W,vn.opacity,Qo.baseColorFactor.toRenderColor(null),yo.emissiveFactor,Qo.metallicFactor,Qo.roughnessFactor,yo,cn,te,[0,0,0],ct);!go&&(oi.hasTranslucentParts||vn.opacity<1)&&Nt.draw(W,he.gl.TRIANGLES,Ee,d.ah.disabled,d.a.disabled,d.ag.backCCW,Ei,te.id,ar.vertexBuffer,ar.indexBuffer,ar.segments,te.paint,W.transform.zoom,void 0,Ro),Nt.draw(W,he.gl.TRIANGLES,go?We:Ee,d.ah.disabled,go||vn.opacity<1||oi.hasTranslucentParts?d.a.alphaBlended:d.a.unblended,d.ag.backCCW,Ei,te.id,ar.vertexBuffer,ar.indexBuffer,ar.segments,te.paint,W.transform.zoom,void 0,Ro)}}}}()}(g,l,h,y),void O();if("model"!==R.type)return;const k=R.getModels(),B=[],U=g.transform.getFreeCameraOptions().position,j=d.$.scale([],[U.x,U.y,U.z],g.transform.worldSize);d.$.negate(j,j);const Z=[],Y=[];let X=0;for(const W of k){const K=h.paint.get("model-rotation").constantOr(null),te=h.paint.get("model-scale").constantOr(null),se=h.paint.get("model-translation").constantOr(null);W.computeModelMatrix(g,K,te,se,!0,!0,!1);const he=d.ae.identity([]),ce=d.ci(W.position.lat,g.transform.zoom),ue=d.ae.fromScaling([],[1,1,1/ce]);d.ae.translate(he,he,j),B.push({zScaleMatrix:ue,negCameraPosMatrix:he});for(const ye of W.nodes)pr(g.transform,ye,W.matrix,g.transform.expandedFarZProjMatrix,X,Z,Y);X++}if(Z.sort((W,K)=>K.depth-W.depth),"shadow"!==g.renderPass){if(1===b)for(const W of Y)Ao(W,g,h,B[W.modelIndex],d.ah.disabled,g.colorModeForRenderPass());else{for(const W of Y)Ao(W,g,h,B[W.modelIndex],d.ah.disabled,d.a.disabled);for(const W of Y)Ao(W,g,h,B[W.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const W of Z)Ao(W,g,h,B[W.modelIndex],d.ah.disabled,g.colorModeForRenderPass());O()}else{for(const W of Y)Ty(W.mesh,W.nodeModelMatrix,g,h);for(const W of Z)Ty(W.mesh,W.nodeModelMatrix,g,h);O()}}},Nr={model:function(g,l,h){const y=l.getSource();if(!y.loaded())return;if("vector"===y.type||"geojson"===y.type)return void(h.modelManager&&h.modelManager.upload(h,"vector"===y.type?g.scope:""));if("batched-model"===y.type||"model"!==y.type)return;const b=y.getModels();for(const w of b)w.upload(h.context)},raster:function(g,l,h){const y=l.getSource();if(!(y instanceof ec&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const w=g.paint.get("raster-array-band")||y.getInitialBand(b);if(null==w)return;const E=l.getIds().map(M=>l.getTileByID(M));for(const M of E)M.updateNeeded(b,w)&&y.prepareTile(M,b,w)},"raster-particle":function(g,l,h){const y=l.getSource();if(!(y instanceof ec&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const w=g.paint.get("raster-particle-array-band")||y.getInitialBand(b);if(null==w)return;const E=l.getIds().map(M=>l.getTileByID(M));for(const M of E)M.updateNeeded(b,w)&&y.prepareTile(M,b,w)}};class rg{constructor(l,h,y,b){this.context=new Wl(l,h),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=d.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const M of w)this._debugParams.enabledLayers[M]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const M of w)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new ri(b),this.setup(),this.numSublayers=d.bx.maxUnderzooming+d.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new d.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Gm(this),this._wireframeDebugCache=new hn,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const E=new d.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new d.T(this.context,E,l.RGBA)}updateTerrain(l,h){const y=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Mo(this,l));const b=this._terrain;this.transform.elevation=y?b:null,b.update(l,this.transform,h),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(l){const h=l.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=h.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const w=y+.78*(b-y);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new Mo(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,h){if(this.width=l*d.e.devicePixelRatio,this.height=h*d.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const l=this.context,h=new d.bv;h.emplaceBack(0,0),h.emplaceBack(d.a4,0),h.emplaceBack(0,d.a4),h.emplaceBack(d.a4,d.a4),this.tileExtentBuffer=l.createVertexBuffer(h,d.bt.members),this.tileExtentSegments=d.b.simpleSegment(0,0,4,2);const y=new d.bv;y.emplaceBack(0,0),y.emplaceBack(d.a4,0),y.emplaceBack(0,d.a4),y.emplaceBack(d.a4,d.a4),this.debugBuffer=l.createVertexBuffer(y,d.bt.members),this.debugSegments=d.b.simpleSegment(0,0,4,5);const b=new d.bv;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,d.bt.members),this.viewportSegments=d.b.simpleSegment(0,0,4,2);const w=new d.cq;w.emplaceBack(0,0,0,0),w.emplaceBack(d.a4,0,d.a4,0),w.emplaceBack(0,d.a4,0,d.a4),w.emplaceBack(d.a4,d.a4,d.a4,d.a4),this.mercatorBoundsBuffer=l.createVertexBuffer(w,d.cr.members),this.mercatorBoundsSegments=d.b.simpleSegment(0,0,4,2);const E=new d.bw;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(E);const M=new d.cs;for(const R of[0,1,3,2,0])M.emplaceBack(R);this.debugIndexBuffer=l.createIndexBuffer(M),this.emptyTexture=new d.T(l,new d.j({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=d.ae.create();const O=this.context.gl;this.stencilClearMode=new d.ah({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,d.af.disabled,this.stencilClearMode,d.a.disabled,d.ag.disabled,Rh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,h,y){if(!h||this.currentStencilSource===h.id||!l.isTileClipped()||!y||0===y.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const O of y)if(void 0===this._tileClippingMaskIDs[O.key]){M=!0;break}if(!M)return}this.currentStencilSource=h.id;const b=this.context,w=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(d.a.disabled),b.setDepthMode(d.af.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of y){const O=h.getTile(M),R=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:B,tileBoundsSegments:U}=this.getTileBoundsBuffers(O);E.draw(this,w.TRIANGLES,d.af.disabled,new d.ah({func:w.ALWAYS,mask:0},R,255,w.KEEP,w.KEEP,w.REPLACE),d.a.disabled,d.ag.disabled,Rh(M.projMatrix),"$clipping",k,B,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new d.ah({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const h=this.context.gl;return new d.ah({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(l){const h=this.context.gl,y=l.sort((E,M)=>M.overscaledZ-E.overscaledZ),b=y[y.length-1].overscaledZ,w=y[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const E={};for(let M=0;M<w;M++)E[M+b]=new d.ah({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[E,y]}return[{[b]:d.ah.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new d.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new d.C(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.a.unblended:d.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&"translucent"===this.renderPass?new d.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new d.C(0,0,0,void 0===l?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,h,y,b=!1){if(this.depthOcclusion)return new d.af(this.context.gl.GREATER,d.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return d.af.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new d.af(y||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,h=Math.ceil(this.width),y=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),w=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==h&&0!==y&&(this.depthFBO=new ms(this.context,h,y,!1,"texture"),this.depthTexture=new d.T(this.context,{width:h,height:y,data:null},l.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),l.bindTexture(l.TEXTURE_2D,w),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,h,y,0,0,h,y,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,h)=>l+h/this._fpsHistory.length,0))}render(l,h){const y=d.e.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=h;const b=this.style._mergedLayers,w=this.style.order.filter(xe=>{const ae=b[xe];return!(ae.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ae.type]});let E=!1,M=!1;for(const xe of w){const ae=b[xe];"circle"===ae.type&&(E=!0),"symbol"===ae.type&&(ae.hasInitialOcclusionOpacityProperties?M=!0:E=!0)}const O=w.map(xe=>b[xe]),R=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(d.e.now()),this.imageManager.beginFrame();let k=0,B=!1;for(const xe in R){const ae=R[xe];ae.used&&(ae.prepare(this.context),ae.getSource().usedInConflation&&++k)}let U=!1;for(const xe of O)xe.isHidden(this.transform.zoom)||("clip"===xe.type&&(U=!0),this.prepareLayer(xe));const j={},Z={},Y={},X={},W={};for(const xe in R){const ae=R[xe];j[xe]=ae.getVisibleCoordinates(),Z[xe]=j[xe].slice().reverse(),Y[xe]=ae.getVisibleCoordinates(!0).reverse(),X[xe]=ae.getShadowCasterCoordinates(),W[xe]=ae.sortCoordinatesByDistance(j[xe])}const K=xe=>{const ae=this.style.getLayerSourceCache(xe);return ae&&ae.used?ae.getSource():null};if(k||U){const xe=[],ae=[];let Fe=0;for(const ke of O)this.isSourceForClippingOrConflation(ke,K(ke))&&(xe.push(ke),ae.push(Fe)),Fe++;if(xe&&(U||xe.length>1)){const ke=[];for(let Ee=0;Ee<xe.length;Ee++){const We=xe[Ee],Ye=ae[Ee],Oe=this.style.getLayerSourceCache(We);if(!Oe||!Oe.used||!Oe.getSource().usedInConflation&&"clip"!==We.type)continue;let ze=d.cv,Te=d.cw.None;const Ke=[];if("clip"===We.type){ze=Ye;for(const Xe of We.layout.get("clip-layer-types"))Te|="model"===Xe?d.cw.Model:"symbol"===Xe?d.cw.Symbol:d.cw.FillExtrusion;for(const Xe of We.layout.get("clip-layer-scope"))Ke.push(Xe)}ke.push({layer:We.fqid,cache:Oe,order:ze,clipMask:Te,clipScope:Ke})}this.replacementSource.setSources(ke),B=!0}}B||this.replacementSource.clear(),this.conflationActive=B,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let xe=0;xe<O.length;xe++){const ae=O[xe],Fe=ae.cutoffRange();if(this.longestCutoffRange=Math.max(Fe,this.longestCutoffRange),Fe>0){const ke=K(ae);ke&&(this.minCutoffZoom=Math.max(ke.minzoom,this.minCutoffZoom)),ae.minzoom&&(this.minCutoffZoom=Math.max(ae.minzoom,this.minCutoffZoom))}ae.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=xe),this._lastOcclusionLayer=xe)}const te=this.style&&this.style.fog;te?(this._fogVisible=0!==te.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Y),this.opaquePassCutoff=0);const se=this._shadowRenderer;if(se){se.updateShadowParameters(this.transform,this.style.directionalLight);for(const xe in R)for(const ae of j[xe]){let Fe={min:0,max:0};this.terrain&&(Fe=this.terrain.getMinMaxForTile(ae)||Fe),se.addShadowReceiver(ae.toUnwrapped(),Fe.min,Fe.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new md(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!d.cu(this.context.gl))return;this.renderPass="offscreen";for(const xe of O){const ae=l.getLayerSourceCache(xe);if(!xe.hasOffscreenPass()||xe.isHidden(this.transform.zoom))continue;const Fe=ae?Z[ae.id]:void 0;("custom"===xe.type||"raster"===xe.type||"raster-particle"===xe.type||xe.isSky()||Fe&&Fe.length)&&this.renderLayer(this,ae,xe,Fe)}this.depthRangeFor3D=[0,1-(O.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,X)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const he="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),ce=(()=>{if(h.showOverdrawInspector)return d.C.black;const xe=this.style.fog;if(xe&&this.transform.projection.supportsFog){const ae=this.style.getLut(xe.scope);if(!he){const Fe=xe.properties.get("color").toRenderColor(ae).toArray01();return new d.C(...Fe)}if(he){const Fe=xe.properties.get("space-color").toRenderColor(ae).toArray01();return new d.C(...Fe)}}return d.C.transparent})();if(this.context.clear({color:ce,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&he&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const xe=O[this.currentLayer],ae=l.getLayerSourceCache(xe);if(xe.isSky())continue;const Fe=ae?(xe.is3D()?W:Z)[ae.id]:void 0;this._renderTileClippingMasks(xe,ae,Fe),this.renderLayer(this,ae,xe,Fe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&he&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||d.a2(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const xe=O[this.currentLayer],ae=l.getLayerSourceCache(xe);xe.isSky()&&this.renderLayer(this,ae,xe,ae?Z[ae.id]:void 0)}function ue(xe,ae){let Fe;return ae&&(Fe=("symbol"===xe.type?Y:xe.is3D()?W:Z)[ae.id]),Fe}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const xe=O[this.currentLayer];if("raster"===xe.type||"raster-particle"===xe.type){const ae=l.getLayerSourceCache(xe);this.renderLayer(this,ae,xe,ue(xe,ae))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ye=0;se&&(ye=se.getShadowCastingLayerCount());let pe=!1,Se=-1;for(let xe=0;xe<w.length;++xe){const ae=O[xe];ae.isHidden(this.transform.zoom)||ae.is3D()&&(Se=xe)}for(M&&-1===Se&&(E=!0);this.currentLayer<w.length;){const xe=O[this.currentLayer],ae=l.getLayerSourceCache(xe);if(xe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(xe)){if(xe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(E&&!pe&&this.terrain&&!this.transform.isOrthographic&&(pe=!0,this.blitDepth()),M&&-1!==Se&&this.currentLayer===Se+1&&!this.transform.isOrthographic&&this.blitDepth(),xe.is3D()||this.terrain||this._renderTileClippingMasks(xe,ae,ae?j[ae.id]:void 0),this.renderLayer(this,ae,xe,ue(xe,ae)),!this.terrain&&se&&ye>0&&xe.hasShadowPass()&&0==--ye&&(se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Fe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Fe;this.currentLayer++){const ke=O[this.currentLayer];if(!ke.hasLightBeamPass())continue;const Ee=l.getLayerSourceCache(ke);this.renderLayer(this,Ee,ke,Ee?Z[Ee.id]:void 0)}this.currentLayer=Fe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Fe=this.currentLayer;this.depthOcclusion=!0;for(const ke of this.layersWithOcclusionOpacity){this.currentLayer=ke;const Ee=O[this.currentLayer],We=l.getLayerSourceCache(Ee),Ye=We?Z[We.id]:void 0;Ee.is3D()||this.terrain||this._renderTileClippingMasks(Ee,We,We?j[We.id]:void 0),this.renderLayer(this,We,Ee,Ye)}this.depthOcclusion=!1,this.currentLayer=Fe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let xe=null;O.forEach(ae=>{const Fe=l.getLayerSourceCache(ae);Fe&&!ae.isHidden(this.transform.zoom)&&Fe.getVisibleCoordinates().length&&(!xe||xe.getSource().maxzoom<Fe.getSource().maxzoom)&&(xe=Fe)}),xe&&this.options.showTileBoundaries&&qa.debug(this,xe,xe.getVisibleCoordinates(),d.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&qa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new d.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(xe){const ae=xe.transform.padding;ig(xe,xe.transform.height-(ae.top||0),3,Cy),ig(xe,ae.bottom||0,3,ng),hd(xe,ae.left||0,3,Mt),hd(xe,xe.transform.width-(ae.right||0),3,ni);const Fe=xe.transform.centerPoint;var ke,Ee,We,Ye;fd(ke=xe,(Ee=Fe.x)-1,(We=xe.transform.height-Fe.y)-10,2,20,Ye=Pi),fd(ke,Ee-10,We-1,20,2,Ye)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),B||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:h}=this.transform.projection,y=!h||!h.includes(l.type);if(Nr[l.type]&&(y||this.terrain&&"custom"===l.type)){const b=this.style.getLayerSourceCache(l);Nr[l.type](l,b,this)}this.gpuTimingEnd()}renderLayer(l,h,y,b){y.isHidden(this.transform.zoom)||("background"===y.type||"sky"===y.type||"custom"===y.type||"model"===y.type||"raster"===y.type||"raster-particle"===y.type||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(y.type)&&(!l.terrain||"custom"!==y.type)||"clip"===y.type||qa[y.type](l,h,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,y=this.context.gl;let b=this.gpuTimers[l.id];b||(b=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:y.createQuery()}),b.calls++,y.beginQuery(h.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,h=this.context.gl,y=h.createQuery();this.deferredRenderGpuTimeQueries.push(y),h.beginQuery(l.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const h={};for(const y in l){const b=l[y],w=this.context.extTimerQuery,E=w.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(b.query),h[y]=E}return h}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery,y=this.context.gl;let b=0;for(const w of l)b+=h.getQueryParameter(w,y.QUERY_RESULT)/1e6,h.deleteQueryEXT(w);return b}translatePosMatrix(l,h,y,b,w){if(!y[0]&&!y[1])return l;const E=w?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(E){const R=Math.sin(E),k=Math.cos(E);y=[y[0]*k-y[1]*R,y[0]*R+y[1]*k]}const M=[w?y[0]:d.bD(h,y[0],this.transform.zoom),w?y[1]:d.bD(h,y[1],this.transform.zoom),0],O=new Float32Array(16);return d.ae.translate(O,l,M),O}saveTileTexture(l){const h=l.size[0],y=this._tileTextures[h];y?y.push(l):this._tileTextures[h]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(l,h,y){const b=void 0===y?this.terrain&&this.terrain.renderingToTexture:y,w=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===l||"terrainRaster"===l?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||w.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&w.push("GLOBE"),!this._fogVisible||b||void 0!==h&&!h||w.push("FOG","FOG_DITHERING"),b&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(l,h){this.cache=this.cache||{};const y=h&&h.defines||[],b=h&&h.config,w=this.currentGlobalDefines(l,h&&h.overrideFog,h&&h.overrideRtt).concat(y),E=Wm.cacheKey(_1[l],l,w,b);return this.cache[E]||(this.cache[E]=new Wm(this.context,l,_1[l],b,by[l],w)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,h){if(this.style.enable3dLights()){const y=this.style.directionalLight,b=this.style.ambientLight;if(y&&b){const w=((E,M,O)=>{const R=E.properties.get("direction"),k=E.properties.get("color").toRenderColor(O.getLut(E.scope)).toArray01(),B=E.properties.get("intensity"),U=M.properties.get("color").toRenderColor(O.getLut(M.scope)).toArray01(),j=M.properties.get("intensity"),Z=[R.x,R.y,R.z],Y=d.bC(U,j),X=d.bC(k,B);return{u_lighting_ambient_color:Y,u_lighting_directional_dir:Z,u_lighting_directional_color:X,u_ground_radiance:qm(Z,X,Y)}})(y,b,this.style);h.setLightsUniformValues(l,w)}}}uploadCommonUniforms(l,h,y,b,w){if(this.uploadCommonLightUniforms(l,h),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const M=E.getOpacity(this.transform.pitch),O=((R,k,B,U,j,Z,Y,X,W,K,te,se)=>{const he=R.transform,ce=k.properties.get("color").toRenderColor(R.style.getLut(k.scope)).toArray01();ce[3]=U;const ue=R.frameCounter/1e3%1,[ye,pe]=k.properties.get("vertical-range");return{u_fog_matrix:B?he.calculateFogTileMatrix(B):se||R.identityMat,u_fog_range:k.getFovAdjustedRange(he._fov),u_fog_color:ce,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ye,pe),pe],u_fog_temporal_offset:ue,u_frustum_tl:j,u_frustum_tr:Z,u_frustum_br:Y,u_frustum_bl:X,u_globe_pos:W,u_globe_radius:K,u_viewport:te,u_globe_transition:d.a2(he.zoom),u_is_globe:+("globe"===he.projection.name)}})(this,E,y,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.e.devicePixelRatio,this.transform.height*d.e.devicePixelRatio],b);h.setFogUniformValues(l,O)}w&&h.setCutoffUniformValues(l,w.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,h=l.createTexture();return l.bindTexture(l.TEXTURE_2D,h),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,h=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)h[b.key]=l[b.key]||new d.bA(b,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,h){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||"building"!==l.sourceLayer)&&"clip"!==l.type&&(!h||"batched-model"!==h.type))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let h=this._cachedTileFogOpacities[l.key];return h||(this._cachedTileFogOpacities[l.key]=h=this.style.fog.getOpacityForTile(l)),h[0]>=Qn||h[1]>=Qn}setupDepthForOcclusion(l,h,y){const b=this.context,w=b.gl,E=!!y;var M;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(w.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),b.activeTexture.set(w.TEXTURE0),E||h.setTerrainUniformValues(b,y)}}class sa{constructor(l,h,y,b){this.screenBounds=l,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(l,h){let y,b;if(l instanceof d.P||"number"==typeof l[0]){const w=d.P.convert(l);y=[w],b=h.isPointAboveHorizon(w)}else{const w=d.P.convert(l[0]),E=d.P.convert(l[1]);y=[w,E],b=d.cx(w,E).every(M=>h.isPointAboveHorizon(M))}return new sa(y,h.getCameraPoint(),b,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return d.cx(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const h=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new d.P(1,1)):this.screenBounds[1],b=d.cx(h,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(b[3]=this.cameraPoint)),d.cy(b,l)}bufferedCameraGeometryGlobe(l){const h=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new d.P(1,1)):this.screenBounds[1],b=d.cx(h,y,l),w=this.cameraPoint.clone();switch(3*((w.y>h.y)+(w.y>y.y))+((w.x>h.x)+(w.x>y.x))){case 0:b[0]=w,b[4]=w.clone();break;case 1:b.splice(1,0,w);break;case 2:b[1]=w;break;case 3:b.splice(4,0,w);break;case 5:b.splice(2,0,w);break;case 6:b[3]=w;break;case 7:b.splice(3,0,w);break;case 8:b[2]=w}return b}containsTile(l,h,y,b=0){const w=l.queryPadding/h._pixelsPerMercatorPixel+1,E=y?this._bufferedCameraMercator(w,h):this._bufferedScreenMercator(w,h);let M=l.tileID.wrap+(E.unwrapped?b:0);const O=E.polygon.map(X=>d.cz(l.tileTransform,X,M));if(!d.cA(O,0,0,d.a4,d.a4))return;M=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const R=this.screenGeometryMercator.polygon.map(X=>d.cB(l.tileTransform,X,M)),k=R.map(X=>new d.P(X[0],X[1])),B=h.getFreeCameraOptions().position||new d._(0,0,0),U=d.cB(l.tileTransform,B,M),j=R.map(X=>{const W=d.$.sub(X,X,U);return d.$.normalize(W,W),new d.aU(U,W)}),Z=d.bD(l,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:j,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(Y=d.cC(O),Y.min.x=d.au(Y.min.x,0,d.a4),Y.min.y=d.au(Y.min.y,0,d.a4),Y.max.x=d.au(Y.max.x,0,d.a4),Y.max.y=d.au(Y.max.y,0,d.a4),Y),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:Z};var Y}_bufferedScreenMercator(l,h){const y=Yn(l);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(l),h):{polygon:this.bufferedScreenGeometry(l).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(l,h){const y=Yn(l);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),h):{polygon:this.bufferedCameraGeometry(l).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(l,h){const y=function(w,E){const M=d.ae.multiply([],E.pixelMatrix,E.globeMatrix),O=[0,-d.cF,0,1],R=[0,d.cF,0,1],k=[0,0,0,1];d.aB.transformMat4(O,O,M),d.aB.transformMat4(R,R,M),d.aB.transformMat4(k,k,M);const B=new d.P(O[0]/O[3],O[1]/O[3]),U=new d.P(R[0]/R[3],R[1]/R[3]),j=d.cD(w,B)&&O[3]<k[3],Z=d.cD(w,U)&&R[3]<k[3];if(!j&&!Z)return null;const Y=function(ue,ye,pe){for(let Se=1;Se<ue.length;Se++){const xe=Ta(ye.pointCoordinate3D(ue[Se-1]).x),ae=Ta(ye.pointCoordinate3D(ue[Se]).x);if(pe<0){if(xe<ae)return{idx:Se,t:-xe/(ae-1-xe)}}else if(ae<xe)return{idx:Se,t:(1-xe)/(ae+1-xe)}}return null}(w,E,j?-1:1);if(!Y)return null;const{idx:X,t:W}=Y;let K=X>1?lu(w.slice(0,X),E):[],te=X<w.length?lu(w.slice(X),E):[];K=K.map(ue=>new d.P(Ta(ue.x),ue.y)),te=te.map(ue=>new d.P(Ta(ue.x),ue.y));const se=[...K];0===se.length&&se.push(te[te.length-1]);const he=d.a3(se[se.length-1].y,(0===te.length?K[0]:te[0]).y,W);let ce;return ce=j?[new d.P(0,he),new d.P(0,0),new d.P(1,0),new d.P(1,he)]:[new d.P(1,he),new d.P(1,1),new d.P(0,1),new d.P(0,he)],se.push(...ce),0===te.length?se.push(K[0]):se.push(...te),{polygon:se.map(ue=>new d._(ue.x,ue.y)),unwrapped:!1}}(l,h);if(y)return y;const b=function(w,E){let M=!1,O=-1/0,R=0;for(let B=0;B<w.length-1;B++)w[B].x>O&&(O=w[B].x,R=B);for(let B=0;B<w.length-1;B++){const U=(R+B)%(w.length-1),j=w[U],Z=w[U+1];Math.abs(j.x-Z.x)>.5&&(j.x<Z.x?(j.x+=1,0===U&&(w[w.length-1].x+=1)):(Z.x+=1,U+1===w.length-1&&(w[0].x+=1)),M=!0)}const k=d.ak(E.center.lng);return M&&k<Math.abs(k-1)&&w.forEach(B=>{B.x-=1}),{polygon:w,unwrapped:M}}(lu(l,h).map(w=>new d.P(Ta(w.x),w.y)),h);return{polygon:b.polygon.map(w=>new d._(w.x,w.y)),unwrapped:b.unwrapped}}}function lu(g,l){return d.cE(g,h=>{const y=l.pointCoordinate3D(h);h.x=y.x,h.y=y.y},1/256)}function Ta(g){return g<0?1+g%1:g%1}function Yn(g){return 100*g|0}function og(g,l){const h=d.ae.identity([]);return d.ae.scale(h,h,[.5*g.width,.5*-g.height,1]),d.ae.translate(h,h,[1,-1,0]),d.ae.multiply(h,h,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(h)}function Wa(g,l,h,y,b,w,E,M=!1){const O=g.tilesIn(y,E,M);O.sort(fp);const R=[];for(const B of O)R.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(l,h,g._state,B,b,w,og(g.transform,B.tile.tileID),M)});const k=function(B){const U={},j={};for(const Z of B){const Y=Z.queryResults,X=Z.wrappedTileID,W=j[X]=j[X]||{};for(const K in Y){const te=Y[K],se=W[K]=W[K]||{},he=U[K]=U[K]||[];for(const ce of te)se[ce.featureIndex]||(se[ce.featureIndex]=!0,he.push(ce))}}return U}(R);for(const B in k)k[B].forEach(U=>{const j=U.feature,Z=j.layer;Z&&"background"!==Z.type&&"sky"!==Z.type&&"slot"!==Z.type&&(j.source=Z.source,Z["source-layer"]&&(j.sourceLayer=Z["source-layer"]),j.state=void 0!==j.id?g.getFeatureState(Z["source-layer"],j.id):{})});return k}function bs(g,l){const h=g.getRenderableIds().map(w=>g.getTileByID(w)),y=[],b={};for(let w=0;w<h.length;w++){const E=h[w],M=E.tileID.canonical.key;b[M]||(b[M]=!0,E.querySourceFeatures(y,l))}return y}function fp(g,l){const h=g.tileID,y=l.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}class Fs{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,h=!1;for(const y in this.style._mergedLayers){const b=this.style._mergedLayers[y];if("fill-extrusion"===b.type)this.layers.push({layer:b,visible:l,visibilityChanged:h});else if("model"===b.type){const w=this.style.getLayerSource(b);w&&"batched-model"===w.type&&this.layers.push({layer:b,visible:l,visibilityChanged:h})}}}onNewFrame(l){this.layersGotHidden=!1;for(const h of this.layers){const y=h.layer;let b=!1;"fill-extrusion"===y.type?b=!y.isHidden(l)&&y.paint.get("fill-extrusion-opacity")>0:"model"===y.type&&(b=!y.isHidden(l)&&y.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&h.visible,h.visible=b}}updateZOffset(l,h){this.currentBuildingBuckets=[];for(const b of this.layers){const w=b.layer,E=this.style.getLayerSourceCache(w);let M=1;"fill-extrusion"===w.type&&(M=b.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let O=E?E.getTile(h):null;if(!O&&E&&h.canonical.z>E.getSource().minzoom){let R=h.scaledTo(Math.min(E.getSource().maxzoom,h.overscaledZ-1));for(;R.overscaledZ>=E.getSource().minzoom&&(O=E.getTile(R),!O&&0!==R.overscaledZ);)R=R.scaledTo(R.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(w):null,tileID:O?O.tileID:h,verticalScale:M})}l.hasAnyZOffset=!1;let y=!1;for(let b=0;b<l.symbolInstances.length;b++){const w=l.symbolInstances.get(b),E=w.zOffset,M=this._getHeightAtTileOffset(h,w.tileAnchorX,w.tileAnchorY);w.zOffset=M!==Number.NEGATIVE_INFINITY?M:E,y||E===w.zOffset||(y=!0),l.hasAnyZOffset||0===w.zOffset||(l.hasAnyZOffset=!0)}y&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,h,y,b){let w=h,E=y;if(l.canonical.z!==b.canonical.z){const M=b.canonical,O=1/(1<<l.canonical.z-M.z);w=(h+l.canonical.x*d.a4)*O-M.x*d.a4|0,E=(y+l.canonical.y*d.a4)*O-M.y*d.a4|0}return{tileX:w,tileY:E}}_getHeightAtTileOffset(l,h,y){let b,w;for(let E=0;E<this.layers.length;++E){if("fill-extrusion"!==this.layers[E].layer.type)continue;const{bucket:M,tileID:O,verticalScale:R}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:k,tileY:B}=this._mapCoordToOverlappingTile(l,h,y,O),U=M.getHeightAtTileCoord(k,B);U&&void 0!==U.height&&(U.hidden?b=U.height:w=Math.max(U.height*R,w||0))}if(void 0!==w)return w;for(let E=0;E<this.layers.length;++E){const M=this.layers[E];if("model"!==M.layer.type||!M.visible)continue;const{bucket:O,tileID:R}=this.currentBuildingBuckets[E];if(!O)continue;const{tileX:k,tileY:B}=this._mapCoordToOverlappingTile(l,h,y,R),U=O.getHeightAtTileCoord(k,B);if(U&&!U.hidden)return void 0===U.height&&void 0!==b?Math.min(U.maxHeight,b)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function fC(g,l){const h={};for(const y in g)"ref"!==y&&(h[y]=g[y]);return d.cG.forEach(y=>{y in l&&(h[y]=l[y])}),h}function yl(g){g=g.slice();const l=Object.create(null);for(let h=0;h<g.length;h++)l[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=fC(g[h],l[g[h].ref]));return g}const Xn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function vl(g,l,h){h.push({command:Xn.addSource,args:[g,l[g]]})}function Ey(g,l,h){l.push({command:Xn.removeSource,args:[g]}),h[g]=!0}function E1(g,l,h,y){Ey(g,h,y),vl(g,l,h)}function Vh(g,l,h){let y;for(y in g[h])if(g[h].hasOwnProperty(y)&&"data"!==y&&!d.d(g[h][y],l[h][y]))return!1;for(y in l[h])if(l[h].hasOwnProperty(y)&&"data"!==y&&!d.d(g[h][y],l[h][y]))return!1;return!0}function bl(g,l,h,y,b,w){let E;for(E in l=l||{},g=g||{})g.hasOwnProperty(E)&&(d.d(g[E],l[E])||h.push({command:w,args:[y,E,l[E],b]}));for(E in l)l.hasOwnProperty(E)&&!g.hasOwnProperty(E)&&(d.d(g[E],l[E])||h.push({command:w,args:[y,E,l[E],b]}))}function xl(g){return g.id}function wl(g,l){return g[l.id]=l,g}class Cl{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=d.au(l,0,1);let h=1,y=this._distances[h];const b=l*this.paddedLength+this.padding;for(;y<b&&h<this._distances.length;)y=this._distances[++h];const w=h-1,E=this._distances[w],M=y-E,O=M>0?(b-E)/M:0;return this.points[w].mult(1-O).add(this.points[h].mult(O))}}class Uh{constructor(l,h,y){const b=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(h/y);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,y,b,w){this._forEachCell(h,y,b,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(w)}insertCircle(l,h,y,b){this._forEachCell(h-b,y-b,h+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(y),this.circles.push(b)}_insertBoxCell(l,h,y,b,w,E){this.boxCells[w].push(E)}_insertCircleCell(l,h,y,b,w,E){this.circleCells[w].push(E)}_query(l,h,y,b,w,E){if(y<0||l>this.width||b<0||h>this.height)return!w&&[];const M=[];if(l<=0&&h<=0&&this.width<=y&&this.height<=b){if(w)return!0;for(let O=0;O<this.boxKeys.length;O++)M.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const R=this.circles[3*O],k=this.circles[3*O+1],B=this.circles[3*O+2];M.push({key:this.circleKeys[O],x1:R-B,y1:k-B,x2:R+B,y2:k+B})}return E?M.filter(E):M}return this._forEachCell(l,h,y,b,this._queryCell,M,{hitTest:w,seenUids:{box:{},circle:{}}},E),w?M.length>0:M}_queryCircle(l,h,y,b,w){const E=l-y,M=l+y,O=h-y,R=h+y;if(M<0||E>this.width||R<0||O>this.height)return!b&&[];const k=[];return this._forEachCell(E,O,M,R,this._queryCellCircle,k,{hitTest:b,circle:{x:l,y:h,radius:y},seenUids:{box:{},circle:{}}},w),b?k.length>0:k}query(l,h,y,b,w){return this._query(l,h,y,b,!1,w)}hitTest(l,h,y,b,w){return this._query(l,h,y,b,!0,w)}hitTestCircle(l,h,y,b){return this._queryCircle(l,h,y,!0,b)}_queryCell(l,h,y,b,w,E,M,O){const R=M.seenUids,k=this.boxCells[w];if(null!==k){const U=this.bboxes;for(const j of k)if(!R.box[j]){R.box[j]=!0;const Z=4*j;if(l<=U[Z+2]&&h<=U[Z+3]&&y>=U[Z+0]&&b>=U[Z+1]&&(!O||O(this.boxKeys[j]))){if(M.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[j],x1:U[Z],y1:U[Z+1],x2:U[Z+2],y2:U[Z+3]})}}}const B=this.circleCells[w];if(null!==B){const U=this.circles;for(const j of B)if(!R.circle[j]){R.circle[j]=!0;const Z=3*j;if(this._circleAndRectCollide(U[Z],U[Z+1],U[Z+2],l,h,y,b)&&(!O||O(this.circleKeys[j]))){if(M.hitTest)return E.push(!0),!0;{const Y=U[Z],X=U[Z+1],W=U[Z+2];E.push({key:this.circleKeys[j],x1:Y-W,y1:X-W,x2:Y+W,y2:X+W})}}}}}_queryCellCircle(l,h,y,b,w,E,M,O){const R=M.circle,k=M.seenUids,B=this.boxCells[w];if(null!==B){const j=this.bboxes;for(const Z of B)if(!k.box[Z]){k.box[Z]=!0;const Y=4*Z;if(this._circleAndRectCollide(R.x,R.y,R.radius,j[Y+0],j[Y+1],j[Y+2],j[Y+3])&&(!O||O(this.boxKeys[Z])))return E.push(!0),!0}}const U=this.circleCells[w];if(null!==U){const j=this.circles;for(const Z of U)if(!k.circle[Z]){k.circle[Z]=!0;const Y=3*Z;if(this._circlesCollide(j[Y],j[Y+1],j[Y+2],R.x,R.y,R.radius)&&(!O||O(this.circleKeys[Z])))return E.push(!0),!0}}}_forEachCell(l,h,y,b,w,E,M,O){const R=this._convertToXCellCoord(l),k=this._convertToYCellCoord(h),B=this._convertToXCellCoord(y),U=this._convertToYCellCoord(b);for(let j=R;j<=B;j++)for(let Z=k;Z<=U;Z++)if(w.call(this,l,h,y,b,this.xCellCount*Z+j,E,M,O))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,y,b,w,E){const M=b-l,O=w-h,R=y+E;return R*R>M*M+O*O}_circleAndRectCollide(l,h,y,b,w,E,M){const O=(E-b)/2,R=Math.abs(l-(b+O));if(R>O+y)return!1;const k=(M-w)/2,B=Math.abs(h-(w+k));if(B>k+y)return!1;if(R<=O||B<=k)return!0;const U=R-O,j=B-k;return U*U+j*j<=y*y}}const $t=100;class Dy{constructor(l,h,y=new Uh(l.width+200,l.height+200,25),b=new Uh(l.width+200,l.height+200,25)){this.transform=l,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+$t,this.screenBottomBoundary=l.height+$t,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=h}placeCollisionBox(l,h,y,b,w,E,M,O){let R=y.projectedAnchorX,k=y.projectedAnchorY,B=y.projectedAnchorZ;const U=y.elevation,j=y.tileID,Z=l.getProjection();if(U&&j){const[ce,ue,ye]=Z.upVector(j.canonical,y.tileAnchorX,y.tileAnchorY),pe=Z.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=ce*U*pe,k+=ue*U*pe,B+=ye*U*pe}const Y=this.projectAndGetPerspectiveRatio(M,R,k,B,y.tileID,"globe"===Z.name||!!U||this.transform.pitch>0,Z),X=E*Y.perspectiveRatio,W=(y.x1*h+b.x-y.padding)*X+Y.point.x,K=(y.y1*h+b.y-y.padding)*X+Y.point.y,te=(y.x2*h+b.x+y.padding)*X+Y.point.x,se=(y.y2*h+b.y+y.padding)*X+Y.point.y,he=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(W,K,te,se)||!w&&this.grid.hitTest(W,K,te,se,O)||he?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[W,K,te,se],offscreen:this.isOffscreen(W,K,te,se),occluded:!1}}placeCollisionCircles(l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y){const X=[],W=this.transform.elevation,K=l.getProjection(),te=W?W.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,K):null,se=new d.P(y.tileAnchorX,y.tileAnchorY);let{x:he,y:ce,z:ue}=K.projectTilePoint(se.x,se.y,Y.canonical);if(te){const[Ye,Oe,ze]=te(se);he+=Ye,ce+=Oe,ue+=ze}const ye="globe"===K.name,pe=this.projectAndGetPerspectiveRatio(M,he,ce,ue,Y,ye||!!W||this.transform.pitch>0,K),{perspectiveRatio:Se}=pe,xe=(B?E/Se:E*Se)/d.bP,ae=xa(he,ce,ue,O),Fe=pe.signedDistanceFromCamera>0?ep(xe,w,y.lineOffsetX*xe,y.lineOffsetY*xe,!1,ae,se,y,b,O,{},W&&!B?te:null,B&&!!W,K,Y,B):null;let ke=!1,Ee=!1,We=!0;if(Fe&&!pe.occluded){const Ye=.5*j*Se+Z,Oe=new d.P(-100,-100),ze=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Te=new Cl,{first:Ke,last:Xe}=Fe,bt=Ke.path.length;let pt=[];for(let Gt=bt-1;Gt>=1;Gt--)pt.push(Ke.path[Gt]);for(let Gt=1;Gt<Xe.path.length;Gt++)pt.push(Xe.path[Gt]);const nt=2.5*Ye;R&&(pt=pt.map(([Gt,rn,en],mn)=>(te&&!ye&&(en=te(mn<bt-1?Ke.tilePath[bt-1-mn]:Xe.tilePath[mn-bt+2])[2]),xa(Gt,rn,en,R))),pt.some(Gt=>Gt[3]<=0)&&(pt=[]));let Ct=[];if(pt.length>0){let Gt=1/0,rn=-1/0,en=1/0,mn=-1/0;for(const on of pt)Gt=Math.min(Gt,on[0]),en=Math.min(en,on[1]),rn=Math.max(rn,on[0]),mn=Math.max(mn,on[1]);rn>=Oe.x&&Gt<=ze.x&&mn>=Oe.y&&en<=ze.y&&(Ct=[pt.map(on=>new d.P(on[0],on[1]))],(Gt<Oe.x||rn>ze.x||en<Oe.y||mn>ze.y)&&(Ct=d.cH(Ct,Oe.x,Oe.y,ze.x,ze.y)))}for(const Gt of Ct){Te.reset(Gt,.25*Ye);let rn=0;rn=Te.length<=.5*Ye?1:Math.ceil(Te.paddedLength/nt)+1;for(let en=0;en<rn;en++){const mn=en/Math.max(rn-1,1),on=Te.lerp(mn),xi=on.x+$t,An=on.y+$t;X.push(xi,An,Ye,0);const vn=xi-Ye,oi=An-Ye,xn=xi+Ye,Mn=An+Ye;if(We=We&&this.isOffscreen(vn,oi,xn,Mn),Ee=Ee||this.isInsideGrid(vn,oi,xn,Mn),!h&&this.grid.hitTestCircle(xi,An,Ye,U)&&(ke=!0,!k))return{circles:[],offscreen:!1,collisionDetected:ke,occluded:!1}}}}return{circles:!k&&ke||!Ee?[]:X,offscreen:We,collisionDetected:ke,occluded:pe.occluded}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let y=1/0,b=1/0,w=-1/0,E=-1/0;for(const k of l){const B=new d.P(k.x+$t,k.y+$t);y=Math.min(y,B.x),b=Math.min(b,B.y),w=Math.max(w,B.x),E=Math.max(E,B.y),h.push(B)}const M=this.grid.query(y,b,w,E).concat(this.ignoredGrid.query(y,b,w,E)),O={},R={};for(const k of M){const B=k.key;if(void 0===O[B.bucketInstanceId]&&(O[B.bucketInstanceId]={}),O[B.bucketInstanceId][B.featureIndex])continue;const U=[new d.P(k.x1,k.y1),new d.P(k.x2,k.y1),new d.P(k.x2,k.y2),new d.P(k.x1,k.y2)];d.cI(h,U)&&(O[B.bucketInstanceId][B.featureIndex]=!0,void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(l,h,y,b,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:w},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,y,b,w){const E=h?this.ignoredGrid:this.grid,M={bucketInstanceId:y,featureIndex:b,collisionGroupID:w};for(let O=0;O<l.length;O+=4)E.insertCircle(M,l[O],l[O+1],l[O+2])}projectAndGetPerspectiveRatio(l,h,y,b,w,E,M){const O=[h,y,b,1];let R=!1;b||this.transform.pitch>0?(d.aB.transformMat4(O,O,l),this.fogState&&w&&"globe"!==M.name&&(R=function(U,j,Z,Y,X,W){const K=W.calculateFogTileMatrix(X),te=[j,Z,Y];return d.$.transformMat4(te,te,K),Hn(U,d.$.length(te),W.pitch,W._fov)}(this.fogState,h,y,b,w.toUnwrapped(),this.transform)>.9)):tp(O,O,l);const k=O[3];return{point:new d.P((O[0]/k+1)/2*this.transform.width+$t,(-O[1]/k+1)/2*this.transform.height+$t),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/k*.5,1.5),signedDistanceFromCamera:k,occluded:E&&O[2]>k||R}}isOffscreen(l,h,y,b){return y<$t||l>=this.screenRightBoundary||b<$t||h>this.screenBottomBoundary}isInsideGrid(l,h,y,b){return y>=0&&l<this.gridRightBoundary&&b>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=d.ae.identity([]);return d.ae.translate(l,l,[-100,-100,0]),l}}class Re{constructor(l,h,y,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):b&&y?1:0,this.placed=y}isHidden(){return 0===this.opacity&&!this.placed}}class rc{constructor(l,h,y,b,w,E=!1){this.text=new Re(l?l.text:null,h,y,w),this.icon=new Re(l?l.icon:null,h,b,w),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bd{constructor(l,h,y,b=!1){this.text=l,this.icon=h,this.skipFade=y,this.clipped=b}}class jh{constructor(){this.invProjMatrix=d.ae.create(),this.viewportMatrix=d.ae.create(),this.circles=[]}}class sg{constructor(l,h,y,b,w){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=w}}class Sy{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[l]}}function ag(g,l,h,y,b){const{horizontalAlign:w,verticalAlign:E}=d.bS(g),M=-(w-.5)*l,O=-(E-.5)*h,R=d.bR(g,y);return new d.P(M+R[0]*b,O+R[1]*b)}function pp(g,l,h,y,b){const w=new d.P(g,l);return h&&w._rotate(y?b:-b),w}class $h{constructor(l,h,y,b,w,E){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new Dy(this.transform,w),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Sy(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,h,y,b){const w=y.getBucket(h),E=y.latestFeatureIndex;if(!w||!E||h.fqid!==w.layerIds[0])return;const M=w.layers[0].layout,O=y.collisionBoxArray,R=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),k=y.tileSize/d.a4,B=y.tileID.toUnwrapped();this.transform.setProjection(w.projection);const U=(j=y.tileID,Z=w.getProjection(),Y=this.transform,Z.name===this.projection?Y.calculateProjMatrix(j.toUnwrapped()):sr(Y,Z,j));var j,Z,Y;const X="map"===M.get("text-pitch-alignment"),W="map"===M.get("text-rotation-alignment");h.compileFilter();const K=h.dynamicFilter(),te=h.dynamicFilterNeedsFeature(),se=this.transform.calculatePixelsToTileUnitsMatrix(y),he=Kf(U,y.tileID.canonical,X,W,this.transform,w.getProjection(),se);let ce=null;if(X){const pe=Jf(U,y.tileID.canonical,X,W,this.transform,w.getProjection(),se);ce=d.ae.multiply([],this.transform.labelPlaneMatrix,pe)}let ue=null;K&&y.latestFeatureIndex&&(ue={unwrappedTileID:B,dynamicFilter:K,dynamicFilterNeedsFeature:te,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new sg(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,y.tileID);const ye={bucket:w,layout:M,posMatrix:U,textLabelPlaneMatrix:he,labelToScreenMatrix:ce,clippingData:ue,scale:R,textPixelRatio:k,holdingForFade:y.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:d.aE(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.aE(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(b)for(const pe of w.sortKeyRanges){const{sortKey:Se,symbolInstanceStart:xe,symbolInstanceEnd:ae}=pe;l.push({sortKey:Se,symbolInstanceStart:xe,symbolInstanceEnd:ae,parameters:ye})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(l,h,y,b,w,E,M,O,R,k,B,U,j,Z,Y,X,W,K){const{textOffset0:te,textOffset1:se,crossTileID:he}=U,ce=[te,se],ue=ag(l,y,b,ce,w),ye=this.collisionIndex.placeCollisionBox(Z,w,h,pp(ue.x,ue.y,E,M,this.transform.angle),B,O,R,k.predicate);if(X){const pe=Z.getSymbolInstanceIconSize(K,this.transform.zoom,U.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Z,pe,X,pp(ue.x,ue.y,E,M,this.transform.angle),B,O,R,k.predicate).box.length)return}if(ye.box.length>0){let pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[he]&&this.prevPlacement.placements[he]&&this.prevPlacement.placements[he].text&&(pe=this.prevPlacement.variableOffsets[he].anchor),this.variableOffsets[he]={textOffset:ce,width:y,height:b,anchor:l,textScale:w,prevAnchor:pe},this.markUsedJustification(Z,l,U,Y),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,Y,U),this.placedOrientations[he]=Y),{shift:ue,placedGlyphBoxes:ye}}}placeLayerBucketPart(l,h,y,b){const{bucket:w,layout:E,posMatrix:M,textLabelPlaneMatrix:O,labelToScreenMatrix:R,clippingData:k,textPixelRatio:B,holdingForFade:U,collisionBoxArray:j,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:Y,collisionGroup:X}=l.parameters,W=E.get("text-optional"),K=E.get("icon-optional"),te=E.get("text-allow-overlap"),se=E.get("icon-allow-overlap"),he="map"===E.get("text-rotation-alignment"),ce="map"===E.get("text-pitch-alignment"),ue="viewport-y"===E.get("symbol-z-order"),ye=E.get("symbol-z-elevate");this.transform.setProjection(w.projection);let pe=te&&(se||!w.hasIconData()||K),Se=se&&(te||!w.hasTextData()||W);!w.collisionArrays&&j&&w.deserializeCollisionBoxes(j),y&&b&&w.updateCollisionDebugBuffers(this.transform.zoom,j);const xe=(ae,Fe,ke)=>{const{crossTileID:Ee,numVerticalGlyphVertices:We}=ae;if(k){const xn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Mn=null;if(k.dynamicFilterNeedsFeature){const nn=this.retainedQueryData[w.bucketInstanceId];Mn=k.featureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:nn.bucketIndex,sourceLayerIndex:nn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(xn,Mn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new d.P(ae.tileAnchorX,ae.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[Ee]=new bd(!1,!1,!1,!0),void h.add(Ee)}if(h.has(Ee))return;if(U)return void(this.placements[Ee]=new bd(!1,!1,!1));let Ye=!1,Oe=!1,ze=!0,Te=!1,Ke=!1,Xe=null,bt={box:null,offscreen:null,occluded:null},pt={box:null,offscreen:null,occluded:null},nt=null,Ct=null,Gt=null,rn=0,en=0,mn=0;ke.textFeatureIndex?rn=ke.textFeatureIndex:ae.useRuntimeCollisionCircles&&(rn=ae.featureIndex),ke.verticalTextFeatureIndex&&(en=ke.verticalTextFeatureIndex);const on=xn=>{xn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Mn=this.transform.elevation;xn.elevation=ae.zOffset+(Mn?Mn.getAtTileOffset(xn.tileID,xn.tileAnchorX,xn.tileAnchorY):0)},xi=ke.textBox;if(xi){on(xi);const xn=nn=>{let Bn=d.aF.horizontal;if(w.allowVerticalPlacement&&!nn&&this.prevPlacement){const kn=this.prevPlacement.placedOrientations[Ee];kn&&(this.placedOrientations[Ee]=kn,Bn=kn,this.markUsedOrientation(w,Bn,ae))}return Bn},Mn=(nn,Bn)=>{if(w.allowVerticalPlacement&&We>0&&ke.verticalTextBox){for(const kn of w.writingModes)if(kn===d.aF.vertical?(bt=Bn(),pt=bt):bt=nn(),bt&&bt.box&&bt.box.length)break}else bt=nn()};if(E.get("text-variable-anchor")){let nn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ee]){const cn=this.prevPlacement.variableOffsets[Ee];nn.indexOf(cn.anchor)>0&&(nn=nn.filter(rr=>rr!==cn.anchor),nn.unshift(cn.anchor))}const Bn=(cn,rr,ar)=>{const go=w.getSymbolInstanceTextSize(Z,ae,this.transform.zoom,Fe),Wr=(cn.x2-cn.x1)*go+2*cn.padding,_o=(cn.y2-cn.y1)*go+2*cn.padding,Ro=ae.hasIconTextFit&&!se?rr:null;Ro&&on(Ro);let no={box:[],offscreen:!1,occluded:!1};const yo=te?2*nn.length:nn.length;for(let ct=0;ct<yo;++ct){const Nt=this.attemptAnchorPlacement(nn[ct%nn.length],cn,Wr,_o,go,he,ce,B,M,X,ct>=nn.length,ae,Fe,w,ar,Ro,Z,Y);if(Nt&&(no=Nt.placedGlyphBoxes,no&&no.box&&no.box.length)){Ye=!0,Xe=Nt.shift;break}}return no};Mn(()=>Bn(xi,ke.iconBox,d.aF.horizontal),()=>{const cn=ke.verticalTextBox;return cn&&on(cn),w.allowVerticalPlacement&&!(bt&&bt.box&&bt.box.length)&&We>0&&cn?Bn(cn,ke.verticalIconBox,d.aF.vertical):{box:null,offscreen:null,occluded:null}}),bt&&(Ye=bt.box,ze=bt.offscreen,Te=bt.occluded);const kn=xn(!(!bt||!bt.box));if(!Ye&&this.prevPlacement){const cn=this.prevPlacement.variableOffsets[Ee];cn&&(this.variableOffsets[Ee]=cn,this.markUsedJustification(w,cn.anchor,ae,kn))}}else{const nn=(Bn,kn)=>{const cn=w.getSymbolInstanceTextSize(Z,ae,this.transform.zoom,Fe),rr=this.collisionIndex.placeCollisionBox(w,cn,Bn,new d.P(0,0),te,B,M,X.predicate);return rr&&rr.box&&rr.box.length&&(this.markUsedOrientation(w,kn,ae),this.placedOrientations[Ee]=kn),rr};Mn(()=>nn(xi,d.aF.horizontal),()=>{const Bn=ke.verticalTextBox;return w.allowVerticalPlacement&&We>0&&Bn?(on(Bn),nn(Bn,d.aF.vertical)):{box:null,offscreen:null,occluded:null}}),xn(!!(bt&&bt.box&&bt.box.length))}}if(nt=bt,Ye=nt&&nt.box&&nt.box.length>0,ze=nt&&nt.offscreen,Te=nt&&nt.occluded,ae.useRuntimeCollisionCircles){const xn=w.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex>=0?ae.centerJustifiedTextSymbolIndex:ae.verticalPlacedTextSymbolIndex),Mn=d.aG(w.textSizeData,Z,xn),nn=E.get("text-padding");Ct=this.collisionIndex.placeCollisionCircles(w,te,xn,w.lineVertexArray,w.glyphOffsetArray,Mn,M,O,R,y,ce,X.predicate,ae.collisionCircleDiameter*Mn/d.bP,nn,this.retainedQueryData[w.bucketInstanceId].tileID),Ye=te||Ct.circles.length>0&&!Ct.collisionDetected,ze=ze&&Ct.offscreen,Te=Ct.occluded}if(ke.iconFeatureIndex&&(mn=ke.iconFeatureIndex),ke.iconBox){const xn=Mn=>{on(Mn);const nn=ae.hasIconTextFit&&Xe?pp(Xe.x,Xe.y,he,ce,this.transform.angle):new d.P(0,0),Bn=w.getSymbolInstanceIconSize(Y,this.transform.zoom,ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Bn,Mn,nn,se,B,M,X.predicate)};pt&&pt.box&&pt.box.length&&ke.verticalIconBox?(Gt=xn(ke.verticalIconBox),Oe=Gt.box.length>0):(Gt=xn(ke.iconBox),Oe=Gt.box.length>0),ze=ze&&Gt.offscreen,Ke=Gt.occluded}const An=W||0===ae.numHorizontalGlyphVertices&&0===We,vn=K||0===ae.numIconVertices;if(An||vn?vn?An||(Oe=Oe&&Ye):Ye=Oe&&Ye:Oe=Ye=Oe&&Ye,Ye&&nt&&nt.box&&this.collisionIndex.insertCollisionBox(nt.box,E.get("text-ignore-placement"),w.bucketInstanceId,pt&&pt.box&&en?en:rn,X.ID),Oe&&Gt&&this.collisionIndex.insertCollisionBox(Gt.box,E.get("icon-ignore-placement"),w.bucketInstanceId,mn,X.ID),Ct&&(Ye&&this.collisionIndex.insertCollisionCircles(Ct.circles,E.get("text-ignore-placement"),w.bucketInstanceId,rn,X.ID),y)){const xn=w.bucketInstanceId;let Mn=this.collisionCircleArrays[xn];void 0===Mn&&(Mn=this.collisionCircleArrays[xn]=new jh);for(let nn=0;nn<Ct.circles.length;nn+=4)Mn.circles.push(Ct.circles[nn+0]),Mn.circles.push(Ct.circles[nn+1]),Mn.circles.push(Ct.circles[nn+2]),Mn.circles.push(Ct.collisionDetected?1:0)}const oi="globe"!==w.projection.name;pe=pe&&(oi||!Te),Se=Se&&(oi||!Ke),this.placements[Ee]=new bd(Ye||pe,Oe||Se,ze||w.justReloaded),h.add(Ee)};if(ye&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),ue){const ae=w.getSortedSymbolIndexes(this.transform.angle);for(let Fe=ae.length-1;Fe>=0;--Fe){const ke=ae[Fe];xe(w.symbolInstances.get(ke),ke,w.collisionArrays[ke])}w.hasAnyZOffset&&d.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const ae=w.getSortedIndexesByZOffset();for(let Fe=0;Fe<ae.length;++Fe){const ke=ae[Fe];xe(w.symbolInstances.get(ke),ke,w.collisionArrays[ke])}}else for(let ae=l.symbolInstanceStart;ae<l.symbolInstanceEnd;ae++)xe(w.symbolInstances.get(ae),ae,w.collisionArrays[ae]);if(y&&w.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[w.bucketInstanceId];d.ae.invert(ae.invProjMatrix,M),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(l,h,y,b){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:O,crossTileID:R}=y,k=d.cM(h),B=b===d.aF.vertical?O:"left"===k?w:"center"===k?E:"right"===k?M:-1;w>=0&&(l.text.placedSymbolArray.get(w).crossTileID=B>=0&&w!==B?0:R),E>=0&&(l.text.placedSymbolArray.get(E).crossTileID=B>=0&&E!==B?0:R),M>=0&&(l.text.placedSymbolArray.get(M).crossTileID=B>=0&&M!==B?0:R),O>=0&&(l.text.placedSymbolArray.get(O).crossTileID=B>=0&&O!==B?0:R)}markUsedOrientation(l,h,y){const b=h===d.aF.horizontal||h===d.aF.horizontalOnly?h:0,w=h===d.aF.vertical?h:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:R}=y,k=l.text.placedSymbolArray;E>=0&&(k.get(E).placedOrientation=b),M>=0&&(k.get(M).placedOrientation=b),O>=0&&(k.get(O).placedOrientation=b),R>=0&&(k.get(R).placedOrientation=w)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const b=h?h.symbolFadeChange(l):1,w=h?h.opacities:{},E=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const O in this.placements){const R=this.placements[O],k=w[O];k?(this.opacities[O]=new rc(k,b,R.text,R.icon,null,R.clipped),y=y||R.text!==k.text.placed||R.icon!==k.icon.placed):(this.opacities[O]=new rc(null,b,R.text,R.icon,R.skipFade,R.clipped),y=y||R.text||R.icon)}for(const O in w){const R=w[O];if(!this.opacities[O]){const k=new rc(R,b,!1,!1);k.isHidden()||(this.opacities[O]=k,y=y||R.text.placed||R.icon.placed)}}for(const O in E)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=E[O]);for(const O in M)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=M[O]);y?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h,y,b){const w=new Set;for(const E of h){const M=E.getBucket(l);M&&E.latestFeatureIndex&&l.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,w,E.collisionBoxArray,y,b,E.tileID,l.scope),M.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,E.tileID),M.updateZOffset()))}}updateBucketOpacities(l,h,y,b,w,E,M){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const O=l.layers[0].layout,R=!!l.layers[0].dynamicFilter(),k=new rc(null,0,!1,!1,!0),B=O.get("text-allow-overlap"),U=O.get("icon-allow-overlap"),j=O.get("text-variable-anchor"),Z="map"===O.get("text-rotation-alignment"),Y="map"===O.get("text-pitch-alignment"),X=new rc(null,0,B&&(U||!l.hasIconData()||O.get("icon-optional")),U&&(B||!l.hasTextData()||O.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const W=(te,se,he)=>{for(let ce=0;ce<se/4;ce++)te.opacityVertexArray.emplaceBack(he)};let K=0;w&&l.updateReplacement(E,w);for(let te=0;te<l.symbolInstances.length;te++){const se=l.symbolInstances.get(te),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:ce,crossTileID:ue,numIconVertices:ye,tileAnchorX:pe,tileAnchorY:Se}=se,xe=h.has(ue);let ae=this.opacities[ue];xe?ae=k:ae||(ae=X,this.opacities[ue]=ae),h.add(ue);const Fe=he>0||ce>0,ke=ye>0,Ee=this.placedOrientations[ue],We=Ee===d.aF.vertical,Ye=Ee===d.aF.horizontal||Ee===d.aF.horizontalOnly;!Fe&&!ke||ae.isHidden()||K++;let Oe=!1;if((Fe||ke)&&w)for(const ze of l.activeReplacements){if(d.cJ(ze,b,d.cw.Symbol,M)||ze.min.x>pe||pe>ze.max.x||ze.min.y>Se||Se>ze.max.y)continue;const Te=d.cK(pe,Se,E.canonical,ze.footprintTileId.canonical);if(Oe=d.cL(Te,ze),Oe)break}if(Fe){const ze=Oe?Ea:Oo(ae.text);W(l.text,he,We?Ea:ze),W(l.text,ce,Ye?Ea:ze);const Te=ae.text.isHidden(),{leftJustifiedTextSymbolIndex:Ke,centerJustifiedTextSymbolIndex:Xe,rightJustifiedTextSymbolIndex:bt,verticalPlacedTextSymbolIndex:pt}=se,nt=l.text.placedSymbolArray,Ct=Te||We?1:0;Ke>=0&&(nt.get(Ke).hidden=Ct),Xe>=0&&(nt.get(Xe).hidden=Ct),bt>=0&&(nt.get(bt).hidden=Ct),pt>=0&&(nt.get(pt).hidden=Te||Ye?1:0);const Gt=this.variableOffsets[ue];Gt&&this.markUsedJustification(l,Gt.anchor,se,Ee);const rn=this.placedOrientations[ue];rn&&(this.markUsedJustification(l,"left",se,rn),this.markUsedOrientation(l,rn,se))}if(ke){const ze=Oe?Ea:Oo(ae.icon),{placedIconSymbolIndex:Te,verticalPlacedIconSymbolIndex:Ke}=se,Xe=l.icon.placedSymbolArray,bt=ae.icon.isHidden()?1:0;Te>=0&&(W(l.icon,ye,We?Ea:ze),Xe.get(Te).hidden=bt),Ke>=0&&(W(l.icon,se.numVerticalIconVertices,Ye?Ea:ze),Xe.get(Ke).hidden=bt)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const ze=l.collisionArrays[te];if(ze){let Te=new d.P(0,0),Ke=!0;if(ze.textBox||ze.verticalTextBox){if(j){const bt=this.variableOffsets[ue];bt?(Te=ag(bt.anchor,bt.width,bt.height,bt.textOffset,bt.textScale),Z&&Te._rotate(Y?this.transform.angle:-this.transform.angle)):Ke=!1}R&&(Ke=!ae.clipped),ze.textBox&&Za(l.textCollisionBox.collisionVertexArray,ae.text.placed,!Ke||We,Te.x,Te.y),ze.verticalTextBox&&Za(l.textCollisionBox.collisionVertexArray,ae.text.placed,!Ke||Ye,Te.x,Te.y)}const Xe=Ke&&!(Ye||!ze.verticalIconBox);ze.iconBox&&Za(l.iconCollisionBox.collisionVertexArray,ae.icon.placed,Xe,se.hasIconTextFit?Te.x:0,se.hasIconTextFit?Te.y:0),ze.verticalIconBox&&Za(l.iconCollisionBox.collisionVertexArray,ae.icon.placed,!Xe,se.hasIconTextFit?Te.x:0,se.hasIconTextFit?Te.y:0)}}}if(l.fullyClipped=0===K,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=te.invProjMatrix,l.placementViewportMatrix=te.viewportMatrix,l.collisionCircleArray=te.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function Za(g,l,h,y,b){g.emplaceBack(l?1:0,h?1:0,y||0,b||0),g.emplaceBack(l?1:0,h?1:0,y||0,b||0),g.emplaceBack(l?1:0,h?1:0,y||0,b||0),g.emplaceBack(l?1:0,h?1:0,y||0,b||0)}const cu=Math.pow(2,25),My=Math.pow(2,24),oc=Math.pow(2,17),Gh=Math.pow(2,16),to=Math.pow(2,9),uu=Math.pow(2,8),mp=Math.pow(2,1);function Oo(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const l=g.placed?1:0,h=Math.floor(127*g.opacity);return h*cu+l*My+h*oc+l*Gh+h*to+l*uu+h*mp+l}const Ea=0;class ft{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,h,y,b,w){const E=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(E,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((M,O)=>M.sortKey-O.sortKey));this._currentPartIndex<E.length;){const M=E[this._currentPartIndex];if(h.placeLayerBucketPart(M,this._seenCrossTileIDs,y,0===M.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class D1{constructor(l,h,y,b,w,E,M,O,R){this.placement=new $h(l,w,E,M,O,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(l,h,y,b){const w=d.e.now(),E=()=>{const M=d.e.now()-w;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=h[l[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=O)&&(!M.maxzoom||M.maxzoom>O)){const R=M,k=R.layout.get("symbol-z-elevate"),B=this._inProgressLayer=this._inProgressLayer||new ft(R),U=d.am(M.source,M.scope);if(B.continuePlacement(k?b[U]:y[U],this.placement,this._showCollisionBoxes,M,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const xd=512/d.a4/2;class Iy{constructor(l,h,y){this.tileID=l,this.bucketInstanceId=y,this.index=new d.cN(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=l.canonical.x*d.a4,w=l.canonical.y*d.a4;for(let E=0;E<h.length;E++){const{key:M,crossTileID:O,tileAnchorX:R,tileAnchorY:k}=h.get(E),B=Math.floor((b+R)*xd),U=Math.floor((w+k)*xd);this.index.add(B,U),this.keys.push(M),this.crossTileIDs.push(O)}this.index.finish()}findMatches(l,h,y){const b=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),w=xd/Math.pow(2,h.canonical.z-this.tileID.canonical.z),E=h.canonical.x*d.a4,M=h.canonical.y*d.a4;for(let O=0;O<l.length;O++){const R=l.get(O);if(R.crossTileID)continue;const{key:k,tileAnchorX:B,tileAnchorY:U}=R,j=Math.floor((E+B)*w),Z=Math.floor((M+U)*w),Y=this.index.range(j-b,Z-b,j+b,Z+b);for(const X of Y){const W=this.crossTileIDs[X];if(this.keys[X]===k&&!y.has(W)){y.add(W),R.crossTileID=W;break}}}}}class xs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(0!==h)for(const y in this.indexes){const b=this.indexes[y],w={};for(const E in b){const M=b[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),w[M.tileID.key]=M}this.indexes[y]=w}this.lng=l}addBucket(l,h,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const b=this.usedCrossTileIDs[l.overscaledZ];for(const w in this.indexes){const E=this.indexes[w];if(Number(w)>l.overscaledZ)for(const M in E){const O=E[M];O.tileID.isChildOf(l)&&O.findMatches(h.symbolInstances,l,b)}else{const M=E[l.scaledTo(Number(w)).key];M&&M.findMatches(h.symbolInstances,l,b)}}for(let w=0;w<h.symbolInstances.length;w++){const E=h.symbolInstances.get(w);E.crossTileID||(E.crossTileID=y.generate(),b.add(E.crossTileID))}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Iy(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const y of h.crossTileIDs)this.usedCrossTileIDs[l].delete(y)}removeStaleBuckets(l){let h=!1;for(const y in this.indexes){const b=this.indexes[y];for(const w in b)l[b[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[w]),delete b[w],h=!0)}return h}}class ws{constructor(){this.layerIndexes={},this.crossTileIDs=new xs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,y,b){let w=this.layerIndexes[l.fqid];void 0===w&&(w=this.layerIndexes[l.fqid]=new wd);let E=!1;const M={};"globe"!==b.name&&w.handleWrapJump(y);for(const O of h){const R=O.getBucket(l);R&&l.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,R,this.crossTileIDs)&&(E=!0),M[R.bucketInstanceId]=!0)}return w.removeStaleBuckets(M)&&(E=!0),E}pruneUnusedLayers(l){const h={};l.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const Ay=new d.U({data:new d.W(d.N.colorTheme.data)}),Cs=(g,l)=>Wt(g,l&&l.filter(h=>"source.canvas"!==h.identifier)),Ls=d.ai(Xn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),gi=d.ai(Xn,["setCenter","setZoom","setBearing","setPitch"]),aa={version:8,layers:[],sources:{}},lg={duration:300,delay:0};class Ko extends d.E{constructor(l,h={}){super(),this.map=l,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=d.Q({},lg),this._buildingIndex=new Fs(this),this.crossTileSymbolIndex=new ws,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Hl,this.dispatcher=h.dispatcher?h.dispatcher:new d.by(d.bz(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Go,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new d.cP(l._requestManager,h.localFontFamily?d.cQ.all:h.localIdeographFontFamily?d.cQ.ideographs:d.cQ.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new $a(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",d.cR());const y=this;this._rtlTextPluginCallback=Ko.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(w,E)=>{if(d.cS(w),E&&E.every(M=>M))for(const M in y._sourceCaches){const O=y._sourceCaches[M],R=O.getSource().type;"vector"!==R&&"geojson"!==R||O.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const w=this.getOwnSource(b.sourceId);if(w&&w.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===w.id&&this._validateLayer(M)}})}load(l){return l?("string"==typeof l?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if("string"==typeof l){if(d.cT(l))return l;const h=d.cU(l);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${d.cV(JSON.stringify(l))}`}_diffStyle(l,h,y){this.globalId=this._getGlobalId(l);const b=(w,E)=>{try{E(null,this.setState(w,y))}catch(M){E(M,!1)}};if("string"==typeof l){const w=this.map._requestManager.normalizeStyleURL(l),E=this.map._requestManager.transformRequest(w,d.R.Style);d.h(E,(M,O)=>{M?this.fire(new d.f(M)):O&&b(O,h)})}else"object"==typeof l&&b(l,h)}loadURL(l,h={}){this.fire(new d.g("dataloading",{dataType:"style"}));const y="boolean"==typeof h.validate?h.validate:!d.cT(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,h.accessToken),this.resolvedImports.add(l);const b=this.importsCache.get(l);if(b)return this._load(b,y);const w=this.map._requestManager.transformRequest(l,d.R.Style);this._request=d.h(w,(E,M)=>{if(this._request=null,E)this.fire(new d.f(E));else if(M)return this.importsCache.set(l,M),this._load(M,y)})}loadJSON(l,h={}){this.fire(new d.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=d.e.frame(()=>{this._request=null,this._load(l,!1!==h.validate)})}loadEmpty(){this.fire(new d.g("dataloading",{dataType:"style"})),this._load(aa,!1)}_loadImports(l,h,y){if(this.importDepth>=4)return d.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const w of l){const E=this._createFragmentStyle(w),M=new Promise(k=>{E.once("style.import.load",k),E.once("error",k)}).then(()=>this.mergeAll());if(b.push(M),this.resolvedImports.has(w.url)){E.loadEmpty();continue}const O=w.data||this.importsCache.get(w.url);O?(E.loadJSON(O,{validate:h}),this._isInternalStyle(O)&&(E.globalId=null)):w.url?E.loadURL(w.url,{validate:h}):E.loadEmpty();const R={style:E,id:w.id,config:w.config};if(y){const k=this.fragments.findIndex(({id:B})=>B===y);this.fragments=this.fragments.slice(0,k).concat(R).concat(this.fragments.slice(k))}else this.fragments.push(R)}return Promise.allSettled(b)}getImportGlobalIds(l=this,h=new Set){for(const y of l.fragments)y.style.globalId&&h.add(y.style.globalId),this.getImportGlobalIds(y.style,h);return[...h.values()]}_createFragmentStyle(l){const h=this.scope?d.am(l.id,this.scope):l.id;let y;const b=this._initialConfig&&this._initialConfig[h];(l.config||b)&&(y=d.Q({},l.config,b));const w=new Ko(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&!1!==l.fragment)}_load(l,h){const y=l.schema;if(this._isInternalStyle(l)){const E=d.Q({},aa,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(E,h)}if(this.updateConfig(this._config,y),h&&Cs(this,H(l)))return;this._loaded=!0,this.stylesheet=d.cW(l);const b=()=>{for(const R in l.sources)this.addSource(R,l.sources[R],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const E=yl(this.stylesheet.layers);if(this._order=E.map(R=>R.id),this.stylesheet.light&&d.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const R=this.stylesheet.lights[0];this.light=new Wn(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Wn(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const R of E){const k=d.c$(R,this.scope,this._styleColorTheme.lut,this.options);0!==k.configDependencies.size&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize();const B=this.getOwnLayerSourceCache(k),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&k.canCastShadows()&&U&&(B.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new d.g("data",{dataType:"style"}));const O=this.isRootStyle();l.imports?this._loadImports(l.imports,h).then(()=>{this._reloadImports(),this.fire(new d.g(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new d.g(O?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const E=this._evaluateColorThemeData(w);this._loadColorTheme(E).then(()=>{b()}).catch(M=>{d.w(`Couldn't load color theme from the stylesheet: ${M}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return 0===this.importDepth}mergeAll(){let l,h,y,b,w,E,M,O;const R={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(k=>{if(k.stylesheet){if(null!=k.light&&(l=k.light),k.stylesheet.lights)for(const B of k.stylesheet.lights)"ambient"===B.type&&null!=k.ambientLight&&(h=k.ambientLight),"directional"===B.type&&null!=k.directionalLight&&(y=k.directionalLight);b=this._prioritizeTerrain(b,k.terrain,k.stylesheet.terrain),k.stylesheet.fog&&null!=k.fog&&(w=k.fog),null!=k.stylesheet.camera&&(O=k.stylesheet.camera),null!=k.stylesheet.projection&&(E=k.stylesheet.projection),null!=k.stylesheet.transition&&(M=k.stylesheet.transition),R[k.scope]=k._styleColorTheme}}),this.light=l,this.ambientLight=h,this.directionalLight=y,this.fog=w,this._styleColorThemeForScope=R,null===b?delete this.terrain:this.terrain=b,this.camera=O||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=d.Q({},lg,M),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const h=y=>{for(const b of y.fragments)h(b.style);l(y)};h(this)}_prioritizeTerrain(l,h,y){const b=l&&0===l.drapeRenderMode;return null===y?h&&0===h.drapeRenderMode?h:b?l:null:null!=h&&(!l||b||h&&1===h.drapeRenderMode)?h:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{l=this._prioritizeTerrain(l,h.terrain,h.stylesheet.terrain)}),null===l?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(h=>{null!=h.stylesheet.projection&&(l=h.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},h={},y={};this.forEachFragmentStyle(b=>{for(const w in b._sourceCaches){const E=d.am(w,b.scope);l[E]=b._sourceCaches[w]}for(const w in b._otherSourceCaches){const E=d.am(w,b.scope);h[E]=b._otherSourceCaches[w]}for(const w in b._symbolSourceCaches){const E=d.am(w,b.scope);y[E]=b._symbolSourceCaches[w]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=y}mergeLayers(){const l={},h=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(const M of E._order){const O=E._layers[M];if("slot"===O.type){const R=d.cX(M);if(l[R])continue;l[R]=[]}O.slot&&l[O.slot]?l[O.slot].push(O):h.push(O)}}),this._mergedOrder=[],this._clipLayerIndices=[];let b=0;const w=(E=[])=>{for(const M of E)if("slot"===M.type){const O=d.cX(M.id);l[O]&&w(l[O]),this._mergedSlots.push(O)}else{const O=d.am(M.id,M.scope);this._mergedOrder.push(O),y[O]=M,M.is3D()&&(this._has3DLayers=!0),"circle"===M.type&&(this._hasCircleLayers=!0),"symbol"===M.type&&(this._hasSymbolLayers=!0),"clip"===M.type&&this._clipLayerIndices.push(b),b++}};w(h),this._mergedOrder.sort((E,M)=>{const O=y[E],R=y[M];return O.hasInitialOcclusionOpacityProperties?R.is3D()?1:0:O.is3D()&&R.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=d.Q({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(h,y,b){const w=d.Q({},y);for(const M of Object.keys(d.N.colorTheme))void 0===w[M]&&(w[M]=d.N.colorTheme[M].default);const E=new d.O(Ay,h,new Map(b));return E.setTransitionOrValue(w,b),E.untransitioned().possiblyEvaluate(new d.Y(0))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,b)=>{const w="data:image/png;base64,";if(!l||0===l.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let E=l;E.startsWith(w)||(E=w+E);const M="mapbox-reserved-lut",O=new Image;O.src=E,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void y();this._styleColorTheme.lutLoading=!1;const{width:R,height:k,data:B}=d.e.getImageData(O);if(k>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==k*k)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new d.j({width:R,height:k},B),pixelRatio:1,sdf:!1,version:0});const U=this.imageManager.getImage(M,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:l},y()):b(new Error("Missing LUT image."))}})}getLut(l){const h=this._styleColorThemeForScope[l];return h?h.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(h,y,b){let w,E,M;const O=d.e.devicePixelRatio>1?"@2x":"";let R=d.h(y.transformRequest(y.normalizeSpriteURL(h,O,".json"),d.R.SpriteJSON),(U,j)=>{R=null,M||(M=U,w=j,B())}),k=d.i(y.transformRequest(y.normalizeSpriteURL(h,O,".png"),d.R.SpriteImage),(U,j)=>{k=null,M||(M=U,E=j,B())});function B(){if(M)b(M);else if(w&&E){const U=d.e.getImageData(E),j={};for(const Z in w){const{width:Y,height:X,x:W,y:K,sdf:te,pixelRatio:se,stretchX:he,stretchY:ce,content:ue}=w[Z],ye=new d.j({width:Y,height:X});d.j.copy(U,ye,{x:W,y:K},{x:0,y:0},{width:Y,height:X},null),j[Z]={data:ye,pixelRatio:se,sdf:te,stretchX:he,stretchY:ce,content:ue}}b(null,j)}}return{cancel(){R&&(R.cancel(),R=null),k&&(k.cancel(),k=null)}}}(l,this.map._requestManager,(h,y)=>{if(this._spriteRequest=null,h)this.fire(new d.f(h));else if(y)for(const b in y)this.imageManager.addImage(b,this.scope,y[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new d.g("data",{dataType:"style"}))})}_validateLayer(l){const h=this.getOwnSource(l.source);if(!h)return;const y=l.sourceLayer;y&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(y))&&this.fire(new d.f(new Error(`Source layer "${y}" does not exist on source "${h.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,h)=>{const y=this.fragments[h];return y&&y.style&&(l.data=y.style.serialize()),l})}_serializeSources(){const l={};for(const h in this._sourceCaches){const y=this._sourceCaches[h].getSource();l[y.id]||(l[y.id]=y.serialize())}return l}_serializeLayers(l){const h=[];for(const y of l){const b=this._layers[y];b&&"custom"!==b.type&&h.push(b.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const h=this.getOwnLayer(l);if(h)return h;this.fire(new d.f(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const h=this.getOwnSource(l);if(h)return h;this.fire(new d.f(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,h){const y=this.map.painter;if(y)for(let b=l.minzoom||0;b<(l.maxzoom||25.5);b++){const w=l.getProgramIds();if(w)for(const E of w){const M=l.getDefaultProgramParams(E,h.zoom,this._styleColorTheme.lut);M&&(y.style=this,this.fog&&(y._fogVisible=!0,M.overrideFog=!0,y.getOrCreateProgram(E,M)),y._fogVisible=!1,M.overrideFog=!1,y.getOrCreateProgram(E,M),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(M.overrideRtt=!0,y.getOrCreateProgram(E,M)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const h=this.calculateLightsBrightness();l.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));const y=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const M in E){const{updatedIds:O,removedIds:R}=E[M];(O||R)&&(this._updateWorkerLayers(M,O,R),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const w={};for(const E in this._mergedSourceCaches){const M=this._mergedSourceCaches[E];w[E]=M.used,M.used=!1,M.tileCoverLift=0}for(const E of this._mergedOrder){const M=this._mergedLayers[E];if(M.recalculate(l,this._availableImages),!M.isHidden(l.zoom)){const O=this.getLayerSourceCache(M);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,l)}):this.precompilePrograms(M,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();for(const E in w){const M=this._mergedSourceCaches[E];w[E]!==M.used&&M.getSource().fire(new d.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new d.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,h,y){const b=this.getFragmentStyle(l);b&&this.dispatcher.broadcast("updateLayers",{layers:h?b._serializeLayers(h):[],scope:l,removedIds:y||[],options:b.options})}setState(l,h){if(this._checkLoaded(),Cs(this,H(l)))return!1;(l=d.cW(l)).layers=yl(l.layers);const y=function(E,M){if(!E)return[{command:Xn.setStyle,args:[M]}];let O=[];try{if(!d.d(E.version,M.version))return[{command:Xn.setStyle,args:[M]}];if(d.d(E.center,M.center)||O.push({command:Xn.setCenter,args:[M.center]}),d.d(E.zoom,M.zoom)||O.push({command:Xn.setZoom,args:[M.zoom]}),d.d(E.bearing,M.bearing)||O.push({command:Xn.setBearing,args:[M.bearing]}),d.d(E.pitch,M.pitch)||O.push({command:Xn.setPitch,args:[M.pitch]}),d.d(E.sprite,M.sprite)||O.push({command:Xn.setSprite,args:[M.sprite]}),d.d(E.glyphs,M.glyphs)||O.push({command:Xn.setGlyphs,args:[M.glyphs]}),d.d(E.imports,M.imports)||function(j=[],Z=[],Y){Z=Z||[];const X=(j=j||[]).map(xl),W=Z.map(xl),K=j.reduce(wl,{}),te=Z.reduce(wl,{}),se=X.slice();let he,ce,ue,ye;for(he=0,ce=0;he<X.length;he++)ue=X[he],te.hasOwnProperty(ue)?ce++:(Y.push({command:Xn.removeImport,args:[ue]}),se.splice(se.indexOf(ue,ce),1));for(he=0,ce=0;he<W.length;he++)ue=W[W.length-1-he],se[se.length-1-he]!==ue&&(K.hasOwnProperty(ue)?(Y.push({command:Xn.removeImport,args:[ue]}),se.splice(se.lastIndexOf(ue,se.length-ce),1)):ce++,ye=se[se.length-he],Y.push({command:Xn.addImport,args:[te[ue],ye]}),se.splice(se.length-he,0,ue));for(const pe of Z){const Se=K[pe.id];Se&&!d.d(Se,pe)&&Y.push({command:Xn.updateImport,args:[pe.id,pe]})}}(E.imports,M.imports,O),d.d(E.transition,M.transition)||O.push({command:Xn.setTransition,args:[M.transition]}),d.d(E.light,M.light)||O.push({command:Xn.setLight,args:[M.light]}),d.d(E.fog,M.fog)||O.push({command:Xn.setFog,args:[M.fog]}),d.d(E.projection,M.projection)||O.push({command:Xn.setProjection,args:[M.projection]}),d.d(E.lights,M.lights)||O.push({command:Xn.setLights,args:[M.lights]}),d.d(E.camera,M.camera)||O.push({command:Xn.setCamera,args:[M.camera]}),!d.d(E["color-theme"],M["color-theme"]))return[{command:Xn.setStyle,args:[M]}];const R={},k=[];!function(j,Z,Y,X){let W;for(W in Z=Z||{},j=j||{})j.hasOwnProperty(W)&&(Z.hasOwnProperty(W)||Ey(W,Y,X));for(W in Z){if(!Z.hasOwnProperty(W))continue;const K=Z[W];j.hasOwnProperty(W)?d.d(j[W],K)||("geojson"===j[W].type&&"geojson"===K.type&&Vh(j,Z,W)?Y.push({command:Xn.setGeoJSONSourceData,args:[W,K.data]}):E1(W,Z,Y,X)):vl(W,Z,Y)}}(E.sources,M.sources,k,R);const B=[];E.layers&&E.layers.forEach(j=>{j.source&&R[j.source]?O.push({command:Xn.removeLayer,args:[j.id]}):B.push(j)});let U=E.terrain;U&&R[U.source]&&(O.push({command:Xn.setTerrain,args:[void 0]}),U=void 0),O=O.concat(k),d.d(U,M.terrain)||O.push({command:Xn.setTerrain,args:[M.terrain]}),function(j,Z,Y){Z=Z||[];const X=(j=j||[]).map(xl),W=Z.map(xl),K=j.reduce(wl,{}),te=Z.reduce(wl,{}),se=X.slice(),he=Object.create(null);let ce,ue,ye,pe,Se,xe,ae;for(ce=0,ue=0;ce<X.length;ce++)ye=X[ce],te.hasOwnProperty(ye)?ue++:(Y.push({command:Xn.removeLayer,args:[ye]}),se.splice(se.indexOf(ye,ue),1));for(ce=0,ue=0;ce<W.length;ce++)ye=W[W.length-1-ce],se[se.length-1-ce]!==ye&&(K.hasOwnProperty(ye)?(Y.push({command:Xn.removeLayer,args:[ye]}),se.splice(se.lastIndexOf(ye,se.length-ue),1)):ue++,xe=se[se.length-ce],Y.push({command:Xn.addLayer,args:[te[ye],xe]}),se.splice(se.length-ce,0,ye),he[ye]=!0);for(ce=0;ce<W.length;ce++)if(ye=W[ce],pe=K[ye],Se=te[ye],!he[ye]&&!d.d(pe,Se))if(d.d(pe.source,Se.source)&&d.d(pe["source-layer"],Se["source-layer"])&&d.d(pe.type,Se.type)){for(ae in bl(pe.layout,Se.layout,Y,ye,null,Xn.setLayoutProperty),bl(pe.paint,Se.paint,Y,ye,null,Xn.setPaintProperty),d.d(pe.slot,Se.slot)||Y.push({command:Xn.setSlot,args:[ye,Se.slot]}),d.d(pe.filter,Se.filter)||Y.push({command:Xn.setFilter,args:[ye,Se.filter]}),d.d(pe.minzoom,Se.minzoom)&&d.d(pe.maxzoom,Se.maxzoom)||Y.push({command:Xn.setLayerZoomRange,args:[ye,Se.minzoom,Se.maxzoom]}),pe)pe.hasOwnProperty(ae)&&"layout"!==ae&&"paint"!==ae&&"filter"!==ae&&"metadata"!==ae&&"minzoom"!==ae&&"maxzoom"!==ae&&"slot"!==ae&&(0===ae.indexOf("paint.")?bl(pe[ae],Se[ae],Y,ye,ae.slice(6),Xn.setPaintProperty):d.d(pe[ae],Se[ae])||Y.push({command:Xn.setLayerProperty,args:[ye,ae,Se[ae]]}));for(ae in Se)Se.hasOwnProperty(ae)&&!pe.hasOwnProperty(ae)&&"layout"!==ae&&"paint"!==ae&&"filter"!==ae&&"metadata"!==ae&&"minzoom"!==ae&&"maxzoom"!==ae&&"slot"!==ae&&(0===ae.indexOf("paint.")?bl(pe[ae],Se[ae],Y,ye,ae.slice(6),Xn.setPaintProperty):d.d(pe[ae],Se[ae])||Y.push({command:Xn.setLayerProperty,args:[ye,ae,Se[ae]]}))}else Y.push({command:Xn.removeLayer,args:[ye]}),xe=se[se.lastIndexOf(ye)+1],Y.push({command:Xn.addLayer,args:[Se,xe]})}(B,M.layers,O)}catch(R){console.warn("Unable to compute style diff:",R),O=[{command:Xn.setStyle,args:[M]}]}return O}(this.serialize(),l).filter(E=>!(E.command in gi));if(0===y.length)return!1;const b=y.filter(E=>!(E.command in Ls));if(b.length>0)throw new Error(`Unimplemented: ${b.map(E=>E.command).join(", ")}.`);const w=[];return y.forEach(E=>{w.push(this[E.command].apply(this,E.args))}),h&&Promise.all(w).then(h),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,h){return this.getImage(l)?this.fire(new d.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,h),this._afterImageUpdated(l),this)}updateImage(l,h){this.imageManager.updateImage(l,this.scope,h)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new d.f(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new d.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,h,y={}){return this._checkLoaded(),this._validate(ot,`models.${l}`,h,null,y)||(this.modelManager.addModel(l,h,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new d.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,h,y={}){if(this._checkLoaded(),void 0!==this.getOwnSource(l))throw new Error(`There is already a source with ID "${l}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(q,`sources.${l}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const b=ap(l,h,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const w=E=>{const M=(E?"symbol:":"other:")+b.id,O=d.am(M,this.scope),R=this._sourceCaches[M]=new d.bx(O,b,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=R,R.onAdd(this.map)};w(!1),"vector"!==h.type&&"geojson"!==h.type||w(!0),b.onAdd&&b.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const h=this.getOwnSource(l);if(!h)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===l)return this.fire(new d.f(new Error(`Source "${l}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new d.f(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(l);for(const b of y){const w=d.cX(b.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(b.id),b.fire(new d.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,h){this._checkLoaded(),this.getOwnSource(l).setData(h),this._changes.setDirty()}getOwnSource(l){const h=this.getOwnSourceCache(l);return h&&h.getSource()}getOwnSources(){const l=[];for(const h in this._otherSourceCaches){const y=this.getOwnSourceCache(h);y&&l.push(y.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const h in l){const y=l[h]._tiles;for(const b in y){const w=y[b];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const b of l){if(this._validate(be,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(b),w.updateTransitions(h)}else this.ambientLight=new Jc(b,Ch||(Ch=new d.U({color:new d.W(d.N.properties_light_ambient.color),intensity:new d.W(d.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(b),w.updateTransitions(h)}else this.directionalLight=new Jc(b,Th||(Th=new d.U({direction:new d.a6(d.N.properties_light_directional.direction),color:new d.W(d.N.properties_light_directional.color),intensity:new d.W(d.N.properties_light_directional.intensity),"cast-shadows":new d.W(d.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new d.W(d.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=new d.Y(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,h=this.ambientLight;if(!l||!h)return;const y=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),b=l.properties.get("color").toRenderColor(null).toArray01(),w=l.properties.get("intensity"),E=l.properties.get("direction"),M=1-d.ad(E.x,E.y,E.z)[2]/90,O=y(b)*w*M,R=h.properties.get("color").toRenderColor(null).toArray01(),k=h.properties.get("intensity");return(O+y(R)*k)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(d.cY(l)){const h=d.cZ(l),y=this.fragments.find(({id:w})=>w===h);if(!y)throw new Error(`Style import not found: ${l}`);const b=d.cX(l);return y.style.getFragmentStyle(b)}{const h=this.fragments.find(({id:y})=>y===l);if(!h)throw new Error(`Style import not found: ${l}`);return h.style}}getConfigProperty(l,h){const y=this.getFragmentStyle(l);if(!y)return null;const b=d.am(h,y.scope),w=y.options.get(b),E=w?w.value||w.default:null;return E?E.serialize():null}setConfigProperty(l,h,y){const b=this.getFragmentStyle(l);if(!b)return;const w=b.stylesheet.schema;if(!w||!w[h])return;const E=d.z(y);if("success"!==E.result)return void Cs(this,E.value);const M=E.value.expression,O=d.am(h,b.scope),R=b.options.get(O);if(!R)return;let k;const{minValue:B,maxValue:U,stepValue:j,type:Z,values:Y}=w[h],X=d.z(w[h].default);"success"===X.result&&(k=X.value.expression),k?(this.options.set(O,{...R,value:M,default:k,minValue:B,maxValue:U,stepValue:j,type:Z,values:Y}),this.updateConfigDependencies(h)):this.fire(new d.f(new Error(`No schema defined for the config option "${h}" in the "${l}" fragment.`)))}getConfig(l){const h=this.getFragmentStyle(l);if(!h)return null;const y=h.stylesheet.schema;if(!y)return null;const b={};for(const w in y){const E=d.am(w,h.scope),M=h.options.get(E),O=M?M.value||M.default:null;b[w]=O?O.serialize():null}return b}setConfig(l,h){const y=this.getFragmentStyle(l);y&&(y.updateConfig(h,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const h=this.getFragmentStyle(l);return h?h.stylesheet.schema:null}setSchema(l,h){const y=this.getFragmentStyle(l);y&&(y.stylesheet.schema=h,y.updateConfig(y._config,h),this.updateConfigDependencies())}updateConfig(l,h){if(this._config=l,l||h)if(h)for(const y in h){let b,w;const E=d.z(h[y].default);if("success"===E.result&&(b=E.value.expression),l&&void 0!==l[y]){const U=d.z(l[y]);"success"===U.result&&(w=U.value.expression)}const{minValue:M,maxValue:O,stepValue:R,type:k,values:B}=h[y];if(b){const U=d.am(y,this.scope);this.options.set(U,{default:b,value:w,minValue:M,maxValue:O,stepValue:R,type:k,values:B})}else this.fire(new d.f(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new d.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(l){for(const h of this._configDependentLayers){const y=this.getLayer(h);if(y){if(l&&!y.configDependencies.has(l))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(h=>{if(h._styleColorTheme.colorTheme){const y=h._evaluateColorThemeData(h._styleColorTheme.colorTheme);(!h._styleColorTheme.lut&&""!==y||h._styleColorTheme.lut&&y!==h._styleColorTheme.lut.data)&&h.setColorTheme(h._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(l,h,y={}){this._checkLoaded();const b=l.id;if(this._layers[b])return void this.fire(new d.f(new Error(`Layer with id "${b}" already exists on this map`)));let w;if("custom"===l.type){if(Cs(this,d.c_(l)))return;w=d.c$(l,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof l.source&&(this.addSource(b,l.source),l=d.cW(l),l=d.Q(l,{source:b})),this._validate(Ue,`layers.${b}`,l,{arrayIndex:-1},y))return;w=d.c$(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[w.id]=w.serialize()}0!==w.configDependencies.size&&this._configDependentLayers.add(w.fqid);let E=this._order.length;if(h){const k=this._order.indexOf(h);if(-1===k)return void this.fire(new d.f(new Error(`Layer with id "${h}" does not exist on this map.`)));w.slot===this._layers[h].slot?E=k:d.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,b),this._layerOrderChanged=!0,this._layers[b]=w;const M=this.getOwnLayerSourceCache(w),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&w.canCastShadows()&&O&&(M.castsShadows=!0);const R=this._changes.getRemovedLayer(w);if(R&&w.source&&M&&"custom"!==w.type){this._changes.discardLayerRemoval(w);const k=d.am(w.source,w.scope);R.type!==w.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),M.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(l,h){this._checkLoaded();const y=this._checkLayer(l);if(!y||l===h)return;const b=this._order.indexOf(l);this._order.splice(b,1);let w=this._order.length;if(h){const E=this._order.indexOf(h);if(-1===E)return void this.fire(new d.f(new Error(`Layer with id "${h}" does not exist on this map.`)));y.slot===this._layers[h].slot?w=E:d.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const h=this._checkLayer(l);if(!h)return;h.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const b=this.getOwnLayerSourceCache(h);if(b&&b.castsShadows){let w=!1;for(const E in this._layers)if(this._layers[E].source===h.source&&this._layers[E].canCastShadows()){w=!0;break}b.castsShadows=w}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const h in this._layers)if(this._layers[h].type===l)return!0;return!1}setLayerZoomRange(l,h,y){this._checkLoaded();const b=this._checkLayer(l);b&&(b.minzoom===h&&b.maxzoom===y||(null!=h&&(b.minzoom=h),null!=y&&(b.maxzoom=y),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,h){this._checkLoaded();const y=this._checkLayer(l);y&&y.slot!==h&&(y.slot=h,this._updateLayer(y))}setFilter(l,h,y={}){this._checkLoaded();const b=this._checkLayer(l);if(b&&!d.d(b.filter,h))return null==h?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(Me,`layers.${b.id}.filter`,h,{layerType:b.type},y)||(b.filter=d.cW(h),this._updateLayer(b)))}getFilter(l){const h=this._checkLayer(l);if(h)return d.cW(h.filter)}setLayoutProperty(l,h,y,b={}){this._checkLoaded();const w=this._checkLayer(l);if(w&&!d.d(w.getLayoutProperty(h),y)){if(null!=y&&(!b||!1!==b.validate)&&Cs(w,rt.call(H,{key:`layers.${l}.layout.${h}`,layerType:w.type,objectKey:h,value:y,styleSpec:d.N,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(h,y),0!==w.configDependencies.size&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(l,h){const y=this._checkLayer(l);if(y)return y.getLayoutProperty(h)}setPaintProperty(l,h,y,b={}){this._checkLoaded();const w=this._checkLayer(l);if(!w||d.d(w.getPaintProperty(h),y)||null!=y&&(!b||!1!==b.validate)&&Cs(w,Ve.call(H,{key:`layers.${l}.paint.${h}`,layerType:w.type,objectKey:h,value:y,styleSpec:d.N})))return;const E=w.setPaintProperty(h,y);0!==w.configDependencies.size&&this._configDependentLayers.add(w.fqid),E&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(l,h){const y=this._checkLayer(l);if(y)return y.getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const y=l.source,b=l.sourceLayer,w=this._checkSource(y);if(!w)return;const E=w.type;if("geojson"===E&&b)return void this.fire(new d.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!b)return void this.fire(new d.f(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new d.f(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(y);for(const O of M)O.setFeatureState(b,l.id,h)}removeFeatureState(l,h){this._checkLoaded();const y=l.source,b=this._checkSource(y);if(!b)return;const w=b.type,E="vector"===w?l.sourceLayer:void 0;if("vector"===w&&!E)return void this.fire(new d.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new d.f(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(y);for(const O of M)O.removeFeatureState(E,l.id,h)}getFeatureState(l){this._checkLoaded();const h=l.source,y=l.sourceLayer,b=this._checkSource(h);if(b){if("vector"!==b.type||y)return void 0===l.id&&this.fire(new d.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(y,l.id);this.fire(new d.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=d.Q({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return d.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),h=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return d.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>void 0!==y)}_updateLayer(l){this._changes.updateLayer(l);const h=this.getLayerSourceCache(l),y=d.am(l.source,l.scope),b=this._changes.getUpdatedSourceCaches();l.source&&!b[y]&&h&&"raster"!==h.getSource().type&&(this._changes.updateSourceCache(y,"reload"),h.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const h=M=>"fill-extrusion"===this._mergedLayers[M].type||"model"===this._mergedLayers[M].type,y=this.order,b={},w=[];for(let M=y.length-1;M>=0;M--){const O=y[M];if(h(O)){b[O]=M;for(const R of l){const k=R[O];if(k)for(const B of k)w.push(B)}}}w.sort((M,O)=>O.intersectionZ-M.intersectionZ);const E=[];for(let M=y.length-1;M>=0;M--){const O=y[M];if(h(O))for(let R=w.length-1;R>=0;R--){const k=w[R].feature;if(k.layer&&b[k.layer.id]<M)break;E.push(k),w.pop()}else for(const R of l){const k=R[O];if(k)for(const B of k)E.push(B.feature)}}return E}queryRenderedFeatures(l,h,y){h&&h.filter&&this._validate(Me,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;const b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new d.f(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const k=this._mergedLayers[R];if(!k)return this.fire(new d.f(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];b[k.source]=!0}}const w=[],E=h.serializedLayers||{},M=h&&h.layers?h.layers.some(R=>{const k=this.getLayer(R);return k&&k.is3D()}):this.has3DLayers(),O=sa.createFromScreenPoints(l,y);for(const R in this._mergedSourceCaches){const k=this._mergedSourceCaches[R].getSource();if(!k||k.scope!==h.scope)continue;const B=this._mergedSourceCaches[R].getSource().id;h.layers&&!b[B]||w.push(Wa(this._mergedSourceCaches[R],this._mergedLayers,E,O,h,y,M,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(R,k,B,U,j,Z,Y){const X={},W=Z.queryRenderedSymbols(U),K=[];for(const te of Object.keys(W).map(Number))K.push(Y[te]);K.sort(fp);for(const te of K){const se=te.featureIndex.lookupSymbolFeatures(W[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,j.filter,j.layers,j.availableImages,R);for(const he in se){const ce=X[he]=X[he]||[],ue=se[he];ue.sort((ye,pe)=>{const Se=te.featureSortOrder;if(Se){const xe=Se.indexOf(ye.featureIndex);return Se.indexOf(pe.featureIndex)-xe}return pe.featureIndex-ye.featureIndex});for(const ye of ue)ce.push(ye)}}for(const te in X)X[te].forEach(se=>{const he=se.feature,ce=B(R[te]);if(!ce)return;const ue=ce.getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=ue});return X}(this._mergedLayers,E,this.getLayerSourceCache.bind(this),O.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(l,h){h&&h.filter&&this._validate(Me,"querySourceFeatures.filter",h.filter,null,h);const y=this.getOwnSourceCaches(l);let b=[];for(const w of y)b=b.concat(bs(w,h));return b}addSourceType(l,h,y){return Ko.getSourceType(l)?y(new Error(`A source type called "${l}" already exists.`)):(Ko.setSourceType(l,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:h.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,h,y={}){this._checkLoaded();const b=this.light.getLight();let w=!1;for(const M in l)if(!d.d(l[M],b[M])){w=!0;break}if(!w)return;const E=this._getTransitionParameters();this.light.setLight(l,h,y),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=d.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&d.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,h=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===h&&delete this.terrain,null===l?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=l;const b=null==l.source;if(1===h){if(this.disableElevatedTerrain)return;if("object"==typeof y.source){const M="terrain-dem-src";this.addSource(M,y.source),y=d.cW(y),y=d.Q(y,{source:M})}const w=d.Q({},y),E={};if(this.terrain&&b){w.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(E.style=M.serialize())}if(this._validate(me,"terrain",w,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&h!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,h),this.fire(new d.g("data",{dataType:"style"}))}else{const w=this.terrain,E=w.get();for(const M of Object.keys(d.N.terrain))!y.hasOwnProperty(M)&&d.N.terrain[M].default&&(y[M]=d.N.terrain[M].default);for(const M in l)if(!d.d(l[M],E[M])){w.set(l,this.options),this.stylesheet.terrain=l;const O=this._getTransitionParameters({duration:0});w.updateTransitions(O),this.fire(new d.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const h=this.fog=new Wo(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!d.d(h.get(),l)){h.set(l,this.options),this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createFog(l);this._markersNeedUpdate=!0}setColorTheme(l){this._checkLoaded();const h=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()};if(this._styleColorTheme.colorTheme=l,!l)return this._styleColorTheme.lut=null,void h();const y=this._evaluateColorThemeData(l);this._loadColorTheme(y).then(()=>{this.fire(new d.g("colorthemeset")),h()}).catch(b=>{d.w(`Couldn't set color theme: ${b}`)})}_getTransitionParameters(l){return{now:d.e.now(),transition:d.Q(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],h=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?l.push(y):h.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...h)}_createTerrain(l,h){const y=this.terrain=new Gn(l,h,this.scope,this.options);1===h&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const l in this._layers){const h=this._layers[l];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const h=this._layers[l];"symbol"===h.type&&this._updateLayer(h)}}_validate(l,h,y,b,w={}){if(w&&!1===w.validate)return!1;const E=d.Q({},this.serialize());return Cs(this,l.call(H,d.Q({key:h,style:E,value:y,styleSpec:d.N},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const h=this.getSourceCaches(l);for(const y of h)y.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const h=this.getSourceCaches(l);for(const y of h)y.resume(),y.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let h;this.directionalLight&&(h=Oh(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(l,void 0,void 0,h)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const h=this._sourceCaches[l];h.resume(),h.reload()}}_updatePlacement(l,h,y,b,w,E,M=!1){let O=!1,R=!1;const k={},B={};for(const U of this._mergedOrder){const j=this._mergedLayers[U];if("symbol"!==j.type)continue;const Z=d.am(j.source,j.scope);let Y=k[Z];if(!Y){const W=this.getLayerSourceCache(j);if(!W)continue;const K=W.getRenderableIds(!0).map(te=>W.getTileByID(te));B[Z]=K.slice(),Y=k[Z]=K.sort((te,se)=>se.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(se.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(j,Y,h.center.lng,h.projection);O=O||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||0===b,this._layerOrderChanged&&this.fire(new d.g("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.e.now(),h.zoom))&&(this.pauseablePlacement=new D1(h,this._mergedOrder,M,y,b,w,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.e.now()),R=!0),O&&this.pauseablePlacement.placement.setStale()),R||O){this._buildingIndex.onNewFrame(h.zoom);for(let U=0;U<this._mergedOrder.length;U++){const j=this._mergedLayers[this._mergedOrder[U]];if("symbol"!==j.type)continue;const Z=this.isLayerClipped(j)&&this._clipLayerIndices.some(Y=>U<Y);this.placement.updateLayerOpacities(j,k[d.am(j.source,j.scope)],U,Z?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.e.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,h){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==y.findIndex(({id:w})=>w===l.id))return void this.fire(new d.f(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!h)return y.push(l),this._loadImports([l],!0);const b=y.findIndex(({id:w})=>w===h);return-1===b&&this.fire(new d.f(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,b).concat(l).concat(y.slice(b)),this._loadImports([l],!0,h)}updateImport(l,h){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);return-1===b?this:"string"==typeof h?(this.setImportUrl(l,h),this):(h.url&&h.url!==y[b].url&&this.setImportUrl(l,h.url),d.d(h.config,y[b].config)||this.setImportConfig(l,h.config),d.d(h.data,y[b].data)||this.setImportData(l,h.data),this)}moveImport(l,h){this._checkLoaded();let y=this.stylesheet.imports||[];const b=this.getImportIndex(l);if(-1===b)return this;const w=this.getImportIndex(h);if(-1===w)return this;const E=y[b],M=this.fragments[b];return y=y.filter(({id:O})=>O!==l),this.fragments=this.fragments.filter(({id:O})=>O!==l),this.stylesheet.imports=y.slice(0,w).concat(E).concat(y.slice(w)),this.fragments=this.fragments.slice(0,w).concat(M).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(l,h){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);if(-1===b)return this;y[b].url=h;const w=this.fragments[b];return w.style=this._createFragmentStyle(y[b]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(h),this}setImportData(l,h){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];return-1===y?this:h?(this.fragments[y].style.setState(h),this._reloadImports(),this):(delete b[y].data,this.setImportUrl(l,b[y].url))}setImportConfig(l,h){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];if(-1===y)return this;h?b[y].config=h:delete b[y].config;const w=this.fragments[y],E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=h,w.style.updateConfig(h,E),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const h=this.stylesheet.imports||[],y=this.getImportIndex(l);-1!==y&&(h.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(l){const h=(this.stylesheet.imports||[]).findIndex(y=>y.id===l);return-1===h&&this.fire(new d.f(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),h}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const h in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[h];y&&l.push(y.getSource())}return l}getSource(l,h){const y=this.getSourceCache(l,h);return y&&y.getSource()}getLayerSource(l){const h=this.getLayerSourceCache(l);return h&&h.getSource()}getSourceCache(l,h){const y=d.am(l,h);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(l){const h=d.am(l.source,l.scope);return"symbol"===l.type?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(l){if(null==l)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[l]&&h.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&h.push(this._mergedSymbolSourceCaches[l]),h}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const h in l){const y=l[h];"reload"===y?this.reloadSource(h):"clear"===y&&this.clearSource(h)}}updateLayers(l){const h=this._changes.getUpdatedPaintProperties();for(const y of h){const b=this.getLayer(y);b&&b.updateTransitions(l)}}getImages(l,h,y){this.imageManager.getImages(h.icons,h.scope,y),this._updateTilesForChangedImages();const b=w=>{w&&w.setDependencies(h.tileID.key,h.type,h.icons)};b(this._otherSourceCaches[h.source]),b(this._symbolSourceCaches[h.source])}getGlyphs(l,h,y){this.glyphManager.getGlyphs(h.stacks,h.scope,y)}getResource(l,h,y){return d.d2(h,y)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const h=[];return this._otherSourceCaches[l]&&h.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&h.push(this._symbolSourceCaches[l]),h}_isSourceCacheLoaded(l){const h=this.getOwnSourceCaches(l);return 0===h.length?(this.fire(new d.f(new Error(`There is no source with ID '${l}'`))),!1):h.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,h){if(0===this._clipLayerIndices.length&&"fill-extrusion"!==l.type)return!1;const y="fill-extrusion"===l.type&&"building"===l.sourceLayer;let b=0;if(l.is3D()){if(y||h&&"batched-model"===h.type)return!0;"model"===l.type&&(b=d.cw.Model)}else"symbol"===l.type&&(b=d.cw.Symbol);for(const w of this._clipLayerIndices){const E=this._mergedLayers[this._mergedOrder[w]];if(!E)continue;const M=[];for(const O of E.layout.get("clip-layer-types"))M.push("model"===O?d.cw.Model:"symbol"===O?d.cw.Symbol:d.cw.FillExtrusion);for(const O of M)if(b&O)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Hh(g,l){let h=!1,y=null;const b=()=>{y=null,h&&(g(),y=setTimeout(b,l),h=!1)};return()=>(h=!0,y||b(),y)}Ko.getSourceType=function(g){return sp[g]},Ko.setSourceType=function(g,l){sp[g]=l},Ko.registerForPluginStateChange=d.cO;class qh{constructor(l){this._hashName=l&&encodeURIComponent(l),d.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Hh(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const h=Bs(l);if(this._hashName){const y=this._hashName;let b=!1;const w=location.hash.slice(1).split("&").map(E=>{const M=E.split("=")[0];return M===y?(b=!0,`${M}=${h}`):E}).filter(E=>E);return b||w.push(`${y}=${h}`),`#${w.join("&")}`}return`#${h}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let h;return l.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(h=y)}),(h&&h[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(h[3]||0):l.getBearing();return l.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Bs(g,l){const h=g.getCenter(),y=Math.round(100*g.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,b),E=Math.round(h.lng*w)/w,M=Math.round(h.lat*w)/w,O=g.getBearing(),R=g.getPitch();let k=l?`/${E}/${M}/${y}`:`${y}/${M}/${E}`;return(O||R)&&(k+="/"+Math.round(10*O)/10),R&&(k+=`/${Math.round(R)}`),k}const zs={linearity:.3,easing:d.d3(0,0,.3,1)},S1=d.Q({deceleration:2500,maxSpeed:1400},zs),cg=d.Q({deceleration:20,maxSpeed:1400},zs),Oy=d.Q({deceleration:1e3,maxSpeed:360},zs),Py=d.Q({deceleration:1e3,maxSpeed:90},zs);class Cd{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.e.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=d.e.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(h.pan.mag()){const w=sc(h.pan.mag(),y,d.Q({},S1,l||{}));b.offset=h.pan.mult(w.amount/h.pan.mag()),b.center=this._map.transform.center,Wh(b,w)}if(h.zoom){const w=sc(h.zoom,y,cg);b.zoom=this._map.transform.zoom+w.amount,Wh(b,w)}if(h.bearing){const w=sc(h.bearing,y,Oy);b.bearing=this._map.transform.bearing+d.au(w.amount,-179,179),Wh(b,w)}if(h.pitch){const w=sc(h.pitch,y,Py);b.pitch=this._map.transform.pitch+w.amount,Wh(b,w)}if(b.zoom||b.bearing){const w=void 0===h.pinchAround?h.around:h.pinchAround;b.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Wh(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function sc(g,l,h){const{maxSpeed:y,linearity:b,deceleration:w}=h,E=d.au(g*b/(l/1e3),-y,y),M=Math.abs(E)/(w*b);return{easing:h.easing,duration:1e3*M,amount:E*(M/2)}}class Vs extends d.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y,b={}){const w=Di(h.getCanvasContainer(),y),E=h.unproject(w);super(l,d.Q({point:w,lngLat:E,originalEvent:y},b)),this._defaultPrevented=!1,this.target=h}}class du extends d.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){const b="touchend"===l?y.changedTouches:y.touches,w=Mi(h.getCanvasContainer(),b),E=w.map(O=>h.unproject(O)),M=w.reduce((O,R,k,B)=>O.add(R.div(B.length)),new d.P(0,0));super(l,{points:w,point:M,lngLats:E,lngLat:h.unproject(M),originalEvent:y}),this._defaultPrevented=!1}}class ug extends d.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class gp{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new ug(this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new Vs(l.type,this._map,l))}mouseup(l){this._map.fire(new Vs(l.type,this._map,l))}preclick(l){const h=d.Q({},l);h.type="preclick",this._map.fire(new Vs(h.type,this._map,h))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(l),this._map.fire(new Vs(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new Vs(l.type,this._map,l))}mouseover(l){this._map.fire(new Vs(l.type,this._map,l))}mouseout(l){this._map.fire(new Vs(l.type,this._map,l))}touchstart(l){return this._firePreventable(new du(l.type,this._map,l))}touchmove(l){this._map.fire(new du(l.type,this._map,l))}touchend(l){this._map.fire(new du(l.type,this._map,l))}touchcancel(l){this._map.fire(new du(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Us{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new Vs(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Vs(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hu{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&0===l.button&&(ya(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const y=h,b=this._startPos,w=this._lastPos;if(!b||!w||w.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=ti("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const E=Math.min(b.x,y.x),M=Math.max(b.x,y.x),O=Math.min(b.y,y.y),R=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${O}px)`,this._box.style.width=M-E+"px",this._box.style.height=R-O+"px")})}mouseupWindow(l,h){if(!this._active)return;const y=this._startPos,b=h;if(y&&0===l.button){if(this.reset(),us(),y.x!==b.x||y.y!==b.y)return this._map.fire(new d.g("boxzoomend",{originalEvent:l})),{cameraAnimation:w=>w.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Gl(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new d.g(l,{originalEvent:h}))}}function Td(g,l){const h={};for(let y=0;y<g.length;y++)h[g[y].identifier]=l[y];return h}class Ry{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const w=new d.P(0,0);for(const E of b)w._add(E);return w.div(b.length)}(h),this.touches=Td(y,h)))}touchmove(l,h,y){if(this.aborted||!this.centroid)return;const b=Td(y,h);for(const w in this.touches){const E=b[w];(!E||E.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(l,h,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===y.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class ac{constructor(l){this.singleTap=new Ry(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,h,y){this.singleTap.touchstart(l,h,y)}touchmove(l,h,y){this.singleTap.touchmove(l,h,y)}touchend(l,h,y){const b=this.singleTap.touchend(l,h,y);if(b){const w=l.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(w&&E||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Zh{constructor(){this._zoomIn=new ac({numTouches:1,numTaps:2}),this._zoomOut=new ac({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,y){this._zoomIn.touchstart(l,h,y),this._zoomOut.touchstart(l,h,y)}touchmove(l,h,y){this._zoomIn.touchmove(l,h,y),this._zoomOut.touchmove(l,h,y)}touchend(l,h,y){const b=this._zoomIn.touchend(l,h,y),w=this._zoomOut.touchend(l,h,y);return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(b)},{originalEvent:l})}):w?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(w)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _p={0:1,2:2};class Ed{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,h){return!1}_move(l,h){return{}}mousedown(l,h){if(this._lastPoint)return;const y=ao(l);this._correctButton(l,y)&&(this._lastPoint=h,this._eventButton=y)}mousemoveWindow(l,h){const y=this._lastPoint;if(y)if(l.preventDefault(),null!=this._eventButton&&function(b,w){const E=_p[w];return void 0===b.buttons||(b.buttons&E)!==E}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(y,h)}mouseupWindow(l){this._lastPoint&&ao(l)===this._eventButton&&(this._moved&&us(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yh extends Ed{mousedown(l,h){super.mousedown(l,h),this._lastPoint&&(this._active=!0)}_correctButton(l,h){return 0===h&&!l.ctrlKey}_move(l,h){return{around:h,panDelta:h.sub(l)}}}class Xh extends Ed{_correctButton(l,h){return 0===h&&l.ctrlKey||2===h}_move(l,h){const y=.8*(h.x-l.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(l){l.preventDefault()}}class yp extends Ed{_correctButton(l,h){return 0===h&&l.ctrlKey||2===h}_move(l,h){const y=-.5*(h.y-l.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(l){l.preventDefault()}}class Ti{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),d.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}touchstart(l,h,y){return this._calculateTransform(l,h,y)}touchmove(l,h,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===y.length&&!d.d4())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,h,y)}}touchend(l,h,y){this._calculateTransform(l,h,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,y){y.length>0&&(this._active=!0);const b=Td(y,h),w=new d.P(0,0),E=new d.P(0,0);let M=0;for(const R in b){const k=b[R],B=this._touches[R];B&&(w._add(k),E._add(k.sub(B)),M++,b[R]=k)}if(this._touches=b,M<this._minTouches||!E.mag())return;const O=E.div(M);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(M),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ti("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Kh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,h,y){return{}}touchstart(l,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,y){const b=this._firstTwoTouches;if(!b)return;l.preventDefault();const[w,E]=b,M=fu(y,h,w),O=fu(y,h,E);if(!M||!O)return;const R=this._aroundCenter?null:M.add(O).div(2);return this._move([M,O],R,l)}touchend(l,h,y){if(!this._firstTwoTouches)return;const[b,w]=this._firstTwoTouches,E=fu(y,h,b),M=fu(y,h,w);E&&M||(this._active&&us(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fu(g,l,h){for(let y=0;y<g.length;y++)if(g[y].identifier===h)return l[y]}function bi(g,l){return Math.log(g/l)/Math.LN2}class dg extends Kh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(bi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bi(this._distance,y),pinchAround:h}}}function Lt(g,l){return 180*g.angleWith(l)/Math.PI}class Jo extends Kh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h){const y=this._vector;if(this._vector=l[0].sub(l[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Lt(this._vector,y),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=Lt(l,y);return Math.abs(b)<h}}function qn(g){return Math.abs(g.y)>Math.abs(g.x)}class jr extends Kh{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,qn(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,y){const b=this._lastPoints;if(!b)return;const w=l[0].sub(b[0]),E=l[1].sub(b[1]);return this._map._cooperativeGestures&&!d.d4()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(w,E,y.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(w.y+E.y)/2*-.5})}gestureBeginsVertically(l,h,y){if(void 0!==this._valid)return this._valid;const b=l.mag()>=2,w=h.mag()>=2;if(!b&&!w)return;if(!b||!w)return null==this._firstMove&&(this._firstMove=y),y-this._firstMove<100&&void 0;const E=l.y>0==h.y>0;return qn(l)&&qn(h)&&E}}const po={panStep:100,bearingStep:15,pitchStep:10};class lc{constructor(){const l=po;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,y=0,b=0,w=0,E=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),E=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:M=>{const O=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Po,zoom:h?Math.round(O)+h*(l.shiftKey?2:1):O,bearing:M.getBearing()+y*this._bearingStep,pitch:M.getPitch()+b*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:M.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Po(g){return g*(2-g)}const Jh=4.000244140625,vp=1/450;class Dd{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=vp,d.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||d.d4()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=d.e.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,0!==h&&h%Jh==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Di(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;"wheel"===this._type&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Jh?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==k&&(k=1/k);const B=h(),U=Math.pow(2,B),j="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(j*k))),"wheel"===this._type&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y="number"==typeof this._targetZoom?this._targetZoom:h(),b=this._startZoom,w=this._easing;let E,M=!1;if("wheel"===this._type&&b&&w){const R=Math.min((d.e.now()-this._lastWheelEventTime)/200,1),k=w(R);E=d.a3(b,y,k),R<1?this._frameId||(this._frameId=!0):M=!0}else E=y,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=E-h();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=d.d5;if(this._prevEase){const y=this._prevEase,b=(d.e.now()-y.start)/y.duration,w=y.easing(b+.01)-y.easing(b),E=.27/Math.sqrt(w*w+1e-4)*.01,M=Math.sqrt(.0729-E*E);h=d.d3(E,M,.25,1)}return this._prevEase={start:d.e.now(),duration:l,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ti("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class hg{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ny{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,h){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(l.shiftKey?-1:1),around:y.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sd{constructor(){this._tap=new ac({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,h,y){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=h[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(l,h,y))}touchmove(l,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=h[0],w=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(l,h,y)}touchend(l,h,y){this._tapTime?this._swipePoint&&0===y.length&&this.reset():this._tap.touchend(l,h,y)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class M1{constructor(l,h,y){this._el=l,this._mousePan=h,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pu{constructor(l,h,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Md{constructor(l,h,y,b){this._el=l,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const cc=g=>g.zoom||g.drag||g.pitch||g.rotate;class la extends d.g{}class Qh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,h){const y=d.$.sub([],h,l);this.radius=d.$.length(y[2]<0?d.$.div([],y,this.constants):[y[0],y[1],0])}projectRay(l){d.$.div(l,l,this.constants),d.$.normalize(l,l),d.$.mul(l,l,this.constants);const h=d.$.scale([],l,this.radius);if(h[2]>0){const y=d.$.scale([],[0,0,1],d.$.dot(h,[0,0,1])),b=d.$.scale([],d.$.normalize([],[h[0],h[1],0]),this.radius),w=d.$.add([],h,d.$.scale([],d.$.sub([],d.$.add([],b,y),h),2));h[0]=w[0],h[1]=w[1]}return h}}function mu(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Id{constructor(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cd(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Qh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),d.br(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,w,E]of this._listeners){const M=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(w,M,E)}}destroy(){for(const[l,h,y]of this._listeners){const b=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(h,b,y)}}_addDefaultHandlers(l){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new gp(h,l));const b=h.boxZoom=new hu(h,l);this._add("boxZoom",b);const w=new Zh,E=new Ny;h.doubleClickZoom=new hg(E,w),this._add("tapZoom",w),this._add("clickZoom",E);const M=new Sd;this._add("tapDragZoom",M);const O=h.touchPitch=new jr(h);this._add("touchPitch",O);const R=new Xh(l),k=new yp(l);h.dragRotate=new pu(l,R,k),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const B=new Yh(l),U=new Ti(h,l);h.dragPan=new M1(y,B,U),this._add("mousePan",B),this._add("touchPan",U,["touchZoom","touchRotate"]);const j=new Jo,Z=new dg;h.touchZoomRotate=new Md(y,Z,j,M),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Us(h));const Y=h.scrollZoom=new Dd(h,this);this._add("scrollZoom",Y,["mousePan"]);const X=h.keyboard=new lc;this._add("keyboard",X);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[W]&&h[W].enable(l[W])}_add(l,h,y){this._handlers.push({handlerName:l,handler:h,allowed:y}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,h,y){for(const b in l)if(b!==y&&(!h||h.indexOf(b)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const h=[];for(const y of l)this._el.contains(y.target)&&h.push(y);return h}handleEvent(l,h){this._updatingCamera=!0;const y="renderFrame"===l.type,b=y?void 0:l,w={needsRenderFrame:!1},E={},M={},O=l.touches?this._getMapTouches(l.touches):void 0,R=O?Mi(this._el,O):y?void 0:Di(this._el,l);for(const{handlerName:U,handler:j,allowed:Z}of this._handlers){if(!j.isEnabled())continue;let Y;this._blockedByActive(M,Z,U)?j.reset():j[h||l.type]&&(Y=j[h||l.type](l,R,O),this.mergeHandlerResult(w,E,Y,U,b),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||j.isActive())&&(M[U]=j)}const k={};for(const U in this._previousActiveHandlers)M[U]||(k[U]=b);this._previousActiveHandlers=M,(Object.keys(k).length||mu(w))&&(this._changes.push([w,E,k]),this._triggerRenderFrame()),(Object.keys(M).length||mu(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=w;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(l,h,y,b,w){if(!y)return;d.Q(l,y);const E={handlerName:b,originalEvent:y.originalEvent||w};void 0!==y.zoomDelta&&(h.zoom=E),void 0!==y.panDelta&&(h.drag=E),void 0!==y.pitchDelta&&(h.pitch=E),void 0!==y.bearingDelta&&(h.rotate=E)}_applyChanges(){const l={},h={},y={};for(const[b,w,E]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new d.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(l.around=b.around),void 0!==b.aroundCoord&&(l.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),d.Q(h,w),d.Q(y,E);this._updateMapTransform(l,h,y),this._changes=[]}_updateMapTransform(l,h,y){const b=this._map,w=b.transform,E=K=>[K.x,K.y,K.z];if((K=>{const te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!mu(l)){const K=w.zoom;w.cameraElevationReference="sea",null!=this._originalZoom&&w._orthographicProjectionAtLowPitch&&"globe"!==w.projection.name&&0===w.pitch?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),K!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&b._stop(!0),!mu(l))return void this._fireEvents(h,y,!0);let{panDelta:M,zoomDelta:O,bearingDelta:R,pitchDelta:k,around:B,aroundCoord:U,pinchAround:j}=l;w._isCameraConstrained&&(O>0&&(O=0),w._isCameraConstrained=!1),void 0!==j&&(B=j),(O||(K=>h[K]&&!this._eventsInProgress[K])("drag"))&&B&&(this._dragOrigin=E(w.pointCoordinate3D(B)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",b._stop(!0),B=B||b.transform.centerPoint,R&&(w.bearing+=R),k&&(w.pitch+=k),w._updateCameraState();const Z=[0,0,0];if(M)if("mercator"===w.projection.name){const K=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B).dir),te=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B.sub(M)).dir);Z[0]=te[0]-K[0],Z[1]=te[1]-K[1]}else{const K=w.pointCoordinate(B);if("globe"===w.projection.name){M=M.rotate(-w.angle);const te=w._pixelsPerMercatorPixel/w.worldSize;Z[0]=-M.x*d.d6(d.az(K.y))*te,Z[1]=-M.y*d.d6(w.center.lat)*te}else{const te=w.pointCoordinate(B.sub(M));K&&te&&(Z[0]=te.x-K.x,Z[1]=te.y-K.y)}}const Y=w.zoom,X=[0,0,0];if(O){const K=E(U||w.pointCoordinate3D(B)),te={dir:d.$.normalize([],d.$.sub([],K,w._camera.position))};if(te.dir[2]<0){const se=w.zoomDeltaToMovement(K,O);d.$.scale(X,te.dir,se)}}const W=d.$.add(Z,Z,X);w._translateCameraConstrained(W),O&&Math.abs(w.zoom-Y)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,y,!0)}_fireEvents(l,h,y){const b=cc(this._eventsInProgress),w=cc(l),E={};for(const k in l){const{originalEvent:B}=l[k];this._eventsInProgress[k]||(E[`${k}start`]=B),this._eventsInProgress[k]=l[k]}!b&&w&&this._fireEvent("movestart",w.originalEvent);for(const k in E)this._fireEvent(k,E[k]);w&&this._fireEvent("move",w.originalEvent);for(const k in l){const{originalEvent:B}=l[k];this._fireEvent(k,B)}const M={};let O;for(const k in this._eventsInProgress){const{handlerName:B,originalEvent:U}=this._eventsInProgress[k];this._handlersById[B].isActive()||(delete this._eventsInProgress[k],O=h[B]||U,M[`${k}end`]=O)}for(const k in M)this._fireEvent(k,M[k]);const R=cc(this._eventsInProgress);if(y&&(b||w)&&!R){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=U=>0!==U&&-this._bearingSnap<U&&U<this._bearingSnap;k?(B(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:O})):(this._map.fire(new d.g("moveend",{originalEvent:O})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new d.g(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new la("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ef="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class bp extends d.E{constructor(l,h){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=!1!==h.respectPrefersReducedMotion,d.br(["_renderFrameCallback"],this)}getCenter(){return new d.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}panBy(l,h,y){return l=d.P.convert(l).mult(-1),this.panTo(this.transform.center,d.Q({offset:l},h),y)}panTo(l,h,y){return this.easeTo(d.Q({center:l},h),y)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,y){return this.easeTo(d.Q({zoom:l},h),y)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,y){return this.easeTo(d.Q({bearing:l},h),y)}resetNorth(l,h){return this.rotateTo(0,d.Q({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(d.Q({bearing:0,pitch:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}cameraForBounds(l,h){l=d.aj.convert(l);const y=h&&h.bearing||0,b=h&&h.pitch||0,w=l.getNorthWest(),E=l.getSouthEast();return this._cameraForBounds(this.transform,w,E,y,b,h)}_extendPadding(l){const h={top:0,right:0,bottom:0,left:0};return null==l?d.Q({},h,this.transform.padding):"number"==typeof l?{top:l,bottom:l,right:l,left:l}:d.Q({},h,l)}_extendCameraOptions(l){return(l=d.Q({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,h){const y=h.max[0]-h.min[0],b=h.max[1]-h.min[1];return y/b>l.aspect?y/(2*Math.tan(.5*l.fovX)*l.aspect):b/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,h,y,b,w,E){const M=l.clone(),O=this._extendCameraOptions(E);M.bearing=b,M.pitch=w;const R=d.aJ.convert(h),k=d.aJ.convert(y),B=.5*(R.lat+k.lat),U=.5*(R.lng+k.lng),j=d.d7(B,U),Z=d.$.normalize([],j),Y=d.$.normalize([],d.$.cross([],Z,[0,1,0])),X=d.$.cross([],Y,Z),W=[Y[0],Y[1],Y[2],0,X[0],X[1],X[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],K=[j,d.d7(R.lat,R.lng),d.d7(k.lat,R.lng),d.d7(k.lat,k.lng),d.d7(R.lat,k.lng),d.d7(B,R.lng),d.d7(B,k.lng),d.d7(R.lat,U),d.d7(k.lat,U)];let te=d.b8.fromPoints(K.map(Te=>[d.$.dot(Y,Te),d.$.dot(X,Te),d.$.dot(Z,Te)]));const se=d.$.transformMat4([],te.center,W);0===d.$.squaredLength(se)&&d.$.set(se,0,0,1),d.$.normalize(se,se),d.$.scale(se,se,d.cF),M.center=d.d8(se);const he=M.getWorldToCameraMatrix(),ce=d.ae.invert(new Float64Array(16),he);te=d.b8.applyTransform(te,d.ae.multiply([],he,W));const ue=this._extendAABB(te,M,O,b);if(!ue)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=ue,d.$.transformMat4(se,se,he);const ye=.5*(te.max[2]-te.min[2]),pe=this._minimumAABBFrustumDistance(M,te),Se=d.$.scale([],[0,0,1],ye),xe=d.$.add(Se,se,Se),ae=pe+(0===M.pitch?0:d.$.distance(se,xe)),Fe=M.globeCenterInViewSpace,ke=d.$.sub([],se,[Fe[0],Fe[1],Fe[2]]);d.$.normalize(ke,ke),d.$.scale(ke,ke,ae);const Ee=d.$.add([],se,ke);d.$.transformMat4(Ee,Ee,ce);const We=d.da/d.cF,Ye=d.$.length(Ee),Oe=d.ay(Math.max(Ye*We-d.da,Number.EPSILON),0),ze=Math.min(M.zoomFromMercatorZAdjusted(Oe),O.maxZoom);return ze>.5*(d.b3+d.aV)?(M.setProjection({name:"mercator"}),M.zoom=ze,this._cameraForBounds(M,h,y,b,w,E)):{center:M.center,zoom:ze,bearing:b,pitch:w}}_extendAABB(l,h,y,b){const w=.5*((y.padding.left||0)+(y.padding.right||0)),E=.5*((y.padding.top||0)+(y.padding.bottom||0)),M=E,O=w,R=w,k=E,B=h.width-(O+R),U=h.height-(M+k),j=d.$.sub([],l.max,l.min),Z=Math.min(B/j[0],U/j[1]),Y=Math.min(h.scaleZoom(h.scale*Z),y.maxZoom);if(isNaN(Y))return null;const X=h.scale/h.zoomScale(Y),W=new d.b8([l.min[0]-O*X,l.min[1]-k*X,l.min[2]],[l.max[0]+R*X,l.max[1]+M*X,l.max[2]]),K=("number"==typeof y.offset.x&&"number"==typeof y.offset.y?new d.P(y.offset.x,y.offset.y):d.P.convert(y.offset)).rotate(-d.ac(b));return W.center[0]-=K.x*X,W.center[1]+=K.y*X,W}queryTerrainElevation(l,h){const y=this.transform.elevation;return y?(h=d.Q({},{exaggerated:!0},h),y.getAtPoint(d._.fromLngLat(l),null,h.exaggerated)):null}_cameraForBounds(l,h,y,b,w,E){if("globe"===l.projection.name)return this._cameraForBoundsOnGlobe(l,h,y,b,w,E);const M=l.clone(),O=this._extendCameraOptions(E);M.bearing=b,M.pitch=w;const R=d.aJ.convert(h),k=d.aJ.convert(y),B=new d.aJ(R.lng,k.lat),U=new d.aJ(k.lng,R.lat),j=M.project(R),Z=M.project(k),Y=this.queryTerrainElevation(R),X=this.queryTerrainElevation(k),W=this.queryTerrainElevation(B),K=this.queryTerrainElevation(U),te=[[j.x,j.y,Math.min(Y||0,X||0,W||0,K||0)],[Z.x,Z.y,Math.max(Y||0,X||0,W||0,K||0)]];let se=d.b8.fromPoints(te);const he=M.getWorldToCameraMatrix(),ce=d.ae.invert(new Float64Array(16),he);se=d.b8.applyTransform(se,he);const ue=this._extendAABB(se,M,O,b);if(!ue)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");se=ue;const ye=.5*d.$.sub([],se.max,se.min)[2],pe=this._minimumAABBFrustumDistance(M,se),Se=[0,0,1,0];d.aB.transformMat4(Se,Se,he),d.aB.normalize(Se,Se);const xe=d.$.scale([],Se,pe+ye),ae=d.$.add([],se.center,xe);d.$.transformMat4(se.center,se.center,ce),d.$.transformMat4(ae,ae,ce);const Fe=[se.center[0],se.center[1],ae[2]*M.pixelsPerMeter];d.$.scale(Fe,Fe,1/M.worldSize);const ke=d.d9(Fe[0]),Ee=d.az(Fe[1]),We=Math.min(M._zoomFromMercatorZ(Fe[2]),O.maxZoom),Ye=new d.aJ(ke,Ee);return M.mercatorFromTransition&&We<.5*(d.b3+d.aV)?(M.setProjection({name:"globe"}),M.zoom=We,this._cameraForBounds(M,h,y,b,w,E)):{center:Ye,zoom:We,bearing:b,pitch:w}}fitBounds(l,h,y){const b=this.cameraForBounds(l,h);return this._fitInternal(b,h,y)}fitScreenCoordinates(l,h,y,b,w){const E=d.P.convert(l),M=d.P.convert(h),O=new d.P(Math.min(E.x,M.x),Math.min(E.y,M.y)),R=new d.P(Math.max(E.x,M.x),Math.max(E.y,M.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(E,M))return this;const k=this.transform.pointLocation3D(O),B=this.transform.pointLocation3D(R),U=this.transform.pointLocation3D(new d.P(O.x,R.y)),j=this.transform.pointLocation3D(new d.P(R.x,O.y)),Z=[Math.min(k.lng,B.lng,U.lng,j.lng),Math.min(k.lat,B.lat,U.lat,j.lat)],Y=[Math.max(k.lng,B.lng,U.lng,j.lng),Math.max(k.lat,B.lat,U.lat,j.lat)],X=b&&b.pitch?b.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,Z,Y,y,X,b);return this._fitInternal(W,b,w)}_fitInternal(l,h,y){return l?(h=d.Q(l,h)).linear?this.easeTo(h,y):this.flyTo(h,y):this}jumpTo(l,h){this.stop();const y=l.preloadOnly?this.transform.clone():this.transform;let b=!1,w=!1,E=!1;if("zoom"in l&&y.zoom!==+l.zoom&&(b=!0,y.zoom=+l.zoom),void 0!==l.center&&(y.center=d.aJ.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(w=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(E=!0,y.pitch=+l.pitch),null!=l.padding){const M="number"==typeof l.padding?this._extendPadding(l.padding):l.padding;y.isPaddingEqual(M)||(y.padding=M)}return l.preloadOnly?(this._preloadTiles(y),this):(this.fire(new d.g("movestart",h)).fire(new d.g("move",h)),b&&this.fire(new d.g("zoomstart",h)).fire(new d.g("zoom",h)).fire(new d.g("zoomend",h)),w&&this.fire(new d.g("rotatestart",h)).fire(new d.g("rotate",h)).fire(new d.g("rotateend",h)),E&&this.fire(new d.g("pitchstart",h)).fire(new d.g("pitch",h)).fire(new d.g("pitchend",h)),this.fire(new d.g("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.w(ef),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,h){const y=this.transform;if(!y.projection.supportsFreeCamera)return d.w(ef),this;this.stop();const b=y.zoom,w=y.pitch,E=y.bearing;y.setFreeCameraOptions(l);const M=b!==y.zoom,O=w!==y.pitch,R=E!==y.bearing;return this.fire(new d.g("movestart",h)).fire(new d.g("move",h)),M&&this.fire(new d.g("zoomstart",h)).fire(new d.g("zoom",h)).fire(new d.g("zoomend",h)),R&&this.fire(new d.g("rotatestart",h)).fire(new d.g("rotate",h)).fire(new d.g("rotateend",h)),O&&this.fire(new d.g("pitchstart",h)).fire(new d.g("pitch",h)).fire(new d.g("pitchend",h)),this.fire(new d.g("moveend",h)),this}easeTo(l,h){this._stop(!1,l.easeId),(!1===(l=d.Q({offset:[0,0],duration:500,easing:d.d5},l)).animate||this._prefersReducedMotion(l))&&(l.duration=0);const y=this.transform,b=this.getZoom(),w=this.getBearing(),E=this.getPitch(),M=this.getPadding(),O="zoom"in l?+l.zoom:b,R="bearing"in l?this._normalizeBearing(l.bearing,w):w,k="pitch"in l?+l.pitch:E,B=this._extendPadding(l.padding),U=d.P.convert(l.offset);let j,Z,Y;if("globe"===y.projection.name){const pe=d._.fromLngLat(y.center),Se=U.rotate(-y.angle);pe.x+=Se.x/y.worldSize,pe.y+=Se.y/y.worldSize;const xe=pe.toLngLat(),ae=d.aJ.convert(l.center||xe);this._normalizeCenter(ae),j=y.centerPoint.add(Se),Z=new d.P(pe.x,pe.y).mult(y.worldSize),Y=new d.P(d.ak(ae.lng),d.al(ae.lat)).mult(y.worldSize).sub(Z)}else{j=y.centerPoint.add(U);const pe=y.pointLocation(j),Se=d.aJ.convert(l.center||pe);this._normalizeCenter(Se),Z=y.project(pe),Y=y.project(Se).sub(Z)}const X=y.zoomScale(O-b);let W,K;l.around&&(W=d.aJ.convert(l.around),K=y.locationPoint(W));const te=this._zooming||O!==b,se=this._rotating||w!==R,he=this._pitching||k!==E,ce=!y.isPaddingEqual(B),ue=pe=>Se=>{if(te&&(pe.zoom=d.a3(b,O,Se)),se&&(pe.bearing=d.a3(w,R,Se)),he&&(pe.pitch=d.a3(E,k,Se)),ce&&(pe.interpolatePadding(M,B,Se),j=pe.centerPoint.add(U)),W)pe.setLocationAtPoint(W,K);else{const xe=pe.zoomScale(pe.zoom-b),ae=O>b?Math.min(2,X):Math.max(.5,X),Fe=Math.pow(ae,1-Se),ke=pe.unproject(Z.add(Y.mult(Se*Fe)).mult(xe));pe.setLocationAtPoint(pe.renderWorldCopies?ke.wrap():ke,j)}return l.preloadOnly||this._fireMoveEvents(h),pe};if(l.preloadOnly){const pe=this._emulate(ue,l.duration,y);return this._preloadTiles(pe),this}const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=se,this._pitching=he,this._padding=ce,this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,ye),this._ease(ue(y),pe=>{"sea"===y.cameraElevationReference&&y.recenterOnTerrain(),this._afterEase(h,pe)},l),this}_prepareEase(l,h,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),h||y.moving||this.fire(new d.g("movestart",l)),this._zooming&&!y.zooming&&this.fire(new d.g("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new d.g("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new d.g("pitchstart",l))}_fireMoveEvents(l){this.fire(new d.g("move",l)),this._zooming&&this.fire(new d.g("zoom",l)),this._rotating&&this.fire(new d.g("rotate",l)),this._pitching&&this.fire(new d.g("pitch",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new d.g("zoomend",l)),b&&this.fire(new d.g("rotateend",l)),w&&this.fire(new d.g("pitchend",l)),this.fire(new d.g("moveend",l))}flyTo(l,h){if(this._prefersReducedMotion(l)){const ze=d.ai(l,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(ze,h)}this.stop(),l=d.Q({offset:[0,0],speed:1.2,curve:1.42,easing:d.d5},l);const y=this.transform,b=this.getZoom(),w=this.getBearing(),E=this.getPitch(),M=this.getPadding(),O="zoom"in l?d.au(+l.zoom,y.minZoom,y.maxZoom):b,R="bearing"in l?this._normalizeBearing(l.bearing,w):w,k="pitch"in l?+l.pitch:E,B=this._extendPadding(l.padding),U=y.zoomScale(O-b),j=d.P.convert(l.offset);let Z=y.centerPoint.add(j);const Y=y.pointLocation(Z),X=d.aJ.convert(l.center||Y);this._normalizeCenter(X);const W=y.project(Y),K=y.project(X).sub(W);let te=l.curve;const se=Math.max(y.width,y.height),he=se/U,ce=K.mag();if("minZoom"in l){const ze=d.au(Math.min(l.minZoom,b,O),y.minZoom,y.maxZoom),Te=se/y.zoomScale(ze-b);te=Math.sqrt(Te/ce*2)}const ue=te*te;function ye(ze){const Te=(he*he-se*se+(ze?-1:1)*ue*ue*ce*ce)/(2*(ze?he:se)*ue*ce);return Math.log(Math.sqrt(Te*Te+1)-Te)}function pe(ze){return(Math.exp(ze)-Math.exp(-ze))/2}function Se(ze){return(Math.exp(ze)+Math.exp(-ze))/2}const xe=ye(0);let ae=function(ze){return Se(xe)/Se(xe+te*ze)},Fe=function(ze){return se*((Se(xe)*(pe(Te=xe+te*ze)/Se(Te))-pe(xe))/ue)/ce;var Te},ke=(ye(1)-xe)/te;if(Math.abs(ce)<1e-6||!isFinite(ke)){if(Math.abs(se-he)<1e-6)return this.easeTo(l,h);const ze=he<se?-1:1;ke=Math.abs(Math.log(he/se))/te,Fe=function(){return 0},ae=function(Te){return Math.exp(ze*te*Te)}}l.duration="duration"in l?+l.duration:1e3*ke/("screenSpeed"in l?+l.screenSpeed/te:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Ee=w!==R,We=k!==E,Ye=!y.isPaddingEqual(B),Oe=ze=>Te=>{const Ke=Te*ke,Xe=1/ae(Ke);ze.zoom=1===Te?O:b+ze.scaleZoom(Xe),Ee&&(ze.bearing=d.a3(w,R,Te)),We&&(ze.pitch=d.a3(E,k,Te)),Ye&&(ze.interpolatePadding(M,B,Te),Z=ze.centerPoint.add(j));const bt=1===Te?X:ze.unproject(W.add(K.mult(Fe(Ke))).mult(Xe));return ze.setLocationAtPoint(ze.renderWorldCopies?bt.wrap():bt,Z),ze._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(h),ze};if(l.preloadOnly){const ze=this._emulate(Oe,l.duration,y);return this._preloadTiles(ze),this}return this._zooming=!0,this._rotating=Ee,this._pitching=We,this._padding=Ye,this._prepareEase(h,!1),this._ease(Oe(y),()=>this._afterEase(h),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,h)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,h,y){!1===y.animate||0===y.duration?(l(1),h()):(this._easeStart=d.e.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((d.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,h){l=d.av(l,-180,180);const y=Math.abs(l-h);return Math.abs(l-360-h)<y&&(l-=360),Math.abs(l+360-h)<y&&(l+=360),l}_normalizeCenter(l){const h=this.transform;if(h.maxBounds||"globe"!==h.projection.name&&!h.renderWorldCopies)return;const y=l.lng-h.center.lng;l.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&d.e.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,h,y){const b=Math.ceil(15*h/1e3),w=[],E=l(y.clone());for(let M=0;M<=b;M++){const O=E(M/b);w.push(O.clone())}return w}_preloadTiles(l,h){}}class Da{constructor(l={}){this.options=l,d.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const h=this.options&&this.options.compact,y=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=ti("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ti("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const b=ti("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",y),this._innerContainer=ti("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.db.ACCESS_TOKEN}];if(l){const y=h.reduce((b,w,E)=>(w.value&&(b+=`${w.key}=${w.value}${E<h.length-1?"&":""}`),b),"?");l.href=`${d.db.FEEDBACK_URL}/${y}#${Bs(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const h=this._map.style._mergedSourceCaches;for(const b in h){const w=h[b];if(w.used){const E=w.getSource();E.attribution&&l.indexOf(E.attribution)<0&&l.push(E.attribution)}}l.sort((b,w)=>b.length-w.length),l=l.filter((b,w)=>{for(let E=w+1;E<l.length;E++)if(l[E].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class xp{constructor(){d.br(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=ti("div","mapboxgl-ctrl");const h=ti("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const h in l){const y=l[h].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Ad{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const b of y)if(b.id===l)return void(b.cancelled=!0)}run(l=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function uc(g,l,h){if(g=new d.aJ(g.lng,g.lat),l){const y=new d.aJ(g.lng-360,g.lat),b=new d.aJ(g.lng+360,g.lat),w=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),E=h.locationPoint(g).distSqr(l),M=l.x<0||l.y<0||l.x>h.width||l.y>h.height;h.locationPoint(y).distSqr(l)<E&&(M||Math.abs(y.lng-h.center.lng)<w)?g=y:h.locationPoint(b).distSqr(l)<E&&(M||Math.abs(b.lng-h.center.lng)<w)&&(g=b)}for(;Math.abs(g.lng-h.center.lng)>180;){const y=h.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const wp={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Od extends d.E{constructor(l,h){if(super(),(l instanceof HTMLElement||h)&&(l=d.Q({element:l},h)),d.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=d.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=ti("div");const w=41,E=27,M=Or("svg",{display:"block",height:w*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${w}`},this._element),O=Or("radialGradient",{id:"shadowGradient"},Or("defs",{},M));Or("stop",{offset:"10%","stop-opacity":.4},O),Or("stop",{offset:"100%","stop-opacity":.05},O),Or("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Or("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Or("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Or("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=d.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const y=this._element.classList;for(const w in wp)y.remove(`mapboxgl-marker-anchor-${w}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=l&&l.className?l.className.trim().split(/\s+/):[];y.add(...b),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=d.aJ.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const h=l.code,y=l.charCode||l.keyCode;"Space"!==h&&"Enter"!==h&&32!==y&&13!==y||this.togglePopup()}_onMapClick(l){const h=l.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,h=this._pos;if(!l||!h)return!1;const y=l.unproject(h),b=l.getFreeCameraOptions();if(!b.position)return!1;const w=b.position.toLngLat();return w.distanceTo(y)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const h=this._pos;if(!h||h.x<0||h.x>l.transform.width||h.y<0||h.y>l.transform.height)return void this._clearFadeTimer();const y=l.unproject(h);let b;l._showingGlobe()&&d.dc(l.transform,this._lngLat)?b=0:(b=1-l._queryFogOpacity(y),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${l.x}px,${l.y}px)\n            ${wp[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const l=this._pos,h=this._map,y=this.getPitchAlignment();if(!h||!l||"map"!==y)return"";if(!h._showingGlobe()){const O=h.getPitch();return O?`rotateX(${O}deg)`:""}const b=d.b1(d.dd(h.transform,this._lngLat)),w=l.sub(d.de(h.transform)),E=Math.abs(w.x)+Math.abs(w.y);if(0===E)return"";const M=b/E;return`rotateX(${-w.y*M}deg) rotateY(${w.x*M}deg)`}_calculateZTransform(){const l=this._pos,h=this._map;if(!h||!l)return"";let y=0;const b=this.getRotationAlignment();if("map"===b)if(h._showingGlobe()){const w=h.project(new d.aJ(this._lngLat.lng,this._lngLat.lat+.001)),E=h.project(new d.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);y=d.b1(Math.atan2(E.y,E.x))-90}else y=-h.getBearing();else if("horizon"===b){const w=d.a0(4,6,h.getZoom()),E=d.de(h.transform);E.y+=w*h.transform.height;const M=l.sub(E),O=d.b1(Math.atan2(M.y,M.x));y=(O>90?O-270:O+90)*(1-w)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=uc(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===l?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=d.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const h=this._map;if(!h)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const w=this._clickTolerance||h._clickTolerance;if(l.point.dist(y)<w)return;this._isDragging=!0}this._pos=l.point.sub(b),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.g("dragstart"))),this.fire(new d.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.g("dragend")),this._state="inactive"}_addDragHandler(l){const h=this._map,y=this._pos;h&&y&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(y),this._pointerdownPos=l.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const h=this._map;return h&&(l?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Tl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},mo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gu(g=new d.P(0,0),l="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new d.P(0,g);case"top-left":return new d.P(h,h);case"top-right":return new d.P(-h,h);case"bottom":return new d.P(0,-g);case"bottom-left":return new d.P(h,-h);case"bottom-right":return new d.P(-h,-h);case"left":return new d.P(g,0);case"right":return new d.P(-g,0)}return new d.P(0,0)}return g instanceof d.P||Array.isArray(g)?d.P.convert(g):d.P.convert(g[l]||[0,0])}class fg{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const h=d.bb((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,h,y){this._start=this.getValue(h),this._end=l,this._startTime=h,this._endTime=h+y}}const I1={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class A1{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const ky={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},dc={showCompass:!0,showZoom:!0,visualizePitch:!1};class pg{constructor(l,h,y=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Xh({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,y&&(this.mousePitch=new yp({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),d.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),ya()}move(l,h){const y=this.map,b=this.mouseRotate.mousemoveWindow(l,h),w=b&&b.bearingDelta;if(w&&y.setBearing(y.getBearing()+w),this.mousePitch){const E=this.mousePitch.mousemoveWindow(l,h),M=E&&E.pitchDelta;M&&y.setPitch(y.getPitch()+M)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Gl(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(d.Q({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Di(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Di(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=Mi(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=Mi(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Fy={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Pd={maxWidth:100,unit:"metric"},Cp={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:d.dw,supported:hr,setRTLTextPlugin:d.dy,getRTLTextPluginStatus:d.dz,Map:class extends bp{constructor(g){d.df.mark(d.dg.create);const l=g;if(null!=(g=d.Q({},ky,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&d.dh(window)&&(g.antialias=!1,d.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ip(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Ad,this._domRenderTaskQueue=new Ad,this._controls=[],this._markers=[],this._popups=[],this._mapId=d.di(),this._locale=d.Q({},I1,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fg(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new d.dj(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},"string"==typeof g.container){const h=document.getElementById(g.container);if(!h)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=h}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&d.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),d.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new A1),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Id(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||d.db.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new qh("string"==typeof g.hash&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==l.center&&null==l.zoom||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const h=g.bounds;h&&(this.resize(),this.fitBounds(h,d.Q({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Da({customAttribution:g.customAttribution})),this._logoControl=new xp,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update("style"===h.dataType),this.fire(new d.g(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new d.g(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(g,l){if(void 0===l&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new d.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[l];return-1!==l.indexOf("bottom")?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new d.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new d.g("movestart",g)).fire(new d.g("move",g)),this.fire(new d.g("resize",g)),l&&this.fire(new d.g("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(d.aj.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new d.g("zoomstart")).fire(new d.g("zoom")).fire(new d.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new d.g("zoomstart")).fire(new d.g("zoom")).fire(new d.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new d.g("pitchstart")).fire(new d.g("pitch")).fire(new d.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new d.g("pitchstart")).fire(new d.g("pitch")).fire(new d.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(l=>"auto"===l?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,l=g.projection.name;let h;"globe"===l&&g.zoom>=d.aV?(g.setMercatorFromTransition(),h=!0):"mercator"===l&&g.zoom<d.aV&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l="globe"===g.name&&this.transform.zoom>=d.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(d.aJ.convert(g))}unproject(g){return this.transform.pointLocation3D(d.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,h){if("mouseenter"===g||"mouseover"===g){let y=!1;const b=E=>{const M=l.filter(R=>this.getLayer(R)),O=M.length?this.queryRenderedFeatures(E.point,{layers:M}):[];O.length?y||(y=!0,h.call(this,new Vs(g,this,E.originalEvent,{features:O}))):y=!1},w=()=>{y=!1};return{layers:new Set(l),listener:h,delegates:{mousemove:b,mouseout:w}}}if("mouseleave"===g||"mouseout"===g){let y=!1;const b=E=>{const M=l.filter(O=>this.getLayer(O));(M.length?this.queryRenderedFeatures(E.point,{layers:M}):[]).length?y=!0:y&&(y=!1,h.call(this,new Vs(g,this,E.originalEvent)))},w=E=>{y&&(y=!1,h.call(this,new Vs(g,this,E.originalEvent)))};return{layers:new Set(l),listener:h,delegates:{mousemove:b,mouseout:w}}}{const y=b=>{const w=l.filter(M=>this.getLayer(M)),E=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];E.length&&(b.features=E,h.call(this,b),delete b.features)};return{layers:new Set(l),listener:h,delegates:{[g]:y}}}}on(g,l,h){if("function"==typeof l||void 0===h)return super.on(g,l);if(Array.isArray(l)||(l=[l]),l)for(const b of l)if(!this._isValidId(b))return this;const y=this._createDelegatedListener(g,l,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(g,l,h){if("function"==typeof l||void 0===h)return super.once(g,l);if(Array.isArray(l)||(l=[l]),l)for(const b of l)if(!this._isValidId(b))return this;const y=this._createDelegatedListener(g,l,h);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(g,l,h){if("function"==typeof l||void 0===h)return super.off(g,l);const y=new Set(Array.isArray(l)?l:[l]);for(const E of y)if(!this._isValidId(E))return this;const b=(E,M)=>{if(E.size!==M.size)return!1;for(const O of E)if(!M.has(O))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(E=>{for(let M=0;M<E.length;M++){const O=E[M];if(O.listener===h&&b(O.layers,y)){for(const R in O.delegates)this.off(R,O.delegates[R]);return E.splice(M,1),this}}})(w),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(void 0!==l||void 0===g||g instanceof d.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers))for(const h of l.layers)if(!this._isValidId(h))return[];return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return this._isValidId(g)?this.style.querySourceFeatures(g,l):[]}isPointOnSurface(g){const{name:l}=this.transform.projection;return"globe"!==l&&"mercator"!==l&&d.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(d.P.convert(g))}setStyle(g,l){return l=d.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&g&&!1!==l.diff&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(g,(h,y)=>{h?(d.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(g,l)):y&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(null==l)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const h=d.Q({},l);l&&l.config&&(h.initialConfig=l.config,delete h.config),this.style=new Ko(this,h).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ko(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.w("There is no style added to the map."),!1)}_isValidId(g){return null==g?(this.fire(new d.f(new Error("IDs can't be empty."))),!1):!d.cY(g)||(this.fire(new d.f(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,h)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:h=1,sdf:y=!1,stretchX:b,stretchY:w,content:E}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:M,height:O,data:R}=d.e.getImageData(l);this.style.addImage(g,{data:new d.j({width:M,height:O},R),pixelRatio:h,stretchX:b,stretchY:w,content:E,sdf:y,version:0})}else if(void 0===l.width||void 0===l.height)this.fire(new d.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:O}=l,R=l;this.style.addImage(g,{data:new d.j({width:M,height:O},new Uint8Array(R.data)),pixelRatio:h,stretchX:b,stretchY:w,content:E,sdf:y,version:0,userImage:R}),R.onAdd&&R.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const h=this.style.getImage(g);if(!h)return void this.fire(new d.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?d.e.getImageData(l):l,{width:b,height:w,data:E}=y;if(void 0===b||void 0===w)return void this.fire(new d.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==h.data.width||w!==h.data.height)return void this.fire(new d.f(new Error(`The width and height of the updated image (${b}, ${w})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`)));const M=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);h.data.replace(E,M),this.style.updateImage(g,h)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new d.f(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){d.i(this._requestManager.transformRequest(g,d.R.Image),(h,y)=>{l(h,y instanceof HTMLImageElement?d.e.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new d.f(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}getSlot(g){const l=this.getLayer(g);return l&&l.slot||null}setSlot(g,l){return this.style.setSlot(g,l),this.style.mergeLayers(),this._update(!0)}addImport(g,l){return this.style.addImport(g,l),this}updateImport(g,l){return"string"!=typeof l&&l.id!==g?(this.removeImport(g),this.addImport(l)):(this.style.updateImport(g,l),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,l){return this.style.moveImport(g,l),this._update(!0)}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const l=this.style.getOwnLayer(g);return l?"custom"===l.type?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,l,h){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,h),this._update(!0)):this}setFilter(g,l,h={}){return this._isValidId(g)?(this.style.setFilter(g,l,h),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,h,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,h,y),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,h,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,h,y),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getSchema(g){return this.style.getSchema(g)}setSchema(g,l){return this.style.setSchema(g,l),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,l){return this.style.setConfig(g,l),this._update(!0)}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,h){return this.style.setConfigProperty(g,l,h),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&1===g.length&&"flat"===g[0].type){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return 0===g.length&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===g["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.aJ.convert(g),this.transform):0}setFeatureState(g,l){return this._isValidId(g.source)?(this.style.setFeatureState(g,l),this._update()):this}removeFeatureState(g,l){return this._isValidId(g.source)?(this.style.removeFeatureState(g,l),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let h,y,b,w=this._container;for(;w&&(!y||!b);){const E=window.getComputedStyle(w).transform;E&&"none"!==E&&(h=E.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(y=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(b=h[3])),w=w.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=b?Math.abs(l/b):l}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=ti("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=ti("div","mapboxgl-canvas-container",g);this._canvas=ti("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=ti("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=ti("div",`mapboxgl-ctrl-${b}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const h=d.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);-1!==l&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);-1!==l&&this._popups.splice(l,1)}_setupPainter(){const g=d.Q({},hr.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(d.dk(l,!0),this.painter=new rg(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),d.dl.testSupport(l)):this.fire(new d.f(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.g("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new d.g("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new d.g("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,y=d.e.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=b.createQuery(),b.beginQuery(h.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,k=this.transform.pitch,B=d.e.now(),U=new d.Y(R,{now:B,fadeDuration:w,pitch:k,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(y);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource);if(M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.df.mark(d.dg.load),this.fire(new d.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const R=d.e.now()-y;b.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const k=b.getQueryParameter(l,b.QUERY_RESULT)/1e6;b.deleteQuery(l),this.fire(new d.g("gpu-timing-frame",{cpuTime:R,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(R);this.fire(new d.g("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(R);this.fire(new d.g("gpu-timing-deferred-render",{gpuTime:k}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(O||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(E=this._updateAverageElevation(y,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new d.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new d.g("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,d.df.mark(d.dg.fullLoad),this._performanceMetricsCollection&&d.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const h=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const b=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const E=Math.abs(b-w);if(E>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,g,300)}else if(E>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){d.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===d.dp||401===g.status)){const l=this.painter.context.gl;d.dk(l,!1),this._logoControl instanceof xp&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&d.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const h=this.painter.context.gl,y=h.createFramebuffer();function b(w){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,w,0);const E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,y),this._canvasPixelComparison(b(g),l.canvasCopies.map(b),l.timeStamps)}_canvasPixelComparison(g,l,h){let y=h[1]-h[0];const b=g.length/4;for(let w=0;w<l.length;w++){const E=l[w];let M=0;for(let O=0;O<E.length;O+=4)E[O]===g[O]&&E[O+1]===g[O+1]&&E[O+2]===g[O+2]&&E[O+3]===g[O+3]&&(M+=1);y+=(h[w+2]-h[w+1])*(1-M/b)}return y}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),d.ds(this.painter.context.gl),d.dt.remove(),d.du.remove(),this._removed=!0,this.fire(new d.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=d.e.frame(l=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(l)}))}_preloadTiles(g){const l=this.style?this.style.getSourceCaches():[];return d.dv(l,(h,y)=>h._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,l){d.dx(g,l)}get version(){return d.dw}},NavigationControl:class{constructor(g={}){this.options=d.Q({},dc,g),this._container=ti("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(d.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),ti("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),ti("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:l}):h.resetNorth({},{originalEvent:l}))}),this._compassIcon=ti("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),h=l===g.getMaxZoom(),y=l===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pg(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const h=ti("button",g,this._container);return h.type="button",h.addEventListener("click",l),h}_setButtonTitle(g,l){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends d.E{constructor(g={}){super();const l=navigator.geolocation;this.options=d.Q({geolocation:l},Fy,g),d.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Hh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=ti("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(h=>l("denied"!==h.state)).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),h=g.coords;return!!l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new d.g("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new d.g("geolocate",g)),this._finish()}}_updateCamera(g){const l=new d.aJ(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,y=this._map.getBearing(),b=d.Q({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(h),b,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new d.aJ(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=d.ay(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new d.g("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=ti("button","mapboxgl-ctrl-geolocate",this._container),ti("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ti("div","mapboxgl-user-location"),this._dotElement.appendChild(ti("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ti("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Od({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ti("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Od({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.g("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Da,ScaleControl:class{constructor(g={}){this.options=d.Q({},Pd,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),d.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,h=l._containerHeight/2,y=l._containerWidth/2-g/2,b=l.unproject([y,h]),w=l.unproject([y+g,h]),E=b.distanceTo(w);if("imperial"===this.options.unit){const M=3.2808*E;M>5280?this._setScale(g,M/5280,"mile"):this._setScale(g,M,"foot")}else"nautical"===this.options.unit?this._setScale(g,E/1852,"nautical-mile"):E>=1e3?this._setScale(g,E/1e3,"kilometer"):this._setScale(g,E,"meter")}_setScale(g,l,h){this._map._requestDomTask(()=>{const y=function(w){const E=Math.pow(10,`${Math.floor(w)}`.length-1);let M=w/E;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(O){const R=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*R)/R}(M),E*M}(l),b=y/l;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(y):`${y}&nbsp;${Cp[h]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=ti("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:d.w("Full screen control 'container' must be a DOM element.")),d.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=ti("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=ti("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ti("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.E{constructor(g){super(),this.options=d.Q(Object.create(Tl),g),d.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new d.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new d.g("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=d.aJ.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=g;y=h.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=ti("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const h=this._closeButton=ti("button","mapboxgl-popup-close-button",l);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,h=this._container,y=this._pos;if(!l||!h||!y)return"bottom";const b=h.offsetWidth,w=h.offsetHeight,E=y.x<b/2,M=y.x>l.transform.width-b/2;if(y.y+g<w)return E?"top-left":M?"top-right":"top";if(y.y>l.transform.height-w){if(E)return"bottom-left";if(M)return"bottom-right"}return E?"left":M?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,h=this._content;if(!l||!this._lngLat&&!this._trackPointer||!h)return;let y=this._container;if(y||(y=this._container=ti("div","mapboxgl-popup",l.getContainer()),this._tip=ti("div","mapboxgl-popup-tip",y),y.appendChild(h)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=uc(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g instanceof d.P?g:l.project(this._lngLat),w=gu(this.options.offset),E=this._anchor=this._getAnchor(w.y),M=gu(this.options.offset,E),O=b.add(M).round();l._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${wp[E]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&l._showingGlobe()){const b=d.dc(l.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(mo);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Od,Style:Ko,LngLat:d.aJ,LngLatBounds:d.aj,Point:d.P,MercatorCoordinate:d._,FreeCameraOptions:Mh,Evented:d.E,config:d.db,prewarm:d.dA,clearPrewarmedResources:d.dB,get accessToken(){return d.db.ACCESS_TOKEN},set accessToken(g){d.db.ACCESS_TOKEN=g},get baseApiUrl(){return d.db.API_URL},set baseApiUrl(g){d.db.API_URL=g},get workerCount(){return d.dC.workerCount},set workerCount(g){d.dC.workerCount=g},get maxParallelImageRequests(){return d.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){d.db.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){d.dD(g)},get workerUrl(){return d.dE.workerUrl},set workerUrl(g){d.dE.workerUrl=g},get workerClass(){return d.dE.workerClass},set workerClass(g){d.dE.workerClass=g},get workerParams(){return d.dE.workerParams},set workerParams(g){d.dE.workerParams=g},get dracoUrl(){return d.dF()},set dracoUrl(g){d.dG(g)},get meshoptUrl(){return d.dH()},set meshoptUrl(g){d.dI(g)},setNow:d.e.setNow,restoreNow:d.e.restoreNow}}),Zu}()},73:()=>{"use strict";const xh=":";Error;const dn=function(it,...lt){if(dn.translate){const kt=dn.translate(it,lt);it=kt[0],lt=kt[1]}let St=Ii(it[0],it.raw[0]);for(let kt=1;kt<it.length;kt++)St+=lt[kt-1]+Ii(it[kt],it.raw[kt]);return St},Yc=":";function Ii(it,lt){return lt.charAt(0)===Yc?it.substring(function va(it,lt){for(let St=1,kt=1;St<it.length;St++,kt++)if("\\"===lt[kt])kt++;else if(it[St]===xh)return St;throw new Error(`Unterminated $localize metadata block in "${lt}".`)}(it,lt)+1):it}globalThis.$localize=dn}},xh=>{var qc=Zu=>xh(xh.s=Zu);qc(73),qc(513)}]);