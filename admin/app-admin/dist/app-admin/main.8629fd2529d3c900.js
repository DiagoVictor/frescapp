(self.webpackChunkapp_admin=self.webpackChunkapp_admin||[]).push([[792],{400:(oh,_u,Sl)=>{"use strict";function yu(e,n){return Object.is(e,n)}let ts=null,gd=!1,f=1;const as=Symbol("SIGNAL");function _r(e){const n=ts;return ts=e,n}const Pr={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function ei(e){if(gd)throw new Error("");if(null===ts)return;ts.consumerOnSignalRead(e);const n=ts.nextProducerIndex++;Xr(ts),n<ts.producerNode.length&&ts.producerNode[n]!==e&&ci(ts)&&vu(ts.producerNode[n],ts.producerIndexOfThis[n]),ts.producerNode[n]!==e&&(ts.producerNode[n]=e,ts.producerIndexOfThis[n]=ci(ts)?ah(e,ts,n):0),ts.producerLastReadVersion[n]=e.version}function vi(e){if((!ci(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==f)){if(!e.producerMustRecompute(e)&&!Ks(e))return e.dirty=!1,void(e.lastCleanEpoch=f);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=f}}function Ws(e){if(void 0===e.liveConsumerNode)return;const n=gd;gd=!0;try{for(const t of e.liveConsumerNode)t.dirty||Uo(t)}finally{gd=n}}function bc(){return!1!==ts?.consumerAllowSignalWrites}function Uo(e){e.dirty=!0,Ws(e),e.consumerMarkedDirty?.(e)}function xi(e){return e&&(e.nextProducerIndex=0),_r(e)}function Ai(e,n){if(_r(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(ci(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)vu(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Ks(e){Xr(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],r=e.producerLastReadVersion[n];if(r!==t.version||(vi(t),r!==t.version))return!0}return!1}function sa(e){if(Xr(e),ci(e))for(let n=0;n<e.producerNode.length;n++)vu(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function ah(e,n,t){if(Ya(e),0===e.liveConsumerNode.length&&xu(e))for(let r=0;r<e.producerNode.length;r++)e.producerIndexOfThis[r]=ah(e.producerNode[r],e,r);return e.liveConsumerIndexOfThis.push(t),e.liveConsumerNode.push(n)-1}function vu(e,n){if(Ya(e),1===e.liveConsumerNode.length&&xu(e))for(let r=0;r<e.producerNode.length;r++)vu(e.producerNode[r],e.producerIndexOfThis[r]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const r=e.liveConsumerIndexOfThis[n],s=e.liveConsumerNode[n];Xr(s),s.producerIndexOfThis[r]=n}}function ci(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Xr(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function Ya(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function xu(e){return void 0!==e.producerNode}const bu=Symbol("UNSET"),ui=Symbol("COMPUTING"),wc=Symbol("ERRORED"),Ka={...Pr,value:bu,dirty:!0,error:null,equal:yu,producerMustRecompute:e=>e.value===bu||e.value===ui,producerRecomputeValue(e){if(e.value===ui)throw new Error("Detected cycle in computations.");const n=e.value;e.value=ui;const t=xi(e);let r;try{r=e.computation()}catch(s){r=wc,e.error=s}finally{Ai(e,t)}n!==bu&&n!==wc&&r!==wc&&e.equal(n,r)?e.value=n:(e.value=r,e.version++)}};let lh=function am(){throw new Error};function Wc(){lh()}let Jl=null;function _d(e,n){bc()||Wc(),e.equal(e.value,n)||(e.value=n,function wt(e){e.version++,function Is(){f++}(),Ws(e),Jl?.()}(e))}const Li={...Pr,equal:yu,value:void 0};function hn(e){return"function"==typeof e}function ns(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Bi=ns(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,s)=>`${s+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function mn(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class dn{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const l of t)l.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(hn(r))try{r()}catch(l){n=l instanceof Bi?l.errors:[l]}const{_finalizers:s}=this;if(s){this._finalizers=null;for(const l of s)try{Ma(l)}catch(h){n=n??[],h instanceof Bi?n=[...n,...h.errors]:n.push(h)}}if(n)throw new Bi(n)}}add(n){var t;if(n&&n!==this)if(this.closed)Ma(n);else{if(n instanceof dn){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&mn(t,n)}remove(n){const{_finalizers:t}=this;t&&mn(t,n),n instanceof dn&&n._removeParent(this)}}dn.EMPTY=(()=>{const e=new dn;return e.closed=!0,e})();const Ja=dn.EMPTY;function Js(e){return e instanceof dn||e&&"closed"in e&&hn(e.remove)&&hn(e.add)&&hn(e.unsubscribe)}function Ma(e){hn(e)?e():e.unsubscribe()}const Qa={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},qs={setTimeout(e,n,...t){const{delegate:r}=qs;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=qs;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function qc(e){qs.setTimeout(()=>{const{onUnhandledError:n}=Qa;if(!n)throw e;n(e)})}function ji(){}const el=Zc("C",void 0,void 0);function Zc(e,n,t){return{kind:e,value:n,error:t}}let Ql=null;function Aa(e){if(Qa.useDeprecatedSynchronousErrorHandling){const n=!Ql;if(n&&(Ql={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=Ql;if(Ql=null,t)throw r}}else e()}class sr extends dn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Js(n)&&n.add(this)):this.destination=Df}static create(n,t,r){return new wu(n,t,r)}next(n){this.isStopped?xd(function vd(e){return Zc("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?xd(function ch(e){return Zc("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?xd(el,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Cf=Function.prototype.bind;function So(e,n){return Cf.call(e,n)}class Tc{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){ka(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){ka(r)}else ka(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){ka(t)}}}class wu extends sr{constructor(n,t,r){let s;if(super(),hn(n)||!n)s={next:n??void 0,error:t??void 0,complete:r??void 0};else{let l;this&&Qa.useDeprecatedNextContext?(l=Object.create(n),l.unsubscribe=()=>this.unsubscribe(),s={next:n.next&&So(n.next,l),error:n.error&&So(n.error,l),complete:n.complete&&So(n.complete,l)}):s=n}this.destination=new Tc(s)}}function ka(e){Qa.useDeprecatedSynchronousErrorHandling?function Ia(e){Qa.useDeprecatedSynchronousErrorHandling&&Ql&&(Ql.errorThrown=!0,Ql.error=e)}(e):qc(e)}function xd(e,n){const{onStoppedNotification:t}=Qa;t&&qs.setTimeout(()=>t(e,n))}const Df={closed:!0,next:ji,error:function Sf(e){throw e},complete:ji},Tu="function"==typeof Symbol&&Symbol.observable||"@@observable";function tl(e){return e}function Eu(e){return 0===e.length?tl:1===e.length?e[0]:function(t){return e.reduce((r,s)=>s(r),t)}}let $i=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,s){const l=function ec(e){return e&&e instanceof sr||function z_(e){return e&&hn(e.next)&&hn(e.error)&&hn(e.complete)}(e)&&Js(e)}(t)?t:new wu(t,r,s);return Aa(()=>{const{operator:h,source:g}=this;l.add(h?h.call(l,g):g?this._subscribe(l):this._trySubscribe(l))}),l}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=Dl(r))((s,l)=>{const h=new wu({next:g=>{try{t(g)}catch(x){l(x),h.unsubscribe()}},error:l,complete:s});this.subscribe(h)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[Tu](){return this}pipe(...t){return Eu(t)(this)}toPromise(t){return new(t=Dl(t))((r,s)=>{let l;this.subscribe(h=>l=h,h=>s(h),()=>r(l))})}}return e.create=n=>new e(n),e})();function Dl(e){var n;return null!==(n=e??Qa.Promise)&&void 0!==n?n:Promise}const Do=ns(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Ii=(()=>{class e extends $i{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new uh(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new Do}next(t){Aa(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){Aa(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Aa(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:s,observers:l}=this;return r||s?Ja:(this.currentObservers=null,l.push(t),new dn(()=>{this.currentObservers=null,mn(l,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:s,isStopped:l}=this;r?t.error(s):l&&t.complete()}asObservable(){const t=new $i;return t.source=this,t}}return e.create=(n,t)=>new uh(n,t),e})();class uh extends Ii{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,n)}error(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==r?r:Ja}}class Vo extends Ii{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:r}=this;if(n)throw t;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function Bs(e){return hn(e?.lift)}function ys(e){return n=>{if(Bs(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Me(e,n,t,r,s){return new K(e,n,t,r,s)}class K extends sr{constructor(n,t,r,s,l,h){super(n),this.onFinalize=l,this.shouldUnsubscribe=h,this._next=t?function(g){try{t(g)}catch(x){n.error(x)}}:super._next,this._error=s?function(g){try{s(g)}catch(x){n.error(x)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(g){n.error(g)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function J(e,n){return ys((t,r)=>{let s=0;t.subscribe(Me(r,l=>{r.next(e.call(n,l,s++))}))})}typeof navigator<"u"&&navigator,typeof navigator<"u"&&!/Opera/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||navigator),typeof navigator<"u"&&!/Opera|WebKit/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&navigator;const bm="https://g.co/ng/security#xss";class Jt extends Error{constructor(n,t){super(function Sd(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function Pa(e){return{toString:e}.toString()}const Dd="__parameters__";function yh(e,n,t){return Pa(()=>{const r=function Ad(e){return function(...t){if(e){const r=e(...t);for(const s in r)this[s]=r[s]}}}(n);function s(...l){if(this instanceof s)return r.apply(this,l),this;const h=new s(...l);return g.annotation=h,g;function g(x,E,D){const O=x.hasOwnProperty(Dd)?x[Dd]:Object.defineProperty(x,Dd,{value:[]})[Dd];for(;O.length<=D;)O.push(null);return(O[D]=O[D]||[]).push(h),x}}return t&&(s.prototype=Object.create(t.prototype)),s.prototype.ngMetadataName=e,s.annotationCls=s,s})}const ls=globalThis;function Hi(e){for(let n in e)if(e[n]===Hi)return n;throw Error("Could not find renamed property on target object.")}function zv(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function Ts(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Ts).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function Qg(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const Bf=Hi({__forward_ref__:Hi});function zi(e){return e.__forward_ref__=zi,e.toString=function(){return Ts(this())},e}function Tr(e){return wm(e)?e():e}function wm(e){return"function"==typeof e&&e.hasOwnProperty(Bf)&&e.__forward_ref__===zi}function sn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ui(e){return{providers:e.providers||[],imports:e.imports||[]}}function Fn(e){return Vf(e,$f)||Vf(e,ln)}function Vf(e,n){return e.hasOwnProperty(n)?e[n]:null}function Al(e){return e&&(e.hasOwnProperty(Na)||e.hasOwnProperty(Fr))?e[Na]:null}const $f=Hi({\u0275prov:Hi}),Na=Hi({\u0275inj:Hi}),ln=Hi({ngInjectableDef:Hi}),Fr=Hi({ngInjectorDef:Hi});class Gt{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=sn({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function il(e){return e&&!!e.\u0275providers}const Du=Hi({\u0275cmp:Hi}),Wf=Hi({\u0275dir:Hi}),qf=Hi({\u0275pipe:Hi}),Go=Hi({\u0275mod:Hi}),Qs=Hi({\u0275fac:Hi}),Zf=Hi({__NG_ELEMENT_ID__:Hi}),Id=Hi({__NG_ENV_ID__:Hi});function rr(e){return"string"==typeof e?e:null==e?"":String(e)}function Dc(e,n){throw new Jt(-201,!1)}var Gr=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Gr||{});let c1;function Jc(){return c1}function sl(e){const n=c1;return c1=e,n}function n0(e,n,t){const r=Fn(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Gr.Optional?null:void 0!==n?n:void Dc()}const Mu={},Wr="__NG_DI_FLAG__",Au="ngTempTokenPath",rT=/\n/gm,Iu="__source";let ku;function Ru(e){const n=ku;return ku=e,n}function Sm(e,n=Gr.Default){if(void 0===ku)throw new Jt(-203,!1);return null===ku?n0(e,void 0,n):ku.get(e,n&Gr.Optional?null:void 0,n)}function Dn(e,n=Gr.Default){return(Jc()||Sm)(Tr(e),n)}function Xe(e,n=Gr.Default){return Dn(e,xh(n))}function xh(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function Xf(e){const n=[];for(let t=0;t<e.length;t++){const r=Tr(e[t]);if(Array.isArray(r)){if(0===r.length)throw new Jt(900,!1);let s,l=Gr.Default;for(let h=0;h<r.length;h++){const g=r[h],x=u1(g);"number"==typeof x?-1===x?s=g.token:l|=x:s=g}n.push(Dn(s,l))}else n.push(Dn(r))}return n}function Dm(e,n){return e[Wr]=n,e.prototype[Wr]=n,e}function u1(e){return e[Wr]}const Mm=Dm(yh("Optional"),8),Od=Dm(yh("SkipSelf"),4);function bh(e,n){return e.hasOwnProperty(Qs)?e[Qs]:null}function Rd(e,n){e.forEach(t=>Array.isArray(t)?Rd(t,n):n(t))}function s0(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function ua(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function ol(e,n,t){let r=al(e,n);return r>=0?e[1|r]=t:(r=~r,function Yf(e,n,t,r){let s=e.length;if(s==n)e.push(t,r);else if(1===s)e.push(r,e[0]),e[0]=t;else{for(s--,e.push(e[s-1],e[s]);s>n;)e[s]=e[s-2],s--;e[n]=t,e[n+1]=r}}(e,r,n,t)),r}function Kf(e,n){const t=al(e,n);if(t>=0)return e[1|t]}function al(e,n){return function ll(e,n,t){let r=0,s=e.length>>t;for(;s!==r;){const l=r+(s-r>>1),h=e[l<<t];if(n===h)return l<<t;h>n?s=l:r=l+1}return~(s<<t)}(e,n,1)}const kl={},mi=[],rc=new Gt(""),d1=new Gt("",-1),Fa=new Gt("");class Im{get(n,t=Mu){if(t===Mu){const r=new Error(`NullInjectorError: No provider for ${Ts(n)}!`);throw r.name="NullInjectorError",r}return t}}var km=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(km||{}),Ol=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Ol||{}),Rl=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(Rl||{});function sT(e,n,t){let r=e.length;for(;;){const s=e.indexOf(n,t);if(-1===s)return s;if(0===s||e.charCodeAt(s-1)<=32){const l=n.length;if(s+l===r||e.charCodeAt(s+l)<=32)return s}t=s+1}}function f1(e,n,t){let r=0;for(;r<t.length;){const s=t[r];if("number"==typeof s){if(0!==s)break;r++;const l=t[r++],h=t[r++],g=t[r++];e.setAttribute(n,h,g,l)}else{const l=s,h=t[++r];Kv(l)?e.setProperty(n,l,h):e.setAttribute(n,l,h),r++}}return r}function Yv(e){return 3===e||4===e||6===e}function Kv(e){return 64===e.charCodeAt(0)}function Jf(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let r=0;r<n.length;r++){const s=n[r];"number"==typeof s?t=s:0===t||Om(e,t,s,null,-1===t||2===t?n[++r]:null)}}return e}function Om(e,n,t,r,s){let l=0,h=e.length;if(-1===n)h=-1;else for(;l<e.length;){const g=e[l++];if("number"==typeof g){if(g===n){h=-1;break}if(g>n){h=l-1;break}}}for(;l<e.length;){const g=e[l];if("number"==typeof g)break;if(g===t){if(null===r)return void(null!==s&&(e[l+1]=s));if(r===e[l+1])return void(e[l+2]=s)}l++,null!==r&&l++,null!==s&&l++}-1!==h&&(e.splice(h,0,n),l=h+1),e.splice(l++,0,t),null!==r&&e.splice(l++,0,r),null!==s&&e.splice(l++,0,s)}const wh="ng-template";function Pl(e,n,t,r){let s=0;if(r){for(;s<n.length&&"string"==typeof n[s];s+=2)if("class"===n[s]&&-1!==sT(n[s+1].toLowerCase(),t,0))return!0}else if(Pd(e))return!1;if(s=n.indexOf(1,s),s>-1){let l;for(;++s<n.length&&"string"==typeof(l=n[s]);)if(l.toLowerCase()===t)return!0}return!1}function Pd(e){return 4===e.type&&e.value!==wh}function p1(e,n,t){return n===(4!==e.type||t?e.value:wh)}function o0(e,n,t){let r=4;const s=e.attrs,l=null!==s?function Th(e){for(let n=0;n<e.length;n++)if(Yv(e[n]))return n;return e.length}(s):0;let h=!1;for(let g=0;g<n.length;g++){const x=n[g];if("number"!=typeof x){if(!h)if(4&r){if(r=2|1&r,""!==x&&!p1(e,x,t)||""===x&&1===n.length){if(Nl(r))return!1;h=!0}}else if(8&r){if(null===s||!Pl(e,s,x,t)){if(Nl(r))return!1;h=!0}}else{const E=n[++g],D=Nd(x,s,Pd(e),t);if(-1===D){if(Nl(r))return!1;h=!0;continue}if(""!==E){let O;if(O=D>l?"":s[D+1].toLowerCase(),2&r&&E!==O){if(Nl(r))return!1;h=!0}}}}else{if(!h&&!Nl(r)&&!Nl(x))return!1;if(h&&Nl(x))continue;h=!1,r=x|1&r}}return Nl(r)||h}function Nl(e){return!(1&e)}function Nd(e,n,t,r){if(null===n)return-1;let s=0;if(r||!t){let l=!1;for(;s<n.length;){const h=n[s];if(h===e)return s;if(3===h||6===h)l=!0;else{if(1===h||2===h){let g=n[++s];for(;"string"==typeof g;)g=n[++s];continue}if(4===h)break;if(0===h){s+=4;continue}}s+=l?1:2}return-1}return function Rm(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const r=e[t];if("number"==typeof r)return-1;if(r===n)return t;t++}return-1}(n,e)}function Qf(e,n,t=!1){for(let r=0;r<n.length;r++)if(o0(e,n[r],t))return!0;return!1}function a0(e,n){e:for(let t=0;t<n.length;t++){const r=n[t];if(e.length===r.length){for(let s=0;s<e.length;s++)if(e[s]!==r[s])continue e;return!0}}return!1}function ep(e,n){return e?":not("+n.trim()+")":n}function Pm(e){let n=e[0],t=1,r=2,s="",l=!1;for(;t<e.length;){let h=e[t];if("string"==typeof h)if(2&r){const g=e[++t];s+="["+h+(g.length>0?'="'+g+'"':"")+"]"}else 8&r?s+="."+h:4&r&&(s+=" "+h);else""!==s&&!Nl(h)&&(n+=ep(l,s),s=""),r=h,l=l||!Nl(r);t++}return""!==s&&(n+=ep(l,s)),n}function ki(e){return Pa(()=>{const n=Lm(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===km.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Ol.Emulated,styles:e.styles||mi,_:null,schemas:e.schemas||null,tView:null,id:""};c0(t);const r=e.dependencies;return t.directiveDefs=tp(r,!1),t.pipeDefs=tp(r,!0),t.id=function Qv(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const s of t)n=Math.imul(31,n)+s.charCodeAt(0)|0;return n+=2147483648,"c"+n}(t),t})}function Fm(e){return Vr(e)||ho(e)}function Fd(e){return null!==e}function Ci(e){return Pa(()=>({type:e.type,bootstrap:e.bootstrap||mi,declarations:e.declarations||mi,imports:e.imports||mi,exports:e.exports||mi,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function m1(e,n){if(null==e)return kl;const t={};for(const r in e)if(e.hasOwnProperty(r)){const s=e[r];let l,h,g=Rl.None;Array.isArray(s)?(g=s[0],l=s[1],h=s[2]??l):(l=s,h=s),n?(t[l]=g!==Rl.None?[r,g]:r,n[l]=h):t[l]=r}return t}function gn(e){return Pa(()=>{const n=Lm(e);return c0(n),n})}function La(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Vr(e){return e[Du]||null}function ho(e){return e[Wf]||null}function Wo(e){return e[qf]||null}function ha(e,n){const t=e[Go]||null;if(!t&&!0===n)throw new Error(`Type ${Ts(e)} does not have '\u0275mod' property.`);return t}function Lm(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||kl,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||mi,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:m1(e.inputs,n),outputs:m1(e.outputs),debugInfo:null}}function c0(e){e.features?.forEach(n=>n(e))}function tp(e,n){if(!e)return null;const t=n?Wo:Fm;return()=>("function"==typeof e?e():e).map(r=>t(r)).filter(Fd)}function oT(...e){return{\u0275providers:Ld(0,e),\u0275fromNgModule:!0}}function Ld(e,...n){const t=[],r=new Set;let s;const l=h=>{t.push(h)};return Rd(n,h=>{const g=h;Ch(g,l,[],r)&&(s||=[],s.push(g))}),void 0!==s&&rp(s,l),t}function rp(e,n){for(let t=0;t<e.length;t++){const{ngModule:r,providers:s}=e[t];Bm(s,l=>{n(l,r)})}}function Ch(e,n,t,r){if(!(e=Tr(e)))return!1;let s=null,l=Al(e);const h=!l&&Vr(e);if(l||h){if(h&&!h.standalone)return!1;s=e}else{const x=e.ngModule;if(l=Al(x),!l)return!1;s=x}const g=r.has(s);if(h){if(g)return!1;if(r.add(s),h.dependencies){const x="function"==typeof h.dependencies?h.dependencies():h.dependencies;for(const E of x)Ch(E,n,t,r)}}else{if(!l)return!1;{if(null!=l.imports&&!g){let E;r.add(s);try{Rd(l.imports,D=>{Ch(D,n,t,r)&&(E||=[],E.push(D))})}finally{}void 0!==E&&rp(E,n)}if(!g){const E=bh(s)||(()=>new s);n({provide:s,useFactory:E,deps:mi},s),n({provide:Fa,useValue:s,multi:!0},s),n({provide:rc,useValue:()=>Dn(s),multi:!0},s)}const x=l.providers;if(null!=x&&!g){const E=e;Bm(x,D=>{n(D,E)})}}}return s!==e&&void 0!==e.providers}function Bm(e,n){for(let t of e)il(t)&&(t=t.\u0275providers),Array.isArray(t)?Bm(t,n):n(t)}const Bd=Hi({provide:String,useValue:Hi});function ip(e){return null!==e&&"object"==typeof e&&Bd in e}function Ac(e){return"function"==typeof e}const sp=new Gt(""),Sh={},d0={};let op;function Pu(){return void 0===op&&(op=new Im),op}class qo{}class zd extends qo{get destroyed(){return this._destroyed}constructor(n,t,r,s){super(),this.parent=t,this.source=r,this.scopes=s,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,f0(n,h=>this.processProvider(h)),this.records.set(d1,Dh(void 0,this)),s.has("environment")&&this.records.set(qo,Dh(void 0,this));const l=this.records.get(sp);null!=l&&"string"==typeof l.value&&this.scopes.add(l.value),this.injectorDefTypes=new Set(this.get(Fa,mi,Gr.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const n=_r(null);try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),_r(n)}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=Ru(this),r=sl(void 0);try{return n()}finally{Ru(t),sl(r)}}get(n,t=Mu,r=Gr.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(Id))return n[Id](this);r=xh(r);const l=Ru(this),h=sl(void 0);try{if(!(r&Gr.SkipSelf)){let x=this.records.get(n);if(void 0===x){const E=function ap(e){return"function"==typeof e||"object"==typeof e&&e instanceof Gt}(n)&&Fn(n);x=E&&this.injectableDefInScope(E)?Dh(_1(n),Sh):null,this.records.set(n,x)}if(null!=x)return this.hydrate(n,x)}return(r&Gr.Self?Pu():this.parent).get(n,t=r&Gr.Optional&&t===Mu?null:t)}catch(g){if("NullInjectorError"===g.name){if((g[Au]=g[Au]||[]).unshift(Ts(n)),l)throw g;return function Wv(e,n,t,r){const s=e[Au];throw n[Iu]&&s.unshift(n[Iu]),e.message=function h1(e,n,t,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let s=Ts(n);if(Array.isArray(n))s=n.map(Ts).join(" -> ");else if("object"==typeof n){let l=[];for(let h in n)if(n.hasOwnProperty(h)){let g=n[h];l.push(h+":"+("string"==typeof g?JSON.stringify(g):Ts(g)))}s=`{${l.join(", ")}}`}return`${t}${r?"("+r+")":""}[${s}]: ${e.replace(rT,"\n  ")}`}("\n"+e.message,s,t,r),e.ngTokenPath=s,e[Au]=null,e}(g,n,"R3InjectorError",this.source)}throw g}finally{sl(h),Ru(l)}}resolveInjectorInitializers(){const n=_r(null),t=Ru(this),r=sl(void 0);try{const l=this.get(rc,mi,Gr.Self);for(const h of l)h()}finally{Ru(t),sl(r),_r(n)}}toString(){const n=[],t=this.records;for(const r of t.keys())n.push(Ts(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Jt(205,!1)}processProvider(n){let t=Ac(n=Tr(n))?n:Tr(n&&n.provide);const r=function lT(e){return ip(e)?Dh(void 0,e.useValue):Dh(ex(e),Sh)}(n);if(!Ac(n)&&!0===n.multi){let s=this.records.get(t);s||(s=Dh(void 0,Sh,!0),s.factory=()=>Xf(s.multi),this.records.set(t,s)),t=n,s.multi.push(n)}this.records.set(t,r)}hydrate(n,t){const r=_r(null);try{return t.value===Sh&&(t.value=d0,t.value=t.factory()),"object"==typeof t.value&&t.value&&function tx(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{_r(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;const t=Tr(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function _1(e){const n=Fn(e),t=null!==n?n.factory:bh(e);if(null!==t)return t;if(e instanceof Gt)throw new Jt(204,!1);if(e instanceof Function)return function aT(e){if(e.length>0)throw new Jt(204,!1);const t=function jf(e){return e&&(e[$f]||e[ln])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new Jt(204,!1)}function ex(e,n,t){let r;if(Ac(e)){const s=Tr(e);return bh(s)||_1(s)}if(ip(e))r=()=>Tr(e.useValue);else if(function u0(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Xf(e.deps||[]));else if(function zm(e){return!(!e||!e.useExisting)}(e))r=()=>Dn(Tr(e.useExisting));else{const s=Tr(e&&(e.useClass||e.provide));if(!function y1(e){return!!e.deps}(e))return bh(s)||_1(s);r=()=>new s(...Xf(e.deps))}return r}function Dh(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function f0(e,n){for(const t of e)Array.isArray(t)?f0(t,n):t&&il(t)?f0(t.\u0275providers,n):n(t)}function Ic(e,n){e instanceof zd&&e.assertNotDestroyed();const r=Ru(e),s=sl(void 0);try{return n()}finally{Ru(r),sl(s)}}function y(){return void 0!==Jc()||null!=function Ou(){return ku}()}const Q=0,se=1,ce=2,de=3,be=4,_e=5,ye=6,De=7,Ee=8,Be=9,ke=10,pe=11,Je=12,Ke=13,Pe=14,pt=15,mt=16,He=17,nt=18,Oe=19,_t=20,gt=21,Wt=22,Vt=23,bt=25,Qt=1,Yn=7,or=9,Kn=10;var Si=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(Si||{});function wr(e){return Array.isArray(e)&&"object"==typeof e[Qt]}function ur(e){return Array.isArray(e)&&!0===e[Qt]}function ni(e){return!!(4&e.flags)}function dr(e){return e.componentOffset>-1}function xr(e){return!(1&~e.flags)}function Zn(e){return!!e.template}function Ir(e){return!!(512&e[ce])}class p0{constructor(n,t,r){this.previousValue=n,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Vd(e,n,t,r){null!==n?n.applyValueToInputSignal(n,r):e[t]=r}function to(){return cT}function cT(e){return e.type.prototype.ngOnChanges&&(e.setInput=rx),SS}function SS(){const e=uT(this),n=e?.current;if(n){const t=e.previous;if(t===kl)e.previous=n;else for(let r in n)t[r]=n[r];e.current=null,this.ngOnChanges(n)}}function rx(e,n,t,r,s){const l=this.declaredInputs[r],h=uT(e)||function DS(e,n){return e[x1]=n}(e,{previous:kl,current:null}),g=h.current||(h.current={}),x=h.previous,E=x[l];g[l]=new p0(E&&E.currentValue,t,x===kl),Vd(e,n,s,t)}to.ngInherit=!0;const x1="__ngSimpleChanges__";function uT(e){return e[x1]||null}const Ih=function(e,n,t){};function Hn(e){for(;Array.isArray(e);)e=e[Q];return e}function Ll(e,n){return Hn(n[e])}function fa(e,n){return Hn(n[e.index])}function Vm(e,n){return e.data[n]}function $d(e,n){return e[n]}function Io(e,n){const t=n[e];return wr(t)?t:t[Q]}function kh(e){return!(128&~e[ce])}function Bl(e,n){return null==n?null:e[n]}function ox(e){e[He]=0}function ax(e){1024&e[ce]||(e[ce]|=1024,kh(e)&&jm(e))}function nu(e){return!!(9216&e[ce]||e[Vt]?.dirty)}function b1(e){e[ke].changeDetectionScheduler?.notify(7),64&e[ce]&&(e[ce]|=1024),nu(e)&&jm(e)}function jm(e){e[ke].changeDetectionScheduler?.notify(0);let n=cs(e);for(;null!==n&&!(8192&n[ce])&&(n[ce]|=8192,kh(n));)n=cs(n)}function g0(e,n){if(!(256&~e[ce]))throw new Jt(911,!1);null===e[gt]&&(e[gt]=[]),e[gt].push(n)}function cs(e){const n=e[de];return ur(n)?n[de]:n}const Rr={lFrame:v0(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let hp=!1;function cx(){return Rr.bindingsEnabled}function Oh(){return null!==Rr.skipHydrationRootTNode}function jt(){return Rr.lFrame.lView}function hi(){return Rr.lFrame.tView}function Mn(e){return Rr.lFrame.contextLView=e,e[Ee]}function An(e){return Rr.lFrame.contextLView=null,e}function rs(){let e=gT();for(;null!==e&&64===e.type;)e=e.parent;return e}function gT(){return Rr.lFrame.currentTNode}function ru(e,n){const t=Rr.lFrame;t.currentTNode=e,t.isParent=n}function ux(){return Rr.lFrame.isParent}function hx(){Rr.lFrame.isParent=!1}function OS(){return hp}function RS(e){hp=e}function Ko(){const e=Rr.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function sc(){return Rr.lFrame.bindingIndex++}function za(e){const n=Rr.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function Hd(e,n){const t=Rr.lFrame;t.bindingIndex=t.bindingRootIndex=e,C1(n)}function C1(e){Rr.lFrame.currentDirectiveIndex=e}function vT(){return Rr.lFrame.currentQueryIndex}function dp(e){Rr.lFrame.currentQueryIndex=e}function Jk(e){const n=e[se];return 2===n.type?n.declTNode:1===n.type?e[_e]:null}function PS(e,n,t){if(t&Gr.SkipSelf){let s=n,l=e;for(;!(s=s.parent,null!==s||t&Gr.Host||(s=Jk(l),null===s||(l=l[Pe],10&s.type))););if(null===s)return!1;n=s,e=l}const r=Rr.lFrame=mx();return r.currentTNode=n,r.lView=e,!0}function S1(e){const n=mx(),t=e[se];Rr.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function mx(){const e=Rr.lFrame,n=null===e?null:e.child;return null===n?v0(e):n}function v0(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function $m(){const e=Rr.lFrame;return Rr.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Ph=$m;function kc(){const e=$m();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function no(){return Rr.lFrame.selectedIndex}function oc(e){Rr.lFrame.selectedIndex=e}function Rs(){const e=Rr.lFrame;return Vm(e.tView,e.selectedIndex)}let gx=!0;function x0(){return gx}function Nh(e){gx=e}function w0(e,n){for(let t=n.directiveStart,r=n.directiveEnd;t<r;t++){const l=e.data[t].type.prototype,{ngAfterContentInit:h,ngAfterContentChecked:g,ngAfterViewInit:x,ngAfterViewChecked:E,ngOnDestroy:D}=l;h&&(e.contentHooks??=[]).push(-t,h),g&&((e.contentHooks??=[]).push(t,g),(e.contentCheckHooks??=[]).push(t,g)),x&&(e.viewHooks??=[]).push(-t,x),E&&((e.viewHooks??=[]).push(t,E),(e.viewCheckHooks??=[]).push(t,E)),null!=D&&(e.destroyHooks??=[]).push(t,D)}}function zl(e,n,t){mp(e,n,3,t)}function Ul(e,n,t,r){(3&e[ce])===t&&mp(e,n,t,r)}function pp(e,n){let t=e[ce];(3&t)===n&&(t&=16383,t+=1,e[ce]=t)}function mp(e,n,t,r){const l=r??-1,h=n.length-1;let g=0;for(let x=void 0!==r?65535&e[He]:0;x<h;x++)if("number"==typeof n[x+1]){if(g=n[x],null!=r&&g>=r)break}else n[x]<0&&(e[He]+=65536),(g<l||-1==l)&&(xT(e,t,n,x),e[He]=(4294901760&e[He])+x+2),x++}function Hm(e,n){Ih(4,e,n);const t=_r(null);try{n.call(e)}finally{_r(t),Ih(5,e,n)}}function xT(e,n,t,r){const s=t[r]<0,l=t[r+1],g=e[s?-t[r]:t[r]];s?e[ce]>>14<e[He]>>16&&(3&e[ce])===n&&(e[ce]+=16384,Hm(g,l)):Hm(g,l)}const kr=-1;class iu{constructor(n,t,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}const wT={};class Gm{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,r){r=xh(r);const s=this.injector.get(n,wT,r);return s!==wT||t===wT?s:this.parentInjector.get(n,t,r)}}function M1(e){return e!==kr}function ac(e){return 32767&e}function ko(e,n){let t=function Fh(e){return e>>16}(e),r=n;for(;t>0;)r=r[Pe],t--;return r}let fo=!0;function A1(e){const n=fo;return fo=e,n}const TT=255,_p=5;let BS=0;const Oc={};function T0(e,n){const t=yx(e,n);if(-1!==t)return t;const r=n[se];r.firstCreatePass&&(e.injectorIndex=n.length,_x(r.data,e),_x(n,null),_x(r.blueprint,null));const s=vx(e,n),l=e.injectorIndex;if(M1(s)){const h=ac(s),g=ko(s,n),x=g[se].data;for(let E=0;E<8;E++)n[l+E]=g[h+E]|x[h+E]}return n[l+8]=s,l}function _x(e,n){e.push(0,0,0,0,0,0,0,0,n)}function yx(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function vx(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,r=null,s=n;for(;null!==s;){if(r=HS(s),null===r)return kr;if(t++,s=s[Pe],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return kr}function I1(e,n,t){!function pa(e,n,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(Zf)&&(r=t[Zf]),null==r&&(r=t[Zf]=BS++);const s=r&TT;n.data[e+(s>>_p)]|=1<<s}(e,n,t)}function US(e,n,t){if(t&Gr.Optional||void 0!==e)return e;Dc()}function su(e,n,t,r){if(t&Gr.Optional&&void 0===r&&(r=null),!(t&(Gr.Self|Gr.Host))){const s=e[Be],l=sl(void 0);try{return s?s.get(n,r,t&Gr.Optional):n0(n,r,t&Gr.Optional)}finally{sl(l)}}return US(r,0,t)}function Lh(e,n,t,r=Gr.Default,s){if(null!==e){if(2048&n[ce]&&!(r&Gr.Self)){const h=function $S(e,n,t,r,s){let l=e,h=n;for(;null!==l&&null!==h&&2048&h[ce]&&!(512&h[ce]);){const g=k1(l,h,t,r|Gr.Self,Oc);if(g!==Oc)return g;let x=l.parent;if(!x){const E=h[_t];if(E){const D=E.get(t,Oc,r);if(D!==Oc)return D}x=HS(h),h=h[Pe]}l=x}return s}(e,n,t,r,Oc);if(h!==Oc)return h}const l=k1(e,n,t,r,Oc);if(l!==Oc)return l}return su(n,t,r,s)}function k1(e,n,t,r,s){const l=function nO(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(Zf)?e[Zf]:void 0;return"number"==typeof n?n>=0?n&TT:jS:n}(t);if("function"==typeof l){if(!PS(n,e,r))return r&Gr.Host?US(s,0,r):su(n,t,r,s);try{let h;if(h=l(r),null!=h||r&Gr.Optional)return h;Dc()}finally{Ph()}}else if("number"==typeof l){let h=null,g=yx(e,n),x=kr,E=r&Gr.Host?n[pt][_e]:null;for((-1===g||r&Gr.SkipSelf)&&(x=-1===g?vx(e,n):n[g+8],x!==kr&&VS(r,!1)?(h=n[se],g=ac(x),n=ko(x,n)):g=-1);-1!==g;){const D=n[se];if(ET(l,g,D.data)){const O=xx(g,n,t,h,r,E);if(O!==Oc)return O}x=n[g+8],x!==kr&&VS(r,n[se].data[g+8]===E)&&ET(l,g,n)?(h=D,g=ac(x),n=ko(x,n)):g=-1}}return s}function xx(e,n,t,r,s,l){const h=n[se],g=h.data[e+8],D=E0(g,h,t,null==r?dr(g)&&fo:r!=h&&!!(3&g.type),s&Gr.Host&&l===g);return null!==D?Gd(n,h,D,g):Oc}function E0(e,n,t,r,s){const l=e.providerIndexes,h=n.data,g=1048575&l,x=e.directiveStart,D=l>>20,N=s?g+D:e.directiveEnd;for(let B=r?g:g+D;B<N;B++){const W=h[B];if(B<x&&t===W||B>=x&&W.type===t)return B}if(s){const B=h[x];if(B&&Zn(B)&&B.type===t)return x}return null}function Gd(e,n,t,r){let s=e[t];const l=n.data;if(function FS(e){return e instanceof iu}(s)){const h=s;h.resolving&&function l1(e,n){throw n&&n.join(" > "),new Jt(-200,e)}(function ti(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():rr(e)}(l[t]));const g=A1(h.canSeeViewProviders);h.resolving=!0;const E=h.injectImpl?sl(h.injectImpl):null;PS(e,r,Gr.Default);try{s=e[t]=h.factory(void 0,l,e,r),n.firstCreatePass&&t>=r.directiveStart&&function b0(e,n,t){const{ngOnChanges:r,ngOnInit:s,ngDoCheck:l}=n.type.prototype;if(r){const h=cT(n);(t.preOrderHooks??=[]).push(e,h),(t.preOrderCheckHooks??=[]).push(e,h)}s&&(t.preOrderHooks??=[]).push(0-e,s),l&&((t.preOrderHooks??=[]).push(e,l),(t.preOrderCheckHooks??=[]).push(e,l))}(t,l[t],n)}finally{null!==E&&sl(E),A1(g),h.resolving=!1,Ph()}}return s}function ET(e,n,t){return!!(t[n+(e>>_p)]&1<<e)}function VS(e,n){return!(e&Gr.Self||e&Gr.Host&&n)}class vo{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,r){return Lh(this._tNode,this._lView,n,xh(r),t)}}function jS(){return new vo(rs(),jt())}function Cs(e){return Pa(()=>{const n=e.prototype.constructor,t=n[Qs]||Bh(n),r=Object.prototype;let s=Object.getPrototypeOf(e.prototype).constructor;for(;s&&s!==r;){const l=s[Qs]||Bh(s);if(l&&l!==t)return l;s=Object.getPrototypeOf(s)}return l=>new l})}function Bh(e){return wm(e)?()=>{const n=Bh(Tr(e));return n&&n()}:bh(e)}function HS(e){const n=e[se],t=n.type;return 2===t?n.declTNode:1===t?e[_e]:null}function jl(e){return function zS(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const r=t.length;let s=0;for(;s<r;){const l=t[s];if(Yv(l))break;if(0===l)s+=2;else if("number"==typeof l)for(s++;s<r&&"string"==typeof t[s];)s++;else{if(l===n)return t[s+1];s+=2}}}return null}(rs(),e)}function Yi(e,n=null,t=null,r){const s=YS(e,n,t,r);return s.resolveInjectorInitializers(),s}function YS(e,n=null,t=null,r,s=new Set){const l=[t||mi,oT(e)];return r=r||("object"==typeof e?void 0:Ts(e)),new zd(l,n||Pu(),r||null,s)}class xs{static#e=this.THROW_IF_NOT_FOUND=Mu;static#t=this.NULL=new Im;static create(n,t){if(Array.isArray(n))return Yi({name:""},t,n,"");{const r=n.name??"";return Yi({name:r},n.parent,n.providers,r)}}static#n=this.\u0275prov=sn({token:xs,providedIn:"any",factory:()=>Dn(d1)});static#r=this.__NG_ELEMENT_ID__=-1}new Gt("").__NG_ELEMENT_ID__=e=>{const n=rs();if(null===n)throw new Jt(204,!1);if(2&n.type)return n.value;if(e&Gr.Optional)return null;throw new Jt(204,!1)};function IT(e){return e.ngOriginalError}class lc{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&IT(n);for(;t&&IT(t);)t=IT(t);return t||null}}const Nu=new Gt("",{providedIn:"root",factory:()=>Xe(lc).handleError.bind(void 0)});let ja=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=QS;static#t=this.__NG_ENV_ID__=t=>t}return e})();class JS extends ja{constructor(n){super(),this._lView=n}onDestroy(n){return g0(this._lView,n),()=>function w1(e,n){if(null===e[gt])return;const t=e[gt].indexOf(n);-1!==t&&e[gt].splice(t,1)}(this._lView,n)}}function QS(){return new JS(jt())}function N1(){return vp(rs(),jt())}function vp(e,n){return new Di(fa(e,n))}let Di=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=N1}return e})();function PT(e){return e instanceof Di?e.nativeElement:e}let zh=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Vo(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275prov=sn({token:e,providedIn:"root",factory:()=>new e})}return e})();const ir=class tD extends Ii{constructor(n=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=n,y()&&(this.destroyRef=Xe(ja,{optional:!0})??void 0,this.pendingTasks=Xe(zh,{optional:!0})??void 0)}emit(n){const t=_r(null);try{super.next(n)}finally{_r(t)}}subscribe(n,t,r){let s=n,l=t||(()=>null),h=r;if(n&&"object"==typeof n){const x=n;s=x.next?.bind(x),l=x.error?.bind(x),h=x.complete?.bind(x)}this.__isAsync&&(l=this.wrapInTimeout(l),s&&(s=this.wrapInTimeout(s)),h&&(h=this.wrapInTimeout(h)));const g=super.subscribe({next:s,error:l,complete:h});return n instanceof dn&&n.add(g),g}wrapInTimeout(n){return t=>{const r=this.pendingTasks?.add();setTimeout(()=>{n(t),void 0!==r&&this.pendingTasks?.remove(r)})}}};function nD(){return this._results[Symbol.iterator]()}class NT{static#e=Symbol.iterator;get changes(){return this._changes??=new ir}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const t=NT.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=nD)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){this.dirty=!1;const r=function Mo(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function Am(e,n,t){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++){let s=e[r],l=n[r];if(t&&(s=t(s),l=t(l)),l!==s)return!1}return!0}(this._results,r,t))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function Tx(e){return!(128&~e.flags)}const BT=new Map;let aO=0;const B1="__ngContext__";function Oo(e,n){wr(n)?(e[B1]=n[Oe],function iD(e){BT.set(e[Oe],e)}(n)):e[B1]=n}function Cx(e){return qm(e[Je])}function cD(e){return qm(e[be])}function qm(e){for(;null!==e&&!ur(e);)e=e[be];return e}let Ax;const Tp=new Gt("",{providedIn:"root",factory:()=>Uh}),Uh="ng",GT=new Gt(""),Ep=new Gt("",{providedIn:"platform",factory:()=>"unknown"}),mD=new Gt("",{providedIn:"root",factory:()=>function Wd(){if(void 0!==Ax)return Ax;if(typeof document<"u")return document;throw new Jt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let H1=()=>null;function Nx(e,n,t=!1){return H1(e,n,t)}const ED=new Gt("",{providedIn:"root",factory:()=>!1});let X1,K1;function Vh(){if(void 0===X1&&(X1=null,ls.trustedTypes))try{X1=ls.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return X1}function jh(e){return Vh()?.createHTML(e)||e}function DD(e){return function jx(){if(void 0===K1&&(K1=null,ls.trustedTypes))try{K1=ls.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return K1}()?.createScriptURL(e)||e}class Zm{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${bm})`}}class MD extends Zm{getTypeName(){return"HTML"}}class $x extends Zm{getTypeName(){return"Style"}}class AD extends Zm{getTypeName(){return"Script"}}class bO extends Zm{getTypeName(){return"URL"}}class ID extends Zm{getTypeName(){return"ResourceURL"}}function $l(e){return e instanceof Zm?e.changingThisBreaksApplicationSecurity:e}function Fu(e,n){const t=function kD(e){return e instanceof Zm&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${bm})`)}return t===n}class J1{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const t=(new window.DOMParser).parseFromString(jh(n),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(n):(t.removeChild(t.firstChild),t)}catch{return null}}}class FD{constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){const t=this.inertDocument.createElement("template");return t.innerHTML=jh(n),t}}const TO=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Hx(e){return(e=String(e)).match(TO)?e:"unsafe:"+e}function Yd(e){const n={};for(const t of e.split(","))n[t]=!0;return n}function Q1(...e){const n={};for(const t of e)for(const r in t)t.hasOwnProperty(r)&&(n[r]=!0);return n}const BD=Yd("area,br,col,hr,img,wbr"),zD=Yd("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),UD=Yd("rp,rt"),iE=Q1(BD,Q1(zD,Yd("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Q1(UD,Yd("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Q1(UD,zD)),sE=Yd("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),VD=Q1(sE,Yd("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Yd("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),jD=Yd("script,style,template");class SO{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let t=n.firstChild,r=!0,s=[];for(;t;)if(t.nodeType===Node.ELEMENT_NODE?r=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,r&&t.firstChild)s.push(t),t=Gx(t);else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let l=MO(t);if(l){t=l;break}t=s.pop()}return this.buf.join("")}startElement(n){const t=oE(n).toLowerCase();if(!iE.hasOwnProperty(t))return this.sanitizedSomething=!0,!jD.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const r=n.attributes;for(let s=0;s<r.length;s++){const l=r.item(s),h=l.name,g=h.toLowerCase();if(!VD.hasOwnProperty(g)){this.sanitizedSomething=!0;continue}let x=l.value;sE[g]&&(x=Hx(x)),this.buf.push(" ",h,'="',lE(x),'"')}return this.buf.push(">"),!0}endElement(n){const t=oE(n).toLowerCase();iE.hasOwnProperty(t)&&!BD.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(n){this.buf.push(lE(n))}}function MO(e){const n=e.nextSibling;if(n&&e!==n.previousSibling)throw aE(n);return n}function Gx(e){const n=e.firstChild;if(n&&function DO(e,n){return(e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}(e,n))throw aE(n);return n}function oE(e){const n=e.nodeName;return"string"==typeof n?n:"FORM"}function aE(e){return new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`)}const $D=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,HD=/([^\#-~ |!])/g;function lE(e){return e.replace(/&/g,"&amp;").replace($D,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(HD,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let ey;function cE(e,n){let t=null;try{ey=ey||function rE(e){const n=new FD(e);return function LD(){try{return!!(new window.DOMParser).parseFromString(jh(""),"text/html")}catch{return!1}}()?new J1(n):n}(e);let r=n?String(n):"";t=ey.getInertBodyElement(r);let s=5,l=r;do{if(0===s)throw new Error("Failed to sanitize html because the input is unstable");s--,r=l,l=t.innerHTML,t=ey.getInertBodyElement(r)}while(r!==l);return jh((new SO).sanitizeChildren(Wx(t)||t))}finally{if(t){const r=Wx(t)||t;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function Wx(e){return"content"in e&&function GD(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var ou=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(ou||{});function Gi(e){const n=ty();return n?n.sanitize(ou.URL,e)||"":Fu(e,"URL")?$l(e):Hx(rr(e))}function Kd(e){const n=ty();if(n)return DD(n.sanitize(ou.RESOURCE_URL,e)||"");if(Fu(e,"ResourceURL"))return DD($l(e));throw new Jt(904,!1)}function Lu(e){return function Ux(e){return Vh()?.createScriptURL(e)||e}(e[0])}function ty(){const e=jt();return e&&e[ke].sanitizer}const AO=/^>|^->|<!--|-->|--!>|<!-$/g,IO=/(<|>)/g,kO="\u200b$1\u200b";function Rc(e){return e instanceof Function?e():e}var Dp=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Dp||{});let Qx;function eb(e,n){return Qx(e,n)}function Xm(e,n,t,r,s){if(null!=r){let l,h=!1;ur(r)?l=r:wr(r)&&(h=!0,r=r[Q]);const g=Hn(r);0===e&&null!==t?null==s?rb(n,t,g):Ha(n,t,g,s||null,!0):1===e&&null!==t?Ha(n,t,g,s||null,!0):2===e?function Jm(e,n,t){const r=Km(e,n);r&&function Mp(e,n,t,r){e.removeChild(n,t,r)}(e,r,n,t)}(n,g,h):3===e&&n.destroyNode(g),null!=l&&function sb(e,n,t,r,s){const l=t[Yn];l!==Hn(t)&&Xm(n,e,r,l,s);for(let g=Kn;g<t.length;g++){const x=t[g];zu(x[se],x,e,n,r,l)}}(n,e,l,t,s)}}function Bu(e,n){return e.createComment(function XD(e){return e.replace(AO,n=>n.replace(IO,kO))}(n))}function ry(e,n,t){return e.createElement(n,t)}function yE(e,n){n[ke].changeDetectionScheduler?.notify(8),zu(e,n,n[pe],2,null,null)}function vE(e,n){const t=e[or],r=n[de];(wr(r)||n[pt]!==r[de][pt])&&(e[ce]|=Si.HasTransplantedViews),null===t?e[or]=[n]:t.push(n)}function tb(e,n){const t=e[or],r=t.indexOf(n);t.splice(r,1)}function j0(e,n){if(e.length<=Kn)return;const t=Kn+n,r=e[t];if(r){const s=r[mt];null!==s&&s!==e&&tb(s,r),n>0&&(e[t-1][be]=r[be]);const l=ua(e,Kn+n);!function rM(e,n){yE(e,n),n[Q]=null,n[_e]=null}(r[se],r);const h=l[nt];null!==h&&h.detachView(l[se]),r[de]=null,r[be]=null,r[ce]&=-129}return r}function $a(e,n){if(!(256&n[ce])){const t=n[pe];t.destroyNode&&zu(e,n,t,3,null,null),function BO(e){let n=e[Je];if(!n)return iy(e[se],e);for(;n;){let t=null;if(wr(n))t=n[Je];else{const r=n[Kn];r&&(t=r)}if(!t){for(;n&&!n[be]&&n!==e;)wr(n)&&iy(n[se],n),n=n[de];null===n&&(n=e),wr(n)&&iy(n[se],n),t=n&&n[be]}n=t}}(n)}}function iy(e,n){if(256&n[ce])return;const t=_r(null);try{n[ce]&=-129,n[ce]|=256,n[Vt]&&sa(n[Vt]),function sy(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let r=0;r<t.length;r+=2){const s=n[t[r]];if(!(s instanceof iu)){const l=t[r+1];if(Array.isArray(l))for(let h=0;h<l.length;h+=2){const g=s[l[h]],x=l[h+1];Ih(4,g,x);try{x.call(g)}finally{Ih(5,g,x)}}else{Ih(4,s,l);try{l.call(s)}finally{Ih(5,s,l)}}}}}(e,n),function sM(e,n){const t=e.cleanup,r=n[De];if(null!==t)for(let l=0;l<t.length-1;l+=2)if("string"==typeof t[l]){const h=t[l+3];h>=0?r[h]():r[-h].unsubscribe(),l+=2}else t[l].call(r[t[l+1]]);null!==r&&(n[De]=null);const s=n[gt];if(null!==s){n[gt]=null;for(let l=0;l<s.length;l++)(0,s[l])()}}(e,n),1===n[se].type&&n[pe].destroy();const r=n[mt];if(null!==r&&ur(n[de])){r!==n[de]&&tb(r,n);const s=n[nt];null!==s&&s.detachView(e)}!function UT(e){BT.delete(e[Oe])}(n)}finally{_r(t)}}function nb(e,n,t){return function xE(e,n,t){let r=n;for(;null!==r&&168&r.type;)r=(n=r).parent;if(null===r)return t[Q];{const{componentOffset:s}=r;if(s>-1){const{encapsulation:l}=e.data[r.directiveStart+s];if(l===Ol.None||l===Ol.Emulated)return null}return fa(r,t)}}(e,n.parent,t)}function Ha(e,n,t,r,s){e.insertBefore(n,t,r,s)}function rb(e,n,t){e.appendChild(n,t)}function Ym(e,n,t,r,s){null!==r?Ha(e,n,t,r,s):rb(e,n,t)}function Km(e,n){return e.parentNode(n)}function oy(e,n,t){return aM(e,n,t)}let bE,aM=function ay(e,n,t){return 40&e.type?fa(e,t):null};function Qd(e,n,t,r){const s=nb(e,r,n),l=n[pe],g=oy(r.parent||n[_e],r,n);if(null!=s)if(Array.isArray(t))for(let x=0;x<t.length;x++)Ym(l,s,t[x],g,!1);else Ym(l,s,t,g,!1);void 0!==bE&&bE(l,r,n,t,s)}function Ap(e,n){if(null!==n){const t=n.type;if(3&t)return fa(n,e);if(4&t)return ib(-1,e[n.index]);if(8&t){const r=n.child;if(null!==r)return Ap(e,r);{const s=e[n.index];return ur(s)?ib(-1,s):Hn(s)}}if(32&t)return eb(n,e)()||Hn(e[n.index]);{const r=cM(e,n);return null!==r?Array.isArray(r)?r[0]:Ap(cs(e[pt]),r):Ap(e,n.next)}}return null}function cM(e,n){return null!==n?e[pt][_e].projection[n.projection]:null}function ib(e,n){const t=Kn+e+1;if(t<n.length){const r=n[t],s=r[se].firstChild;if(null!==s)return Ap(r,s)}return n[Yn]}function Qm(e,n,t,r,s,l,h){for(;null!=t;){if(128===t.type){t=t.next;continue}const g=r[t.index],x=t.type;if(h&&0===n&&(g&&Oo(Hn(g),r),t.flags|=2),32&~t.flags)if(8&x)Qm(e,n,t.child,r,s,l,!1),Xm(n,e,s,g,l);else if(32&x){const E=eb(t,r);let D;for(;D=E();)Xm(n,e,s,D,l);Xm(n,e,s,g,l)}else 16&x?wE(e,n,r,t,s,l):Xm(n,e,s,g,l);t=h?t.projectionNext:t.next}}function zu(e,n,t,r,s,l){Qm(t,r,e.firstChild,n,s,l,!1)}function wE(e,n,t,r,s,l){const h=t[pt],x=h[_e].projection[r.projection];if(Array.isArray(x))for(let E=0;E<x.length;E++)Xm(n,e,s,x[E],l);else{let E=x;const D=h[de];Tx(r)&&(E.flags|=128),Qm(e,n,E,D,s,l,!0)}}function EE(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function Ip(e,n,t){const{mergedAttrs:r,classes:s,styles:l}=t;null!==r&&f1(e,n,r),null!==s&&EE(e,n,s),null!==l&&function VO(e,n,t){e.setAttribute(n,"style",t)}(e,n,l)}const qr={};function Te(e=1){ef(hi(),jt(),no()+e,!1)}function ef(e,n,t,r){if(!r)if(3&~n[ce]){const l=e.preOrderHooks;null!==l&&Ul(n,l,0,t)}else{const l=e.preOrderCheckHooks;null!==l&&zl(n,l,t)}oc(t)}function xt(e,n=Gr.Default){const t=jt();return null===t?Dn(e,n):Lh(rs(),t,Tr(e),n)}function H0(e,n,t,r,s,l){const h=_r(null);try{let g=null;s&Rl.SignalBased&&(g=n[r][as]),null!==g&&void 0!==g.transformFn&&(l=g.transformFn(l)),s&Rl.HasDecoratorInputTransform&&(l=e.inputTransforms[r].call(n,l)),null!==e.setInput?e.setInput(n,g,l,t,r):Vd(n,g,r,l)}finally{_r(h)}}function kp(e,n,t,r,s,l,h,g,x,E,D){const O=n.blueprint.slice();return O[Q]=s,O[ce]=204|r,(null!==E||e&&2048&e[ce])&&(O[ce]|=2048),ox(O),O[de]=O[Pe]=e,O[Ee]=t,O[ke]=h||e&&e[ke],O[pe]=g||e&&e[pe],O[Be]=x||e&&e[Be]||null,O[_e]=l,O[Oe]=function rD(){return aO++}(),O[ye]=D,O[_t]=E,O[pt]=2==n.type?e[pt]:O,O}function Hh(e,n,t,r,s){let l=e.data[n];if(null===l)l=function CE(e,n,t,r,s){const l=gT(),h=ux(),x=e.data[n]=function ab(e,n,t,r,s,l){let h=n?n.injectorIndex:-1,g=0;return Oh()&&(g|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:h,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:g,providerIndexes:0,value:s,attrs:l,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,h?l:l&&l.parent,t,n,r,s);return null===e.firstChild&&(e.firstChild=x),null!==l&&(h?null==l.child&&null!==x.parent&&(l.child=x):null===l.next&&(l.next=x,x.prev=l)),x}(e,n,t,r,s),function fx(){return Rr.lFrame.inI18n}()&&(l.flags|=32);else if(64&l.type){l.type=t,l.value=r,l.attrs=s;const h=function y0(){const e=Rr.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();l.injectorIndex=null===h?-1:h.injectorIndex}return ru(l,!0),l}function cy(e,n,t,r){if(0===t)return-1;const s=n.length;for(let l=0;l<t;l++)n.push(r),e.blueprint.push(r),e.data.push(null);return s}function eg(e,n,t,r,s){const l=no(),h=2&r;try{oc(-1),h&&n.length>bt&&ef(e,n,bt,!1),Ih(h?2:0,s),t(r,s)}finally{oc(l),Ih(h?3:1,s)}}function G0(e,n,t){if(ni(n)){const r=_r(null);try{const l=n.directiveEnd;for(let h=n.directiveStart;h<l;h++){const g=e.data[h];g.contentQueries&&g.contentQueries(1,t[h],h)}}finally{_r(r)}}}function SE(e,n,t){cx()&&(function Wh(e,n,t,r){const s=t.directiveStart,l=t.directiveEnd;dr(t)&&function dy(e,n,t){const r=fa(n,e),s=DE(t);let h=16;t.signals?h=4096:t.onPush&&(h=64);const g=tg(e,kp(e,s,null,h,r,n,null,e[ke].rendererFactory.createRenderer(r,t),null,null,null));e[n.index]=g}(n,t,e.data[s+t.componentOffset]),e.firstCreatePass||T0(t,n),Oo(r,n);const h=t.initialInputs;for(let g=s;g<l;g++){const x=e.data[g],E=Gd(n,e,g,t);Oo(E,n),null!==h&&OE(0,g-s,E,x,0,h),Zn(x)&&(Io(t.index,n)[Ee]=Gd(n,e,g,t))}}(e,n,t,fa(t,n)),!(64&~t.flags)&&tf(e,n,t))}function ob(e,n,t=fa){const r=n.localNames;if(null!==r){let s=n.index+1;for(let l=0;l<r.length;l+=2){const h=r[l+1],g=-1===h?t(n,e):e[h];e[s++]=g}}}function DE(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=ME(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function ME(e,n,t,r,s,l,h,g,x,E,D){const O=bt+r,N=O+s,B=function dM(e,n){const t=[];for(let r=0;r<n;r++)t.push(r<e?null:qr);return t}(O,N),W="function"==typeof E?E():E;return B[se]={type:e,blueprint:B,template:t,queries:null,viewQuery:g,declTNode:n,data:B.slice().fill(null,O),bindingStartIndex:O,expandoStartIndex:N,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof l?l():l,pipeRegistry:"function"==typeof h?h():h,firstChild:null,schemas:x,consts:W,incompleteFirstPass:!1,ssrId:D}}let pM=()=>null;function uy(e,n,t,r,s){for(let l in n){if(!n.hasOwnProperty(l))continue;const h=n[l];if(void 0===h)continue;r??={};let g,x=Rl.None;Array.isArray(h)?(g=h[0],x=h[1]):g=h;let E=l;if(null!==s){if(!s.hasOwnProperty(l))continue;E=s[l]}0===e?hy(r,t,E,g,x):hy(r,t,E,g)}return r}function hy(e,n,t,r,s){let l;e.hasOwnProperty(t)?(l=e[t]).push(n,r):l=e[t]=[n,r],void 0!==s&&l.push(s)}function cl(e,n,t,r,s,l,h,g){const x=fa(n,t);let D,E=n.inputs;!g&&null!=E&&(D=E[r])?(NE(e,t,D,r,s),dr(n)&&function AE(e,n){const t=Io(n,e);16&t[ce]||(t[ce]|=64)}(t,n.index)):3&n.type&&(r=function GO(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),s=null!=h?h(s,n.value||"",r):s,l.setProperty(x,r,s))}function q0(e,n,t,r){if(cx()){const s=null===r?null:{"":-1},l=function gM(e,n){const t=e.directiveRegistry;let r=null,s=null;if(t)for(let l=0;l<t.length;l++){const h=t[l];if(Qf(n,h.selectors,!1))if(r||(r=[]),Zn(h))if(null!==h.findHostDirectiveDefs){const g=[];s=s||new Map,h.findHostDirectiveDefs(h,g,s),r.unshift(...g,h),Z0(e,n,g.length)}else r.unshift(h),Z0(e,n,0);else s=s||new Map,h.findHostDirectiveDefs?.(h,r,s),r.push(h)}return null===r?null:[r,s]}(e,t);let h,g;null===l?h=g=null:[h,g]=l,null!==h&&Pc(e,n,t,h,s,g),s&&function WO(e,n,t){if(n){const r=e.localNames=[];for(let s=0;s<n.length;s+=2){const l=t[n[s+1]];if(null==l)throw new Jt(-301,!1);r.push(n[s],l)}}}(t,r,s)}t.mergedAttrs=Jf(t.mergedAttrs,t.attrs)}function Pc(e,n,t,r,s,l){for(let E=0;E<r.length;E++)I1(T0(t,n),e,r[E].type);!function IE(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,r.length);for(let E=0;E<r.length;E++){const D=r[E];D.providersResolver&&D.providersResolver(D)}let h=!1,g=!1,x=cy(e,n,r.length,null);for(let E=0;E<r.length;E++){const D=r[E];t.mergedAttrs=Jf(t.mergedAttrs,D.hostAttrs),kE(e,t,n,x,D),X0(x,D,s),null!==D.contentQueries&&(t.flags|=4),(null!==D.hostBindings||null!==D.hostAttrs||0!==D.hostVars)&&(t.flags|=64);const O=D.type.prototype;!h&&(O.ngOnChanges||O.ngOnInit||O.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),h=!0),!g&&(O.ngOnChanges||O.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),g=!0),x++}!function lb(e,n,t){const s=n.directiveEnd,l=e.data,h=n.attrs,g=[];let x=null,E=null;for(let D=n.directiveStart;D<s;D++){const O=l[D],N=t?t.get(O):null,W=N?N.outputs:null;x=uy(0,O.inputs,D,x,N?N.inputs:null),E=uy(1,O.outputs,D,E,W);const V=null===x||null===h||Pd(n)?null:Vu(x,D,h);g.push(V)}null!==x&&(x.hasOwnProperty("class")&&(n.flags|=8),x.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=g,n.inputs=x,n.outputs=E}(e,t,l)}function tf(e,n,t){const r=t.directiveStart,s=t.directiveEnd,l=t.index,h=function yT(){return Rr.lFrame.currentDirectiveIndex}();try{oc(l);for(let g=r;g<s;g++){const x=e.data[g],E=n[g];C1(g),(null!==x.hostBindings||0!==x.hostVars||null!==x.hostAttrs)&&cb(x,E)}}finally{oc(-1),C1(h)}}function cb(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function Z0(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function X0(e,n,t){if(t){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)t[n.exportAs[r]]=e;Zn(n)&&(t[""]=e)}}function kE(e,n,t,r,s){e.data[r]=s;const l=s.factory||(s.factory=bh(s.type)),h=new iu(l,Zn(s),xt);e.blueprint[r]=h,t[r]=h,function Gh(e,n,t,r,s){const l=s.hostBindings;if(l){let h=e.hostBindingOpCodes;null===h&&(h=e.hostBindingOpCodes=[]);const g=~n.index;(function Op(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(h)!=g&&h.push(g),h.push(t,r,l)}}(e,n,r,cy(e,t,s.hostVars,qr),s)}function io(e,n,t,r,s,l){const h=fa(e,n);!function fy(e,n,t,r,s,l,h){if(null==l)e.removeAttribute(n,s,t);else{const g=null==h?rr(l):h(l,r||"",s);e.setAttribute(n,s,g,t)}}(n[pe],h,l,e.value,t,r,s)}function OE(e,n,t,r,s,l){const h=l[n];if(null!==h)for(let g=0;g<h.length;)H0(r,t,h[g++],h[g++],h[g++],h[g++])}function Vu(e,n,t){let r=null,s=0;for(;s<t.length;){const l=t[s];if(0!==l)if(5!==l){if("number"==typeof l)break;if(e.hasOwnProperty(l)){null===r&&(r=[]);const h=e[l];for(let g=0;g<h.length;g+=3)if(h[g]===n){r.push(l,h[g+1],h[g+2],t[s+1]);break}}s+=2}else s+=2;else s+=4}return r}function _M(e,n,t,r){return[e,!0,0,n,null,r,null,t,null,null]}function RE(e,n){const t=e.contentQueries;if(null!==t){const r=_r(null);try{for(let s=0;s<t.length;s+=2){const h=t[s+1];if(-1!==h){const g=e.data[h];dp(t[s]),g.contentQueries(2,n[h],h)}}}finally{_r(r)}}}function tg(e,n){return e[Je]?e[Ke][be]=n:e[Je]=n,e[Ke]=n,n}function PE(e,n,t){dp(0);const r=_r(null);try{n(e,t)}finally{_r(r)}}function yM(e){return e[De]??=[]}function vM(e){return e.cleanup??=[]}function ub(e,n){const t=e[Be],r=t?t.get(lc,null):null;r&&r.handleError(n)}function NE(e,n,t,r,s){for(let l=0;l<t.length;){const h=t[l++],g=t[l++],x=t[l++];H0(e.data[h],n[h],r,g,x,s)}}function nf(e,n,t){const r=Ll(n,e);!function _E(e,n,t){e.setValue(n,t)}(e[pe],r,t)}function qO(e,n){const t=Io(n,e),r=t[se];!function ZO(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(r,t);const s=t[Q];null!==s&&null===t[ye]&&(t[ye]=Nx(s,t[Be])),FE(r,t,t[Ee])}function FE(e,n,t){S1(n);try{const r=e.viewQuery;null!==r&&PE(1,r,t);const s=e.template;null!==s&&eg(e,n,s,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),n[nt]?.finishViewCreation(e),e.staticContentQueries&&RE(e,n),e.staticViewQueries&&PE(2,e.viewQuery,t);const l=e.components;null!==l&&function XO(e,n){for(let t=0;t<n.length;t++)qO(e,n[t])}(n,l)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{n[ce]&=-5,kc()}}function ga(e,n,t,r){const s=_r(null);try{const l=n.tView,x=kp(e,l,t,4096&e[ce]?4096:16,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null);x[mt]=e[n.index];const D=e[nt];return null!==D&&(x[nt]=D.createEmbeddedView(l)),FE(l,x,t),x}finally{_r(s)}}function Y0(e,n){const t=Kn+n;if(t<e.length)return e[t]}function ng(e,n){return!n||null===n.firstChild||Tx(e)}function rg(e,n,t,r=!0){const s=n[se];if(function zO(e,n,t,r){const s=Kn+r,l=t.length;r>0&&(t[s-1][be]=n),r<l-Kn?(n[be]=t[s],s0(t,Kn+r,n)):(t.push(n),n[be]=null),n[de]=t;const h=n[mt];null!==h&&t!==h&&vE(h,n);const g=n[nt];null!==g&&g.insertView(e),b1(n),n[ce]|=128}(s,n,e,t),r){const h=ib(t,e),g=n[pe],x=Km(g,e[Yn]);null!==x&&function iM(e,n,t,r,s,l){r[Q]=s,r[_e]=n,zu(e,r,t,1,s,l)}(s,e[_e],g,n,x,h)}const l=n[ye];null!==l&&null!==l.firstChild&&(l.firstChild=null)}function hb(e,n){const t=j0(e,n);return void 0!==t&&$a(t[se],t),t}function py(e,n,t,r,s=!1){for(;null!==t;){if(128===t.type){t=s?t.projectionNext:t.next;continue}const l=n[t.index];null!==l&&r.push(Hn(l)),ur(l)&&LE(l,r);const h=t.type;if(8&h)py(e,n,t.child,r);else if(32&h){const g=eb(t,n);let x;for(;x=g();)r.push(x)}else if(16&h){const g=cM(n,t);if(Array.isArray(g))r.push(...g);else{const x=cs(n[pt]);py(x[se],x,g,r,!0)}}t=s?t.projectionNext:t.next}return r}function LE(e,n){for(let t=Kn;t<e.length;t++){const r=e[t],s=r[se].firstChild;null!==s&&py(r[se],r,s,n)}e[Yn]!==e[Q]&&n.push(e[Yn])}let BE=[];const wM={...Pr,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{jm(e.lView)},consumerOnSignalRead(){this.lView[Vt]=this}},K0={...Pr,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{let n=cs(e.lView);for(;n&&!J0(n[se]);)n=cs(n);n&&ax(n)},consumerOnSignalRead(){this.lView[Vt]=this}};function J0(e){return 2!==e.type}const my=100;function gy(e,n=!0,t=0){const r=e[ke],s=r.rendererFactory;s.begin?.();try{!function JO(e,n){const t=OS();try{RS(!0),VE(e,n);let r=0;for(;nu(e);){if(r===my)throw new Jt(103,!1);r++,VE(e,1)}}finally{RS(t)}}(e,t)}catch(h){throw n&&ub(e,h),h}finally{s.end?.(),r.inlineEffectRunner?.flush()}}function zE(e,n,t,r){const s=n[ce];if(!(256&~s))return;n[ke].inlineEffectRunner?.flush(),S1(n);let g=!0,x=null,E=null;J0(e)?(E=function bM(e){return e[Vt]??function YO(e){const n=BE.pop()??Object.create(wM);return n.lView=e,n}(e)}(n),x=xi(E)):null===function qn(){return ts}()?(g=!1,E=function Vs(e){const n=e[Vt]??Object.create(K0);return n.lView=e,n}(n),x=xi(E)):n[Vt]&&(sa(n[Vt]),n[Vt]=null);try{ox(n),function dx(e){return Rr.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&eg(e,n,t,2,r);const D=!(3&~s);if(D){const B=e.preOrderCheckHooks;null!==B&&zl(n,B,null)}else{const B=e.preOrderHooks;null!==B&&Ul(n,B,0,null),pp(n,0)}if(function UE(e){for(let n=Cx(e);null!==n;n=cD(n)){if(!(n[ce]&Si.HasTransplantedViews))continue;const t=n[or];for(let r=0;r<t.length;r++)ax(t[r])}}(n),au(n,0),null!==e.contentQueries&&RE(e,n),D){const B=e.contentCheckHooks;null!==B&&zl(n,B)}else{const B=e.contentHooks;null!==B&&Ul(n,B,1),pp(n,1)}!function ly(e,n){const t=e.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const s=t[r];if(s<0)oc(~s);else{const l=s,h=t[++r],g=t[++r];Hd(h,l),g(2,n[l])}}}finally{oc(-1)}}(e,n);const O=e.components;null!==O&&EM(n,O,0);const N=e.viewQuery;if(null!==N&&PE(2,N,r),D){const B=e.viewCheckHooks;null!==B&&zl(n,B)}else{const B=e.viewHooks;null!==B&&Ul(n,B,2),pp(n,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[Wt]){for(const B of n[Wt])B();n[Wt]=null}n[ce]&=-73}catch(D){throw jm(n),D}finally{null!==E&&(Ai(E,x),g&&function KO(e){e.lView[Vt]!==e&&(e.lView=null,BE.push(e))}(E)),kc()}}function au(e,n){for(let t=Cx(e);null!==t;t=cD(t))for(let r=Kn;r<t.length;r++)lu(t[r],n)}function QO(e,n,t){lu(Io(n,e),t)}function lu(e,n){kh(e)&&VE(e,n)}function VE(e,n){const r=e[se],s=e[ce],l=e[Vt];let h=!!(0===n&&16&s);if(h||=!!(64&s&&0===n),h||=!!(1024&s),h||=!(!l?.dirty||!Ks(l)),h||=!1,l&&(l.dirty=!1),e[ce]&=-9217,h)zE(r,e,r.template,e[Ee]);else if(8192&s){au(e,1);const g=r.components;null!==g&&EM(e,g,1)}}function EM(e,n,t){for(let r=0;r<n.length;r++)QO(e,n[r],t)}function _y(e,n){const t=OS()?64:1088;for(e[ke].changeDetectionScheduler?.notify(n);e;){e[ce]|=t;const r=cs(e);if(Ir(e)&&!r)return e;e=r}return null}class ul{get rootNodes(){const n=this._lView,t=n[se];return py(t,n,t.firstChild,[])}constructor(n,t,r=!0){this._lView=n,this._cdRefInjectingView=t,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ee]}set context(n){this._lView[Ee]=n}get destroyed(){return!(256&~this._lView[ce])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[de];if(ur(n)){const t=n[8],r=t?t.indexOf(this):-1;r>-1&&(j0(n,r),ua(t,r))}this._attachedToViewContainer=!1}$a(this._lView[se],this._lView)}onDestroy(n){g0(this._lView,n)}markForCheck(){_y(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[ce]&=-129}reattach(){b1(this._lView),this._lView[ce]|=128}detectChanges(){this._lView[ce]|=1024,gy(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Jt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const n=Ir(this._lView),t=this._lView[mt];null!==t&&!n&&tb(t,this._lView),yE(this._lView[se],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Jt(902,!1);this._appRef=n;const t=Ir(this._lView),r=this._lView[mt];null!==r&&!t&&vE(r,this._lView),b1(this._lView)}}let si=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=jE}return e})();const CM=si,eR=class extends CM{constructor(n,t,r){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,r){const s=ga(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:t,dehydratedView:r});return new ul(s)}};function jE(){return Q0(rs(),jt())}function Q0(e,n){return 4&e.type?new eR(n,e,vp(e,n)):null}let HM=()=>null;function Fp(e,n){return HM(e,n)}class fg{}const s_=new Gt("",{providedIn:"root",factory:()=>!1}),l2=new Gt("");class dR{}class c2{}class GM{resolveComponentFactory(n){throw function pg(e){const n=Error(`No component factory found for ${Ts(e)}.`);return n.ngComponent=e,n}(n)}}class Ab{static#e=this.NULL=new GM}class u2{}let qh=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function WM(){const e=jt(),t=Io(rs().index,e);return(wr(t)?t:e)[pe]}()}return e})(),fR=(()=>{class e{static#e=this.\u0275prov=sn({token:e,providedIn:"root",factory:()=>null})}return e})();const Ib=new Set;function xo(e){Ib.has(e)||(Ib.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function h2(e){let n=!0;return setTimeout(()=>{n&&(n=!1,e())}),"function"==typeof ls.requestAnimationFrame&&ls.requestAnimationFrame(()=>{n&&(n=!1,e())}),()=>{n=!1}}function d2(e){let n=!0;return queueMicrotask(()=>{n&&e()}),()=>{n=!1}}function f2(...e){}class Qr{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ir(!1),this.onMicrotaskEmpty=new ir(!1),this.onStable=new ir(!1),this.onError=new ir(!1),typeof Zone>"u")throw new Jt(908,!1);Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&t,s.shouldCoalesceRunChangeDetection=r,s.callbackScheduled=!1,function qM(e){const n=()=>{!function mR(e){e.isCheckStableRunning||e.callbackScheduled||(e.callbackScheduled=!0,Zone.root.run(()=>{h2(()=>{e.callbackScheduled=!1,m2(e),e.isCheckStableRunning=!0,p2(e),e.isCheckStableRunning=!1})}),m2(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,s,l,h,g)=>{if(function ZM(e){return Ob(e,"__ignore_ng_zone__")}(g))return t.invokeTask(s,l,h,g);try{return g2(e),t.invokeTask(s,l,h,g)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===l.type||e.shouldCoalesceRunChangeDetection)&&n(),kb(e)}},onInvoke:(t,r,s,l,h,g,x)=>{try{return g2(e),t.invoke(s,l,h,g,x)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!function Iy(e){return Ob(e,"__scheduler_tick__")}(g)&&n(),kb(e)}},onHasTask:(t,r,s,l)=>{t.hasTask(s,l),r===s&&("microTask"==l.change?(e._hasPendingMicrotasks=l.microTask,m2(e),p2(e)):"macroTask"==l.change&&(e.hasPendingMacrotasks=l.macroTask))},onHandleError:(t,r,s,l)=>(t.handleError(s,l),e.runOutsideAngular(()=>e.onError.emit(l)),!1)})}(s)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Qr.isInAngularZone())throw new Jt(909,!1)}static assertNotInAngularZone(){if(Qr.isInAngularZone())throw new Jt(909,!1)}run(n,t,r){return this._inner.run(n,t,r)}runTask(n,t,r,s){const l=this._inner,h=l.scheduleEventTask("NgZoneEvent: "+s,n,My,f2,f2);try{return l.runTask(h,t,r)}finally{l.cancelTask(h)}}runGuarded(n,t,r){return this._inner.runGuarded(n,t,r)}runOutsideAngular(n){return this._outer.run(n)}}const My={};function p2(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function m2(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&!0===e.callbackScheduled)}function g2(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function kb(e){e._nesting--,p2(e)}class Ay{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ir,this.onMicrotaskEmpty=new ir,this.onStable=new ir,this.onError=new ir}run(n,t,r){return n.apply(t,r)}runGuarded(n,t,r){return n.apply(t,r)}runOutsideAngular(n){return n()}runTask(n,t,r,s){return n.apply(t,r)}}function Ob(e,n){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0]?.data?.[n]}var o=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(o||{});const i={destroy(){}};function d(e,n){!n&&function c(e){if(!y())throw new Jt(-203,!1)}();const t=n?.injector??Xe(xs);return function Hl(e){return"browser"===(e??Xe(xs)).get(Ep)}(t)?(xo("NgAfterNextRender"),function _(e,n,t,r){const s=function m(e,n){if(e instanceof Function)switch(n){case o.EarlyRead:return{earlyRead:e};case o.Write:return{write:e};case o.MixedReadWrite:return{mixedReadWrite:e};case o.Read:return{read:e}}return e}(e,r),l=n.get(S),h=l.handler??=new T,g=[],x=[],E=()=>{for(const B of x)h.unregister(B);D()},D=n.get(ja).onDestroy(E);let O=0;const N=(B,W)=>{if(!W)return;const V=t?(...le)=>(O--,O<1&&E(),W(...le)):W,X=Ic(n,()=>new b(B,g,V));h.register(X),x.push(X),O++};return N(o.EarlyRead,s.earlyRead),N(o.Write,s.write),N(o.MixedReadWrite,s.mixedReadWrite),N(o.Read,s.read),{destroy:E}}(e,t,!0,n?.phase??o.MixedReadWrite)):i}class b{constructor(n,t,r){this.phase=n,this.pipelinedArgs=t,this.callbackFn=r,this.zone=Xe(Qr),this.errorHandler=Xe(lc,{optional:!0}),Xe(fg,{optional:!0})?.notify(6)}invoke(){try{const n=this.zone.runOutsideAngular(()=>this.callbackFn.apply(null,this.pipelinedArgs));this.pipelinedArgs.splice(0,this.pipelinedArgs.length,n)}catch(n){this.errorHandler?.handleError(n)}}}class T{constructor(){this.executingCallbacks=!1,this.buckets={[o.EarlyRead]:new Set,[o.Write]:new Set,[o.MixedReadWrite]:new Set,[o.Read]:new Set},this.deferredCallbacks=new Set}register(n){(this.executingCallbacks?this.deferredCallbacks:this.buckets[n.phase]).add(n)}unregister(n){this.buckets[n.phase].delete(n),this.deferredCallbacks.delete(n)}execute(){this.executingCallbacks=!0;for(const n of Object.values(this.buckets))for(const t of n)t.invoke();this.executingCallbacks=!1;for(const n of this.deferredCallbacks)this.buckets[n.phase].add(n);this.deferredCallbacks.clear()}destroy(){for(const n of Object.values(this.buckets))n.clear();this.deferredCallbacks.clear()}}let S=(()=>{class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){const t=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const r of t)r()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=sn({token:e,providedIn:"root",factory:()=>new e})}return e})();function we(e,n,t){let r=t?e.styles:null,s=t?e.classes:null,l=0;if(null!==n)for(let h=0;h<n.length;h++){const g=n[h];"number"==typeof g?l=g:1==l?s=Qg(s,g):2==l&&(r=Qg(r,g+": "+n[++h]+";"))}t?e.styles=r:e.stylesWithoutHost=r,t?e.classes=s:e.classesWithoutHost=s}class Se extends Ab{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=Vr(n);return new tt(t,this.ngModule)}}function Fe(e,n){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const s=e[r];if(void 0===s)continue;const l=Array.isArray(s),h=l?s[0]:s;t.push(n?{propName:h,templateName:r,isSignal:!!((l?s[1]:Rl.None)&Rl.SignalBased)}:{propName:h,templateName:r})}return t}class tt extends c2{get inputs(){const n=this.componentDef,t=n.inputTransforms,r=Fe(n.inputs,!0);if(null!==t)for(const s of r)t.hasOwnProperty(s.propName)&&(s.transform=t[s.propName]);return r}get outputs(){return Fe(this.componentDef.outputs,!1)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function Nm(e){return e.map(Pm).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,r,s){const l=_r(null);try{let h=(s=s||this.ngModule)instanceof qo?s:s?.injector;h&&null!==this.componentDef.getStandaloneInjector&&(h=this.componentDef.getStandaloneInjector(h)||h);const g=h?new Gm(n,h):n,x=g.get(u2,null);if(null===x)throw new Jt(407,!1);const E=g.get(fR,null),N={rendererFactory:x,sanitizer:E,inlineEffectRunner:null,afterRenderEventManager:g.get(S,null),changeDetectionScheduler:g.get(fg,null)},B=x.createRenderer(null,this.componentDef),W=this.componentDef.selectors[0][0]||"div",V=r?function jO(e,n,t,r){const l=r.get(ED,!1)||t===Ol.ShadowDom,h=e.selectRootElement(n,l);return function fM(e){pM(e)}(h),h}(B,r,this.componentDef.encapsulation,g):ry(B,W,function Ge(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(W));let X=512;this.componentDef.signals?X|=4096:this.componentDef.onPush||(X|=16);let le=null;null!==V&&(le=Nx(V,g,!0));const oe=ME(0,null,null,1,0,null,null,null,null,null,null),fe=kp(null,oe,null,X,null,null,N,B,g,null,le);let Le,Ze;S1(fe);try{const at=this.componentDef;let Ne,ot=null;at.findHostDirectiveDefs?(Ne=[],ot=new Map,at.findHostDirectiveDefs(at,Ne,ot),Ne.push(at)):Ne=[at];const lt=function ht(e,n){const t=e[se],r=bt;return e[r]=n,Hh(t,r,2,"#host",null)}(fe,V),Tt=function Dt(e,n,t,r,s,l,h){const g=s[se];!function dt(e,n,t,r){for(const s of e)n.mergedAttrs=Jf(n.mergedAttrs,s.hostAttrs);null!==n.mergedAttrs&&(we(n,n.mergedAttrs,!0),null!==t&&Ip(r,t,n))}(r,e,n,h);let x=null;null!==n&&(x=Nx(n,s[Be]));const E=l.rendererFactory.createRenderer(n,t);let D=16;t.signals?D=4096:t.onPush&&(D=64);const O=kp(s,DE(t),null,D,s[e.index],e,l,E,null,null,x);return g.firstCreatePass&&Z0(g,e,r.length-1),tg(s,O),s[e.index]=O}(lt,V,at,Ne,fe,N,B);Ze=Vm(oe,bt),V&&function ut(e,n,t,r){if(r)f1(e,t,["ng-version","18.1.2"]);else{const{attrs:s,classes:l}=function l0(e){const n=[],t=[];let r=1,s=2;for(;r<e.length;){let l=e[r];if("string"==typeof l)2===s?""!==l&&n.push(l,e[++r]):8===s&&t.push(l);else{if(!Nl(s))break;s=l}r++}return{attrs:n,classes:t}}(n.selectors[0]);s&&f1(e,t,s),l&&l.length>0&&EE(e,t,l.join(" "))}}(B,at,V,r),void 0!==t&&function vt(e,n,t){const r=e.projection=[];for(let s=0;s<n.length;s++){const l=t[s];r.push(null!=l?Array.from(l):null)}}(Ze,this.ngContentSelectors,t),Le=function Nt(e,n,t,r,s,l){const h=rs(),g=s[se],x=fa(h,s);Pc(g,s,h,t,null,r);for(let D=0;D<t.length;D++)Oo(Gd(s,g,h.directiveStart+D,h),s);tf(g,s,h),x&&Oo(x,s);const E=Gd(s,g,h.directiveStart+h.componentOffset,h);if(e[Ee]=s[Ee]=E,null!==l)for(const D of l)D(E,n);return G0(g,h,s),E}(Tt,at,Ne,ot,fe,[zt]),FE(oe,fe,null)}finally{kc()}return new Ye(this.componentType,Le,vp(Ze,fe),fe,Ze)}finally{_r(l)}}}class Ye extends dR{constructor(n,t,r,s,l){super(),this.location=r,this._rootLView=s,this._tNode=l,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new ul(s,void 0,!1),this.componentType=n}setInput(n,t){const r=this._tNode.inputs;let s;if(null!==r&&(s=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const l=this._rootLView;NE(l[se],l,s,n,t),this.previousInputValues.set(n,t),_y(Io(this._tNode.index,l),1)}}get injector(){return new vo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function zt(){const e=rs();w0(jt()[se],e)}let ct=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=qt}return e})();function qt(){return en(rs(),jt())}const Lt=ct,Mt=class extends Lt{constructor(n,t,r){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=r}get element(){return vp(this._hostTNode,this._hostLView)}get injector(){return new vo(this._hostTNode,this._hostLView)}get parentInjector(){const n=vx(this._hostTNode,this._hostLView);if(M1(n)){const t=ko(n,this._hostLView),r=ac(n);return new vo(t[se].data[r+8],t)}return new vo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=In(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-Kn}createEmbeddedView(n,t,r){let s,l;"number"==typeof r?s=r:null!=r&&(s=r.index,l=r.injector);const h=Fp(this._lContainer,n.ssrId),g=n.createEmbeddedViewImpl(t||{},l,h);return this.insertImpl(g,s,ng(this._hostTNode,h)),g}createComponent(n,t,r,s,l){const h=n&&!function P(e){return"function"==typeof e}(n);let g;if(h)g=t;else{const W=t||{};g=W.index,r=W.injector,s=W.projectableNodes,l=W.environmentInjector||W.ngModuleRef}const x=h?n:new tt(Vr(n)),E=r||this.parentInjector;if(!l&&null==x.ngModule){const V=(h?E:this.parentInjector).get(qo,null);V&&(l=V)}const D=Vr(x.componentType??{}),O=Fp(this._lContainer,D?.id??null),B=x.create(E,s,O?.firstChild??null,l);return this.insertImpl(B.hostView,g,ng(this._hostTNode,O)),B}insert(n,t){return this.insertImpl(n,t,!0)}insertImpl(n,t,r){const s=n._lView;if(function sx(e){return ur(e[de])}(s)){const g=this.indexOf(n);if(-1!==g)this.detach(g);else{const x=s[de],E=new Mt(x,x[_e],x[de]);E.detach(E.indexOf(n))}}const l=this._adjustIndex(t),h=this._lContainer;return rg(h,s,l,r),n.attachToViewContainerRef(),s0(_n(h),l,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=In(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),r=j0(this._lContainer,t);r&&(ua(_n(this._lContainer),t),$a(r[se],r))}detach(n){const t=this._adjustIndex(n,-1),r=j0(this._lContainer,t);return r&&null!=ua(_n(this._lContainer),t)?new ul(r):null}_adjustIndex(n,t=0){return n??this.length+t}};function In(e){return e[8]}function _n(e){return e[8]||(e[8]=[])}function en(e,n){let t;const r=n[e.index];return ur(r)?t=r:(t=_M(r,n,null,e),n[e.index]=t,tg(n,t)),Jn(t,n,e,r),new Mt(t,e,n)}let Jn=function ar(e,n,t,r){if(e[Yn])return;let s;s=8&t.type?Hn(r):function Ht(e,n){const t=e[pe],r=t.createComment(""),s=fa(n,e);return Ha(t,Km(t,s),r,function oM(e,n){return e.nextSibling(n)}(t,s),!1),r}(n,t),e[Yn]=s},bn=()=>!1;class Ar{constructor(n){this.queryList=n,this.matches=null}clone(){return new Ar(this.queryList)}setDirty(){this.queryList.setDirty()}}class Cr{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const r=null!==n.contentQueries?n.contentQueries[0]:t.length,s=[];for(let l=0;l<r;l++){const h=t.getByIndex(l);s.push(this.queries[h.indexInDeclarationView].clone())}return new Cr(s)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==uc(n,t).matches&&this.queries[t].setDirty()}}class bi{constructor(n,t,r=null){this.flags=t,this.read=r,this.predicate="string"==typeof n?function Fi(e){return e.split(",").map(n=>n.trim())}(n):n}}class wi{constructor(n=[]){this.queries=n}elementStart(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let r=0;r<this.length;r++){const s=null!==t?t.length:0,l=this.getByIndex(r).embeddedTView(n,s);l&&(l.indexInDeclarationView=r,null!==t?t.push(l):t=[l])}return null!==t?new wi(t):null}template(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class lr{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new lr(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1&~this.metadata.flags){const t=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let s=0;s<r.length;s++){const l=r[s];this.matchTNodeWithReadOption(n,t,ri(t,l)),this.matchTNodeWithReadOption(n,t,E0(t,n,l,!1,!1))}else r===si?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,E0(t,n,r,!1,!1))}matchTNodeWithReadOption(n,t,r){if(null!==r){const s=this.metadata.read;if(null!==s)if(s===Di||s===ct||s===si&&4&t.type)this.addMatch(t.index,-2);else{const l=E0(t,n,s,!1,!1);null!==l&&this.addMatch(t.index,l)}else this.addMatch(t.index,r)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function ri(e,n){const t=e.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===n)return t[r+1];return null}function Vi(e,n,t,r){return-1===t?function oi(e,n){return 11&e.type?vp(e,n):4&e.type?Q0(e,n):null}(n,e):-2===t?function Ss(e,n,t){return t===Di?vp(n,e):t===si?Q0(n,e):t===ct?en(n,e):void 0}(e,n,r):Gd(e,e[se],t,n)}function Ns(e,n,t,r){const s=n[nt].queries[r];if(null===s.matches){const l=e.data,h=t.matches,g=[];for(let x=0;null!==h&&x<h.length;x+=2){const E=h[x];g.push(E<0?null:Vi(n,l[E],h[x+1],t.metadata.read))}s.matches=g}return s.matches}function hs(e,n,t,r){const s=e.queries.getByIndex(t),l=s.matches;if(null!==l){const h=Ns(e,n,s,t);for(let g=0;g<l.length;g+=2){const x=l[g];if(x>0)r.push(h[g/2]);else{const E=l[g+1],D=n[-x];for(let O=Kn;O<D.length;O++){const N=D[O];N[mt]===N[de]&&hs(N[se],N,E,r)}if(null!==D[or]){const O=D[or];for(let N=0;N<O.length;N++){const B=O[N];hs(B[se],B,E,r)}}}}}return r}function po(e,n,t){const r=new NT(!(4&~t));return function HO(e,n,t,r){const s=yM(n);s.push(t),e.firstCreatePass&&vM(e).push(r,s.length-1)}(e,n,r,r.destroy),(n[nt]??=new Cr).queries.push(new Ar(r))-1}function hl(e,n,t){null===e.queries&&(e.queries=new wi),e.queries.track(new lr(n,t))}function uc(e,n){return e.queries.getByIndex(n)}function Nc(e,n){const t=e[se],r=uc(t,n);return r.crossesNgTemplate?hs(t,e,n,[]):Ns(t,e,r,n)}function Zh(e,n){xo("NgSignals");const t=function co(e){const n=Object.create(Li);n.value=e;const t=()=>(ei(n),n.value);return t[as]=n,t}(e),r=t[as];return n?.equal&&(r.equal=n.equal),t.set=s=>_d(r,s),t.update=s=>function nr(e,n){bc()||Wc(),_d(e,n(e.value))}(r,s),t.asReadonly=_2.bind(t),t}function _2(){const e=this[as];if(void 0===e.readonlyFn){const n=()=>this();n[as]=e,e.readonlyFn=n}return e.readonlyFn}function y2(e){return function Lp(e){return"function"==typeof e&&void 0!==e[as]}(e)&&"function"==typeof e.set}function is(e){let n=function EL(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const r=[e];for(;n;){let s;if(Zn(e))s=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Jt(903,!1);s=n.\u0275dir}if(s){if(t){r.push(s);const h=e;h.inputs=nA(e.inputs),h.inputTransforms=nA(e.inputTransforms),h.declaredInputs=nA(e.declaredInputs),h.outputs=nA(e.outputs);const g=s.hostBindings;g&&vH(e,g);const x=s.viewQuery,E=s.contentQueries;if(x&&_H(e,x),E&&yH(e,E),mH(e,s),zv(e.outputs,s.outputs),Zn(s)&&s.data.animation){const D=e.data;D.animation=(D.animation||[]).concat(s.data.animation)}}const l=s.features;if(l)for(let h=0;h<l.length;h++){const g=l[h];g&&g.ngInherit&&g(e),g===is&&(t=!1)}}n=Object.getPrototypeOf(n)}!function gH(e){let n=0,t=null;for(let r=e.length-1;r>=0;r--){const s=e[r];s.hostVars=n+=s.hostVars,s.hostAttrs=Jf(s.hostAttrs,t=Jf(t,s.hostAttrs))}}(r)}function mH(e,n){for(const t in n.inputs){if(!n.inputs.hasOwnProperty(t)||e.inputs.hasOwnProperty(t))continue;const r=n.inputs[t];if(void 0!==r&&(e.inputs[t]=r,e.declaredInputs[t]=n.declaredInputs[t],null!==n.inputTransforms)){const s=Array.isArray(r)?r[0]:r;if(!n.inputTransforms.hasOwnProperty(s))continue;e.inputTransforms??={},e.inputTransforms[s]=n.inputTransforms[s]}}}function nA(e){return e===kl?{}:e===mi?[]:e}function _H(e,n){const t=e.viewQuery;e.viewQuery=t?(r,s)=>{n(r,s),t(r,s)}:n}function yH(e,n){const t=e.contentQueries;e.contentQueries=t?(r,s,l)=>{n(r,s,l),t(r,s,l)}:n}function vH(e,n){const t=e.hostBindings;e.hostBindings=t?(r,s)=>{n(r,s),t(r,s)}:n}function E2(e){const n=e.inputConfig,t={};for(const r in n)if(n.hasOwnProperty(r)){const s=n[r];Array.isArray(s)&&s[3]&&(t[r]=s[3])}e.inputTransforms=t}class Oy{}class ML{}class vR extends Oy{constructor(n,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Se(this);const s=ha(n);this._bootstrapComponents=Rc(s.bootstrap),this._r3Injector=YS(n,t,[{provide:Oy,useValue:this},{provide:Ab,useValue:this.componentFactoryResolver},...r],Ts(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class xR extends ML{constructor(n){super(),this.moduleType=n}create(n){return new vR(this.moduleType,n,[])}}class AL extends Oy{constructor(n){super(),this.componentFactoryResolver=new Se(this),this.instance=null;const t=new zd([...n.providers,{provide:Oy,useValue:this},{provide:Ab,useValue:this.componentFactoryResolver}],n.parent||Pu(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function rA(e,n,t=null){return new AL({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}function iA(e){return!!function bR(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Bp(e,n,t){return e[n]=t}function Jo(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function Ry(e,n,t,r){const s=Jo(e,n,t);return Jo(e,n+1,r)||s}function S2(e,n,t,r,s,l,h,g,x,E){const D=t+bt,O=n.firstCreatePass?function IH(e,n,t,r,s,l,h,g,x){const E=n.consts,D=Hh(n,e,4,h||null,g||null);q0(n,t,D,Bl(E,x)),w0(n,D);const O=D.tView=ME(2,D,r,s,l,n.directiveRegistry,n.pipeRegistry,null,n.schemas,E,null);return null!==n.queries&&(n.queries.template(n,D),O.queries=n.queries.embeddedTView(D)),D}(D,n,e,r,s,l,h,g,x):n.data[D];ru(O,!1);const N=IL(n,e,O,t);x0()&&Qd(n,e,N,O),Oo(N,e);const B=_M(N,e,N,O);return e[D]=B,tg(e,B),function cn(e,n,t){return bn(e,n,t)}(B,O,e),xr(O)&&SE(n,e,O),null!=x&&ob(e,O,E),O}function Cn(e,n,t,r,s,l,h,g){const x=jt(),E=hi();return S2(x,E,e,n,t,r,s,Bl(E.consts,l),h,g),Cn}let IL=function kL(e,n,t,r){return Nh(!0),n[pe].createComment("")};function ds(e,n,t,r){const s=jt();return Jo(s,sc(),n)&&(hi(),io(Rs(),s,e,n,t,r)),ds}function Hb(e,n,t,r){return Jo(e,sc(),t)?n+rr(t)+r:qr}function Gb(e,n,t,r,s,l){const g=Ry(e,function Rh(){return Rr.lFrame.bindingIndex}(),t,s);return za(2),g?n+rr(t)+r+rr(s)+l:qr}function hA(e,n){return e<<17|n<<2}function u_(e){return e>>17&32767}function OR(e){return 2|e}function Ny(e){return(131068&e)>>2}function RR(e,n){return-131069&e|n<<2}function PR(e){return 1|e}function l4(e,n,t,r){const s=e[t+1],l=null===n;let h=r?u_(s):Ny(s),g=!1;for(;0!==h&&(!1===g||l);){const E=e[h+1];mG(e[h],n)&&(g=!0,e[h+1]=r?PR(E):OR(E)),h=r?u_(E):Ny(E)}g&&(e[t+1]=r?OR(s):PR(s))}function mG(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&al(e,n)>=0}const Ga={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function c4(e){return e.substring(Ga.key,Ga.keyEnd)}function u4(e,n){const t=Ga.textEnd;return t===n?-1:(n=Ga.keyEnd=function vG(e,n,t){for(;n<t&&e.charCodeAt(n)>32;)n++;return n}(e,Ga.key=n,t),Jb(e,n,t))}function Jb(e,n,t){for(;n<t&&e.charCodeAt(n)<=32;)n++;return n}function Zt(e,n,t){const r=jt();return Jo(r,sc(),n)&&cl(hi(),Rs(),r,e,n,r[pe],t,!1),Zt}function NR(e,n,t,r,s){const h=s?"class":"style";NE(e,t,n.inputs[h],h,r)}function Ki(e,n){return function af(e,n,t,r){const s=jt(),l=hi(),h=za(2);l.firstUpdatePass&&_4(l,e,h,r),n!==qr&&Jo(s,h,n)&&v4(l,l.data[no()],s,s[pe],e,s[h+1]=function IG(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=Ts($l(e)))),e}(n,t),r,h)}(e,n,null,!0),Ki}function I2(e){!function lf(e,n,t,r){const s=hi(),l=za(2);s.firstUpdatePass&&_4(s,null,l,r);const h=jt();if(t!==qr&&Jo(h,l,t)){const g=s.data[no()];if(b4(g,r)&&!g4(s,l)){let x=r?g.classesWithoutHost:g.stylesWithoutHost;null!==x&&(t=Qg(x,t||"")),NR(s,g,h,t,r)}else!function AG(e,n,t,r,s,l,h,g){s===qr&&(s=mi);let x=0,E=0,D=0<s.length?s[0]:null,O=0<l.length?l[0]:null;for(;null!==D||null!==O;){const N=x<s.length?s[x+1]:void 0,B=E<l.length?l[E+1]:void 0;let V,W=null;D===O?(x+=2,E+=2,N!==B&&(W=O,V=B)):null===O||null!==D&&D<O?(x+=2,W=D):(E+=2,W=O,V=B),null!==W&&v4(e,n,t,r,W,V,h,g),D=x<s.length?s[x]:null,O=E<l.length?l[E]:null}}(s,g,h,h[pe],h[l+1],h[l+1]=function DG(e,n,t){if(null==t||""===t)return mi;const r=[],s=$l(t);if(Array.isArray(s))for(let l=0;l<s.length;l++)e(r,s[l],!0);else if("object"==typeof s)for(const l in s)s.hasOwnProperty(l)&&e(r,l,s[l]);else"string"==typeof s&&n(r,s);return r}(e,n,t),r,l)}}(MG,Up,e,!0)}function Up(e,n){for(let t=function _G(e){return function d4(e){Ga.key=0,Ga.keyEnd=0,Ga.value=0,Ga.valueEnd=0,Ga.textEnd=e.length}(e),u4(e,Jb(e,0,Ga.textEnd))}(n);t>=0;t=u4(n,t))ol(e,c4(n),!0)}function g4(e,n){return n>=e.expandoStartIndex}function _4(e,n,t,r){const s=e.data;if(null===s[t+1]){const l=s[no()],h=g4(e,t);b4(l,r)&&null===n&&!h&&(n=!1),n=function TG(e,n,t,r){const s=function px(e){const n=Rr.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let l=r?n.residualClasses:n.residualStyles;if(null===s)0===(r?n.classBindings:n.styleBindings)&&(t=k2(t=FR(null,e,n,t,r),n.attrs,r),l=null);else{const h=n.directiveStylingLast;if(-1===h||e[h]!==s)if(t=FR(s,e,n,t,r),null===l){let x=function EG(e,n,t){const r=t?n.classBindings:n.styleBindings;if(0!==Ny(r))return e[u_(r)]}(e,n,r);void 0!==x&&Array.isArray(x)&&(x=FR(null,e,n,x[1],r),x=k2(x,n.attrs,r),function CG(e,n,t,r){e[u_(t?n.classBindings:n.styleBindings)]=r}(e,n,r,x))}else l=function SG(e,n,t){let r;const s=n.directiveEnd;for(let l=1+n.directiveStylingLast;l<s;l++)r=k2(r,e[l].hostAttrs,t);return k2(r,n.attrs,t)}(e,n,r)}return void 0!==l&&(r?n.residualClasses=l:n.residualStyles=l),t}(s,l,n,r),function fG(e,n,t,r,s,l){let h=l?n.classBindings:n.styleBindings,g=u_(h),x=Ny(h);e[r]=t;let D,E=!1;if(Array.isArray(t)?(D=t[1],(null===D||al(t,D)>0)&&(E=!0)):D=t,s)if(0!==x){const N=u_(e[g+1]);e[r+1]=hA(N,g),0!==N&&(e[N+1]=RR(e[N+1],r)),e[g+1]=function hG(e,n){return 131071&e|n<<17}(e[g+1],r)}else e[r+1]=hA(g,0),0!==g&&(e[g+1]=RR(e[g+1],r)),g=r;else e[r+1]=hA(x,0),0===g?g=r:e[x+1]=RR(e[x+1],r),x=r;E&&(e[r+1]=OR(e[r+1])),l4(e,D,r,!0),l4(e,D,r,!1),function pG(e,n,t,r,s){const l=s?e.residualClasses:e.residualStyles;null!=l&&"string"==typeof n&&al(l,n)>=0&&(t[r+1]=PR(t[r+1]))}(n,D,e,r,l),h=hA(g,x),l?n.classBindings=h:n.styleBindings=h}(s,l,n,t,h,r)}}function FR(e,n,t,r,s){let l=null;const h=t.directiveEnd;let g=t.directiveStylingLast;for(-1===g?g=t.directiveStart:g++;g<h&&(l=n[g],r=k2(r,l.hostAttrs,s),l!==e);)g++;return null!==e&&(t.directiveStylingLast=g),r}function k2(e,n,t){const r=t?1:2;let s=-1;if(null!==n)for(let l=0;l<n.length;l++){const h=n[l];"number"==typeof h?s=h:s===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),ol(e,h,!!t||n[++l]))}return void 0===e?null:e}function MG(e,n,t){const r=String(n);""!==r&&!r.includes(" ")&&ol(e,r,t)}function v4(e,n,t,r,s,l,h,g){if(!(3&n.type))return;const x=e.data,E=x[g+1],D=function dG(e){return!(1&~e)}(E)?x4(x,n,t,s,Ny(E),h):void 0;dA(D)||(dA(l)||function uG(e){return!(2&~e)}(E)&&(l=x4(x,null,t,s,g,h)),function TE(e,n,t,r,s){if(n)s?e.addClass(t,r):e.removeClass(t,r);else{let l=-1===r.indexOf("-")?void 0:Dp.DashCase;null==s?e.removeStyle(t,r,l):("string"==typeof s&&s.endsWith("!important")&&(s=s.slice(0,-10),l|=Dp.Important),e.setStyle(t,r,s,l))}}(r,h,Ll(no(),t),s,l))}function x4(e,n,t,r,s,l){const h=null===n;let g;for(;s>0;){const x=e[s],E=Array.isArray(x),D=E?x[1]:x,O=null===D;let N=t[s+1];N===qr&&(N=O?mi:void 0);let B=O?Kf(N,r):D===r?N:void 0;if(E&&!dA(B)&&(B=Kf(x,r)),dA(B)&&(g=B,h))return g;const W=e[s+1];s=h?u_(W):Ny(W)}if(null!==n){let x=l?n.residualClasses:n.residualStyles;null!=x&&(g=Kf(x,r))}return g}function dA(e){return void 0!==e}function b4(e,n){return!!(e.flags&(n?8:16))}function LR(){return jt()[pt][Ee]}class UG{destroy(n){}updateValue(n,t){}swap(n,t){const r=Math.min(n,t),s=Math.max(n,t),l=this.detach(s);if(s-r>1){const h=this.detach(r);this.attach(r,l),this.attach(s,h)}else this.attach(r,l)}move(n,t){this.attach(t,this.detach(n))}}function BR(e,n,t,r,s){return e===t&&Object.is(n,r)?1:Object.is(s(e,n),s(t,r))?-1:0}function zR(e,n,t,r){return!(void 0===n||!n.has(r)||(e.attach(t,n.get(r)),n.delete(r),0))}function w4(e,n,t,r,s){if(zR(e,n,r,t(r,s)))e.updateValue(r,s);else{const l=e.create(r,s);e.attach(r,l)}}function T4(e,n,t,r){const s=new Set;for(let l=n;l<=t;l++)s.add(r(l,e.at(l)));return s}class E4{constructor(){this.kvMap=new Map,this._vMap=void 0}has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;const t=this.kvMap.get(n);return void 0!==this._vMap&&this._vMap.has(t)?(this.kvMap.set(n,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,t){if(this.kvMap.has(n)){let r=this.kvMap.get(n);void 0===this._vMap&&(this._vMap=new Map);const s=this._vMap;for(;s.has(r);)r=s.get(r);s.set(r,t)}else this.kvMap.set(n,t)}forEach(n){for(let[t,r]of this.kvMap)if(n(r,t),void 0!==this._vMap){const s=this._vMap;for(;s.has(r);)r=s.get(r),n(r,t)}}}function Ds(e,n){xo("NgControlFlow");const t=jt(),r=sc(),s=t[r]!==qr?t[r]:-1,l=-1!==s?fA(t,bt+s):void 0;if(Jo(t,r,e)){const g=_r(null);try{if(void 0!==l&&hb(l,0),-1!==e){const x=bt+e,E=fA(t,x),D=VR(t[se],x),O=Fp(E,D.tView.ssrId);rg(E,ga(t,D,n,{dehydratedView:O}),0,ng(D,O))}}finally{_r(g)}}else if(void 0!==l){const g=Y0(l,0);void 0!==g&&(g[Ee]=n)}}class jG{constructor(n,t,r){this.lContainer=n,this.$implicit=t,this.$index=r}get $count(){return this.lContainer.length-Kn}}class $G{constructor(n,t,r){this.hasEmptyBlock=n,this.trackByFn=t,this.liveCollection=r}}function Yh(e,n,t,r,s,l,h,g,x,E,D,O,N){xo("NgControlFlow");const B=jt(),W=hi(),V=void 0!==x,X=jt(),le=g?h.bind(X[pt][Ee]):h,oe=new $G(V,le);X[bt+e]=oe,S2(B,W,e+1,n,t,r,s,Bl(W.consts,l)),V&&S2(B,W,e+2,x,E,D,O,Bl(W.consts,N))}class HG extends UG{constructor(n,t,r){super(),this.lContainer=n,this.hostLView=t,this.templateTNode=r,this.operationsCounter=void 0,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-Kn}at(n){return this.getLView(n)[Ee].$implicit}attach(n,t){const r=t[ye];this.needsIndexUpdate||=n!==this.length,rg(this.lContainer,t,n,ng(this.templateTNode,r))}detach(n){return this.needsIndexUpdate||=n!==this.length-1,function GG(e,n){return j0(e,n)}(this.lContainer,n)}create(n,t){const r=Fp(this.lContainer,this.templateTNode.tView.ssrId),s=ga(this.hostLView,this.templateTNode,new jG(this.lContainer,t,n),{dehydratedView:r});return this.operationsCounter?.recordCreate(),s}destroy(n){$a(n[se],n),this.operationsCounter?.recordDestroy()}updateValue(n,t){this.getLView(n)[Ee].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[Ee].$index=n}getLView(n){return function WG(e,n){return Y0(e,n)}(this.lContainer,n)}}function Kh(e){const n=_r(null),t=no();try{const r=jt(),s=r[se],l=r[t],h=t+1,g=fA(r,h);if(void 0===l.liveCollection){const E=VR(s,h);l.liveCollection=new HG(g,r,E)}else l.liveCollection.reset();const x=l.liveCollection;if(function VG(e,n,t){let r,s,l=0,h=e.length-1;if(Array.isArray(n)){let x=n.length-1;for(;l<=h&&l<=x;){const E=e.at(l),D=n[l],O=BR(l,E,l,D,t);if(0!==O){O<0&&e.updateValue(l,D),l++;continue}const N=e.at(h),B=n[x],W=BR(h,N,x,B,t);if(0!==W){W<0&&e.updateValue(h,B),h--,x--;continue}const V=t(l,E),X=t(h,N),le=t(l,D);if(Object.is(le,X)){const oe=t(x,B);Object.is(oe,V)?(e.swap(l,h),e.updateValue(h,B),x--,h--):e.move(h,l),e.updateValue(l,D),l++}else if(r??=new E4,s??=T4(e,l,h,t),zR(e,r,l,le))e.updateValue(l,D),l++,h++;else if(s.has(le))r.set(V,e.detach(l)),h--;else{const oe=e.create(l,n[l]);e.attach(l,oe),l++,h++}}for(;l<=x;)w4(e,r,t,l,n[l]),l++}else if(null!=n){const x=n[Symbol.iterator]();let E=x.next();for(;!E.done&&l<=h;){const D=e.at(l),O=E.value,N=BR(l,D,l,O,t);if(0!==N)N<0&&e.updateValue(l,O),l++,E=x.next();else{r??=new E4,s??=T4(e,l,h,t);const B=t(l,O);if(zR(e,r,l,B))e.updateValue(l,O),l++,h++,E=x.next();else if(s.has(B)){const W=t(l,D);r.set(W,e.detach(l)),h--}else e.attach(l,e.create(l,O)),l++,h++,E=x.next()}}for(;!E.done;)w4(e,r,t,e.length,E.value),E=x.next()}for(;l<=h;)e.destroy(e.detach(h--));r?.forEach(x=>{e.destroy(x)})}(x,e,l.trackByFn),x.updateIndexes(),l.hasEmptyBlock){const E=sc(),D=0===x.length;if(Jo(r,E,D)){const O=t+2,N=fA(r,O);if(D){const B=VR(s,O),W=Fp(N,B.tView.ssrId);rg(N,ga(r,B,void 0,{dehydratedView:W}),0,ng(B,W))}else hb(N,0)}}}finally{_r(n)}}function fA(e,n){return e[n]}function VR(e,n){return Vm(e,n)}function ee(e,n,t,r){const s=jt(),l=hi(),h=bt+e,g=s[pe],x=l.firstCreatePass?function qG(e,n,t,r,s,l){const h=n.consts,x=Hh(n,e,2,r,Bl(h,s));return q0(n,t,x,Bl(h,l)),null!==x.attrs&&we(x,x.attrs,!1),null!==x.mergedAttrs&&we(x,x.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,x),x}(h,l,s,n,t,r):l.data[h],E=C4(l,s,x,g,n,e);s[h]=E;const D=xr(x);return ru(x,!0),Ip(g,E,x),!function Fb(e){return!(32&~e.flags)}(x)&&x0()&&Qd(l,s,E,x),0===function dT(){return Rr.lFrame.elementDepthCount}()&&Oo(E,s),function T1(){Rr.lFrame.elementDepthCount++}(),D&&(SE(l,s,x),G0(l,x,s)),null!==r&&ob(s,x),ee}function te(){let e=rs();ux()?hx():(e=e.parent,ru(e,!1));const n=e;(function fT(e){return Rr.skipHydrationRootTNode===e})(n)&&function IS(){Rr.skipHydrationRootTNode=null}(),function E1(){Rr.lFrame.elementDepthCount--}();const t=hi();return t.firstCreatePass&&(w0(t,e),ni(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function LS(e){return!!(8&e.flags)}(n)&&NR(t,n,jt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function ro(e){return!!(16&e.flags)}(n)&&NR(t,n,jt(),n.stylesWithoutHost,!1),te}function Xn(e,n,t,r){return ee(e,n,t,r),te(),Xn}let C4=(e,n,t,r,s,l)=>(Nh(!0),ry(r,s,function Va(){return Rr.lFrame.currentNamespace}()));function pA(e,n,t){const r=jt(),s=hi(),l=e+bt,h=s.firstCreatePass?function YG(e,n,t,r,s){const l=n.consts,h=Bl(l,r),g=Hh(n,e,8,"ng-container",h);return null!==h&&we(g,h,!0),q0(n,t,g,Bl(l,s)),null!==n.queries&&n.queries.elementStart(n,g),g}(l,s,r,n,t):s.data[l];ru(h,!0);const g=S4(s,r,h,e);return r[l]=g,x0()&&Qd(s,r,g,h),Oo(g,r),xr(h)&&(SE(s,r,h),G0(s,h,r)),null!=t&&ob(r,h),pA}function mA(){let e=rs();const n=hi();return ux()?hx():(e=e.parent,ru(e,!1)),n.firstCreatePass&&(w0(n,e),ni(e)&&n.queries.elementEnd(e)),mA}function gA(e,n,t){return pA(e,n,t),mA(),gA}let S4=(e,n,t,r)=>(Nh(!0),Bu(n[pe],""));function Wi(){return jt()}const Fy=void 0;var eW=["en",[["a","p"],["AM","PM"],Fy],[["AM","PM"],Fy,Fy],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Fy,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Fy,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Fy,"{1} 'at' {0}",Fy],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function QG(e){const t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}];let Qb={};function Lc(e){const n=function tW(e){return e.toLowerCase().replace(/_/g,"-")}(e);let t=A4(n);if(t)return t;const r=n.split("-")[0];if(t=A4(r),t)return t;if("en"===r)return eW;throw new Jt(701,!1)}function A4(e){return e in Qb||(Qb[e]=ls.ng&&ls.ng.common&&ls.ng.common.locales&&ls.ng.common.locales[e]),Qb[e]}var Xs=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}(Xs||{});const ew="en-US";let I4=ew;let X4=(e,n,t)=>{};function on(e,n,t,r){const s=jt(),l=hi(),h=rs();return HR(l,s,s[pe],h,e,n,r),on}function HR(e,n,t,r,s,l,h){const g=xr(r),E=e.firstCreatePass&&vM(e),D=n[Ee],O=yM(n);let N=!0;if(3&r.type||h){const V=fa(r,n),X=h?h(V):V,le=O.length,oe=h?Le=>h(Hn(Le[r.index])):r.index;let fe=null;if(!h&&g&&(fe=function VW(e,n,t,r){const s=e.cleanup;if(null!=s)for(let l=0;l<s.length-1;l+=2){const h=s[l];if(h===t&&s[l+1]===r){const g=n[De],x=s[l+2];return g.length>x?g[x]:null}"string"==typeof h&&(l+=2)}return null}(e,n,s,r.index)),null!==fe)(fe.__ngLastListenerFn__||fe).__ngNextListenerFn__=l,fe.__ngLastListenerFn__=l,N=!1;else{l=Q4(r,n,D,l),X4(V,s,l);const Le=t.listen(X,s,l);O.push(l,Le),E&&E.push(s,oe,le,le+1)}}else l=Q4(r,n,D,l);const B=r.outputs;let W;if(N&&null!==B&&(W=B[s])){const V=W.length;if(V)for(let X=0;X<V;X+=2){const Ze=n[W[X]][W[X+1]].subscribe(l),at=O.length;O.push(l,Ze),E&&E.push(s,r.index,at,-(at+1))}}}function J4(e,n,t,r){const s=_r(null);try{return Ih(6,n,t),!1!==t(r)}catch(l){return ub(e,l),!1}finally{Ih(7,n,t),_r(s)}}function Q4(e,n,t,r){return function s(l){if(l===Function)return r;_y(e.componentOffset>-1?Io(e.index,n):n,5);let g=J4(n,t,r,l),x=s.__ngNextListenerFn__;for(;x;)g=J4(n,t,x,l)&&g,x=x.__ngNextListenerFn__;return g}}function Bt(e=1){return function fp(e){return(Rr.lFrame.contextLView=function lx(e,n){for(;e>0;)n=n[Pe],e--;return n}(e,Rr.lFrame.contextLView))[Ee]}(e)}function jW(e,n){let t=null;const r=function Jv(e){const n=e.attrs;if(null!=n){const t=n.indexOf(5);if(!(1&t))return n[t+1]}return null}(e);for(let s=0;s<n.length;s++){const l=n[s];if("*"!==l){if(null===r?Qf(e,l,!0):a0(r,l))return s}else t=s}return t}function xA(e){const n=jt()[pt][_e];if(!n.projection){const r=n.projection=function Mc(e,n){const t=[];for(let r=0;r<e;r++)t.push(n);return t}(e?e.length:1,null),s=r.slice();let l=n.child;for(;null!==l;){if(128!==l.type){const h=e?jW(l,e):0;null!==h&&(s[h]?s[h].projectionNext=l:r[h]=l,s[h]=l)}l=l.next}}}function bA(e,n=0,t,r,s,l){const h=jt(),g=hi(),x=r?e+1:null;null!==x&&S2(h,g,x,r,s,l,null,t);const E=Hh(g,bt+e,16,null,t||null);null===E.projection&&(E.projection=n),hx();const O=!h[ye]||Oh();null===h[pt][_e].projection[E.projection]&&null!==x?function $W(e,n,t){const r=bt+t,s=n.data[r],l=e[r],h=Fp(l,s.tView.ssrId);rg(l,ga(e,s,void 0,{dehydratedView:h}),0,ng(s,h))}(h,g,x):O&&32&~E.flags&&function hM(e,n,t){wE(n[pe],0,n,t,nb(e,t,n),oy(t.parent||n[_e],t,n))}(g,h,E)}function wA(e,n,t){return GR(e,"",n,"",t),wA}function GR(e,n,t,r,s){const l=jt(),h=Hb(l,n,t,r);return h!==qr&&cl(hi(),Rs(),l,e,h,l[pe],s,!1),GR}function fs(e,n,t,r){!function Ro(e,n,t,r){const s=hi();if(s.firstCreatePass){const l=rs();hl(s,new bi(n,t,r),l.index),function $u(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(s,e),!(2&~t)&&(s.staticContentQueries=!0)}return po(s,jt(),t)}(e,n,t,r)}function Gu(e,n,t){!function js(e,n,t){const r=hi();return r.firstCreatePass&&(hl(r,new bi(e,n,t),-1),!(2&~n)&&(r.staticViewQueries=!0)),po(r,jt(),n)}(e,n,t)}function di(e){const n=jt(),t=hi(),r=vT();dp(r+1);const s=uc(t,r);if(e.dirty&&function cp(e){return!(4&~e[ce])}(n)===!(2&~s.metadata.flags)){if(null===s.matches)e.reset([]);else{const l=Nc(n,r);e.reset(l,PT),e.notifyOnChanges()}return!0}return!1}function fi(){return function es(e,n){return e[nt].queries[n].queryList}(jt(),vT())}function Wa(e){return $d(function kS(){return Rr.lFrame.contextLView}(),bt+e)}function xe(e,n=""){const t=jt(),r=hi(),s=e+bt,l=r.firstCreatePass?Hh(r,s,1,n,null):r.data[s],h=_B(r,t,l,n,e);t[s]=h,x0()&&Qd(r,t,h,l),ru(l,!1)}let _B=(e,n,t,r,s)=>(Nh(!0),function gE(e,n){return e.createText(n)}(n[pe],r));function kn(e){return dl("",e,""),kn}function dl(e,n,t){const r=jt(),s=Hb(r,e,n,t);return s!==qr&&nf(r,no(),s),dl}function qR(e,n,t,r,s){const l=jt(),h=Gb(l,e,n,t,r,s);return h!==qr&&nf(l,no(),h),qR}function wn(e,n,t){y2(n)&&(n=n());const r=jt();return Jo(r,sc(),n)&&cl(hi(),Rs(),r,e,n,r[pe],t,!1),wn}function En(e,n){const t=y2(e);return t&&e.set(n),t}function Tn(e,n){const t=jt(),r=hi(),s=rs();return HR(r,t,t[pe],s,e,n),Tn}function ZR(e,n,t,r,s){if(e=Tr(e),Array.isArray(e))for(let l=0;l<e.length;l++)ZR(e[l],n,t,r,s);else{const l=hi(),h=jt(),g=rs();let x=Ac(e)?e:Tr(e.provide);const E=ex(e),D=1048575&g.providerIndexes,O=g.directiveStart,N=g.providerIndexes>>20;if(Ac(e)||!e.multi){const B=new iu(E,s,xt),W=YR(x,n,s?D:D+N,O);-1===W?(I1(T0(g,h),l,x),XR(l,e,n.length),n.push(x),g.directiveStart++,g.directiveEnd++,s&&(g.providerIndexes+=1048576),t.push(B),h.push(B)):(t[W]=B,h[W]=B)}else{const B=YR(x,n,D+N,O),W=YR(x,n,D,D+N),X=W>=0&&t[W];if(s&&!X||!s&&!(B>=0&&t[B])){I1(T0(g,h),l,x);const le=function cq(e,n,t,r,s){const l=new iu(e,t,xt);return l.multi=[],l.index=n,l.componentProviders=0,DB(l,s,r&&!t),l}(s?lq:aq,t.length,s,r,E);!s&&X&&(t[W].providerFactory=le),XR(l,e,n.length,0),n.push(x),g.directiveStart++,g.directiveEnd++,s&&(g.providerIndexes+=1048576),t.push(le),h.push(le)}else XR(l,e,B>-1?B:W,DB(t[s?W:B],E,!s&&r));!s&&r&&X&&t[W].componentProviders++}}}function XR(e,n,t,r){const s=Ac(n),l=function h0(e){return!!e.useClass}(n);if(s||l){const x=(l?Tr(n.useClass):n).prototype.ngOnDestroy;if(x){const E=e.destroyHooks||(e.destroyHooks=[]);if(!s&&n.multi){const D=E.indexOf(t);-1===D?E.push(t,[r,x]):E[D+1].push(r,x)}else E.push(t,x)}}}function DB(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function YR(e,n,t,r){for(let s=t;s<r;s++)if(n[s]===e)return s;return-1}function aq(e,n,t,r){return KR(this.multi,[])}function lq(e,n,t,r){const s=this.multi;let l;if(this.providerFactory){const h=this.providerFactory.componentProviders,g=Gd(t,t[se],this.providerFactory.index,r);l=g.slice(0,h),KR(s,l);for(let x=h;x<g.length;x++)l.push(g[x])}else l=[],KR(s,l);return l}function KR(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function Fs(e,n=[]){return t=>{t.providersResolver=(r,s)=>function oq(e,n,t){const r=hi();if(r.firstCreatePass){const s=Zn(e);ZR(t,r.data,r.blueprint,s,!0),ZR(n,r.data,r.blueprint,s,!1)}}(r,s?s(e):e,n)}}let uq=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=Ld(0,t.type),s=r.length>0?rA([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,s)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=sn({token:e,providedIn:"environment",factory:()=>new e(Dn(qo))})}return e})();function cf(e){xo("NgStandalone"),e.getStandaloneInjector=n=>n.get(uq).getOrCreateStandaloneInjector(e)}function uf(e,n,t,r){return OB(jt(),Ko(),e,n,t,r)}function tw(e,n,t,r,s){return RB(jt(),Ko(),e,n,t,r,s)}function CA(e,n,t,r,s,l){return function PB(e,n,t,r,s,l,h,g){const x=n+t;return function sA(e,n,t,r,s){const l=Ry(e,n,t,r);return Jo(e,n+2,s)||l}(e,x,s,l,h)?Bp(e,x+3,g?r.call(g,s,l,h):r(s,l,h)):B2(e,x+3)}(jt(),Ko(),e,n,t,r,s,l)}function kB(e,n,t,r,s,l,h){return function NB(e,n,t,r,s,l,h,g,x){const E=n+t;return function Xh(e,n,t,r,s,l){const h=Ry(e,n,t,r);return Ry(e,n+2,s,l)||h}(e,E,s,l,h,g)?Bp(e,E+4,x?r.call(x,s,l,h,g):r(s,l,h,g)):B2(e,E+4)}(jt(),Ko(),e,n,t,r,s,l,h)}function B2(e,n){const t=e[n];return t===qr?void 0:t}function OB(e,n,t,r,s,l){const h=n+t;return Jo(e,h,s)?Bp(e,h+1,l?r.call(l,s):r(s)):B2(e,h+1)}function RB(e,n,t,r,s,l,h){const g=n+t;return Ry(e,g,s,l)?Bp(e,g+2,h?r.call(h,s,l):r(s,l)):B2(e,g+2)}function SA(e,n){const t=hi();let r;const s=e+bt;t.firstCreatePass?(r=function vq(e,n){if(n)for(let t=n.length-1;t>=0;t--){const r=n[t];if(e===r.name)return r}}(n,t.pipeRegistry),t.data[s]=r,r.onDestroy&&(t.destroyHooks??=[]).push(s,r.onDestroy)):r=t.data[s];const l=r.factory||(r.factory=bh(r.type)),g=sl(xt);try{const x=A1(!1),E=l();return A1(x),function WR(e,n,t,r){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=r}(t,jt(),s,E),E}finally{sl(g)}}function JR(e,n,t,r){const s=e+bt,l=jt(),h=$d(l,s);return z2(l,s)?RB(l,Ko(),n,h.transform,t,r,h):h.transform(t,r)}function z2(e,n){return e[se].data[n].pure}function fl(e,n){return Q0(e,n)}let QB=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const i5=new Gt(""),AA=new Gt("");let oP,iP=(()=>{class e{constructor(t,r,s){this._ngZone=t,this.registry=r,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,oP||(function mZ(e){oP=e}(s),s.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Qr.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb()}});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1))}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,s){let l=-1;r&&r>0&&(l=setTimeout(()=>{this._callbacks=this._callbacks.filter(h=>h.timeoutId!==l),t()},r)),this._callbacks.push({doneCb:t,timeoutId:l,updateCb:s})}whenStable(t,r,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,s),this._runCallbacksIfReady()}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,s){return[]}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Qr),Dn(sP),Dn(AA))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})(),sP=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return oP?.findTestabilityInTree(this,t,r)??null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function $2(e){return!!e&&"function"==typeof e.then}function s5(e){return!!e&&"function"==typeof e.subscribe}const aP=new Gt("");let lP=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=Xe(aP,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const s of this.appInits){const l=s();if($2(l))t.push(l);else if(s5(l)){const h=new Promise((g,x)=>{l.subscribe({complete:g,error:x})});t.push(h)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(s=>{this.reject(s)}),0===t.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const IA=new Gt("");function l5(e,n){return Array.isArray(n)?n.reduce(l5,e):{...e,...n}}let Qh=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Xe(Nu),this.afterRenderEffectManager=Xe(S),this.zonelessEnabled=Xe(s_),this.externalTestViews=new Set,this.beforeRender=new Ii,this.afterTick=new Ii,this.componentTypes=[],this.components=[],this.isStable=Xe(zh).hasPendingTasks.pipe(J(t=>!t)),this._injector=Xe(qo)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){const s=t instanceof c2;if(!this._injector.get(lP).done)throw!s&&function Eh(e){const n=Vr(e)||ho(e)||Wo(e);return null!==n&&n.standalone}(t),new Jt(405,!1);let h;h=s?t:this._injector.get(Ab).resolveComponentFactory(t),this.componentTypes.push(h.componentType);const g=function gZ(e){return e.isBoundToModule}(h)?void 0:this._injector.get(Oy),E=h.create(xs.NULL,[],r||h.selector,g),D=E.location.nativeElement,O=E.injector.get(i5,null);return O?.registerApplication(D),E.onDestroy(()=>{this.detachView(E.hostView),kA(this.components,E),O?.unregisterApplication(D)}),this._loadComponent(E),E}tick(){this._tick(!0)}_tick(t){if(this._runningTick)throw new Jt(101,!1);const r=_r(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(t)}catch(s){this.internalErrorHandler(s)}finally{this._runningTick=!1,_r(r),this.afterTick.next()}}detectChangesInAttachedViews(t){let r=null;this._injector.destroyed||(r=this._injector.get(u2,null,{optional:!0}));let s=0;const l=this.afterRenderEffectManager;for(;s<10;){const h=0===s;if(t||!h){this.beforeRender.next(h);for(let{_lView:g,notifyErrorHandler:x}of this._views)yZ(g,x,h,this.zonelessEnabled)}else r?.begin?.(),r?.end?.();if(s++,l.executeInternalCallbacks(),!this.allViews.some(({_lView:g})=>nu(g))&&(l.execute(),!this.allViews.some(({_lView:g})=>nu(g))))break}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;kA(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(IA,[]);[...this._bootstrapListeners,...r].forEach(s=>s(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>kA(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Jt(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function kA(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function yZ(e,n,t,r){(t||nu(e))&&gy(e,n,t&&!r?0:1)}class vZ{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let u5=(()=>{class e{compileModuleSync(t){return new xR(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),l=Rc(ha(t).declarations).reduce((h,g)=>{const x=Vr(g);return x&&h.push(new tt(x)),h},[]);return new vZ(r,l)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wZ=(()=>{class e{constructor(){this.zone=Xe(Qr),this.changeDetectionScheduler=Xe(fg),this.applicationRef=Xe(Qh)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function cP({ngZoneFactory:e,ignoreChangesOutsideZone:n}){return e??=()=>new Qr(uP()),[{provide:Qr,useFactory:e},{provide:rc,multi:!0,useFactory:()=>{const t=Xe(wZ,{optional:!0});return()=>t.initialize()}},{provide:rc,multi:!0,useFactory:()=>{const t=Xe(CZ);return()=>{t.initialize()}}},{provide:Nu,useFactory:EZ},!0===n?{provide:l2,useValue:!0}:[]]}function EZ(){const e=Xe(Qr),n=Xe(lc);return t=>e.runOutsideAngular(()=>n.handleError(t))}function uP(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}let CZ=(()=>{class e{constructor(){this.subscription=new dn,this.initialized=!1,this.zone=Xe(Qr),this.pendingTasks=Xe(zh)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Qr.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Qr.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),H2=(()=>{class e{constructor(){this.appRef=Xe(Qh),this.taskService=Xe(zh),this.ngZone=Xe(Qr),this.zonelessEnabled=Xe(s_),this.disableScheduling=Xe(l2,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new dn,this.cancelScheduledCallback=null,this.shouldRefreshViews=!1,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Ay||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&5===t)return;switch(t){case 3:case 2:case 0:case 4:case 5:case 1:this.shouldRefreshViews=!0}if(!this.shouldScheduleTick())return;const r=this.useMicrotaskScheduler?d2:h2;this.pendingRenderTaskId=this.taskService.add(),this.zoneIsDefined?Zone.root.run(()=>{this.cancelScheduledCallback=r(()=>{this.tick(this.shouldRefreshViews)})}):this.cancelScheduledCallback=r(()=>{this.tick(this.shouldRefreshViews)})}shouldScheduleTick(){return!(this.disableScheduling||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Qr.isInAngularZone())}tick(t){if(this.runningTick||this.appRef.destroyed)return;const r=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick(t)},void 0,this.schedulerTickApplyArgs)}catch(s){throw this.taskService.remove(r),s}finally{this.cleanup()}this.useMicrotaskScheduler=!0,d2(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(r)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.shouldRefreshViews=!1,this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Vp=new Gt("",{providedIn:"root",factory:()=>Xe(Vp,Gr.Optional|Gr.SkipSelf)||function SZ(){return typeof $localize<"u"&&$localize.locale||ew}()}),DZ=new Gt("",{providedIn:"root",factory:()=>"USD"}),dP=new Gt("");let p5=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const s=function XM(e="zone.js",n){return"noop"===e?new Ay:"zone.js"===e?new Qr(n):e}(r?.ngZone,uP({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return s.run(()=>{const l=r?.ignoreChangesOutsideZone,h=function CH(e,n,t){return new vR(e,n,t)}(t.moduleType,this.injector,[...cP({ngZoneFactory:()=>s,ignoreChangesOutsideZone:l}),{provide:fg,useExisting:H2}]),g=h.injector.get(lc,null);return s.runOutsideAngular(()=>{const x=s.onError.subscribe({next:E=>{g.handleError(E)}});h.onDestroy(()=>{kA(this._modules,h),x.unsubscribe()})}),function a5(e,n,t){try{const r=t();return $2(r)?r.catch(s=>{throw n.runOutsideAngular(()=>e.handleError(s)),s}):r}catch(r){throw n.runOutsideAngular(()=>e.handleError(r)),r}}(g,s,()=>{const x=h.injector.get(lP);return x.runInitializers(),x.donePromise.then(()=>(function k4(e){"string"==typeof e&&(I4=e.toLowerCase().replace(/_/g,"-"))}(h.injector.get(Vp,ew)||ew),this._moduleDoBootstrap(h),h))})})}bootstrapModule(t,r=[]){const s=l5({},r);return function bZ(e,n,t){const r=new xR(t);return Promise.resolve(r)}(0,0,t).then(l=>this.bootstrapModuleFactory(l,s))}_moduleDoBootstrap(t){const r=t.injector.get(Qh);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(s=>r.bootstrap(s));else{if(!t.instance.ngDoBootstrap)throw new Jt(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Jt(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(dP,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(xs))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),d_=null;const m5=new Gt("");function g5(e,n,t=[]){const r=`Platform: ${n}`,s=new Gt(r);return(l=[])=>{let h=fP();if(!h||h.injector.get(m5,!1)){const g=[...t,...l,{provide:s,useValue:!0}];e?e(g):function AZ(e){if(d_&&!d_.get(m5,!1))throw new Jt(400,!1);(function o5(){!function ii(e){lh=e}(()=>{throw new Jt(600,!1)})})(),d_=e;const n=e.get(p5);(function y5(e){e.get(GT,null)?.forEach(t=>t())})(e)}(function _5(e=[],n){return xs.create({name:n,providers:[{provide:sp,useValue:"platform"},{provide:dP,useValue:new Set([()=>d_=null])},...e]})}(g,r))}return function IZ(e){const n=fP();if(!n)throw new Jt(401,!1);return n}()}}function fP(){return d_?.get(p5)??null}let ed=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=OZ}return e})();function OZ(e){return function RZ(e,n,t){if(dr(e)&&!t){const r=Io(e.index,n);return new ul(r,r)}return 175&e.type?new ul(n[pt],n):null}(rs(),jt(),!(16&~e))}class T5{constructor(){}supports(n){return iA(n)}create(n){return new BZ(n)}}const LZ=(e,n)=>n;class BZ{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||LZ}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,r=this._removalsHead,s=0,l=null;for(;t||r;){const h=!r||t&&t.currentIndex<C5(r,s,l)?t:r,g=C5(h,s,l),x=h.currentIndex;if(h===r)s--,r=r._nextRemoved;else if(t=t._next,null==h.previousIndex)s++;else{l||(l=[]);const E=g-s,D=x-s;if(E!=D){for(let N=0;N<E;N++){const B=N<l.length?l[N]:l[N]=0,W=B+N;D<=W&&W<E&&(l[N]=B+1)}l[h.previousIndex]=D-E}}g!==x&&n(h,g,x)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!iA(n))throw new Jt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let s,l,h,t=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let g=0;g<this.length;g++)l=n[g],h=this._trackByFn(g,l),null!==t&&Object.is(t.trackById,h)?(r&&(t=this._verifyReinsertion(t,l,h,g)),Object.is(t.item,l)||this._addIdentityChange(t,l)):(t=this._mismatch(t,l,h,g),r=!0),t=t._next}else s=0,function MH(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let r;for(;!(r=t.next()).done;)n(r.value)}}(n,g=>{h=this._trackByFn(s,g),null!==t&&Object.is(t.trackById,h)?(r&&(t=this._verifyReinsertion(t,g,h,s)),Object.is(t.item,g)||this._addIdentityChange(t,g)):(t=this._mismatch(t,g,h,s),r=!0),t=t._next,s++}),this.length=s;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,r,s){let l;return null===n?l=this._itTail:(l=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,l,s)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,s))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,l,s)):n=this._addAfter(new zZ(t,r),l,s),n}_verifyReinsertion(n,t,r,s){let l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==l?n=this._reinsertAfter(l,n._prev,s):n.currentIndex!=s&&(n.currentIndex=s,this._addToMoves(n,s)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const s=n._prevRemoved,l=n._nextRemoved;return null===s?this._removalsHead=l:s._nextRemoved=l,null===l?this._removalsTail=s:l._prevRemoved=s,this._insertAfter(n,t,r),this._addToMoves(n,r),n}_moveAfter(n,t,r){return this._unlink(n),this._insertAfter(n,t,r),this._addToMoves(n,r),n}_addAfter(n,t,r){return this._insertAfter(n,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,r){const s=null===t?this._itHead:t._next;return n._next=s,n._prev=t,null===s?this._itTail=n:s._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new E5),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,r=n._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new E5),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class zZ{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class UZ{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const t=n._prevDup,r=n._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class E5{constructor(){this.map=new Map}put(n){const t=n.trackById;let r=this.map.get(t);r||(r=new UZ,this.map.set(t,r)),r.add(n)}get(n,t){const s=this.map.get(n);return s?s.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function C5(e,n,t){const r=e.previousIndex;if(null===r)return r;let s=0;return t&&r<t.length&&(s=t[r]),r+n+s}function D5(){return new yP([new T5])}let yP=(()=>{class e{static#e=this.\u0275prov=sn({token:e,providedIn:"root",factory:D5});constructor(t){this.factories=t}static create(t,r){if(null!=r){const s=r.factories.slice();t=t.concat(s)}return new e(t)}static extend(t){return{provide:e,useFactory:r=>e.create(t,r||D5()),deps:[[e,new Od,new Mm]]}}find(t){const r=this.factories.find(s=>s.supports(t));if(null!=r)return r;throw new Jt(901,!1)}}return e})();const GZ=g5(null,"core",[]);let WZ=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Qh))};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})();const G5=new Gt("");function so(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function jA(e,n=NaN){return isNaN(parseFloat(e))||isNaN(Number(e))?n:Number(e)}function Z2(e,n){xo("NgSignals");const t=function Ef(e){const n=Object.create(Ka);n.computation=e;const t=()=>{if(vi(n),ei(n),n.value===wc)throw n.error;return n.value};return t[as]=n,t}(e);return n?.equal&&(t[as].equal=n.equal),t}function jp(e){const n=_r(null);try{return e()}finally{_r(n)}}function wP(e,n){const t=Vr(e),r=n.elementInjector||Pu();return new tt(t).create(r,n.projectableNodes,n.hostElement,n.environmentInjector)}let tz=null;function f_(){return tz}class NX{}const bo=new Gt("");let TP=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:()=>Xe(LX),providedIn:"platform"})}return e})();const FX=new Gt("");let LX=(()=>{class e extends TP{constructor(){super(),this._doc=Xe(bo),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return f_().getBaseHref(this._doc)}onPopState(t){const r=f_().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=f_().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,s){this._history.pushState(t,r,s)}replaceState(t,r,s){this._history.replaceState(t,r,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function EP(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function nz(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function _g(e){return e&&"?"!==e[0]?"?"+e:e}let p_=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:()=>Xe(iz),providedIn:"root"})}return e})();const rz=new Gt("");let iz=(()=>{class e extends p_{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Xe(bo).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return EP(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+_g(this._platformLocation.search),s=this._platformLocation.hash;return s&&t?`${r}${s}`:r}pushState(t,r,s,l){const h=this.prepareExternalUrl(s+_g(l));this._platformLocation.pushState(t,r,h)}replaceState(t,r,s,l){const h=this.prepareExternalUrl(s+_g(l));this._platformLocation.replaceState(t,r,h)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(TP),Dn(rz,8))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),sz=(()=>{class e extends p_{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){const r=this._platformLocation.hash??"#";return r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=EP(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,s,l){let h=this.prepareExternalUrl(s+_g(l));0==h.length&&(h=this._platformLocation.pathname),this._platformLocation.pushState(t,r,h)}replaceState(t,r,s,l){let h=this.prepareExternalUrl(s+_g(l));0==h.length&&(h=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,h)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(TP),Dn(rz,8))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})(),X2=(()=>{class e{constructor(t){this._subject=new ir,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function UX(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(nz(oz(r))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+_g(r))}normalize(t){return e.stripTrailingSlash(function zX(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,oz(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",s=null){this._locationStrategy.pushState(s,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+_g(r)),s)}replaceState(t,r="",s=null){this._locationStrategy.replaceState(s,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+_g(r)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(s=>s(t,r))}subscribe(t,r,s){return this._subject.subscribe({next:t,error:r,complete:s})}static#e=this.normalizeQueryParams=_g;static#t=this.joinWithSlash=EP;static#n=this.stripTrailingSlash=nz;static#r=this.\u0275fac=function(r){return new(r||e)(Dn(p_))};static#i=this.\u0275prov=sn({token:e,factory:()=>function BX(){return new X2(Dn(p_))}(),providedIn:"root"})}return e})();function oz(e){return e.replace(/\/index.html$/,"")}const az={ADP:[void 0,void 0,0],AFN:[void 0,"\u060b",0],ALL:[void 0,void 0,0],AMD:[void 0,"\u058f",2],AOA:[void 0,"Kz"],ARS:[void 0,"$"],AUD:["A$","$"],AZN:[void 0,"\u20bc"],BAM:[void 0,"KM"],BBD:[void 0,"$"],BDT:[void 0,"\u09f3"],BHD:[void 0,void 0,3],BIF:[void 0,void 0,0],BMD:[void 0,"$"],BND:[void 0,"$"],BOB:[void 0,"Bs"],BRL:["R$"],BSD:[void 0,"$"],BWP:[void 0,"P"],BYN:[void 0,void 0,2],BYR:[void 0,void 0,0],BZD:[void 0,"$"],CAD:["CA$","$",2],CHF:[void 0,void 0,2],CLF:[void 0,void 0,4],CLP:[void 0,"$",0],CNY:["CN\xa5","\xa5"],COP:[void 0,"$",2],CRC:[void 0,"\u20a1",2],CUC:[void 0,"$"],CUP:[void 0,"$"],CZK:[void 0,"K\u010d",2],DJF:[void 0,void 0,0],DKK:[void 0,"kr",2],DOP:[void 0,"$"],EGP:[void 0,"E\xa3"],ESP:[void 0,"\u20a7",0],EUR:["\u20ac"],FJD:[void 0,"$"],FKP:[void 0,"\xa3"],GBP:["\xa3"],GEL:[void 0,"\u20be"],GHS:[void 0,"GH\u20b5"],GIP:[void 0,"\xa3"],GNF:[void 0,"FG",0],GTQ:[void 0,"Q"],GYD:[void 0,"$",2],HKD:["HK$","$"],HNL:[void 0,"L"],HRK:[void 0,"kn"],HUF:[void 0,"Ft",2],IDR:[void 0,"Rp",2],ILS:["\u20aa"],INR:["\u20b9"],IQD:[void 0,void 0,0],IRR:[void 0,void 0,0],ISK:[void 0,"kr",0],ITL:[void 0,void 0,0],JMD:[void 0,"$"],JOD:[void 0,void 0,3],JPY:["\xa5",void 0,0],KHR:[void 0,"\u17db"],KMF:[void 0,"CF",0],KPW:[void 0,"\u20a9",0],KRW:["\u20a9",void 0,0],KWD:[void 0,void 0,3],KYD:[void 0,"$"],KZT:[void 0,"\u20b8"],LAK:[void 0,"\u20ad",0],LBP:[void 0,"L\xa3",0],LKR:[void 0,"Rs"],LRD:[void 0,"$"],LTL:[void 0,"Lt"],LUF:[void 0,void 0,0],LVL:[void 0,"Ls"],LYD:[void 0,void 0,3],MGA:[void 0,"Ar",0],MGF:[void 0,void 0,0],MMK:[void 0,"K",0],MNT:[void 0,"\u20ae",2],MRO:[void 0,void 0,0],MUR:[void 0,"Rs",2],MXN:["MX$","$"],MYR:[void 0,"RM"],NAD:[void 0,"$"],NGN:[void 0,"\u20a6"],NIO:[void 0,"C$"],NOK:[void 0,"kr",2],NPR:[void 0,"Rs"],NZD:["NZ$","$"],OMR:[void 0,void 0,3],PHP:["\u20b1"],PKR:[void 0,"Rs",2],PLN:[void 0,"z\u0142"],PYG:[void 0,"\u20b2",0],RON:[void 0,"lei"],RSD:[void 0,void 0,0],RUB:[void 0,"\u20bd"],RWF:[void 0,"RF",0],SBD:[void 0,"$"],SEK:[void 0,"kr",2],SGD:[void 0,"$"],SHP:[void 0,"\xa3"],SLE:[void 0,void 0,2],SLL:[void 0,void 0,0],SOS:[void 0,void 0,0],SRD:[void 0,"$"],SSP:[void 0,"\xa3"],STD:[void 0,void 0,0],STN:[void 0,"Db"],SYP:[void 0,"\xa3",0],THB:[void 0,"\u0e3f"],TMM:[void 0,void 0,0],TND:[void 0,void 0,3],TOP:[void 0,"T$"],TRL:[void 0,void 0,0],TRY:[void 0,"\u20ba"],TTD:[void 0,"$"],TWD:["NT$","$",2],TZS:[void 0,void 0,2],UAH:[void 0,"\u20b4"],UGX:[void 0,void 0,0],USD:["$"],UYI:[void 0,void 0,0],UYU:[void 0,"$"],UYW:[void 0,void 0,4],UZS:[void 0,void 0,2],VEF:[void 0,"Bs",2],VND:["\u20ab",void 0,0],VUV:[void 0,void 0,0],XAF:["FCFA",void 0,0],XCD:["EC$","$"],XOF:["F\u202fCFA",void 0,0],XPF:["CFPF",void 0,0],XXX:["\xa4"],YER:[void 0,void 0,0],ZAR:[void 0,"R"],ZMK:[void 0,void 0,0],ZMW:[void 0,"ZK"],ZWD:[void 0,void 0,0]};var $A=function(e){return e[e.Decimal=0]="Decimal",e[e.Percent=1]="Percent",e[e.Currency=2]="Currency",e[e.Scientific=3]="Scientific",e}($A||{}),zc=function(e){return e[e.Format=0]="Format",e[e.Standalone=1]="Standalone",e}(zc||{}),$s=function(e){return e[e.Narrow=0]="Narrow",e[e.Abbreviated=1]="Abbreviated",e[e.Wide=2]="Wide",e[e.Short=3]="Short",e}($s||{}),Wu=function(e){return e[e.Short=0]="Short",e[e.Medium=1]="Medium",e[e.Long=2]="Long",e[e.Full=3]="Full",e}(Wu||{});const _a={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function HA(e,n){return nd(Lc(e)[Xs.DateFormat],n)}function GA(e,n){return nd(Lc(e)[Xs.TimeFormat],n)}function WA(e,n){return nd(Lc(e)[Xs.DateTimeFormat],n)}function td(e,n){const t=Lc(e),r=t[Xs.NumberSymbols][n];if(typeof r>"u"){if(n===_a.CurrencyDecimal)return t[Xs.NumberSymbols][_a.Decimal];if(n===_a.CurrencyGroup)return t[Xs.NumberSymbols][_a.Group]}return r}function lz(e){if(!e[Xs.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[Xs.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function nd(e,n){for(let t=n;t>-1;t--)if(typeof e[t]<"u")return e[t];throw new Error("Locale data API: locale data undefined")}function SP(e){const[n,t]=e.split(":");return{hours:+n,minutes:+t}}const eY=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,qA={},tY=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var yg=function(e){return e[e.Short=0]="Short",e[e.ShortGMT=1]="ShortGMT",e[e.Long=2]="Long",e[e.Extended=3]="Extended",e}(yg||{}),ps=function(e){return e[e.FullYear=0]="FullYear",e[e.Month=1]="Month",e[e.Date=2]="Date",e[e.Hours=3]="Hours",e[e.Minutes=4]="Minutes",e[e.Seconds=5]="Seconds",e[e.FractionalSeconds=6]="FractionalSeconds",e[e.Day=7]="Day",e}(ps||{}),ms=function(e){return e[e.DayPeriods=0]="DayPeriods",e[e.Days=1]="Days",e[e.Months=2]="Months",e[e.Eras=3]="Eras",e}(ms||{});function cz(e,n,t,r){let s=function uY(e){if(dz(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[s,l=1,h=1]=e.split("-").map(g=>+g);return ZA(s,l-1,h)}const t=parseFloat(e);if(!isNaN(e-t))return new Date(t);let r;if(r=e.match(eY))return function hY(e){const n=new Date(0);let t=0,r=0;const s=e[8]?n.setUTCFullYear:n.setFullYear,l=e[8]?n.setUTCHours:n.setHours;e[9]&&(t=Number(e[9]+e[10]),r=Number(e[9]+e[11])),s.call(n,Number(e[1]),Number(e[2])-1,Number(e[3]));const h=Number(e[4]||0)-t,g=Number(e[5]||0)-r,x=Number(e[6]||0),E=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return l.call(n,h,g,x,E),n}(r)}const n=new Date(e);if(!dz(n))throw new Error(`Unable to convert "${e}" into a date`);return n}(e);n=vg(t,n)||n;let g,h=[];for(;n;){if(g=tY.exec(n),!g){h.push(n);break}{h=h.concat(g.slice(1));const D=h.pop();if(!D)break;n=D}}let x=s.getTimezoneOffset();r&&(x=hz(r,x),s=function cY(e,n,t){const r=t?-1:1,s=e.getTimezoneOffset();return function lY(e,n){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+n),e}(e,r*(hz(n,s)-s))}(s,r,!0));let E="";return h.forEach(D=>{const O=function aY(e){if(MP[e])return MP[e];let n;switch(e){case"G":case"GG":case"GGG":n=Ys(ms.Eras,$s.Abbreviated);break;case"GGGG":n=Ys(ms.Eras,$s.Wide);break;case"GGGGG":n=Ys(ms.Eras,$s.Narrow);break;case"y":n=ya(ps.FullYear,1,0,!1,!0);break;case"yy":n=ya(ps.FullYear,2,0,!0,!0);break;case"yyy":n=ya(ps.FullYear,3,0,!1,!0);break;case"yyyy":n=ya(ps.FullYear,4,0,!1,!0);break;case"Y":n=JA(1);break;case"YY":n=JA(2,!0);break;case"YYY":n=JA(3);break;case"YYYY":n=JA(4);break;case"M":case"L":n=ya(ps.Month,1,1);break;case"MM":case"LL":n=ya(ps.Month,2,1);break;case"MMM":n=Ys(ms.Months,$s.Abbreviated);break;case"MMMM":n=Ys(ms.Months,$s.Wide);break;case"MMMMM":n=Ys(ms.Months,$s.Narrow);break;case"LLL":n=Ys(ms.Months,$s.Abbreviated,zc.Standalone);break;case"LLLL":n=Ys(ms.Months,$s.Wide,zc.Standalone);break;case"LLLLL":n=Ys(ms.Months,$s.Narrow,zc.Standalone);break;case"w":n=DP(1);break;case"ww":n=DP(2);break;case"W":n=DP(1,!0);break;case"d":n=ya(ps.Date,1);break;case"dd":n=ya(ps.Date,2);break;case"c":case"cc":n=ya(ps.Day,1);break;case"ccc":n=Ys(ms.Days,$s.Abbreviated,zc.Standalone);break;case"cccc":n=Ys(ms.Days,$s.Wide,zc.Standalone);break;case"ccccc":n=Ys(ms.Days,$s.Narrow,zc.Standalone);break;case"cccccc":n=Ys(ms.Days,$s.Short,zc.Standalone);break;case"E":case"EE":case"EEE":n=Ys(ms.Days,$s.Abbreviated);break;case"EEEE":n=Ys(ms.Days,$s.Wide);break;case"EEEEE":n=Ys(ms.Days,$s.Narrow);break;case"EEEEEE":n=Ys(ms.Days,$s.Short);break;case"a":case"aa":case"aaa":n=Ys(ms.DayPeriods,$s.Abbreviated);break;case"aaaa":n=Ys(ms.DayPeriods,$s.Wide);break;case"aaaaa":n=Ys(ms.DayPeriods,$s.Narrow);break;case"b":case"bb":case"bbb":n=Ys(ms.DayPeriods,$s.Abbreviated,zc.Standalone,!0);break;case"bbbb":n=Ys(ms.DayPeriods,$s.Wide,zc.Standalone,!0);break;case"bbbbb":n=Ys(ms.DayPeriods,$s.Narrow,zc.Standalone,!0);break;case"B":case"BB":case"BBB":n=Ys(ms.DayPeriods,$s.Abbreviated,zc.Format,!0);break;case"BBBB":n=Ys(ms.DayPeriods,$s.Wide,zc.Format,!0);break;case"BBBBB":n=Ys(ms.DayPeriods,$s.Narrow,zc.Format,!0);break;case"h":n=ya(ps.Hours,1,-12);break;case"hh":n=ya(ps.Hours,2,-12);break;case"H":n=ya(ps.Hours,1);break;case"HH":n=ya(ps.Hours,2);break;case"m":n=ya(ps.Minutes,1);break;case"mm":n=ya(ps.Minutes,2);break;case"s":n=ya(ps.Seconds,1);break;case"ss":n=ya(ps.Seconds,2);break;case"S":n=ya(ps.FractionalSeconds,1);break;case"SS":n=ya(ps.FractionalSeconds,2);break;case"SSS":n=ya(ps.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":n=YA(yg.Short);break;case"ZZZZZ":n=YA(yg.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=YA(yg.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":n=YA(yg.Long);break;default:return null}return MP[e]=n,n}(D);E+=O?O(s,t,x):"''"===D?"'":D.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),E}function ZA(e,n,t){const r=new Date(0);return r.setFullYear(e,n,t),r.setHours(0,0,0),r}function vg(e,n){const t=function jX(e){return Lc(e)[Xs.LocaleId]}(e);if(qA[t]??={},qA[t][n])return qA[t][n];let r="";switch(n){case"shortDate":r=HA(e,Wu.Short);break;case"mediumDate":r=HA(e,Wu.Medium);break;case"longDate":r=HA(e,Wu.Long);break;case"fullDate":r=HA(e,Wu.Full);break;case"shortTime":r=GA(e,Wu.Short);break;case"mediumTime":r=GA(e,Wu.Medium);break;case"longTime":r=GA(e,Wu.Long);break;case"fullTime":r=GA(e,Wu.Full);break;case"short":const s=vg(e,"shortTime"),l=vg(e,"shortDate");r=XA(WA(e,Wu.Short),[s,l]);break;case"medium":const h=vg(e,"mediumTime"),g=vg(e,"mediumDate");r=XA(WA(e,Wu.Medium),[h,g]);break;case"long":const x=vg(e,"longTime"),E=vg(e,"longDate");r=XA(WA(e,Wu.Long),[x,E]);break;case"full":const D=vg(e,"fullTime"),O=vg(e,"fullDate");r=XA(WA(e,Wu.Full),[D,O])}return r&&(qA[t][n]=r),r}function XA(e,n){return n&&(e=e.replace(/\{([^}]+)}/g,function(t,r){return null!=n&&r in n?n[r]:t})),e}function hf(e,n,t="-",r,s){let l="";(e<0||s&&e<=0)&&(s?e=1-e:(e=-e,l=t));let h=String(e);for(;h.length<n;)h="0"+h;return r&&(h=h.slice(h.length-n)),l+h}function ya(e,n,t=0,r=!1,s=!1){return function(l,h){let g=function rY(e,n){switch(e){case ps.FullYear:return n.getFullYear();case ps.Month:return n.getMonth();case ps.Date:return n.getDate();case ps.Hours:return n.getHours();case ps.Minutes:return n.getMinutes();case ps.Seconds:return n.getSeconds();case ps.FractionalSeconds:return n.getMilliseconds();case ps.Day:return n.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,l);if((t>0||g>-t)&&(g+=t),e===ps.Hours)0===g&&-12===t&&(g=12);else if(e===ps.FractionalSeconds)return function nY(e,n){return hf(e,3).substring(0,n)}(g,n);const x=td(h,_a.MinusSign);return hf(g,n,x,r,s)}}function Ys(e,n,t=zc.Format,r=!1){return function(s,l){return function iY(e,n,t,r,s,l){switch(t){case ms.Months:return function GX(e,n,t){const r=Lc(e),l=nd([r[Xs.MonthsFormat],r[Xs.MonthsStandalone]],n);return nd(l,t)}(n,s,r)[e.getMonth()];case ms.Days:return function HX(e,n,t){const r=Lc(e),l=nd([r[Xs.DaysFormat],r[Xs.DaysStandalone]],n);return nd(l,t)}(n,s,r)[e.getDay()];case ms.DayPeriods:const h=e.getHours(),g=e.getMinutes();if(l){const E=function XX(e){const n=Lc(e);return lz(n),(n[Xs.ExtraData][2]||[]).map(r=>"string"==typeof r?SP(r):[SP(r[0]),SP(r[1])])}(n),D=function YX(e,n,t){const r=Lc(e);lz(r);const l=nd([r[Xs.ExtraData][0],r[Xs.ExtraData][1]],n)||[];return nd(l,t)||[]}(n,s,r),O=E.findIndex(N=>{if(Array.isArray(N)){const[B,W]=N,V=h>=B.hours&&g>=B.minutes,X=h<W.hours||h===W.hours&&g<W.minutes;if(B.hours<W.hours){if(V&&X)return!0}else if(V||X)return!0}else if(N.hours===h&&N.minutes===g)return!0;return!1});if(-1!==O)return D[O]}return function $X(e,n,t){const r=Lc(e),l=nd([r[Xs.DayPeriodsFormat],r[Xs.DayPeriodsStandalone]],n);return nd(l,t)}(n,s,r)[h<12?0:1];case ms.Eras:return function WX(e,n){return nd(Lc(e)[Xs.Eras],n)}(n,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${t}`)}}(s,l,e,n,t,r)}}function YA(e){return function(n,t,r){const s=-1*r,l=td(t,_a.MinusSign),h=s>0?Math.floor(s/60):Math.ceil(s/60);switch(e){case yg.Short:return(s>=0?"+":"")+hf(h,2,l)+hf(Math.abs(s%60),2,l);case yg.ShortGMT:return"GMT"+(s>=0?"+":"")+hf(h,1,l);case yg.Long:return"GMT"+(s>=0?"+":"")+hf(h,2,l)+":"+hf(Math.abs(s%60),2,l);case yg.Extended:return 0===r?"Z":(s>=0?"+":"")+hf(h,2,l)+":"+hf(Math.abs(s%60),2,l);default:throw new Error(`Unknown zone width "${e}"`)}}}const sY=0,KA=4;function uz(e){const n=e.getDay(),t=0===n?-3:KA-n;return ZA(e.getFullYear(),e.getMonth(),e.getDate()+t)}function DP(e,n=!1){return function(t,r){let s;if(n){const l=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,h=t.getDate();s=1+Math.floor((h+l)/7)}else{const l=uz(t),h=function oY(e){const n=ZA(e,sY,1).getDay();return ZA(e,0,1+(n<=KA?KA:KA+7)-n)}(l.getFullYear()),g=l.getTime()-h.getTime();s=1+Math.round(g/6048e5)}return hf(s,e,td(r,_a.MinusSign))}}function JA(e,n=!1){return function(t,r){return hf(uz(t).getFullYear(),e,td(r,_a.MinusSign),n)}}const MP={};function hz(e,n){e=e.replace(/:/g,"");const t=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(t)?n:t}function dz(e){return e instanceof Date&&!isNaN(e.valueOf())}const dY=/^(\d+)?\.((\d+)(-(\d+))?)?$/,fz=22,QA=".",Y2="0",fY=";",pY=",",AP="#";function gY(e,n,t,r,s){const h=function kP(e,n="-"){const t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(fY),s=r[0],l=r[1],h=-1!==s.indexOf(QA)?s.split(QA):[s.substring(0,s.lastIndexOf(Y2)+1),s.substring(s.lastIndexOf(Y2)+1)],g=h[0],x=h[1]||"";t.posPre=g.substring(0,g.indexOf(AP));for(let D=0;D<x.length;D++){const O=x.charAt(D);O===Y2?t.minFrac=t.maxFrac=D+1:O===AP?t.maxFrac=D+1:t.posSuf+=O}const E=g.split(pY);if(t.gSize=E[1]?E[1].length:0,t.lgSize=E[2]||E[1]?(E[2]||E[1]).length:0,l){const D=s.length-t.posPre.length-t.posSuf.length,O=l.indexOf(AP);t.negPre=l.substring(0,O).replace(/'/g,""),t.negSuf=l.slice(O+D).replace(/'/g,"")}else t.negPre=n+t.posPre,t.negSuf=t.posSuf;return t}(function CP(e,n){return Lc(e)[Xs.NumberFormats][n]}(n,$A.Currency),td(n,_a.MinusSign));return h.minFrac=function QX(e){let n;const t=az[e];return t&&(n=t[2]),"number"==typeof n?n:2}(r),h.maxFrac=h.minFrac,function IP(e,n,t,r,s,l,h=!1){let g="",x=!1;if(isFinite(e)){let E=function xY(e){let r,s,l,h,g,n=Math.abs(e)+"",t=0;for((s=n.indexOf(QA))>-1&&(n=n.replace(QA,"")),(l=n.search(/e/i))>0?(s<0&&(s=l),s+=+n.slice(l+1),n=n.substring(0,l)):s<0&&(s=n.length),l=0;n.charAt(l)===Y2;l++);if(l===(g=n.length))r=[0],s=1;else{for(g--;n.charAt(g)===Y2;)g--;for(s-=l,r=[],h=0;l<=g;l++,h++)r[h]=Number(n.charAt(l))}return s>fz&&(r=r.splice(0,fz-1),t=s-1,s=1),{digits:r,exponent:t,integerLen:s}}(e);h&&(E=function vY(e){if(0===e.digits[0])return e;const n=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===n?e.digits.push(0,0):1===n&&e.digits.push(0),e.integerLen+=2),e}(E));let D=n.minInt,O=n.minFrac,N=n.maxFrac;if(l){const oe=l.match(dY);if(null===oe)throw new Error(`${l} is not a valid digit info`);const fe=oe[1],Le=oe[3],Ze=oe[5];null!=fe&&(D=OP(fe)),null!=Le&&(O=OP(Le)),null!=Ze?N=OP(Ze):null!=Le&&O>N&&(N=O)}!function bY(e,n,t){if(n>t)throw new Error(`The minimum number of digits after fraction (${n}) is higher than the maximum (${t}).`);let r=e.digits,s=r.length-e.integerLen;const l=Math.min(Math.max(n,s),t);let h=l+e.integerLen,g=r[h];if(h>0){r.splice(Math.max(e.integerLen,h));for(let O=h;O<r.length;O++)r[O]=0}else{s=Math.max(0,s),e.integerLen=1,r.length=Math.max(1,h=l+1),r[0]=0;for(let O=1;O<h;O++)r[O]=0}if(g>=5)if(h-1<0){for(let O=0;O>h;O--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[h-1]++;for(;s<Math.max(0,l);s++)r.push(0);let x=0!==l;const E=n+e.integerLen,D=r.reduceRight(function(O,N,B,W){return W[B]=(N+=O)<10?N:N-10,x&&(0===W[B]&&B>=E?W.pop():x=!1),N>=10?1:0},0);D&&(r.unshift(D),e.integerLen++)}(E,O,N);let B=E.digits,W=E.integerLen;const V=E.exponent;let X=[];for(x=B.every(oe=>!oe);W<D;W++)B.unshift(0);for(;W<0;W++)B.unshift(0);W>0?X=B.splice(W,B.length):(X=B,B=[0]);const le=[];for(B.length>=n.lgSize&&le.unshift(B.splice(-n.lgSize,B.length).join(""));B.length>n.gSize;)le.unshift(B.splice(-n.gSize,B.length).join(""));B.length&&le.unshift(B.join("")),g=le.join(td(t,r)),X.length&&(g+=td(t,s)+X.join("")),V&&(g+=td(t,_a.Exponential)+"+"+V)}else g=td(t,_a.Infinity);return g=e<0&&!x?n.negPre+g+n.negSuf:n.posPre+g+n.posSuf,g}(e,h,n,_a.CurrencyGroup,_a.CurrencyDecimal,s).replace("\xa4",t).replace("\xa4","").trim()}function OP(e){const n=parseInt(e);if(isNaN(n))throw new Error("Invalid integer literal when parsing "+e);return n}function gz(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const r=t.indexOf("="),[s,l]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(s.trim()===n)return decodeURIComponent(l)}return null}const PP=/\s+/,_z=[];let K2=(()=>{class e{constructor(t,r){this._ngEl=t,this._renderer=r,this.initialClasses=_z,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(PP):_z}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(PP):t}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const r of t)this._updateState(r,!0);else if(null!=t)for(const r of Object.keys(t))this._updateState(r,!!t[r]);this._applyStateDiff()}_updateState(t,r){const s=this.stateMap.get(t);void 0!==s?(s.enabled!==r&&(s.changed=!0,s.enabled=r),s.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const r=t[0],s=t[1];s.changed?(this._toggleClass(r,s.enabled),s.changed=!1):s.touched||(s.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),s.touched=!1}}_toggleClass(t,r){(t=t.trim()).length>0&&t.split(PP).forEach(s=>{r?this._renderer.addClass(this._ngEl.nativeElement,s):this._renderer.removeClass(this._ngEl.nativeElement,s)})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Di),xt(qh))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class EY{constructor(n,t,r,s){this.$implicit=n,this.ngForOf=t,this.index=r,this.count=s}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let $p=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,s){this._viewContainer=t,this._template=r,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=this._viewContainer;t.forEachOperation((s,l,h)=>{if(null==s.previousIndex)r.createEmbeddedView(this._template,new EY(s.item,this._ngForOf,-1,-1),null===h?void 0:h);else if(null==h)r.remove(null===l?void 0:l);else if(null!==l){const g=r.get(l);r.move(g,h),vz(g,s)}});for(let s=0,l=r.length;s<l;s++){const g=r.get(s).context;g.index=s,g.count=l,g.ngForOf=this._ngForOf}t.forEachIdentityChange(s=>{vz(r.get(s.currentIndex),s)})}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(xt(ct),xt(si),xt(yP))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function vz(e,n){e.context.$implicit=n.item}let uu=(()=>{class e{constructor(t,r){this._viewContainer=t,this._context=new CY,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){xz("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){xz("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}static#e=this.\u0275fac=function(r){return new(r||e)(xt(ct),xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class CY{constructor(){this.$implicit=null,this.ngIf=null}}function xz(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Ts(n)}'.`)}let By=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){const r=this._viewContainerRef;if(this._viewRef&&r.remove(r.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const s=this._createContextForwardProxy();this._viewRef=r.createEmbeddedView(this.ngTemplateOutlet,s,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,r,s)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,r,s),get:(t,r,s)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,r,s)}})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(ct))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[to]})}return e})();function df(e,n){return new Jt(2100,!1)}const UY=new Gt(""),VY=new Gt("");let J2=(()=>{class e{constructor(t,r,s){this.locale=t,this.defaultTimezone=r,this.defaultOptions=s}transform(t,r,s,l){if(null==t||""===t||t!=t)return null;try{return cz(t,r??this.defaultOptions?.dateFormat??"mediumDate",l||this.locale,s??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(h){throw df()}}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Vp,16),xt(UY,24),xt(VY,24))};static#t=this.\u0275pipe=La({name:"date",type:e,pure:!0,standalone:!0})}return e})(),LP=(()=>{class e{constructor(t,r="USD"){this._locale=t,this._defaultCurrencyCode=r}transform(t,r=this._defaultCurrencyCode,s="symbol",l,h){if(!function BP(e){return!(null==e||""===e||e!=e)}(t))return null;h||=this._locale,"boolean"==typeof s&&(s=s?"symbol":"code");let g=r||this._defaultCurrencyCode;"code"!==s&&(g="symbol"===s||"symbol-narrow"===s?function KX(e,n,t="en"){const r=function qX(e){return Lc(e)[Xs.Currencies]}(t)[e]||az[e]||[],s=r[1];return"narrow"===n&&"string"==typeof s?s:r[0]||e}(g,"symbol"===s?"wide":"narrow",h):s);try{return gY(function zP(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(t),h,g,r,l)}catch(x){throw df()}}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Vp,16),xt(DZ,16))};static#t=this.\u0275pipe=La({name:"currency",type:e,pure:!0,standalone:!0})}return e})();let Tz=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})();const Ez="browser";function Cz(e){return"server"===e}let JY=(()=>{class e{static#e=this.\u0275prov=sn({token:e,providedIn:"root",factory:()=>function KY(e){return e===Ez}(Xe(Ep))?new QY(Xe(bo),window):new tK})}return e})();class QY{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n){this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){const t=function eK(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let s=r.currentNode;for(;s;){const l=s.shadowRoot;if(l){const h=l.getElementById(n)||l.querySelector(`[name="${n}"]`);if(h)return h}s=r.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.window.history.scrollRestoration=n}scrollToElement(n){const t=n.getBoundingClientRect(),r=t.left+this.window.pageXOffset,s=t.top+this.window.pageYOffset,l=this.offset();this.window.scrollTo(r-l[0],s-l[1])}}class tK{setOffset(n){}getScrollPosition(){return[0,0]}scrollToPosition(n){}scrollToAnchor(n){}setHistoryScrollRestoration(n){}}class Sz{}class AK extends NX{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class $P extends AK{static makeCurrent(){!function PX(e){tz??=e}(new $P)}onAndCancel(n,t,r){return n.addEventListener(t,r),()=>{n.removeEventListener(t,r)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function IK(){return tC=tC||document.querySelector("base"),tC?tC.getAttribute("href"):null}();return null==t?null:function kK(e){return new URL(e,document.baseURI).pathname}(t)}resetBaseElement(){tC=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return gz(document.cookie,n)}}let tC=null,RK=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();const rI=new Gt("");let Fz=(()=>{class e{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(s=>{s.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,s){return this._findPluginFor(r).addEventListener(t,r,s)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(l=>l.supports(t)),!r)throw new Jt(5101,!1);return this._eventNameToPlugin.set(t,r),r}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(rI),Dn(Qr))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();class HP{constructor(n){this._doc=n}}const GP="ng-app-id";let Lz=(()=>{class e{constructor(t,r,s,l={}){this.doc=t,this.appId=r,this.nonce=s,this.platformId=l,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Cz(l),this.resetHostNodes()}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.elements?.forEach(s=>s.remove()),r.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${GP}="${this.appId}"]`);if(t?.length){const r=new Map;return t.forEach(s=>{null!=s.textContent&&r.set(s.textContent,s)}),r}return null}changeUsageCount(t,r){const s=this.styleRef;if(s.has(t)){const l=s.get(t);return l.usage+=r,l.usage}return s.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){const s=this.styleNodesInDOM,l=s?.get(r);if(l?.parentNode===t)return s.delete(r),l.removeAttribute(GP),l;{const h=this.doc.createElement("style");return this.nonce&&h.setAttribute("nonce",this.nonce),h.textContent=r,this.platformIsServer&&h.setAttribute(GP,this.appId),t.appendChild(h),h}}addStyleToHost(t,r){const s=this.getStyleElement(t,r),l=this.styleRef,h=l.get(r)?.elements;h?h.push(s):l.set(r,{elements:[s],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(bo),Dn(Tp),Dn(mD,8),Dn(Ep))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();const WP={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},qP=/%COMP%/g,LK=new Gt("",{providedIn:"root",factory:()=>!0});function zz(e,n){return n.map(t=>t.replace(qP,e))}let Uz=(()=>{class e{constructor(t,r,s,l,h,g,x,E=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=s,this.removeStylesOnCompDestroy=l,this.doc=h,this.platformId=g,this.ngZone=x,this.nonce=E,this.rendererByCompId=new Map,this.platformIsServer=Cz(g),this.defaultRenderer=new ZP(t,h,x,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Ol.ShadowDom&&(r={...r,encapsulation:Ol.Emulated});const s=this.getOrCreateRenderer(t,r);return s instanceof jz?s.applyToHost(t):s instanceof XP&&s.applyStyles(),s}getOrCreateRenderer(t,r){const s=this.rendererByCompId;let l=s.get(r.id);if(!l){const h=this.doc,g=this.ngZone,x=this.eventManager,E=this.sharedStylesHost,D=this.removeStylesOnCompDestroy,O=this.platformIsServer;switch(r.encapsulation){case Ol.Emulated:l=new jz(x,E,r,this.appId,D,h,g,O);break;case Ol.ShadowDom:return new VK(x,E,t,r,h,g,this.nonce,O);default:l=new XP(x,E,r,D,h,g,O)}s.set(r.id,l)}return l}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Fz),Dn(Lz),Dn(Tp),Dn(LK),Dn(bo),Dn(Ep),Dn(Qr),Dn(mD))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();class ZP{constructor(n,t,r,s){this.eventManager=n,this.doc=t,this.ngZone=r,this.platformIsServer=s,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(WP[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(Vz(n)?n.content:n).appendChild(t)}insertBefore(n,t,r){n&&(Vz(n)?n.content:n).insertBefore(t,r)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new Jt(-5104,!1);return t||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,r,s){if(s){t=s+":"+t;const l=WP[s];l?n.setAttributeNS(l,t,r):n.setAttribute(t,r)}else n.setAttribute(t,r)}removeAttribute(n,t,r){if(r){const s=WP[r];s?n.removeAttributeNS(s,t):n.removeAttribute(`${r}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,r,s){s&(Dp.DashCase|Dp.Important)?n.style.setProperty(t,r,s&Dp.Important?"important":""):n.style[t]=r}removeStyle(n,t,r){r&Dp.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,r){null!=n&&(n[t]=r)}setValue(n,t){n.nodeValue=t}listen(n,t,r){if("string"==typeof n&&!(n=f_().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(r))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function Vz(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class VK extends ZP{constructor(n,t,r,s,l,h,g,x){super(n,l,h,x),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const E=zz(s.id,s.styles);for(const D of E){const O=document.createElement("style");g&&O.setAttribute("nonce",g),O.textContent=D,this.shadowRoot.appendChild(O)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,r){return super.insertBefore(this.nodeOrShadowRoot(n),t,r)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class XP extends ZP{constructor(n,t,r,s,l,h,g,x){super(n,l,h,g),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=s,this.styles=x?zz(x,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class jz extends XP{constructor(n,t,r,s,l,h,g,x){const E=s+"-"+r.id;super(n,t,r,l,h,g,x,E),this.contentAttr=function BK(e){return"_ngcontent-%COMP%".replace(qP,e)}(E),this.hostAttr=function zK(e){return"_nghost-%COMP%".replace(qP,e)}(E)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const r=super.createElement(n,t);return super.setAttribute(r,this.contentAttr,""),r}}let jK=(()=>{class e extends HP{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,s){return t.addEventListener(r,s,!1),()=>this.removeEventListener(t,r,s)}removeEventListener(t,r,s){return t.removeEventListener(r,s)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(bo))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})(),$K=(()=>{class e extends HP{constructor(t){super(t),this.delegate=Xe(G5,{optional:!0})}supports(t){return!!this.delegate&&this.delegate.supports(t)}addEventListener(t,r,s){return this.delegate.addEventListener(t,r,s)}removeEventListener(t,r,s){return this.delegate.removeEventListener(t,r,s)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(bo))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();const $z=["alt","control","meta","shift"],HK={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},GK={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let WK=(()=>{class e extends HP{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,s){const l=e.parseEventName(r),h=e.eventCallback(l.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>f_().onAndCancel(t,l.domEventName,h))}static parseEventName(t){const r=t.toLowerCase().split("."),s=r.shift();if(0===r.length||"keydown"!==s&&"keyup"!==s)return null;const l=e._normalizeKey(r.pop());let h="",g=r.indexOf("code");if(g>-1&&(r.splice(g,1),h="code."),$z.forEach(E=>{const D=r.indexOf(E);D>-1&&(r.splice(D,1),h+=E+".")}),h+=l,0!=r.length||0===l.length)return null;const x={};return x.domEventName=s,x.fullKey=h,x}static matchEventFullKeyCode(t,r){let s=HK[t.key]||t.key,l="";return r.indexOf("code.")>-1&&(s=t.code,l="code."),!(null==s||!s)&&(s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),$z.forEach(h=>{h!==s&&(0,GK[h])(t)&&(l+=h+".")}),l+=s,l===r)}static eventCallback(t,r,s){return l=>{e.matchEventFullKeyCode(l,t)&&s.runGuarded(()=>r(l))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(bo))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();const YK=g5(GZ,"browser",[{provide:Ep,useValue:Ez},{provide:GT,useValue:function qK(){$P.makeCurrent()},multi:!0},{provide:bo,useFactory:function XK(){return function pD(e){Ax=e}(document),document},deps:[]}]),KK=new Gt(""),Wz=[{provide:AA,useClass:class OK{addToWindow(n){ls.getAngularTestability=(r,s=!0)=>{const l=n.findTestabilityInTree(r,s);if(null==l)throw new Jt(5103,!1);return l},ls.getAllAngularTestabilities=()=>n.getAllTestabilities(),ls.getAllAngularRootElements=()=>n.getAllRootElements(),ls.frameworkStabilizers||(ls.frameworkStabilizers=[]),ls.frameworkStabilizers.push(r=>{const s=ls.getAllAngularTestabilities();let l=s.length;const h=function(){l--,0==l&&r()};s.forEach(g=>{g.whenStable(h)})})}findTestabilityInTree(n,t,r){return null==t?null:n.getTestability(t)??(r?f_().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:i5,useClass:iP,deps:[Qr,sP,AA]},{provide:iP,useClass:iP,deps:[Qr,sP,AA]}],qz=[{provide:sp,useValue:"root"},{provide:lc,useFactory:function ZK(){return new lc},deps:[]},{provide:rI,useClass:jK,multi:!0,deps:[bo,Qr,Ep]},{provide:rI,useClass:WK,multi:!0,deps:[bo]},{provide:rI,useClass:$K,multi:!0},Uz,Lz,Fz,{provide:u2,useExisting:Uz},{provide:Sz,useClass:RK,deps:[]},[]];let JK=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Tp,useValue:t.appId}]}}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(KK,12))};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({providers:[...qz,...Wz],imports:[Tz,WZ]})}return e})(),QK=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(bo))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),nC=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:function(r){let s=null;return s=r?new(r||e):Dn(rJ),s},providedIn:"root"})}return e})(),rJ=(()=>{class e extends nC{constructor(t){super(),this._doc=t}sanitize(t,r){if(null==r)return null;switch(t){case ou.NONE:return r;case ou.HTML:return Fu(r,"HTML")?$l(r):cE(this._doc,String(r)).toString();case ou.STYLE:return Fu(r,"Style")?$l(r):r;case ou.SCRIPT:if(Fu(r,"Script"))return $l(r);throw new Jt(5200,!1);case ou.URL:return Fu(r,"URL")?$l(r):Hx(String(r));case ou.RESOURCE_URL:if(Fu(r,"ResourceURL"))return $l(r);throw new Jt(5201,!1);default:throw new Jt(5202,!1)}}bypassSecurityTrustHtml(t){return function OD(e){return new MD(e)}(t)}bypassSecurityTrustStyle(t){return function RD(e){return new $x(e)}(t)}bypassSecurityTrustScript(t){return function PD(e){return new AD(e)}(t)}bypassSecurityTrustUrl(t){return function wO(e){return new bO(e)}(t)}bypassSecurityTrustResourceUrl(t){return function ND(e){return new ID(e)}(t)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(bo))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Yz(e,n,t,r,s,l,h){try{var g=e[l](h),x=g.value}catch(E){return void t(E)}g.done?n(x):Promise.resolve(x).then(r,s)}function Kz(e){return function(){var n=this,t=arguments;return new Promise(function(r,s){var l=e.apply(n,t);function h(x){Yz(l,r,s,h,g,"next",x)}function g(x){Yz(l,r,s,h,g,"throw",x)}h(void 0)})}}function Jz(e){return e&&hn(e.schedule)}function YP(e){return e[e.length-1]}function sI(e){return hn(YP(e))?e.pop():void 0}function rC(e){return Jz(YP(e))?e.pop():void 0}function m_(e){return this instanceof m_?(this.v=e,this):new m_(e)}function n6(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function eN(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(l){t[l]=e[l]&&function(h){return new Promise(function(g,x){!function s(l,h,g,x){Promise.resolve(x).then(function(E){l({value:E,done:g})},h)}(g,x,(h=e[l](h)).done,h.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const tN=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function r6(e){return hn(e?.then)}function i6(e){return hn(e[Tu])}function s6(e){return Symbol.asyncIterator&&hn(e?.[Symbol.asyncIterator])}function o6(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const a6=function SJ(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function l6(e){return hn(e?.[a6])}function c6(e){return function t6(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,r=t.apply(e,n||[]),l=[];return s={},g("next"),g("throw"),g("return",function h(B){return function(W){return Promise.resolve(W).then(B,O)}}),s[Symbol.asyncIterator]=function(){return this},s;function g(B,W){r[B]&&(s[B]=function(V){return new Promise(function(X,le){l.push([B,V,X,le])>1||x(B,V)})},W&&(s[B]=W(s[B])))}function x(B,W){try{!function E(B){B.value instanceof m_?Promise.resolve(B.value.v).then(D,O):N(l[0][2],B)}(r[B](W))}catch(V){N(l[0][3],V)}}function D(B){x("next",B)}function O(B){x("throw",B)}function N(B,W){B(W),l.shift(),l.length&&x(l[0][0],l[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:s}=yield m_(t.read());if(s)return yield m_(void 0);yield yield m_(r)}}finally{t.releaseLock()}})}function u6(e){return hn(e?.getReader)}function pl(e){if(e instanceof $i)return e;if(null!=e){if(i6(e))return function DJ(e){return new $i(n=>{const t=e[Tu]();if(hn(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(tN(e))return function MJ(e){return new $i(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(r6(e))return function AJ(e){return new $i(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,qc)})}(e);if(s6(e))return h6(e);if(l6(e))return function IJ(e){return new $i(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(u6(e))return function kJ(e){return h6(c6(e))}(e)}throw o6(e)}function h6(e){return new $i(n=>{(function OJ(e,n){var t,r,s,l;return function Qz(e,n,t,r){return new(t||(t=Promise))(function(l,h){function g(D){try{E(r.next(D))}catch(O){h(O)}}function x(D){try{E(r.throw(D))}catch(O){h(O)}}function E(D){D.done?l(D.value):function s(l){return l instanceof t?l:new t(function(h){h(l)})}(D.value).then(g,x)}E((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=n6(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(h){s={error:h}}finally{try{r&&!r.done&&(l=t.return)&&(yield l.call(t))}finally{if(s)throw s.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function xg(e,n,t,r=0,s=!1){const l=n.schedule(function(){t(),s?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(l),!s)return l}function d6(e,n=0){return ys((t,r)=>{t.subscribe(Me(r,s=>xg(r,e,()=>r.next(s),n),()=>xg(r,e,()=>r.complete(),n),s=>xg(r,e,()=>r.error(s),n)))})}function f6(e,n=0){return ys((t,r)=>{r.add(e.schedule(()=>t.subscribe(r),n))})}function p6(e,n){if(!e)throw new Error("Iterable cannot be null");return new $i(t=>{xg(t,n,()=>{const r=e[Symbol.asyncIterator]();xg(t,n,()=>{r.next().then(s=>{s.done?t.complete():t.next(s.value)})},0,!0)})})}function va(e,n){return n?function BJ(e,n){if(null!=e){if(i6(e))return function RJ(e,n){return pl(e).pipe(f6(n),d6(n))}(e,n);if(tN(e))return function NJ(e,n){return new $i(t=>{let r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}(e,n);if(r6(e))return function PJ(e,n){return pl(e).pipe(f6(n),d6(n))}(e,n);if(s6(e))return p6(e,n);if(l6(e))return function FJ(e,n){return new $i(t=>{let r;return xg(t,n,()=>{r=e[a6](),xg(t,n,()=>{let s,l;try{({value:s,done:l}=r.next())}catch(h){return void t.error(h)}l?t.complete():t.next(s)},0,!0)}),()=>hn(r?.return)&&r.return()})}(e,n);if(u6(e))return function LJ(e,n){return p6(c6(e),n)}(e,n)}throw o6(e)}(e,n):pl(e)}function Lr(...e){return va(e,rC(e))}function ml(e,n,t=1/0){return hn(n)?ml((r,s)=>J((l,h)=>n(r,l,s,h))(pl(e(r,s))),t):("number"==typeof n&&(t=n),ys((r,s)=>function zJ(e,n,t,r,s,l,h,g){const x=[];let E=0,D=0,O=!1;const N=()=>{O&&!x.length&&!E&&n.complete()},B=V=>E<r?W(V):x.push(V),W=V=>{l&&n.next(V),E++;let X=!1;pl(t(V,D++)).subscribe(Me(n,le=>{s?.(le),l?B(le):n.next(le)},()=>{X=!0},void 0,()=>{if(X)try{for(E--;x.length&&E<r;){const le=x.shift();h?xg(n,h,()=>W(le)):W(le)}N()}catch(le){n.error(le)}}))};return e.subscribe(Me(n,B,()=>{O=!0,N()})),()=>{g?.()}}(r,s,e,t)))}function ow(e,n){return hn(n)?ml(e,n,1):ml(e,1)}function xa(e,n){return ys((t,r)=>{let s=0;t.subscribe(Me(r,l=>e.call(n,l,s++)&&r.next(l)))})}function iC(e){return ys((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}function rd(e,n){return ys((t,r)=>{let s=null,l=0,h=!1;const g=()=>h&&!s&&r.complete();t.subscribe(Me(r,x=>{s?.unsubscribe();let E=0;const D=l++;pl(e(x,D)).subscribe(s=Me(r,O=>r.next(n?n(x,O,D,E++):O),()=>{s=null,g()}))},()=>{h=!0,g()}))})}class oI{}class aI{}class Uc{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const s=t.slice(0,r),l=s.toLowerCase(),h=t.slice(r+1).trim();this.maybeSetNormalizedName(s,l),this.headers.has(l)?this.headers.get(l).push(h):this.headers.set(l,[h])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof Uc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){const t=new Uc;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Uc?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){const t=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,t);const s=("a"===n.op?this.headers.get(t):void 0)||[];s.push(...r),this.headers.set(t,s);break;case"d":const l=n.value;if(l){let h=this.headers.get(t);if(!h)return;h=h.filter(g=>-1===l.indexOf(g)),0===h.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,h)}else this.headers.delete(t),this.normalizedNames.delete(t)}}setHeaderEntries(n,t){const r=(Array.isArray(t)?t:[t]).map(l=>l.toString()),s=n.toLowerCase();this.headers.set(s,r),this.maybeSetNormalizedName(n,s)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}}class UJ{encodeKey(n){return m6(n)}encodeValue(n){return m6(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const jJ=/%(\d[a-f0-9])/gi,$J={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function m6(e){return encodeURIComponent(e).replace(jJ,(n,t)=>$J[t]??n)}function lI(e){return`${e}`}class g_{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new UJ,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function VJ(e,n){const t=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(s=>{const l=s.indexOf("="),[h,g]=-1==l?[n.decodeKey(s),""]:[n.decodeKey(s.slice(0,l)),n.decodeValue(s.slice(l+1))],x=t.get(h)||[];x.push(g),t.set(h,x)}),t}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{const r=n.fromObject[t],s=Array.isArray(r)?r.map(lI):[lI(r)];this.map.set(t,s)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){const t=[];return Object.keys(n).forEach(r=>{const s=n[r];Array.isArray(s)?s.forEach(l=>{t.push({param:r,value:l,op:"a"})}):t.push({param:r,value:s,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const t=this.encoder.encodeKey(n);return this.map.get(n).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const t=new g_({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const t=("a"===n.op?this.map.get(n.param):void 0)||[];t.push(lI(n.value)),this.map.set(n.param,t);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const s=r.indexOf(lI(n.value));-1!==s&&r.splice(s,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class HJ{constructor(){this.map=new Map}set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function g6(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function _6(e){return typeof Blob<"u"&&e instanceof Blob}function y6(e){return typeof FormData<"u"&&e instanceof FormData}class sC{constructor(n,t,r,s){let l;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function GJ(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||s?(this.body=void 0!==r?r:null,l=s):l=r,l&&(this.reportProgress=!!l.reportProgress,this.withCredentials=!!l.withCredentials,l.responseType&&(this.responseType=l.responseType),l.headers&&(this.headers=l.headers),l.context&&(this.context=l.context),l.params&&(this.params=l.params),this.transferCache=l.transferCache),this.headers??=new Uc,this.context??=new HJ,this.params){const h=this.params.toString();if(0===h.length)this.urlWithParams=t;else{const g=t.indexOf("?");this.urlWithParams=t+(-1===g?"?":g<t.length-1?"&":"")+h}}else this.params=new g_,this.urlWithParams=t}serializeBody(){return null===this.body?null:"string"==typeof this.body||g6(this.body)||_6(this.body)||y6(this.body)||function WJ(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)?this.body:this.body instanceof g_?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||y6(this.body)?null:_6(this.body)?this.body.type||null:g6(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof g_?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const t=n.method||this.method,r=n.url||this.url,s=n.responseType||this.responseType,l=n.transferCache??this.transferCache,h=void 0!==n.body?n.body:this.body,g=n.withCredentials??this.withCredentials,x=n.reportProgress??this.reportProgress;let E=n.headers||this.headers,D=n.params||this.params;const O=n.context??this.context;return void 0!==n.setHeaders&&(E=Object.keys(n.setHeaders).reduce((N,B)=>N.set(B,n.setHeaders[B]),E)),n.setParams&&(D=Object.keys(n.setParams).reduce((N,B)=>N.set(B,n.setParams[B]),D)),new sC(t,r,h,{params:D,headers:E,context:O,reportProgress:x,responseType:s,withCredentials:g,transferCache:l})}}var __=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(__||{});class nN{constructor(n,t=200,r="OK"){this.headers=n.headers||new Uc,this.status=void 0!==n.status?n.status:t,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class cI extends nN{constructor(n={}){super(n),this.type=__.ResponseHeader}clone(n={}){return new cI({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class Uy extends nN{constructor(n={}){super(n),this.type=__.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new Uy({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class aw extends nN{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function rN(e,n){return{body:n,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache}}let Hp=(()=>{class e{constructor(t){this.handler=t}request(t,r,s={}){let l;if(t instanceof sC)l=t;else{let x,E;x=s.headers instanceof Uc?s.headers:new Uc(s.headers),s.params&&(E=s.params instanceof g_?s.params:new g_({fromObject:s.params})),l=new sC(t,r,void 0!==s.body?s.body:null,{headers:x,context:s.context,params:E,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}const h=Lr(l).pipe(ow(x=>this.handler.handle(x)));if(t instanceof sC||"events"===s.observe)return h;const g=h.pipe(xa(x=>x instanceof Uy));switch(s.observe||"body"){case"body":switch(l.responseType){case"arraybuffer":return g.pipe(J(x=>{if(null!==x.body&&!(x.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return x.body}));case"blob":return g.pipe(J(x=>{if(null!==x.body&&!(x.body instanceof Blob))throw new Error("Response is not a Blob.");return x.body}));case"text":return g.pipe(J(x=>{if(null!==x.body&&"string"!=typeof x.body)throw new Error("Response is not a string.");return x.body}));default:return g.pipe(J(x=>x.body))}case"response":return g;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new g_).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,s={}){return this.request("PATCH",t,rN(s,r))}post(t,r,s={}){return this.request("POST",t,rN(s,r))}put(t,r,s={}){return this.request("PUT",t,rN(s,r))}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(oI))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();const XJ=/^\)\]\}',?\n/;function x6(e){if(e.url)return e.url;const n="X-Request-URL".toLocaleLowerCase();return e.headers.get(n)}let iN=(()=>{class e{constructor(){this.fetchImpl=Xe(KJ,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Xe(Qr)}handle(t){return new $i(r=>{const s=new AbortController;return this.doRequest(t,s.signal,r).then(sN,l=>r.error(new aw({error:l}))),()=>s.abort()})}doRequest(t,r,s){var l=this;return Kz(function*(){const h=l.createRequestInit(t);let g;try{const W=l.ngZone.runOutsideAngular(()=>l.fetchImpl(t.urlWithParams,{signal:r,...h}));(function JJ(e){e.then(sN,sN)})(W),s.next({type:__.Sent}),g=yield W}catch(W){return void s.error(new aw({error:W,status:W.status??0,statusText:W.statusText,url:t.urlWithParams,headers:W.headers}))}const x=new Uc(g.headers),E=g.statusText,D=x6(g)??t.urlWithParams;let O=g.status,N=null;if(t.reportProgress&&s.next(new cI({headers:x,status:O,statusText:E,url:D})),g.body){const W=g.headers.get("content-length"),V=[],X=g.body.getReader();let oe,fe,le=0;const Le=typeof Zone<"u"&&Zone.current;yield l.ngZone.runOutsideAngular(Kz(function*(){for(;;){const{done:at,value:Ne}=yield X.read();if(at)break;if(V.push(Ne),le+=Ne.length,t.reportProgress){fe="text"===t.responseType?(fe??"")+(oe??=new TextDecoder).decode(Ne,{stream:!0}):void 0;const ot=()=>s.next({type:__.DownloadProgress,total:W?+W:void 0,loaded:le,partialText:fe});Le?Le.run(ot):ot()}}}));const Ze=l.concatChunks(V,le);try{const at=g.headers.get("Content-Type")??"";N=l.parseBody(t,Ze,at)}catch(at){return void s.error(new aw({error:at,headers:new Uc(g.headers),status:g.status,statusText:g.statusText,url:x6(g)??t.urlWithParams}))}}0===O&&(O=N?200:0),O>=200&&O<300?(s.next(new Uy({body:N,headers:x,status:O,statusText:E,url:D})),s.complete()):s.error(new aw({error:N,headers:x,status:O,statusText:E,url:D}))})()}parseBody(t,r,s){switch(t.responseType){case"json":const l=(new TextDecoder).decode(r).replace(XJ,"");return""===l?null:JSON.parse(l);case"text":return(new TextDecoder).decode(r);case"blob":return new Blob([r],{type:s});case"arraybuffer":return r.buffer}}createRequestInit(t){const r={},s=t.withCredentials?"include":void 0;if(t.headers.forEach((l,h)=>r[l]=h.join(",")),t.headers.has("Accept")||(r.Accept="application/json, text/plain, */*"),!t.headers.has("Content-Type")){const l=t.detectContentTypeHeader();null!==l&&(r["Content-Type"]=l)}return{body:t.serializeBody(),method:t.method,headers:r,credentials:s}}concatChunks(t,r){const s=new Uint8Array(r);let l=0;for(const h of t)s.set(h,l),l+=h.length;return s}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();class KJ{}function sN(){}function b6(e,n){return n(e)}function QJ(e,n){return(t,r)=>n.intercept(t,{handle:s=>e(s,r)})}const tQ=new Gt(""),oC=new Gt(""),w6=new Gt(""),T6=new Gt("",{providedIn:"root",factory:()=>!0});function nQ(){let e=null;return(n,t)=>{null===e&&(e=(Xe(tQ,{optional:!0})??[]).reduceRight(QJ,b6));const r=Xe(zh);if(Xe(T6)){const l=r.add();return e(n,t).pipe(iC(()=>r.remove(l)))}return e(n,t)}}let E6=(()=>{class e extends oI{constructor(t,r){super(),this.backend=t,this.injector=r,this.chain=null,this.pendingTasks=Xe(zh),this.contributeToStability=Xe(T6)}handle(t){if(null===this.chain){const r=Array.from(new Set([...this.injector.get(oC),...this.injector.get(w6,[])]));this.chain=r.reduceRight((s,l)=>function eQ(e,n,t){return(r,s)=>Ic(t,()=>n(r,l=>e(l,s)))}(s,l,this.injector),b6)}if(this.contributeToStability){const r=this.pendingTasks.add();return this.chain(t,s=>this.backend.handle(s)).pipe(iC(()=>this.pendingTasks.remove(r)))}return this.chain(t,r=>this.backend.handle(r))}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(aI),Dn(qo))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();const aQ=/^\)\]\}',?\n/;let S6=(()=>{class e{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Jt(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?va(r.\u0275loadImpl()):Lr(null)).pipe(rd(()=>new $i(l=>{const h=r.build();if(h.open(t.method,t.urlWithParams),t.withCredentials&&(h.withCredentials=!0),t.headers.forEach((V,X)=>h.setRequestHeader(V,X.join(","))),t.headers.has("Accept")||h.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const V=t.detectContentTypeHeader();null!==V&&h.setRequestHeader("Content-Type",V)}if(t.responseType){const V=t.responseType.toLowerCase();h.responseType="json"!==V?V:"text"}const g=t.serializeBody();let x=null;const E=()=>{if(null!==x)return x;const V=h.statusText||"OK",X=new Uc(h.getAllResponseHeaders()),le=function lQ(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(h)||t.url;return x=new cI({headers:X,status:h.status,statusText:V,url:le}),x},D=()=>{let{headers:V,status:X,statusText:le,url:oe}=E(),fe=null;204!==X&&(fe=typeof h.response>"u"?h.responseText:h.response),0===X&&(X=fe?200:0);let Le=X>=200&&X<300;if("json"===t.responseType&&"string"==typeof fe){const Ze=fe;fe=fe.replace(aQ,"");try{fe=""!==fe?JSON.parse(fe):null}catch(at){fe=Ze,Le&&(Le=!1,fe={error:at,text:fe})}}Le?(l.next(new Uy({body:fe,headers:V,status:X,statusText:le,url:oe||void 0})),l.complete()):l.error(new aw({error:fe,headers:V,status:X,statusText:le,url:oe||void 0}))},O=V=>{const{url:X}=E(),le=new aw({error:V,status:h.status||0,statusText:h.statusText||"Unknown Error",url:X||void 0});l.error(le)};let N=!1;const B=V=>{N||(l.next(E()),N=!0);let X={type:__.DownloadProgress,loaded:V.loaded};V.lengthComputable&&(X.total=V.total),"text"===t.responseType&&h.responseText&&(X.partialText=h.responseText),l.next(X)},W=V=>{let X={type:__.UploadProgress,loaded:V.loaded};V.lengthComputable&&(X.total=V.total),l.next(X)};return h.addEventListener("load",D),h.addEventListener("error",O),h.addEventListener("timeout",O),h.addEventListener("abort",O),t.reportProgress&&(h.addEventListener("progress",B),null!==g&&h.upload&&h.upload.addEventListener("progress",W)),h.send(g),l.next({type:__.Sent}),()=>{h.removeEventListener("error",O),h.removeEventListener("abort",O),h.removeEventListener("load",D),h.removeEventListener("timeout",O),t.reportProgress&&(h.removeEventListener("progress",B),null!==g&&h.upload&&h.upload.removeEventListener("progress",W)),h.readyState!==h.DONE&&h.abort()}})))}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Sz))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();const oN=new Gt(""),D6=new Gt("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),M6=new Gt("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class A6{}let hQ=(()=>{class e{constructor(t,r,s){this.doc=t,this.platform=r,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=gz(t,this.cookieName),this.lastCookieString=t),this.lastToken}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(bo),Dn(Ep),Dn(D6))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();function dQ(e,n){const t=e.url.toLowerCase();if(!Xe(oN)||"GET"===e.method||"HEAD"===e.method||t.startsWith("http://")||t.startsWith("https://"))return n(e);const r=Xe(A6).getToken(),s=Xe(M6);return null!=r&&!e.headers.has(s)&&(e=e.clone({headers:e.headers.set(s,r)})),n(e)}var y_=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(y_||{});function fQ(...e){const n=[Hp,S6,E6,{provide:oI,useExisting:E6},{provide:aI,useFactory:()=>Xe(iN,{optional:!0})??Xe(S6)},{provide:oC,useValue:dQ,multi:!0},{provide:oN,useValue:!0},{provide:A6,useClass:hQ}];for(const t of e)n.push(...t.\u0275providers);return function np(e){return{\u0275providers:e}}(n)}const I6=new Gt("");function pQ(){return function Vy(e,n){return{\u0275kind:e,\u0275providers:n}}(y_.LegacyInterceptors,[{provide:I6,useFactory:nQ},{provide:oC,useExisting:I6,multi:!0}])}let mQ=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({providers:[fQ(pQ())]})}return e})();const{isArray:CQ}=Array,{getPrototypeOf:SQ,prototype:DQ,keys:MQ}=Object;function B6(e){if(1===e.length){const n=e[0];if(CQ(n))return{args:n,keys:null};if(function AQ(e){return e&&"object"==typeof e&&SQ(e)===DQ}(n)){const t=MQ(n);return{args:t.map(r=>n[r]),keys:t}}}return{args:e,keys:null}}const{isArray:IQ}=Array;function aN(e){return J(n=>function kQ(e,n){return IQ(n)?e(...n):e(n)}(e,n))}function z6(e,n){return e.reduce((t,r,s)=>(t[r]=n[s],t),{})}function lN(...e){const n=rC(e),t=sI(e),{args:r,keys:s}=B6(e);if(0===r.length)return va([],n);const l=new $i(function OQ(e,n,t=tl){return r=>{U6(n,()=>{const{length:s}=e,l=new Array(s);let h=s,g=s;for(let x=0;x<s;x++)U6(n,()=>{const E=va(e[x],n);let D=!1;E.subscribe(Me(r,O=>{l[x]=O,D||(D=!0,g--),g||r.next(t(l.slice()))},()=>{--h||r.complete()}))},r)},r)}}(r,n,s?h=>z6(s,h):tl));return t?l.pipe(aN(t)):l}function U6(e,n,t){e?xg(t,e,n):n()}const hI=ns(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function lw(e=1/0){return ml(tl,e)}function aC(...e){return function RQ(){return lw(1)}()(va(e,rC(e)))}function V6(e){return new $i(n=>{pl(e()).subscribe(n)})}function dI(e,n){const t=hn(e)?e:()=>e,r=s=>s.error(t());return new $i(n?s=>n.schedule(r,0,s):r)}const qu=new $i(e=>e.complete());function cN(){return ys((e,n)=>{let t=null;e._refCount++;const r=Me(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const s=e._connection,l=t;t=null,s&&(!l||s===l)&&s.unsubscribe(),n.unsubscribe()});e.subscribe(r),r.closed||(t=e.connect())})}class j6 extends $i{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Bs(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new dn;const t=this.getSubject();n.add(this.source.subscribe(Me(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=dn.EMPTY)}return n}refCount(){return cN()(this)}}function hc(e){return e<=0?()=>qu:ys((n,t)=>{let r=0;n.subscribe(Me(t,s=>{++r<=e&&(t.next(s),e<=r&&t.complete())}))})}function uN(...e){const n=rC(e);return ys((t,r)=>{(n?aC(e,t,n):aC(e,t)).subscribe(r)})}function fI(e){return ys((n,t)=>{let r=!1;n.subscribe(Me(t,s=>{r=!0,t.next(s)},()=>{r||t.next(e),t.complete()}))})}function $6(e=NQ){return ys((n,t)=>{let r=!1;n.subscribe(Me(t,s=>{r=!0,t.next(s)},()=>r?t.complete():t.error(e())))})}function NQ(){return new hI}function jy(e,n){const t=arguments.length>=2;return r=>r.pipe(e?xa((s,l)=>e(s,l,r)):tl,hc(1),t?fI(n):$6(()=>new hI))}function gl(e,n,t){const r=hn(e)||n||t?{next:e,error:n,complete:t}:e;return r?ys((s,l)=>{var h;null===(h=r.subscribe)||void 0===h||h.call(r);let g=!0;s.subscribe(Me(l,x=>{var E;null===(E=r.next)||void 0===E||E.call(r,x),l.next(x)},()=>{var x;g=!1,null===(x=r.complete)||void 0===x||x.call(r),l.complete()},x=>{var E;g=!1,null===(E=r.error)||void 0===E||E.call(r,x),l.error(x)},()=>{var x,E;g&&(null===(x=r.unsubscribe)||void 0===x||x.call(r)),null===(E=r.finalize)||void 0===E||E.call(r)}))}):tl}function cw(e){return ys((n,t)=>{let l,r=null,s=!1;r=n.subscribe(Me(t,void 0,void 0,h=>{l=pl(e(h,cw(e)(n))),r?(r.unsubscribe(),r=null,l.subscribe(t)):s=!0})),s&&(r.unsubscribe(),r=null,l.subscribe(t))})}function hN(e){return e<=0?()=>qu:ys((n,t)=>{let r=[];n.subscribe(Me(t,s=>{r.push(s),e<r.length&&r.shift()},()=>{for(const s of r)t.next(s);t.complete()},void 0,()=>{r=null}))})}function wo(e){return ys((n,t)=>{pl(e).subscribe(Me(t,()=>t.complete(),ji)),!t.closed&&n.subscribe(t)})}const Ti="primary",lC=Symbol("RouteTitle");class zQ{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function uw(e){return new zQ(e)}function UQ(e,n,t){const r=t.path.split("/");if(r.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||r.length<e.length))return null;const s={};for(let l=0;l<r.length;l++){const h=r[l],g=e[l];if(":"===h[0])s[h.substring(1)]=g;else if(h!==g.path)return null}return{consumed:e.slice(0,r.length),posParams:s}}function Gp(e,n){const t=e?dN(e):void 0,r=n?dN(n):void 0;if(!t||!r||t.length!=r.length)return!1;let s;for(let l=0;l<t.length;l++)if(s=t[l],!G6(e[s],n[s]))return!1;return!0}function dN(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function G6(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),r=[...n].sort();return t.every((s,l)=>r[l]===s)}return e===n}function W6(e){return e.length>0?e[e.length-1]:null}function v_(e){return function EQ(e){return!!e&&(e instanceof $i||hn(e.lift)&&hn(e.subscribe))}(e)?e:$2(e)?va(Promise.resolve(e)):Lr(e)}const jQ={exact:function X6(e,n,t){if(!Hy(e.segments,n.segments)||!pI(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!X6(e.children[r],n.children[r],t))return!1;return!0},subset:Y6},q6={exact:function $Q(e,n){return Gp(e,n)},subset:function HQ(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>G6(e[t],n[t]))},ignored:()=>!0};function Z6(e,n,t){return jQ[t.paths](e.root,n.root,t.matrixParams)&&q6[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function Y6(e,n,t){return K6(e,n,n.segments,t)}function K6(e,n,t,r){if(e.segments.length>t.length){const s=e.segments.slice(0,t.length);return!(!Hy(s,t)||n.hasChildren()||!pI(s,t,r))}if(e.segments.length===t.length){if(!Hy(e.segments,t)||!pI(e.segments,t,r))return!1;for(const s in n.children)if(!e.children[s]||!Y6(e.children[s],n.children[s],r))return!1;return!0}{const s=t.slice(0,e.segments.length),l=t.slice(e.segments.length);return!!(Hy(e.segments,s)&&pI(e.segments,s,r)&&e.children[Ti])&&K6(e.children[Ti],n,l,r)}}function pI(e,n,t){return n.every((r,s)=>q6[t](e[s].parameters,r.parameters))}class $y{constructor(n=new Ls([],{}),t={},r=null){this.root=n,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=uw(this.queryParams),this._queryParamMap}toString(){return qQ.serialize(this)}}class Ls{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return gI(this)}}class cC{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap??=uw(this.parameters),this._parameterMap}toString(){return e8(this)}}function Hy(e,n){return e.length===n.length&&e.every((t,r)=>t.path===n[r].path)}let hw=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:()=>new mI,providedIn:"root"})}return e})();class mI{parse(n){const t=new iee(n);return new $y(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${uC(n.root,!0)}`,r=function YQ(e){const n=Object.entries(e).map(([t,r])=>Array.isArray(r)?r.map(s=>`${_I(t)}=${_I(s)}`).join("&"):`${_I(t)}=${_I(r)}`).filter(t=>t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${r}${"string"==typeof n.fragment?`#${function ZQ(e){return encodeURI(e)}(n.fragment)}`:""}`}}const qQ=new mI;function gI(e){return e.segments.map(n=>e8(n)).join("/")}function uC(e,n){if(!e.hasChildren())return gI(e);if(n){const t=e.children[Ti]?uC(e.children[Ti],!1):"",r=[];return Object.entries(e.children).forEach(([s,l])=>{s!==Ti&&r.push(`${s}:${uC(l,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function WQ(e,n){let t=[];return Object.entries(e.children).forEach(([r,s])=>{r===Ti&&(t=t.concat(n(s,r)))}),Object.entries(e.children).forEach(([r,s])=>{r!==Ti&&(t=t.concat(n(s,r)))}),t}(e,(r,s)=>s===Ti?[uC(e.children[Ti],!1)]:[`${s}:${uC(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Ti]?`${gI(e)}/${t[0]}`:`${gI(e)}/(${t.join("//")})`}}function J6(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function _I(e){return J6(e).replace(/%3B/gi,";")}function fN(e){return J6(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function yI(e){return decodeURIComponent(e)}function Q6(e){return yI(e.replace(/\+/g,"%20"))}function e8(e){return`${fN(e.path)}${function XQ(e){return Object.entries(e).map(([n,t])=>`;${fN(n)}=${fN(t)}`).join("")}(e.parameters)}`}const KQ=/^[^\/()?;#]+/;function pN(e){const n=e.match(KQ);return n?n[0]:""}const JQ=/^[^\/()?;=#]+/,eee=/^[^=?&#]+/,nee=/^[^&#]+/;class iee{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ls([],{}):new Ls([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(r[Ti]=new Ls(n,t)),r}parseSegment(){const n=pN(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Jt(4009,!1);return this.capture(n),new cC(yI(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function QQ(e){const n=e.match(JQ);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const s=pN(this.remaining);s&&(r=s,this.capture(r))}n[yI(t)]=yI(r)}parseQueryParam(n){const t=function tee(e){const n=e.match(eee);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const h=function ree(e){const n=e.match(nee);return n?n[0]:""}(this.remaining);h&&(r=h,this.capture(r))}const s=Q6(t),l=Q6(r);if(n.hasOwnProperty(s)){let h=n[s];Array.isArray(h)||(h=[h],n[s]=h),h.push(l)}else n[s]=l}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=pN(this.remaining),s=this.remaining[r.length];if("/"!==s&&")"!==s&&";"!==s)throw new Jt(4010,!1);let l;r.indexOf(":")>-1?(l=r.slice(0,r.indexOf(":")),this.capture(l),this.capture(":")):n&&(l=Ti);const h=this.parseChildren();t[l]=1===Object.keys(h).length?h[Ti]:new Ls([],h),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Jt(4011,!1)}}function t8(e){return e.segments.length>0?new Ls([],{[Ti]:e}):e}function n8(e){const n={};for(const[r,s]of Object.entries(e.children)){const l=n8(s);if(r===Ti&&0===l.segments.length&&l.hasChildren())for(const[h,g]of Object.entries(l.children))n[h]=g;else(l.segments.length>0||l.hasChildren())&&(n[r]=l)}return function see(e){if(1===e.numberOfChildren&&e.children[Ti]){const n=e.children[Ti];return new Ls(e.segments.concat(n.segments),n.children)}return e}(new Ls(e.segments,n))}function Gy(e){return e instanceof $y}function r8(e){let n;const s=t8(function t(l){const h={};for(const x of l.children){const E=t(x);h[x.outlet]=E}const g=new Ls(l.url,h);return l===e&&(n=g),g}(e.root));return n??s}function i8(e,n,t,r){let s=e;for(;s.parent;)s=s.parent;if(0===n.length)return mN(s,s,s,t,r);const l=function aee(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new o8(!0,0,e);let n=0,t=!1;const r=e.reduce((s,l,h)=>{if("object"==typeof l&&null!=l){if(l.outlets){const g={};return Object.entries(l.outlets).forEach(([x,E])=>{g[x]="string"==typeof E?E.split("/"):E}),[...s,{outlets:g}]}if(l.segmentPath)return[...s,l.segmentPath]}return"string"!=typeof l?[...s,l]:0===h?(l.split("/").forEach((g,x)=>{0==x&&"."===g||(0==x&&""===g?t=!0:".."===g?n++:""!=g&&s.push(g))}),s):[...s,l]},[]);return new o8(t,n,r)}(n);if(l.toRoot())return mN(s,s,new Ls([],{}),t,r);const h=function lee(e,n,t){if(e.isAbsolute)return new xI(n,!0,0);if(!t)return new xI(n,!1,NaN);if(null===t.parent)return new xI(t,!0,0);const r=vI(e.commands[0])?0:1;return function cee(e,n,t){let r=e,s=n,l=t;for(;l>s;){if(l-=s,r=r.parent,!r)throw new Jt(4005,!1);s=r.segments.length}return new xI(r,!1,s-l)}(t,t.segments.length-1+r,e.numberOfDoubleDots)}(l,s,e),g=h.processChildren?dC(h.segmentGroup,h.index,l.commands):a8(h.segmentGroup,h.index,l.commands);return mN(s,h.segmentGroup,g,t,r)}function vI(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function hC(e){return"object"==typeof e&&null!=e&&e.outlets}function mN(e,n,t,r,s){let h,l={};r&&Object.entries(r).forEach(([x,E])=>{l[x]=Array.isArray(E)?E.map(D=>`${D}`):`${E}`}),h=e===n?t:s8(e,n,t);const g=t8(n8(h));return new $y(g,l,s)}function s8(e,n,t){const r={};return Object.entries(e.children).forEach(([s,l])=>{r[s]=l===n?t:s8(l,n,t)}),new Ls(e.segments,r)}class o8{constructor(n,t,r){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=r,n&&r.length>0&&vI(r[0]))throw new Jt(4003,!1);const s=r.find(hC);if(s&&s!==W6(r))throw new Jt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class xI{constructor(n,t,r){this.segmentGroup=n,this.processChildren=t,this.index=r}}function a8(e,n,t){if(e??=new Ls([],{}),0===e.segments.length&&e.hasChildren())return dC(e,n,t);const r=function hee(e,n,t){let r=0,s=n;const l={match:!1,pathIndex:0,commandIndex:0};for(;s<e.segments.length;){if(r>=t.length)return l;const h=e.segments[s],g=t[r];if(hC(g))break;const x=`${g}`,E=r<t.length-1?t[r+1]:null;if(s>0&&void 0===x)break;if(x&&E&&"object"==typeof E&&void 0===E.outlets){if(!c8(x,E,h))return l;r+=2}else{if(!c8(x,{},h))return l;r++}s++}return{match:!0,pathIndex:s,commandIndex:r}}(e,n,t),s=t.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const l=new Ls(e.segments.slice(0,r.pathIndex),{});return l.children[Ti]=new Ls(e.segments.slice(r.pathIndex),e.children),dC(l,0,s)}return r.match&&0===s.length?new Ls(e.segments,{}):r.match&&!e.hasChildren()?gN(e,n,t):r.match?dC(e,0,s):gN(e,n,t)}function dC(e,n,t){if(0===t.length)return new Ls(e.segments,{});{const r=function uee(e){return hC(e[0])?e[0].outlets:{[Ti]:e}}(t),s={};if(Object.keys(r).some(l=>l!==Ti)&&e.children[Ti]&&1===e.numberOfChildren&&0===e.children[Ti].segments.length){const l=dC(e.children[Ti],n,t);return new Ls(e.segments,l.children)}return Object.entries(r).forEach(([l,h])=>{"string"==typeof h&&(h=[h]),null!==h&&(s[l]=a8(e.children[l],n,h))}),Object.entries(e.children).forEach(([l,h])=>{void 0===r[l]&&(s[l]=h)}),new Ls(e.segments,s)}}function gN(e,n,t){const r=e.segments.slice(0,n);let s=0;for(;s<t.length;){const l=t[s];if(hC(l)){const x=dee(l.outlets);return new Ls(r,x)}if(0===s&&vI(t[0])){r.push(new cC(e.segments[n].path,l8(t[0]))),s++;continue}const h=hC(l)?l.outlets[Ti]:`${l}`,g=s<t.length-1?t[s+1]:null;h&&g&&vI(g)?(r.push(new cC(h,l8(g))),s+=2):(r.push(new cC(h,{})),s++)}return new Ls(r,{})}function dee(e){const n={};return Object.entries(e).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[t]=gN(new Ls([],{}),0,r))}),n}function l8(e){const n={};return Object.entries(e).forEach(([t,r])=>n[t]=`${r}`),n}function c8(e,n,t){return e==t.path&&Gp(n,t.parameters)}const fC="imperative";var qi=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(qi||{});class Wp{constructor(n,t){this.id=n,this.url=t}}class bI extends Wp{constructor(n,t,r="imperative",s=null){super(n,t),this.type=qi.NavigationStart,this.navigationTrigger=r,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class bg extends Wp{constructor(n,t,r){super(n,t),this.urlAfterRedirects=r,this.type=qi.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Zu=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(Zu||{}),wI=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(wI||{});class Wy extends Wp{constructor(n,t,r,s){super(n,t),this.reason=r,this.code=s,this.type=qi.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class dw extends Wp{constructor(n,t,r,s){super(n,t),this.reason=r,this.code=s,this.type=qi.NavigationSkipped}}class _N extends Wp{constructor(n,t,r,s){super(n,t),this.error=r,this.target=s,this.type=qi.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class u8 extends Wp{constructor(n,t,r,s){super(n,t),this.urlAfterRedirects=r,this.state=s,this.type=qi.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fee extends Wp{constructor(n,t,r,s){super(n,t),this.urlAfterRedirects=r,this.state=s,this.type=qi.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class pee extends Wp{constructor(n,t,r,s,l){super(n,t),this.urlAfterRedirects=r,this.state=s,this.shouldActivate=l,this.type=qi.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class mee extends Wp{constructor(n,t,r,s){super(n,t),this.urlAfterRedirects=r,this.state=s,this.type=qi.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gee extends Wp{constructor(n,t,r,s){super(n,t),this.urlAfterRedirects=r,this.state=s,this.type=qi.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _ee{constructor(n){this.route=n,this.type=qi.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class yee{constructor(n){this.route=n,this.type=qi.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class vee{constructor(n){this.snapshot=n,this.type=qi.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xee{constructor(n){this.snapshot=n,this.type=qi.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bee{constructor(n){this.snapshot=n,this.type=qi.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wee{constructor(n){this.snapshot=n,this.type=qi.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class h8{constructor(n,t,r){this.routerEvent=n,this.position=t,this.anchor=r,this.type=qi.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class yN{}class TI{constructor(n,t){this.url=n,this.navigationBehaviorOptions=t}}function ff(e){return e.outlet||Ti}function pC(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class Mee{get injector(){return pC(this.route?.snapshot)??this.rootInjector}set injector(n){}constructor(n){this.rootInjector=n,this.outlet=null,this.route=null,this.children=new mC(this.rootInjector),this.attachRef=null}}let mC=(()=>{class e{constructor(t){this.rootInjector=t,this.contexts=new Map}onChildOutletCreated(t,r){const s=this.getOrCreateContext(t);s.outlet=r,this.contexts.set(t,s)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new Mee(this.rootInjector),this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(qo))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class d8{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=vN(n,this._root);return t?t.children.map(r=>r.value):[]}firstChild(n){const t=vN(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=xN(n,this._root);return t.length<2?[]:t[t.length-2].children.map(s=>s.value).filter(s=>s!==n)}pathFromRoot(n){return xN(n,this._root).map(t=>t.value)}}function vN(e,n){if(e===n.value)return n;for(const t of n.children){const r=vN(e,t);if(r)return r}return null}function xN(e,n){if(e===n.value)return[n];for(const t of n.children){const r=xN(e,t);if(r.length)return r.unshift(n),r}return[]}class pf{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function fw(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class f8 extends d8{constructor(n,t){super(n),this.snapshot=t,bN(this,n)}toString(){return this.snapshot.toString()}}function p8(e){const n=function Aee(e){const l=new CI([],{},{},"",{},Ti,e,null,{});return new m8("",new pf(l,[]))}(e),t=new Vo([new cC("",{})]),r=new Vo({}),s=new Vo({}),l=new Vo({}),h=new Vo(""),g=new qp(t,r,l,h,s,Ti,e,n.root);return g.snapshot=n.root,new f8(new pf(g,[]),n)}class qp{constructor(n,t,r,s,l,h,g,x){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=s,this.dataSubject=l,this.outlet=h,this.component=g,this._futureSnapshot=x,this.title=this.dataSubject?.pipe(J(E=>E[lC]))??Lr(void 0),this.url=n,this.params=t,this.queryParams=r,this.fragment=s,this.data=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(J(n=>uw(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(J(n=>uw(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function EI(e,n,t="emptyOnly"){let r;const{routeConfig:s}=e;return r=null===n||"always"!==t&&""!==s?.path&&(n.component||n.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.data,...s?.data,...e._resolvedData}},s&&_8(s)&&(r.resolve[lC]=s.title),r}class CI{get title(){return this.data?.[lC]}constructor(n,t,r,s,l,h,g,x,E){this.url=n,this.params=t,this.queryParams=r,this.fragment=s,this.data=l,this.outlet=h,this.component=g,this.routeConfig=x,this._resolve=E}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=uw(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=uw(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class m8 extends d8{constructor(n,t){super(t),this.url=n,bN(this,t)}toString(){return g8(this._root)}}function bN(e,n){n.value._routerState=e,n.children.forEach(t=>bN(e,t))}function g8(e){const n=e.children.length>0?` { ${e.children.map(g8).join(", ")} } `:"";return`${e.value}${n}`}function wN(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Gp(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Gp(n.params,t.params)||e.paramsSubject.next(t.params),function VQ(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!Gp(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),Gp(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function TN(e,n){const t=Gp(e.params,n.params)&&function GQ(e,n){return Hy(e,n)&&e.every((t,r)=>Gp(t.parameters,n[r].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||TN(e.parent,n.parent))}function _8(e){return"string"==typeof e.title||null===e.title}let EN=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ti,this.activateEvents=new ir,this.deactivateEvents=new ir,this.attachEvents=new ir,this.detachEvents=new ir,this.parentContexts=Xe(mC),this.location=Xe(ct),this.changeDetector=Xe(ed),this.inputBinder=Xe(SI,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:s}=t.name;if(r)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Jt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Jt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Jt(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Jt(4013,!1);this._activatedRoute=t;const s=this.location,h=t.snapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,x=new CN(t,g,s.injector);this.activated=s.createComponent(h,{index:s.length,injector:x,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=gn({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[to]})}return e})();class CN{__ngOutletInjector(n){return new CN(this.route,this.childContexts,n)}constructor(n,t,r){this.route=n,this.childContexts=t,this.parent=r}get(n,t){return n===qp?this.route:n===mC?this.childContexts:this.parent.get(n,t)}}const SI=new Gt("");let y8=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:r}=t,s=lN([r.queryParams,r.params,r.data]).pipe(rd(([l,h,g],x)=>(g={...l,...h,...g},0===x?Lr(g):Promise.resolve(g)))).subscribe(l=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(t);const h=function RX(e){const n=Vr(e);if(!n)return null;const t=new tt(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(h)for(const{templateName:g}of h.inputs)t.activatedComponentRef.setInput(g,l[g]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,s)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();function gC(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=n.value;const s=function kee(e,n,t){return n.children.map(r=>{for(const s of t.children)if(e.shouldReuseRoute(r.value,s.value.snapshot))return gC(e,r,s);return gC(e,r)})}(e,n,t);return new pf(r,s)}{if(e.shouldAttach(n.value)){const l=e.retrieve(n.value);if(null!==l){const h=l.route;return h.value._futureSnapshot=n.value,h.children=n.children.map(g=>gC(e,g)),h}}const r=function Oee(e){return new qp(new Vo(e.url),new Vo(e.params),new Vo(e.queryParams),new Vo(e.fragment),new Vo(e.data),e.outlet,e.component,e)}(n.value),s=n.children.map(l=>gC(e,l));return new pf(r,s)}}class SN{constructor(n,t){this.redirectTo=n,this.navigationBehaviorOptions=t}}const v8="ngNavigationCancelingError";function DI(e,n){const{redirectTo:t,navigationBehaviorOptions:r}=Gy(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,s=x8(!1,Zu.Redirect);return s.url=t,s.navigationBehaviorOptions=r,s}function x8(e,n){const t=new Error(`NavigationCancelingError: ${e||""}`);return t[v8]=!0,t.cancellationCode=n,t}function b8(e){return!!e&&e[v8]}class Nee{constructor(n,t,r,s,l){this.routeReuseStrategy=n,this.futureState=t,this.currState=r,this.forwardEvent=s,this.inputBindingEnabled=l}activate(n){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,n),wN(this.futureState.root),this.activateChildRoutes(t,r,n)}deactivateChildRoutes(n,t,r){const s=fw(t);n.children.forEach(l=>{const h=l.value.outlet;this.deactivateRoutes(l,s[h],r),delete s[h]}),Object.values(s).forEach(l=>{this.deactivateRouteAndItsChildren(l,r)})}deactivateRoutes(n,t,r){const s=n.value,l=t?t.value:null;if(s===l)if(s.component){const h=r.getContext(s.outlet);h&&this.deactivateChildRoutes(n,t,h.children)}else this.deactivateChildRoutes(n,t,r);else l&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const r=t.getContext(n.value.outlet),s=r&&n.value.component?r.children:t,l=fw(n);for(const h of Object.values(l))this.deactivateRouteAndItsChildren(h,s);if(r&&r.outlet){const h=r.outlet.detach(),g=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:h,route:n,contexts:g})}}deactivateRouteAndOutlet(n,t){const r=t.getContext(n.value.outlet),s=r&&n.value.component?r.children:t,l=fw(n);for(const h of Object.values(l))this.deactivateRouteAndItsChildren(h,s);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,t,r){const s=fw(t);n.children.forEach(l=>{this.activateRoutes(l,s[l.value.outlet],r),this.forwardEvent(new wee(l.value.snapshot))}),n.children.length&&this.forwardEvent(new xee(n.value.snapshot))}activateRoutes(n,t,r){const s=n.value,l=t?t.value:null;if(wN(s),s===l)if(s.component){const h=r.getOrCreateContext(s.outlet);this.activateChildRoutes(n,t,h.children)}else this.activateChildRoutes(n,t,r);else if(s.component){const h=r.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const g=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),h.children.onOutletReAttached(g.contexts),h.attachRef=g.componentRef,h.route=g.route.value,h.outlet&&h.outlet.attach(g.componentRef,g.route.value),wN(g.route.value),this.activateChildRoutes(n,null,h.children)}else h.attachRef=null,h.route=s,h.outlet&&h.outlet.activateWith(s,h.injector),this.activateChildRoutes(n,null,h.children)}else this.activateChildRoutes(n,null,r)}}class w8{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class MI{constructor(n,t){this.component=n,this.route=t}}function Fee(e,n,t){const r=e._root;return _C(r,n?n._root:null,t,[r.value])}function pw(e,n){const t=Symbol(),r=n.get(e,t);return r===t?"function"!=typeof e||function a1(e){return null!==Fn(e)}(e)?n.get(e):e:r}function _C(e,n,t,r,s={canDeactivateChecks:[],canActivateChecks:[]}){const l=fw(n);return e.children.forEach(h=>{(function Bee(e,n,t,r,s={canDeactivateChecks:[],canActivateChecks:[]}){const l=e.value,h=n?n.value:null,g=t?t.getContext(e.value.outlet):null;if(h&&l.routeConfig===h.routeConfig){const x=function zee(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!Hy(e.url,n.url);case"pathParamsOrQueryParamsChange":return!Hy(e.url,n.url)||!Gp(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!TN(e,n)||!Gp(e.queryParams,n.queryParams);default:return!TN(e,n)}}(h,l,l.routeConfig.runGuardsAndResolvers);x?s.canActivateChecks.push(new w8(r)):(l.data=h.data,l._resolvedData=h._resolvedData),_C(e,n,l.component?g?g.children:null:t,r,s),x&&g&&g.outlet&&g.outlet.isActivated&&s.canDeactivateChecks.push(new MI(g.outlet.component,h))}else h&&yC(n,g,s),s.canActivateChecks.push(new w8(r)),_C(e,null,l.component?g?g.children:null:t,r,s)})(h,l[h.value.outlet],t,r.concat([h.value]),s),delete l[h.value.outlet]}),Object.entries(l).forEach(([h,g])=>yC(g,t.getContext(h),s)),s}function yC(e,n,t){const r=fw(e),s=e.value;Object.entries(r).forEach(([l,h])=>{yC(h,s.component?n?n.children.getContext(l):null:n,t)}),t.canDeactivateChecks.push(new MI(s.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,s))}function vC(e){return"function"==typeof e}function T8(e){return e instanceof hI||"EmptyError"===e?.name}const AI=Symbol("INITIAL_VALUE");function mw(){return rd(e=>lN(e.map(n=>n.pipe(hc(1),uN(AI)))).pipe(J(n=>{for(const t of n)if(!0!==t){if(t===AI)return AI;if(!1===t||Wee(t))return t}return!0}),xa(n=>n!==AI),hc(1)))}function Wee(e){return Gy(e)||e instanceof SN}function E8(e){return function Mf(...e){return Eu(e)}(gl(n=>{if("boolean"!=typeof n)throw DI(0,n)}),J(n=>!0===n))}class DN{constructor(n){this.segmentGroup=n||null}}class II extends Error{constructor(n){super(),this.urlTree=n}}function gw(e){return dI(new DN(e))}class ste{constructor(n,t){this.urlSerializer=n,this.urlTree=t}lineralizeSegments(n,t){let r=[],s=t.root;for(;;){if(r=r.concat(s.segments),0===s.numberOfChildren)return Lr(r);if(s.numberOfChildren>1||!s.children[Ti])return dI(new Jt(4e3,!1));s=s.children[Ti]}}applyRedirectCommands(n,t,r,s,l){if("string"!=typeof t){const g=t,{queryParams:x,fragment:E,routeConfig:D,url:O,outlet:N,params:B,data:W,title:V}=s,X=Ic(l,()=>g({params:B,data:W,queryParams:x,fragment:E,routeConfig:D,url:O,outlet:N,title:V}));if(X instanceof $y)throw new II(X);t=X}const h=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,r);if("/"===t[0])throw new II(h);return h}applyRedirectCreateUrlTree(n,t,r,s){const l=this.createSegmentGroup(n,t.root,r,s);return new $y(l,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const r={};return Object.entries(n).forEach(([s,l])=>{if("string"==typeof l&&":"===l[0]){const g=l.substring(1);r[s]=t[g]}else r[s]=l}),r}createSegmentGroup(n,t,r,s){const l=this.createSegments(n,t.segments,r,s);let h={};return Object.entries(t.children).forEach(([g,x])=>{h[g]=this.createSegmentGroup(n,x,r,s)}),new Ls(l,h)}createSegments(n,t,r,s){return t.map(l=>":"===l.path[0]?this.findPosParam(n,l,s):this.findOrReturn(l,r))}findPosParam(n,t,r){const s=r[t.path.substring(1)];if(!s)throw new Jt(4001,!1);return s}findOrReturn(n,t){let r=0;for(const s of t){if(s.path===n.path)return t.splice(r),s;r++}return n}}const MN={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ote(e,n,t,r,s){const l=AN(e,n,t);return l.matched?(r=function Tee(e,n){return e.providers&&!e._injector&&(e._injector=rA(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,r),function nte(e,n,t,r){const s=n.canMatch;return s&&0!==s.length?Lr(s.map(h=>{const g=pw(h,e);return v_(function Gee(e){return e&&vC(e.canMatch)}(g)?g.canMatch(n,t):Ic(e,()=>g(n,t)))})).pipe(mw(),E8()):Lr(!0)}(r,n,t).pipe(J(h=>!0===h?l:{...MN}))):Lr(l)}function AN(e,n,t){if("**"===n.path)return function ate(e){return{matched:!0,parameters:e.length>0?W6(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...MN}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const s=(n.matcher||UQ)(t,e,n);if(!s)return{...MN};const l={};Object.entries(s.posParams??{}).forEach(([g,x])=>{l[g]=x.path});const h=s.consumed.length>0?{...l,...s.consumed[s.consumed.length-1].parameters}:l;return{matched:!0,consumedSegments:s.consumed,remainingSegments:t.slice(s.consumed.length),parameters:h,positionalParamSegments:s.posParams??{}}}function C8(e,n,t,r){return t.length>0&&function ute(e,n,t){return t.some(r=>kI(e,n,r)&&ff(r)!==Ti)}(e,t,r)?{segmentGroup:new Ls(n,cte(r,new Ls(t,e.children))),slicedSegments:[]}:0===t.length&&function hte(e,n,t){return t.some(r=>kI(e,n,r))}(e,t,r)?{segmentGroup:new Ls(e.segments,lte(e,t,r,e.children)),slicedSegments:t}:{segmentGroup:new Ls(e.segments,e.children),slicedSegments:t}}function lte(e,n,t,r){const s={};for(const l of t)if(kI(e,n,l)&&!r[ff(l)]){const h=new Ls([],{});s[ff(l)]=h}return{...r,...s}}function cte(e,n){const t={};t[Ti]=n;for(const r of e)if(""===r.path&&ff(r)!==Ti){const s=new Ls([],{});t[ff(r)]=s}return t}function kI(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class pte{}class _te{constructor(n,t,r,s,l,h,g){this.injector=n,this.configLoader=t,this.rootComponentType=r,this.config=s,this.urlTree=l,this.paramsInheritanceStrategy=h,this.urlSerializer=g,this.applyRedirects=new ste(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new Jt(4002,`'${n.segmentGroup}'`)}recognize(){const n=C8(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(J(({children:t,rootSnapshot:r})=>{const s=new pf(r,t),l=new m8("",s),h=function oee(e,n,t=null,r=null){return i8(r8(e),n,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return h.queryParams=this.urlTree.queryParams,l.url=this.urlSerializer.serialize(h),{state:l,tree:h}}))}match(n){const t=new CI([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),Ti,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,Ti,t).pipe(J(r=>({children:r,rootSnapshot:t})),cw(r=>{if(r instanceof II)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof DN?this.noMatchError(r):r}))}processSegmentGroup(n,t,r,s,l){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,t,r,l):this.processSegment(n,t,r,r.segments,s,!0,l).pipe(J(h=>h instanceof pf?[h]:[]))}processChildren(n,t,r,s){const l=[];for(const h of Object.keys(r.children))"primary"===h?l.unshift(h):l.push(h);return va(l).pipe(ow(h=>{const g=r.children[h],x=function Dee(e,n){const t=e.filter(r=>ff(r)===n);return t.push(...e.filter(r=>ff(r)!==n)),t}(t,h);return this.processSegmentGroup(n,x,g,h,s)}),function LQ(e,n){return ys(function FQ(e,n,t,r,s){return(l,h)=>{let g=t,x=n,E=0;l.subscribe(Me(h,D=>{const O=E++;x=g?e(x,D,O):(g=!0,D),r&&h.next(x)},s&&(()=>{g&&h.next(x),h.complete()})))}}(e,n,arguments.length>=2,!0))}((h,g)=>(h.push(...g),h)),fI(null),function BQ(e,n){const t=arguments.length>=2;return r=>r.pipe(e?xa((s,l)=>e(s,l,r)):tl,hN(1),t?fI(n):$6(()=>new hI))}(),ml(h=>{if(null===h)return gw(r);const g=S8(h);return function yte(e){e.sort((n,t)=>n.value.outlet===Ti?-1:t.value.outlet===Ti?1:n.value.outlet.localeCompare(t.value.outlet))}(g),Lr(g)}))}processSegment(n,t,r,s,l,h,g){return va(t).pipe(ow(x=>this.processSegmentAgainstRoute(x._injector??n,t,x,r,s,l,h,g).pipe(cw(E=>{if(E instanceof DN)return Lr(null);throw E}))),jy(x=>!!x),cw(x=>{if(T8(x))return function fte(e,n,t){return 0===n.length&&!e.children[t]}(r,s,l)?Lr(new pte):gw(r);throw x}))}processSegmentAgainstRoute(n,t,r,s,l,h,g,x){return function dte(e,n,t,r){return!!(ff(e)===r||r!==Ti&&kI(n,t,e))&&AN(n,e,t).matched}(r,s,l,h)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,s,r,l,h,x):this.allowRedirects&&g?this.expandSegmentAgainstRouteUsingRedirect(n,s,t,r,l,h,x):gw(s):gw(s)}expandSegmentAgainstRouteUsingRedirect(n,t,r,s,l,h,g){const{matched:x,parameters:E,consumedSegments:D,positionalParamSegments:O,remainingSegments:N}=AN(t,s,l);if(!x)return gw(t);"string"==typeof s.redirectTo&&"/"===s.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const B=new CI(l,E,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,D8(s),ff(s),s.component??s._loadedComponent??null,s,M8(s)),W=EI(B,g,this.paramsInheritanceStrategy);B.params=Object.freeze(W.params),B.data=Object.freeze(W.data);const V=this.applyRedirects.applyRedirectCommands(D,s.redirectTo,O,B,n);return this.applyRedirects.lineralizeSegments(s,V).pipe(ml(X=>this.processSegment(n,r,t,X.concat(N),h,!1,g)))}matchSegmentAgainstRoute(n,t,r,s,l,h){const g=ote(t,r,s,n);return"**"===r.path&&(t.children={}),g.pipe(rd(x=>x.matched?this.getChildConfig(n=r._injector??n,r,s).pipe(rd(({routes:E})=>{const D=r._loadedInjector??n,{parameters:O,consumedSegments:N,remainingSegments:B}=x,W=new CI(N,O,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,D8(r),ff(r),r.component??r._loadedComponent??null,r,M8(r)),V=EI(W,h,this.paramsInheritanceStrategy);W.params=Object.freeze(V.params),W.data=Object.freeze(V.data);const{segmentGroup:X,slicedSegments:le}=C8(t,N,B,E);if(0===le.length&&X.hasChildren())return this.processChildren(D,E,X,W).pipe(J(fe=>new pf(W,fe)));if(0===E.length&&0===le.length)return Lr(new pf(W,[]));const oe=ff(r)===l;return this.processSegment(D,E,X,le,oe?Ti:l,!0,W).pipe(J(fe=>new pf(W,fe instanceof pf?[fe]:[])))})):gw(t)))}getChildConfig(n,t,r){return t.children?Lr({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?Lr({routes:t._loadedRoutes,injector:t._loadedInjector}):function tte(e,n,t,r){const s=n.canLoad;return void 0===s||0===s.length?Lr(!0):Lr(s.map(h=>{const g=pw(h,e);return v_(function Vee(e){return e&&vC(e.canLoad)}(g)?g.canLoad(n,t):Ic(e,()=>g(n,t)))})).pipe(mw(),E8())}(n,t,r).pipe(ml(s=>s?this.configLoader.loadChildren(n,t).pipe(gl(l=>{t._loadedRoutes=l.routes,t._loadedInjector=l.injector})):function ite(e){return dI(x8(!1,Zu.GuardRejected))}())):Lr({routes:[],injector:n})}}function vte(e){const n=e.value.routeConfig;return n&&""===n.path}function S8(e){const n=[],t=new Set;for(const r of e){if(!vte(r)){n.push(r);continue}const s=n.find(l=>r.value.routeConfig===l.value.routeConfig);void 0!==s?(s.children.push(...r.children),t.add(s)):n.push(r)}for(const r of t){const s=S8(r.children);n.push(new pf(r.value,s))}return n.filter(r=>!t.has(r))}function D8(e){return e.data||{}}function M8(e){return e.resolve||{}}function bte(e,n){return ml(t=>{const{targetSnapshot:r,guards:{canActivateChecks:s}}=t;if(!s.length)return Lr(t);const l=new Set(s.map(x=>x.route)),h=new Set;for(const x of l)if(!h.has(x))for(const E of A8(x))h.add(E);let g=0;return va(h).pipe(ow(x=>l.has(x)?function wte(e,n,t,r){const s=e.routeConfig,l=e._resolve;return void 0!==s?.title&&!_8(s)&&(l[lC]=s.title),function Tte(e,n,t,r){const s=dN(e);if(0===s.length)return Lr({});const l={};return va(s).pipe(ml(h=>function Ete(e,n,t,r){const s=pC(n)??r,l=pw(e,s);return v_(l.resolve?l.resolve(n,t):Ic(s,()=>l(n,t)))}(e[h],n,t,r).pipe(jy(),gl(g=>{if(g instanceof SN)throw DI(new mI,g);l[h]=g}))),hN(1),function H6(e){return J(()=>e)}(l),cw(h=>T8(h)?qu:dI(h)))}(l,e,n,r).pipe(J(h=>(e._resolvedData=h,e.data=EI(e,e.parent,t).resolve,null)))}(x,r,e,n):(x.data=EI(x,x.parent,e).resolve,Lr(void 0))),gl(()=>g++),hN(1),ml(x=>g===h.size?Lr(t):qu))})}function A8(e){const n=e.children.map(t=>A8(t)).flat();return[e,...n]}function IN(e){return rd(n=>{const t=e(n);return t?va(t).pipe(J(()=>n)):Lr(n)})}let I8=(()=>{class e{buildTitle(t){let r,s=t.root;for(;void 0!==s;)r=this.getResolvedTitleForRoute(s)??r,s=s.children.find(l=>l.outlet===Ti);return r}getResolvedTitleForRoute(t){return t.data[lC]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:()=>Xe(Cte),providedIn:"root"})}return e})(),Cte=(()=>{class e extends I8{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(QK))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const _w=new Gt("",{providedIn:"root",factory:()=>({})});let k8=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=ki({type:e,selectors:[["ng-component"]],standalone:!0,features:[cf],decls:1,vars:0,template:function(r,s){1&r&&Xn(0,"router-outlet")},dependencies:[EN],encapsulation:2})}return e})();function kN(e){const n=e.children&&e.children.map(kN),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==Ti&&(t.component=k8),t}const yw=new Gt("");let ON=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Xe(u5)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Lr(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=v_(t.loadComponent()).pipe(J(O8),gl(l=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=l}),iC(()=>{this.componentLoaders.delete(t)})),s=new j6(r,()=>new Ii).pipe(cN());return this.componentLoaders.set(t,s),s}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Lr({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const l=function Ste(e,n,t,r){return v_(e.loadChildren()).pipe(J(O8),ml(s=>s instanceof ML||Array.isArray(s)?Lr(s):va(n.compileModuleAsync(s))),J(s=>{r&&r(e);let l,h,g=!1;return Array.isArray(s)?(h=s,!0):(l=s.create(t).injector,h=l.get(yw,[],{optional:!0,self:!0}).flat()),{routes:h.map(kN),injector:l}}))}(r,this.compiler,t,this.onLoadEndListener).pipe(iC(()=>{this.childrenLoaders.delete(r)})),h=new j6(l,()=>new Ii).pipe(cN());return this.childrenLoaders.set(r,h),h}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function O8(e){return function Dte(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let RN=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:()=>Xe(Mte),providedIn:"root"})}return e})(),Mte=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const R8=new Gt(""),P8=new Gt("");function Ate(e,n,t){const r=e.get(P8),s=e.get(bo);return e.get(Qr).runOutsideAngular(()=>{if(!s.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(E=>setTimeout(E));let l;const h=new Promise(E=>{l=E}),g=s.startViewTransition(()=>(l(),function Ite(e){return new Promise(n=>{d({read:()=>setTimeout(n)},{injector:e})})}(e))),{onViewTransitionCreated:x}=r;return x&&Ic(e,()=>x({transition:g,from:n,to:t})),h})}const N8=new Gt("");let OI=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ii,this.transitionAbortSubject=new Ii,this.configLoader=Xe(ON),this.environmentInjector=Xe(qo),this.urlSerializer=Xe(hw),this.rootContexts=Xe(mC),this.location=Xe(X2),this.inputBindingEnabled=null!==Xe(SI,{optional:!0}),this.titleStrategy=Xe(I8),this.options=Xe(_w,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Xe(RN),this.createViewTransition=Xe(R8,{optional:!0}),this.navigationErrorHandler=Xe(N8,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Lr(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=s=>this.events.next(new yee(s)),this.configLoader.onLoadStartListener=s=>this.events.next(new _ee(s))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t,r,s){return this.transitions=new Vo({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:fC,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(xa(l=>0!==l.id),J(l=>({...l,extractedUrl:this.urlHandlingStrategy.extract(l.rawUrl)})),rd(l=>{let h=!1,g=!1;return Lr(l).pipe(rd(x=>{if(this.navigationId>l.id)return this.cancelNavigationTransition(l,"",Zu.SupersededByNewNavigation),qu;this.currentTransition=l,this.currentNavigation={id:x.id,initialUrl:x.rawUrl,extractedUrl:x.extractedUrl,targetBrowserUrl:"string"==typeof x.extras.browserUrl?this.urlSerializer.parse(x.extras.browserUrl):x.extras.browserUrl,trigger:x.source,extras:x.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const E=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!E&&"reload"!==(x.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const O="";return this.events.next(new dw(x.id,this.urlSerializer.serialize(x.rawUrl),O,wI.IgnoredSameUrlNavigation)),x.resolve(!1),qu}if(this.urlHandlingStrategy.shouldProcessUrl(x.rawUrl))return Lr(x).pipe(rd(O=>{const N=this.transitions?.getValue();return this.events.next(new bI(O.id,this.urlSerializer.serialize(O.extractedUrl),O.source,O.restoredState)),N!==this.transitions?.getValue()?qu:Promise.resolve(O)}),function xte(e,n,t,r,s,l){return ml(h=>function mte(e,n,t,r,s,l,h="emptyOnly"){return new _te(e,n,t,r,s,h,l).recognize()}(e,n,t,r,h.extractedUrl,s,l).pipe(J(({state:g,tree:x})=>({...h,targetSnapshot:g,urlAfterRedirects:x}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),gl(O=>{l.targetSnapshot=O.targetSnapshot,l.urlAfterRedirects=O.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:O.urlAfterRedirects};const N=new u8(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next(N)}));if(E&&this.urlHandlingStrategy.shouldProcessUrl(x.currentRawUrl)){const{id:O,extractedUrl:N,source:B,restoredState:W,extras:V}=x,X=new bI(O,this.urlSerializer.serialize(N),B,W);this.events.next(X);const le=p8(this.rootComponentType).snapshot;return this.currentTransition=l={...x,targetSnapshot:le,urlAfterRedirects:N,extras:{...V,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=N,Lr(l)}{const O="";return this.events.next(new dw(x.id,this.urlSerializer.serialize(x.extractedUrl),O,wI.IgnoredByUrlHandlingStrategy)),x.resolve(!1),qu}}),gl(x=>{const E=new fee(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects),x.targetSnapshot);this.events.next(E)}),J(x=>(this.currentTransition=l={...x,guards:Fee(x.targetSnapshot,x.currentSnapshot,this.rootContexts)},l)),function qee(e,n){return ml(t=>{const{targetSnapshot:r,currentSnapshot:s,guards:{canActivateChecks:l,canDeactivateChecks:h}}=t;return 0===h.length&&0===l.length?Lr({...t,guardsResult:!0}):function Zee(e,n,t,r){return va(e).pipe(ml(s=>function ete(e,n,t,r,s){const l=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return l&&0!==l.length?Lr(l.map(g=>{const x=pC(n)??s,E=pw(g,x);return v_(function Hee(e){return e&&vC(e.canDeactivate)}(E)?E.canDeactivate(e,n,t,r):Ic(x,()=>E(e,n,t,r))).pipe(jy())})).pipe(mw()):Lr(!0)}(s.component,s.route,t,n,r)),jy(s=>!0!==s,!0))}(h,r,s,e).pipe(ml(g=>g&&function Uee(e){return"boolean"==typeof e}(g)?function Xee(e,n,t,r){return va(n).pipe(ow(s=>aC(function Kee(e,n){return null!==e&&n&&n(new vee(e)),Lr(!0)}(s.route.parent,r),function Yee(e,n){return null!==e&&n&&n(new bee(e)),Lr(!0)}(s.route,r),function Qee(e,n,t){const r=n[n.length-1],l=n.slice(0,n.length-1).reverse().map(h=>function Lee(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(h)).filter(h=>null!==h).map(h=>V6(()=>Lr(h.guards.map(x=>{const E=pC(h.node)??t,D=pw(x,E);return v_(function $ee(e){return e&&vC(e.canActivateChild)}(D)?D.canActivateChild(r,e):Ic(E,()=>D(r,e))).pipe(jy())})).pipe(mw())));return Lr(l).pipe(mw())}(e,s.path,t),function Jee(e,n,t){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return Lr(!0);const s=r.map(l=>V6(()=>{const h=pC(n)??t,g=pw(l,h);return v_(function jee(e){return e&&vC(e.canActivate)}(g)?g.canActivate(n,e):Ic(h,()=>g(n,e))).pipe(jy())}));return Lr(s).pipe(mw())}(e,s.route,t))),jy(s=>!0!==s,!0))}(r,l,e,n):Lr(g)),J(g=>({...t,guardsResult:g})))})}(this.environmentInjector,x=>this.events.next(x)),gl(x=>{if(l.guardsResult=x.guardsResult,x.guardsResult&&"boolean"!=typeof x.guardsResult)throw DI(0,x.guardsResult);const E=new pee(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects),x.targetSnapshot,!!x.guardsResult);this.events.next(E)}),xa(x=>!!x.guardsResult||(this.cancelNavigationTransition(x,"",Zu.GuardRejected),!1)),IN(x=>{if(x.guards.canActivateChecks.length)return Lr(x).pipe(gl(E=>{const D=new mee(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(D)}),rd(E=>{let D=!1;return Lr(E).pipe(bte(this.paramsInheritanceStrategy,this.environmentInjector),gl({next:()=>D=!0,complete:()=>{D||this.cancelNavigationTransition(E,"",Zu.NoDataFromResolver)}}))}),gl(E=>{const D=new gee(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(D)}))}),IN(x=>{const E=D=>{const O=[];D.routeConfig?.loadComponent&&!D.routeConfig._loadedComponent&&O.push(this.configLoader.loadComponent(D.routeConfig).pipe(gl(N=>{D.component=N}),J(()=>{})));for(const N of D.children)O.push(...E(N));return O};return lN(E(x.targetSnapshot.root)).pipe(fI(null),hc(1))}),IN(()=>this.afterPreactivation()),rd(()=>{const{currentSnapshot:x,targetSnapshot:E}=l,D=this.createViewTransition?.(this.environmentInjector,x.root,E.root);return D?va(D).pipe(J(()=>l)):Lr(l)}),J(x=>{const E=function Iee(e,n,t){const r=gC(e,n._root,t?t._root:void 0);return new f8(r,n)}(t.routeReuseStrategy,x.targetSnapshot,x.currentRouterState);return this.currentTransition=l={...x,targetRouterState:E},this.currentNavigation.targetRouterState=E,l}),gl(()=>{this.events.next(new yN)}),((e,n,t,r)=>J(s=>(new Nee(n,s.targetRouterState,s.currentRouterState,t,r).activate(e),s)))(this.rootContexts,t.routeReuseStrategy,x=>this.events.next(x),this.inputBindingEnabled),hc(1),gl({next:x=>{h=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new bg(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects))),this.titleStrategy?.updateTitle(x.targetRouterState.snapshot),x.resolve(!0)},complete:()=>{h=!0}}),wo(this.transitionAbortSubject.pipe(gl(x=>{throw x}))),iC(()=>{!h&&!g&&this.cancelNavigationTransition(l,"",Zu.SupersededByNewNavigation),this.currentTransition?.id===l.id&&(this.currentNavigation=null,this.currentTransition=null)}),cw(x=>{if(g=!0,b8(x))this.events.next(new Wy(l.id,this.urlSerializer.serialize(l.extractedUrl),x.message,x.cancellationCode)),function Ree(e){return b8(e)&&Gy(e.url)}(x)?this.events.next(new TI(x.url,x.navigationBehaviorOptions)):l.resolve(!1);else{const E=new _N(l.id,this.urlSerializer.serialize(l.extractedUrl),x,l.targetSnapshot??void 0);try{const D=Ic(this.environmentInjector,()=>this.navigationErrorHandler?.(E));if(D instanceof SN){const{message:O,cancellationCode:N}=DI(0,D);this.events.next(new Wy(l.id,this.urlSerializer.serialize(l.extractedUrl),O,N)),this.events.next(new TI(D.redirectTo,D.navigationBehaviorOptions))}else{this.events.next(E);const O=t.errorHandler(x);l.resolve(!!O)}}catch(D){this.options.resolveNavigationPromiseOnError?l.resolve(!1):l.reject(D)}}return qu}))}))}cancelNavigationTransition(t,r,s){const l=new Wy(t.id,this.urlSerializer.serialize(t.extractedUrl),r,s);this.events.next(l),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function kte(e){return e!==fC}let Ote=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:()=>Xe(Pte),providedIn:"root"})}return e})();class Rte{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let Pte=(()=>{class e extends Rte{static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=Cs(e)))(s||e)}})();static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),F8=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:()=>Xe(Nte),providedIn:"root"})}return e})(),Nte=(()=>{class e extends F8{constructor(){super(...arguments),this.location=Xe(X2),this.urlSerializer=Xe(hw),this.options=Xe(_w,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Xe(RN),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new $y,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=p8(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(r=>{"popstate"===r.type&&t(r.url,r.state)})}handleRouterEvent(t,r){if(t instanceof bI)this.stateMemento=this.createStateMemento();else if(t instanceof dw)this.rawUrlTree=r.initialUrl;else if(t instanceof u8){if("eager"===this.urlUpdateStrategy&&!r.extras.skipLocationChange){const s=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??s,r)}}else t instanceof yN?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):t instanceof Wy&&(t.code===Zu.GuardRejected||t.code===Zu.NoDataFromResolver)?this.restoreHistory(r):t instanceof _N?this.restoreHistory(r,!0):t instanceof bg&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,r){const s=t instanceof $y?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(s)||r.extras.replaceUrl){const h={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(s,"",h)}else{const l={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(s,"",l)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-this.browserPageId;0!==l?this.location.historyGo(l):this.currentUrlTree===t.finalUrl&&0===l&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=Cs(e)))(s||e)}})();static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var xC=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(xC||{});function L8(e,n){e.events.pipe(xa(t=>t instanceof bg||t instanceof Wy||t instanceof _N||t instanceof dw),J(t=>t instanceof bg||t instanceof dw?xC.COMPLETE:t instanceof Wy&&(t.code===Zu.Redirect||t.code===Zu.SupersededByNewNavigation)?xC.REDIRECTING:xC.FAILED),xa(t=>t!==xC.REDIRECTING),hc(1)).subscribe(()=>{n()})}function Fte(e){throw e}const Lte={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Bte={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ba=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=Xe(QB),this.stateManager=Xe(F8),this.options=Xe(_w,{optional:!0})||{},this.pendingTasks=Xe(zh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Xe(OI),this.urlSerializer=Xe(hw),this.location=Xe(X2),this.urlHandlingStrategy=Xe(RN),this._events=new Ii,this.errorHandler=this.options.errorHandler||Fte,this.navigated=!1,this.routeReuseStrategy=Xe(Ote),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Xe(yw,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Xe(SI,{optional:!0}),this.eventsSubscription=new dn,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(r=>{try{const s=this.navigationTransitions.currentTransition,l=this.navigationTransitions.currentNavigation;if(null!==s&&null!==l)if(this.stateManager.handleRouterEvent(r,l),r instanceof Wy&&r.code!==Zu.Redirect&&r.code!==Zu.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof bg)this.navigated=!0;else if(r instanceof TI){const h=r.navigationBehaviorOptions,g=this.urlHandlingStrategy.merge(r.url,s.currentRawUrl),x={browserUrl:s.extras.browserUrl,info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:s.extras.replaceUrl||"eager"===this.urlUpdateStrategy||kte(s.source),...h};this.scheduleNavigation(g,fC,null,x,{resolve:s.resolve,reject:s.reject,promise:s.promise})}(function Ute(e){return!(e instanceof yN||e instanceof TI)})(r)&&this._events.next(r)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),fC,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",r)},0)})}navigateToSyncWithBrowser(t,r,s){const l={replaceUrl:!0},h=s?.navigationId?s:null;if(s){const x={...s};delete x.navigationId,delete x.\u0275routerPageId,0!==Object.keys(x).length&&(l.state=x)}const g=this.parseUrl(t);this.scheduleNavigation(g,r,h,l)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(kN),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){const{relativeTo:s,queryParams:l,fragment:h,queryParamsHandling:g,preserveFragment:x}=r,E=x?this.currentUrlTree.fragment:h;let O,D=null;switch(g){case"merge":D={...this.currentUrlTree.queryParams,...l};break;case"preserve":D=this.currentUrlTree.queryParams;break;default:D=l||null}null!==D&&(D=this.removeEmptyProps(D));try{O=r8(s?s.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||"/"!==t[0][0])&&(t=[]),O=this.currentUrlTree.root}return i8(O,t,D,E??null)}navigateByUrl(t,r={skipLocationChange:!1}){const s=Gy(t)?t:this.parseUrl(t),l=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(l,fC,null,r)}navigate(t,r={skipLocationChange:!1}){return function zte(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new Jt(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,r){let s;if(s=!0===r?{...Lte}:!1===r?{...Bte}:r,Gy(t))return Z6(this.currentUrlTree,t,s);const l=this.parseUrl(t);return Z6(this.currentUrlTree,l,s)}removeEmptyProps(t){return Object.entries(t).reduce((r,[s,l])=>(null!=l&&(r[s]=l),r),{})}scheduleNavigation(t,r,s,l,h){if(this.disposed)return Promise.resolve(!1);let g,x,E;h?(g=h.resolve,x=h.reject,E=h.promise):E=new Promise((O,N)=>{g=O,x=N});const D=this.pendingTasks.add();return L8(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(D))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:l,resolve:g,reject:x,promise:E,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),E.catch(O=>Promise.reject(O))}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),vw=(()=>{class e{constructor(t,r,s,l,h,g){this.router=t,this.route=r,this.tabIndexAttribute=s,this.renderer=l,this.el=h,this.locationStrategy=g,this.href=null,this.onChanges=new Ii,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;const x=h.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===x||"area"===x,this.isAnchorElement?this.subscription=t.events.subscribe(E=>{E instanceof bg&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null==t?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(this.routerLinkInput=Gy(t)||Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,r,s,l,h){const g=this.urlTree;return!!(null===g||this.isAnchorElement&&(0!==t||r||s||l||h||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(g,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const t=this.urlTree;this.href=null!==t&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t)):null;const r=null===this.href?null:function uE(e,n,t){return function L0(e,n){return"src"===n&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===n&&("base"===e||"link"===e)?Kd:Gi}(n,t)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(t,r){const s=this.renderer,l=this.el.nativeElement;null!==r?s.setAttribute(l,t,r):s.removeAttribute(l,t)}get urlTree(){return null===this.routerLinkInput?null:Gy(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(ba),xt(qp),jl("tabindex"),xt(qh),xt(Di),xt(p_))};static#t=this.\u0275dir=gn({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,s){1&r&&on("click",function(h){return s.onClick(h.button,h.ctrlKey,h.shiftKey,h.altKey,h.metaKey)}),2&r&&ds("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",so],skipLocationChange:[2,"skipLocationChange","skipLocationChange",so],replaceUrl:[2,"replaceUrl","replaceUrl",so],routerLink:"routerLink"},standalone:!0,features:[E2,to]})}return e})(),B8=(()=>{class e{get isActive(){return this._isActive}constructor(t,r,s,l,h){this.router=t,this.element=r,this.renderer=s,this.cdr=l,this.link=h,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new ir,this.routerEventsSubscription=t.events.subscribe(g=>{g instanceof bg&&this.update()})}ngAfterContentInit(){Lr(this.links.changes,Lr(null)).pipe(lw()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const t=[...this.links.toArray(),this.link].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=va(t).pipe(lw()).subscribe(r=>{this._isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(t){const r=Array.isArray(t)?t:t.split(" ");this.classes=r.filter(s=>!!s)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const t=this.hasActiveLinks();this.classes.forEach(r=>{t?this.renderer.addClass(this.element.nativeElement,r):this.renderer.removeClass(this.element.nativeElement,r)}),t&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.isActiveChange.emit(t))})}isLinkActive(t){const r=function Vte(e){return!!e.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return s=>{const l=s.urlTree;return!!l&&t.isActive(l,r)}}hasActiveLinks(){const t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(ba),xt(Di),xt(qh),xt(ed),xt(vw,8))};static#t=this.\u0275dir=gn({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(r,s,l){if(1&r&&fs(l,vw,5),2&r){let h;di(h=fi())&&(s.links=h)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[to]})}return e})();class z8{}let jte=(()=>{class e{constructor(t,r,s,l,h){this.router=t,this.injector=s,this.preloadingStrategy=l,this.loader=h}setUpPreloading(){this.subscription=this.router.events.pipe(xa(t=>t instanceof bg),ow(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const s=[];for(const l of r){l.providers&&!l._injector&&(l._injector=rA(l.providers,t,`Route: ${l.path}`));const h=l._injector??t,g=l._loadedInjector??h;(l.loadChildren&&!l._loadedRoutes&&void 0===l.canLoad||l.loadComponent&&!l._loadedComponent)&&s.push(this.preloadConfig(h,l)),(l.children||l._loadedRoutes)&&s.push(this.processRoutes(g,l.children??l._loadedRoutes))}return va(s).pipe(lw())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let s;s=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):Lr(null);const l=s.pipe(ml(h=>null===h?Lr(void 0):(r._loadedRoutes=h.routes,r._loadedInjector=h.injector,this.processRoutes(h.injector??t,h.routes))));return r.loadComponent&&!r._loadedComponent?va([l,this.loader.loadComponent(r)]).pipe(lw()):l})}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(ba),Dn(u5),Dn(qo),Dn(z8),Dn(ON))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const PN=new Gt("");let U8=(()=>{class e{constructor(t,r,s,l,h={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=s,this.zone=l,this.options=h,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},h.scrollPositionRestoration||="disabled",h.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof bI?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof bg?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof dw&&t.code===wI.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof h8&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new h8(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function $0(){throw new Error("invalid")}()};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();function Zp(e,n){return{\u0275kind:e,\u0275providers:n}}function j8(){const e=Xe(xs);return n=>{const t=e.get(Qh);if(n!==t.components[0])return;const r=e.get(ba),s=e.get($8);1===e.get(NN)&&r.initialNavigation(),e.get(H8,null,Gr.Optional)?.setUpPreloading(),e.get(PN,null,Gr.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),s.closed||(s.next(),s.complete(),s.unsubscribe())}}const $8=new Gt("",{factory:()=>new Ii}),NN=new Gt("",{providedIn:"root",factory:()=>1}),H8=new Gt("");function Wte(e){return Zp(0,[{provide:H8,useExisting:jte},{provide:z8,useExisting:e}])}function Zte(e){return Zp(9,[{provide:R8,useValue:Ate},{provide:P8,useValue:{skipNextTransition:!!e?.skipInitialTransition,...e}}])}const G8=new Gt("ROUTER_FORROOT_GUARD"),Xte=[X2,{provide:hw,useClass:mI},ba,mC,{provide:qp,useFactory:function V8(e){return e.routerState.root},deps:[ba]},ON,[]];let W8=(()=>{class e{constructor(t){}static forRoot(t,r){return{ngModule:e,providers:[Xte,[],{provide:yw,multi:!0,useValue:t},{provide:G8,useFactory:Qte,deps:[[ba,new Mm,new Od]]},{provide:_w,useValue:r||{}},r?.useHash?{provide:p_,useClass:sz}:{provide:p_,useClass:iz},{provide:PN,useFactory:()=>{const e=Xe(JY),n=Xe(Qr),t=Xe(_w),r=Xe(OI),s=Xe(hw);return t.scrollOffset&&e.setOffset(t.scrollOffset),new U8(s,r,e,n,t)}},r?.preloadingStrategy?Wte(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?ene(r):[],r?.bindToComponentInputs?Zp(8,[y8,{provide:SI,useExisting:y8}]).\u0275providers:[],r?.enableViewTransitions?Zte().\u0275providers:[],[{provide:q8,useFactory:j8},{provide:IA,multi:!0,useExisting:q8}]]}}static forChild(t){return{ngModule:e,providers:[{provide:yw,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(G8,8))};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})();function Qte(e){return"guarded"}function ene(e){return["disabled"===e.initialNavigation?Zp(3,[{provide:aP,multi:!0,useFactory:()=>{const n=Xe(ba);return()=>{n.setUpLocationChangeListener()}}},{provide:NN,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Zp(2,[{provide:NN,useValue:0},{provide:aP,multi:!0,deps:[xs],useFactory:n=>{const t=n.get(FX,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const s=n.get(ba),l=n.get($8);L8(s,()=>{r(!0)}),n.get(OI).afterPreactivation=()=>(r(!0),l.closed?Lr(void 0):l),s.initialNavigation()}))}}]).\u0275providers:[]]}const q8=new Gt("");let FN=(()=>{class e{constructor(t){this.httpClient=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getProducts(){return this.httpClient.get(this.baseUrl+"api/product/products")}updateProduct(t,r){return this.httpClient.put(this.baseUrl+"api/product/products/"+t,r)}createProduct(t){return this.httpClient.post(this.baseUrl+"api/product/product",t)}updatePrices(t){return this.httpClient.put(`${this.baseUrl}api/product/products/update_prices`,{sku_price_list:t})}syncSheet(){return this.httpClient.post(this.baseUrl+"api/product/products/syncsheet",{})}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Z8=(()=>{class e{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(qh),xt(Di))};static#t=this.\u0275dir=gn({type:e})}return e})(),qy=(()=>{class e extends Z8{static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=Cs(e)))(s||e)}})();static#t=this.\u0275dir=gn({type:e,features:[is]})}return e})();const Xu=new Gt(""),rne={provide:Xu,useExisting:zi(()=>LN),multi:!0};let LN=(()=>{class e extends qy{writeValue(t){this.setProperty("checked",t)}static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=Cs(e)))(s||e)}})();static#t=this.\u0275dir=gn({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,s){1&r&&on("change",function(h){return s.onChange(h.target.checked)})("blur",function(){return s.onTouched()})},features:[Fs([rne]),is]})}return e})();const ine={provide:Xu,useExisting:zi(()=>Za),multi:!0},one=new Gt("");let Za=(()=>{class e extends Z8{constructor(t,r,s){super(t,r),this._compositionMode=s,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function sne(){const e=f_()?f_().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(qh),xt(Di),xt(one,8))};static#t=this.\u0275dir=gn({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,s){1&r&&on("input",function(h){return s._handleInput(h.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(h){return s._compositionEnd(h.target.value)})},features:[Fs([ine]),is]})}return e})();const Wl=new Gt(""),b_=new Gt("");function J8(e){return function x_(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}(e.value)?{required:!0}:null}function RI(e){return null}function iU(e){return null!=e}function sU(e){return $2(e)?va(e):e}function oU(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function aU(e,n){return n.map(t=>t(e))}function lU(e){return e.map(n=>function lne(e){return!e.validate}(n)?n:t=>n.validate(t))}function BN(e){return null!=e?function cU(e){if(!e)return null;const n=e.filter(iU);return 0==n.length?null:function(t){return oU(aU(t,n))}}(lU(e)):null}function zN(e){return null!=e?function uU(e){if(!e)return null;const n=e.filter(iU);return 0==n.length?null:function(t){return function nne(...e){const n=sI(e),{args:t,keys:r}=B6(e),s=new $i(l=>{const{length:h}=t;if(!h)return void l.complete();const g=new Array(h);let x=h,E=h;for(let D=0;D<h;D++){let O=!1;pl(t[D]).subscribe(Me(l,N=>{O||(O=!0,E--),g[D]=N},()=>x--,void 0,()=>{(!x||!O)&&(E||l.next(r?z6(r,g):g),l.complete())}))}});return n?s.pipe(aN(n)):s}(aU(t,n).map(sU)).pipe(J(oU))}}(lU(e)):null}function hU(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function UN(e){return e?Array.isArray(e)?e:[e]:[]}function PI(e,n){return Array.isArray(e)?e.includes(n):e===n}function pU(e,n){const t=UN(n);return UN(e).forEach(s=>{PI(t,s)||t.push(s)}),t}function mU(e,n){return UN(n).filter(t=>!PI(e,t))}class gU{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=BN(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=zN(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class Vc extends gU{get formDirective(){return null}get path(){return null}}class w_ extends gU{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class _U{constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let ql=(()=>{class e extends _U{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(w_,2))};static#t=this.\u0275dir=gn({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,s){2&r&&Ki("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[is]})}return e})(),NI=(()=>{class e extends _U{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Vc,10))};static#t=this.\u0275dir=gn({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,s){2&r&&Ki("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[is]})}return e})();const bC="VALID",LI="INVALID",xw="PENDING",wC="DISABLED";class bw{}class vU extends bw{constructor(n,t){super(),this.value=n,this.source=t}}class $N extends bw{constructor(n,t){super(),this.pristine=n,this.source=t}}class HN extends bw{constructor(n,t){super(),this.touched=n,this.source=t}}class BI extends bw{constructor(n,t){super(),this.status=n,this.source=t}}function GN(e){return(zI(e)?e.validators:e)||null}function WN(e,n){return(zI(n)?n.asyncValidators:e)||null}function zI(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class qN{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Z2(()=>this.statusReactive()),this.statusReactive=Zh(void 0),this._pristine=Z2(()=>this.pristineReactive()),this.pristineReactive=Zh(!0),this._touched=Z2(()=>this.touchedReactive()),this.touchedReactive=Zh(!1),this._events=new Ii,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return jp(this.statusReactive)}set status(n){jp(()=>this.statusReactive.set(n))}get valid(){return this.status===bC}get invalid(){return this.status===LI}get pending(){return this.status==xw}get disabled(){return this.status===wC}get enabled(){return this.status!==wC}get pristine(){return jp(this.pristineReactive)}set pristine(n){jp(()=>this.pristineReactive.set(n))}get dirty(){return!this.pristine}get touched(){return jp(this.touchedReactive)}set touched(n){jp(()=>this.touchedReactive.set(n))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(pU(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(pU(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(mU(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(mU(n,this._rawAsyncValidators))}hasValidator(n){return PI(this._rawValidators,n)}hasAsyncValidator(n){return PI(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){const t=!1===this.touched;this.touched=!0;const r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched({...n,sourceControl:r}),t&&!1!==n.emitEvent&&this._events.next(new HN(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(n))}markAsUntouched(n={}){const t=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const r=n.sourceControl??this;this._forEachChild(s=>{s.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),t&&!1!==n.emitEvent&&this._events.next(new HN(!1,r))}markAsDirty(n={}){const t=!0===this.pristine;this.pristine=!1;const r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty({...n,sourceControl:r}),t&&!1!==n.emitEvent&&this._events.next(new $N(!1,r))}markAsPristine(n={}){const t=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const r=n.sourceControl??this;this._forEachChild(s=>{s.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),t&&!1!==n.emitEvent&&this._events.next(new $N(!0,r))}markAsPending(n={}){this.status=xw;const t=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new BI(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending({...n,sourceControl:t})}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=wC,this.errors=null,this._forEachChild(s=>{s.disable({...n,onlySelf:!0})}),this._updateValue();const r=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new vU(this.value,r)),this._events.next(new BI(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t},this),this._onDisabledChange.forEach(s=>s(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=bC,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t},this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,t){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===bC||this.status===xw)&&this._runAsyncValidator(r,n.emitEvent)}const t=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new vU(this.value,t)),this._events.next(new BI(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity({...n,sourceControl:t})}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?wC:bC}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,t){if(this.asyncValidator){this.status=xw,this._hasOwnPendingAsyncValidator={emitEvent:!1!==t};const r=sU(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(s=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(s,{emitEvent:t,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent,this,t.shouldHaveEmitted)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,s)=>r&&r._find(s),this)}getError(n,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,t,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new BI(this.status,t)),this._parent&&this._parent._updateControlsErrors(n,t,r)}_initObservables(){this.valueChanges=new ir,this.statusChanges=new ir}_calculateStatus(){return this._allControlsDisabled()?wC:this.errors?LI:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(xw)?xw:this._anyControlsHaveStatus(LI)?LI:bC}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,t){const r=!this._anyControlsDirty(),s=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,t),s&&this._events.next(new $N(this.pristine,t))}_updateTouched(n={},t){this.touched=this._anyControlsTouched(),this._events.next(new HN(this.touched,t)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,t)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){zI(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function mne(e){return Array.isArray(e)?BN(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function gne(e){return Array.isArray(e)?zN(e):e||null}(this._rawAsyncValidators)}}class ZN extends qN{constructor(n,t,r){super(GN(t),WN(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,r={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){(function bU(e,n,t){e._forEachChild((r,s)=>{if(void 0===t[s])throw new Jt(1002,"")})})(this,0,n),Object.keys(n).forEach(r=>{(function xU(e,n,t){const r=e.controls;if(!(n?Object.keys(r):r).length)throw new Jt(1e3,"");if(!r[t])throw new Jt(1001,"")})(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(r=>{const s=this.controls[r];s&&s.patchValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((r,s)=>{r.reset(n?n[s]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,r)=>(n[r]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&n(r,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,s)=>((r.enabled||this.disabled)&&(t[s]=r.value),t))}_reduceChildren(n,t){let r=n;return this._forEachChild((s,l)=>{r=t(r,s,l)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}const Zy=new Gt("CallSetDisabledState",{providedIn:"root",factory:()=>TC}),TC="always";function EC(e,n,t=TC){XN(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function vne(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&wU(e,n)})}(e,n),function bne(e,n){const t=(r,s)=>{n.valueAccessor.writeValue(r),s&&n.viewToModelUpdate(r)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function xne(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&wU(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function yne(e,n){if(n.valueAccessor.setDisabledState){const t=r=>{n.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function jI(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function XN(e,n){const t=function dU(e){return e._rawValidators}(e);null!==n.validator?e.setValidators(hU(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const r=function fU(e){return e._rawAsyncValidators}(e);null!==n.asyncValidator?e.setAsyncValidators(hU(r,n.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const s=()=>e.updateValueAndValidity();jI(n._rawValidators,s),jI(n._rawAsyncValidators,s)}function wU(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}const Sne={provide:Vc,useExisting:zi(()=>ww)},CC=Promise.resolve();let ww=(()=>{class e extends Vc{get submitted(){return jp(this.submittedReactive)}constructor(t,r,s){super(),this.callSetDisabledState=s,this._submitted=Z2(()=>this.submittedReactive()),this.submittedReactive=Zh(!1),this._directives=new Set,this.ngSubmit=new ir,this.form=new ZN({},BN(t),zN(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){CC.then(()=>{const r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),EC(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){CC.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){CC.then(()=>{const r=this._findContainer(t.path),s=new ZN({});(function TU(e,n){XN(e,n)})(s,t),r.registerControl(t.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){CC.then(()=>{const r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){CC.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),function EU(e,n){e._syncPendingControls(),n.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Wl,10),xt(b_,10),xt(Zy,8))};static#t=this.\u0275dir=gn({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,s){1&r&&on("submit",function(h){return s.onSubmit(h)})("reset",function(){return s.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Fs([Sne]),is]})}return e})();function CU(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function SU(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const DU=class extends qN{constructor(n=null,t,r){super(GN(t),WN(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),zI(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=SU(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){CU(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){CU(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){SU(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},Ane={provide:w_,useExisting:zi(()=>_l)},IU=Promise.resolve();let _l=(()=>{class e extends w_{constructor(t,r,s,l,h,g){super(),this._changeDetectorRef=h,this.callSetDisabledState=g,this.control=new DU,this._registered=!1,this.name="",this.update=new ir,this._parent=t,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=function JN(e,n){if(!n)return null;let t,r,s;return Array.isArray(n),n.forEach(l=>{l.constructor===Za?t=l:function Ene(e){return Object.getPrototypeOf(e.constructor)===qy}(l)?r=l:s=l}),s||r||t||null}(0,l)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),function KN(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){EC(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){IU.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const r=t.isDisabled.currentValue,s=0!==r&&so(r);IU.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?function UI(e,n){return[...n.path,e]}(t,this._parent):[t]}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Vc,9),xt(Wl,10),xt(b_,10),xt(Xu,10),xt(ed,8),xt(Zy,8))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Fs([Ane]),is,to]})}return e})(),HI=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=gn({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})();const Ine={provide:Xu,useExisting:zi(()=>SC),multi:!0};let SC=(()=>{class e extends qy{writeValue(t){this.setProperty("value",t??"")}registerOnChange(t){this.onChange=r=>{t(""==r?null:parseFloat(r))}}static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=Cs(e)))(s||e)}})();static#t=this.\u0275dir=gn({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,s){1&r&&on("input",function(h){return s.onChange(h.target.value)})("blur",function(){return s.onTouched()})},features:[Fs([Ine]),is]})}return e})();const QN=new Gt(""),zne={provide:Xu,useExisting:zi(()=>wg),multi:!0};function FU(e,n){return null==e?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let wg=(()=>{class e extends qy{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const s=FU(this._getOptionId(t),t);this.setProperty("value",s)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function Une(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=Cs(e)))(s||e)}})();static#t=this.\u0275dir=gn({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,s){1&r&&on("change",function(h){return s.onChange(h.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[Fs([zne]),is]})}return e})(),Xy=(()=>{class e{constructor(t,r,s){this._element=t,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(FU(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Di),xt(qh),xt(wg,9))};static#t=this.\u0275dir=gn({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})();const Vne={provide:Xu,useExisting:zi(()=>rF),multi:!0};function LU(e,n){return null==e?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${e}: ${n}`.slice(0,50))}let rF=(()=>{class e extends qy{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const s=t.map(l=>this._getOptionId(l));r=(l,h)=>{l._setSelected(s.indexOf(h.toString())>-1)}}else r=(s,l)=>{s._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const s=[],l=r.selectedOptions;if(void 0!==l){const h=l;for(let g=0;g<h.length;g++){const E=this._getOptionValue(h[g].value);s.push(E)}}else{const h=r.options;for(let g=0;g<h.length;g++){const x=h[g];if(x.selected){const E=this._getOptionValue(x.value);s.push(E)}}}this.value=s,t(s)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function jne(e){return e.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=Cs(e)))(s||e)}})();static#t=this.\u0275dir=gn({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,s){1&r&&on("change",function(h){return s.onChange(h.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[Fs([Vne]),is]})}return e})(),Yy=(()=>{class e{constructor(t,r,s){this._element=t,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(LU(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(LU(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Di),xt(qh),xt(rF,9))};static#t=this.\u0275dir=gn({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return e})(),Ky=(()=>{class e{constructor(){this._validator=RI}ngOnChanges(t){if(this.inputName in t){const r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):RI,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return null!=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=gn({type:e,features:[to]})}return e})();const Gne={provide:Wl,useExisting:zi(()=>Tw),multi:!0};let Tw=(()=>{class e extends Ky{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=so,this.createValidator=t=>J8}enabled(t){return t}static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=Cs(e)))(s||e)}})();static#t=this.\u0275dir=gn({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,s){2&r&&ds("required",s._enabled?"":null)},inputs:{required:"required"},features:[Fs([Gne]),is]})}return e})(),qU=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),Jne=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:Zy,useValue:t.callSetDisabledState??TC}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({imports:[qU]})}return e})(),Qne=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:QN,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:Zy,useValue:t.callSetDisabledState??TC}]}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({imports:[qU]})}return e})();function ere(e,n){1&e&&Xn(0,"br")}function tre(e,n){if(1&e&&(ee(0,"div",62),xe(1),te()),2&e){const t=Bt();Te(),dl(" ",t.successMessage," ")}}function nre(e,n){if(1&e&&(ee(0,"div",63),xe(1),te()),2&e){const t=Bt();Te(),dl(" ",t.errorMessage," ")}}function rre(e,n){if(1&e){const t=Wi();ee(0,"tr")(1,"td"),xe(2),te(),ee(3,"td"),xe(4),te(),ee(5,"td"),xe(6),te(),ee(7,"td"),xe(8),te(),ee(9,"td"),xe(10),te(),ee(11,"td")(12,"input",37),Tn("ngModelChange",function(s){const l=Mn(t).$implicit;return En(l.price_sale,s)||(l.price_sale=s),An(s)}),te()(),ee(13,"td"),xe(14),te(),ee(15,"td")(16,"span",64),on("click",function(){const s=Mn(t).$implicit;return An(Bt().openEditModal(s,"update"))}),Xn(17,"i",65),te()()()}if(2&e){const t=n.$implicit;Te(2),kn(t.sku),Te(2),kn(t.name),Te(2),kn(t.unit),Te(2),kn(t.category),Te(2),kn(t.price_purchase),Te(2),wn("ngModel",t.price_sale),Te(2),kn(t.status)}}function ire(e,n){if(1&e){const t=Wi();ee(0,"button",66),on("click",function(){return Mn(t),An(Bt().updated_product())}),xe(1,"Guardar Cambios"),te()}2&e&&Zt("disabled",!Bt().camposCompletos())}function sre(e,n){if(1&e){const t=Wi();ee(0,"button",66),on("click",function(){return Mn(t),An(Bt().created_product())}),xe(1,"Nuevo Producto"),te()}2&e&&Zt("disabled",!Bt().camposCompletos())}let ore=(()=>{class e{constructor(t,r){this.productService=t,this.router=r,this.products=[],this.filteredProducts=[],this.searchText="",this.product={},this.actionTipo="",this.successMessage="",this.errorMessage=""}ngOnInit(){this.checkIfLoggedIn()?this.getProducts():this.router.navigate(["/login"])}checkIfLoggedIn(){return!!localStorage.getItem("token")}getProducts(){this.productService.getProducts().subscribe(t=>{this.products=t,this.filteredProducts=t,this.filterProducts()})}filterProducts(){this.filteredProducts=""!==this.searchText.trim()?this.products.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())):this.products}openEditModal(t,r){this.product=t,this.actionTipo=r}updated_product(){this.product.price_sale=parseFloat(this.product.price_sale),this.product.price_purchase=parseFloat(this.product.price_purchase),this.product.margen=parseFloat(this.product.margen),this.product.discount=parseFloat(this.product.discount),this.product.iva_value=parseFloat(this.product.iva_value),this.product.iva="true"===this.product.iva,this.productService.updateProduct(this.product.id,this.product).subscribe(t=>{this.successMessage="\xa1Producto actualizado correctamente!",setTimeout(()=>{this.successMessage=""},3e3)}),this.getProducts()}created_product(){this.product.price_sale=+this.product.price_sale,this.product.price_purchase=+this.product.price_purchase,this.product.iva="true"===this.product.iva,this.productService.createProduct(this.product).subscribe(t=>{}),this.getProducts()}updatePrice(){const t=this.filteredProducts.map(r=>({sku:r.sku,price_sale:r.price_sale,id:r.id}));this.productService.updatePrices(t).subscribe(r=>{this.successMessage="\xa1Precios actualizados correctamente!",setTimeout(()=>{this.successMessage=""},3e3)})}camposCompletos(){const{name:t,unit:r,category:s,sku:l,price_sale:h,image:B,status:W}=this.product;return!!(t&&r&&s&&l&&h&&B&&W)}syncSheet(){this.productService.syncSheet().subscribe(t=>{200===t.status||void 0===t.status?(this.successMessage="\xa1Sincronizaci\xf3n exitosa!",this.getProducts(),setTimeout(()=>{this.successMessage=""},3e3)):(this.errorMessage="Error en la sincronizaci\xf3n.",setTimeout(()=>{this.errorMessage=""},3e3))})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(FN),xt(ba))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-products"]],decls:136,vars:21,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],[1,"col-6"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","keyup","ngModel"],["type","button","data-bs-toggle","modal","data-bs-target","#editProductModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","editProductModal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],["id","editProductModalLabel",1,"modal-title"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-10"],[1,"form-group"],["for","name"],["type","text","id","name","name","name",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-2"],["for","unit"],["id","unit","name","unit",1,"form-control",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],["value","KG"],["value","UNIT"],[1,"col-4"],["for","category"],["type","text","id","category","name","category",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-8"],["for","sku"],["type","text","id","sku","name","sku",1,"form-control",3,"ngModelChange","ngModel"],["for","price_sale"],["type","number","id","price_sale","name","price_sale",1,"form-control",3,"ngModelChange","ngModel"],["for","price_purchase"],["type","number","id","price_purchase","name","price_purchase",1,"form-control",3,"ngModelChange","ngModel"],["for","discount"],["type","number","id","discount","name","discount",1,"form-control",3,"ngModelChange","ngModel"],["for","margen"],["type","number","id","margen","name","margen",1,"form-control",3,"ngModelChange","ngModel"],["for","iva"],["id","iva","name","iva",1,"form-control",3,"ngModelChange","ngModel"],["value","true"],["value","false"],["for","iva_value"],["type","number","id","iva_value","name","iva_value",1,"form-control",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description",1,"form-control",3,"ngModelChange","ngModel"],["for","image"],["type","text","id","image","name","image",1,"form-control",3,"ngModelChange","ngModel"],["for","status"],["id","status","name","status",1,"form-control",3,"ngModelChange","ngModel"],["value","active"],["value","inactive"],["alt","Imagen del producto",1,"img-fluid",3,"src"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","class","btn btn-primary","data-bs-dismiss","modal",3,"disabled","click",4,"ngIf"],["role","alert",1,"alert","alert-success"],["role","alert",1,"alert","alert-danger"],["data-bs-toggle","modal","data-bs-target","#editProductModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-pencil-alt","fa-lg"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click","disabled"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),on("click",function(){return s.syncSheet()}),xe(4,"Sincronizar sheet"),te()(),ee(5,"div",4)(6,"input",5),Tn("ngModelChange",function(h){return En(s.searchText,h)||(s.searchText=h),h}),on("keyup",function(){return s.filterProducts()}),te()(),ee(7,"div",2)(8,"button",6),on("click",function(){return s.openEditModal({},"new")}),xe(9,"Nuevo Producto"),te()()(),Cn(10,ere,1,0,"br",7)(11,tre,2,1,"div",8)(12,nre,2,1,"div",9),Xn(13,"br"),ee(14,"table",10)(15,"thead")(16,"tr")(17,"th"),xe(18,"ID"),te(),ee(19,"th"),xe(20,"Nombre"),te(),ee(21,"th"),xe(22,"Unidad"),te(),ee(23,"th"),xe(24,"Categoria"),te(),ee(25,"th"),xe(26,"Precio Compra"),te(),ee(27,"th"),xe(28,"Precio Venta"),te(),ee(29,"th"),xe(30,"Estado"),te(),ee(31,"th"),xe(32,"Acciones"),te()()(),ee(33,"tbody"),Cn(34,rre,18,7,"tr",11),te()()(),ee(35,"div",12)(36,"div",13)(37,"div",14)(38,"div",15)(39,"h5",16),xe(40,"Editar Producto"),te()(),ee(41,"div",17)(42,"div",18)(43,"div",19)(44,"div",20)(45,"div",21)(46,"label",22),xe(47,"Nombre:"),te(),ee(48,"input",23),Tn("ngModelChange",function(h){return En(s.product.name,h)||(s.product.name=h),h}),te()()(),ee(49,"div",24)(50,"div",21)(51,"label",25),xe(52,"Unidad:"),te(),ee(53,"select",26),Tn("ngModelChange",function(h){return En(s.product.unit,h)||(s.product.unit=h),h}),ee(54,"option",27),xe(55,"Selecciona una unidad"),te(),ee(56,"option",28),xe(57,"Kg"),te(),ee(58,"option",29),xe(59,"Unidad"),te()()()()(),ee(60,"div",19)(61,"div",30)(62,"div",21)(63,"label",31),xe(64,"Categor\xeda:"),te(),ee(65,"input",32),Tn("ngModelChange",function(h){return En(s.product.category,h)||(s.product.category=h),h}),te()()(),ee(66,"div",33)(67,"div",21)(68,"label",34),xe(69,"SKU:"),te(),ee(70,"input",35),Tn("ngModelChange",function(h){return En(s.product.sku,h)||(s.product.sku=h),h}),te()()()(),ee(71,"div",19)(72,"div",4)(73,"div",21)(74,"label",36),xe(75,"Precio de Venta:"),te(),ee(76,"input",37),Tn("ngModelChange",function(h){return En(s.product.price_sale,h)||(s.product.price_sale=h),h}),te()()(),ee(77,"div",4)(78,"div",21)(79,"label",38),xe(80,"Precio de Compra:"),te(),ee(81,"input",39),Tn("ngModelChange",function(h){return En(s.product.price_purchase,h)||(s.product.price_purchase=h),h}),te()()()(),ee(82,"div",19)(83,"div",4)(84,"div",21)(85,"label",40),xe(86,"Descuento:"),te(),ee(87,"input",41),Tn("ngModelChange",function(h){return En(s.product.discount,h)||(s.product.discount=h),h}),te()()(),ee(88,"div",4)(89,"div",21)(90,"label",42),xe(91,"Margen:"),te(),ee(92,"input",43),Tn("ngModelChange",function(h){return En(s.product.margen,h)||(s.product.margen=h),h}),te()()()(),ee(93,"div",19)(94,"div",4)(95,"div",21)(96,"label",44),xe(97,"IVA:"),te(),ee(98,"select",45),Tn("ngModelChange",function(h){return En(s.product.iva,h)||(s.product.iva=h),h}),ee(99,"option",27),xe(100,"Selecciona una unidad"),te(),ee(101,"option",46),xe(102,"Si"),te(),ee(103,"option",47),xe(104,"No"),te()()()(),ee(105,"div",4)(106,"div",21)(107,"label",48),xe(108,"Valor IVA:"),te(),ee(109,"input",49),Tn("ngModelChange",function(h){return En(s.product.iva_value,h)||(s.product.iva_value=h),h}),te()()()(),ee(110,"div",21)(111,"label",50),xe(112,"Descripci\xf3n:"),te(),ee(113,"textarea",51),Tn("ngModelChange",function(h){return En(s.product.description,h)||(s.product.description=h),h}),te()(),ee(114,"div",19)(115,"div",4)(116,"div",21)(117,"label",52),xe(118,"Imagen:"),te(),ee(119,"input",53),Tn("ngModelChange",function(h){return En(s.product.image,h)||(s.product.image=h),h}),te()(),ee(120,"div",21)(121,"label",54),xe(122,"Estado:"),te(),ee(123,"select",55),Tn("ngModelChange",function(h){return En(s.product.status,h)||(s.product.status=h),h}),ee(124,"option",56),xe(125,"Activo"),te(),ee(126,"option",57),xe(127,"Inactivo"),te()()()(),ee(128,"div",4)(129,"div",33),Xn(130,"img",58),te()()()()(),ee(131,"div",59)(132,"button",60),xe(133,"Cerrar"),te(),Cn(134,ire,2,1,"button",61)(135,sre,2,1,"button",61),te()()()()),2&r&&(Te(6),wn("ngModel",s.searchText),Te(4),Zt("ngIf",s.successMessage),Te(),Zt("ngIf",s.successMessage),Te(),Zt("ngIf",s.errorMessage),Te(22),Zt("ngForOf",s.filteredProducts),Te(14),wn("ngModel",s.product.name),Te(5),wn("ngModel",s.product.unit),Te(12),wn("ngModel",s.product.category),Te(5),wn("ngModel",s.product.sku),Te(6),wn("ngModel",s.product.price_sale),Te(5),wn("ngModel",s.product.price_purchase),Te(6),wn("ngModel",s.product.discount),Te(5),wn("ngModel",s.product.margen),Te(6),wn("ngModel",s.product.iva),Te(11),wn("ngModel",s.product.iva_value),Te(4),wn("ngModel",s.product.description),Te(6),wn("ngModel",s.product.image),Te(4),wn("ngModel",s.product.status),Te(7),Zt("src",s.product.image,Gi),Te(4),Zt("ngIf","update"===s.actionTipo),Te(),Zt("ngIf","new"===s.actionTipo))},dependencies:[$p,uu,Xy,Yy,Za,SC,wg,ql,_l]})}return e})(),iF=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getClientes(){return this.http.get(this.baseUrl+"api/customer/customers")}createCliente(t){return this.http.post(`${this.baseUrl}`,t)}updateCliente(t){return this.http.put(`${this.baseUrl}/${t._id}`,t)}deleteCliente(t){return this.http.delete(`${this.baseUrl}/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function are(e,n){if(1&e){const t=Wi();ee(0,"tr")(1,"td"),xe(2),te(),ee(3,"td"),xe(4),te(),ee(5,"td"),xe(6),te(),ee(7,"td"),xe(8),te(),ee(9,"td"),xe(10),te(),ee(11,"td"),xe(12),te(),ee(13,"td"),xe(14),te(),ee(15,"td"),xe(16),te(),ee(17,"td")(18,"div",40)(19,"div",3)(20,"button",41),on("click",function(){const s=Mn(t).$implicit;return An(Bt().edit_customer(s))}),Xn(21,"i",42),te()(),ee(22,"div",3)(23,"button",43),on("click",function(){const s=Mn(t).$implicit;return An(Bt().delete_customer(s))}),Xn(24,"i",44),te()()()()()}if(2&e){const t=n.$implicit;Te(2),kn(t.name),Te(2),kn(t.phone),Te(2),kn(t.document),Te(2),kn(t.document_type),Te(2),kn(t.address),Te(2),kn(t.restaurant_name),Te(2),kn(t.email),Te(2),kn(t.category)}}let lre=(()=>{class e{constructor(t){this.clientesService=t,this.customers=[],this.filteredCustomers=[],this.searchText="",this.selectedCustomer={},this.isNewCustomer=!0}ngOnInit(){this.getClientes()}getClientes(){this.clientesService.getClientes().subscribe(t=>{this.customers=t,this.filteredCustomers=this.customers},t=>{console.error("Error al obtener clientes:",t)})}filterCustomers(){this.filteredCustomers=this.customers.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())||t.phone.toLowerCase().includes(this.searchText.toLowerCase())||t.document.toLowerCase().includes(this.searchText.toLowerCase())||t.email.toLowerCase().includes(this.searchText.toLowerCase())||t.restaurant_name.toLowerCase().includes(this.searchText.toLowerCase())||t.status.toLowerCase().includes(this.searchText.toLowerCase())||t.category.toLowerCase().includes(this.searchText.toLowerCase()))}openEditModal(t,r){this.isNewCustomer="new"===r,this.selectedCustomer="new"===r?{}:{...t}}edit_customer(t){this.openEditModal(t,"edit")}saveCustomer(){}delete_customer(t){confirm("\xbfEst\xe1 seguro de que desea eliminar este cliente?")&&this.clientesService.deleteCliente(t._id).subscribe(()=>{this.customers=this.customers.filter(r=>r._id!==t._id),this.filterCustomers()},r=>{console.error("Error al eliminar cliente:",r)})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(iF))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-clientes"]],decls:84,vars:12,consts:[["customerForm","ngForm"],[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"col-10"],["type","text","placeholder","Buscar cliente...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"row"],[1,"container-fluid"],[1,"table"],[4,"ngFor","ngForOf"],["id","customerModal","tabindex","-1","aria-labelledby","customerModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","customerModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","phone",1,"form-label"],["type","text","id","phone","name","phone","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","document",1,"form-label"],["type","text","id","document","name","document","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","documentType",1,"form-label"],["type","text","id","documentType","name","documentType","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","address",1,"form-label"],["type","text","id","address","name","address",1,"form-control",3,"ngModelChange","ngModel"],["for","restaurantName",1,"form-label"],["type","text","id","restaurantName","name","restaurantName",1,"form-control",3,"ngModelChange","ngModel"],["for","email",1,"form-label"],["type","email","id","email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","status",1,"form-label"],["type","text","id","status","name","status",1,"form-control",3,"ngModelChange","ngModel"],["for","category",1,"form-label"],["type","text","id","category","name","category",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","justify-content-center"],["title","Edit",1,"btn","btn-primary",3,"click"],[1,"fa","fa-pencil"],["title","Delete",1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash"]],template:function(r,s){if(1&r){const l=Wi();ee(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),on("click",function(){return Mn(l),An(s.openEditModal({},"new"))}),xe(4,"Nueva Cliente"),te()(),ee(5,"div",5)(6,"input",6),Tn("ngModelChange",function(g){return Mn(l),En(s.searchText,g)||(s.searchText=g),An(g)}),on("keyup",function(){return Mn(l),An(s.filterCustomers())}),te()(),Xn(7,"br"),ee(8,"div",7)(9,"div",8)(10,"table",9)(11,"thead")(12,"tr")(13,"th"),xe(14,"Nombre"),te(),ee(15,"th"),xe(16,"Tel\xe9fono"),te(),ee(17,"th"),xe(18,"Documento"),te(),ee(19,"th"),xe(20,"Tipo de Documento"),te(),ee(21,"th"),xe(22,"Direcci\xf3n"),te(),ee(23,"th"),xe(24,"Nombre del Restaurante"),te(),ee(25,"th"),xe(26,"Email"),te(),ee(27,"th"),xe(28,"Categor\xeda"),te(),ee(29,"th"),xe(30,"Acciones"),te()()(),ee(31,"tbody"),Cn(32,are,25,8,"tr",10),te()()()()()(),ee(33,"div",11)(34,"div",12)(35,"div",13)(36,"div",14)(37,"h5",15),xe(38),te(),Xn(39,"button",16),te(),ee(40,"div",17)(41,"form",null,0)(43,"div",18)(44,"label",19),xe(45,"Nombre"),te(),ee(46,"input",20),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.name,g)||(s.selectedCustomer.name=g),An(g)}),te()(),ee(47,"div",18)(48,"label",21),xe(49,"Tel\xe9fono"),te(),ee(50,"input",22),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.phone,g)||(s.selectedCustomer.phone=g),An(g)}),te()(),ee(51,"div",18)(52,"label",23),xe(53,"Documento"),te(),ee(54,"input",24),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.document,g)||(s.selectedCustomer.document=g),An(g)}),te()(),ee(55,"div",18)(56,"label",25),xe(57,"Tipo de Documento"),te(),ee(58,"input",26),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.document_type,g)||(s.selectedCustomer.document_type=g),An(g)}),te()(),ee(59,"div",18)(60,"label",27),xe(61,"Direcci\xf3n"),te(),ee(62,"input",28),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.address,g)||(s.selectedCustomer.address=g),An(g)}),te()(),ee(63,"div",18)(64,"label",29),xe(65,"Nombre del Restaurante"),te(),ee(66,"input",30),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.restaurant_name,g)||(s.selectedCustomer.restaurant_name=g),An(g)}),te()(),ee(67,"div",18)(68,"label",31),xe(69,"Email"),te(),ee(70,"input",32),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.email,g)||(s.selectedCustomer.email=g),An(g)}),te()(),ee(71,"div",18)(72,"label",33),xe(73,"Estado"),te(),ee(74,"input",34),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.status,g)||(s.selectedCustomer.status=g),An(g)}),te()(),ee(75,"div",18)(76,"label",35),xe(77,"Categor\xeda"),te(),ee(78,"input",36),Tn("ngModelChange",function(g){return Mn(l),En(s.selectedCustomer.category,g)||(s.selectedCustomer.category=g),An(g)}),te()()()(),ee(79,"div",37)(80,"button",38),xe(81,"Cancelar"),te(),ee(82,"button",39),on("click",function(){return Mn(l),An(s.saveCustomer())}),xe(83,"Guardar"),te()()()()()}2&r&&(Te(6),wn("ngModel",s.searchText),Te(26),Zt("ngForOf",s.filteredCustomers),Te(6),kn(s.isNewCustomer?"Nuevo Cliente":"Editar Cliente"),Te(8),wn("ngModel",s.selectedCustomer.name),Te(4),wn("ngModel",s.selectedCustomer.phone),Te(4),wn("ngModel",s.selectedCustomer.document),Te(4),wn("ngModel",s.selectedCustomer.document_type),Te(4),wn("ngModel",s.selectedCustomer.address),Te(4),wn("ngModel",s.selectedCustomer.restaurant_name),Te(4),wn("ngModel",s.selectedCustomer.email),Te(4),wn("ngModel",s.selectedCustomer.status),Te(4),wn("ngModel",s.selectedCustomer.category))},dependencies:[$p,HI,Za,ql,NI,Tw,_l,ww]})}return e})(),ZU=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getOrders(t){return this.http.get(this.baseUrl+"api/order/orders/"+t)}updateOrder(t,r){return this.http.post(this.baseUrl+"api/order/order/"+t,r)}createOrder(t){return this.http.post(this.baseUrl+"api/order/order",t)}getConfig(){return this.http.get(this.baseUrl+"api/config/configOrder")}deleteOrder(t){return this.http.delete(this.baseUrl+"api/order/order/"+t)}getLastOrdersByCustomerId(t){return this.http.get(this.baseUrl+"api/order/orders_latest_customer/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),cre=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}send_invoice(t){return this.http.get(this.baseUrl+"api/alegra/send_invoice/"+t)}get_invoice(t){const s=new Uc({Accept:"application/json","Content-Type":"application/json",Authorization:"Basic dm1kaWFnb3ZAZ21haWwuY29tOjBmZmQ1YzdiM2NiMWI5OWVjNDA0","X-Authorization":"tu-valor",Origin:"tu-origen","X-Requested-With":"XMLHttpRequest","X-HTTP-Method-Override":"POST","X-Data-Source":"tu-data-source","X-Experiment-Onb-Variant":"tu-variant","X-Experiment-Onb-Id":"tu-id","X-Request-Origin-Project":"tu-proyecto","X-School-Name":"tu-school-name","X-Regime-Name":"tu-regime-name","X-Sat-Register":"tu-sat-register"});return this.http.post("https://api.alegra.com/api/v1/invoices/215/open",{headers:s})}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class ure extends dn{constructor(n,t){super()}schedule(n,t=0){return this}}const GI={setInterval(e,n,...t){const{delegate:r}=GI;return r?.setInterval?r.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=GI;return(n?.clearInterval||clearInterval)(e)},delegate:void 0};class sF extends ure{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var r;if(this.closed)return this;this.state=n;const s=this.id,l=this.scheduler;return null!=s&&(this.id=this.recycleAsyncId(l,s,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(l,this.id,t),this}requestAsyncId(n,t,r=0){return GI.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&GI.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(n,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let s,r=!1;try{this.work(n)}catch(l){r=!0,s=l||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,mn(r,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}const XU={now:()=>(XU.delegate||Date).now(),delegate:void 0};class DC{constructor(n,t=DC.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,r){return new this.schedulerActionCtor(this,n).schedule(r,t)}}DC.now=XU.now;class oF extends DC{constructor(n,t=DC.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let r;this._active=!0;do{if(r=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,r){for(;n=t.shift();)n.unsubscribe();throw r}}}const WI=new oF(sF),hre=WI;function aF(e=0,n,t=hre){let r=-1;return null!=n&&(Jz(n)?t=n:r=n),new $i(s=>{let l=function fre(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;l<0&&(l=0);let h=0;return t.schedule(function(){s.closed||(s.next(h++),0<=r?this.schedule(void 0,r):s.complete())},l)})}const MC={schedule(e){let n=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:r}=MC;r&&(n=r.requestAnimationFrame,t=r.cancelAnimationFrame);const s=n(l=>{t=void 0,e(l)});return new dn(()=>t?.(s))},requestAnimationFrame(...e){const{delegate:n}=MC;return(n?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:n}=MC;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0},yre=new class _re extends oF{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:r}=this;let s;n=n||r.shift();do{if(s=n.execute(n.state,n.delay))break}while((n=r[0])&&n.id===t&&r.shift());if(this._active=!1,s){for(;(n=r[0])&&n.id===t&&r.shift();)n.unsubscribe();throw s}}}(class gre extends sF{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,r=0){return null!==r&&r>0?super.requestAsyncId(n,t,r):(n.actions.push(this),n._scheduled||(n._scheduled=MC.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,t,r=0){var s;if(null!=r?r>0:this.delay>0)return super.recycleAsyncId(n,t,r);const{actions:l}=n;null!=t&&(null===(s=l[l.length-1])||void 0===s?void 0:s.id)!==t&&(MC.cancelAnimationFrame(t),n._scheduled=void 0)}});let lF,vre=1;const qI={};function YU(e){return e in qI&&(delete qI[e],!0)}const xre={setImmediate(e){const n=vre++;return qI[n]=!0,lF||(lF=Promise.resolve()),lF.then(()=>YU(n)&&e()),n},clearImmediate(e){YU(e)}},{setImmediate:bre,clearImmediate:wre}=xre,ZI={setImmediate(...e){const{delegate:n}=ZI;return(n?.setImmediate||bre)(...e)},clearImmediate(e){const{delegate:n}=ZI;return(n?.clearImmediate||wre)(e)},delegate:void 0},Cre=new class Ere extends oF{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:r}=this;let s;n=n||r.shift();do{if(s=n.execute(n.state,n.delay))break}while((n=r[0])&&n.id===t&&r.shift());if(this._active=!1,s){for(;(n=r[0])&&n.id===t&&r.shift();)n.unsubscribe();throw s}}}(class Tre extends sF{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,r=0){return null!==r&&r>0?super.requestAsyncId(n,t,r):(n.actions.push(this),n._scheduled||(n._scheduled=ZI.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,t,r=0){var s;if(null!=r?r>0:this.delay>0)return super.recycleAsyncId(n,t,r);const{actions:l}=n;null!=t&&(null===(s=l[l.length-1])||void 0===s?void 0:s.id)!==t&&(ZI.clearImmediate(t),n._scheduled===t&&(n._scheduled=void 0))}}),Sre=["addListener","removeListener"],Dre=["addEventListener","removeEventListener"],Mre=["on","off"];function ta(e,n,t,r){if(hn(t)&&(r=t,t=void 0),r)return ta(e,n,t).pipe(aN(r));const[s,l]=function kre(e){return hn(e.addEventListener)&&hn(e.removeEventListener)}(e)?Dre.map(h=>g=>e[h](n,g,t)):function Are(e){return hn(e.addListener)&&hn(e.removeListener)}(e)?Sre.map(KU(e,n)):function Ire(e){return hn(e.on)&&hn(e.off)}(e)?Mre.map(KU(e,n)):[];if(!s&&tN(e))return ml(h=>ta(h,n,t))(pl(e));if(!s)throw new TypeError("Invalid event target");return new $i(h=>{const g=(...x)=>h.next(1<x.length?x:x[0]);return s(g),()=>l(g)})}function KU(e,n){return t=>r=>e[t](n,r)}function XI(...e){const n=rC(e),t=function iJ(e,n){return"number"==typeof YP(e)?e.pop():n}(e,1/0),r=e;return r.length?1===r.length?pl(r[0]):lw(t)(va(r,n)):qu}const Ore=["content"],Rre=["scroll"],Pre=["padding"],JU=["*"],AC=e=>({searchTerm:e});function Nre(e,n){if(1&e&&(ee(0,"div",3),gA(1,6),te()),2&e){const t=Bt();Te(),Zt("ngTemplateOutlet",t.headerTemplate)("ngTemplateOutletContext",uf(2,AC,t.filterValue))}}function Fre(e,n){if(1&e&&(ee(0,"div",5),gA(1,6),te()),2&e){const t=Bt();Te(),Zt("ngTemplateOutlet",t.footerTemplate)("ngTemplateOutletContext",uf(2,AC,t.filterValue))}}const Lre=["searchInput"],Bre=["clearButton"],zre=(e,n,t)=>({item:e,clear:n,label:t}),Ure=(e,n)=>({items:e,clear:n}),Vre=(e,n,t,r)=>({item:e,item$:n,index:t,searchTerm:r});function jre(e,n){if(1&e){const t=Wi();ee(0,"span",21),on("click",function(){Mn(t);const s=Bt().$implicit;return An(Bt(2).unselect(s))}),xe(1,"\xd7"),te(),Xn(2,"span",22)}if(2&e){const t=Bt().$implicit,r=Bt(2);Te(2),Zt("ngItemLabel",t.label)("escape",r.escapeHTML)}}function $re(e,n){}function Hre(e,n){if(1&e&&(ee(0,"div",20),Cn(1,jre,3,2,"ng-template",null,1,fl)(3,$re,0,0,"ng-template",12),te()),2&e){const t=n.$implicit,r=Wa(2),s=Bt(2);Ki("ng-value-disabled",t.disabled),Te(3),Zt("ngTemplateOutlet",s.labelTemplate||r)("ngTemplateOutletContext",CA(4,zre,t.value,s.clearItem,t.label))}}function Gre(e,n){1&e&&Yh(0,Hre,4,8,"div",19,LR().trackByOption,!0),2&e&&Kh(Bt().selectedItems)}function Wre(e,n){}function qre(e,n){if(1&e&&Cn(0,Wre,0,0,"ng-template",12),2&e){const t=Bt();Zt("ngTemplateOutlet",t.multiLabelTemplate)("ngTemplateOutletContext",tw(2,Ure,t.selectedValues,t.clearItem))}}function Zre(e,n){1&e&&Xn(0,"div",24)}function Xre(e,n){}function Yre(e,n){if(1&e&&Cn(0,Zre,1,0,"ng-template",null,2,fl)(2,Xre,0,0,"ng-template",23),2&e){const t=Wa(1),r=Bt();Te(2),Zt("ngTemplateOutlet",r.loadingSpinnerTemplate||t)}}function Kre(e,n){1&e&&(ee(0,"span",15,3)(2,"span",25),xe(3,"\xd7"),te()()),2&e&&wA("title",Bt().clearAllText)}function Jre(e,n){if(1&e&&Xn(0,"span",30),2&e){const t=Bt().$implicit,r=Bt(2);Zt("ngItemLabel",t.label)("escape",r.escapeHTML)}}function Qre(e,n){}function eie(e,n){if(1&e){const t=Wi();ee(0,"div",29),on("click",function(){const s=Mn(t).$implicit;return An(Bt(2).toggleItem(s))})("mouseover",function(){const s=Mn(t).$implicit;return An(Bt(2).onItemHover(s))}),Cn(1,Jre,1,2,"ng-template",null,4,fl)(3,Qre,0,0,"ng-template",12),te()}if(2&e){const t=n.$implicit,r=Wa(2),s=Bt(2);Ki("ng-option-disabled",t.disabled)("ng-option-selected",t.selected)("ng-optgroup",t.children)("ng-option",!t.children)("ng-option-child",!!t.parent)("ng-option-marked",t===s.itemsList.markedItem),ds("role",t.children?"group":"option")("aria-selected",t.selected)("id",null==t?null:t.htmlId),Te(3),Zt("ngTemplateOutlet",t.children?s.optgroupTemplate||r:s.optionTemplate||r)("ngTemplateOutletContext",kB(17,Vre,t.value,t,t.index,s.searchTerm))}}function tie(e,n){if(1&e&&(ee(0,"span")(1,"span",32),xe(2),te(),xe(3),te()),2&e){const t=Bt(3);Te(2),kn(t.addTagText),Te(),dl('"',t.searchTerm,'"')}}function nie(e,n){}function rie(e,n){if(1&e){const t=Wi();ee(0,"div",31),on("mouseover",function(){return Mn(t),An(Bt(2).itemsList.unmarkItem())})("click",function(){return Mn(t),An(Bt(2).selectTag())}),Cn(1,tie,4,2,"ng-template",null,5,fl)(3,nie,0,0,"ng-template",12),te()}if(2&e){const t=Wa(2),r=Bt(2);Ki("ng-option-marked",!r.itemsList.markedItem),Te(3),Zt("ngTemplateOutlet",r.tagTemplate||t)("ngTemplateOutletContext",uf(4,AC,r.searchTerm))}}function iie(e,n){if(1&e&&(ee(0,"div",33),xe(1),te()),2&e){const t=Bt(3);Te(),kn(t.notFoundText)}}function sie(e,n){}function oie(e,n){if(1&e&&Cn(0,iie,2,1,"ng-template",null,6,fl)(2,sie,0,0,"ng-template",12),2&e){const t=Wa(1),r=Bt(2);Te(2),Zt("ngTemplateOutlet",r.notFoundTemplate||t)("ngTemplateOutletContext",uf(2,AC,r.searchTerm))}}function aie(e,n){if(1&e&&(ee(0,"div",33),xe(1),te()),2&e){const t=Bt(3);Te(),kn(t.typeToSearchText)}}function lie(e,n){}function cie(e,n){if(1&e&&Cn(0,aie,2,1,"ng-template",null,7,fl)(2,lie,0,0,"ng-template",23),2&e){const t=Wa(1),r=Bt(2);Te(2),Zt("ngTemplateOutlet",r.typeToSearchTemplate||t)}}function uie(e,n){if(1&e&&(ee(0,"div",33),xe(1),te()),2&e){const t=Bt(3);Te(),kn(t.loadingText)}}function hie(e,n){}function die(e,n){if(1&e&&Cn(0,uie,2,1,"ng-template",null,8,fl)(2,hie,0,0,"ng-template",12),2&e){const t=Wa(1),r=Bt(2);Te(2),Zt("ngTemplateOutlet",r.loadingTextTemplate||t)("ngTemplateOutletContext",uf(2,AC,r.searchTerm))}}function fie(e,n){if(1&e){const t=Wi();ee(0,"ng-dropdown-panel",26),on("update",function(s){return Mn(t),An(Bt().viewPortItems=s)})("scroll",function(s){return Mn(t),An(Bt().scroll.emit(s))})("scrollToEnd",function(s){return Mn(t),An(Bt().scrollToEnd.emit(s))})("outsideClick",function(){return Mn(t),An(Bt().close())}),pA(1),Yh(2,eie,4,22,"div",27,LR().trackByOption,!0),Cn(4,rie,4,6,"div",28),mA(),Cn(5,oie,3,4)(6,cie,3,1)(7,die,3,4),te()}if(2&e){const t=Bt();Ki("ng-select-multiple",t.multiple),Zt("virtualScroll",t.virtualScroll)("bufferAmount",t.bufferAmount)("appendTo",t.appendTo)("position",t.dropdownPosition)("headerTemplate",t.headerTemplate)("footerTemplate",t.footerTemplate)("filterValue",t.searchTerm)("items",t.itemsList.filteredItems)("markedItem",t.itemsList.markedItem)("ngClass",t.appendTo?t.classes:null)("id",t.dropdownId),Te(2),Kh(t.viewPortItems),Te(2),Ds(t.showAddTag?4:-1),Te(),Ds(t.showNoItemsFound()?5:-1),Te(),Ds(t.showTypeToSearch()?6:-1),Te(),Ds(t.loading&&0===t.itemsList.filteredItems.length?7:-1)}}const QU=/[&<>"']/g,pie=RegExp(QU.source),mie={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function To(e){return null!=e}function IC(e){return"object"==typeof e&&To(e)}function YI(e){return e instanceof Function}let yie=(()=>{class e{constructor(t){this.element=t,this.escape=!0}ngOnChanges(t){this.element.nativeElement.innerHTML=this.escape?function gie(e){return e&&pie.test(e)?e.replace(QU,n=>mie[n]):e}(this.ngItemLabel):this.ngItemLabel}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Di))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ngItemLabel",""]],inputs:{ngItemLabel:"ngItemLabel",escape:"escape"},features:[to]})}return e})(),vie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-option-tmp",""]]})}return e})(),xie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-optgroup-tmp",""]]})}return e})(),bie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-label-tmp",""]]})}return e})(),wie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-multi-label-tmp",""]]})}return e})(),Tie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-header-tmp",""]]})}return e})(),Eie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-footer-tmp",""]]})}return e})(),Cie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-notfound-tmp",""]]})}return e})(),Sie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-typetosearch-tmp",""]]})}return e})(),Die=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-loadingtext-tmp",""]]})}return e})(),Mie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-tag-tmp",""]]})}return e})(),Aie=(()=>{class e{constructor(t){this.template=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(si))};static#t=this.\u0275dir=gn({type:e,selectors:[["","ng-loadingspinner-tmp",""]]})}return e})();function eV(){return"axxxxxxxxxxx".replace(/[x]/g,()=>(16*Math.random()|0).toString(16))}const Iie={"\u24b6":"A",\uff21:"A",\u00c0:"A",\u00c1:"A",\u00c2:"A",\u1ea6:"A",\u1ea4:"A",\u1eaa:"A",\u1ea8:"A",\u00c3:"A",\u0100:"A",\u0102:"A",\u1eb0:"A",\u1eae:"A",\u1eb4:"A",\u1eb2:"A",\u0226:"A",\u01e0:"A",\u00c4:"A",\u01de:"A",\u1ea2:"A",\u00c5:"A",\u01fa:"A",\u01cd:"A",\u0200:"A",\u0202:"A",\u1ea0:"A",\u1eac:"A",\u1eb6:"A",\u1e00:"A",\u0104:"A",\u023a:"A",\u2c6f:"A",\ua732:"AA",\u00c6:"AE",\u01fc:"AE",\u01e2:"AE",\ua734:"AO",\ua736:"AU",\ua738:"AV",\ua73a:"AV",\ua73c:"AY","\u24b7":"B",\uff22:"B",\u1e02:"B",\u1e04:"B",\u1e06:"B",\u0243:"B",\u0182:"B",\u0181:"B","\u24b8":"C",\uff23:"C",\u0106:"C",\u0108:"C",\u010a:"C",\u010c:"C",\u00c7:"C",\u1e08:"C",\u0187:"C",\u023b:"C",\ua73e:"C","\u24b9":"D",\uff24:"D",\u1e0a:"D",\u010e:"D",\u1e0c:"D",\u1e10:"D",\u1e12:"D",\u1e0e:"D",\u0110:"D",\u018b:"D",\u018a:"D",\u0189:"D",\ua779:"D",\u01f1:"DZ",\u01c4:"DZ",\u01f2:"Dz",\u01c5:"Dz","\u24ba":"E",\uff25:"E",\u00c8:"E",\u00c9:"E",\u00ca:"E",\u1ec0:"E",\u1ebe:"E",\u1ec4:"E",\u1ec2:"E",\u1ebc:"E",\u0112:"E",\u1e14:"E",\u1e16:"E",\u0114:"E",\u0116:"E",\u00cb:"E",\u1eba:"E",\u011a:"E",\u0204:"E",\u0206:"E",\u1eb8:"E",\u1ec6:"E",\u0228:"E",\u1e1c:"E",\u0118:"E",\u1e18:"E",\u1e1a:"E",\u0190:"E",\u018e:"E","\u24bb":"F",\uff26:"F",\u1e1e:"F",\u0191:"F",\ua77b:"F","\u24bc":"G",\uff27:"G",\u01f4:"G",\u011c:"G",\u1e20:"G",\u011e:"G",\u0120:"G",\u01e6:"G",\u0122:"G",\u01e4:"G",\u0193:"G",\ua7a0:"G",\ua77d:"G",\ua77e:"G","\u24bd":"H",\uff28:"H",\u0124:"H",\u1e22:"H",\u1e26:"H",\u021e:"H",\u1e24:"H",\u1e28:"H",\u1e2a:"H",\u0126:"H",\u2c67:"H",\u2c75:"H",\ua78d:"H","\u24be":"I",\uff29:"I",\u00cc:"I",\u00cd:"I",\u00ce:"I",\u0128:"I",\u012a:"I",\u012c:"I",\u0130:"I",\u00cf:"I",\u1e2e:"I",\u1ec8:"I",\u01cf:"I",\u0208:"I",\u020a:"I",\u1eca:"I",\u012e:"I",\u1e2c:"I",\u0197:"I","\u24bf":"J",\uff2a:"J",\u0134:"J",\u0248:"J","\u24c0":"K",\uff2b:"K",\u1e30:"K",\u01e8:"K",\u1e32:"K",\u0136:"K",\u1e34:"K",\u0198:"K",\u2c69:"K",\ua740:"K",\ua742:"K",\ua744:"K",\ua7a2:"K","\u24c1":"L",\uff2c:"L",\u013f:"L",\u0139:"L",\u013d:"L",\u1e36:"L",\u1e38:"L",\u013b:"L",\u1e3c:"L",\u1e3a:"L",\u0141:"L",\u023d:"L",\u2c62:"L",\u2c60:"L",\ua748:"L",\ua746:"L",\ua780:"L",\u01c7:"LJ",\u01c8:"Lj","\u24c2":"M",\uff2d:"M",\u1e3e:"M",\u1e40:"M",\u1e42:"M",\u2c6e:"M",\u019c:"M","\u24c3":"N",\uff2e:"N",\u01f8:"N",\u0143:"N",\u00d1:"N",\u1e44:"N",\u0147:"N",\u1e46:"N",\u0145:"N",\u1e4a:"N",\u1e48:"N",\u0220:"N",\u019d:"N",\ua790:"N",\ua7a4:"N",\u01ca:"NJ",\u01cb:"Nj","\u24c4":"O",\uff2f:"O",\u00d2:"O",\u00d3:"O",\u00d4:"O",\u1ed2:"O",\u1ed0:"O",\u1ed6:"O",\u1ed4:"O",\u00d5:"O",\u1e4c:"O",\u022c:"O",\u1e4e:"O",\u014c:"O",\u1e50:"O",\u1e52:"O",\u014e:"O",\u022e:"O",\u0230:"O",\u00d6:"O",\u022a:"O",\u1ece:"O",\u0150:"O",\u01d1:"O",\u020c:"O",\u020e:"O",\u01a0:"O",\u1edc:"O",\u1eda:"O",\u1ee0:"O",\u1ede:"O",\u1ee2:"O",\u1ecc:"O",\u1ed8:"O",\u01ea:"O",\u01ec:"O",\u00d8:"O",\u01fe:"O",\u0186:"O",\u019f:"O",\ua74a:"O",\ua74c:"O",\u01a2:"OI",\ua74e:"OO",\u0222:"OU","\u24c5":"P",\uff30:"P",\u1e54:"P",\u1e56:"P",\u01a4:"P",\u2c63:"P",\ua750:"P",\ua752:"P",\ua754:"P","\u24c6":"Q",\uff31:"Q",\ua756:"Q",\ua758:"Q",\u024a:"Q","\u24c7":"R",\uff32:"R",\u0154:"R",\u1e58:"R",\u0158:"R",\u0210:"R",\u0212:"R",\u1e5a:"R",\u1e5c:"R",\u0156:"R",\u1e5e:"R",\u024c:"R",\u2c64:"R",\ua75a:"R",\ua7a6:"R",\ua782:"R","\u24c8":"S",\uff33:"S",\u1e9e:"S",\u015a:"S",\u1e64:"S",\u015c:"S",\u1e60:"S",\u0160:"S",\u1e66:"S",\u1e62:"S",\u1e68:"S",\u0218:"S",\u015e:"S",\u2c7e:"S",\ua7a8:"S",\ua784:"S","\u24c9":"T",\uff34:"T",\u1e6a:"T",\u0164:"T",\u1e6c:"T",\u021a:"T",\u0162:"T",\u1e70:"T",\u1e6e:"T",\u0166:"T",\u01ac:"T",\u01ae:"T",\u023e:"T",\ua786:"T",\ua728:"TZ","\u24ca":"U",\uff35:"U",\u00d9:"U",\u00da:"U",\u00db:"U",\u0168:"U",\u1e78:"U",\u016a:"U",\u1e7a:"U",\u016c:"U",\u00dc:"U",\u01db:"U",\u01d7:"U",\u01d5:"U",\u01d9:"U",\u1ee6:"U",\u016e:"U",\u0170:"U",\u01d3:"U",\u0214:"U",\u0216:"U",\u01af:"U",\u1eea:"U",\u1ee8:"U",\u1eee:"U",\u1eec:"U",\u1ef0:"U",\u1ee4:"U",\u1e72:"U",\u0172:"U",\u1e76:"U",\u1e74:"U",\u0244:"U","\u24cb":"V",\uff36:"V",\u1e7c:"V",\u1e7e:"V",\u01b2:"V",\ua75e:"V",\u0245:"V",\ua760:"VY","\u24cc":"W",\uff37:"W",\u1e80:"W",\u1e82:"W",\u0174:"W",\u1e86:"W",\u1e84:"W",\u1e88:"W",\u2c72:"W","\u24cd":"X",\uff38:"X",\u1e8a:"X",\u1e8c:"X","\u24ce":"Y",\uff39:"Y",\u1ef2:"Y",\u00dd:"Y",\u0176:"Y",\u1ef8:"Y",\u0232:"Y",\u1e8e:"Y",\u0178:"Y",\u1ef6:"Y",\u1ef4:"Y",\u01b3:"Y",\u024e:"Y",\u1efe:"Y","\u24cf":"Z",\uff3a:"Z",\u0179:"Z",\u1e90:"Z",\u017b:"Z",\u017d:"Z",\u1e92:"Z",\u1e94:"Z",\u01b5:"Z",\u0224:"Z",\u2c7f:"Z",\u2c6b:"Z",\ua762:"Z","\u24d0":"a",\uff41:"a",\u1e9a:"a",\u00e0:"a",\u00e1:"a",\u00e2:"a",\u1ea7:"a",\u1ea5:"a",\u1eab:"a",\u1ea9:"a",\u00e3:"a",\u0101:"a",\u0103:"a",\u1eb1:"a",\u1eaf:"a",\u1eb5:"a",\u1eb3:"a",\u0227:"a",\u01e1:"a",\u00e4:"a",\u01df:"a",\u1ea3:"a",\u00e5:"a",\u01fb:"a",\u01ce:"a",\u0201:"a",\u0203:"a",\u1ea1:"a",\u1ead:"a",\u1eb7:"a",\u1e01:"a",\u0105:"a",\u2c65:"a",\u0250:"a",\ua733:"aa",\u00e6:"ae",\u01fd:"ae",\u01e3:"ae",\ua735:"ao",\ua737:"au",\ua739:"av",\ua73b:"av",\ua73d:"ay","\u24d1":"b",\uff42:"b",\u1e03:"b",\u1e05:"b",\u1e07:"b",\u0180:"b",\u0183:"b",\u0253:"b","\u24d2":"c",\uff43:"c",\u0107:"c",\u0109:"c",\u010b:"c",\u010d:"c",\u00e7:"c",\u1e09:"c",\u0188:"c",\u023c:"c",\ua73f:"c",\u2184:"c","\u24d3":"d",\uff44:"d",\u1e0b:"d",\u010f:"d",\u1e0d:"d",\u1e11:"d",\u1e13:"d",\u1e0f:"d",\u0111:"d",\u018c:"d",\u0256:"d",\u0257:"d",\ua77a:"d",\u01f3:"dz",\u01c6:"dz","\u24d4":"e",\uff45:"e",\u00e8:"e",\u00e9:"e",\u00ea:"e",\u1ec1:"e",\u1ebf:"e",\u1ec5:"e",\u1ec3:"e",\u1ebd:"e",\u0113:"e",\u1e15:"e",\u1e17:"e",\u0115:"e",\u0117:"e",\u00eb:"e",\u1ebb:"e",\u011b:"e",\u0205:"e",\u0207:"e",\u1eb9:"e",\u1ec7:"e",\u0229:"e",\u1e1d:"e",\u0119:"e",\u1e19:"e",\u1e1b:"e",\u0247:"e",\u025b:"e",\u01dd:"e","\u24d5":"f",\uff46:"f",\u1e1f:"f",\u0192:"f",\ua77c:"f","\u24d6":"g",\uff47:"g",\u01f5:"g",\u011d:"g",\u1e21:"g",\u011f:"g",\u0121:"g",\u01e7:"g",\u0123:"g",\u01e5:"g",\u0260:"g",\ua7a1:"g",\u1d79:"g",\ua77f:"g","\u24d7":"h",\uff48:"h",\u0125:"h",\u1e23:"h",\u1e27:"h",\u021f:"h",\u1e25:"h",\u1e29:"h",\u1e2b:"h",\u1e96:"h",\u0127:"h",\u2c68:"h",\u2c76:"h",\u0265:"h",\u0195:"hv","\u24d8":"i",\uff49:"i",\u00ec:"i",\u00ed:"i",\u00ee:"i",\u0129:"i",\u012b:"i",\u012d:"i",\u00ef:"i",\u1e2f:"i",\u1ec9:"i",\u01d0:"i",\u0209:"i",\u020b:"i",\u1ecb:"i",\u012f:"i",\u1e2d:"i",\u0268:"i",\u0131:"i","\u24d9":"j",\uff4a:"j",\u0135:"j",\u01f0:"j",\u0249:"j","\u24da":"k",\uff4b:"k",\u1e31:"k",\u01e9:"k",\u1e33:"k",\u0137:"k",\u1e35:"k",\u0199:"k",\u2c6a:"k",\ua741:"k",\ua743:"k",\ua745:"k",\ua7a3:"k","\u24db":"l",\uff4c:"l",\u0140:"l",\u013a:"l",\u013e:"l",\u1e37:"l",\u1e39:"l",\u013c:"l",\u1e3d:"l",\u1e3b:"l",\u017f:"l",\u0142:"l",\u019a:"l",\u026b:"l",\u2c61:"l",\ua749:"l",\ua781:"l",\ua747:"l",\u01c9:"lj","\u24dc":"m",\uff4d:"m",\u1e3f:"m",\u1e41:"m",\u1e43:"m",\u0271:"m",\u026f:"m","\u24dd":"n",\uff4e:"n",\u01f9:"n",\u0144:"n",\u00f1:"n",\u1e45:"n",\u0148:"n",\u1e47:"n",\u0146:"n",\u1e4b:"n",\u1e49:"n",\u019e:"n",\u0272:"n",\u0149:"n",\ua791:"n",\ua7a5:"n",\u01cc:"nj","\u24de":"o",\uff4f:"o",\u00f2:"o",\u00f3:"o",\u00f4:"o",\u1ed3:"o",\u1ed1:"o",\u1ed7:"o",\u1ed5:"o",\u00f5:"o",\u1e4d:"o",\u022d:"o",\u1e4f:"o",\u014d:"o",\u1e51:"o",\u1e53:"o",\u014f:"o",\u022f:"o",\u0231:"o",\u00f6:"o",\u022b:"o",\u1ecf:"o",\u0151:"o",\u01d2:"o",\u020d:"o",\u020f:"o",\u01a1:"o",\u1edd:"o",\u1edb:"o",\u1ee1:"o",\u1edf:"o",\u1ee3:"o",\u1ecd:"o",\u1ed9:"o",\u01eb:"o",\u01ed:"o",\u00f8:"o",\u01ff:"o",\u0254:"o",\ua74b:"o",\ua74d:"o",\u0275:"o",\u01a3:"oi",\u0223:"ou",\ua74f:"oo","\u24df":"p",\uff50:"p",\u1e55:"p",\u1e57:"p",\u01a5:"p",\u1d7d:"p",\ua751:"p",\ua753:"p",\ua755:"p","\u24e0":"q",\uff51:"q",\u024b:"q",\ua757:"q",\ua759:"q","\u24e1":"r",\uff52:"r",\u0155:"r",\u1e59:"r",\u0159:"r",\u0211:"r",\u0213:"r",\u1e5b:"r",\u1e5d:"r",\u0157:"r",\u1e5f:"r",\u024d:"r",\u027d:"r",\ua75b:"r",\ua7a7:"r",\ua783:"r","\u24e2":"s",\uff53:"s",\u00df:"s",\u015b:"s",\u1e65:"s",\u015d:"s",\u1e61:"s",\u0161:"s",\u1e67:"s",\u1e63:"s",\u1e69:"s",\u0219:"s",\u015f:"s",\u023f:"s",\ua7a9:"s",\ua785:"s",\u1e9b:"s","\u24e3":"t",\uff54:"t",\u1e6b:"t",\u1e97:"t",\u0165:"t",\u1e6d:"t",\u021b:"t",\u0163:"t",\u1e71:"t",\u1e6f:"t",\u0167:"t",\u01ad:"t",\u0288:"t",\u2c66:"t",\ua787:"t",\ua729:"tz","\u24e4":"u",\uff55:"u",\u00f9:"u",\u00fa:"u",\u00fb:"u",\u0169:"u",\u1e79:"u",\u016b:"u",\u1e7b:"u",\u016d:"u",\u00fc:"u",\u01dc:"u",\u01d8:"u",\u01d6:"u",\u01da:"u",\u1ee7:"u",\u016f:"u",\u0171:"u",\u01d4:"u",\u0215:"u",\u0217:"u",\u01b0:"u",\u1eeb:"u",\u1ee9:"u",\u1eef:"u",\u1eed:"u",\u1ef1:"u",\u1ee5:"u",\u1e73:"u",\u0173:"u",\u1e77:"u",\u1e75:"u",\u0289:"u","\u24e5":"v",\uff56:"v",\u1e7d:"v",\u1e7f:"v",\u028b:"v",\ua75f:"v",\u028c:"v",\ua761:"vy","\u24e6":"w",\uff57:"w",\u1e81:"w",\u1e83:"w",\u0175:"w",\u1e87:"w",\u1e85:"w",\u1e98:"w",\u1e89:"w",\u2c73:"w","\u24e7":"x",\uff58:"x",\u1e8b:"x",\u1e8d:"x","\u24e8":"y",\uff59:"y",\u1ef3:"y",\u00fd:"y",\u0177:"y",\u1ef9:"y",\u0233:"y",\u1e8f:"y",\u00ff:"y",\u1ef7:"y",\u1e99:"y",\u1ef5:"y",\u01b4:"y",\u024f:"y",\u1eff:"y","\u24e9":"z",\uff5a:"z",\u017a:"z",\u1e91:"z",\u017c:"z",\u017e:"z",\u1e93:"z",\u1e95:"z",\u01b6:"z",\u0225:"z",\u0240:"z",\u2c6c:"z",\ua763:"z",\u0386:"\u0391",\u0388:"\u0395",\u0389:"\u0397",\u038a:"\u0399",\u03aa:"\u0399",\u038c:"\u039f",\u038e:"\u03a5",\u03ab:"\u03a5",\u038f:"\u03a9",\u03ac:"\u03b1",\u03ad:"\u03b5",\u03ae:"\u03b7",\u03af:"\u03b9",\u03ca:"\u03b9",\u0390:"\u03b9",\u03cc:"\u03bf",\u03cd:"\u03c5",\u03cb:"\u03c5",\u03b0:"\u03c5",\u03c9:"\u03c9",\u03c2:"\u03c3"};function KI(e){return e.replace(/[^\u0000-\u007E]/g,t=>Iie[t]||t)}class kie{constructor(n,t){this._ngSelect=n,this._selectionModel=t,this._items=[],this._filteredItems=[],this._markedIndex=-1}get items(){return this._items}get filteredItems(){return this._filteredItems}get markedIndex(){return this._markedIndex}get selectedItems(){return this._selectionModel.value}get markedItem(){return this._filteredItems[this._markedIndex]}get noItemsToSelect(){return this._ngSelect.hideSelected&&this._items.length===this.selectedItems.length}get maxItemsSelected(){return this._ngSelect.multiple&&this._ngSelect.maxSelectedItems<=this.selectedItems.length}get lastSelectedItem(){let n=this.selectedItems.length-1;for(;n>=0;n--){const t=this.selectedItems[n];if(!t.disabled)return t}return null}setItems(n){this._items=n.map((t,r)=>this.mapItem(t,r)),this._ngSelect.groupBy?(this._groups=this._groupBy(this._items,this._ngSelect.groupBy),this._items=this._flatten(this._groups)):(this._groups=new Map,this._groups.set(void 0,this._items)),this._filteredItems=[...this._items]}select(n){if(n.selected||this.maxItemsSelected)return;const t=this._ngSelect.multiple;t||this.clearSelected(),this._selectionModel.select(n,t,this._ngSelect.selectableGroupAsModel),this._ngSelect.hideSelected&&this._hideSelected(n)}unselect(n){n.selected&&(this._selectionModel.unselect(n,this._ngSelect.multiple),this._ngSelect.hideSelected&&To(n.index)&&this._ngSelect.multiple&&this._showSelected(n))}findItem(n){let t;return t=this._ngSelect.compareWith?r=>this._ngSelect.compareWith(r.value,n):this._ngSelect.bindValue?r=>!r.children&&this.resolveNested(r.value,this._ngSelect.bindValue)===n:r=>r.value===n||!r.children&&r.label&&r.label===this.resolveNested(n,this._ngSelect.bindLabel),this._items.find(r=>t(r))}addItem(n){const t=this.mapItem(n,this._items.length);return this._items.push(t),this._filteredItems.push(t),t}clearSelected(n=!1){this._selectionModel.clear(n),this._items.forEach(t=>{t.selected=n&&t.selected&&t.disabled,t.marked=!1}),this._ngSelect.hideSelected&&this.resetFilteredItems()}findByLabel(n){return n=KI(n).toLocaleLowerCase(),this.filteredItems.find(t=>KI(t.label).toLocaleLowerCase().substr(0,n.length)===n)}filter(n){if(!n)return void this.resetFilteredItems();this._filteredItems=[],n=this._ngSelect.searchFn?n:KI(n).toLocaleLowerCase();const t=this._ngSelect.searchFn||this._defaultSearchFn,r=this._ngSelect.hideSelected;for(const s of Array.from(this._groups.keys())){const l=[];for(const h of this._groups.get(s))r&&(h.parent&&h.parent.selected||h.selected)||t(n,this._ngSelect.searchFn?h.value:h)&&l.push(h);if(l.length>0){const[h]=l.slice(-1);if(h.parent){const g=this._items.find(x=>x===h.parent);this._filteredItems.push(g)}this._filteredItems.push(...l)}}}resetFilteredItems(){this._filteredItems.length!==this._items.length&&(this._filteredItems=this._ngSelect.hideSelected&&this.selectedItems.length>0?this._items.filter(n=>!n.selected):this._items)}unmarkItem(){this._markedIndex=-1}markNextItem(){this._stepToItem(1)}markPreviousItem(){this._stepToItem(-1)}markItem(n){this._markedIndex=this._filteredItems.indexOf(n)}markSelectedOrDefault(n){if(0===this._filteredItems.length)return;const t=this._getLastMarkedIndex();this._markedIndex=t>-1?t:n?this.filteredItems.findIndex(r=>!r.disabled):-1}resolveNested(n,t){if(!IC(n))return n;if(-1===t.indexOf("."))return n[t];{const r=t.split(".");let s=n;for(let l=0,h=r.length;l<h;++l){if(null==s)return null;s=s[r[l]]}return s}}mapItem(n,t){const r=To(n.$ngOptionLabel)?n.$ngOptionLabel:this.resolveNested(n,this._ngSelect.bindLabel),s=To(n.$ngOptionValue)?n.$ngOptionValue:n;return{index:t,label:To(r)?r.toString():"",value:s,disabled:n.disabled,htmlId:`${this._ngSelect.dropdownId}-${t}`}}mapSelectedItems(){const n=this._ngSelect.multiple;for(const t of this.selectedItems){const r=this._ngSelect.bindValue?this.resolveNested(t.value,this._ngSelect.bindValue):t.value,s=To(r)?this.findItem(r):null;this._selectionModel.unselect(t,n),this._selectionModel.select(s||t,n,this._ngSelect.selectableGroupAsModel)}this._ngSelect.hideSelected&&(this._filteredItems=this.filteredItems.filter(t=>-1===this.selectedItems.indexOf(t)))}_showSelected(n){if(this._filteredItems.push(n),n.parent){const t=n.parent;this._filteredItems.find(s=>s===t)||this._filteredItems.push(t)}else if(n.children)for(const t of n.children)t.selected=!1,this._filteredItems.push(t);this._filteredItems=[...this._filteredItems.sort((t,r)=>t.index-r.index)]}_hideSelected(n){this._filteredItems=this._filteredItems.filter(t=>t!==n),n.parent?n.parent.children.every(r=>r.selected)&&(this._filteredItems=this._filteredItems.filter(r=>r!==n.parent)):n.children&&(this._filteredItems=this.filteredItems.filter(t=>t.parent!==n))}_defaultSearchFn(n,t){return KI(t.label).toLocaleLowerCase().indexOf(n)>-1}_getNextItemIndex(n){return n>0?this._markedIndex>=this._filteredItems.length-1?0:this._markedIndex+1:this._markedIndex<=0?this._filteredItems.length-1:this._markedIndex-1}_stepToItem(n){0===this._filteredItems.length||this._filteredItems.every(t=>t.disabled)||(this._markedIndex=this._getNextItemIndex(n),this.markedItem.disabled&&this._stepToItem(n))}_getLastMarkedIndex(){if(this._ngSelect.hideSelected||this._markedIndex>-1&&void 0===this.markedItem)return-1;const n=this._filteredItems.indexOf(this.lastSelectedItem);return this.lastSelectedItem&&n<0?-1:Math.max(this.markedIndex,n)}_groupBy(n,t){const r=new Map;if(0===n.length)return r;if(Array.isArray(n[0].value[t])){for(const h of n){const g=(h.value[t]||[]).map((x,E)=>this.mapItem(x,E));r.set(h,g)}return r}const s=YI(this._ngSelect.groupBy),l=h=>{const g=s?t(h.value):h.value[t];return To(g)?g:void 0};for(const h of n){const g=l(h),x=r.get(g);x?x.push(h):r.set(g,[h])}return r}_flatten(n){const t=YI(this._ngSelect.groupBy),r=[];for(const s of Array.from(n.keys())){let l=r.length;if(void 0===s){const O=n.get(void 0)||[];r.push(...O.map(N=>(N.index=l++,N)));continue}const h=IC(s),g={label:h?"":String(s),children:void 0,parent:null,index:l++,disabled:!this._ngSelect.selectableGroup,htmlId:eV()},x=t?this._ngSelect.bindLabel:this._ngSelect.groupBy,E=this._ngSelect.groupValue||(()=>h?s.value:{[x]:s}),D=n.get(s).map(O=>(O.parent=g,O.children=void 0,O.index=l++,O));g.children=D,g.value=E(s,D.map(O=>O.value)),r.push(g),r.push(...D)}return r}}var Xp=function(e){return e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Esc=27]="Esc",e[e.Space=32]="Space",e[e.ArrowUp=38]="ArrowUp",e[e.ArrowDown=40]="ArrowDown",e[e.Backspace=8]="Backspace",e}(Xp||{});let tV=(()=>{class e{constructor(){this._dimensions={itemHeight:0,panelHeight:0,itemsPerViewport:0}}get dimensions(){return this._dimensions}calculateItems(t,r,s){const l=this._dimensions,h=l.itemHeight*r,x=Math.max(0,t)/h*r;let E=Math.min(r,Math.ceil(x)+(l.itemsPerViewport+1));const O=Math.max(0,E-l.itemsPerViewport);let N=Math.min(O,Math.floor(x)),B=l.itemHeight*Math.ceil(N)-l.itemHeight*Math.min(N,s);return B=isNaN(B)?0:B,N=isNaN(N)?-1:N,E=isNaN(E)?-1:E,N-=s,N=Math.max(0,N),E+=s,E=Math.min(r,E),{topPadding:B,scrollHeight:h,start:N,end:E}}setDimensions(t,r){const s=Math.max(1,Math.floor(r/t));this._dimensions={itemHeight:t,panelHeight:r,itemsPerViewport:s}}getScrollTo(t,r,s){const{panelHeight:l}=this.dimensions,h=t+r,x=s+l;return l>=h&&s===t?null:h>x?s+h-x:t<=s?t:null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac})}return e})();const nV=["top","right","bottom","left"],Oie=typeof requestAnimationFrame<"u"?yre:Cre;let rV=(()=>{class e{constructor(t,r,s,l,h){this._renderer=t,this._zone=r,this._panelService=s,this._document=h,this.items=[],this.position="auto",this.virtualScroll=!1,this.filterValue=null,this.update=new ir,this.scroll=new ir,this.scrollToEnd=new ir,this.outsideClick=new ir,this._destroy$=new Ii,this._scrollToEndFired=!1,this._updateScrollHeight=!1,this._lastScrollPosition=0,this._dropdown=l.nativeElement}get currentPosition(){return this._currentPosition}get itemsLength(){return this._itemsLength}set itemsLength(t){t!==this._itemsLength&&(this._itemsLength=t,this._onItemsLengthChanged())}get _startOffset(){if(this.markedItem){const{itemHeight:t,panelHeight:r}=this._panelService.dimensions,s=this.markedItem.index*t;return r>s?0:s}return 0}ngOnInit(){this._select=this._dropdown.parentElement,this._virtualPadding=this.paddingElementRef.nativeElement,this._scrollablePanel=this.scrollElementRef.nativeElement,this._contentPanel=this.contentElementRef.nativeElement,this._handleScroll(),this._handleOutsideClick(),this._appendDropdown(),this._setupMousedownListener()}ngOnChanges(t){if(t.items){const r=t.items;this._onItemsChange(r.currentValue,r.firstChange)}}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete(),this._destroy$.unsubscribe(),this.appendTo&&this._renderer.removeChild(this._dropdown.parentNode,this._dropdown)}scrollTo(t,r=!1){if(!t)return;const s=this.items.indexOf(t);if(s<0||s>=this.itemsLength)return;let l;if(this.virtualScroll){const h=this._panelService.dimensions.itemHeight;l=this._panelService.getScrollTo(s*h,h,this._lastScrollPosition)}else{const h=this._dropdown.querySelector(`#${t.htmlId}`);l=this._panelService.getScrollTo(h.offsetTop,h.clientHeight,r?h.offsetTop:this._lastScrollPosition)}To(l)&&(this._scrollablePanel.scrollTop=l)}scrollToTag(){const t=this._scrollablePanel;t.scrollTop=t.scrollHeight-t.clientHeight}adjustPosition(){this._updateYPosition()}_handleDropdownPosition(){this._currentPosition=this._calculateCurrentPosition(this._dropdown),nV.includes(this._currentPosition)?this._updateDropdownClass(this._currentPosition):this._updateDropdownClass("bottom"),this.appendTo&&this._updateYPosition(),this._dropdown.style.opacity="1"}_updateDropdownClass(t){nV.forEach(s=>{const l=`ng-select-${s}`;this._renderer.removeClass(this._dropdown,l),this._renderer.removeClass(this._select,l)});const r=`ng-select-${t}`;this._renderer.addClass(this._dropdown,r),this._renderer.addClass(this._select,r)}_handleScroll(){this._zone.runOutsideAngular(()=>{ta(this.scrollElementRef.nativeElement,"scroll").pipe(wo(this._destroy$),function pre(e,n=WI){return function dre(e){return ys((n,t)=>{let r=!1,s=null,l=null,h=!1;const g=()=>{if(l?.unsubscribe(),l=null,r){r=!1;const E=s;s=null,t.next(E)}h&&t.complete()},x=()=>{l=null,h&&t.complete()};n.subscribe(Me(t,E=>{r=!0,s=E,l||pl(e(E)).subscribe(l=Me(t,g,x))},()=>{h=!0,(!r||!l||l.closed)&&t.complete()}))})}(()=>aF(e,n))}(0,Oie)).subscribe(t=>{const r=t.path||t.composedPath&&t.composedPath();r&&(0!==r.length||t.target)&&this._onContentScrolled(r&&0!==r.length?r[0].scrollTop:t.target.scrollTop)})})}_handleOutsideClick(){this._document&&this._zone.runOutsideAngular(()=>{XI(ta(this._document,"touchstart",{capture:!0}),ta(this._document,"click",{capture:!0})).pipe(wo(this._destroy$)).subscribe(t=>this._checkToClose(t))})}_checkToClose(t){if(this._select.contains(t.target)||this._dropdown.contains(t.target))return;const r=t.path||t.composedPath&&t.composedPath();t.target&&t.target.shadowRoot&&r&&r[0]&&this._select.contains(r[0])||this._zone.run(()=>this.outsideClick.emit())}_onItemsChange(t,r){this.items=t||[],this._scrollToEndFired=!1,this.itemsLength=t.length,this.virtualScroll?this._updateItemsRange(r):(this._setVirtualHeight(),this._updateItems(r))}_updateItems(t){this.update.emit(this.items),!1!==t&&this._zone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._panelService.setDimensions(0,this._scrollablePanel.clientHeight),this._handleDropdownPosition(),this.scrollTo(this.markedItem,t)})})}_updateItemsRange(t){this._zone.runOutsideAngular(()=>{this._measureDimensions().then(()=>{t?(this._renderItemsRange(this._startOffset),this._handleDropdownPosition()):this._renderItemsRange()})})}_onContentScrolled(t){this.virtualScroll&&this._renderItemsRange(t),this._lastScrollPosition=t,this._fireScrollToEnd(t)}_updateVirtualHeight(t){this._updateScrollHeight&&(this._virtualPadding.style.height=`${t}px`,this._updateScrollHeight=!1)}_setVirtualHeight(){this._virtualPadding&&(this._virtualPadding.style.height="0px")}_onItemsLengthChanged(){this._updateScrollHeight=!0}_renderItemsRange(t=null){if(t&&this._lastScrollPosition===t)return;const r=this._panelService.calculateItems(t=t||this._scrollablePanel.scrollTop,this.itemsLength,this.bufferAmount);this._updateVirtualHeight(r.scrollHeight),this._contentPanel.style.transform=`translateY(${r.topPadding}px)`,this._zone.run(()=>{this.update.emit(this.items.slice(r.start,r.end)),this.scroll.emit({start:r.start,end:r.end})}),To(t)&&0===this._lastScrollPosition&&(this._scrollablePanel.scrollTop=t,this._lastScrollPosition=t)}_measureDimensions(){if(this._panelService.dimensions.itemHeight>0||0===this.itemsLength)return Promise.resolve(this._panelService.dimensions);const[t]=this.items;return this.update.emit([t]),Promise.resolve().then(()=>{const s=this._dropdown.querySelector(`#${t.htmlId}`).clientHeight;return this._virtualPadding.style.height=s*this.itemsLength+"px",this._panelService.setDimensions(s,this._scrollablePanel.clientHeight),this._panelService.dimensions})}_fireScrollToEnd(t){this._scrollToEndFired||0===t||t+this._dropdown.clientHeight>=(this.virtualScroll?this._virtualPadding:this._contentPanel).clientHeight-1&&(this._zone.run(()=>this.scrollToEnd.emit()),this._scrollToEndFired=!0)}_calculateCurrentPosition(t){if("auto"!==this.position)return this.position;const r=this._select.getBoundingClientRect(),s=document.documentElement.scrollTop||document.body.scrollTop;return r.top+window.pageYOffset+r.height+t.getBoundingClientRect().height>s+document.documentElement.clientHeight?"top":"bottom"}_appendDropdown(){if(this.appendTo){if(this._parent=document.querySelector(this.appendTo),!this._parent)throw new Error(`appendTo selector ${this.appendTo} did not found any parent element`);this._updateXPosition(),this._parent.appendChild(this._dropdown)}}_updateXPosition(){const t=this._select.getBoundingClientRect(),r=this._parent.getBoundingClientRect();this._dropdown.style.left=t.left-r.left+"px",this._dropdown.style.width=t.width+"px",this._dropdown.style.minWidth=t.width+"px"}_updateYPosition(){const t=this._select.getBoundingClientRect(),r=this._parent.getBoundingClientRect(),s=t.height;"top"===this._currentPosition?(this._dropdown.style.bottom=r.bottom-t.bottom+s+"px",this._dropdown.style.top="auto"):"bottom"===this._currentPosition&&(this._dropdown.style.top=t.top-r.top+s+"px",this._dropdown.style.bottom="auto")}_setupMousedownListener(){this._zone.runOutsideAngular(()=>{ta(this._dropdown,"mousedown").pipe(wo(this._destroy$)).subscribe(t=>{"INPUT"!==t.target.tagName&&t.preventDefault()})})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(qh),xt(Qr),xt(tV),xt(Di),xt(bo,8))};static#t=this.\u0275cmp=ki({type:e,selectors:[["ng-dropdown-panel"]],viewQuery:function(r,s){if(1&r&&(Gu(Ore,7,Di),Gu(Rre,7,Di),Gu(Pre,7,Di)),2&r){let l;di(l=fi())&&(s.contentElementRef=l.first),di(l=fi())&&(s.scrollElementRef=l.first),di(l=fi())&&(s.paddingElementRef=l.first)}},inputs:{items:"items",markedItem:"markedItem",position:"position",appendTo:"appendTo",bufferAmount:"bufferAmount",virtualScroll:[2,"virtualScroll","virtualScroll",so],headerTemplate:"headerTemplate",footerTemplate:"footerTemplate",filterValue:"filterValue"},outputs:{update:"update",scroll:"scroll",scrollToEnd:"scrollToEnd",outsideClick:"outsideClick"},features:[E2,to],ngContentSelectors:JU,decls:9,vars:6,consts:[["scroll",""],["padding",""],["content",""],[1,"ng-dropdown-header"],["role","listbox",1,"ng-dropdown-panel-items","scroll-host"],[1,"ng-dropdown-footer"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(r,s){1&r&&(xA(),Cn(0,Nre,2,4,"div",3),ee(1,"div",4,0),Xn(3,"div",null,1),ee(5,"div",null,2),bA(7),te()(),Cn(8,Fre,2,4,"div",5)),2&r&&(Ds(s.headerTemplate?0:-1),Te(3),Ki("total-padding",s.virtualScroll),Te(2),Ki("scrollable-content",s.virtualScroll&&s.items.length),Te(3),Ds(s.footerTemplate?8:-1))},dependencies:[By],encapsulation:2,changeDetection:0})}return e})(),Rie=(()=>{class e{constructor(t){this.elementRef=t,this.disabled=!1,this.stateChange$=new Ii}get label(){return(this.elementRef.nativeElement.textContent||"").trim()}ngOnChanges(t){t.disabled&&this.stateChange$.next({value:this.value,disabled:this.disabled})}ngAfterViewChecked(){this.label!==this._previousLabel&&(this._previousLabel=this.label,this.stateChange$.next({value:this.value,disabled:this.disabled,label:this.elementRef.nativeElement.innerHTML}))}ngOnDestroy(){this.stateChange$.complete()}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Di))};static#t=this.\u0275cmp=ki({type:e,selectors:[["ng-option"]],inputs:{value:"value",disabled:[2,"disabled","disabled",so]},features:[E2,to],ngContentSelectors:JU,decls:1,vars:0,template:function(r,s){1&r&&(xA(),bA(0))},encapsulation:2,changeDetection:0})}return e})(),Pie=(()=>{class e{constructor(){this.notFoundText="No items found",this.typeToSearchText="Type to search",this.addTagText="Add item",this.loadingText="Loading...",this.clearAllText="Clear all",this.disableVirtualScroll=!0,this.openOnEnter=!0,this.appearance="underline"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Nie=(()=>{class e{warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const iV=new Gt("ng-select-selection-model");let Fie=(()=>{class e{get items(){return this._items}set items(t){this._itemsAreUsed=!0,this._items=t??[]}get compareWith(){return this._compareWith}set compareWith(t){if(null!=t&&!YI(t))throw Error("`compareWith` must be a function.");this._compareWith=t}get clearSearchOnAdd(){return To(this._clearSearchOnAdd)?this._clearSearchOnAdd:To(this.config.clearSearchOnAdd)?this.config.clearSearchOnAdd:this.closeOnSelect}set clearSearchOnAdd(t){this._clearSearchOnAdd=t}get deselectOnClick(){return To(this._deselectOnClick)?this._deselectOnClick:To(this.config.deselectOnClick)?this.config.deselectOnClick:this.multiple}set deselectOnClick(t){this._deselectOnClick=t}get disabled(){return this.readonly||this._disabled}get filtered(){return!!this.searchTerm&&this.searchable||this._isComposing}get single(){return!this.multiple}get _editableSearchTerm(){return this.editableSearchTerm&&!this.multiple}constructor(t,r,s,l,h,g,x){this.classes=t,this.autoFocus=r,this.config=s,this._cd=g,this._console=x,this.markFirst=!0,this.dropdownPosition="auto",this.loading=!1,this.closeOnSelect=!0,this.hideSelected=!1,this.selectOnTab=!1,this.bufferAmount=4,this.selectableGroup=!1,this.selectableGroupAsModel=!0,this.searchFn=null,this.trackByFn=null,this.clearOnBackspace=!0,this.labelForId=null,this.inputAttrs={},this.readonly=!1,this.searchWhileComposing=!0,this.minTermLength=0,this.editableSearchTerm=!1,this.keyDownFn=E=>!0,this.multiple=!1,this.addTag=!1,this.searchable=!0,this.clearable=!0,this.isOpen=!1,this.blurEvent=new ir,this.focusEvent=new ir,this.changeEvent=new ir,this.openEvent=new ir,this.closeEvent=new ir,this.searchEvent=new ir,this.clearEvent=new ir,this.addEvent=new ir,this.removeEvent=new ir,this.scroll=new ir,this.scrollToEnd=new ir,this.useDefaultClass=!0,this.viewPortItems=[],this.searchTerm=null,this.dropdownId=eV(),this.escapeHTML=!0,this._items=[],this._defaultLabel="label",this._pressedKeys=[],this._isComposing=!1,this._destroy$=new Ii,this._keyPress$=new Ii,this._onChange=E=>{},this._onTouched=()=>{},this.clearItem=E=>{const D=this.selectedItems.find(O=>O.value===E);this.unselect(D)},this.trackByOption=(E,D)=>this.trackByFn?this.trackByFn(D.value):D,this._mergeGlobalConfig(s),this.itemsList=new kie(this,l()),this.element=h.nativeElement}get selectedItems(){return this.itemsList.selectedItems}get selectedValues(){return this.selectedItems.map(t=>t.value)}get hasValue(){return this.selectedItems.length>0}get currentPanelPosition(){if(this.dropdownPanel)return this.dropdownPanel.currentPosition}ngOnInit(){this._handleKeyPresses(),this._setInputAttributes()}ngOnChanges(t){t.multiple&&this.itemsList.clearSelected(),t.items&&this._setItems(t.items.currentValue||[]),t.isOpen&&(this._manualOpen=To(t.isOpen.currentValue))}ngAfterViewInit(){this._itemsAreUsed||(this.escapeHTML=!1,this._setItemsFromNgOptions()),To(this.autoFocus)&&this.focus()}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}handleKeyDown(t){if(Xp[t.which]){if(!1===this.keyDownFn(t))return;this.handleKeyCode(t)}else t.key&&1===t.key.length&&this._keyPress$.next(t.key.toLocaleLowerCase())}handleKeyCode(t){this.clearButton&&this.clearButton.nativeElement===t.target?this.handleKeyCodeClear(t):this.handleKeyCodeInput(t)}handleKeyCodeInput(t){switch(t.which){case Xp.ArrowDown:this._handleArrowDown(t);break;case Xp.ArrowUp:this._handleArrowUp(t);break;case Xp.Space:this._handleSpace(t);break;case Xp.Enter:this._handleEnter(t);break;case Xp.Tab:this._handleTab(t);break;case Xp.Esc:this.close(),t.preventDefault();break;case Xp.Backspace:this._handleBackspace()}}handleKeyCodeClear(t){t.which===Xp.Enter&&(this.handleClearClick(),t.preventDefault())}handleMousedown(t){const r=t.target;"INPUT"!==r.tagName&&t.preventDefault(),r.classList.contains("ng-clear-wrapper")?this.handleClearClick():r.classList.contains("ng-arrow-wrapper")?this.handleArrowClick():r.classList.contains("ng-value-icon")||(this.focused||this.focus(),this.searchable?this.open():this.toggle())}handleArrowClick(){this.isOpen?this.close():this.open()}handleClearClick(){this.hasValue&&(this.itemsList.clearSelected(!0),this._updateNgModel()),this._clearSearch(),this.focus(),this.clearEvent.emit(),this._onSelectionChanged()}clearModel(){this.clearable&&(this.itemsList.clearSelected(),this._updateNgModel())}writeValue(t){this.itemsList.clearSelected(),this._handleWriteValue(t),this._cd.markForCheck()}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this._disabled=t,this._cd.markForCheck()}toggle(){this.isOpen?this.close():this.open()}open(){this.disabled||this.isOpen||this._manualOpen||!this._isTypeahead&&!this.addTag&&this.itemsList.noItemsToSelect||(this.isOpen=!0,this.itemsList.markSelectedOrDefault(this.markFirst),this.openEvent.emit(),this.searchTerm||this.focus(),this.detectChanges())}close(){!this.isOpen||this._manualOpen||(this.isOpen=!1,this._isComposing=!1,this._editableSearchTerm?this.itemsList.resetFilteredItems():this._clearSearch(),this.itemsList.unmarkItem(),this._onTouched(),this.closeEvent.emit(),this._cd.markForCheck())}toggleItem(t){!t||t.disabled||this.disabled||(this.deselectOnClick&&t.selected?this.unselect(t):this.select(t),this._editableSearchTerm&&this._setSearchTermFromItems(),this._onSelectionChanged())}select(t){t.selected||(this.itemsList.select(t),this.clearSearchOnAdd&&!this._editableSearchTerm&&this._clearSearch(),this._updateNgModel(),this.multiple&&this.addEvent.emit(t.value)),(this.closeOnSelect||this.itemsList.noItemsToSelect)&&this.close()}focus(){this.searchInput.nativeElement.focus()}blur(){this.searchInput.nativeElement.blur()}unselect(t){t&&(this.itemsList.unselect(t),this.focus(),this._updateNgModel(),this.removeEvent.emit(t.value))}selectTag(){let t;t=YI(this.addTag)?this.addTag(this.searchTerm):this._primitive?this.searchTerm:{[this.bindLabel]:this.searchTerm};const r=s=>this._isTypeahead||!this.isOpen?this.itemsList.mapItem(s,null):this.itemsList.addItem(s);!function _ie(e){return e instanceof Promise}(t)?t&&this.select(r(t)):t.then(s=>this.select(r(s))).catch(()=>{})}showClear(){return this.clearable&&(this.hasValue||this.searchTerm)&&!this.disabled}focusOnClear(){this.blur(),this.clearButton&&this.clearButton.nativeElement.focus()}get showAddTag(){if(!this._validTerm)return!1;const t=this.searchTerm.toLowerCase().trim();return this.addTag&&!this.itemsList.filteredItems.some(r=>r.label.toLowerCase()===t)&&(!this.hideSelected&&this.isOpen||!this.selectedItems.some(r=>r.label.toLowerCase()===t))&&!this.loading}showNoItemsFound(){const t=0===this.itemsList.filteredItems.length;return(t&&!this._isTypeahead&&!this.loading||t&&this._isTypeahead&&this._validTerm&&!this.loading)&&!this.showAddTag}showTypeToSearch(){return 0===this.itemsList.filteredItems.length&&this._isTypeahead&&!this._validTerm&&!this.loading}onCompositionStart(){this._isComposing=!0}onCompositionEnd(t){this._isComposing=!1,!this.searchWhileComposing&&this.filter(t)}filter(t){this._isComposing&&!this.searchWhileComposing||(this.searchTerm=t,this._isTypeahead&&(this._validTerm||0===this.minTermLength)&&this.typeahead.next(t),this._isTypeahead||(this.itemsList.filter(this.searchTerm),this.isOpen&&this.itemsList.markSelectedOrDefault(this.markFirst)),this.searchEvent.emit({term:t,items:this.itemsList.filteredItems.map(r=>r.value)}),this.open())}onInputFocus(t){this.focused||(this._editableSearchTerm&&this._setSearchTermFromItems(),this.element.classList.add("ng-select-focused"),this.focusEvent.emit(t),this.focused=!0)}onInputBlur(t){this.element.classList.remove("ng-select-focused"),this.blurEvent.emit(t),!this.isOpen&&!this.disabled&&this._onTouched(),this._editableSearchTerm&&this._setSearchTermFromItems(),this.focused=!1}onItemHover(t){t.disabled||this.itemsList.markItem(t)}detectChanges(){this._cd.destroyed||this._cd.detectChanges()}_setSearchTermFromItems(){const t=this.selectedItems&&this.selectedItems[0];this.searchTerm=t&&t.label||null}_setItems(t){const r=t[0];this.bindLabel=this.bindLabel||this._defaultLabel,this._primitive=To(r)?!IC(r):this._primitive||this.bindLabel===this._defaultLabel,this.itemsList.setItems(t),t.length>0&&this.hasValue&&this.itemsList.mapSelectedItems(),this.isOpen&&To(this.searchTerm)&&!this._isTypeahead&&this.itemsList.filter(this.searchTerm),(this._isTypeahead||this.isOpen)&&this.itemsList.markSelectedOrDefault(this.markFirst)}_setItemsFromNgOptions(){const t=s=>{this.items=s.map(l=>({$ngOptionValue:l.value,$ngOptionLabel:l.elementRef.nativeElement.innerHTML,disabled:l.disabled})),this.itemsList.setItems(this.items),this.hasValue&&this.itemsList.mapSelectedItems(),this.detectChanges()},r=()=>{const s=XI(this.ngOptions.changes,this._destroy$);XI(...this.ngOptions.map(l=>l.stateChange$)).pipe(wo(s)).subscribe(l=>{const h=this.itemsList.findItem(l.value);h.disabled=l.disabled,h.label=l.label||h.label,this._cd.detectChanges()})};this.ngOptions.changes.pipe(uN(this.ngOptions),wo(this._destroy$)).subscribe(s=>{this.bindLabel=this._defaultLabel,t(s),r()})}_isValidWriteValue(t){if(!To(t)||this.multiple&&""===t||Array.isArray(t)&&0===t.length)return!1;const r=s=>!(!To(this.compareWith)&&IC(s)&&this.bindValue&&(this._console.warn(`Setting object(${JSON.stringify(s)}) as your model with bindValue is not allowed unless [compareWith] is used.`),1));return this.multiple?Array.isArray(t)?t.every(s=>r(s)):(this._console.warn("Multiple select ngModel should be array."),!1):r(t)}_handleWriteValue(t){if(!this._isValidWriteValue(t))return;const r=s=>{let l=this.itemsList.findItem(s);if(l)this.itemsList.select(l);else{const h=IC(s);h||!h&&!this.bindValue?this.itemsList.select(this.itemsList.mapItem(s,null)):this.bindValue&&(l={[this.bindLabel]:null,[this.bindValue]:s},this.itemsList.select(this.itemsList.mapItem(l,null)))}};this.multiple?t.forEach(s=>r(s)):r(t)}_handleKeyPresses(){this.searchable||this._keyPress$.pipe(wo(this._destroy$),gl(t=>this._pressedKeys.push(t)),function mre(e,n=WI){return ys((t,r)=>{let s=null,l=null,h=null;const g=()=>{if(s){s.unsubscribe(),s=null;const E=l;l=null,r.next(E)}};function x(){const E=h+e,D=n.now();if(D<E)return s=this.schedule(void 0,E-D),void r.add(s);g()}t.subscribe(Me(r,E=>{l=E,h=n.now(),s||(s=n.schedule(x,e),r.add(s))},()=>{g(),r.complete()},void 0,()=>{l=s=null}))})}(200),xa(()=>this._pressedKeys.length>0),J(()=>this._pressedKeys.join(""))).subscribe(t=>{const r=this.itemsList.findByLabel(t);r&&(this.isOpen?(this.itemsList.markItem(r),this._scrollToMarked(),this._cd.markForCheck()):this.select(r)),this._pressedKeys=[]})}_setInputAttributes(){const t=this.searchInput.nativeElement,r={type:"text",autocorrect:"off",autocapitalize:"off",autocomplete:this.labelForId?"off":this.dropdownId,...this.inputAttrs};for(const s of Object.keys(r))t.setAttribute(s,r[s])}_updateNgModel(){const t=[];for(const s of this.selectedItems)if(this.bindValue){let l=null;l=s.children?s.value[(this.groupValue?this.bindValue:this.groupBy)||this.groupBy]:this.itemsList.resolveNested(s.value,this.bindValue),t.push(l)}else t.push(s.value);const r=this.selectedItems.map(s=>s.value);this.multiple?(this._onChange(t),this.changeEvent.emit(r)):(this._onChange(To(t[0])?t[0]:null),this.changeEvent.emit(r[0])),this._cd.markForCheck()}_clearSearch(){this.searchTerm&&(this._changeSearch(null),this.itemsList.resetFilteredItems())}_changeSearch(t){this.searchTerm=t,this._isTypeahead&&this.typeahead.next(t)}_scrollToMarked(){!this.isOpen||!this.dropdownPanel||this.dropdownPanel.scrollTo(this.itemsList.markedItem)}_scrollToTag(){!this.isOpen||!this.dropdownPanel||this.dropdownPanel.scrollToTag()}_onSelectionChanged(){this.isOpen&&this.deselectOnClick&&this.appendTo&&(this._cd.detectChanges(),this.dropdownPanel.adjustPosition())}_handleTab(t){if(!1===this.isOpen)if(this.showClear()&&!t.shiftKey)this.focusOnClear(),t.preventDefault();else if(!this.addTag)return;this.selectOnTab?this.itemsList.markedItem?(this.toggleItem(this.itemsList.markedItem),t.preventDefault()):this.showAddTag?(this.selectTag(),t.preventDefault()):this.close():this.close()}_handleEnter(t){if(this.isOpen||this._manualOpen)this.itemsList.markedItem?this.toggleItem(this.itemsList.markedItem):this.showAddTag&&this.selectTag();else{if(!this.openOnEnter)return;this.open()}t.preventDefault()}_handleSpace(t){this.isOpen||this._manualOpen||(this.open(),t.preventDefault())}_handleArrowDown(t){this._nextItemIsTag(1)?(this.itemsList.unmarkItem(),this._scrollToTag()):(this.itemsList.markNextItem(),this._scrollToMarked()),this.open(),t.preventDefault()}_handleArrowUp(t){this.isOpen&&(this._nextItemIsTag(-1)?(this.itemsList.unmarkItem(),this._scrollToTag()):(this.itemsList.markPreviousItem(),this._scrollToMarked()),t.preventDefault())}_nextItemIsTag(t){const r=this.itemsList.markedIndex+t;return this.addTag&&this.searchTerm&&this.itemsList.markedItem&&(r<0||r===this.itemsList.filteredItems.length)}_handleBackspace(){this.searchTerm||!this.clearable||!this.clearOnBackspace||!this.hasValue||(this.multiple?this.unselect(this.itemsList.lastSelectedItem):this.clearModel())}get _isTypeahead(){return this.typeahead&&this.typeahead.observers.length>0}get _validTerm(){const t=this.searchTerm&&this.searchTerm.trim();return t&&t.length>=this.minTermLength}_mergeGlobalConfig(t){this.placeholder=this.placeholder||t.placeholder,this.notFoundText=this.notFoundText||t.notFoundText,this.typeToSearchText=this.typeToSearchText||t.typeToSearchText,this.addTagText=this.addTagText||t.addTagText,this.loadingText=this.loadingText||t.loadingText,this.clearAllText=this.clearAllText||t.clearAllText,this.virtualScroll=To(this.virtualScroll)?this.virtualScroll:!!To(t.disableVirtualScroll)&&!t.disableVirtualScroll,this.openOnEnter=To(this.openOnEnter)?this.openOnEnter:t.openOnEnter,this.appendTo=this.appendTo||t.appendTo,this.bindValue=this.bindValue||t.bindValue,this.bindLabel=this.bindLabel||t.bindLabel,this.appearance=this.appearance||t.appearance}static#e=this.\u0275fac=function(r){return new(r||e)(jl("class"),jl("autofocus"),xt(Pie),xt(iV),xt(Di),xt(ed),xt(Nie))};static#t=this.\u0275cmp=ki({type:e,selectors:[["ng-select"]],contentQueries:function(r,s,l){if(1&r&&(fs(l,vie,5,si),fs(l,xie,5,si),fs(l,bie,5,si),fs(l,wie,5,si),fs(l,Tie,5,si),fs(l,Eie,5,si),fs(l,Cie,5,si),fs(l,Sie,5,si),fs(l,Die,5,si),fs(l,Mie,5,si),fs(l,Aie,5,si),fs(l,Rie,5)),2&r){let h;di(h=fi())&&(s.optionTemplate=h.first),di(h=fi())&&(s.optgroupTemplate=h.first),di(h=fi())&&(s.labelTemplate=h.first),di(h=fi())&&(s.multiLabelTemplate=h.first),di(h=fi())&&(s.headerTemplate=h.first),di(h=fi())&&(s.footerTemplate=h.first),di(h=fi())&&(s.notFoundTemplate=h.first),di(h=fi())&&(s.typeToSearchTemplate=h.first),di(h=fi())&&(s.loadingTextTemplate=h.first),di(h=fi())&&(s.tagTemplate=h.first),di(h=fi())&&(s.loadingSpinnerTemplate=h.first),di(h=fi())&&(s.ngOptions=h)}},viewQuery:function(r,s){if(1&r&&(Gu(rV,5),Gu(Lre,7),Gu(Bre,5)),2&r){let l;di(l=fi())&&(s.dropdownPanel=l.first),di(l=fi())&&(s.searchInput=l.first),di(l=fi())&&(s.clearButton=l.first)}},hostVars:20,hostBindings:function(r,s){1&r&&on("keydown",function(h){return s.handleKeyDown(h)}),2&r&&Ki("ng-select-typeahead",s.typeahead)("ng-select-multiple",s.multiple)("ng-select-taggable",s.addTag)("ng-select-searchable",s.searchable)("ng-select-clearable",s.clearable)("ng-select-opened",s.isOpen)("ng-select",s.useDefaultClass)("ng-select-disabled",s.disabled)("ng-select-filtered",s.filtered)("ng-select-single",s.single)},inputs:{bindLabel:"bindLabel",bindValue:"bindValue",markFirst:[2,"markFirst","markFirst",so],placeholder:"placeholder",notFoundText:"notFoundText",typeToSearchText:"typeToSearchText",addTagText:"addTagText",loadingText:"loadingText",clearAllText:"clearAllText",appearance:"appearance",dropdownPosition:"dropdownPosition",appendTo:"appendTo",loading:[2,"loading","loading",so],closeOnSelect:[2,"closeOnSelect","closeOnSelect",so],hideSelected:[2,"hideSelected","hideSelected",so],selectOnTab:[2,"selectOnTab","selectOnTab",so],openOnEnter:[2,"openOnEnter","openOnEnter",so],maxSelectedItems:[2,"maxSelectedItems","maxSelectedItems",jA],groupBy:"groupBy",groupValue:"groupValue",bufferAmount:[2,"bufferAmount","bufferAmount",jA],virtualScroll:[2,"virtualScroll","virtualScroll",so],selectableGroup:[2,"selectableGroup","selectableGroup",so],selectableGroupAsModel:[2,"selectableGroupAsModel","selectableGroupAsModel",so],searchFn:"searchFn",trackByFn:"trackByFn",clearOnBackspace:[2,"clearOnBackspace","clearOnBackspace",so],labelForId:"labelForId",inputAttrs:"inputAttrs",tabIndex:[2,"tabIndex","tabIndex",jA],readonly:[2,"readonly","readonly",so],searchWhileComposing:[2,"searchWhileComposing","searchWhileComposing",so],minTermLength:[2,"minTermLength","minTermLength",jA],editableSearchTerm:[2,"editableSearchTerm","editableSearchTerm",so],keyDownFn:"keyDownFn",typeahead:"typeahead",multiple:[2,"multiple","multiple",so],addTag:"addTag",searchable:[2,"searchable","searchable",so],clearable:[2,"clearable","clearable",so],isOpen:[2,"isOpen","isOpen",so],items:"items",compareWith:"compareWith",clearSearchOnAdd:"clearSearchOnAdd",deselectOnClick:"deselectOnClick"},outputs:{blurEvent:"blur",focusEvent:"focus",changeEvent:"change",openEvent:"open",closeEvent:"close",searchEvent:"search",clearEvent:"clear",addEvent:"add",removeEvent:"remove",scroll:"scroll",scrollToEnd:"scrollToEnd"},features:[Fs([{provide:Xu,useExisting:zi(()=>e),multi:!0},tV]),E2,to],decls:14,vars:19,consts:[["searchInput",""],["defaultLabelTemplate",""],["defaultLoadingSpinnerTemplate",""],["clearButton",""],["defaultOptionTemplate",""],["defaultTagTemplate",""],["defaultNotFoundTemplate",""],["defaultTypeToSearchTemplate",""],["defaultLoadingTextTemplate",""],[1,"ng-select-container",3,"mousedown"],[1,"ng-value-container"],[1,"ng-placeholder"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["role","combobox","aria-haspopup","listbox",1,"ng-input"],["aria-autocomplete","list",3,"input","compositionstart","compositionend","focus","blur","change","readOnly","disabled","value"],["tabindex","0",1,"ng-clear-wrapper",3,"title"],[1,"ng-arrow-wrapper"],[1,"ng-arrow"],["role","listbox","aria-label","Options list",1,"ng-dropdown-panel",3,"virtualScroll","bufferAmount","appendTo","position","headerTemplate","footerTemplate","filterValue","items","markedItem","ng-select-multiple","ngClass","id"],[1,"ng-value",3,"ng-value-disabled"],[1,"ng-value"],["aria-hidden","true",1,"ng-value-icon","left",3,"click"],[1,"ng-value-label",3,"ngItemLabel","escape"],[3,"ngTemplateOutlet"],[1,"ng-spinner-loader"],["aria-hidden","true",1,"ng-clear"],["role","listbox","aria-label","Options list",1,"ng-dropdown-panel",3,"update","scroll","scrollToEnd","outsideClick","virtualScroll","bufferAmount","appendTo","position","headerTemplate","footerTemplate","filterValue","items","markedItem","ngClass","id"],[1,"ng-option",3,"ng-option-disabled","ng-option-selected","ng-optgroup","ng-option","ng-option-child","ng-option-marked"],["role","option",1,"ng-option",3,"ng-option-marked"],[1,"ng-option",3,"click","mouseover"],[1,"ng-option-label",3,"ngItemLabel","escape"],["role","option",1,"ng-option",3,"mouseover","click"],[1,"ng-tag-label"],[1,"ng-option","ng-option-disabled"]],template:function(r,s){if(1&r){const l=Wi();ee(0,"div",9),on("mousedown",function(g){return Mn(l),An(s.handleMousedown(g))}),ee(1,"div",10)(2,"div",11),xe(3),te(),Cn(4,Gre,2,0)(5,qre,1,5,null,12),ee(6,"div",13)(7,"input",14,0),on("input",function(){Mn(l);const g=Wa(8);return An(s.filter(g.value))})("compositionstart",function(){return Mn(l),An(s.onCompositionStart())})("compositionend",function(){Mn(l);const g=Wa(8);return An(s.onCompositionEnd(g.value))})("focus",function(g){return Mn(l),An(s.onInputFocus(g))})("blur",function(g){return Mn(l),An(s.onInputBlur(g))})("change",function(g){return Mn(l),An(g.stopPropagation())}),te()()(),Cn(9,Yre,3,1)(10,Kre,4,1,"span",15),ee(11,"span",16),Xn(12,"span",17),te()(),Cn(13,fie,8,17,"ng-dropdown-panel",18)}2&r&&(Ki("ng-appearance-outline","outline"===s.appearance)("ng-has-value",s.hasValue),Te(3),kn(s.placeholder),Te(),Ds(s.multiLabelTemplate&&s.multiple||!(s.selectedItems.length>0)?-1:4),Te(),Ds(s.multiple&&s.multiLabelTemplate&&s.selectedValues.length>0?5:-1),Te(),ds("aria-expanded",s.isOpen)("aria-owns",s.isOpen?s.dropdownId:null),Te(),Zt("readOnly",!s.searchable||s.itemsList.maxItemsSelected)("disabled",s.disabled)("value",s.searchTerm?s.searchTerm:""),ds("id",s.labelForId)("tabindex",s.tabIndex)("aria-activedescendant",s.isOpen?null==s.itemsList||null==s.itemsList.markedItem?null:s.itemsList.markedItem.htmlId:null)("aria-controls",s.isOpen?s.dropdownId:null),Te(2),Ds(s.loading?9:-1),Te(),Ds(s.showClear()?10:-1),Te(3),Ds(s.isOpen?13:-1))},dependencies:[K2,By,rV,yie],styles:['@charset "UTF-8";.ng-select{position:relative;display:block;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.ng-select div,.ng-select input,.ng-select span{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.ng-select [hidden]{display:none}.ng-select.ng-select-searchable .ng-select-container .ng-value-container .ng-input{opacity:1}.ng-select.ng-select-opened .ng-select-container{z-index:1001}.ng-select.ng-select-disabled .ng-select-container .ng-value-container .ng-placeholder,.ng-select.ng-select-disabled .ng-select-container .ng-value-container .ng-value{-webkit-user-select:none;user-select:none;cursor:default}.ng-select.ng-select-disabled .ng-arrow-wrapper{cursor:default}.ng-select.ng-select-filtered .ng-placeholder{display:none}.ng-select .ng-select-container{cursor:default;display:flex;outline:none;overflow:hidden;position:relative;width:100%}.ng-select .ng-select-container .ng-value-container{display:flex;flex:1}.ng-select .ng-select-container .ng-value-container .ng-input{opacity:0}.ng-select .ng-select-container .ng-value-container .ng-input>input{box-sizing:content-box;background:none transparent;border:0 none;box-shadow:none;outline:none;padding:0;cursor:default;width:100%}.ng-select .ng-select-container .ng-value-container .ng-input>input::-ms-clear{display:none}.ng-select .ng-select-container .ng-value-container .ng-input>input[readonly]{-webkit-user-select:none;user-select:none;width:0;padding:0}.ng-select.ng-select-single.ng-select-filtered .ng-select-container .ng-value-container .ng-value{visibility:hidden}.ng-select.ng-select-single .ng-select-container .ng-value-container,.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-value{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-value .ng-value-icon{display:none}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-input{position:absolute;left:0;width:100%}.ng-select.ng-select-multiple.ng-select-disabled>.ng-select-container .ng-value-container .ng-value .ng-value-icon{display:none}.ng-select.ng-select-multiple .ng-select-container .ng-value-container{flex-wrap:wrap}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{position:absolute}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{white-space:nowrap}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value.ng-value-disabled .ng-value-icon{display:none}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value .ng-value-icon{cursor:pointer}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-input{flex:1;z-index:2}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{z-index:1}.ng-select .ng-clear-wrapper{cursor:pointer;position:relative;width:17px;-webkit-user-select:none;user-select:none}.ng-select .ng-clear-wrapper .ng-clear{display:inline-block;font-size:18px;line-height:1;pointer-events:none}.ng-select .ng-spinner-loader{border-radius:50%;width:17px;height:17px;margin-right:5px;font-size:10px;position:relative;text-indent:-9999em;border-top:2px solid rgba(66,66,66,.2);border-right:2px solid rgba(66,66,66,.2);border-bottom:2px solid rgba(66,66,66,.2);border-left:2px solid #424242;transform:translateZ(0);animation:load8 .8s infinite linear}.ng-select .ng-spinner-loader:after{border-radius:50%;width:17px;height:17px}@-webkit-keyframes load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.ng-select .ng-arrow-wrapper{cursor:pointer;position:relative;text-align:center;-webkit-user-select:none;user-select:none}.ng-select .ng-arrow-wrapper .ng-arrow{pointer-events:none;display:inline-block;height:0;width:0;position:relative}.ng-dropdown-panel{box-sizing:border-box;position:absolute;opacity:0;width:100%;z-index:1050;-webkit-overflow-scrolling:touch}.ng-dropdown-panel .ng-dropdown-panel-items{display:block;height:auto;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;max-height:240px;overflow-y:auto}.ng-dropdown-panel .ng-dropdown-panel-items .ng-optgroup{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option{box-sizing:border-box;cursor:pointer;display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option .ng-option-label:empty:before{content:"\\200b"}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option .highlighted{font-weight:700;text-decoration:underline}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option.disabled{cursor:default}.ng-dropdown-panel .scroll-host{overflow:hidden;overflow-y:auto;position:relative;display:block;-webkit-overflow-scrolling:touch}.ng-dropdown-panel .scrollable-content{top:0;left:0;width:100%;height:100%;position:absolute}.ng-dropdown-panel .total-padding{width:1px;opacity:0}\n'],encapsulation:2,changeDetection:0})}return e})();function Lie(){return new Bie}class Bie{constructor(){this._selected=[]}get value(){return this._selected}select(n,t,r){if(n.selected=!0,(!n.children||!t&&r)&&this._selected.push(n),t)if(n.parent){const s=n.parent.children.length,l=n.parent.children.filter(h=>h.selected).length;n.parent.selected=s===l}else n.children&&(this._setChildrenSelectedState(n.children,!0),this._removeChildren(n),this._selected=r&&this._activeChildren(n)?[...this._selected.filter(s=>s.parent!==n),n]:[...this._selected,...n.children.filter(s=>!s.disabled)])}unselect(n,t){if(this._selected=this._selected.filter(r=>r!==n),n.selected=!1,t)if(n.parent&&n.parent.selected){const r=n.parent.children;this._removeParent(n.parent),this._removeChildren(n.parent),this._selected.push(...r.filter(s=>s!==n&&!s.disabled)),n.parent.selected=!1}else n.children&&(this._setChildrenSelectedState(n.children,!1),this._removeChildren(n))}clear(n){this._selected=n?this._selected.filter(t=>t.disabled):[]}_setChildrenSelectedState(n,t){for(const r of n)r.disabled||(r.selected=t)}_removeChildren(n){this._selected=[...this._selected.filter(t=>t.parent!==n),...n.children.filter(t=>t.parent===n&&t.disabled&&t.selected)]}_removeParent(n){this._selected=this._selected.filter(t=>t!==n)}_activeChildren(n){return n.children.every(t=>!t.disabled||t.selected)}}let zie=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({providers:[{provide:iV,useValue:Lie}],imports:[Tz]})}return e})();function Uie(e,n){1&e&&Xn(0,"br")}function Vie(e,n){if(1&e&&(ee(0,"div",62),xe(1),te()),2&e){const t=Bt();Te(),dl(" ",t.successMessage," ")}}function jie(e,n){if(1&e&&(ee(0,"div",66),xe(1),Xn(2,"button",67),te()),2&e){const t=Bt(2);Te(),dl(" ",t.messageAlegra," ")}}function $ie(e,n){if(1&e&&(ee(0,"div",68),xe(1),Xn(2,"button",67),te()),2&e){const t=Bt(2);Te(),dl(" ",t.messageAlegra," ")}}function Hie(e,n){if(1&e&&(ee(0,"div",63),Cn(1,jie,3,1,"div",64)(2,$ie,3,1,"div",65),te()),2&e){const t=Bt();Te(),Zt("ngIf","201"==t.statusCodeAlegra),Te(),Zt("ngIf","201"!=t.statusCodeAlegra)}}function Gie(e,n){if(1&e&&(ee(0,"span"),xe(1),te()),2&e){const t=Bt();Te(),kn(t.sortDirection)}}function Wie(e,n){if(1&e&&(ee(0,"span"),xe(1),te()),2&e){const t=Bt();Te(),kn(t.sortDirection)}}function qie(e,n){if(1&e&&(ee(0,"span"),xe(1),te()),2&e){const t=Bt();Te(),kn(t.sortDirection)}}function Zie(e,n){if(1&e&&(ee(0,"span"),xe(1),te()),2&e){const t=Bt();Te(),kn(t.sortDirection)}}function Xie(e,n){if(1&e&&(ee(0,"span"),xe(1),te()),2&e){const t=Bt();Te(),kn(t.sortDirection)}}function Yie(e,n){if(1&e&&(ee(0,"span"),xe(1),te()),2&e){const t=Bt();Te(),kn(t.sortDirection)}}function Kie(e,n){if(1&e&&(ee(0,"span"),xe(1),te()),2&e){const t=Bt();Te(),kn(t.sortDirection)}}function Jie(e,n){if(1&e){const t=Wi();ee(0,"div",2)(1,"span",74),on("click",function(){Mn(t);const s=Bt().$implicit;return An(Bt().get_invoice(s.id))}),Xn(2,"i",75),te()()}}function Qie(e,n){if(1&e){const t=Wi();ee(0,"div",2)(1,"span",76),on("click",function(){Mn(t);const s=Bt().$implicit;return An(Bt().sync_allegra(s.order_number))}),Xn(2,"img",77),te()()}}function ese(e,n){if(1&e){const t=Wi();ee(0,"div",2)(1,"span",76),on("click",function(){Mn(t);const s=Bt().$implicit;return An(Bt().delete_order(s.id))}),Xn(2,"i",78),te()()}}function tse(e,n){if(1&e){const t=Wi();ee(0,"tr")(1,"td"),xe(2),te(),ee(3,"td"),xe(4),te(),ee(5,"td"),xe(6),te(),ee(7,"td"),xe(8),te(),ee(9,"td"),xe(10),te(),ee(11,"td"),xe(12),SA(13,"date"),te(),ee(14,"td"),xe(15),SA(16,"currency"),te(),ee(17,"td"),xe(18),te(),ee(19,"td")(20,"div",20)(21,"div",2)(22,"span",69),on("click",function(){const s=Mn(t).$implicit;return An(Bt().openEditModal(s,"update"))}),Xn(23,"i",70),te()(),ee(24,"div",2)(25,"span",71),on("click",function(){const s=Mn(t).$implicit;return An(Bt().openPdfModal(s.id))}),Xn(26,"i",72),te()(),Cn(27,Jie,3,0,"div",73)(28,Qie,3,0,"div",73)(29,ese,3,0,"div",73),te()()()}if(2&e){const t=n.$implicit;Te(2),kn(t.order_number),Te(2),kn(t.customer_email),Te(2),kn(t.customer_phone),Te(2),kn(t.customer_documentNumber),Te(2),kn(t.customer_name),Te(2),kn(JR(13,11,t.delivery_date,"yyyy-MM-dd")),Te(3),kn(function LB(e,n,t){const r=e+bt,s=jt(),l=$d(s,r);return z2(s,r)?OB(s,Ko(),n,l.transform,t,l):l.transform(t)}(16,14,t.total)),Te(3),kn(t.status),Te(9),Zt("ngIf","Facturada"===t.status),Te(),Zt("ngIf","Facturada"!==t.status&&"Cancelada"!==t.status),Te(),Zt("ngIf","Creada"===t.status)}}function nse(e,n){if(1&e&&(ee(0,"option",79),xe(1),te()),2&e){const t=n.$implicit;Zt("value",t),Te(),kn(t)}}function rse(e,n){if(1&e&&(ee(0,"option",79),xe(1),te()),2&e){const t=n.$implicit;Zt("value",t),Te(),kn(t)}}function ise(e,n){if(1&e&&(ee(0,"option",79),xe(1),te()),2&e){const t=n.$implicit;Zt("value",t),Te(),kn(t)}}function sse(e,n){if(1&e&&(ee(0,"option",79),xe(1),te()),2&e){const t=n.$implicit;Zt("value",t),Te(),kn(t)}}function ose(e,n){if(1&e){const t=Wi();ee(0,"tr")(1,"ng-select",80),Tn("ngModelChange",function(s){const l=Mn(t).$implicit;return En(l.id,s)||(l.id=s),An(s)}),on("change",function(){const s=Mn(t).$implicit;return An(Bt().onProductSelect(s))}),te(),ee(2,"td")(3,"input",81),Tn("ngModelChange",function(s){const l=Mn(t).$implicit;return En(l.sku,s)||(l.sku=s),An(s)}),te()(),ee(4,"td")(5,"input",82),Tn("ngModelChange",function(s){const l=Mn(t).$implicit;return En(l.price_sale,s)||(l.price_sale=s),An(s)}),te()(),ee(6,"td")(7,"input",82),Tn("ngModelChange",function(s){const l=Mn(t).$implicit;return En(l.quantity,s)||(l.quantity=s),An(s)}),te()(),ee(8,"td")(9,"input",83),Tn("ngModelChange",function(s){const l=Mn(t).$implicit;return En(l.iva,s)||(l.iva=s),An(s)}),te()(),ee(10,"td")(11,"input",82),Tn("ngModelChange",function(s){const l=Mn(t).$implicit;return En(l.iva_value,s)||(l.iva_value=s),An(s)}),te()(),ee(12,"td")(13,"button",84),on("click",function(){const s=Mn(t).$implicit;return An(Bt().removeProduct(s))}),Xn(14,"i",85),te()()()}if(2&e){const t=n.$implicit,r=Bt();Te(),wA("placeholder",t.name),Zt("items",r.products)("searchable",!0),wn("ngModel",t.id),Te(2),wn("ngModel",t.sku),Te(2),wn("ngModel",t.price_sale),Te(2),wn("ngModel",t.quantity),Te(2),wn("ngModel",t.iva),Te(2),wn("ngModel",t.iva_value)}}let ase=(()=>{class e{constructor(t,r,s,l,h,g,x){this.orderService=t,this.router=r,this.productService=s,this.clienteService=l,this.sanitizer=h,this.alegraService=g,this.datePipe=x,this.searchText="",this.order={},this.product={},this.customers=[],this.actionType="",this.successMessage="",this.failedMessage="",this.documentTypes=[],this.paymentMethods=[],this.deliverySlots=[],this.orderStatus=["Creada","Confirmada","Despachada","Entregada","Facturada","Archivada"],this.products=[],this.selectedsku="",this.messageAlegra="",this.statusCodeAlegra="",this.sortColumn="",this.sortDirection="asc"}ngOnInit(){this.checkIfLoggedIn()?(this.getOrders(),this.orderService.getConfig().subscribe(r=>{this.documentTypes=r.document_type,this.paymentMethods=r.payments_method,this.deliverySlots=r.delivery_slots}),this.obtenerProductos(),this.getCustomers()):this.router.navigate(["/login"])}checkIfLoggedIn(){return!!localStorage.getItem("token")}getOrders(){this.orders=[],this.orderService.getOrders(this.datePipe.transform(this.searchDate,"yyyy-MM-dd")||"all").subscribe(t=>{this.orders=t,this.filteredOrders=t,this.filterOrders()})}filterOrders(){this.filteredOrders=""!==this.searchText.trim()?this.orders?.filter(t=>["order_number","customer_email","customer_phone","customer_documentNumber","customer_name","delivery_date","status"].some(r=>t[r]?.toLowerCase().includes(this.searchText.toLowerCase()))):this.orders}openEditModal(t,r){this.order=t,this.actionType=r}updated_order(){const t=new Date,r=t.getFullYear(),s=t.getMonth()+1,l=t.getDate(),h=t.getHours(),g=t.getMinutes(),x=t.getSeconds(),E=`${r}-${s.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")} ${h.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`;this.order.total=parseFloat(this.order.total),this.order.updated_at=E,this.orderService.updateOrder(this.order.id,this.order).subscribe(D=>{}),this.getOrders()}created_order(){const t=new Date,r=t.getFullYear(),s=t.getMonth()+1,l=t.getDate(),h=t.getHours(),g=t.getMinutes(),x=t.getSeconds(),E=`${r}-${s.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")} ${h.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`;this.order.created_at=E,this.order.updated_at=E,this.order.total=parseFloat(this.order.total),this.orderService.createOrder(this.order).subscribe(D=>{}),this.getOrders()}saveOrder(){"update"===this.actionType?(this.updated_order(),this.getOrders()):"new"===this.actionType&&(this.created_order(),this.getOrders())}camposCompletos(){const{order_number:t,customer_email:r,customer_phone:s,customer_documentNumber:l,customer_documentType:h,customer_name:g,delivery_date:x,status:E}=this.order;return!!(t&&r&&s&&l&&h&&g&&x&&E)}removeProduct(t){const r=this.order.products.indexOf(t);-1!==r&&this.order.products.splice(r,1)}addProduct(){this.order.products||(this.order.products=[]),this.order.products.push({sku:"",name:"",price_sale:0,quantity:1,iva:!1,iva_value:0})}obtenerProductos(){this.productService.getProducts().subscribe(t=>{this.products=t})}openPdfModal(t){this.pdfData=this.sanitizer.bypassSecurityTrustResourceUrl("https://app.buyfrescapp.com:5000/api/order/generate_pdf/"+t)}getCustomers(){this.clienteService.getClientes().subscribe(t=>{this.customers=t})}filteredCustomers(){return this.searchText?this.customers.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())):this.customers}onCustomerSelect(){const t=this.customers.find(r=>r.id===this.selectedCustomerId);t&&(this.order.customer_name=t.name,this.order.customer_email=t.email,this.order.customer_phone=t.phone,this.order.customer_documentNumber=t.document,this.order.customer_documentType=t.document_type,this.order.deliveryAddress=t.address)}onProductSelect(t){const r=this.products.find(s=>s.id===t.id);r&&(t.name=r.name,t.sku=r.sku,t.price_sale=r.price_sale,t.iva=r.iva,t.iva_value=r.iva_value)}sync_allegra(t){this.alegraService.send_invoice(t).subscribe(r=>{"201"==r.status?(this.statusCodeAlegra="201",this.messageAlegra=r.message||"Factura creada exitosamente."):this.messageAlegra=r.error?.message||"Ocurri\xf3 un error",this.getOrders()},r=>{this.statusCodeAlegra=r.status.toString(),this.messageAlegra=r.error?.message||"Ocurri\xf3 un error",this.getOrders()})}get_invoice(t){this.alegraService.get_invoice("215").subscribe(r=>{console.log(r.text)})}delete_order(t){this.orderService.deleteOrder(t).subscribe(r=>{this.getOrders()})}sort(t){console.log(t),this.filteredOrders&&0!==this.filteredOrders.length&&(this.sortColumn===t?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),this.filteredOrders.sort((r,s)=>{const l=r[this.sortColumn],h=s[this.sortColumn];return null==l?"asc"===this.sortDirection?1:-1:null==h||l<h?"asc"===this.sortDirection?-1:1:l>h?"asc"===this.sortDirection?1:-1:0}))}static#e=this.\u0275fac=function(r){return new(r||e)(xt(ZU),xt(ba),xt(FN),xt(iF),xt(nC),xt(cre),xt(J2))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-orders"]],decls:181,vars:36,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"col-5"],["type","text","placeholder","Buscar orden...",1,"form-control",3,"ngModelChange","keyup","ngModel"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["class","position-fixed top-0 end-0 p-3","style","z-index: 11",4,"ngIf"],[1,"table"],[3,"click"],[4,"ngFor","ngForOf"],["id","editOrderModal","tabindex","-1","role","dialog",1,"modal","fade","bd-example-modal-lg"],["role","document",1,"modal-dialog","modal-dialog-centered",2,"max-width","80%"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"container-fluid"],[1,"row"],[1,"col-6"],[1,"form-group"],["for","documentType"],["bindLabel","name","bindValue","id","placeholder","Escribe para buscar...",3,"ngModelChange","change","items","searchable","ngModel"],["for","order_number"],["type","text","id","order_number","name","order_number",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_email"],["type","email","id","customer_email","name","customer_email",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_phone"],["type","text","id","customer_phone","name","customer_phone",1,"form-control",3,"ngModelChange","ngModel"],["for","customer_documentNumber"],["type","text","id","customer_documentNumber","name","customer_documentNumber",1,"form-control",3,"ngModelChange","ngModel"],["id","documentType","name","documentType",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","customer_name"],["type","text","id","customer_name","name","customer_name",1,"form-control",3,"ngModelChange","ngModel"],["for","delivery_date"],["type","date","id","delivery_date","name","delivery_date",1,"form-control",3,"ngModelChange","ngModel"],["for","status"],["id","status","name","status",1,"form-control",3,"ngModelChange","ngModel"],["for","total"],["type","number","id","total","name","total",1,"form-control",3,"ngModelChange","ngModel"],["for","deliverySlot"],["id","deliverySlot","name","deliverySlot",1,"form-control",3,"ngModelChange","ngModel"],["for","paymentMethod"],["id","paymentMethod","name","paymentMethod",1,"form-control",3,"ngModelChange","ngModel"],["for","deliveryAddress"],["type","text","id","deliveryAddress","name","deliveryAddress",1,"form-control",3,"ngModelChange","ngModel"],["for","deliveryAddressDetails"],["type","text","id","deliveryAddressDetails","name","deliveryAddressDetails",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12"],[1,"col-4"],["type","button",1,"btn","btn-primary",3,"click"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["id","pdfModal","tabindex","-1","role","dialog","aria-labelledby","pdfModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-lg"],["id","pdfModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["type","application/pdf","width","100%","height","600px",3,"src"],["id","facturaModal","tabindex","-1","role","dialog","aria-labelledby","facturaLabel","aria-hidden","true",1,"modal","fade"],["role","alert",1,"alert","alert-success"],[1,"position-fixed","top-0","end-0","p-3",2,"z-index","11"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],["data-bs-toggle","modal","data-bs-target","#editOrderModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-pencil-alt","fa-lg","text-primary"],["data-bs-toggle","modal","data-bs-target","#pdfModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-danger"],["class","col-auto",4,"ngIf"],["data-bs-toggle","modal","data-bs-target","#facturaModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-primary"],[2,"cursor","pointer",3,"click"],["src","assets/alegra.png","alt","icono",2,"width","24px","height","24px"],[1,"fas","fa-trash","fa-lg","text-danger"],[3,"value"],["bindLabel","name","bindValue","id",3,"ngModelChange","change","items","searchable","placeholder","ngModel"],["type","text",1,"form-control",3,"ngModelChange","ngModel"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],["type","checkbox",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fas","fa-trash"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),on("click",function(){return s.openEditModal({},"new")}),xe(4,"Nueva Orden"),te()(),ee(5,"div",4)(6,"input",5),Tn("ngModelChange",function(h){return En(s.searchText,h)||(s.searchText=h),h}),on("keyup",function(){return s.filterOrders()}),te()(),ee(7,"div",2)(8,"input",6),Tn("ngModelChange",function(h){return En(s.searchDate,h)||(s.searchDate=h),h}),on("change",function(){return s.getOrders()}),te()()(),Cn(9,Uie,1,0,"br",7)(10,Vie,2,1,"div",8)(11,Hie,3,2,"div",9),Xn(12,"br"),ee(13,"table",10)(14,"thead")(15,"tr")(16,"th",11),on("click",function(){return s.sort("order_number")}),xe(17,"N\xfamero de Orden "),Cn(18,Gie,2,1,"span",7),te(),ee(19,"th",11),on("click",function(){return s.sort("customer_email")}),xe(20,"Email del Cliente "),Cn(21,Wie,2,1,"span",7),te(),ee(22,"th",11),on("click",function(){return s.sort("customer_phone")}),xe(23,"Tel\xe9fono del Cliente "),Cn(24,qie,2,1,"span",7),te(),ee(25,"th",11),on("click",function(){return s.sort("customer_documentNumber")}),xe(26,"Documento del Cliente "),Cn(27,Zie,2,1,"span",7),te(),ee(28,"th",11),on("click",function(){return s.sort("customer_name")}),xe(29,"Nombre del Cliente "),Cn(30,Xie,2,1,"span",7),te(),ee(31,"th",11),on("click",function(){return s.sort("delivery_date")}),xe(32,"Fecha de Entrega "),Cn(33,Yie,2,1,"span",7),te(),ee(34,"th"),xe(35,"total"),te(),ee(36,"th",11),on("click",function(){return s.sort("status")}),xe(37,"Estado "),Cn(38,Kie,2,1,"span",7),te(),ee(39,"th"),xe(40,"Acciones"),te()()(),ee(41,"tbody"),Cn(42,tse,30,16,"tr",12),te()()(),ee(43,"div",13)(44,"div",14)(45,"div",15)(46,"div",16)(47,"h5",17),xe(48,"Editar Orden"),te()(),ee(49,"div",18)(50,"div",19)(51,"div",20)(52,"div",21)(53,"div",22)(54,"label",23),xe(55,"Cliente:"),te(),ee(56,"ng-select",24),Tn("ngModelChange",function(h){return En(s.selectedCustomerId,h)||(s.selectedCustomerId=h),h}),on("change",function(){return s.onCustomerSelect()}),te()()(),ee(57,"div",21)(58,"div",22)(59,"label",25),xe(60,"N\xfamero de Orden:"),te(),ee(61,"input",26),Tn("ngModelChange",function(h){return En(s.order.order_number,h)||(s.order.order_number=h),h}),te()()(),ee(62,"div",21)(63,"div",22)(64,"label",27),xe(65,"Email del Cliente:"),te(),ee(66,"input",28),Tn("ngModelChange",function(h){return En(s.order.customer_email,h)||(s.order.customer_email=h),h}),te()()()(),ee(67,"div",20)(68,"div",21)(69,"div",22)(70,"label",29),xe(71,"Tel\xe9fono del Cliente:"),te(),ee(72,"input",30),Tn("ngModelChange",function(h){return En(s.order.customer_phone,h)||(s.order.customer_phone=h),h}),te()()(),ee(73,"div",21)(74,"div",22)(75,"label",31),xe(76,"N\xfamero de Documento del Cliente:"),te(),ee(77,"input",32),Tn("ngModelChange",function(h){return En(s.order.customer_documentNumber,h)||(s.order.customer_documentNumber=h),h}),te()()()(),ee(78,"div",20)(79,"div",21)(80,"div",22)(81,"label",23),xe(82,"Tipo de Documento:"),te(),ee(83,"select",33),Tn("ngModelChange",function(h){return En(s.order.customer_documentType,h)||(s.order.customer_documentType=h),h}),Cn(84,nse,2,2,"option",34),te()()(),ee(85,"div",21)(86,"div",22)(87,"label",35),xe(88,"Nombre del Cliente:"),te(),ee(89,"input",36),Tn("ngModelChange",function(h){return En(s.order.customer_name,h)||(s.order.customer_name=h),h}),te()()()(),ee(90,"div",20)(91,"div",21)(92,"div",22)(93,"label",37),xe(94,"Fecha de Entrega:"),te(),ee(95,"input",38),Tn("ngModelChange",function(h){return En(s.order.delivery_date,h)||(s.order.delivery_date=h),h}),te()()(),ee(96,"div",21)(97,"div",22)(98,"label",39),xe(99,"Estado:"),te(),ee(100,"select",40),Tn("ngModelChange",function(h){return En(s.order.status,h)||(s.order.status=h),h}),Cn(101,rse,2,2,"option",34),te()()()(),ee(102,"div",20)(103,"div",21)(104,"div",22)(105,"label",41),xe(106,"Total:"),te(),ee(107,"input",42),Tn("ngModelChange",function(h){return En(s.order.total,h)||(s.order.total=h),h}),te()()(),ee(108,"div",21)(109,"div",22)(110,"label",43),xe(111,"Horario de Entrega:"),te(),ee(112,"select",44),Tn("ngModelChange",function(h){return En(s.order.deliverySlot,h)||(s.order.deliverySlot=h),h}),Cn(113,ise,2,2,"option",34),te()()()(),ee(114,"div",22)(115,"label",45),xe(116,"M\xe9todo de Pago:"),te(),ee(117,"select",46),Tn("ngModelChange",function(h){return En(s.order.paymentMethod,h)||(s.order.paymentMethod=h),h}),Cn(118,sse,2,2,"option",34),te()(),ee(119,"div",22)(120,"label",47),xe(121,"Direcci\xf3n de Entrega:"),te(),ee(122,"input",48),Tn("ngModelChange",function(h){return En(s.order.deliveryAddress,h)||(s.order.deliveryAddress=h),h}),te()(),ee(123,"div",22)(124,"label",49),xe(125,"Detalles de la Direcci\xf3n de Entrega:"),te(),ee(126,"input",50),Tn("ngModelChange",function(h){return En(s.order.deliveryAddressDetails,h)||(s.order.deliveryAddressDetails=h),h}),te()(),Xn(127,"br")(128,"br"),ee(129,"div",20)(130,"div",51)(131,"table",10)(132,"thead")(133,"tr")(134,"th",52),xe(135,"Producto"),te(),ee(136,"th"),xe(137,"sku"),te(),ee(138,"th"),xe(139,"Precio Venta"),te(),ee(140,"th"),xe(141,"Cantidad"),te(),ee(142,"th"),xe(143,"IVA"),te(),ee(144,"th"),xe(145,"Valor IVA"),te(),ee(146,"th"),xe(147,"Acciones"),te()()(),ee(148,"tbody"),Cn(149,ose,15,9,"tr",12),te()(),ee(150,"button",53),on("click",function(){return s.addProduct()}),xe(151,"Agregar Producto"),te()()()()(),ee(152,"div",54)(153,"button",55),xe(154,"Cerrar"),te(),ee(155,"button",53),on("click",function(){return s.saveOrder()}),xe(156,"Guardar Cambios"),te()()()()(),ee(157,"div",56)(158,"div",57)(159,"div",15)(160,"div",16)(161,"h5",58),xe(162,"Remisi\xf3n"),te(),Xn(163,"button",59),te(),ee(164,"div",18),Xn(165,"iframe",60),te(),ee(166,"div",54)(167,"button",55),xe(168,"Cerrar"),te()()()()(),ee(169,"div",61)(170,"div",57)(171,"div",15)(172,"div",16)(173,"h5",58),xe(174,"Factura"),te(),Xn(175,"button",59),te(),ee(176,"div",18),Xn(177,"iframe",60),te(),ee(178,"div",54)(179,"button",55),xe(180,"Cerrar"),te()()()()()),2&r&&(Te(6),wn("ngModel",s.searchText),Te(2),wn("ngModel",s.searchDate),Te(),Zt("ngIf",s.successMessage),Te(),Zt("ngIf",s.successMessage),Te(),Zt("ngIf",s.statusCodeAlegra),Te(7),Zt("ngIf","order_number"===s.sortColumn),Te(3),Zt("ngIf","customer_email"===s.sortColumn),Te(3),Zt("ngIf","customer_phone"===s.sortColumn),Te(3),Zt("ngIf","customer_documentNumber"===s.sortColumn),Te(3),Zt("ngIf","customer_name"===s.sortColumn),Te(3),Zt("ngIf","delivery_date"===s.sortColumn),Te(5),Zt("ngIf","status"===s.sortColumn),Te(4),Zt("ngForOf",s.filteredOrders),Te(14),Zt("items",s.customers)("searchable",!0),wn("ngModel",s.selectedCustomerId),Te(5),wn("ngModel",s.order.order_number),Te(5),wn("ngModel",s.order.customer_email),Te(6),wn("ngModel",s.order.customer_phone),Te(5),wn("ngModel",s.order.customer_documentNumber),Te(6),wn("ngModel",s.order.customer_documentType),Te(),Zt("ngForOf",s.documentTypes),Te(5),wn("ngModel",s.order.customer_name),Te(6),wn("ngModel",s.order.delivery_date),Te(5),wn("ngModel",s.order.status),Te(),Zt("ngForOf",s.orderStatus),Te(6),wn("ngModel",s.order.total),Te(5),wn("ngModel",s.order.deliverySlot),Te(),Zt("ngForOf",s.deliverySlots),Te(4),wn("ngModel",s.order.paymentMethod),Te(),Zt("ngForOf",s.paymentMethods),Te(4),wn("ngModel",s.order.deliveryAddress),Te(4),wn("ngModel",s.order.deliveryAddressDetails),Te(23),Zt("ngForOf",s.order.products),Te(16),Zt("src",s.pdfData,Kd),Te(12),Zt("src",s.facturaData,Kd))},dependencies:[$p,uu,Xy,Yy,Za,SC,LN,wg,ql,_l,Fie,LP,J2]})}return e})(),kC=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/",this._username=""}login(t,r){return this.http.post(this.baseUrl+"api/user/login",{user:t,password:r}).pipe(J(s=>(s.token&&(localStorage.setItem("token",s.token),localStorage.setItem("role",s.user_data.role)),s)))}logout(t){const r={headers:new Uc({Authorization:`Bearer ${t}`})};return this.http.post(this.baseUrl+"api/user/logout",{},r)}checkToken(t){const r={headers:new Uc({Authorization:`Bearer ${t}`})};return this.http.post(this.baseUrl+"api/user/check_token",{},r)}changePassword(t,r){return this.http.post(this.baseUrl+"api/user/restore",{password:r,user_id:t})}deleteAccount(t,r){return this.http.post(this.baseUrl+"api/user/delete_account",{password:r,user_email:t})}setUsername(t){this._username=t}getUsername(){return this._username}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),lse=(()=>{class e{constructor(t,r){this.authService=t,this.router=r,this.username="",this.password=""}login(){""!==this.username&&""!==this.password?this.authService.login(this.username,this.password).subscribe(()=>{localStorage.setItem("username",this.username),this.router.navigate(["/home"])},t=>{console.error("Error al iniciar sesi\xf3n:",t),alert("Nombre de usuario o contrase\xf1a incorrectos.")}):alert("Por favor, ingrese nombre de usuario y contrase\xf1a.")}static#e=this.\u0275fac=function(r){return new(r||e)(xt(kC),xt(ba))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-login"]],decls:17,vars:2,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-12","text-center"],["src","assets\\banner.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"container-fluid"],[1,"form-group"],["type","text","id","username","placeholder","Usuario",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-primary","btn-block",3,"click"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2),Xn(3,"img",3),te(),ee(4,"div",2)(5,"h1"),xe(6,"Ingreso al Admin"),te(),Xn(7,"br"),ee(8,"div",4)(9,"div",5)(10,"input",6),Tn("ngModelChange",function(h){return En(s.username,h)||(s.username=h),h}),te()(),Xn(11,"br"),ee(12,"div",5)(13,"input",7),Tn("ngModelChange",function(h){return En(s.password,h)||(s.password=h),h}),te()(),Xn(14,"br"),ee(15,"button",8),on("click",function(){return s.login()}),xe(16,"Iniciar Sesi\xf3n"),te()()()()()),2&r&&(Te(10),wn("ngModel",s.username),Te(3),wn("ngModel",s.password))},dependencies:[Za,ql,_l]})}return e})();function cse(e,n){1&e&&(ee(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),xe(4,"Productos"),te(),ee(5,"p",7),xe(6,"Administrar productos"),te(),ee(7,"button",8),xe(8,"Ver productos"),te()()()())}function use(e,n){1&e&&(ee(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),xe(4,"\xd3rdenes"),te(),ee(5,"p",7),xe(6,"Administrar \xf3rdenes"),te(),ee(7,"button",9),xe(8,"Ver \xf3rdenes"),te()()()())}function hse(e,n){1&e&&(ee(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),xe(4,"Clientes"),te(),ee(5,"p",7),xe(6,"Administrar clientes"),te(),ee(7,"button",10),xe(8,"Ver clientes"),te()()()())}function dse(e,n){1&e&&(ee(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),xe(4,"Reportes"),te(),ee(5,"p",7),xe(6,"Ver reportes"),te(),ee(7,"button",11),xe(8,"Ver reportes"),te()()()())}function fse(e,n){1&e&&(ee(0,"div",3)(1,"div",4)(2,"div",5)(3,"h5",6),xe(4,"CRM"),te(),ee(5,"p",7),xe(6,"Gestionar nuevos Clientes"),te(),ee(7,"button",12),xe(8,"CRM"),te()()()())}let sV=(()=>{class e{constructor(t,r){this.authService=t,this.router=r,this.isLoggedIn=!1,this.role=""}ngOnInit(){this.checkToken(),this.role=localStorage.getItem("role")}checkToken(){const t=localStorage.getItem("token");t?this.authService.checkToken(t).subscribe(()=>{this.isLoggedIn=!0},r=>{console.error("Error al verificar el token:",r),this.isLoggedIn=!1,this.router.navigate(["/login"])}):(this.isLoggedIn=!1,this.router.navigate(["/login"]))}redirectToLogin(){this.router.navigate(["/login"])}static#e=this.\u0275fac=function(r){return new(r||e)(xt(kC),xt(ba))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-home"]],decls:7,vars:5,consts:[[1,"container","mt-5"],[1,"row"],["class","col-md-3 mb-4",4,"ngIf"],[1,"col-md-3","mb-4"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["routerLink","/productos",1,"btn","btn-primary","btn-block"],["routerLink","/ordenes",1,"btn","btn-primary","btn-block"],["routerLink","/clientes",1,"btn","btn-primary","btn-block"],["routerLink","/reports",1,"btn","btn-primary","btn-block"],["routerLink","/crm",1,"btn","btn-primary","btn-block"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1),Cn(2,cse,9,0,"div",2)(3,use,9,0,"div",2)(4,hse,9,0,"div",2)(5,dse,9,0,"div",2)(6,fse,9,0,"div",2),te()()),2&r&&(Te(2),Zt("ngIf","administrador"==s.role),Te(),Zt("ngIf","administrador"==s.role),Te(),Zt("ngIf","administrador"==s.role),Te(),Zt("ngIf","administrador"==s.role),Te(),Zt("ngIf","administrador"==s.role||"comercial"==s.role))},dependencies:[uu,vw]})}return e})(),pse=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-reports"]],decls:38,vars:0,consts:[[1,"container","mt-5"],[1,"row"],[1,"col-md-3","mb-4"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["routerLink","/reports/picking",1,"btn","btn-primary","btn-block"],["routerLink","/reports/cotizar",1,"btn","btn-primary","btn-block"],["routerLink","/reports/integrar",1,"btn","btn-primary","btn-block"],["href","https://app.buyfrescapp.com:5000/api/order/orders/csv"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),xe(6,"Picking"),te(),ee(7,"p",6),xe(8,"Ordenes a entregar"),te(),ee(9,"button",7),xe(10,"Ver Picking"),te()()()(),ee(11,"div",2)(12,"div",3)(13,"div",4)(14,"h5",5),xe(15,"Cotizar"),te(),ee(16,"p",6),xe(17,"Cotizar productos"),te(),ee(18,"button",8),xe(19,"Cotizar"),te()()()(),ee(20,"div",2)(21,"div",3)(22,"div",4)(23,"h5",5),xe(24,"Integraci\xf3n"),te(),ee(25,"p",6),xe(26,"Integrar pedidos p\xe1gina"),te(),ee(27,"button",9),xe(28,"Integrar"),te()()()(),ee(29,"div",2)(30,"div",3)(31,"div",4)(32,"h5",5),xe(33,"Descargas"),te(),ee(34,"p",6),xe(35,"Descargar hist\xf3rico de ordenes "),te(),ee(36,"a",10),xe(37,"Ordenes en CSV"),te()()()()()())},dependencies:[vw]})}return e})();function mse(e,n){if(1&e&&(ee(0,"div",12),xe(1),te()),2&e){const t=Bt();Te(),kn(t.mensajeError)}}function gse(e,n){if(1&e&&(ee(0,"div",13),xe(1),te()),2&e){const t=Bt();Te(),kn(t.mensajeSuccess)}}let _se=(()=>{class e{constructor(t,r){this.route=t,this.authService=r,this.password1="",this.password2="",this.mensajeError="",this.mensajeSuccess="",this.user_id=""}ngOnInit(){this.route.params.subscribe(t=>{this.user_id=t.user_id})}restablecer(){this.password1===this.password2?this.user_id?this.authService.changePassword(this.user_id,this.password1).subscribe(()=>{this.mensajeSuccess="Se realiz\xf3 el cambio de contrase\xf1a correctamente, vuelve a intentar ingresar en la app. Gracias."},t=>{this.mensajeError="No se realiz\xf3 el cambio de contrase\xf1a, por favor intentalo m\xe1s tarde o comun\xedcate a nuestro Whatsapp 3115455042"}):this.mensajeError="No se encontr\xf3 el user_id. Por favor intenta nuevamente.":this.mensajeError="Las contrase\xf1as no coinciden."}static#e=this.\u0275fac=function(r){return new(r||e)(xt(qp),xt(kC))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-restore-password"]],decls:18,vars:4,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-auto","text-center"],["src","assets\\banner.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"col-auto"],[1,"container-fluid"],[1,"form-group"],["type","password","id","password1","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password2","placeholder","Confirmar Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn",2,"background-color","#97D700",3,"click"],["class","text-danger",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"text-danger"],[1,"text-success"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2),Xn(3,"img",3),te(),ee(4,"div",4)(5,"div",5),Xn(6,"br")(7,"br"),ee(8,"div",6)(9,"input",7),Tn("ngModelChange",function(h){return En(s.password1,h)||(s.password1=h),h}),te()(),Xn(10,"br"),ee(11,"div",6)(12,"input",8),Tn("ngModelChange",function(h){return En(s.password2,h)||(s.password2=h),h}),te()(),Xn(13,"br"),ee(14,"button",9),on("click",function(){return s.restablecer()}),xe(15,"Reestablecer"),te(),Cn(16,mse,2,1,"div",10)(17,gse,2,1,"div",11),te()()()()),2&r&&(Te(9),wn("ngModel",s.password1),Te(3),wn("ngModel",s.password2),Te(4),Zt("ngIf",s.mensajeError),Te(),Zt("ngIf",s.mensajeSuccess))},dependencies:[uu,Za,ql,_l]})}return e})();function yse(e,n){if(1&e&&(ee(0,"div",12),xe(1),te()),2&e){const t=Bt();Te(),kn(t.mensajeError)}}function vse(e,n){if(1&e&&(ee(0,"div",13),xe(1),te()),2&e){const t=Bt();Te(),kn(t.mensajeSuccess)}}let xse=(()=>{class e{constructor(t,r){this.route=t,this.authService=r,this.password="",this.mensajeError="",this.mensajeSuccess="",this.user_email="",this.route.queryParams.subscribe(s=>{this.user_email=s.user_id})}delete(){this.authService.deleteAccount(this.user_email,this.password).subscribe(()=>{this.mensajeSuccess="Se elimin\xf3 la cuenta "+this.user_email+" correctamente"},t=>{this.mensajeError="No se elimin\xf3 correctamente la cuenta, por favor comunicate con nuestro Whatsapp 3115455042"})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(qp),xt(kC))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-delete-account"]],decls:18,vars:4,consts:[[1,"container","mt-5","d-flex","justify-content-center","align-items-center"],[1,"row"],[1,"col-auto","text-center"],["src","assets\\banner.png","alt","Logo","width","300","height","300",1,"img-fluid","mb-4"],[1,"col-auto"],[1,"container-fluid"],[1,"form-group"],["type","email","id","email","placeholder","Email",1,"form-control",3,"ngModelChange","ngModel"],["type","password","id","password","placeholder","Contrase\xf1a",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn",2,"background-color","#97D700",3,"click"],["class","text-danger",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"text-danger"],[1,"text-success"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2),Xn(3,"img",3),te(),ee(4,"div",4)(5,"div",5),Xn(6,"br")(7,"br"),ee(8,"div",6)(9,"input",7),Tn("ngModelChange",function(h){return En(s.user_email,h)||(s.user_email=h),h}),te()(),Xn(10,"br"),ee(11,"div",6)(12,"input",8),Tn("ngModelChange",function(h){return En(s.password,h)||(s.password=h),h}),te()(),Xn(13,"br"),ee(14,"button",9),on("click",function(){return s.delete()}),xe(15,"Eliminar cuenta"),te(),Cn(16,yse,2,1,"div",10)(17,vse,2,1,"div",11),te()()()()),2&r&&(Te(9),wn("ngModel",s.user_email),Te(3),wn("ngModel",s.password),Te(4),Zt("ngIf",s.mensajeError),Te(),Zt("ngIf",s.mensajeSuccess))},dependencies:[uu,Za,ql,_l]})}return e})(),bse=(()=>{class e{constructor(t){this.sanitizer=t,this.fecha="",this.pdfPicking=""}generarPDF(){this.pdfPicking=this.sanitizer.bypassSecurityTrustResourceUrl("https://app.buyfrescapp.com:5000/api/reports/picking/"+this.fecha)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(nC))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-picking"]],decls:18,vars:2,consts:[[1,"container"],[1,"row","justify-content-center","mt-5"],[1,"col-md-6"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],["type","application/pdf","width","100%","height","600px",3,"src"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3"),xe(6,"Generar Archivo PDF con Picking"),te()(),ee(7,"div",5)(8,"div",6)(9,"label",7),xe(10,"Fecha:"),te(),ee(11,"input",8),Tn("ngModelChange",function(h){return En(s.fecha,h)||(s.fecha=h),h}),te()(),Xn(12,"br"),ee(13,"div",9)(14,"button",10),on("click",function(){return s.generarPDF()}),xe(15,"Generar PDF"),te()()()()()(),ee(16,"div",1),Xn(17,"iframe",11),te()()),2&r&&(Te(11),wn("ngModel",s.fecha),Te(6),Zt("src",s.pdfPicking,Kd))},dependencies:[Za,ql,_l]})}return e})(),wse=(()=>{class e{constructor(t){this.sanitizer=t,this.fecha="",this.pdfPicking="",this.supplier="Todos"}generarPDF(){this.pdfPicking=this.sanitizer.bypassSecurityTrustResourceUrl("https://app.buyfrescapp.com:5000/api/reports/compras/"+this.fecha+"/"+this.supplier)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(nC))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-compras"]],decls:31,vars:3,consts:[[1,"container"],[1,"row","justify-content-center","mt-5"],[1,"col-md-6"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","mt-3"],["for","proveedor"],["id","proveedor","name","proveedor",1,"form-control",3,"ngModelChange","ngModel"],["value","Todos"],["value","Angelyn"],["value","Marko"],["value","abastos"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],[1,"col-md-12"],["type","application/pdf","width","100%","height","600px",3,"src"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3"),xe(6,"Generar Archivo PDF con Compras"),te()(),ee(7,"div",5)(8,"div",6)(9,"label",7),xe(10,"Fecha:"),te(),ee(11,"input",8),Tn("ngModelChange",function(h){return En(s.fecha,h)||(s.fecha=h),h}),te()(),ee(12,"div",9)(13,"label",10),xe(14,"Proveedor:"),te(),ee(15,"select",11),Tn("ngModelChange",function(h){return En(s.supplier,h)||(s.supplier=h),h}),ee(16,"option",12),xe(17,"Todos"),te(),ee(18,"option",13),xe(19,"Anyelin"),te(),ee(20,"option",14),xe(21,"Marko"),te(),ee(22,"option",15),xe(23,"abastos"),te()()(),Xn(24,"br"),ee(25,"div",16)(26,"button",17),on("click",function(){return s.generarPDF()}),xe(27,"Generar PDF"),te()()()()()(),ee(28,"div",1)(29,"div",18),Xn(30,"iframe",19),te()()()),2&r&&(Te(11),wn("ngModel",s.fecha),Te(4),wn("ngModel",s.supplier),Te(15),Zt("src",s.pdfPicking,Kd))},dependencies:[Xy,Yy,Za,wg,ql,_l]})}return e})(),Tse=(()=>{class e{constructor(t){this.productService=t,this.fecha="",this.products=[],this.price=0,this.searchTerm=""}ngOnInit(){this.getProducts()}getProducts(){this.productService.getProducts().subscribe(t=>{this.products=t})}cotizarProducto(){}filterProducts(){}static#e=this.\u0275fac=function(r){return new(r||e)(xt(FN))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-cotizar"]],decls:14,vars:3,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-10"],["type","text","placeholder","Precio",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-2"],[1,"btn","btn-primary",3,"click"],["type","text","placeholder","Buscar producto",1,"form-control",3,"ngModelChange","input","ngModel"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"label",2),xe(3,"Fecha:"),te(),ee(4,"input",3),Tn("ngModelChange",function(h){return En(s.fecha,h)||(s.fecha=h),h}),te()(),ee(5,"div",1)(6,"div",4)(7,"input",5),Tn("ngModelChange",function(h){return En(s.price,h)||(s.price=h),h}),te()(),ee(8,"div",6)(9,"button",7),on("click",function(){return s.cotizarProducto()}),xe(10,"Cotizar"),te()()(),Xn(11,"br"),ee(12,"div",1)(13,"input",8),Tn("ngModelChange",function(h){return En(s.products,h)||(s.products=h),h}),on("input",function(){return s.filterProducts()}),te()()()),2&r&&(Te(4),wn("ngModel",s.fecha),Te(3),wn("ngModel",s.price),Te(6),wn("ngModel",s.products))},dependencies:[Za,ql,_l]})}return e})(),Ese=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}get_order(t){return console.log(t),this.http.get(this.baseUrl+"api/woo/get_order/"+t)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Cse(e,n){if(1&e&&(ee(0,"div",7),xe(1),Xn(2,"button",8),te()),2&e){const t=Bt();Zt("ngClass",t.alertClass),Te(),dl(" ",t.message," ")}}let Sse=(()=>{class e{constructor(t){this.wooService=t,this.orderNumber="",this.message="",this.alertClass=""}ngOnInit(){}sendOrder(t){this.wooService.get_order(t).subscribe(r=>{r?(this.message=r.message||"Order sent successfully",this.alertClass="alert alert-success"):(this.message=r.message||"Failed to send the order",this.alertClass="alert alert-danger")})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(Ese))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-integrar"]],decls:12,vars:2,consts:[[1,"container"],[1,"row"],[1,"col-auto"],["type","text","placeholder","Enter Order Number",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"col"],["class","alert alert-dismissible fade show","role","alert",3,"ngClass",4,"ngIf"],["role","alert",1,"alert","alert-dismissible","fade","show",3,"ngClass"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"]],template:function(r,s){1&r&&(Xn(0,"br")(1,"br"),ee(2,"div",0)(3,"div",1)(4,"div",2)(5,"input",3),Tn("ngModelChange",function(h){return En(s.orderNumber,h)||(s.orderNumber=h),h}),te()(),ee(6,"div",2)(7,"button",4),on("click",function(){return s.sendOrder(s.orderNumber)}),xe(8,"Sincronizar Orden"),te()()(),ee(9,"div",1)(10,"div",5),Cn(11,Cse,3,2,"div",6),te()()()),2&r&&(Te(5),wn("ngModel",s.orderNumber),Te(6),Zt("ngIf",s.message))},dependencies:[K2,uu,Za,ql,_l]})}return e})();var OC={version:"0.18.5"},Yu=1200,Jy=1252,Dse=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],cF={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},JI=function(e){-1!=Dse.indexOf(e)&&(Jy=cF[0]=e)},id=function(e){Yu=e,JI(e)};var Ji,RC=function(n){return String.fromCharCode(n)},uF=function(n){return String.fromCharCode(n)},Po=null,T_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function NC(e){for(var n="",t=0,r=0,s=0,l=0,h=0,g=0,x=0,E=0;E<e.length;)l=(t=e.charCodeAt(E++))>>2,h=(3&t)<<4|(r=e.charCodeAt(E++))>>4,g=(15&r)<<2|(s=e.charCodeAt(E++))>>6,x=63&s,isNaN(r)?g=x=64:isNaN(s)&&(x=64),n+=T_.charAt(l)+T_.charAt(h)+T_.charAt(g)+T_.charAt(x);return n}function Ku(e){var n="",l=0,h=0,g=0,x=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var E=0;E<e.length;)l=T_.indexOf(e.charAt(E++)),h=T_.indexOf(e.charAt(E++)),n+=String.fromCharCode(l<<2|h>>4),64!==(g=T_.indexOf(e.charAt(E++)))&&(n+=String.fromCharCode((15&h)<<4|g>>2)),64!==(x=T_.indexOf(e.charAt(E++)))&&(n+=String.fromCharCode((3&g)<<6|x));return n}var Oi=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Tg=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(n,t){return t?new Buffer(n,t):new Buffer(n)}:Buffer.from.bind(Buffer)}return function(){}}();function E_(e){return Oi?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function aV(e){return Oi?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var Ju=function(n){return Oi?Tg(n,"binary"):n.split("").map(function(t){return 255&t.charCodeAt(0)})};function FC(e){if(typeof ArrayBuffer>"u")return Ju(e);for(var n=new ArrayBuffer(e.length),t=new Uint8Array(n),r=0;r!=e.length;++r)t[r]=255&e.charCodeAt(r);return n}function C_(e){if(Array.isArray(e))return e.map(function(r){return String.fromCharCode(r)}).join("");for(var n=[],t=0;t<e.length;++t)n[t]=String.fromCharCode(e[t]);return n.join("")}var yl=Oi?function(e){return Buffer.concat(e.map(function(n){return Buffer.isBuffer(n)?n:Tg(n)}))}:function(e){if(typeof Uint8Array<"u"){var n=0,t=0;for(n=0;n<e.length;++n)t+=e[n].length;var r=new Uint8Array(t),s=0;for(n=0,t=0;n<e.length;t+=s,++n)if(s=e[n].length,e[n]instanceof Uint8Array)r.set(e[n],t);else{if("string"==typeof e[n])throw"wtf";r.set(new Uint8Array(e[n]),t)}return r}return[].concat.apply([],e.map(function(l){return Array.isArray(l)?l:[].slice.call(l)}))},dc=/\u0000/g,LC=/[\u0001-\u0006]/g;function Cw(e){for(var n="",t=e.length-1;t>=0;)n+=e.charAt(t--);return n}function mf(e,n){var t=""+e;return t.length>=n?t:Fo("0",n-t.length)+t}function dF(e,n){var t=""+e;return t.length>=n?t:Fo(" ",n-t.length)+t}function tk(e,n){var t=""+e;return t.length>=n?t:t+Fo(" ",n-t.length)}var lV=Math.pow(2,32);function Sw(e,n){return e>lV||e<-lV?function Ose(e,n){var t=""+Math.round(e);return t.length>=n?t:Fo("0",n-t.length)+t}(e,n):function Rse(e,n){var t=""+e;return t.length>=n?t:Fo("0",n-t.length)+t}(Math.round(e),n)}function nk(e,n){return e.length>=7+(n=n||0)&&103==(32|e.charCodeAt(n))&&101==(32|e.charCodeAt(n+1))&&110==(32|e.charCodeAt(n+2))&&101==(32|e.charCodeAt(n+3))&&114==(32|e.charCodeAt(n+4))&&97==(32|e.charCodeAt(n+5))&&108==(32|e.charCodeAt(n+6))}var cV=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],fF=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]],Br={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "'},uV={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Nse={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function rk(e,n,t){for(var r=e<0?-1:1,s=e*r,l=0,h=1,g=0,x=1,E=0,D=0,O=Math.floor(s);E<n&&(g=(O=Math.floor(s))*h+l,D=O*E+x,!(s-O<5e-8));)s=1/(s-O),l=h,h=g,x=E,E=D;if(D>n&&(E>n?(D=x,g=l):(D=E,g=h)),!t)return[0,r*g,D];var N=Math.floor(r*g/D);return[N,r*g-N*D,D]}function S_(e,n,t){if(e>2958465||e<0)return null;var r=0|e,s=Math.floor(86400*(e-r)),l=0,h=[],g={D:r,T:s,u:86400*(e-r)-s,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(g.u)<1e-6&&(g.u=0),n&&n.date1904&&(r+=1462),g.u>.9999&&(g.u=0,86400==++s&&(g.T=s=0,++r,++g.D)),60===r)h=t?[1317,10,29]:[1900,2,29],l=3;else if(0===r)h=t?[1317,8,29]:[1900,1,0],l=6;else{r>60&&--r;var x=new Date(1900,0,1);x.setDate(x.getDate()+r-1),h=[x.getFullYear(),x.getMonth()+1,x.getDate()],l=x.getDay(),r<60&&(l=(l+6)%7),t&&(l=function Vse(e,n){n[0]-=581;var t=e.getDay();return e<60&&(t=(t+6)%7),t}(x,h))}return g.y=h[0],g.m=h[1],g.d=h[2],g.S=s%60,s=Math.floor(s/60),g.M=s%60,s=Math.floor(s/60),g.H=s,g.q=l,g}var hV=new Date(1899,11,31,0,0,0),Fse=hV.getTime(),Lse=new Date(1900,2,1,0,0,0);function dV(e,n){var t=e.getTime();return n?t-=1262304e5:e>=Lse&&(t+=864e5),(t-(Fse+6e4*(e.getTimezoneOffset()-hV.getTimezoneOffset())))/864e5}function pF(e){return-1==e.indexOf(".")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function Qy(e,n){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(0|e)===e?e.toString(10):function BC(e){var t,n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E);return t=n>=-4&&n<=-1?e.toPrecision(10+n):Math.abs(n)<=9?function zse(e){var n=e<0?12:11,t=pF(e.toFixed(12));return t.length<=n||(t=e.toPrecision(10)).length<=n?t:e.toExponential(5)}(e):10===n?e.toFixed(10).substr(0,12):function Use(e){var n=pF(e.toFixed(11));return n.length>(e<0?12:11)||"0"===n||"-0"===n?e.toPrecision(6):n}(e),pF(function Bse(e){return-1==e.indexOf("E")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}(t.toUpperCase()))}(e);case"undefined":return"";case"object":if(null==e)return"";if(e instanceof Date)return Qu(14,dV(e,n&&n.date1904),n)}throw new Error("unsupported value in General format: "+e)}function jse(e,n,t,r){var x,s="",l=0,h=0,g=t.y,E=0;switch(e){case 98:g=t.y+543;case 121:switch(n.length){case 1:case 2:x=g%100,E=2;break;default:x=g%1e4,E=4}break;case 109:switch(n.length){case 1:case 2:x=t.m,E=n.length;break;case 3:return fF[t.m-1][1];case 5:return fF[t.m-1][0];default:return fF[t.m-1][2]}break;case 100:switch(n.length){case 1:case 2:x=t.d,E=n.length;break;case 3:return cV[t.q][0];default:return cV[t.q][1]}break;case 104:switch(n.length){case 1:case 2:x=1+(t.H+11)%12,E=n.length;break;default:throw"bad hour format: "+n}break;case 72:switch(n.length){case 1:case 2:x=t.H,E=n.length;break;default:throw"bad hour format: "+n}break;case 77:switch(n.length){case 1:case 2:x=t.M,E=n.length;break;default:throw"bad minute format: "+n}break;case 115:if("s"!=n&&"ss"!=n&&".0"!=n&&".00"!=n&&".000"!=n)throw"bad second format: "+n;return 0!==t.u||"s"!=n&&"ss"!=n?(h=r>=2?3===r?1e3:100:1===r?10:1,(l=Math.round(h*(t.S+t.u)))>=60*h&&(l=0),"s"===n?0===l?"0":""+l/h:(s=mf(l,2+r),"ss"===n?s.substr(0,2):"."+s.substr(2,n.length-1))):mf(t.S,n.length);case 90:switch(n){case"[h]":case"[hh]":x=24*t.D+t.H;break;case"[m]":case"[mm]":x=60*(24*t.D+t.H)+t.M;break;case"[s]":case"[ss]":x=60*(60*(24*t.D+t.H)+t.M)+Math.round(t.S+t.u);break;default:throw"bad abstime format: "+n}E=3===n.length?1:2;break;case 101:x=g,E=1}return E>0?mf(x,E):""}function D_(e){if(e.length<=3)return e;for(var t=e.length%3,r=e.substr(0,t);t!=e.length;t+=3)r+=(r.length>0?",":"")+e.substr(t,3);return r}var fV=/%/g;function pV(e,n){var t,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==n)return"0.0E+0";if(n<0)return"-"+pV(e,-n);var s=e.indexOf(".");-1===s&&(s=e.indexOf("E"));var l=Math.floor(Math.log(n)*Math.LOG10E)%s;if(l<0&&(l+=s),-1===(t=(n/Math.pow(10,l)).toPrecision(r+1+(s+l)%s)).indexOf("e")){var h=Math.floor(Math.log(n)*Math.LOG10E);for(-1===t.indexOf(".")?t=t.charAt(0)+"."+t.substr(1)+"E+"+(h-t.length+l):t+="E+"+(h-l);"0."===t.substr(0,2);)t=(t=t.charAt(0)+t.substr(2,s)+"."+t.substr(2+s)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(g,x,E,D){return x+E+D.substr(0,(s+l)%s)+"."+D.substr(l)+"E"})}else t=n.toExponential(r);return e.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),e.match(/E\-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}var mV=/# (\?+)( ?)\/( ?)(\d+)/,gV=/^#*0*\.([0#]+)/,_V=/\).*[0#]/,yV=/\(###\) ###\\?-####/;function jc(e){for(var t,n="",r=0;r!=e.length;++r)switch(t=e.charCodeAt(r)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(t)}return n}function vV(e,n){var t=Math.pow(10,n);return""+Math.round(e*t)/t}function xV(e,n){var t=e-Math.floor(e),r=Math.pow(10,n);return n<(""+Math.round(t*r)).length?0:Math.round(t*r)}function sd(e,n,t){if(40===e.charCodeAt(0)&&!n.match(_V)){var r=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?sd("n",r,t):"("+sd("n",r,-t)+")"}if(44===n.charCodeAt(n.length-1))return function Hse(e,n,t){for(var r=n.length-1;44===n.charCodeAt(r-1);)--r;return Eg(e,n.substr(0,r),t/Math.pow(10,3*(n.length-r)))}(e,n,t);if(-1!==n.indexOf("%"))return function $se(e,n,t){var r=n.replace(fV,""),s=n.length-r.length;return Eg(e,r,t*Math.pow(10,2*s))+Fo("%",s)}(e,n,t);if(-1!==n.indexOf("E"))return pV(n,t);if(36===n.charCodeAt(0))return"$"+sd(e,n.substr(" "==n.charAt(1)?2:1),t);var s,l,h,g,x=Math.abs(t),E=t<0?"-":"";if(n.match(/^00+$/))return E+Sw(x,n.length);if(n.match(/^[#?]+$/))return"0"===(s=Sw(t,0))&&(s=""),s.length>n.length?s:jc(n.substr(0,n.length-s.length))+s;if(l=n.match(mV))return function Gse(e,n,t){var r=parseInt(e[4],10),s=Math.round(n*r),l=Math.floor(s/r),h=s-l*r,g=r;return t+(0===l?"":""+l)+" "+(0===h?Fo(" ",e[1].length+1+e[4].length):dF(h,e[1].length)+e[2]+"/"+e[3]+mf(g,e[4].length))}(l,x,E);if(n.match(/^#+0+$/))return E+Sw(x,n.length-n.indexOf("0"));if(l=n.match(gV))return s=vV(t,l[1].length).replace(/^([^\.]+)$/,"$1."+jc(l[1])).replace(/\.$/,"."+jc(l[1])).replace(/\.(\d*)$/,function(W,V){return"."+V+Fo("0",jc(l[1]).length-V.length)}),-1!==n.indexOf("0.")?s:s.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),l=n.match(/^(0*)\.(#*)$/))return E+vV(x,l[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,l[1].length?"0.":".");if(l=n.match(/^#{1,3},##0(\.?)$/))return E+D_(Sw(x,0));if(l=n.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+sd(e,n,-t):D_(""+(Math.floor(t)+function qse(e,n){return n<(""+Math.round((e-Math.floor(e))*Math.pow(10,n))).length?1:0}(t,l[1].length)))+"."+mf(xV(t,l[1].length),l[1].length);if(l=n.match(/^#,#*,#0/))return sd(e,n.replace(/^#,#*,/,""),t);if(l=n.match(/^([0#]+)(\\?-([0#]+))+$/))return s=Cw(sd(e,n.replace(/[\\-]/g,""),t)),h=0,Cw(Cw(n.replace(/\\/g,"")).replace(/[0#]/g,function(W){return h<s.length?s.charAt(h++):"0"===W?"0":""}));if(n.match(yV))return"("+(s=sd(e,"##########",t)).substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var D="";if(l=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return h=Math.min(l[4].length,7),g=rk(x,Math.pow(10,h)-1,!1),s=""+E," "==(D=Eg("n",l[1],g[1])).charAt(D.length-1)&&(D=D.substr(0,D.length-1)+"0"),s+=D+l[2]+"/"+l[3],(D=tk(g[2],h)).length<l[4].length&&(D=jc(l[4].substr(l[4].length-D.length))+D),s+=D;if(l=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return h=Math.min(Math.max(l[1].length,l[4].length),7),E+((g=rk(x,Math.pow(10,h)-1,!0))[0]||(g[1]?"":"0"))+" "+(g[1]?dF(g[1],h)+l[2]+"/"+l[3]+tk(g[2],h):Fo(" ",2*h+1+l[2].length+l[3].length));if(l=n.match(/^[#0?]+$/))return s=Sw(t,0),n.length<=s.length?s:jc(n.substr(0,n.length-s.length))+s;if(l=n.match(/^([#0?]+)\.([#0]+)$/)){s=""+t.toFixed(Math.min(l[2].length,10)).replace(/([^0])0+$/,"$1"),h=s.indexOf(".");var O=n.indexOf(".")-h,N=n.length-s.length-O;return jc(n.substr(0,O)+s+n.substr(n.length-N))}if(l=n.match(/^00,000\.([#0]*0)$/))return h=xV(t,l[1].length),t<0?"-"+sd(e,n,-t):D_(function Zse(e){return e<2147483647&&e>-2147483648?""+(e>=0?0|e:e-1|0):""+Math.floor(e)}(t)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(W){return"00,"+(W.length<3?mf(0,3-W.length):"")+W})+"."+mf(h,l[1].length);switch(n){case"###,##0.00":return sd(e,"#,##0.00",t);case"###,###":case"##,###":case"#,###":var B=D_(Sw(x,0));return"0"!==B?E+B:"";case"###,###.00":return sd(e,"###,##0.00",t).replace(/^0\./,".");case"#,###.00":return sd(e,"#,##0.00",t).replace(/^0\./,".")}throw new Error("unsupported format |"+n+"|")}function bV(e,n){var t,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==n)return"0.0E+0";if(n<0)return"-"+bV(e,-n);var s=e.indexOf(".");-1===s&&(s=e.indexOf("E"));var l=Math.floor(Math.log(n)*Math.LOG10E)%s;if(l<0&&(l+=s),!(t=(n/Math.pow(10,l)).toPrecision(r+1+(s+l)%s)).match(/[Ee]/)){var h=Math.floor(Math.log(n)*Math.LOG10E);-1===t.indexOf(".")?t=t.charAt(0)+"."+t.substr(1)+"E+"+(h-t.length+l):t+="E+"+(h-l),t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(g,x,E,D){return x+E+D.substr(0,(s+l)%s)+"."+D.substr(l)+"E"})}else t=n.toExponential(r);return e.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),e.match(/E\-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}function Yp(e,n,t){if(40===e.charCodeAt(0)&&!n.match(_V)){var r=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?Yp("n",r,t):"("+Yp("n",r,-t)+")"}if(44===n.charCodeAt(n.length-1))return function Xse(e,n,t){for(var r=n.length-1;44===n.charCodeAt(r-1);)--r;return Eg(e,n.substr(0,r),t/Math.pow(10,3*(n.length-r)))}(e,n,t);if(-1!==n.indexOf("%"))return function Yse(e,n,t){var r=n.replace(fV,""),s=n.length-r.length;return Eg(e,r,t*Math.pow(10,2*s))+Fo("%",s)}(e,n,t);if(-1!==n.indexOf("E"))return bV(n,t);if(36===n.charCodeAt(0))return"$"+Yp(e,n.substr(" "==n.charAt(1)?2:1),t);var s,l,h,g,x=Math.abs(t),E=t<0?"-":"";if(n.match(/^00+$/))return E+mf(x,n.length);if(n.match(/^[#?]+$/))return s=""+t,0===t&&(s=""),s.length>n.length?s:jc(n.substr(0,n.length-s.length))+s;if(l=n.match(mV))return function Wse(e,n,t){return t+(0===n?"":""+n)+Fo(" ",e[1].length+2+e[4].length)}(l,x,E);if(n.match(/^#+0+$/))return E+mf(x,n.length-n.indexOf("0"));if(l=n.match(gV))return s=(s=(""+t).replace(/^([^\.]+)$/,"$1."+jc(l[1])).replace(/\.$/,"."+jc(l[1]))).replace(/\.(\d*)$/,function(W,V){return"."+V+Fo("0",jc(l[1]).length-V.length)}),-1!==n.indexOf("0.")?s:s.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),l=n.match(/^(0*)\.(#*)$/))return E+(""+x).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,l[1].length?"0.":".");if(l=n.match(/^#{1,3},##0(\.?)$/))return E+D_(""+x);if(l=n.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+Yp(e,n,-t):D_(""+t)+"."+Fo("0",l[1].length);if(l=n.match(/^#,#*,#0/))return Yp(e,n.replace(/^#,#*,/,""),t);if(l=n.match(/^([0#]+)(\\?-([0#]+))+$/))return s=Cw(Yp(e,n.replace(/[\\-]/g,""),t)),h=0,Cw(Cw(n.replace(/\\/g,"")).replace(/[0#]/g,function(W){return h<s.length?s.charAt(h++):"0"===W?"0":""}));if(n.match(yV))return"("+(s=Yp(e,"##########",t)).substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var D="";if(l=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return h=Math.min(l[4].length,7),g=rk(x,Math.pow(10,h)-1,!1),s=""+E," "==(D=Eg("n",l[1],g[1])).charAt(D.length-1)&&(D=D.substr(0,D.length-1)+"0"),s+=D+l[2]+"/"+l[3],(D=tk(g[2],h)).length<l[4].length&&(D=jc(l[4].substr(l[4].length-D.length))+D),s+=D;if(l=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return h=Math.min(Math.max(l[1].length,l[4].length),7),E+((g=rk(x,Math.pow(10,h)-1,!0))[0]||(g[1]?"":"0"))+" "+(g[1]?dF(g[1],h)+l[2]+"/"+l[3]+tk(g[2],h):Fo(" ",2*h+1+l[2].length+l[3].length));if(l=n.match(/^[#0?]+$/))return n.length<=(s=""+t).length?s:jc(n.substr(0,n.length-s.length))+s;if(l=n.match(/^([#0]+)\.([#0]+)$/)){s=""+t.toFixed(Math.min(l[2].length,10)).replace(/([^0])0+$/,"$1"),h=s.indexOf(".");var O=n.indexOf(".")-h,N=n.length-s.length-O;return jc(n.substr(0,O)+s+n.substr(n.length-N))}if(l=n.match(/^00,000\.([#0]*0)$/))return t<0?"-"+Yp(e,n,-t):D_(""+t).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(W){return"00,"+(W.length<3?mf(0,3-W.length):"")+W})+"."+mf(0,l[1].length);switch(n){case"###,###":case"##,###":case"#,###":var B=D_(""+x);return"0"!==B?E+B:"";default:if(n.match(/\.[0#?]*$/))return Yp(e,n.slice(0,n.lastIndexOf(".")),t)+jc(n.slice(n.lastIndexOf(".")))}throw new Error("unsupported format |"+n+"|")}function Eg(e,n,t){return(0|t)===t?Yp(e,n,t):sd(e,n,t)}var wV=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function Dw(e){for(var n=0,t="",r="";n<e.length;)switch(t=e.charAt(n)){case"G":nk(e,n)&&(n+=6),n++;break;case'"':for(;34!==e.charCodeAt(++n)&&n<e.length;);++n;break;case"\\":case"_":n+=2;break;case"@":++n;break;case"B":case"b":if("1"===e.charAt(n+1)||"2"===e.charAt(n+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4e0a":if("A/P"===e.substr(n,3).toUpperCase()||"AM/PM"===e.substr(n,5).toUpperCase()||"\u4e0a\u5348/\u4e0b\u5348"===e.substr(n,5).toUpperCase())return!0;++n;break;case"[":for(r=t;"]"!==e.charAt(n++)&&n<e.length;)r+=e.charAt(n);if(r.match(wV))return!0;break;case".":case"0":case"#":for(;n<e.length&&("0#?.,E+-%".indexOf(t=e.charAt(++n))>-1||"\\"==t&&"-"==e.charAt(n+1)&&"0#".indexOf(e.charAt(n+2))>-1););break;case"?":for(;e.charAt(++n)===t;);break;case"*":++n,(" "==e.charAt(n)||"*"==e.charAt(n))&&++n;break;case"(":case")":++n;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;n<e.length&&"0123456789".indexOf(e.charAt(++n))>-1;);break;default:++n}return!1}var TV=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function EV(e,n){if(null==n)return!1;var t=parseFloat(n[2]);switch(n[1]){case"=":if(e==t)return!0;break;case">":if(e>t)return!0;break;case"<":if(e<t)return!0;break;case"<>":if(e!=t)return!0;break;case">=":if(e>=t)return!0;break;case"<=":if(e<=t)return!0}return!1}function Qu(e,n,t){null==t&&(t={});var r="";switch(typeof e){case"string":r="m/d/yy"==e&&t.dateNF?t.dateNF:e;break;case"number":null==(r=14==e&&t.dateNF?t.dateNF:(null!=t.table?t.table:Br)[e])&&(r=t.table&&t.table[uV[e]]||Br[uV[e]]),null==r&&(r=Nse[e]||"General")}if(nk(r,0))return Qy(n,t);n instanceof Date&&(n=dV(n,t.date1904));var s=function Qse(e,n){var t=function Kse(e){for(var n=[],t=!1,r=0,s=0;r<e.length;++r)switch(e.charCodeAt(r)){case 34:t=!t;break;case 95:case 42:case 92:++r;break;case 59:n[n.length]=e.substr(s,r-s),s=r+1}if(n[n.length]=e.substr(s),!0===t)throw new Error("Format |"+e+"| unterminated string ");return n}(e),r=t.length,s=t[r-1].indexOf("@");if(r<4&&s>-1&&--r,t.length>4)throw new Error("cannot find right format for |"+t.join("|")+"|");if("number"!=typeof n)return[4,4===t.length||s>-1?t[t.length-1]:"@"];switch(t.length){case 1:t=s>-1?["General","General","General",t[0]]:[t[0],t[0],t[0],"@"];break;case 2:t=s>-1?[t[0],t[0],t[0],t[1]]:[t[0],t[1],t[0],"@"];break;case 3:t=s>-1?[t[0],t[1],t[0],t[2]]:[t[0],t[1],t[2],"@"]}var l=n>0?t[0]:n<0?t[1]:t[2];if(-1===t[0].indexOf("[")&&-1===t[1].indexOf("["))return[r,l];if(null!=t[0].match(/\[[=<>]/)||null!=t[1].match(/\[[=<>]/)){var h=t[0].match(TV),g=t[1].match(TV);return EV(n,h)?[r,t[0]]:EV(n,g)?[r,t[1]]:[r,t[null!=h&&null!=g?2:1]]}return[r,l]}(r,n);if(nk(s[1]))return Qy(n,t);if(!0===n)n="TRUE";else if(!1===n)n="FALSE";else if(""===n||null==n)return"";return function Jse(e,n,t,r){for(var E,D,O,s=[],l="",h=0,g="",x="t",N="H";h<e.length;)switch(g=e.charAt(h)){case"G":if(!nk(e,h))throw new Error("unrecognized character "+g+" in "+e);s[s.length]={t:"G",v:"General"},h+=7;break;case'"':for(l="";34!==(O=e.charCodeAt(++h))&&h<e.length;)l+=String.fromCharCode(O);s[s.length]={t:"t",v:l},++h;break;case"\\":var B=e.charAt(++h);s[s.length]={t:"("===B||")"===B?B:"t",v:B},++h;break;case"_":s[s.length]={t:"t",v:" "},h+=2;break;case"@":s[s.length]={t:"T",v:n},++h;break;case"B":case"b":if("1"===e.charAt(h+1)||"2"===e.charAt(h+1)){if(null==E&&null==(E=S_(n,t,"2"===e.charAt(h+1))))return"";s[s.length]={t:"X",v:e.substr(h,2)},x=g,h+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":g=g.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(n<0||null==E&&null==(E=S_(n,t)))return"";for(l=g;++h<e.length&&e.charAt(h).toLowerCase()===g;)l+=g;"m"===g&&"h"===x.toLowerCase()&&(g="M"),"h"===g&&(g=N),s[s.length]={t:g,v:l},x=g;break;case"A":case"a":case"\u4e0a":var V={t:g,v:g};if(null==E&&(E=S_(n,t)),"A/P"===e.substr(h,3).toUpperCase()?(null!=E&&(V.v=E.H>=12?"P":"A"),V.t="T",N="h",h+=3):"AM/PM"===e.substr(h,5).toUpperCase()?(null!=E&&(V.v=E.H>=12?"PM":"AM"),V.t="T",h+=5,N="h"):"\u4e0a\u5348/\u4e0b\u5348"===e.substr(h,5).toUpperCase()?(null!=E&&(V.v=E.H>=12?"\u4e0b\u5348":"\u4e0a\u5348"),V.t="T",h+=5,N="h"):(V.t="t",++h),null==E&&"T"===V.t)return"";s[s.length]=V,x=g;break;case"[":for(l=g;"]"!==e.charAt(h++)&&h<e.length;)l+=e.charAt(h);if("]"!==l.slice(-1))throw'unterminated "[" block: |'+l+"|";if(l.match(wV)){if(null==E&&null==(E=S_(n,t)))return"";s[s.length]={t:"Z",v:l.toLowerCase()},x=l.charAt(1)}else l.indexOf("$")>-1&&(l=(l.match(/\$([^-\[\]]*)/)||[])[1]||"$",Dw(e)||(s[s.length]={t:"t",v:l}));break;case".":if(null!=E){for(l=g;++h<e.length&&"0"===(g=e.charAt(h));)l+=g;s[s.length]={t:"s",v:l};break}case"0":case"#":for(l=g;++h<e.length&&"0#?.,E+-%".indexOf(g=e.charAt(h))>-1;)l+=g;s[s.length]={t:"n",v:l};break;case"?":for(l=g;e.charAt(++h)===g;)l+=g;s[s.length]={t:g,v:l},x=g;break;case"*":++h,(" "==e.charAt(h)||"*"==e.charAt(h))&&++h;break;case"(":case")":s[s.length]={t:1===r?"t":g,v:g},++h;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(l=g;h<e.length&&"0123456789".indexOf(e.charAt(++h))>-1;)l+=e.charAt(h);s[s.length]={t:"D",v:l};break;case" ":s[s.length]={t:g,v:g},++h;break;case"$":s[s.length]={t:"t",v:"$"},++h;break;default:if(-1===",$-+/():!^&'~{}<>=\u20acacfijklopqrtuvwxzP".indexOf(g))throw new Error("unrecognized character "+g+" in "+e);s[s.length]={t:"t",v:g},++h}var oe,X=0,le=0;for(h=s.length-1,x="t";h>=0;--h)switch(s[h].t){case"h":case"H":s[h].t=N,x="h",X<1&&(X=1);break;case"s":(oe=s[h].v.match(/\.0+$/))&&(le=Math.max(le,oe[0].length-1)),X<3&&(X=3);case"d":case"y":case"M":case"e":x=s[h].t;break;case"m":"s"===x&&(s[h].t="M",X<2&&(X=2));break;case"X":break;case"Z":X<1&&s[h].v.match(/[Hh]/)&&(X=1),X<2&&s[h].v.match(/[Mm]/)&&(X=2),X<3&&s[h].v.match(/[Ss]/)&&(X=3)}switch(X){case 0:break;case 1:E.u>=.5&&(E.u=0,++E.S),E.S>=60&&(E.S=0,++E.M),E.M>=60&&(E.M=0,++E.H);break;case 2:E.u>=.5&&(E.u=0,++E.S),E.S>=60&&(E.S=0,++E.M)}var Le,fe="";for(h=0;h<s.length;++h)switch(s[h].t){case"t":case"T":case" ":case"D":break;case"X":s[h].v="",s[h].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":s[h].v=jse(s[h].t.charCodeAt(0),s[h].v,E,le),s[h].t="t";break;case"n":case"?":for(Le=h+1;null!=s[Le]&&("?"===(g=s[Le].t)||"D"===g||(" "===g||"t"===g)&&null!=s[Le+1]&&("?"===s[Le+1].t||"t"===s[Le+1].t&&"/"===s[Le+1].v)||"("===s[h].t&&(" "===g||"n"===g||")"===g)||"t"===g&&("/"===s[Le].v||" "===s[Le].v&&null!=s[Le+1]&&"?"==s[Le+1].t));)s[h].v+=s[Le].v,s[Le]={v:"",t:";"},++Le;fe+=s[h].v,h=Le-1;break;case"G":s[h].t="t",s[h].v=Qy(n,t)}var at,Ne,Ze="";if(fe.length>0){40==fe.charCodeAt(0)?(at=n<0&&45===fe.charCodeAt(0)?-n:n,Ne=Eg("n",fe,at)):(Ne=Eg("n",fe,at=n<0&&r>1?-n:n),at<0&&s[0]&&"t"==s[0].t&&(Ne=Ne.substr(1),s[0].v="-"+s[0].v)),Le=Ne.length-1;var ot=s.length;for(h=0;h<s.length;++h)if(null!=s[h]&&"t"!=s[h].t&&s[h].v.indexOf(".")>-1){ot=h;break}var lt=s.length;if(ot===s.length&&-1===Ne.indexOf("E")){for(h=s.length-1;h>=0;--h)null==s[h]||-1==="n?".indexOf(s[h].t)||(Le>=s[h].v.length-1?s[h].v=Ne.substr(1+(Le-=s[h].v.length),s[h].v.length):Le<0?s[h].v="":(s[h].v=Ne.substr(0,Le+1),Le=-1),s[h].t="t",lt=h);Le>=0&&lt<s.length&&(s[lt].v=Ne.substr(0,Le+1)+s[lt].v)}else if(ot!==s.length&&-1===Ne.indexOf("E")){for(Le=Ne.indexOf(".")-1,h=ot;h>=0;--h)if(null!=s[h]&&-1!=="n?".indexOf(s[h].t)){for(D=s[h].v.indexOf(".")>-1&&h===ot?s[h].v.indexOf(".")-1:s[h].v.length-1,Ze=s[h].v.substr(D+1);D>=0;--D)Le>=0&&("0"===s[h].v.charAt(D)||"#"===s[h].v.charAt(D))&&(Ze=Ne.charAt(Le--)+Ze);s[h].v=Ze,s[h].t="t",lt=h}for(Le>=0&&lt<s.length&&(s[lt].v=Ne.substr(0,Le+1)+s[lt].v),Le=Ne.indexOf(".")+1,h=ot;h<s.length;++h)if(null!=s[h]&&(-1!=="n?(".indexOf(s[h].t)||h===ot)){for(D=s[h].v.indexOf(".")>-1&&h===ot?s[h].v.indexOf(".")+1:0,Ze=s[h].v.substr(0,D);D<s[h].v.length;++D)Le<Ne.length&&(Ze+=Ne.charAt(Le++));s[h].v=Ze,s[h].t="t",lt=h}}}for(h=0;h<s.length;++h)null!=s[h]&&"n?".indexOf(s[h].t)>-1&&(s[h].v=Eg(s[h].t,s[h].v,at=r>1&&n<0&&h>0&&"-"===s[h-1].v?-n:n),s[h].t="t");var Tt="";for(h=0;h!==s.length;++h)null!=s[h]&&(Tt+=s[h].v);return Tt}(s[1],n,t,s[0])}function Kp(e,n){if("number"!=typeof n){n=+n||-1;for(var t=0;t<392;++t)if(null!=Br[t]){if(Br[t]==e){n=t;break}}else n<0&&(n=t);n<0&&(n=391)}return Br[n]=e,n}function zC(e){for(var n=0;392!=n;++n)void 0!==e[n]&&Kp(e[n],n)}function Mw(){Br=function Pse(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "',e}()}var CV=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g,ioe=function(){var e={version:"1.2.0"},t=function n(){for(var Ne=0,ot=new Array(256),lt=0;256!=lt;++lt)ot[lt]=Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=1&(Ne=lt)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1)?-306674912^Ne>>>1:Ne>>>1;return typeof Int32Array<"u"?new Int32Array(ot):ot}(),s=function r(Ne){var ot=0,lt=0,Tt=0,Ot=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(Tt=0;256!=Tt;++Tt)Ot[Tt]=Ne[Tt];for(Tt=0;256!=Tt;++Tt)for(lt=Ne[Tt],ot=256+Tt;ot<4096;ot+=256)lt=Ot[ot]=lt>>>8^Ne[255&lt];var ft=[];for(Tt=1;16!=Tt;++Tt)ft[Tt-1]=typeof Int32Array<"u"?Ot.subarray(256*Tt,256*Tt+256):Ot.slice(256*Tt,256*Tt+256);return ft}(t),l=s[0],h=s[1],g=s[2],x=s[3],E=s[4],D=s[5],O=s[6],N=s[7],B=s[8],W=s[9],V=s[10],X=s[11],le=s[12],oe=s[13],fe=s[14];return e.table=t,e.bstr=function Le(Ne,ot){for(var lt=~ot,Tt=0,Ot=Ne.length;Tt<Ot;)lt=lt>>>8^t[255&(lt^Ne.charCodeAt(Tt++))];return~lt},e.buf=function Ze(Ne,ot){for(var lt=~ot,Tt=Ne.length-15,Ot=0;Ot<Tt;)lt=fe[Ne[Ot++]^255&lt]^oe[Ne[Ot++]^lt>>8&255]^le[Ne[Ot++]^lt>>16&255]^X[Ne[Ot++]^lt>>>24]^V[Ne[Ot++]]^W[Ne[Ot++]]^B[Ne[Ot++]]^N[Ne[Ot++]]^O[Ne[Ot++]]^D[Ne[Ot++]]^E[Ne[Ot++]]^x[Ne[Ot++]]^g[Ne[Ot++]]^h[Ne[Ot++]]^l[Ne[Ot++]]^t[Ne[Ot++]];for(Tt+=15;Ot<Tt;)lt=lt>>>8^t[255&(lt^Ne[Ot++])];return~lt},e.str=function at(Ne,ot){for(var lt=~ot,Tt=0,Ot=Ne.length,ft=0,un=0;Tt<Ot;)(ft=Ne.charCodeAt(Tt++))<128?lt=lt>>>8^t[255&(lt^ft)]:ft<2048?lt=(lt=lt>>>8^t[255&(lt^(192|ft>>6&31))])>>>8^t[255&(lt^(128|63&ft))]:ft>=55296&&ft<57344?(ft=64+(1023&ft),un=1023&Ne.charCodeAt(Tt++),lt=(lt=(lt=(lt=lt>>>8^t[255&(lt^(240|ft>>8&7))])>>>8^t[255&(lt^(128|ft>>2&63))])>>>8^t[255&(lt^(128|un>>6&15|(3&ft)<<4))])>>>8^t[255&(lt^(128|63&un))]):lt=(lt=(lt=lt>>>8^t[255&(lt^(224|ft>>12&15))])>>>8^t[255&(lt^(128|ft>>6&63))])>>>8^t[255&(lt^(128|63&ft))];return~lt},e}(),Mr=function(){var x,n={};function r(ge){if("/"==ge.charAt(ge.length-1))return-1===ge.slice(0,-1).indexOf("/")?ge:r(ge.slice(0,-1));var ze=ge.lastIndexOf("/");return-1===ze?ge:ge.slice(0,ze+1)}function s(ge){if("/"==ge.charAt(ge.length-1))return s(ge.slice(0,-1));var ze=ge.lastIndexOf("/");return-1===ze?ge:ge.slice(ze+1)}function l(ge,ze){"string"==typeof ze&&(ze=new Date(ze));var Ie=ze.getHours();Ie=(Ie=Ie<<6|ze.getMinutes())<<5|ze.getSeconds()>>>1,ge.write_shift(2,Ie);var Re=ze.getFullYear()-1980;Re=(Re=Re<<4|ze.getMonth()+1)<<5|ze.getDate(),ge.write_shift(2,Re)}function g(ge){Xl(ge,0);for(var ze={},Ie=0;ge.l<=ge.length-4;){var Re=ge.read_shift(2),Ve=ge.read_shift(2),je=ge.l+Ve,At={};21589===Re&&(1&(Ie=ge.read_shift(1))&&(At.mtime=ge.read_shift(4)),Ve>5&&(2&Ie&&(At.atime=ge.read_shift(4)),4&Ie&&(At.ctime=ge.read_shift(4))),At.mtime&&(At.mt=new Date(1e3*At.mtime))),ge.l=je,ze[Re]=At}return ze}function E(){return x||(x={})}function D(ge,ze){if(80==ge[0]&&75==ge[1])return sH(ge,ze);if(109==(32|ge[0])&&105==(32|ge[1]))return function Rxe(ge,ze){if("mime-version:"!=Vn(ge.slice(0,13)).toLowerCase())throw new Error("Unsupported MAD header");var Ie=ze&&ze.root||"",Re=(Oi&&Buffer.isBuffer(ge)?ge.toString("binary"):Vn(ge)).split("\r\n"),Ve=0,je="";for(Ve=0;Ve<Re.length;++Ve)if(/^Content-Location:/i.test(je=Re[Ve])&&(je=je.slice(je.indexOf("file")),Ie||(Ie=je.slice(0,je.lastIndexOf("/")+1)),je.slice(0,Ie.length)!=Ie))for(;Ie.length>0&&(Ie=(Ie=Ie.slice(0,Ie.length-1)).slice(0,Ie.lastIndexOf("/")+1),je.slice(0,Ie.length)!=Ie););var At=(Re[1]||"").match(/boundary="(.*?)"/);if(!At)throw new Error("MAD cannot find boundary");var Kt="--"+(At[1]||""),Ft={FileIndex:[],FullPaths:[]};Ne(Ft);var xn,Bn=0;for(Ve=0;Ve<Re.length;++Ve){var mr=Re[Ve];mr!==Kt&&mr!==Kt+"--"||(Bn++&&Oxe(Ft,Re.slice(xn,Ve),Ie),xn=Ve)}return Ft}(ge,ze);if(ge.length<512)throw new Error("CFB file size "+ge.length+" < 512");var Ie,Ve,je,At,Kt,kt,Re=512,It=[],Ft=ge.slice(0,512);Xl(Ft,0);var xn=function O(ge){if(80==ge[ge.l]&&75==ge[ge.l+1])return[0,0];ge.chk(Wn,"Header Signature: "),ge.l+=16;var ze=ge.read_shift(2,"u");return[ge.read_shift(2,"u"),ze]}(Ft);switch(Ie=xn[0]){case 3:Re=512;break;case 4:Re=4096;break;case 0:if(0==xn[1])return sH(ge,ze);default:throw new Error("Major Version: Expected 3 or 4 saw "+Ie)}512!==Re&&Xl(Ft=ge.slice(0,Re),28);var Bn=ge.slice(0,Re);!function N(ge,ze){var Ie;switch(ge.l+=2,Ie=ge.read_shift(2)){case 9:if(3!=ze)throw new Error("Sector Shift: Expected 9 saw "+Ie);break;case 12:if(4!=ze)throw new Error("Sector Shift: Expected 12 saw "+Ie);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Ie)}ge.chk("0600","Mini Sector Shift: "),ge.chk("000000000000","Reserved: ")}(Ft,Ie);var mr=Ft.read_shift(4,"i");if(3===Ie&&0!==mr)throw new Error("# Directory Sectors: Expected 0 saw "+mr);Ft.l+=4,At=Ft.read_shift(4,"i"),Ft.l+=4,Ft.chk("00100000","Mini Stream Cutoff Size: "),Kt=Ft.read_shift(4,"i"),Ve=Ft.read_shift(4,"i"),kt=Ft.read_shift(4,"i"),je=Ft.read_shift(4,"i");for(var zn=-1,$n=0;$n<109&&!((zn=Ft.read_shift(4,"i"))<0);++$n)It[$n]=zn;var li=function B(ge,ze){for(var Ie=Math.ceil(ge.length/ze)-1,Re=[],Ve=1;Ve<Ie;++Ve)Re[Ve-1]=ge.slice(Ve*ze,(Ve+1)*ze);return Re[Ie-1]=ge.slice(Ie*ze),Re}(ge,Re);X(kt,je,li,Re,It);var lo=function oe(ge,ze,Ie,Re){var Ve=ge.length,je=[],At=[],Kt=[],kt=[],It=Re-1,Ft=0,xn=0,Bn=0,mr=0;for(Ft=0;Ft<Ve;++Ft)if(Kt=[],(Bn=Ft+ze)>=Ve&&(Bn-=Ve),!At[Bn]){kt=[];var zn=[];for(xn=Bn;xn>=0;){zn[xn]=!0,At[xn]=!0,Kt[Kt.length]=xn,kt.push(ge[xn]);var $n=Ie[Math.floor(4*xn/Re)];if(Re<4+(mr=4*xn&It))throw new Error("FAT boundary crossed: "+xn+" 4 "+Re);if(!ge[$n]||zn[xn=tv(ge[$n],mr)])break}je[Bn]={nodes:Kt,data:qV([kt])}}return je}(li,At,It,Re);lo[At].name="!Directory",Ve>0&&Kt!==un&&(lo[Kt].name="!MiniFAT"),lo[It[0]].name="!FAT",lo.fat_addrs=It,lo.ssz=Re;var Da=[],sh=[],bS=[];(function fe(ge,ze,Ie,Re,Ve,je,At,Kt){for(var mr,kt=0,It=Re.length?2:0,Ft=ze[ge].data,xn=0,Bn=0;xn<Ft.length;xn+=128){var zn=Ft.slice(xn,xn+128);Xl(zn,64),Bn=zn.read_shift(2),mr=lk(zn,0,Bn-It),Re.push(mr);var $n={name:mr,type:zn.read_shift(1),color:zn.read_shift(1),L:zn.read_shift(4,"i"),R:zn.read_shift(4,"i"),C:zn.read_shift(4,"i"),clsid:zn.read_shift(16),state:zn.read_shift(4,"i"),start:0,size:0};0!==zn.read_shift(2)+zn.read_shift(2)+zn.read_shift(2)+zn.read_shift(2)&&($n.ct=Le(zn,zn.l-8)),0!==zn.read_shift(2)+zn.read_shift(2)+zn.read_shift(2)+zn.read_shift(2)&&($n.mt=Le(zn,zn.l-8)),$n.start=zn.read_shift(4,"i"),$n.size=zn.read_shift(4,"i"),$n.size<0&&$n.start<0&&($n.size=$n.type=0,$n.start=un,$n.name=""),5===$n.type?(kt=$n.start,Ve>0&&kt!==un&&(ze[kt].name="!StreamData")):$n.size>=4096?($n.storage="fat",void 0===ze[$n.start]&&(ze[$n.start]=le(Ie,$n.start,ze.fat_addrs,ze.ssz)),ze[$n.start].name=$n.name,$n.content=ze[$n.start].data.slice(0,$n.size)):($n.storage="minifat",$n.size<0?$n.size=0:kt!==un&&$n.start!==un&&ze[kt]&&($n.content=V($n,ze[kt].data,(ze[Kt]||{}).data))),$n.content&&Xl($n.content,0),je[mr]=$n,At.push($n)}})(At,lo,li,Da,Ve,{},sh,Kt),function W(ge,ze,Ie){for(var Re=0,Ve=0,je=0,At=0,Kt=0,kt=Ie.length,It=[],Ft=[];Re<kt;++Re)It[Re]=Ft[Re]=Re,ze[Re]=Ie[Re];for(;Kt<Ft.length;++Kt)Ve=ge[Re=Ft[Kt]].L,je=ge[Re].R,At=ge[Re].C,It[Re]===Re&&(-1!==Ve&&It[Ve]!==Ve&&(It[Re]=It[Ve]),-1!==je&&It[je]!==je&&(It[Re]=It[je])),-1!==At&&(It[At]=Re),-1!==Ve&&Re!=It[Re]&&(It[Ve]=It[Re],Ft.lastIndexOf(Ve)<Kt&&Ft.push(Ve)),-1!==je&&Re!=It[Re]&&(It[je]=It[Re],Ft.lastIndexOf(je)<Kt&&Ft.push(je));for(Re=1;Re<kt;++Re)It[Re]===Re&&(-1!==je&&It[je]!==je?It[Re]=It[je]:-1!==Ve&&It[Ve]!==Ve&&(It[Re]=It[Ve]));for(Re=1;Re<kt;++Re)if(0!==ge[Re].type){if((Kt=Re)!=It[Kt])do{ze[Re]=ze[Kt=It[Kt]]+"/"+ze[Re]}while(0!==Kt&&-1!==It[Kt]&&Kt!=It[Kt]);It[Re]=-1}for(ze[0]+="/",Re=1;Re<kt;++Re)2!==ge[Re].type&&(ze[Re]+="/")}(sh,bS,Da),Da.shift();var wS={FileIndex:sh,FullPaths:bS};return ze&&ze.raw&&(wS.raw={header:Bn,sectors:li}),wS}function V(ge,ze,Ie){for(var Ve=ge.size,je=[],At=ge.start;Ie&&Ve>0&&At>=0;)je.push(ze.slice(At*ft,At*ft+ft)),Ve-=ft,At=tv(Ie,4*At);return 0===je.length?Xt(0):yl(je).slice(0,ge.size)}function X(ge,ze,Ie,Re,Ve){var je=un;if(ge===un){if(0!==ze)throw new Error("DIFAT chain shorter than expected")}else if(-1!==ge){var At=Ie[ge],Kt=(Re>>>2)-1;if(!At)return;for(var kt=0;kt<Kt&&(je=tv(At,4*kt))!==un;++kt)Ve.push(je);X(tv(At,Re-4),ze-1,Ie,Re,Ve)}}function le(ge,ze,Ie,Re,Ve){var je=[],At=[];Ve||(Ve=[]);var Kt=Re-1,kt=0,It=0;for(kt=ze;kt>=0;){Ve[kt]=!0,je[je.length]=kt,At.push(ge[kt]);var Ft=Ie[Math.floor(4*kt/Re)];if(Re<4+(It=4*kt&Kt))throw new Error("FAT boundary crossed: "+kt+" 4 "+Re);if(!ge[Ft])break;kt=tv(ge[Ft],It)}return{nodes:je,data:qV([At])}}function Le(ge,ze){return new Date(1e3*(xl(ge,ze+4)/1e7*Math.pow(2,32)+xl(ge,ze)/1e7-11644473600))}function Ne(ge,ze){var Ie=ze||{},Re=Ie.root||"Root Entry";if(ge.FullPaths||(ge.FullPaths=[]),ge.FileIndex||(ge.FileIndex=[]),ge.FullPaths.length!==ge.FileIndex.length)throw new Error("inconsistent CFB structure");0===ge.FullPaths.length&&(ge.FullPaths[0]=Re+"/",ge.FileIndex[0]={name:Re,type:5}),Ie.CLSID&&(ge.FileIndex[0].clsid=Ie.CLSID),function ot(ge){var ze="\x01Sh33tJ5";if(!Mr.find(ge,"/"+ze)){var Ie=Xt(4);Ie[0]=55,Ie[1]=Ie[3]=50,Ie[2]=54,ge.FileIndex.push({name:ze,type:2,content:Ie,size:4,L:69,R:69,C:69}),ge.FullPaths.push(ge.FullPaths[0]+ze),lt(ge)}}(ge)}function lt(ge,ze){Ne(ge);for(var Ie=!1,Re=!1,Ve=ge.FullPaths.length-1;Ve>=0;--Ve){var je=ge.FileIndex[Ve];switch(je.type){case 0:Re?Ie=!0:(ge.FileIndex.pop(),ge.FullPaths.pop());break;case 1:case 2:case 5:Re=!0,isNaN(je.R*je.L*je.C)&&(Ie=!0),je.R>-1&&je.L>-1&&je.R==je.L&&(Ie=!0);break;default:Ie=!0}}if(Ie||ze){var At=new Date(1987,1,19),Kt=0,kt=Object.create?Object.create(null):{},It=[];for(Ve=0;Ve<ge.FullPaths.length;++Ve)kt[ge.FullPaths[Ve]]=!0,0!==ge.FileIndex[Ve].type&&It.push([ge.FullPaths[Ve],ge.FileIndex[Ve]]);for(Ve=0;Ve<It.length;++Ve){var Ft=r(It[Ve][0]);(Re=kt[Ft])||(It.push([Ft,{name:s(Ft).replace("/",""),type:1,clsid:pr,ct:At,mt:At,content:null}]),kt[Ft]=!0)}for(It.sort(function(mr,zn){return function t(ge,ze){for(var Ie=ge.split("/"),Re=ze.split("/"),Ve=0,je=0,At=Math.min(Ie.length,Re.length);Ve<At;++Ve){if(je=Ie[Ve].length-Re[Ve].length)return je;if(Ie[Ve]!=Re[Ve])return Ie[Ve]<Re[Ve]?-1:1}return Ie.length-Re.length}(mr[0],zn[0])}),ge.FullPaths=[],ge.FileIndex=[],Ve=0;Ve<It.length;++Ve)ge.FullPaths[Ve]=It[Ve][0],ge.FileIndex[Ve]=It[Ve][1];for(Ve=0;Ve<It.length;++Ve){var xn=ge.FileIndex[Ve],Bn=ge.FullPaths[Ve];if(xn.name=s(Bn).replace("/",""),xn.L=xn.R=xn.C=-(xn.color=1),xn.size=xn.content?xn.content.length:0,xn.start=0,xn.clsid=xn.clsid||pr,0===Ve)xn.C=It.length>1?1:-1,xn.size=0,xn.type=5;else if("/"==Bn.slice(-1)){for(Kt=Ve+1;Kt<It.length&&r(ge.FullPaths[Kt])!=Bn;++Kt);for(xn.C=Kt>=It.length?-1:Kt,Kt=Ve+1;Kt<It.length&&r(ge.FullPaths[Kt])!=r(Bn);++Kt);xn.R=Kt>=It.length?-1:Kt,xn.type=1}else r(ge.FullPaths[Ve+1]||"")==r(Bn)&&(xn.R=Ve+1),xn.type=2}}}function Tt(ge,ze){var Ie=ze||{};if("mad"==Ie.fileType)return function Pxe(ge,ze){for(var Ie=ze||{},Re=Ie.boundary||"SheetJS",Ve=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+(Re="------="+Re).slice(2)+'"',"","",""],je=ge.FullPaths[0],At=je,Kt=ge.FileIndex[0],kt=1;kt<ge.FullPaths.length;++kt)if(At=ge.FullPaths[kt].slice(je.length),(Kt=ge.FileIndex[kt]).size&&Kt.content&&"\x01Sh33tJ5"!=At){At=At.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(li){return"_x"+li.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(li){return"_u"+li.charCodeAt(0).toString(16)+"_"});for(var It=Kt.content,Ft=Oi&&Buffer.isBuffer(It)?It.toString("binary"):Vn(It),xn=0,Bn=Math.min(1024,Ft.length),mr=0,zn=0;zn<=Bn;++zn)(mr=Ft.charCodeAt(zn))>=32&&mr<128&&++xn;var $n=xn>=4*Bn/5;Ve.push(Re),Ve.push("Content-Location: "+(Ie.root||"file:///C:/SheetJS/")+At),Ve.push("Content-Transfer-Encoding: "+($n?"quoted-printable":"base64")),Ve.push("Content-Type: "+Mxe(Kt,At)),Ve.push(""),Ve.push($n?Ixe(Ft):Axe(Ft))}return Ve.push(Re+"--\r\n"),Ve.join("\r\n")}(ge,Ie);if("zip"===(lt(ge),Ie.fileType))return function Dxe(ge,ze){var Ie=ze||{},Re=[],Ve=[],je=Xt(1),At=Ie.compression?8:0,Kt=0,It=0,Ft=0,xn=0,Bn=0,mr=ge.FullPaths[0],zn=mr,$n=ge.FileIndex[0],li=[],lo=0;for(It=1;It<ge.FullPaths.length;++It)if(zn=ge.FullPaths[It].slice(mr.length),($n=ge.FileIndex[It]).size&&$n.content&&"\x01Sh33tJ5"!=zn){var gu=xn,Da=Xt(zn.length);for(Ft=0;Ft<zn.length;++Ft)Da.write_shift(1,127&zn.charCodeAt(Ft));Da=Da.slice(0,Da.l),li[Bn]=ioe.buf($n.content,0);var sh=$n.content;8==At&&(sh=rt(sh)),(je=Xt(30)).write_shift(4,67324752),je.write_shift(2,20),je.write_shift(2,Kt),je.write_shift(2,At),$n.mt?l(je,$n.mt):je.write_shift(4,0),je.write_shift(-4,8&Kt?0:li[Bn]),je.write_shift(4,8&Kt?0:sh.length),je.write_shift(4,8&Kt?0:$n.content.length),je.write_shift(2,Da.length),je.write_shift(2,0),xn+=je.length,Re.push(je),xn+=Da.length,Re.push(Da),xn+=sh.length,Re.push(sh),8&Kt&&((je=Xt(12)).write_shift(-4,li[Bn]),je.write_shift(4,sh.length),je.write_shift(4,$n.content.length),xn+=je.l,Re.push(je)),(je=Xt(46)).write_shift(4,33639248),je.write_shift(2,0),je.write_shift(2,20),je.write_shift(2,Kt),je.write_shift(2,At),je.write_shift(4,0),je.write_shift(-4,li[Bn]),je.write_shift(4,sh.length),je.write_shift(4,$n.content.length),je.write_shift(2,Da.length),je.write_shift(2,0),je.write_shift(2,0),je.write_shift(2,0),je.write_shift(2,0),je.write_shift(4,0),je.write_shift(4,gu),lo+=je.l,Ve.push(je),lo+=Da.length,Ve.push(Da),++Bn}return(je=Xt(22)).write_shift(4,101010256),je.write_shift(2,0),je.write_shift(2,0),je.write_shift(2,Bn),je.write_shift(2,Bn),je.write_shift(4,lo),je.write_shift(4,xn),je.write_shift(2,0),yl([yl(Re),yl(Ve),je])}(ge,Ie);var Re=function(mr){for(var zn=0,$n=0,li=0;li<mr.FileIndex.length;++li){var lo=mr.FileIndex[li];if(lo.content){var gu=lo.content.length;gu>0&&(gu<4096?zn+=gu+63>>6:$n+=gu+511>>9)}}for(var Da=mr.FullPaths.length+3>>2,bS=zn+127>>7,wS=(zn+7>>3)+$n+Da+bS,Ev=wS+127>>7,nL=Ev<=109?0:Math.ceil((Ev-109)/127);wS+Ev+nL+127>>7>Ev;)nL=++Ev<=109?0:Math.ceil((Ev-109)/127);var Og=[1,nL,Ev,bS,Da,$n,zn,0];return mr.FileIndex[0].size=zn<<6,Og[7]=(mr.FileIndex[0].start=Og[0]+Og[1]+Og[2]+Og[3]+Og[4]+Og[5])+(Og[6]+7>>3),Og}(ge),Ve=Xt(Re[7]<<9),je=0,At=0;for(je=0;je<8;++je)Ve.write_shift(1,On[je]);for(je=0;je<8;++je)Ve.write_shift(2,0);for(Ve.write_shift(2,62),Ve.write_shift(2,3),Ve.write_shift(2,65534),Ve.write_shift(2,9),Ve.write_shift(2,6),je=0;je<3;++je)Ve.write_shift(2,0);for(Ve.write_shift(4,0),Ve.write_shift(4,Re[2]),Ve.write_shift(4,Re[0]+Re[1]+Re[2]+Re[3]-1),Ve.write_shift(4,0),Ve.write_shift(4,4096),Ve.write_shift(4,Re[3]?Re[0]+Re[1]+Re[2]-1:un),Ve.write_shift(4,Re[3]),Ve.write_shift(-4,Re[1]?Re[0]-1:un),Ve.write_shift(4,Re[1]),je=0;je<109;++je)Ve.write_shift(-4,je<Re[2]?Re[1]+je:-1);if(Re[1])for(At=0;At<Re[1];++At){for(;je<236+127*At;++je)Ve.write_shift(-4,je<Re[2]?Re[1]+je:-1);Ve.write_shift(-4,At===Re[1]-1?un:At+1)}var Kt=function(mr){for(At+=mr;je<At-1;++je)Ve.write_shift(-4,je+1);mr&&(++je,Ve.write_shift(-4,un))};for(At=je=0,At+=Re[1];je<At;++je)Ve.write_shift(-4,er.DIFSECT);for(At+=Re[2];je<At;++je)Ve.write_shift(-4,er.FATSECT);Kt(Re[3]),Kt(Re[4]);for(var kt=0,It=0,Ft=ge.FileIndex[0];kt<ge.FileIndex.length;++kt)(Ft=ge.FileIndex[kt]).content&&!((It=Ft.content.length)<4096)&&(Ft.start=At,Kt(It+511>>9));for(Kt(Re[6]+7>>3);511&Ve.l;)Ve.write_shift(-4,er.ENDOFCHAIN);for(At=je=0,kt=0;kt<ge.FileIndex.length;++kt)(Ft=ge.FileIndex[kt]).content&&(It=Ft.content.length)&&!(It>=4096)&&(Ft.start=At,Kt(It+63>>6));for(;511&Ve.l;)Ve.write_shift(-4,er.ENDOFCHAIN);for(je=0;je<Re[4]<<2;++je){var xn=ge.FullPaths[je];if(xn&&0!==xn.length){Ft=ge.FileIndex[je],0===je&&(Ft.start=Ft.size?Ft.start-1:un);var Bn=0===je&&Ie.root||Ft.name;if(It=2*(Bn.length+1),Ve.write_shift(64,Bn,"utf16le"),Ve.write_shift(2,It),Ve.write_shift(1,Ft.type),Ve.write_shift(1,Ft.color),Ve.write_shift(-4,Ft.L),Ve.write_shift(-4,Ft.R),Ve.write_shift(-4,Ft.C),Ft.clsid)Ve.write_shift(16,Ft.clsid,"hex");else for(kt=0;kt<4;++kt)Ve.write_shift(4,0);Ve.write_shift(4,Ft.state||0),Ve.write_shift(4,0),Ve.write_shift(4,0),Ve.write_shift(4,0),Ve.write_shift(4,0),Ve.write_shift(4,Ft.start),Ve.write_shift(4,Ft.size),Ve.write_shift(4,0)}else{for(kt=0;kt<17;++kt)Ve.write_shift(4,0);for(kt=0;kt<3;++kt)Ve.write_shift(4,-1);for(kt=0;kt<12;++kt)Ve.write_shift(4,0)}}for(je=1;je<ge.FileIndex.length;++je)if((Ft=ge.FileIndex[je]).size>=4096)if(Ve.l=Ft.start+1<<9,Oi&&Buffer.isBuffer(Ft.content))Ft.content.copy(Ve,Ve.l,0,Ft.size),Ve.l+=Ft.size+511&-512;else{for(kt=0;kt<Ft.size;++kt)Ve.write_shift(1,Ft.content[kt]);for(;511&kt;++kt)Ve.write_shift(1,0)}for(je=1;je<ge.FileIndex.length;++je)if((Ft=ge.FileIndex[je]).size>0&&Ft.size<4096)if(Oi&&Buffer.isBuffer(Ft.content))Ft.content.copy(Ve,Ve.l,0,Ft.size),Ve.l+=Ft.size+63&-64;else{for(kt=0;kt<Ft.size;++kt)Ve.write_shift(1,Ft.content[kt]);for(;63&kt;++kt)Ve.write_shift(1,0)}if(Oi)Ve.l=Ve.length;else for(;Ve.l<Ve.length;)Ve.write_shift(1,0);return Ve}n.version="1.2.1";var nn,ft=64,un=-2,Wn="d0cf11e0a1b11ae1",On=[208,207,17,224,161,177,26,225],pr="00000000000000000000000000000000",er={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:un,FREESECT:-1,HEADER_SIGNATURE:Wn,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:pr,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Vn(ge){for(var ze=new Array(ge.length),Ie=0;Ie<ge.length;++Ie)ze[Ie]=String.fromCharCode(ge[Ie]);return ze.join("")}function rt(ge){return nn?nn.deflateRawSync(ge):Ni(ge)}for(var ge,ze,et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Yt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],jn=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Sn=typeof Uint8Array<"u",rn=Sn?new Uint8Array(256):[],ai=0;ai<256;++ai)rn[ai]=(void 0,255&((ze=139536&((ge=ai)<<1|ge<<11)|558144&(ge<<5|ge<<15))>>16|ze>>8|ze));function We(ge,ze){var Ie=rn[255&ge];return ze<=8?Ie>>>8-ze:(Ie=Ie<<8|rn[ge>>8&255],ze<=16?Ie>>>16-ze:(Ie=Ie<<8|rn[ge>>16&255])>>>24-ze)}function os(ge,ze){var Ie=7&ze,Re=ze>>>3;return(ge[Re]|(Ie<=6?0:ge[Re+1]<<8))>>>Ie&3}function Ri(ge,ze){var Ie=7&ze,Re=ze>>>3;return(ge[Re]|(Ie<=5?0:ge[Re+1]<<8))>>>Ie&7}function Mi(ge,ze){var Ie=7&ze,Re=ze>>>3;return(ge[Re]|(Ie<=3?0:ge[Re+1]<<8))>>>Ie&31}function Gn(ge,ze){var Ie=7&ze,Re=ze>>>3;return(ge[Re]|(Ie<=1?0:ge[Re+1]<<8))>>>Ie&127}function Co(ge,ze,Ie){var Re=7&ze,Ve=ze>>>3,At=ge[Ve]>>>Re;return Ie<8-Re||(At|=ge[Ve+1]<<8-Re,Ie<16-Re)||(At|=ge[Ve+2]<<16-Re,Ie<24-Re)||(At|=ge[Ve+3]<<24-Re),At&(1<<Ie)-1}function pu(ge,ze,Ie){var Re=7&ze,Ve=ze>>>3;return Re<=5?ge[Ve]|=(7&Ie)<<Re:(ge[Ve]|=Ie<<Re&255,ge[Ve+1]=(7&Ie)>>8-Re),ze+3}function El(ge,ze,Ie){return ge[ze>>>3]|=Ie=(1&Ie)<<(7&ze),ze+1}function mu(ge,ze,Ie){var Ve=ze>>>3;return ge[Ve]|=255&(Ie<<=7&ze),ge[Ve+1]=Ie>>>=8,ze+8}function L_(ge,ze,Ie){var Ve=ze>>>3;return ge[Ve]|=255&(Ie<<=7&ze),ge[Ve+1]=255&(Ie>>>=8),ge[Ve+2]=Ie>>>8,ze+16}function wf(ge,ze){var Ie=ge.length,Re=2*Ie>ze?2*Ie:ze+5,Ve=0;if(Ie>=ze)return ge;if(Oi){var je=aV(Re);if(ge.copy)ge.copy(je);else for(;Ve<ge.length;++Ve)je[Ve]=ge[Ve];return je}if(Sn){var At=new Uint8Array(Re);if(At.set)At.set(ge);else for(;Ve<Ie;++Ve)At[Ve]=ge[Ve];return At}return ge.length=Re,ge}function Kl(ge){for(var ze=new Array(ge),Ie=0;Ie<ge;++Ie)ze[Ie]=0;return ze}function pd(ge,ze,Ie){var Re=1,Ve=0,je=0,At=0,Kt=0,kt=ge.length,It=Sn?new Uint16Array(32):Kl(32);for(je=0;je<32;++je)It[je]=0;for(je=kt;je<Ie;++je)ge[je]=0;kt=ge.length;var Ft=Sn?new Uint16Array(kt):Kl(kt);for(je=0;je<kt;++je)It[Ve=ge[je]]++,Re<Ve&&(Re=Ve),Ft[je]=0;for(It[0]=0,je=1;je<=Re;++je)It[je+16]=Kt=Kt+It[je-1]<<1;for(je=0;je<kt;++je)0!=(Kt=ge[je])&&(Ft[je]=It[Kt+16]++);var xn=0;for(je=0;je<kt;++je)if(0!=(xn=ge[je]))for(Kt=We(Ft[je],Re)>>Re-xn,At=(1<<Re+4-xn)-1;At>=0;--At)ze[Kt|At<<xn]=15&xn|je<<4;return Re}var Tf=Sn?new Uint16Array(512):Kl(512),B_=Sn?new Uint16Array(32):Kl(32);if(!Sn){for(var Cl=0;Cl<512;++Cl)Tf[Cl]=0;for(Cl=0;Cl<32;++Cl)B_[Cl]=0}!function(){for(var ge=[],ze=0;ze<32;ze++)ge.push(5);pd(ge,B_,32);var Ie=[];for(ze=0;ze<=143;ze++)Ie.push(8);for(;ze<=255;ze++)Ie.push(9);for(;ze<=279;ze++)Ie.push(7);for(;ze<=287;ze++)Ie.push(8);pd(Ie,Tf,288)}();var om=function(){for(var ze=Sn?new Uint8Array(32768):[],Ie=0,Re=0;Ie<jn.length-1;++Ie)for(;Re<jn[Ie+1];++Re)ze[Re]=Ie;for(;Re<32768;++Re)ze[Re]=29;var Ve=Sn?new Uint8Array(259):[];for(Ie=0,Re=0;Ie<Yt.length-1;++Ie)for(;Re<Yt[Ie+1];++Re)Ve[Re]=Ie;return function(kt,It){return kt.length<8?function je(Kt,kt){for(var It=0;It<Kt.length;){var Ft=Math.min(65535,Kt.length-It);for(kt.write_shift(1,+(It+Ft==Kt.length)),kt.write_shift(2,Ft),kt.write_shift(2,65535&~Ft);Ft-- >0;)kt[kt.l++]=Kt[It++]}return kt.l}(kt,It):function At(Kt,kt){for(var It=0,Ft=0,xn=Sn?new Uint16Array(32768):[];Ft<Kt.length;){var Bn=Math.min(65535,Kt.length-Ft);if(Bn<10){for(7&(It=pu(kt,It,+(Ft+Bn==Kt.length)))&&(It+=8-(7&It)),kt.l=It/8|0,kt.write_shift(2,Bn),kt.write_shift(2,65535&~Bn);Bn-- >0;)kt[kt.l++]=Kt[Ft++];It=8*kt.l}else{It=pu(kt,It,+(Ft+Bn==Kt.length)+2);for(var mr=0;Bn-- >0;){var zn=Kt[Ft],$n=-1,li=0;if(($n=xn[mr=32767&(mr<<5^zn)])&&(($n|=-32768&Ft)>Ft&&($n-=32768),$n<Ft))for(;Kt[$n+li]==Kt[Ft+li]&&li<250;)++li;if(li>2){(zn=Ve[li])<=22?It=mu(kt,It,rn[zn+1]>>1)-1:(mu(kt,It,3),mu(kt,It+=5,rn[zn-23]>>5),It+=3);var lo=zn<8?0:zn-4>>2;lo>0&&(L_(kt,It,li-Yt[zn]),It+=lo),It=mu(kt,It,rn[zn=ze[Ft-$n]]>>3),It-=3;var gu=zn<4?0:zn-2>>1;gu>0&&(L_(kt,It,Ft-$n-jn[zn]),It+=gu);for(var Da=0;Da<li;++Da)xn[mr]=32767&Ft,mr=32767&(mr<<5^Kt[Ft]),++Ft;Bn-=li-1}else zn<=143?zn+=48:It=El(kt,It,1),It=mu(kt,It,rn[zn]),xn[mr]=32767&Ft,++Ft}It=mu(kt,It,0)-1}}return kt.l=(It+7)/8|0,kt.l}(kt,It)}}();function Ni(ge){var ze=Xt(50+Math.floor(1.1*ge.length)),Ie=om(ge,ze);return ze.slice(0,Ie)}var ia=Sn?new Uint16Array(32768):Kl(32768),md=Sn?new Uint16Array(32768):Kl(32768),Xa=Sn?new Uint16Array(128):Kl(128),Tv=1,nH=1;function Exe(ge,ze){var Ie=Mi(ge,ze)+257,Re=Mi(ge,ze+=5)+1,Ve=function gs(ge,ze){var Ie=7&ze,Re=ze>>>3;return(ge[Re]|(Ie<=4?0:ge[Re+1]<<8))>>>Ie&15}(ge,ze+=5)+4;ze+=4;for(var je=0,At=Sn?new Uint8Array(19):Kl(19),Kt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],kt=1,It=Sn?new Uint8Array(8):Kl(8),Ft=Sn?new Uint8Array(8):Kl(8),xn=At.length,Bn=0;Bn<Ve;++Bn)At[et[Bn]]=je=Ri(ge,ze),kt<je&&(kt=je),It[je]++,ze+=3;var mr=0;for(It[0]=0,Bn=1;Bn<=kt;++Bn)Ft[Bn]=mr=mr+It[Bn-1]<<1;for(Bn=0;Bn<xn;++Bn)0!=(mr=At[Bn])&&(Kt[Bn]=Ft[mr]++);var zn=0;for(Bn=0;Bn<xn;++Bn)if(0!=(zn=At[Bn])){mr=rn[Kt[Bn]]>>8-zn;for(var $n=(1<<7-zn)-1;$n>=0;--$n)Xa[mr|$n<<zn]=7&zn|Bn<<3}var li=[];for(kt=1;li.length<Ie+Re;)switch(mr=Xa[Gn(ge,ze)],ze+=7&mr,mr>>>=3){case 16:for(je=3+os(ge,ze),ze+=2,mr=li[li.length-1];je-- >0;)li.push(mr);break;case 17:for(je=3+Ri(ge,ze),ze+=3;je-- >0;)li.push(0);break;case 18:for(je=11+Gn(ge,ze),ze+=7;je-- >0;)li.push(0);break;default:li.push(mr),kt<mr&&(kt=mr)}var lo=li.slice(0,Ie),gu=li.slice(Ie);for(Bn=Ie;Bn<286;++Bn)lo[Bn]=0;for(Bn=Re;Bn<30;++Bn)gu[Bn]=0;return Tv=pd(lo,ia,286),nH=pd(gu,md,30),ze}function rH(ge,ze){var Re=function Cxe(ge,ze){if(3==ge[0]&&!(3&ge[1]))return[E_(ze),2];for(var Ie=0,Re=0,Ve=aV(ze||1<<18),je=0,At=Ve.length>>>0,Kt=0,kt=0;!(1&Re);)if(Re=Ri(ge,Ie),Ie+=3,Re>>>1)for(Re>>1==1?(Kt=9,kt=5):(Ie=Exe(ge,Ie),Kt=Tv,kt=nH);;){!ze&&At<je+32767&&(At=(Ve=wf(Ve,je+32767)).length);var Ft=Co(ge,Ie,Kt),xn=Re>>>1==1?Tf[Ft]:ia[Ft];if(Ie+=15&xn,(xn>>>=4)>>>8&255){if(256==xn)break;var Bn=(xn-=257)<8?0:xn-4>>2;Bn>5&&(Bn=0);var mr=je+Yt[xn];Bn>0&&(mr+=Co(ge,Ie,Bn),Ie+=Bn),Ft=Co(ge,Ie,kt),Ie+=15&(xn=Re>>>1==1?B_[Ft]:md[Ft]);var zn=(xn>>>=4)<4?0:xn-2>>1,$n=jn[xn];for(zn>0&&($n+=Co(ge,Ie,zn),Ie+=zn),!ze&&At<mr&&(At=(Ve=wf(Ve,mr+100)).length);je<mr;)Ve[je]=Ve[je-$n],++je}else Ve[je++]=xn}else{7&Ie&&(Ie+=8-(7&Ie));var It=ge[Ie>>>3]|ge[1+(Ie>>>3)]<<8;if(Ie+=32,It>0)for(!ze&&At<je+It&&(At=(Ve=wf(Ve,je+It)).length);It-- >0;)Ve[je++]=ge[Ie>>>3],Ie+=8}return ze?[Ve,Ie+7>>>3]:[Ve.slice(0,je),Ie+7>>>3]}(ge.slice(ge.l||0),ze);return ge.l+=Re[1],Re[0]}function iH(ge,ze){if(!ge)throw new Error(ze);typeof console<"u"&&console.error(ze)}function sH(ge,ze){var Ie=ge;Xl(Ie,0);var je={FileIndex:[],FullPaths:[]};Ne(je,{root:ze.root});for(var At=Ie.length-4;(80!=Ie[At]||75!=Ie[At+1]||5!=Ie[At+2]||6!=Ie[At+3])&&At>=0;)--At;Ie.l=At+4,Ie.l+=4;var Kt=Ie.read_shift(2);Ie.l+=6;var kt=Ie.read_shift(4);for(Ie.l=kt,At=0;At<Kt;++At){Ie.l+=20;var It=Ie.read_shift(4),Ft=Ie.read_shift(4),xn=Ie.read_shift(2),Bn=Ie.read_shift(2),mr=Ie.read_shift(2);Ie.l+=8;var zn=Ie.read_shift(4),$n=g(Ie.slice(Ie.l+xn,Ie.l+xn+Bn));Ie.l+=xn+Bn+mr;var li=Ie.l;Ie.l=zn+4,Sxe(Ie,It,Ft,je,$n),Ie.l=li}return je}function Sxe(ge,ze,Ie,Re,Ve){ge.l+=2;var je=ge.read_shift(2),At=ge.read_shift(2),Kt=function h(ge){var ze=65535&ge.read_shift(2),Ie=65535&ge.read_shift(2),Re=new Date,Ve=31&Ie,je=15&(Ie>>>=5);Ie>>>=4,Re.setMilliseconds(0),Re.setFullYear(Ie+1980),Re.setMonth(je-1),Re.setDate(Ve);var At=31&ze,Kt=63&(ze>>>=5);return Re.setHours(ze>>>=6),Re.setMinutes(Kt),Re.setSeconds(At<<1),Re}(ge);if(8257&je)throw new Error("Unsupported ZIP encryption");ge.read_shift(4);for(var It=ge.read_shift(4),Ft=ge.read_shift(4),xn=ge.read_shift(2),Bn=ge.read_shift(2),mr="",zn=0;zn<xn;++zn)mr+=String.fromCharCode(ge[ge.l++]);if(Bn){var $n=g(ge.slice(ge.l,ge.l+Bn));($n[21589]||{}).mt&&(Kt=$n[21589].mt),((Ve||{})[21589]||{}).mt&&(Kt=Ve[21589].mt)}ge.l+=Bn;var li=ge.slice(ge.l,ge.l+It);switch(At){case 8:li=function St(ge,ze){if(!nn)return rH(ge,ze);var Re=new(0,nn.InflateRaw),Ve=Re._processChunk(ge.slice(ge.l),Re._finishFlushFlag);return ge.l+=Re.bytesRead,Ve}(ge,Ft);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+At)}var lo=!1;8&je&&(134695760==ge.read_shift(4)&&(ge.read_shift(4),lo=!0),It=ge.read_shift(4),Ft=ge.read_shift(4)),It!=ze&&iH(lo,"Bad compressed size: "+ze+" != "+It),Ft!=Ie&&iH(lo,"Bad uncompressed size: "+Ie+" != "+Ft),tL(Re,mr,li,{unsafe:!0,mt:Kt})}var Kk={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Mxe(ge,ze){if(ge.ctype)return ge.ctype;var Ie=ge.name||"",Re=Ie.match(/\.([^\.]+)$/);return Re&&Kk[Re[1]]||ze&&(Re=(Ie=ze).match(/[\.\\]([^\.\\])+$/))&&Kk[Re[1]]?Kk[Re[1]]:"application/octet-stream"}function Axe(ge){for(var ze=NC(ge),Ie=[],Re=0;Re<ze.length;Re+=76)Ie.push(ze.slice(Re,Re+76));return Ie.join("\r\n")+"\r\n"}function Ixe(ge){var ze=ge.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(It){var Ft=It.charCodeAt(0).toString(16).toUpperCase();return"="+(1==Ft.length?"0"+Ft:Ft)});"\n"==(ze=ze.replace(/ $/gm,"=20").replace(/\t$/gm,"=09")).charAt(0)&&(ze="=0D"+ze.slice(1));for(var Ie=[],Re=(ze=ze.replace(/\r(?!\n)/gm,"=0D").replace(/\n\n/gm,"\n=0A").replace(/([^\r\n])\n/gm,"$1=0A")).split("\r\n"),Ve=0;Ve<Re.length;++Ve){var je=Re[Ve];if(0!=je.length)for(var At=0;At<je.length;){var Kt=76,kt=je.slice(At,At+Kt);"="==kt.charAt(Kt-1)?Kt--:"="==kt.charAt(Kt-2)?Kt-=2:"="==kt.charAt(Kt-3)&&(Kt-=3),kt=je.slice(At,At+Kt),(At+=Kt)<je.length&&(kt+="="),Ie.push(kt)}else Ie.push("")}return Ie.join("\r\n")}function Oxe(ge,ze,Ie){for(var At,Re="",Ve="",je="",Kt=0;Kt<10;++Kt){var kt=ze[Kt];if(!kt||kt.match(/^\s*$/))break;var It=kt.match(/^(.*?):\s*([^\s].*)$/);if(It)switch(It[1].toLowerCase()){case"content-location":Re=It[2].trim();break;case"content-type":je=It[2].trim();break;case"content-transfer-encoding":Ve=It[2].trim()}}switch(++Kt,Ve.toLowerCase()){case"base64":At=Ju(Ku(ze.slice(Kt).join("")));break;case"quoted-printable":At=function kxe(ge){for(var ze=[],Ie=0;Ie<ge.length;++Ie){for(var Re=ge[Ie];Ie<=ge.length&&"="==Re.charAt(Re.length-1);)Re=Re.slice(0,Re.length-1)+ge[++Ie];ze.push(Re)}for(var Ve=0;Ve<ze.length;++Ve)ze[Ve]=ze[Ve].replace(/[=][0-9A-Fa-f]{2}/g,function(je){return String.fromCharCode(parseInt(je.slice(1),16))});return Ju(ze.join("\r\n"))}(ze.slice(Kt));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+Ve)}var Ft=tL(ge,Re.slice(Ie.length),At,{unsafe:!0});je&&(Ft.ctype=je)}function tL(ge,ze,Ie,Re){var Ve=Re&&Re.unsafe;Ve||Ne(ge);var je=!Ve&&Mr.find(ge,ze);if(!je){var At=ge.FullPaths[0];ze.slice(0,At.length)==At?At=ze:("/"!=At.slice(-1)&&(At+="/"),At=(At+ze).replace("//","/")),je={name:s(ze),type:2},ge.FileIndex.push(je),ge.FullPaths.push(At),Ve||Mr.utils.cfb_gc(ge)}return je.content=Ie,je.size=Ie?Ie.length:0,Re&&(Re.CLSID&&(je.clsid=Re.CLSID),Re.mt&&(je.mt=Re.mt),Re.ct&&(je.ct=Re.ct)),je}return n.find=function Ot(ge,ze){var Ie=ge.FullPaths.map(function(kt){return kt.toUpperCase()}),Re=Ie.map(function(kt){var It=kt.split("/");return It[It.length-("/"==kt.slice(-1)?2:1)]}),Ve=!1;47===ze.charCodeAt(0)?(Ve=!0,ze=Ie[0].slice(0,-1)+ze):Ve=-1!==ze.indexOf("/");var je=ze.toUpperCase(),At=!0===Ve?Ie.indexOf(je):Re.indexOf(je);if(-1!==At)return ge.FileIndex[At];var Kt=!je.match(LC);for(je=je.replace(dc,""),Kt&&(je=je.replace(LC,"!")),At=0;At<Ie.length;++At)if((Kt?Ie[At].replace(LC,"!"):Ie[At]).replace(dc,"")==je||(Kt?Re[At].replace(LC,"!"):Re[At]).replace(dc,"")==je)return ge.FileIndex[At];return null},n.read=function at(ge,ze){var Ie=ze&&ze.type;switch(Ie||Oi&&Buffer.isBuffer(ge)&&(Ie="buffer"),Ie||"base64"){case"file":return function Ze(ge,ze){return E(),D(x.readFileSync(ge),ze)}(ge,ze);case"base64":return D(Ju(Ku(ge)),ze);case"binary":return D(Ju(ge),ze)}return D(ge,ze)},n.parse=D,n.write=function Or(ge,ze){var Ie=Tt(ge,ze);switch(ze&&ze.type||"buffer"){case"file":return E(),x.writeFileSync(ze.filename,Ie),Ie;case"binary":return"string"==typeof Ie?Ie:Vn(Ie);case"base64":return NC("string"==typeof Ie?Ie:Vn(Ie));case"buffer":if(Oi)return Buffer.isBuffer(Ie)?Ie:Tg(Ie);case"array":return"string"==typeof Ie?Ju(Ie):Ie}return Ie},n.writeFile=function yi(ge,ze,Ie){E();var Re=Tt(ge,Ie);x.writeFileSync(ze,Re)},n.utils={cfb_new:function Nxe(ge){var ze={};return Ne(ze,ge),ze},cfb_add:tL,cfb_del:function Fxe(ge,ze){Ne(ge);var Ie=Mr.find(ge,ze);if(Ie)for(var Re=0;Re<ge.FileIndex.length;++Re)if(ge.FileIndex[Re]==Ie)return ge.FileIndex.splice(Re,1),ge.FullPaths.splice(Re,1),!0;return!1},cfb_mov:function Lxe(ge,ze,Ie){Ne(ge);var Re=Mr.find(ge,ze);if(Re)for(var Ve=0;Ve<ge.FileIndex.length;++Ve)if(ge.FileIndex[Ve]==Re)return ge.FileIndex[Ve].name=s(Ie),ge.FullPaths[Ve]=Ie,!0;return!1},cfb_gc:function Bxe(ge){lt(ge,!0)},ReadShift:HC,CheckField:sj,prep_blob:Xl,bconcat:yl,use_zlib:function qe(ge){try{var Ie=new(0,ge.InflateRaw);if(Ie._processChunk(new Uint8Array([3,0]),Ie._finishFlushFlag),!Ie.bytesRead)throw new Error("zlib does not expose bytesRead");nn=ge}catch(Re){console.error("cannot use native zlib: "+(Re.message||Re))}},_deflateRaw:Ni,_inflateRaw:rH,consts:er},n}();let M_;function soe(e){return"string"==typeof e?FC(e):Array.isArray(e)?function Ise(e){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(e)}(e):e}function UC(e,n,t){if(typeof M_<"u"&&M_.writeFileSync)return t?M_.writeFileSync(e,n,t):M_.writeFileSync(e,n);if(typeof Deno<"u"){if(t&&"string"==typeof n)switch(t){case"utf8":n=new TextEncoder(t).encode(n);break;case"binary":n=FC(n);break;default:throw new Error("Unsupported encoding "+t)}return Deno.writeFileSync(e,n)}var r="utf8"==t?Qp(n):n;if(typeof IE_SaveFile<"u")return IE_SaveFile(r,e);if(typeof Blob<"u"){var s=new Blob([soe(r)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(s,e);if(typeof saveAs<"u")return saveAs(s,e);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var l=URL.createObjectURL(s);if("object"==typeof chrome&&"function"==typeof(chrome.downloads||{}).download)return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(l)},6e4),chrome.downloads.download({url:l,filename:e,saveAs:!0});var h=document.createElement("a");if(null!=h.download)return h.download=e,h.href=l,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(l)},6e4),l}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var g=File(e);return g.open("w"),g.encoding="binary",Array.isArray(n)&&(n=C_(n)),g.write(n),g.close(),n}catch(x){if(!x.message||!x.message.match(/onstruct/))throw x}throw new Error("cannot save file "+e)}function No(e){for(var n=Object.keys(e),t=[],r=0;r<n.length;++r)Object.prototype.hasOwnProperty.call(e,n[r])&&t.push(n[r]);return t}function SV(e,n){for(var t=[],r=No(e),s=0;s!==r.length;++s)null==t[e[r[s]][n]]&&(t[e[r[s]][n]]=r[s]);return t}function ik(e){for(var n=[],t=No(e),r=0;r!==t.length;++r)n[e[t[r]]]=t[r];return n}function sk(e){for(var n=[],t=No(e),r=0;r!==t.length;++r)n[e[t[r]]]=parseInt(t[r],10);return n}var ok=new Date(1899,11,30,0,0,0);function vl(e,n){var t=e.getTime();return n&&(t-=1263168e5),(t-(ok.getTime()+6e4*(e.getTimezoneOffset()-ok.getTimezoneOffset())))/864e5}var DV=new Date,loe=ok.getTime()+6e4*(DV.getTimezoneOffset()-ok.getTimezoneOffset()),MV=DV.getTimezoneOffset();function mF(e){var n=new Date;return n.setTime(24*e*60*60*1e3+loe),n.getTimezoneOffset()!==MV&&n.setTime(n.getTime()+6e4*(n.getTimezoneOffset()-MV)),n}var AV=new Date("2017-02-19T19:06:09.000Z"),IV=isNaN(AV.getFullYear())?new Date("2/19/17"):AV,uoe=2017==IV.getFullYear();function Eo(e,n){var t=new Date(e);if(uoe)return n>0?t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3):n<0&&t.setTime(t.getTime()-60*t.getTimezoneOffset()*1e3),t;if(e instanceof Date)return e;if(1917==IV.getFullYear()&&!isNaN(t.getFullYear())){var r=t.getFullYear();return e.indexOf(""+r)>-1||t.setFullYear(t.getFullYear()+100),t}var s=e.match(/\d+/g)||["2017","2","19","0","0","0"],l=new Date(+s[0],+s[1]-1,+s[2],+s[3]||0,+s[4]||0,+s[5]||0);return e.indexOf("Z")>-1&&(l=new Date(l.getTime()-60*l.getTimezoneOffset()*1e3)),l}function ev(e,n){if(Oi&&Buffer.isBuffer(e)){if(n){if(255==e[0]&&254==e[1])return Qp(e.slice(2).toString("utf16le"));if(254==e[1]&&255==e[2])return Qp(function oV(e){for(var n=[],t=0;t<e.length>>1;++t)n[t]=String.fromCharCode(e.charCodeAt(2*t+1)+(e.charCodeAt(2*t)<<8));return n.join("")}(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(n){if(255==e[0]&&254==e[1])return Qp(new TextDecoder("utf-16le").decode(e.slice(2)));if(254==e[0]&&255==e[1])return Qp(new TextDecoder("utf-16be").decode(e.slice(2)))}var t={"\u20ac":"\x80","\u201a":"\x82",\u0192:"\x83","\u201e":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87",\u02c6:"\x88","\u2030":"\x89",\u0160:"\x8a","\u2039":"\x8b",\u0152:"\x8c",\u017d:"\x8e","\u2018":"\x91","\u2019":"\x92","\u201c":"\x93","\u201d":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02dc":"\x98","\u2122":"\x99",\u0161:"\x9a","\u203a":"\x9b",\u0153:"\x9c",\u017e:"\x9e",\u0178:"\x9f"};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[\u20ac\u201a\u0192\u201e\u2026\u2020\u2021\u02c6\u2030\u0160\u2039\u0152\u017d\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u02dc\u2122\u0161\u203a\u0153\u017e\u0178]/g,function(l){return t[l]||l})}catch{}for(var r=[],s=0;s!=e.length;++s)r.push(String.fromCharCode(e[s]));return r.join("")}function Gs(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if("object"!=typeof e||null==e)return e;if(e instanceof Date)return new Date(e.getTime());var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=Gs(e[t]));return n}function Fo(e,n){for(var t="";t.length<n;)t+=e;return t}function gf(e){var n=Number(e);if(!isNaN(n))return isFinite(n)?n:NaN;if(!/\d/.test(e))return n;var t=1,r=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return t*=100,""});return isNaN(n=Number(r))&&(r=r.replace(/[(](.*)[)]/,function(s,l){return t=-t,l}),isNaN(n=Number(r)))?n:n/t}var hoe=["january","february","march","april","may","june","july","august","september","october","november","december"];function Aw(e){var n=new Date(e),t=new Date(NaN),r=n.getYear(),s=n.getMonth(),l=n.getDate();if(isNaN(l))return t;var h=e.toLowerCase();if(h.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if((h=h.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,"")).length>3&&-1==hoe.indexOf(h))return t}else if(h.match(/[a-z]/))return t;return r<0||r>8099?t:(s>0||l>1)&&101!=r?n:e.match(/[^-0-9:,\/\\]/)?t:n}function Ei(e,n,t){if(e.FullPaths){var r;if("string"==typeof t)return r=Oi?Tg(t):function kse(e){for(var n=[],t=0,r=e.length+250,s=E_(e.length+255),l=0;l<e.length;++l){var h=e.charCodeAt(l);if(h<128)s[t++]=h;else if(h<2048)s[t++]=192|h>>6&31,s[t++]=128|63&h;else if(h>=55296&&h<57344){h=64+(1023&h);var g=1023&e.charCodeAt(++l);s[t++]=240|h>>8&7,s[t++]=128|h>>2&63,s[t++]=128|g>>6&15|(3&h)<<4,s[t++]=128|63&g}else s[t++]=224|h>>12&15,s[t++]=128|h>>6&63,s[t++]=128|63&h;t>r&&(n.push(s.slice(0,t)),t=0,s=E_(65535),r=65530)}return n.push(s.slice(0,t)),yl(n)}(t),Mr.utils.cfb_add(e,n,r);Mr.utils.cfb_add(e,n,t)}else e.file(n,t)}function _F(){return Mr.utils.cfb_new()}var Lo='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n',yF=ik({"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"}),vF=/[&<>'"]/g,voe=/[\u0000-\u0008\u000b-\u001f]/g;function As(e){return(e+"").replace(vF,function(t){return yF[t]}).replace(voe,function(t){return"_x"+("000"+t.charCodeAt(0).toString(16)).slice(-4)+"_"})}function LV(e){return As(e).replace(/ /g,"_x0020_")}var BV=/[\u0000-\u001f]/g;function zV(e){return(e+"").replace(vF,function(t){return yF[t]}).replace(/\n/g,"<br/>").replace(BV,function(t){return"&#x"+("000"+t.charCodeAt(0).toString(16)).slice(-4)+";"})}function xF(e){for(var n="",t=0,r=0,s=0,l=0,h=0,g=0;t<e.length;)(r=e.charCodeAt(t++))<128?n+=String.fromCharCode(r):(s=e.charCodeAt(t++),r>191&&r<224?(h=(31&r)<<6,h|=63&s,n+=String.fromCharCode(h)):(l=e.charCodeAt(t++),r<240?n+=String.fromCharCode((15&r)<<12|(63&s)<<6|63&l):(g=((7&r)<<18|(63&s)<<12|(63&l)<<6|63&(h=e.charCodeAt(t++)))-65536,n+=String.fromCharCode(55296+(g>>>10&1023)),n+=String.fromCharCode(56320+(1023&g)))));return n}function VV(e){var t,r,g,n=E_(2*e.length),s=1,l=0,h=0;for(r=0;r<e.length;r+=s)s=1,(g=e.charCodeAt(r))<128?t=g:g<224?(t=64*(31&g)+(63&e.charCodeAt(r+1)),s=2):g<240?(t=4096*(15&g)+64*(63&e.charCodeAt(r+1))+(63&e.charCodeAt(r+2)),s=3):(s=4,t=262144*(7&g)+4096*(63&e.charCodeAt(r+1))+64*(63&e.charCodeAt(r+2))+(63&e.charCodeAt(r+3)),h=55296+((t-=65536)>>>10&1023),t=56320+(1023&t)),0!==h&&(n[l++]=255&h,n[l++]=h>>>8,h=0),n[l++]=t%256,n[l++]=t>>>8;return n.slice(0,l).toString("ucs2")}function jV(e){return Tg(e,"binary").toString("utf8")}var ak="foo bar baz\xe2\x98\x83\xf0\x9f\x8d\xa3",oo=Oi&&(jV(ak)==xF(ak)&&jV||VV(ak)==xF(ak)&&VV)||xF,Qp=Oi?function(e){return Tg(e,"utf8").toString("binary")}:function(e){for(var n=[],t=0,r=0,s=0;t<e.length;)switch(r=e.charCodeAt(t++),!0){case r<128:n.push(String.fromCharCode(r));break;case r<2048:n.push(String.fromCharCode(192+(r>>6))),n.push(String.fromCharCode(128+(63&r)));break;case r>=55296&&r<57344:r-=55296,s=e.charCodeAt(t++)-56320+(r<<10),n.push(String.fromCharCode(240+(s>>18&7))),n.push(String.fromCharCode(144+(s>>12&63))),n.push(String.fromCharCode(128+(s>>6&63))),n.push(String.fromCharCode(128+(63&s)));break;default:n.push(String.fromCharCode(224+(r>>12))),n.push(String.fromCharCode(128+(r>>6&63))),n.push(String.fromCharCode(128+(63&r)))}return n.join("")},GV=/(^\s|\s$|\n)/;function Zl(e,n){return"<"+e+(n.match(GV)?' xml:space="preserve"':"")+">"+n+"</"+e+">"}function jC(e){return No(e).map(function(n){return" "+n+'="'+e[n]+'"'}).join("")}function Rn(e,n,t){return"<"+e+(null!=t?jC(t):"")+(null!=n?(n.match(GV)?' xml:space="preserve"':"")+">"+n+"</"+e:"/")+">"}function bF(e,n){try{return e.toISOString().replace(/\.\d*/,"")}catch(t){if(n)throw t}return""}var Ta={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},A_=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],th={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"},WV=function(e){for(var n=[],r=0;r<e[0].length;++r)if(e[0][r])for(var s=0,l=e[0][r].length;s<l;s+=10240)n.push.apply(n,e[0][r].slice(s,s+10240));return n},qV=Oi?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(n){return Buffer.isBuffer(n)?n:Tg(n)})):WV(e)}:WV,ZV=function(e,n,t){for(var r=[],s=n;s<t;s+=2)r.push(String.fromCharCode(Cg(e,s)));return r.join("").replace(dc,"")},lk=Oi?function(e,n,t){return Buffer.isBuffer(e)?e.toString("utf16le",n,t).replace(dc,""):ZV(e,n,t)}:ZV,XV=function(e,n,t){for(var r=[],s=n;s<n+t;++s)r.push(("0"+e[s].toString(16)).slice(-2));return r.join("")},YV=Oi?function(e,n,t){return Buffer.isBuffer(e)?e.toString("hex",n,n+t):XV(e,n,t)}:XV,KV=function(e,n,t){for(var r=[],s=n;s<t;s++)r.push(String.fromCharCode(kw(e,s)));return r.join("")},Iw=Oi?function(n,t,r){return Buffer.isBuffer(n)?n.toString("utf8",t,r):KV(n,t,r)}:KV,JV=function(e,n){var t=xl(e,n);return t>0?Iw(e,n+4,n+4+t-1):""},TF=JV,QV=function(e,n){var t=xl(e,n);return t>0?Iw(e,n+4,n+4+t-1):""},EF=QV,ej=function(e,n){var t=2*xl(e,n);return t>0?Iw(e,n+4,n+4+t-1):""},CF=ej,tj=function(n,t){var r=xl(n,t);return r>0?lk(n,t+4,t+4+r):""},SF=tj,nj=function(e,n){var t=xl(e,n);return t>0?Iw(e,n+4,n+4+t):""},DF=nj,rj=function(e,n){return function Doe(e,n){for(var t=1-2*(e[n+7]>>>7),r=((127&e[n+7])<<4)+(e[n+6]>>>4&15),s=15&e[n+6],l=5;l>=0;--l)s=256*s+e[n+l];return 2047==r?0==s?t*(1/0):NaN:(0==r?r=-1022:(r-=1023,s+=Math.pow(2,52)),t*Math.pow(2,r-52)*s)}(e,n)},ck=rj,MF=function(n){return Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array};Oi&&(TF=function(n,t){if(!Buffer.isBuffer(n))return JV(n,t);var r=n.readUInt32LE(t);return r>0?n.toString("utf8",t+4,t+4+r-1):""},EF=function(n,t){if(!Buffer.isBuffer(n))return QV(n,t);var r=n.readUInt32LE(t);return r>0?n.toString("utf8",t+4,t+4+r-1):""},CF=function(n,t){if(!Buffer.isBuffer(n))return ej(n,t);var r=2*n.readUInt32LE(t);return n.toString("utf16le",t+4,t+4+r-1)},SF=function(n,t){if(!Buffer.isBuffer(n))return tj(n,t);var r=n.readUInt32LE(t);return n.toString("utf16le",t+4,t+4+r)},DF=function(n,t){if(!Buffer.isBuffer(n))return nj(n,t);var r=n.readUInt32LE(t);return n.toString("utf8",t+4,t+4+r)},ck=function(n,t){return Buffer.isBuffer(n)?n.readDoubleLE(t):rj(n,t)},MF=function(n){return Buffer.isBuffer(n)||Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array}),typeof Ji<"u"&&function ij(){lk=function(e,n,t){return Ji.utils.decode(1200,e.slice(n,t)).replace(dc,"")},Iw=function(e,n,t){return Ji.utils.decode(65001,e.slice(n,t))},TF=function(e,n){var t=xl(e,n);return t>0?Ji.utils.decode(Jy,e.slice(n+4,n+4+t-1)):""},EF=function(e,n){var t=xl(e,n);return t>0?Ji.utils.decode(Yu,e.slice(n+4,n+4+t-1)):""},CF=function(e,n){var t=2*xl(e,n);return t>0?Ji.utils.decode(1200,e.slice(n+4,n+4+t-1)):""},SF=function(e,n){var t=xl(e,n);return t>0?Ji.utils.decode(1200,e.slice(n+4,n+4+t)):""},DF=function(e,n){var t=xl(e,n);return t>0?Ji.utils.decode(65001,e.slice(n+4,n+4+t)):""}}();var kw=function(e,n){return e[n]},Cg=function(e,n){return 256*e[n+1]+e[n]},Aoe=function(e,n){var t=256*e[n+1]+e[n];return t<32768?t:-1*(65535-t+1)},xl=function(e,n){return e[n+3]*(1<<24)+(e[n+2]<<16)+(e[n+1]<<8)+e[n]},tv=function(e,n){return e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]},Ioe=function(e,n){return e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]};function HC(e,n){var r,s,h,g,x,E,t="",l=[];switch(n){case"dbcs":if(E=this.l,Oi&&Buffer.isBuffer(this))t=this.slice(this.l,this.l+2*e).toString("utf16le");else for(x=0;x<e;++x)t+=String.fromCharCode(Cg(this,E)),E+=2;e*=2;break;case"utf8":t=Iw(this,this.l,this.l+e);break;case"utf16le":t=lk(this,this.l,this.l+(e*=2));break;case"wstr":if(!(typeof Ji<"u"))return HC.call(this,e,"dbcs");t=Ji.utils.decode(Yu,this.slice(this.l,this.l+2*e)),e*=2;break;case"lpstr-ansi":t=TF(this,this.l),e=4+xl(this,this.l);break;case"lpstr-cp":t=EF(this,this.l),e=4+xl(this,this.l);break;case"lpwstr":t=CF(this,this.l),e=4+2*xl(this,this.l);break;case"lpp4":e=4+xl(this,this.l),t=SF(this,this.l),2&e&&(e+=2);break;case"8lpp4":e=4+xl(this,this.l),t=DF(this,this.l),3&e&&(e+=4-(3&e));break;case"cstr":for(e=0,t="";0!==(h=kw(this,this.l+e++));)l.push(RC(h));t=l.join("");break;case"_wstr":for(e=0,t="";0!==(h=Cg(this,this.l+e));)l.push(RC(h)),e+=2;e+=2,t=l.join("");break;case"dbcs-cont":for(t="",E=this.l,x=0;x<e;++x){if(this.lens&&-1!==this.lens.indexOf(E))return h=kw(this,E),this.l=E+1,g=HC.call(this,e-x,h?"dbcs-cont":"sbcs-cont"),l.join("")+g;l.push(RC(Cg(this,E))),E+=2}t=l.join(""),e*=2;break;case"cpstr":if(typeof Ji<"u"){t=Ji.utils.decode(Yu,this.slice(this.l,this.l+e));break}case"sbcs-cont":for(t="",E=this.l,x=0;x!=e;++x){if(this.lens&&-1!==this.lens.indexOf(E))return h=kw(this,E),this.l=E+1,g=HC.call(this,e-x,h?"dbcs-cont":"sbcs-cont"),l.join("")+g;l.push(RC(kw(this,E))),E+=1}t=l.join("");break;default:switch(e){case 1:return r=kw(this,this.l),this.l++,r;case 2:return r=("i"===n?Aoe:Cg)(this,this.l),this.l+=2,r;case 4:case-4:return"i"!==n&&128&this[this.l+3]?(s=xl(this,this.l),this.l+=4,s):(r=(e>0?tv:Ioe)(this,this.l),this.l+=4,r);case 8:case-8:if("f"===n)return s=8==e?ck(this,this.l):ck([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,s;e=8;case 16:t=YV(this,this.l,e)}}return this.l+=e,t}var koe=function(e,n,t){e[t]=255&n,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24&255},Ooe=function(e,n,t){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},Roe=function(e,n,t){e[t]=255&n,e[t+1]=n>>>8&255};function Poe(e,n,t){var r=0,s=0;if("dbcs"===t){for(s=0;s!=n.length;++s)Roe(this,n.charCodeAt(s),this.l+2*s);r=2*n.length}else if("sbcs"===t){if(typeof Ji<"u"&&874==Jy)for(s=0;s!=n.length;++s){var l=Ji.utils.encode(Jy,n.charAt(s));this[this.l+s]=l[0]}else for(n=n.replace(/[^\x00-\x7F]/g,"_"),s=0;s!=n.length;++s)this[this.l+s]=255&n.charCodeAt(s);r=n.length}else{if("hex"===t){for(;s<e;++s)this[this.l++]=parseInt(n.slice(2*s,2*s+2),16)||0;return this}if("utf16le"===t){var h=Math.min(this.l+e,this.length);for(s=0;s<Math.min(n.length,e);++s){var g=n.charCodeAt(s);this[this.l++]=255&g,this[this.l++]=g>>8}for(;this.l<h;)this[this.l++]=0;return this}switch(e){case 1:r=1,this[this.l]=255&n;break;case 2:r=2,this[this.l]=255&n,this[this.l+1]=255&(n>>>=8);break;case 3:r=3,this[this.l]=255&n,this[this.l+1]=255&(n>>>=8),this[this.l+2]=255&(n>>>=8);break;case 4:r=4,koe(this,n,this.l);break;case 8:if(r=8,"f"===t){!function Moe(e,n,t){var r=(n<0||1/n==-1/0?1:0)<<7,s=0,l=0,h=r?-n:n;isFinite(h)?0==h?s=l=0:(s=Math.floor(Math.log(h)/Math.LN2),l=h*Math.pow(2,52-s),s<=-1023&&(!isFinite(l)||l<Math.pow(2,52))?s=-1022:(l-=Math.pow(2,52),s+=1023)):(s=2047,l=isNaN(n)?26985:0);for(var g=0;g<=5;++g,l/=256)e[t+g]=255&l;e[t+6]=(15&s)<<4|15&l,e[t+7]=s>>4|r}(this,n,this.l);break}case 16:break;case-4:r=4,Ooe(this,n,this.l)}}return this.l+=r,this}function sj(e,n){var t=YV(this,this.l,e.length>>1);if(t!==e)throw new Error(n+"Expected "+e+" saw "+t);this.l+=e.length>>1}function Xl(e,n){e.l=n,e.read_shift=HC,e.chk=sj,e.write_shift=Poe}function pc(e,n){e.l+=n}function Xt(e){var n=E_(e);return Xl(n,0),n}function $c(){var e=[],n=Oi?256:2048,t=function(E){var D=Xt(E);return Xl(D,0),D},r=t(n),s=function(){r&&(r.length>r.l&&((r=r.slice(0,r.l)).l=r.length),r.length>0&&e.push(r),r=null)},l=function(E){return r&&E<r.length-r.l?r:(s(),r=t(Math.max(E+1,n)))};return{next:l,push:function(E){s(),null==(r=E).l&&(r.l=r.length),l(n)},end:function(){return s(),yl(e)},_bufs:e}}function tn(e,n,t,r){var l,s=+n;if(!isNaN(s)){r||(r=lS[s].p||(t||[]).length||0),l=1+(s>=128?1:0)+1,r>=128&&++l,r>=16384&&++l,r>=2097152&&++l;var h=e.next(l);s<=127?h.write_shift(1,s):(h.write_shift(1,128+(127&s)),h.write_shift(1,s>>7));for(var g=0;4!=g;++g){if(!(r>=128)){h.write_shift(1,r);break}h.write_shift(1,128+(127&r)),r>>=7}r>0&&MF(t)&&e.push(t)}}function GC(e,n,t){var r=Gs(e);if(n.s?(r.cRel&&(r.c+=n.s.c),r.rRel&&(r.r+=n.s.r)):(r.cRel&&(r.c+=n.c),r.rRel&&(r.r+=n.r)),!t||t.biff<12){for(;r.c>=256;)r.c-=256;for(;r.r>=65536;)r.r-=65536}return r}function oj(e,n,t){var r=Gs(e);return r.s=GC(r.s,n.s,t),r.e=GC(r.e,n.s,t),r}function WC(e,n){if(e.cRel&&e.c<0)for(e=Gs(e);e.c<0;)e.c+=n>8?16384:256;if(e.rRel&&e.r<0)for(e=Gs(e);e.r<0;)e.r+=n>8?1048576:n>5?65536:16384;var t=Zr(e);return!e.cRel&&null!=e.cRel&&(t=function Loe(e){return e.replace(/^([A-Z])/,"$$$1")}(t)),!e.rRel&&null!=e.rRel&&(t=function Noe(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}(t)),t}function AF(e,n){return 0!=e.s.r||e.s.rRel||e.e.r!=(n.biff>=12?1048575:n.biff>=8?65536:16384)||e.e.rRel?0!=e.s.c||e.s.cRel||e.e.c!=(n.biff>=12?16383:255)||e.e.cRel?WC(e.s,n.biff)+":"+WC(e.e,n.biff):(e.s.rRel?"":"$")+Bo(e.s.r)+":"+(e.e.rRel?"":"$")+Bo(e.e.r):(e.s.cRel?"":"$")+ao(e.s.c)+":"+(e.e.cRel?"":"$")+ao(e.e.c)}function IF(e){return parseInt(function Foe(e){return e.replace(/\$(\d+)$/,"$1")}(e),10)-1}function Bo(e){return""+(e+1)}function kF(e){for(var n=function Boe(e){return e.replace(/^\$([A-Z])/,"$1")}(e),t=0,r=0;r!==n.length;++r)t=26*t+n.charCodeAt(r)-64;return t-1}function ao(e){if(e<0)throw new Error("invalid column "+e);var n="";for(++e;e;e=Math.floor((e-1)/26))n=String.fromCharCode((e-1)%26+65)+n;return n}function na(e){for(var n=0,t=0,r=0;r<e.length;++r){var s=e.charCodeAt(r);s>=48&&s<=57?n=10*n+(s-48):s>=65&&s<=90&&(t=26*t+(s-64))}return{c:t-1,r:n-1}}function Zr(e){for(var n=e.c+1,t="";n;n=(n-1)/26|0)t=String.fromCharCode((n-1)%26+65)+t;return t+(e.r+1)}function Hc(e){var n=e.indexOf(":");return-1==n?{s:na(e),e:na(e)}:{s:na(e.slice(0,n)),e:na(e.slice(n+1))}}function gi(e,n){return typeof n>"u"||"number"==typeof n?gi(e.s,e.e):("string"!=typeof e&&(e=Zr(e)),"string"!=typeof n&&(n=Zr(n)),e==n?e:e+":"+n)}function Zi(e){var n={s:{c:0,r:0},e:{c:0,r:0}},t=0,r=0,s=0,l=e.length;for(t=0;r<l&&!((s=e.charCodeAt(r)-64)<1||s>26);++r)t=26*t+s;for(n.s.c=--t,t=0;r<l&&!((s=e.charCodeAt(r)-48)<0||s>9);++r)t=10*t+s;if(n.s.r=--t,r===l||10!=s)return n.e.c=n.s.c,n.e.r=n.s.r,n;for(++r,t=0;r!=l&&!((s=e.charCodeAt(r)-64)<1||s>26);++r)t=26*t+s;for(n.e.c=--t,t=0;r!=l&&!((s=e.charCodeAt(r)-48)<0||s>9);++r)t=10*t+s;return n.e.r=--t,n}function em(e,n,t){return null==e||null==e.t||"z"==e.t?"":void 0!==e.w?e.w:("d"==e.t&&!e.z&&t&&t.dateNF&&(e.z=t.dateNF),"e"==e.t?Dg[e.v]||e.v:function aj(e,n){var t="d"==e.t&&n instanceof Date;if(null!=e.z)try{return e.w=Qu(e.z,t?vl(n):n)}catch{}try{return e.w=Qu((e.XF||{}).numFmtId||(t?14:0),t?vl(n):n)}catch{return""+n}}(e,null==n?e.v:n))}function I_(e,n){var t=n&&n.sheet?n.sheet:"Sheet1",r={};return r[t]=e,{SheetNames:[t],Sheets:r}}function lj(e,n,t){var r=t||{},s=e?Array.isArray(e):r.dense;null!=Po&&null==s&&(s=Po);var l=e||(s?[]:{}),h=0,g=0;if(l&&null!=r.origin){if("number"==typeof r.origin)h=r.origin;else{var x="string"==typeof r.origin?na(r.origin):r.origin;h=x.r,g=x.c}l["!ref"]||(l["!ref"]="A1:A1")}var E={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(l["!ref"]){var D=Zi(l["!ref"]);E.s.c=D.s.c,E.s.r=D.s.r,E.e.c=Math.max(E.e.c,D.e.c),E.e.r=Math.max(E.e.r,D.e.r),-1==h&&(E.e.r=h=D.e.r+1)}for(var O=0;O!=n.length;++O)if(n[O]){if(!Array.isArray(n[O]))throw new Error("aoa_to_sheet expects an array of arrays");for(var N=0;N!=n[O].length;++N)if(!(typeof n[O][N]>"u")){var B={v:n[O][N]},W=h+O,V=g+N;if(E.s.r>W&&(E.s.r=W),E.s.c>V&&(E.s.c=V),E.e.r<W&&(E.e.r=W),E.e.c<V&&(E.e.c=V),!n[O][N]||"object"!=typeof n[O][N]||Array.isArray(n[O][N])||n[O][N]instanceof Date)if(Array.isArray(B.v)&&(B.f=n[O][N][1],B.v=B.v[0]),null===B.v)if(B.f)B.t="n";else if(r.nullError)B.t="e",B.v=0;else{if(!r.sheetStubs)continue;B.t="z"}else"number"==typeof B.v?B.t="n":"boolean"==typeof B.v?B.t="b":B.v instanceof Date?(B.z=r.dateNF||Br[14],r.cellDates?(B.t="d",B.w=Qu(B.z,vl(B.v))):(B.t="n",B.v=vl(B.v),B.w=Qu(B.z,B.v))):B.t="s";else B=n[O][N];if(s)l[W]||(l[W]=[]),l[W][V]&&l[W][V].z&&(B.z=l[W][V].z),l[W][V]=B;else{var X=Zr({c:V,r:W});l[X]&&l[X].z&&(B.z=l[X].z),l[X]=B}}}return E.s.c<1e7&&(l["!ref"]=gi(E)),l}function Ow(e,n){return lj(null,e,n)}function _f(e,n){return n||(n=Xt(4)),n.write_shift(4,e),n}function mc(e){var n=e.read_shift(4);return 0===n?"":e.read_shift(n,"dbcs")}function bl(e,n){var t=!1;return null==n&&(t=!0,n=Xt(4+2*e.length)),n.write_shift(4,e.length),e.length>0&&n.write_shift(0,e,"dbcs"),t?n.slice(0,n.l):n}function Voe(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function OF(e,n){var t=e.l,r=e.read_shift(1),s=mc(e),l=[],h={t:s,h:s};if(1&r){for(var g=e.read_shift(4),x=0;x!=g;++x)l.push(Voe(e));h.r=l}else h.r=[{ich:0,ifnt:0}];return e.l=t+n,h}var Hoe=OF;function ad(e){var n=e.read_shift(4),t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:n,iStyleRef:t}}function nv(e,n){return null==n&&(n=Xt(8)),n.write_shift(-4,e.c),n.write_shift(3,e.iStyleRef||e.s),n.write_shift(1,0),n}function rv(e){var n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:n}}function iv(e,n){return null==n&&(n=Xt(4)),n.write_shift(3,e.iStyleRef||e.s),n.write_shift(1,0),n}var Woe=mc,cj=bl;function RF(e){var n=e.read_shift(4);return 0===n||4294967295===n?"":e.read_shift(n,"dbcs")}function uk(e,n){var t=!1;return null==n&&(t=!0,n=Xt(127)),n.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&n.write_shift(0,e,"dbcs"),t?n.slice(0,n.l):n}var qoe=mc,PF=RF,NF=uk;function FF(e){var n=e.slice(e.l,e.l+4),t=1&n[0],r=2&n[0];e.l+=4;var s=0===r?ck([0,0,0,0,252&n[0],n[1],n[2],n[3]],0):tv(n,0)>>2;return t?s/100:s}function uj(e,n){null==n&&(n=Xt(4));var t=0,r=0,s=100*e;if(e==(0|e)&&e>=-(1<<29)&&e<1<<29?r=1:s==(0|s)&&s>=-(1<<29)&&s<1<<29&&(r=1,t=1),!r)throw new Error("unsupported RkNumber "+e);n.write_shift(-4,((t?s:e)<<2)+(t+2))}function hj(e){var n={s:{},e:{}};return n.s.r=e.read_shift(4),n.e.r=e.read_shift(4),n.s.c=e.read_shift(4),n.e.c=e.read_shift(4),n}var sv=hj,Rw=function Zoe(e,n){return n||(n=Xt(16)),n.write_shift(4,e.s.r),n.write_shift(4,e.e.r),n.write_shift(4,e.s.c),n.write_shift(4,e.e.c),n};function gc(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function ov(e,n){return(n||Xt(8)).write_shift(8,e,"f")}function hk(e,n){if(n||(n=Xt(8)),!e||e.auto)return n.write_shift(4,0),n.write_shift(4,0),n;null!=e.index?(n.write_shift(1,2),n.write_shift(1,e.index)):null!=e.theme?(n.write_shift(1,6),n.write_shift(1,e.theme)):(n.write_shift(1,5),n.write_shift(1,0));var t=e.tint||0;if(t>0?t*=32767:t<0&&(t*=32768),n.write_shift(2,t),e.rgb&&null==e.theme){var r=e.rgb||"FFFFFF";"number"==typeof r&&(r=("000000"+r.toString(16)).slice(-6)),n.write_shift(1,parseInt(r.slice(0,2),16)),n.write_shift(1,parseInt(r.slice(2,4),16)),n.write_shift(1,parseInt(r.slice(4,6),16)),n.write_shift(1,255)}else n.write_shift(2,0),n.write_shift(1,0),n.write_shift(1,0);return n}var BF={1:{n:"CodePage",t:2},2:{n:"Category",t:80},3:{n:"PresentationFormat",t:80},4:{n:"ByteCount",t:3},5:{n:"LineCount",t:3},6:{n:"ParagraphCount",t:3},7:{n:"SlideCount",t:3},8:{n:"NoteCount",t:3},9:{n:"HiddenCount",t:3},10:{n:"MultimediaClipCount",t:3},11:{n:"ScaleCrop",t:11},12:{n:"HeadingPairs",t:4108},13:{n:"TitlesOfParts",t:4126},14:{n:"Manager",t:80},15:{n:"Company",t:80},16:{n:"LinksUpToDate",t:11},17:{n:"CharacterCount",t:3},19:{n:"SharedDoc",t:11},22:{n:"HyperlinksChanged",t:11},23:{n:"AppVersion",t:3,p:"version"},24:{n:"DigSig",t:65},26:{n:"ContentType",t:80},27:{n:"ContentStatus",t:80},28:{n:"Language",t:80},29:{n:"Version",t:80},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}},zF={1:{n:"CodePage",t:2},2:{n:"Title",t:80},3:{n:"Subject",t:80},4:{n:"Author",t:80},5:{n:"Keywords",t:80},6:{n:"Comments",t:80},7:{n:"Template",t:80},8:{n:"LastAuthor",t:80},9:{n:"RevNumber",t:80},10:{n:"EditTime",t:64},11:{n:"LastPrinted",t:64},12:{n:"CreatedDate",t:64},13:{n:"ModifiedDate",t:64},14:{n:"PageCount",t:3},15:{n:"WordCount",t:3},16:{n:"CharCount",t:3},17:{n:"Thumbnail",t:71},18:{n:"Application",t:80},19:{n:"DocSecurity",t:3},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}};function oae(e){return e.map(function(n){return[n>>16&255,n>>8&255,255&n]})}var av=Gs(oae([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),Dg={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},UF={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},mk={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function gj(e,n){var s,t=function aoe(e){for(var n=[],t=No(e),r=0;r!==t.length;++r)null==n[e[t[r]]]&&(n[e[t[r]]]=[]),n[e[t[r]]].push(t[r]);return n}(UF),r=[];r[r.length]=Lo,r[r.length]=Rn("Types",null,{xmlns:Ta.CT,"xmlns:xsd":Ta.xsd,"xmlns:xsi":Ta.xsi}),r=r.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(x){return Rn("Default",null,{Extension:x[0],ContentType:x[1]})}));var l=function(x){e[x]&&e[x].length>0&&(r[r.length]=Rn("Override",null,{PartName:("/"==(s=e[x][0])[0]?"":"/")+s,ContentType:mk[x][n.bookType]||mk[x].xlsx}))},h=function(x){(e[x]||[]).forEach(function(E){r[r.length]=Rn("Override",null,{PartName:("/"==E[0]?"":"/")+E,ContentType:mk[x][n.bookType]||mk[x].xlsx})})},g=function(x){(e[x]||[]).forEach(function(E){r[r.length]=Rn("Override",null,{PartName:("/"==E[0]?"":"/")+E,ContentType:t[x][0]})})};return l("workbooks"),h("sheets"),h("charts"),g("themes"),["strs","styles"].forEach(l),["coreprops","extprops","custprops"].forEach(g),g("vba"),g("comments"),g("threadedcomments"),g("drawings"),h("metadata"),g("people"),r.length>2&&(r[r.length]="</Types>",r[1]=r[1].replace("/>",">")),r.join("")}var _i={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function qC(e){var n=e.lastIndexOf("/");return e.slice(0,n+1)+"_rels/"+e.slice(n+1)+".rels"}function Pw(e){var n=[Lo,Rn("Relationships",null,{xmlns:Ta.RELS})];return No(e["!id"]).forEach(function(t){n[n.length]=Rn("Relationship",null,e["!id"][t])}),n.length>2&&(n[n.length]="</Relationships>",n[1]=n[1].replace("/>",">")),n.join("")}function bs(e,n,t,r,s,l){if(s||(s={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),n<0)for(n=e["!idx"];e["!id"]["rId"+n];++n);if(e["!idx"]=n+1,s.Id="rId"+n,s.Type=r,s.Target=t,l?s.TargetMode=l:[_i.HLINK,_i.XPATH,_i.XMISS].indexOf(s.Type)>-1&&(s.TargetMode="External"),e["!id"][s.Id])throw new Error("Cannot rewrite rId "+n);return e["!id"][s.Id]=s,e[("/"+s.Target).replace("//","/")]=s,n}function _j(e,n,t){return['  <rdf:Description rdf:about="'+e+'">\n','    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(t||"odf")+"#"+n+'"/>\n',"  </rdf:Description>\n"].join("")}function fae(e,n){return['  <rdf:Description rdf:about="'+e+'">\n','    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+n+'"/>\n',"  </rdf:Description>\n"].join("")}function yj(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+OC.version+"</meta:generator></office:meta></office:document-meta>"}var Mg=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function jF(e,n,t,r,s){null!=s[e]||null==n||""===n||(s[e]=n,n=As(n),r[r.length]=t?Rn(e,n,t):Zl(e,n))}function xj(e,n){var t=n||{},r=[Lo,Rn("cp:coreProperties",null,{"xmlns:cp":Ta.CORE_PROPS,"xmlns:dc":Ta.dc,"xmlns:dcterms":Ta.dcterms,"xmlns:dcmitype":Ta.dcmitype,"xmlns:xsi":Ta.xsi})],s={};if(!e&&!t.Props)return r.join("");e&&(null!=e.CreatedDate&&jF("dcterms:created","string"==typeof e.CreatedDate?e.CreatedDate:bF(e.CreatedDate,t.WTF),{"xsi:type":"dcterms:W3CDTF"},r,s),null!=e.ModifiedDate&&jF("dcterms:modified","string"==typeof e.ModifiedDate?e.ModifiedDate:bF(e.ModifiedDate,t.WTF),{"xsi:type":"dcterms:W3CDTF"},r,s));for(var l=0;l!=Mg.length;++l){var h=Mg[l],g=t.Props&&null!=t.Props[h[1]]?t.Props[h[1]]:e?e[h[1]]:null;!0===g?g="1":!1===g?g="0":"number"==typeof g&&(g=String(g)),null!=g&&jF(h[0],g,null,r,s)}return r.length>2&&(r[r.length]="</cp:coreProperties>",r[1]=r[1].replace("/>",">")),r.join("")}var lv=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],bj=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function Tj(e){var n=[],t=Rn;return e||(e={}),e.Application="SheetJS",n[n.length]=Lo,n[n.length]=Rn("Properties",null,{xmlns:Ta.EXT_PROPS,"xmlns:vt":Ta.vt}),lv.forEach(function(r){if(void 0!==e[r[1]]){var s;switch(r[2]){case"string":s=As(String(e[r[1]]));break;case"bool":s=e[r[1]]?"true":"false"}void 0!==s&&(n[n.length]=t(r[0],s))}}),n[n.length]=t("HeadingPairs",t("vt:vector",t("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+t("vt:variant",t("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),n[n.length]=t("TitlesOfParts",t("vt:vector",e.SheetNames.map(function(r){return"<vt:lpstr>"+As(r)+"</vt:lpstr>"}).join(""),{size:e.Worksheets,baseType:"lpstr"})),n.length>2&&(n[n.length]="</Properties>",n[1]=n[1].replace("/>",">")),n.join("")}function Ej(e){var n=[Lo,Rn("Properties",null,{xmlns:Ta.CUST_PROPS,"xmlns:vt":Ta.vt})];if(!e)return n.join("");var t=1;return No(e).forEach(function(s){++t,n[n.length]=Rn("property",function Soe(e,n){switch(typeof e){case"string":var t=Rn("vt:lpwstr",As(e));return n&&(t=t.replace(/&quot;/g,"_x0022_")),t;case"number":return Rn((0|e)==e?"vt:i4":"vt:r8",As(String(e)));case"boolean":return Rn("vt:bool",e?"true":"false")}if(e instanceof Date)return Rn("vt:filetime",bF(e));throw new Error("Unable to serialize "+e)}(e[s],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:t,name:As(s)})}),n.length>2&&(n[n.length]="</Properties>",n[1]=n[1].replace("/>",">")),n.join("")}var $F={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function Ij(e,n){var t=Xt(4),r=Xt(4);switch(t.write_shift(4,80==e?31:e),e){case 3:r.write_shift(-4,n);break;case 5:(r=Xt(8)).write_shift(8,n,"f");break;case 11:r.write_shift(4,n?1:0);break;case 64:r=function wae(e){var t=("string"==typeof e?new Date(Date.parse(e)):e).getTime()/1e3+11644473600,r=t%Math.pow(2,32),s=(t-r)/Math.pow(2,32);s*=1e7;var l=(r*=1e7)/Math.pow(2,32)|0;l>0&&(r%=Math.pow(2,32),s+=l);var h=Xt(8);return h.write_shift(4,r),h.write_shift(4,s),h}(n);break;case 31:case 80:for((r=Xt(4+2*(n.length+1)+(n.length%2?0:2))).write_shift(4,n.length+1),r.write_shift(0,n,"dbcs");r.l!=r.length;)r.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+n)}return yl([t,r])}var Oj=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function Aae(e){switch(typeof e){case"boolean":return 11;case"number":return(0|e)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64}return-1}function Rj(e,n,t){var r=Xt(8),s=[],l=[],h=8,g=0,x=Xt(8),E=Xt(8);if(x.write_shift(4,2),x.write_shift(4,1200),E.write_shift(4,1),l.push(x),s.push(E),h+=8+x.length,!n){(E=Xt(8)).write_shift(4,0),s.unshift(E);var D=[Xt(4)];for(D[0].write_shift(4,e.length),g=0;g<e.length;++g){var O=e[g][0];for((x=Xt(8+2*(O.length+1)+(O.length%2?0:2))).write_shift(4,g+2),x.write_shift(4,O.length+1),x.write_shift(0,O,"dbcs");x.l!=x.length;)x.write_shift(1,0);D.push(x)}x=yl(D),l.unshift(x),h+=8+x.length}for(g=0;g<e.length;++g)if((!n||n[e[g][0]])&&!(Oj.indexOf(e[g][0])>-1||bj.indexOf(e[g][0])>-1)&&null!=e[g][1]){var N=e[g][1],B=0;if(n){var W=t[B=+n[e[g][0]]];if("version"==W.p&&"string"==typeof N){var V=N.split(".");N=(+V[0]<<16)+(+V[1]||0)}x=Ij(W.t,N)}else{var X=Aae(N);-1==X&&(X=31,N=String(N)),x=Ij(X,N)}l.push(x),(E=Xt(8)).write_shift(4,n?B:2+g),s.push(E),h+=8+x.length}var le=8*(l.length+1);for(g=0;g<l.length;++g)s[g].write_shift(4,le),le+=l[g].length;return r.write_shift(4,h),r.write_shift(4,l.length),yl([r].concat(s).concat(l))}function Nj(e,n,t,r,s,l){var h=Xt(s?68:48),g=[h];h.write_shift(2,65534),h.write_shift(2,0),h.write_shift(4,842412599),h.write_shift(16,Mr.utils.consts.HEADER_CLSID,"hex"),h.write_shift(4,s?2:1),h.write_shift(16,n,"hex"),h.write_shift(4,s?68:48);var x=Rj(e,t,r);if(g.push(x),s){var E=Rj(s,null,null);h.write_shift(16,l,"hex"),h.write_shift(4,68+x.length),g.push(E)}return yl(g)}function Gc(e,n){return n||(n=Xt(2)),n.write_shift(2,+!!e),n}function Ea(e){return e.read_shift(2,"u")}function ld(e,n){return n||(n=Xt(2)),n.write_shift(2,e),n}function Lj(e,n,t){return t||(t=Xt(2)),t.write_shift(1,"e"==n?+e:+!!e),t.write_shift(1,"e"==n?1:0),t}function XC(e,n,t){var r=e.read_shift(t&&t.biff>=12?2:1),s="sbcs-cont",l=Yu;t&&t.biff>=8&&(Yu=1200),t&&8!=t.biff?12==t.biff&&(s="wstr"):e.read_shift(1)&&(s="dbcs-cont"),t.biff>=2&&t.biff<=5&&(s="cpstr");var g=r?e.read_shift(r,s):"";return Yu=l,g}function Pae(e){var n=e.t||"",r=Xt(3);r.write_shift(2,n.length),r.write_shift(1,1);var s=Xt(2*n.length);return s.write_shift(2*n.length,n,"utf16le"),yl([r,s])}function Bj(e,n,t){return t||(t=Xt(3+2*e.length)),t.write_shift(2,e.length),t.write_shift(1,1),t.write_shift(31,e,"utf16le"),t}function zj(e,n){n||(n=Xt(6+2*e.length)),n.write_shift(4,1+e.length);for(var t=0;t<e.length;++t)n.write_shift(2,e.charCodeAt(t));return n.write_shift(2,0),n}function Uae(e){var n=Xt(512),t=0,r=e.Target;"file://"==r.slice(0,7)&&(r=r.slice(7));var s=r.indexOf("#"),l=s>-1?31:23;switch(r.charAt(0)){case"#":l=28;break;case".":l&=-3}n.write_shift(4,2),n.write_shift(4,l);var h=[8,6815827,6619237,4849780,83];for(t=0;t<h.length;++t)n.write_shift(4,h[t]);if(28==l)zj(r=r.slice(1),n);else if(2&l){for(h="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),t=0;t<h.length;++t)n.write_shift(1,parseInt(h[t],16));var g=s>-1?r.slice(0,s):r;for(n.write_shift(4,2*(g.length+1)),t=0;t<g.length;++t)n.write_shift(2,g.charCodeAt(t));n.write_shift(2,0),8&l&&zj(s>-1?r.slice(s+1):"",n)}else{for(h="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),t=0;t<h.length;++t)n.write_shift(1,parseInt(h[t],16));for(var x=0;"../"==r.slice(3*x,3*x+3)||"..\\"==r.slice(3*x,3*x+3);)++x;for(n.write_shift(2,x),n.write_shift(4,r.length-3*x+1),t=0;t<r.length-3*x;++t)n.write_shift(1,255&r.charCodeAt(t+3*x));for(n.write_shift(1,0),n.write_shift(2,65535),n.write_shift(2,57005),t=0;t<6;++t)n.write_shift(4,0)}return n.slice(0,n.l)}function hv(e,n,t,r){return r||(r=Xt(6)),r.write_shift(2,e),r.write_shift(2,n),r.write_shift(2,t||0),r}function $ae(e,n,t){var r=t.biff>8?4:2;return[e.read_shift(r),e.read_shift(r,"i"),e.read_shift(r,"i")]}function yk(e){var n=e.read_shift(2),t=e.read_shift(2);return{s:{c:e.read_shift(2),r:n},e:{c:e.read_shift(2),r:t}}}function $j(e,n){return n||(n=Xt(8)),n.write_shift(2,e.s.r),n.write_shift(2,e.e.r),n.write_shift(2,e.s.c),n.write_shift(2,e.e.c),n}function qF(e,n,t){var r=1536,s=16;switch(t.bookType){case"biff8":case"xla":break;case"biff5":r=1280,s=8;break;case"biff4":r=4,s=6;break;case"biff3":r=3,s=6;break;case"biff2":r=2,s=4;break;default:throw new Error("unsupported BIFF version")}var l=Xt(s);return l.write_shift(2,r),l.write_shift(2,n),s>4&&l.write_shift(2,29282),s>6&&l.write_shift(2,1997),s>8&&(l.write_shift(2,49161),l.write_shift(2,1),l.write_shift(2,1798),l.write_shift(2,0)),l}function tle(e,n){var t=!n||n.biff>=8?2:1,r=Xt(8+t*e.name.length);r.write_shift(4,e.pos),r.write_shift(1,e.hs||0),r.write_shift(1,e.dt),r.write_shift(1,e.name.length),n.biff>=8&&r.write_shift(1,1),r.write_shift(t*e.name.length,e.name,n.biff<8?"sbcs":"utf16le");var s=r.slice(0,r.l);return s.l=r.l,s}function xle(e,n,t,r){var s=t&&5==t.biff;r||(r=Xt(s?3+n.length:5+2*n.length)),r.write_shift(2,e),r.write_shift(s?1:2,n.length),s||r.write_shift(1,1),r.write_shift((s?1:2)*n.length,n,s?"sbcs":"utf16le");var l=r.length>r.l?r.slice(0,r.l):r;return null==l.l&&(l.l=l.length),l}function Zj(e,n,t,r){var s=t&&5==t.biff;r||(r=Xt(s?16:20)),r.write_shift(2,0),e.style?(r.write_shift(2,e.numFmtId||0),r.write_shift(2,65524)):(r.write_shift(2,e.numFmtId||0),r.write_shift(2,n<<4));var l=0;return e.numFmtId>0&&s&&(l|=1024),r.write_shift(4,l),r.write_shift(4,0),s||r.write_shift(4,0),r.write_shift(2,0),r}function Zle(e){var n=Xt(24),t=na(e[0]);n.write_shift(2,t.r),n.write_shift(2,t.r),n.write_shift(2,t.c),n.write_shift(2,t.c);for(var r="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),s=0;s<16;++s)n.write_shift(1,parseInt(r[s],16));return yl([n,Uae(e[1])])}function Yle(e){var n=e[1].Tooltip,t=Xt(10+2*(n.length+1));t.write_shift(2,2048);var r=na(e[0]);t.write_shift(2,r.r),t.write_shift(2,r.r),t.write_shift(2,r.c),t.write_shift(2,r.c);for(var s=0;s<n.length;++s)t.write_shift(2,n.charCodeAt(s));return t.write_shift(2,0),t}var ZF=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},n=ik({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(g,x){var E=x||{};E.dateNF||(E.dateNF="yyyymmdd");var D=Ow(function t(g,x){var E=[],D=E_(1);switch(x.type){case"base64":D=Ju(Ku(g));break;case"binary":D=Ju(g);break;case"buffer":case"array":D=g}Xl(D,0);var O=D.read_shift(1),N=!!(136&O),B=!1,W=!1;switch(O){case 2:case 3:case 131:case 139:case 245:break;case 48:case 49:B=!0,N=!0;break;case 140:W=!0;break;default:throw new Error("DBF Unsupported Version: "+O.toString(16))}var V=0,X=521;2==O&&(V=D.read_shift(2)),D.l+=3,2!=O&&(V=D.read_shift(4)),V>1048576&&(V=1e6),2!=O&&(X=D.read_shift(2));var le=D.read_shift(2),oe=x.codepage||1252;2!=O&&(D.l+=16,D.read_shift(1),0!==D[D.l]&&(oe=e[D[D.l]]),D.l+=1,D.l+=2),W&&(D.l+=36);for(var fe=[],Le={},Ze=Math.min(D.length,2==O?521:X-10-(B?264:0)),at=W?32:11;D.l<Ze&&13!=D[D.l];)switch(Le={},Le.name=Ji.utils.decode(oe,D.slice(D.l,D.l+at)).replace(/[\u0000\r\n].*$/g,""),D.l+=at,Le.type=String.fromCharCode(D.read_shift(1)),2!=O&&!W&&(Le.offset=D.read_shift(4)),Le.len=D.read_shift(1),2==O&&(Le.offset=D.read_shift(2)),Le.dec=D.read_shift(1),Le.name.length&&fe.push(Le),2!=O&&(D.l+=W?13:14),Le.type){case"B":(!B||8!=Le.len)&&x.WTF&&console.log("Skipping "+Le.name+":"+Le.type);break;case"G":case"P":x.WTF&&console.log("Skipping "+Le.name+":"+Le.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+Le.type)}if(13!==D[D.l]&&(D.l=X-1),13!==D.read_shift(1))throw new Error("DBF Terminator not found "+D.l+" "+D[D.l]);D.l=X;var Ne=0,ot=0;for(E[0]=[],ot=0;ot!=fe.length;++ot)E[0][ot]=fe[ot].name;for(;V-- >0;)if(42!==D[D.l])for(++D.l,E[++Ne]=[],ot=0,ot=0;ot!=fe.length;++ot){var lt=D.slice(D.l,D.l+fe[ot].len);D.l+=fe[ot].len,Xl(lt,0);var Tt=Ji.utils.decode(oe,lt);switch(fe[ot].type){case"C":Tt.trim().length&&(E[Ne][ot]=Tt.replace(/\s+$/,""));break;case"D":E[Ne][ot]=8===Tt.length?new Date(+Tt.slice(0,4),+Tt.slice(4,6)-1,+Tt.slice(6,8)):Tt;break;case"F":E[Ne][ot]=parseFloat(Tt.trim());break;case"+":case"I":E[Ne][ot]=W?2147483648^lt.read_shift(-4,"i"):lt.read_shift(4,"i");break;case"L":switch(Tt.trim().toUpperCase()){case"Y":case"T":E[Ne][ot]=!0;break;case"N":case"F":E[Ne][ot]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+Tt+"|")}break;case"M":if(!N)throw new Error("DBF Unexpected MEMO for type "+O.toString(16));E[Ne][ot]="##MEMO##"+(W?parseInt(Tt.trim(),10):lt.read_shift(4));break;case"N":(Tt=Tt.replace(/\u0000/g,"").trim())&&"."!=Tt&&(E[Ne][ot]=+Tt||0);break;case"@":E[Ne][ot]=new Date(lt.read_shift(-8,"f")-621356832e5);break;case"T":E[Ne][ot]=new Date(864e5*(lt.read_shift(4)-2440588)+lt.read_shift(4));break;case"Y":E[Ne][ot]=lt.read_shift(4,"i")/1e4+lt.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":E[Ne][ot]=-lt.read_shift(-8,"f");break;case"B":if(B&&8==fe[ot].len){E[Ne][ot]=lt.read_shift(8,"f");break}case"G":case"P":lt.l+=fe[ot].len;break;case"0":if("_NullFlags"===fe[ot].name)break;default:throw new Error("DBF Unsupported data type "+fe[ot].type)}}else D.l+=le;if(2!=O&&D.l<D.length&&26!=D[D.l++])throw new Error("DBF EOF Marker missing "+(D.l-1)+" of "+D.length+" "+D[D.l-1].toString(16));return x&&x.sheetRows&&(E=E.slice(0,x.sheetRows)),x.DBF=fe,E}(g,E),E);return D["!cols"]=E.DBF.map(function(O){return{wch:O.len,DBF:O}}),delete E.DBF,D}var l={B:8,C:250,L:1,D:8,"?":0,"":0};return{to_workbook:function s(g,x){try{return I_(r(g,x),x)}catch(E){if(x&&x.WTF)throw E}return{SheetNames:[],Sheets:{}}},to_sheet:r,from_sheet:function h(g,x){var E=x||{};if(+E.codepage>=0&&id(+E.codepage),"string"==E.type)throw new Error("Cannot write DBF to JS string");var D=$c(),O=Ok(g,{header:1,raw:!0,cellDates:!0}),N=O[0],B=O.slice(1),W=g["!cols"]||[],V=0,X=0,le=0,oe=1;for(V=0;V<N.length;++V)if(((W[V]||{}).DBF||{}).name)N[V]=W[V].DBF.name,++le;else if(null!=N[V]){if(++le,"number"==typeof N[V]&&(N[V]=N[V].toString(10)),"string"!=typeof N[V])throw new Error("DBF Invalid column name "+N[V]+" |"+typeof N[V]+"|");if(N.indexOf(N[V])!==V)for(X=0;X<1024;++X)if(-1==N.indexOf(N[V]+"_"+X)){N[V]+="_"+X;break}}var fe=Zi(g["!ref"]),Le=[],Ze=[],at=[];for(V=0;V<=fe.e.c-fe.s.c;++V){var Ne="",ot="",lt=0,Tt=[];for(X=0;X<B.length;++X)null!=B[X][V]&&Tt.push(B[X][V]);if(0!=Tt.length&&null!=N[V]){for(X=0;X<Tt.length;++X){switch(typeof Tt[X]){case"number":ot="B";break;case"string":default:ot="C";break;case"boolean":ot="L";break;case"object":ot=Tt[X]instanceof Date?"D":"C"}lt=Math.max(lt,String(Tt[X]).length),Ne=Ne&&Ne!=ot?"C":ot}lt>250&&(lt=250),"C"==(ot=((W[V]||{}).DBF||{}).type)&&W[V].DBF.len>lt&&(lt=W[V].DBF.len),"B"==Ne&&"N"==ot&&(Ne="N",at[V]=W[V].DBF.dec,lt=W[V].DBF.len),Ze[V]="C"==Ne||"N"==ot?lt:l[Ne]||0,oe+=Ze[V],Le[V]=Ne}else Le[V]="?"}var Ot=D.next(32);for(Ot.write_shift(4,318902576),Ot.write_shift(4,B.length),Ot.write_shift(2,296+32*le),Ot.write_shift(2,oe),V=0;V<4;++V)Ot.write_shift(4,0);for(Ot.write_shift(4,(+n[Jy]||3)<<8),V=0,X=0;V<N.length;++V)if(null!=N[V]){var ft=D.next(32),un=(N[V].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);ft.write_shift(1,un,"sbcs"),ft.write_shift(1,"?"==Le[V]?"C":Le[V],"sbcs"),ft.write_shift(4,X),ft.write_shift(1,Ze[V]||l[Le[V]]||0),ft.write_shift(1,at[V]||0),ft.write_shift(1,2),ft.write_shift(4,0),ft.write_shift(1,0),ft.write_shift(4,0),ft.write_shift(4,0),X+=Ze[V]||l[Le[V]]||0}var Wn=D.next(264);for(Wn.write_shift(4,13),V=0;V<65;++V)Wn.write_shift(4,0);for(V=0;V<B.length;++V){var On=D.next(oe);for(On.write_shift(1,0),X=0;X<N.length;++X)if(null!=N[X])switch(Le[X]){case"L":On.write_shift(1,null==B[V][X]?63:B[V][X]?84:70);break;case"B":On.write_shift(8,B[V][X]||0,"f");break;case"N":var pr="0";for("number"==typeof B[V][X]&&(pr=B[V][X].toFixed(at[X]||0)),le=0;le<Ze[X]-pr.length;++le)On.write_shift(1,32);On.write_shift(1,pr,"sbcs");break;case"D":B[V][X]?(On.write_shift(4,("0000"+B[V][X].getFullYear()).slice(-4),"sbcs"),On.write_shift(2,("00"+(B[V][X].getMonth()+1)).slice(-2),"sbcs"),On.write_shift(2,("00"+B[V][X].getDate()).slice(-2),"sbcs")):On.write_shift(8,"00000000","sbcs");break;case"C":var er=String(null!=B[V][X]?B[V][X]:"").slice(0,Ze[X]);for(On.write_shift(1,er,"sbcs"),le=0;le<Ze[X]-er.length;++le)On.write_shift(1,32)}}return D.next(1).write_shift(1,26),D.end()}}}(),n7=function(){var e={AA:"\xc0",BA:"\xc1",CA:"\xc2",DA:195,HA:"\xc4",JA:197,AE:"\xc8",BE:"\xc9",CE:"\xca",HE:"\xcb",AI:"\xcc",BI:"\xcd",CI:"\xce",HI:"\xcf",AO:"\xd2",BO:"\xd3",CO:"\xd4",DO:213,HO:"\xd6",AU:"\xd9",BU:"\xda",CU:"\xdb",HU:"\xdc",Aa:"\xe0",Ba:"\xe1",Ca:"\xe2",Da:227,Ha:"\xe4",Ja:229,Ae:"\xe8",Be:"\xe9",Ce:"\xea",He:"\xeb",Ai:"\xec",Bi:"\xed",Ci:"\xee",Hi:"\xef",Ao:"\xf2",Bo:"\xf3",Co:"\xf4",Do:245,Ho:"\xf6",Au:"\xf9",Bu:"\xfa",Cu:"\xfb",Hu:"\xfc",KC:"\xc7",Kc:"\xe7",q:"\xe6",z:"\u0153",a:"\xc6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},n=new RegExp("\x1bN("+No(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),t=function(N,B){var W=e[B];return"number"==typeof W?uF(W):W},r=function(N,B,W){var V=B.charCodeAt(0)-32<<4|W.charCodeAt(0)-48;return 59==V?N:uF(V)};function l(N,B){var Ot,W=N.split(/[\n\r]+/),V=-1,X=-1,le=0,oe=0,fe=[],Le=[],Ze=null,at={},Ne=[],ot=[],lt=[],Tt=0;for(+B.codepage>=0&&id(+B.codepage);le!==W.length;++le){Tt=0;var On,ft=W[le].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,r).replace(n,t),un=ft.replace(/;;/g,"\0").split(";").map(function(et){return et.replace(/\u0000/g,";")});if(ft.length>0)switch(un[0]){case"ID":case"E":case"B":case"O":case"W":break;case"P":"P"==un[1].charAt(0)&&Le.push(ft.slice(3).replace(/;;/g,";"));break;case"C":var pr=!1,er=!1,yi=!1,Vn=!1,Or=-1,nn=-1;for(oe=1;oe<un.length;++oe)switch(un[oe].charAt(0)){case"A":case"G":break;case"X":X=parseInt(un[oe].slice(1))-1,er=!0;break;case"Y":for(V=parseInt(un[oe].slice(1))-1,er||(X=0),Ot=fe.length;Ot<=V;++Ot)fe[Ot]=[];break;case"K":'"'===(On=un[oe].slice(1)).charAt(0)?On=On.slice(1,On.length-1):"TRUE"===On?On=!0:"FALSE"===On?On=!1:isNaN(gf(On))?isNaN(Aw(On).getDate())||(On=Eo(On)):(On=gf(On),null!==Ze&&Dw(Ze)&&(On=mF(On))),typeof Ji<"u"&&"string"==typeof On&&"string"!=(B||{}).type&&(B||{}).codepage&&(On=Ji.utils.decode(B.codepage,On)),pr=!0;break;case"E":Vn=!0;var qe=Lw(un[oe].slice(1),{r:V,c:X});fe[V][X]=[fe[V][X],qe];break;case"S":yi=!0,fe[V][X]=[fe[V][X],"S5S"];break;case"R":Or=parseInt(un[oe].slice(1))-1;break;case"C":nn=parseInt(un[oe].slice(1))-1;break;default:if(B&&B.WTF)throw new Error("SYLK bad record "+ft)}if(pr&&(fe[V][X]&&2==fe[V][X].length?fe[V][X][0]=On:fe[V][X]=On,Ze=null),yi){if(Vn)throw new Error("SYLK shared formula cannot have own formula");var St=Or>-1&&fe[Or][nn];if(!St||!St[1])throw new Error("SYLK shared formula cannot find base");fe[V][X][1]=T7(St[1],{r:V-Or,c:X-nn})}break;case"F":var rt=0;for(oe=1;oe<un.length;++oe)switch(un[oe].charAt(0)){case"X":X=parseInt(un[oe].slice(1))-1,++rt;break;case"Y":for(V=parseInt(un[oe].slice(1))-1,Ot=fe.length;Ot<=V;++Ot)fe[Ot]=[];break;case"M":Tt=parseInt(un[oe].slice(1))/20;break;case"F":case"G":case"S":case"D":case"N":break;case"P":Ze=Le[parseInt(un[oe].slice(1))];break;case"W":for(lt=un[oe].slice(1).split(" "),Ot=parseInt(lt[0],10);Ot<=parseInt(lt[1],10);++Ot)Tt=parseInt(lt[2],10),ot[Ot-1]=0===Tt?{hidden:!0}:{wch:Tt},O_(ot[Ot-1]);break;case"C":ot[X=parseInt(un[oe].slice(1))-1]||(ot[X]={});break;case"R":Ne[V=parseInt(un[oe].slice(1))-1]||(Ne[V]={}),Tt>0?(Ne[V].hpt=Tt,Ne[V].hpx=wk(Tt)):0===Tt&&(Ne[V].hidden=!0);break;default:if(B&&B.WTF)throw new Error("SYLK bad record "+ft)}rt<1&&(Ze=null);break;default:if(B&&B.WTF)throw new Error("SYLK bad record "+ft)}}return Ne.length>0&&(at["!rows"]=Ne),ot.length>0&&(at["!cols"]=ot),B&&B.sheetRows&&(fe=fe.slice(0,B.sheetRows)),[fe,at]}function h(N,B){var W=function s(N,B){switch(B.type){case"base64":return l(Ku(N),B);case"binary":return l(N,B);case"buffer":return l(Oi&&Buffer.isBuffer(N)?N.toString("binary"):C_(N),B);case"array":return l(ev(N),B)}throw new Error("Unrecognized type "+B.type)}(N,B),X=W[1],le=Ow(W[0],B);return No(X).forEach(function(oe){le[oe]=X[oe]}),le}function x(N,B,W,V){var X="C;Y"+(W+1)+";X"+(V+1)+";K";switch(N.t){case"n":X+=N.v||0,N.f&&!N.F&&(X+=";E"+t3(N.f,{r:W,c:V}));break;case"b":X+=N.v?"TRUE":"FALSE";break;case"e":X+=N.w||N.v;break;case"d":X+='"'+(N.w||N.v)+'"';break;case"s":X+='"'+N.v.replace(/"/g,"").replace(/;/g,";;")+'"'}return X}return e["|"]=254,{to_workbook:function g(N,B){return I_(h(N,B),B)},to_sheet:h,from_sheet:function O(N,B){var le,W=["ID;PWXL;N;E"],V=[],X=Zi(N["!ref"]),oe=Array.isArray(N),fe="\r\n";W.push("P;PGeneral"),W.push("F;P0;DG0G8;M255"),N["!cols"]&&function E(N,B){B.forEach(function(W,V){var X="F;W"+(V+1)+" "+(V+1)+" ";W.hidden?X+="0":("number"==typeof W.width&&!W.wpx&&(W.wpx=JC(W.width)),"number"==typeof W.wpx&&!W.wch&&(W.wch=QC(W.wpx)),"number"==typeof W.wch&&(X+=Math.round(W.wch)))," "!=X.charAt(X.length-1)&&N.push(X)})}(W,N["!cols"]),N["!rows"]&&function D(N,B){B.forEach(function(W,V){var X="F;";W.hidden?X+="M0;":W.hpt?X+="M"+20*W.hpt+";":W.hpx&&(X+="M"+20*eS(W.hpx)+";"),X.length>2&&N.push(X+"R"+(V+1))})}(W,N["!rows"]),W.push("B;Y"+(X.e.r-X.s.r+1)+";X"+(X.e.c-X.s.c+1)+";D"+[X.s.c,X.s.r,X.e.c,X.e.r].join(" "));for(var Le=X.s.r;Le<=X.e.r;++Le)for(var Ze=X.s.c;Ze<=X.e.c;++Ze){var at=Zr({r:Le,c:Ze});(le=oe?(N[Le]||[])[Ze]:N[at])&&(null!=le.v||le.f&&!le.F)&&V.push(x(le,0,Le,Ze))}return W.join(fe)+fe+V.join(fe)+fe+"E"+fe}}}(),r7=function(){function n(l,h){for(var g=l.split("\n"),x=-1,E=-1,D=0,O=[];D!==g.length;++D)if("BOT"!==g[D].trim()){if(!(x<0)){for(var N=g[D].trim().split(","),B=N[0],W=N[1],V=g[++D]||"";1&(V.match(/["]/g)||[]).length&&D<g.length-1;)V+="\n"+g[++D];switch(V=V.trim(),+B){case-1:if("BOT"===V){O[++x]=[],E=0;continue}if("EOD"!==V)throw new Error("Unrecognized DIF special command "+V);break;case 0:O[x][E]="TRUE"===V||"FALSE"!==V&&(isNaN(gf(W))?isNaN(Aw(W).getDate())?W:Eo(W):gf(W)),++E;break;case 1:(V=(V=V.slice(1,V.length-1)).replace(/""/g,'"'))&&V.match(/^=".*"$/)&&(V=V.slice(2,-1)),O[x][E++]=""!==V?V:null}if("EOD"===V)break}}else O[++x]=[],E=0;return h&&h.sheetRows&&(O=O.slice(0,h.sheetRows)),O}function t(l,h){return Ow(function e(l,h){switch(h.type){case"base64":return n(Ku(l),h);case"binary":return n(l,h);case"buffer":return n(Oi&&Buffer.isBuffer(l)?l.toString("binary"):C_(l),h);case"array":return n(ev(l),h)}throw new Error("Unrecognized type "+h.type)}(l,h),h)}return{to_workbook:function r(l,h){return I_(t(l,h),h)},to_sheet:t,from_sheet:function(){var l=function(x,E,D,O,N){x.push(E),x.push(D+","+O),x.push('"'+N.replace(/"/g,'""')+'"')},h=function(x,E,D,O){x.push(E+","+D),x.push(1==E?'"'+O.replace(/"/g,'""')+'"':O)};return function(x){var O,E=[],D=Zi(x["!ref"]),N=Array.isArray(x);l(E,"TABLE",0,1,"sheetjs"),l(E,"VECTORS",0,D.e.r-D.s.r+1,""),l(E,"TUPLES",0,D.e.c-D.s.c+1,""),l(E,"DATA",0,0,"");for(var B=D.s.r;B<=D.e.r;++B){h(E,-1,0,"BOT");for(var W=D.s.c;W<=D.e.c;++W){var V=Zr({r:B,c:W});if(O=N?(x[B]||[])[W]:x[V])switch(O.t){case"n":var X=O.w;!X&&null!=O.v&&(X=O.v),null==X?h(E,1,0,O.f&&!O.F?"="+O.f:""):h(E,0,X,"V");break;case"b":h(E,0,O.v?1:0,O.v?"TRUE":"FALSE");break;case"s":h(E,1,0,isNaN(O.v)?O.v:'="'+O.v+'"');break;case"d":O.w||(O.w=Qu(O.z||Br[14],vl(Eo(O.v)))),h(E,0,O.w,"V");break;default:h(E,1,0,"")}else h(E,1,0,"")}}return h(E,-1,0,"EOD"),E.join("\r\n")}}()}}(),i7=function(){function e(O){return O.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,"\n")}function n(O){return O.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function r(O,N){return Ow(function t(O,N){for(var B=O.split("\n"),W=-1,V=-1,X=0,le=[];X!==B.length;++X){var oe=B[X].trim().split(":");if("cell"===oe[0]){var fe=na(oe[1]);if(le.length<=fe.r)for(W=le.length;W<=fe.r;++W)le[W]||(le[W]=[]);switch(W=fe.r,V=fe.c,oe[2]){case"t":le[W][V]=e(oe[3]);break;case"v":le[W][V]=+oe[3];break;case"vtf":var Le=oe[oe.length-1];case"vtc":le[W][V]="nl"===oe[3]?!!+oe[4]:+oe[4],"vtf"==oe[2]&&(le[W][V]=[le[W][V],Le])}}}return N&&N.sheetRows&&(le=le.slice(0,N.sheetRows)),le}(O,N),N)}var l=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join("\n"),h=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join("\n")+"\n",g=["# SocialCalc Spreadsheet Control Save","part:sheet"].join("\n"),x="--SocialCalcSpreadsheetControlSave--";function E(O){if(!O||!O["!ref"])return"";for(var W,N=[],B=[],V="",X=Hc(O["!ref"]),le=Array.isArray(O),oe=X.s.r;oe<=X.e.r;++oe)for(var fe=X.s.c;fe<=X.e.c;++fe)if(V=Zr({r:oe,c:fe}),(W=le?(O[oe]||[])[fe]:O[V])&&null!=W.v&&"z"!==W.t){switch(B=["cell",V,"t"],W.t){case"s":case"str":B.push(n(W.v));break;case"n":W.f?(B[2]="vtf",B[3]="n",B[4]=W.v,B[5]=n(W.f)):(B[2]="v",B[3]=W.v);break;case"b":B[2]="vt"+(W.f?"f":"c"),B[3]="nl",B[4]=W.v?"1":"0",B[5]=n(W.f||(W.v?"TRUE":"FALSE"));break;case"d":var Le=vl(Eo(W.v));B[2]="vtc",B[3]="nd",B[4]=""+Le,B[5]=W.w||Qu(W.z||Br[14],Le);break;case"e":continue}N.push(B.join(":"))}return N.push("sheet:c:"+(X.e.c-X.s.c+1)+":r:"+(X.e.r-X.s.r+1)+":tvf:1"),N.push("valueformat:1:text-wiki"),N.join("\n")}return{to_workbook:function s(O,N){return I_(r(O,N),N)},to_sheet:r,from_sheet:function D(O){return[l,h,g,h,E(O),x].join("\n")}}}(),Nw=function(){function e(D,O,N,B,W){W.raw?O[N][B]=D:""===D||(O[N][B]="TRUE"===D||"FALSE"!==D&&(isNaN(gf(D))?isNaN(Aw(D).getDate())?D:Eo(D):gf(D)))}var t={44:",",9:"\t",59:";",124:"|"},r={44:3,9:2,59:1,124:0};function s(D){for(var O={},N=!1,B=0,W=0;B<D.length;++B)34==(W=D.charCodeAt(B))?N=!N:!N&&W in t&&(O[W]=(O[W]||0)+1);for(B in W=[],O)Object.prototype.hasOwnProperty.call(O,B)&&W.push([O[B],B]);if(!W.length)for(B in O=r)Object.prototype.hasOwnProperty.call(O,B)&&W.push([O[B],B]);return W.sort(function(V,X){return V[0]-X[0]||r[V[1]]-r[X[1]]}),t[W.pop()[1]]||44}function h(D,O){return!O||!O.PRN||O.FS||"sep="==D.slice(0,4)||D.indexOf("\t")>=0||D.indexOf(",")>=0||D.indexOf(";")>=0?function l(D,O){var N=O||{},B="";null!=Po&&null==N.dense&&(N.dense=Po);var W=N.dense?[]:{},V={s:{c:0,r:0},e:{c:0,r:0}};"sep="==D.slice(0,4)?13==D.charCodeAt(5)&&10==D.charCodeAt(6)?(B=D.charAt(4),D=D.slice(7)):13==D.charCodeAt(5)||10==D.charCodeAt(5)?(B=D.charAt(4),D=D.slice(6)):B=s(D.slice(0,1024)):B=N&&N.FS?N.FS:s(D.slice(0,1024));var X=0,le=0,oe=0,fe=0,Le=0,Ze=B.charCodeAt(0),at=!1,Ne=0,ot=D.charCodeAt(0);D=D.replace(/\r\n/gm,"\n");var lt=null!=N.dateNF?function noe(e){var n="number"==typeof e?Br[e]:e;return n=n.replace(CV,"(\\d+)"),new RegExp("^"+n+"$")}(N.dateNF):null;function Tt(){var Ot=D.slice(fe,Le),ft={};if('"'==Ot.charAt(0)&&'"'==Ot.charAt(Ot.length-1)&&(Ot=Ot.slice(1,-1).replace(/""/g,'"')),0===Ot.length)ft.t="z";else if(N.raw)ft.t="s",ft.v=Ot;else if(0===Ot.trim().length)ft.t="s",ft.v=Ot;else if(61==Ot.charCodeAt(0))34==Ot.charCodeAt(1)&&34==Ot.charCodeAt(Ot.length-1)?(ft.t="s",ft.v=Ot.slice(2,-1).replace(/""/g,'"')):function She(e){return 1!=e.length}(Ot)?(ft.t="n",ft.f=Ot.slice(1)):(ft.t="s",ft.v=Ot);else if("TRUE"==Ot)ft.t="b",ft.v=!0;else if("FALSE"==Ot)ft.t="b",ft.v=!1;else if(isNaN(oe=gf(Ot)))if(!isNaN(Aw(Ot).getDate())||lt&&Ot.match(lt)){ft.z=N.dateNF||Br[14];var un=0;lt&&Ot.match(lt)&&(Ot=function roe(e,n,t){var r=-1,s=-1,l=-1,h=-1,g=-1,x=-1;(n.match(CV)||[]).forEach(function(O,N){var B=parseInt(t[N+1],10);switch(O.toLowerCase().charAt(0)){case"y":r=B;break;case"d":l=B;break;case"h":h=B;break;case"s":x=B;break;case"m":h>=0?g=B:s=B}}),x>=0&&-1==g&&s>=0&&(g=s,s=-1);var E=(""+(r>=0?r:(new Date).getFullYear())).slice(-4)+"-"+("00"+(s>=1?s:1)).slice(-2)+"-"+("00"+(l>=1?l:1)).slice(-2);7==E.length&&(E="0"+E),8==E.length&&(E="20"+E);var D=("00"+(h>=0?h:0)).slice(-2)+":"+("00"+(g>=0?g:0)).slice(-2)+":"+("00"+(x>=0?x:0)).slice(-2);return-1==h&&-1==g&&-1==x?E:-1==r&&-1==s&&-1==l?D:E+"T"+D}(0,N.dateNF,Ot.match(lt)||[]),un=1),N.cellDates?(ft.t="d",ft.v=Eo(Ot,un)):(ft.t="n",ft.v=vl(Eo(Ot,un))),!1!==N.cellText&&(ft.w=Qu(ft.z,ft.v instanceof Date?vl(ft.v):ft.v)),N.cellNF||delete ft.z}else ft.t="s",ft.v=Ot;else ft.t="n",!1!==N.cellText&&(ft.w=Ot),ft.v=oe;if("z"==ft.t||(N.dense?(W[X]||(W[X]=[]),W[X][le]=ft):W[Zr({c:le,r:X})]=ft),ot=D.charCodeAt(fe=Le+1),V.e.c<le&&(V.e.c=le),V.e.r<X&&(V.e.r=X),Ne==Ze)++le;else if(le=0,++X,N.sheetRows&&N.sheetRows<=X)return!0}e:for(;Le<D.length;++Le)switch(Ne=D.charCodeAt(Le)){case 34:34===ot&&(at=!at);break;case Ze:case 10:case 13:if(!at&&Tt())break e}return Le-fe>0&&Tt(),W["!ref"]=gi(V),W}(D,O):Ow(function n(D,O){var N=O||{},B=[];if(!D||0===D.length)return B;for(var W=D.split(/[\r\n]/),V=W.length-1;V>=0&&0===W[V].length;)--V;for(var X=10,le=0,oe=0;oe<=V;++oe)-1==(le=W[oe].indexOf(" "))?le=W[oe].length:le++,X=Math.max(X,le);for(oe=0;oe<=V;++oe){B[oe]=[];var fe=0;for(e(W[oe].slice(0,X).trim(),B,oe,fe,N),fe=1;fe<=(W[oe].length-X)/10+1;++fe)e(W[oe].slice(X+10*(fe-1),X+10*fe).trim(),B,oe,fe,N)}return N.sheetRows&&(B=B.slice(0,N.sheetRows)),B}(D,O),O)}function g(D,O){var N="",B="string"==O.type?[0,0,0,0]:function y3(e,n){var t="";switch((n||{}).type||"base64"){case"buffer":case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":t=Ku(e.slice(0,12));break;case"binary":t=e;break;default:throw new Error("Unrecognized type "+(n&&n.type||"undefined"))}return[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3),t.charCodeAt(4),t.charCodeAt(5),t.charCodeAt(6),t.charCodeAt(7)]}(D,O);switch(O.type){case"base64":N=Ku(D);break;case"binary":case"string":N=D;break;case"buffer":N=65001==O.codepage?D.toString("utf8"):O.codepage&&typeof Ji<"u"?Ji.utils.decode(O.codepage,D):Oi&&Buffer.isBuffer(D)?D.toString("binary"):C_(D);break;case"array":N=ev(D);break;default:throw new Error("Unrecognized type "+O.type)}return 239==B[0]&&187==B[1]&&191==B[2]?N=oo(N.slice(3)):"string"!=O.type&&"buffer"!=O.type&&65001==O.codepage?N=oo(N):"binary"==O.type&&typeof Ji<"u"&&O.codepage&&(N=Ji.utils.decode(O.codepage,Ji.utils.encode(28591,N))),"socialcalc:version:"==N.slice(0,19)?i7.to_sheet("string"==O.type?N:oo(N),O):h(N,O)}return{to_workbook:function x(D,O){return I_(g(D,O),O)},to_sheet:g,from_sheet:function E(D){for(var B,O=[],N=Zi(D["!ref"]),W=Array.isArray(D),V=N.s.r;V<=N.e.r;++V){for(var X=[],le=N.s.c;le<=N.e.c;++le){var oe=Zr({r:V,c:le});if((B=W?(D[V]||[])[le]:D[oe])&&null!=B.v){for(var fe=(B.w||(em(B),B.w)||"").slice(0,10);fe.length<10;)fe+=" ";X.push(fe+(0===le?" ":""))}else X.push("          ")}O.push(X.join(""))}return O.join("\n")}}}(),dv=function(){function e(qe,St,rt){if(qe){Xl(qe,qe.l||0);for(var et=rt.Enum||Or;qe.l<qe.length;){var Yt=qe.read_shift(2),jn=et[Yt]||et[65535],vn=qe.read_shift(2),Sn=qe.l+vn,rn=jn.f&&jn.f(qe,vn,rt);if(qe.l=Sn,St(rn,jn,Yt))return}}}function t(qe,St){if(!qe)return qe;var rt=St||{};null!=Po&&null==rt.dense&&(rt.dense=Po);var et=rt.dense?[]:{},Yt="Sheet1",jn="",vn=0,Sn={},rn=[],ai=[],We={s:{r:0,c:0},e:{r:0,c:0}},os=rt.sheetRows||0;if(0==qe[2]&&(8==qe[3]||9==qe[3])&&qe.length>=16&&5==qe[14]&&108===qe[15])throw new Error("Unsupported Works 3 for Mac file");if(2==qe[2])rt.Enum=Or,e(qe,function(Gn,Co,pu){switch(pu){case 0:rt.vers=Gn,Gn>=4096&&(rt.qpro=!0);break;case 6:We=Gn;break;case 204:Gn&&(jn=Gn);break;case 222:jn=Gn;break;case 15:case 51:rt.qpro||(Gn[1].v=Gn[1].v.slice(1));case 13:case 14:case 16:14==pu&&!(112&~Gn[2])&&(15&Gn[2])>1&&(15&Gn[2])<15&&(Gn[1].z=rt.dateNF||Br[14],rt.cellDates&&(Gn[1].t="d",Gn[1].v=mF(Gn[1].v))),rt.qpro&&Gn[3]>vn&&(et["!ref"]=gi(We),Sn[Yt]=et,rn.push(Yt),et=rt.dense?[]:{},We={s:{r:0,c:0},e:{r:0,c:0}},vn=Gn[3],Yt=jn||"Sheet"+(vn+1),jn="");var El=rt.dense?(et[Gn[0].r]||[])[Gn[0].c]:et[Zr(Gn[0])];if(El){El.t=Gn[1].t,El.v=Gn[1].v,null!=Gn[1].z&&(El.z=Gn[1].z),null!=Gn[1].f&&(El.f=Gn[1].f);break}rt.dense?(et[Gn[0].r]||(et[Gn[0].r]=[]),et[Gn[0].r][Gn[0].c]=Gn[1]):et[Zr(Gn[0])]=Gn[1]}},rt);else{if(26!=qe[2]&&14!=qe[2])throw new Error("Unrecognized LOTUS BOF "+qe[2]);rt.Enum=nn,14==qe[2]&&(rt.qpro=!0,qe.l=0),e(qe,function(Gn,Co,pu){switch(pu){case 204:Yt=Gn;break;case 22:Gn[1].v=Gn[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Gn[3]>vn&&(et["!ref"]=gi(We),Sn[Yt]=et,rn.push(Yt),et=rt.dense?[]:{},We={s:{r:0,c:0},e:{r:0,c:0}},Yt="Sheet"+((vn=Gn[3])+1)),os>0&&Gn[0].r>=os)break;rt.dense?(et[Gn[0].r]||(et[Gn[0].r]=[]),et[Gn[0].r][Gn[0].c]=Gn[1]):et[Zr(Gn[0])]=Gn[1],We.e.c<Gn[0].c&&(We.e.c=Gn[0].c),We.e.r<Gn[0].r&&(We.e.r=Gn[0].r);break;case 27:Gn[14e3]&&(ai[Gn[14e3][0]]=Gn[14e3][1]);break;case 1537:ai[Gn[0]]=Gn[1],Gn[0]==vn&&(Yt=Gn[1])}},rt)}if(et["!ref"]=gi(We),Sn[jn||Yt]=et,rn.push(jn||Yt),!ai.length)return{SheetNames:rn,Sheets:Sn};for(var Ri={},gs=[],Mi=0;Mi<ai.length;++Mi)Sn[rn[Mi]]?(gs.push(ai[Mi]||rn[Mi]),Ri[ai[Mi]]=Sn[ai[Mi]]||Sn[rn[Mi]]):(gs.push(ai[Mi]),Ri[ai[Mi]]={"!ref":"A1"});return{SheetNames:gs,Sheets:Ri}}function E(qe,St,rt){var et=[{c:0,r:0},{t:"n",v:0},0,0];return rt.qpro&&20768!=rt.vers?(et[0].c=qe.read_shift(1),et[3]=qe.read_shift(1),et[0].r=qe.read_shift(2),qe.l+=2):(et[2]=qe.read_shift(1),et[0].c=qe.read_shift(2),et[0].r=qe.read_shift(2)),et}function D(qe,St,rt){var et=qe.l+St,Yt=E(qe,0,rt);if(Yt[1].t="s",20768==rt.vers){qe.l++;var jn=qe.read_shift(1);return Yt[1].v=qe.read_shift(jn,"utf8"),Yt}return rt.qpro&&qe.l++,Yt[1].v=qe.read_shift(et-qe.l,"cstr"),Yt}function O(qe,St,rt){var et=Xt(7+rt.length);et.write_shift(1,255),et.write_shift(2,St),et.write_shift(2,qe),et.write_shift(1,39);for(var Yt=0;Yt<et.length;++Yt){var jn=rt.charCodeAt(Yt);et.write_shift(1,jn>=128?95:jn)}return et.write_shift(1,0),et}function B(qe,St,rt){var et=Xt(7);return et.write_shift(1,255),et.write_shift(2,St),et.write_shift(2,qe),et.write_shift(2,rt,"i"),et}function V(qe,St,rt){var et=Xt(13);return et.write_shift(1,255),et.write_shift(2,St),et.write_shift(2,qe),et.write_shift(8,rt,"f"),et}function le(qe,St,rt){var et=32768&St;return St=(et?qe:0)+((St&=-32769)>=8192?St-16384:St),(et?"":"$")+(rt?ao(St):Bo(St))}var oe={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},fe=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function Ze(qe){var St=[{c:0,r:0},{t:"n",v:0},0];return St[0].r=qe.read_shift(2),St[3]=qe[qe.l++],St[0].c=qe[qe.l++],St}function Ne(qe,St,rt,et){var Yt=Xt(6+et.length);Yt.write_shift(2,qe),Yt.write_shift(1,rt),Yt.write_shift(1,St),Yt.write_shift(1,39);for(var jn=0;jn<et.length;++jn){var vn=et.charCodeAt(jn);Yt.write_shift(1,vn>=128?95:vn)}return Yt.write_shift(1,0),Yt}function lt(qe,St){var rt=Ze(qe),et=qe.read_shift(4),Yt=qe.read_shift(4),jn=qe.read_shift(2);if(65535==jn)return 0===et&&3221225472===Yt?(rt[1].t="e",rt[1].v=15):0===et&&3489660928===Yt?(rt[1].t="e",rt[1].v=42):rt[1].v=0,rt;var vn=32768&jn;return jn=(32767&jn)-16446,rt[1].v=(1-2*vn)*(Yt*Math.pow(2,jn+32)+et*Math.pow(2,jn)),rt}function Tt(qe,St,rt,et){var Yt=Xt(14);if(Yt.write_shift(2,qe),Yt.write_shift(1,rt),Yt.write_shift(1,St),0==et)return Yt.write_shift(4,0),Yt.write_shift(4,0),Yt.write_shift(2,65535),Yt;var jn=0,vn=0,rn=0;return et<0&&(jn=1,et=-et),vn=0|Math.log2(et),2147483648&(rn=(et/=Math.pow(2,vn-31))>>>0)||(++vn,rn=(et/=2)>>>0),et-=rn,rn|=2147483648,rn>>>=0,et*=Math.pow(2,32),Yt.write_shift(4,et>>>0),Yt.write_shift(4,rn),Yt.write_shift(2,vn+=16383+(jn?32768:0)),Yt}function un(qe,St){var rt=Ze(qe),et=qe.read_shift(8,"f");return rt[1].v=et,rt}function On(qe,St){return 0==qe[qe.l+St-1]?qe.read_shift(St,"cstr"):""}function Vn(qe,St){var rt=Xt(5+qe.length);rt.write_shift(2,14e3),rt.write_shift(2,St);for(var et=0;et<qe.length;++et){var Yt=qe.charCodeAt(et);rt[rt.l++]=Yt>127?95:Yt}return rt[rt.l++]=0,rt}var Or={0:{n:"BOF",f:Ea},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:function g(qe,St,rt){var et={s:{c:0,r:0},e:{c:0,r:0}};return 8==St&&rt.qpro?(et.s.c=qe.read_shift(1),qe.l++,et.s.r=qe.read_shift(2),et.e.c=qe.read_shift(1),qe.l++,et.e.r=qe.read_shift(2),et):(et.s.c=qe.read_shift(2),et.s.r=qe.read_shift(2),12==St&&rt.qpro&&(qe.l+=2),et.e.c=qe.read_shift(2),et.e.r=qe.read_shift(2),12==St&&rt.qpro&&(qe.l+=2),65535==et.s.c&&(et.s.c=et.e.c=et.s.r=et.e.r=0),et)}},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:function N(qe,St,rt){var et=E(qe,0,rt);return et[1].v=qe.read_shift(2,"i"),et}},14:{n:"NUMBER",f:function W(qe,St,rt){var et=E(qe,0,rt);return et[1].v=qe.read_shift(8,"f"),et}},15:{n:"LABEL",f:D},16:{n:"FORMULA",f:function X(qe,St,rt){var et=qe.l+St,Yt=E(qe,0,rt);if(Yt[1].v=qe.read_shift(8,"f"),rt.qpro)qe.l=et;else{var jn=qe.read_shift(2);(function Le(qe,St){Xl(qe,0);for(var rt=[],et=0,Yt="",jn="",vn="",Sn="";qe.l<qe.length;){var rn=qe[qe.l++];switch(rn){case 0:rt.push(qe.read_shift(8,"f"));break;case 1:jn=le(St[0].c,qe.read_shift(2),!0),Yt=le(St[0].r,qe.read_shift(2),!1),rt.push(jn+Yt);break;case 2:var ai=le(St[0].c,qe.read_shift(2),!0),We=le(St[0].r,qe.read_shift(2),!1);jn=le(St[0].c,qe.read_shift(2),!0),Yt=le(St[0].r,qe.read_shift(2),!1),rt.push(ai+We+":"+jn+Yt);break;case 3:if(qe.l<qe.length)return void console.error("WK1 premature formula end");break;case 4:rt.push("("+rt.pop()+")");break;case 5:rt.push(qe.read_shift(2));break;case 6:for(var os="";rn=qe[qe.l++];)os+=String.fromCharCode(rn);rt.push('"'+os.replace(/"/g,'""')+'"');break;case 8:rt.push("-"+rt.pop());break;case 23:rt.push("+"+rt.pop());break;case 22:rt.push("NOT("+rt.pop()+")");break;case 20:case 21:Sn=rt.pop(),vn=rt.pop(),rt.push(["AND","OR"][rn-20]+"("+vn+","+Sn+")");break;default:if(rn<32&&fe[rn])Sn=rt.pop(),vn=rt.pop(),rt.push(vn+fe[rn]+Sn);else{if(!oe[rn])return rn<=7?console.error("WK1 invalid opcode "+rn.toString(16)):rn<=24?console.error("WK1 unsupported op "+rn.toString(16)):rn<=30?console.error("WK1 invalid opcode "+rn.toString(16)):rn<=115?console.error("WK1 unsupported function opcode "+rn.toString(16)):console.error("WK1 unrecognized opcode "+rn.toString(16));if(69==(et=oe[rn][1])&&(et=qe[qe.l++]),et>rt.length)return void console.error("WK1 bad formula parse 0x"+rn.toString(16)+":|"+rt.join("|")+"|");var Ri=rt.slice(-et);rt.length-=et,rt.push(oe[rn][0]+"("+Ri.join(",")+")")}}}1==rt.length?St[1].f=""+rt[0]:console.error("WK1 bad formula parse |"+rt.join("|")+"|")})(qe.slice(qe.l,qe.l+jn),Yt),qe.l+=jn}return Yt}},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:D},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:On},222:{n:"SHEETNAMELP",f:function pr(qe,St){var rt=qe[qe.l++];rt>St-1&&(rt=St-1);for(var et="";et.length<rt;)et+=String.fromCharCode(qe[qe.l++]);return et}},65535:{n:""}},nn={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:function at(qe,St){var rt=Ze(qe);return rt[1].t="s",rt[1].v=qe.read_shift(St-4,"cstr"),rt}},23:{n:"NUMBER17",f:lt},24:{n:"NUMBER18",f:function ot(qe,St){var rt=Ze(qe);rt[1].v=qe.read_shift(2);var et=rt[1].v>>1;if(1&rt[1].v)switch(7&et){case 0:et=5e3*(et>>3);break;case 1:et=500*(et>>3);break;case 2:et=(et>>3)/20;break;case 3:et=(et>>3)/200;break;case 4:et=(et>>3)/2e3;break;case 5:et=(et>>3)/2e4;break;case 6:et=(et>>3)/16;break;case 7:et=(et>>3)/64}return rt[1].v=et,rt}},25:{n:"FORMULA19",f:function Ot(qe,St){var rt=lt(qe);return qe.l+=St-14,rt}},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:function yi(qe,St){for(var rt={},et=qe.l+St;qe.l<et;){var Yt=qe.read_shift(2);if(14e3==Yt){for(rt[Yt]=[0,""],rt[Yt][0]=qe.read_shift(2);qe[qe.l];)rt[Yt][1]+=String.fromCharCode(qe[qe.l]),qe.l++;qe.l++}}return rt}},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:function ft(qe,St){var rt=Ze(qe),et=qe.read_shift(4);return rt[1].v=et>>6,rt}},38:{n:"??"},39:{n:"NUMBER27",f:un},40:{n:"FORMULA28",f:function Wn(qe,St){var rt=un(qe);return qe.l+=St-10,rt}},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:On},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:function er(qe,St,rt){if(rt.qpro&&!(St<21)){var et=qe.read_shift(1);return qe.l+=17,qe.l+=1,qe.l+=2,[et,qe.read_shift(St-21,"cstr")]}}},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:function r(qe,St){var rt=St||{};if(+rt.codepage>=0&&id(+rt.codepage),"string"==rt.type)throw new Error("Cannot write WK1 to JS string");var et=$c(),Yt=Zi(qe["!ref"]),jn=Array.isArray(qe),vn=[];Ln(et,0,function l(qe){var St=Xt(2);return St.write_shift(2,qe),St}(1030)),Ln(et,6,function x(qe){var St=Xt(8);return St.write_shift(2,qe.s.c),St.write_shift(2,qe.s.r),St.write_shift(2,qe.e.c),St.write_shift(2,qe.e.r),St}(Yt));for(var Sn=Math.min(Yt.e.r,8191),rn=Yt.s.r;rn<=Sn;++rn)for(var ai=Bo(rn),We=Yt.s.c;We<=Yt.e.c;++We){rn===Yt.s.r&&(vn[We]=ao(We));var Ri=jn?(qe[rn]||[])[We]:qe[vn[We]+ai];Ri&&"z"!=Ri.t&&("n"==Ri.t?(0|Ri.v)==Ri.v&&Ri.v>=-32768&&Ri.v<=32767?Ln(et,13,B(rn,We,Ri.v)):Ln(et,14,V(rn,We,Ri.v)):Ln(et,15,O(rn,We,em(Ri).slice(0,239))))}return Ln(et,1),et.end()},book_to_wk3:function s(qe,St){var rt=St||{};if(+rt.codepage>=0&&id(+rt.codepage),"string"==rt.type)throw new Error("Cannot write WK3 to JS string");var et=$c();Ln(et,0,function h(qe){var St=Xt(26);St.write_shift(2,4096),St.write_shift(2,4),St.write_shift(4,0);for(var rt=0,et=0,Yt=0,jn=0;jn<qe.SheetNames.length;++jn){var Sn=qe.Sheets[qe.SheetNames[jn]];if(Sn&&Sn["!ref"]){++Yt;var rn=Hc(Sn["!ref"]);rt<rn.e.r&&(rt=rn.e.r),et<rn.e.c&&(et=rn.e.c)}}return rt>8191&&(rt=8191),St.write_shift(2,rt),St.write_shift(1,Yt),St.write_shift(1,et),St.write_shift(2,0),St.write_shift(2,0),St.write_shift(1,1),St.write_shift(1,2),St.write_shift(4,0),St.write_shift(4,0),St}(qe));for(var Yt=0,jn=0;Yt<qe.SheetNames.length;++Yt)(qe.Sheets[qe.SheetNames[Yt]]||{})["!ref"]&&Ln(et,27,Vn(qe.SheetNames[Yt],jn++));var vn=0;for(Yt=0;Yt<qe.SheetNames.length;++Yt){var Sn=qe.Sheets[qe.SheetNames[Yt]];if(Sn&&Sn["!ref"]){for(var rn=Zi(Sn["!ref"]),ai=Array.isArray(Sn),We=[],os=Math.min(rn.e.r,8191),Ri=rn.s.r;Ri<=os;++Ri)for(var gs=Bo(Ri),Mi=rn.s.c;Mi<=rn.e.c;++Mi){Ri===rn.s.r&&(We[Mi]=ao(Mi));var Co=ai?(Sn[Ri]||[])[Mi]:Sn[We[Mi]+gs];Co&&"z"!=Co.t&&("n"==Co.t?Ln(et,23,Tt(Ri,Mi,vn,Co.v)):Ln(et,22,Ne(Ri,Mi,vn,em(Co).slice(0,239))))}++vn}}return Ln(et,1),et.end()},to_workbook:function n(qe,St){switch(St.type){case"base64":return t(Ju(Ku(qe)),St);case"binary":return t(Ju(qe),St);case"buffer":case"array":return t(qe,St)}throw"Unsupported type "+St.type}}}(),Ace=/^\s|\s$|[\t\n\r]/;function o7(e,n){if(!n.bookSST)return"";var t=[Lo];t[t.length]=Rn("sst",null,{xmlns:A_[0],count:e.Count,uniqueCount:e.Unique});for(var r=0;r!=e.length;++r)if(null!=e[r]){var s=e[r],l="<si>";s.r?l+=s.r:(l+="<t",s.t||(s.t=""),s.t.match(Ace)&&(l+=' xml:space="preserve"'),l+=">"+As(s.t)+"</t>"),t[t.length]=l+="</si>"}return t.length>2&&(t[t.length]="</sst>",t[1]=t[1].replace("/>",">")),t.join("")}var Rce=function $oe(e,n){var t=!1;return null==n&&(t=!0,n=Xt(15+4*e.t.length)),n.write_shift(1,0),bl(e.t,n),t?n.slice(0,n.l):n};function Pce(e){var n=$c();tn(n,159,function Oce(e,n){return n||(n=Xt(8)),n.write_shift(4,e.Count),n.write_shift(4,e.Unique),n}(e));for(var t=0;t<e.length;++t)tn(n,19,Rce(e[t]));return tn(n,160),n.end()}function XF(e){var t,l,n=0,r=function a7(e){if(typeof Ji<"u")return Ji.utils.encode(Jy,e);for(var n=[],t=e.split(""),r=0;r<t.length;++r)n[r]=t[r].charCodeAt(0);return n}(e),s=r.length+1;for((t=E_(s))[0]=r.length,l=1;l!=s;++l)t[l]=r[l-1];for(l=s-1;l>=0;--l)n=((16384&n?1:0)|n<<1&32767)^t[l];return 52811^n}var h7=function(){function e(s,l){switch(l.type){case"base64":return n(Ku(s),l);case"binary":return n(s,l);case"buffer":return n(Oi&&Buffer.isBuffer(s)?s.toString("binary"):C_(s),l);case"array":return n(ev(s),l)}throw new Error("Unrecognized type "+l.type)}function n(s,l){var g=(l||{}).dense?[]:{},x=s.match(/\\trowd.*?\\row\b/g);if(!x.length)throw new Error("RTF missing table");var E={s:{c:0,r:0},e:{c:0,r:x.length-1}};return x.forEach(function(D,O){Array.isArray(g)&&(g[O]=[]);for(var W,N=/\\\w+\b/g,B=0,V=-1;W=N.exec(D);){if("\\cell"===W[0]){var X=D.slice(B,N.lastIndex-W[0].length);if(" "==X[0]&&(X=X.slice(1)),++V,X.length){var le={v:X,t:"s"};Array.isArray(g)?g[O][V]=le:g[Zr({r:O,c:V})]=le}}B=N.lastIndex}V>E.e.c&&(E.e.c=V)}),g["!ref"]=gi(E),g}return{to_workbook:function t(s,l){return I_(e(s,l),l)},to_sheet:e,from_sheet:function r(s){for(var g,l=["{\\rtf1\\ansi"],h=Zi(s["!ref"]),x=Array.isArray(s),E=h.s.r;E<=h.e.r;++E){l.push("\\trowd\\trautofit1");for(var D=h.s.c;D<=h.e.c;++D)l.push("\\cellx"+(D+1));for(l.push("\\pard\\intbl"),D=h.s.c;D<=h.e.c;++D){var O=Zr({r:E,c:D});(g=x?(s[E]||[])[D]:s[O])&&(null!=g.v||g.f&&!g.F)&&(l.push(" "+(g.w||(em(g),g.w))),l.push("\\cell"))}l.push("\\pard\\intbl\\row")}return l.join("")+"}"}}}();function KC(e){for(var n=0,t=1;3!=n;++n)t=256*t+(e[n]>255?255:e[n]<0?0:e[n]);return t.toString(16).toUpperCase().slice(1)}var yc=6;function JC(e){return Math.floor((e+Math.round(128/yc)/256)*yc)}function QC(e){return Math.floor((e-5)/yc*100+.5)/100}function bk(e){return Math.round((e*yc+5)/yc*256)/256}function O_(e){e.width?(e.wpx=JC(e.width),e.wch=QC(e.wpx),e.MDW=yc):e.wpx?(e.wch=QC(e.wpx),e.width=bk(e.wch),e.MDW=yc):"number"==typeof e.wch&&(e.width=bk(e.wch),e.wpx=JC(e.width),e.MDW=yc),e.customWidth&&delete e.customWidth}var f7=96;function eS(e){return 96*e/f7}function wk(e){return e*f7/96}function p7(e,n){var r,t=[Lo,Rn("styleSheet",null,{xmlns:A_[0],"xmlns:vt":Ta.vt})];return e.SSF&&null!=(r=function sue(e){var n=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(t){for(var r=t[0];r<=t[1];++r)null!=e[r]&&(n[n.length]=Rn("numFmt",null,{numFmtId:r,formatCode:As(e[r])}))}),1===n.length?"":(n[n.length]="</numFmts>",n[0]=Rn("numFmts",null,{count:n.length-2}).replace("/>",">"),n.join(""))}(e.SSF))&&(t[t.length]=r),t[t.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',t[t.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',t[t.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',t[t.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(r=function oue(e){var n=[];return n[n.length]=Rn("cellXfs",null),e.forEach(function(t){n[n.length]=Rn("xf",null,t)}),n[n.length]="</cellXfs>",2===n.length?"":(n[0]=Rn("cellXfs",null,{count:n.length-2}).replace("/>",">"),n.join(""))}(n.cellXfs))&&(t[t.length]=r),t[t.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',t[t.length]='<dxfs count="0"/>',t[t.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',t.length>2&&(t[t.length]="</styleSheet>",t[1]=t[1].replace("/>",">")),t.join("")}function cue(e,n,t){t||(t=Xt(6+4*n.length)),t.write_shift(2,e),bl(n,t);var r=t.length>t.l?t.slice(0,t.l):t;return null==t.l&&(t.l=t.length),r}var JF,due=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],fue=pc;function m7(e,n){n||(n=Xt(84)),JF||(JF=ik(due));var t=JF[e.patternType];null==t&&(t=40),n.write_shift(4,t);var r=0;if(40!=t)for(hk({auto:1},n),hk({auto:1},n);r<12;++r)n.write_shift(4,0);else{for(;r<4;++r)n.write_shift(4,0);for(;r<12;++r)n.write_shift(4,0)}return n.length>n.l?n.slice(0,n.l):n}function g7(e,n,t){return t||(t=Xt(16)),t.write_shift(2,n||0),t.write_shift(2,e.numFmtId||0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(1,0),t}function tS(e,n){return n||(n=Xt(10)),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(4,0),n.write_shift(4,0),n}var mue=pc;function Aue(e,n){var t=$c();return tn(t,278),function xue(e,n){if(n){var t=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var s=r[0];s<=r[1];++s)null!=n[s]&&++t}),0!=t&&(tn(e,615,_f(t)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var s=r[0];s<=r[1];++s)null!=n[s]&&tn(e,44,cue(s,n[s]))}),tn(e,616))}}(t,e.SSF),function bue(e){tn(e,611,_f(1)),tn(e,43,function hue(e,n){n||(n=Xt(153)),n.write_shift(2,20*e.sz),function Koe(e,n){n||(n=Xt(2)),n.write_shift(1,(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0)),n.write_shift(1,0)}(e,n),n.write_shift(2,e.bold?700:400);var t=0;"superscript"==e.vertAlign?t=1:"subscript"==e.vertAlign&&(t=2),n.write_shift(2,t),n.write_shift(1,e.underline||0),n.write_shift(1,e.family||0),n.write_shift(1,e.charset||0),n.write_shift(1,0),hk(e.color,n);var r=0;return"major"==e.scheme&&(r=1),"minor"==e.scheme&&(r=2),n.write_shift(1,r),bl(e.name,n),n.length>n.l?n.slice(0,n.l):n}({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),tn(e,612)}(t),function wue(e){tn(e,603,_f(2)),tn(e,45,m7({patternType:"none"})),tn(e,45,m7({patternType:"gray125"})),tn(e,604)}(t),function Tue(e){tn(e,613,_f(1)),tn(e,46,function gue(e,n){return n||(n=Xt(51)),n.write_shift(1,0),tS(0,n),tS(0,n),tS(0,n),tS(0,n),tS(0,n),n.length>n.l?n.slice(0,n.l):n}()),tn(e,614)}(t),function Eue(e){tn(e,626,_f(1)),tn(e,47,g7({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),tn(e,627)}(t),function Cue(e,n){tn(e,617,_f(n.length)),n.forEach(function(t){tn(e,47,g7(t,0))}),tn(e,618)}(t,n.cellXfs),function Sue(e){tn(e,619,_f(1)),tn(e,48,function _ue(e,n){return n||(n=Xt(52)),n.write_shift(4,e.xfId),n.write_shift(2,1),n.write_shift(1,+e.builtinId),n.write_shift(1,0),uk(e.name||"",n),n.length>n.l?n.slice(0,n.l):n}({xfId:0,builtinId:0,name:"Normal"})),tn(e,620)}(t),function Due(e){tn(e,505,_f(0)),tn(e,506)}(t),function Mue(e){tn(e,508,function yue(e,n,t){var r=Xt(2052);return r.write_shift(4,e),uk(n,r),uk(t,r),r.length>r.l?r.slice(0,r.l):r}(0,"TableStyleMedium9","PivotStyleMedium4")),tn(e,509)}(t),tn(t,279),t.end()}function QF(e,n){if(n&&n.themeXLSX)return n.themeXLSX;if(e&&"string"==typeof e.raw)return e.raw;var t=[Lo];return t[t.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',t[t.length]="<a:themeElements>",t[t.length]='<a:clrScheme name="Office">',t[t.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',t[t.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',t[t.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',t[t.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',t[t.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',t[t.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',t[t.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',t[t.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',t[t.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',t[t.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',t[t.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',t[t.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',t[t.length]="</a:clrScheme>",t[t.length]='<a:fontScheme name="Office">',t[t.length]="<a:majorFont>",t[t.length]='<a:latin typeface="Cambria"/>',t[t.length]='<a:ea typeface=""/>',t[t.length]='<a:cs typeface=""/>',t[t.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',t[t.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',t[t.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',t[t.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',t[t.length]='<a:font script="Arab" typeface="Times New Roman"/>',t[t.length]='<a:font script="Hebr" typeface="Times New Roman"/>',t[t.length]='<a:font script="Thai" typeface="Tahoma"/>',t[t.length]='<a:font script="Ethi" typeface="Nyala"/>',t[t.length]='<a:font script="Beng" typeface="Vrinda"/>',t[t.length]='<a:font script="Gujr" typeface="Shruti"/>',t[t.length]='<a:font script="Khmr" typeface="MoolBoran"/>',t[t.length]='<a:font script="Knda" typeface="Tunga"/>',t[t.length]='<a:font script="Guru" typeface="Raavi"/>',t[t.length]='<a:font script="Cans" typeface="Euphemia"/>',t[t.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',t[t.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',t[t.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',t[t.length]='<a:font script="Thaa" typeface="MV Boli"/>',t[t.length]='<a:font script="Deva" typeface="Mangal"/>',t[t.length]='<a:font script="Telu" typeface="Gautami"/>',t[t.length]='<a:font script="Taml" typeface="Latha"/>',t[t.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',t[t.length]='<a:font script="Orya" typeface="Kalinga"/>',t[t.length]='<a:font script="Mlym" typeface="Kartika"/>',t[t.length]='<a:font script="Laoo" typeface="DokChampa"/>',t[t.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',t[t.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',t[t.length]='<a:font script="Viet" typeface="Times New Roman"/>',t[t.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',t[t.length]='<a:font script="Geor" typeface="Sylfaen"/>',t[t.length]="</a:majorFont>",t[t.length]="<a:minorFont>",t[t.length]='<a:latin typeface="Calibri"/>',t[t.length]='<a:ea typeface=""/>',t[t.length]='<a:cs typeface=""/>',t[t.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',t[t.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',t[t.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',t[t.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',t[t.length]='<a:font script="Arab" typeface="Arial"/>',t[t.length]='<a:font script="Hebr" typeface="Arial"/>',t[t.length]='<a:font script="Thai" typeface="Tahoma"/>',t[t.length]='<a:font script="Ethi" typeface="Nyala"/>',t[t.length]='<a:font script="Beng" typeface="Vrinda"/>',t[t.length]='<a:font script="Gujr" typeface="Shruti"/>',t[t.length]='<a:font script="Khmr" typeface="DaunPenh"/>',t[t.length]='<a:font script="Knda" typeface="Tunga"/>',t[t.length]='<a:font script="Guru" typeface="Raavi"/>',t[t.length]='<a:font script="Cans" typeface="Euphemia"/>',t[t.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',t[t.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',t[t.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',t[t.length]='<a:font script="Thaa" typeface="MV Boli"/>',t[t.length]='<a:font script="Deva" typeface="Mangal"/>',t[t.length]='<a:font script="Telu" typeface="Gautami"/>',t[t.length]='<a:font script="Taml" typeface="Latha"/>',t[t.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',t[t.length]='<a:font script="Orya" typeface="Kalinga"/>',t[t.length]='<a:font script="Mlym" typeface="Kartika"/>',t[t.length]='<a:font script="Laoo" typeface="DokChampa"/>',t[t.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',t[t.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',t[t.length]='<a:font script="Viet" typeface="Arial"/>',t[t.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',t[t.length]='<a:font script="Geor" typeface="Sylfaen"/>',t[t.length]="</a:minorFont>",t[t.length]="</a:fontScheme>",t[t.length]='<a:fmtScheme name="Office">',t[t.length]="<a:fillStyleLst>",t[t.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:lin ang="16200000" scaled="1"/>',t[t.length]="</a:gradFill>",t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:lin ang="16200000" scaled="0"/>',t[t.length]="</a:gradFill>",t[t.length]="</a:fillStyleLst>",t[t.length]="<a:lnStyleLst>",t[t.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]="</a:lnStyleLst>",t[t.length]="<a:effectStyleLst>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]="</a:effectStyle>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]="</a:effectStyle>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',t[t.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',t[t.length]="</a:effectStyle>",t[t.length]="</a:effectStyleLst>",t[t.length]="<a:bgFillStyleLst>",t[t.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',t[t.length]="</a:gradFill>",t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',t[t.length]="</a:gradFill>",t[t.length]="</a:bgFillStyleLst>",t[t.length]="</a:fmtScheme>",t[t.length]="</a:themeElements>",t[t.length]="<a:objectDefaults>",t[t.length]="<a:spDef>",t[t.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',t[t.length]="</a:spDef>",t[t.length]="<a:lnDef>",t[t.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',t[t.length]="</a:lnDef>",t[t.length]="</a:objectDefaults>",t[t.length]="<a:extraClrSchemeLst/>",t[t.length]="</a:theme>",t.join("")}function the(){var e=$c();return tn(e,332),tn(e,334,_f(1)),tn(e,335,function Zue(e){var n=Xt(12+2*e.name.length);return n.write_shift(4,e.flags),n.write_shift(4,e.version),bl(e.name,n),n.slice(0,n.l)}({name:"XLDAPR",version:12e4,flags:3496657072})),tn(e,336),tn(e,339,function Kue(e,n){var t=Xt(8+2*n.length);return t.write_shift(4,e),bl(n,t),t.slice(0,t.l)}(1,"XLDAPR")),tn(e,52),tn(e,35,_f(514)),tn(e,4096,_f(0)),tn(e,4097,ld(1)),tn(e,36),tn(e,53),tn(e,340),tn(e,337,function Que(e,n){var t=Xt(8);return t.write_shift(4,e),t.write_shift(4,n?1:0),t}(1,!0)),tn(e,51,function Yue(e){var n=Xt(4+8*e.length);n.write_shift(4,e.length);for(var t=0;t<e.length;++t)n.write_shift(4,e[t][0]),n.write_shift(4,e[t][1]);return n}([[1,0]])),tn(e,338),tn(e,333),e.end()}function y7(){var e=[Lo];return e.push('<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">\n  <metadataTypes count="1">\n    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>\n  </metadataTypes>\n  <futureMetadata name="XLDAPR" count="1">\n    <bk>\n      <extLst>\n        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">\n          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>\n        </ext>\n      </extLst>\n    </bk>\n  </futureMetadata>\n  <cellMetadata count="1">\n    <bk>\n      <rc t="1" v="0"/>\n    </bk>\n  </cellMetadata>\n</metadata>'),e.join("")}var Fw=1024;function v7(e,n){for(var t=[21600,21600],r=["m0,0l0",t[1],t[0],t[1],t[0],"0xe"].join(","),s=[Rn("xml",null,{"xmlns:v":th.v,"xmlns:o":th.o,"xmlns:x":th.x,"xmlns:mv":th.mv}).replace(/\/>/,">"),Rn("o:shapelayout",Rn("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),Rn("v:shapetype",[Rn("v:stroke",null,{joinstyle:"miter"}),Rn("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:t.join(","),path:r})];Fw<1e3*e;)Fw+=1e3;return n.forEach(function(l){var h=na(l[0]),g={color2:"#BEFF82",type:"gradient"};"gradient"==g.type&&(g.angle="-180");var x="gradient"==g.type?Rn("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,E=Rn("v:fill",x,g);++Fw,s=s.concat(["<v:shape"+jC({id:"_x0000_s"+Fw,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(l[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",E,Rn("v:shadow",null,{on:"t",obscured:"t"}),Rn("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",Zl("x:Anchor",[h.c+1,0,h.r+1,0,h.c+3,20,h.r+5,20].join(",")),Zl("x:AutoFill","False"),Zl("x:Row",String(h.r)),Zl("x:Column",String(h.c)),l[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),s.push("</xml>"),s.join("")}function b7(e){var n=[Lo,Rn("comments",null,{xmlns:A_[0]})],t=[];return n.push("<authors>"),e.forEach(function(r){r[1].forEach(function(s){var l=As(s.a);-1==t.indexOf(l)&&(t.push(l),n.push("<author>"+l+"</author>")),s.T&&s.ID&&-1==t.indexOf("tc="+s.ID)&&(t.push("tc="+s.ID),n.push("<author>tc="+s.ID+"</author>"))})}),0==t.length&&(t.push("SheetJ5"),n.push("<author>SheetJ5</author>")),n.push("</authors>"),n.push("<commentList>"),e.forEach(function(r){var s=0,l=[];if(r[1][0]&&r[1][0].T&&r[1][0].ID?s=t.indexOf("tc="+r[1][0].ID):r[1].forEach(function(x){x.a&&(s=t.indexOf(As(x.a))),l.push(x.t||"")}),n.push('<comment ref="'+r[0]+'" authorId="'+s+'"><text>'),l.length<=1)n.push(Zl("t",As(l[0]||"")));else{for(var h="Comment:\n    "+l[0]+"\n",g=1;g<l.length;++g)h+="Reply:\n    "+l[g]+"\n";n.push(Zl("t",As(h)))}n.push("</text></comment>")}),n.push("</commentList>"),n.length>2&&(n[n.length]="</comments>",n[1]=n[1].replace("/>",">")),n.join("")}function uhe(e,n,t){var r=[Lo,Rn("ThreadedComments",null,{xmlns:Ta.TCMNT}).replace(/[\/]>/,">")];return e.forEach(function(s){var l="";(s[1]||[]).forEach(function(h,g){if(h.T){h.a&&-1==n.indexOf(h.a)&&n.push(h.a);var x={ref:s[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+t.tcid++).slice(-12)+"}"};0==g?l=x.id:x.parentId=l,h.ID=x.id,h.a&&(x.personId="{54EE7950-7262-4200-6969-"+("000000000000"+n.indexOf(h.a)).slice(-12)+"}"),r.push(Rn("threadedComment",Zl("text",h.t||""),x))}else delete h.ID})}),r.push("</ThreadedComments>"),r.join("")}var mhe=mc;function yhe(e){var n=$c(),t=[];return tn(n,628),tn(n,630),e.forEach(function(r){r[1].forEach(function(s){t.indexOf(s.a)>-1||(t.push(s.a.slice(0,54)),tn(n,632,function ghe(e){return bl(e.slice(0,54))}(s.a)))})}),tn(n,631),tn(n,633),e.forEach(function(r){r[1].forEach(function(s){s.iauthor=t.indexOf(s.a);var l={s:na(r[0]),e:na(r[0])};tn(n,635,function phe(e,n){return null==n&&(n=Xt(36)),n.write_shift(4,e[1].iauthor),Rw(e[0],n),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n}([l,s])),s.t&&s.t.length>0&&tn(n,637,function Goe(e,n){var t=!1;return null==n&&(t=!0,n=Xt(23+4*e.t.length)),n.write_shift(1,1),bl(e.t,n),n.write_shift(4,1),function joe(e,n){n||(n=Xt(4)),n.write_shift(2,e.ich||0),n.write_shift(2,e.ifnt||0)}({ich:0,ifnt:0},n),t?n.slice(0,n.l):n}(s)),tn(n,636),delete s.iauthor})}),tn(n,634),tn(n,629),n.end()}var w7=["xlsb","xlsm","xlam","biff8","xla"],Lw=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,n={r:0,c:0};function t(r,s,l,h){var g=!1,x=!1;0==l.length?x=!0:"["==l.charAt(0)&&(x=!0,l=l.slice(1,-1)),0==h.length?g=!0:"["==h.charAt(0)&&(g=!0,h=h.slice(1,-1));var E=l.length>0?0|parseInt(l,10):0,D=h.length>0?0|parseInt(h,10):0;return g?D+=n.c:--D,x?E+=n.r:--E,s+(g?"":"$")+ao(D)+(x?"":"$")+Bo(E)}return function(s,l){return n=l,s.replace(e,t)}}(),e3=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,t3=function(){return function(n,t){return n.replace(e3,function(r,s,l,h,g,x){var E=kF(h)-(l?0:t.c),D=IF(x)-(g?0:t.r);return s+"R"+(0==D?"":g?D+1:"["+D+"]")+"C"+(0==E?"":l?E+1:"["+E+"]")})}}();function T7(e,n){return e.replace(e3,function(t,r,s,l,h,g){return r+("$"==s?s+l:ao(kF(l)+n.c))+("$"==h?h+g:Bo(IF(g)+n.r))})}function Ca(e){e.l+=1}function R_(e,n){var t=e.read_shift(1==n?1:2);return[16383&t,t>>14&1,t>>15&1]}function E7(e,n,t){var r=2;if(t){if(t.biff>=2&&t.biff<=5)return C7(e);12==t.biff&&(r=4)}var s=e.read_shift(r),l=e.read_shift(r),h=R_(e,2),g=R_(e,2);return{s:{r:s,c:h[0],cRel:h[1],rRel:h[2]},e:{r:l,c:g[0],cRel:g[1],rRel:g[2]}}}function C7(e){var n=R_(e,2),t=R_(e,2),r=e.read_shift(1),s=e.read_shift(1);return{s:{r:n[0],c:r,cRel:n[1],rRel:n[2]},e:{r:t[0],c:s,cRel:t[1],rRel:t[2]}}}function S7(e,n,t){if(t&&t.biff>=2&&t.biff<=5)return function Mhe(e){var n=R_(e,2),t=e.read_shift(1);return{r:n[0],c:t,cRel:n[1],rRel:n[2]}}(e);var r=e.read_shift(t&&12==t.biff?4:2),s=R_(e,2);return{r,c:s[0],cRel:s[1],rRel:s[2]}}function Ahe(e){var n=e.read_shift(2),t=e.read_shift(2);return{r:n,c:255&t,fQuoted:!!(16384&t),cRel:t>>15,rRel:t>>15}}function D7(e){var n=1&e[e.l+1];return e.l+=4,[n,1]}function M7(e){return[e.read_shift(1),e.read_shift(1)]}function ide(e,n){var t=[e.read_shift(1)];if(12==n)switch(t[0]){case 2:t[0]=4;break;case 4:t[0]=16;break;case 0:t[0]=1;break;case 1:t[0]=2}switch(t[0]){case 4:t[1]=function ra(e,n){return 1===e.read_shift(n)}(e,1)?"TRUE":"FALSE",12!=n&&(e.l+=7);break;case 37:case 16:t[1]=Dg[e[e.l]],e.l+=12==n?4:8;break;case 0:e.l+=8;break;case 1:t[1]=gc(e);break;case 2:t[1]=function uv(e,n,t){if(t.biff>5)return function YC(e,n,t){var r=e.read_shift(t&&2==t.biff?1:2);return 0===r?(e.l++,""):function cv(e,n,t){if(t){if(t.biff>=2&&t.biff<=5)return e.read_shift(n,"cpstr");if(t.biff>=12)return e.read_shift(n,"dbcs-cont")}var s=e.read_shift(1);return e.read_shift(n,0===s?"sbcs-cont":"dbcs-cont")}(e,r,t)}(e,0,t);var r=e.read_shift(1);return 0===r?(e.l++,""):e.read_shift(r,t.biff<=4||!e.lens?"cpstr":"sbcs-cont")}(e,0,{biff:n>0&&n<8?2:n});break;default:throw new Error("Bad SerAr: "+t[0])}return t}function sde(e,n,t){for(var r=e.read_shift(12==t.biff?4:2),s=[],l=0;l!=r;++l)s.push((12==t.biff?sv:yk)(e,8));return s}function ode(e,n,t){var r=0,s=0;12==t.biff?(r=e.read_shift(4),s=e.read_shift(4)):(s=1+e.read_shift(1),r=1+e.read_shift(2)),t.biff>=2&&t.biff<8&&(--r,0==--s&&(s=256));for(var l=0,h=[];l!=r&&(h[l]=[]);++l)for(var g=0;g!=s;++g)h[l][g]=ide(e,t.biff);return h}function nS(e,n,t){return e.l+=2,[Ahe(e)]}function n3(e){return e.l+=6,[]}function A7(e){return e.l+=2,[Ea(e),1&e.read_shift(2)]}var Sde=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"],I7={1:{n:"PtgExp",f:function Jhe(e,n,t){return e.l++,t&&12==t.biff?[e.read_shift(4,"i"),0]:[e.read_shift(2),e.read_shift(t&&2==t.biff?1:2)]}},2:{n:"PtgTbl",f:pc},3:{n:"PtgAdd",f:Ca},4:{n:"PtgSub",f:Ca},5:{n:"PtgMul",f:Ca},6:{n:"PtgDiv",f:Ca},7:{n:"PtgPower",f:Ca},8:{n:"PtgConcat",f:Ca},9:{n:"PtgLt",f:Ca},10:{n:"PtgLe",f:Ca},11:{n:"PtgEq",f:Ca},12:{n:"PtgGe",f:Ca},13:{n:"PtgGt",f:Ca},14:{n:"PtgNe",f:Ca},15:{n:"PtgIsect",f:Ca},16:{n:"PtgUnion",f:Ca},17:{n:"PtgRange",f:Ca},18:{n:"PtgUplus",f:Ca},19:{n:"PtgUminus",f:Ca},20:{n:"PtgPercent",f:Ca},21:{n:"PtgParen",f:Ca},22:{n:"PtgMissArg",f:Ca},23:{n:"PtgStr",f:function rde(e,n,t){return e.l++,XC(e,0,t)}},26:{n:"PtgSheet",f:function Ade(e,n,t){return e.l+=5,e.l+=2,e.l+=2==t.biff?1:4,["PTGSHEET"]}},27:{n:"PtgEndSheet",f:function Ide(e,n,t){return e.l+=2==t.biff?4:5,["PTGENDSHEET"]}},28:{n:"PtgErr",f:function Qhe(e){return e.l++,Dg[e.read_shift(1)]}},29:{n:"PtgBool",f:function tde(e){return e.l++,0!==e.read_shift(1)}},30:{n:"PtgInt",f:function ede(e){return e.l++,e.read_shift(2)}},31:{n:"PtgNum",f:function nde(e){return e.l++,gc(e)}},32:{n:"PtgArray",f:function Lhe(e,n,t){var r=(96&e[e.l++])>>5;return e.l+=2==t.biff?6:12==t.biff?14:7,[r]}},33:{n:"PtgFunc",f:function Zhe(e,n,t){var r=(96&e[e.l])>>5;e.l+=1;var s=e.read_shift(t&&t.biff<=3?1:2);return[Kde[s],R7[s],r]}},34:{n:"PtgFuncVar",f:function Xhe(e,n,t){var r=e[e.l++],s=e.read_shift(1),l=t&&t.biff<=3?[88==r?-1:0,e.read_shift(1)]:function Yhe(e){return[e[e.l+1]>>7,32767&e.read_shift(2)]}(e);return[s,(0===l[0]?R7:Yde)[l[1]]]}},35:{n:"PtgName",f:function ade(e,n,t){var r=e.read_shift(1)>>>5&3,l=e.read_shift(!t||t.biff>=8?4:2);switch(t.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12}return[r,0,l]}},36:{n:"PtgRef",f:function Ghe(e,n,t){var r=(96&e[e.l])>>5;return e.l+=1,[r,S7(e,0,t)]}},37:{n:"PtgArea",f:function Ohe(e,n,t){return[(96&e[e.l++])>>5,E7(e,0,t)]}},38:{n:"PtgMemArea",f:function ude(e,n,t){var r=e.read_shift(1)>>>5&3;return e.l+=t&&2==t.biff?3:4,[r,e.read_shift(t&&2==t.biff?1:2)]}},39:{n:"PtgMemErr",f:pc},40:{n:"PtgMemNoMem",f:pc},41:{n:"PtgMemFunc",f:function hde(e,n,t){return[e.read_shift(1)>>>5&3,e.read_shift(t&&2==t.biff?1:2)]}},42:{n:"PtgRefErr",f:function dde(e,n,t){var r=e.read_shift(1)>>>5&3;return e.l+=4,t.biff<8&&e.l--,12==t.biff&&(e.l+=2),[r]}},43:{n:"PtgAreaErr",f:function Phe(e,n,t){var r=(96&e[e.l++])>>5;return e.l+=t&&t.biff>8?12:t.biff<8?6:8,[r]}},44:{n:"PtgRefN",f:function Whe(e,n,t){var r=(96&e[e.l])>>5;e.l+=1;var s=function Ihe(e,n,t){var r=t&&t.biff?t.biff:8;if(r>=2&&r<=5)return function khe(e){var n=e.read_shift(2),t=e.read_shift(1),r=(32768&n)>>15,s=(16384&n)>>14;return n&=16383,1==r&&n>=8192&&(n-=16384),1==s&&t>=128&&(t-=256),{r:n,c:t,cRel:s,rRel:r}}(e);var s=e.read_shift(r>=12?4:2),l=e.read_shift(2),h=(16384&l)>>14,g=(32768&l)>>15;if(l&=16383,1==g)for(;s>524287;)s-=1048576;if(1==h)for(;l>8191;)l-=16384;return{r:s,c:l,cRel:h,rRel:g}}(e,0,t);return[r,s]}},45:{n:"PtgAreaN",f:function Fhe(e,n,t){var r=(96&e[e.l++])>>5,s=function Dhe(e,n,t){if(t.biff<8)return C7(e);var r=e.read_shift(12==t.biff?4:2),s=e.read_shift(12==t.biff?4:2),l=R_(e,2),h=R_(e,2);return{s:{r,c:l[0],cRel:l[1],rRel:l[2]},e:{r:s,c:h[0],cRel:h[1],rRel:h[2]}}}(e,0,t);return[r,s]}},46:{n:"PtgMemAreaN",f:function kde(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},47:{n:"PtgMemNoMemN",f:function Ode(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},57:{n:"PtgNameX",f:function lde(e,n,t){return 5==t.biff?function cde(e){var n=e.read_shift(1)>>>5&3,t=e.read_shift(2,"i");e.l+=8;var r=e.read_shift(2);return e.l+=12,[n,t,r]}(e):[e.read_shift(1)>>>5&3,e.read_shift(2),e.read_shift(4)]}},58:{n:"PtgRef3d",f:function qhe(e,n,t){var r=(96&e[e.l])>>5;e.l+=1;var s=e.read_shift(2);return t&&5==t.biff&&(e.l+=12),[r,s,S7(e,0,t)]}},59:{n:"PtgArea3d",f:function Rhe(e,n,t){var r=(96&e[e.l++])>>5,s=e.read_shift(2,"i");if(t&&5===t.biff)e.l+=12;return[r,s,E7(e,0,t)]}},60:{n:"PtgRefErr3d",f:function fde(e,n,t){var r=(96&e[e.l++])>>5,s=e.read_shift(2),l=4;if(t)switch(t.biff){case 5:l=15;break;case 12:l=6}return e.l+=l,[r,s]}},61:{n:"PtgAreaErr3d",f:function Nhe(e,n,t){var r=(96&e[e.l++])>>5,s=e.read_shift(2),l=8;if(t)switch(t.biff){case 5:e.l+=12,l=6;break;case 12:l=12}return e.l+=l,[r,s]}},255:{}},Pde={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Nde={1:{n:"PtgElfLel",f:A7},2:{n:"PtgElfRw",f:nS},3:{n:"PtgElfCol",f:nS},6:{n:"PtgElfRwV",f:nS},7:{n:"PtgElfColV",f:nS},10:{n:"PtgElfRadical",f:nS},11:{n:"PtgElfRadicalS",f:n3},13:{n:"PtgElfColS",f:n3},15:{n:"PtgElfColSV",f:n3},16:{n:"PtgElfRadicalLel",f:A7},25:{n:"PtgList",f:function Dde(e){e.l+=2;var n=e.read_shift(2),t=e.read_shift(2),r=e.read_shift(4),s=e.read_shift(2),l=e.read_shift(2);return{ixti:n,coltype:3&t,rt:Sde[t>>2&31],idx:r,c:s,C:l}}},29:{n:"PtgSxName",f:function Mde(e){return e.l+=2,[e.read_shift(4)]}},255:{}},Fde={0:{n:"PtgAttrNoop",f:function Rde(e){return e.l+=4,[0,0]}},1:{n:"PtgAttrSemi",f:function jhe(e,n,t){var r=255&e[e.l+1]?1:0;return e.l+=t&&2==t.biff?3:4,[r]}},2:{n:"PtgAttrIf",f:function Uhe(e,n,t){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(t&&2==t.biff?1:2)]}},4:{n:"PtgAttrChoose",f:function Bhe(e,n,t){e.l+=2;for(var r=e.read_shift(t&&2==t.biff?1:2),s=[],l=0;l<=r;++l)s.push(e.read_shift(t&&2==t.biff?1:2));return s}},8:{n:"PtgAttrGoto",f:function zhe(e,n,t){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(t&&2==t.biff?1:2)]}},16:{n:"PtgAttrSum",f:function Khe(e,n,t){e.l+=t&&2==t.biff?3:4}},32:{n:"PtgAttrBaxcel",f:D7},33:{n:"PtgAttrBaxcel",f:D7},64:{n:"PtgAttrSpace",f:function $he(e){return e.read_shift(2),M7(e)}},65:{n:"PtgAttrSpaceSemi",f:function Hhe(e){return e.read_shift(2),M7(e)}},128:{n:"PtgAttrIfError",f:function Vhe(e){var n=255&e[e.l+1]?1:0;return e.l+=2,[n,e.read_shift(2)]}},255:{}};function rS(e,n,t,r){if(r.biff<8)return pc(e,n);for(var s=e.l+n,l=[],h=0;h!==t.length;++h)switch(t[h][0]){case"PtgArray":t[h][1]=ode(e,0,r),l.push(t[h][1]);break;case"PtgMemArea":t[h][2]=sde(e,0,r),l.push(t[h][2]);break;case"PtgExp":r&&12==r.biff&&(t[h][1][1]=e.read_shift(4),l.push(t[h][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+t[h][0]}return 0!=(n=s-e.l)&&l.push(pc(e,n)),l}function Lde(e){for(var n=[],t=0;t<e.length;++t){for(var r=e[t],s=[],l=0;l<r.length;++l){var h=r[l];s.push(h?2===h[0]?'"'+h[1].replace(/"/g,'""')+'"':h[1]:"")}n.push(s.join(","))}return n.join(";")}var Bde={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function k7(e,n,t){if(!e)return"SH33TJSERR0";if(t.biff>8&&(!e.XTI||!e.XTI[n]))return e.SheetNames[n];if(!e.XTI)return"SH33TJSERR6";var r=e.XTI[n];if(t.biff<8)return n>1e4&&(n-=65536),n<0&&(n=-n),0==n?"":e.XTI[n-1];if(!r)return"SH33TJSERR1";var s="";if(t.biff>8)switch(e[r[0]][0]){case 357:return s=-1==r[1]?"#REF":e.SheetNames[r[1]],r[1]==r[2]?s:s+":"+e.SheetNames[r[2]];case 358:return null!=t.SID?e.SheetNames[t.SID]:"SH33TJSSAME"+e[r[0]][0];default:return"SH33TJSSRC"+e[r[0]][0]}switch(e[r[0]][0][0]){case 1025:return s=-1==r[1]?"#REF":e.SheetNames[r[1]]||"SH33TJSERR3",r[1]==r[2]?s:s+":"+e.SheetNames[r[2]];case 14849:return e[r[0]].slice(1).map(function(l){return l.Name}).join(";;");default:return e[r[0]][0][3]?(s=-1==r[1]?"#REF":e[r[0]][0][3][r[1]]||"SH33TJSERR4",r[1]==r[2]?s:s+":"+e[r[0]][0][3][r[2]]):"SH33TJSERR2"}}function O7(e,n,t){var r=k7(e,n,t);return"#REF"==r?r:function zde(e,n){if(!(e||n&&n.biff<=5&&n.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}(r,t)}function vc(e,n,t,r,s){var x,E,D,B,l=s&&s.biff||8,h={s:{c:0,r:0},e:{c:0,r:0}},g=[],O=0,N=0,W="";if(!e[0]||!e[0][0])return"";for(var V=-1,X="",le=0,oe=e[0].length;le<oe;++le){var fe=e[0][le];switch(fe[0]){case"PtgUminus":g.push("-"+g.pop());break;case"PtgUplus":g.push("+"+g.pop());break;case"PtgPercent":g.push(g.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(x=g.pop(),E=g.pop(),V>=0){switch(e[0][V][1][0]){case 0:X=Fo(" ",e[0][V][1][1]);break;case 1:X=Fo("\r",e[0][V][1][1]);break;default:if(X="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][V][1][0])}E+=X,V=-1}g.push(E+Bde[fe[0]]+x);break;case"PtgIsect":x=g.pop(),E=g.pop(),g.push(E+" "+x);break;case"PtgUnion":x=g.pop(),E=g.pop(),g.push(E+","+x);break;case"PtgRange":x=g.pop(),E=g.pop(),g.push(E+":"+x);break;case"PtgAttrChoose":case"PtgAttrGoto":case"PtgAttrIf":case"PtgAttrIfError":case"PtgAttrBaxcel":case"PtgAttrSemi":case"PtgMemArea":case"PtgTbl":case"PtgMemErr":case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":case"PtgMemFunc":case"PtgMemNoMem":break;case"PtgRef":D=GC(fe[1][1],h,s),g.push(WC(D,l));break;case"PtgRefN":D=t?GC(fe[1][1],t,s):fe[1][1],g.push(WC(D,l));break;case"PtgRef3d":O=fe[1][1],D=GC(fe[1][2],h,s),W=O7(r,O,s),g.push(W+"!"+WC(D,l));break;case"PtgFunc":case"PtgFuncVar":var Ze=fe[1][0],at=fe[1][1];Ze||(Ze=0);var Ne=0==(Ze&=127)?[]:g.slice(-Ze);g.length-=Ze,"User"===at&&(at=Ne.shift()),g.push(at+"("+Ne.join(",")+")");break;case"PtgBool":g.push(fe[1]?"TRUE":"FALSE");break;case"PtgInt":case"PtgErr":g.push(fe[1]);break;case"PtgNum":g.push(String(fe[1]));break;case"PtgStr":g.push('"'+fe[1].replace(/"/g,'""')+'"');break;case"PtgAreaN":B=oj(fe[1][1],t?{s:t}:h,s),g.push(AF(B,s));break;case"PtgArea":B=oj(fe[1][1],h,s),g.push(AF(B,s));break;case"PtgArea3d":B=fe[1][2],W=O7(r,O=fe[1][1],s),g.push(W+"!"+AF(B,s));break;case"PtgAttrSum":g.push("SUM("+g.pop()+")");break;case"PtgName":var ot=(r.names||[])[(N=fe[1][2])-1]||(r[0]||[])[N],lt=ot?ot.Name:"SH33TJSNAME"+String(N);lt&&"_xlfn."==lt.slice(0,6)&&!s.xlfn&&(lt=lt.slice(6)),g.push(lt);break;case"PtgNameX":var Ot,Tt=fe[1][1];if(N=fe[1][2],!(s.biff<=5)){var ft="";if(14849==((r[Tt]||[])[0]||[])[0]||(1025==((r[Tt]||[])[0]||[])[0]?r[Tt][N]&&r[Tt][N].itab>0&&(ft=r.SheetNames[r[Tt][N].itab-1]+"!"):ft=r.SheetNames[N-1]+"!"),r[Tt]&&r[Tt][N])ft+=r[Tt][N].Name;else if(r[0]&&r[0][N])ft+=r[0][N].Name;else{var un=(k7(r,Tt,s)||"").split(";;");un[N-1]?ft=un[N-1]:ft+="SH33TJSERRX"}g.push(ft);break}Tt<0&&(Tt=-Tt),r[Tt]&&(Ot=r[Tt][N]),Ot||(Ot={Name:"SH33TJSERRY"}),g.push(Ot.Name);break;case"PtgParen":var Wn="(",On=")";if(V>=0){switch(X="",e[0][V][1][0]){case 2:Wn=Fo(" ",e[0][V][1][1])+Wn;break;case 3:Wn=Fo("\r",e[0][V][1][1])+Wn;break;case 4:On=Fo(" ",e[0][V][1][1])+On;break;case 5:On=Fo("\r",e[0][V][1][1])+On;break;default:if(s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][V][1][0])}V=-1}g.push(Wn+g.pop()+On);break;case"PtgRefErr":case"PtgRefErr3d":case"PtgAreaErr":case"PtgAreaErr3d":g.push("#REF!");break;case"PtgExp":var pr={c:t.c,r:t.r};if(r.sharedf[Zr(D={c:fe[1][1],r:fe[1][0]})]){var er=r.sharedf[Zr(D)];g.push(vc(er,0,pr,r,s))}else{var yi=!1;for(x=0;x!=r.arrayf.length;++x)if(!(D.c<(E=r.arrayf[x])[0].s.c||D.c>E[0].e.c||D.r<E[0].s.r||D.r>E[0].e.r)){g.push(vc(E[1],0,pr,r,s)),yi=!0;break}yi||g.push(fe[1])}break;case"PtgArray":g.push("{"+Lde(fe[1])+"}");break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":V=le;break;case"PtgMissArg":g.push("");break;case"PtgList":g.push("Table"+fe[1].idx+"[#"+fe[1].rt+"]");break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");default:throw new Error("Unrecognized Formula Token: "+String(fe))}if(3!=s.biff&&V>=0&&-1==["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"].indexOf(e[0][le][0])){var Or=!0;switch((fe=e[0][V])[1][0]){case 4:Or=!1;case 0:X=Fo(" ",fe[1][1]);break;case 5:Or=!1;case 1:X=Fo("\r",fe[1][1]);break;default:if(X="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+fe[1][0])}g.push((Or?X:"")+g.pop()+(Or?"":X)),V=-1}}if(g.length>1&&s.WTF)throw new Error("bad formula stack");return g[0]}function Ck(e,n,t){var r=e.read_shift(4),s=function iS(e,n,t){for(var s,l,r=e.l+n,h=[];r!=e.l;)n=r-e.l,s=I7[l=e[e.l]]||I7[Pde[l]],(24===l||25===l)&&(s=(24===l?Nde:Fde)[e[e.l+1]]),s&&s.f?h.push([s.n,s.f(e,n,t)]):pc(e,n);return h}(e,r,t),l=e.read_shift(4);return[s,l>0?rS(e,l,s,t):null]}var qde=Ck,Sk=Ck,Zde=Ck,Xde=Ck,Yde={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},R7={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Kde={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function Jde(e){return("of:="+e.replace(e3,"$1[.$2$3$4$5]").replace(/\]:\[/g,":")).replace(/;/g,"|").replace(/,/g,";")}function Qde(e){return e.replace(/\./,"!")}var sS=typeof Map<"u";function s3(e,n,t){var r=0,s=e.length;if(t){if(sS?t.has(n):Object.prototype.hasOwnProperty.call(t,n))for(var l=sS?t.get(n):t[n];r<l.length;++r)if(e[l[r]].t===n)return e.Count++,l[r]}else for(;r<s;++r)if(e[r].t===n)return e.Count++,r;return e[s]={t:n},e.Count++,e.Unique++,t&&(sS?(t.has(n)||t.set(n,[]),t.get(n).push(s)):(Object.prototype.hasOwnProperty.call(t,n)||(t[n]=[]),t[n].push(s))),s}function Mk(e,n){var t={min:e+1,max:e+1},r=-1;return n.MDW&&(yc=n.MDW),null!=n.width?t.customWidth=1:null!=n.wpx?r=QC(n.wpx):null!=n.wch&&(r=n.wch),r>-1?(t.width=bk(r),t.customWidth=1):null!=n.width&&(t.width=n.width),n.hidden&&(t.hidden=!0),null!=n.level&&(t.outlineLevel=t.level=n.level),t}function fv(e,n){if(e){var t=[.7,.7,.75,.75,.3,.3];"xlml"==n&&(t=[1,1,1,1,.5,.5]),null==e.left&&(e.left=t[0]),null==e.right&&(e.right=t[1]),null==e.top&&(e.top=t[2]),null==e.bottom&&(e.bottom=t[3]),null==e.header&&(e.header=t[4]),null==e.footer&&(e.footer=t[5])}}function P_(e,n,t){var r=t.revssf[null!=n.z?n.z:"General"],s=60,l=e.length;if(null==r&&t.ssf)for(;s<392;++s)if(null==t.ssf[s]){Kp(n.z,s),t.ssf[s]=n.z,t.revssf[n.z]=r=s;break}for(s=0;s!=l;++s)if(e[s].numFmtId===r)return s;return e[l]={numFmtId:r,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},l}function tfe(e,n,t){if(e&&e["!ref"]){var r=Zi(e["!ref"]);if(r.e.c<r.s.c||r.e.r<r.s.r)throw new Error("Bad range ("+t+"): "+e["!ref"])}}var gfe=["objects","scenarios","selectLockedCells","selectUnlockedCells"],_fe=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function Afe(e,n,t,r){if(e.c&&t["!comments"].push([n,e.c]),void 0===e.v&&"string"!=typeof e.f||"z"===e.t&&!e.f)return"";var s="",l=e.t,h=e.v;if("z"!==e.t)switch(e.t){case"b":s=e.v?"1":"0";break;case"n":s=""+e.v;break;case"e":s=Dg[e.v];break;case"d":r&&r.cellDates?s=Eo(e.v,-1).toISOString():((e=Gs(e)).t="n",s=""+(e.v=vl(Eo(e.v)))),typeof e.z>"u"&&(e.z=Br[14]);break;default:s=e.v}var g=Zl("v",As(s)),x={r:n},E=P_(r.cellXfs,e,r);switch(0!==E&&(x.s=E),e.t){case"n":case"z":break;case"d":x.t="d";break;case"b":x.t="b";break;case"e":x.t="e";break;default:if(null==e.v){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(r&&r.bookSST){g=Zl("v",""+s3(r.Strings,e.v,r.revStrings)),x.t="s";break}x.t="str"}if(e.t!=l&&(e.t=l,e.v=h),"string"==typeof e.f&&e.f){var D=e.F&&e.F.slice(0,n.length)==n?{t:"array",ref:e.F}:null;g=Rn("f",As(e.f),D)+(null!=e.v?g:"")}return e.l&&t["!links"].push([n,e.l]),e.D&&(x.cm=1),Rn("c",g,x)}function F7(e,n,t,r){var h,s=[Lo,Rn("worksheet",null,{xmlns:A_[0],"xmlns:r":Ta.r})],g="",x=t.Sheets[t.SheetNames[e]];null==x&&(x={});var E=x["!ref"]||"A1",D=Zi(E);if(D.e.c>16383||D.e.r>1048575){if(n.WTF)throw new Error("Range "+E+" exceeds format limit A1:XFD1048576");D.e.c=Math.min(D.e.c,16383),D.e.r=Math.min(D.e.c,1048575),E=gi(D)}r||(r={}),x["!comments"]=[];var O=[];(function mfe(e,n,t,r,s){var l=!1,h={},g=null;if("xlsx"!==r.bookType&&n.vbaraw){var x=n.SheetNames[t];try{n.Workbook&&(x=n.Workbook.Sheets[t].CodeName||x)}catch{}l=!0,h.codeName=Qp(As(x))}if(e&&e["!outline"]){var E={summaryBelow:1,summaryRight:1};e["!outline"].above&&(E.summaryBelow=0),e["!outline"].left&&(E.summaryRight=0),g=(g||"")+Rn("outlinePr",null,E)}!l&&!g||(s[s.length]=Rn("sheetPr",g,h))})(x,t,e,n,s),s[s.length]=Rn("dimension",null,{ref:E}),s[s.length]=function Mfe(e,n,t,r){var s={workbookViewId:"0"};return(((r||{}).Workbook||{}).Views||[])[0]&&(s.rightToLeft=r.Workbook.Views[0].RTL?"1":"0"),Rn("sheetViews",Rn("sheetView",null,s),{})}(0,0,0,t),n.sheetFormat&&(s[s.length]=Rn("sheetFormatPr",null,{defaultRowHeight:n.sheetFormat.defaultRowHeight||"16",baseColWidth:n.sheetFormat.baseColWidth||"10",outlineLevelRow:n.sheetFormat.outlineLevelRow||"7"})),null!=x["!cols"]&&x["!cols"].length>0&&(s[s.length]=function Tfe(e,n){for(var r,t=["<cols>"],s=0;s!=n.length;++s)(r=n[s])&&(t[t.length]=Rn("col",null,Mk(s,r)));return t[t.length]="</cols>",t.join("")}(0,x["!cols"])),s[h=s.length]="<sheetData/>",x["!links"]=[],null!=x["!ref"]&&(g=function kfe(e,n,t,r){var x,X,s=[],l=[],h=Zi(e["!ref"]),g="",E="",D=[],O=0,N=0,B=e["!rows"],W=Array.isArray(e),V={r:E},le=-1;for(N=h.s.c;N<=h.e.c;++N)D[N]=ao(N);for(O=h.s.r;O<=h.e.r;++O){for(l=[],E=Bo(O),N=h.s.c;N<=h.e.c;++N){x=D[N]+E;var oe=W?(e[O]||[])[N]:e[x];void 0!==oe&&null!=(g=Afe(oe,x,e,n))&&l.push(g)}(l.length>0||B&&B[O])&&(V={r:E},B&&B[O]&&((X=B[O]).hidden&&(V.hidden=1),le=-1,X.hpx?le=eS(X.hpx):X.hpt&&(le=X.hpt),le>-1&&(V.ht=le,V.customHeight=1),X.level&&(V.outlineLevel=X.level)),s[s.length]=Rn("row",l.join(""),V))}if(B)for(;O<B.length;++O)B&&B[O]&&(V={r:O+1},(X=B[O]).hidden&&(V.hidden=1),le=-1,X.hpx?le=eS(X.hpx):X.hpt&&(le=X.hpt),le>-1&&(V.ht=le,V.customHeight=1),X.level&&(V.outlineLevel=X.level),s[s.length]=Rn("row","",V));return s.join("")}(x,n),g.length>0&&(s[s.length]=g)),s.length>h+1&&(s[s.length]="</sheetData>",s[h]=s[h].replace("/>",">")),x["!protect"]&&(s[s.length]=function yfe(e){var n={sheet:1};return gfe.forEach(function(t){null!=e[t]&&e[t]&&(n[t]="1")}),_fe.forEach(function(t){null!=e[t]&&!e[t]&&(n[t]="0")}),e.password&&(n.password=XF(e.password).toString(16).toUpperCase()),Rn("sheetProtection",null,n)}(x["!protect"])),null!=x["!autofilter"]&&(s[s.length]=function Cfe(e,n,t,r){var s="string"==typeof e.ref?e.ref:gi(e.ref);t.Workbook||(t.Workbook={Sheets:[]}),t.Workbook.Names||(t.Workbook.Names=[]);var l=t.Workbook.Names,h=Hc(s);h.s.r==h.e.r&&(h.e.r=Hc(n["!ref"]).e.r,s=gi(h));for(var g=0;g<l.length;++g){var x=l[g];if("_xlnm._FilterDatabase"==x.Name&&x.Sheet==r){x.Ref="'"+t.SheetNames[r]+"'!"+s;break}}return g==l.length&&l.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+t.SheetNames[r]+"'!"+s}),Rn("autoFilter",null,{ref:s})}(x["!autofilter"],x,t,e)),null!=x["!merges"]&&x["!merges"].length>0&&(s[s.length]=function ffe(e){if(0===e.length)return"";for(var n='<mergeCells count="'+e.length+'">',t=0;t!=e.length;++t)n+='<mergeCell ref="'+gi(e[t])+'"/>';return n+"</mergeCells>"}(x["!merges"]));var B,N=-1,W=-1;return x["!links"].length>0&&(s[s.length]="<hyperlinks>",x["!links"].forEach(function(V){V[1].Target&&(B={ref:V[0]},"#"!=V[1].Target.charAt(0)&&(W=bs(r,-1,As(V[1].Target).replace(/#.*$/,""),_i.HLINK),B["r:id"]="rId"+W),(N=V[1].Target.indexOf("#"))>-1&&(B.location=As(V[1].Target.slice(N+1))),V[1].Tooltip&&(B.tooltip=As(V[1].Tooltip)),s[s.length]=Rn("hyperlink",null,B))}),s[s.length]="</hyperlinks>"),delete x["!links"],null!=x["!margins"]&&(s[s.length]=function bfe(e){return fv(e),Rn("pageMargins",null,e)}(x["!margins"])),(!n||n.ignoreEC||null==n.ignoreEC)&&(s[s.length]=Zl("ignoredErrors",Rn("ignoredError",null,{numberStoredAsText:1,sqref:E}))),O.length>0&&(W=bs(r,-1,"../drawings/drawing"+(e+1)+".xml",_i.DRAW),s[s.length]=Rn("drawing",null,{"r:id":"rId"+W}),x["!drawing"]=O),x["!comments"].length>0&&(W=bs(r,-1,"../drawings/vmlDrawing"+(e+1)+".vml",_i.VML),s[s.length]=Rn("legacyDrawing",null,{"r:id":"rId"+W}),x["!legacy"]=W),s.length>1&&(s[s.length]="</worksheet>",s[1]=s[1].replace("/>",">")),s.join("")}function Pfe(e,n,t,r){var s=function Rfe(e,n,t){var r=Xt(145),s=(t["!rows"]||[])[e]||{};r.write_shift(4,e),r.write_shift(4,0);var l=320;s.hpx?l=20*eS(s.hpx):s.hpt&&(l=20*s.hpt),r.write_shift(2,l),r.write_shift(1,0);var h=0;s.level&&(h|=s.level),s.hidden&&(h|=16),(s.hpx||s.hpt)&&(h|=32),r.write_shift(1,h),r.write_shift(1,0);var g=0,x=r.l;r.l+=4;for(var E={r:e,c:0},D=0;D<16;++D)if(!(n.s.c>D+1<<10||n.e.c<D<<10)){for(var O=-1,N=-1,B=D<<10;B<D+1<<10;++B)E.c=B,(Array.isArray(t)?(t[E.r]||[])[E.c]:t[Zr(E)])&&(O<0&&(O=B),N=B);O<0||(++g,r.write_shift(4,O),r.write_shift(4,N))}var V=r.l;return r.l=x,r.write_shift(4,g),r.l=V,r.length>r.l?r.slice(0,r.l):r}(r,t,n);(s.length>17||(n["!rows"]||[])[r])&&tn(e,0,s)}var Nfe=sv,Ffe=Rw;var ype=sv,vpe=Rw,B7=["left","right","top","bottom","header","footer"];function Fpe(e,n,t,r,s,l,h){if(void 0===n.v)return!1;var g="";switch(n.t){case"b":g=n.v?"1":"0";break;case"d":(n=Gs(n)).z=n.z||Br[14],n.v=vl(Eo(n.v)),n.t="n";break;case"n":case"e":g=""+n.v;break;default:g=n.v}var x={r:t,c:r};switch(x.s=P_(s.cellXfs,n,s),n.l&&l["!links"].push([Zr(x),n.l]),n.c&&l["!comments"].push([Zr(x),n.c]),n.t){case"s":case"str":return s.bookSST?(g=s3(s.Strings,n.v,s.revStrings),x.t="s",x.v=g,h?tn(e,18,function tpe(e,n,t){return null==t&&(t=Xt(8)),iv(n,t),t.write_shift(4,n.v),t}(0,x)):tn(e,7,function Qfe(e,n,t){return null==t&&(t=Xt(12)),nv(n,t),t.write_shift(4,n.v),t}(0,x))):(x.t="str",h?tn(e,17,function fpe(e,n,t){return null==t&&(t=Xt(8+4*e.v.length)),iv(n,t),bl(e.v,t),t.length>t.l?t.slice(0,t.l):t}(n,x)):tn(e,6,function hpe(e,n,t){return null==t&&(t=Xt(12+4*e.v.length)),nv(n,t),bl(e.v,t),t.length>t.l?t.slice(0,t.l):t}(n,x))),!0;case"n":return n.v==(0|n.v)&&n.v>-1e3&&n.v<1e3?h?tn(e,13,function lpe(e,n,t){return null==t&&(t=Xt(8)),iv(n,t),uj(e.v,t),t}(n,x)):tn(e,2,function ope(e,n,t){return null==t&&(t=Xt(12)),nv(n,t),uj(e.v,t),t}(n,x)):h?tn(e,16,function ipe(e,n,t){return null==t&&(t=Xt(12)),iv(n,t),ov(e.v,t),t}(n,x)):tn(e,5,function rpe(e,n,t){return null==t&&(t=Xt(16)),nv(n,t),ov(e.v,t),t}(n,x)),!0;case"b":return x.t="b",h?tn(e,15,function qfe(e,n,t){return null==t&&(t=Xt(5)),iv(n,t),t.write_shift(1,e.v?1:0),t}(n,x)):tn(e,4,function Gfe(e,n,t){return null==t&&(t=Xt(9)),nv(n,t),t.write_shift(1,e.v?1:0),t}(n,x)),!0;case"e":return x.t="e",h?tn(e,14,function Kfe(e,n,t){return null==t&&(t=Xt(8)),iv(n,t),t.write_shift(1,e.v),t.write_shift(2,0),t.write_shift(1,0),t}(n,x)):tn(e,3,function Xfe(e,n,t){return null==t&&(t=Xt(9)),nv(n,t),t.write_shift(1,e.v),t}(n,x)),!0}return h?tn(e,12,function $fe(e,n,t){return null==t&&(t=Xt(4)),iv(n,t)}(0,x)):tn(e,1,function Vfe(e,n,t){return null==t&&(t=Xt(8)),nv(n,t)}(0,x)),!0}function Wpe(e,n,t,r){var s=$c(),l=t.SheetNames[e],h=t.Sheets[l]||{},g=l;try{t&&t.Workbook&&(g=t.Workbook.Sheets[e].CodeName||g)}catch{}var x=Zi(h["!ref"]||"A1");if(x.e.c>16383||x.e.r>1048575){if(n.WTF)throw new Error("Range "+(h["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");x.e.c=Math.min(x.e.c,16383),x.e.r=Math.min(x.e.c,1048575)}return h["!links"]=[],h["!comments"]=[],tn(s,129),(t.vbaraw||h["!outline"])&&tn(s,147,function zfe(e,n,t){null==t&&(t=Xt(84+4*e.length));var r=192;n&&(n.above&&(r&=-65),n.left&&(r&=-129)),t.write_shift(1,r);for(var s=1;s<3;++s)t.write_shift(1,0);return hk({auto:1},t),t.write_shift(-4,-1),t.write_shift(-4,-1),cj(e,t),t.slice(0,t.l)}(g,h["!outline"])),tn(s,148,Ffe(x)),function Hpe(e,n,t){tn(e,133),tn(e,137,function Ipe(e,n,t){null==t&&(t=Xt(30));var r=924;return(((n||{}).Views||[])[0]||{}).RTL&&(r|=32),t.write_shift(2,r),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,100),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(4,0),t}(0,t)),tn(e,138),tn(e,134)}(s,0,t.Workbook),function zpe(e,n){!n||!n["!cols"]||(tn(e,390),n["!cols"].forEach(function(t,r){t&&tn(e,60,function Spe(e,n,t){null==t&&(t=Xt(18));var r=Mk(e,n);t.write_shift(-4,e),t.write_shift(-4,e),t.write_shift(4,256*(r.width||10)),t.write_shift(4,0);var s=0;return n.hidden&&(s|=1),"number"==typeof r.width&&(s|=2),n.level&&(s|=n.level<<8),t.write_shift(2,s),t}(r,t))}),tn(e,391))}(s,h),function Lpe(e,n,t,r){var s=Zi(n["!ref"]||"A1"),h="",g=[];tn(e,145);var x=Array.isArray(n),E=s.e.r;n["!rows"]&&(E=Math.max(s.e.r,n["!rows"].length-1));for(var D=s.s.r;D<=E;++D){h=Bo(D),Pfe(e,n,s,D);var O=!1;if(D<=s.e.r)for(var N=s.s.c;N<=s.e.c;++N){D===s.s.r&&(g[N]=ao(N));var B=x?(n[D]||[])[N]:n[g[N]+h];O=!!B&&Fpe(e,B,D,N,r,n,O)}}tn(e,146)}(s,h,0,n),function Gpe(e,n){n["!protect"]&&tn(e,535,function Ope(e,n){return null==n&&(n=Xt(66)),n.write_shift(2,e.password?XF(e.password):0),n.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(t){n.write_shift(4,t[1]?null==e[t[0]]||e[t[0]]?0:1:null!=e[t[0]]&&e[t[0]]?0:1)}),n}(n["!protect"]))}(s,h),function $pe(e,n,t,r){if(n["!autofilter"]){var s=n["!autofilter"],l="string"==typeof s.ref?s.ref:gi(s.ref);t.Workbook||(t.Workbook={Sheets:[]}),t.Workbook.Names||(t.Workbook.Names=[]);var h=t.Workbook.Names,g=Hc(l);g.s.r==g.e.r&&(g.e.r=Hc(n["!ref"]).e.r,l=gi(g));for(var x=0;x<h.length;++x){var E=h[x];if("_xlnm._FilterDatabase"==E.Name&&E.Sheet==r){E.Ref="'"+t.SheetNames[r]+"'!"+l;break}}x==h.length&&h.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+t.SheetNames[r]+"'!"+l}),tn(e,161,Rw(Zi(l))),tn(e,162)}}(s,h,t,e),function Bpe(e,n){!n||!n["!merges"]||(tn(e,177,function xpe(e,n){return null==n&&(n=Xt(4)),n.write_shift(4,e),n}(n["!merges"].length)),n["!merges"].forEach(function(t){tn(e,176,vpe(t))}),tn(e,178))}(s,h),function Vpe(e,n,t){n["!links"].forEach(function(r){if(r[1].Target){var s=bs(t,-1,r[1].Target.replace(/#.*$/,""),_i.HLINK);tn(e,494,function wpe(e,n){var t=Xt(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));Rw({s:na(e[0]),e:na(e[0])},t),NF("rId"+n,t);var r=e[1].Target.indexOf("#");return bl((-1==r?"":e[1].Target.slice(r+1))||"",t),bl(e[1].Tooltip||"",t),bl("",t),t.slice(0,t.l)}(r,s))}}),delete n["!links"]}(s,h,r),h["!margins"]&&tn(s,476,function Mpe(e,n){return null==n&&(n=Xt(48)),fv(e),B7.forEach(function(t){ov(e[t],n)}),n}(h["!margins"])),(!n||n.ignoreEC||null==n.ignoreEC)&&function Upe(e,n){!n||!n["!ref"]||(tn(e,648),tn(e,649,function kpe(e){var n=Xt(24);return n.write_shift(4,4),n.write_shift(4,1),Rw(e,n),n}(Zi(n["!ref"]))),tn(e,650))}(s,h),function jpe(e,n,t,r){if(n["!comments"].length>0){var s=bs(r,-1,"../drawings/vmlDrawing"+(t+1)+".vml",_i.VML);tn(e,551,NF("rId"+s)),n["!legacy"]=s}}(s,h,e,r),tn(s,130),s.end()}var a3=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],ime="][*?/\\".split("");function j7(e,n){if(e.length>31){if(n)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var t=!0;return ime.forEach(function(r){if(-1!=e.indexOf(r)){if(!n)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");t=!1}}),t}function H7(e){var n=[Lo];n[n.length]=Rn("workbook",null,{xmlns:A_[0],"xmlns:r":Ta.r});var t=e.Workbook&&(e.Workbook.Names||[]).length>0,r={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(a3.forEach(function(g){null!=e.Workbook.WBProps[g[0]]&&e.Workbook.WBProps[g[0]]!=g[1]&&(r[g[0]]=e.Workbook.WBProps[g[0]])}),e.Workbook.WBProps.CodeName&&(r.codeName=e.Workbook.WBProps.CodeName,delete r.CodeName)),n[n.length]=Rn("workbookPr",null,r);var s=e.Workbook&&e.Workbook.Sheets||[],l=0;if(s&&s[0]&&s[0].Hidden){for(n[n.length]="<bookViews>",l=0;l!=e.SheetNames.length&&s[l]&&s[l].Hidden;++l);l==e.SheetNames.length&&(l=0),n[n.length]='<workbookView firstSheet="'+l+'" activeTab="'+l+'"/>',n[n.length]="</bookViews>"}for(n[n.length]="<sheets>",l=0;l!=e.SheetNames.length;++l){var h={name:As(e.SheetNames[l].slice(0,31))};if(h.sheetId=""+(l+1),h["r:id"]="rId"+(l+1),s[l])switch(s[l].Hidden){case 1:h.state="hidden";break;case 2:h.state="veryHidden"}n[n.length]=Rn("sheet",null,h)}return n[n.length]="</sheets>",t&&(n[n.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach(function(g){var x={name:g.Name};g.Comment&&(x.comment=g.Comment),null!=g.Sheet&&(x.localSheetId=""+g.Sheet),g.Hidden&&(x.hidden="1"),g.Ref&&(n[n.length]=Rn("definedName",As(g.Ref),x))}),n[n.length]="</definedNames>"),n.length>2&&(n[n.length]="</workbook>",n[1]=n[1].replace("/>",">")),n.join("")}function cme(e,n){return n||(n=Xt(127)),n.write_shift(4,e.Hidden),n.write_shift(4,e.iTabID),NF(e.strRelID,n),bl(e.name.slice(0,31),n),n.length>n.l?n.slice(0,n.l):n}function vme(e,n){var t=$c();return tn(t,131),tn(t,128,function gme(e,n){n||(n=Xt(127));for(var t=0;4!=t;++t)n.write_shift(4,0);return bl("SheetJS",n),bl(OC.version,n),bl(OC.version,n),bl("7262",n),n.length>n.l?n.slice(0,n.l):n}()),tn(t,153,function hme(e,n){n||(n=Xt(72));var t=0;return e&&e.filterPrivacy&&(t|=8),n.write_shift(4,t),n.write_shift(4,0),cj(e&&e.CodeName||"ThisWorkbook",n),n.slice(0,n.l)}(e.Workbook&&e.Workbook.WBProps||null)),function yme(e,n){if(n.Workbook&&n.Workbook.Sheets){for(var t=n.Workbook.Sheets,r=0,s=-1,l=-1;r<t.length;++r)!t[r]||!t[r].Hidden&&-1==s?s=r:1==t[r].Hidden&&-1==l&&(l=r);l>s||(tn(e,135),tn(e,158,function _me(e,n){return n||(n=Xt(29)),n.write_shift(-4,0),n.write_shift(-4,460),n.write_shift(4,28800),n.write_shift(4,17600),n.write_shift(4,500),n.write_shift(4,e),n.write_shift(4,e),n.write_shift(1,120),n.length>n.l?n.slice(0,n.l):n}(s)),tn(e,136))}}(t,e),function mme(e,n){tn(e,143);for(var t=0;t!=n.SheetNames.length;++t)tn(e,156,cme({Hidden:n.Workbook&&n.Workbook.Sheets&&n.Workbook.Sheets[t]&&n.Workbook.Sheets[t].Hidden||0,iTabID:t+1,strRelID:"rId"+(t+1),name:n.SheetNames[t]}));tn(e,144)}(t,e),tn(t,132),t.end()}function Rme(e,n,t,r,s){return(".bin"===n.slice(-4)?Wpe:F7)(e,t,r,s)}function Fme(e,n,t){return(".bin"===n.slice(-4)?yhe:b7)(e,t)}function q7(e){return Rn("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+t3(e.Ref,{r:0,c:0})})}function Jme(e,n,t,r,s,l,h){if(!e||null==e.v&&null==e.f)return"";var g={};if(e.f&&(g["ss:Formula"]="="+As(t3(e.f,h))),e.F&&e.F.slice(0,n.length)==n){var x=na(e.F.slice(n.length+1));g["ss:ArrayRange"]="RC:R"+(x.r==h.r?"":"["+(x.r-h.r)+"]")+"C"+(x.c==h.c?"":"["+(x.c-h.c)+"]")}if(e.l&&e.l.Target&&(g["ss:HRef"]=As(e.l.Target),e.l.Tooltip&&(g["x:HRefScreenTip"]=As(e.l.Tooltip))),t["!merges"])for(var E=t["!merges"],D=0;D!=E.length;++D)E[D].s.c!=h.c||E[D].s.r!=h.r||(E[D].e.c>E[D].s.c&&(g["ss:MergeAcross"]=E[D].e.c-E[D].s.c),E[D].e.r>E[D].s.r&&(g["ss:MergeDown"]=E[D].e.r-E[D].s.r));var O="",N="";switch(e.t){case"z":if(!r.sheetStubs)return"";break;case"n":O="Number",N=String(e.v);break;case"b":O="Boolean",N=e.v?"1":"0";break;case"e":O="Error",N=Dg[e.v];break;case"d":O="DateTime",N=new Date(e.v).toISOString(),null==e.z&&(e.z=e.z||Br[14]);break;case"s":O="String",N=function xoe(e){return(e+"").replace(vF,function(t){return yF[t]}).replace(BV,function(t){return"&#x"+t.charCodeAt(0).toString(16).toUpperCase()+";"})}(e.v||"")}var B=P_(r.cellXfs,e,r);g["ss:StyleID"]="s"+(21+B),g["ss:Index"]=h.c+1;var V="z"==e.t?"":'<Data ss:Type="'+O+'">'+(null!=e.v?N:"")+"</Data>";return(e.c||[]).length>0&&(V+=function Kme(e){return e.map(function(n){var t=function boe(e){return e.replace(/(\r\n|[\r\n])/g,"&#10;")}(n.t||""),r=Rn("ss:Data",t,{xmlns:"http://www.w3.org/TR/REC-html40"});return Rn("Comment",r,{"ss:Author":n.a})}).join("")}(e.c)),Rn("Cell",V,g)}function Qme(e,n){var t='<Row ss:Index="'+(e+1)+'"';return n&&(n.hpt&&!n.hpx&&(n.hpx=wk(n.hpt)),n.hpx&&(t+=' ss:AutoFitHeight="0" ss:Height="'+n.hpx+'"'),n.hidden&&(t+=' ss:Hidden="1"')),t+">"}function tge(e,n,t){var r=[],l=t.Sheets[t.SheetNames[e]],h=l?function Xme(e,n,t,r){if(!e||!((r||{}).Workbook||{}).Names)return"";for(var s=r.Workbook.Names,l=[],h=0;h<s.length;++h){var g=s[h];g.Sheet==t&&(g.Name.match(/^_xlfn\./)||l.push(q7(g)))}return l.join("")}(l,0,e,t):"";return h.length>0&&r.push("<Names>"+h+"</Names>"),h=l?function ege(e,n,t,r){if(!e["!ref"])return"";var s=Zi(e["!ref"]),l=e["!merges"]||[],h=0,g=[];e["!cols"]&&e["!cols"].forEach(function(X,le){O_(X);var oe=!!X.width,fe=Mk(le,X),Le={"ss:Index":le+1};oe&&(Le["ss:Width"]=JC(fe.width)),X.hidden&&(Le["ss:Hidden"]="1"),g.push(Rn("Column",null,Le))});for(var x=Array.isArray(e),E=s.s.r;E<=s.e.r;++E){for(var D=[Qme(E,(e["!rows"]||[])[E])],O=s.s.c;O<=s.e.c;++O){var N=!1;for(h=0;h!=l.length;++h)if(!(l[h].s.c>O||l[h].s.r>E||l[h].e.c<O||l[h].e.r<E)){(l[h].s.c!=O||l[h].s.r!=E)&&(N=!0);break}if(!N){var B={r:E,c:O},W=Zr(B);D.push(Jme(x?(e[E]||[])[O]:e[W],W,e,n,0,0,B))}}D.push("</Row>"),D.length>2&&g.push(D.join(""))}return g.join("")}(l,n):"",h.length>0&&r.push("<Table>"+h+"</Table>"),r.push(function Yme(e,n,t,r){if(!e)return"";var s=[];if(e["!margins"]&&(s.push("<PageSetup>"),e["!margins"].header&&s.push(Rn("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&s.push(Rn("Footer",null,{"x:Margin":e["!margins"].footer})),s.push(Rn("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),s.push("</PageSetup>")),r&&r.Workbook&&r.Workbook.Sheets&&r.Workbook.Sheets[t])if(r.Workbook.Sheets[t].Hidden)s.push(Rn("Visible",1==r.Workbook.Sheets[t].Hidden?"SheetHidden":"SheetVeryHidden",{}));else{for(var l=0;l<t&&(!r.Workbook.Sheets[l]||r.Workbook.Sheets[l].Hidden);++l);l==t&&s.push("<Selected/>")}return((((r||{}).Workbook||{}).Views||[])[0]||{}).RTL&&s.push("<DisplayRightToLeft/>"),e["!protect"]&&(s.push(Zl("ProtectContents","True")),e["!protect"].objects&&s.push(Zl("ProtectObjects","True")),e["!protect"].scenarios&&s.push(Zl("ProtectScenarios","True")),null==e["!protect"].selectLockedCells||e["!protect"].selectLockedCells?null!=e["!protect"].selectUnlockedCells&&!e["!protect"].selectUnlockedCells&&s.push(Zl("EnableSelection","UnlockedCells")):s.push(Zl("EnableSelection","NoSelection")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(h){e["!protect"][h[0]]&&s.push("<"+h[1]+"/>")})),0==s.length?"":Rn("WorksheetOptions",s.join(""),{xmlns:th.x})}(l,0,e,t)),r.join("")}function nge(e,n){n||(n={}),e.SSF||(e.SSF=Gs(Br)),e.SSF&&(Mw(),zC(e.SSF),n.revssf=sk(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF,n.cellXfs=[],P_(n.cellXfs,{},{revssf:{General:0}}));var t=[];t.push(function Gme(e,n){var t=[];return e.Props&&t.push(function xae(e,n){var t=[];return No($F).map(function(r){for(var s=0;s<Mg.length;++s)if(Mg[s][1]==r)return Mg[s];for(s=0;s<lv.length;++s)if(lv[s][1]==r)return lv[s];throw r}).forEach(function(r){if(null!=e[r[1]]){var s=n&&n.Props&&null!=n.Props[r[1]]?n.Props[r[1]]:e[r[1]];"date"===r[2]&&(s=new Date(s).toISOString().replace(/\.\d*Z/,"Z")),"number"==typeof s?s=String(s):!0===s||!1===s?s=s?"1":"0":s instanceof Date&&(s=new Date(s).toISOString().replace(/\.\d*Z/,"")),t.push(Zl($F[r[1]]||r[1],s))}}),Rn("DocumentProperties",t.join(""),{xmlns:th.o})}(e.Props,n)),e.Custprops&&t.push(function bae(e,n){var t=["Worksheets","SheetNames"],r="CustomDocumentProperties",s=[];return e&&No(e).forEach(function(l){if(Object.prototype.hasOwnProperty.call(e,l)){for(var h=0;h<Mg.length;++h)if(l==Mg[h][1])return;for(h=0;h<lv.length;++h)if(l==lv[h][1])return;for(h=0;h<t.length;++h)if(l==t[h])return;var g=e[l],x="string";"number"==typeof g?(x="float",g=String(g)):!0===g||!1===g?(x="boolean",g=g?"1":"0"):g=String(g),s.push(Rn(LV(l),g,{"dt:dt":x}))}}),n&&No(n).forEach(function(l){if(Object.prototype.hasOwnProperty.call(n,l)&&(!e||!Object.prototype.hasOwnProperty.call(e,l))){var h=n[l],g="string";"number"==typeof h?(g="float",h=String(h)):!0===h||!1===h?(g="boolean",h=h?"1":"0"):h instanceof Date?(g="dateTime.tz",h=h.toISOString()):h=String(h),s.push(Rn(LV(l),h,{"dt:dt":g}))}}),"<"+r+' xmlns="'+th.o+'">'+s.join("")+"</"+r+">"}(e.Props,e.Custprops)),t.join("")}(e,n)),t.push(""),t.push(""),t.push("");for(var r=0;r<e.SheetNames.length;++r)t.push(Rn("Worksheet",tge(r,n,e),{"ss:Name":As(e.SheetNames[r])}));return t[2]=function qme(e,n){var t=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return n.cellXfs.forEach(function(r,s){var l=[];l.push(Rn("NumberFormat",null,{"ss:Format":As(Br[r.numFmtId])}));var h={"ss:ID":"s"+(21+s)};t.push(Rn("Style",l.join(""),h))}),Rn("Styles",t.join(""))}(0,n),t[3]=function Zme(e){if(!((e||{}).Workbook||{}).Names)return"";for(var n=e.Workbook.Names,t=[],r=0;r<n.length;++r){var s=n[r];null==s.Sheet&&(s.Name.match(/^_xlfn\./)||t.push(q7(s)))}return Rn("Names",t.join(""))}(e),Lo+Rn("Workbook",t.join(""),{xmlns:th.ss,"xmlns:o":th.o,"xmlns:x":th.x,"xmlns:ss":th.ss,"xmlns:dt":th.dt,"xmlns:html":th.html})}var aS={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};var lS={0:{f:function Ofe(e,n){var t={},r=e.l+n;t.r=e.read_shift(4),e.l+=4;var s=e.read_shift(2);e.l+=1;var l=e.read_shift(1);return e.l=r,7&l&&(t.level=7&l),16&l&&(t.hidden=!0),32&l&&(t.hpt=s/20),t}},1:{f:function Ufe(e){return[ad(e)]}},2:{f:function spe(e){return[ad(e),FF(e),"n"]}},3:{f:function Zfe(e){return[ad(e),e.read_shift(1),"e"]}},4:{f:function Hfe(e){return[ad(e),e.read_shift(1),"b"]}},5:{f:function npe(e){return[ad(e),gc(e),"n"]}},6:{f:function upe(e){return[ad(e),mc(e),"str"]}},7:{f:function Jfe(e){return[ad(e),e.read_shift(4),"s"]}},8:{f:function _pe(e,n,t){var r=e.l+n,s=ad(e);s.r=t["!row"];var h=[s,mc(e),"str"];if(t.cellFormula){e.l+=2;var g=Sk(e,r-e.l,t);h[3]=vc(g,0,s,t.supbooks,t)}else e.l=r;return h}},9:{f:function gpe(e,n,t){var r=e.l+n,s=ad(e);s.r=t["!row"];var h=[s,gc(e),"n"];if(t.cellFormula){e.l+=2;var g=Sk(e,r-e.l,t);h[3]=vc(g,0,s,t.supbooks,t)}else e.l=r;return h}},10:{f:function ppe(e,n,t){var r=e.l+n,s=ad(e);s.r=t["!row"];var h=[s,e.read_shift(1),"b"];if(t.cellFormula){e.l+=2;var g=Sk(e,r-e.l,t);h[3]=vc(g,0,s,t.supbooks,t)}else e.l=r;return h}},11:{f:function mpe(e,n,t){var r=e.l+n,s=ad(e);s.r=t["!row"];var h=[s,e.read_shift(1),"e"];if(t.cellFormula){e.l+=2;var g=Sk(e,r-e.l,t);h[3]=vc(g,0,s,t.supbooks,t)}else e.l=r;return h}},12:{f:function jfe(e){return[rv(e)]}},13:{f:function ape(e){return[rv(e),FF(e),"n"]}},14:{f:function Yfe(e){return[rv(e),e.read_shift(1),"e"]}},15:{f:function Wfe(e){return[rv(e),e.read_shift(1),"b"]}},16:{f:function L7(e){return[rv(e),gc(e),"n"]}},17:{f:function dpe(e){return[rv(e),mc(e),"str"]}},18:{f:function epe(e){return[rv(e),e.read_shift(4),"s"]}},19:{f:OF},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:function fme(e,n,t){var r=e.l+n;e.l+=4,e.l+=1;var s=e.read_shift(4),l=qoe(e),h=Zde(e,0,t),g=RF(e);e.l=r;var x={Name:l,Ptg:h};return s<268435455&&(x.Sheet=s),g&&(x.Comment=g),x}},40:{},42:{},43:{f:function uue(e,n,t){var r={};r.sz=e.read_shift(2)/20;var s=function Yoe(e){var n=e.read_shift(1);return e.l++,{fBold:1&n,fItalic:2&n,fUnderline:4&n,fStrikeout:8&n,fOutline:16&n,fShadow:32&n,fCondense:64&n,fExtend:128&n}}(e);switch(s.fItalic&&(r.italic=1),s.fCondense&&(r.condense=1),s.fExtend&&(r.extend=1),s.fShadow&&(r.shadow=1),s.fOutline&&(r.outline=1),s.fStrikeout&&(r.strike=1),700===e.read_shift(2)&&(r.bold=1),e.read_shift(2)){case 1:r.vertAlign="superscript";break;case 2:r.vertAlign="subscript"}var h=e.read_shift(1);0!=h&&(r.underline=h);var g=e.read_shift(1);g>0&&(r.family=g);var x=e.read_shift(1);switch(x>0&&(r.charset=x),e.l++,r.color=function Xoe(e){var n={},r=e.read_shift(1)>>>1,s=e.read_shift(1),l=e.read_shift(2,"i"),h=e.read_shift(1),g=e.read_shift(1),x=e.read_shift(1);switch(e.l++,r){case 0:n.auto=1;break;case 1:n.index=s;var E=av[s];E&&(n.rgb=KC(E));break;case 2:n.rgb=KC([h,g,x]);break;case 3:n.theme=s}return 0!=l&&(n.tint=l>0?l/32767:l/32768),n}(e),e.read_shift(1)){case 1:r.scheme="major";break;case 2:r.scheme="minor"}return r.name=mc(e),r}},44:{f:function lue(e,n){return[e.read_shift(2),mc(e)]}},45:{f:fue},46:{f:mue},47:{f:function pue(e,n){var t=e.l+n,r=e.read_shift(2),s=e.read_shift(2);return e.l=t,{ixfe:r,numFmtId:s}}},48:{},49:{f:function Uoe(e){return e.read_shift(4,"i")}},50:{},51:{f:function Xue(e){for(var n=[],t=e.read_shift(4);t-- >0;)n.push([e.read_shift(4),e.read_shift(4)]);return n}},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:function t7(e,n,t){if(!t.cellStyles)return pc(e,n);var r=t&&t.biff>=12?4:2,s=e.read_shift(r),l=e.read_shift(r),h=e.read_shift(r),g=e.read_shift(r),x=e.read_shift(2);2==r&&(e.l+=2);var E={s,e:l,w:h,ixfe:g,flags:x};return(t.biff>=5||!t.biff)&&(E.level=x>>8&7),E}},62:{f:function cpe(e){return[ad(e),OF(e),"is"]}},63:{f:function ihe(e){var n={};n.i=e.read_shift(4);var t={};t.r=e.read_shift(4),t.c=e.read_shift(4),n.r=Zr(t);var r=e.read_shift(1);return 2&r&&(n.l="1"),8&r&&(n.a="1"),n}},64:{f:function Rpe(){}},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:pc,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:function Ape(e){var n=e.read_shift(2);return e.l+=28,{RTL:32&n}}},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:function Bfe(e,n){var t={},r=e[e.l];return++e.l,t.above=!(64&r),t.left=!(128&r),e.l+=18,t.name=Woe(e,n-19),t}},148:{f:Nfe,p:16},151:{f:function Tpe(){}},152:{},153:{f:function ume(e,n){var t={},r=e.read_shift(4);t.defaultThemeVersion=e.read_shift(4);var s=n>8?mc(e):"";return s.length>0&&(t.CodeName=s),t.autoCompressPictures=!!(65536&r),t.backupFile=!!(64&r),t.checkCompatibility=!!(4096&r),t.date1904=!!(1&r),t.filterPrivacy=!!(8&r),t.hidePivotFieldList=!!(1024&r),t.promptedSolutions=!!(16&r),t.publishItems=!!(2048&r),t.refreshAllConnections=!!(262144&r),t.saveExternalLinkValues=!!(128&r),t.showBorderUnselectedTables=!!(4&r),t.showInkAnnotation=!!(32&r),t.showObjects=["all","placeholders","none"][r>>13&3],t.showPivotChartFilter=!!(32768&r),t.updateLinks=["userSet","never","always"][r>>8&3],t}},154:{},155:{},156:{f:function lme(e,n){var t={};return t.Hidden=e.read_shift(4),t.iTabID=e.read_shift(4),t.strRelID=PF(e,n-8),t.name=mc(e),t}},157:{},158:{},159:{T:1,f:function Ice(e){return[e.read_shift(4),e.read_shift(4)]}},160:{T:-1},161:{T:1,f:sv},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:ype},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:function que(e,n){return{flags:e.read_shift(4),version:e.read_shift(4),name:mc(e)}}},336:{T:-1},337:{f:function Jue(e){return e.l+=4,0!=e.read_shift(4)},T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:PF},357:{},358:{},359:{},360:{T:1},361:{},362:{f:function Qj(e,n,t){if(t.biff<8)return function Nle(e,n,t){3==e[e.l+1]&&e[e.l]++;var r=XC(e,0,t);return 3==r.charCodeAt(0)?r.slice(1):r}(e,0,t);for(var r=[],s=e.l+n,l=e.read_shift(t.biff>8?4:2);0!=l--;)r.push($ae(e,0,t));if(e.l!=s)throw new Error("Bad ExternSheet: "+e.l+" != "+s);return r}},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:function Epe(e,n,t){var r=e.l+n,s=hj(e),l=e.read_shift(1),h=[s];if(h[2]=l,t.cellFormula){var g=qde(e,r-e.l,t);h[1]=g}else e.l=r;return h}},427:{f:function Cpe(e,n,t){var r=e.l+n,l=[sv(e,16)];if(t.cellFormula){var h=Xde(e,r-e.l,t);l[1]=h,e.l=r}else e.l=r;return l}},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:function Dpe(e){var n={};return B7.forEach(function(t){n[t]=gc(e)}),n}},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:function Lfe(){}},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:function bpe(e,n){var t=e.l+n,r=sv(e,16),s=RF(e),l=mc(e),h=mc(e),g=mc(e);e.l=t;var x={rfx:r,relId:s,loc:l,display:g};return h&&(x.Tooltip=h),x}},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:PF},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:mhe},633:{T:1},634:{T:-1},635:{T:1,f:function fhe(e){var n={};n.iauthor=e.read_shift(4);var t=sv(e,16);return n.rfx=t.s,n.ref=Zr(t.s),e.l+=16,n}},636:{T:-1},637:{f:Hoe},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:function Kpe(e,n){return e.l+=10,{name:mc(e)}}},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:function Ppe(){}},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function Ln(e,n,t,r){var s=n;if(!isNaN(s)){var l=r||(t||[]).length||0,h=e.next(4);h.write_shift(2,s),h.write_shift(2,l),l>0&&MF(t)&&e.push(t)}}function cS(e,n,t){return e||(e=Xt(7)),e.write_shift(2,n),e.write_shift(2,t),e.write_shift(2,0),e.write_shift(1,0),e}function fge(e,n,t,r){if(null!=n.v)switch(n.t){case"d":case"n":var s="d"==n.t?vl(Eo(n.v)):n.v;return void(s==(0|s)&&s>=0&&s<65536?Ln(e,2,function pce(e,n,t){var r=Xt(9);return cS(r,e,n),r.write_shift(2,t),r}(t,r,s)):Ln(e,3,function dce(e,n,t){var r=Xt(15);return cS(r,e,n),r.write_shift(8,t,"f"),r}(t,r,s)));case"b":case"e":return void Ln(e,5,function hge(e,n,t,r){var s=Xt(9);return cS(s,e,n),Lj(t,r||"b",s),s}(t,r,n.v,n.t));case"s":case"str":return void Ln(e,4,function dge(e,n,t){var r=Xt(8+2*t.length);return cS(r,e,n),r.write_shift(1,t.length),r.write_shift(t.length,t,"sbcs"),r.l<r.length?r.slice(0,r.l):r}(t,r,(n.v||"").slice(0,255)))}Ln(e,1,cS(null,t,r))}function wge(e,n,t,r,s){var l=16+P_(s.cellXfs,n,s);if(null!=n.v||n.bf)if(n.bf)Ln(e,6,function Wde(e,n,t,r,s){var l=hv(n,t,s),h=function Gde(e){if(null==e){var n=Xt(8);return n.write_shift(1,3),n.write_shift(1,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,65535),n}return ov("number"==typeof e?e:0)}(e.v),g=Xt(6);g.write_shift(2,33),g.write_shift(4,0);for(var E=Xt(e.bf.length),D=0;D<e.bf.length;++D)E[D]=e.bf[D];return yl([l,h,g,E])}(n,t,r,0,l));else switch(n.t){case"d":case"n":Ln(e,515,function Ole(e,n,t,r){var s=Xt(14);return hv(e,n,r,s),ov(t,s),s}(t,r,"d"==n.t?vl(Eo(n.v)):n.v,l));break;case"b":case"e":Ln(e,517,function Ile(e,n,t,r,s,l){var h=Xt(8);return hv(e,n,r,h),Lj(t,l,h),h}(t,r,n.v,l,0,n.t));break;case"s":case"str":s.bookSST?Ln(e,253,function gle(e,n,t,r){var s=Xt(10);return hv(e,n,r,s),s.write_shift(4,t),s}(t,r,s3(s.Strings,n.v,s.revStrings),l)):Ln(e,516,function yle(e,n,t,r,s){var l=!s||8==s.biff,h=Xt(+l+8+(1+l)*t.length);return hv(e,n,r,h),h.write_shift(2,t.length),l&&h.write_shift(1,1),h.write_shift((1+l)*t.length,t,l?"utf16le":"sbcs"),h}(t,r,(n.v||"").slice(0,255),l,s));break;default:Ln(e,513,hv(t,r,l))}else Ln(e,513,hv(t,r,l))}function Tge(e,n,t){var D,r=$c(),s=t.SheetNames[e],l=t.Sheets[s]||{},h=(t||{}).Workbook||{},g=(h.Sheets||[])[e]||{},x=Array.isArray(l),E=8==n.biff,O="",N=[],B=Zi(l["!ref"]||"A1"),W=E?65536:16384;if(B.e.c>255||B.e.r>=W){if(n.WTF)throw new Error("Range "+(l["!ref"]||"A1")+" exceeds format limit A1:IV16384");B.e.c=Math.min(B.e.c,255),B.e.r=Math.min(B.e.c,W-1)}Ln(r,2057,qF(0,16,n)),Ln(r,13,ld(1)),Ln(r,12,ld(100)),Ln(r,15,Gc(!0)),Ln(r,17,Gc(!1)),Ln(r,16,ov(.001)),Ln(r,95,Gc(!0)),Ln(r,42,Gc(!1)),Ln(r,43,Gc(!1)),Ln(r,130,ld(1)),Ln(r,128,function Ale(e){var n=Xt(8);return n.write_shift(4,0),n.write_shift(2,e[0]?e[0]+1:0),n.write_shift(2,e[1]?e[1]+1:0),n}([0,0])),Ln(r,131,Gc(!1)),Ln(r,132,Gc(!1)),E&&function bge(e,n){if(n){var t=0;n.forEach(function(r,s){++t<=256&&r&&Ln(e,125,function nce(e,n){var t=Xt(12);t.write_shift(2,n),t.write_shift(2,n),t.write_shift(2,256*e.width),t.write_shift(2,0);var r=0;return e.hidden&&(r|=1),t.write_shift(1,r),t.write_shift(1,r=e.level||0),t.write_shift(2,0),t}(Mk(s,r),s))})}}(r,l["!cols"]),Ln(r,512,function wle(e,n){var t=8!=n.biff&&n.biff?2:4,r=Xt(2*t+6);return r.write_shift(t,e.s.r),r.write_shift(t,e.e.r+1),r.write_shift(2,e.s.c),r.write_shift(2,e.e.c+1),r.write_shift(2,0),r}(B,n)),E&&(l["!links"]=[]);for(var V=B.s.r;V<=B.e.r;++V){O=Bo(V);for(var X=B.s.c;X<=B.e.c;++X){V===B.s.r&&(N[X]=ao(X)),D=N[X]+O;var le=x?(l[V]||[])[X]:l[D];le&&(wge(r,le,V,X,n),E&&le.l&&l["!links"].push([D,le.l]))}}var oe=g.CodeName||g.name||s;return E&&Ln(r,574,function hle(e){var n=Xt(18),t=1718;return e&&e.RTL&&(t|=64),n.write_shift(2,t),n.write_shift(4,0),n.write_shift(4,64),n.write_shift(4,0),n.write_shift(4,0),n}((h.Views||[])[0])),E&&(l["!merges"]||[]).length&&Ln(r,229,function jle(e){var n=Xt(2+8*e.length);n.write_shift(2,e.length);for(var t=0;t<e.length;++t)$j(e[t],n);return n}(l["!merges"])),E&&function xge(e,n){for(var t=0;t<n["!links"].length;++t){var r=n["!links"][t];Ln(e,440,Zle(r)),r[1].Tooltip&&Ln(e,2048,Yle(r))}delete n["!links"]}(r,l),Ln(r,442,Bj(oe)),E&&function yge(e,n){var t=Xt(19);t.write_shift(4,2151),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(2,3),t.write_shift(1,1),t.write_shift(4,0),Ln(e,2151,t),(t=Xt(39)).write_shift(4,2152),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(2,3),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(2,1),t.write_shift(4,4),t.write_shift(2,0),$j(Zi(n["!ref"]||"A1"),t),t.write_shift(4,4),Ln(e,2152,t)}(r,l),Ln(r,10),r.end()}function Ege(e,n,t){var r=$c(),s=(e||{}).Workbook||{},l=s.Sheets||[],h=s.WBProps||{},g=8==t.biff,x=5==t.biff;Ln(r,2057,qF(0,5,t)),"xla"==t.bookType&&Ln(r,135),Ln(r,225,g?ld(1200):null),Ln(r,193,function Iae(e,n){n||(n=Xt(e));for(var t=0;t<e;++t)n.write_shift(1,0);return n}(2)),x&&Ln(r,191),x&&Ln(r,192),Ln(r,226),Ln(r,92,function Jae(e,n){var t=!n||8==n.biff,r=Xt(t?112:54);for(r.write_shift(8==n.biff?2:1,7),t&&r.write_shift(1,0),r.write_shift(4,859007059),r.write_shift(4,5458548|(t?0:536870912));r.l<r.length;)r.write_shift(1,t?0:32);return r}(0,t)),Ln(r,66,ld(g?1200:1252)),g&&Ln(r,353,ld(0)),g&&Ln(r,448),Ln(r,317,function sce(e){for(var n=Xt(2*e),t=0;t<e;++t)n.write_shift(2,t+1);return n}(e.SheetNames.length)),g&&e.vbaraw&&Ln(r,211),g&&e.vbaraw&&Ln(r,442,Bj(h.CodeName||"ThisWorkbook")),Ln(r,156,ld(17)),Ln(r,25,Gc(!1)),Ln(r,18,Gc(!1)),Ln(r,19,ld(0)),g&&Ln(r,431,Gc(!1)),g&&Ln(r,444,ld(0)),Ln(r,61,function cle(){var e=Xt(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}()),Ln(r,64,Gc(!1)),Ln(r,141,ld(0)),Ln(r,34,Gc("true"==function rme(e){return e.Workbook&&e.Workbook.WBProps&&function mo(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}(e.Workbook.WBProps.date1904)?"true":"false"}(e))),Ln(r,14,Gc(!0)),g&&Ln(r,439,Gc(!1)),Ln(r,218,ld(0)),function gge(e,n,t){Ln(e,49,function ple(e,n){var t=e.name||"Arial",r=n&&5==n.biff,l=Xt(r?15+t.length:16+2*t.length);return l.write_shift(2,20*(e.sz||12)),l.write_shift(4,0),l.write_shift(2,400),l.write_shift(4,0),l.write_shift(2,0),l.write_shift(1,t.length),r||l.write_shift(1,1),l.write_shift((r?1:2)*t.length,t,r?"sbcs":"utf16le"),l}({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},t))}(r,0,t),function _ge(e,n,t){n&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var s=r[0];s<=r[1];++s)null!=n[s]&&Ln(e,1054,xle(s,n[s],t))})}(r,e.SSF,t),function vge(e,n){for(var t=0;t<16;++t)Ln(e,224,Zj({numFmtId:0,style:!0},0,n));n.cellXfs.forEach(function(r){Ln(e,224,Zj(r,0,n))})}(r,t),g&&Ln(r,352,Gc(!1));var D=r.end(),O=$c();g&&Ln(O,140,function Jle(e){return e||(e=Xt(4)),e.write_shift(2,1),e.write_shift(2,1),e}()),g&&t.Strings&&function uge(e,n,t,r){var s=r||(t||[]).length||0;if(s<=8224)return Ln(e,n,t,s);var l=n;if(!isNaN(l)){for(var h=t.parts||[],g=0,x=0,E=0;E+(h[g]||8224)<=8224;)E+=h[g]||8224,g++;var D=e.next(4);for(D.write_shift(2,l),D.write_shift(2,E),e.push(t.slice(x,x+E)),x+=E;x<s;){for((D=e.next(4)).write_shift(2,60),E=0;E+(h[g]||8224)<=8224;)E+=h[g]||8224,g++;D.write_shift(2,E),e.push(t.slice(x,x+E)),x+=E}}}(O,252,function rle(e,n){var t=Xt(8);t.write_shift(4,e.Count),t.write_shift(4,e.Unique);for(var r=[],s=0;s<e.length;++s)r[s]=Pae(e[s]);var l=yl([t].concat(r));return l.parts=[t.length].concat(r.map(function(h){return h.length})),l}(t.Strings)),Ln(O,10);var N=O.end(),B=$c(),W=0,V=0;for(V=0;V<e.SheetNames.length;++V)W+=(g?12:11)+(g?2:1)*e.SheetNames[V].length;var X=D.length+W+N.length;for(V=0;V<e.SheetNames.length;++V)Ln(B,133,tle({pos:X,hs:(l[V]||{}).Hidden||0,dt:0,name:e.SheetNames[V]},t)),X+=n[V].length;var oe=B.end();if(W!=oe.length)throw new Error("BS8 "+W+" != "+oe.length);var fe=[];return D.length&&fe.push(D),oe.length&&fe.push(oe),N.length&&fe.push(N),yl(fe)}function X7(e,n){for(var t=0;t<=e.SheetNames.length;++t){var r=e.Sheets[e.SheetNames[t]];r&&r["!ref"]&&Hc(r["!ref"]).e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+e.SheetNames[t]+"' extends beyond column IV (255).  Data may be lost.")}var l=n||{};switch(l.biff||2){case 8:case 5:return function Cge(e,n){var t=n||{},r=[];e&&!e.SSF&&(e.SSF=Gs(Br)),e&&e.SSF&&(Mw(),zC(e.SSF),t.revssf=sk(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,_3(t),t.cellXfs=[],P_(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var s=0;s<e.SheetNames.length;++s)r[r.length]=Tge(s,t,e);return r.unshift(Ege(e,r,t)),yl(r)}(e,n);case 4:case 3:case 2:return function mge(e,n){var t=n||{};null!=Po&&null==t.dense&&(t.dense=Po);for(var r=$c(),s=0,l=0;l<e.SheetNames.length;++l)e.SheetNames[l]==t.sheet&&(s=l);if(0==s&&t.sheet&&e.SheetNames[0]!=t.sheet)throw new Error("Sheet not found: "+t.sheet);return Ln(r,4==t.biff?1033:3==t.biff?521:9,qF(0,16,t)),function pge(e,n,t,r){var h,s=Array.isArray(n),l=Zi(n["!ref"]||"A1"),g="",x=[];if(l.e.c>255||l.e.r>16383){if(r.WTF)throw new Error("Range "+(n["!ref"]||"A1")+" exceeds format limit A1:IV16384");l.e.c=Math.min(l.e.c,255),l.e.r=Math.min(l.e.c,16383),h=gi(l)}for(var E=l.s.r;E<=l.e.r;++E){g=Bo(E);for(var D=l.s.c;D<=l.e.c;++D){E===l.s.r&&(x[D]=ao(D)),h=x[D]+g;var O=s?(n[E]||[])[D]:n[h];O&&fge(e,O,E,D)}}}(r,e.Sheets[e.SheetNames[s]],0,t),Ln(r,10),r.end()}(e,n)}throw new Error("invalid type "+l.bookType+" for BIFF")}function K7(e,n,t,r){for(var s=e["!merges"]||[],l=[],h=n.s.c;h<=n.e.c;++h){for(var g=0,x=0,E=0;E<s.length;++E)if(!(s[E].s.r>t||s[E].s.c>h||s[E].e.r<t||s[E].e.c<h)){if(s[E].s.r<t||s[E].s.c<h){g=-1;break}g=s[E].e.r-s[E].s.r+1,x=s[E].e.c-s[E].s.c+1;break}if(!(g<0)){var D=Zr({r:t,c:h}),O=r.dense?(e[t]||[])[h]:e[D],N=O&&null!=O.v&&(O.h||zV(O.w||(em(O),O.w)||""))||"",B={};g>1&&(B.rowspan=g),x>1&&(B.colspan=x),r.editable?N='<span contenteditable="true">'+N+"</span>":O&&(B["data-t"]=O&&O.t||"z",null!=O.v&&(B["data-v"]=O.v),null!=O.z&&(B["data-z"]=O.z),O.l&&"#"!=(O.l.Target||"#").charAt(0)&&(N='<a href="'+O.l.Target+'">'+N+"</a>")),B.id=(r.id||"sjs")+"-"+D,l.push(Rn("td",N,B))}}return"<tr>"+l.join("")+"</tr>"}var J7='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',Q7="</body></html>";function t$(e,n){var t=n||{},s=null!=t.footer?t.footer:Q7,l=[null!=t.header?t.header:J7],h=Hc(e["!ref"]);t.dense=Array.isArray(e),l.push(function e$(e,n,t){return[].join("")+"<table"+(t&&t.id?' id="'+t.id+'"':"")+">"}(0,0,t));for(var g=h.s.r;g<=h.e.r;++g)l.push(K7(e,h,g,t));return l.push("</table>"+s),l.join("")}var Ige=function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),n="<office:document-styles "+jC({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return Lo+n}}(),c$=function(){var e=function(l){return As(l).replace(/  +/g,function(h){return'<text:s text:c="'+h.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},n="          <table:table-cell />\n",r=function(l,h,g){var x=[];x.push('      <table:table table:name="'+As(h.SheetNames[g])+'" table:style-name="ta1">\n');var E=0,D=0,O=Hc(l["!ref"]||"A1"),N=l["!merges"]||[],B=0,W=Array.isArray(l);if(l["!cols"])for(D=0;D<=O.e.c;++D)x.push("        <table:table-column"+(l["!cols"][D]?' table:style-name="co'+l["!cols"][D].ods+'"':"")+"></table:table-column>\n");var X=l["!rows"]||[];for(E=0;E<O.s.r;++E)x.push("        <table:table-row"+(X[E]?' table:style-name="ro'+X[E].ods+'"':"")+"></table:table-row>\n");for(;E<=O.e.r;++E){for(x.push("        <table:table-row"+(X[E]?' table:style-name="ro'+X[E].ods+'"':"")+">\n"),D=0;D<O.s.c;++D)x.push(n);for(;D<=O.e.c;++D){var le=!1,oe={},fe="";for(B=0;B!=N.length;++B)if(!(N[B].s.c>D||N[B].s.r>E||N[B].e.c<D||N[B].e.r<E)){(N[B].s.c!=D||N[B].s.r!=E)&&(le=!0),oe["table:number-columns-spanned"]=N[B].e.c-N[B].s.c+1,oe["table:number-rows-spanned"]=N[B].e.r-N[B].s.r+1;break}if(le)x.push("          <table:covered-table-cell/>\n");else{var Le=Zr({r:E,c:D}),Ze=W?(l[E]||[])[D]:l[Le];if(Ze&&Ze.f&&(oe["table:formula"]=As(Jde(Ze.f)),Ze.F&&Ze.F.slice(0,Le.length)==Le)){var at=Hc(Ze.F);oe["table:number-matrix-columns-spanned"]=at.e.c-at.s.c+1,oe["table:number-matrix-rows-spanned"]=at.e.r-at.s.r+1}if(Ze){switch(Ze.t){case"b":fe=Ze.v?"TRUE":"FALSE",oe["office:value-type"]="boolean",oe["office:boolean-value"]=Ze.v?"true":"false";break;case"n":fe=Ze.w||String(Ze.v||0),oe["office:value-type"]="float",oe["office:value"]=Ze.v||0;break;case"s":case"str":fe=null==Ze.v?"":Ze.v,oe["office:value-type"]="string";break;case"d":fe=Ze.w||Eo(Ze.v).toISOString(),oe["office:value-type"]="date",oe["office:date-value"]=Eo(Ze.v).toISOString(),oe["table:style-name"]="ce1";break;default:x.push(n);continue}var Ne=e(fe);if(Ze.l&&Ze.l.Target){var ot=Ze.l.Target;"#"!=(ot="#"==ot.charAt(0)?"#"+Qde(ot.slice(1)):ot).charAt(0)&&!ot.match(/^\w+:/)&&(ot="../"+ot),Ne=Rn("text:a",Ne,{"xlink:href":ot.replace(/&/g,"&amp;")})}x.push("          "+Rn("table:table-cell",Rn("text:p",Ne,{}),oe)+"\n")}else x.push(n)}}x.push("        </table:table-row>\n")}return x.push("      </table:table>\n"),x.join("")};return function(h,g){var x=[Lo],E=jC({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),D=jC({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});"fods"==g.bookType?(x.push("<office:document"+E+D+">\n"),x.push(yj().replace(/office:document-meta/g,"office:meta"))):x.push("<office:document-content"+E+">\n"),function(l,h){l.push(" <office:automatic-styles>\n"),l.push('  <number:date-style style:name="N37" number:automatic-order="true">\n'),l.push('   <number:month number:style="long"/>\n'),l.push("   <number:text>/</number:text>\n"),l.push('   <number:day number:style="long"/>\n'),l.push("   <number:text>/</number:text>\n"),l.push("   <number:year/>\n"),l.push("  </number:date-style>\n");var g=0;h.SheetNames.map(function(E){return h.Sheets[E]}).forEach(function(E){if(E&&E["!cols"])for(var D=0;D<E["!cols"].length;++D)if(E["!cols"][D]){var O=E["!cols"][D];if(null==O.width&&null==O.wpx&&null==O.wch)continue;O_(O),O.ods=g;var N=E["!cols"][D].wpx+"px";l.push('  <style:style style:name="co'+g+'" style:family="table-column">\n'),l.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+N+'"/>\n'),l.push("  </style:style>\n"),++g}});var x=0;h.SheetNames.map(function(E){return h.Sheets[E]}).forEach(function(E){if(E&&E["!rows"])for(var D=0;D<E["!rows"].length;++D)if(E["!rows"][D]){E["!rows"][D].ods=x;var O=E["!rows"][D].hpx+"px";l.push('  <style:style style:name="ro'+x+'" style:family="table-row">\n'),l.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+O+'"/>\n'),l.push("  </style:style>\n"),++x}}),l.push('  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">\n'),l.push('   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>\n'),l.push("  </style:style>\n"),l.push('  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>\n'),l.push(" </office:automatic-styles>\n")}(x,h),x.push("  <office:body>\n"),x.push("    <office:spreadsheet>\n");for(var O=0;O!=h.SheetNames.length;++O)x.push(r(h.Sheets[h.SheetNames[O]],h,O));return x.push("    </office:spreadsheet>\n"),x.push("  </office:body>\n"),x.push("fods"==g.bookType?"</office:document>":"</office:document-content>"),x.join("")}}();function u$(e,n){if("fods"==n.bookType)return c$(e,n);var t=_F(),r="",s=[],l=[];return Ei(t,r="mimetype","application/vnd.oasis.opendocument.spreadsheet"),Ei(t,r="content.xml",c$(e,n)),s.push([r,"text/xml"]),l.push([r,"ContentFile"]),Ei(t,r="styles.xml",Ige(e,n)),s.push([r,"text/xml"]),l.push([r,"StylesFile"]),Ei(t,r="meta.xml",Lo+yj()),s.push([r,"text/xml"]),l.push([r,"MetadataFile"]),Ei(t,r="manifest.rdf",function pae(e){var n=[Lo];n.push('<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n');for(var t=0;t!=e.length;++t)n.push(_j(e[t][0],e[t][1])),n.push(fae("",e[t][0]));return n.push(_j("","Document","pkg")),n.push("</rdf:RDF>"),n.join("")}(l)),s.push([r,"application/rdf+xml"]),Ei(t,r="META-INF/manifest.xml",function dae(e){var n=[Lo];n.push('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">\n'),n.push('  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>\n');for(var t=0;t<e.length;++t)n.push('  <manifest:file-entry manifest:full-path="'+e[t][0]+'" manifest:media-type="'+e[t][1]+'"/>\n');return n.push("</manifest:manifest>"),n.join("")}(s)),t}function pv(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function kge(e){return typeof TextEncoder<"u"?(new TextEncoder).encode(e):Ju(Qp(e))}function N_(e){var n=e.reduce(function(s,l){return s+l.length},0),t=new Uint8Array(n),r=0;return e.forEach(function(s){t.set(s,r),r+=s.length}),t}function uS(e,n){var t=n?n[0]:0,r=127&e[t];e:if(e[t++]>=128&&(r|=(127&e[t])<<7,e[t++]<128||(r|=(127&e[t])<<14,e[t++]<128)||(r|=(127&e[t])<<21,e[t++]<128)||(r+=(127&e[t])*Math.pow(2,28),++t,e[t++]<128)||(r+=(127&e[t])*Math.pow(2,35),++t,e[t++]<128)||(r+=(127&e[t])*Math.pow(2,42),++t,e[t++]<128)))break e;return n&&(n[0]=t),r}function ws(e){var n=new Uint8Array(7);n[0]=127&e;var t=1;e:if(e>127){if(n[t-1]|=128,n[t]=e>>7&127,++t,e<=16383||(n[t-1]|=128,n[t]=e>>14&127,++t,e<=2097151)||(n[t-1]|=128,n[t]=e>>21&127,++t,e<=268435455)||(n[t-1]|=128,n[t]=e/256>>>21&127,++t,e<=34359738367)||(n[t-1]|=128,n[t]=e/65536>>>21&127,++t,e<=4398046511103))break e;n[t-1]|=128,n[t]=e/16777216>>>21&127,++t}return n.slice(0,t)}function zo(e){var n=0,t=127&e[n];e:if(e[n++]>=128){if(t|=(127&e[n])<<7,e[n++]<128||(t|=(127&e[n])<<14,e[n++]<128)||(t|=(127&e[n])<<21,e[n++]<128))break e;t|=(127&e[n])<<28}return t}function ss(e){for(var n=[],t=[0];t[0]<e.length;){var g,r=t[0],s=uS(e,t),l=7&s,h=0;if(0==(s=Math.floor(s/8)))break;switch(l){case 0:for(var x=t[0];e[t[0]++]>=128;);g=e.slice(x,t[0]);break;case 5:g=e.slice(t[0],t[0]+(h=4)),t[0]+=h;break;case 1:g=e.slice(t[0],t[0]+(h=8)),t[0]+=h;break;case 2:h=uS(e,t),g=e.slice(t[0],t[0]+h),t[0]+=h;break;default:throw new Error("PB Type ".concat(l," for Field ").concat(s," at offset ").concat(r))}var E={data:g,type:l};null==n[s]?n[s]=[E]:n[s].push(E)}return n}function Tl(e){var n=[];return e.forEach(function(t,r){t.forEach(function(s){s.data&&(n.push(ws(8*r+s.type)),2==s.type&&n.push(ws(s.data.length)),n.push(s.data))})}),N_(n)}function cd(e){for(var n,t=[],r=[0];r[0]<e.length;){var s=uS(e,r),l=ss(e.slice(r[0],r[0]+s));r[0]+=s;var h={id:zo(l[1][0].data),messages:[]};l[2].forEach(function(g){var x=ss(g.data),E=zo(x[3][0].data);h.messages.push({meta:x,data:e.slice(r[0],r[0]+E)}),r[0]+=E}),null!=(n=l[3])&&n[0]&&(h.merge=zo(l[3][0].data)>>>0>0),t.push(h)}return t}function zw(e){var n=[];return e.forEach(function(t){var r=[];r[1]=[{data:ws(t.id),type:0}],r[2]=[],null!=t.merge&&(r[3]=[{data:ws(+!!t.merge),type:0}]);var s=[];t.messages.forEach(function(h){s.push(h.data),h.meta[3]=[{type:0,data:ws(h.data.length)}],r[2].push({data:Tl(h.meta),type:2})});var l=Tl(r);n.push(ws(l.length)),n.push(l),s.forEach(function(h){return n.push(h)})}),N_(n)}function Nge(e,n){if(0!=e)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var t=[0],r=uS(n,t),s=[];t[0]<n.length;){var l=3&n[t[0]];if(0!=l){var x=0,E=0;if(1==l?(E=4+(n[t[0]]>>2&7),x=(224&n[t[0]++])<<3,x|=n[t[0]++]):(E=1+(n[t[0]++]>>2),2==l?(x=n[t[0]]|n[t[0]+1]<<8,t[0]+=2):(x=(n[t[0]]|n[t[0]+1]<<8|n[t[0]+2]<<16|n[t[0]+3]<<24)>>>0,t[0]+=4)),s=[N_(s)],0==x)throw new Error("Invalid offset 0");if(x>s[0].length)throw new Error("Invalid offset beyond length");if(E>=x)for(s.push(s[0].slice(-x)),E-=x;E>=s[s.length-1].length;)s.push(s[s.length-1]),E-=s[s.length-1].length;s.push(s[0].slice(-x,-x+E))}else{var h=n[t[0]++]>>2;if(h<60)++h;else{var g=h-59;h=n[t[0]],g>1&&(h|=n[t[0]+1]<<8),g>2&&(h|=n[t[0]+2]<<16),g>3&&(h|=n[t[0]+3]<<24),h>>>=0,h++,t[0]+=g}s.push(n.slice(t[0],t[0]+h)),t[0]+=h}}var D=N_(s);if(D.length!=r)throw new Error("Unexpected length: ".concat(D.length," != ").concat(r));return D}function ud(e){for(var n=[],t=0;t<e.length;){var r=e[t++],s=e[t]|e[t+1]<<8|e[t+2]<<16;n.push(Nge(r,e.slice(t+=3,t+s))),t+=s}if(t!==e.length)throw new Error("data is not a valid framed stream!");return N_(n)}function Uw(e){for(var n=[],t=0;t<e.length;){var r=Math.min(e.length-t,268435455),s=new Uint8Array(4);n.push(s);var l=ws(r),h=l.length;n.push(l),r<=60?(h++,n.push(new Uint8Array([r-1<<2]))):r<=256?(h+=2,n.push(new Uint8Array([240,r-1&255]))):r<=65536?(h+=3,n.push(new Uint8Array([244,r-1&255,r-1>>8&255]))):r<=16777216?(h+=4,n.push(new Uint8Array([248,r-1&255,r-1>>8&255,r-1>>16&255]))):r<=4294967296&&(h+=5,n.push(new Uint8Array([252,r-1&255,r-1>>8&255,r-1>>16&255,r-1>>>24&255]))),n.push(e.slice(t,t+r)),h+=r,s[0]=0,s[1]=255&h,s[2]=h>>8&255,s[3]=h>>16&255,t+=r}return N_(n)}function f3(e,n){var t=new Uint8Array(32),r=pv(t),s=12,l=0;switch(t[0]=5,e.t){case"n":t[1]=2,function Pge(e,n,t){var r=Math.floor(0==t?0:Math.LOG10E*Math.log(Math.abs(t)))+6176-20,s=t/Math.pow(10,r-6176);e[n+15]|=r>>7,e[n+14]|=(127&r)<<1;for(var l=0;s>=1;++l,s/=256)e[n+l]=255&s;e[n+15]|=t>=0?0:128}(t,s,e.v),l|=1,s+=16;break;case"b":t[1]=6,r.setFloat64(s,e.v?1:0,!0),l|=2,s+=8;break;case"s":if(-1==n.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));t[1]=3,r.setUint32(s,n.indexOf(e.v),!0),l|=8,s+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(8,l,!0),t.slice(0,s)}function p3(e,n){var t=new Uint8Array(32),r=pv(t),s=12,l=0;switch(t[0]=3,e.t){case"n":t[2]=2,r.setFloat64(s,e.v,!0),l|=32,s+=8;break;case"b":t[2]=6,r.setFloat64(s,e.v?1:0,!0),l|=32,s+=8;break;case"s":if(-1==n.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));t[2]=3,r.setUint32(s,n.indexOf(e.v),!0),l|=16,s+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(4,l,!0),t.slice(0,s)}function xc(e){return uS(ss(e)[1][0].data)}function Gge(e,n,t){var r,s,l,h;if(null==(r=e[6])||!r[0]||null==(s=e[7])||!s[0])throw"Mutation only works on post-BNC storages!";if((null==(h=null==(l=e[8])?void 0:l[0])?void 0:h.data)&&zo(e[8][0].data)>0)throw"Math only works with normal offsets";for(var x=0,E=pv(e[7][0].data),D=0,O=[],N=pv(e[4][0].data),B=0,W=[],V=0;V<n.length;++V)if(null!=n[V]){var X,le;switch(E.setUint16(2*V,D,!0),N.setUint16(2*V,B,!0),typeof n[V]){case"string":X=f3({t:"s",v:n[V]},t),le=p3({t:"s",v:n[V]},t);break;case"number":X=f3({t:"n",v:n[V]},t),le=p3({t:"n",v:n[V]},t);break;case"boolean":X=f3({t:"b",v:n[V]},t),le=p3({t:"b",v:n[V]},t);break;default:throw new Error("Unsupported value "+n[V])}O.push(X),D+=X.length,W.push(le),B+=le.length,++x}else E.setUint16(2*V,65535,!0),N.setUint16(2*V,65535);for(e[2][0].data=ws(x);V<e[7][0].data.length/2;++V)E.setUint16(2*V,65535,!0),N.setUint16(2*V,65535,!0);return e[6][0].data=N_(O),e[3][0].data=N_(W),x}function _3(e){!function f$(e){return function(t){for(var r=0;r!=e.length;++r){var s=e[r];void 0===t[s[0]]&&(t[s[0]]=s[1]),"n"===s[2]&&(t[s[0]]=Number(t[s[0]]))}}}([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function Jge(e,n){return"ods"==n.bookType?u$(e,n):"numbers"==n.bookType?function Wge(e,n){if(!n||!n.numbers)throw new Error("Must pass a `numbers` option -- check the README");var t=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var r=Hc(t["!ref"]);r.s.r=r.s.c=0;var s=!1;r.e.c>9&&(s=!0,r.e.c=9),r.e.r>49&&(s=!0,r.e.r=49),s&&console.error("The Numbers writer is currently limited to ".concat(gi(r)));var l=Ok(t,{range:r,header:1}),h=["~Sh33tJ5~"];l.forEach(function(rt){return rt.forEach(function(et){"string"==typeof et&&h.push(et)})});var g={},x=[],E=Mr.read(n.numbers,{type:"base64"});E.FileIndex.map(function(rt,et){return[rt,E.FullPaths[et]]}).forEach(function(rt){var et=rt[0],Yt=rt[1];2==et.type&&et.name.match(/\.iwa/)&&cd(ud(et.content)).forEach(function(rn){x.push(rn.id),g[rn.id]={deps:[],location:Yt,type:zo(rn.messages[0].meta[1][0].data)}})}),x.sort(function(rt,et){return rt-et});var D=x.filter(function(rt){return rt>1}).map(function(rt){return[rt,ws(rt)]});E.FileIndex.map(function(rt,et){return[rt,E.FullPaths[et]]}).forEach(function(rt){var et=rt[0];et.name.match(/\.iwa/)&&cd(ud(et.content)).forEach(function(vn){vn.messages.forEach(function(Sn){D.forEach(function(rn){vn.messages.some(function(ai){return 11006!=zo(ai.meta[1][0].data)&&function Oge(e,n){e:for(var t=0;t<=e.length-n.length;++t){for(var r=0;r<n.length;++r)if(e[t+r]!=n[r])continue e;return!0}return!1}(ai.data,rn[1])})&&g[rn[0]].deps.push(vn.id)})})})});for(var W,N=Mr.find(E,g[1].location),B=cd(ud(N.content)),V=0;V<B.length;++V){var X=B[V];1==X.id&&(W=X)}var le=xc(ss(W.messages[0].data)[1][0].data);for(B=cd(ud((N=Mr.find(E,g[le].location)).content)),V=0;V<B.length;++V)(X=B[V]).id==le&&(W=X);for(le=xc(ss(W.messages[0].data)[2][0].data),B=cd(ud((N=Mr.find(E,g[le].location)).content)),V=0;V<B.length;++V)(X=B[V]).id==le&&(W=X);for(le=xc(ss(W.messages[0].data)[2][0].data),B=cd(ud((N=Mr.find(E,g[le].location)).content)),V=0;V<B.length;++V)(X=B[V]).id==le&&(W=X);var oe=ss(W.messages[0].data);oe[6][0].data=ws(r.e.r+1),oe[7][0].data=ws(r.e.c+1);for(var fe=xc(oe[46][0].data),Le=Mr.find(E,g[fe].location),Ze=cd(ud(Le.content)),at=0;at<Ze.length&&Ze[at].id!=fe;++at);if(Ze[at].id!=fe)throw"Bad ColumnRowUIDMapArchive";var Ne=ss(Ze[at].messages[0].data);Ne[1]=[],Ne[2]=[],Ne[3]=[];for(var ot=0;ot<=r.e.c;++ot){var lt=[];lt[1]=lt[2]=[{type:0,data:ws(ot+420690)}],Ne[1].push({type:2,data:Tl(lt)}),Ne[2].push({type:0,data:ws(ot)}),Ne[3].push({type:0,data:ws(ot)})}Ne[4]=[],Ne[5]=[],Ne[6]=[];for(var Tt=0;Tt<=r.e.r;++Tt)(lt=[])[1]=lt[2]=[{type:0,data:ws(Tt+726270)}],Ne[4].push({type:2,data:Tl(lt)}),Ne[5].push({type:0,data:ws(Tt)}),Ne[6].push({type:0,data:ws(Tt)});Ze[at].messages[0].data=Tl(Ne),Le.content=Uw(zw(Ze)),Le.size=Le.content.length,delete oe[46];var Ot=ss(oe[4][0].data);Ot[7][0].data=ws(r.e.r+1);var un=xc(ss(Ot[1][0].data)[2][0].data);if((Ze=cd(ud((Le=Mr.find(E,g[un].location)).content)))[0].id!=un)throw"Bad HeaderStorageBucket";var Wn=ss(Ze[0].messages[0].data);for(Tt=0;Tt<l.length;++Tt){var On=ss(Wn[2][0].data);On[1][0].data=ws(Tt),On[4][0].data=ws(l[Tt].length),Wn[2][Tt]={type:Wn[2][0].type,data:Tl(On)}}Ze[0].messages[0].data=Tl(Wn),Le.content=Uw(zw(Ze)),Le.size=Le.content.length;var pr=xc(Ot[2][0].data);if((Ze=cd(ud((Le=Mr.find(E,g[pr].location)).content)))[0].id!=pr)throw"Bad HeaderStorageBucket";for(Wn=ss(Ze[0].messages[0].data),ot=0;ot<=r.e.c;++ot)(On=ss(Wn[2][0].data))[1][0].data=ws(ot),On[4][0].data=ws(r.e.r+1),Wn[2][ot]={type:Wn[2][0].type,data:Tl(On)};Ze[0].messages[0].data=Tl(Wn),Le.content=Uw(zw(Ze)),Le.size=Le.content.length;var er=xc(Ot[4][0].data);!function(){for(var Yt,rt=Mr.find(E,g[er].location),et=cd(ud(rt.content)),jn=0;jn<et.length;++jn){var vn=et[jn];vn.id==er&&(Yt=vn)}var Sn=ss(Yt.messages[0].data);Sn[3]=[];var rn=[];h.forEach(function(os,Ri){rn[1]=[{type:0,data:ws(Ri)}],rn[2]=[{type:0,data:ws(1)}],rn[3]=[{type:2,data:kge(os)}],Sn[3].push({type:2,data:Tl(rn)})}),Yt.messages[0].data=Tl(Sn);var We=Uw(zw(et));rt.content=We,rt.size=rt.content.length}();var yi=ss(Ot[3][0].data),Vn=yi[1][0];delete yi[2];var Or=ss(Vn.data),nn=xc(Or[2][0].data);!function(){for(var Yt,rt=Mr.find(E,g[nn].location),et=cd(ud(rt.content)),jn=0;jn<et.length;++jn){var vn=et[jn];vn.id==nn&&(Yt=vn)}var Sn=ss(Yt.messages[0].data);delete Sn[6],delete yi[7];var rn=new Uint8Array(Sn[5][0].data);Sn[5]=[];for(var ai=0,We=0;We<=r.e.r;++We){var os=ss(rn);ai+=Gge(os,l[We],h),os[1][0].data=ws(We),Sn[5].push({data:Tl(os),type:2})}Sn[1]=[{type:0,data:ws(r.e.c+1)}],Sn[2]=[{type:0,data:ws(r.e.r+1)}],Sn[3]=[{type:0,data:ws(ai)}],Sn[4]=[{type:0,data:ws(r.e.r+1)}],Yt.messages[0].data=Tl(Sn);var gs=Uw(zw(et));rt.content=gs,rt.size=rt.content.length}(),Vn.data=Tl(Or),Ot[3][0].data=Tl(yi),oe[4][0].data=Tl(Ot),W.messages[0].data=Tl(oe);var St=Uw(zw(B));return N.content=St,N.size=N.content.length,E}(e,n):"xlsb"==n.bookType?function Qge(e,n){Fw=1024,e&&!e.SSF&&(e.SSF=Gs(Br)),e&&e.SSF&&(Mw(),zC(e.SSF),n.revssf=sk(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF),n.rels={},n.wbrels={},n.Strings=[],n.Strings.Count=0,n.Strings.Unique=0,sS?n.revStrings=new Map:(n.revStrings={},n.revStrings.foo=[],delete n.revStrings.foo);var t="xlsb"==n.bookType?"bin":"xml",r=w7.indexOf(n.bookType)>-1,s={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};_3(n=n||{});var l=_F(),h="",g=0;if(n.cellXfs=[],P_(n.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),Ei(l,h="docProps/core.xml",xj(e.Props,n)),s.coreprops.push(h),bs(n.rels,2,h,_i.CORE_PROPS),h="docProps/app.xml",!e.Props||!e.Props.SheetNames)if(e.Workbook&&e.Workbook.Sheets){for(var x=[],E=0;E<e.SheetNames.length;++E)2!=(e.Workbook.Sheets[E]||{}).Hidden&&x.push(e.SheetNames[E]);e.Props.SheetNames=x}else e.Props.SheetNames=e.SheetNames;for(e.Props.Worksheets=e.Props.SheetNames.length,Ei(l,h,Tj(e.Props)),s.extprops.push(h),bs(n.rels,3,h,_i.EXT_PROPS),e.Custprops!==e.Props&&No(e.Custprops||{}).length>0&&(Ei(l,h="docProps/custom.xml",Ej(e.Custprops)),s.custprops.push(h),bs(n.rels,4,h,_i.CUST_PROPS)),g=1;g<=e.SheetNames.length;++g){var D={"!id":{}},O=e.Sheets[e.SheetNames[g-1]];if(Ei(l,h="xl/worksheets/sheet"+g+"."+t,Rme(g-1,h,n,e,D)),s.sheets.push(h),bs(n.wbrels,-1,"worksheets/sheet"+g+"."+t,_i.WS[0]),O){var B=O["!comments"],W=!1,V="";B&&B.length>0&&(Ei(l,V="xl/comments"+g+"."+t,Fme(B,V,n)),s.comments.push(V),bs(D,-1,"../comments"+g+"."+t,_i.CMNT),W=!0),O["!legacy"]&&W&&Ei(l,"xl/drawings/vmlDrawing"+g+".vml",v7(g,O["!comments"])),delete O["!comments"],delete O["!legacy"]}D["!id"].rId1&&Ei(l,qC(h),Pw(D))}return null!=n.Strings&&n.Strings.length>0&&(Ei(l,h="xl/sharedStrings."+t,function Nme(e,n,t){return(".bin"===n.slice(-4)?Pce:o7)(e,t)}(n.Strings,h,n)),s.strs.push(h),bs(n.wbrels,-1,"sharedStrings."+t,_i.SST)),Ei(l,h="xl/workbook."+t,function Ome(e,n,t){return(".bin"===n.slice(-4)?vme:H7)(e,t)}(e,h,n)),s.workbooks.push(h),bs(n.rels,1,h,_i.WB),Ei(l,h="xl/theme/theme1.xml",QF(e.Themes,n)),s.themes.push(h),bs(n.wbrels,-1,"theme/theme1.xml",_i.THEME),Ei(l,h="xl/styles."+t,function Pme(e,n,t){return(".bin"===n.slice(-4)?Aue:p7)(e,t)}(e,h,n)),s.styles.push(h),bs(n.wbrels,-1,"styles."+t,_i.STY),e.vbaraw&&r&&(Ei(l,h="xl/vbaProject.bin",e.vbaraw),s.vba.push(h),bs(n.wbrels,-1,"vbaProject.bin",_i.VBA)),Ei(l,h="xl/metadata."+t,function Lme(e){return(".bin"===e.slice(-4)?the:y7)()}(h)),s.metadata.push(h),bs(n.wbrels,-1,"metadata."+t,_i.XLMETA),Ei(l,"[Content_Types].xml",gj(s,n)),Ei(l,"_rels/.rels",Pw(n.rels)),Ei(l,"xl/_rels/workbook."+t+".rels",Pw(n.wbrels)),delete n.revssf,delete n.ssf,l}(e,n):function p$(e,n){Fw=1024,e&&!e.SSF&&(e.SSF=Gs(Br)),e&&e.SSF&&(Mw(),zC(e.SSF),n.revssf=sk(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF),n.rels={},n.wbrels={},n.Strings=[],n.Strings.Count=0,n.Strings.Unique=0,sS?n.revStrings=new Map:(n.revStrings={},n.revStrings.foo=[],delete n.revStrings.foo);var t="xml",r=w7.indexOf(n.bookType)>-1,s={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};_3(n=n||{});var l=_F(),h="",g=0;if(n.cellXfs=[],P_(n.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),Ei(l,h="docProps/core.xml",xj(e.Props,n)),s.coreprops.push(h),bs(n.rels,2,h,_i.CORE_PROPS),h="docProps/app.xml",!e.Props||!e.Props.SheetNames)if(e.Workbook&&e.Workbook.Sheets){for(var x=[],E=0;E<e.SheetNames.length;++E)2!=(e.Workbook.Sheets[E]||{}).Hidden&&x.push(e.SheetNames[E]);e.Props.SheetNames=x}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,Ei(l,h,Tj(e.Props)),s.extprops.push(h),bs(n.rels,3,h,_i.EXT_PROPS),e.Custprops!==e.Props&&No(e.Custprops||{}).length>0&&(Ei(l,h="docProps/custom.xml",Ej(e.Custprops)),s.custprops.push(h),bs(n.rels,4,h,_i.CUST_PROPS));var D=["SheetJ5"];for(n.tcid=0,g=1;g<=e.SheetNames.length;++g){var O={"!id":{}},N=e.Sheets[e.SheetNames[g-1]];if(Ei(l,h="xl/worksheets/sheet"+g+"."+t,F7(g-1,n,e,O)),s.sheets.push(h),bs(n.wbrels,-1,"worksheets/sheet"+g+"."+t,_i.WS[0]),N){var W=N["!comments"],V=!1,X="";if(W&&W.length>0){var le=!1;W.forEach(function(oe){oe[1].forEach(function(fe){1==fe.T&&(le=!0)})}),le&&(Ei(l,X="xl/threadedComments/threadedComment"+g+"."+t,uhe(W,D,n)),s.threadedcomments.push(X),bs(O,-1,"../threadedComments/threadedComment"+g+"."+t,_i.TCMNT)),Ei(l,X="xl/comments"+g+"."+t,b7(W)),s.comments.push(X),bs(O,-1,"../comments"+g+"."+t,_i.CMNT),V=!0}N["!legacy"]&&V&&Ei(l,"xl/drawings/vmlDrawing"+g+".vml",v7(g,N["!comments"])),delete N["!comments"],delete N["!legacy"]}O["!id"].rId1&&Ei(l,qC(h),Pw(O))}return null!=n.Strings&&n.Strings.length>0&&(Ei(l,h="xl/sharedStrings."+t,o7(n.Strings,n)),s.strs.push(h),bs(n.wbrels,-1,"sharedStrings."+t,_i.SST)),Ei(l,h="xl/workbook."+t,H7(e)),s.workbooks.push(h),bs(n.rels,1,h,_i.WB),Ei(l,h="xl/theme/theme1.xml",QF(e.Themes,n)),s.themes.push(h),bs(n.wbrels,-1,"theme/theme1.xml",_i.THEME),Ei(l,h="xl/styles."+t,p7(e,n)),s.styles.push(h),bs(n.wbrels,-1,"styles."+t,_i.STY),e.vbaraw&&r&&(Ei(l,h="xl/vbaProject.bin",e.vbaraw),s.vba.push(h),bs(n.wbrels,-1,"vbaProject.bin",_i.VBA)),Ei(l,h="xl/metadata."+t,y7()),s.metadata.push(h),bs(n.wbrels,-1,"metadata."+t,_i.XLMETA),D.length>1&&(Ei(l,h="xl/persons/person.xml",function dhe(e){var n=[Lo,Rn("personList",null,{xmlns:Ta.TCMNT,"xmlns:x":A_[0]}).replace(/[\/]>/,">")];return e.forEach(function(t,r){n.push(Rn("person",null,{displayName:t,id:"{54EE7950-7262-4200-6969-"+("000000000000"+r).slice(-12)+"}",userId:t,providerId:"None"}))}),n.push("</personList>"),n.join("")}(D)),s.people.push(h),bs(n.wbrels,-1,"persons/person.xml",_i.PEOPLE)),Ei(l,"[Content_Types].xml",gj(s,n)),Ei(l,"_rels/.rels",Pw(n.rels)),Ei(l,"xl/_rels/workbook.xml.rels",Pw(n.wbrels)),delete n.revssf,delete n.ssf,l}(e,n)}function g$(e,n){switch(n.type){case"base64":case"binary":break;case"buffer":case"array":n.type="";break;case"file":return UC(n.file,Mr.write(e,{type:Oi?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+n.bookType+"' files");default:throw new Error("Unrecognized type "+n.type)}return Mr.write(e,n)}function rm(e,n,t){t||(t="");var r=t+e;switch(n.type){case"base64":return NC(Qp(r));case"binary":return Qp(r);case"string":return e;case"file":return UC(n.file,r,"utf8");case"buffer":return Oi?Tg(r,"utf8"):typeof TextEncoder<"u"?(new TextEncoder).encode(r):rm(r,{type:"binary"}).split("").map(function(s){return s.charCodeAt(0)})}throw new Error("Unrecognized type "+n.type)}function Ik(e,n){switch(n.type){case"string":case"base64":case"binary":for(var t="",r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return"base64"==n.type?NC(t):"string"==n.type?oo(t):t;case"file":return UC(n.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+n.type)}}function kk(e,n){(function QI(){id(1200),function Mse(){JI(1252)}()})(),function $7(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");!function sme(e,n,t){e.forEach(function(r,s){j7(r);for(var l=0;l<s;++l)if(r==e[l])throw new Error("Duplicate Sheet Name: "+r);if(t){var h=n&&n[s]&&n[s].CodeName||r;if(95==h.charCodeAt(0)&&h.length>22)throw new Error("Bad Code Name: Worksheet"+h)}})}(e.SheetNames,e.Workbook&&e.Workbook.Sheets||[],!!e.vbaraw);for(var t=0;t<e.SheetNames.length;++t)tfe(e.Sheets[e.SheetNames[t]],0,t)}(e);var t=Gs(n||{});if(t.cellStyles&&(t.cellNF=!0,t.sheetStubs=!0),"array"==t.type){t.type="binary";var r=kk(e,t);return t.type="array",FC(r)}var s=0;if(t.sheet&&(s="number"==typeof t.sheet?t.sheet:e.SheetNames.indexOf(t.sheet),!e.SheetNames[s]))throw new Error("Sheet not found: "+t.sheet+" : "+typeof t.sheet);switch(t.bookType||"xlsb"){case"xml":case"xlml":return rm(nge(e,t),t);case"slk":case"sylk":return rm(n7.from_sheet(e.Sheets[e.SheetNames[s]],t),t);case"htm":case"html":return rm(t$(e.Sheets[e.SheetNames[s]],t),t);case"txt":return function l0e(e,n){switch(n.type){case"base64":return NC(e);case"binary":case"string":return e;case"file":return UC(n.file,e,"binary");case"buffer":return Oi?Tg(e,"binary"):e.split("").map(function(t){return t.charCodeAt(0)})}throw new Error("Unrecognized type "+n.type)}(w$(e.Sheets[e.SheetNames[s]],t),t);case"csv":return rm(w3(e.Sheets[e.SheetNames[s]],t),t,"\ufeff");case"dif":return rm(r7.from_sheet(e.Sheets[e.SheetNames[s]],t),t);case"dbf":return Ik(ZF.from_sheet(e.Sheets[e.SheetNames[s]],t),t);case"prn":return rm(Nw.from_sheet(e.Sheets[e.SheetNames[s]],t),t);case"rtf":return rm(h7.from_sheet(e.Sheets[e.SheetNames[s]],t),t);case"eth":return rm(i7.from_sheet(e.Sheets[e.SheetNames[s]],t),t);case"fods":return rm(u$(e,t),t);case"wk1":return Ik(dv.sheet_to_wk1(e.Sheets[e.SheetNames[s]],t),t);case"wk3":return Ik(dv.book_to_wk3(e,t),t);case"biff2":t.biff||(t.biff=2);case"biff3":t.biff||(t.biff=3);case"biff4":return t.biff||(t.biff=4),Ik(X7(e,t),t);case"biff5":t.biff||(t.biff=5);case"biff8":case"xla":case"xls":return t.biff||(t.biff=8),function a0e(e,n){var t=n||{};return g$(function cge(e,n){var t=n||{},r=Mr.utils.cfb_new({root:"R"}),s="/Workbook";switch(t.bookType||"xls"){case"xls":t.bookType="biff8";case"xla":t.bookType||(t.bookType="xla");case"biff8":s="/Workbook",t.biff=8;break;case"biff5":s="/Book",t.biff=5;break;default:throw new Error("invalid type "+t.bookType+" for XLS CFB")}return Mr.utils.cfb_add(r,s,X7(e,t)),8==t.biff&&(e.Props||e.Custprops)&&function lge(e,n){var h,t=[],r=[],s=[],l=0,g=SV(BF,"n"),x=SV(zF,"n");if(e.Props)for(h=No(e.Props),l=0;l<h.length;++l)(Object.prototype.hasOwnProperty.call(g,h[l])?t:Object.prototype.hasOwnProperty.call(x,h[l])?r:s).push([h[l],e.Props[h[l]]]);if(e.Custprops)for(h=No(e.Custprops),l=0;l<h.length;++l)Object.prototype.hasOwnProperty.call(e.Props||{},h[l])||(Object.prototype.hasOwnProperty.call(g,h[l])?t:Object.prototype.hasOwnProperty.call(x,h[l])?r:s).push([h[l],e.Custprops[h[l]]]);var E=[];for(l=0;l<s.length;++l)Oj.indexOf(s[l][0])>-1||bj.indexOf(s[l][0])>-1||null!=s[l][1]&&E.push(s[l]);r.length&&Mr.utils.cfb_add(n,"/\x05SummaryInformation",Nj(r,aS.SI,x,zF)),(t.length||E.length)&&Mr.utils.cfb_add(n,"/\x05DocumentSummaryInformation",Nj(t,aS.DSI,g,BF,E.length?E:null,aS.UDI))}(e,r),8==t.biff&&e.vbaraw&&function bhe(e,n){n.FullPaths.forEach(function(t,r){if(0!=r){var s=t.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");"/"!==s.slice(-1)&&Mr.utils.cfb_add(e,s,n.FileIndex[r].content)}})}(r,Mr.read(e.vbaraw,{type:"string"==typeof e.vbaraw?"binary":"buffer"})),r}(e,t),t)}(e,t);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return function s0e(e,n){var t=Gs(n||{});return function _$(e,n){var t={},r=Oi?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(n.compression&&(t.compression="DEFLATE"),n.password)t.type=r;else switch(n.type){case"base64":t.type="base64";break;case"binary":t.type="string";break;case"string":throw new Error("'string' output type invalid for '"+n.bookType+"' files");case"buffer":case"file":t.type=r;break;default:throw new Error("Unrecognized type "+n.type)}var s=e.FullPaths?Mr.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[t.type]||t.type,compression:!!n.compression}):e.generate(t);if(typeof Deno<"u"&&"string"==typeof s){if("binary"==n.type||"base64"==n.type)return s;s=new Uint8Array(FC(s))}return n.password&&typeof encrypt_agile<"u"?g$(encrypt_agile(s,n.password),n):"file"===n.type?UC(n.file,s):"string"==n.type?oo(s):s}(Jge(e,t),t)}(e,t);default:throw new Error("Unrecognized bookType |"+t.bookType+"|")}}function v$(e,n,t,r,s,l,h,g){var x=Bo(t),E=g.defval,D=g.raw||!Object.prototype.hasOwnProperty.call(g,"raw"),O=!0,N=1===s?[]:{};if(1!==s)if(Object.defineProperty)try{Object.defineProperty(N,"__rowNum__",{value:t,enumerable:!1})}catch{N.__rowNum__=t}else N.__rowNum__=t;if(!h||e[t])for(var B=n.s.c;B<=n.e.c;++B){var W=h?e[t][B]:e[r[B]+x];if(void 0!==W&&void 0!==W.t){var V=W.v;switch(W.t){case"z":if(null==V)break;continue;case"e":V=0==V?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+W.t)}if(null!=l[B]){if(null==V)if("e"==W.t&&null===V)N[l[B]]=null;else if(void 0!==E)N[l[B]]=E;else{if(!D||null!==V)continue;N[l[B]]=null}else N[l[B]]=D&&("n"!==W.t||"n"===W.t&&!1!==g.rawNumbers)?V:em(W,V,g);null!=V&&(O=!1)}}else{if(void 0===E)continue;null!=l[B]&&(N[l[B]]=E)}}return{row:N,isempty:O}}function Ok(e,n){if(null==e||null==e["!ref"])return[];var t={t:"n",v:0},r=0,s=1,l=[],h=0,g="",x={s:{r:0,c:0},e:{r:0,c:0}},E=n||{},D=null!=E.range?E.range:e["!ref"];switch(1===E.header?r=1:"A"===E.header?r=2:Array.isArray(E.header)?r=3:null==E.header&&(r=0),typeof D){case"string":x=Zi(D);break;case"number":(x=Zi(e["!ref"])).s.r=D;break;default:x=D}r>0&&(s=0);var O=Bo(x.s.r),N=[],B=[],W=0,V=0,X=Array.isArray(e),le=x.s.r,oe=0,fe={};X&&!e[le]&&(e[le]=[]);var Le=E.skipHidden&&e["!cols"]||[],Ze=E.skipHidden&&e["!rows"]||[];for(oe=x.s.c;oe<=x.e.c;++oe)if(!(Le[oe]||{}).hidden)switch(N[oe]=ao(oe),t=X?e[le][oe]:e[N[oe]+O],r){case 1:l[oe]=oe-x.s.c;break;case 2:l[oe]=N[oe];break;case 3:l[oe]=E.header[oe-x.s.c];break;default:if(null==t&&(t={w:"__EMPTY",t:"s"}),g=h=em(t,null,E),V=fe[h]||0){do{g=h+"_"+V++}while(fe[g]);fe[h]=V,fe[g]=1}else fe[h]=1;l[oe]=g}for(le=x.s.r+s;le<=x.e.r;++le)if(!(Ze[le]||{}).hidden){var at=v$(e,x,le,N,r,l,X,E);(!1===at.isempty||(1===r?!1!==E.blankrows:E.blankrows))&&(B[W++]=at.row)}return B.length=W,B}var x$=/"/g;function b$(e,n,t,r,s,l,h,g){for(var x=!0,E=[],D="",O=Bo(t),N=n.s.c;N<=n.e.c;++N)if(r[N]){var B=g.dense?(e[t]||[])[N]:e[r[N]+O];if(null==B)D="";else if(null!=B.v){x=!1,D=""+(g.rawNumbers&&"n"==B.t?B.v:em(B,null,g));for(var W=0,V=0;W!==D.length;++W)if((V=D.charCodeAt(W))===s||V===l||34===V||g.forceQuotes){D='"'+D.replace(x$,'""')+'"';break}"ID"==D&&(D='"ID"')}else null==B.f||B.F?D="":(x=!1,(D="="+B.f).indexOf(",")>=0&&(D='"'+D.replace(x$,'""')+'"'));E.push(D)}return!1===g.blankrows&&x?null:E.join(h)}function w3(e,n){var t=[],r=n??{};if(null==e||null==e["!ref"])return"";var s=Zi(e["!ref"]),l=void 0!==r.FS?r.FS:",",h=l.charCodeAt(0),g=void 0!==r.RS?r.RS:"\n",x=g.charCodeAt(0),E=new RegExp(("|"==l?"\\|":l)+"+$"),D="",O=[];r.dense=Array.isArray(e);for(var N=r.skipHidden&&e["!cols"]||[],B=r.skipHidden&&e["!rows"]||[],W=s.s.c;W<=s.e.c;++W)(N[W]||{}).hidden||(O[W]=ao(W));for(var V=0,X=s.s.r;X<=s.e.r;++X)(B[X]||{}).hidden||null!=(D=b$(e,s,X,O,h,x,l,r))&&(r.strip&&(D=D.replace(E,"")),(D||!1!==r.blankrows)&&t.push((V++?g:"")+D));return delete r.dense,t.join("")}function w$(e,n){n||(n={}),n.FS="\t",n.RS="\n";var t=w3(e,n);return typeof Ji>"u"||"string"==n.type?t:"\xff\xfe"+Ji.utils.encode(1200,t,"str")}function T$(e,n,t){var r=t||{},s=+!r.skipHeader,l=e||{},h=0,g=0;if(l&&null!=r.origin)if("number"==typeof r.origin)h=r.origin;else{var x="string"==typeof r.origin?na(r.origin):r.origin;h=x.r,g=x.c}var E,D={s:{c:0,r:0},e:{c:g,r:h+n.length-1+s}};if(l["!ref"]){var O=Zi(l["!ref"]);D.e.c=Math.max(D.e.c,O.e.c),D.e.r=Math.max(D.e.r,O.e.r),-1==h&&(D.e.r=(h=O.e.r+1)+n.length-1+s)}else-1==h&&(h=0,D.e.r=n.length-1+s);var N=r.header||[],B=0;n.forEach(function(V,X){No(V).forEach(function(le){-1==(B=N.indexOf(le))&&(N[B=N.length]=le);var oe=V[le],fe="z",Le="",Ze=Zr({c:g+B,r:h+X+s});E=hS(l,Ze),!oe||"object"!=typeof oe||oe instanceof Date?("number"==typeof oe?fe="n":"boolean"==typeof oe?fe="b":"string"==typeof oe?fe="s":oe instanceof Date?(fe="d",r.cellDates||(fe="n",oe=vl(oe)),Le=r.dateNF||Br[14]):null===oe&&r.nullError&&(fe="e",oe=0),E?(E.t=fe,E.v=oe,delete E.w,delete E.R,Le&&(E.z=Le)):l[Ze]=E={t:fe,v:oe},Le&&(E.z=Le)):l[Ze]=oe})}),D.e.c=Math.max(D.e.c,g+N.length-1);var W=Bo(h);if(s)for(B=0;B<N.length;++B)l[ao(B+g)+W]={t:"s",v:N[B]};return l["!ref"]=gi(D),l}function hS(e,n,t){if("string"==typeof n){if(Array.isArray(e)){var r=na(n);return e[r.r]||(e[r.r]=[]),e[r.r][r.c]||(e[r.r][r.c]={t:"z"})}return e[n]||(e[n]={t:"z"})}return hS(e,Zr("number"!=typeof n?n:{r:n,c:t||0}))}var _0e_json_to_sheet=function u0e(e,n){return T$(null,e,n)},w0e=Sl(578);let C$=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getPurchases(){return this.http.get(this.baseUrl+"api/purchase/purchases")}getPurchase(t){return this.http.get(this.baseUrl+"api/purchase/purchase/"+t)}updatePurchase(t){return this.http.put(`${this.baseUrl}/${t._id}`,t)}deletePurchase(t){return this.http.delete(this.baseUrl+"api/purchase/purchase/"+t)}createPurchase(t){return this.http.get(this.baseUrl+"api/purchase/create/"+t)}updatePrice(t){return this.http.post(`${this.baseUrl}api/purchase/update_price`,t)}getReport(t){return`${this.baseUrl}api/purchase/purchase/report/${t}`}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function T0e(e,n){if(1&e&&(ee(0,"div",28),xe(1),Xn(2,"button",29),te()),2&e){const t=Bt();Te(),dl(" ",t.messagePurchase," ")}}function E0e(e,n){if(1&e){const t=Wi();ee(0,"tr")(1,"td",30),on("click",function(){const s=Mn(t).$implicit;return An(Bt().navigateToPurchase(s.purchase_number))}),xe(2),te(),ee(3,"td",30),on("click",function(){const s=Mn(t).$implicit;return An(Bt().navigateToPurchase(s.purchase_number))}),xe(4),te(),ee(5,"td",30),on("click",function(){const s=Mn(t).$implicit;return An(Bt().navigateToPurchase(s.purchase_number))}),xe(6),te(),ee(7,"td",30),on("click",function(){const s=Mn(t).$implicit;return An(Bt().navigateToPurchase(s.purchase_number))}),xe(8),te(),ee(9,"td",30),on("click",function(){const s=Mn(t).$implicit;return An(Bt().navigateToPurchase(s.purchase_number))}),xe(10),SA(11,"currency"),te(),ee(12,"td")(13,"div",31)(14,"div",4)(15,"span",32),on("click",function(){const s=Mn(t).$implicit;return An(Bt().openPdfModal(s.purchase_number))}),Xn(16,"i",33),te()(),ee(17,"div",4)(18,"span",34),on("click",function(){const s=Mn(t).$implicit;return An(Bt().delete_purchase(s.purchase_number))}),Xn(19,"i",35),te()(),ee(20,"div",4)(21,"span",34),on("click",function(){const s=Mn(t).$implicit;return An(Bt().downloadExcel(s))}),Xn(22,"i",36),te()()()()()}if(2&e){const t=n.$implicit,r=Bt();Te(2),kn(t.purchase_number),Te(2),kn(t.date),Te(2),kn(t.products.length),Te(2),dl(" ",r.calculateRegisteredPercentage(t.products),"% "),Te(2),dl(" ",JR(11,5,r.calculateGMV(t.products),"USD")," ")}}let C0e=(()=>{class e{constructor(t,r,s){this.purchaseService=t,this.router=r,this.sanitizer=s,this.purchases=[],this.filteredPurchases=[],this.searchText="",this.fechaNewOrder="",this.messagePurchase="",this.statusCodePurchase=""}ngOnInit(){this.getPurchases()}navigateToPurchase(t){this.router.navigate(["/purchase",t])}filterPurchases(){this.filteredPurchases=""!==this.searchText.trim()?this.purchases.filter(t=>t.purchase_number.toLowerCase().includes(this.searchText.toLowerCase())):this.purchases}newPurchase(){this.purchaseService.createPurchase(this.fechaNewOrder).subscribe(t=>{this.getPurchases(),this.messagePurchase="Orden de compra creada exitosamente!",this.statusCodePurchase=t.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},t=>{this.messagePurchase="Fallo al crear la Orden de compra.",this.statusCodePurchase=t.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)})}getPurchases(){this.purchaseService.getPurchases().subscribe(t=>{this.purchases=t})}openPdfModal(t){this.pdfData=this.sanitizer.bypassSecurityTrustResourceUrl(this.purchaseService.getReport(t))}delete_purchase(t){this.purchaseService.deletePurchase(t).subscribe(r=>{this.getPurchases(),this.messagePurchase="Orden de compra eliminada exitosamente!",this.statusCodePurchase=r.statusCode||"200",setTimeout(()=>{this.messagePurchase=""},3e3)},r=>{this.messagePurchase="Fallo al eliminar la Orden de compra.",this.statusCodePurchase=r.status||"500",setTimeout(()=>{this.messagePurchase=""},3e3)})}calculateRegisteredPercentage(t){if(0===t.length)return 0;const r=t.filter(s=>"Registrado"===s.status).length;return Math.round(r/t.length*100)}calculateGMV(t){return t.reduce((r,s)=>r+(s.price_purchase||0)*(s.total_quantity_ordered||0),0)}downloadExcel(t){const l=t.products.map(O=>({SKU:O.sku,Nombre:O.name,Categor\u00eda:O.category,Precio_Sugerido:O.price_purchase,Precio_Real:O.final_price_purchase,Cantidad:O.total_quantity_ordered,Total_Sugerido:O.price_purchase*O.total_quantity_ordered,Total_Real:O.final_price_purchase*O.total_quantity_ordered,status:O.status})),x=kk({Sheets:{Productos:_0e_json_to_sheet(l)},SheetNames:["Productos"]},{bookType:"xlsx",type:"array"}),E=new Blob([x],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});w0e.saveAs(E,`Compra_${t.purchase_number}.xlsx`)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(C$),xt(ba),xt(nC))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-purchases"]],decls:53,vars:5,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-6"],["type","text","placeholder","Buscar compra...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#newPurchase","data-bs-dismiss","modal",1,"btn","btn-primary"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","newPurchase","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","newPurchase",1,"modal-title"],[1,"modal-body"],[1,"container"],[1,"form-group"],["for","fecha"],["type","date","id","fecha","name","fecha",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],["id","pdfModal","tabindex","-1","role","dialog","aria-labelledby","pdfModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-lg"],["id","pdfModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["type","application/pdf","width","100%","height","600px",3,"src"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[3,"click"],[1,"row"],["data-bs-toggle","modal","data-bs-target","#pdfModal","data-bs-dismiss","modal",2,"cursor","pointer",3,"click"],[1,"fas","fa-file-pdf","fa-lg","text-primary"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-trash","fa-lg","text-danger"],[1,"fas","fa-file-excel","fa-lg","text-success"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),Tn("ngModelChange",function(h){return En(s.searchText,h)||(s.searchText=h),h}),on("keyup",function(){return s.filterPurchases()}),te()(),ee(4,"div",4)(5,"button",5),xe(6,"Nueva compra"),te()()(),Cn(7,T0e,3,1,"div",6),ee(8,"table",7)(9,"thead")(10,"tr")(11,"th"),xe(12,"N\xfamero de Compra"),te(),ee(13,"th"),xe(14,"Fecha"),te(),ee(15,"th"),xe(16,"Cantidad SKU"),te(),ee(17,"th"),xe(18,"Porcentaje Registrado"),te(),ee(19,"th"),xe(20,"GMV"),te(),ee(21,"th"),xe(22,"Acciones"),te()()(),ee(23,"tbody"),Cn(24,E0e,23,8,"tr",8),te()()(),ee(25,"div",9)(26,"div",10)(27,"div",11)(28,"div",12)(29,"h5",13),xe(30,"Nueva compra"),te()(),ee(31,"div",14)(32,"div",15)(33,"div",16)(34,"label",17),xe(35,"Fecha:"),te(),ee(36,"input",18),Tn("ngModelChange",function(h){return En(s.fechaNewOrder,h)||(s.fechaNewOrder=h),h}),te()(),Xn(37,"br"),ee(38,"div",19)(39,"button",20),on("click",function(){return s.newPurchase()}),xe(40,"Nueva Orden de compra"),te()()()()()()(),ee(41,"div",21)(42,"div",22)(43,"div",11)(44,"div",12)(45,"h5",23),xe(46,"Orden de compra"),te(),Xn(47,"button",24),te(),ee(48,"div",14),Xn(49,"iframe",25),te(),ee(50,"div",26)(51,"button",27),xe(52,"Cerrar"),te()()()()()),2&r&&(Te(3),wn("ngModel",s.searchText),Te(4),Zt("ngIf",s.messagePurchase),Te(17),Zt("ngForOf",s.purchases),Te(12),wn("ngModel",s.fechaNewOrder),Te(13),Zt("src",s.pdfData,Kd))},dependencies:[$p,uu,Za,ql,_l,LP]})}return e})();const{isArray:I0e}=Array;function S$(e){return 1===e.length&&I0e(e[0])?e[0]:e}function C3(...e){const n=sI(e),t=S$(e);return t.length?new $i(r=>{let s=t.map(()=>[]),l=t.map(()=>!1);r.add(()=>{s=l=null});for(let h=0;!r.closed&&h<t.length;h++)pl(t[h]).subscribe(Me(r,g=>{if(s[h].push(g),s.every(x=>x.length)){const x=s.map(E=>E.shift());r.next(n?n(...x):x),s.some((E,D)=>!E.length&&l[D])&&r.complete()}},()=>{l[h]=!0,!s[h].length&&r.complete()}));return()=>{s=l=null}}):qu}function S3(...e){const n=sI(e);return ys((t,r)=>{const s=e.length,l=new Array(s);let h=e.map(()=>!1),g=!1;for(let x=0;x<s;x++)pl(e[x]).subscribe(Me(r,E=>{l[x]=E,!g&&!h[x]&&(h[x]=!0,(g=h.every(tl))&&(h=null))},ji));t.subscribe(Me(r,x=>{if(g){const E=[x,...l];r.next(n?n(...E):E)}}))})}Math,Math,Math;const V_e=["*"],_1e=["dialog"],W$={animation:!0,transitionTimerDelayMs:5};let Bk=(()=>{class e{constructor(){this.animation=W$.animation}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Gw(e){return"string"==typeof e}function _v(e){return null!=e}function Ww(e){return(e||document.body).getBoundingClientRect()}const uye=()=>{},{transitionTimerDelayMs:hye}=W$,yS=new Map,fd=(e,n,t,r)=>{let s=r.context||{};const l=yS.get(n);if(l)switch(r.runningTransition){case"continue":return qu;case"stop":e.run(()=>l.transition$.complete()),s=Object.assign(l.context,s),yS.delete(n)}const h=t(n,r.animation,s)||uye;if(!r.animation||"none"===window.getComputedStyle(n).transitionProperty)return e.run(()=>h()),Lr(void 0).pipe(function cye(e){return n=>new $i(t=>n.subscribe({next:h=>e.run(()=>t.next(h)),error:h=>e.run(()=>t.error(h)),complete:()=>e.run(()=>t.complete())}))}(e));const g=new Ii,x=new Ii,E=g.pipe(function O0e(...e){return n=>aC(n,Lr(...e))}(!0));yS.set(n,{transition$:g,complete:()=>{x.next(),x.complete()},context:s});const D=function oye(e){const{transitionDelay:n,transitionDuration:t}=window.getComputedStyle(e);return 1e3*(parseFloat(n)+parseFloat(t))}(n);return e.runOutsideAngular(()=>{const O=ta(n,"transitionend").pipe(wo(E),xa(({target:B})=>B===n));(function D$(...e){return 1===(e=S$(e)).length?pl(e[0]):new $i(function k0e(e){return n=>{let t=[];for(let r=0;t&&!n.closed&&r<e.length;r++)t.push(pl(e[r]).subscribe(Me(n,s=>{if(t){for(let l=0;l<t.length;l++)l!==r&&t[l].unsubscribe();t=null}n.next(s)})))}}(e))})(aF(D+hye).pipe(wo(E)),O,x).pipe(wo(E)).subscribe(()=>{yS.delete(n),e.run(()=>{h(),g.next(),g.complete()})})}),g.asObservable()};let Q$=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),e9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),r9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),i9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})();typeof navigator<"u"&&navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));const h9=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function d9(e){const n=Array.from(e.querySelectorAll(h9)).filter(t=>-1!==t.tabIndex);return[n[0],n[n.length-1]]}new Date(1882,10,12),new Date(2174,10,25);let M9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),I9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),pve=(()=>{class e{constructor(){this._ngbConfig=Xe(Bk),this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0}get animation(){return this._animation??this._ngbConfig.animation}set animation(t){this._animation=t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class wv{constructor(n,t,r){this.nodes=n,this.viewRef=t,this.componentRef=r}}let mve=(()=>{class e{constructor(){this._document=Xe(bo)}hide(){const t=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),r=this._document.body,s=r.style,{overflow:l,paddingRight:h}=s;if(t>0){const g=parseFloat(window.getComputedStyle(r).paddingRight);s.paddingRight=`${g+t}px`}return s.overflow="hidden",()=>{t>0&&(s.paddingRight=h),s.overflow=l}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),gve=(()=>{class e{constructor(){this._nativeElement=Xe(Di).nativeElement,this._zone=Xe(Qr)}ngOnInit(){this._zone.onStable.asObservable().pipe(hc(1)).subscribe(()=>{fd(this._zone,this._nativeElement,(t,r)=>{r&&Ww(t),t.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return fd(this._zone,this._nativeElement,({classList:t})=>t.remove("show"),{animation:this.animation,runningTransition:"stop"})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=ki({type:e,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(r,s){2&r&&(I2("modal-backdrop"+(s.backdropClass?" "+s.backdropClass:"")),Ki("show",!s.animation)("fade",s.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},standalone:!0,features:[cf],decls:0,vars:0,template:function(r,s){},encapsulation:2})}return e})();class k9{update(n){}close(n){}dismiss(n){}}const _ve=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","scrollable","size","windowClass","modalDialogClass"],yve=["animation","backdropClass"];class vve{_applyWindowOptions(n,t){_ve.forEach(r=>{_v(t[r])&&(n[r]=t[r])})}_applyBackdropOptions(n,t){yve.forEach(r=>{_v(t[r])&&(n[r]=t[r])})}update(n){this._applyWindowOptions(this._windowCmptRef.instance,n),this._backdropCmptRef&&this._backdropCmptRef.instance&&this._applyBackdropOptions(this._backdropCmptRef.instance,n)}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(wo(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(wo(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}constructor(n,t,r,s){this._windowCmptRef=n,this._contentRef=t,this._backdropCmptRef=r,this._beforeDismiss=s,this._closed=new Ii,this._dismissed=new Ii,this._hidden=new Ii,n.instance.dismissEvent.subscribe(l=>{this.dismiss(l)}),this.result=new Promise((l,h)=>{this._resolve=l,this._reject=h}),this.result.then(null,()=>{})}close(n){this._windowCmptRef&&(this._closed.next(n),this._resolve(n),this._removeModalElements())}_dismiss(n){this._dismissed.next(n),this._reject(n),this._removeModalElements()}dismiss(n){if(this._windowCmptRef)if(this._beforeDismiss){const t=this._beforeDismiss();!function q$(e){return e&&e.then}(t)?!1!==t&&this._dismiss(n):t.then(r=>{!1!==r&&this._dismiss(n)},()=>{})}else this._dismiss(n)}_removeModalElements(){const n=this._windowCmptRef.instance.hide(),t=this._backdropCmptRef?this._backdropCmptRef.instance.hide():Lr(void 0);n.subscribe(()=>{const{nativeElement:r}=this._windowCmptRef.location;r.parentNode.removeChild(r),this._windowCmptRef.destroy(),this._contentRef?.viewRef?.destroy(),this._windowCmptRef=null,this._contentRef=null}),t.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:r}=this._backdropCmptRef.location;r.parentNode.removeChild(r),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),C3(n,t).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var K3=function(e){return e[e.BACKDROP_CLICK=0]="BACKDROP_CLICK",e[e.ESC=1]="ESC",e}(K3||{});let xve=(()=>{class e{constructor(){this._document=Xe(bo),this._elRef=Xe(Di),this._zone=Xe(Qr),this._closed$=new Ii,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new ir,this.shown=new Ii,this.hidden=new Ii}get fullscreenClass(){return!0===this.fullscreen?" modal-fullscreen":Gw(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(t){this.dismissEvent.emit(t)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe(hc(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:t}=this._elRef,r={animation:this.animation,runningTransition:"stop"},h=C3(fd(this._zone,t,()=>t.classList.remove("show"),r),fd(this._zone,this._dialogEl.nativeElement,()=>{},r));return h.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),h}_show(){const t={animation:this.animation,runningTransition:"continue"};C3(fd(this._zone,this._elRef.nativeElement,(l,h)=>{h&&Ww(l),l.classList.add("show")},t),fd(this._zone,this._dialogEl.nativeElement,()=>{},t)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:t}=this._elRef;this._zone.runOutsideAngular(()=>{ta(t,"keydown").pipe(wo(this._closed$),xa(s=>"Escape"===s.key)).subscribe(s=>{this.keyboard?requestAnimationFrame(()=>{s.defaultPrevented||this._zone.run(()=>this.dismiss(K3.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let r=!1;ta(this._dialogEl.nativeElement,"mousedown").pipe(wo(this._closed$),gl(()=>r=!1),rd(()=>ta(t,"mouseup").pipe(wo(this._closed$),hc(1))),xa(({target:s})=>t===s)).subscribe(()=>{r=!0}),ta(t,"click").pipe(wo(this._closed$)).subscribe(({target:s})=>{t===s&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!r&&this._zone.run(()=>this.dismiss(K3.BACKDROP_CLICK))),r=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:t}=this._elRef;if(!t.contains(document.activeElement)){const r=t.querySelector("[ngbAutofocus]"),s=d9(t)[0];(r||s||t).focus()}}_restoreFocus(){const t=this._document.body,r=this._elWithFocus;let s;s=r&&r.focus&&t.contains(r)?r:t,this._zone.runOutsideAngular(()=>{setTimeout(()=>s.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&fd(this._zone,this._elRef.nativeElement,({classList:t})=>(t.add("modal-static"),()=>t.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=ki({type:e,selectors:[["ngb-modal-window"]],viewQuery:function(r,s){if(1&r&&Gu(_1e,7),2&r){let l;di(l=fi())&&(s._dialogEl=l.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(r,s){2&r&&(ds("aria-modal",!0)("aria-labelledby",s.ariaLabelledBy)("aria-describedby",s.ariaDescribedBy),I2("modal d-block"+(s.windowClass?" "+s.windowClass:"")),Ki("fade",s.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},standalone:!0,features:[cf],ngContentSelectors:V_e,decls:4,vars:2,consts:[["dialog",""],["role","document"],[1,"modal-content"]],template:function(r,s){1&r&&(xA(),ee(0,"div",1,0)(2,"div",2),bA(3),te()()),2&r&&I2("modal-dialog"+(s.size?" modal-"+s.size:"")+(s.centered?" modal-dialog-centered":"")+s.fullscreenClass+(s.scrollable?" modal-dialog-scrollable":"")+(s.modalDialogClass?" "+s.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}\n"],encapsulation:2})}return e})(),bve=(()=>{class e{constructor(){this._applicationRef=Xe(Qh),this._injector=Xe(xs),this._environmentInjector=Xe(qo),this._document=Xe(bo),this._scrollBar=Xe(mve),this._activeWindowCmptHasChanged=new Ii,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._modalRefs=[],this._windowCmpts=[],this._activeInstances=new ir;const t=Xe(Qr);this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const r=this._windowCmpts[this._windowCmpts.length-1];((e,n,t,r=!1)=>{e.runOutsideAngular(()=>{const s=ta(n,"focusin").pipe(wo(t),J(l=>l.target));ta(n,"keydown").pipe(wo(t),xa(l=>"Tab"===l.key),S3(s)).subscribe(([l,h])=>{const[g,x]=d9(n);(h===g||h===n)&&l.shiftKey&&(x.focus(),l.preventDefault()),h===x&&!l.shiftKey&&(g.focus(),l.preventDefault())}),r&&ta(n,"click").pipe(wo(t),S3(s),J(l=>l[1])).subscribe(l=>l.focus())})})(t,r.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(r.location.nativeElement)}})}_restoreScrollBar(){const t=this._scrollBarRestoreFn;t&&(this._scrollBarRestoreFn=null,t())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(t,r,s){const l=s.container instanceof HTMLElement?s.container:_v(s.container)?this._document.querySelector(s.container):this._document.body;if(!l)throw new Error(`The specified modal container "${s.container||"body"}" was not found in the DOM.`);this._hideScrollBar();const h=new k9,g=(t=s.injector||t).get(qo,null)||this._environmentInjector,x=this._getContentRef(t,g,r,h,s);let E=!1!==s.backdrop?this._attachBackdrop(l):void 0,D=this._attachWindowComponent(l,x.nodes),O=new vve(D,x,E,s.beforeDismiss);return this._registerModalRef(O),this._registerWindowCmpt(D),O.hidden.pipe(hc(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(this._document.body.classList.remove("modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),h.close=N=>{O.close(N)},h.dismiss=N=>{O.dismiss(N)},h.update=N=>{O.update(N)},O.update(s),1===this._modalRefs.length&&this._document.body.classList.add("modal-open"),E&&E.instance&&E.changeDetectorRef.detectChanges(),D.changeDetectorRef.detectChanges(),O}get activeInstances(){return this._activeInstances}dismissAll(t){this._modalRefs.forEach(r=>r.dismiss(t))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(t){let r=wP(gve,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(r.hostView),t.appendChild(r.location.nativeElement),r}_attachWindowComponent(t,r){let s=wP(xve,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:r});return this._applicationRef.attachView(s.hostView),t.appendChild(s.location.nativeElement),s}_getContentRef(t,r,s,l,h){return s?s instanceof si?this._createFromTemplateRef(s,l):Gw(s)?this._createFromString(s):this._createFromComponent(t,r,s,l,h):new wv([])}_createFromTemplateRef(t,r){const l=t.createEmbeddedView({$implicit:r,close(h){r.close(h)},dismiss(h){r.dismiss(h)}});return this._applicationRef.attachView(l),new wv([l.rootNodes],l)}_createFromString(t){const r=this._document.createTextNode(`${t}`);return new wv([[r]])}_createFromComponent(t,r,s,l,h){const x=wP(s,{environmentInjector:r,elementInjector:xs.create({providers:[{provide:k9,useValue:l}],parent:t})}),E=x.location.nativeElement;return h.scrollable&&E.classList.add("component-host-scrollable"),this._applicationRef.attachView(x.hostView),new wv([[E]],x.hostView,x)}_setAriaHidden(t){const r=t.parentElement;r&&t!==this._document.body&&(Array.from(r.children).forEach(s=>{s!==t&&"SCRIPT"!==s.nodeName&&(this._ariaHiddenValues.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}),this._setAriaHidden(r))}_revertAriaHidden(){this._ariaHiddenValues.forEach((t,r)=>{t?r.setAttribute("aria-hidden",t):r.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(t){const r=()=>{const s=this._modalRefs.indexOf(t);s>-1&&(this._modalRefs.splice(s,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(t),this._activeInstances.emit(this._modalRefs),t.result.then(r,r)}_registerWindowCmpt(t){this._windowCmpts.push(t),this._activeWindowCmptHasChanged.next(),t.onDestroy(()=>{const r=this._windowCmpts.indexOf(t);r>-1&&(this._windowCmpts.splice(r,1),this._activeWindowCmptHasChanged.next())})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),O9=(()=>{class e{constructor(){this._injector=Xe(xs),this._modalStack=Xe(bve),this._config=Xe(pve)}open(t,r={}){const s={...this._config,animation:this._config.animation,...r};return this._modalStack.open(this._injector,t,s)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(t){this._modalStack.dismissAll(t)}hasOpenModals(){return this._modalStack.hasOpenModals()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),R9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({providers:[O9]})}return e})(),F9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),H9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),G9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),W9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),q9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),Z9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),X9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),Y9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),K9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})();new Gt("live announcer delay",{providedIn:"root",factory:()=>100});let J9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})(),Q9=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({})}return e})();const Fve=[Q$,e9,r9,i9,M9,I9,R9,F9,Q9,H9,G9,W9,q9,Z9,X9,Y9,K9,J9];let Lve=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({imports:[Fve,Q$,e9,r9,i9,M9,I9,R9,F9,Q9,H9,G9,W9,q9,Z9,X9,Y9,K9,J9]})}return e})(),eH=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}getSuppliers(){return this.http.get(`${this.baseUrl}api/supplier/suppliers`)}createSupplier(t){return this.http.post(`${this.baseUrl}api/supplier/supplier`,t)}updateSupplier(t){return this.http.put(`${this.baseUrl}api/supplier/supplier/${t._id}`,t)}deleteSupplier(t){return this.http.delete(`${this.baseUrl}api/supplier/supplier/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Bve=(e,n)=>({"table-success":e,"table-warning":n});function zve(e,n){if(1&e){const t=Wi();ee(0,"tr",7),on("click",function(){const s=Mn(t).$implicit,l=Bt(),h=Wa(13);return An(l.openEditModal(h,s))}),ee(1,"td"),xe(2),te(),ee(3,"td"),xe(4),te()()}if(2&e){const t=n.$implicit;Zt("ngClass",tw(3,Bve,"Registrado"===t.status,"Registro parcial"===t.status)),Te(2),kn(t.category.substring(0,3).toUpperCase()+" - "+t.name),Te(2),kn(t.total_quantity_ordered+" "+t.unit)}}function Uve(e,n){if(1&e&&(ee(0,"div",22),xe(1),te()),2&e){const t=Bt(2);Te(),kn(t.successMessage)}}function Vve(e,n){if(1&e&&(ee(0,"div",23),xe(1),te()),2&e){const t=Bt(2);Te(),kn(t.errorMessage)}}function jve(e,n){if(1&e&&(ee(0,"option",24),xe(1),te()),2&e){const t=n.$implicit;Zt("ngValue",t),Te(),kn(t.name)}}function $ve(e,n){if(1&e&&(ee(0,"tr")(1,"td"),xe(2),te(),ee(3,"td"),xe(4),te()()),2&e){const t=n.$implicit;Te(2),kn(t.client_name),Te(2),kn(t.quantity)}}function Hve(e,n){if(1&e&&(ee(0,"div")(1,"h6",25),xe(2,"Clientes que pidieron este producto:"),te(),ee(3,"table",4)(4,"thead")(5,"tr")(6,"th"),xe(7,"Cliente"),te(),ee(8,"th"),xe(9,"Cantidad"),te()()(),ee(10,"tbody"),Cn(11,$ve,5,2,"tr",26),te()()()),2&e){const t=Bt(2);Te(11),Zt("ngForOf",t.selectedProduct.clients)}}function Gve(e,n){if(1&e){const t=Wi();ee(0,"div",8)(1,"h5",9),xe(2),te(),ee(3,"button",10),on("click",function(){return An(Mn(t).$implicit.dismiss("Cross click"))}),te()(),ee(4,"div",11),Cn(5,Uve,2,1,"div",12)(6,Vve,2,1,"div",13),ee(7,"div")(8,"label"),xe(9,"Precio de Compra sugerido:"),te(),ee(10,"span",14),xe(11),te()(),ee(12,"div")(13,"label"),xe(14,"Precio de Compra:"),te(),ee(15,"input",15),Tn("ngModelChange",function(s){Mn(t);const l=Bt();return En(l.selectedProduct.final_price_purchase,s)||(l.selectedProduct.final_price_purchase=s),An(s)}),te()(),ee(16,"div")(17,"label"),xe(18,"Proveedor:"),te(),ee(19,"select",16),Tn("ngModelChange",function(s){Mn(t);const l=Bt();return En(l.selectedProduct.proveedor,s)||(l.selectedProduct.proveedor=s),An(s)}),Cn(20,jve,2,2,"option",17),te()(),Cn(21,Hve,12,1,"div",18),te(),ee(22,"div",19)(23,"button",20),on("click",function(){return An(Mn(t).$implicit.dismiss("Cancel"))}),xe(24,"Cancelar"),te(),ee(25,"button",21),on("click",function(){const s=Mn(t).$implicit;return Bt().savePrice(),An(s.close("Save click"))}),xe(26,"Guardar"),te()()}if(2&e){const t=Bt();Te(2),kn(t.selectedProduct.name),Te(3),Zt("ngIf",t.successMessage),Te(),Zt("ngIf",t.errorMessage),Te(5),kn(t.selectedProduct.price_purchase),Te(4),wn("ngModel",t.selectedProduct.final_price_purchase),Te(4),wn("ngModel",t.selectedProduct.proveedor),Te(),Zt("ngForOf",t.suppliers),Te(),Zt("ngIf",null==t.selectedProduct.clients?null:t.selectedProduct.clients.length)}}let Wve=(()=>{class e{constructor(t,r,s,l){this.route=t,this.purchaseService=r,this.modalService=s,this.supplierService=l,this.selectedProduct=null,this.editedPrice=null,this.purchaseNumber="",this.purchase=null,this.filteredProducts=[],this.searchTerm="",this.sortColumn="",this.sortDirection=1,this.successMessage=null,this.errorMessage=null,this.suppliers=[],this.route.params.subscribe(h=>{this.purchaseNumber=h.purchaseNumber})}ngOnInit(){this.purchaseService.getPurchase(this.purchaseNumber).subscribe(t=>{this.purchase=t,this.filteredProducts=this.purchase.products.sort((r,s)=>r.category.toLowerCase()<s.category.toLowerCase()?-1:r.category.toLowerCase()>s.category.toLowerCase()?1:0)}),this.supplierService.getSuppliers().subscribe(t=>{this.suppliers=t})}filterProducts(){this.filteredProducts=this.purchase.products.filter(t=>t.name.toLowerCase().includes(this.searchTerm.toLowerCase()))}sortBy(t){this.sortColumn===t?this.sortDirection=-this.sortDirection:(this.sortColumn=t,this.sortDirection=1),this.filteredProducts.sort((r,s)=>r[t]<s[t]?-1*this.sortDirection:r[t]>s[t]?1*this.sortDirection:0)}openEditModal(t,r){this.selectedProduct=r,this.editedPrice=0,this.modalService.open(t),this.successMessage=null,this.errorMessage=null,this.selectedProduct.proveedor&&(this.selectedProduct.proveedor=this.suppliers.find(s=>s.id===this.selectedProduct.proveedor.id))}savePrice(){let t="Creada";this.selectedProduct.final_price_purchase>0&&this.selectedProduct.proveedor?t="Registrado":(this.selectedProduct.final_price_purchase||this.selectedProduct.proveedor)&&(t="Registro parcial"),this.selectedProduct.status=t,this.purchaseService.updatePrice({sku:this.selectedProduct.sku,purchase_number:this.purchaseNumber,final_price_purchase:this.selectedProduct.final_price_purchase,proveedor:this.selectedProduct.proveedor,status:t}).subscribe(s=>{this.successMessage="Precio guardado exitosamente.",this.errorMessage=null},s=>{this.successMessage=null,this.errorMessage="Error al guardar el precio."})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(qp),xt(C$),xt(O9),xt(eH))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-purchase"]],decls:14,vars:2,consts:[["productModal",""],[1,"container-fluid","mt-5"],[1,"mb-3"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"ngModelChange","ngModel"],[1,"table"],[3,"click"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"click","ngClass"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"form-control"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-control",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[3,"ngValue"],[1,"mt-3"],[4,"ngFor","ngForOf"]],template:function(r,s){if(1&r){const l=Wi();ee(0,"div",1)(1,"div",2)(2,"input",3),Tn("ngModelChange",function(g){return Mn(l),En(s.searchTerm,g)||(s.searchTerm=g),An(g)}),on("ngModelChange",function(){return Mn(l),An(s.filterProducts())}),te()(),ee(3,"table",4)(4,"thead")(5,"tr")(6,"th",5),on("click",function(){return Mn(l),An(s.sortBy("name"))}),xe(7,"Producto"),te(),ee(8,"th",5),on("click",function(){return Mn(l),An(s.sortBy("total_quantity_ordered"))}),xe(9,"Cantidad"),te()()(),ee(10,"tbody"),Cn(11,zve,5,6,"tr",6),te()()(),Cn(12,Gve,27,8,"ng-template",null,0,fl)}2&r&&(Te(2),wn("ngModel",s.searchTerm),Te(9),Zt("ngForOf",s.filteredProducts))},dependencies:[K2,$p,uu,Xy,Yy,Za,SC,wg,ql,_l],styles:[".table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{cursor:pointer}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}"]})}return e})(),eL=(()=>{class e{constructor(t){this.http=t,this.baseUrl="https://app.buyfrescapp.com:5000/"}createAction(t){return this.http.post(`${this.baseUrl}api/action/action`,t)}getActions(){return this.http.get(`${this.baseUrl}api/action/actions`)}getAction(t){return this.http.get(`${this.baseUrl}api/action/action/${t}`)}editAction(t,r){return this.http.put(`${this.baseUrl}api/action/action/${t}`,r)}deleteAction(t){return this.http.delete(`${this.baseUrl}api/action/action/${t}`)}static#e=this.\u0275fac=function(r){return new(r||e)(Dn(Hp))};static#t=this.\u0275prov=sn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const qve=e=>({"table-success":e});function Zve(e,n){if(1&e&&(ee(0,"div",8),xe(1),Xn(2,"button",9),te()),2&e){const t=Bt();Te(),dl(" ",t.messageAction," ")}}function Xve(e,n){if(1&e){const t=Wi();ee(0,"tr",10),on("click",function(){const s=Mn(t).$implicit,l=Bt();return An("Creada"===s.status?l.navigateToaAction(s.actionNumber):l.viewAction(s))}),ee(1,"td"),xe(2),te(),ee(3,"td"),xe(4),te(),ee(5,"td"),xe(6),te()()}if(2&e){const t=n.$implicit;Zt("ngClass",uf(6,qve,"Completada"===t.status)),ds("data-bs-toggle","Creada"!==t.status?"modal":null)("data-bs-target","Creada"!==t.status?"#viewModal":null),Te(2),kn(t.dateAction),Te(2),kn(t.customer.name),Te(2),kn(t.customer.address)}}function Yve(e,n){if(1&e&&(ee(0,"div",18)(1,"label"),xe(2,"N\xfamero de Pedido:"),te(),ee(3,"p"),xe(4),te()()),2&e){const t=Bt(2);Te(4),kn(t.actionSelect.orderNumber)}}function Kve(e,n){if(1&e&&(ee(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14)(4,"h5",15),xe(5,"Detalles de la Acci\xf3n"),te(),Xn(6,"button",16),te(),ee(7,"div",17)(8,"div",18)(9,"label"),xe(10,"Fecha Ejecuci\xf3n:"),te(),ee(11,"p"),xe(12),te()(),ee(13,"div",18)(14,"label"),xe(15,"Cliente:"),te(),ee(16,"p"),xe(17),te()(),ee(18,"div",18)(19,"label"),xe(20,"Tipo de Acci\xf3n:"),te(),ee(21,"p"),xe(22),te()(),Cn(23,Yve,5,1,"div",19),ee(24,"div",18)(25,"label"),xe(26,"Manager:"),te(),ee(27,"p"),xe(28),te()(),ee(29,"div",18)(30,"label"),xe(31,"Detalle Acci\xf3n:"),te(),ee(32,"p"),xe(33),te()(),ee(34,"div",18)(35,"label"),xe(36,"Tipo Soluci\xf3n:"),te(),ee(37,"p"),xe(38),te()(),ee(39,"div",18)(40,"label"),xe(41,"Detalle Soluci\xf3n:"),te(),ee(42,"p"),xe(43),te()(),ee(44,"div",18)(45,"label"),xe(46,"Fecha Soluci\xf3n:"),te(),ee(47,"p"),xe(48),te()(),ee(49,"div",18)(50,"label"),xe(51,"Estado:"),te(),ee(52,"p"),xe(53),te()()(),ee(54,"div",20)(55,"button",21),xe(56,"Cerrar"),te()()()()()),2&e){const t=Bt();Te(12),kn(t.actionSelect.dateAction),Te(5),kn(t.actionSelect.customer.name),Te(5),kn(t.actionSelect.type.name),Te(),Zt("ngIf",t.actionSelect.orderNumber),Te(5),kn(t.actionSelect.manager),Te(5),kn(t.actionSelect.actionComment),Te(5),kn(t.actionSelect.solutionType),Te(5),kn(t.actionSelect.solutionComment),Te(5),kn(t.actionSelect.dateSolution),Te(5),kn(t.actionSelect.status)}}let Jve=(()=>{class e{constructor(t,r,s){this.actionService=t,this.router=r,this.datePipe=s,this.actions=[],this.filteredActions=[],this.searchText="",this.messageAction="",this.statusCodeAction="",this.managers=["Ferney","Cata","Diago","Saco"],this.searchDate=null,this.selectedManager=null}ngOnInit(){this.getActions(),this.selectedManager=localStorage.getItem("username"),this.filterDateManager()}navigateToaAction(t){this.router.navigate(["/edit_action",t])}filterActions(){this.filteredActions=""!==this.searchText.trim()?this.actions.filter(t=>t.purchase_number.toLowerCase().includes(this.searchText.toLowerCase())):this.actions}filterDateManager(){this.selectedManager=localStorage.getItem("username"),this.filteredActions=this.actions.filter(t=>{const r=this.datePipe.transform(t.dateAction,"yyyy-MM-dd");return!(this.searchDate&&r!==this.searchDate||this.selectedManager&&t.manager!==this.selectedManager)})}newAction(){this.router.navigate(["/newAction"])}getActions(){this.actionService.getActions().subscribe(t=>{this.actions=t,this.filteredActions=this.actions})}delete_action(t){this.actionService.deleteAction(t).subscribe(r=>{this.getActions(),this.messageAction="Accion eliminada exitosamente!",this.statusCodeAction=r.statusCode||"200",setTimeout(()=>{this.messageAction=""},3e3)},r=>{this.messageAction="Fallo al eliminar la accion.",this.statusCodeAction=r.status||"500",setTimeout(()=>{this.messageAction=""},3e3)})}resolver(t){this.router.navigate(["/edit_action",t])}viewAction(t){this.actionSelect=t}static#e=this.\u0275fac=function(r){return new(r||e)(xt(eL),xt(ba),xt(J2))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-list-actionns-customers"]],decls:17,vars:4,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-12"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[3,"ngClass","click",4,"ngFor","ngForOf"],["class","modal fade","id","viewModal","tabindex","-1","aria-labelledby","viewModalLabel","aria-hidden","true",4,"ngIf"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[3,"click","ngClass"],["id","viewModal","tabindex","-1","aria-labelledby","viewModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","viewModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"form-group","mb-3"],["class","form-group mb-3",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),Tn("ngModelChange",function(h){return En(s.searchDate,h)||(s.searchDate=h),h}),on("ngModelChange",function(){return s.filterDateManager()}),te()()(),Cn(4,Zve,3,1,"div",4),ee(5,"table",5)(6,"thead")(7,"tr")(8,"th"),xe(9," Fecha "),te(),ee(10,"th"),xe(11," Cliente "),te(),ee(12,"th"),xe(13," Estado"),te()()(),ee(14,"tbody"),Cn(15,Xve,7,8,"tr",6),te()()(),Cn(16,Kve,57,10,"div",7)),2&r&&(Te(3),wn("ngModel",s.searchDate),Te(),Zt("ngIf",s.messageAction),Te(11),Zt("ngForOf",s.filteredActions),Te(),Zt("ngIf",s.actionSelect))},dependencies:[K2,$p,uu,Za,ql,_l]})}return e})();var tH=Sl(247);function Qve(e,n){if(1&e){const t=Wi();ee(0,"div",4)(1,"label",30),xe(2,"N\xfamero de Pedido:"),te(),ee(3,"input",31),Tn("ngModelChange",function(s){Mn(t);const l=Bt();return En(l.actionObject.orderNumber,s)||(l.actionObject.orderNumber=s),An(s)}),te()()}if(2&e){const t=Bt();Te(3),wn("ngModel",t.actionObject.orderNumber)}}function exe(e,n){if(1&e&&(ee(0,"option",32),xe(1),te()),2&e){const t=n.$implicit;Zt("value",t),Te(),kn(t)}}const nxe=()=>({standalone:!0});function rxe(e,n){if(1&e){const t=Wi();ee(0,"tr")(1,"td"),xe(2),te(),ee(3,"td"),xe(4),te(),ee(5,"td"),xe(6),te(),ee(7,"td")(8,"button",34),on("click",function(){const s=Mn(t).$implicit;return An(Bt().selectCustomer(s))}),xe(9," Seleccionar "),te()()()}if(2&e){const t=n.$implicit;Te(2),kn(t.name),Te(2),kn(t.phone),Te(2),kn(t.email)}}function ixe(e,n){if(1&e&&(ee(0,"option",35),xe(1),te()),2&e){const t=n.$implicit;Zt("ngValue",t),Te(),kn(t.name)}}function sxe(e,n){if(1&e&&(ee(0,"option",38),xe(1),te()),2&e){const t=n.$implicit;Zt("value",t.order_number),Te(),qR("",t.order_number," - ( ",t.delivery_date,")")}}function oxe(e,n){if(1&e){const t=Wi();ee(0,"div",2)(1,"label",36),xe(2,"N\xfamero de Pedido:"),te(),ee(3,"select",37),Tn("ngModelChange",function(s){Mn(t);const l=Bt();return En(l.newActionObject.orderNumber,s)||(l.newActionObject.orderNumber=s),An(s)}),ee(4,"option",23),xe(5,"Seleccione un pedido"),te(),Cn(6,sxe,2,3,"option",28),te()()}if(2&e){const t=Bt();Te(3),wn("ngModel",t.newActionObject.orderNumber),Te(3),Zt("ngForOf",t.orders)}}function axe(e,n){if(1&e&&(ee(0,"option",38),xe(1),te()),2&e){const t=n.$implicit;Zt("value",t),Te(),kn(t)}}function cxe(e,n){if(1&e&&(ee(0,"div",27),xe(1),Xn(2,"button",28),te()),2&e){const t=Bt();Te(),dl(" ",t.messageSupplier," ")}}function uxe(e,n){if(1&e){const t=Wi();ee(0,"tr")(1,"td"),xe(2),te(),ee(3,"td"),xe(4),te(),ee(5,"td"),xe(6),te(),ee(7,"td"),xe(8),te(),ee(9,"td")(10,"div",29)(11,"div",4)(12,"span",30),on("click",function(){const s=Mn(t).$implicit;return An(Bt().setCurrentSupplier(s))}),Xn(13,"i",31),te()(),ee(14,"div",4)(15,"span",32),on("click",function(){const s=Mn(t).$implicit;return An(Bt().deleteSupplier(s._id))}),Xn(16,"i",33),te()()()()()}if(2&e){const t=n.$implicit;Te(2),kn(t.name),Te(2),kn(t.nit),Te(2),kn(t.email),Te(2),kn(t.address)}}const hxe=[{path:"productos",component:ore},{path:"clientes",component:lre},{path:"ordenes",component:ase},{path:"login",component:lse},{path:"home",component:sV},{path:"reports",component:pse},{path:"reports/picking",component:bse},{path:"reports/compras",component:wse},{path:"reports/cotizar",component:Tse},{path:"reports/integrar",component:Sse},{path:"delete-account",component:xse},{path:"restore/:user_id",component:_se},{path:"purchases",component:C0e},{path:"purchase/:purchaseNumber",component:Wve},{path:"crm",component:Jve},{path:"edit_action/:action",component:(()=>{class e{constructor(t,r,s){this.actionService=t,this.router=r,this.route=s,this.actionObject={dateAction:"",dateSolution:"",type:"",customer:{},orderNumber:"",manager:"",status:"",actionComment:"",solutionType:"",solutionComment:"",latitude:null,longitude:null},this.solutions=[]}ngOnInit(){this.loadAction(),this.getCurrentLocation()}loadAction(){const t=this.route.snapshot.paramMap.get("action");t&&this.actionService.getAction(t).subscribe(r=>{this.actionObject=r,this.solutions=r.type.solutions,this.initializeMap()},r=>{console.error("Error al cargar la acci\xf3n:",r)})}initializeMap(){this.actionObject.customer.latitude&&this.actionObject.customer.longitude&&(this.map=new tH.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",projection:{name:"mercator"},zoom:15,center:[parseFloat(this.actionObject.customer.longitude),parseFloat(this.actionObject.customer.latitude)],accessToken:"pk.eyJ1Ijoidm1kaWFnb3YiLCJhIjoiY2x4MGtxY2NlMDFxdDJycTdrdXhvYWE4byJ9.rQb2uBaS48sEyvpbdMj14Q"}),(new tH.Marker).setLngLat([parseFloat(this.actionObject.customer.longitude),parseFloat(this.actionObject.customer.latitude)]).addTo(this.map))}getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.actionObject.latitude=t.coords.latitude,this.actionObject.longitude=t.coords.longitude},t=>{console.error("Error obteniendo la ubicaci\xf3n:",t)}):console.error("Geolocalizaci\xf3n no es soportada por el navegador")}backList(){this.router.navigate(["/crm"])}completar(){const t=(new Date).toLocaleString("en-US",{timeZone:"America/Bogota"});this.actionObject.dateSolution=new Date(t).toISOString(),this.actionObject.status="Completada",this.getCurrentLocation(),this.actionService.editAction(this.actionObject.actionNumber,this.actionObject).subscribe(r=>{this.router.navigate(["/crm"])})}static#e=this.\u0275fac=function(r){return new(r||e)(xt(eL),xt(ba),xt(qp))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-edit-action"]],decls:61,vars:12,consts:[["href",Lu`https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.css`,"rel","stylesheet"],["href",Lu`https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css`,"rel","stylesheet"],[1,"container"],[1,"mb-4"],[1,"form-group","mb-3"],["for","dateAction"],["type","text","id","dateAction","name","dateAction","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","customer"],["type","text","id","name","name","name",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","address","name","address",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","phone","name","phone",1,"form-control",3,"ngModelChange","ngModel"],["type","text","id","email","name","email",1,"form-control",3,"ngModelChange","ngModel"],["id","map",1,"map-container"],["for","type"],["type","text","id","type","name","type","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["class","form-group mb-3",4,"ngIf"],["for","manager"],["type","text","id","manager","name","manager","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","actionComment"],["type","text","id","actionComment","name","actionComment","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["for","solution"],["id","solution","name","solution","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["for","solutionComment"],["type","text","id","solutionComment","name","solutionComment",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],["for","orderNumber"],["type","text","id","orderNumber","name","orderNumber","readonly","","disabled","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"]],template:function(r,s){1&r&&(Xn(0,"link",0)(1,"link",1)(2,"br")(3,"br"),ee(4,"div",2)(5,"h3",3),xe(6,"Completar acci\xf3n"),te(),ee(7,"form")(8,"div",4)(9,"label",5),xe(10,"Fecha Ejecuci\xf3n:"),te(),ee(11,"input",6),Tn("ngModelChange",function(h){return En(s.actionObject.dateAction,h)||(s.actionObject.dateAction=h),h}),te()(),ee(12,"div",4)(13,"label",7),xe(14,"Nombre Cliente:"),te(),ee(15,"input",8),Tn("ngModelChange",function(h){return En(s.actionObject.customer.name,h)||(s.actionObject.customer.name=h),h}),te()(),ee(16,"div",4)(17,"label",7),xe(18,"Direcci\xf3n Cliente:"),te(),ee(19,"input",9),Tn("ngModelChange",function(h){return En(s.actionObject.customer.address,h)||(s.actionObject.customer.address=h),h}),te()(),ee(20,"div",4)(21,"label",7),xe(22,"Tel\xe9fono Cliente:"),te(),ee(23,"input",10),Tn("ngModelChange",function(h){return En(s.actionObject.customer.phone,h)||(s.actionObject.customer.phone=h),h}),te()(),ee(24,"div",4)(25,"label",7),xe(26,"Email Cliente:"),te(),ee(27,"input",11),Tn("ngModelChange",function(h){return En(s.actionObject.customer.email,h)||(s.actionObject.customer.email=h),h}),te()(),ee(28,"div",4),Xn(29,"div",12),te(),ee(30,"div",4)(31,"label",13),xe(32,"Tipo de Acci\xf3n:"),te(),ee(33,"input",14),Tn("ngModelChange",function(h){return En(s.actionObject.type.name,h)||(s.actionObject.type.name=h),h}),te()(),Cn(34,Qve,4,1,"div",15),ee(35,"div",4)(36,"label",16),xe(37,"Manager:"),te(),ee(38,"input",17),Tn("ngModelChange",function(h){return En(s.actionObject.manager,h)||(s.actionObject.manager=h),h}),te()(),ee(39,"div",4)(40,"label",18),xe(41,"Detalle:"),te(),ee(42,"input",19),Tn("ngModelChange",function(h){return En(s.actionObject.actionComment,h)||(s.actionObject.actionComment=h),h}),te()(),ee(43,"div",4)(44,"label",20),xe(45,"Soluci\xf3n:"),te(),ee(46,"select",21),Tn("ngModelChange",function(h){return En(s.actionObject.solutionType,h)||(s.actionObject.solutionType=h),h}),ee(47,"option",22),xe(48,"Seleccione una soluci\xf3n"),te(),Cn(49,exe,2,2,"option",23),te()(),ee(50,"div",4)(51,"label",24),xe(52,"Detalle Soluci\xf3n:"),te(),ee(53,"input",25),Tn("ngModelChange",function(h){return En(s.actionObject.solutionComment,h)||(s.actionObject.solutionComment=h),h}),te()(),ee(54,"div",26)(55,"div",27)(56,"button",28),on("click",function(){return s.completar()}),xe(57,"Completar"),te()(),ee(58,"div",27)(59,"button",29),on("click",function(){return s.backList()}),xe(60,"Regresar"),te()()()()()),2&r&&(Te(11),wn("ngModel",s.actionObject.dateAction),Te(4),wn("ngModel",s.actionObject.customer.name),Te(4),wn("ngModel",s.actionObject.customer.address),Te(4),wn("ngModel",s.actionObject.customer.phone),Te(4),wn("ngModel",s.actionObject.customer.email),Te(6),wn("ngModel",s.actionObject.type.name),Te(),Zt("ngIf",s.actionObject.orderNumber),Te(4),wn("ngModel",s.actionObject.manager),Te(4),wn("ngModel",s.actionObject.actionComment),Te(4),wn("ngModel",s.actionObject.solutionType),Te(3),Zt("ngForOf",s.solutions),Te(4),wn("ngModel",s.actionObject.solutionComment))},dependencies:[$p,uu,HI,Xy,Yy,Za,wg,ql,NI,Tw,_l,ww],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:400px}"]})}return e})()},{path:"newAction",component:(()=>{class e{constructor(t,r,s,l){this.actionService=t,this.customerService=r,this.orderService=s,this.router=l,this.newActionObject={dateAction:"",dateSolution:"",type:{},customer:{},orderNumber:"",manager:"",status:"Creada",actionComment:"",solutionType:"",solutionComment:"",longituted:"",latituted:""},this.customers=[],this.actionTypes=[],this.orders=[],this.managers=[],this.searchText=""}ngOnInit(){this.loadCustomers(),this.orderService.getConfig().subscribe(t=>{this.actionTypes=t.actionsType,this.managers=t.comercials})}loadCustomers(){this.customerService.getClientes().subscribe(t=>{this.customers=t},t=>{console.error("Error al cargar los clientes:",t)})}loadOrders(t){this.orderService.getLastOrdersByCustomerId(t).subscribe(r=>{this.orders=r},r=>{console.error("Error al cargar los pedidos:",r)})}selectCustomer(t){this.newActionObject.customer=t,this.loadOrders(t.email)}onTypeChange(){this.newActionObject.type.requiresOrder&&this.newActionObject.customer.id&&this.loadOrders(this.newActionObject.customer.email)}createAction(){this.newActionObject.dateAction&&this.newActionObject.type&&this.newActionObject.customer.id?this.actionService.createAction(this.newActionObject).subscribe(t=>{console.log("Acci\xf3n creada exitosamente:",t),this.router.navigate(["/crm"])},t=>{console.error("Error al crear la acci\xf3n:",t)}):alert("Por favor, completa todos los campos obligatorios.")}filteredCustomers(){if(!this.searchText)return this.customers;const t=this.searchText.toLowerCase();return this.customers.filter(r=>r.phone.toLowerCase().includes(t)||r.name.toLowerCase().includes(t)||r.email.toLowerCase().includes(t))}backList(){this.router.navigate(["/crm"])}static#e=this.\u0275fac=function(r){return new(r||e)(xt(eL),xt(iF),xt(ZU),xt(ba))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-new-action"]],decls:69,vars:12,consts:[[1,"container"],[1,"mb-4"],[1,"form-group","mb-3"],["for","dateAction"],["type","date","id","dateAction","name","dateAction","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","customerId"],[1,"input-group"],["type","text","id","customer","name","customer","readonly","","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","button","data-bs-toggle","modal","data-bs-target","#customerModal",1,"btn","btn-outline-secondary"],["id","customerModal","tabindex","-1","aria-labelledby","customerModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","customerModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["type","text","placeholder","Buscar cliente...",1,"form-control","mb-3",3,"ngModelChange","ngModel","ngModelOptions"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["for","type"],["id","type","name","type","required","",1,"form-control",3,"ngModelChange","change","ngModel"],["value","","disabled","","selected",""],[3,"ngValue",4,"ngFor","ngForOf"],["class","form-group mb-3",4,"ngIf"],["for","manager"],["id","manager","name","manager","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","id","actionComment","name","actionComment",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[3,"ngValue"],["for","orderNumber"],["id","orderNumber","name","orderNumber",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"]],template:function(r,s){1&r&&(Xn(0,"br")(1,"br"),ee(2,"div",0)(3,"h3",1),xe(4,"Nueva acci\xf3n"),te(),ee(5,"form")(6,"div",2)(7,"label",3),xe(8,"Fecha Ejecuci\xf3n:"),te(),ee(9,"input",4),Tn("ngModelChange",function(h){return En(s.newActionObject.dateAction,h)||(s.newActionObject.dateAction=h),h}),te()(),ee(10,"div",2)(11,"label",5),xe(12,"Cliente:"),te(),ee(13,"div",6)(14,"input",7),Tn("ngModelChange",function(h){return En(s.newActionObject.customer.name,h)||(s.newActionObject.customer.name=h),h}),te(),ee(15,"button",8),xe(16," Seleccionar Cliente "),te()()(),ee(17,"div",9)(18,"div",10)(19,"div",11)(20,"div",12)(21,"h5",13),xe(22,"Seleccionar Cliente"),te(),Xn(23,"button",14),te(),ee(24,"div",15)(25,"input",16),Tn("ngModelChange",function(h){return En(s.searchText,h)||(s.searchText=h),h}),te(),ee(26,"table",17)(27,"thead")(28,"tr")(29,"th"),xe(30,"Nombre"),te(),ee(31,"th"),xe(32,"Email"),te(),ee(33,"th"),xe(34,"Tel\xe9fono"),te(),ee(35,"th"),xe(36,"Acci\xf3n"),te()()(),ee(37,"tbody"),Cn(38,rxe,10,3,"tr",18),te()()(),ee(39,"div",19)(40,"button",20),xe(41,"Cerrar"),te()()()()(),ee(42,"div",2)(43,"label",21),xe(44,"Tipo de Acci\xf3n:"),te(),ee(45,"select",22),Tn("ngModelChange",function(h){return En(s.newActionObject.type,h)||(s.newActionObject.type=h),h}),on("change",function(){return s.onTypeChange()}),ee(46,"option",23),xe(47,"Seleccione una opci\xf3n"),te(),Cn(48,ixe,2,2,"option",24),te()(),Cn(49,oxe,7,2,"div",25),ee(50,"div",2)(51,"label",26),xe(52,"Manager:"),te(),ee(53,"select",27),Tn("ngModelChange",function(h){return En(s.newActionObject.manager,h)||(s.newActionObject.manager=h),h}),ee(54,"option",23),xe(55,"Seleccione un manager"),te(),Cn(56,axe,2,2,"option",28),te()(),ee(57,"div",2)(58,"label",26),xe(59,"Detalle:"),te(),ee(60,"input",29),Tn("ngModelChange",function(h){return En(s.newActionObject.actionComment,h)||(s.newActionObject.actionComment=h),h}),te()(),Xn(61,"br"),ee(62,"div",30)(63,"div",31)(64,"button",32),on("click",function(){return s.createAction()}),xe(65,"Crear acci\xf3n"),te()(),ee(66,"div",31)(67,"button",33),on("click",function(){return s.backList()}),xe(68,"Regresar"),te()()()()()),2&r&&(Te(9),wn("ngModel",s.newActionObject.dateAction),Te(5),wn("ngModel",s.newActionObject.customer.name),Te(11),wn("ngModel",s.searchText),Zt("ngModelOptions",function IB(e,n,t){const r=Ko()+e,s=jt();return s[r]===qr?Bp(s,r,t?n.call(t):n()):function C2(e,n){return e[n]}(s,r)}(11,nxe)),Te(13),Zt("ngForOf",s.filteredCustomers()),Te(7),wn("ngModel",s.newActionObject.type),Te(3),Zt("ngForOf",s.actionTypes),Te(),Zt("ngIf",s.newActionObject.type.requiresOrder),Te(4),wn("ngModel",s.newActionObject.manager),Te(3),Zt("ngForOf",s.managers),Te(4),wn("ngModel",s.newActionObject.actionComment))},dependencies:[$p,uu,HI,Xy,Yy,Za,wg,ql,NI,Tw,_l,ww]})}return e})()},{path:"suppliers",component:(()=>{class e{constructor(t,r){this.supplierService=t,this.router=r,this.suppliers=[],this.filteredSuppliers=[],this.searchText="",this.messageSupplier="",this.isEditMode=!1,this.currentSupplier={id:null,name:"",nit:"",email:"",address:""}}ngOnInit(){this.getSuppliers()}getSuppliers(){this.supplierService.getSuppliers().subscribe(t=>{this.suppliers=t,this.filteredSuppliers=t})}filterSuppliers(){this.filteredSuppliers=""!==this.searchText.trim()?this.suppliers.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())||t.nit.toLowerCase().includes(this.searchText.toLowerCase())):this.suppliers}setCurrentSupplier(t){this.isEditMode=!0,this.currentSupplier={...t}}saveSupplier(){this.isEditMode?this.supplierService.updateSupplier(this.currentSupplier).subscribe(t=>{this.getSuppliers(),this.messageSupplier="Proveedor actualizado exitosamente!",this.clearMessageAfterDelay()},t=>{this.messageSupplier="Error al actualizar el proveedor.",this.clearMessageAfterDelay()}):this.supplierService.createSupplier(this.currentSupplier).subscribe(t=>{this.getSuppliers(),this.messageSupplier="Proveedor creado exitosamente!",this.clearMessageAfterDelay()},t=>{this.messageSupplier="Error al crear el proveedor.",this.clearMessageAfterDelay()}),this.isEditMode=!1,this.resetCurrentSupplier()}deleteSupplier(t){this.supplierService.deleteSupplier(t).subscribe(r=>{this.getSuppliers(),this.messageSupplier="Proveedor eliminado exitosamente!",this.clearMessageAfterDelay()},r=>{this.messageSupplier="Error al eliminar el proveedor.",this.clearMessageAfterDelay()})}resetCurrentSupplier(){this.currentSupplier={id:null,name:"",nit:"",email:"",address:""}}clearMessageAfterDelay(){setTimeout(()=>{this.messageSupplier=""},3e3)}static#e=this.\u0275fac=function(r){return new(r||e)(xt(eH),xt(ba))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-suppliers"]],decls:51,vars:9,consts:[[1,"container-fluid","mt-5"],[1,"row","justify-right"],[1,"col-6"],["type","text","placeholder","Buscar proveedor...",1,"form-control",3,"ngModelChange","keyup","ngModel"],[1,"col-auto"],["type","button","data-bs-toggle","modal","data-bs-target","#newSupplierModal","data-bs-dismiss","modal",1,"btn","btn-primary"],["class","alert alert-success alert-dismissible fade show","role","alert",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["id","newSupplierModal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-group"],["for","name"],["type","text","id","name",1,"form-control",3,"ngModelChange","ngModel"],["for","nit"],["type","text","id","nit",1,"form-control",3,"ngModelChange","ngModel"],["for","email"],["type","email","id","email",1,"form-control",3,"ngModelChange","ngModel"],["for","address"],["type","text","id","address",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],["role","alert",1,"alert","alert-success","alert-dismissible","fade","show"],["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close"],[1,"row"],["data-bs-toggle","modal","data-bs-target","#newSupplierModal",2,"cursor","pointer",3,"click"],[1,"fas","fa-edit","fa-lg","text-primary"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-trash","fa-lg","text-danger"]],template:function(r,s){1&r&&(ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),Tn("ngModelChange",function(h){return En(s.searchText,h)||(s.searchText=h),h}),on("keyup",function(){return s.filterSuppliers()}),te()(),ee(4,"div",4)(5,"button",5),xe(6,"Nuevo Proveedor"),te()()(),Cn(7,cxe,3,1,"div",6),ee(8,"table",7)(9,"thead")(10,"tr")(11,"th"),xe(12,"Nombre"),te(),ee(13,"th"),xe(14,"NIT"),te(),ee(15,"th"),xe(16,"Email"),te(),ee(17,"th"),xe(18,"Direcci\xf3n"),te(),ee(19,"th"),xe(20,"Acciones"),te()()(),ee(21,"tbody"),Cn(22,uxe,17,4,"tr",8),te()()(),ee(23,"div",9)(24,"div",10)(25,"div",11)(26,"div",12)(27,"h5",13),xe(28),te()(),ee(29,"div",14)(30,"div",15)(31,"label",16),xe(32,"Nombre:"),te(),ee(33,"input",17),Tn("ngModelChange",function(h){return En(s.currentSupplier.name,h)||(s.currentSupplier.name=h),h}),te()(),ee(34,"div",15)(35,"label",18),xe(36,"NIT:"),te(),ee(37,"input",19),Tn("ngModelChange",function(h){return En(s.currentSupplier.nit,h)||(s.currentSupplier.nit=h),h}),te()(),ee(38,"div",15)(39,"label",20),xe(40,"Correo Electr\xf3nico:"),te(),ee(41,"input",21),Tn("ngModelChange",function(h){return En(s.currentSupplier.email,h)||(s.currentSupplier.email=h),h}),te()(),ee(42,"div",15)(43,"label",22),xe(44,"Direcci\xf3n:"),te(),ee(45,"input",23),Tn("ngModelChange",function(h){return En(s.currentSupplier.address,h)||(s.currentSupplier.address=h),h}),te()()(),ee(46,"div",24)(47,"button",25),xe(48,"Cancelar"),te(),ee(49,"button",26),on("click",function(){return s.saveSupplier()}),xe(50),te()()()()()),2&r&&(Te(3),wn("ngModel",s.searchText),Te(4),Zt("ngIf",s.messageSupplier),Te(15),Zt("ngForOf",s.filteredSuppliers),Te(6),kn(s.isEditMode?"Editar Proveedor":"Nuevo Proveedor"),Te(5),wn("ngModel",s.currentSupplier.name),Te(4),wn("ngModel",s.currentSupplier.nit),Te(4),wn("ngModel",s.currentSupplier.email),Te(4),wn("ngModel",s.currentSupplier.address),Te(5),dl(" ",s.isEditMode?"Guardar Cambios":"Crear Proveedor"," "))},dependencies:[$p,uu,Za,ql,_l]})}return e})()},{path:"",component:sV}];let dxe=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e});static#n=this.\u0275inj=Ui({imports:[W8.forRoot(hxe,{useHash:!1}),W8]})}return e})();function fxe(e,n){1&e&&(ee(0,"li",4)(1,"a",6),xe(2,"Productos"),te()())}function pxe(e,n){1&e&&(ee(0,"li",4)(1,"a",7),xe(2,"Clientes"),te()())}function mxe(e,n){1&e&&(ee(0,"li",4)(1,"a",8),xe(2,"Pedidos"),te()())}function gxe(e,n){1&e&&(ee(0,"li",4)(1,"a",9),xe(2,"Operaci\xf3n"),te()())}function _xe(e,n){1&e&&(ee(0,"li",4)(1,"a",10),xe(2,"Proveedores"),te()())}function yxe(e,n){1&e&&(ee(0,"li",4)(1,"a",11),xe(2,"Compras"),te()())}function vxe(e,n){1&e&&(ee(0,"li",4)(1,"a",12),xe(2,"CRM"),te()())}function xxe(e,n){if(1&e){const t=Wi();ee(0,"nav",1)(1,"ul",2),Cn(2,fxe,3,0,"li",3)(3,pxe,3,0,"li",3)(4,mxe,3,0,"li",3)(5,gxe,3,0,"li",3)(6,_xe,3,0,"li",3)(7,yxe,3,0,"li",3)(8,vxe,3,0,"li",3),ee(9,"li",4)(10,"a",5),on("click",function(){return Mn(t),An(Bt().logout())}),xe(11,"Cerrar Sesi\xf3n"),te()()()()}if(2&e){const t=Bt();Te(2),Zt("ngIf","administrador"==t.role),Te(),Zt("ngIf","administrador"==t.role),Te(),Zt("ngIf","administrador"==t.role),Te(),Zt("ngIf","administrador"==t.role),Te(),Zt("ngIf","administrador"==t.role),Te(),Zt("ngIf","administrador"==t.role),Te(),Zt("ngIf","administrador"==t.role||"comercial"==t.role)}}let bxe=(()=>{class e{constructor(t,r){this.authService=t,this.router=r,this.role=""}ngOnInit(){}isLoggedIn(){const t=localStorage.getItem("token");return this.role=localStorage.getItem("role"),!!t}logout(){const t=localStorage.getItem("token");t?this.authService.logout(t).subscribe(()=>{localStorage.removeItem("token"),this.router.navigate(["/login"])},r=>{this.router.navigate(["/login"])}):this.router.navigate(["/login"])}static#e=this.\u0275fac=function(r){return new(r||e)(xt(kC),xt(ba))};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-navigation-bar"]],decls:1,vars:1,consts:[["class","navbar","style","padding: 0;",4,"ngIf"],[1,"navbar",2,"padding","0"],[1,"nav"],["class","nav-item",4,"ngIf"],[1,"nav-item"],[1,"nav-link",3,"click"],["routerLink","/productos","routerLinkActive","active",1,"nav-link"],["routerLink","/clientes","routerLinkActive","active",1,"nav-link"],["routerLink","/ordenes","routerLinkActive","active",1,"nav-link"],["routerLink","/reports","routerLinkActive","active",1,"nav-link"],["routerLink","/suppliers","routerLinkActive","active",1,"nav-link"],["routerLink","/purchases","routerLinkActive","active",1,"nav-link"],["routerLink","/crm","routerLinkActive","active",1,"nav-link"]],template:function(r,s){1&r&&Cn(0,xxe,12,7,"nav",0),2&r&&Zt("ngIf",s.isLoggedIn())},dependencies:[uu,vw,B8],styles:[".navbar[_ngcontent-%COMP%]{background-color:#333}.nav[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:0;overflow:hidden}.nav-item[_ngcontent-%COMP%]{float:left}.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;color:#fff;text-align:center;padding:14px 16px;text-decoration:none}.nav-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#ddd;color:#000}.active[_ngcontent-%COMP%]{background-color:#4caf50}"]})}return e})(),wxe=(()=>{class e{constructor(){this.title="Admin Frescapp"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=ki({type:e,selectors:[["app-root"]],decls:3,vars:0,template:function(r,s){1&r&&(ee(0,"div"),Xn(1,"app-navigation-bar"),te(),Xn(2,"router-outlet"))},dependencies:[EN,bxe]})}return e})(),Txe=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ci({type:e,bootstrap:[wxe]});static#n=this.\u0275inj=Ui({providers:[J2,{provide:p_,useClass:sz}],imports:[JK,dxe,Jne,zie,mQ,Qne,Lve]})}return e})();YK().bootstrapModule(Txe).catch(e=>console.error(e))},578:function(oh,_u){var Sl,ts;void 0!==(ts="function"==typeof(Sl=function(){"use strict";function f(Pr,ei,Is){var vi=new XMLHttpRequest;vi.open("GET",Pr),vi.responseType="blob",vi.onload=function(){_s(vi.response,ei,Is)},vi.onerror=function(){console.error("could not download file")},vi.send()}function as(Pr){var ei=new XMLHttpRequest;ei.open("HEAD",Pr,!1);try{ei.send()}catch{}return 200<=ei.status&&299>=ei.status}function _r(Pr){try{Pr.dispatchEvent(new MouseEvent("click"))}catch{var ei=document.createEvent("MouseEvents");ei.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),Pr.dispatchEvent(ei)}}var qn="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,jr=qn.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),_s=qn.saveAs||("object"!=typeof window||window!==qn?function(){}:"download"in HTMLAnchorElement.prototype&&!jr?function(Pr,ei,Is){var vi=qn.URL||qn.webkitURL,Ws=document.createElement("a");Ws.download=ei=ei||Pr.name||"download",Ws.rel="noopener","string"==typeof Pr?(Ws.href=Pr,Ws.origin===location.origin?_r(Ws):as(Ws.href)?f(Pr,ei,Is):_r(Ws,Ws.target="_blank")):(Ws.href=vi.createObjectURL(Pr),setTimeout(function(){vi.revokeObjectURL(Ws.href)},4e4),setTimeout(function(){_r(Ws)},0))}:"msSaveOrOpenBlob"in navigator?function(Pr,ei,Is){if(ei=ei||Pr.name||"download","string"!=typeof Pr)navigator.msSaveOrOpenBlob(function gd(Pr,ei){return typeof ei>"u"?ei={autoBom:!1}:"object"!=typeof ei&&(console.warn("Deprecated: Expected third argument to be a object"),ei={autoBom:!ei}),ei.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(Pr.type)?new Blob(["\ufeff",Pr],{type:Pr.type}):Pr}(Pr,Is),ei);else if(as(Pr))f(Pr,ei,Is);else{var vi=document.createElement("a");vi.href=Pr,vi.target="_blank",setTimeout(function(){_r(vi)})}}:function(Pr,ei,Is,vi){if((vi=vi||open("","_blank"))&&(vi.document.title=vi.document.body.innerText="downloading..."),"string"==typeof Pr)return f(Pr,ei,Is);var Ws="application/octet-stream"===Pr.type,bc=/constructor/i.test(qn.HTMLElement)||qn.safari,Uo=/CriOS\/[\d]+/.test(navigator.userAgent);if((Uo||Ws&&bc||jr)&&typeof FileReader<"u"){var xi=new FileReader;xi.onloadend=function(){var sa=xi.result;sa=Uo?sa:sa.replace(/^data:[^;]*;/,"data:attachment/file;"),vi?vi.location.href=sa:location=sa,vi=null},xi.readAsDataURL(Pr)}else{var Ai=qn.URL||qn.webkitURL,Ks=Ai.createObjectURL(Pr);vi?vi.location=Ks:location.href=Ks,vi=null,setTimeout(function(){Ai.revokeObjectURL(Ks)},4e4)}});qn.saveAs=_s.saveAs=_s,oh.exports=_s})?Sl.apply(_u,[]):Sl)&&(oh.exports=ts)},247:function(oh){oh.exports=function(){"use strict";var _u,Sl,yu;function ts(f,as){if(_u)if(Sl){var _r="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+_u+")(sharedChunk); ("+Sl+")(sharedChunk); self.onerror = null;",qn={};_u(qn),yu=as(qn),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(yu.workerUrl=window.URL.createObjectURL(new Blob([_r],{type:"text/javascript"})))}else Sl=as;else _u=as}return ts(0,function(f){var as="3.6.0";let _r;const qn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==_r){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{_r=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{_r=o}}return _r},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!qn.API_URL)return null;try{const o=new URL(qn.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function jr(o){return qn.API_URL_REGEX.test(o)}function _s(o){return 0===o.indexOf("mapbox:")}function Pr(o){return qn.API_CDN_URL_REGEX.test(o)}function ei(o){return qn.API_SPRITE_REGEX.test(o)}function Is(o){return qn.API_STYLE_REGEX.test(o)&&!ei(o)}const vi={create:"create",load:"load",fullLoad:"fullLoad"},Ws={mark(o){performance.mark(o)},measure(o,i,a){performance.measure(o,i,a)}};function bc(o){const i=o.name.split("?")[0];return Pr(i)&&i.includes("mapbox-gl.js")?"javascript":Pr(i)&&i.includes("mapbox-gl.css")?"css":qn.API_FONTS_REGEX.test(i)?"fontRange":ei(i)?"sprite":Is(i)?"style":qn.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}function Uo(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var xi={},Ai={};Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.setMatrixArrayType=function(o){Ai.ARRAY_TYPE=sa=o},Ai.toRadian=function(o){return o*vu},Ai.equals=function(o,i){return Math.abs(o-i)<=Ks*Math.max(1,Math.abs(o),Math.abs(i))},Ai.RANDOM=Ai.ARRAY_TYPE=Ai.EPSILON=void 0;var Ks=1e-6;Ai.EPSILON=Ks;var sa=typeof Float32Array<"u"?Float32Array:Array;Ai.ARRAY_TYPE=sa;var ah=Math.random;Ai.RANDOM=ah;var vu=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var ci={};function Xr(o){return(Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(ci,"__esModule",{value:!0}),ci.create=function(){var o=new Ya.ARRAY_TYPE(4);return Ya.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},ci.clone=function(o){var i=new Ya.ARRAY_TYPE(4);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i},ci.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o},ci.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o},ci.fromValues=function(o,i,a,u){var d=new Ya.ARRAY_TYPE(4);return d[0]=o,d[1]=i,d[2]=a,d[3]=u,d},ci.set=function(o,i,a,u,d){return o[0]=i,o[1]=a,o[2]=u,o[3]=d,o},ci.transpose=function(o,i){if(o===i){var a=i[1];o[1]=i[2],o[2]=a}else o[0]=i[0],o[1]=i[2],o[2]=i[1],o[3]=i[3];return o},ci.invert=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=a*m-d*u;return _?(o[0]=m*(_=1/_),o[1]=-u*_,o[2]=-d*_,o[3]=a*_,o):null},ci.adjoint=function(o,i){var a=i[0];return o[0]=i[3],o[1]=-i[1],o[2]=-i[2],o[3]=a,o},ci.determinant=function(o){return o[0]*o[3]-o[2]*o[1]},ci.multiply=Ef,ci.rotate=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=Math.sin(a),T=Math.cos(a);return o[0]=u*T+m*b,o[1]=d*T+_*b,o[2]=u*-b+m*T,o[3]=d*-b+_*T,o},ci.scale=function(o,i,a){var u=i[1],d=i[2],m=i[3],_=a[0],b=a[1];return o[0]=i[0]*_,o[1]=u*_,o[2]=d*b,o[3]=m*b,o},ci.fromRotation=function(o,i){var a=Math.sin(i),u=Math.cos(i);return o[0]=u,o[1]=a,o[2]=-a,o[3]=u,o},ci.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=i[1],o},ci.str=function(o){return"mat2("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},ci.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},ci.LDU=function(o,i,a,u){return o[2]=u[2]/u[0],a[0]=u[0],a[1]=u[1],a[3]=u[3]-o[2]*a[1],[o,i,a]},ci.add=function(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o[3]=i[3]+a[3],o},ci.subtract=bu,ci.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},ci.equals=function(o,i){var a=o[0],u=o[1],d=o[2],m=o[3],_=i[0],b=i[1],T=i[2],S=i[3];return Math.abs(a-_)<=Ya.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-b)<=Ya.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-T)<=Ya.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(m-S)<=Ya.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},ci.multiplyScalar=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o[3]=i[3]*a,o},ci.multiplyScalarAndAdd=function(o,i,a,u){return o[0]=i[0]+a[0]*u,o[1]=i[1]+a[1]*u,o[2]=i[2]+a[2]*u,o[3]=i[3]+a[3]*u,o},ci.sub=ci.mul=void 0;var Ya=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Xr(o)&&"function"!=typeof o)return{default:o};var a=xu(void 0);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}(Ai);function xu(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(xu=function(u){return u?a:i})(o)}function Ef(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=a[0],T=a[1],S=a[2],A=a[3];return o[0]=u*b+m*T,o[1]=d*b+_*T,o[2]=u*S+m*A,o[3]=d*S+_*A,o}function bu(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o[2]=i[2]-a[2],o[3]=i[3]-a[3],o}ci.mul=Ef,ci.sub=bu;var ui={};function wc(o){return(wc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(ui,"__esModule",{value:!0}),ui.create=function(){var o=new Ka.ARRAY_TYPE(6);return Ka.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[4]=0,o[5]=0),o[0]=1,o[3]=1,o},ui.clone=function(o){var i=new Ka.ARRAY_TYPE(6);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i},ui.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o},ui.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o[4]=0,o[5]=0,o},ui.fromValues=function(o,i,a,u,d,m){var _=new Ka.ARRAY_TYPE(6);return _[0]=o,_[1]=i,_[2]=a,_[3]=u,_[4]=d,_[5]=m,_},ui.set=function(o,i,a,u,d,m,_){return o[0]=i,o[1]=a,o[2]=u,o[3]=d,o[4]=m,o[5]=_,o},ui.invert=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=i[4],b=i[5],T=a*m-u*d;return T?(o[0]=m*(T=1/T),o[1]=-u*T,o[2]=-d*T,o[3]=a*T,o[4]=(d*b-m*_)*T,o[5]=(u*_-a*b)*T,o):null},ui.determinant=function(o){return o[0]*o[3]-o[1]*o[2]},ui.multiply=lh,ui.rotate=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=i[4],T=i[5],S=Math.sin(a),A=Math.cos(a);return o[0]=u*A+m*S,o[1]=d*A+_*S,o[2]=u*-S+m*A,o[3]=d*-S+_*A,o[4]=b,o[5]=T,o},ui.scale=function(o,i,a){var u=i[1],d=i[2],m=i[3],_=i[4],b=i[5],T=a[0],S=a[1];return o[0]=i[0]*T,o[1]=u*T,o[2]=d*S,o[3]=m*S,o[4]=_,o[5]=b,o},ui.translate=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=i[4],T=i[5],S=a[0],A=a[1];return o[0]=u,o[1]=d,o[2]=m,o[3]=_,o[4]=u*S+m*A+b,o[5]=d*S+_*A+T,o},ui.fromRotation=function(o,i){var a=Math.sin(i),u=Math.cos(i);return o[0]=u,o[1]=a,o[2]=-a,o[3]=u,o[4]=0,o[5]=0,o},ui.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=i[1],o[4]=0,o[5]=0,o},ui.fromTranslation=function(o,i){return o[0]=1,o[1]=0,o[2]=0,o[3]=1,o[4]=i[0],o[5]=i[1],o},ui.str=function(o){return"mat2d("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+")"},ui.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],1)},ui.add=function(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o[3]=i[3]+a[3],o[4]=i[4]+a[4],o[5]=i[5]+a[5],o},ui.subtract=Wc,ui.multiplyScalar=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o[3]=i[3]*a,o[4]=i[4]*a,o[5]=i[5]*a,o},ui.multiplyScalarAndAdd=function(o,i,a,u){return o[0]=i[0]+a[0]*u,o[1]=i[1]+a[1]*u,o[2]=i[2]+a[2]*u,o[3]=i[3]+a[3]*u,o[4]=i[4]+a[4]*u,o[5]=i[5]+a[5]*u,o},ui.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]},ui.equals=function(o,i){var a=o[0],u=o[1],d=o[2],m=o[3],_=o[4],b=o[5],T=i[0],S=i[1],A=i[2],k=i[3],R=i[4],L=i[5];return Math.abs(a-T)<=Ka.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(u-S)<=Ka.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(d-A)<=Ka.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(m-k)<=Ka.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(_-R)<=Ka.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(b-L)<=Ka.EPSILON*Math.max(1,Math.abs(b),Math.abs(L))},ui.sub=ui.mul=void 0;var Ka=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==wc(o)&&"function"!=typeof o)return{default:o};var a=am(void 0);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}(Ai);function am(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(am=function(u){return u?a:i})(o)}function lh(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=i[4],T=i[5],S=a[0],A=a[1],k=a[2],R=a[3],L=a[4],U=a[5];return o[0]=u*S+m*A,o[1]=d*S+_*A,o[2]=u*k+m*R,o[3]=d*k+_*R,o[4]=u*L+m*U+b,o[5]=d*L+_*U+T,o}function Wc(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o[2]=i[2]-a[2],o[3]=i[3]-a[3],o[4]=i[4]-a[4],o[5]=i[5]-a[5],o}ui.mul=lh,ui.sub=Wc;var ii={};function Jl(o){return(Jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(ii,"__esModule",{value:!0}),ii.create=function(){var o=new co.ARRAY_TYPE(9);return co.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},ii.fromMat4=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[4],o[4]=i[5],o[5]=i[6],o[6]=i[8],o[7]=i[9],o[8]=i[10],o},ii.clone=function(o){var i=new co.ARRAY_TYPE(9);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i},ii.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o},ii.fromValues=function(o,i,a,u,d,m,_,b,T){var S=new co.ARRAY_TYPE(9);return S[0]=o,S[1]=i,S[2]=a,S[3]=u,S[4]=d,S[5]=m,S[6]=_,S[7]=b,S[8]=T,S},ii.set=function(o,i,a,u,d,m,_,b,T,S){return o[0]=i,o[1]=a,o[2]=u,o[3]=d,o[4]=m,o[5]=_,o[6]=b,o[7]=T,o[8]=S,o},ii.identity=function(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ii.transpose=function(o,i){if(o===i){var a=i[1],u=i[2],d=i[5];o[1]=i[3],o[2]=i[6],o[3]=a,o[5]=i[7],o[6]=u,o[7]=d}else o[0]=i[0],o[1]=i[3],o[2]=i[6],o[3]=i[1],o[4]=i[4],o[5]=i[7],o[6]=i[2],o[7]=i[5],o[8]=i[8];return o},ii.invert=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=i[4],b=i[5],T=i[6],S=i[7],A=i[8],k=A*_-b*S,R=-A*m+b*T,L=S*m-_*T,U=a*k+u*R+d*L;return U?(o[0]=k*(U=1/U),o[1]=(-A*u+d*S)*U,o[2]=(b*u-d*_)*U,o[3]=R*U,o[4]=(A*a-d*T)*U,o[5]=(-b*a+d*m)*U,o[6]=L*U,o[7]=(-S*a+u*T)*U,o[8]=(_*a-u*m)*U,o):null},ii.adjoint=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=i[4],b=i[5],T=i[6],S=i[7],A=i[8];return o[0]=_*A-b*S,o[1]=d*S-u*A,o[2]=u*b-d*_,o[3]=b*T-m*A,o[4]=a*A-d*T,o[5]=d*m-a*b,o[6]=m*S-_*T,o[7]=u*T-a*S,o[8]=a*_-u*m,o},ii.determinant=function(o){var i=o[3],a=o[4],u=o[5],d=o[6],m=o[7],_=o[8];return o[0]*(_*a-u*m)+o[1]*(-_*i+u*d)+o[2]*(m*i-a*d)},ii.multiply=Pg,ii.translate=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=i[8],R=a[0],L=a[1];return o[0]=u,o[1]=d,o[2]=m,o[3]=_,o[4]=b,o[5]=T,o[6]=R*u+L*_+S,o[7]=R*d+L*b+A,o[8]=R*m+L*T+k,o},ii.rotate=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=i[8],R=Math.sin(a),L=Math.cos(a);return o[0]=L*u+R*_,o[1]=L*d+R*b,o[2]=L*m+R*T,o[3]=L*_-R*u,o[4]=L*b-R*d,o[5]=L*T-R*m,o[6]=S,o[7]=A,o[8]=k,o},ii.scale=function(o,i,a){var u=a[0],d=a[1];return o[0]=u*i[0],o[1]=u*i[1],o[2]=u*i[2],o[3]=d*i[3],o[4]=d*i[4],o[5]=d*i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o},ii.fromTranslation=function(o,i){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=i[0],o[7]=i[1],o[8]=1,o},ii.fromRotation=function(o,i){var a=Math.sin(i),u=Math.cos(i);return o[0]=u,o[1]=a,o[2]=0,o[3]=-a,o[4]=u,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ii.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=i[1],o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},ii.fromMat2d=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=0,o[3]=i[2],o[4]=i[3],o[5]=0,o[6]=i[4],o[7]=i[5],o[8]=1,o},ii.fromQuat=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=a+a,b=u+u,T=d+d,S=a*_,A=u*_,k=u*b,R=d*_,L=d*b,U=d*T,H=m*_,G=m*b,Y=m*T;return o[0]=1-k-U,o[3]=A-Y,o[6]=R+G,o[1]=A+Y,o[4]=1-S-U,o[7]=L-H,o[2]=R-G,o[5]=L+H,o[8]=1-S-k,o},ii.normalFromMat4=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=i[4],b=i[5],T=i[6],S=i[7],A=i[8],k=i[9],R=i[10],L=i[11],U=i[12],H=i[13],G=i[14],Y=i[15],ue=a*b-u*_,ae=a*T-d*_,he=a*S-m*_,ve=u*T-d*b,we=u*S-m*b,Se=d*S-m*T,Fe=A*H-k*U,Ge=A*G-R*U,tt=A*Y-L*U,Ye=k*G-R*H,ht=k*Y-L*H,Dt=R*Y-L*G,dt=ue*Dt-ae*ht+he*Ye+ve*tt-we*Ge+Se*Fe;return dt?(o[0]=(b*Dt-T*ht+S*Ye)*(dt=1/dt),o[1]=(T*tt-_*Dt-S*Ge)*dt,o[2]=(_*ht-b*tt+S*Fe)*dt,o[3]=(d*ht-u*Dt-m*Ye)*dt,o[4]=(a*Dt-d*tt+m*Ge)*dt,o[5]=(u*tt-a*ht-m*Fe)*dt,o[6]=(H*Se-G*we+Y*ve)*dt,o[7]=(G*he-U*Se-Y*ae)*dt,o[8]=(U*we-H*he+Y*ue)*dt,o):null},ii.projection=function(o,i,a){return o[0]=2/i,o[1]=0,o[2]=0,o[3]=0,o[4]=-2/a,o[5]=0,o[6]=-1,o[7]=1,o[8]=1,o},ii.str=function(o){return"mat3("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+", "+o[8]+")"},ii.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8])},ii.add=function(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o[3]=i[3]+a[3],o[4]=i[4]+a[4],o[5]=i[5]+a[5],o[6]=i[6]+a[6],o[7]=i[7]+a[7],o[8]=i[8]+a[8],o},ii.subtract=_d,ii.multiplyScalar=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o[3]=i[3]*a,o[4]=i[4]*a,o[5]=i[5]*a,o[6]=i[6]*a,o[7]=i[7]*a,o[8]=i[8]*a,o},ii.multiplyScalarAndAdd=function(o,i,a,u){return o[0]=i[0]+a[0]*u,o[1]=i[1]+a[1]*u,o[2]=i[2]+a[2]*u,o[3]=i[3]+a[3]*u,o[4]=i[4]+a[4]*u,o[5]=i[5]+a[5]*u,o[6]=i[6]+a[6]*u,o[7]=i[7]+a[7]*u,o[8]=i[8]+a[8]*u,o},ii.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]},ii.equals=function(o,i){var a=o[0],u=o[1],d=o[2],m=o[3],_=o[4],b=o[5],T=o[6],S=o[7],A=o[8],k=i[0],R=i[1],L=i[2],U=i[3],H=i[4],G=i[5],Y=i[6],ue=i[7],ae=i[8];return Math.abs(a-k)<=co.EPSILON*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(u-R)<=co.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-L)<=co.EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(m-U)<=co.EPSILON*Math.max(1,Math.abs(m),Math.abs(U))&&Math.abs(_-H)<=co.EPSILON*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(b-G)<=co.EPSILON*Math.max(1,Math.abs(b),Math.abs(G))&&Math.abs(T-Y)<=co.EPSILON*Math.max(1,Math.abs(T),Math.abs(Y))&&Math.abs(S-ue)<=co.EPSILON*Math.max(1,Math.abs(S),Math.abs(ue))&&Math.abs(A-ae)<=co.EPSILON*Math.max(1,Math.abs(A),Math.abs(ae))},ii.sub=ii.mul=void 0;var co=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Jl(o)&&"function"!=typeof o)return{default:o};var a=Rg(void 0);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}(Ai);function Rg(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(Rg=function(u){return u?a:i})(o)}function Pg(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=i[8],R=a[0],L=a[1],U=a[2],H=a[3],G=a[4],Y=a[5],ue=a[6],ae=a[7],he=a[8];return o[0]=R*u+L*_+U*S,o[1]=R*d+L*b+U*A,o[2]=R*m+L*T+U*k,o[3]=H*u+G*_+Y*S,o[4]=H*d+G*b+Y*A,o[5]=H*m+G*T+Y*k,o[6]=ue*u+ae*_+he*S,o[7]=ue*d+ae*b+he*A,o[8]=ue*m+ae*T+he*k,o}function _d(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o[2]=i[2]-a[2],o[3]=i[3]-a[3],o[4]=i[4]-a[4],o[5]=i[5]-a[5],o[6]=i[6]-a[6],o[7]=i[7]-a[7],o[8]=i[8]-a[8],o}ii.mul=Pg,ii.sub=_d;var nr={};function yd(o){return(yd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(nr,"__esModule",{value:!0}),nr.create=function(){var o=new Li.ARRAY_TYPE(16);return Li.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},nr.clone=function(o){var i=new Li.ARRAY_TYPE(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},nr.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},nr.fromValues=function(o,i,a,u,d,m,_,b,T,S,A,k,R,L,U,H){var G=new Li.ARRAY_TYPE(16);return G[0]=o,G[1]=i,G[2]=a,G[3]=u,G[4]=d,G[5]=m,G[6]=_,G[7]=b,G[8]=T,G[9]=S,G[10]=A,G[11]=k,G[12]=R,G[13]=L,G[14]=U,G[15]=H,G},nr.set=function(o,i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G){return o[0]=i,o[1]=a,o[2]=u,o[3]=d,o[4]=m,o[5]=_,o[6]=b,o[7]=T,o[8]=S,o[9]=A,o[10]=k,o[11]=R,o[12]=L,o[13]=U,o[14]=H,o[15]=G,o},nr.identity=Rt,nr.transpose=function(o,i){if(o===i){var a=i[1],u=i[2],d=i[3],m=i[6],_=i[7],b=i[11];o[1]=i[4],o[2]=i[8],o[3]=i[12],o[4]=a,o[6]=i[9],o[7]=i[13],o[8]=u,o[9]=m,o[11]=i[14],o[12]=d,o[13]=_,o[14]=b}else o[0]=i[0],o[1]=i[4],o[2]=i[8],o[3]=i[12],o[4]=i[1],o[5]=i[5],o[6]=i[9],o[7]=i[13],o[8]=i[2],o[9]=i[6],o[10]=i[10],o[11]=i[14],o[12]=i[3],o[13]=i[7],o[14]=i[11],o[15]=i[15];return o},nr.invert=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=i[4],b=i[5],T=i[6],S=i[7],A=i[8],k=i[9],R=i[10],L=i[11],U=i[12],H=i[13],G=i[14],Y=i[15],ue=a*b-u*_,ae=a*T-d*_,he=a*S-m*_,ve=u*T-d*b,we=u*S-m*b,Se=d*S-m*T,Fe=A*H-k*U,Ge=A*G-R*U,tt=A*Y-L*U,Ye=k*G-R*H,ht=k*Y-L*H,Dt=R*Y-L*G,dt=ue*Dt-ae*ht+he*Ye+ve*tt-we*Ge+Se*Fe;return dt?(o[0]=(b*Dt-T*ht+S*Ye)*(dt=1/dt),o[1]=(d*ht-u*Dt-m*Ye)*dt,o[2]=(H*Se-G*we+Y*ve)*dt,o[3]=(R*we-k*Se-L*ve)*dt,o[4]=(T*tt-_*Dt-S*Ge)*dt,o[5]=(a*Dt-d*tt+m*Ge)*dt,o[6]=(G*he-U*Se-Y*ae)*dt,o[7]=(A*Se-R*he+L*ae)*dt,o[8]=(_*ht-b*tt+S*Fe)*dt,o[9]=(u*tt-a*ht-m*Fe)*dt,o[10]=(U*we-H*he+Y*ue)*dt,o[11]=(k*he-A*we-L*ue)*dt,o[12]=(b*Ge-_*Ye-T*Fe)*dt,o[13]=(a*Ye-u*Ge+d*Fe)*dt,o[14]=(H*ae-U*ve-G*ue)*dt,o[15]=(A*ve-k*ae+R*ue)*dt,o):null},nr.adjoint=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=i[4],b=i[5],T=i[6],S=i[7],A=i[8],k=i[9],R=i[10],L=i[11],U=i[12],H=i[13],G=i[14],Y=i[15];return o[0]=b*(R*Y-L*G)-k*(T*Y-S*G)+H*(T*L-S*R),o[1]=-(u*(R*Y-L*G)-k*(d*Y-m*G)+H*(d*L-m*R)),o[2]=u*(T*Y-S*G)-b*(d*Y-m*G)+H*(d*S-m*T),o[3]=-(u*(T*L-S*R)-b*(d*L-m*R)+k*(d*S-m*T)),o[4]=-(_*(R*Y-L*G)-A*(T*Y-S*G)+U*(T*L-S*R)),o[5]=a*(R*Y-L*G)-A*(d*Y-m*G)+U*(d*L-m*R),o[6]=-(a*(T*Y-S*G)-_*(d*Y-m*G)+U*(d*S-m*T)),o[7]=a*(T*L-S*R)-_*(d*L-m*R)+A*(d*S-m*T),o[8]=_*(k*Y-L*H)-A*(b*Y-S*H)+U*(b*L-S*k),o[9]=-(a*(k*Y-L*H)-A*(u*Y-m*H)+U*(u*L-m*k)),o[10]=a*(b*Y-S*H)-_*(u*Y-m*H)+U*(u*S-m*b),o[11]=-(a*(b*L-S*k)-_*(u*L-m*k)+A*(u*S-m*b)),o[12]=-(_*(k*G-R*H)-A*(b*G-T*H)+U*(b*R-T*k)),o[13]=a*(k*G-R*H)-A*(u*G-d*H)+U*(u*R-d*k),o[14]=-(a*(b*G-T*H)-_*(u*G-d*H)+U*(u*T-d*b)),o[15]=a*(b*R-T*k)-_*(u*R-d*k)+A*(u*T-d*b),o},nr.determinant=function(o){var i=o[0],a=o[1],u=o[2],d=o[3],m=o[4],_=o[5],b=o[6],T=o[7],S=o[8],A=o[9],k=o[10],R=o[11],L=o[12],U=o[13],H=o[14],G=o[15];return(i*_-a*m)*(k*G-R*H)-(i*b-u*m)*(A*G-R*U)+(i*T-d*m)*(A*H-k*U)+(a*b-u*_)*(S*G-R*L)-(a*T-d*_)*(S*H-k*L)+(u*T-d*b)*(S*U-A*L)},nr.multiply=an,nr.translate=function(o,i,a){var u,d,m,_,b,T,S,A,k,R,L,U,H=a[0],G=a[1],Y=a[2];return i===o?(o[12]=i[0]*H+i[4]*G+i[8]*Y+i[12],o[13]=i[1]*H+i[5]*G+i[9]*Y+i[13],o[14]=i[2]*H+i[6]*G+i[10]*Y+i[14],o[15]=i[3]*H+i[7]*G+i[11]*Y+i[15]):(d=i[1],m=i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=i[8],R=i[9],L=i[10],U=i[11],o[0]=u=i[0],o[1]=d,o[2]=m,o[3]=_,o[4]=b,o[5]=T,o[6]=S,o[7]=A,o[8]=k,o[9]=R,o[10]=L,o[11]=U,o[12]=u*H+b*G+k*Y+i[12],o[13]=d*H+T*G+R*Y+i[13],o[14]=m*H+S*G+L*Y+i[14],o[15]=_*H+A*G+U*Y+i[15]),o},nr.scale=function(o,i,a){var u=a[0],d=a[1],m=a[2];return o[0]=i[0]*u,o[1]=i[1]*u,o[2]=i[2]*u,o[3]=i[3]*u,o[4]=i[4]*d,o[5]=i[5]*d,o[6]=i[6]*d,o[7]=i[7]*d,o[8]=i[8]*m,o[9]=i[9]*m,o[10]=i[10]*m,o[11]=i[11]*m,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},nr.rotate=function(o,i,a,u){var d,m,_,b,T,S,A,k,R,L,U,H,G,Y,ue,ae,he,ve,we,Se,Fe,Ge,tt,Ye,ht=u[0],Dt=u[1],dt=u[2],Nt=Math.hypot(ht,Dt,dt);return Nt<Li.EPSILON?null:(ht*=Nt=1/Nt,Dt*=Nt,dt*=Nt,d=Math.sin(a),m=Math.cos(a),T=i[1],S=i[2],A=i[3],R=i[5],L=i[6],U=i[7],G=i[9],Y=i[10],ue=i[11],ae=ht*ht*(_=1-m)+m,we=ht*Dt*_-dt*d,Se=Dt*Dt*_+m,Fe=dt*Dt*_+ht*d,Ge=ht*dt*_+Dt*d,tt=Dt*dt*_-ht*d,Ye=dt*dt*_+m,o[0]=(b=i[0])*ae+(k=i[4])*(he=Dt*ht*_+dt*d)+(H=i[8])*(ve=dt*ht*_-Dt*d),o[1]=T*ae+R*he+G*ve,o[2]=S*ae+L*he+Y*ve,o[3]=A*ae+U*he+ue*ve,o[4]=b*we+k*Se+H*Fe,o[5]=T*we+R*Se+G*Fe,o[6]=S*we+L*Se+Y*Fe,o[7]=A*we+U*Se+ue*Fe,o[8]=b*Ge+k*tt+H*Ye,o[9]=T*Ge+R*tt+G*Ye,o[10]=S*Ge+L*tt+Y*Ye,o[11]=A*Ge+U*tt+ue*Ye,i!==o&&(o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o)},nr.rotateX=function(o,i,a){var u=Math.sin(a),d=Math.cos(a),m=i[4],_=i[5],b=i[6],T=i[7],S=i[8],A=i[9],k=i[10],R=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=m*d+S*u,o[5]=_*d+A*u,o[6]=b*d+k*u,o[7]=T*d+R*u,o[8]=S*d-m*u,o[9]=A*d-_*u,o[10]=k*d-b*u,o[11]=R*d-T*u,o},nr.rotateY=function(o,i,a){var u=Math.sin(a),d=Math.cos(a),m=i[0],_=i[1],b=i[2],T=i[3],S=i[8],A=i[9],k=i[10],R=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=m*d-S*u,o[1]=_*d-A*u,o[2]=b*d-k*u,o[3]=T*d-R*u,o[8]=m*u+S*d,o[9]=_*u+A*d,o[10]=b*u+k*d,o[11]=T*u+R*d,o},nr.rotateZ=function(o,i,a){var u=Math.sin(a),d=Math.cos(a),m=i[0],_=i[1],b=i[2],T=i[3],S=i[4],A=i[5],k=i[6],R=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=m*d+S*u,o[1]=_*d+A*u,o[2]=b*d+k*u,o[3]=T*d+R*u,o[4]=S*d-m*u,o[5]=A*d-_*u,o[6]=k*d-b*u,o[7]=R*d-T*u,o},nr.fromTranslation=function(o,i){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=i[0],o[13]=i[1],o[14]=i[2],o[15]=1,o},nr.fromScaling=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},nr.fromRotation=function(o,i,a){var u,d,m,_=a[0],b=a[1],T=a[2],S=Math.hypot(_,b,T);return S<Li.EPSILON?null:(_*=S=1/S,b*=S,T*=S,u=Math.sin(i),d=Math.cos(i),o[0]=_*_*(m=1-d)+d,o[1]=b*_*m+T*u,o[2]=T*_*m-b*u,o[3]=0,o[4]=_*b*m-T*u,o[5]=b*b*m+d,o[6]=T*b*m+_*u,o[7]=0,o[8]=_*T*m+b*u,o[9]=b*T*m-_*u,o[10]=T*T*m+d,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)},nr.fromXRotation=function(o,i){var a=Math.sin(i),u=Math.cos(i);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=a,o[7]=0,o[8]=0,o[9]=-a,o[10]=u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},nr.fromYRotation=function(o,i){var a=Math.sin(i),u=Math.cos(i);return o[0]=u,o[1]=0,o[2]=-a,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=a,o[9]=0,o[10]=u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},nr.fromZRotation=function(o,i){var a=Math.sin(i),u=Math.cos(i);return o[0]=u,o[1]=a,o[2]=0,o[3]=0,o[4]=-a,o[5]=u,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},nr.fromRotationTranslation=pn,nr.fromQuat2=function(o,i){var a=new Li.ARRAY_TYPE(3),u=-i[0],d=-i[1],m=-i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=u*u+d*d+m*m+_*_;return k>0?(a[0]=2*(b*_+A*u+T*m-S*d)/k,a[1]=2*(T*_+A*d+S*u-b*m)/k,a[2]=2*(S*_+A*m+b*d-T*u)/k):(a[0]=2*(b*_+A*u+T*m-S*d),a[1]=2*(T*_+A*d+S*u-b*m),a[2]=2*(S*_+A*m+b*d-T*u)),pn(o,i,a),o},nr.getTranslation=function(o,i){return o[0]=i[12],o[1]=i[13],o[2]=i[14],o},nr.getScaling=cr,nr.getRotation=function(o,i){var a=new Li.ARRAY_TYPE(3);cr(a,i);var u=1/a[0],d=1/a[1],m=1/a[2],_=i[0]*u,b=i[1]*d,T=i[2]*m,S=i[4]*u,A=i[5]*d,k=i[6]*m,R=i[8]*u,L=i[9]*d,U=i[10]*m,H=_+A+U,G=0;return H>0?(G=2*Math.sqrt(H+1),o[3]=.25*G,o[0]=(k-L)/G,o[1]=(R-T)/G,o[2]=(b-S)/G):_>A&&_>U?(G=2*Math.sqrt(1+_-A-U),o[3]=(k-L)/G,o[0]=.25*G,o[1]=(b+S)/G,o[2]=(R+T)/G):A>U?(G=2*Math.sqrt(1+A-_-U),o[3]=(R-T)/G,o[0]=(b+S)/G,o[1]=.25*G,o[2]=(k+L)/G):(G=2*Math.sqrt(1+U-_-A),o[3]=(b-S)/G,o[0]=(R+T)/G,o[1]=(k+L)/G,o[2]=.25*G),o},nr.fromRotationTranslationScale=function(o,i,a,u){var d=i[0],m=i[1],_=i[2],b=i[3],T=d+d,S=m+m,A=_+_,k=d*T,R=d*S,L=d*A,U=m*S,H=m*A,G=_*A,Y=b*T,ue=b*S,ae=b*A,he=u[0],ve=u[1],we=u[2];return o[0]=(1-(U+G))*he,o[1]=(R+ae)*he,o[2]=(L-ue)*he,o[3]=0,o[4]=(R-ae)*ve,o[5]=(1-(k+G))*ve,o[6]=(H+Y)*ve,o[7]=0,o[8]=(L+ue)*we,o[9]=(H-Y)*we,o[10]=(1-(k+U))*we,o[11]=0,o[12]=a[0],o[13]=a[1],o[14]=a[2],o[15]=1,o},nr.fromRotationTranslationScaleOrigin=function(o,i,a,u,d){var m=i[0],_=i[1],b=i[2],T=i[3],S=m+m,A=_+_,k=b+b,R=m*S,L=m*A,U=m*k,H=_*A,G=_*k,Y=b*k,ue=T*S,ae=T*A,he=T*k,ve=u[0],we=u[1],Se=u[2],Fe=d[0],Ge=d[1],tt=d[2],Ye=(1-(H+Y))*ve,ht=(L+he)*ve,Dt=(U-ae)*ve,dt=(L-he)*we,Nt=(1-(R+Y))*we,ut=(G+ue)*we,vt=(U+ae)*Se,zt=(G-ue)*Se,ct=(1-(R+H))*Se;return o[0]=Ye,o[1]=ht,o[2]=Dt,o[3]=0,o[4]=dt,o[5]=Nt,o[6]=ut,o[7]=0,o[8]=vt,o[9]=zt,o[10]=ct,o[11]=0,o[12]=a[0]+Fe-(Ye*Fe+dt*Ge+vt*tt),o[13]=a[1]+Ge-(ht*Fe+Nt*Ge+zt*tt),o[14]=a[2]+tt-(Dt*Fe+ut*Ge+ct*tt),o[15]=1,o},nr.fromQuat=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=a+a,b=u+u,T=d+d,S=a*_,A=u*_,k=u*b,R=d*_,L=d*b,U=d*T,H=m*_,G=m*b,Y=m*T;return o[0]=1-k-U,o[1]=A+Y,o[2]=R-G,o[3]=0,o[4]=A-Y,o[5]=1-S-U,o[6]=L+H,o[7]=0,o[8]=R+G,o[9]=L-H,o[10]=1-S-k,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},nr.frustum=function(o,i,a,u,d,m,_){var b=1/(a-i),T=1/(d-u),S=1/(m-_);return o[0]=2*m*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*m*T,o[6]=0,o[7]=0,o[8]=(a+i)*b,o[9]=(d+u)*T,o[10]=(_+m)*S,o[11]=-1,o[12]=0,o[13]=0,o[14]=_*m*2*S,o[15]=0,o},nr.perspectiveNO=hn,nr.perspectiveZO=function(o,i,a,u,d){var m,_=1/Math.tan(i/2);return o[0]=_/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=d&&d!==1/0?(o[10]=d*(m=1/(u-d)),o[14]=d*u*m):(o[10]=-1,o[14]=-u),o},nr.perspectiveFromFieldOfView=function(o,i,a,u){var d=Math.tan(i.upDegrees*Math.PI/180),m=Math.tan(i.downDegrees*Math.PI/180),_=Math.tan(i.leftDegrees*Math.PI/180),b=Math.tan(i.rightDegrees*Math.PI/180),T=2/(_+b),S=2/(d+m);return o[0]=T,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=S,o[6]=0,o[7]=0,o[8]=-(_-b)*T*.5,o[9]=(d-m)*S*.5,o[10]=u/(a-u),o[11]=-1,o[12]=0,o[13]=0,o[14]=u*a/(a-u),o[15]=0,o},nr.orthoNO=ns,nr.orthoZO=function(o,i,a,u,d,m,_){var b=1/(i-a),T=1/(u-d),S=1/(m-_);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=S,o[11]=0,o[12]=(i+a)*b,o[13]=(d+u)*T,o[14]=m*S,o[15]=1,o},nr.lookAt=function(o,i,a,u){var d,m,_,b,T,S,A,k,R,L,U=i[0],H=i[1],G=i[2],Y=u[0],ue=u[1],ae=u[2],he=a[0],ve=a[1],we=a[2];return Math.abs(U-he)<Li.EPSILON&&Math.abs(H-ve)<Li.EPSILON&&Math.abs(G-we)<Li.EPSILON?Rt(o):(A=U-he,k=H-ve,R=G-we,d=ue*(R*=L=1/Math.hypot(A,k,R))-ae*(k*=L),m=ae*(A*=L)-Y*R,_=Y*k-ue*A,(L=Math.hypot(d,m,_))?(d*=L=1/L,m*=L,_*=L):(d=0,m=0,_=0),b=k*_-R*m,T=R*d-A*_,S=A*m-k*d,(L=Math.hypot(b,T,S))?(b*=L=1/L,T*=L,S*=L):(b=0,T=0,S=0),o[0]=d,o[1]=b,o[2]=A,o[3]=0,o[4]=m,o[5]=T,o[6]=k,o[7]=0,o[8]=_,o[9]=S,o[10]=R,o[11]=0,o[12]=-(d*U+m*H+_*G),o[13]=-(b*U+T*H+S*G),o[14]=-(A*U+k*H+R*G),o[15]=1,o)},nr.targetTo=function(o,i,a,u){var d=i[0],m=i[1],_=i[2],b=u[0],T=u[1],S=u[2],A=d-a[0],k=m-a[1],R=_-a[2],L=A*A+k*k+R*R;L>0&&(A*=L=1/Math.sqrt(L),k*=L,R*=L);var U=T*R-S*k,H=S*A-b*R,G=b*k-T*A;return(L=U*U+H*H+G*G)>0&&(U*=L=1/Math.sqrt(L),H*=L,G*=L),o[0]=U,o[1]=H,o[2]=G,o[3]=0,o[4]=k*G-R*H,o[5]=R*U-A*G,o[6]=A*H-k*U,o[7]=0,o[8]=A,o[9]=k,o[10]=R,o[11]=0,o[12]=d,o[13]=m,o[14]=_,o[15]=1,o},nr.str=function(o){return"mat4("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+", "+o[8]+", "+o[9]+", "+o[10]+", "+o[11]+", "+o[12]+", "+o[13]+", "+o[14]+", "+o[15]+")"},nr.frob=function(o){return Math.hypot(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15])},nr.add=function(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o[3]=i[3]+a[3],o[4]=i[4]+a[4],o[5]=i[5]+a[5],o[6]=i[6]+a[6],o[7]=i[7]+a[7],o[8]=i[8]+a[8],o[9]=i[9]+a[9],o[10]=i[10]+a[10],o[11]=i[11]+a[11],o[12]=i[12]+a[12],o[13]=i[13]+a[13],o[14]=i[14]+a[14],o[15]=i[15]+a[15],o},nr.subtract=Bi,nr.multiplyScalar=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o[3]=i[3]*a,o[4]=i[4]*a,o[5]=i[5]*a,o[6]=i[6]*a,o[7]=i[7]*a,o[8]=i[8]*a,o[9]=i[9]*a,o[10]=i[10]*a,o[11]=i[11]*a,o[12]=i[12]*a,o[13]=i[13]*a,o[14]=i[14]*a,o[15]=i[15]*a,o},nr.multiplyScalarAndAdd=function(o,i,a,u){return o[0]=i[0]+a[0]*u,o[1]=i[1]+a[1]*u,o[2]=i[2]+a[2]*u,o[3]=i[3]+a[3]*u,o[4]=i[4]+a[4]*u,o[5]=i[5]+a[5]*u,o[6]=i[6]+a[6]*u,o[7]=i[7]+a[7]*u,o[8]=i[8]+a[8]*u,o[9]=i[9]+a[9]*u,o[10]=i[10]+a[10]*u,o[11]=i[11]+a[11]*u,o[12]=i[12]+a[12]*u,o[13]=i[13]+a[13]*u,o[14]=i[14]+a[14]*u,o[15]=i[15]+a[15]*u,o},nr.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},nr.equals=function(o,i){var a=o[0],u=o[1],d=o[2],m=o[3],_=o[4],b=o[5],T=o[6],S=o[7],A=o[8],k=o[9],R=o[10],L=o[11],U=o[12],H=o[13],G=o[14],Y=o[15],ue=i[0],ae=i[1],he=i[2],ve=i[3],we=i[4],Se=i[5],Fe=i[6],Ge=i[7],tt=i[8],Ye=i[9],ht=i[10],Dt=i[11],dt=i[12],Nt=i[13],ut=i[14],vt=i[15];return Math.abs(a-ue)<=Li.EPSILON*Math.max(1,Math.abs(a),Math.abs(ue))&&Math.abs(u-ae)<=Li.EPSILON*Math.max(1,Math.abs(u),Math.abs(ae))&&Math.abs(d-he)<=Li.EPSILON*Math.max(1,Math.abs(d),Math.abs(he))&&Math.abs(m-ve)<=Li.EPSILON*Math.max(1,Math.abs(m),Math.abs(ve))&&Math.abs(_-we)<=Li.EPSILON*Math.max(1,Math.abs(_),Math.abs(we))&&Math.abs(b-Se)<=Li.EPSILON*Math.max(1,Math.abs(b),Math.abs(Se))&&Math.abs(T-Fe)<=Li.EPSILON*Math.max(1,Math.abs(T),Math.abs(Fe))&&Math.abs(S-Ge)<=Li.EPSILON*Math.max(1,Math.abs(S),Math.abs(Ge))&&Math.abs(A-tt)<=Li.EPSILON*Math.max(1,Math.abs(A),Math.abs(tt))&&Math.abs(k-Ye)<=Li.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ye))&&Math.abs(R-ht)<=Li.EPSILON*Math.max(1,Math.abs(R),Math.abs(ht))&&Math.abs(L-Dt)<=Li.EPSILON*Math.max(1,Math.abs(L),Math.abs(Dt))&&Math.abs(U-dt)<=Li.EPSILON*Math.max(1,Math.abs(U),Math.abs(dt))&&Math.abs(H-Nt)<=Li.EPSILON*Math.max(1,Math.abs(H),Math.abs(Nt))&&Math.abs(G-ut)<=Li.EPSILON*Math.max(1,Math.abs(G),Math.abs(ut))&&Math.abs(Y-vt)<=Li.EPSILON*Math.max(1,Math.abs(Y),Math.abs(vt))},nr.sub=nr.mul=nr.ortho=nr.perspective=void 0;var Li=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==yd(o)&&"function"!=typeof o)return{default:o};var a=wt(void 0);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}(Ai);function wt(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(wt=function(u){return u?a:i})(o)}function Rt(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function an(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=i[8],R=i[9],L=i[10],U=i[11],H=i[12],G=i[13],Y=i[14],ue=i[15],ae=a[0],he=a[1],ve=a[2],we=a[3];return o[0]=ae*u+he*b+ve*k+we*H,o[1]=ae*d+he*T+ve*R+we*G,o[2]=ae*m+he*S+ve*L+we*Y,o[3]=ae*_+he*A+ve*U+we*ue,o[4]=(ae=a[4])*u+(he=a[5])*b+(ve=a[6])*k+(we=a[7])*H,o[5]=ae*d+he*T+ve*R+we*G,o[6]=ae*m+he*S+ve*L+we*Y,o[7]=ae*_+he*A+ve*U+we*ue,o[8]=(ae=a[8])*u+(he=a[9])*b+(ve=a[10])*k+(we=a[11])*H,o[9]=ae*d+he*T+ve*R+we*G,o[10]=ae*m+he*S+ve*L+we*Y,o[11]=ae*_+he*A+ve*U+we*ue,o[12]=(ae=a[12])*u+(he=a[13])*b+(ve=a[14])*k+(we=a[15])*H,o[13]=ae*d+he*T+ve*R+we*G,o[14]=ae*m+he*S+ve*L+we*Y,o[15]=ae*_+he*A+ve*U+we*ue,o}function pn(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=u+u,T=d+d,S=m+m,A=u*b,k=u*T,R=u*S,L=d*T,U=d*S,H=m*S,G=_*b,Y=_*T,ue=_*S;return o[0]=1-(L+H),o[1]=k+ue,o[2]=R-Y,o[3]=0,o[4]=k-ue,o[5]=1-(A+H),o[6]=U+G,o[7]=0,o[8]=R+Y,o[9]=U-G,o[10]=1-(A+L),o[11]=0,o[12]=a[0],o[13]=a[1],o[14]=a[2],o[15]=1,o}function cr(o,i){var a=i[4],u=i[5],d=i[6],m=i[8],_=i[9],b=i[10];return o[0]=Math.hypot(i[0],i[1],i[2]),o[1]=Math.hypot(a,u,d),o[2]=Math.hypot(m,_,b),o}function hn(o,i,a,u,d){var m,_=1/Math.tan(i/2);return o[0]=_/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=d&&d!==1/0?(o[10]=(d+u)*(m=1/(u-d)),o[14]=2*d*u*m):(o[10]=-1,o[14]=-2*u),o}function ns(o,i,a,u,d,m,_){var b=1/(i-a),T=1/(u-d),S=1/(m-_);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*S,o[11]=0,o[12]=(i+a)*b,o[13]=(d+u)*T,o[14]=(_+m)*S,o[15]=1,o}function Bi(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o[2]=i[2]-a[2],o[3]=i[3]-a[3],o[4]=i[4]-a[4],o[5]=i[5]-a[5],o[6]=i[6]-a[6],o[7]=i[7]-a[7],o[8]=i[8]-a[8],o[9]=i[9]-a[9],o[10]=i[10]-a[10],o[11]=i[11]-a[11],o[12]=i[12]-a[12],o[13]=i[13]-a[13],o[14]=i[14]-a[14],o[15]=i[15]-a[15],o}nr.perspective=hn,nr.ortho=ns,nr.mul=an,nr.sub=Bi;var mn={},dn={};function Ja(o){return(Ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(dn,"__esModule",{value:!0}),dn.create=Qa,dn.clone=function(o){var i=new Js.ARRAY_TYPE(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i},dn.length=qs,dn.fromValues=function(o,i,a){var u=new Js.ARRAY_TYPE(3);return u[0]=o,u[1]=i,u[2]=a,u},dn.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o},dn.set=function(o,i,a,u){return o[0]=i,o[1]=a,o[2]=u,o},dn.add=function(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o},dn.subtract=qc,dn.multiply=ji,dn.divide=el,dn.ceil=function(o,i){return o[0]=Math.ceil(i[0]),o[1]=Math.ceil(i[1]),o[2]=Math.ceil(i[2]),o},dn.floor=function(o,i){return o[0]=Math.floor(i[0]),o[1]=Math.floor(i[1]),o[2]=Math.floor(i[2]),o},dn.min=function(o,i,a){return o[0]=Math.min(i[0],a[0]),o[1]=Math.min(i[1],a[1]),o[2]=Math.min(i[2],a[2]),o},dn.max=function(o,i,a){return o[0]=Math.max(i[0],a[0]),o[1]=Math.max(i[1],a[1]),o[2]=Math.max(i[2],a[2]),o},dn.round=function(o,i){return o[0]=Math.round(i[0]),o[1]=Math.round(i[1]),o[2]=Math.round(i[2]),o},dn.scale=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o},dn.scaleAndAdd=function(o,i,a,u){return o[0]=i[0]+a[0]*u,o[1]=i[1]+a[1]*u,o[2]=i[2]+a[2]*u,o},dn.distance=ch,dn.squaredDistance=vd,dn.squaredLength=Zc,dn.negate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o},dn.inverse=function(o,i){return o[0]=1/i[0],o[1]=1/i[1],o[2]=1/i[2],o},dn.normalize=function(o,i){var a=i[0],u=i[1],d=i[2],m=a*a+u*u+d*d;return m>0&&(m=1/Math.sqrt(m)),o[0]=i[0]*m,o[1]=i[1]*m,o[2]=i[2]*m,o},dn.dot=Ql,dn.cross=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=a[0],b=a[1],T=a[2];return o[0]=d*T-m*b,o[1]=m*_-u*T,o[2]=u*b-d*_,o},dn.lerp=function(o,i,a,u){var d=i[0],m=i[1],_=i[2];return o[0]=d+u*(a[0]-d),o[1]=m+u*(a[1]-m),o[2]=_+u*(a[2]-_),o},dn.hermite=function(o,i,a,u,d,m){var _=m*m,b=_*(2*m-3)+1,T=_*(m-2)+m,S=_*(m-1),A=_*(3-2*m);return o[0]=i[0]*b+a[0]*T+u[0]*S+d[0]*A,o[1]=i[1]*b+a[1]*T+u[1]*S+d[1]*A,o[2]=i[2]*b+a[2]*T+u[2]*S+d[2]*A,o},dn.bezier=function(o,i,a,u,d,m){var _=1-m,b=_*_,T=m*m,S=b*_,A=3*m*b,k=3*T*_,R=T*m;return o[0]=i[0]*S+a[0]*A+u[0]*k+d[0]*R,o[1]=i[1]*S+a[1]*A+u[1]*k+d[1]*R,o[2]=i[2]*S+a[2]*A+u[2]*k+d[2]*R,o},dn.random=function(o,i){i=i||1;var a=2*Js.RANDOM()*Math.PI,u=2*Js.RANDOM()-1,d=Math.sqrt(1-u*u)*i;return o[0]=Math.cos(a)*d,o[1]=Math.sin(a)*d,o[2]=u*i,o},dn.transformMat4=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=a[3]*u+a[7]*d+a[11]*m+a[15];return o[0]=(a[0]*u+a[4]*d+a[8]*m+a[12])/(_=_||1),o[1]=(a[1]*u+a[5]*d+a[9]*m+a[13])/_,o[2]=(a[2]*u+a[6]*d+a[10]*m+a[14])/_,o},dn.transformMat3=function(o,i,a){var u=i[0],d=i[1],m=i[2];return o[0]=u*a[0]+d*a[3]+m*a[6],o[1]=u*a[1]+d*a[4]+m*a[7],o[2]=u*a[2]+d*a[5]+m*a[8],o},dn.transformQuat=function(o,i,a){var u=a[0],d=a[1],m=a[2],_=i[0],b=i[1],T=i[2],S=d*T-m*b,A=m*_-u*T,k=u*b-d*_,R=d*k-m*A,L=m*S-u*k,U=u*A-d*S,H=2*a[3];return A*=H,k*=H,L*=2,U*=2,o[0]=_+(S*=H)+(R*=2),o[1]=b+A+L,o[2]=T+k+U,o},dn.rotateX=function(o,i,a,u){var d=[],m=[];return d[0]=i[0]-a[0],d[1]=i[1]-a[1],d[2]=i[2]-a[2],m[0]=d[0],m[1]=d[1]*Math.cos(u)-d[2]*Math.sin(u),m[2]=d[1]*Math.sin(u)+d[2]*Math.cos(u),o[0]=m[0]+a[0],o[1]=m[1]+a[1],o[2]=m[2]+a[2],o},dn.rotateY=function(o,i,a,u){var d=[],m=[];return d[0]=i[0]-a[0],d[1]=i[1]-a[1],d[2]=i[2]-a[2],m[0]=d[2]*Math.sin(u)+d[0]*Math.cos(u),m[1]=d[1],m[2]=d[2]*Math.cos(u)-d[0]*Math.sin(u),o[0]=m[0]+a[0],o[1]=m[1]+a[1],o[2]=m[2]+a[2],o},dn.rotateZ=function(o,i,a,u){var d=[],m=[];return d[0]=i[0]-a[0],d[1]=i[1]-a[1],d[2]=i[2]-a[2],m[0]=d[0]*Math.cos(u)-d[1]*Math.sin(u),m[1]=d[0]*Math.sin(u)+d[1]*Math.cos(u),m[2]=d[2],o[0]=m[0]+a[0],o[1]=m[1]+a[1],o[2]=m[2]+a[2],o},dn.angle=function(o,i){var a=o[0],u=o[1],d=o[2],m=i[0],_=i[1],b=i[2],T=Math.sqrt(a*a+u*u+d*d)*Math.sqrt(m*m+_*_+b*b),S=T&&Ql(o,i)/T;return Math.acos(Math.min(Math.max(S,-1),1))},dn.zero=function(o){return o[0]=0,o[1]=0,o[2]=0,o},dn.str=function(o){return"vec3("+o[0]+", "+o[1]+", "+o[2]+")"},dn.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]},dn.equals=function(o,i){var a=o[0],u=o[1],d=o[2],m=i[0],_=i[1],b=i[2];return Math.abs(a-m)<=Js.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(u-_)<=Js.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(d-b)<=Js.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},dn.forEach=dn.sqrLen=dn.len=dn.sqrDist=dn.dist=dn.div=dn.mul=dn.sub=void 0;var Js=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Ja(o)&&"function"!=typeof o)return{default:o};var a=Ma(void 0);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}(Ai);function Ma(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(Ma=function(u){return u?a:i})(o)}function Qa(){var o=new Js.ARRAY_TYPE(3);return Js.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function qs(o){return Math.hypot(o[0],o[1],o[2])}function qc(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o[2]=i[2]-a[2],o}function ji(o,i,a){return o[0]=i[0]*a[0],o[1]=i[1]*a[1],o[2]=i[2]*a[2],o}function el(o,i,a){return o[0]=i[0]/a[0],o[1]=i[1]/a[1],o[2]=i[2]/a[2],o}function ch(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2])}function vd(o,i){var a=i[0]-o[0],u=i[1]-o[1],d=i[2]-o[2];return a*a+u*u+d*d}function Zc(o){var i=o[0],a=o[1],u=o[2];return i*i+a*a+u*u}function Ql(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]}dn.sub=qc,dn.mul=ji,dn.div=el,dn.dist=ch,dn.sqrDist=vd,dn.len=qs,dn.sqrLen=Zc;var Aa,Ia=(Aa=Qa(),function(o,i,a,u,d,m){var _,b;for(i||(i=3),a||(a=0),b=u?Math.min(u*i+a,o.length):o.length,_=a;_<b;_+=i)Aa[0]=o[_],Aa[1]=o[_+1],Aa[2]=o[_+2],d(Aa,Aa,m),o[_]=Aa[0],o[_+1]=Aa[1],o[_+2]=Aa[2];return o});dn.forEach=Ia;var sr={};function Cf(o){return(Cf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(sr,"__esModule",{value:!0}),sr.create=wu,sr.clone=function(o){var i=new So.ARRAY_TYPE(4);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i},sr.fromValues=function(o,i,a,u){var d=new So.ARRAY_TYPE(4);return d[0]=o,d[1]=i,d[2]=a,d[3]=u,d},sr.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o},sr.set=function(o,i,a,u,d){return o[0]=i,o[1]=a,o[2]=u,o[3]=d,o},sr.add=function(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o[3]=i[3]+a[3],o},sr.subtract=ka,sr.multiply=Sf,sr.divide=xd,sr.ceil=function(o,i){return o[0]=Math.ceil(i[0]),o[1]=Math.ceil(i[1]),o[2]=Math.ceil(i[2]),o[3]=Math.ceil(i[3]),o},sr.floor=function(o,i){return o[0]=Math.floor(i[0]),o[1]=Math.floor(i[1]),o[2]=Math.floor(i[2]),o[3]=Math.floor(i[3]),o},sr.min=function(o,i,a){return o[0]=Math.min(i[0],a[0]),o[1]=Math.min(i[1],a[1]),o[2]=Math.min(i[2],a[2]),o[3]=Math.min(i[3],a[3]),o},sr.max=function(o,i,a){return o[0]=Math.max(i[0],a[0]),o[1]=Math.max(i[1],a[1]),o[2]=Math.max(i[2],a[2]),o[3]=Math.max(i[3],a[3]),o},sr.round=function(o,i){return o[0]=Math.round(i[0]),o[1]=Math.round(i[1]),o[2]=Math.round(i[2]),o[3]=Math.round(i[3]),o},sr.scale=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o[3]=i[3]*a,o},sr.scaleAndAdd=function(o,i,a,u){return o[0]=i[0]+a[0]*u,o[1]=i[1]+a[1]*u,o[2]=i[2]+a[2]*u,o[3]=i[3]+a[3]*u,o},sr.distance=Df,sr.squaredDistance=Tu,sr.length=tl,sr.squaredLength=Mf,sr.negate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=-i[3],o},sr.inverse=function(o,i){return o[0]=1/i[0],o[1]=1/i[1],o[2]=1/i[2],o[3]=1/i[3],o},sr.normalize=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=a*a+u*u+d*d+m*m;return _>0&&(_=1/Math.sqrt(_)),o[0]=a*_,o[1]=u*_,o[2]=d*_,o[3]=m*_,o},sr.dot=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]},sr.cross=function(o,i,a,u){var d=a[0]*u[1]-a[1]*u[0],m=a[0]*u[2]-a[2]*u[0],_=a[0]*u[3]-a[3]*u[0],b=a[1]*u[2]-a[2]*u[1],T=a[1]*u[3]-a[3]*u[1],S=a[2]*u[3]-a[3]*u[2],A=i[0],k=i[1],R=i[2],L=i[3];return o[0]=k*S-R*T+L*b,o[1]=-A*S+R*_-L*m,o[2]=A*T-k*_+L*d,o[3]=-A*b+k*m-R*d,o},sr.lerp=function(o,i,a,u){var d=i[0],m=i[1],_=i[2],b=i[3];return o[0]=d+u*(a[0]-d),o[1]=m+u*(a[1]-m),o[2]=_+u*(a[2]-_),o[3]=b+u*(a[3]-b),o},sr.random=function(o,i){var a,u,d,m,_,b;i=i||1;do{_=(a=2*So.RANDOM()-1)*a+(u=2*So.RANDOM()-1)*u}while(_>=1);do{b=(d=2*So.RANDOM()-1)*d+(m=2*So.RANDOM()-1)*m}while(b>=1);var T=Math.sqrt((1-_)/b);return o[0]=i*a,o[1]=i*u,o[2]=i*d*T,o[3]=i*m*T,o},sr.transformMat4=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3];return o[0]=a[0]*u+a[4]*d+a[8]*m+a[12]*_,o[1]=a[1]*u+a[5]*d+a[9]*m+a[13]*_,o[2]=a[2]*u+a[6]*d+a[10]*m+a[14]*_,o[3]=a[3]*u+a[7]*d+a[11]*m+a[15]*_,o},sr.transformQuat=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=a[0],b=a[1],T=a[2],S=a[3],A=S*u+b*m-T*d,k=S*d+T*u-_*m,R=S*m+_*d-b*u,L=-_*u-b*d-T*m;return o[0]=A*S+L*-_+k*-T-R*-b,o[1]=k*S+L*-b+R*-_-A*-T,o[2]=R*S+L*-T+A*-b-k*-_,o[3]=i[3],o},sr.zero=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=0,o},sr.str=function(o){return"vec4("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},sr.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},sr.equals=function(o,i){var a=o[0],u=o[1],d=o[2],m=o[3],_=i[0],b=i[1],T=i[2],S=i[3];return Math.abs(a-_)<=So.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-b)<=So.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-T)<=So.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(m-S)<=So.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},sr.forEach=sr.sqrLen=sr.len=sr.sqrDist=sr.dist=sr.div=sr.mul=sr.sub=void 0;var So=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Cf(o)&&"function"!=typeof o)return{default:o};var a=Tc(void 0);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}(Ai);function Tc(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(Tc=function(u){return u?a:i})(o)}function wu(){var o=new So.ARRAY_TYPE(4);return So.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function ka(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o[2]=i[2]-a[2],o[3]=i[3]-a[3],o}function Sf(o,i,a){return o[0]=i[0]*a[0],o[1]=i[1]*a[1],o[2]=i[2]*a[2],o[3]=i[3]*a[3],o}function xd(o,i,a){return o[0]=i[0]/a[0],o[1]=i[1]/a[1],o[2]=i[2]/a[2],o[3]=i[3]/a[3],o}function Df(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2],i[3]-o[3])}function Tu(o,i){var a=i[0]-o[0],u=i[1]-o[1],d=i[2]-o[2],m=i[3]-o[3];return a*a+u*u+d*d+m*m}function tl(o){return Math.hypot(o[0],o[1],o[2],o[3])}function Mf(o){var i=o[0],a=o[1],u=o[2],d=o[3];return i*i+a*a+u*u+d*d}sr.sub=ka,sr.mul=Sf,sr.div=xd,sr.dist=Df,sr.sqrDist=Tu,sr.len=tl,sr.sqrLen=Mf;var o,Eu=(o=wu(),function(i,a,u,d,m,_){var b,T;for(a||(a=4),u||(u=0),T=d?Math.min(d*a+u,i.length):i.length,b=u;b<T;b+=a)o[0]=i[b],o[1]=i[b+1],o[2]=i[b+2],o[3]=i[b+3],m(o,o,_),i[b]=o[0],i[b+1]=o[1],i[b+2]=o[2],i[b+3]=o[3];return i});function $i(o){return($i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}sr.forEach=Eu,Object.defineProperty(mn,"__esModule",{value:!0}),mn.create=Vo,mn.identity=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o},mn.setAxisAngle=Bs,mn.getAxisAngle=function(o,i){var a=2*Math.acos(i[3]),u=Math.sin(a/2);return u>Dl.EPSILON?(o[0]=i[0]/u,o[1]=i[1]/u,o[2]=i[2]/u):(o[0]=1,o[1]=0,o[2]=0),a},mn.getAngle=function(o,i){var a=Ce(o,i);return Math.acos(2*a*a-1)},mn.multiply=ys,mn.rotateX=function(o,i,a){a*=.5;var u=i[0],d=i[1],m=i[2],_=i[3],b=Math.sin(a),T=Math.cos(a);return o[0]=u*T+_*b,o[1]=d*T+m*b,o[2]=m*T-d*b,o[3]=_*T-u*b,o},mn.rotateY=function(o,i,a){a*=.5;var u=i[0],d=i[1],m=i[2],_=i[3],b=Math.sin(a),T=Math.cos(a);return o[0]=u*T-m*b,o[1]=d*T+_*b,o[2]=m*T+u*b,o[3]=_*T-d*b,o},mn.rotateZ=function(o,i,a){a*=.5;var u=i[0],d=i[1],m=i[2],_=i[3],b=Math.sin(a),T=Math.cos(a);return o[0]=u*T+d*b,o[1]=d*T-u*b,o[2]=m*T+_*b,o[3]=_*T-m*b,o},mn.calculateW=function(o,i){var a=i[0],u=i[1],d=i[2];return o[0]=a,o[1]=u,o[2]=d,o[3]=Math.sqrt(Math.abs(1-a*a-u*u-d*d)),o},mn.exp=Me,mn.ln=K,mn.pow=function(o,i,a){return K(o,i),Ae(o,o,a),Me(o,o),o},mn.slerp=J,mn.random=function(o){var i=Dl.RANDOM(),a=Dl.RANDOM(),u=Dl.RANDOM(),d=Math.sqrt(1-i),m=Math.sqrt(i);return o[0]=d*Math.sin(2*Math.PI*a),o[1]=d*Math.cos(2*Math.PI*a),o[2]=m*Math.sin(2*Math.PI*u),o[3]=m*Math.cos(2*Math.PI*u),o},mn.invert=function(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=a*a+u*u+d*d+m*m,b=_?1/_:0;return o[0]=-a*b,o[1]=-u*b,o[2]=-d*b,o[3]=m*b,o},mn.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o},mn.fromMat3=me,mn.fromEuler=function(o,i,a,u){var d=.5*Math.PI/180;i*=d,a*=d,u*=d;var m=Math.sin(i),_=Math.cos(i),b=Math.sin(a),T=Math.cos(a),S=Math.sin(u),A=Math.cos(u);return o[0]=m*T*A-_*b*S,o[1]=_*b*A+m*T*S,o[2]=_*T*S-m*b*A,o[3]=_*T*A+m*b*S,o},mn.str=function(o){return"quat("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")"},mn.setAxes=mn.sqlerp=mn.rotationTo=mn.equals=mn.exactEquals=mn.normalize=mn.sqrLen=mn.squaredLength=mn.len=mn.length=mn.lerp=mn.dot=mn.scale=mn.mul=mn.add=mn.set=mn.copy=mn.fromValues=mn.clone=void 0;var Dl=uh(Ai),z_=uh(ii),ec=uh(dn),Do=uh(sr);function Ii(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(Ii=function(u){return u?a:i})(o)}function uh(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==$i(o)&&"function"!=typeof o)return{default:o};var a=Ii(i);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}function Vo(){var o=new Dl.ARRAY_TYPE(4);return Dl.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Bs(o,i,a){a*=.5;var u=Math.sin(a);return o[0]=u*i[0],o[1]=u*i[1],o[2]=u*i[2],o[3]=Math.cos(a),o}function ys(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=a[0],T=a[1],S=a[2],A=a[3];return o[0]=u*A+_*b+d*S-m*T,o[1]=d*A+_*T+m*b-u*S,o[2]=m*A+_*S+u*T-d*b,o[3]=_*A-u*b-d*T-m*S,o}function Me(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=Math.sqrt(a*a+u*u+d*d),b=Math.exp(m),T=_>0?b*Math.sin(_)/_:0;return o[0]=a*T,o[1]=u*T,o[2]=d*T,o[3]=b*Math.cos(_),o}function K(o,i){var a=i[0],u=i[1],d=i[2],m=i[3],_=Math.sqrt(a*a+u*u+d*d),b=_>0?Math.atan2(_,m)/_:0;return o[0]=a*b,o[1]=u*b,o[2]=d*b,o[3]=.5*Math.log(a*a+u*u+d*d+m*m),o}function J(o,i,a,u){var d,m,_,b,T,S=i[0],A=i[1],k=i[2],R=i[3],L=a[0],U=a[1],H=a[2],G=a[3];return(m=S*L+A*U+k*H+R*G)<0&&(m=-m,L=-L,U=-U,H=-H,G=-G),1-m>Dl.EPSILON?(d=Math.acos(m),_=Math.sin(d),b=Math.sin((1-u)*d)/_,T=Math.sin(u*d)/_):(b=1-u,T=u),o[0]=b*S+T*L,o[1]=b*A+T*U,o[2]=b*k+T*H,o[3]=b*R+T*G,o}function me(o,i){var a,u=i[0]+i[4]+i[8];if(u>0)a=Math.sqrt(u+1),o[3]=.5*a,o[0]=(i[5]-i[7])*(a=.5/a),o[1]=(i[6]-i[2])*a,o[2]=(i[1]-i[3])*a;else{var d=0;i[4]>i[0]&&(d=1),i[8]>i[3*d+d]&&(d=2);var m=(d+1)%3,_=(d+2)%3;a=Math.sqrt(i[3*d+d]-i[3*m+m]-i[3*_+_]+1),o[d]=.5*a,o[3]=(i[3*m+_]-i[3*_+m])*(a=.5/a),o[m]=(i[3*m+d]+i[3*d+m])*a,o[_]=(i[3*_+d]+i[3*d+_])*a}return o}mn.clone=Do.clone,mn.fromValues=Do.fromValues,mn.copy=Do.copy,mn.set=Do.set,mn.add=Do.add,mn.mul=ys;var Ae=Do.scale;mn.scale=Ae;var Ce=Do.dot;mn.dot=Ce,mn.lerp=Do.lerp;var $e=Do.length;mn.length=$e,mn.len=$e;var st=Do.squaredLength;mn.squaredLength=st,mn.sqrLen=st;var Ue=Do.normalize;mn.normalize=Ue,mn.exactEquals=Do.exactEquals,mn.equals=Do.equals;var it,Et,Ct,yt=(it=ec.create(),Et=ec.fromValues(1,0,0),Ct=ec.fromValues(0,1,0),function(o,i,a){var u=ec.dot(i,a);return u<-.999999?(ec.cross(it,Et,i),ec.len(it)<1e-6&&ec.cross(it,Ct,i),ec.normalize(it,it),Bs(o,it,Math.PI),o):u>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(ec.cross(it,i,a),o[0]=it[0],o[1]=it[1],o[2]=it[2],o[3]=1+u,Ue(o,o))});mn.rotationTo=yt;var Nn,Qn,$r=(Nn=Vo(),Qn=Vo(),function(o,i,a,u,d,m){return J(Nn,i,d,m),J(Qn,a,u,m),J(o,Nn,Qn,2*m*(1-m)),o});mn.sqlerp=$r;var gr,zr=(gr=z_.create(),function(o,i,a,u){return gr[0]=a[0],gr[3]=a[1],gr[6]=a[2],gr[1]=u[0],gr[4]=u[1],gr[7]=u[2],gr[2]=-i[0],gr[5]=-i[1],gr[8]=-i[2],Ue(o,me(o,gr))});mn.setAxes=zr;var yn={};function Qi(o){return(Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(yn,"__esModule",{value:!0}),yn.create=function(){var o=new Yr.ARRAY_TYPE(8);return Yr.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[4]=0,o[5]=0,o[6]=0,o[7]=0),o[3]=1,o},yn.clone=function(o){var i=new Yr.ARRAY_TYPE(8);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i},yn.fromValues=function(o,i,a,u,d,m,_,b){var T=new Yr.ARRAY_TYPE(8);return T[0]=o,T[1]=i,T[2]=a,T[3]=u,T[4]=d,T[5]=m,T[6]=_,T[7]=b,T},yn.fromRotationTranslationValues=function(o,i,a,u,d,m,_){var b=new Yr.ARRAY_TYPE(8);b[0]=o,b[1]=i,b[2]=a,b[3]=u;var T=.5*d,S=.5*m,A=.5*_;return b[4]=T*u+S*a-A*i,b[5]=S*u+A*o-T*a,b[6]=A*u+T*i-S*o,b[7]=-T*o-S*i-A*a,b},yn.fromRotationTranslation=jo,yn.fromTranslation=function(o,i){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=.5*i[0],o[5]=.5*i[1],o[6]=.5*i[2],o[7]=0,o},yn.fromRotation=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=0,o[5]=0,o[6]=0,o[7]=0,o},yn.fromMat4=function(o,i){var a=Ur.create();Kr.getRotation(a,i);var u=new Yr.ARRAY_TYPE(3);return Kr.getTranslation(u,i),jo(o,a,u),o},yn.copy=Oa,yn.identity=function(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=0,o[5]=0,o[6]=0,o[7]=0,o},yn.set=function(o,i,a,u,d,m,_,b,T){return o[0]=i,o[1]=a,o[2]=u,o[3]=d,o[4]=m,o[5]=_,o[6]=b,o[7]=T,o},yn.getDual=function(o,i){return o[0]=i[4],o[1]=i[5],o[2]=i[6],o[3]=i[7],o},yn.setDual=function(o,i){return o[4]=i[0],o[5]=i[1],o[6]=i[2],o[7]=i[3],o},yn.getTranslation=function(o,i){var a=i[4],u=i[5],d=i[6],m=i[7],_=-i[0],b=-i[1],T=-i[2],S=i[3];return o[0]=2*(a*S+m*_+u*T-d*b),o[1]=2*(u*S+m*b+d*_-a*T),o[2]=2*(d*S+m*T+a*b-u*_),o},yn.translate=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=.5*a[0],T=.5*a[1],S=.5*a[2],A=i[4],k=i[5],R=i[6],L=i[7];return o[0]=u,o[1]=d,o[2]=m,o[3]=_,o[4]=_*b+d*S-m*T+A,o[5]=_*T+m*b-u*S+k,o[6]=_*S+u*T-d*b+R,o[7]=-u*b-d*T-m*S+L,o},yn.rotateX=function(o,i,a){var u=-i[0],d=-i[1],m=-i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=b*_+A*u+T*m-S*d,R=T*_+A*d+S*u-b*m,L=S*_+A*m+b*d-T*u,U=A*_-b*u-T*d-S*m;return Ur.rotateX(o,i,a),o[4]=k*(_=o[3])+U*(u=o[0])+R*(m=o[2])-L*(d=o[1]),o[5]=R*_+U*d+L*u-k*m,o[6]=L*_+U*m+k*d-R*u,o[7]=U*_-k*u-R*d-L*m,o},yn.rotateY=function(o,i,a){var u=-i[0],d=-i[1],m=-i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=b*_+A*u+T*m-S*d,R=T*_+A*d+S*u-b*m,L=S*_+A*m+b*d-T*u,U=A*_-b*u-T*d-S*m;return Ur.rotateY(o,i,a),o[4]=k*(_=o[3])+U*(u=o[0])+R*(m=o[2])-L*(d=o[1]),o[5]=R*_+U*d+L*u-k*m,o[6]=L*_+U*m+k*d-R*u,o[7]=U*_-k*u-R*d-L*m,o},yn.rotateZ=function(o,i,a){var u=-i[0],d=-i[1],m=-i[2],_=i[3],b=i[4],T=i[5],S=i[6],A=i[7],k=b*_+A*u+T*m-S*d,R=T*_+A*d+S*u-b*m,L=S*_+A*m+b*d-T*u,U=A*_-b*u-T*d-S*m;return Ur.rotateZ(o,i,a),o[4]=k*(_=o[3])+U*(u=o[0])+R*(m=o[2])-L*(d=o[1]),o[5]=R*_+U*d+L*u-k*m,o[6]=L*_+U*m+k*d-R*u,o[7]=U*_-k*u-R*d-L*m,o},yn.rotateByQuatAppend=function(o,i,a){var u=a[0],d=a[1],m=a[2],_=a[3],b=i[0],T=i[1],S=i[2],A=i[3];return o[0]=b*_+A*u+T*m-S*d,o[1]=T*_+A*d+S*u-b*m,o[2]=S*_+A*m+b*d-T*u,o[3]=A*_-b*u-T*d-S*m,o[4]=(b=i[4])*_+(A=i[7])*u+(T=i[5])*m-(S=i[6])*d,o[5]=T*_+A*d+S*u-b*m,o[6]=S*_+A*m+b*d-T*u,o[7]=A*_-b*u-T*d-S*m,o},yn.rotateByQuatPrepend=function(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=a[0],T=a[1],S=a[2],A=a[3];return o[0]=u*A+_*b+d*S-m*T,o[1]=d*A+_*T+m*b-u*S,o[2]=m*A+_*S+u*T-d*b,o[3]=_*A-u*b-d*T-m*S,o[4]=u*(A=a[7])+_*(b=a[4])+d*(S=a[6])-m*(T=a[5]),o[5]=d*A+_*T+m*b-u*S,o[6]=m*A+_*S+u*T-d*b,o[7]=_*A-u*b-d*T-m*S,o},yn.rotateAroundAxis=function(o,i,a,u){if(Math.abs(u)<Yr.EPSILON)return Oa(o,i);var d=Math.hypot(a[0],a[1],a[2]);u*=.5;var m=Math.sin(u),_=m*a[0]/d,b=m*a[1]/d,T=m*a[2]/d,S=Math.cos(u),A=i[0],k=i[1],R=i[2],L=i[3];o[0]=A*S+L*_+k*T-R*b,o[1]=k*S+L*b+R*_-A*T,o[2]=R*S+L*T+A*b-k*_,o[3]=L*S-A*_-k*b-R*T;var U=i[4],H=i[5],G=i[6],Y=i[7];return o[4]=U*S+Y*_+H*T-G*b,o[5]=H*S+Y*b+G*_-U*T,o[6]=G*S+Y*T+U*b-H*_,o[7]=Y*S-U*_-H*b-G*T,o},yn.add=function(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o[2]=i[2]+a[2],o[3]=i[3]+a[3],o[4]=i[4]+a[4],o[5]=i[5]+a[5],o[6]=i[6]+a[6],o[7]=i[7]+a[7],o},yn.multiply=bd,yn.scale=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o[2]=i[2]*a,o[3]=i[3]*a,o[4]=i[4]*a,o[5]=i[5]*a,o[6]=i[6]*a,o[7]=i[7]*a,o},yn.lerp=function(o,i,a,u){var d=1-u;return lm(i,a)<0&&(u=-u),o[0]=i[0]*d+a[0]*u,o[1]=i[1]*d+a[1]*u,o[2]=i[2]*d+a[2]*u,o[3]=i[3]*d+a[3]*u,o[4]=i[4]*d+a[4]*u,o[5]=i[5]*d+a[5]*u,o[6]=i[6]*d+a[6]*u,o[7]=i[7]*d+a[7]*u,o},yn.invert=function(o,i){var a=um(i);return o[0]=-i[0]/a,o[1]=-i[1]/a,o[2]=-i[2]/a,o[3]=i[3]/a,o[4]=-i[4]/a,o[5]=-i[5]/a,o[6]=-i[6]/a,o[7]=i[7]/a,o},yn.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o[4]=-i[4],o[5]=-i[5],o[6]=-i[6],o[7]=i[7],o},yn.normalize=function(o,i){var a=um(i);if(a>0){a=Math.sqrt(a);var u=i[0]/a,d=i[1]/a,m=i[2]/a,_=i[3]/a,b=i[4],T=i[5],S=i[6],A=i[7],k=u*b+d*T+m*S+_*A;o[0]=u,o[1]=d,o[2]=m,o[3]=_,o[4]=(b-u*k)/a,o[5]=(T-d*k)/a,o[6]=(S-m*k)/a,o[7]=(A-_*k)/a}return o},yn.str=function(o){return"quat2("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+")"},yn.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]},yn.equals=function(o,i){var a=o[0],u=o[1],d=o[2],m=o[3],_=o[4],b=o[5],T=o[6],S=o[7],A=i[0],k=i[1],R=i[2],L=i[3],U=i[4],H=i[5],G=i[6],Y=i[7];return Math.abs(a-A)<=Yr.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(u-k)<=Yr.EPSILON*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(d-R)<=Yr.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(m-L)<=Yr.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(_-U)<=Yr.EPSILON*Math.max(1,Math.abs(_),Math.abs(U))&&Math.abs(b-H)<=Yr.EPSILON*Math.max(1,Math.abs(b),Math.abs(H))&&Math.abs(T-G)<=Yr.EPSILON*Math.max(1,Math.abs(T),Math.abs(G))&&Math.abs(S-Y)<=Yr.EPSILON*Math.max(1,Math.abs(S),Math.abs(Y))},yn.sqrLen=yn.squaredLength=yn.len=yn.length=yn.dot=yn.mul=yn.setReal=yn.getReal=void 0;var Yr=uo(Ai),Ur=uo(mn),Kr=uo(nr);function zs(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(zs=function(u){return u?a:i})(o)}function uo(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Qi(o)&&"function"!=typeof o)return{default:o};var a=zs(i);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}function jo(o,i,a){var u=.5*a[0],d=.5*a[1],m=.5*a[2],_=i[0],b=i[1],T=i[2],S=i[3];return o[0]=_,o[1]=b,o[2]=T,o[3]=S,o[4]=u*S+d*T-m*b,o[5]=d*S+m*_-u*T,o[6]=m*S+u*b-d*_,o[7]=-u*_-d*b-m*T,o}function Oa(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o}function bd(o,i,a){var u=i[0],d=i[1],m=i[2],_=i[3],b=a[4],T=a[5],S=a[6],A=a[7],k=i[4],R=i[5],L=i[6],U=i[7],H=a[0],G=a[1],Y=a[2],ue=a[3];return o[0]=u*ue+_*H+d*Y-m*G,o[1]=d*ue+_*G+m*H-u*Y,o[2]=m*ue+_*Y+u*G-d*H,o[3]=_*ue-u*H-d*G-m*Y,o[4]=u*A+_*b+d*S-m*T+k*ue+U*H+R*Y-L*G,o[5]=d*A+_*T+m*b-u*S+R*ue+U*G+L*H-k*Y,o[6]=m*A+_*S+u*T-d*b+L*ue+U*Y+k*G-R*H,o[7]=_*A-u*b-d*T-m*S+U*ue-k*H-R*G-L*Y,o}yn.getReal=Ur.copy,yn.setReal=Ur.copy,yn.mul=bd;var lm=Ur.dot;yn.dot=lm;var cm=Ur.length;yn.length=cm,yn.len=cm;var um=Ur.squaredLength;yn.squaredLength=um,yn.sqrLen=um;var br={};function Ng(o){return(Ng="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}Object.defineProperty(br,"__esModule",{value:!0}),br.create=U_,br.clone=function(o){var i=new wd.ARRAY_TYPE(2);return i[0]=o[0],i[1]=o[1],i},br.fromValues=function(o,i){var a=new wd.ARRAY_TYPE(2);return a[0]=o,a[1]=i,a},br.copy=function(o,i){return o[0]=i[0],o[1]=i[1],o},br.set=function(o,i,a){return o[0]=i,o[1]=a,o},br.add=function(o,i,a){return o[0]=i[0]+a[0],o[1]=i[1]+a[1],o},br.subtract=V_,br.multiply=Sv,br.divide=Dv,br.ceil=function(o,i){return o[0]=Math.ceil(i[0]),o[1]=Math.ceil(i[1]),o},br.floor=function(o,i){return o[0]=Math.floor(i[0]),o[1]=Math.floor(i[1]),o},br.min=function(o,i,a){return o[0]=Math.min(i[0],a[0]),o[1]=Math.min(i[1],a[1]),o},br.max=function(o,i,a){return o[0]=Math.max(i[0],a[0]),o[1]=Math.max(i[1],a[1]),o},br.round=function(o,i){return o[0]=Math.round(i[0]),o[1]=Math.round(i[1]),o},br.scale=function(o,i,a){return o[0]=i[0]*a,o[1]=i[1]*a,o},br.scaleAndAdd=function(o,i,a,u){return o[0]=i[0]+a[0]*u,o[1]=i[1]+a[1]*u,o},br.distance=j_,br.squaredDistance=$_,br.length=hm,br.squaredLength=Fg,br.negate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o},br.inverse=function(o,i){return o[0]=1/i[0],o[1]=1/i[1],o},br.normalize=function(o,i){var a=i[0],u=i[1],d=a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),o[0]=i[0]*d,o[1]=i[1]*d,o},br.dot=function(o,i){return o[0]*i[0]+o[1]*i[1]},br.cross=function(o,i,a){var u=i[0]*a[1]-i[1]*a[0];return o[0]=o[1]=0,o[2]=u,o},br.lerp=function(o,i,a,u){var d=i[0],m=i[1];return o[0]=d+u*(a[0]-d),o[1]=m+u*(a[1]-m),o},br.random=function(o,i){i=i||1;var a=2*wd.RANDOM()*Math.PI;return o[0]=Math.cos(a)*i,o[1]=Math.sin(a)*i,o},br.transformMat2=function(o,i,a){var u=i[0],d=i[1];return o[0]=a[0]*u+a[2]*d,o[1]=a[1]*u+a[3]*d,o},br.transformMat2d=function(o,i,a){var u=i[0],d=i[1];return o[0]=a[0]*u+a[2]*d+a[4],o[1]=a[1]*u+a[3]*d+a[5],o},br.transformMat3=function(o,i,a){var u=i[0],d=i[1];return o[0]=a[0]*u+a[3]*d+a[6],o[1]=a[1]*u+a[4]*d+a[7],o},br.transformMat4=function(o,i,a){var u=i[0],d=i[1];return o[0]=a[0]*u+a[4]*d+a[12],o[1]=a[1]*u+a[5]*d+a[13],o},br.rotate=function(o,i,a,u){var d=i[0]-a[0],m=i[1]-a[1],_=Math.sin(u),b=Math.cos(u);return o[0]=d*b-m*_+a[0],o[1]=d*_+m*b+a[1],o},br.angle=function(o,i){var a=o[0],u=o[1],d=i[0],m=i[1],_=Math.sqrt(a*a+u*u)*Math.sqrt(d*d+m*m);return Math.acos(Math.min(Math.max(_&&(a*d+u*m)/_,-1),1))},br.zero=function(o){return o[0]=0,o[1]=0,o},br.str=function(o){return"vec2("+o[0]+", "+o[1]+")"},br.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]},br.equals=function(o,i){var a=o[0],u=o[1],d=i[0],m=i[1];return Math.abs(a-d)<=wd.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(u-m)<=wd.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))},br.forEach=br.sqrLen=br.sqrDist=br.dist=br.div=br.mul=br.sub=br.len=void 0;var wd=function(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Ng(o)&&"function"!=typeof o)return{default:o};var a=Cv(void 0);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}(Ai);function Cv(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(Cv=function(u){return u?a:i})(o)}function U_(){var o=new wd.ARRAY_TYPE(2);return wd.ARRAY_TYPE!=Float32Array&&(o[0]=0,o[1]=0),o}function V_(o,i,a){return o[0]=i[0]-a[0],o[1]=i[1]-a[1],o}function Sv(o,i,a){return o[0]=i[0]*a[0],o[1]=i[1]*a[1],o}function Dv(o,i,a){return o[0]=i[0]/a[0],o[1]=i[1]/a[1],o}function j_(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1])}function $_(o,i){var a=i[0]-o[0],u=i[1]-o[1];return a*a+u*u}function hm(o){return Math.hypot(o[0],o[1])}function Fg(o){var i=o[0],a=o[1];return i*i+a*a}br.len=hm,br.sub=V_,br.mul=Sv,br.div=Dv,br.dist=j_,br.sqrDist=$_,br.sqrLen=Fg;var Lg=function(){var o=U_();return function(i,a,u,d,m,_){var b,T;for(a||(a=2),u||(u=0),T=d?Math.min(d*a+u,i.length):i.length,b=u;b<T;b+=a)o[0]=i[b],o[1]=i[b+1],m(o,o,_),i[b]=o[0],i[b+1]=o[1];return i}}();function Bg(o){return(Bg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(o)}br.forEach=Lg,Object.defineProperty(xi,"__esModule",{value:!0}),f.aB=xi.vec4=f.$=xi.vec3=xi.vec2=xi.quat2=f.aw=xi.quat=f.ae=xi.mat4=f.bE=xi.mat3=xi.mat2d=f.aD=xi.mat2=xi.glMatrix=void 0;var Mv=Ml(Ai);xi.glMatrix=Mv;var Xw=Ml(ci);f.aD=xi.mat2=Xw;var Af=Ml(ui);xi.mat2d=Af;var Nr=Ml(ii);f.bE=xi.mat3=Nr;var Yw=Ml(nr);f.ae=xi.mat4=Yw;var Av=Ml(mn);f.aw=xi.quat=Av;var Iv=Ml(yn);xi.quat2=Iv;var H_=Ml(br);xi.vec2=H_;var Kw=Ml(dn);f.$=xi.vec3=Kw;var G_=Ml(sr);function dm(o){if("function"!=typeof WeakMap)return null;var i=new WeakMap,a=new WeakMap;return(dm=function(u){return u?a:i})(o)}function Ml(o,i){if(o&&o.__esModule)return o;if(null===o||"object"!==Bg(o)&&"function"!=typeof o)return{default:o};var a=dm(i);if(a&&a.has(o))return a.get(o);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in o)if("default"!==m&&Object.prototype.hasOwnProperty.call(o,m)){var _=d?Object.getOwnPropertyDescriptor(o,m):null;_&&(_.get||_.set)?Object.defineProperty(u,m,_):u[m]=o[m]}return u.default=o,a&&a.set(o,u),u}f.aB=xi.vec4=G_;var kv=Jw;function Jw(o,i,a,u){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=a,this.p2y=u}Jw.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(void 0===i&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var a=o,u=0;u<8;u++){var d=this.sampleCurveX(a)-o;if(Math.abs(d)<i)return a;var m=this.sampleCurveDerivativeX(a);if(Math.abs(m)<1e-6)break;a-=d/m}var _=0,b=1;for(a=o,u=0;u<20&&(d=this.sampleCurveX(a),!(Math.abs(d-o)<i));u++)o>d?_=a:b=a,a=.5*(b-_)+_;return a},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var W_=Uo(kv),zg=Td;function Td(o,i){this.x=o,this.y=i}Td.prototype={clone:function(){return new Td(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,a=o.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),a=Math.sin(o),u=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=u,this},_rotateAround:function(o,i){var a=Math.cos(o),u=Math.sin(o),d=i.y+u*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-u*(this.y-i.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Td.convert=function(o){return o instanceof Td?o:Array.isArray(o)?new Td(o[0],o[1]):o};var $t=Uo(zg);function Ed(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let a=0;a<o.length;a++)if(!Ed(o[a],i[a]))return!1;return!0}if("object"==typeof o&&null!==o&&null!==i){if("object"!=typeof i||Object.keys(o).length!==Object.keys(i).length)return!1;for(const a in o)if(!Ed(o[a],i[a]))return!1;return!0}return o===i}const fm=Math.PI/180,Cd=180/Math.PI;function Dr(o){return o*fm}function oa(o){return o*Cd}const If=[[0,0],[1,0],[1,1],[0,1]];function Ug(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,a=i*o;return 4*(o<.5?a:3*(o-i)+a-.75)}function Vg(o,i,a,u){const d=new W_(o,i,a,u);return function(m){return d.solve(m)}}const Ec=Vg(.25,.1,.25,1);function vr(o,i,a){return Math.min(a,Math.max(i,o))}function jg(o,i,a){return(a=vr((a-o)/(i-o),0,1))*a*(3-2*a)}function hh(o,i,a){const u=a-i,d=((o-i)%u+u)%u+i;return d===i?a:d}function $g(o,i,a){if(!o.length)return a(null,[]);let u=o.length;const d=new Array(o.length);let m=null;o.forEach((_,b)=>{i(_,(T,S)=>{T&&(m=T),d[b]=S,0==--u&&a(m,d)})})}function kf(o){const i=[];for(const a in o)i.push(o[a]);return i}function $o(o,...i){for(const a of i)for(const u in a)o[u]=a[u];return o}let Ov=1;function q_(){return Ov++}function pm(){return function o(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function dh(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Hg(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Gg(o,i){o.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function mm(o,i){return-1!==o.indexOf(i,o.length-i.length)}function Wg(o,i,a){const u={};for(const d in o)u[d]=i.call(this,o[d],d,o);return u}function _o(o,i,a){const u={};for(const d in o)i.call(this,o[d],d,o)&&(u[d]=o[d]);return u}function Ra(o){return Array.isArray(o)?o.map(Ra):"object"==typeof o&&o?Wg(o,Ra):o}const Ho={};function ks(o){Ho[o]||(typeof console<"u"&&console.warn(o),Ho[o]=!0)}function fh(o,i,a){return(a.y-o.y)*(i.x-o.x)>(i.y-o.y)*(a.x-o.x)}function Z_(o){let i=0;for(let a,u,d=0,m=o.length,_=m-1;d<m;_=d++)a=o[d],u=o[_],i+=(u.x-a.x)*(a.y+u.y);return i}function Of([o,i,a]){const u=Dr(i+90),d=Dr(a);return{x:o*Math.cos(u)*Math.sin(d),y:o*Math.sin(u)*Math.sin(d),z:o*Math.cos(d),azimuthal:i,polar:a}}function gm(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function _m(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,d,m)=>{const _=d||m;return i[u]=!_||_.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let Rv,Rf,ph,qg,mh,Zg,ym=null;function X_(o){try{const i=self[o];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function gh(o,i){return[o[4*i],o[4*i+1],o[4*i+2],o[4*i+3]]}function Xg(o,i,a,u){for(;i<a;){const d=i+a>>1;o[d]<u?i=d+1:a=d}return i}function Yg(o,i,a,u){for(;i<a;){const d=i+a>>1;o[d]<=u?i=d+1:a=d}return i}function Pv(o){return o>0?1/(1.001-o):1+o}function _h(o){return o>0?1-1/(1.001-o):-o}function Nv(){return null==Rv&&(Rv=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Rv}const aa={now:()=>void 0!==qg?qg:performance.now(),setNow(o){qg=o},restoreNow(){qg=void 0},frame(o){const i=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(o,i=0){const{width:a,height:u}=o;mh||(mh=document.createElement("canvas"));const d=mh.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(a>mh.width||u>mh.height)&&(mh.width=a,mh.height=u),d.clearRect(-i,-i,a+2*i,u+2*i),d.drawImage(o,0,0,a,u),d.getImageData(-i,-i,a+2*i,u+2*i)},resolveURL:o=>(Rf||(Rf=document.createElement("a")),Rf.href=o,Rf.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==ph&&(ph=window.matchMedia("(prefers-reduced-motion: reduce)")),ph.matches)},hasCanvasFingerprintNoise(){if(void 0!==Zg)return Zg;if(!Nv())return Zg=!1,!1;const o=new OffscreenCanvas(85,1),i=o.getContext("2d",{willReadFrequently:!0});let a=0;for(let d=0;d<o.width;++d)i.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,i.fillRect(d,0,1,1);const u=i.getImageData(0,0,o.width,o.height);a=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&a++!==u.data[d])return Zg=!0,!0;return Zg=!1,!1}};function Y_(o,i){const a=o.indexOf("?");if(a<0)return`${o}?${new URLSearchParams(i).toString()}`;const u=new URLSearchParams(o.slice(a));for(const d in i)u.set(d,i[d]);return`${o.slice(0,a)}?${u.toString()}`}function vm(o,i={persistentParams:[]}){const a=o.indexOf("?");if(a<0)return o;const u=new URLSearchParams,d=new URLSearchParams(o.slice(a));for(const _ of i.persistentParams){const b=d.get(_);b&&u.set(_,b)}const m=u.toString();return`${o.slice(0,a)}${m.length>0?`?${m}`:""}`}const Fv="mapbox-tiles";let K_=500,J_=50;const Q_=["language","worldview","jobid"];let Cu,e1;function Qw(){try{return caches}catch{}}function Kg(){const o=Qw();o&&!Cu&&(Cu=o.open(Fv))}let t1=1/0;const n1={supported:!1,testSupport:function(o){!bm&&xm&&(Jt?Pf(o):Jg=o)}};let Jg,xm,bm=!1,Jt=!1;const Sd=typeof self<"u"?self:{};function Pf(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,xm),o.isContextLost())return;n1.supported=!0}catch{}o.deleteTexture(i),bm=!0}Sd.document&&(xm=Sd.document.createElement("img"),xm.onload=function(){Jg&&Pf(Jg),Jg=null,Jt=!0},xm.onerror=function(){bm=!0,Jg=null},xm.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Nf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Nf);class r1 extends Error{constructor(i,a,u){401===a&&jr(u)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Lv=gm()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Cc=function(o,i){if(!(/^file:/.test(a=o.url)||/^file:/.test(Lv())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,d){const m=new AbortController,_=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Lv(),referrerPolicy:u.referrerPolicy,signal:m.signal});let b=!1,T=!1;const S=(A=_.url).indexOf("sku=")>0&&jr(A);var A;"json"===u.type&&_.headers.set("Accept","application/json");const k=(L,U,H)=>{if(T)return;if(L&&"SecurityError"!==L.message&&ks(L.toString()),U&&H)return R(U);const G=Date.now();fetch(_).then(Y=>{if(Y.ok){const ue=S?Y.clone():null;return R(Y,ue,G)}return d(new r1(Y.statusText,Y.status,u.url))}).catch(Y=>{"AbortError"!==Y.name&&d(new Error(`${Y.message} ${u.url}`))})},R=(L,U,H)=>{("arrayBuffer"===u.type?L.arrayBuffer():"json"===u.type?L.json():L.text()).then(G=>{T||(U&&H&&function(Y,ue,ae){if(Kg(),!Cu)return;const he=_m(ue.headers.get("Cache-Control")||"");if(he["no-store"])return;const ve={status:ue.status,statusText:ue.statusText,headers:new Headers};ue.headers.forEach((Fe,Ge)=>ve.headers.set(Ge,Fe)),he["max-age"]&&ve.headers.set("Expires",new Date(ae+1e3*he["max-age"]).toUTCString());const we=ve.headers.get("Expires");if(!we||new Date(we).getTime()-ae<42e4)return;let Se=vm(Y.url,{persistentParams:Q_});if(206===ue.status){const Fe=Y.headers.get("Range");if(!Fe)return;ve.status=200,Se=Y_(Se,{range:Fe})}!function(Fe,Ge){if(void 0===e1)try{new Response(new ReadableStream),e1=!0}catch{e1=!1}e1?Ge(Fe.body):Fe.blob().then(Ge)}(ue,Fe=>{const Ge=new Response(200!==(tt=ue.status)&&404!==tt&&[101,103,204,205,304].includes(tt)?null:Fe,ve);var tt;Kg(),Cu&&Cu.then(Ye=>Ye.put(Se,Ge)).catch(Ye=>ks(Ye.message))})}(_,U,H),b=!0,d(null,G,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(G=>{T||d(new Error(G.message))})};return S?function(L,U){if(Kg(),!Cu)return U(null);Cu.then(H=>{let G=vm(L.url,{persistentParams:Q_});const Y=L.headers.get("Range");Y&&(G=Y_(G,{range:Y})),H.match(G).then(ue=>{const ae=function(he){if(!he)return!1;const ve=new Date(he.headers.get("Expires")||0),we=_m(he.headers.get("Cache-Control")||"");return ve>Date.now()&&!we["no-cache"]}(ue);H.delete(G),ae&&H.put(G,ue.clone()),U(null,ue,ae)}).catch(U)}).catch(U)}(_,k):k(null,null),{cancel:()=>{T=!0,b||m.abort()}}}(o,i);if(gm()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var a;return function(u,d){const m=new XMLHttpRequest;m.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(m.responseType="arraybuffer");for(const _ in u.headers)m.setRequestHeader(_,u.headers[_]);return"json"===u.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===u.credentials,m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===u.type)try{_=JSON.parse(m.response)}catch(b){return d(b)}d(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else d(new r1(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}}(o,i)},Pa=function(o,i){return Cc($o(o,{type:"arrayBuffer"}),i)};function Ff(o){const i=document.createElement("a");return i.href=o,i.protocol===location.protocol&&i.host===location.host}const Dd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xc,Md;Xc=[],Md=0;const Ad=function(o,i){if(n1.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Md>=qn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Xc.push(m),m}Md++;let a=!1;const u=()=>{if(!a)for(a=!0,Md--;Xc.length&&Md<qn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Xc.shift(),{requestParameters:_,callback:b,cancelled:T}=m;T||(m.cancel=Ad(_,b).cancel)}},d=Pa(o,(m,_,b,T)=>{u(),m?i(m):_&&(self.createImageBitmap?function(S,A){const k=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(k).then(R=>{A(null,R)}).catch(R=>{A(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(S,A)=>i(S,A,b,T)):function(S,A){const k=new Image;k.onload=()=>{A(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame(()=>{k.src=Dd})},k.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(S)],{type:"image/png"});k.src=S.byteLength?URL.createObjectURL(R):Dd}(_,(S,A)=>i(S,A,b,T)))});return{cancel:()=>{d.cancel(),u()}}},yh="01",Bv="NO_ACCESS_TOKEN",ls=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sc(o){const i=o.match(ls);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Lf(o){const i=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${i}`}const Hi="mapbox.eventData";function zv(o){if(!o)return null;const i=o.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(atob(i[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ts{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const a=zv(qn.ACCESS_TOKEN);let u="";return u=a&&a.u?btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(d,m)=>String.fromCharCode(+("0x"+m)))):qn.ACCESS_TOKEN||"",i?`${Hi}.${i}:${u}`:`${Hi}:${u}`}fetchEventData(){const i=X_("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{const d=localStorage.getItem(a);d&&(this.eventData=JSON.parse(d));const m=localStorage.getItem(u);m&&(this.anonId=m)}catch{ks("Unable to read from LocalStorage")}}saveEventData(){const i=X_("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid"),d=this.anonId;if(i&&d)try{localStorage.setItem(u,d),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{ks("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,a,u,d){if(!qn.EVENTS_URL)return;const m=Sc(qn.EVENTS_URL);m.params.push(`access_token=${d||qn.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(i).toISOString()},b=a?$o(_,a):_,T={url:Lf(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};var A;this.pendingRequest=(A=S=>{this.pendingRequest=null,u(S),this.saveEventData(),this.processRequests(d)},Cc($o(T,{method:"POST"}),A))}queueRequest(i,a){this.queue.push(i),this.processRequests(a)}}const Qg=new class extends Ts{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,i){qn.EVENTS_URL&&qn.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>_s(a)||jr(a))&&this.queueRequest(Date.now(),i)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=zv(qn.ACCESS_TOKEN),a=i?i.u:qn.ACCESS_TOKEN;let u=a!==this.eventData.tokenU;Hg(this.anonId)||(this.anonId=pm(),u=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(d),b=(d-this.eventData.lastSuccess)/864e5;u=u||b>=1||b<-1||m.getDate()!==_.getDate()}else u=!0;u?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:as,skuId:yh,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=a)},o):this.processRequests()}},Uv=Qg.postTurnstileEvent.bind(Qg),Bf=new class extends Ts{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,i,a,u){this.skuToken=i,this.errorCb=u,qn.EVENTS_URL&&(a||qn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Bv)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),Hg(this.anonId)||(this.anonId=pm()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:as,skuId:yh,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},o))}remove(){this.errorCb=null}},zi=Bf.postMapLoadEvent.bind(Bf),Tr=new class extends Ts{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(o){let i=this.mapInstanceIdMap.get(o);return i||(i=pm(),this.mapInstanceIdMap.set(o,i)),i}getEventId(o){const i=this.eventIdPerMapInstanceMap.get(o)||0;return this.eventIdPerMapInstanceMap.set(o,i+1),i}postStyleLoadEvent(o,i){const{map:a,style:u,importedStyles:d}=i;if(!qn.EVENTS_URL||!o&&!qn.ACCESS_TOKEN)return;const m=this.getMapInstanceId(a),_={mapInstanceId:m,eventId:this.getEventId(m),style:u};d.length&&(_.importedStyles=d),this.queueRequest({timestamp:Date.now(),payload:_},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,payload:a}=this.queue.shift();this.postEvent(i,a,()=>{},o)}},wm=Tr.postStyleLoadEvent.bind(Tr),nl=new class extends Ts{constructor(){super("gljs.performance")}postPerformanceEvent(o,i){qn.EVENTS_URL&&(o||qn.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:a}=this.queue.shift(),u=function(d){const m=performance.getEntriesByType("resource"),_=performance.getEntriesByType("mark"),b=function(L){const U={};if(L)for(const H in L)if("other"!==H)for(const G of L[H]){const Y=`${H}ResolveRangeMin`,ue=`${H}ResolveRangeMax`,ae=`${H}RequestCount`,he=`${H}RequestCachedCount`;U[Y]=Math.min(U[Y]||1/0,G.startTime),U[ue]=Math.max(U[ue]||-1/0,G.responseEnd);const ve=we=>{void 0===U[we]&&(U[we]=0),++U[we]};void 0!==G.transferSize&&0===G.transferSize&&ve(he),ve(ae)}return U}(function(L,U){const H={};if(L)for(const G of L){const Y=U(G);void 0===H[Y]&&(H[Y]=[]),H[Y].push(G)}return H}(m,bc)),T=window.devicePixelRatio,S=navigator.connection||navigator.mozConnection||navigator.webkitConnection,A=S?S.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},R=(L,U,H)=>{null!=H&&L.push({name:U,value:H.toString()})};for(const L in b)R(k.counters,L,b[L]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(R(k.counters,"interactionRangeMin",d.interactionRange[0]),R(k.counters,"interactionRangeMax",d.interactionRange[1])),_)for(const L of Object.keys(vi)){const U=vi[L],H=_.find(G=>G.name===U);H&&R(k.counters,U,H.startTime)}return R(k.counters,"visibilityHidden",d.visibilityHidden),R(k.attributes,"style",function(L){if(L)for(const U of L){const H=U.name.split("?")[0];if(Is(H)){const G=H.split("/").slice(-2);if(2===G.length)return`mapbox://styles/${G[0]}/${G[1]}`}}}(m)),R(k.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),R(k.attributes,"fogEnabled",d.fogEnabled?"true":"false"),R(k.attributes,"projection",d.projection),R(k.attributes,"zoom",d.zoom),R(k.metadata,"devicePixelRatio",T),R(k.metadata,"connectionEffectiveType",A),R(k.metadata,"navigatorUserAgent",navigator.userAgent),R(k.metadata,"screenWidth",window.screen.width),R(k.metadata,"screenHeight",window.screen.height),R(k.metadata,"windowWidth",window.innerWidth),R(k.metadata,"windowHeight",window.innerHeight),R(k.metadata,"mapWidth",d.width/T),R(k.metadata,"mapHeight",d.height/T),R(k.metadata,"webglRenderer",d.renderer),R(k.metadata,"webglVendor",d.vendor),R(k.metadata,"sdkVersion",as),R(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(a);for(const d of u.metadata);for(const d of u.counters);for(const d of u.attributes);this.postEvent(i,u,()=>{},o)}},TS=nl.postPerformanceEvent.bind(nl),Tm=new class extends Ts{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,i,a,u){if(!qn.API_URL||!qn.SESSION_PATH)return;const d=Sc(qn.API_URL+qn.SESSION_PATH);d.params.push(`sku=${i||""}`),d.params.push(`access_token=${u||qn.ACCESS_TOKEN||""}`);const m={url:Lf(d),headers:{"Content-Type":"text/plain"}};var b;this.pendingRequest=(b=_=>{this.pendingRequest=null,a(_),this.saveEventData(),this.processRequests(u)},Cc($o(m,{method:"GET"}),b))}getSessionAPI(o,i,a,u){this.skuToken=i,this.errorCb=u,qn.SESSION_PATH&&qn.API_URL&&(a||qn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Bv)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},o)}remove(){this.errorCb=null}},Vv=Tm.getSessionAPI.bind(Tm),tc=new Set;var zf={exports:{}},eT=function(o,i){var a,u,d,m,_,b,T,S;for(u=o.length-(a=3&o.length),d=i,_=3432918353,b=461845907,S=0;S<u;)T=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24,++S,d=27492+(65535&(m=5*(65535&(d=(d^=T=(65535&(T=(T=(65535&T)*_+(((T>>>16)*_&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(T=0,a){case 3:T^=(255&o.charCodeAt(S+2))<<16;case 2:T^=(255&o.charCodeAt(S+1))<<8;case 1:d^=T=(65535&(T=(T=(65535&(T^=255&o.charCodeAt(S)))*_+(((T>>>16)*_&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return d^=o.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0},tT=function(o,i){for(var a,u=o.length,d=i^u,m=0;u>=4;)a=1540483477*(65535&(a=255&o.charCodeAt(m)|(255&o.charCodeAt(++m))<<8|(255&o.charCodeAt(++m))<<16|(255&o.charCodeAt(++m))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++m;switch(u){case 3:d^=(255&o.charCodeAt(m+2))<<16;case 2:d^=(255&o.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&o.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};zf.exports=eT,zf.exports.murmur3=eT,zf.exports.murmur2=tT;var i1=Uo(zf.exports);class Yc{constructor(i,...a){$o(this,a[0]||{}),this.type=i}}class e0 extends Yc{constructor(i,a={}){super("error",$o({error:i},a))}}function la(o,i,a){a[o]&&-1!==a[o].indexOf(i)||(a[o]=a[o]||[],a[o].push(i))}function Er(o,i,a){if(a&&a[o]){const u=a[o].indexOf(i);-1!==u&&a[o].splice(u,1)}}class Uf{on(i,a){return this._listeners=this._listeners||{},la(i,a,this._listeners),this}off(i,a){return Er(i,a,this._listeners),Er(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},la(i,a,this._oneTimeListeners),this):new Promise(u=>this.once(i,u))}fire(i,a){const u="string"==typeof i?new Yc(i,a):i,d=u.type;if(this.listens(d)){u.target=this;const m=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of m)T.call(this,u);const _=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of _)Er(d,T,this._oneTimeListeners),T.call(this,u);const b=this._eventedParent;b&&($o(u,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(u))}else u instanceof e0&&console.error(u.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}f.G=void 0;var nT={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s1(o){return(o=Math.round(o))<0?0:o>255?255:o}function jv(o){return s1("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function o1(o){return(i="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:i>1?1:i;var i}function sn(o,i,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?o+(i-o)*a*6:2*a<1?i:3*a<2?o+(i-o)*(2/3-a)*6:o}try{f.G={}.parseCSSColor=function(o){var i,a=o.replace(/ /g,"").toLowerCase();if(a in nT)return nT[a].slice();if("#"===a[0])return 4===a.length?(i=parseInt(a.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===a.length&&(i=parseInt(a.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var u=a.indexOf("("),d=a.indexOf(")");if(-1!==u&&d+1===a.length){var m=a.substr(0,u),_=a.substr(u+1,d-(u+1)).split(","),b=1;switch(m){case"rgba":if(4!==_.length)return null;b=o1(_.pop());case"rgb":return 3!==_.length?null:[jv(_[0]),jv(_[1]),jv(_[2]),b];case"hsla":if(4!==_.length)return null;b=o1(_.pop());case"hsl":if(3!==_.length)return null;var T=(parseFloat(_[0])%360+360)%360/360,S=o1(_[1]),A=o1(_[2]),k=A<=.5?A*(S+1):A+S-A*S,R=2*A-k;return[s1(255*sn(R,k,T+1/3)),s1(255*sn(R,k,T)),s1(255*sn(R,k,T-1/3)),b];default:return null}}return null}}catch{}class Jr{constructor(i,a,u,d=1){this.r=i,this.g=a,this.b=u,this.a=d}static parse(i){if(!i)return;if(i instanceof Jr)return i;if("string"!=typeof i)return;const a=f.G(i);return a?new Jr(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[i,a,u,d]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(i)},${Math.round(a)},${Math.round(u)},${d})`}toRenderColor(i){const{r:a,g:u,b:d,a:m}=this;return new Ui(i,a,u,d,m)}}class Ui{constructor(i,a,u,d,m){if(i){const _=i.image.height,b=_*_;a=0===m?0:a/m*(_-1),u=0===m?0:u/m*(_-1),d=0===m?0:d/m*(_-1);const T=Math.floor(a),S=Math.floor(u),A=Math.floor(d),k=Math.ceil(a),R=Math.ceil(u),L=Math.ceil(d),U=a-T,H=u-S,G=d-A,Y=i.image.data,ue=4*(T+S*b+A*_),ae=4*(T+S*b+L*_),he=4*(T+R*b+A*_),ve=4*(T+R*b+L*_),we=4*(k+S*b+A*_),Se=4*(k+S*b+L*_),Fe=4*(k+R*b+A*_),Ge=4*(k+R*b+L*_);if(ue<0||Ge>=Y.length)throw new Error("out of range");this.r=Fn(Fn(Fn(Y[ue],Y[ae],G),Fn(Y[he],Y[ve],G),H),Fn(Fn(Y[we],Y[Se],G),Fn(Y[Fe],Y[Ge],G),H),U)/255*m,this.g=Fn(Fn(Fn(Y[ue+1],Y[ae+1],G),Fn(Y[he+1],Y[ve+1],G),H),Fn(Fn(Y[we+1],Y[Se+1],G),Fn(Y[Fe+1],Y[Ge+1],G),H),U)/255*m,this.b=Fn(Fn(Fn(Y[ue+2],Y[ae+2],G),Fn(Y[he+2],Y[ve+2],G),H),Fn(Fn(Y[we+2],Y[Se+2],G),Fn(Y[Fe+2],Y[Ge+2],G),H),U)/255*m,this.a=m}else this.r=a,this.g=u,this.b=d,this.a=m}toArray(){const{r:i,g:a,b:u,a:d}=this;return 0===d?[0,0,0,0]:[255*i/d,255*a/d,255*u/d,d]}toArray01(){const{r:i,g:a,b:u,a:d}=this;return 0===d?[0,0,0,0]:[i/d,a/d,u/d,d]}toArray01Scaled(i){const{r:a,g:u,b:d,a:m}=this;return 0===m?[0,0,0]:[a/m*i,u/m*i,d/m*i]}toArray01PremultipliedAlpha(){const{r:i,g:a,b:u,a:d}=this;return[i,a,u,d]}toArray01Linear(){const{r:i,g:a,b:u,a:d}=this;return 0===d?[0,0,0,0]:[Math.pow(i/d,2.2),Math.pow(a/d,2.2),Math.pow(u/d,2.2),d]}}function Fn(o,i,a){return o*(1-a)+i*a}function a1(o,i,a){return o.map((u,d)=>Fn(u,i[d],a))}Jr.black=new Jr(0,0,0,1),Jr.white=new Jr(1,1,1,1),Jr.transparent=new Jr(0,0,0,0),Jr.red=new Jr(1,0,0,1),Jr.blue=new Jr(0,0,1,1);var Vf=Object.freeze({__proto__:null,array:a1,color:function(o,i,a){return new Jr(Fn(o.r,i.r,a),Fn(o.g,i.g,a),Fn(o.b,i.b,a),Fn(o.a,i.a,a))},number:Fn});function jf(o,...i){for(const a of i)for(const u in a)o[u]=a[u];return o}class Al extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class $f{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[u,d]of a)this.bindings[u]=d}concat(i){return new $f(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Na={kind:"null"},ln={kind:"number"},Fr={kind:"string"},Gt={kind:"boolean"},rl={kind:"color"},vh={kind:"object"},Hr={kind:"value"},Hf={kind:"collator"},Gf={kind:"formatted"},Su={kind:"resolvedImage"};function ca(o,i){return{kind:"array",itemType:o,N:i}}function Os(o){if("array"===o.kind){const i=Os(o.itemType);return"number"==typeof o.N?`array<${i}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${i}>`}return o.kind}const $v=[Na,ln,Fr,Gt,rl,Gf,vh,ca(Hr),Su];function t0(o,i){if("error"===i.kind)return null;if("array"===o.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!t0(o.itemType,i.itemType))&&("number"!=typeof o.N||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if("value"===o.kind)for(const a of $v)if(!t0(a,i))return null}return`Expected ${Os(o)} but found ${Os(i)} instead.`}function il(o,i){return i.some(a=>a.kind===o.kind)}function Du(o,i){return i.some(a=>"null"===a?null===o:"array"===a?Array.isArray(o):"object"===a?o&&!Array.isArray(o)&&"object"==typeof o:a===typeof o)}class Wf{constructor(i,a,u){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qf{constructor(i,a,u,d,m){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=u,this.fontStack=d,this.textColor=m}}class Go{constructor(i){this.sections=i}static fromString(i){return new Go([new qf(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.namePrimary.length)}static factory(i){return i instanceof Go?i:Go.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){i.push(["image",a.image.namePrimary]);continue}i.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toRenderColor(null).toArray())),i.push(u)}return i}}class Qs{constructor(i){this.namePrimary=i.namePrimary,i.nameSecondary&&(this.nameSecondary=i.nameSecondary),this.available=i.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(i,a){return i?new Qs({namePrimary:i,nameSecondary:a,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Zf(o,i,a,u){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[o,i,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[o,i,a,u]:[o,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Id(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof Jr||o instanceof Wf||o instanceof Go||o instanceof Qs)return!0;if(Array.isArray(o)){for(const i of o)if(!Id(i))return!1;return!0}if("object"==typeof o){for(const i in o)if(!Id(o[i]))return!1;return!0}return!1}function rr(o){if(null===o)return Na;if("string"==typeof o)return Fr;if("boolean"==typeof o)return Gt;if("number"==typeof o)return ln;if(o instanceof Jr)return rl;if(o instanceof Wf)return Hf;if(o instanceof Go)return Gf;if(o instanceof Qs)return Su;if(Array.isArray(o)){const i=o.length;let a;for(const u of o){const d=rr(u);if(a){if(a===d)continue;a=Hr;break}a=d}return ca(a||Hr,i)}return vh}function ti(o){const i=typeof o;return null===o?"":"string"===i||"number"===i||"boolean"===i?String(o):o instanceof Jr||o instanceof Go||o instanceof Qs?o.toString():JSON.stringify(o)}class Kc{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(2!==i.length)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Id(i[1]))return a.error("invalid value");const u=i[1];let d=rr(u);const m=a.expectedType;return"array"!==d.kind||0!==d.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(d=m),new Kc(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Jr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Go?this.value.serialize():this.value}}class eo{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const l1={string:Fr,number:ln,boolean:Gt,object:vh};class nc{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let u,d=1;const m=i[0];if("array"===m){let b,T;if(i.length>2){const S=i[1];if("string"!=typeof S||!(S in l1)||"object"===S)return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=l1[S],d++}else b=Hr;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);T=i[2],d++}u=ca(b,T)}else u=l1[m];const _=[];for(;d<i.length;d++){const b=a.parse(i[d],d,Hr);if(!b)return null;_.push(b)}return new nc(u,_)}evaluate(i){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(i);if(!t0(this.type,rr(u)))return u;if(a===this.args.length-1)throw new eo(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Os(rr(u))} but was expected to be of type ${Os(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if("array"===i.kind){const u=i.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){a.push(u.kind);const d=i.N;("number"==typeof d||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map(u=>u.serialize()))}}class kd{constructor(i){this.type=Gf,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const u=i[1];if(!Array.isArray(u)&&"object"==typeof u)return a.error("First argument must be an image or text section.");const d=[];let m=!1;for(let _=1;_<=i.length-1;++_){const b=i[_];if(m&&"object"==typeof b&&!Array.isArray(b)){m=!1;let T=null;if(b["font-scale"]&&(T=a.parse(b["font-scale"],1,ln),!T))return null;let S=null;if(b["text-font"]&&(S=a.parse(b["text-font"],1,ca(Fr)),!S))return null;let A=null;if(b["text-color"]&&(A=a.parse(b["text-color"],1,rl),!A))return null;const k=d[d.length-1];k.scale=T,k.font=S,k.textColor=A}else{const T=a.parse(i[_],1,Hr);if(!T)return null;const S=T.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:T,scale:null,font:null,textColor:null})}}return new kd(d)}evaluate(i){return new Go(this.sections.map(a=>{const u=a.content.evaluate(i);return rr(u)===Su?new qf("",u,null,null,null):new qf(ti(u),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),i.push(u)}return i}}class Dc{constructor(i,a){this.type=Su,this.inputPrimary=i,this.inputSecondary=a}static parse(i,a){if(i.length<2)return a.error("Expected two or more arguments.");const u=a.parse(i[1],1,Fr);if(!u)return a.error("No image name provided.");if(2===i.length)return new Dc(u);const d=a.parse(i[2],1,Fr);return d?new Dc(u,d):a.error("Secondary image variant is not a string.")}evaluate(i){const a=Qs.fromString(this.inputPrimary.evaluate(i),this.inputSecondary?this.inputSecondary.evaluate(i):void 0);return a&&i.availableImages&&(a.available=i.availableImages.indexOf(a.namePrimary)>-1,a.nameSecondary&&a.available&&i.availableImages&&(a.available=i.availableImages.indexOf(a.nameSecondary)>-1)),a}eachChild(i){i(this.inputPrimary),this.inputSecondary&&i(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Gr(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}const c1={"to-boolean":Gt,"to-color":rl,"to-number":ln,"to-string":Fr};class Jc{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const u=i[0],d=[];let m=Na;if("to-array"===u){if(!Array.isArray(i[1]))return null;const _=i[1].length;if(a.expectedType){if("array"!==a.expectedType.kind)return a.error(`Expected ${a.expectedType.kind} but found array.`);m=ca(a.expectedType.itemType,_)}else{if(!(_>0&&Id(i[1][0])))return null;m=ca(rr(i[1][0]),_)}for(let b=0;b<_;b++){const T=i[1][b];let S;if("array"===Gr(T))S=a.parse(T,void 0,m.itemType);else{const A=Gr(T);if(A!==m.itemType.kind)return a.error(`Expected ${m.itemType.kind} but found ${A}.`);S=a.registry.literal.parse(["literal",void 0===T?null:T],a)}if(!S)return null;d.push(S)}}else{if(("to-boolean"===u||"to-string"===u)&&2!==i.length)return a.error("Expected one argument.");m=c1[u];for(let _=1;_<i.length;_++){const b=a.parse(i[_],_,Hr);if(!b)return null;d.push(b)}}return new Jc(m,d)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let a,u;for(const d of this.args){if(a=d.evaluate(i),u=null,a instanceof Jr)return a;if("string"==typeof a){const m=i.parseColor(a);if(m)return m}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Zf(a[0],a[1],a[2],a[3]),!u))return new Jr(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new eo(u||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const u of this.args){if(a=u.evaluate(i),null===a)return 0;const d=Number(a);if(!isNaN(d))return d}throw new eo(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?Go.fromString(ti(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Qs.fromString(ti(this.args[0].evaluate(i))):"array"===this.type.kind?this.args.map(a=>a.evaluate(i)):ti(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new kd([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Dc(this.args[0]).serialize();const i="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}const sl=["Unknown","Point","LineString","Polygon"];class n0{constructor(i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=a}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?sl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-i[0])+this.featureDistanceData.bearing[1]*(d*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=Jr.parse(i)),a}getConfig(i){return this.options?this.options.get(i):null}}class Il{constructor(i,a,u,d,m){this.name=i,this.type=a,this._evaluate=u,this.args=d,this._overloadIndex=m}evaluate(i){if(!this._evaluate){const a=Il.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const u=i[0],d=Il.definitions[u];if(!d)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=[];let T=null,S=-1;for(const[A,k]of _){if(Array.isArray(A)&&A.length!==i.length-1)continue;b.push(A),S++,T=new ki(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const R=[];let L=!1;for(let U=1;U<i.length;U++){const H=i[U],G=Array.isArray(A)?A[U-1]:A.type,Y=T.parse(H,1+R.length,G);if(!Y){L=!0;break}R.push(Y)}if(!L)if(Array.isArray(A)&&A.length!==R.length)T.error(`Expected ${A.length} arguments, but found ${R.length} instead.`);else{for(let U=0;U<R.length;U++){const H=Array.isArray(A)?A[U]:A.type,G=R[U];T.concat(U+1).checkSubtype(H,G.type)}if(0===T.errors.length)return new Il(u,m,k,R,S)}}if(1===b.length)a.errors.push(...T.errors);else{const A=(b.length?b:_.map(([R])=>R)).map(CS).join(" | "),k=[];for(let R=1;R<i.length;R++){const L=a.parse(i[R],1+k.length);if(!L)return null;k.push(Os(L.type))}a.error(`Expected arguments of type ${A}, but found (${k.join(", ")}) instead.`)}return null}static register(i,a){Il.definitions=a;for(const u in a)i[u]=Il}}function CS(o){return Array.isArray(o)?`(${o.map(Os).join(", ")})`:`(${Os(o.type)}...)`}class Mu{constructor(i,a,u){this.type=Hf,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(2!==i.length)return a.error("Expected one argument.");const u=i[1];if("object"!=typeof u||Array.isArray(u))return a.error("Collator options argument must be an object.");const d=a.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Gt);if(!d)return null;const m=a.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Gt);if(!m)return null;let _=null;return u.locale&&(_=a.parse(u.locale,1,Fr),!_)?null:new Mu(d,m,_)}evaluate(i){return new Wf(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function Wr(o,i,a=0,u=o.length-1,d=Hv){for(;u>a;){if(u-a>600){const T=u-a+1,S=i-a+1,A=Math.log(T),k=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*k*(T-k)/T)*(S-T/2<0?-1:1);Wr(o,i,Math.max(a,Math.floor(i-S*k/T+R)),Math.min(u,Math.floor(i+(T-S)*k/T+R)),d)}const m=o[i];let _=a,b=u;for(Au(o,a,i),d(o[u],m)>0&&Au(o,a,u);_<b;){for(Au(o,_,b),_++,b--;d(o[_],m)<0;)_++;for(;d(o[b],m)>0;)b--}0===d(o[a],m)?Au(o,a,b):(b++,Au(o,b,u)),b<=i&&(a=b+1),i<=b&&(u=b-1)}}function Au(o,i,a){const u=o[i];o[i]=o[a],o[a]=u}function Hv(o,i){return o<i?-1:o>i?1:0}function rT(o){let i=0;for(let a,u,d=0,m=o.length,_=m-1;d<m;_=d++)a=o[d],u=o[_],i+=(u.x-a.x)*(a.y+u.y);return i}function Cm(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Iu(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function ku(o,i,a){const u=o[0]-i[0],d=o[1]-i[1],m=o[0]-a[0],_=o[1]-a[1];return u*_-m*d==0&&u*m<=0&&d*_<=0}function Ou(o,i,a=!1){let u=!1;for(let b=0,T=i.length;b<T;b++){const S=i[b];for(let A=0,k=S.length,R=k-1;A<k;R=A++){const L=S[R],U=S[A];if(ku(o,L,U))return a;(m=L)[1]>(d=o)[1]!=(_=U)[1]>d[1]&&d[0]<(_[0]-m[0])*(d[1]-m[1])/(_[1]-m[1])+m[0]&&(u=!u)}}var d,m,_;return u}function Ru(o,i,a,u){const d=u[0]-a[0],m=u[1]-a[1],_=(o[0]-a[0])*m-d*(o[1]-a[1]),b=(i[0]-a[0])*m-d*(i[1]-a[1]);return _>0&&b<0||_<0&&b>0}function Sm(o,i,a,u){return(d=[u[0]-a[0],u[1]-a[1]])[0]*(m=[i[0]-o[0],i[1]-o[1]])[1]-d[1]*m[0]!=0&&!(!Ru(o,i,a,u)||!Ru(a,u,o,i));var d,m}const Dn=8192;function Gv(o,i){const a=(180+o[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,d=Math.pow(2,i.z);return[Math.round(a*d*Dn),Math.round(u*d*Dn)]}function Xe(o,i){for(let a=0;a<i.length;a++)if(Ou(o,i[a]))return!0;return!1}function xh(o,i,a){for(const u of a)for(let d=0,m=u.length,_=m-1;d<m;_=d++)if(Sm(o,i,u[_],u[d]))return!0;return!1}function Xf(o,i){for(let a=0;a<o.length;++a)if(!Ou(o[a],i))return!1;for(let a=0;a<o.length-1;++a)if(xh(o[a],o[a+1],i))return!1;return!0}function Dm(o,i){for(let a=0;a<i.length;a++)if(Xf(o,i[a]))return!0;return!1}function u1(o,i,a){const u=[];for(let d=0;d<o.length;d++){const m=[];for(let _=0;_<o[d].length;_++){const b=Gv(o[d][_],a);Cm(i,b),m.push(b)}u.push(m)}return u}function Wv(o,i,a){const u=[];for(let d=0;d<o.length;d++){const m=u1(o[d],i,a);u.push(m)}return u}function h1(o,i,a,u){if(o[0]<a[0]||o[0]>a[2]){const d=.5*u;let m=o[0]-a[0]>d?-u:a[0]-o[0]>d?u:0;0===m&&(m=o[0]-a[2]>d?-u:a[2]-o[0]>d?u:0),o[0]+=m}Cm(i,o)}function r0(o,i,a,u){const d=Math.pow(2,u.z)*Dn,m=[u.x*Dn,u.y*Dn],_=[];if(!o)return _;for(const b of o)for(const T of b){const S=[T.x+m[0],T.y+m[1]];h1(S,i,a,d),_.push(S)}return _}function Mm(o,i,a,u){const d=Math.pow(2,u.z)*Dn,m=[u.x*Dn,u.y*Dn],_=[];if(!o)return _;for(const T of o){const S=[];for(const A of T){const k=[A.x+m[0],A.y+m[1]];Cm(i,k),S.push(k)}_.push(S)}if(i[2]-i[0]<=d/2){(b=i)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of _)for(const S of T)h1(S,i,a,d)}var b;return _}class Qc{constructor(i,a){this.type=Gt,this.geojson=i,this.geometries=a}static parse(i,a){if(2!==i.length)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Id(i[1])){const u=i[1];if("FeatureCollection"===u.type)for(let d=0;d<u.features.length;++d){const m=u.features[d].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new Qc(u,u.features[d].geometry)}else if("Feature"===u.type){const d=u.geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new Qc(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Qc(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(a,u){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===u.type){const b=u1(u.coordinates,m,_),T=r0(a.geometry(),d,m,_);if(!Iu(d,m))return!1;for(const S of T)if(!Ou(S,b))return!1}if("MultiPolygon"===u.type){const b=Wv(u.coordinates,m,_),T=r0(a.geometry(),d,m,_);if(!Iu(d,m))return!1;for(const S of T)if(!Xe(S,b))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(a,u){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===u.type){const b=u1(u.coordinates,m,_),T=Mm(a.geometry(),d,m,_);if(!Iu(d,m))return!1;for(const S of T)if(!Xf(S,b))return!1}if("MultiPolygon"===u.type){const b=Wv(u.coordinates,m,_),T=Mm(a.geometry(),d,m,_);if(!Iu(d,m))return!1;for(const S of T)if(!Dm(S,b))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Od={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},qv=1/298.257223563,bh=qv*(2-qv),Am=Math.PI/180;class Mo{static fromTile(i,a,u){const d=Math.PI*(1-2*(i+.5)/Math.pow(2,a)),m=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Am;return new Mo(m,u)}static get units(){return Od}constructor(i,a){if(void 0===i)throw new Error("No latitude given.");if(a&&!Od[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Od).join(", ")}`);const u=6378.137*Am*(a?Od[a]:1),d=Math.cos(i*Am),m=1/(1-bh*(1-d*d)),_=Math.sqrt(m);this.kx=u*_*d,this.ky=u*_*m*(1-bh)}distance(i,a){const u=ua(i[0]-a[0])*this.kx,d=(i[1]-a[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(i,a){const u=ua(a[0]-i[0])*this.kx;return Math.atan2(u,(a[1]-i[1])*this.ky)/Am}destination(i,a,u){const d=u*Am;return this.offset(i,Math.sin(d)*a,Math.cos(d)*a)}offset(i,a,u){return[i[0]+a/this.kx,i[1]+u/this.ky]}lineDistance(i){let a=0;for(let u=0;u<i.length-1;u++)a+=this.distance(i[u],i[u+1]);return a}area(i){let a=0;for(let u=0;u<i.length;u++){const d=i[u];for(let m=0,_=d.length,b=_-1;m<_;b=m++)a+=ua(d[m][0]-d[b][0])*(d[m][1]+d[b][1])*(u?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(i,a){let u=0;if(a<=0)return i[0];for(let d=0;d<i.length-1;d++){const m=i[d],_=i[d+1],b=this.distance(m,_);if(u+=b,u>a)return s0(m,_,(a-(u-b))/b)}return i[i.length-1]}pointToSegmentDistance(i,a,u){let[d,m]=a,_=ua(u[0]-d)*this.kx,b=(u[1]-m)*this.ky;if(0!==_||0!==b){const T=(ua(i[0]-d)*this.kx*_+(i[1]-m)*this.ky*b)/(_*_+b*b);T>1?(d=u[0],m=u[1]):T>0&&(d+=_/this.kx*T,m+=b/this.ky*T)}return _=ua(i[0]-d)*this.kx,b=(i[1]-m)*this.ky,Math.sqrt(_*_+b*b)}pointOnLine(i,a){let u=1/0,d=i[0][0],m=i[0][1],_=0,b=0;for(let T=0;T<i.length-1;T++){let S=i[T][0],A=i[T][1],k=ua(i[T+1][0]-S)*this.kx,R=(i[T+1][1]-A)*this.ky,L=0;0===k&&0===R||(L=(ua(a[0]-S)*this.kx*k+(a[1]-A)*this.ky*R)/(k*k+R*R),L>1?(S=i[T+1][0],A=i[T+1][1]):L>0&&(S+=k/this.kx*L,A+=R/this.ky*L)),k=ua(a[0]-S)*this.kx,R=(a[1]-A)*this.ky;const U=k*k+R*R;U<u&&(u=U,d=S,m=A,_=T,b=L)}return{point:[d,m],index:_,t:Math.max(0,Math.min(1,b))}}lineSlice(i,a,u){let d=this.pointOnLine(u,i),m=this.pointOnLine(u,a);if(d.index>m.index||d.index===m.index&&d.t>m.t){const S=d;d=m,m=S}const _=[d.point],b=d.index+1,T=m.index;!Rd(u[b],_[0])&&b<=T&&_.push(u[b]);for(let S=b+1;S<=T;S++)_.push(u[S]);return Rd(u[T],m.point)||_.push(m.point),_}lineSliceAlong(i,a,u){let d=0;const m=[];for(let _=0;_<u.length-1;_++){const b=u[_],T=u[_+1],S=this.distance(b,T);if(d+=S,d>i&&0===m.length&&m.push(s0(b,T,(i-(d-S))/S)),d>=a)return m.push(s0(b,T,(a-(d-S))/S)),m;d>i&&m.push(T)}return m}bufferPoint(i,a){const u=a/this.ky,d=a/this.kx;return[i[0]-d,i[1]-u,i[0]+d,i[1]+u]}bufferBBox(i,a){const u=a/this.ky,d=a/this.kx;return[i[0]-d,i[1]-u,i[2]+d,i[3]+u]}insideBBox(i,a){return ua(i[0]-a[0])>=0&&ua(i[0]-a[2])<=0&&i[1]>=a[1]&&i[1]<=a[3]}}function Rd(o,i){return o[0]===i[0]&&o[1]===i[1]}function s0(o,i,a){const u=ua(i[0]-o[0]);return[o[0]+u*a,o[1]+(i[1]-o[1])*a]}function ua(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Mc{constructor(i=[],a=((u,d)=>u<d?-1:u>d?1:0)){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(0===this.length)return;const i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:u}=this,d=a[i];for(;i>0;){const m=i-1>>1,_=a[m];if(u(d,_)>=0)break;a[i]=_,i=m}a[i]=d}_down(i){const{data:a,compare:u}=this,d=this.length>>1,m=a[i];for(;i<d;){let _=1+(i<<1);const b=_+1;if(b<this.length&&u(a[b],a[_])<0&&(_=b),u(a[_],m)>=0)break;a[i]=a[_],i=_}a[i]=m}}var Ut=8192;function iT(o,i){return i.dist-o.dist}const Yf=100,Zv=50;function ol(o){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==o.length)return!1;for(let a=0;a<i.length;a++)if(i[a]!==o[a])return!1;return!0}function Kf(o){return o[1]-o[0]+1}function al(o,i){const a=o[1]>=o[0]&&o[1]<i;return a||console.warn("Distance Expression: Index is out of range"),a}function Xv(o,i){if(o[0]>o[1])return[null,null];const a=Kf(o);if(i){if(2===a)return[o,null];const u=Math.floor(a/2);return[[o[0],o[0]+u],[o[0]+u,o[1]]]}{if(1===a)return[o,null];const u=Math.floor(a/2)-1;return[[o[0],o[0]+u],[o[0]+u+1,o[1]]]}}function ll(o,i){const a=[1/0,1/0,-1/0,-1/0];if(!al(i,o.length))return a;for(let u=i[0];u<=i[1];++u)Cm(a,o[u]);return a}function kl(o){const i=[1/0,1/0,-1/0,-1/0];for(let a=0;a<o.length;++a)for(let u=0;u<o[a].length;++u)Cm(i,o[a][u]);return i}function mi(o,i,a){if(ol(o)||ol(i))return NaN;let u=0,d=0;return o[2]<i[0]&&(u=i[0]-o[2]),o[0]>i[2]&&(u=o[0]-i[2]),o[1]>i[3]&&(d=o[1]-i[3]),o[3]<i[1]&&(d=i[1]-o[3]),a.distance([0,0],[u,d])}function rc(o){return 360*o-180}function d1(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Fa(o,i){const a=Math.pow(2,i.z),u=(o.y/Ut+i.y)/a;return[rc((o.x/Ut+i.x)/a),d1(u)]}function Im(o,i){const a=[];for(let u=0;u<o.length;++u)a.push(Fa(o[u],i));return a}function km(o,i,a){const u=a.pointOnLine(i,o).point;return a.distance(o,u)}function Ol(o,i,a,u,d){const m=a.slice(u[0],u[1]+1);let _=1/0;for(let b=i[0];b<=i[1];++b)if(0===(_=Math.min(_,km(o[b],m,d))))return 0;return _}function Rl(o,i,a,u,d){const m=Math.min(d.pointToSegmentDistance(o,a,u),d.pointToSegmentDistance(i,a,u)),_=Math.min(d.pointToSegmentDistance(a,o,i),d.pointToSegmentDistance(u,o,i));return Math.min(m,_)}function sT(o,i,a,u,d){if(!al(i,o.length)||!al(u,a.length))return NaN;let m=1/0;for(let _=i[0];_<i[1];++_)for(let b=u[0];b<u[1];++b){if(Sm(o[_],o[_+1],a[b],a[b+1]))return 0;m=Math.min(m,Rl(o[_],o[_+1],a[b],a[b+1],d))}return m}function f1(o,i,a,u,d){if(!al(i,o.length)||!al(u,a.length))return NaN;let m=1/0;for(let _=i[0];_<=i[1];++_)for(let b=u[0];b<=u[1];++b)if(0===(m=Math.min(m,d.distance(o[_],a[b]))))return m;return m}function Yv(o,i,a){if(Ou(o,i,!0))return 0;let u=1/0;for(const d of i){const m=d.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[m-1]&&0===(u=Math.min(u,a.pointToSegmentDistance(o,d[m-1],d[0])))||0===(u=Math.min(u,km(o,d,a))))return u}return u}function Kv(o,i,a,u){if(!al(i,o.length))return NaN;for(let m=i[0];m<=i[1];++m)if(Ou(o[m],a,!0))return 0;let d=1/0;for(let m=i[0];m<i[1];++m)for(const _ of a)for(let b=0,T=_.length,S=T-1;b<T;S=b++){if(Sm(o[m],o[m+1],_[S],_[b]))return 0;d=Math.min(d,Rl(o[m],o[m+1],_[S],_[b],u))}return d}function Jf(o,i){for(const a of o)for(let u=0;u<=a.length-1;++u)if(Ou(a[u],i,!0))return!0;return!1}function Om(o,i,a,u=1/0){const d=kl(o),m=kl(i);if(u!==1/0&&mi(d,m,a)>=u)return u;if(Iu(d,m)){if(Jf(o,i))return 0}else if(Jf(i,o))return 0;let _=u;for(const b of o)for(let T=0,S=b.length,A=S-1;T<S;A=T++)for(const k of i)for(let R=0,L=k.length,U=L-1;R<L;U=R++){if(Sm(b[A],b[T],k[U],k[R]))return 0;_=Math.min(_,Rl(b[A],b[T],k[U],k[R],a))}return _}function wh(o,i,a,u,d,m,_){if(null===m||null===_)return;const b=mi(ll(u,m),ll(d,_),a);b<i&&o.push({dist:b,range1:m,range2:_})}function Pl(o,i,a,u,d=1/0){let m=Math.min(u.distance(o[0],a[0][0]),d);if(0===m)return m;const _=new Mc([{dist:0,range1:[0,o.length-1],range2:[0,0]}],iT),b=i?Zv:Yf,T=kl(a);for(;_.length;){const S=_.pop();if(S.dist>=m)continue;const A=S.range1;if(Kf(A)<=b){if(!al(A,o.length))return NaN;if(i){const k=Kv(o,A,a,u);if(0===(m=Math.min(m,k)))return m}else for(let k=A[0];k<=A[1];++k){const R=Yv(o[k],a,u);if(0===(m=Math.min(m,R)))return m}}else{const k=Xv(A,i);if(null!==k[0]){const R=mi(ll(o,k[0]),T,u);R<m&&_.push({dist:R,range1:k[0],range2:[0,0]})}if(null!==k[1]){const R=mi(ll(o,k[1]),T,u);R<m&&_.push({dist:R,range1:k[1],range2:[0,0]})}}}return m}function Pd(o,i,a,u,d,m=1/0){let _=Math.min(m,d.distance(o[0],a[0]));if(0===_)return _;const b=new Mc([{dist:0,range1:[0,o.length-1],range2:[0,a.length-1]}],iT),T=i?Zv:Yf,S=u?Zv:Yf;for(;b.length;){const A=b.pop();if(A.dist>=_)continue;const k=A.range1,R=A.range2;if(Kf(k)<=T&&Kf(R)<=S){if(!al(k,o.length)||!al(R,a.length))return NaN;if(i&&u?_=Math.min(_,sT(o,k,a,R,d)):i||u?i&&!u?_=Math.min(_,Ol(a,R,o,k,d)):!i&&u&&(_=Math.min(_,Ol(o,k,a,R,d))):_=Math.min(_,f1(o,k,a,R,d)),0===_)return _}else{const L=Xv(k,i),U=Xv(R,u);wh(b,_,d,o,a,L[0],U[0]),wh(b,_,d,o,a,L[0],U[1]),wh(b,_,d,o,a,L[1],U[0]),wh(b,_,d,o,a,L[1],U[1])}}return _}function p1(o,i,a,u,d=1/0){let m=d;const _=ll(o,[0,o.length-1]);for(const b of a)if(!(m!==1/0&&mi(_,ll(b,[0,b.length-1]),u)>=m)&&(m=Math.min(m,Pd(o,i,b,!0,u,m)),0===m))return m;return m}function o0(o,i,a,u,d=1/0){let m=d;const _=ll(o,[0,o.length-1]);for(const b of a){if(m!==1/0&&mi(_,kl(b),u)>=m)continue;const T=Pl(o,i,b,u,m);if(isNaN(T))return T;if(0===(m=Math.min(m,T)))return m}return m}function Nl(o){return"Point"===o||"MultiPoint"===o||"LineString"===o||"MultiLineString"===o||"Polygon"===o||"MultiPolygon"===o}class Nd{constructor(i,a){this.type=ln,this.geojson=i,this.geometries=a}static parse(i,a){if(2!==i.length)return a.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(Id(i[1])){const u=i[1];if("FeatureCollection"===u.type){for(let d=0;d<u.features.length;++d)if(Nl(u.features[d].geometry.type))return new Nd(u,u.features[d].geometry)}else if("Feature"===u.type){if(Nl(u.geometry.type))return new Nd(u,u.geometry)}else if(Nl(u.type))return new Nd(u,u)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const a=i.geometry(),u=i.canonicalID();if(null!=a&&null!=u){if("Point"===i.geometryType())return function(d,m,_){const b=[];for(const S of d)for(const A of S)b.push(Fa(A,m));const T=new Mo(b[0][1],"meters");return"Point"===_.type||"MultiPoint"===_.type||"LineString"===_.type?Pd(b,!1,"Point"===_.type?[_.coordinates]:_.coordinates,"LineString"===_.type,T):"MultiLineString"===_.type?p1(b,!1,_.coordinates,T):"Polygon"===_.type||"MultiPolygon"===_.type?o0(b,!1,"Polygon"===_.type?[_.coordinates]:_.coordinates,T):null}(a,u,this.geometries);if("LineString"===i.geometryType())return function(d,m,_){const b=[];for(const S of d){const A=[];for(const k of S)A.push(Fa(k,m));b.push(A)}const T=new Mo(b[0][0][1],"meters");if("Point"===_.type||"MultiPoint"===_.type||"LineString"===_.type)return p1("Point"===_.type?[_.coordinates]:_.coordinates,"LineString"===_.type,b,T);if("MultiLineString"===_.type){let S=1/0;for(let A=0;A<_.coordinates.length;A++){const k=p1(_.coordinates[A],!0,b,T,S);if(isNaN(k))return k;if(0===(S=Math.min(S,k)))return S}return S}if("Polygon"===_.type||"MultiPolygon"===_.type){let S=1/0;for(let A=0;A<b.length;A++){const k=o0(b[A],!0,"Polygon"===_.type?[_.coordinates]:_.coordinates,T,S);if(isNaN(k))return k;if(0===(S=Math.min(S,k)))return S}return S}return null}(a,u,this.geometries);if("Polygon"===i.geometryType())return function(d,m,_){const b=[];for(const S of function(A,k){const R=A.length;if(R<=1)return[A];const L=[];let U,H;for(let G=0;G<R;G++){const Y=rT(A[G]);0!==Y&&(A[G].area=Math.abs(Y),void 0===H&&(H=Y<0),H===Y<0?(U&&L.push(U),U=[A[G]]):U.push(A[G]))}return U&&L.push(U),L}(d)){const A=[];for(let k=0;k<S.length;++k)A.push(Im(S[k],m));b.push(A)}const T=new Mo(b[0][0][0][1],"meters");if("Point"===_.type||"MultiPoint"===_.type||"LineString"===_.type)return o0("Point"===_.type?[_.coordinates]:_.coordinates,"LineString"===_.type,b,T);if("MultiLineString"===_.type){let S=1/0;for(let A=0;A<_.coordinates.length;A++){const k=o0(_.coordinates[A],!0,b,T,S);if(isNaN(k))return k;if(0===(S=Math.min(S,k)))return S}return S}return"Polygon"===_.type||"MultiPolygon"===_.type?function(S,A,k){let R=1/0;for(const L of S)for(const U of A){const H=Om(L,U,k,R);if(isNaN(H))return H;if(0===(R=Math.min(R,H)))return R}return R}("Polygon"===_.type?[_.coordinates]:_.coordinates,b,T):null}(a,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Qf(o,i){switch(o){case"string":return ti(i);case"number":return+i;case"boolean":return!!i;case"color":return Jr.parse(i);case"formatted":return Go.fromString(ti(i));case"resolvedImage":return Qs.fromString(ti(i))}return i}function Jv(o,i,a,u){return void 0!==u&&(o=u*Math.round(o/u)),void 0!==i&&o<i&&(o=i),void 0!==a&&o>a&&(o=a),o}class Th{constructor(i,a,u){this.type=i,this.key=a,this.scope=u}static parse(i,a){let u=a.expectedType;if(null==u&&(u=Hr),i.length<2||i.length>3)return a.error("Invalid number of arguments for 'config' expression.");const d=a.parse(i[1],1);if(!(d instanceof Kc))return a.error("Key name of 'config' expression must be a string literal.");if(i.length>=3){const m=a.parse(i[2],2);return m instanceof Kc?new Th(u,ti(d.value),ti(m.value)):a.error("Scope of 'config' expression must be a string literal.")}return new Th(u,ti(d.value))}evaluate(i){const a=[this.key,this.scope,i.scope].filter(Boolean).join("\x1f"),u=i.getConfig(a);if(!u)return null;const{type:d,value:m,values:_,minValue:b,maxValue:T,stepValue:S}=u,A=u.default.evaluate(i);let k=A;if(m){const R=i.scope;i.scope=(R||"").split("\x1f").slice(1).join("\x1f"),k=m.evaluate(i),i.scope=R}return d&&(k=Qf(d,k)),void 0===k||void 0===b&&void 0===T&&void 0===S||("number"==typeof k?k=Jv(k,b,T,S):Array.isArray(k)&&(k=k.map(R=>"number"==typeof R?Jv(R,b,T,S):R))),void 0!==m&&void 0!==k&&_&&!_.includes(k)&&(k=A,d&&(k=Qf(d,k))),(d&&d!==this.type||void 0!==k&&rr(k)!==this.type)&&(k=Qf(this.type.kind,k)),k}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.key),i}}function Rm(o){if(o instanceof Il&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Qc||o instanceof Nd)return!1;let i=!0;return o.eachChild(a=>{i&&!Rm(a)&&(i=!1)}),i}function a0(o){if(o instanceof Il&&"feature-state"===o.name)return!1;let i=!0;return o.eachChild(a=>{i&&!a0(a)&&(i=!1)}),i}function ep(o){if(o instanceof Th)return new Set([o.key]);let i=new Set;return o.eachChild(a=>{i=new Set([...i,...ep(a)])}),i}function Pm(o,i){if(o instanceof Il&&i.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(u=>{a&&!Pm(u,i)&&(a=!1)}),a}class Nm{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(2!==i.length||"string"!=typeof i[1])return a.error("'var' expression requires exactly one string literal argument.");const u=i[1];return a.scope.has(u)?new Nm(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class l0{constructor(i,a=[],u,d=new $f,m=[],_,b){this.registry=i,this.path=a,this.key=a.map(T=>`[${T}]`).join(""),this.scope=d,this.errors=m,this.expectedType=u,this._scope=_,this.options=b}parse(i,a,u,d,m={}){return a||u?this.concat(a,u,d)._parse(i,m):this._parse(i,m)}_parse(i,a){function u(d,m,_){return"assert"===_?new nc(m,[d]):"coerce"===_?new Jc(m,[d]):d}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d="string"==typeof i[0]?this.registry[i[0]]:void 0;if(d){let m=d.parse(i,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,b=m.type;if("string"!==_.kind&&"number"!==_.kind&&"boolean"!==_.kind&&"object"!==_.kind&&"array"!==_.kind||"value"!==b.kind)if("color"!==_.kind&&"formatted"!==_.kind&&"resolvedImage"!==_.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(_,b))return null}else m=u(m,_,a.typeAnnotation||"coerce");else m=u(m,_,a.typeAnnotation||"assert")}if(!(m instanceof Kc)&&"resolvedImage"!==m.type.kind&&Fm(m)){const _=new n0(this._scope,this.options);try{m=new Kc(m.type,m.evaluate(_))}catch(b){return this.error(b.message),null}}return m}return Jc.parse(["to-array",i],this)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,u){const d="number"==typeof i?this.path.concat(i):this.path,m=u?this.scope.concat(u):this.scope;return new l0(this.registry,d,a||null,m,this.errors,this._scope,this.options)}error(i,...a){const u=`${this.key}${a.map(d=>`[${d}]`).join("")}`;this.errors.push(new Al(u,i))}checkSubtype(i,a){const u=t0(i,a);return u&&this.error(u),u}}var ki=l0;function Fm(o){if(o instanceof Nm)return Fm(o.boundExpression);if(o instanceof Il&&"error"===o.name||o instanceof Mu||o instanceof Qc||o instanceof Nd||o instanceof Th)return!1;const i=o instanceof Jc||o instanceof nc;let a=!0;return o.eachChild(u=>{a=i?a&&Fm(u):a&&u instanceof Kc}),!!a&&Rm(o)&&Pm(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Fd(o,i){const a=o.length-1;let u,d,m=0,_=a,b=0;for(;m<=_;)if(b=Math.floor((m+_)/2),u=o[b],d=o[b+1],u<=i){if(b===a||i<d)return b;m=b+1}else{if(!(u>i))throw new eo("Input is not a number.");_=b-1}return 0}class Ci{constructor(i,a,u){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[d,m]of u)this.labels.push(d),this.outputs.push(m)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(i[1],1,ln);if(!u)return null;const d=[];let m=null;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);for(let _=1;_<i.length;_+=2){const b=1===_?-1/0:i[_],T=i[_+1],S=_,A=_+1;if("number"!=typeof b)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(d.length&&d[d.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const k=a.parse(T,A,m);if(!k)return null;m=m||k.type,d.push([b,k])}return new Ci(m,u,d)}evaluate(i){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(i);const d=this.input.evaluate(i);if(d<=a[0])return u[0].evaluate(i);const m=a.length;return d>=a[m-1]?u[m-1].evaluate(i):u[Fd(a,d)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}const La=4/29,Vr=6/29,ho=3*Vr*Vr,Wo=Vr*Vr*Vr,Eh=Math.PI/180,ha=180/Math.PI;function Lm(o){return o>Wo?Math.pow(o,1/3):o/ho+La}function c0(o){return o>Vr?o*o*o:ho*(o-La)}function tp(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function g1(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Qv(o){const i=g1(o.r),a=g1(o.g),u=g1(o.b),d=Lm((.4124564*i+.3575761*a+.1804375*u)/.95047),m=Lm((.2126729*i+.7151522*a+.072175*u)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Lm((.0193339*i+.119192*a+.9503041*u)/1.08883)),alpha:o.a}}function np(o){let i=(o.l+16)/116,a=isNaN(o.a)?i:i+o.a/500,u=isNaN(o.b)?i:i-o.b/200;return i=1*c0(i),a=.95047*c0(a),u=1.08883*c0(u),new Jr(tp(3.2404542*a-1.5371385*i-.4985314*u),tp(-.969266*a+1.8760108*i+.041556*u),tp(.0556434*a-.2040259*i+1.0572252*u),o.alpha)}function oT(o,i,a){const u=i-o;return o+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ld={forward:Qv,reverse:np,interpolate:function(o,i,a){return{l:Fn(o.l,i.l,a),a:Fn(o.a,i.a,a),b:Fn(o.b,i.b,a),alpha:Fn(o.alpha,i.alpha,a)}}},rp={forward:function(o){const{l:i,a,b:u}=Qv(o),d=Math.atan2(u,a)*ha;return{h:d<0?d+360:d,c:Math.sqrt(a*a+u*u),l:i,alpha:o.a}},reverse:function(o){const i=o.h*Eh,a=o.c;return np({l:o.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:o.alpha})},interpolate:function(o,i,a){return{h:oT(o.h,i.h,a),c:Fn(o.c,i.c,a),l:Fn(o.l,i.l,a),alpha:Fn(o.alpha,i.alpha,a)}}};var Ch=Object.freeze({__proto__:null,hcl:rp,lab:Ld});class ic{constructor(i,a,u,d,m){this.type=i,this.operator=a,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[_,b]of m)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(i,a,u,d){let m=0;if("exponential"===i.name)m=Bm(a,i.base,u,d);else if("linear"===i.name)m=Bm(a,1,u,d);else if("cubic-bezier"===i.name){const _=i.controlPoints;m=new W_(_[0],_[1],_[2],_[3]).solve(Bm(a,1,u,d))}return m}static parse(i,a){let[u,d,m,..._]=i;if(!Array.isArray(d)||0===d.length)return a.error("Expected an interpolation type expression.",1);if("linear"===d[0])d={name:"linear"};else if("exponential"===d[0]){const S=d[1];if("number"!=typeof S)return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:S}}else{if("cubic-bezier"!==d[0])return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const S=d.slice(1);if(4!==S.length||S.some(A=>"number"!=typeof A||A<0||A>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:S}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(m=a.parse(m,2,ln),!m)return null;const b=[];let T=null;"interpolate-hcl"===u||"interpolate-lab"===u?T=rl:a.expectedType&&"value"!==a.expectedType.kind&&(T=a.expectedType);for(let S=0;S<_.length;S+=2){const A=_[S],k=_[S+1],R=S+3,L=S+4;if("number"!=typeof A)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(b.length&&b[b.length-1][0]>=A)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const U=a.parse(k,L,T);if(!U)return null;T=T||U.type,b.push([A,U])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new ic(T,u,d,m,b):a.error(`Type ${Os(T)} is not interpolatable.`)}evaluate(i){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(i);const d=this.input.evaluate(i);if(d<=a[0])return u[0].evaluate(i);const m=a.length;if(d>=a[m-1])return u[m-1].evaluate(i);const _=Fd(a,d),b=ic.interpolationFactor(this.interpolation,d,a[_],a[_+1]),T=u[_].evaluate(i),S=u[_+1].evaluate(i);return"interpolate"===this.operator?Vf[this.type.kind.toLowerCase()](T,S,b):"interpolate-hcl"===this.operator?rp.reverse(rp.interpolate(rp.forward(T),rp.forward(S),b)):Ld.reverse(Ld.interpolate(Ld.forward(T),Ld.forward(S),b))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,i,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function Bm(o,i,a,u){const d=u-a,m=o-a;return 0===d?0:1===i?m/d:(Math.pow(i,m)-1)/(Math.pow(i,d)-1)}class Bd{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let u=null;const d=a.expectedType;d&&"value"!==d.kind&&(u=d);const m=[];for(const b of i.slice(1)){const T=a.parse(b,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,m.push(T)}const _=d&&m.some(b=>t0(d,b.type));return new Bd(_?Hr:u,m)}evaluate(i){let a,u=null,d=0;for(const m of this.args){if(d++,u=m.evaluate(i),u&&u instanceof Qs&&!u.available&&(a||(a=u),u=null,d===this.args.length))return a;if(null!==u)break}return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class ip{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const u=[];for(let m=1;m<i.length-1;m+=2){const _=i[m];if("string"!=typeof _)return a.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=a.parse(i[m+1],m+1);if(!b)return null;u.push([_,b])}const d=a.parse(i[i.length-1],i.length-1,a.expectedType,u);return d?new ip(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,u]of this.bindings)i.push(a,u.serialize());return i.push(this.result.serialize()),i}}class zm{constructor(i,a,u){this.type=i,this.index=a,this.input=u}static parse(i,a){if(3!==i.length)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,ln),d=a.parse(i[2],2,ca(a.expectedType||Hr));return u&&d?new zm(d.type.itemType,u,d):null}evaluate(i){const a=this.index.evaluate(i),u=this.input.evaluate(i);if(a<0)throw new eo(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new eo(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new eo(`Array index must be an integer, but found ${a} instead.`);return u[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class u0{constructor(i,a){this.type=Gt,this.needle=i,this.haystack=a}static parse(i,a){if(3!==i.length)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Hr),d=a.parse(i[2],2,Hr);return u&&d?il(u.type,[Gt,Fr,ln,Na,Hr])?new u0(u,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Os(u.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(null==u)return!1;if(!Du(a,["boolean","string","number","null"]))throw new eo(`Expected first argument to be of type boolean, string, number or null, but found ${Os(rr(a))} instead.`);if(!Du(u,["string","array"]))throw new eo(`Expected second argument to be of type array or string, but found ${Os(rr(u))} instead.`);return u.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ac{constructor(i,a,u){this.type=ln,this.needle=i,this.haystack=a,this.fromIndex=u}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Hr),d=a.parse(i[2],2,Hr);if(!u||!d)return null;if(!il(u.type,[Gt,Fr,ln,Na,Hr]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Os(u.type)} instead`);if(4===i.length){const m=a.parse(i[3],3,ln);return m?new Ac(u,d,m):null}return new Ac(u,d)}evaluate(i){const a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!Du(a,["boolean","string","number","null"]))throw new eo(`Expected first argument to be of type boolean, string, number or null, but found ${Os(rr(a))} instead.`);if(!Du(u,["string","array"]))throw new eo(`Expected second argument to be of type array or string, but found ${Os(rr(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(i);return u.indexOf(a,d)}return u.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class h0{constructor(i,a,u,d,m,_){this.inputType=i,this.type=a,this.input=u,this.cases=d,this.outputs=m,this.otherwise=_}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let u,d;a.expectedType&&"value"!==a.expectedType.kind&&(d=a.expectedType);const m={},_=[];for(let S=2;S<i.length-1;S+=2){let A=i[S];const k=i[S+1];Array.isArray(A)||(A=[A]);const R=a.concat(S);if(0===A.length)return R.error("Expected at least one branch label.");for(const U of A){if("number"!=typeof U&&"string"!=typeof U)return R.error("Branch labels must be numbers or strings.");if("number"==typeof U&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof U&&Math.floor(U)!==U)return R.error("Numeric branch labels must be integer values.");if(u){if(R.checkSubtype(u,rr(U)))return null}else u=rr(U);if(void 0!==m[String(U)])return R.error("Branch labels must be unique.");m[String(U)]=_.length}const L=a.parse(k,S,d);if(!L)return null;d=d||L.type,_.push(L)}const b=a.parse(i[1],1,Hr);if(!b)return null;const T=a.parse(i[i.length-1],i.length-1,d);return T?"value"!==b.type.kind&&a.concat(1).checkSubtype(u,b.type)?null:new h0(u,d,b,m,_,T):null}evaluate(i){const a=this.input.evaluate(i);return(rr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],d={};for(const _ of a){const b=d[this.cases[_]];void 0===b?(d[this.cases[_]]=u.length,u.push([this.cases[_],[_]])):u[b][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,b]of u)i.push(1===b.length?m(b[0]):b.map(m)),i.push(this.outputs[_].serialize());return i.push(this.otherwise.serialize()),i}}class sp{constructor(i,a,u){this.type=i,this.branches=a,this.otherwise=u}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&"value"!==a.expectedType.kind&&(u=a.expectedType);const d=[];for(let _=1;_<i.length-1;_+=2){const b=a.parse(i[_],_,Gt);if(!b)return null;const T=a.parse(i[_+1],_+1,u);if(!T)return null;d.push([b,T]),u=u||T.type}const m=a.parse(i[i.length-1],i.length-1,u);return m?new sp(u,d,m):null}evaluate(i){for(const[a,u]of this.branches)if(a.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,u]of this.branches)i(a),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class Sh{constructor(i,a,u,d){this.type=i,this.input=a,this.beginIndex=u,this.endIndex=d}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Hr),d=a.parse(i[2],2,ln);if(!u||!d)return null;if(!il(u.type,[ca(Hr),Fr,Hr]))return a.error(`Expected first argument to be of type array or string, but found ${Os(u.type)} instead`);if(4===i.length){const m=a.parse(i[3],3,ln);return m?new Sh(u.type,u,d,m):null}return new Sh(u.type,u,d)}evaluate(i){const a=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!Du(a,["string","array"]))throw new eo(`Expected first argument to be of type array or string, but found ${Os(rr(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(i);return a.slice(u,d)}return a.slice(u)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function d0(o,i){return"=="===o||"!="===o?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function op(o,i,a,u){return 0===u.compare(i,a)}function Pu(o,i,a){const u="=="!==o&&"!="!==o;return class oH{constructor(m,_,b){this.type=Gt,this.lhs=m,this.rhs=_,this.collator=b,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const b=m[0];let T=_.parse(m[1],1,Hr);if(!T)return null;if(!d0(b,T.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${Os(T.type)}'.`);let S=_.parse(m[2],2,Hr);if(!S)return null;if(!d0(b,S.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${Os(S.type)}'.`);if(T.type.kind!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return _.error(`Cannot compare types '${Os(T.type)}' and '${Os(S.type)}'.`);u&&("value"===T.type.kind&&"value"!==S.type.kind?T=new nc(S.type,[T]):"value"!==T.type.kind&&"value"===S.type.kind&&(S=new nc(T.type,[S])));let A=null;if(4===m.length){if("string"!==T.type.kind&&"string"!==S.type.kind&&"value"!==T.type.kind&&"value"!==S.type.kind)return _.error("Cannot use collator to compare non-string types.");if(A=_.parse(m[3],3,Hf),!A)return null}return new oH(T,S,A)}evaluate(m){const _=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){const T=rr(_),S=rr(b);if(T.kind!==S.kind||"string"!==T.kind&&"number"!==T.kind)throw new eo(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=rr(_),S=rr(b);if("string"!==T.kind||"string"!==S.kind)return i(m,_,b)}return this.collator?a(m,_,b,this.collator.evaluate(m)):i(m,_,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const qo=Pu("==",function(o,i,a){return i===a},op),zd=Pu("!=",function(o,i,a){return i!==a},function(o,i,a,u){return!op(0,i,a,u)}),_1=Pu("<",function(o,i,a){return i<a},function(o,i,a,u){return u.compare(i,a)<0}),aT=Pu(">",function(o,i,a){return i>a},function(o,i,a,u){return u.compare(i,a)>0}),lT=Pu("<=",function(o,i,a){return i<=a},function(o,i,a,u){return u.compare(i,a)<=0}),ex=Pu(">=",function(o,i,a){return i>=a},function(o,i,a,u){return u.compare(i,a)>=0});class Dh{constructor(i,a,u,d,m,_){this.type=Fr,this.number=i,this.locale=a,this.currency=u,this.unit=d,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(i,a){if(3!==i.length)return a.error("Expected two arguments.");const u=a.parse(i[1],1,ln);if(!u)return null;const d=i[2];if("object"!=typeof d||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=a.parse(d.locale,1,Fr),!m))return null;let _=null;if(d.currency&&(_=a.parse(d.currency,1,Fr),!_))return null;let b=null;if(d.unit&&(b=a.parse(d.unit,1,Fr),!b))return null;let T=null;if(d["min-fraction-digits"]&&(T=a.parse(d["min-fraction-digits"],1,ln),!T))return null;let S=null;return d["max-fraction-digits"]&&(S=a.parse(d["max-fraction-digits"],1,ln),!S)?null:new Dh(u,m,_,b,T,S)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class y1{constructor(i){this.type=ln,this.input=i}static parse(i,a){if(2!==i.length)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const u=a.parse(i[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?a.error(`Expected argument of type string or array, but found ${Os(u.type)} instead.`):new y1(u):null}evaluate(i){const a=this.input.evaluate(i);if("string"==typeof a||Array.isArray(a))return a.length;throw new eo(`Expected value to be of type string or array, but found ${Os(rr(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}function tx(o){return function(){o=1831565813+(o|=0)|0;let i=Math.imul(o^o>>>15,1|o);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const ap={"==":qo,"!=":zd,">":aT,"<":_1,">=":ex,"<=":lT,array:nc,at:zm,boolean:nc,case:sp,coalesce:Bd,collator:Mu,format:kd,image:Dc,in:u0,"index-of":Ac,interpolate:ic,"interpolate-hcl":ic,"interpolate-lab":ic,length:y1,let:ip,literal:Kc,match:h0,number:nc,"number-format":Dh,object:nc,slice:Sh,step:Ci,string:nc,"to-boolean":Jc,"to-color":Jc,"to-number":Jc,"to-string":Jc,var:Nm,within:Qc,distance:Nd,config:Th};function f0(o,[i,a,u,d]){i=i.evaluate(o),a=a.evaluate(o),u=u.evaluate(o);const m=d?d.evaluate(o):1,_=Zf(i,a,u,m);if(_)throw new eo(_);return new Jr(i/255*m,a/255*m,u/255*m,m)}function Ic(o,[i,a,u,d]){i=i.evaluate(o),a=a.evaluate(o),u=u.evaluate(o);const m=d?d.evaluate(o):1,_=(A=a,k=u,R=m,"number"==typeof(S=i)&&S>=0&&S<=360?"number"==typeof A&&A>=0&&A<=100&&"number"==typeof k&&k>=0&&k<=100?void 0===R||"number"==typeof R&&R>=0&&R<=1?null:`Invalid hsla value [${[S,A,k,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof R?[S,A,k,R]:[S,A,k]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof R?[S,A,k,R]:[S,A,k]).join(", ")}]: 'h' must be between 0 and 360.`);var S,A,k,R;if(_)throw new eo(_);const b=`hsla(${i}, ${a}%, ${u}%, ${m})`,T=Jr.parse(b);if(!T)throw new eo(`Failed to parse HSLA color: ${b}`);return T}function y(o,i){return o in i}function c(o,i){const a=i[o];return void 0===a?null:a}function p(o){return{type:o}}function v(o){return{result:"success",value:o}}function w(o){return{result:"error",value:o}}function C(o,i){return!!o&&!!o.parameters&&o.parameters.indexOf(i)>-1}function M(o){return"data-driven"===o["property-type"]}function I(o){return C(o.expression,"measure-light")}function P(o){return C(o.expression,"zoom")}function F(o){return!!o.expression&&o.expression.interpolated}function z(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function j(o){return o}function q(o,i){const a="color"===i.type,u=o.stops&&"object"==typeof o.stops[0][0],d=u||!(u||void 0!==o.property),m=o.type||(F(i)?"exponential":"interval");if(a&&((o=jf({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],Jr.parse(S[1])])),o.default=Jr.parse(o.default?o.default:i.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!Ch[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let _,b,T;if("exponential"===m)_=ie;else if("interval"===m)_=re;else if("categorical"===m){_=ne,b=Object.create(null);for(const S of o.stops)b[S[0]]=S[1];T=typeof o.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=Q}if(u){const S={},A=[];for(let L=0;L<o.stops.length;L++){const U=o.stops[L],H=U[0].zoom;void 0===S[H]&&(S[H]={zoom:H,type:o.type,property:o.property,default:o.default,stops:[]},A.push(H)),S[H].stops.push([U[0].value,U[1]])}const k=[];for(const L of A)k.push([S[L].zoom,q(S[L],i)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:ic.interpolationFactor.bind(void 0,R),zoomStops:k.map(L=>L[0]),evaluate:({zoom:L},U)=>ie({stops:k,base:o.base},i,L).evaluate(L,U)}}if(d){const S="exponential"===m?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ic.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(A=>A[0]),evaluate:({zoom:A})=>_(o,i,A,b,T)}}return{kind:"source",evaluate(S,A){const k=A&&A.properties?A.properties[o.property]:void 0;return void 0===k?Z(o.default,i.default):_(o,i,k,b,T)}}}function Z(o,i,a){return void 0!==o?o:void 0!==i?i:void 0!==a?a:void 0}function ne(o,i,a,u,d){return Z(typeof a===d?u[a]:void 0,o.default,i.default)}function re(o,i,a){if("number"!==Gr(a))return Z(o.default,i.default);const u=o.stops.length;if(1===u||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[u-1][0])return o.stops[u-1][1];const d=Fd(o.stops.map(m=>m[0]),a);return o.stops[d][1]}function ie(o,i,a){const u=void 0!==o.base?o.base:1;if("number"!==Gr(a))return Z(o.default,i.default);const d=o.stops.length;if(1===d||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[d-1][0])return o.stops[d-1][1];const m=Fd(o.stops.map(A=>A[0]),a),_=function(A,k,R,L){const U=L-R,H=A-R;return 0===U?0:1===k?H/U:(Math.pow(k,H)-1)/(Math.pow(k,U)-1)}(a,u,o.stops[m][0],o.stops[m+1][0]),b=o.stops[m][1],T=o.stops[m+1][1];let S=Vf[i.type]||j;if(o.colorSpace&&"rgb"!==o.colorSpace){const A=Ch[o.colorSpace];S=(k,R)=>A.reverse(A.interpolate(A.forward(k),A.forward(R),_))}return"function"==typeof b.evaluate?{evaluate(...A){const k=b.evaluate.apply(void 0,A),R=T.evaluate.apply(void 0,A);if(void 0!==k&&void 0!==R)return S(k,R,_)}}:S(b,T,_)}function Q(o,i,a){return"color"===i.type?a=Jr.parse(a):"formatted"===i.type?a=Go.fromString(a.toString()):"resolvedImage"===i.type?a=Qs.fromString(a.toString()):Gr(a)===i.type||"enum"===i.type&&i.values[a]||(a=void 0),Z(a,o.default,i.default)}Il.register(ap,{error:[{kind:"error"},[Fr],(o,[i])=>{throw new eo(i.evaluate(o))}],typeof:[Fr,[Hr],(o,[i])=>Os(rr(i.evaluate(o)))],"to-rgba":[ca(ln,4),[rl],(o,[i])=>i.evaluate(o).toRenderColor(null).toArray()],rgb:[rl,[ln,ln,ln],f0],rgba:[rl,[ln,ln,ln,ln],f0],hsl:[rl,[ln,ln,ln],Ic],hsla:[rl,[ln,ln,ln,ln],Ic],has:{type:Gt,overloads:[[[Fr],(o,[i])=>y(i.evaluate(o),o.properties())],[[Fr,vh],(o,[i,a])=>y(i.evaluate(o),a.evaluate(o))]]},get:{type:Hr,overloads:[[[Fr],(o,[i])=>c(i.evaluate(o),o.properties())],[[Fr,vh],(o,[i,a])=>c(i.evaluate(o),a.evaluate(o))]]},"feature-state":[Hr,[Fr],(o,[i])=>c(i.evaluate(o),o.featureState||{})],properties:[vh,[],o=>o.properties()],"geometry-type":[Fr,[],o=>o.geometryType()],id:[Hr,[],o=>o.id()],zoom:[ln,[],o=>o.globals.zoom],pitch:[ln,[],o=>o.globals.pitch||0],"distance-from-center":[ln,[],o=>o.distanceFromCenter()],"measure-light":[ln,[Fr],(o,[i])=>o.measureLight(i.evaluate(o))],"heatmap-density":[ln,[],o=>o.globals.heatmapDensity||0],"line-progress":[ln,[],o=>o.globals.lineProgress||0],"raster-value":[ln,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[ln,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[ln,[],o=>o.globals.skyRadialProgress||0],accumulated:[Hr,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[ln,p(ln),(o,i)=>{let a=0;for(const u of i)a+=u.evaluate(o);return a}],"*":[ln,p(ln),(o,i)=>{let a=1;for(const u of i)a*=u.evaluate(o);return a}],"-":{type:ln,overloads:[[[ln,ln],(o,[i,a])=>i.evaluate(o)-a.evaluate(o)],[[ln],(o,[i])=>-i.evaluate(o)]]},"/":[ln,[ln,ln],(o,[i,a])=>i.evaluate(o)/a.evaluate(o)],"%":[ln,[ln,ln],(o,[i,a])=>i.evaluate(o)%a.evaluate(o)],ln2:[ln,[],()=>Math.LN2],pi:[ln,[],()=>Math.PI],e:[ln,[],()=>Math.E],"^":[ln,[ln,ln],(o,[i,a])=>Math.pow(i.evaluate(o),a.evaluate(o))],sqrt:[ln,[ln],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[ln,[ln],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[ln,[ln],(o,[i])=>Math.log(i.evaluate(o))],log2:[ln,[ln],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[ln,[ln],(o,[i])=>Math.sin(i.evaluate(o))],cos:[ln,[ln],(o,[i])=>Math.cos(i.evaluate(o))],tan:[ln,[ln],(o,[i])=>Math.tan(i.evaluate(o))],asin:[ln,[ln],(o,[i])=>Math.asin(i.evaluate(o))],acos:[ln,[ln],(o,[i])=>Math.acos(i.evaluate(o))],atan:[ln,[ln],(o,[i])=>Math.atan(i.evaluate(o))],min:[ln,p(ln),(o,i)=>Math.min(...i.map(a=>a.evaluate(o)))],max:[ln,p(ln),(o,i)=>Math.max(...i.map(a=>a.evaluate(o)))],abs:[ln,[ln],(o,[i])=>Math.abs(i.evaluate(o))],round:[ln,[ln],(o,[i])=>{const a=i.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[ln,[ln],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[ln,[ln],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[Gt,[Fr,Hr],(o,[i,a])=>o.properties()[i.value]===a.value],"filter-id-==":[Gt,[Hr],(o,[i])=>o.id()===i.value],"filter-type-==":[Gt,[Fr],(o,[i])=>o.geometryType()===i.value],"filter-<":[Gt,[Fr,Hr],(o,[i,a])=>{const u=o.properties()[i.value],d=a.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Gt,[Hr],(o,[i])=>{const a=o.id(),u=i.value;return typeof a==typeof u&&a<u}],"filter->":[Gt,[Fr,Hr],(o,[i,a])=>{const u=o.properties()[i.value],d=a.value;return typeof u==typeof d&&u>d}],"filter-id->":[Gt,[Hr],(o,[i])=>{const a=o.id(),u=i.value;return typeof a==typeof u&&a>u}],"filter-<=":[Gt,[Fr,Hr],(o,[i,a])=>{const u=o.properties()[i.value],d=a.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Gt,[Hr],(o,[i])=>{const a=o.id(),u=i.value;return typeof a==typeof u&&a<=u}],"filter->=":[Gt,[Fr,Hr],(o,[i,a])=>{const u=o.properties()[i.value],d=a.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Gt,[Hr],(o,[i])=>{const a=o.id(),u=i.value;return typeof a==typeof u&&a>=u}],"filter-has":[Gt,[Hr],(o,[i])=>i.value in o.properties()],"filter-has-id":[Gt,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[Gt,[ca(Fr)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[Gt,[ca(Hr)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[Gt,[Fr,ca(Hr)],(o,[i,a])=>a.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[Gt,[Fr,ca(Hr)],(o,[i,a])=>function(u,d,m,_){for(;m<=_;){const b=m+_>>1;if(d[b]===u)return!0;d[b]>u?_=b-1:m=b+1}return!1}(o.properties()[i.value],a.value,0,a.value.length-1)],all:{type:Gt,overloads:[[[Gt,Gt],(o,[i,a])=>i.evaluate(o)&&a.evaluate(o)],[p(Gt),(o,i)=>{for(const a of i)if(!a.evaluate(o))return!1;return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],(o,[i,a])=>i.evaluate(o)||a.evaluate(o)],[p(Gt),(o,i)=>{for(const a of i)if(a.evaluate(o))return!0;return!1}]]},"!":[Gt,[Gt],(o,[i])=>!i.evaluate(o)],"is-supported-script":[Gt,[Fr],(o,[i])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(i.evaluate(o))}],upcase:[Fr,[Fr],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[Fr,[Fr],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[Fr,p(Hr),(o,i)=>i.map(a=>ti(a.evaluate(o))).join("")],"resolved-locale":[Fr,[Hf],(o,[i])=>i.evaluate(o).resolvedLocale()],random:[ln,[ln,ln,Hr],(o,i)=>{const[a,u,d]=i.map(_=>_.evaluate(o));if(a>u||a===u)return a;let m;if("string"==typeof d)m=function(_){let b=0;if(0===_.length)return b;for(let T=0;T<_.length;T++)b=(b<<5)-b+_.charCodeAt(T),b|=0;return b}(d);else{if("number"!=typeof d)throw new eo(`Invalid seed input: ${d}`);m=d}return a+tx(m)()*(u-a)}]});class se{constructor(i,a,u,d){var m;this.expression=i,this._warningHistory={},this._evaluator=new n0(u,d),this._defaultValue=a?"color"===(m=a).type&&(z(m.default)||Array.isArray(m.default))?new Jr(0,0,0,0):"color"===m.type?Jr.parse(m.default)||null:void 0===m.default?null:m.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(i,a,u,d,m,_,b,T){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,u,d,m,_,b,T){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null;try{const S=this.expression.evaluate(this._evaluator);if(null==S||"number"==typeof S&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new eo(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function ce(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in ap}function de(o,i,a,u){const d=new ki(ap,[],i?function(_){const b={color:rl,string:Fr,number:ln,enum:Fr,boolean:Gt,formatted:Gf,resolvedImage:Su};return"array"===_.type?ca(b[_.value]||Hr,_.length):b[_.type]}(i):void 0,void 0,void 0,a,u),m=d.parse(o,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return m?v(new se(m,i,a,u)):w(d.errors)}class be{constructor(i,a,u){this.kind=i,this._styleExpression=a,this.isLightConstant=u,this.isStateDependent="constant"!==i&&!a0(a.expression),this.configDependencies=ep(a.expression)}evaluateWithoutErrorHandling(i,a,u,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,d,m,_)}evaluate(i,a,u,d,m,_){return this._styleExpression.evaluate(i,a,u,d,m,_)}}class _e{constructor(i,a,u,d,m){this.kind=i,this.zoomStops=u,this._styleExpression=a,this.isStateDependent="camera"!==i&&!a0(a.expression),this.isLightConstant=m,this.configDependencies=ep(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(i,a,u,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,d,m,_)}evaluate(i,a,u,d,m,_){return this._styleExpression.evaluate(i,a,u,d,m,_)}interpolationFactor(i,a,u){return this.interpolationType?ic.interpolationFactor(this.interpolationType,i,a,u):0}}function ye(o,i,a,u){if("error"===(o=de(o,i,a,u)).result)return o;const d=o.value.expression,m=Rm(d);if(!m&&!M(i))return w([new Al("","data expressions not supported")]);const _=Pm(d,["zoom","pitch","distance-from-center"]);if(!_&&!P(i))return w([new Al("","zoom expressions not supported")]);const b=Pm(d,["measure-light"]);if(!b&&!I(i))return w([new Al("","measure-light expression not supported")]);const T=i.expression&&i.expression.relaxZoomRestriction,S=Ee(d);return S||_||T?S instanceof Al?w([S]):S instanceof ic&&!F(i)?w([new Al("",'"interpolate" expressions cannot be used with this property')]):v(S?new _e(m?"camera":"composite",o.value,S.labels,S instanceof ic?S.interpolation:void 0,b):new be(m?"constant":"source",o.value,b)):w([new Al("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class De{constructor(i,a){this._parameters=i,this._specification=a,jf(this,q(this._parameters,this._specification))}static deserialize(i){return new De(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Ee(o){let i=null;if(o instanceof ip)i=Ee(o.result);else if(o instanceof Bd){for(const a of o.args)if(i=Ee(a),i)break}else(o instanceof Ci||o instanceof ic)&&o.input instanceof Il&&"zoom"===o.input.name&&(i=o);return i instanceof Al||o.eachChild(a=>{const u=Ee(a);u instanceof Al?i=u:i&&u&&i!==u&&(i=new Al("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var Be=pe,ke=3;function pe(o,i,a){var u=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var d=new Int32Array(this.arrayBuffer);o=d[0],this.d=(i=d[1])+2*(a=d[2]);for(var m=0;m<this.d*this.d;m++){var _=d[ke+m],b=d[ke+m+1];u.push(_===b?null:d.subarray(_,b))}var T=d[ke+u.length+1];this.keys=d.subarray(d[ke+u.length],T),this.bboxes=d.subarray(T),this.insert=this._insertReadonly}else{this.d=i+2*a;for(var S=0;S<this.d*this.d;S++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=o,this.padding=a,this.scale=i/o,this.uid=0;var A=a/i*o;this.min=-A,this.max=o+A}pe.prototype.insert=function(o,i,a,u,d){this._forEachCell(i,a,u,d,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d)},pe.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},pe.prototype._insertCell=function(o,i,a,u,d,m){this.cells[d].push(m)},pe.prototype.query=function(o,i,a,u,d){var m=this.min,_=this.max;if(o<=m&&i<=m&&_<=a&&_<=u&&!d)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(o,i,a,u,this._queryCell,b,{},d),b},pe.prototype._queryCell=function(o,i,a,u,d,m,_,b){var T=this.cells[d];if(null!==T)for(var S=this.keys,A=this.bboxes,k=0;k<T.length;k++){var R=T[k];if(void 0===_[R]){var L=4*R;(b?b(A[L+0],A[L+1],A[L+2],A[L+3]):o<=A[L+2]&&i<=A[L+3]&&a>=A[L+0]&&u>=A[L+1])?(_[R]=!0,m.push(S[R])):_[R]=!1}}},pe.prototype._forEachCell=function(o,i,a,u,d,m,_,b){for(var T=this._convertToCellCoord(o),S=this._convertToCellCoord(i),A=this._convertToCellCoord(a),k=this._convertToCellCoord(u),R=T;R<=A;R++)for(var L=S;L<=k;L++){var U=this.d*L+R;if((!b||b(this._convertFromCellCoord(R),this._convertFromCellCoord(L),this._convertFromCellCoord(R+1),this._convertFromCellCoord(L+1)))&&d.call(this,o,i,a,u,U,m,_,b))return}},pe.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},pe.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},pe.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,i=ke+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var d=new Int32Array(i+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var m=i,_=0;_<o.length;_++){var b=o[_];d[ke+_]=m,d.set(b,m),m+=b.length}return d[ke+o.length]=m,d.set(this.keys,m),d[ke+o.length+1]=m+=this.keys.length,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer};var Je=Uo(Be);const Ke={};function Pe(o,i,a={}){Object.defineProperty(o,"_classRegistryKey",{value:i,writable:!1}),Ke[i]={klass:o,omit:a.omit||[]}}Pe(Object,"Object"),Je.serialize=function(o,i){const a=o.toArrayBuffer();return i&&i.add(a),{buffer:a}},Je.deserialize=function(o){return new Je(o.buffer)},Object.defineProperty(Je,"name",{value:"Grid"}),Pe(Je,"Grid"),Pe(Jr,"Color"),Pe(Error,"Error"),Pe(Go,"Formatted"),Pe(qf,"FormattedSection"),Pe(r1,"AJAXError"),Pe(Qs,"ResolvedImage"),Pe(De,"StylePropertyFunction"),Pe(se,"StyleExpression",{omit:["_evaluator"]}),Pe(_e,"ZoomDependentExpression"),Pe(be,"ZoomConstantExpression"),Pe(Il,"CompoundExpression",{omit:["_evaluate"]});for(const o in ap)Ke[ap[o]._classRegistryKey]||Pe(ap[o],`Expression${o}`);function pt(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function mt(o){return self.ImageBitmap&&o instanceof ImageBitmap}function He(o,i){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(pt(o)||mt(o))return i&&i.add(o),o;if(ArrayBuffer.isView(o)){const a=o;return i&&i.add(a.buffer),a}if(o instanceof ImageData)return i&&i.add(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const u of o)a.push(He(u,i));return a}if(o instanceof Map){const a={$name:"Map"};for(const[u,d]of o.entries())a[u]=He(d);return a}if(o instanceof Set){const a={$name:"Set"};let u=0;for(const d of o.values())a[++u]=He(d);return a}if("object"==typeof o){const a=o.constructor,u=a._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const d=a.serialize?a.serialize(o,i):{};if(!a.serialize){for(const m in o)o.hasOwnProperty(m)&&(Ke[u].omit.indexOf(m)>=0||(d[m]=He(o[m],i)));o instanceof Error&&(d.message=o.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof o)}function nt(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||pt(o)||mt(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(nt);if("object"==typeof o){const i=o.$name||"Object";if("Map"===i){const d=new Map;for(const m of Object.keys(o))"$name"!==m&&d.set(m,nt(o[m]));return d}if("Set"===i){const d=new Set;for(const m of Object.keys(o))"$name"!==m&&d.add(nt(o[m]));return d}const{klass:a}=Ke[i];if(!a)throw new Error(`can't deserialize unregistered class ${i}`);if(a.deserialize)return a.deserialize(o);const u=Object.create(a.prototype);for(const d of Object.keys(o))"$name"!==d&&(u[d]=nt(o[d]));return u}throw new Error("can't deserialize object of type "+typeof o)}const Oe={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function _t(o){for(const i of o)if(Vt(i.charCodeAt(0)))return!0;return!1}function gt(o){for(const i of o)if(!Wt(i.charCodeAt(0)))return!1;return!0}function Wt(o){return!(Oe.Arabic(o)||Oe["Arabic Supplement"](o)||Oe["Arabic Extended-A"](o)||Oe["Arabic Presentation Forms-A"](o)||Oe["Arabic Presentation Forms-B"](o))}function Vt(o){return!(746!==o&&747!==o&&(o<4352||!(Oe["Bopomofo Extended"](o)||Oe.Bopomofo(o)||Oe["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Oe["CJK Compatibility Ideographs"](o)||Oe["CJK Compatibility"](o)||Oe["CJK Radicals Supplement"](o)||Oe["CJK Strokes"](o)||!(!Oe["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Oe["CJK Unified Ideographs Extension A"](o)||Oe["CJK Unified Ideographs"](o)||Oe["Enclosed CJK Letters and Months"](o)||Oe["Hangul Compatibility Jamo"](o)||Oe["Hangul Jamo Extended-A"](o)||Oe["Hangul Jamo Extended-B"](o)||Oe["Hangul Jamo"](o)||Oe["Hangul Syllables"](o)||Oe.Hiragana(o)||Oe["Ideographic Description Characters"](o)||Oe.Kanbun(o)||Oe["Kangxi Radicals"](o)||Oe["Katakana Phonetic Extensions"](o)||Oe.Katakana(o)&&12540!==o||!(!Oe["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Oe["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Oe["Unified Canadian Aboriginal Syllabics"](o)||Oe["Unified Canadian Aboriginal Syllabics Extended"](o)||Oe["Vertical Forms"](o)||Oe["Yijing Hexagram Symbols"](o)||Oe["Yi Syllables"](o)||Oe["Yi Radicals"](o))))}function bt(o){return!(Vt(o)||(i=o,Oe["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||Oe["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||Oe["Letterlike Symbols"](i)||Oe["Number Forms"](i)||Oe["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||Oe["Control Pictures"](i)&&9251!==i||Oe["Optical Character Recognition"](i)||Oe["Enclosed Alphanumerics"](i)||Oe["Geometric Shapes"](i)||Oe["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Oe["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Oe["CJK Symbols and Punctuation"](i)||Oe.Katakana(i)||Oe["Private Use Area"](i)||Oe["CJK Compatibility Forms"](i)||Oe["Small Form Variants"](i)||Oe["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function Qt(o){return o>=1424&&o<=2303||Oe["Arabic Presentation Forms-A"](o)||Oe["Arabic Presentation Forms-B"](o)}function Pn(o,i){return!(!i&&Qt(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Oe.Khmer(o))}function Yn(o){for(const i of o)if(Qt(i.charCodeAt(0)))return!0;return!1}const Un="deferred",or="loading",Kn="loaded";let Si=null,wr="unavailable",ur=null;const ni=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(wr="error"),Si&&Si(o)};function dr(){xr.fire(new Yc("pluginStateChange",{pluginStatus:wr,pluginURL:ur}))}const xr=new Uf,Zn=function(){return wr},Ir=function(){if(wr!==Un||!ur)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");wr=or,dr(),ur&&Pa({url:ur},o=>{o?ni(o):(wr=Kn,dr())})},Sr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>wr===Kn||null!=Sr.applyArabicShaping,isLoading:()=>wr===or,setState(o){wr=o.pluginStatus,ur=o.pluginURL},isParsed:()=>null!=Sr.applyArabicShaping&&null!=Sr.processBidirectionalText&&null!=Sr.processStyledBidirectionalText,getPluginURL:()=>ur};class tr{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(a,u){for(const d of a)if(!Pn(d.charCodeAt(0),u))return!1;return!0}(i,Sr.isLoaded())}}class vs{constructor(i,a,u,d){this.property=i,this.value=a,this.expression=function(m,_,b,T){if(z(m))return new De(m,_);if(ce(m)||Array.isArray(m)&&m.length>0){const S=ye(m,_,b,T);if("error"===S.result)throw new Error(S.value.map(A=>`${A.key}: ${A.message}`).join(", "));return S.value}{let S=m;return"string"==typeof m&&"color"===_.type&&(S=Jr.parse(m)),{kind:"constant",configDependencies:new Set,evaluate:()=>S}}}(void 0===a?i.specification.default:a,i.specification,u,d)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,a,u){return this.property.possiblyEvaluate(this,i,a,u)}}class Es{constructor(i,a,u){this.property=i,this.value=new vs(i,void 0,a,u)}transitioned(i,a){return new yo(this.property,this.value,a,$o({},i.transition,this.transition),i.now)}untransitioned(){return new yo(this.property,this.value,null,{},0)}}class Zo{constructor(i,a,u){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=a,this._options=u,this.configDependencies=new Set}getValue(i){return Ra(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Es(this._values[i].property,this._scope,this._options)),this._values[i].value=new vs(this._values[i].property,null===a?void 0:Ra(a),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,a){a&&(this._options=a);const u=this._properties.properties;if(i)for(const d in i){const m=i[d];if(mm(d,"-transition")){const _=d.slice(0,-11);u[_]&&this.setTransition(_,m)}else u.hasOwnProperty(d)&&this.setValue(d,m)}}getTransition(i){return Ra(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Es(this._values[i].property)),this._values[i].transition=Ra(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(i[a]=u);const d=this.getTransition(a);void 0!==d&&(i[`${a}-transition`]=d)}return i}transitioned(i,a){const u=new Xo(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(i,a._values[d]);return u}untransitioned(){const i=new Xo(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class yo{constructor(i,a,u,d,m){const _=d.delay||0,b=d.duration||0;m=m||0,this.property=i,this.value=a,this.begin=m+_,this.end=this.begin+b,i.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(i,a,u){const d=i.now||0,m=this.value.possiblyEvaluate(i,a,u),_=this.prior;if(_){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return _.possiblyEvaluate(i,a,u);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(i,a,u),m,Ug(b))}}return m}}class Xo{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,u){const d=new Yo(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(i,a,u);return d}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class da{constructor(i,a,u){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=a,this._options=u,this.configDependencies=new Set}getValue(i){return Ra(this._values[i].value)}setValue(i,a){this._values[i]=new vs(this._values[i].property,null===a?void 0:Ra(a),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(i[a]=u)}return i}possiblyEvaluate(i,a,u){const d=new Yo(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(i,a,u);return d}}class Ao{constructor(i,a,u){this.property=i,this.value=a,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,a,u,d){return this.property.evaluate(this.value,this.parameters,i,a,u,d)}}class Yo{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Pt{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,u){const d=Vf[this.specification.type];return d?d(i,a,u):i}}class fn{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,u,d){return new Ao(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(a,null,{},u,d)}:i.expression,a)}interpolate(i,a,u){if("constant"!==i.value.kind||"constant"!==a.value.kind)return i;if(void 0===i.value.value||void 0===a.value.value)return new Ao(this,{kind:"constant",value:void 0},i.parameters);const d=Vf[this.specification.type];return d?new Ao(this,{kind:"constant",value:d(i.value.value,a.value.value,u)},i.parameters):i}evaluate(i,a,u,d,m,_){return"constant"===i.kind?i.value:i.evaluate(a,u,d,m,_)}}class Ba{constructor(i){this.specification=i}possiblyEvaluate(i,a,u,d){return!!i.expression.evaluate(a,null,{},u,d)}interpolate(){return!1}}class Pi{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new tr(0,{});for(const u in i){const d=i[u];d.specification.overridable&&this.overridableProperties.push(u);const m=this.defaultPropertyValues[u]=new vs(d,void 0),_=this.defaultTransitionablePropertyValues[u]=new Es(d);this.defaultTransitioningPropertyValues[u]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate(a)}}}Pe(fn,"DataDrivenProperty"),Pe(Pt,"DataConstantProperty"),Pe(Ba,"ColorRampProperty");var Qe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Mh(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function eu(o){if(Array.isArray(o))return o.map(eu);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const a in o)i[a]=eu(o[a]);return i}return Mh(o)}function Ah(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!Ah(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function tu(o,i="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ah(o)||(o=Vd(o));const a=o;let u=!0;try{u=function(S){if(!Ud(S))return S;let A=eu(S);return v1(A),A=Um(A),A}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const d=Qe[`filter_${i}`],m=de(u,d);let _=null;if("error"===m.result)throw new Error(m.value.map(S=>`${S.key}: ${S.message}`).join(", "));_=(S,A,k)=>m.value.evaluate(S,A,{},k);let b=null,T=null;if(u!==a){const S=de(a,d);if("error"===S.result)throw new Error(S.value.map(A=>`${A.key}: ${A.message}`).join(", "));b=(A,k,R,L,U)=>S.value.evaluate(A,k,{},R,void 0,void 0,L,U),T=!Rm(S.value.expression)}return{filter:_,dynamicFilter:b||void 0,needGeometry:p0(u),needFeature:!!T}}function Um(o){if(!Array.isArray(o))return o;const i=function(a){if(nx.has(a[0]))for(let u=1;u<a.length;u++)if(Ud(a[u]))return!0;return a}(o);return!0===i?i:i.map(a=>Um(a))}function v1(o){let i=!1;const a=[];if("case"===o[0]){for(let u=1;u<o.length-1;u+=2)i=i||Ud(o[u]),a.push(o[u+1]);a.push(o[o.length-1])}else if("match"===o[0]){i=i||Ud(o[1]);for(let u=2;u<o.length-1;u+=2)a.push(o[u+1]);a.push(o[o.length-1])}else if("step"===o[0]){i=i||Ud(o[1]);for(let u=1;u<o.length-1;u+=2)a.push(o[u+1])}i&&(o.length=0,o.push("any",...a));for(let u=1;u<o.length;u++)v1(o[u])}function Ud(o){if(!Array.isArray(o))return!1;if("pitch"===(i=o[0])||"distance-from-center"===i)return!0;var i;for(let a=1;a<o.length;a++)if(Ud(o[a]))return!0;return!1}const nx=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function lp(o,i){return o<i?-1:o>i?1:0}function p0(o){if(!Array.isArray(o))return!1;if("within"===o[0]||"distance"===o[0])return!0;for(let i=1;i<o.length;i++)if(p0(o[i]))return!0;return!1}function Vd(o){if(!o)return!0;const i=o[0];return o.length<=1?"any"!==i:"=="===i?to(o[1],o[2],"=="):"!="===i?rx(to(o[1],o[2],"==")):"<"===i||">"===i||"<="===i||">="===i?to(o[1],o[2],i):"any"===i?(a=o.slice(1),["any"].concat(a.map(Vd))):"all"===i?["all"].concat(o.slice(1).map(Vd)):"none"===i?["all"].concat(o.slice(1).map(Vd).map(rx)):"in"===i?cT(o[1],o.slice(2)):"!in"===i?rx(cT(o[1],o.slice(2))):"has"===i?SS(o[1]):"!has"!==i||rx(SS(o[1]));var a}function to(o,i,a){switch(o){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,o,i]}}function cT(o,i){if(0===i.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",o,["literal",i.sort(lp)]]:["filter-in-small",o,["literal",i]]}}function SS(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function rx(o){return["!",o]}function uT(o,i){return i?`${o}\x1f${i}`:o}const DS="-transition",hT=new Set(["fill","line","background","hillshade","raster"]);class Fl extends Uf{constructor(i,a,u,d,m){if(super(),this.id=i.id,this.fqid=uT(this.id,u),this.type=i.type,this.scope=u,this.lut=d,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&"slot"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),i.slot&&(this.slot=i.slot),a.layout&&(this._unevaluatedLayout=new da(a.layout,this.scope,m),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint)){this._transitionablePaint=new Zo(a.paint,this.scope,m);for(const _ in i.paint)this.setPaintProperty(_,i.paint[_]);for(const _ in i.layout)this.setLayoutProperty(_,i.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yo(a.paint)}}onAdd(i){}onRemove(i){}isDraped(i){return hT.has(this.type)}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a){if("custom"===this.type&&"visibility"===i)return void(this.visibility=a);const u=this._unevaluatedLayout;u._properties.properties[i]&&(u.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),"visibility"===i&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(i){return mm(i,DS)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a){const u=this._transitionablePaint,d=u._properties.properties;if(mm(i,DS)){const k=i.slice(0,-11);return d[k]&&u.setTransition(k,a||void 0),!1}if(!d[i])return!1;const m=u._values[i],_=m.value.isDataDriven(),b=m.value;u.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const T=u._values[i].value,S=T.isDataDriven(),A=mm(i,"pattern")||"line-dasharray"===i;return S||_||A||this._handleOverridablePaintPropertyUpdate(i,b,T)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,a,u){return null}_handleOverridablePaintPropertyUpdate(i,a,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){return _o({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,a)=>!(void 0===i||"layout"===a&&!Object.keys(i).length||"paint"===a&&!Object.keys(i).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof Ao&&M(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=tu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&("shadow"===i.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,a,u,d,m,_,b,T,S){}queryIntersectsMatchingFeature(i,a,u,d){}}const Ih={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m0{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&(i.isTransferred=!0,a.add(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Hn(o,i=1){let a=0,u=0;return{members:o.map(d=>{const m=Ih[d.type].BYTES_PER_ELEMENT,_=a=ix(a,Math.max(i,m)),b=d.components||1;return u=Math.max(u,m),a+=m*b,{name:d.name,type:d.type,components:b,offset:_}}),size:ix(a,Math.max(u,i)),alignment:i}}function ix(o,i){return Math.ceil(o/i)*i}class Ll extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const d=2*i;return this.int16[d+0]=a,this.int16[d+1]=u,i}}Ll.prototype.bytesPerElement=4,Pe(Ll,"StructArrayLayout2i4");class fa extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,u)}emplace(i,a,u,d){const m=3*i;return this.int16[m+0]=a,this.int16[m+1]=u,this.int16[m+2]=d,i}}fa.prototype.bytesPerElement=6,Pe(fa,"StructArrayLayout3i6");class jd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,u,d)}emplace(i,a,u,d,m){const _=4*i;return this.int16[_+0]=a,this.int16[_+1]=u,this.int16[_+2]=d,this.int16[_+3]=m,i}}jd.prototype.bytesPerElement=8,Pe(jd,"StructArrayLayout4i8");class Vm extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,u,d,m)}emplace(i,a,u,d,m,_){const b=5*i;return this.int16[b+0]=a,this.int16[b+1]=u,this.int16[b+2]=d,this.int16[b+3]=m,this.int16[b+4]=_,i}}Vm.prototype.bytesPerElement=10,Pe(Vm,"StructArrayLayout5i10");class $d extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,d,m,_,b)}emplace(i,a,u,d,m,_,b,T){const S=6*i,A=12*i,k=3*i;return this.int16[S+0]=a,this.int16[S+1]=u,this.uint8[A+4]=d,this.uint8[A+5]=m,this.uint8[A+6]=_,this.uint8[A+7]=b,this.float32[k+2]=T,i}}$d.prototype.bytesPerElement=12,Pe($d,"StructArrayLayout2i4ub1f12");class Io extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,u,d)}emplace(i,a,u,d,m){const _=4*i;return this.float32[_+0]=a,this.float32[_+1]=u,this.float32[_+2]=d,this.float32[_+3]=m,i}}Io.prototype.bytesPerElement=16,Pe(Io,"StructArrayLayout4f16");class cp extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,u)}emplace(i,a,u,d){const m=3*i;return this.float32[m+0]=a,this.float32[m+1]=u,this.float32[m+2]=d,i}}cp.prototype.bytesPerElement=12,Pe(cp,"StructArrayLayout3f12");class kh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,u,d,m)}emplace(i,a,u,d,m,_){const b=6*i,T=3*i;return this.uint16[b+0]=a,this.uint16[b+1]=u,this.uint16[b+2]=d,this.uint16[b+3]=m,this.float32[T+2]=_,i}}kh.prototype.bytesPerElement=12,Pe(kh,"StructArrayLayout4ui1f12");class sx extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,u,d)}emplace(i,a,u,d,m){const _=4*i;return this.uint16[_+0]=a,this.uint16[_+1]=u,this.uint16[_+2]=d,this.uint16[_+3]=m,i}}sx.prototype.bytesPerElement=8,Pe(sx,"StructArrayLayout4ui8");class Bl extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,d,m,_)}emplace(i,a,u,d,m,_,b){const T=6*i;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=d,this.int16[T+3]=m,this.int16[T+4]=_,this.int16[T+5]=b,i}}Bl.prototype.bytesPerElement=12,Pe(Bl,"StructArrayLayout6i12");class ox extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b,T,S,A,k,R){const L=this.length;return this.resize(L+1),this.emplace(L,i,a,u,d,m,_,b,T,S,A,k,R)}emplace(i,a,u,d,m,_,b,T,S,A,k,R,L){const U=12*i;return this.int16[U+0]=a,this.int16[U+1]=u,this.int16[U+2]=d,this.int16[U+3]=m,this.uint16[U+4]=_,this.uint16[U+5]=b,this.uint16[U+6]=T,this.uint16[U+7]=S,this.int16[U+8]=A,this.int16[U+9]=k,this.int16[U+10]=R,this.int16[U+11]=L,i}}ox.prototype.bytesPerElement=24,Pe(ox,"StructArrayLayout4i4ui4i24");class ax extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,d,m,_)}emplace(i,a,u,d,m,_,b){const T=10*i,S=5*i;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=d,this.float32[S+2]=m,this.float32[S+3]=_,this.float32[S+4]=b,i}}ax.prototype.bytesPerElement=20,Pe(ax,"StructArrayLayout3i3f20");class lx extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}lx.prototype.bytesPerElement=4,Pe(lx,"StructArrayLayout1ul4");class nu extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const d=2*i;return this.uint16[d+0]=a,this.uint16[d+1]=u,i}}nu.prototype.bytesPerElement=4,Pe(nu,"StructArrayLayout2ui4");class b1 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b,T,S,A,k,R,L){const U=this.length;return this.resize(U+1),this.emplace(U,i,a,u,d,m,_,b,T,S,A,k,R,L)}emplace(i,a,u,d,m,_,b,T,S,A,k,R,L,U){const H=20*i,G=10*i;return this.int16[H+0]=a,this.int16[H+1]=u,this.int16[H+2]=d,this.int16[H+3]=m,this.int16[H+4]=_,this.float32[G+3]=b,this.float32[G+4]=T,this.float32[G+5]=S,this.float32[G+6]=A,this.int16[H+14]=k,this.uint32[G+8]=R,this.uint16[H+18]=L,this.uint16[H+19]=U,i}}b1.prototype.bytesPerElement=40,Pe(b1,"StructArrayLayout5i4f1i1ul2ui40");class jm extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,d,m,_,b)}emplace(i,a,u,d,m,_,b,T){const S=8*i;return this.int16[S+0]=a,this.int16[S+1]=u,this.int16[S+2]=d,this.int16[S+4]=m,this.int16[S+5]=_,this.int16[S+6]=b,this.int16[S+7]=T,i}}jm.prototype.bytesPerElement=16,Pe(jm,"StructArrayLayout3i2i2i16");class g0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,u,d,m)}emplace(i,a,u,d,m,_){const b=4*i,T=8*i;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=d,this.int16[T+6]=m,this.int16[T+7]=_,i}}g0.prototype.bytesPerElement=16,Pe(g0,"StructArrayLayout2f1f2i16");class w1 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,u,d)}emplace(i,a,u,d,m){const _=12*i,b=3*i;return this.uint8[_+0]=a,this.uint8[_+1]=u,this.float32[b+1]=d,this.float32[b+2]=m,i}}w1.prototype.bytesPerElement=12,Pe(w1,"StructArrayLayout2ub2f12");class cs extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,u)}emplace(i,a,u,d){const m=3*i;return this.uint16[m+0]=a,this.uint16[m+1]=u,this.uint16[m+2]=d,i}}cs.prototype.bytesPerElement=6,Pe(cs,"StructArrayLayout3ui6");class Rr extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G,Y,ue,ae,he,ve){const we=this.length;return this.resize(we+1),this.emplace(we,i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G,Y,ue,ae,he,ve)}emplace(i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G,Y,ue,ae,he,ve,we){const Se=30*i,Fe=15*i,Ge=60*i;return this.int16[Se+0]=a,this.int16[Se+1]=u,this.int16[Se+2]=d,this.float32[Fe+2]=m,this.float32[Fe+3]=_,this.uint16[Se+8]=b,this.uint16[Se+9]=T,this.uint32[Fe+5]=S,this.uint32[Fe+6]=A,this.uint32[Fe+7]=k,this.uint16[Se+16]=R,this.uint16[Se+17]=L,this.uint16[Se+18]=U,this.float32[Fe+10]=H,this.float32[Fe+11]=G,this.uint8[Ge+48]=Y,this.uint8[Ge+49]=ue,this.uint8[Ge+50]=ae,this.uint32[Fe+13]=he,this.int16[Se+28]=ve,this.uint8[Ge+58]=we,i}}Rr.prototype.bytesPerElement=60,Pe(Rr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _0 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G,Y,ue,ae,he,ve,we,Se,Fe,Ge,tt,Ye,ht,Dt,dt,Nt,ut){const vt=this.length;return this.resize(vt+1),this.emplace(vt,i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G,Y,ue,ae,he,ve,we,Se,Fe,Ge,tt,Ye,ht,Dt,dt,Nt,ut)}emplace(i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G,Y,ue,ae,he,ve,we,Se,Fe,Ge,tt,Ye,ht,Dt,dt,Nt,ut,vt){const zt=20*i,ct=40*i,qt=80*i;return this.float32[zt+0]=a,this.float32[zt+1]=u,this.int16[ct+4]=d,this.int16[ct+5]=m,this.int16[ct+6]=_,this.int16[ct+7]=b,this.int16[ct+8]=T,this.int16[ct+9]=S,this.int16[ct+10]=A,this.int16[ct+11]=k,this.int16[ct+12]=R,this.uint16[ct+13]=L,this.uint16[ct+14]=U,this.uint16[ct+15]=H,this.uint16[ct+16]=G,this.uint16[ct+17]=Y,this.uint16[ct+18]=ue,this.uint16[ct+19]=ae,this.uint16[ct+20]=he,this.uint16[ct+21]=ve,this.uint16[ct+22]=we,this.uint16[ct+23]=Se,this.uint16[ct+24]=Fe,this.uint16[ct+25]=Ge,this.uint16[ct+26]=tt,this.uint16[ct+27]=Ye,this.uint32[zt+14]=ht,this.float32[zt+15]=Dt,this.float32[zt+16]=dt,this.float32[zt+17]=Nt,this.float32[zt+18]=ut,this.uint8[qt+76]=vt,i}}_0.prototype.bytesPerElement=80,Pe(_0,"StructArrayLayout2f9i15ui1ul4f1ub80");class up extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}up.prototype.bytesPerElement=4,Pe(up,"StructArrayLayout1f4");class hp extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,u,d,m)}emplace(i,a,u,d,m,_){const b=5*i;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=d,this.float32[b+3]=m,this.float32[b+4]=_,i}}hp.prototype.bytesPerElement=20,Pe(hp,"StructArrayLayout5f20");class MS extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,d,m,_,b)}emplace(i,a,u,d,m,_,b,T){const S=7*i;return this.float32[S+0]=a,this.float32[S+1]=u,this.float32[S+2]=d,this.float32[S+3]=m,this.float32[S+4]=_,this.float32[S+5]=b,this.float32[S+6]=T,i}}MS.prototype.bytesPerElement=28,Pe(MS,"StructArrayLayout7f28");class dT extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,u,d)}emplace(i,a,u,d,m){const _=6*i;return this.uint32[3*i+0]=a,this.uint16[_+2]=u,this.uint16[_+3]=d,this.uint16[_+4]=m,i}}dT.prototype.bytesPerElement=12,Pe(dT,"StructArrayLayout1ul3ui12");class T1 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}T1.prototype.bytesPerElement=2,Pe(T1,"StructArrayLayout1ui2");class E1 extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const d=2*i;return this.float32[d+0]=a,this.float32[d+1]=u,i}}E1.prototype.bytesPerElement=8,Pe(E1,"StructArrayLayout2f8");class cx extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G){const Y=this.length;return this.resize(Y+1),this.emplace(Y,i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G)}emplace(i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G,Y){const ue=16*i;return this.float32[ue+0]=a,this.float32[ue+1]=u,this.float32[ue+2]=d,this.float32[ue+3]=m,this.float32[ue+4]=_,this.float32[ue+5]=b,this.float32[ue+6]=T,this.float32[ue+7]=S,this.float32[ue+8]=A,this.float32[ue+9]=k,this.float32[ue+10]=R,this.float32[ue+11]=L,this.float32[ue+12]=U,this.float32[ue+13]=H,this.float32[ue+14]=G,this.float32[ue+15]=Y,i}}cx.prototype.bytesPerElement=64,Pe(cx,"StructArrayLayout16f64");class Oh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,d,m,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,d,m,_,b)}emplace(i,a,u,d,m,_,b,T){const S=10*i,A=5*i;return this.uint16[S+0]=a,this.uint16[S+1]=u,this.uint16[S+2]=d,this.uint16[S+3]=m,this.float32[A+2]=_,this.float32[A+3]=b,this.float32[A+4]=T,i}}Oh.prototype.bytesPerElement=20,Pe(Oh,"StructArrayLayout4ui3f20");class fT extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.int16[1*i+0]=a,i}}fT.prototype.bytesPerElement=2,Pe(fT,"StructArrayLayout1i2");class pT extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint8[1*i+0]=a,i}}pT.prototype.bytesPerElement=1,Pe(pT,"StructArrayLayout1ub1");class AS extends m0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}AS.prototype.size=40;class mT extends b1{get(i){return new AS(this,i)}}Pe(mT,"CollisionBoxArray");class IS extends m0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}IS.prototype.size=60;class jt extends Rr{get(i){return new IS(this,i)}}Pe(jt,"PlacedSymbolArray");class hi extends m0{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}hi.prototype.size=80;class Mn extends _0{get(i){return new hi(this,i)}}Pe(Mn,"SymbolInstanceArray");class An extends up{getoffsetX(i){return this.float32[1*i+0]}}Pe(An,"GlyphOffsetArray");class rs extends Ll{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Pe(rs,"SymbolLineVertexArray");class gT extends m0{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gT.prototype.size=12;class y0 extends dT{get(i){return new gT(this,i)}}Pe(y0,"FeatureIndexArray");class ru extends nu{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Pe(ru,"FillExtrusionCentroidArray");class ux extends m0{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}ux.prototype.size=8;class hx extends jd{get(i){return new ux(this,i)}}Pe(hx,"FillExtrusionWallArray");const kS=Hn([{name:"a_pos",components:2,type:"Int16"}],4),rL=Hn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class us{constructor(i=[]){this.segments=i}_prepareSegment(i,a,u,d){let m=this.segments[this.segments.length-1];return i>us.MAX_VERTEX_ARRAY_LENGTH&&ks(`Max vertices per segment is ${us.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!m||m.vertexLength+i>us.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:a,primitiveOffset:u,vertexLength:0,primitiveLength:0},void 0!==d&&(m.sortKey=d),this.segments.push(m)),m}prepareSegment(i,a,u,d){return this._prepareSegment(i,a.length,u.length,d)}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,u,d){return new us([{vertexOffset:i,primitiveOffset:a,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function _T(o,i){return 256*(o=vr(Math.floor(o),0,255))+vr(Math.floor(i),0,255)}us.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pe(us,"SegmentVector");const OS=Hn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),RS=Hn([{name:"a_dash",components:4,type:"Uint16"}]);class Ko{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,a,u,d){this.ids.push(Rh(i)),this.positions.push(a,u,d)}eachPosition(i,a){const u=Rh(i);let d=0,m=this.ids.length-1;for(;d<m;){const _=d+m>>1;this.ids[_]>=u?m=_:d=_+1}for(;this.ids[d]===u;)a(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(i,a){const u=new Float64Array(i.ids),d=new Uint32Array(i.positions);return dx(u,d,0,u.length-1),a&&(a.add(u.buffer),a.add(d.buffer)),{ids:u,positions:d}}static deserialize(i){const a=new Ko;let u;a.ids=i.ids,a.positions=i.positions;for(const d of a.ids)d!==u&&a.uniqueIds.push(d),u=d;return a.indexed=!0,a}}function Rh(o){const i=+o;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:i1(String(o))}function dx(o,i,a,u){for(;a<u;){const d=o[a+u>>1];let m=a-1,_=u+1;for(;;){do{m++}while(o[m]<d);do{_--}while(o[_]>d);if(m>=_)break;sc(o,m,_),sc(i,3*m,3*_),sc(i,3*m+1,3*_+1),sc(i,3*m+2,3*_+2)}_-a<u-_?(dx(o,i,a,_),a=_+1):(dx(o,i,_+1,u),u=_)}}function sc(o,i,a){const u=o[i];o[i]=o[a],o[a]=u}Pe(Ko,"FeaturePositionMap");class za{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}set(i,a,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class fx extends za{constructor(i){super(i),this.current=0}set(i,a,u){this.fetchUniformLocation(i,a)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Ua extends za{constructor(i){super(i),this.current=0}set(i,a,u){this.fetchUniformLocation(i,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Hd extends za{constructor(i){super(i),this.current=[0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class yT extends za{constructor(i){super(i),this.current=[0,0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class C1 extends za{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class px extends za{constructor(i){super(i),this.current=Jr.transparent.toRenderColor(null)}set(i,a,u){this.fetchUniformLocation(i,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const vT=new Float32Array(16);class dp extends za{constructor(i){super(i),this.current=vT}set(i,a,u){if(this.fetchUniformLocation(i,a)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Jk=new Float32Array(9),PS=new Float32Array(4);class S1 extends za{constructor(i){super(i),this.current=PS}set(i,a,u){if(this.fetchUniformLocation(i,a))for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}function mx(o){return[_T(255*o.r,255*o.g),_T(255*o.b,255*o.a)]}class v0{constructor(i,a,u,d){this.value=i,this.uniformNames=a.map(m=>`u_${m}`),this.type=u,this.context=d}setUniform(i,a,u,d,m){const _=d.constantOr(this.value);a.set(i,m,_ instanceof Jr?_.toRenderColor(this.context.lut):_)}getBinding(i,a){return"color"===this.type?new px(i):new Ua(i)}}class $m{constructor(i,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,a,u,d,m){const _="u_pattern"===m||"u_dash"===m?this.pattern:"u_pixel_ratio"===m?this.pixelRatio:null;_&&a.set(i,m,_)}getBinding(i,a){return"u_pattern"===a||"u_dash"===a?new C1(i):new Ua(i)}}class Ph{constructor(i,a,u,d){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(i,a,u,d,m,_,b){const T=this.paintVertexArray.length,S=this.expression.evaluate(new tr(0,{brightness:_}),a,{},m,d,b);this.paintVertexArray.resize(i),this._setPaintValue(T,i,S,this.context)}updatePaintArray(i,a,u,d,m,_,b){const T=this.expression.evaluate({zoom:0,brightness:b},u,d,void 0,m);this._setPaintValue(i,a,T,this.context)}_setPaintValue(i,a,u,d){if("color"===this.type){const m=mx(u.toRenderColor(d.lut));for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=i;m<a;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kc{constructor(i,a,u,d,m,_){this.expression=i,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=d,this.context=m,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(i,a,u,d,m,_,b){const T=this.expression.evaluate(new tr(this.context.zoom,{brightness:_}),a,{},m,d,b),S=this.expression.evaluate(new tr(this.context.zoom+1,{brightness:_}),a,{},m,d,b),A=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(A,i,T,S,this.context)}updatePaintArray(i,a,u,d,m,_,b){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:b},u,d,void 0,m),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},u,d,void 0,m);this._setPaintValue(i,a,T,S,this.context)}_setPaintValue(i,a,u,d,m){if("color"===this.type){const _=mx(u.toRenderColor(m.lut)),b=mx(u.toRenderColor(m.lut));for(let T=i;T<a;T++)this.paintVertexArray.emplace(T,_[0],_[1],b[0],b[1])}else{for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,u,d,m){const _=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=vr(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);a.set(i,m,b)}getBinding(i,a){return new Ua(i)}}class fp{constructor(i,a,u,d,m){this.expression=i,this.layerId=m,this.paintVertexAttributes=("array"===u?RS:OS).members;for(let _=0;_<a.length;++_);this.paintVertexArray=new d}populatePaintArray(i,a,u,d){const m=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(m,i,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(i,a,u,d,m,_,b){this._setPaintValues(i,a,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(i,a,u,d){if(!d||!u)return;const m=d[u];if(!m)return;const{tl:_,br:b,pixelRatio:T}=m;for(let S=i;S<a;S++)this.paintVertexArray.emplace(S,_[0],_[1],b[0],b[1],T)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class no{constructor(i,a,u=(()=>!0)){this.binders={},this._buffers=[],this.context=a;const d=[];for(const m in i.paint._values){const _=i.paint.get(m);if(!u(m)||!(_ instanceof Ao&&M(_.property.specification)))continue;const b=Qk(m,i.type),T=_.value,S=_.property.specification.type,A=!!_.property.useIntegerZoom,k="line-dasharray"===m||m.endsWith("pattern"),R="line-dasharray"===m&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==T.kind||R)if("source"===T.kind||R||k){const L=NS(m,S,"source");this.binders[m]=k?new fp(T,b,S,L,i.id):new Ph(T,b,S,L),d.push(`/a_${m}`)}else{const L=NS(m,S,"composite");this.binders[m]=new kc(T,b,S,A,a,L),d.push(`/z_${m}`)}else this.binders[m]=k?new $m(T.value,b):new v0(T.value,b,S,a),d.push(`/u_${m}`)}this.cacheKey=d.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof Ph||a instanceof kc?a.maxValue:0}populatePaintArrays(i,a,u,d,m,_,b){for(const T in this.binders){const S=this.binders[T];S.context=this.context,(S instanceof Ph||S instanceof kc||S instanceof fp)&&S.populatePaintArray(i,a,u,d,m,_,b)}}setConstantPatternPositions(i){for(const a in this.binders){const u=this.binders[a];u instanceof $m&&u.setConstantPatternPositions(i)}}updatePaintArrays(i,a,u,d,m,_,b,T){let S=!1;const A=Object.keys(i),k=0!==A.length,R=k?A:a.uniqueIds;this.context.lut=m.lut;for(const L in this.binders){const U=this.binders[L];if(U.context=this.context,(U instanceof Ph||U instanceof kc||U instanceof fp)&&(!0===U.expression.isStateDependent||!1===U.expression.isLightConstant)){const H=m.paint.get(L);U.expression=H.value;for(const G of R){const Y=i[G.toString()];a.eachPosition(G,(ue,ae,he)=>{const ve=d.feature(ue);U.updatePaintArray(ae,he,ve,Y,_,b,T)})}if(!k)for(const G of u.uniqueIds){const Y=i[G.toString()];u.eachPosition(G,(ue,ae,he)=>{const ve=d.feature(ue);U.updatePaintArray(ae,he,ve,Y,_,b,T)})}S=!0}}return S}defines(){const i=[];for(const a in this.binders){const u=this.binders[a];(u instanceof v0||u instanceof $m)&&i.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return i}getBinderAttributes(){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Ph||u instanceof kc||u instanceof fp)for(let d=0;d<u.paintVertexAttributes.length;d++)i.push(u.paintVertexAttributes[d].name)}return i}getBinderUniforms(){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof v0||u instanceof $m||u instanceof kc)for(const d of u.uniformNames)i.push(d)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof v0||d instanceof $m||d instanceof kc)for(const m of d.uniformNames)a.push({name:m,property:u,binding:d.getBinding(i,m)})}return a}setUniforms(i,a,u,d,m){for(const{name:_,property:b,binding:T}of u)this.binders[b].setUniform(i,T,m,d.get(b),_)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Ph||a instanceof kc||a instanceof fp)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(i){for(const a in this.binders){const u=this.binders[a];(u instanceof Ph||u instanceof kc||u instanceof fp)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof Ph||a instanceof kc||a instanceof fp)&&a.destroy()}}}class oc{constructor(i,a,u=(()=>!0)){this.programConfigurations={};for(const d of i)this.programConfigurations[d.id]=new no(d,a,u);this.needsUpload=!1,this._featureMap=new Ko,this._featureMapWithoutIds=new Ko,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,a,u,d,m,_,b,T){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(i,a,d,m,_,b,T);void 0!==a.id?this._featureMap.add(a.id,u,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,u,d,m,_){for(const b of u)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,a,b,d,m,_||0)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const Rs={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Qk(o,i){return Rs[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}const eO={"line-pattern":{source:kh,composite:kh},"fill-pattern":{source:kh,composite:kh},"fill-extrusion-pattern":{source:kh,composite:kh},"line-dasharray":{source:sx,composite:sx}},tO={color:{source:E1,composite:Io},number:{source:up,composite:E1}};function NS(o,i,a){const u=eO[o];return u&&u[a]||tO[i][a]}Pe(v0,"ConstantBinder"),Pe($m,"PatternConstantBinder"),Pe(Ph,"SourceExpressionBinder"),Pe(fp,"PatternCompositeBinder"),Pe(kc,"CompositeExpressionBinder"),Pe(no,"ProgramConfiguration",{omit:["_buffers"]}),Pe(oc,"ProgramConfigurationSet");const Va=Ut/Math.PI/2,gx=5,x0=6,Nh=16383,w0=[64,32,16],zl=-Va,Ul=Va;function pp(o,i,a,u=Va){return a=Dr(a),[o*Math.sin(a)*u,-i*u,o*Math.cos(a)*u]}function mp(o,i,a){return pp(Math.cos(Dr(o)),Math.sin(Dr(o)),i,a)}const Hm=6371008.8,xT=2*Math.PI*Hm;class kr{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kr(hh(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,u=this.lat*a,d=i.lat*a,m=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((i.lng-this.lng)*a);return Hm*Math.acos(Math.min(m,1))}toBounds(i=0){const a=360*i/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new iu({lng:this.lng-u,lat:this.lat-a},{lng:this.lng+u,lat:this.lat+a})}toEcef(i){return mp(this.lat,this.lng,Va+i*Va/Hm)}static convert(i){if(i instanceof kr)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new kr(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new kr(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class iu{constructor(i,a){if(i)if(a)this.setSouthWest(i).setNorthEast(a);else if(4===i.length){const u=i;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=i;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(i){return this._ne=i instanceof kr?new kr(i.lng,i.lat):kr.convert(i),this}setSouthWest(i){return this._sw=i instanceof kr?new kr(i.lng,i.lat):kr.convert(i),this}extend(i){const a=this._sw,u=this._ne;let d,m;if(i instanceof kr)d=i,m=i;else{if(!(i instanceof iu))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(iu.convert(i)):this.extend(kr.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(kr.convert(i)):this;if(d=i._sw,m=i._ne,!d||!m)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new kr(d.lng,d.lat),this._ne=new kr(m.lng,m.lat)),this}getCenter(){return new kr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new kr(this.getWest(),this.getNorth())}getSouthEast(){return new kr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:u}=kr.convert(i);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(i){return!i||i instanceof iu?i:new iu(i)}}var FS={};!function(a){function u(m,_,b){var T=d(256*m,256*(_=Math.pow(2,b)-_-1),b),S=d(256*(m+1),256*(_+1),b);return T[0]+","+T[1]+","+S[0]+","+S[1]}function d(m,_,b){var T=2*Math.PI*6378137/256/Math.pow(2,b);return[m*T-2*Math.PI*6378137/2,_*T-2*Math.PI*6378137/2]}a.getURL=function(m,_,b,T,S,A){return A=A||{},m+"?"+["bbox="+u(b,T,S),"format="+(A.format||"image/png"),"service="+(A.service||"WMS"),"version="+(A.version||"1.1.1"),"request="+(A.request||"GetMap"),"srs="+(A.srs||"EPSG:3857"),"width="+(A.width||256),"height="+(A.height||256),"layers="+_].join("&")},a.getTileBBox=u,a.getMercCoords=d,Object.defineProperty(a,"__esModule",{value:!0})}(FS);var bT=FS;class gp{constructor(i,a,u){this.z=i,this.x=a,this.y=u,this.key=D1(0,i,i,a,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,a){const u=bT.getTileBBox(this.x,this.y,this.z),d=function(m,_,b){let T,S="";for(let A=m;A>0;A--)T=1<<A-1,S+=(_&T?1:0)+(b&T?2:0);return S}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class LS{constructor(i,a){this.wrap=i,this.canonical=a,this.key=D1(i,a.z,a.z,a.x,a.y)}}class ro{constructor(i,a,u,d,m){this.overscaledZ=i,this.wrap=a,this.canonical=new gp(u,+d,+m),this.key=0===a&&i===u?this.canonical.key:D1(a,i,u,d,m)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new ro(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ro(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return D1(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-i;return D1(this.wrap*+a,i,i,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new ro(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new ro(a,this.wrap,a,u,d),new ro(a,this.wrap,a,u+1,d),new ro(a,this.wrap,a,u,d+1),new ro(a,this.wrap,a,u+1,d+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new ro(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new ro(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new LS(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function D1(o,i,a,u,d){const m=1<<Math.min(a,22);let _=m*(d%m)+u%m;return o&&a<22&&(_+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*_+a)+(i-a)}const iL=[o=>{let i=o.canonical.x-1,a=o.wrap;return i<0&&(i=(1<<o.canonical.z)-1,a--),new ro(o.overscaledZ,a,o.canonical.z,i,o.canonical.y)},o=>{let i=o.canonical.x+1,a=o.wrap;return i===1<<o.canonical.z&&(i=0,a++),new ro(o.overscaledZ,a,o.canonical.z,i,o.canonical.y)},o=>new ro(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(0===o.canonical.y?1<<o.canonical.z:o.canonical.y)-1),o=>new ro(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Pe(gp,"CanonicalTileID"),Pe(ro,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const wT=0,Gm=25.5;function M1(o){return xT*Math.cos(o*Math.PI/180)}function ac(o){return(180+o)/360}function Fh(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function ko(o,i){return o/M1(i)}function Vl(o){return 360*o-180}function fo(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function A1(o,i){return o*M1(fo(i))}const Us=85.051129;function TT(o){return Math.cos(Dr(vr(o,-Us,Us)))}function _p(o,i){const a=vr(i,wT,Gm),u=Math.pow(2,a);return TT(o)*xT/(512*u)}function BS(o){return 1/Math.cos(o*Math.PI/180)}function Oc(o,i=0){const a=Math.exp(Math.PI*(1-(o.y+i/Ut)/(1<<o.z)*2));return 80150034*a/(a*a+1)/Ut/(1<<o.z)}class pa{constructor(i,a,u=0){this.x=+i,this.y=+a,this.z=+u}static fromLngLat(i,a=0){const u=kr.convert(i);return new pa(ac(u.lng),Fh(u.lat),ko(a,u.lat))}toLngLat(){return new kr(Vl(this.x),fo(this.y))}toAltitude(){return A1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xT*BS(fo(this.y))}}function T0(o,i,a,u,d,m,_,b,T){const S=(i+u)/2,A=(a+d)/2,k=new $t(S,A);b(k),function(R,L,U,H,G,Y){const ue=U-G,ae=H-Y;return Math.abs((H-L)*ue-(U-R)*ae)/Math.hypot(ue,ae)}(k.x,k.y,m.x,m.y,_.x,_.y)>=T?(T0(o,i,a,S,A,m,k,b,T),T0(o,S,A,u,d,k,_,b,T)):o.push(_)}function _x(o,i,a){let u=o[0],d=u.x,m=u.y;i(u);const _=[u];for(let b=1;b<o.length;b++){const T=o[b],{x:S,y:A}=T;i(T),T0(_,d,m,S,A,u,T,i,a),d=S,m=A,u=T}return _}function yx(o,i,a,u){if(u(i,a)){const d=i.add(a)._mult(.5);yx(o,i,d,u),yx(o,d,a,u)}else o.push(a)}function vx(o,i){let a=o[0];const u=[a];for(let d=1;d<o.length;d++){const m=o[d];yx(u,a,m,i),a=m}return u}const I1=Math.pow(2,14)-1,zS=-I1-1;function US(o,i){const a=Math.round(o.x*i),u=Math.round(o.y*i);return o.x=vr(a,zS,I1),o.y=vr(u,zS,I1),(a<o.x||a>o.x+1||u<o.y||u>o.y+1)&&ks("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function su(o,i,a){const u=o.loadGeometry(),d=o.extent,m=Ut/d;if(i&&a&&a.projection.isReprojectedInTileSpace){const _=1<<i.z,{scale:b,x:T,y:S,projection:A}=a,k=R=>{const L=Vl((i.x+R.x/d)/_),U=fo((i.y+R.y/d)/_),H=A.project(L,U);R.x=(H.x*b-T)*d,R.y=(H.y*b-S)*d};for(let R=0;R<u.length;R++)if(1!==o.type)u[R]=_x(u[R],k,1);else{const L=[];for(const U of u[R])U.x<0||U.x>=d||U.y<0||U.y>=d||(k(U),L.push(U));u[R]=L}}for(const _ of u)for(const b of _)US(b,m);return u}function Lh(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?su(o):[]}}function k1(o,i,a,u,d){o.emplaceBack(2*i+(u+1)/2,2*a+(d+1)/2)}function xx(o,i,a){o.emplaceBack(i.x,i.y,i.z,16384*a[0],16384*a[1],16384*a[2])}class E0{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Ll,this.indexArray=new cs,this.segments=new us,this.programConfigurations=new oc(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}updateFootprints(i,a){}populate(i,a,u,d){const m=this.layers[0],_=[];let b=null;"circle"===m.type&&(b=m.layout.get("circle-sort-key"));for(const{feature:S,id:A,index:k,sourceLayerIndex:R}of i){const L=this.layers[0]._featureFilter.needGeometry,U=Lh(S,L);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),U,u))continue;const H=b?b.evaluate(U,{},u):void 0,G={id:A,properties:S.properties,type:S.type,sourceLayerIndex:R,index:k,geometry:L?U.geometry:su(S,u,d),patterns:{},sortKey:H};_.push(G)}b&&_.sort((S,A)=>S.sortKey-A.sortKey);let T=null;"globe"===d.projection.name&&(this.globeExtVertexArray=new Bl,T=d.projection);for(const S of _){const{geometry:A,index:k,sourceLayerIndex:R}=S,L=i[k].feature;this.addFeature(S,A,k,a.availableImages,u,T,a.brightness),a.featureIndex.insert(L,A,k,R,this.index)}}update(i,a,u,d,m){const _=0!==Object.keys(i).length;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(i,a,_?this.stateDependentLayers:this.layers,u,d,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,kS.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,rL.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,a,u,d,m,_,b){for(const T of a)for(const S of T){const A=S.x,k=S.y;if(A<0||A>=Ut||k<0||k>=Ut)continue;if(_){const U=_.projectTilePoint(A,k,m),H=_.upVector(m,A,k),G=this.globeExtVertexArray;xx(G,U,H),xx(G,U,H),xx(G,U,H),xx(G,U,H)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),L=R.vertexLength;k1(this.layoutVertexArray,A,k,-1,-1),k1(this.layoutVertexArray,A,k,1,-1),k1(this.layoutVertexArray,A,k,1,1),k1(this.layoutVertexArray,A,k,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},d,m,b)}}function Gd(o,i){for(let a=0;a<o.length;a++)if(Bh(i,o[a]))return!0;for(let a=0;a<i.length;a++)if(Bh(o,i[a]))return!0;return!!yp(o,i)}function nO(o,i,a){return!!Bh(o,i)||!!vo(i,o,a)}function ET(o,i){if(1===o.length)return Cs(i,o[0]);for(let a=0;a<i.length;a++){const u=i[a];for(let d=0;d<u.length;d++)if(Bh(o,u[d]))return!0}for(let a=0;a<o.length;a++)if(Cs(i,o[a]))return!0;for(let a=0;a<i.length;a++)if(yp(o,i[a]))return!0;return!1}function VS(o,i,a){if(o.length>1){if(yp(o,i))return!0;for(let u=0;u<i.length;u++)if(vo(i[u],o,a))return!0}for(let u=0;u<o.length;u++)if(vo(o[u],i,a))return!0;return!1}function yp(o,i){if(0===o.length||0===i.length)return!1;for(let a=0;a<o.length-1;a++){const u=o[a],d=o[a+1];for(let m=0;m<i.length-1;m++)if(C0(u,d,i[m],i[m+1]))return!0}return!1}function C0(o,i,a,u){return fh(o,a,u)!==fh(i,a,u)&&fh(o,i,a)!==fh(o,i,u)}function vo(o,i,a){const u=a*a;if(1===i.length)return o.distSqr(i[0])<u;for(let d=1;d<i.length;d++)if(jS(o,i[d-1],i[d])<u)return!0;return!1}function jS(o,i,a){const u=i.distSqr(a);if(0===u)return o.distSqr(i);const d=((o.x-i.x)*(a.x-i.x)+(o.y-i.y)*(a.y-i.y))/u;return o.distSqr(d<0?i:d>1?a:a.sub(i)._mult(d)._add(i))}function Cs(o,i){let a,u,d,m=!1;for(let _=0;_<o.length;_++){a=o[_];for(let b=0,T=a.length-1;b<a.length;T=b++)u=a[b],d=a[T],u.y>i.y!=d.y>i.y&&i.x<(d.x-u.x)*(i.y-u.y)/(d.y-u.y)+u.x&&(m=!m)}return m}function Bh(o,i){let a=!1;for(let u=0,d=o.length-1;u<o.length;d=u++){const m=o[u],_=o[d];m.y>i.y!=_.y>i.y&&i.x<(_.x-m.x)*(i.y-m.y)/(_.y-m.y)+m.x&&(a=!a)}return a}function $S(o,i,a,u,d){for(const _ of o)if(i<=_.x&&a<=_.y&&u>=_.x&&d>=_.y)return!0;const m=[new $t(i,a),new $t(i,d),new $t(u,d),new $t(u,a)];if(o.length>2)for(const _ of m)if(Bh(o,_))return!0;for(let _=0;_<o.length-1;_++)if(HS(o[_],o[_+1],m))return!0;return!1}function HS(o,i,a){const u=a[0],d=a[2];if(o.x<u.x&&i.x<u.x||o.x>d.x&&i.x>d.x||o.y<u.y&&i.y<u.y||o.y>d.y&&i.y>d.y)return!1;const m=fh(o,i,a[0]);return m!==fh(o,i,a[1])||m!==fh(o,i,a[2])||m!==fh(o,i,a[3])}function jl(o,i,a,u,d,m){let _=i.y-o.y,b=o.x-i.x;if(m=m||0){const T=_*_+b*b;if(0===T)return!0;const S=Math.sqrt(T);_/=S,b/=S}return!((a.x-o.x)*_+(a.y-o.y)*b-m<0||(u.x-o.x)*_+(u.y-o.y)*b-m<0||(d.x-o.x)*_+(d.y-o.y)*b-m<0)}function CT(o,i,a,u,d,m,_){return!(jl(o,i,u,d,m,_)||jl(i,a,u,d,m,_)||jl(a,o,u,d,m,_)||jl(u,d,o,i,a,_)||jl(d,m,o,i,a,_)||jl(m,u,o,i,a,_))}function Wm(o,i,a){const u=i.paint.get(o).value;return"constant"===u.kind?u.value:a.programConfigurations.get(i.id).getMaxValue(o)}function S0(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function O1(o,i,a,u,d){if(!i[0]&&!i[1])return o;const m=$t.convert(i)._mult(d);"viewport"===a&&m._rotate(-u);const _=[];for(let b=0;b<o.length;b++)_.push(o[b].sub(m));return _}function ST(o,i,a,u){const d=$t.convert(o)._mult(u);return"viewport"===i&&d._rotate(-a),d}let GS,WS;Pe(E0,"CircleBucket",{omit:["layers"]});class DT{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,u){const d=f.$.dot(a,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/d;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,u[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(i,a,u){if(f.$.equals(this.pos,i)||0===a)return u[0]=u[1]=u[2]=0,!1;const[d,m,_]=this.dir,b=this.pos[0]-i[0],T=this.pos[1]-i[1],S=this.pos[2]-i[2],A=d*d+m*m+_*_,k=2*(b*d+T*m+S*_),R=k*k-4*A*(b*b+T*T+S*S-a*a);if(R<0){const L=Math.max(-k/2,0),U=b+d*L,H=T+m*L,G=S+_*L,Y=Math.hypot(U,H,G);return u[0]=U*a/Y,u[1]=H*a/Y,u[2]=G*a/Y,!1}{const L=(-k-Math.sqrt(R))/(2*A);if(L<0){const U=Math.hypot(b,T,S);return u[0]=b*a/U,u[1]=T*a/U,u[2]=S*a/U,!1}return u[0]=b+d*L,u[1]=T+m*L,u[2]=S+_*L,!0}}}class bx{constructor(i,a,u,d,m){this.TL=i,this.TR=a,this.BR=u,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(i,a,u){const d=[-1,1,1],m=[1,1,1],_=[1,-1,1],b=[-1,-1,1],T=f.$.transformMat4(d,d,i),S=f.$.transformMat4(m,m,i),A=f.$.transformMat4(_,_,i),k=f.$.transformMat4(b,b,i);return new bx(T,S,A,k,a/u)}}function R1(o,i,a){let u=1/0,d=-1/0;const m=[];for(const _ of o){f.$.sub(m,_,i);const b=f.$.dot(m,a);u=Math.min(u,b),d=Math.max(d,b)}return[u,d]}function MT(o,i){let a=!0;for(let u=0;u<o.planes.length;u++){const d=o.planes[u];let m=0;for(let _=0;_<i.length;_++)m+=f.$.dot(d,i[_])+d[3]>=0;if(0===m)return 0;m!==i.length&&(a=!1)}return a?2:1}function qS(o,i){for(const a of o.projections){const u=R1(i,o.points[0],a.axis);if(a.projection[1]<u[0]||a.projection[0]>u[1])return 0}return 1}function ZS(o,i){let a=0;const u=[0,0,0,0];for(let d=0;d<o.length;d++)u[0]=o[d][0],u[1]=o[d][1],u[2]=o[d][2],u[3]=1,f.aB.dot(u,i)>=0&&a++;return a}class XS{constructor(i,a){this.points=i||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Yi.fromPoints(this.points),this.projections=[],this.frustumEdges=[f.$.sub([],this.points[2],this.points[3]),f.$.sub([],this.points[0],this.points[3]),f.$.sub([],this.points[4],this.points[0]),f.$.sub([],this.points[5],this.points[1]),f.$.sub([],this.points[6],this.points[2]),f.$.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const d=[0,-u[2],u[1]],m=[u[2],0,-u[0]];this.projections.push({axis:d,projection:R1(this.points,this.points[0],d)}),this.projections.push({axis:m,projection:R1(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(i,a,u,d){const m=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=f.aB.transformMat4([],S,i),k=1/A[3]/a*m;return f.aB.mul(A,A,[k,k,d?1/A[3]:k,k])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=f.$.sub([],_[S[0]],_[S[1]]),k=f.$.sub([],_[S[2]],_[S[1]]),R=f.$.normalize([],f.$.cross([],A,k)),L=-f.$.dot(R,_[S[1]]);return R.concat(L)}),T=[];for(let S=0;S<_.length;S++)T.push([_[S][0],_[S][1],_[S][2]]);return new XS(T,b)}intersectsPrecise(i,a,u){for(let d=0;d<a.length;d++)if(!ZS(i,a[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!ZS(i,this.planes[d]))return 0;for(const d of u)for(const m of this.frustumEdges){const _=f.$.cross([],d,m),b=f.$.length(_);if(0===b)continue;f.$.scale(_,_,1/b);const T=R1(this.points,this.points[0],_),S=R1(i,this.points[0],_);if(T[0]>S[1]||S[0]>T[1])return 0}return 1}containsPoint(i){for(const a of this.planes){const u=a[3];if(f.$.dot([a[0],a[1],a[2]],i)+u<0)return!1}return!0}}class Yi{static fromPoints(i){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of i)f.$.min(a,a,d),f.$.max(u,u,d);return new Yi(a,u)}static fromTileIdAndHeight(i,a,u){const d=1<<i.canonical.z,m=i.canonical.x,_=i.canonical.y;return new Yi([m/d,_/d,a],[(m+1)/d,(_+1)/d,u])}static applyTransform(i,a){const u=i.getCorners();for(let d=0;d<u.length;++d)f.$.transformMat4(u[d],u[d],a);return Yi.fromPoints(u)}static applyTransformFast(i,a){const u=[a[12],a[13],a[14]],d=[...u];for(let m=0;m<3;m++)for(let _=0;_<3;_++){const b=a[4*_+m],T=b*i.min[_],S=b*i.max[_];u[m]+=Math.min(T,S),d[m]+=Math.max(T,S)}return new Yi(u,d)}static projectAabbCorners(i,a){const u=i.getCorners();for(let d=0;d<u.length;++d)f.$.transformMat4(u[d],u[d],a);return u}constructor(i,a){this.min=i,this.max=a,this.center=f.$.scale([],f.$.add([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],u=f.$.clone(this.min),d=f.$.clone(this.max);for(let m=0;m<a.length;m++)u[m]=a[m]?this.min[m]:this.center[m],d[m]=a[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Yi(u,d)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?MT(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?MT(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,a){return a||this.intersects(i)?qS(i,this.getCorners()):0}intersectsPreciseFlat(i,a){return a||this.intersectsFlat(i)?qS(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let a=0;a<3;++a)if(this.min[a]>i.max[a]||i.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i.min[a]),this.max[a]=Math.max(this.max[a],i.max[a])}encapsulatePoint(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i[a]),this.max[a]=Math.max(this.max[a],i[a])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Pe(Yi,"Aabb");const YS=Hn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:xs}=YS,rO=Hn([{name:"a_pos_3",components:3,type:"Int16"}]);var P1=Hn([{name:"a_pos",type:"Int16",components:2}]);function AT(o){return o*Va/Hm}const KS=[new Yi([zl,zl,zl],[Ul,Ul,Ul]),new Yi([zl,zl,zl],[0,0,Ul]),new Yi([0,zl,zl],[Ul,0,Ul]),new Yi([zl,0,zl],[0,Ul,Ul]),new Yi([0,0,zl],[Ul,Ul,Ul])];function iO(o,i,a,u=!0){const d=f.$.scale([],o._camera.position,o.worldSize),m=[i,a,1,1];f.aB.transformMat4(m,m,o.pixelMatrixInverse),f.aB.scale(m,m,1/m[3]);const _=f.$.sub([],m,d),b=f.$.normalize([],_),T=o.globeMatrix,S=[T[12],T[13],T[14]],A=f.$.sub([],S,d),k=f.$.length(A),R=f.$.normalize([],A),L=o.worldSize/(2*Math.PI),U=f.$.dot(R,b),H=Math.asin(L/k);if(H<Math.acos(U)){if(!u)return null;const Ye=[],ht=[];f.$.scale(Ye,b,k/U),f.$.normalize(ht,f.$.sub(ht,Ye,A)),f.$.normalize(b,f.$.add(b,A,f.$.scale(b,ht,Math.tan(H)*k)))}const G=[];new DT(d,b).closestPointOnSphere(S,L,G);const Y=f.$.normalize([],gh(T,0)),ue=f.$.normalize([],gh(T,1)),ae=f.$.normalize([],gh(T,2)),he=f.$.dot(Y,G),ve=f.$.dot(ue,G),we=f.$.dot(ae,G),Se=oa(Math.asin(-ve/L));let Fe=oa(Math.atan2(he,we));Fe=o.center.lng+function(Ye,ht){const Dt=(ht-Ye+180)%360-180;return Dt<-180?Dt+360:Dt}(o.center.lng,Fe);const Ge=ac(Fe),tt=vr(Fh(Se),0,1);return new pa(Ge,tt)}class IT{constructor(i,a,u){this.a=f.$.sub([],i,u),this.b=f.$.sub([],a,u),this.center=u;const d=f.$.normalize([],this.a),m=f.$.normalize([],this.b);this.angle=Math.acos(f.$.dot(d,m))}}function lc(o,i){if(0===o.angle)return null;let a;return a=0===o.a[i]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[i]/o.a[i]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(u,d,m,_){const b=Math.sin(m);return u*(Math.sin((1-_)*m)/b)+d*(Math.sin(_*m)/b)}(o.a[i],o.b[i],o.angle,vr(a,0,1))+o.center[i]}function Nu(o){if(o.z<=1)return KS[o.z+2*o.y+o.x];const i=eD(OT(o));return Yi.fromPoints(i)}function ja(o,i,a){return f.$.scale(o,o,1-a),f.$.scaleAndAdd(o,o,i,a)}function JS(o,i){const a=xp(i.zoom);if(0===a)return Nu(o);const u=OT(o),d=eD(u),m=ac(u.getWest())*i.worldSize,_=ac(u.getEast())*i.worldSize,b=Fh(u.getNorth())*i.worldSize,T=Fh(u.getSouth())*i.worldSize,S=[m,b,0],A=[_,b,0],k=[m,T,0],R=[_,T,0],L=f.ae.invert([],i.globeMatrix);return f.$.transformMat4(S,S,L),f.$.transformMat4(A,A,L),f.$.transformMat4(k,k,L),f.$.transformMat4(R,R,L),d[0]=ja(d[0],k,a),d[1]=ja(d[1],R,a),d[2]=ja(d[2],A,a),d[3]=ja(d[3],S,a),Yi.fromPoints(d)}function QS(o,i,a){for(const u of o)f.$.transformMat4(u,u,i),f.$.scale(u,u,a)}function kT(o,i,a,u){const d=i/o.worldSize,m=o.globeMatrix;if(a.z<=1){const Ge=Nu(a).getCorners();return QS(Ge,m,d),Yi.fromPoints(Ge)}const _=OT(a,u),b=eD(_,Va+AT(o._tileCoverLift));QS(b,m,d);const T=Number.MAX_VALUE,S=[-T,-T,-T],A=[T,T,T];if(_.contains(o.center)){for(const Ye of b)f.$.min(A,A,Ye),f.$.max(S,S,Ye);S[2]=0;const Ge=o.point,tt=[Ge.x*d,Ge.y*d,0];return f.$.min(A,A,tt),f.$.max(S,S,tt),new Yi(A,S)}if(o._tileCoverLift>0){for(const Ge of b)f.$.min(A,A,Ge),f.$.max(S,S,Ge);return new Yi(A,S)}const k=[m[12]*d,m[13]*d,m[14]*d],R=_.getCenter(),L=vr(o.center.lat,-Us,Us),U=vr(R.lat,-Us,Us),H=ac(o.center.lng),G=Fh(L);let Y=H-ac(R.lng);const ue=G-Fh(U);Y>.5?Y-=1:Y<-.5&&(Y+=1);let ae=0;if(Math.abs(Y)>Math.abs(ue))ae=Y>=0?1:3;else{ae=ue>=0?0:2;const Ge=[m[4]*d,m[5]*d,m[6]*d],tt=-Math.sin(Dr(ue>=0?_.getSouth():_.getNorth()))*Va;f.$.scaleAndAdd(k,k,Ge,tt)}const he=b[ae],ve=b[(ae+1)%4],we=new IT(he,ve,k),Se=[lc(we,0)||he[0],lc(we,1)||he[1],lc(we,2)||he[2]],Fe=xp(o.zoom);if(Fe>0){const Ge=function({x:Ye,y:ht,z:Dt},dt,Nt,ut,vt){const zt=1/(1<<Dt);let ct=Ye*zt,qt=ct+zt,Lt=ht*zt,Mt=Lt+zt,In=0;const _n=(ct+qt)/2-ut;return _n>.5?In=-1:_n<-.5&&(In=1),ct=((ct+In)*dt-(ut*=dt))*Nt+ut,qt=((qt+In)*dt-ut)*Nt+ut,Lt=(Lt*dt-(vt*=dt))*Nt+vt,Mt=(Mt*dt-vt)*Nt+vt,[[ct,Mt,0],[qt,Mt,0],[qt,Lt,0],[ct,Lt,0]]}(a,i,o._pixelsPerMercatorPixel,H,G);for(let Ye=0;Ye<b.length;Ye++)ja(b[Ye],Ge[Ye],Fe);const tt=f.$.add([],Ge[ae],Ge[(ae+1)%4]);f.$.scale(tt,tt,.5),ja(Se,tt,Fe)}for(const Ge of b)f.$.min(A,A,Ge),f.$.max(S,S,Ge);return A[2]=Math.min(he[2],ve[2]),f.$.min(A,A,Se),f.$.max(S,S,Se),new Yi(A,S)}function OT({x:o,y:i,z:a},u=!1){const d=1/(1<<a),m=new kr(Vl(o*d),i===(1<<a)-1&&u?-90:fo((i+1)*d)),_=new kr(Vl((o+1)*d),0===i&&u?90:fo(i*d));return new iu(m,_)}function eD(o,i=Va){const a=Dr(o.getNorth()),u=Dr(o.getSouth()),d=Math.cos(a),m=Math.cos(u),_=Math.sin(a),b=Math.sin(u),T=o.getWest(),S=o.getEast();return[pp(m,b,T,i),pp(m,b,S,i),pp(d,_,S,i),pp(d,_,T,i)]}function wx(o,i,a,u){const d=1<<a.z,m=(o/Ut+a.x)/d;return mp(fo((i/Ut+a.y)/d),Vl(m),u)}function RT({min:o,max:i}){return Nh/Math.max(i[0]-o[0],i[1]-o[1],i[2]-o[2])}const sO=new Float64Array(16);function N1(o){const i=RT(o),a=f.ae.fromScaling(sO,[i,i,i]);return f.ae.translate(a,a,f.$.negate([],o.min))}function vp(o){const i=f.ae.fromTranslation(sO,o.min),a=1/RT(o);return f.ae.scale(i,i,[a,a,a])}function Di(o){const i=Ut/(2*Math.PI);return o/(2*Math.PI)/i}function PT(o,i){return Ut/(512*Math.pow(2,o))*RT(Nu(i))}function zh(o,i,a,u,d){const m=Di(a),_=[o,i,-a/(2*Math.PI)],b=f.ae.identity(new Float64Array(16));return f.ae.translate(b,b,_),f.ae.scale(b,b,[m,m,m]),f.ae.rotateX(b,b,Dr(-d)),f.ae.rotateY(b,b,Dr(-u)),b}function xp(o){return jg(gx,x0,o)}function tD(o,i){const a=mp(i.lat,i.lng),u=function(m){const _=mp(m._center.lat,m._center.lng),b=f.$.fromValues(0,1,0);let T=f.$.cross([],b,_);const S=f.ae.fromRotation([],-m.angle,_);T=f.$.transformMat4(T,T,S),f.ae.fromRotation(S,-m._pitch,T);const A=f.$.normalize([],_);return f.$.scale(A,A,AT(m.cameraToCenterDistance/m.pixelsPerMeter)),f.$.transformMat4(A,A,S),f.$.add([],_,A)}(o),d=f.$.subtract([],u,a);return f.$.angle(d,a)}function ir(o,i){return tD(o,i)>Math.PI/2*1.01}const nD=Dr(85),NT=Math.cos(nD),F1=Math.sin(nD),oO=f.ae.create(),FT=o=>{const i=[];return"map"===o.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===o.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i};function LT(o,i,a,u,d,m,_,b,T){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(T*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,A=a.projection.upVectorScale(S,a.center.lat,a.worldSize).metersToTile;for(const k of i)for(const R of k){const L=R.add(b),U=d&&a.elevation?a.elevation.exaggeration()*d.getElevationAt(L.x,L.y,!0):0,H=a.projection.projectTilePoint(L.x,L.y,S);if(U>0){const ae=a.projection.upVector(S,L.x,L.y);H.x+=ae[0]*A*U,H.y+=ae[1]*A*U,H.z+=ae[2]*A*U}const G=m?L:Tx(H.x,H.y,H.z,u),Y=m?o.tilespaceRays.map(ae=>aO(ae,U)):o.queryGeometry.screenGeometry,ue=f.aB.transformMat4([],[H.x,H.y,H.z,1],u);if(!_&&m?T*=ue[3]/a.cameraToCenterDistance:_&&!m&&(T*=a.cameraToCenterDistance/ue[3]),m){const ae=fo((R.y/Ut+S.y)/(1<<S.z));T/=a.projection.pixelsPerMeter(ae,1)/ko(1,ae)}if(nO(Y,G,T))return!0}return!1}function Tx(o,i,a,u){const d=f.aB.transformMat4([],[o,i,a,1],u);return new $t(d[0]/d[3],d[1]/d[3])}const L1=f.$.fromValues(0,0,0),BT=f.$.fromValues(0,0,1);function aO(o,i){const a=f.$.create();return L1[2]=i,o.intersectsPlane(L1,BT,a),new $t(a[0],a[1])}class rD extends E0{}function iD(o,{width:i,height:a},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==i*a*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(i*a*u);return o.width=i,o.height=a,o.data=d,o}function zT(o,i,a){const{width:u,height:d}=i;u===o.width&&d===o.height||(UT(o,i,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,u),height:Math.min(o.height,d)},a,null),o.width=u,o.height=d,o.data=i.data)}function UT(o,i,a,u,d,m,_,b){if(0===d.width||0===d.height)return i;if(d.width>o.width||d.height>o.height||a.x>o.width-d.width||a.y>o.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>i.width||d.height>i.height||u.x>i.width-d.width||u.y>i.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const T=o.data,S=i.data,A=4===m&&b;for(let k=0;k<d.height;k++){const R=((a.y+k)*o.width+a.x)*m,L=((u.y+k)*i.width+u.x)*m;if(A)for(let U=0;U<d.width;U++){const H=R+U*m+3,G=L+U*m;S[G+0]=255,S[G+1]=255,S[G+2]=255,S[G+3]=T[H]}else if(_)for(let U=0;U<d.width;U++){const H=R+U*m,G=L+U*m,Y=T[H+3],ue=new Jr(T[H+0]/255*Y,T[H+1]/255*Y,T[H+2]/255*Y,Y).toRenderColor(_).toArray();S[G+0]=ue[0],S[G+1]=ue[1],S[G+2]=ue[2],S[G+3]=ue[3]}else for(let U=0;U<d.width*m;U++)S[L+U]=T[R+U]}return i}Pe(rD,"HeatmapBucket",{omit:["layers"]});class bp{constructor(i,a){iD(this,i,1,a)}resize(i){zT(this,new bp(i),1)}clone(){return new bp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,u,d,m){UT(i,a,u,d,m,1,null)}}class Ps{constructor(i,a){iD(this,i,4,a)}resize(i){zT(this,new Ps(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ps({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,u,d,m,_,b){UT(i,a,u,d,m,4,_,b)}}class Ex{constructor(i,a){this.width=i.width,this.height=i.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}let VT,B1,lO,cO;function Oo(o){const i={},a=o.resolution||256,u=o.clips?o.clips.length:1,d=o.image||new Ps({width:a,height:u}),m=(_,b,T)=>{i[o.evaluationKey]=T;const S=o.expression.evaluate(i);S&&(d.data[_+b+0]=Math.floor(255*S.r/S.a),d.data[_+b+1]=Math.floor(255*S.g/S.a),d.data[_+b+2]=Math.floor(255*S.b/S.a),d.data[_+b+3]=Math.floor(255*S.a))};if(o.clips)for(let _=0,b=0;_<u;++_,b+=4*a)for(let T=0,S=0;T<a;T++,S+=4){const A=T/(a-1),{start:k,end:R}=o.clips[_];m(b,S,k*(1-A)+R*A)}else for(let _=0,b=0;_<a;_++,b+=4)m(0,b,_/(a-1));return d}Pe(bp,"AlphaImage"),Pe(Ps,"RGBAImage");const D0=Hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:sD}=D0;function M0(o,i,a=2){const u=i&&i.length,d=u?i[0]*a:o.length;let m=oD(o,0,d,a,!0);const _=[];if(!m||m.next===m.prev)return _;let b,T,S;if(u&&(m=function(A,k,R,L){const U=[];for(let H=0,G=k.length;H<G;H++){const Y=oD(A,k[H]*L,H<G-1?k[H+1]*L:A.length,L,!1);Y===Y.next&&(Y.steiner=!0),U.push(cD(Y))}U.sort(dO);for(let H=0;H<U.length;H++)R=fO(U[H],R);return R}(o,i,m,a)),o.length>80*a){b=1/0,T=1/0;let A=-1/0,k=-1/0;for(let R=a;R<d;R+=a){const L=o[R],U=o[R+1];L<b&&(b=L),U<T&&(T=U),L>A&&(A=L),U>k&&(k=U)}S=Math.max(A-b,k-T),S=0!==S?32767/S:0}return z1(m,_,a,b,T,S,0),_}function oD(o,i,a,u,d){let m;if(d===function(_,b,T,S){let A=0;for(let k=b,R=T-S;k<T;k+=S)A+=(_[R]-_[k])*(_[k+1]+_[R+1]),R=k;return A}(o,i,a,u)>0)for(let _=i;_<a;_+=u)m=hD(_/u|0,o[_],o[_+1],m);else for(let _=a-u;_>=i;_-=u)m=hD(_/u|0,o[_],o[_+1],m);return m&&U1(m,m.next)&&(A0(m),m=m.next),m}function wp(o,i){if(!o)return o;i||(i=o);let a,u=o;do{if(a=!1,u.steiner||!U1(u,u.next)&&0!==Zs(u.prev,u,u.next))u=u.next;else{if(A0(u),u=i=u.prev,u===u.next)break;a=!0}}while(a||u!==i);return i}function z1(o,i,a,u,d,m,_){if(!o)return;!_&&m&&function(T,S,A,k){let R=T;do{0===R.z&&(R.z=Cx(R.x,R.y,S,A,k)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next}while(R!==T);R.prevZ.nextZ=null,R.prevZ=null,function(L){let U,H=1;do{let G,Y=L;L=null;let ue=null;for(U=0;Y;){U++;let ae=Y,he=0;for(let we=0;we<H&&(he++,ae=ae.nextZ,ae);we++);let ve=H;for(;he>0||ve>0&&ae;)0!==he&&(0===ve||!ae||Y.z<=ae.z)?(G=Y,Y=Y.nextZ,he--):(G=ae,ae=ae.nextZ,ve--),ue?ue.nextZ=G:L=G,G.prevZ=ue,ue=G;Y=ae}ue.nextZ=null,H*=2}while(U>1)}(R)}(o,u,d,m);let b=o;for(;o.prev!==o.next;){const T=o.prev,S=o.next;if(m?uO(o,u,d,m):aD(o))i.push(T.i,o.i,S.i),A0(o),o=S.next,b=S.next;else if((o=S)===b){_?1===_?z1(o=lD(wp(o),i),i,a,u,d,m,2):2===_&&hO(o,i,a,u,d,m):z1(wp(o),i,a,u,d,m,1);break}}}function aD(o){const i=o.prev,a=o,u=o.next;if(Zs(i,a,u)>=0)return!1;const d=i.x,m=a.x,_=u.x,b=i.y,T=a.y,S=u.y,A=d<m?d<_?d:_:m<_?m:_,k=b<T?b<S?b:S:T<S?T:S,R=d>m?d>_?d:_:m>_?m:_,L=b>T?b>S?b:S:T>S?T:S;let U=u.next;for(;U!==i;){if(U.x>=A&&U.x<=R&&U.y>=k&&U.y<=L&&qm(d,b,m,T,_,S,U.x,U.y)&&Zs(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function uO(o,i,a,u){const d=o.prev,m=o,_=o.next;if(Zs(d,m,_)>=0)return!1;const b=d.x,T=m.x,S=_.x,A=d.y,k=m.y,R=_.y,L=b<T?b<S?b:S:T<S?T:S,U=A<k?A<R?A:R:k<R?k:R,H=b>T?b>S?b:S:T>S?T:S,G=A>k?A>R?A:R:k>R?k:R,Y=Cx(L,U,i,a,u),ue=Cx(H,G,i,a,u);let ae=o.prevZ,he=o.nextZ;for(;ae&&ae.z>=Y&&he&&he.z<=ue;){if(ae.x>=L&&ae.x<=H&&ae.y>=U&&ae.y<=G&&ae!==d&&ae!==_&&qm(b,A,T,k,S,R,ae.x,ae.y)&&Zs(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,he.x>=L&&he.x<=H&&he.y>=U&&he.y<=G&&he!==d&&he!==_&&qm(b,A,T,k,S,R,he.x,he.y)&&Zs(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ae&&ae.z>=Y;){if(ae.x>=L&&ae.x<=H&&ae.y>=U&&ae.y<=G&&ae!==d&&ae!==_&&qm(b,A,T,k,S,R,ae.x,ae.y)&&Zs(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;he&&he.z<=ue;){if(he.x>=L&&he.x<=H&&he.y>=U&&he.y<=G&&he!==d&&he!==_&&qm(b,A,T,k,S,R,he.x,he.y)&&Zs(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function lD(o,i){let a=o;do{const u=a.prev,d=a.next.next;!U1(u,d)&&jT(u,a,a.next,d)&&j1(u,d)&&j1(d,u)&&(i.push(u.i,a.i,d.i),A0(a),A0(a.next),a=o=d),a=a.next}while(a!==o);return wp(a)}function hO(o,i,a,u,d,m){let _=o;do{let b=_.next.next;for(;b!==_.prev;){if(_.i!==b.i&&Sx(_,b)){let T=uD(_,b);return _=wp(_,_.next),T=wp(T,T.next),z1(_,i,a,u,d,m,0),void z1(T,i,a,u,d,m,0)}b=b.next}_=_.next}while(_!==o)}function dO(o,i){return o.x-i.x}function fO(o,i){const a=function(d,m){let _=m;const b=d.x,T=d.y;let S,A=-1/0;do{if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const H=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(H<=b&&H>A&&(A=H,S=_.x<_.next.x?_:_.next,H===b))return S}_=_.next}while(_!==m);if(!S)return null;const k=S,R=S.x,L=S.y;let U=1/0;_=S;do{if(b>=_.x&&_.x>=R&&b!==_.x&&qm(T<L?b:A,T,R,L,T<L?A:b,T,_.x,_.y)){const H=Math.abs(T-_.y)/(b-_.x);j1(_,d)&&(H<U||H===U&&(_.x>S.x||_.x===S.x&&pO(S,_)))&&(S=_,U=H)}_=_.next}while(_!==k);return S}(o,i);if(!a)return i;const u=uD(a,o);return wp(u,u.next),wp(a,a.next)}function pO(o,i){return Zs(o.prev,o,i.prev)<0&&Zs(i.next,o,o.next)<0}function Cx(o,i,a,u,d){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-a)*d|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-u)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function cD(o){let i=o,a=o;do{(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next}while(i!==o);return a}function qm(o,i,a,u,d,m,_,b){return(d-_)*(i-b)>=(o-_)*(m-b)&&(o-_)*(u-b)>=(a-_)*(i-b)&&(a-_)*(m-b)>=(d-_)*(u-b)}function Sx(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(a,u){let d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==u.i&&d.next.i!==u.i&&jT(d,d.next,a,u))return!0;d=d.next}while(d!==a);return!1}(o,i)&&(j1(o,i)&&j1(i,o)&&function(a,u){let d=a,m=!1;const _=(a.x+u.x)/2,b=(a.y+u.y)/2;do{d.y>b!=d.next.y>b&&d.next.y!==d.y&&_<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next}while(d!==a);return m}(o,i)&&(Zs(o.prev,o,i.prev)||Zs(o,i.prev,i))||U1(o,i)&&Zs(o.prev,o,o.next)>0&&Zs(i.prev,i,i.next)>0)}function Zs(o,i,a){return(i.y-o.y)*(a.x-i.x)-(i.x-o.x)*(a.y-i.y)}function U1(o,i){return o.x===i.x&&o.y===i.y}function jT(o,i,a,u){const d=Dx(Zs(o,i,a)),m=Dx(Zs(o,i,u)),_=Dx(Zs(a,u,o)),b=Dx(Zs(a,u,i));return d!==m&&_!==b||!(0!==d||!V1(o,a,i))||!(0!==m||!V1(o,u,i))||!(0!==_||!V1(a,o,u))||!(0!==b||!V1(a,i,u))}function V1(o,i,a){return i.x<=Math.max(o.x,a.x)&&i.x>=Math.min(o.x,a.x)&&i.y<=Math.max(o.y,a.y)&&i.y>=Math.min(o.y,a.y)}function Dx(o){return o>0?1:o<0?-1:0}function j1(o,i){return Zs(o.prev,o,o.next)<0?Zs(o,i,o.next)>=0&&Zs(o,o.prev,i)>=0:Zs(o,i,o.prev)<0||Zs(o,o.next,i)<0}function uD(o,i){const a=dD(o.i,o.x,o.y),u=dD(i.i,i.x,i.y),d=o.next,m=i.prev;return o.next=i,i.prev=o,a.next=d,d.prev=a,u.next=a,a.prev=u,m.next=u,u.prev=m,u}function hD(o,i,a,u){const d=dD(o,i,a);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function A0(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function dD(o,i,a){return{i:o,x:i,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $1(o,i){const a=o.length;if(a<=1)return[o];const u=[];let d,m;for(let _=0;_<a;_++){const b=Z_(o[_]);0!==b&&(o[_].area=Math.abs(b),void 0===m&&(m=b<0),m===b<0?(d&&u.push(d),d=[o[_]]):d.push(o[_]))}if(d&&u.push(d),i>1)for(let _=0;_<u.length;_++)u[_].length<=i||(Wr(u[_],i,1,u[_].length-1,mO),u[_]=u[_].slice(0,i));return u}function mO(o,i){return i.area-o.area}function $T(o,i,a){const u=a.patternDependencies;let d=!1;for(const m of i){const _=m.paint.get(`${o}-pattern`);_.isConstant()||(d=!0);const b=_.constantOr(null);b&&(d=!0,u[b]=!0)}return d}function fD(o,i,a,u,d){const m=d.patternDependencies;for(const _ of i){const b=_.paint.get(`${o}-pattern`).value;if("constant"!==b.kind){let T=b.evaluate({zoom:u},a,{},d.availableImages);T=T&&T.name?T.name:T,m[T]=!0,a.patterns[_.id]=T}}return a}class Mx{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ll,this.indexArray=new cs,this.indexArray2=new nu,this.programConfigurations=new oc(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new us,this.segments2=new us,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection}updateFootprints(i,a){}populate(i,a,u,d){this.hasPattern=$T("fill",this.layers,a);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:b,id:T,index:S,sourceLayerIndex:A}of i){const k=this.layers[0]._featureFilter.needGeometry,R=Lh(b,k);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),R,u))continue;const L=m?m.evaluate(R,{},u,a.availableImages):void 0,U={id:T,properties:b.properties,type:b.type,sourceLayerIndex:A,index:S,geometry:k?R.geometry:su(b,u,d),patterns:{},sortKey:L};_.push(U)}m&&_.sort((b,T)=>b.sortKey-T.sortKey);for(const b of _){const{geometry:T,index:S,sourceLayerIndex:A}=b;if(this.hasPattern){const k=fD("fill",this.layers,b,this.zoom,a);this.patternFeatures.push(k)}else this.addFeature(b,T,S,u,{},a.availableImages,a.brightness);a.featureIndex.insert(i[S].feature,T,S,A,this.index)}}update(i,a,u,d,m){const _=0!==Object.keys(i).length;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(i,a,_?this.stateDependentLayers:this.layers,u,d,m)}addFeatures(i,a,u,d,m,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,u,d,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,sD),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,a,u,d,m,_=[],b){for(const T of $1(a,500)){let S=0;for(const H of T)S+=H.length;const A=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),k=A.vertexLength,R=[],L=[];for(const H of T){if(0===H.length)continue;H!==T[0]&&L.push(R.length/2);const G=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),Y=G.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(Y+H.length-1,Y),R.push(H[0].x),R.push(H[0].y);for(let ue=1;ue<H.length;ue++)this.layoutVertexArray.emplaceBack(H[ue].x,H[ue].y),this.indexArray2.emplaceBack(Y+ue-1,Y+ue),R.push(H[ue].x),R.push(H[ue].y);G.vertexLength+=H.length,G.primitiveLength+=H.length}const U=M0(R,L);for(let H=0;H<U.length;H+=3)this.indexArray.emplaceBack(k+U[H],k+U[H+1],k+U[H+2]);A.vertexLength+=S,A.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,m,_,d,b)}}let HT,Ax,pD,Wd;Pe(Mx,"FillBucket",{omit:["layers","patternFeatures"]});class Tp{constructor(i,a,u,d){if(this.triangleCount=a.length/3,this.min=new $t(0,0),this.max=new $t(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===i.length)return;const[m,_]=[i[0].clone(),i[0].clone()];for(let k=1;k<i.length;++k){const R=i[k];m.x=Math.min(m.x,R.x),m.y=Math.min(m.y,R.y),_.x=Math.max(_.x,R.x),_.y=Math.max(_.y,R.y)}if(d){const k=Math.ceil(Math.max(_.x-m.x,_.y-m.y)/d);u=Math.max(u,k)}if(0===u)return;this.min=m,this.max=_;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const T=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/T)),this.cellsY=Math.max(1,Math.ceil(b.y/T)),this.xScale=1/T,this.yScale=1/T;const S=[];for(let k=0;k<this.triangleCount;k++){const R=i[a[3*k+0]].sub(this.min),L=i[a[3*k+1]].sub(this.min),U=i[a[3*k+2]].sub(this.min),H=Uh(Math.floor(Math.min(R.x,L.x,U.x)),this.xScale,this.cellsX),G=Uh(Math.floor(Math.max(R.x,L.x,U.x)),this.xScale,this.cellsX),Y=Uh(Math.floor(Math.min(R.y,L.y,U.y)),this.yScale,this.cellsY),ue=Uh(Math.floor(Math.max(R.y,L.y,U.y)),this.yScale,this.cellsY),ae=new $t(0,0),he=new $t(0,0),ve=new $t(0,0),we=new $t(0,0);for(let Se=Y;Se<=ue;++Se){ae.y=he.y=Se*T,ve.y=we.y=(Se+1)*T;for(let Fe=H;Fe<=G;++Fe)ae.x=ve.x=Fe*T,he.x=we.x=(Fe+1)*T,(CT(R,L,U,ae,he,we)||CT(R,L,U,ae,we,ve))&&S.push({cellIdx:Se*this.cellsX+Fe,triIdx:k})}}if(0===S.length)return;S.sort((k,R)=>k.cellIdx-R.cellIdx||k.triIdx-R.triIdx);let A=0;for(;A<S.length;){const k=S[A].cellIdx,R={start:this.payload.length,len:0};for(;A<S.length&&S[A].cellIdx===k;)++R.len,this.payload.push(S[A++].triIdx);this.cells[k]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,a){if(0===this.triangleCount||0===this.cells.length||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const u=Uh(i.x-this.min.x,this.xScale,this.cellsX),d=Uh(i.y-this.min.y,this.yScale,this.cellsY),m=this.cells[d*this.cellsX+u];if(m){this._lazyInitLookup();for(let _=0;_<m.len;_++){const b=this.payload[m.start+_],T=Math.floor(b/8),S=1<<b%8;if(!(this.lookup[T]&S)&&(this.lookup[T]|=S,a.push(b),a.length===this.triangleCount))return}}}query(i,a,u){if(0===this.triangleCount||0===this.cells.length||i.x>this.max.x||this.min.x>a.x||i.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const d=Uh(i.x-this.min.x,this.xScale,this.cellsX),m=Uh(a.x-this.min.x,this.xScale,this.cellsX),_=Uh(i.y-this.min.y,this.yScale,this.cellsY),b=Uh(a.y-this.min.y,this.yScale,this.cellsY);for(let T=_;T<=b;T++)for(let S=d;S<=m;S++){const A=this.cells[T*this.cellsX+S];if(A)for(let k=0;k<A.len;k++){const R=this.payload[A.start+k],L=Math.floor(R/8),U=1<<R%8;if(!(this.lookup[L]&U)&&(this.lookup[L]|=U,u.push(R),u.length===this.triangleCount))return}}}}function Uh(o,i,a){return Math.max(0,Math.min(a-1,Math.floor(o*i)))}Pe(Tp,"TriangleGridIndex");class GT{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[]}updateFootprints(i,a){for(const u of this.footprints)a.push({footprint:u,id:i})}populate(i,a,u,d){const m=[];for(const{feature:_,id:b,index:T,sourceLayerIndex:S}of i){const A=this.layers[0]._featureFilter.needGeometry,k=Lh(_,A);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),k,u))continue;const R={id:b,properties:_.properties,type:_.type,sourceLayerIndex:S,index:T,geometry:A?k.geometry:su(_,u,d),patterns:{}};m.push(R)}for(const _ of m){const{geometry:b,index:T,sourceLayerIndex:S}=_;this.addFeature(_,b,T,u,{},a.availableImages,a.brightness),a.featureIndex.insert(i[T].feature,b,T,S,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(i){}update(i,a,u,d,m){}destroy(){}addFeature(i,a,u,d,m,_=[],b){for(const T of $1(a,2)){const S=[],A=[],k=[],R=new $t(1/0,1/0),L=new $t(-1/0,-1/0);for(const G of T)if(0!==G.length){G!==T[0]&&k.push(A.length/2);for(let Y=0;Y<G.length;Y++)A.push(G[Y].x),A.push(G[Y].y),S.push(G[Y]),R.x=Math.min(R.x,G[Y].x),R.y=Math.min(R.y,G[Y].y),L.x=Math.max(L.x,G[Y].x),L.y=Math.max(L.y,G[Y].y)}const U=M0(A,k),H=new Tp(S,U,8,256);this.footprints.push({vertices:S,indices:U,grid:H,min:R,max:L})}}}Pe(GT,"ClipBucket",{omit:["layers"]});const Ep=Hn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sL=Hn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),oL=Hn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),mD=Hn([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),gO=Hn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),_O=Hn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:aL}=Ep;var WT={},Ix=zg,gD=Cp;function Cp(o,i,a,u,d){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=u,this._values=d,o.readFields(qT,this,i)}function qT(o,i,a){1==o?i.id=a.readVarint():2==o?function(u,d){for(var m=u.readVarint()+u.pos;u.pos<m;){var _=d._keys[u.readVarint()],b=d._values[u.readVarint()];d.properties[_]=b}}(a,i):3==o?i.type=a.readVarint():4==o&&(i._geometry=a.pos)}function I0(o){for(var i,a,u=0,d=0,m=o.length,_=m-1;d<m;_=d++)u+=((a=o[_]).x-(i=o[d]).x)*(i.y+a.y);return u}Cp.types=["Unknown","Point","LineString","Polygon"],Cp.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,a=o.readVarint()+o.pos,u=1,d=0,m=0,_=0,b=[];o.pos<a;){if(d<=0){var T=o.readVarint();u=7&T,d=T>>3}if(d--,1===u||2===u)m+=o.readSVarint(),_+=o.readSVarint(),1===u&&(i&&b.push(i),i=[]),i.push(new Ix(m,_));else{if(7!==u)throw new Error("unknown command "+u);i&&i.push(i[0].clone())}}return i&&b.push(i),b},Cp.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,a=1,u=0,d=0,m=0,_=1/0,b=-1/0,T=1/0,S=-1/0;o.pos<i;){if(u<=0){var A=o.readVarint();a=7&A,u=A>>3}if(u--,1===a||2===a)(d+=o.readSVarint())<_&&(_=d),d>b&&(b=d),(m+=o.readSVarint())<T&&(T=m),m>S&&(S=m);else if(7!==a)throw new Error("unknown command "+a)}return[_,T,b,S]},Cp.prototype.toGeoJSON=function(o,i,a){var u,d,m=this.extent*Math.pow(2,a),_=this.extent*o,b=this.extent*i,T=this.loadGeometry(),S=Cp.types[this.type];function A(L){for(var U=0;U<L.length;U++){var H=L[U];L[U]=[360*(H.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(u=0;u<T.length;u++)k[u]=T[u][0];A(T=k);break;case 2:for(u=0;u<T.length;u++)A(T[u]);break;case 3:for(T=function(L){var U=L.length;if(U<=1)return[L];for(var H,G,Y=[],ue=0;ue<U;ue++){var ae=I0(L[ue]);0!==ae&&(void 0===G&&(G=ae<0),G===ae<0?(H&&Y.push(H),H=[L[ue]]):H.push(L[ue]))}return H&&Y.push(H),Y}(T),u=0;u<T.length;u++)for(d=0;d<T[u].length;d++)A(T[u][d])}1===T.length?T=T[0]:S="Multi"+S;var R={type:"Feature",geometry:{type:S,coordinates:T},properties:this.properties};return"id"in this&&(R.id=this.id),R};var kx=gD,Ox=k0;function k0(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Rx,this,i),this.length=this._features.length}function Rx(o,i,a){15===o?i.version=a.readVarint():1===o?i.name=a.readString():5===o?i.extent=a.readVarint():2===o?i._features.push(a.pos):3===o?i._keys.push(a.readString()):4===o&&i._values.push(function(u){for(var d=null,m=u.readVarint()+u.pos;u.pos<m;){var _=u.readVarint()>>3;d=1===_?u.readString():2===_?u.readFloat():3===_?u.readDouble():4===_?u.readVarint64():5===_?u.readVarint():6===_?u.readSVarint():7===_?u.readBoolean():null}return d}(a))}k0.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new kx(this._pbf,i,this.extent,this._keys,this._values)};var O0=Ox;function ZT(o,i,a){if(3===o){var u=new O0(a,a.readVarint()+a.pos);u.length&&(i[u.name]=u)}}var R0=WT.VectorTile=function(o,i){this.layers=o.readFields(ZT,{},i)},Sp=WT.VectorTileFeature=gD;WT.VectorTileLayer=Ox;class qd extends $t{constructor(i,a,u){super(i,a),this.z=u}}class yO extends qd{constructor(i,a,u,d){super(i,a,u),this.w=d}}function P0(o,i,a,u){const d=[],m=0===u?(_,b,T,S,A,k)=>{_.push(new $t(k,T+(k-b)/(S-b)*(A-T)))}:(_,b,T,S,A,k)=>{_.push(new $t(b+(k-T)/(A-T)*(S-b),k))};for(const _ of o){const b=[];for(const T of _){if(T.length<=2)continue;const S=[];for(let R=0;R<T.length-1;R++){const L=T[R].x,U=T[R].y,H=T[R+1].x,G=T[R+1].y,Y=0===u?L:U,ue=0===u?H:G;Y<i?ue>i&&m(S,L,U,H,G,i):Y>a?ue<a&&m(S,L,U,H,G,a):S.push(T[R]),ue<i&&Y>=i&&m(S,L,U,H,G,i),ue>a&&Y<=a&&m(S,L,U,H,G,a)}let A=T[T.length-1];const k=0===u?A.x:A.y;k>=i&&k<=a&&S.push(A),S.length&&(A=S[S.length-1],S[0].x===A.x&&S[0].y===A.y||S.push(S[0]),b.push(S))}b.length&&d.push(b)}return d}function N0(o,i,a,u){const d="x"===a?"y":"x",m=(u-o[a])/(i[a]-o[a]);o[d]=o[d]+(i[d]-o[d])*m,o[a]=u,o.hasOwnProperty("z")&&(o.z=Fn(o.z,i.z,m)),o.hasOwnProperty("w")&&(o.w=Fn(o.w,i.w,m))}function _D(o,i,a,u){const d=a,m=u;for(const _ of["x","y"]){let b=o,T=i;b[_]>=T[_]&&(b=i,T=o),b[_]<d&&T[_]>d&&N0(b,T,_,d),b[_]<m&&T[_]>m&&N0(T,b,_,m)}}const H1=Number.MAX_SAFE_INTEGER;function yD(o,i,a,u){return o.order<i||o.order===H1||!(o.clipMask&a)||(d=u,0!==(m=o.clipScope).length&&void 0===m.find(_=>_===d));var d,m}function Px(o,i){return o.x-i.x||o.y-i.y}function Nx(o,i){return 0===Px(o.min,i.min)&&0===Px(o.max,i.max)}function Fx(o,i){return!(o.min.x>i.max.x||o.max.x<i.min.x||o.min.y>i.max.y||o.max.y<i.min.y)}function XT(o,i){if(o.length!==i.length)return!1;for(let a=0;a<o.length;a++)if(o[a].sourceId!==i[a].sourceId||!Nx(o[a],i[a])||o[a].order!==i[a].order||o[a].clipMask!==i[a].clipMask||!Ed(o[a].clipScope,i[a].clipScope))return!1;return!0}function vD(o,i,a){const u=1/Ut,d=1/(1<<a.canonical.z),m=(i.x*u+a.canonical.x)*d+a.wrap,_=(i.y*u+a.canonical.y)*d;return{min:new $t((o.x*u+a.canonical.x)*d+a.wrap,(o.y*u+a.canonical.y)*d),max:new $t(m,_)}}function G1(o,i,a){const u=1<<a.canonical.z,d=((i.x-a.wrap)*u-a.canonical.x)*Ut,m=(i.y*u-a.canonical.y)*Ut;return{min:new $t(((o.x-a.wrap)*u-a.canonical.x)*Ut,(o.y*u-a.canonical.y)*Ut),max:new $t(d,m)}}function YT(o,i,a,u,d,m,_){const b=o.indices,T=o.vertices,S=[];for(let A=u;A<u+d;A+=3){const k=i[a[A+0]+m],R=i[a[A+1]+m],L=i[a[A+2]+m],U=Math.min(k.x,R.x,L.x),H=Math.max(k.x,R.x,L.x),G=Math.min(k.y,R.y,L.y),Y=Math.max(k.y,R.y,L.y);S.length=0,o.grid.query(new $t(U,G),new $t(H,Y),S);for(let ue=0;ue<S.length;ue++){const ae=S[ue];if(CT(T[b[3*ae+0]],T[b[3*ae+1]],T[b[3*ae+2]],k,R,L,_))return!0}}return!1}function Lx(o,i,a,u){if(!o||!a)return!1;let d=o.vertices;if(!i.canonical.equals(u.canonical)||i.wrap!==u.wrap){if(a.vertices.length<o.vertices.length)return Lx(a,u,o,i);const m=i.canonical,_=u.canonical,b=Math.pow(2,_.z-m.z);d=o.vertices.map(T=>new $t((T.x+m.x*Ut)*b-_.x*Ut,(T.y+m.y*Ut)*b-_.y*Ut))}return YT(a,d,o.indices,0,o.indices.length,0,0)}function xD(o,i,a,u){const d=Math.pow(2,u.z-a.z);return new $t((o+a.x*Ut)*d-u.x*Ut,(i+a.y*Ut)*d-u.y*Ut)}function vO(o,i){const a=[];i.footprint.grid.queryPoint(o,a);const u=i.footprint.indices,d=i.footprint.vertices;for(let m=0;m<a.length;m++){const _=a[m];if(Bh([d[u[3*_+0]],d[u[3*_+1]],d[u[3*_+2]]],o))return!0}return!1}class xO{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const u=this.toIdx(i,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function F0(o,i,a,u){let d=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(u[_])<1e-15){if(a[_]<o[_]||a[_]>i[_])return null}else{const b=1/u[_];let T=(o[_]-a[_])*b,S=(i[_]-a[_])*b;if(T>S){const A=T;T=S,S=A}if(T>d&&(d=T),S<m&&(m=S),d>m)return null}return d}function bD(o,i,a,u,d,m,_,b,T,S,A){const k=u-o,R=d-i,L=m-a,U=_-o,H=b-i,G=T-a,Y=A[1]*G-A[2]*H,ue=A[2]*U-A[0]*G,ae=A[0]*H-A[1]*U,he=k*Y+R*ue+L*ae;if(Math.abs(he)<1e-15)return null;const ve=1/he,we=S[0]-o,Se=S[1]-i,Fe=S[2]-a,Ge=(we*Y+Se*ue+Fe*ae)*ve;if(Ge<0||Ge>1)return null;const tt=Se*L-Fe*R,Ye=Fe*k-we*L,ht=we*R-Se*k,Dt=(A[0]*tt+A[1]*Ye+A[2]*ht)*ve;return Dt<0||Ge+Dt>1?null:(U*tt+H*Ye+G*ht)*ve}function W1(o,i,a){return(o-i)/(a-i)}function Bx(o,i,a,u,d,m,_,b,T){const S=1<<a,A=m-u,k=_-d,R=(o+1)/S*A+u,L=(i+0)/S*k+d,U=(i+1)/S*k+d;b[0]=(o+0)/S*A+u,b[1]=L,T[0]=R,T[1]=U}class KT{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(m){const _=Math.ceil(Math.log2(m.dim/8)),b=[];let T=Math.ceil(Math.pow(2,_));const S=1/T,A=(L,U,H,G,Y)=>{const ue=G?1:0,ae=(L+1)*H-ue,he=U*H,ve=(U+1)*H-ue;Y[0]=L*H,Y[1]=he,Y[2]=ae,Y[3]=ve};let k=new xO(T);const R=[];for(let L=0;L<T*T;L++){A(L%T,Math.floor(L/T),S,!1,R);const U=Zd(R[0],R[1],m),H=Zd(R[2],R[1],m),G=Zd(R[2],R[3],m),Y=Zd(R[0],R[3],m);k.minimums.push(Math.min(U,H,G,Y)),k.maximums.push(Math.max(U,H,G,Y)),k.leaves.push(1)}for(b.push(k),T/=2;T>=1;T/=2){const L=b[b.length-1];k=new xO(T);for(let U=0;U<T*T;U++){A(U%T,Math.floor(U/T),2,!0,R);const H=L.getElevation(R[0],R[1]),G=L.getElevation(R[2],R[1]),Y=L.getElevation(R[2],R[3]),ue=L.getElevation(R[0],R[3]),ae=L.isLeaf(R[0],R[1]),he=L.isLeaf(R[2],R[1]),ve=L.isLeaf(R[2],R[3]),we=L.isLeaf(R[0],R[3]),Se=Math.min(H.min,G.min,Y.min,ue.min),Fe=Math.max(H.max,G.max,Y.max,ue.max),Ge=ae&&he&&ve&&we;k.maximums.push(Fe),k.minimums.push(Se),k.leaves.push(Fe-Se<=5&&Ge?1:0)}b.push(k)}return b}(this.dem),u=a.length-1,d=a[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(i,a,u,d,m,_,b=1){return F0([i,a,-100],[u,d,this.maximums[0]*b],m,_)}raycast(i,a,u,d,m,_,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(i,a,u,d,m,_,b);if(null==T)return null;const S=[],A=[],k=[],R=[],L=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:U,t:H,nodex:G,nodey:Y,depth:ue}=L.pop();if(this.leaves[U]){Bx(G,Y,ue,i,a,u,d,k,R);const he=1<<ue,ve=(G+0)/he,we=(G+1)/he,Se=(Y+0)/he,Fe=(Y+1)/he,Ge=Zd(ve,Se,this.dem)*b,tt=Zd(we,Se,this.dem)*b,Ye=Zd(we,Fe,this.dem)*b,ht=Zd(ve,Fe,this.dem)*b,Dt=bD(k[0],k[1],Ge,R[0],k[1],tt,R[0],R[1],Ye,m,_),dt=bD(R[0],R[1],Ye,k[0],R[1],ht,k[0],k[1],Ge,m,_),Nt=Math.min(null!==Dt?Dt:Number.MAX_VALUE,null!==dt?dt:Number.MAX_VALUE);if(Nt!==Number.MAX_VALUE)return Nt;{const ut=f.$.scaleAndAdd([],m,_,H);if(wD(Ge,tt,ht,Ye,W1(ut[0],k[0],R[0]),W1(ut[1],k[1],R[1]))>=ut[2])return H}continue}let ae=0;for(let he=0;he<this._siblingOffset.length;he++){Bx((G<<1)+this._siblingOffset[he][0],(Y<<1)+this._siblingOffset[he][1],ue+1,i,a,u,d,k,R),k[2]=-100,R[2]=this.maximums[this.childOffsets[U]+he]*b;const ve=F0(k,R,m,_);if(null!=ve){const we=ve;S[he]=we;let Se=!1;for(let Fe=0;Fe<ae&&!Se;Fe++)we>=S[A[Fe]]&&(A.splice(Fe,0,he),Se=!0);Se||(A[ae]=he),ae++}}for(let he=0;he<ae;he++){const ve=A[he];L.push({idx:this.childOffsets[U]+ve,t:S[ve],nodex:(G<<1)+this._siblingOffset[ve][0],nodey:(Y<<1)+this._siblingOffset[ve][1],depth:ue+1})}}return null}_addNode(i,a,u){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,u,d,m){if(1===i[d].isLeaf(a,u))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=d-1,b=i[_];let T=0,S=0;for(let A=0;A<this._siblingOffset.length;A++){const k=2*a+this._siblingOffset[A][0],R=2*u+this._siblingOffset[A][1],L=b.getElevation(k,R),U=b.isLeaf(k,R),H=this._addNode(L.min,L.max,U);U&&(T|=1<<A),S||(S=H)}for(let A=0;A<this._siblingOffset.length;A++)T&1<<A||this._construct(i,2*a+this._siblingOffset[A][0],2*u+this._siblingOffset[A][1],_,S+A)}}function wD(o,i,a,u,d,m){return Fn(Fn(o,a,m),Fn(i,u,m),d)}function Zd(o,i,a){const u=a.dim,d=vr(o*u-.5,0,u-1),m=vr(i*u-.5,0,u-1),_=Math.floor(d),b=Math.floor(m),T=Math.min(_+1,u-1),S=Math.min(b+1,u-1);return wD(a.get(_,b),a.get(T,b),a.get(_,S),a.get(T,S),d-_,m-b)}const JT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function TD(o,i,a){return(256*o*256+256*i+a)/10-1e4}function q1(o,i,a){return 256*o+i+a/256-32768}class Z1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,u,d=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return ks(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const m=this.dim=a.height-2,_=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let T=0;T<m;T++)_[this._idx(-1,T)]=_[this._idx(0,T)],_[this._idx(m,T)]=_[this._idx(m-1,T)],_[this._idx(T,-1)]=_[this._idx(T,0)],_[this._idx(T,m)]=_[this._idx(T,m-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(m,-1)]=_[this._idx(m-1,0)],_[this._idx(-1,m)]=_[this._idx(0,m-1)],_[this._idx(m,m)]=_[this._idx(m-1,m-1)]}const b="terrarium"===u?q1:TD;for(let T=0;T<_.length;++T){const S=4*T;this.floatView[T]=b(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=aa.now()}_buildQuadTree(){this._tree=new KT(this)}get(i,a,u=!1){u&&(i=vr(i,-1,this.dim),a=vr(a,-1,this.dim));const d=this._idx(i,a);return this.floatView[d]}set(i,a,u){const d=this._idx(i,a),m=this.floatView[d];return this.floatView[d]=u,u-m}static getUnpackVector(i){return JT[i]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}static pack(i,a){const u=[0,0,0,0],d=Z1.getUnpackVector(a);let m=Math.floor((i+d[3])/d[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new Ex({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,m=a*this.dim+this.dim,_=u*this.dim,b=u*this.dim+this.dim;switch(a){case-1:d=m-1;break;case 1:m=d+1}switch(u){case-1:_=b-1;break;case 1:b=_+1}const T=-a*this.dim,S=-u*this.dim;for(let A=_;A<b;A++)for(let k=d;k<m;k++){const R=4*this._idx(k,A),L=4*this._idx(k+T,A+S);this.pixels[R+0]=i.pixels[L+0],this.pixels[R+1]=i.pixels[L+1],this.pixels[R+2]=i.pixels[L+2],this.pixels[R+3]=i.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Pe(Z1,"DEMData"),Pe(KT,"DemMinMaxQuadTree",{omit:["dem"]});class Xd{constructor(i,a,u){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(i,a,u){const d=u||i.findDEMTileFor(a);if(!d||!d.dem)return;const m=d.dem,_=d.tileID,b=1<<a.canonical.z-_.canonical.z;return new Xd(d,m.dim/Ut/b,[(a.canonical.x/b-_.canonical.x)*m.dim,(a.canonical.y/b-_.canonical.y)*m.dim])}tileCoordToPixel(i,a){const u=a*this._scale+this._offset[1],d=Math.floor(i*this._scale+this._offset[0]),m=Math.floor(u);return new $t(d,m)}getElevationAt(i,a,u,d){const m=i*this._scale+this._offset[0],_=a*this._scale+this._offset[1],b=Math.floor(m),T=Math.floor(_),S=this._dem;return d=!!d,u?Fn(Fn(S.get(b,T,d),S.get(b,T+1,d),_-T),Fn(S.get(b+1,T,d),S.get(b+1,T+1,d),_-T),m-b):S.get(b,T,d)}getElevationAtPixel(i,a,u){return this._dem.get(i,a,!!u)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*ko(1,i)*this._dem.stride}}const QT={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},ED=Sp.types,CD=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],zx=["fill-extrusion-flood-light-ground-radius"],eE=Math.pow(2,13),SD=Math.pow(2,15)-1,X1=new $t(0,1),Vh=2147483648;function jh(o,i,a,u,d,m,_,b){o.emplaceBack((i<<1)+_,(a<<1)+m,(Math.floor(u*eE)<<1)+d,Math.round(b))}function Y1(o,i,a,u){o.emplaceBack(i.x*Ut,i.y*Ut,a?0:1,u?1:0)}function Ux(o,i,a,u,d,m){o.emplaceBack(i.x,i.y,(a.x<<1)+u,(a.y<<1)+d,m)}function Vx(o,i,a){o.emplaceBack(i.x,i.y,i.z,16384*a[0],16384*a[1],16384*a[2])}class K1{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class jx{constructor(){this.centroidXY=new $t(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new $t(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new $t(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new $t(this.max.x-this.min.x,this.max.y-this.min.y)}}class tE{constructor(){this.acc=new $t(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,a){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=a.x,i.min.y=i.max.y=a.y)}appendEdge(i,a,u){this.accCount++,this.acc._add(a);let d=!!this.borders;a.x<i.min.x?(i.min.x=a.x,d=!0):a.x>i.max.x&&(i.max.x=a.x,d=!0),a.y<i.min.y?(i.min.y=a.y,d=!0):a.y>i.max.y&&(i.max.y=a.y,d=!0),((0===a.x||a.x===Ut)&&a.x===u.x)!=((0===a.y||a.y===Ut)&&a.y===u.y)&&this.processBorderOverlap(a,u),d&&this.checkBorderIntersection(a,u)}checkBorderIntersection(i,a){a.x<0!=i.x<0&&this.addBorderIntersection(0,Fn(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>Ut!=i.x>Ut&&this.addBorderIntersection(1,Fn(a.y,i.y,(Ut-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,Fn(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>Ut!=i.y>Ut&&this.addBorderIntersection(3,Fn(a.x,i.x,(Ut-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[i];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const u=0===i.x?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,i.y)}else{const u=0===i.y?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,i.x)}}centroid(){return 0===this.accCount?new $t(0,0):new $t(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0):0}}function nE(o,i){const a=o.add(i)._unit(),u=vr(o.x*a.x+o.y*a.y,-1,1);var d,m,_;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*SD*((m=o).x*(_=i).y-m.y*_.x<0?-1:1)}const DD=[o=>o.x<0,o=>o.x>Ut,o=>o.y<0,o=>o.y>Ut];function Zm(o,i,a,u){const d=[4];if(0===u)return d;a._mult(u);const m=o.sub(a),_=i.sub(a),b=[o,i,m,_];for(let T=0;T<4;T++)for(const S of b)if(DD[T](S)){d.push(T);break}return d}class MD{constructor(i){this.vertexArray=new Vm,this.indexArray=new cs,this.programConfigurations=new oc(i.layers,{zoom:i.zoom,lut:i.lut},a=>zx.includes(a)),this._segments=new us,this.hiddenByLandmarkVertexArray=new pT,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new us}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(i,a,u,d=!1){const m=i.length;if(m>2){let _=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let T;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const S=i[0],A=i[1];T=nE(S.sub(i[m-1])._perp()._unit(),A.sub(S)._perp()._unit())}for(let S=0;S<m;S++){const A=S===m-1?0:S+1,k=i[S],R=i[A],L=i[A===m-1?0:A+1],U=R.sub(k)._perp()._unit(),H=nE(U,L.sub(R)._perp()._unit()),G=T,Y=H;if($l(k,R,a)||d&&Fu(k,a)&&Fu(R,a)){T=H;continue}const ue=b.vertexLength;Ux(this.vertexArray,k,R,1,1,G),Ux(this.vertexArray,k,R,1,0,G),Ux(this.vertexArray,k,R,0,1,Y),Ux(this.vertexArray,k,R,0,0,Y),b.vertexLength+=4;const ae=Zm(k,R,U,u);for(const he of ae)this._segmentToGroundQuads[_].push({id:ue,region:he}),this._segmentToRegionTriCounts[_][he]+=2,b.primitiveLength+=2;T=H}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),a=i.length;for(let u=0;u<a;u++)this._segmentToGroundQuads[u].sort((d,m)=>d.region-m.region);for(let u=0;u<a;u++){const d=this._segmentToGroundQuads[u],m=i[u],_=this._segmentToRegionTriCounts[u];_.reduce((T,S)=>T+S,0);let b=0;for(let T=0;T<=4;T++){const S=_[T];if(0!==S){let A=this.regionSegments[T];A||(A=this.regionSegments[T]=new us);const k={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:S};A.get().push(k)}b+=S}for(let T=0;T<d.length;T++){const S=d[T].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,a,u,d,m,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,a,u,d,m,_)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,sL.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,a,u,d,m,_){this.hasData()&&this.programConfigurations.updatePaintArrays(i,a,u,d,m,_)}updateHiddenByLandmark(i){if(!this.hasData())return;const a=i.groundVertexCount+i.groundVertexArrayOffset;if(0===i.groundVertexCount)return;const u=i.flags&Vh?1:0;for(let d=i.groundVertexArrayOffset;d<a;++d)this.hiddenByLandmarkVertexArray.emplace(d,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,gO.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const a=this.regionSegments[i];a&&a.destroy()}}}}class $x{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new cs,this.footprintVertices=new Ll,this.footprintSegments=[],this.layoutVertexArray=new jd,this.centroidVertexArray=new ru,this.wallVertexArray=new hx,this.indexArray=new cs,this.programConfigurations=new oc(i.layers,{zoom:i.zoom,lut:i.lut},a=>CD.includes(a)),this.segments=new us,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new MD(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(i,a){}populate(i,a,u,d){this.features=[],this.hasPattern=$T("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Oc(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:m,id:_,index:b,sourceLayerIndex:T}of i){const S=this.layers[0]._featureFilter.needGeometry,A=Lh(m,S);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),A,u))continue;const k={id:_,sourceLayerIndex:T,index:b,geometry:S?A.geometry:su(m,u,d),properties:m.properties,type:m.type,patterns:{}},R=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(fD("fill-extrusion",this.layers,k,this.zoom,a));else if(this.wallMode)for(const L of k.geometry)this.addFeature(k,[L],b,u,{},a.availableImages,d,a.brightness);else this.addFeature(k,k.geometry,b,u,{},a.availableImages,d,a.brightness);a.featureIndex.insert(m,k.geometry,b,T,this.index,R)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,a,u,d,m,_){for(const b of this.features){const{geometry:T}=b;if(this.wallMode)for(const S of T)this.addFeature(b,[S],b.index,a,u,d,m,_);else this.addFeature(b,T,b.index,a,u,d,m,_)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(i,a,u,d,m){const _=0!==Object.keys(i).length;if(_&&!this.stateDependentLayers.length)return;const b=_?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(i,a,b,u,d,m),this.groundEffect.update(i,a,b,u,d,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,aL),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,mD.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,_O.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,oL.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,u,d,m,_,b,T){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,A=[new $t(0,0),new $t(Ut,Ut)],k=b.projection,R="globe"===k.name,L=this.wallMode||"Polygon"===ED[i.type],U=new tE;U.centroidDataIndex=this.centroidData.length;const H=new jx,G=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},d)<=0,Y=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},d);let ue;if(H.height=Y,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Bl),this.wallMode){if(R)return void ks("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==a.length)return;ue=function(tt){const Ye=tt[0].x===tt[tt.length-1].x&&tt[0].y===tt[tt.length-1].y;(function(_n){let en=0;const Ht=_n.length;for(let Jn=0;Jn<Ht;Jn++)en+=(_n[(Jn+1)%Ht].x-_n[Jn].x)*(_n[(Jn+1)%Ht].y+_n[Jn].y);return en>=0})(tt)||(tt=tt.reverse());const Dt={isPolygon:Ye,geometry:[],joinNormals:[]},dt=[],Nt=[],ut=[];let vt=tt.length;if(vt<(Ye?3:2))return Dt;for(;vt>=2&&tt[vt-1].equals(tt[vt-2]);)vt--;let zt,ct,qt,Lt,Mt,In=0;for(;In<vt-1&&tt[In].equals(tt[In+1]);)In++;Ye&&(zt=tt[vt-2],Mt=tt[In].sub(zt)._unit()._perp());for(let _n=In;_n<vt;_n++){if(qt=_n===vt-1?Ye?tt[In+1]:void 0:tt[_n+1],qt&&tt[_n].equals(qt))continue;Mt&&(Lt=Mt),zt&&(ct=zt),zt=tt[_n],Mt=qt?qt.sub(zt)._unit()._perp():Lt,Lt=Lt||Mt;const en=Lt.add(Mt);0===en.x&&0===en.y||en._unit();const Ht=en.x*Mt.x+en.y*Mt.y,Jn=0!==Ht?1/Ht:1/0,bn=Lt.x*Mt.y-Lt.y*Mt.x>0;let cn="miter";"miter"===cn&&Jn>2&&(cn="bevel");const ar=(fr,hr,yr,Ar)=>{const Cr=new $t(fr.x,fr.y),bi=new $t(fr.x,fr.y);Cr.x-=hr.x*Ar,Cr.y-=hr.y*Ar,bi.x-=hr.x*Math.max(yr,1),bi.y-=hr.y*Math.max(yr,1),ut.push(hr),dt.push(Cr),Nt.push(bi)};if("miter"===cn)en._mult(Jn),ar(zt,en,1,0);else{const fr=-Math.sqrt(Jn*Jn-1),hr=bn?fr:0,yr=bn?0:fr;ct&&ar(zt,Lt,hr,yr),qt&&ar(zt,Mt,hr,yr)}}return Dt.geometry=[...dt,...Nt.reverse(),dt[0]],Dt.joinNormals=[...ut,...ut.reverse(),ut[ut.length-1]],Dt}(a[0]),a=[ue.geometry]}const ae=(tt,Ye)=>tt<(Ye.length-1)/2||tt===Ye.length-1,he=this.wallMode?[a]:$1(a,500);for(let tt=he.length-1;tt>=0;tt--){const Ye=he[tt];(0===Ye.length||(ve=Ye[0]).every(ht=>ht.x<=0)||ve.every(ht=>ht.x>=Ut)||ve.every(ht=>ht.y<=0)||ve.every(ht=>ht.y>=Ut))&&he.splice(tt,1)}var ve;let we;if(R)we=PD(he,A,d);else{we=[];for(const tt of he)we.push({polygon:tt,bounds:A})}const Se=L?this.edgeRadius:0,Fe=Se>0&&this.zoom<17,Ge=(tt,Ye)=>{if(0===tt.length)return!1;const ht=tt[tt.length-1];return Ye.x===ht.x&&Ye.y===ht.y};for(const{polygon:tt,bounds:Ye}of we){let ht=0,Dt=0;for(const vt of tt)L&&!vt[0].equals(vt[vt.length-1])&&vt.push(vt[0]),Dt+=L?vt.length-1:vt.length;const dt=this.segments.prepareSegment((L?5:4)*Dt,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);const Nt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ut=new K1;if(ut.vertexOffset=this.footprintVertices.length,ut.indexOffset=3*this.footprintIndices.length,ut.ringIndices=[],L){const vt=[],zt=[];ht=dt.vertexLength;for(let qt=0;qt<tt.length;qt++){const Lt=tt[qt];Lt.length&&0!==qt&&zt.push(vt.length/2);const Mt=[];let In,_n;In=Lt[1].sub(Lt[0])._perp()._unit(),ut.ringIndices.push(Lt.length-1);for(let en=1;en<Lt.length;en++){const Ht=Lt[en],Jn=Lt[en===Lt.length-1?1:en+1],bn=Ht.clone();if(Se){_n=Jn.sub(Ht)._perp()._unit();const cn=In.add(_n)._unit(),ar=Se*Math.min(4,1/(In.x*cn.x+In.y*cn.y));bn.x+=ar*cn.x,bn.y+=ar*cn.y,bn.x=Math.round(bn.x),bn.y=Math.round(bn.y),In=_n}if(!G||0!==Se&&!Fe||Ge(Mt,bn)||Mt.push(bn),jh(this.layoutVertexArray,bn.x,bn.y,0,0,1,1,0),this.wallMode){const cn=ae(en,Lt);Y1(this.wallVertexArray,ue.joinNormals[en],cn,ue.isPolygon)}dt.vertexLength++,this.footprintVertices.emplaceBack(Ht.x,Ht.y),vt.push(Ht.x,Ht.y),R&&Vx(this.layoutVertexExtArray,k.projectTilePoint(bn.x,bn.y,d),k.upVector(d,bn.x,bn.y))}G&&(0===Se||Fe)&&(0!==Mt.length&&Ge(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,Ye,S))}const ct=M0(vt,zt);for(let qt=0;qt<ct.length;qt+=3)this.footprintIndices.emplaceBack(ut.vertexOffset+ct[qt+0],ut.vertexOffset+ct[qt+1],ut.vertexOffset+ct[qt+2]),this.indexArray.emplaceBack(ht+ct[qt],ht+ct[qt+2],ht+ct[qt+1]),dt.primitiveLength++;ut.indexCount+=ct.length,ut.vertexCount+=this.footprintVertices.length-ut.vertexOffset}for(let vt=0;vt<tt.length;vt++){const zt=tt[vt];U.startRing(H,zt[0]);let ct=zt.length>4&&kD(zt[zt.length-2],zt[0],zt[1]),qt=Se?bO(zt[zt.length-2],zt[0],zt[1],Se):0;const Lt=[];let Mt,In,_n;In=zt[1].sub(zt[0])._perp()._unit();let en=!0;for(let Ht=1,Jn=0;Ht<zt.length;Ht++){let bn=zt[Ht-1],cn=zt[Ht];const ar=zt[Ht===zt.length-1?1:Ht+1];if(U.appendEdge(H,cn,bn),$l(cn,bn,Ye)){Se&&(In=ar.sub(cn)._perp()._unit(),en=!en);continue}const fr=cn.sub(bn)._perp(),hr=fr.x/(Math.abs(fr.x)+Math.abs(fr.y)),yr=fr.y>0?1:0,Ar=bn.dist(cn);if(Jn+Ar>32768&&(Jn=0),Se){_n=ar.sub(cn)._perp()._unit();let lr=ID(bn,cn,ar,AD(In,_n),Se);isNaN(lr)&&(lr=0);const ri=cn.sub(bn)._unit();bn=bn.add(ri.mult(qt))._round(),cn=cn.add(ri.mult(-lr))._round(),qt=lr,In=_n,G&&this.zoom>=17&&(Ge(Lt,bn)||Lt.push(bn),Ge(Lt,cn)||Lt.push(cn))}const Cr=dt.vertexLength,bi=zt.length>4&&kD(bn,cn,ar);let wi=OD(Jn,ct,en);if(jh(this.layoutVertexArray,bn.x,bn.y,hr,yr,0,0,wi),jh(this.layoutVertexArray,bn.x,bn.y,hr,yr,0,1,wi),this.wallMode){const lr=ae(Ht-1,zt),ri=ue.joinNormals[Ht-1];Y1(this.wallVertexArray,ri,!lr,ue.isPolygon),Y1(this.wallVertexArray,ri,!lr,ue.isPolygon)}if(Jn+=Ar,wi=OD(Jn,bi,!en),ct=bi,jh(this.layoutVertexArray,cn.x,cn.y,hr,yr,0,0,wi),jh(this.layoutVertexArray,cn.x,cn.y,hr,yr,0,1,wi),this.wallMode){const lr=ae(Ht,zt),ri=ue.joinNormals[Ht];Y1(this.wallVertexArray,ri,!lr,ue.isPolygon),Y1(this.wallVertexArray,ri,!lr,ue.isPolygon)}if(dt.vertexLength+=4,this.indexArray.emplaceBack(Cr+0,Cr+1,Cr+2),this.indexArray.emplaceBack(Cr+1,Cr+3,Cr+2),dt.primitiveLength+=2,Se){const lr=ht+(1===Ht?zt.length-2:Ht-2),ri=1===Ht?ht:lr+1;if(this.indexArray.emplaceBack(Cr+1,lr,Cr+3),this.indexArray.emplaceBack(lr,ri,Cr+3),dt.primitiveLength+=2,void 0===Mt&&(Mt=Cr),!$l(ar,zt[Ht],Ye)){const oi=Ht===zt.length-1?Mt:dt.vertexLength;this.indexArray.emplaceBack(Cr+2,Cr+3,oi),this.indexArray.emplaceBack(Cr+3,oi+1,oi),this.indexArray.emplaceBack(Cr+3,ri,oi+1),dt.primitiveLength+=3}en=!en}if(R){const lr=this.layoutVertexExtArray,ri=k.projectTilePoint(bn.x,bn.y,d),oi=k.projectTilePoint(cn.x,cn.y,d),Vi=k.upVector(d,bn.x,bn.y),Ss=k.upVector(d,cn.x,cn.y);Vx(lr,ri,Vi),Vx(lr,ri,Vi),Vx(lr,oi,Ss),Vx(lr,oi,Ss)}}L&&(ht+=zt.length-1),G&&Se&&this.zoom>=17&&(0!==Lt.length&&Ge(Lt,Lt[0])&&Lt.pop(),this.groundEffect.addData(Lt,Ye,S,Se>0))}this.footprintSegments.push(ut),Nt.triangleCount=this.indexArray.length-Nt.triangleArrayOffset,this.polygonSegments.push(Nt),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,0!==H.vertexCount){if(H.centroidXY=U.borders?X1:this.encodeCentroid(U,H),this.centroidData.push(H),U.borders){this.featuresOnBorder.push(U);const tt=this.featuresOnBorder.length-1;for(let Ye=0;Ye<U.borders.length;Ye++)U.borders[Ye][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ye].push(tt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,m,_,d,T),this.groundEffect.addPaintPropertiesData(i,u,m,_,d,T),this.maxHeight=Math.max(this.maxHeight,Y)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((a,u)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[u].borders[i][0])}splitToSubtiles(){const i=[];for(let b=0;b<this.centroidData.length;b++){const T=this.centroidData[b],S=+(T.min.y+T.max.y>Ut),A=2*S+(+(T.min.x+T.max.x>Ut)^S);for(let k=0;k<T.polygonSegLen;k++){const R=T.polygonSegIdx+k;i.push({centroidIdx:b,subtile:A,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const a=new cs;i.sort((b,T)=>b.triangleSegmentIdx===T.triangleSegmentIdx?b.subtile-T.subtile:b.triangleSegmentIdx-T.triangleSegmentIdx);let u=0,d=0,m=0;for(const b of i){if(b.triangleSegmentIdx!==u)break;m++}const _=i.length;for(;d!==i.length;){u=i[d].triangleSegmentIdx;let b=0,T=d,S=d;for(let A=T;A<m&&i[A].subtile===b;A++)S++;for(;T!==m;){const A=i[T];b=A.subtile;const k=this.centroidData[A.centroidIdx].min.clone(),R=this.centroidData[A.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=T;U<S;U++){const H=i[U],G=this.polygonSegments[H.polygonSegmentIdx],Y=this.centroidData[H.centroidIdx].min,ue=this.centroidData[H.centroidIdx].max,ae=this.indexArray.uint16;for(let he=G.triangleArrayOffset;he<G.triangleArrayOffset+G.triangleCount;he++)a.emplaceBack(ae[3*he],ae[3*he+1],ae[3*he+2]);L.primitiveLength+=G.triangleCount,k.x=Math.min(k.x,Y.x),k.y=Math.min(k.y,Y.y),R.x=Math.max(R.x,ue.x),R.y=Math.max(R.y,ue.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:k,max:R}),T=S;for(let U=T;U<m&&i[U].subtile===i[T].subtile;U++)S++}d=m;for(let A=d;A<_&&i[A].triangleSegmentIdx===i[d].triangleSegmentIdx;A++)m++}a._trim(),this.indexArray=a}getVisibleSegments(i,a,u){const d=new us;if(this.wallMode){for(const H of this.triangleSubSegments)d.segments.push(H.segment);return d}let m=0,_=0;const b=1<<i.canonical.z;if(a){const H=a.getMinMaxForTile(i);H&&(m=H.min,_=H.max)}_+=this.maxHeight;const T=i.toUnwrapped();let S;const A=[T.canonical.x/b+T.wrap,T.canonical.y/b],k=[(T.canonical.x+1)/b+T.wrap,(T.canonical.y+1)/b],R=(H,G,Y)=>[H[0]*(1-Y[0])+G[0]*Y[0],H[1]*(1-Y[1])+G[1]*Y[1]],L=[],U=[];for(const H of this.triangleSubSegments){L[0]=H.min.x/Ut,L[1]=H.min.y/Ut,U[0]=H.max.x/Ut,U[1]=H.max.y/Ut;const G=R(A,k,L),Y=R(A,k,U);if(0===new Yi([G[0],G[1],m],[Y[0],Y[1],_]).intersectsPrecise(u)){S&&(d.segments.push(S),S=void 0);continue}const ue=H.segment;S&&S.vertexOffset!==ue.vertexOffset&&(d.segments.push(S),S=void 0),S?(S.vertexLength+=ue.vertexLength,S.primitiveLength+=ue.primitiveLength):S={vertexOffset:ue.vertexOffset,primitiveLength:ue.primitiveLength,vertexLength:ue.vertexLength,primitiveOffset:ue.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&d.segments.push(S),d}encodeCentroid(i,a){const u=i.centroid(),d=a.span(),m=Math.min(7,Math.round(d.x*this.tileToMeter/10)),_=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new $t(vr(u.x,1,Ut-1)<<3|m,vr(u.y,1,Ut-1)<<3|_)}encodeBorderCentroid(i){if(!i.borders)return new $t(0,0);const a=i.borders,u=Number.MAX_VALUE;if(a[0][0]!==u||a[1][0]!==u){const d=a[0][0]!==u?0:1;return new $t(6|(a[0][0]!==u?0:65528),(a[d][0]+a[d][1])/2<<3|6)}{const d=a[2][0]!==u?2:3;return new $t((a[d][0]+a[d][1])/2<<3|6,6|(a[2][0]!==u?0:65528))}}showCentroid(i){const a=this.centroidData[i.centroidDataIndex];a.flags&=Vh,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const a=i.vertexArrayOffset,u=i.vertexCount+i.vertexArrayOffset,d=i.flags&Vh?X1:i.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==d.y||m!==d.x){for(let _=a;_<u;++_)this.centroidVertexArray.emplace(_,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped());if(XT(this.activeReplacements,d))return;if(this.activeReplacements=d,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const m=[];for(const _ of this.activeReplacements){if(_.order<u)continue;const b=Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z);for(const T of this.centroidData)if(!(T.flags&Vh||_.min.x>T.max.x||T.min.x>_.max.x||_.min.y>T.max.y||T.min.y>_.max.y))for(let S=0;S<T.footprintSegLen;S++){const A=this.footprintSegments[T.footprintSegIdx+S];if(m.length=0,wO(this.footprintVertices,A.vertexOffset,A.vertexCount,_.footprintTileId.canonical,i.canonical,m),YT(_.footprint,m,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-b)){T.flags|=Vh;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,a,u){let d=!1;for(let m=0;m<u.footprintSegLen;m++){const _=this.footprintSegments[u.footprintSegIdx+m];let b=0;for(const T of _.ringIndices){for(let S=b,A=T+b-1;S<T+b;A=S++){const k=this.footprintVertices.int16[2*(S+_.vertexOffset)+0],R=this.footprintVertices.int16[2*(S+_.vertexOffset)+1],L=this.footprintVertices.int16[2*(A+_.vertexOffset)+1];R>a!=L>a&&i<(this.footprintVertices.int16[2*(A+_.vertexOffset)+0]-k)*(a-R)/(L-R)+k&&(d=!d)}b=T}}return d}getHeightAtTileCoord(i,a){let u=Number.NEGATIVE_INFINITY,d=!0;const m=4*(i+Ut)*Ut+(a+Ut);if(this.partLookup.hasOwnProperty(m)){const _=this.partLookup[m];return _?{height:_.height,hidden:!!(_.flags&Vh)}:void 0}for(const _ of this.centroidData)i>_.max.x||_.min.x>i||a>_.max.y||_.min.y>a||this.footprintContainsPoint(i,a,_)&&_&&_.height>u&&(u=_.height,this.partLookup[m]=_,d=!!(_.flags&Vh));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[m]=void 0}}function AD(o,i){const a=o.add(i)._unit();return o.x*a.x+o.y*a.y}function bO(o,i,a,u){const d=i.sub(o)._perp()._unit(),m=a.sub(i)._perp()._unit();return ID(o,i,a,AD(d,m),u)}function ID(o,i,a,u,d){const m=Math.sqrt(1-u*u);return Math.min(o.dist(i)/3,i.dist(a)/3,d*m/u)}function $l(o,i,a){return o.x<a[0].x&&i.x<a[0].x||o.x>a[1].x&&i.x>a[1].x||o.y<a[0].y&&i.y<a[0].y||o.y>a[1].y&&i.y>a[1].y}function Fu(o,i){return o.x<i[0].x||o.x>i[1].x||o.y<i[0].y||o.y>i[1].y}function kD(o,i,a){if(o.x<0||o.x>=Ut||i.x<0||i.x>=Ut||a.x<0||a.x>=Ut)return!1;const u=a.sub(i),d=u.perp(),m=o.sub(i);return(u.x*m.x+u.y*m.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(m.x*m.x+m.y*m.y))>-.866&&d.x*m.x+d.y*m.y<0}function OD(o,i,a){const u=i?2|o:-3&o;return a?1|u:-2&u}function RD(){const o=Math.PI/32,i=Math.tan(o),a=Hm;return a*Math.sqrt(1+2*i*i)-a}function PD(o,i,a){const u=1<<a.z,d=Vl(a.x/u),m=Vl((a.x+1)/u),_=fo(a.y/u),b=fo((a.y+1)/u);return function(T,S,A,k,R=0,L){const U=[];if(!T.length||!A||!k)return U;const H=(we,Se)=>{for(const Fe of we)U.push({polygon:Fe,bounds:Se})},G=Math.ceil(Math.log2(A)),Y=Math.ceil(Math.log2(k)),ue=G-Y,ae=[];for(let we=0;we<Math.abs(ue);we++)ae.push(ue>0?0:1);for(let we=0;we<Math.min(G,Y);we++)ae.push(0),ae.push(1);let he=T;if(he=P0(he,S[0].y-R,S[1].y+R,1),he=P0(he,S[0].x-R,S[1].x+R,0),!he.length)return U;const ve=[];for(ae.length?ve.push({polygons:he,bounds:S,depth:0}):H(he,S);ve.length;){const we=ve.pop(),Se=we.depth,Fe=ae[Se],Ge=we.bounds[0],tt=we.bounds[1],Ye=0===Fe?Ge.x:Ge.y,ht=0===Fe?tt.x:tt.y,Dt=L?L(Fe,Ye,ht):.5*(Ye+ht),dt=P0(we.polygons,Ye-R,Dt+R,Fe),Nt=P0(we.polygons,Dt-R,ht+R,Fe);if(dt.length){const ut=[Ge,new $t(0===Fe?Dt:tt.x,1===Fe?Dt:tt.y)];ae.length>Se+1?ve.push({polygons:dt,bounds:ut,depth:Se+1}):H(dt,ut)}if(Nt.length){const ut=[new $t(0===Fe?Dt:Ge.x,1===Fe?Dt:Ge.y),tt];ae.length>Se+1?ve.push({polygons:Nt,bounds:ut,depth:Se+1}):H(Nt,ut)}}return U}(o,i,Math.ceil((m-d)/11.25),Math.ceil((_-b)/11.25),1,(T,S,A)=>{if(0===T)return.5*(S+A);{const k=fo((a.y+S/Ut)/u);return(Fh(.5*(fo((a.y+A/Ut)/u)+k))*u-a.y)*Ut}})}function wO(o,i,a,u,d,m){const _=Math.pow(2,u.z-d.z);for(let b=0;b<a;b++){let T=o.int16[2*(b+i)+0],S=o.int16[2*(b+i)+1];T=(T+d.x*Ut)*_-u.x*Ut,S=(S+d.y*Ut)*_-u.y*Ut,m.push(new $t(T,S))}}let ND,rE;function J1(o,i){return o.x*i.x+o.y*i.y}function FD(o,i){if(1===o.length){let a=0;const u=i[a++];let d;for(;!d||u.equals(d);)if(d=i[a++],!d)return 1/0;for(;a<i.length;a++){const m=i[a],_=o[0],b=d.sub(u),T=m.sub(u),S=_.sub(u),A=J1(b,b),k=J1(b,T),R=J1(T,T),L=J1(S,b),U=J1(S,T),H=A*R-k*k,G=(R*L-k*U)/H,Y=(A*U-k*L)/H,ue=u.z*(1-G-Y)+d.z*G+m.z*Y;if(isFinite(ue))return ue}return 1/0}{let a=1/0;for(const u of i)a=Math.min(a,u.z);return a}}function LD(o,i,a,u,d,m,_,b){const T=_*d.getElevationAt(o,i,!0,!0),S=0!==m[0],A=S?0===m[1]?_*(m[0]/7-450):_*function(k,R,L){const U=Math.floor(R[0]/8),H=Math.floor(R[1]/8),G=10*(R[0]-8*U),Y=10*(R[1]-8*H),ue=k.getElevationAt(U,H,!0,!0),ae=k.getMeterToDEM(L),he=Math.floor(.5*(G*ae-1)),ve=Math.floor(.5*(Y*ae-1)),we=k.tileCoordToPixel(U,H),Se=2*he+1,Fe=2*ve+1,Ge=(zt=Se,ct=Fe,[(Nt=k).getElevationAtPixel(ut=we.x-he,vt=we.y-ve,!0),Nt.getElevationAtPixel(ut+ct,vt,!0),Nt.getElevationAtPixel(ut,vt+ct,!0),Nt.getElevationAtPixel(ut+zt,vt+ct,!0)]),tt=Math.abs(Ge[0]-Ge[1]),Ye=Math.abs(Ge[2]-Ge[3]),ht=Math.abs(Ge[0]-Ge[2])+Math.abs(Ge[1]-Ge[3]),Dt=Math.min(.25,.5*ae*(tt+Ye)/Se),dt=Math.min(.25,.5*ae*ht/Fe);var Nt,ut,vt,zt,ct;return ue+Math.max(Dt*G,dt*Y)}(d,m,b):T;return{base:T+(0===a)?-1:a,top:S?Math.max(A+u,T+a+2):T+u}}Pe($x,"FillExtrusionBucket",{omit:["layers","features"]}),Pe(jx,"PartData"),Pe(K1,"FootprintSegment"),Pe(tE,"BorderCentroidData"),Pe(MD,"GroundEffect");const TO=Hn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Hx}=TO,Yd=Hn([{name:"a_packed",components:4,type:"Float32"}]),{members:Q1}=Yd,BD=Hn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:zD}=BD,UD=Hn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lL=Hn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),cL=Hn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Hn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const EO=Hn([{name:"a_z_offset",components:1,type:"Float32"}],4),iE=Hn([{name:"a_texb",components:2,type:"Uint16"}]),sE=Hn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),uL=Hn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Hn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const CO=Hn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),VD=Hn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Hn([{name:"triangle",components:3,type:"Uint16"}]),Hn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Hn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Hn([{type:"Float32",name:"offsetX"}]),Hn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class jD{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new bp({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const u=this.getKey(i,a);return this.positions[u]}trim(){const i=this.width,a=this.height=dh(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,u){const d=[];let m=i.length%2==1?-i[i.length-1]*u:0,_=i[0]*u,b=!0;d.push({left:m,right:_,isDash:b,zeroLength:0===i[0]});let T=i[0];for(let S=1;S<i.length;S++){b=!b;const A=i[S];m=T*u,T+=A,_=T*u,d.push({left:m,right:_,isDash:b,zeroLength:0===A})}return d}addRoundDash(i,a,u){const d=a/2;for(let m=-u;m<=u;m++){const _=this.width*(this.nextRow+u+m);let b=0,T=i[b];for(let S=0;S<this.width;S++){S/T.right>1&&(T=i[++b]);const A=Math.abs(S-T.left),k=Math.abs(S-T.right),R=Math.min(A,k);let L;const U=m/u*(d+1);if(T.isDash){const H=d-Math.abs(U);L=Math.sqrt(R*R+H*H)}else L=d-Math.sqrt(R*R+U*U);this.image.data[_+S]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(i,a){for(let T=i.length-1;T>=0;--T){const S=i[T],A=i[T+1];S.zeroLength?i.splice(T,1):A&&A.isDash===S.isDash&&(A.left=S.left,i.splice(T,1))}const u=i[0],d=i[i.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const m=this.width*this.nextRow;let _=0,b=i[_];for(let T=0;T<this.width;T++){T/b.right>1&&(b=i[++_]);const S=Math.abs(T-b.left),A=Math.abs(T-b.right),k=Math.min(S,A);this.image.data[m+T]=Math.max(0,Math.min(255,(b.isDash?k:-k)+a+128))}}addDash(i,a){const u=this.getKey(i,a);if(this.positions[u])return this.positions[u];const d="round"===a,m=d?7:0,_=2*m+1;if(this.nextRow+_>this.height)return ks("LineAtlas out of space"),null;0===i.length&&i.push(1);let b=0;for(let A=0;A<i.length;A++)i[A]<0&&(ks("Negative value is found in line dasharray, replacing values with 0"),i[A]=0),b+=i[A];if(0!==b){const A=this.width/b,k=this.getDashRanges(i,this.width,A);d?this.addRoundDash(k,A,m):this.addRegularDash(k,"square"===a?.5*A:0)}const T=this.nextRow+m;this.nextRow+=_;const S={tl:[T,m],br:[b,0]};return this.positions[u]=S,S}}Pe(jD,"LineAtlas");const SO=Sp.types,DO=Math.cos(Math.PI/180*37.5),MO=Math.cos(Math.PI/180*5);class Gx{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new $d,this.layoutVertexArray2=new Io,this.patternVertexArray=new cp,this.indexArray=new cs,this.programConfigurations=new oc(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new us,this.maxLineLength=0,this.zOffsetVertexArray=new up,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Ut/64}updateFootprints(i,a){}populate(i,a,u,d){this.hasPattern=$T("line",this.layers,a);const m=this.layers[0].layout.get("line-sort-key"),_=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!_.isConstant()||!!_.constantOr(0);const b=[];for(const{feature:k,id:R,index:L,sourceLayerIndex:U}of i){const H=this.layers[0]._featureFilter.needGeometry,G=Lh(k,H);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),G,u))continue;const Y=m?m.evaluate(G,{},u):void 0,ue={id:R,properties:k.properties,type:k.type,sourceLayerIndex:U,index:L,geometry:H?G.geometry:su(k,u,d),patterns:{},sortKey:Y};b.push(ue)}m&&b.sort((k,R)=>k.sortKey-R.sortKey);const{lineAtlas:T,featureIndex:S}=a,A=this.addConstantDashes(T);for(const k of b){const{geometry:R,index:L,sourceLayerIndex:U}=k;if(A&&this.addFeatureDashes(k,T),this.hasPattern){const H=fD("line",this.layers,k,this.zoom,a);this.patternFeatures.push(H)}else this.addFeature(k,R,L,u,T.positions,a.availableImages,a.brightness);S.insert(i[L].feature,R,L,U,this.index)}}addConstantDashes(i){let a=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if("constant"!==d.kind||"constant"!==m.kind)a=!0;else{const _=m.value,b=d.value;if(!b)continue;i.addDash(b,_)}}return a}addFeatureDashes(i,a){const u=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let b,T;if("constant"===m.kind){if(b=m.value,!b)continue}else b=m.evaluate({zoom:u},i);T="constant"===_.kind?_.value:_.evaluate({zoom:u},i),a.addDash(b,T),i.patterns[d.id]=a.getKey(b,T)}}update(i,a,u,d,m){const _=0!==Object.keys(i).length;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(i,a,_?this.stateDependentLayers:this.layers,u,d,m)}addFeatures(i,a,u,d,m,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,u,d,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Q1)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,zD)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,EO.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Hx),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,u,d,m,_,b){const T=this.layers[0].layout,S=T.get("line-join").evaluate(i,{}),A=T.get("line-cap").evaluate(i,{}),k=T.get("line-miter-limit"),R=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const L of a)this.addLine(L,i,d,S,A,k,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,m,_,d,b)}addLine(i,a,u,d,m,_,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const T={zoom:this.zoom,lineProgress:void 0},S=this.layers[0].layout,A="none"===d;if(this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let we=0;we<i.length-1;we++)this.totalDistance+=i[we].dist(i[we+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k="Polygon"===SO[a.type];let R=i.length;for(;R>=2&&i[R-1].equals(i[R-2]);)R--;let L=0;for(;L<R-1&&i[L].equals(i[L+1]);)L++;if(R<(k?3:2))return;"bevel"===d&&(_=1.05);const U=this.overscaling<=16?15*Ut/(512*this.overscaling):0,H=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let G,Y,ue,ae,he,ve;this.e1=this.e2=-1,k&&(G=i[R-2],he=i[L].sub(G)._unit()._perp());for(let we=L;we<R;we++){if(ue=we===R-1?k?i[L+1]:void 0:i[we+1],ue&&i[we].equals(ue))continue;if(he&&(ae=he),G&&(Y=G),G=i[we],this.hasZOffset){const ut=S.get("line-z-offset").value;if("constant"===ut.kind)ve=ut.value;else{if(this.lineClips){const vt=this.totalDistance/(this.lineClips.end-this.lineClips.start);T.lineProgress=(vt*this.lineClips.start+this.distance+(Y?Y.dist(G):0))/vt}else ks(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),T.lineProgress=0;ve=ut.evaluate(T,a)}ve=ve||0}he=ue?ue.sub(G)._unit()._perp():ae,ae=ae||he;const Se=Y&&ue;let Fe=Se?d:k||A?"butt":m;const Ge=ae.x*he.x+ae.y*he.y;if(A){const ut=function(vt){if(vt.patternJoinNone){const zt=vt.segmentPoints.length/2,ct=vt.lineSoFar-vt.segmentStart;for(let qt=0;qt<zt;++qt){const Lt=vt.segmentPoints[2*qt+1],Mt=Math.round(vt.segmentPoints[2*qt])+.5+.25*Lt;vt.patternVertexArray.emplaceBack(Mt,ct,vt.segmentStart),vt.patternVertexArray.emplaceBack(Mt,ct,vt.segmentStart)}vt.segmentPoints.length=0}vt.e1=vt.e2=-1};if(Se&&Ge<MO){this.updateDistance(Y,G),this.addCurrentVertex(G,ae,1,1,H,ve),ut(this),this.addCurrentVertex(G,he,-1,-1,H,ve);continue}if(Y){if(!ue){this.updateDistance(Y,G),this.addCurrentVertex(G,ae,1,1,H,ve),ut(this);continue}Fe="miter"}}let tt=ae.add(he);0===tt.x&&0===tt.y||tt._unit();const Ye=tt.x*he.x+tt.y*he.y,ht=0!==Ye?1/Ye:1/0,Dt=2*Math.sqrt(2-2*Ye),dt=Ye<DO&&Y&&ue,Nt=ae.x*he.y-ae.y*he.x>0;if(dt&&we>L){const ut=G.dist(Y);if(ut>2*U){const vt=G.sub(G.sub(Y)._mult(U/ut)._round());this.updateDistance(Y,vt),this.addCurrentVertex(vt,ae,0,0,H,ve),Y=vt}}if(Se&&"round"===Fe&&(ht<b?Fe="miter":ht<=2&&(Fe="fakeround")),"miter"===Fe&&ht>_&&(Fe="bevel"),"bevel"===Fe&&(ht>2&&(Fe="flipbevel"),ht<_&&(Fe="miter")),Y&&this.updateDistance(Y,G),"miter"===Fe)tt._mult(ht),this.addCurrentVertex(G,tt,0,0,H,ve);else if("flipbevel"===Fe){if(ht>100)tt=he.mult(-1);else{const ut=ht*ae.add(he).mag()/ae.sub(he).mag();tt._perp()._mult(ut*(Nt?-1:1))}this.addCurrentVertex(G,tt,0,0,H,ve),this.addCurrentVertex(G,tt.mult(-1),0,0,H,ve)}else if("bevel"===Fe||"fakeround"===Fe){const ut=-Math.sqrt(ht*ht-1),vt=Nt?ut:0,zt=Nt?0:ut;if(Y&&this.addCurrentVertex(G,ae,vt,zt,H,ve),"fakeround"===Fe){const ct=Math.round(180*Dt/Math.PI/20);for(let qt=1;qt<ct;qt++){let Lt=qt/ct;if(.5!==Lt){const In=Lt-.5;Lt+=Lt*In*(Lt-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*In*In+(.848013+Ge*(.215638*Ge-1.06021)))}const Mt=he.sub(ae)._mult(Lt)._add(ae)._unit()._mult(Nt?-1:1);this.addHalfVertex(G,Mt.x,Mt.y,!1,Nt,0,H,ve)}}ue&&this.addCurrentVertex(G,he,-vt,-zt,H,ve)}else"butt"===Fe?this.addCurrentVertex(G,tt,0,0,H,ve):"square"===Fe?(Y||this.addCurrentVertex(G,tt,-1,-1,H,ve),this.addCurrentVertex(G,tt,0,0,H,ve),Y&&this.addCurrentVertex(G,tt,1,1,H,ve)):"round"===Fe&&(Y&&(this.addCurrentVertex(G,ae,0,0,H,ve),this.addCurrentVertex(G,ae,1,1,H,ve,!0)),ue&&(this.addCurrentVertex(G,he,-1,-1,H,ve,!0),this.addCurrentVertex(G,he,0,0,H,ve)));if(dt&&we<R-1){const ut=G.dist(ue);if(ut>2*U){const vt=G.add(ue.sub(G)._mult(U/ut)._round());this.updateDistance(G,vt),this.addCurrentVertex(vt,he,0,0,H,ve),G=vt}}}}addVerticesTo(i,a,u,d,m,_,b,T,S,A){const k=(a.w-i.w)/this.tessellationStep|0;if(k>1){this.lineSoFar=i.w;const R=(a.x-i.x)/k,L=(a.y-i.y)/k,U=(a.z-i.z)/k,H=(a.w-i.w)/k;for(let G=1;G<k;++G)i.x+=R,i.y+=L,i.z+=U,this.lineSoFar+=H,this.addHalfVertex(i,u,d,A,!1,b,S,i.z),this.addHalfVertex(i,m,_,A,!0,-T,S,i.z)}this.lineSoFar=a.w,this.addHalfVertex(a,u,d,A,!1,b,S,a.z),this.addHalfVertex(a,m,_,A,!0,-T,S,a.z)}addCurrentVertex(i,a,u,d,m,_,b=!1){const T=a.x+a.y*u,S=a.y-a.x*u,A=a.y*d-a.x,k=-a.y-a.x*d;if(null!=_){const L=Ut+10,U=_,H=new yO(i.x,i.y,U,this.lineSoFar),G=oE(i,-10,L),Y=this.lineSoFar;if(this.currentVertex)if(G){const ue=this.currentVertexIsOutside,ae=this.currentVertex,he=new yO(i.x,i.y,U,this.lineSoFar);_D(ae,he,-10,L),oE(he,-10,L)||(ue&&(this.e1=this.e2=-1,this.lineSoFar=ae.w,this.addHalfVertex(ae,T,S,b,!1,u,m,ae.z),this.addHalfVertex(ae,A,k,b,!0,-d,m,ae.z)),this.addVerticesTo(ae,he,T,S,A,k,u,d,m,b))}else{const ue=this.currentVertex;this.currentVertexIsOutside&&(_D(ue,H,-10,L),this.e1=this.e2=-1,this.lineSoFar=ue.w,this.addHalfVertex(ue,T,S,b,!1,u,m,ue.z),this.addHalfVertex(ue,A,k,b,!0,-d,m,ue.z)),this.addVerticesTo(ue,H,T,S,A,k,u,d,m,b)}else G||(this.addHalfVertex(i,T,S,b,!1,u,m,_),this.addHalfVertex(i,A,k,b,!0,-d,m,_));this.currentVertex=H,this.currentVertexIsOutside=G,this.lineSoFar=Y}else this.addHalfVertex(i,T,S,b,!1,u,m,_),this.addHalfVertex(i,A,k,b,!0,-d,m,_)}addHalfVertex({x:i,y:a},u,d,m,_,b,T,S){this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((i<<1)+(m?1:0),(a<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),T.primitiveLength++),_?this.e2=A:this.e1=A,null!=S&&this.zOffsetVertexArray.emplaceBack(S)}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,a){this.distance+=i.dist(a),this.updateScaledDistance()}}function oE(o,i,a){return o.x<i||o.x>a||o.y<i||o.y>a}let aE,$D;function HD(o,i,a){return i*(Ut/(o.tileSize*Math.pow(2,a-o.tileID.overscaledZ)))}function lE(o,i){return 1/HD(o,1,i.tileZoom)}function ey(o,i,a,u){return o.translatePosMatrix(u||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}Pe(Gx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const cE=o=>{const i=[];Wx(o)&&i.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const a=o.paint.get("line-trim-offset");0===a[0]&&0===a[1]||i.push("RENDER_LINE_TRIM_OFFSET"),0!==o.paint.get("line-border-width").constantOr(1)&&i.push("RENDER_LINE_BORDER");const u="none"===o.layout.get("line-join").constantOr("miter"),d=!!o.paint.get("line-pattern").constantOr(1);return u&&d&&i.push("LINE_JOIN_NONE"),i};function Wx(o){const i=o.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}class GD{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const u=i[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}var ou={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(o,i,a,u,d){var m,_,b=8*d-u-1,T=(1<<b)-1,S=T>>1,A=-7,k=a?d-1:0,R=a?-1:1,L=o[i+k];for(k+=R,m=L&(1<<-A)-1,L>>=-A,A+=b;A>0;m=256*m+o[i+k],k+=R,A-=8);for(_=m&(1<<-A)-1,m>>=-A,A+=u;A>0;_=256*_+o[i+k],k+=R,A-=8);if(0===m)m=1-S;else{if(m===T)return _?NaN:1/0*(L?-1:1);_+=Math.pow(2,u),m-=S}return(L?-1:1)*_*Math.pow(2,m-u)},write:function(o,i,a,u,d,m){var _,b,T,S=8*m-d-1,A=(1<<S)-1,k=A>>1,R=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,L=u?0:m-1,U=u?1:-1,H=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(b=isNaN(i)?1:0,_=A):(_=Math.floor(Math.log(i)/Math.LN2),i*(T=Math.pow(2,-_))<1&&(_--,T*=2),(i+=_+k>=1?R/T:R*Math.pow(2,1-k))*T>=2&&(_++,T/=2),_+k>=A?(b=0,_=A):_+k>=1?(b=(i*T-1)*Math.pow(2,d),_+=k):(b=i*Math.pow(2,k-1)*Math.pow(2,d),_=0));d>=8;o[a+L]=255&b,L+=U,b/=256,d-=8);for(_=_<<d|b,S+=d;S>0;o[a+L]=255&_,L+=U,_/=256,S-=8);o[a+L-U]|=128*H}},WD=Gi,qx=ou;function Gi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Gi.Varint=0,Gi.Fixed64=1,Gi.Bytes=2,Gi.Fixed32=5;var Kd=4294967296,qD=1/Kd,ZD=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Lu(o){return o.type===Gi.Bytes?o.readVarint()+o.pos:o.pos+1}function uE(o,i,a){var u=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(u);for(var d=a.pos-1;d>=o;d--)a.buf[d+u]=a.buf[d]}function hL(o,i){for(var a=0;a<o.length;a++)i.writeVarint(o[a])}function dL(o,i){for(var a=0;a<o.length;a++)i.writeSVarint(o[a])}function ty(o,i){for(var a=0;a<o.length;a++)i.writeFloat(o[a])}function AO(o,i){for(var a=0;a<o.length;a++)i.writeDouble(o[a])}function IO(o,i){for(var a=0;a<o.length;a++)i.writeBoolean(o[a])}function kO(o,i){for(var a=0;a<o.length;a++)i.writeFixed32(o[a])}function XD(o,i){for(var a=0;a<o.length;a++)i.writeSFixed32(o[a])}function OO(o,i){for(var a=0;a<o.length;a++)i.writeFixed64(o[a])}function RO(o,i){for(var a=0;a<o.length;a++)i.writeSFixed64(o[a])}function Zx(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function B0(o,i,a){o[a]=i,o[a+1]=i>>>8,o[a+2]=i>>>16,o[a+3]=i>>>24}function YD(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}Gi.prototype={destroy:function(){this.buf=null},readFields:function(o,i,a){for(a=a||this.length;this.pos<a;){var u=this.readVarint(),d=u>>3,m=this.pos;this.type=7&u,o(d,i,this),this.pos===m&&this.skip(u)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=Zx(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=YD(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Zx(this.buf,this.pos)+Zx(this.buf,this.pos+4)*Kd;return this.pos+=8,o},readSFixed64:function(){var o=Zx(this.buf,this.pos)+YD(this.buf,this.pos+4)*Kd;return this.pos+=8,o},readFloat:function(){var o=qx.read(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=qx.read(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,a,u=this.buf;return i=127&(a=u[this.pos++]),a<128?i:(i|=(127&(a=u[this.pos++]))<<7,a<128?i:(i|=(127&(a=u[this.pos++]))<<14,a<128?i:(i|=(127&(a=u[this.pos++]))<<21,a<128?i:function(d,m,_){var b,T,S=_.buf;if(b=(112&(T=S[_.pos++]))>>4,T<128||(b|=(127&(T=S[_.pos++]))<<3,T<128)||(b|=(127&(T=S[_.pos++]))<<10,T<128)||(b|=(127&(T=S[_.pos++]))<<17,T<128)||(b|=(127&(T=S[_.pos++]))<<24,T<128)||(b|=(1&(T=S[_.pos++]))<<31,T<128))return function L0(o,i,a){return a?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}(d,b,m);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(a=u[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&ZD?ZD.decode(this.buf.subarray(i,o)):function(a,u,d){for(var m="",_=u;_<d;){var b,T,S,A=a[_],k=null,R=A>239?4:A>223?3:A>191?2:1;if(_+R>d)break;1===R?A<128&&(k=A):2===R?128==(192&(b=a[_+1]))&&(k=(31&A)<<6|63&b)<=127&&(k=null):3===R?(T=a[_+2],128==(192&(b=a[_+1]))&&128==(192&T)&&((k=(15&A)<<12|(63&b)<<6|63&T)<=2047||k>=55296&&k<=57343)&&(k=null)):4===R&&(T=a[_+2],S=a[_+3],128==(192&(b=a[_+1]))&&128==(192&T)&&128==(192&S)&&((k=(15&A)<<18|(63&b)<<12|(63&T)<<6|63&S)<=65535||k>=1114112)&&(k=null)),null===k?(k=65533,R=1):k>65535&&(k-=65536,m+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),m+=String.fromCharCode(k),_+=R}return m}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==Gi.Bytes)return o.push(this.readVarint(i));var a=Lu(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==Gi.Bytes)return o.push(this.readSVarint());var i=Lu(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Gi.Bytes)return o.push(this.readBoolean());var i=Lu(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Gi.Bytes)return o.push(this.readFloat());var i=Lu(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Gi.Bytes)return o.push(this.readDouble());var i=Lu(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Gi.Bytes)return o.push(this.readFixed32());var i=Lu(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Gi.Bytes)return o.push(this.readSFixed32());var i=Lu(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Gi.Bytes)return o.push(this.readFixed64());var i=Lu(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Gi.Bytes)return o.push(this.readSFixed64());var i=Lu(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===Gi.Varint)for(;this.buf[this.pos++]>127;);else if(i===Gi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Gi.Fixed32)this.pos+=4;else{if(i!==Gi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),B0(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),B0(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),B0(this.buf,-1&o,this.pos),B0(this.buf,Math.floor(o*qD),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),B0(this.buf,-1&o,this.pos),B0(this.buf,Math.floor(o*qD),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,a){var u,d,m,b;if(i>=0?(u=i%4294967296|0,d=i/4294967296|0):(d=~(-i/4294967296),4294967295^(u=~(-i%4294967296))?u=u+1|0:(u=0,d=d+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),m=u,(b=a).buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7),function(m,_){var b=(7&m)<<4;_.buf[_.pos++]|=b|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(d,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(u,d,m){for(var _,b,T=0;T<d.length;T++){if((_=d.charCodeAt(T))>55295&&_<57344){if(!b){_>56319||T+1===d.length?(u[m++]=239,u[m++]=191,u[m++]=189):b=_;continue}if(_<56320){u[m++]=239,u[m++]=191,u[m++]=189,b=_;continue}_=b-55296<<10|_-56320|65536,b=null}else b&&(u[m++]=239,u[m++]=191,u[m++]=189,b=null);_<128?u[m++]=_:(_<2048?u[m++]=_>>6|192:(_<65536?u[m++]=_>>12|224:(u[m++]=_>>18|240,u[m++]=_>>12&63|128),u[m++]=_>>6&63|128),u[m++]=63&_|128)}return m}(this.buf,o,this.pos);var a=this.pos-i;a>=128&&uE(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),qx.write(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),qx.write(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var a=0;a<i;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,i){this.pos++;var a=this.pos;o(i,this);var u=this.pos-a;u>=128&&uE(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeMessage:function(o,i,a){this.writeTag(o,Gi.Bytes),this.writeRawMessage(i,a)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,hL,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,dL,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,IO,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,ty,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,AO,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,kO,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,XD,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,OO,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,RO,i)},writeBytesField:function(o,i){this.writeTag(o,Gi.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,Gi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,Gi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,Gi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,Gi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,Gi.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,Gi.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,Gi.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,Gi.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,Gi.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var ny=Uo(WD);const hE=["id","tile","layer","source","sourceLayer","state"];class PO{constructor(i,a,u,d,m){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=u,this._y=d,this.properties=i.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of hE)void 0!==this[a]&&(i[a]=this[a]);return i}}class fL{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,u){const d=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][d]=this.stateChanges[i][d]||{},$o(this.stateChanges[i][d],u),null===this.deletedStates[i]){this.deletedStates[i]={};for(const m in this.state[i])m!==d&&(this.deletedStates[i][m]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][d]){this.deletedStates[i][d]={};for(const m in this.state[i][d])u[m]||(this.deletedStates[i][d][m]=null)}else for(const m in u)this.deletedStates[i]&&this.deletedStates[i][d]&&null===this.deletedStates[i][d][m]&&delete this.deletedStates[i][d][m]}removeFeatureState(i,a,u){if(null===this.deletedStates[i])return;const d=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&void 0!==a)null!==this.deletedStates[i][d]&&(this.deletedStates[i][d]=this.deletedStates[i][d]||{},this.deletedStates[i][d][u]=null);else if(void 0!==a)if(this.stateChanges[i]&&this.stateChanges[i][d])for(u in this.deletedStates[i][d]={},this.stateChanges[i][d])this.deletedStates[i][d][u]=null;else this.deletedStates[i][d]=null;else this.deletedStates[i]=null}getState(i,a){const u=String(a),d=$o({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const m=this.deletedStates[i][a];if(null===m)return{};for(const _ in m)delete d[_]}return d}initializeTileState(i,a){i.setFeatureState(this.state,a)}coalesceChanges(i,a){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),$o(this.state[d][_],this.stateChanges[d][_]),m[_]=this.state[d][_];u[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(null===this.deletedStates[d])for(const _ in this.state[d])m[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(null===this.deletedStates[d][_])this.state[d][_]={};else if(this.state[d][_])for(const b of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][b];m[_]=this.state[d][_]}u[d]=u[d]||{},$o(u[d],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const d in i)i[d].setFeatureState(u,a)}}class Xx{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Je(Ut,16,0),this.featureIndexArray=new y0,this.promoteId=a,this.is3DTile=!1}insert(i,a,u,d,m,_=0,b=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,m,_);const S=this.grid;for(let A=0;A<a.length;A++){const k=a[A],R=[1/0,1/0,-1/0,-1/0];for(let L=0;L<k.length;L++){const U=k[L];R[0]=Math.min(R[0],U.x),R[1]=Math.min(R[1],U.y),R[2]=Math.max(R[2],U.x),R[3]=Math.max(R[3],U.y)}0!==b&&(R[0]-=b,R[1]-=b,R[2]+=b,R[3]+=b),R[0]<Ut&&R[1]<Ut&&R[2]>=0&&R[3]>=0&&S.insert(T,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new R0(new ny(this.rawTileData)).layers,this.sourceLayerCoder=new GD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a,u,d){this.loadVTLayers();const m=i.params||{},_=tu(m.filter),b=i.tileResult,T=i.transform,S=b.bufferedTilespaceBounds,A=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(U,H,G,Y)=>$S(b.bufferedTilespaceGeometry,U,H,G,Y));A.sort(pL);let k=null;T.elevation&&A.length>0&&(k=Xd.create(T.elevation,this.tileID));const R={};let L;for(let U=0;U<A.length;U++){const H=A[U];if(H===L)continue;L=H;const G=this.featureIndexArray.get(H);let Y=null;if(this.is3DTile){const ue=this.bucketLayerIDs[0][0],ae=a[ue];if("model"!==ae.type)continue;const{queryFeature:he,intersectionZ:ve}=ae.queryIntersectsMatchingFeature(b,G.featureIndex,_,T);he&&this.appendToResult(R,ue,G.featureIndex,he,ve)}else this.loadMatchingFeature(R,G,_,m.layers,m.availableImages,a,u,d,(ue,ae,he,ve=0)=>(Y||(Y=su(ue,this.tileID.canonical,i.tileTransform)),ae.queryIntersectsFeature(b,ue,he,Y,this.z,i.transform,i.pixelPosMatrix,k,ve)))}return R}loadMatchingFeature(i,a,u,d,m,_,b,T,S){const{featureIndex:A,bucketIndex:k,sourceLayerIndex:R,layoutVertexArrayOffset:L}=a,U=this.bucketLayerIDs[k];if(d&&!function(ue,ae){for(let he=0;he<ue.length;he++)if(ae.indexOf(ue[he])>=0)return!0;return!1}(d,U))return;const H=this.sourceLayerCoder.decode(R),G=this.vtLayers[H].feature(A);if(u.needGeometry){const ue=Lh(G,!0);if(!u.filter(new tr(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!u.filter(new tr(this.tileID.overscaledZ),G))return;const Y=this.getId(G,H);for(let ue=0;ue<U.length;ue++){const ae=U[ue];if(d&&d.indexOf(ae)<0)continue;const he=_[ae];if(!he)continue;let ve={};void 0!==Y&&T&&(ve=T.getState(he.sourceLayer||"_geojsonTileLayer",Y));const we=!S||S(G,he,ve,L);if(!we)continue;const Se=new PO(G,this.z,this.x,this.y,Y),Fe=$o({},b[ae]);Fe.paint=NO(Fe.paint,he.paint,G,ve,m),Fe.layout=NO(Fe.layout,he.layout,G,ve,m),Se.layer=Fe,this.appendToResult(i,ae,A,Se,we)}}appendToResult(i,a,u,d,m){let _=i[a];void 0===_&&(_=i[a]=[]),_.push({featureIndex:u,feature:d,intersectionZ:m})}lookupSymbolFeatures(i,a,u,d,m,_,b,T){const S={};this.loadVTLayers();const A=tu(m);for(const k of i)this.loadMatchingFeature(S,{bucketIndex:u,sourceLayerIndex:d,featureIndex:k,layoutVertexArrayOffset:0},A,_,b,T,a);return S}loadFeature(i){const{featureIndex:a,sourceLayerIndex:u}=i;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),m=this.vtFeatures[d];if(m[a])return m[a];const _=this.vtLayers[d].feature(a);return m[a]=_,_}hasLayer(i){for(const a of this.bucketLayerIDs)for(const u of a)if(i===u)return!0;return!1}getId(i,a){let u=i.id;if(this.promoteId){const d="string"==typeof this.promoteId?this.promoteId:this.promoteId[a];null!=d&&(u=i.properties[d]),"boolean"==typeof u&&(u=Number(u))}return u}}function NO(o,i,a,u,d){return Wg(o,(m,_)=>{const b=i instanceof Yo?i.get(_):null;return b&&b.evaluate?b.evaluate(a,u,d):b})}function pL(o,i){return i-o}Pe(Xx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var ma=24;const $h=128;function KD(o,i){const{expression:a}=i;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new tr(o+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:d}=a;let m=0;for(;m<u.length&&u[m]<=o;)m++;m=Math.max(0,m-1);let _=m;for(;_<u.length&&u[_]<o+1;)_++;_=Math.min(u.length-1,_);const b=u[m],T=u[_];return"composite"===a.kind?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:T,minSize:a.evaluate(new tr(b)),maxSize:a.evaluate(new tr(T)),interpolationType:d}}}function Yx(o,{uSize:i,uSizeT:a},{lowerSize:u,upperSize:d}){return"source"===o.kind?u/$h:"composite"===o.kind?Fn(u/$h,d/$h,a):i}function Jd(o,i){let a=0,u=0;if("constant"===o.kind)u=o.layoutSize;else if("source"!==o.kind){const{interpolationType:d,minZoom:m,maxZoom:_}=o,b=d?vr(ic.interpolationFactor(d,i,m,_),0,1):0;"camera"===o.kind?u=Fn(o.minSize,o.maxSize,b):a=b}return{uSizeT:a,uSize:u}}var Kx=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:$h,evaluateSizeForFeature:Yx,evaluateSizeForZoom:Jd,getSizeData:KD});function JD(o,i,a){return o.sections.forEach(u=>{u.text=function(d,m,_){const b=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===b?d=d.toLocaleUpperCase():"lowercase"===b&&(d=d.toLocaleLowerCase()),Sr.applyArabicShaping&&(d=Sr.applyArabicShaping(d)),d}(u.text,i,a)}),o}const z0={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function QD(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function FO(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}const dE=3;function eM(o,i,a){i.glyphs=[],1===o&&a.readMessage(U0,i)}function U0(o,i,a){if(3===o){const{id:u,bitmap:d,width:m,height:_,left:b,top:T,advance:S}=a.readMessage(Rc,{});i.glyphs.push({id:u,bitmap:new bp({width:m+2*dE,height:_+2*dE},d),metrics:{width:m,height:_,left:b,top:T,advance:S}})}else 4===o?i.ascender=a.readSVarint():5===o&&(i.descender=a.readSVarint())}function Rc(o,i,a){1===o?i.id=a.readVarint():2===o?i.bitmap=a.readBytes():3===o?i.width=a.readVarint():4===o?i.height=a.readVarint():5===o?i.left=a.readSVarint():6===o?i.top=a.readSVarint():7===o&&(i.advance=a.readVarint())}const Hl=dE,cc={horizontal:1,vertical:2,horizontalOnly:3};class Jx{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,a){const u=new Jx;return u.scale=i||1,u.fontStack=a,u}static forImage(i){const a=new Jx;return a.imageName=i,a}}class V0{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a){const u=new V0;for(let d=0;d<i.sections.length;d++){const m=i.sections[d];m.image?u.addImageSection(m):u.addTextSection(m,a)}return u}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(a,u){let d="";for(let m=0;m<a.length;m++){const _=a.charCodeAt(m+1)||null,b=a.charCodeAt(m-1)||null;d+=!u&&(_&&bt(_)&&!z0[a[m+1]]||b&&bt(b)&&!z0[a[m-1]])||!z0[a[m]]?a[m]:z0[a[m]]}return d}(this.text,i)}trim(){let i=0;for(let u=0;u<this.text.length&&fE[this.text.charCodeAt(u)];u++)i++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&fE[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const u=new V0;return u.text=this.text.substring(i,a),u.sectionIndex=this.sectionIndex.slice(i,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(Jx.forText(i.scale,i.fontStack||a));const u=this.sections.length-1;for(let d=0;d<i.text.length;++d)this.sectionIndex.push(u)}addImageSection(i){const a=i.image?i.image.namePrimary:"";if(0===a.length)return void ks("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(Jx.forImage(a)),this.sectionIndex.push(this.sections.length-1)):ks("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function tM(o,i,a,u,d,m,_,b,T,S,A,k,R,L,U){const H=V0.fromFeature(o,d);k===cc.vertical&&H.verticalizePunctuation(R);let G=[];const Y=function(we,Se,Fe,Ge,tt,Ye){if(!we)return[];const ht=[],Dt=function(vt,zt,ct,qt,Lt,Mt){let In=0;for(let _n=0;_n<vt.length();_n++){const en=vt.getSection(_n);In+=pE(vt.getCodePoint(_n),en,qt,Lt,zt,Mt)}return In/Math.max(1,Math.ceil(In/ct))}(we,Se,Fe,Ge,tt,Ye),dt=we.text.indexOf("\u200b")>=0;let Nt=0;for(let vt=0;vt<we.length();vt++){const zt=we.getSection(vt),ct=we.getCodePoint(vt);if(fE[ct]||(Nt+=pE(ct,zt,Ge,tt,Se,Ye)),vt<we.length()-1){const qt=!((ut=ct)<11904||!(Oe["Bopomofo Extended"](ut)||Oe.Bopomofo(ut)||Oe["CJK Compatibility Forms"](ut)||Oe["CJK Compatibility Ideographs"](ut)||Oe["CJK Compatibility"](ut)||Oe["CJK Radicals Supplement"](ut)||Oe["CJK Strokes"](ut)||Oe["CJK Symbols and Punctuation"](ut)||Oe["CJK Unified Ideographs Extension A"](ut)||Oe["CJK Unified Ideographs"](ut)||Oe["Enclosed CJK Letters and Months"](ut)||Oe["Halfwidth and Fullwidth Forms"](ut)||Oe.Hiragana(ut)||Oe["Ideographic Description Characters"](ut)||Oe["Kangxi Radicals"](ut)||Oe["Katakana Phonetic Extensions"](ut)||Oe.Katakana(ut)||Oe["Vertical Forms"](ut)||Oe["Yi Radicals"](ut)||Oe["Yi Syllables"](ut)));(nM[ct]||qt||zt.imageName)&&ht.push(Qx(vt+1,Nt,Dt,ht,Dp(ct,we.getCodePoint(vt+1),qt&&dt),!1))}}var ut;return eb(Qx(we.length(),Nt,Dt,ht,0,!0))}(H,S,m,i,u,L),{processBidirectionalText:ue,processStyledBidirectionalText:ae}=Sr;if(ue&&1===H.sections.length){const we=ue(H.toString(),Y);for(const Se of we){const Fe=new V0;Fe.text=Se,Fe.sections=H.sections;for(let Ge=0;Ge<Se.length;Ge++)Fe.sectionIndex.push(0);G.push(Fe)}}else if(ae){const we=ae(H.text,H.sectionIndex,Y);for(const Se of we){const Fe=new V0;Fe.text=Se[0],Fe.sectionIndex=Se[1],Fe.sections=H.sections,G.push(Fe)}}else G=function(we,Se){const Fe=[],Ge=we.text;let tt=0;for(const Ye of Se)Fe.push(we.substring(tt,Ye)),tt=Ye;return tt<Ge.length&&Fe.push(we.substring(tt,Ge.length)),Fe}(H,Y);const he=[],ve={positionedLines:he,text:H.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(we,Se,Fe,Ge,tt,Ye,ht,Dt,dt,Nt,ut,vt){let zt=0,ct=0,qt=0;const Lt="right"===Dt?1:"left"===Dt?0:.5;let Mt=!1;for(const bn of tt){const cn=bn.getSections();for(const ar of cn){if(ar.imageName)continue;const fr=Se[ar.fontStack];if(fr&&(Mt=void 0!==fr.ascender&&void 0!==fr.descender,!Mt))break}if(!Mt)break}let In=0;for(const bn of tt){bn.trim();const cn=bn.getMaxScale(),ar=(cn-1)*ma,fr={positionedGlyphs:[],lineOffset:0};we.positionedLines[In]=fr;const hr=fr.positionedGlyphs;let yr=0;if(!bn.length()){ct+=Ye,++In;continue}let Ar=0,Cr=0;for(let wi=0;wi<bn.length();wi++){const lr=bn.getSection(wi),ri=bn.getSectionIndex(wi),oi=bn.getCodePoint(wi);let Vi=lr.scale,Ss=null,Ns=null,hs=null,es=ma,po=0;const js=!(dt===cc.horizontal||!ut&&!Vt(oi)||ut&&(fE[oi]||(_n=oi,Oe.Arabic(_n)||Oe["Arabic Supplement"](_n)||Oe["Arabic Extended-A"](_n)||Oe["Arabic Presentation Forms-A"](_n)||Oe["Arabic Presentation Forms-B"](_n))));if(lr.imageName){const Ro=Ge[lr.imageName];if(!Ro)continue;hs=lr.imageName,we.iconsInText=we.iconsInText||!0,Ns=Ro.paddedRect;const Fi=Ro.displaySize;Vi=Vi*ma/vt,Ss={width:Fi[0],height:Fi[1],left:0,top:-Hl,advance:js?Fi[1]:Fi[0],localGlyph:!1},po=Mt?-Ss.height*Vi:cn*ma-17-Fi[1]*Vi,es=Ss.advance;const hl=(js?Fi[0]:Fi[1])*Vi-ma*cn;hl>0&&hl>yr&&(yr=hl)}else{const Ro=Fe[lr.fontStack];if(!Ro)continue;Ro[oi]&&(Ns=Ro[oi]);const Fi=Se[lr.fontStack];if(!Fi)continue;const hl=Fi.glyphs[oi];if(!hl)continue;if(Ss=hl.metrics,es=8203!==oi?ma:0,Mt){const $u=void 0!==Fi.ascender?Math.abs(Fi.ascender):0,uc=void 0!==Fi.descender?Math.abs(Fi.descender):0,Nc=($u+uc)*Vi;Ar<Nc&&(Ar=Nc,Cr=($u-uc)/2*Vi),po=-$u*Vi}else po=(cn-Vi)*ma-17}js?(we.verticalizable=!0,hr.push({glyph:oi,imageName:hs,x:zt,y:ct+po,vertical:js,scale:Vi,localGlyph:Ss.localGlyph,fontStack:lr.fontStack,sectionIndex:ri,metrics:Ss,rect:Ns}),zt+=es*Vi+Nt):(hr.push({glyph:oi,imageName:hs,x:zt,y:ct+po,vertical:js,scale:Vi,localGlyph:Ss.localGlyph,fontStack:lr.fontStack,sectionIndex:ri,metrics:Ss,rect:Ns}),zt+=Ss.advance*Vi+Nt)}0!==hr.length&&(qt=Math.max(zt-Nt,qt),Mt?Xm(hr,Lt,yr,Cr,Ye*cn/2):Xm(hr,Lt,yr,0,Ye/2)),zt=0;const bi=Ye*cn+yr;fr.lineOffset=Math.max(yr,ar),ct+=bi,++In}var _n;const en=ct,{horizontalAlign:Ht,verticalAlign:Jn}=mE(ht);(function(bn,cn,ar,fr,hr,yr){const Ar=(cn-ar)*hr,Cr=-yr*fr;for(const bi of bn)for(const wi of bi.positionedGlyphs)wi.x+=Ar,wi.y+=Cr})(we.positionedLines,Lt,Ht,Jn,qt,en),we.top+=-Jn*en,we.bottom=we.top+en,we.left+=-Ht*qt,we.right=we.left+qt,we.hasBaseline=Mt}(ve,i,a,u,G,_,b,T,k,S,R,U),!function(we){for(const Se of we)if(0!==Se.positionedGlyphs.length)return!1;return!0}(he)&&ve}const fE={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pE(o,i,a,u,d,m){if(i.imageName){const _=u[i.imageName];return _?_.displaySize[0]*i.scale*ma/m+d:0}{const _=a[i.fontStack],b=_&&_.glyphs[o];return b?b.metrics.advance*i.scale+d:0}}function LO(o,i,a,u){const d=Math.pow(o-i,2);return u?o<i?d/2:2*d:d+Math.abs(a)*a}function Dp(o,i,a){let u=0;return 10===o&&(u-=1e4),a&&(u+=150),40!==o&&65288!==o||(u+=50),41!==i&&65289!==i||(u+=50),u}function Qx(o,i,a,u,d,m){let _=null,b=LO(i,a,d,m);for(const T of u){const S=LO(i-T.x,a,d,m)+T.badness;S<=b&&(_=T,b=S)}return{index:o,x:i,priorBreak:_,badness:b}}function eb(o){return o?eb(o.priorBreak).concat(o.index):[]}function mE(o){let i=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function Xm(o,i,a,u,d){if(!(i||a||u||d))return;const m=o.length-1,_=o[m],b=(_.x+_.metrics.advance*_.scale)*i;for(let T=0;T<=m;T++)o[T].x-=b,o[T].y+=a+u+d}function gE(o,i,a,u){const{horizontalAlign:d,verticalAlign:m}=mE(u),_=a[0]-o.displaySize[0]*d,b=a[1]-o.displaySize[1]*m;return{imagePrimary:o,imageSecondary:i,top:b,bottom:b+o.displaySize[1],left:_,right:_+o.displaySize[0]}}function _E(o,i,a,u,d,m){const _=o.imagePrimary;let b;if(_.content){const G=_.content,Y=_.pixelRatio||1;b=[G[0]/Y,G[1]/Y,_.displaySize[0]-G[2]/Y,_.displaySize[1]-G[3]/Y]}const T=i.left*m,S=i.right*m;let A,k,R,L;"width"===a||"both"===a?(L=d[0]+T-u[3],k=d[0]+S+u[1]):(L=d[0]+(T+S-_.displaySize[0])/2,k=L+_.displaySize[0]);const U=i.top*m,H=i.bottom*m;return"height"===a||"both"===a?(A=d[1]+U-u[0],R=d[1]+H+u[2]):(A=d[1]+(U+H-_.displaySize[1])/2,R=A+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:A,right:k,bottom:R,left:L,collisionPadding:b}}class Bu extends $t{constructor(i,a,u,d,m){super(i,a),this.angle=d,this.z=u,void 0!==m&&(this.segment=m)}clone(){return new Bu(this.x,this.y,this.z,this.angle,this.segment)}}function ry(o,i,a,u,d){if(void 0===i.segment)return!0;let m=i,_=i.segment+1,b=0;for(;b>-a/2;){if(_--,_<0)return!1;b-=o[_].dist(m),m=o[_]}b+=o[_].dist(o[_+1]),_++;const T=[];let S=0;for(;b<a/2;){const A=o[_],k=o[_+1];if(!k)return!1;let R=o[_-1].angleTo(A)-A.angleTo(k);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:R}),S+=R;b-T[0].distance>u;)S-=T.shift().angleDelta;if(S>d)return!1;_++,b+=A.dist(k)}return!0}function rM(o){let i=0;for(let a=0;a<o.length-1;a++)i+=o[a].dist(o[a+1]);return i}function iM(o,i,a){return o?.6*i*a:0}function yE(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function BO(o,i,a,u,d,m){const _=iM(a,d,m),b=yE(a,u)*m;let T=0;const S=rM(o)/2;for(let A=0;A<o.length-1;A++){const k=o[A],R=o[A+1],L=k.dist(R);if(T+L>S){const U=(S-T)/L,H=Fn(k.x,R.x,U),G=Fn(k.y,R.y,U),Y=new Bu(H,G,0,R.angleTo(k),A);return!_||ry(o,Y,b,_,i)?Y:void 0}T+=L}}function zO(o,i,a,u,d,m,_,b,T){const S=iM(u,m,_),A=yE(u,d),k=A*_,R=0===o[0].x||o[0].x===T||0===o[0].y||o[0].y===T;return i-k<i/4&&(i=k+i/4),vE(o,R?i/2*b%i:(A/2+2*m)*_*b%i,i,S,a,k,R,!1,T)}function vE(o,i,a,u,d,m,_,b,T){const S=m/2,A=rM(o);let k=0,R=i-a,L=[];for(let U=0;U<o.length-1;U++){const H=o[U],G=o[U+1],Y=H.dist(G),ue=G.angleTo(H);for(;R+a<k+Y;){R+=a;const ae=(R-k)/Y,he=Fn(H.x,G.x,ae),ve=Fn(H.y,G.y,ae);if(he>=0&&he<T&&ve>=0&&ve<T&&R-S>=0&&R+S<=A){const we=new Bu(he,ve,0,ue,U);u&&!ry(o,we,m,u,d)||L.push(we)}}k+=Y}return b||L.length||_||(L=vE(o,k/2,a,u,d,m,_,!0,T)),L}function tb(o,i,a,u,d){const m=[];for(let _=0;_<o.length;_++){const b=o[_];let T;for(let S=0;S<b.length-1;S++){let A=b[S],k=b[S+1];A.x<i&&k.x<i||(A.x<i?A=new $t(i,A.y+(i-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<i&&(k=new $t(i,A.y+(i-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<a&&k.y<a||(A.y<a?A=new $t(A.x+(a-A.y)/(k.y-A.y)*(k.x-A.x),a)._round():k.y<a&&(k=new $t(A.x+(a-A.y)/(k.y-A.y)*(k.x-A.x),a)._round()),A.x>=u&&k.x>=u||(A.x>=u?A=new $t(u,A.y+(u-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=u&&(k=new $t(u,A.y+(u-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=d&&k.y>=d||(A.y>=d?A=new $t(A.x+(d-A.y)/(k.y-A.y)*(k.x-A.x),d)._round():k.y>=d&&(k=new $t(A.x+(d-A.y)/(k.y-A.y)*(k.x-A.x),d)._round()),T&&A.equals(T[T.length-1])||(T=[A],m.push(T)),T.push(k)))))}}return m}function j0(o){let i=0,a=0;for(const _ of o)i+=_.w*_.h,a=Math.max(a,_.w);o.sort((_,b)=>b.h-_.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let d=0,m=0;for(const _ of o)for(let b=u.length-1;b>=0;b--){const T=u[b];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,m=Math.max(m,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===T.w&&_.h===T.h){const S=u.pop();b<u.length&&(u[b]=S)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(u.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:d,h:m,fill:i/(d*m)||0}}Pe(Bu,"Anchor");const $a=1;class iy{constructor(i,{pixelRatio:a,version:u,stretchX:d,stretchY:m,content:_}){this.paddedRect=i,this.pixelRatio=a,this.stretchX=d,this.stretchY=m,this.content=_,this.version=u}get tl(){return[this.paddedRect.x+$a,this.paddedRect.y+$a]}get br(){return[this.paddedRect.x+this.paddedRect.w-$a,this.paddedRect.y+this.paddedRect.h-$a]}get displaySize(){return[(this.paddedRect.w-2*$a)/this.pixelRatio,(this.paddedRect.h-2*$a)/this.pixelRatio]}}class sM{constructor(i,a,u){const d={},m={};this.haveRenderCallbacks=[];const _=[];this.addImages(i,d,_),this.addImages(a,m,_);const{w:b,h:T}=j0(_),S=new Ps({width:b||1,height:T||1});for(const A in i){const k=i[A],R=d[A].paddedRect;Ps.copy(k.data,S,{x:0,y:0},{x:R.x+$a,y:R.y+$a},k.data,u,k.sdf)}for(const A in a){const k=a[A],R=m[A].paddedRect,L=R.x+$a,U=R.y+$a,H=k.data.width,G=k.data.height;Ps.copy(k.data,S,{x:0,y:0},{x:L,y:U},k.data,u),Ps.copy(k.data,S,{x:0,y:G-1},{x:L,y:U-1},{width:H,height:1},u),Ps.copy(k.data,S,{x:0,y:0},{x:L,y:U+G},{width:H,height:1},u),Ps.copy(k.data,S,{x:H-1,y:0},{x:L-1,y:U},{width:1,height:G},u),Ps.copy(k.data,S,{x:0,y:0},{x:L+H,y:U},{width:1,height:G},u)}this.image=S,this.iconPositions=d,this.patternPositions=m}addImages(i,a,u){for(const d in i){const m=i[d],_={x:0,y:0,w:m.data.width+2*$a,h:m.data.height+2*$a};u.push(_),a[d]=new iy(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(i,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>i.hasImage(d,u)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const d in i.getUpdatedImages(u))this.patchUpdatedImage(this.iconPositions[d],i.getImage(d,u),a),this.patchUpdatedImage(this.patternPositions[d],i.getImage(d,u),a)}patchUpdatedImage(i,a,u){if(!i||!a||i.version===a.version)return;i.version=a.version;const[d,m]=i.tl,_=!!Object.keys(this.patternPositions).length;u.update(a.data,{useMipmap:_},{x:d,y:m})}}Pe(iy,"ImagePosition"),Pe(sM,"ImageAtlas");const sy=1e20;function nb(o,i,a,u,d,m,_,b,T){for(let S=i;S<i+u;S++)xE(o,a*m+S,m,d,_,b,T);for(let S=a;S<a+d;S++)xE(o,S*m+i,1,u,_,b,T)}function xE(o,i,a,u,d,m,_){m[0]=0,_[0]=-sy,_[1]=sy,d[0]=o[i];for(let b=1,T=0,S=0;b<u;b++){d[b]=o[i+b*a];const A=b*b;do{const k=m[T];S=(d[b]-d[k]+A-k*k)/(b-k)/2}while(S<=_[T]&&--T>-1);T++,m[T]=b,_[T]=S,_[T+1]=sy}for(let b=0,T=0;b<u;b++){for(;_[T+1]<b;)T++;const S=m[T],A=b-S;o[i+b*a]=d[S]+A*A}}const Ha=2,rb={none:0,ideographs:1,all:2};class Ym{constructor(i,a,u){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i,a){this.urls[a]=i}getGlyphs(i,a,u){const d=[],m=this.urls[a]||qn.GLYPHS_URL;for(const _ in i)for(const b of i[_])d.push({stack:_,id:b});$g(d,({stack:_,id:b},T)=>{let S=this.entries[_];S||(S=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=S.glyphs[b];if(void 0!==A)return void T(null,{stack:_,id:b,glyph:A});if(A=this._tinySDF(S,_,b),A)return S.glyphs[b]=A,void T(null,{stack:_,id:b,glyph:A});const k=Math.floor(b/256);if(256*k>65535)return void T(new Error("glyphs > 65535 not supported"));if(S.ranges[k])return void T(null,{stack:_,id:b,glyph:A});let R=S.requests[k];R||(R=S.requests[k]=[],Ym.loadGlyphRange(_,k,m,this.requestManager,(L,U)=>{if(U){S.ascender=U.ascender,S.descender=U.descender;for(const H in U.glyphs)this._doesCharSupportLocalGlyph(+H)||(S.glyphs[+H]=U.glyphs[+H]);S.ranges[k]=!0}for(const H of R)H(L,U);delete S.requests[k]})),R.push((L,U)=>{L?T(L):U&&T(null,{stack:_,id:b,glyph:U.glyphs[b]||null})})},(_,b)=>{if(_)u(_);else if(b){const T={};for(const{stack:S,id:A,glyph:k}of b)void 0===T[S]&&(T[S]={}),void 0===T[S].glyphs&&(T[S].glyphs={}),T[S].glyphs[A]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},T[S].ascender=this.entries[S].ascender,T[S].descender=this.entries[S].descender;u(null,T)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==rb.none&&(this.localGlyphMode===rb.all?!!this.localFontFamily:!!this.localFontFamily&&(Oe["CJK Unified Ideographs"](i)||Oe["Hangul Syllables"](i)||Oe.Hiragana(i)||Oe.Katakana(i)||Oe["CJK Symbols and Punctuation"](i)||Oe["CJK Unified Ideographs Extension A"](i)||Oe["CJK Unified Ideographs Extension B"](i)))}_tinySDF(i,a,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let m=i.tinySDF;if(!m){let H="400";/bold/i.test(a)?H="900":/medium/i.test(a)?H="500":/light/i.test(a)&&(H="200"),m=i.tinySDF=new Ym.TinySDF({fontFamily:d,fontWeight:H,fontSize:24*Ha,buffer:3*Ha,radius:8*Ha}),m.fontWeight=H}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];const _=String.fromCodePoint(u),{data:b,width:T,height:S,glyphWidth:A,glyphHeight:k,glyphLeft:R,glyphTop:L,glyphAdvance:U}=m.draw(_);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new bp({width:T,height:S},b),metrics:{width:A/Ha,height:k/Ha,left:R/Ha,top:L/Ha-27,advance:U/Ha,localGlyph:!0}}}}Ym.loadGlyphRange=function(o,i,a,u,d){const m=256*i,_=m+255,b=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${m}-${_}`),Nf.Glyphs);Pa(b,(T,S)=>{if(T)d(T);else if(S){const A={},k=new ny(S).readFields(eM,{});for(const R of k.glyphs)A[R.id]=R;d(null,{glyphs:A,ascender:k.ascender,descender:k.descender})}})},Ym.TinySDF=class{constructor({fontSize:o=24,buffer:i=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}={}){this.buffer=i,this.cutoff=u,this.radius=a;const b=this.size=o+4*i,T=this._createCanvas(b),S=this.ctx=T.getContext("2d",{willReadFrequently:!0});S.font=`${_} ${m} ${o}px ${d}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(o){const i=document.createElement("canvas");return i.width=i.height=o,i}draw(o){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(o),_=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-d))),T=Math.min(this.size-this.buffer,_+Math.ceil(u)),S=b+2*this.buffer,A=T+2*this.buffer,k=Math.max(S*A,0),R=new Uint8ClampedArray(k),L={data:R,width:S,height:A,glyphWidth:b,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:i};if(0===b||0===T)return L;const{ctx:U,buffer:H,gridInner:G,gridOuter:Y}=this;U.clearRect(H,H,b,T),U.fillText(o,H,H+_);const ue=U.getImageData(H,H,b,T);Y.fill(sy,0,k),G.fill(0,0,k);for(let ae=0;ae<T;ae++)for(let he=0;he<b;he++){const ve=ue.data[4*(ae*b+he)+3]/255;if(0===ve)continue;const we=(ae+H)*S+he+H;if(1===ve)Y[we]=0,G[we]=sy;else{const Se=.5-ve;Y[we]=Se>0?Se*Se:0,G[we]=Se<0?Se*Se:0}}nb(Y,0,0,S,A,S,this.f,this.v,this.z),nb(G,H,H,b,T,S,this.f,this.v,this.z);for(let ae=0;ae<k;ae++){const he=Math.sqrt(Y[ae])-Math.sqrt(G[ae]);R[ae]=Math.round(255-255*(he/this.radius+this.cutoff))}return L}};const Mp=$a;function UO(o,i,a,u){const d=[],m=o.imagePrimary,_=m.pixelRatio,b=m.paddedRect.w-2*Mp,T=m.paddedRect.h-2*Mp,S=o.right-o.left,A=o.bottom-o.top,k=m.stretchX||[[0,b]],R=m.stretchY||[[0,T]],L=(Ye,ht)=>Ye+ht[1]-ht[0],U=k.reduce(L,0),H=R.reduce(L,0),G=b-U,Y=T-H;let ue=0,ae=U,he=0,ve=H,we=0,Se=G,Fe=0,Ge=Y;if(m.content&&u){const Ye=m.content;ue=Km(k,0,Ye[0]),he=Km(R,0,Ye[1]),ae=Km(k,Ye[0],Ye[2]),ve=Km(R,Ye[1],Ye[3]),we=Ye[0]-ue,Fe=Ye[1]-he,Se=Ye[2]-Ye[0]-ae,Ge=Ye[3]-Ye[1]-ve}const tt=(Ye,ht,Dt,dt)=>{const Nt=oy(Ye.stretch-ue,ae,S,o.left),ut=ay(Ye.fixed-we,Se,Ye.stretch,U),vt=oy(ht.stretch-he,ve,A,o.top),zt=ay(ht.fixed-Fe,Ge,ht.stretch,H),ct=oy(Dt.stretch-ue,ae,S,o.left),qt=ay(Dt.fixed-we,Se,Dt.stretch,U),Lt=oy(dt.stretch-he,ve,A,o.top),Mt=ay(dt.fixed-Fe,Ge,dt.stretch,H),In=new $t(Nt,vt),_n=new $t(ct,vt),en=new $t(ct,Lt),Ht=new $t(Nt,Lt),Jn=new $t(ut/_,zt/_),bn=new $t(qt/_,Mt/_),cn=i*Math.PI/180;if(cn){const Cr=Math.sin(cn),bi=Math.cos(cn),wi=[bi,-Cr,Cr,bi];In._matMult(wi),_n._matMult(wi),Ht._matMult(wi),en._matMult(wi)}const ar=Ye.stretch+Ye.fixed,fr=Dt.stretch+Dt.fixed,hr=ht.stretch+ht.fixed,yr=dt.stretch+dt.fixed,Ar=o.imageSecondary;return{tl:In,tr:_n,bl:Ht,br:en,texPrimary:{x:m.paddedRect.x+Mp+ar,y:m.paddedRect.y+Mp+hr,w:fr-ar,h:yr-hr},texSecondary:Ar?{x:Ar.paddedRect.x+Mp+ar,y:Ar.paddedRect.y+Mp+hr,w:fr-ar,h:yr-hr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jn,pixelOffsetBR:bn,minFontScaleX:Se/_/S,minFontScaleY:Ge/_/A,isSDF:a}};if(u&&(m.stretchX||m.stretchY)){const Ye=oM(k,G,U),ht=oM(R,Y,H);for(let Dt=0;Dt<Ye.length-1;Dt++){const dt=Ye[Dt],Nt=Ye[Dt+1];for(let ut=0;ut<ht.length-1;ut++)d.push(tt(dt,ht[ut],Nt,ht[ut+1]))}}else d.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return d}function Km(o,i,a){let u=0;for(const d of o)u+=Math.max(i,Math.min(a,d[1]))-Math.max(i,Math.min(a,d[0]));return u}function oM(o,i,a){const u=[{fixed:-Mp,stretch:0}];for(const[d,m]of o){const _=u[u.length-1];u.push({fixed:d-_.stretch,stretch:_.stretch}),u.push({fixed:d-_.stretch,stretch:_.stretch+(m-d)})}return u.push({fixed:i+Mp,stretch:a}),u}function oy(o,i,a,u){return o/i*a+u}function ay(o,i,a,u){return o-i*a/u}function aM(o,i,a,u){const d=i+o.positionedLines[u].lineOffset;return 0===u?a+d/2:a+(d+(i+o.positionedLines[u-1].lineOffset))/2}function bE(o,i=1,a=!1){let u=1/0,d=1/0,m=-1/0,_=-1/0;const b=o[0];for(let L=0;L<b.length;L++){const U=b[L];(!L||U.x<u)&&(u=U.x),(!L||U.y<d)&&(d=U.y),(!L||U.x>m)&&(m=U.x),(!L||U.y>_)&&(_=U.y)}const T=Math.min(m-u,_-d);let S=T/2;const A=new Mc([],lM);if(0===T)return new $t(u,d);for(let L=u;L<m;L+=T)for(let U=d;U<_;U+=T)A.push(new Qd(L+S,U+S,S,o));let k=function(L){let U=0,H=0,G=0;const Y=L[0];for(let ue=0,ae=Y.length,he=ae-1;ue<ae;he=ue++){const ve=Y[ue],we=Y[he],Se=ve.x*we.y-we.x*ve.y;H+=(ve.x+we.x)*Se,G+=(ve.y+we.y)*Se,U+=3*Se}return new Qd(H/U,G/U,0,L)}(o),R=A.length;for(;A.length;){const L=A.pop();(L.d>k.d||!k.d)&&(k=L,a&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,R)),L.max-k.d<=i||(S=L.h/2,A.push(new Qd(L.p.x-S,L.p.y-S,S,o)),A.push(new Qd(L.p.x+S,L.p.y-S,S,o)),A.push(new Qd(L.p.x-S,L.p.y+S,S,o)),A.push(new Qd(L.p.x+S,L.p.y+S,S,o)),R+=4)}return a&&(console.log(`num probes: ${R}`),console.log(`best distance: ${k.d}`)),k.p}function lM(o,i){return i.max-o.max}class Qd{constructor(i,a,u,d){this.p=new $t(i,a),this.h=u,this.d=function(m,_){let b=!1,T=1/0;for(let S=0;S<_.length;S++){const A=_[S];for(let k=0,R=A.length,L=R-1;k<R;L=k++){const U=A[k],H=A[L];U.y>m.y!=H.y>m.y&&m.x<(H.x-U.x)*(m.y-U.y)/(H.y-U.y)+U.x&&(b=!b),T=Math.min(T,jS(m,U,H))}}return(b?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const Ap=Number.POSITIVE_INFINITY,cM=Math.sqrt(2);function ib(o,[i,a]){let u=0,d=0;if(a===Ap){i<0&&(i=0);const m=i/cM;switch(o){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-i;break;case"top":d=i-7}switch(o){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=i;break;case"right":u=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),o){case"top-right":case"top-left":case"top":d=a-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-a}switch(o){case"top-right":case"bottom-right":case"right":u=-i;break;case"top-left":case"bottom-left":case"left":u=i}}return[u,d]}function Jm(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uM(o,i,a,u,d,m,_,b,T,S,A,k,R,L,U){let H=m.textMaxSize.evaluate(i,{},k);void 0===H&&(H=_);const G=o.layers[0].layout,Y=G.get("icon-offset").evaluate(i,{},k),ue=wE(a.horizontal)||a.vertical,ae="globe"===R.name,he=ma,ve=_/he,we=o.tilePixelRatio*H/he,Se=(Nt=o.overscaling,o.zoom>18&&Nt>2&&(Nt>>=1),Math.max(Ut/(512*Nt),1)*G.get("symbol-spacing")),Fe=G.get("text-padding")*o.tilePixelRatio,Ge=G.get("icon-padding")*o.tilePixelRatio,tt=Dr(G.get("text-max-angle")),Ye="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),ht="map"===G.get("icon-rotation-alignment")&&"point"!==G.get("symbol-placement"),Dt=G.get("symbol-placement"),dt=Se/2;var Nt;const ut=G.get("icon-text-fit").evaluate(i,{},k),vt=G.get("icon-text-fit-padding").evaluate(i,{},k),zt="none"!==ut;let ct;!1===o.hasAnyIconTextFit&&zt&&(o.hasAnyIconTextFit=!0),u&&zt&&(o.allowVerticalPlacement&&a.vertical&&(ct=_E(u,a.vertical,ut,vt,Y,ve)),ue&&(u=_E(u,ue,ut,vt,Y,ve)));const qt=(Lt,Mt,In)=>{if(Mt.x<0||Mt.x>=Ut||Mt.y<0||Mt.y>=Ut)return;let _n=null;if(ae){const{x:en,y:Ht,z:Jn}=R.projectTilePoint(Mt.x,Mt.y,In);_n={anchor:new Bu(en,Ht,Jn,0,void 0),up:R.upVector(In,Mt.x,Mt.y)}}!function(en,Ht,Jn,bn,cn,ar,fr,hr,yr,Ar,Cr,bi,wi,lr,ri,oi,Vi,Ss,Ns,hs,es,po,js,Ro,Fi,hl,$u){const uc=en.addToLineVertexArray(Ht,bn);let Nc,Lp,mg,o_,Zh,_2,y2,Rb=0,v2=0,x2=0,b2=0,Pb=-1,w2=-1;const sf={};let gR=i1("");const a_=Jn?Jn.anchor:Ht,YM="none"!==yr.layout.get("icon-text-fit").evaluate(es,{},Fi);let KM=0,JM=0;if(void 0===yr._unevaluatedLayout.getValue("text-radial-offset")?[KM,JM]=yr.layout.get("text-offset").evaluate(es,{},Fi).map(Gl=>Gl*ma):(KM=yr.layout.get("text-radial-offset").evaluate(es,{},Fi)*ma,JM=Ap),en.allowVerticalPlacement&&cn.vertical){const Gl=cn.vertical;if(ri)_2=TE(Gl),hr&&(y2=TE(hr));else{const Fc=yr.layout.get("text-rotate").evaluate(es,{},Fi)+90;mg=sb(Ar,a_,Ht,Cr,bi,wi,Gl,lr,Fc,oi),hr&&(o_=sb(Ar,a_,Ht,Cr,bi,wi,hr,Ss,Fc))}}if(ar){const Gl=yr.layout.get("icon-rotate").evaluate(es,{},Fi),Fc=UO(ar,Gl,js,YM),ky=hr?UO(hr,Gl,js,YM):void 0;Lp=sb(Ar,a_,Ht,Cr,bi,wi,ar,Ss,Gl),Rb=4*Fc.length;const _R=en.iconSizeData;let l_=null;"source"===_R.kind?(l_=[$h*yr.layout.get("icon-size").evaluate(es,{},Fi)],l_[0]>zu&&ks(`${en.layerIds[0]}: Value for "icon-size" is >= ${Qm}. Reduce your "icon-size".`)):"composite"===_R.kind&&(l_=[$h*po.compositeIconSizes[0].evaluate(es,{},Fi),$h*po.compositeIconSizes[1].evaluate(es,{},Fi)],(l_[0]>zu||l_[1]>zu)&&ks(`${en.layerIds[0]}: Value for "icon-size" is >= ${Qm}. Reduce your "icon-size".`)),en.addSymbols(en.icon,Fc,l_,hs,Ns,es,!1,Jn,Ht,uc.lineStartIndex,uc.lineLength,-1,Ro,Fi,hl,$u),Pb=en.icon.placedSymbolArray.length-1,ky&&(v2=4*ky.length,en.addSymbols(en.icon,ky,l_,hs,Ns,es,cc.vertical,Jn,Ht,uc.lineStartIndex,uc.lineLength,-1,Ro,Fi,hl,$u),w2=en.icon.placedSymbolArray.length-1)}for(const Gl in cn.horizontal){const Fc=cn.horizontal[Gl];Nc||(gR=i1(Fc.text),ri?Zh=TE(Fc):Nc=sb(Ar,a_,Ht,Cr,bi,wi,Fc,lr,yr.layout.get("text-rotate").evaluate(es,{},Fi),oi));const ky=1===Fc.positionedLines.length;if(x2+=hM(en,Jn,Ht,Fc,fr,yr,ri,es,oi,uc,cn.vertical?cc.horizontal:cc.horizontalOnly,ky?Object.keys(cn.horizontal):[Gl],sf,Pb,po,Ro,Fi,hl),ky)break}cn.vertical&&(b2+=hM(en,Jn,Ht,cn.vertical,fr,yr,ri,es,oi,uc,cc.vertical,["vertical"],sf,w2,po,Ro,Fi,hl));let gg=-1;const QM=(Gl,Fc)=>Gl?Math.max(Gl,Fc):Fc;gg=QM(Zh,gg),gg=QM(_2,gg),gg=QM(y2,gg);const eA=gg>-1?1:0;en.glyphOffsetArray.length>=65535&&ks("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==es.sortKey&&en.addToSortKeyRanges(en.symbolInstances.length,es.sortKey),en.symbolInstances.emplaceBack(Ht.x,Ht.y,a_.x,a_.y,a_.z,sf.right>=0?sf.right:-1,sf.center>=0?sf.center:-1,sf.left>=0?sf.left:-1,sf.vertical>=0?sf.vertical:-1,Pb,w2,gR,void 0!==Nc?Nc:en.collisionBoxArray.length,void 0!==Nc?Nc+1:en.collisionBoxArray.length,void 0!==mg?mg:en.collisionBoxArray.length,void 0!==mg?mg+1:en.collisionBoxArray.length,void 0!==Lp?Lp:en.collisionBoxArray.length,void 0!==Lp?Lp+1:en.collisionBoxArray.length,o_||en.collisionBoxArray.length,o_?o_+1:en.collisionBoxArray.length,Cr,x2,b2,Rb,v2,eA,0,KM,JM,gg,0,YM?1:0)}(o,Mt,_n,Lt,a,u,d,ct,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,Fe,Ye,T,0,Ge,ht,Y,i,m,S,A,k,L,U)};if("line"===Dt)for(const Lt of tb(i.geometry,0,0,Ut,Ut)){const Mt=zO(Lt,Se,tt,a.vertical||ue,u,he,we,o.overscaling,Ut);for(const In of Mt)ue&&VO(o,ue.text,dt,In)||qt(Lt,In,k)}else if("line-center"===Dt){for(const Lt of i.geometry)if(Lt.length>1){const Mt=BO(Lt,tt,a.vertical||ue,u,he,we);Mt&&qt(Lt,Mt,k)}}else if("Polygon"===i.type)for(const Lt of $1(i.geometry,0)){const Mt=bE(Lt,16);qt(Lt[0],new Bu(Mt.x,Mt.y,0,0,void 0),k)}else if("LineString"===i.type)for(const Lt of i.geometry)qt(Lt,new Bu(Lt[0].x,Lt[0].y,0,0,void 0),k);else if("Point"===i.type)for(const Lt of i.geometry)for(const Mt of Lt)qt([Mt],new Bu(Mt.x,Mt.y,0,0,void 0),k)}const Qm=255,zu=Qm*$h;function hM(o,i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G,Y){const ue=function(ve,we,Se,Fe,Ge,tt,Ye,ht){const Dt=[];if(0===we.positionedLines.length)return Dt;const dt=Fe.layout.get("text-rotate").evaluate(tt,{})*Math.PI/180,Nt=function(qt){const Lt=qt[0],Mt=qt[1],In=Lt*Mt;return In>0?[Lt,-Mt]:In<0?[-Lt,Mt]:0===Lt?[Mt,Lt]:[Mt,-Lt]}(Se);let ut=Math.abs(we.top-we.bottom);for(const qt of we.positionedLines)ut-=qt.lineOffset;const vt=we.positionedLines.length,zt=ut/vt;let ct=we.top-Se[1];for(let qt=0;qt<vt;++qt){const Lt=we.positionedLines[qt];ct=aM(we,zt,ct,qt);for(const Mt of Lt.positionedGlyphs){if(!Mt.rect)continue;const In=Mt.rect||{};let _n=Hl+1,en=!0,Ht=1,Jn=0;if(Mt.imageName){const hs=Ye[Mt.imageName];if(!hs)continue;if(hs.sdf){ks("SDF images are not supported in formatted text and will be ignored.");continue}en=!1,Ht=hs.pixelRatio,_n=$a/Ht}const bn=(Ge||ht)&&Mt.vertical,cn=Mt.metrics.advance*Mt.scale/2,ar=Mt.metrics,fr=Mt.rect;if(null===fr)continue;ht&&we.verticalizable&&(Jn=Mt.imageName?cn-Mt.metrics.width*Mt.scale/2:0);const hr=Ge?[Mt.x+cn,Mt.y]:[0,0];let yr=[0,0],Ar=[0,0],Cr=!1;Ge||(bn?(Ar=[Mt.x+cn+Nt[0],Mt.y+Nt[1]-Jn],Cr=!0):yr=[Mt.x+cn+Se[0],Mt.y+Se[1]-Jn]);const bi=fr.w*Mt.scale/(Ht*(Mt.localGlyph?Ha:1)),wi=fr.h*Mt.scale/(Ht*(Mt.localGlyph?Ha:1));let lr,ri,oi,Vi;if(bn){const hs=Mt.y-ct,es=new $t(-cn,cn-hs),po=-Math.PI/2,js=new $t(...Ar);lr=new $t(-cn+yr[0],yr[1]),lr._rotateAround(po,es)._add(js),lr.x+=-hs+cn,lr.y-=(ar.left-_n)*Mt.scale;const Ro=Mt.imageName?ar.advance*Mt.scale:ma*Mt.scale,Fi=String.fromCodePoint(Mt.glyph);QD(Fi)?lr.x+=(1-_n)*Mt.scale:FO(Fi)?lr.x+=Ro-ar.height*Mt.scale+(-_n-1)*Mt.scale:lr.x+=Mt.imageName||ar.width+2*_n===fr.w&&ar.height+2*_n===fr.h?(Ro-wi)/2:(Ro-(ar.height+2*_n)*Mt.scale)/2,ri=new $t(lr.x,lr.y-bi),oi=new $t(lr.x+wi,lr.y),Vi=new $t(lr.x+wi,lr.y-bi)}else{const hs=(ar.left-_n)*Mt.scale-cn+yr[0],es=(-ar.top-_n)*Mt.scale+yr[1],po=hs+bi,js=es+wi;lr=new $t(hs,es),ri=new $t(po,es),oi=new $t(hs,js),Vi=new $t(po,js)}if(dt){let hs;hs=Ge?new $t(0,0):Cr?new $t(Nt[0],Nt[1]):new $t(Se[0],Se[1]),lr._rotateAround(dt,hs),ri._rotateAround(dt,hs),oi._rotateAround(dt,hs),Vi._rotateAround(dt,hs)}const Ss=new $t(0,0),Ns=new $t(0,0);Dt.push({tl:lr,tr:ri,bl:oi,br:Vi,texPrimary:In,texSecondary:void 0,writingMode:we.writingMode,glyphOffset:hr,sectionIndex:Mt.sectionIndex,isSDF:en,pixelOffsetTL:Ss,pixelOffsetBR:Ns,minFontScaleX:0,minFontScaleY:0})}}return Dt}(0,u,T,m,_,b,d,o.allowVerticalPlacement),ae=o.textSizeData;let he=null;"source"===ae.kind?(he=[$h*m.layout.get("text-size").evaluate(b,{},G)],he[0]>zu&&ks(`${o.layerIds[0]}: Value for "text-size" is >= ${Qm}. Reduce your "text-size".`)):"composite"===ae.kind&&(he=[$h*U.compositeTextSizes[0].evaluate(b,{},G),$h*U.compositeTextSizes[1].evaluate(b,{},G)],(he[0]>zu||he[1]>zu)&&ks(`${o.layerIds[0]}: Value for "text-size" is >= ${Qm}. Reduce your "text-size".`)),o.addSymbols(o.text,ue,he,T,_,b,A,i,a,S.lineStartIndex,S.lineLength,L,H,G,Y,!1);for(const ve of k)R[ve]=o.text.placedSymbolArray.length-1;return 4*ue.length}function wE(o){for(const i in o)return o[i];return null}function sb(o,i,a,u,d,m,_,b,T,S){let A=_.top,k=_.bottom,R=_.left,L=_.right;const U=_.collisionPadding;if(U&&(R-=U[0],A-=U[1],L+=U[2],k+=U[3]),T){const H=new $t(R,A),G=new $t(L,A),Y=new $t(R,k),ue=new $t(L,k),ae=Dr(T);let he=new $t(0,0);S&&(he=new $t(S[0],S[1])),H._rotateAround(ae,he),G._rotateAround(ae,he),Y._rotateAround(ae,he),ue._rotateAround(ae,he),R=Math.min(H.x,G.x,Y.x,ue.x),L=Math.max(H.x,G.x,Y.x,ue.x),A=Math.min(H.y,G.y,Y.y,ue.y),k=Math.max(H.y,G.y,Y.y,ue.y)}return o.emplaceBack(i.x,i.y,i.z,a.x,a.y,R,A,L,k,b,u,d,m),o.length-1}function TE(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const i=o.bottom-o.top;return i>0?Math.max(10,i):null}function VO(o,i,a,u){const d=o.compareText;if(i in d){const m=d[i];for(let _=m.length-1;_>=0;_--)if(u.dist(m[_])<a)return!0}else d[i]=[];return d[i].push(u),!1}function EE(o,i){const a=o.fovAboveCenter,u=o.elevation?o.elevation.getMinElevationBelowMSL()*i:0,d=(o._camera.position[2]*o.worldSize-u)/Math.cos(o._pitch),m=Math.sin(a)*d/Math.sin(Math.max(Math.PI/2-o._pitch-a,.01)),_=Math.sin(o._pitch)*m+d;return Math.min(1.01*_,d*(1/o._horizonShift))}function Ip(o,i){if(!i.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:i};const a=Math.pow(2,-o.z),u=o.x*a,d=(o.x+1)*a,m=o.y*a,_=(o.y+1)*a,b=Vl(u),T=Vl(d),S=fo(m),A=fo(_),k=i.project(b,S),R=i.project(T,S),L=i.project(T,A),U=i.project(b,A);let H=Math.min(k.x,R.x,L.x,U.x),G=Math.min(k.y,R.y,L.y,U.y),Y=Math.max(k.x,R.x,L.x,U.x),ue=Math.max(k.y,R.y,L.y,U.y);const ae=a/16;function he(we,Se,Fe,Ge,tt,Ye){const ht=(Fe+tt)/2,Dt=(Ge+Ye)/2,dt=i.project(Vl(ht),fo(Dt)),Nt=Math.max(0,H-dt.x,G-dt.y,dt.x-Y,dt.y-ue);H=Math.min(H,dt.x),Y=Math.max(Y,dt.x),G=Math.min(G,dt.y),ue=Math.max(ue,dt.y),Nt>ae&&(he(we,dt,Fe,Ge,ht,Dt),he(dt,Se,ht,Dt,tt,Ye))}he(k,R,u,m,d,m),he(R,L,d,m,d,_),he(L,U,d,_,u,_),he(U,k,u,_,u,m),H-=ae,G-=ae,Y+=ae,ue+=ae;const ve=1/Math.max(Y-H,ue-G);return{scale:ve,x:H*ve,y:G*ve,x2:Y*ve,y2:ue*ve,projection:i}}function qr(o,{x:i,y:a},u=0){return new $t(((i-u)*o.scale-o.x)*Ut,(a*o.scale-o.y)*Ut)}const Te=f.ae.identity(new Float32Array(16));class ef{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new kr(0,0)}projectTilePoint(i,a,u){return{x:i,y:a,z:0}}locationPoint(i,a,u=!0){return i._coordinatePoint(i.locationCoordinate(a),u)}pixelsPerMeter(i,a){return ko(1,i)*a}pixelSpaceConversion(i,a,u){return 1}farthestPixelDistance(i){return EE(i,i.pixelsPerMeter)}pointCoordinate(i,a,u,d){const m=i.horizonLineFromTop(!1),_=new $t(a,Math.max(m,u));return i.rayIntersectionCoordinate(i.pointRayIntersection(_,d))}pointCoordinate3D(i,a,u){const d=new $t(a,u);if(i.elevation)return i.elevation.pointCoordinate(d);{const m=this.pointCoordinate(i,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(i,a){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,a.x,a.y);const u=i.horizonLineFromTop();return a.y<u}createInversionMatrix(i,a){return Te}createTileMatrix(i,a,u){let d,m,_;const b=u.canonical,T=f.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Ip(b,this);d=1,m=S.x+u.wrap*S.scale,_=S.y,f.ae.scale(T,T,[d/S.scale,d/S.scale,i.pixelsPerMeter/a])}else d=a/i.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*u.wrap)*d,_=b.y*d;return f.ae.translate(T,T,[m,_,0]),f.ae.scale(T,T,[d/Ut,d/Ut,1]),T}upVector(i,a,u){return[0,0,1]}upVectorScale(i,a,u){return{metersToTile:1}}}class xt extends ef{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,u]=this.parallels=i.parallels||[29.5,45.5],d=Math.sin(Dr(a));this.n=(d+Math.sin(Dr(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:u,c:d,r0:m}=this,_=Dr(i-this.center[0]),b=Dr(a),T=Math.sqrt(d-2*u*Math.sin(b))/u;return{x:T*Math.sin(_*u),y:T*Math.cos(_*u)-m,z:0}}unproject(i,a){const{n:u,c:d,r0:m}=this,_=m+a;let b=Math.atan2(i,Math.abs(_))*Math.sign(_);_*u<0&&(b-=Math.PI*Math.sign(i)*Math.sign(_));const T=Dr(this.center[0])*u;b=hh(b,-Math.PI-T,Math.PI-T);const S=vr(oa(b/u)+this.center[0],-180,180),A=Math.asin(vr((d-(i*i+_*_)*u*u)/(2*u),-1,1)),k=vr(oa(A),-Us,Us);return new kr(S,k)}}const $0=1.340264,H0=-.081106,ly=893e-6,kp=.003796,Hh=Math.sqrt(3)/2;class CE extends ef{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const u=Math.asin(Hh*Math.sin(a)),d=u*u,m=d*d*d;return{x:.5*(i*Math.cos(u)/(Hh*($0+3*H0*d+m*(7*ly+9*kp*d)))/Math.PI+.5),y:1-.5*(u*($0+H0*d+m*(ly+kp*d))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=u*u,m=d*d*d;for(let A,k,R,L=0;L<12&&(k=u*($0+H0*d+m*(ly+kp*d))-a,R=$0+3*H0*d+m*(7*ly+9*kp*d),A=k/R,u=vr(u-A,-Math.PI/3,Math.PI/3),d=u*u,m=d*d*d,!(Math.abs(A)<1e-12));++L);const _=Hh*i*($0+3*H0*d+m*(7*ly+9*kp*d))/Math.cos(u),b=Math.asin(Math.sin(u)/Hh),T=vr(180*_/Math.PI,-180,180),S=vr(180*b/Math.PI,-Us,Us);return new kr(T,S)}}class cy extends ef{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const u=360*(i-.5),d=vr(360*(.5-a),-Us,Us);return new kr(u,d)}}const eg=Math.PI/2;function G0(o){return Math.tan((eg+o)/2)}class SE extends ef{constructor(i){super(i),this.center=i.center||[0,30];const[a,u]=this.parallels=i.parallels||[30,30];let d=Dr(a),m=Dr(u);this.southernCenter=d+m<0,this.southernCenter&&(d=-d,m=-m);const _=Math.cos(d),b=G0(d);this.n=d===m?Math.sin(d):Math.log(_/Math.cos(m))/Math.log(G0(m)/b),this.f=_*Math.pow(G0(d),this.n)/this.n}project(i,a){a=Dr(a),this.southernCenter&&(a=-a),i=Dr(i-this.center[0]);const u=1e-6,{n:d,f:m}=this;m>0?a<-eg+u&&(a=-eg+u):a>eg-u&&(a=eg-u);const _=m/Math.pow(G0(a),d);let b=_*Math.sin(d*i),T=m-_*Math.cos(d*i);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:d}=this,m=d-a,_=Math.sign(m),b=Math.sign(u)*Math.sqrt(i*i+m*m);let T=Math.atan2(i,Math.abs(m))*_;m*u<0&&(T-=Math.PI*Math.sign(i)*_);const S=vr(oa(T/u)+this.center[0],-180,180),A=vr(oa(2*Math.atan(Math.pow(d/b,1/u))-eg),-Us,Us);return new kr(S,this.southernCenter?-A:A)}}class ob extends ef{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:ac(i),y:Fh(a),z:0}}unproject(i,a){const u=Vl(i),d=fo(a);return new kr(u,d)}}const DE=Dr(Us);class ME extends ef{project(i,a){const u=(a=Dr(a))*a,d=u*u;return{x:.5*((i=Dr(i))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=25,m=0,_=u*u;do{_=u*u;const S=_*_;m=(u*(1.007226+_*(.015085+S*(.028874*_-.044475-.005916*S)))-a)/(1.007226+_*(.045255+S*(.259866*_-.311325-.005916*11*S))),u=vr(u-m,-DE,DE)}while(Math.abs(m)>1e-6&&--d>0);_=u*u;const b=vr(oa(i/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=oa(u);return new kr(b,T)}}const dM=Dr(Us);class jO extends ef{project(i,a){a=Dr(a),i=Dr(i);const u=Math.cos(a),d=2/Math.PI,m=Math.acos(u*Math.cos(i/2)),_=Math.sin(m)/m,b=.5*(i*d+2*u*Math.sin(i/2)/_)||0,T=.5*(a+Math.sin(a)/_)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(i,a){let u=i=(2*i-.5)*Math.PI,d=a=(2*(1-a)-1)*Math.PI,m=25;const _=1e-6;let b=0,T=0;do{const S=Math.cos(d),A=Math.sin(d),k=2*A*S,R=A*A,L=S*S,U=Math.cos(u/2),H=Math.sin(u/2),G=2*U*H,Y=H*H,ue=1-L*U*U,ae=ue?1/ue:0,he=ue?Math.acos(S*U)*Math.sqrt(1/ue):0,ve=.5*(2*he*S*H+2*u/Math.PI)-i,we=.5*(he*A+d)-a,Se=.5*ae*(L*Y+he*S*U*R)+1/Math.PI,Fe=ae*(G*k/4-he*A*H),Ge=.125*ae*(k*H-he*A*L*G),tt=.5*ae*(R*U+he*Y*S)+.5,Ye=Fe*Ge-tt*Se;b=(we*Fe-ve*tt)/Ye,T=(ve*Ge-we*Se)/Ye,u=vr(u-b,-Math.PI,Math.PI),d=vr(d-T,-dM,dM)}while((Math.abs(b)>_||Math.abs(T)>_)&&--m>0);return new kr(oa(u),oa(d))}}class fM extends ef{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Dr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:u,cosPhi:d}=this;return{x:Dr(i)*d*u+.5,y:-Math.sin(Dr(a))/d*u+.5,z:0}}unproject(i,a){const{scale:u,cosPhi:d}=this,m=-(a-.5)/u,_=vr(oa((i-.5)/u)/d,-180,180),b=Math.asin(vr(m*d,-1,1)),T=vr(oa(b),-Us,Us);return new kr(_,T)}}class pM extends ob{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,u){const d=wx(i,a,u),m=N1(Nu(u));return f.$.transformMat4(d,d,m),{x:d[0],y:d[1],z:d[2]}}locationPoint(i,a){const u=mp(a.lat,a.lng),d=f.$.normalize([],u),m=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude,_=ko(1,0)*Ut*m;f.$.scaleAndAdd(u,u,d,_);const b=f.ae.identity(new Float64Array(16));return f.ae.multiply(b,i.pixelMatrix,i.globeMatrix),f.$.transformMat4(u,u,b),new $t(u[0],u[1])}pixelsPerMeter(i,a){return ko(1,0)*a}pixelSpaceConversion(i,a,u){const d=ko(1,i)*a,m=Fn(ko(1,45)*a,d,u);return this.pixelsPerMeter(i,a)/m}createTileMatrix(i,a,u){const d=vp(Nu(u.canonical));return f.ae.multiply(new Float64Array(16),i.globeMatrix,d)}createInversionMatrix(i,a){const{center:u}=i,d=N1(Nu(a));return f.ae.rotateY(d,d,Dr(u.lng)),f.ae.rotateX(d,d,Dr(u.lat)),f.ae.scale(d,d,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(i,a,u,d){return iO(i,a,u,!0)||new pa(0,0)}pointCoordinate3D(i,a,u){const d=this.pointCoordinate(i,a,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(i,a){return!iO(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(d,m){const _=d.cameraToCenterDistance,b=d._centerAltitude*m,T=d._camera,S=d._camera.forward(),A=f.$.add([],f.$.scale([],S,-_),[0,0,b]),k=d.worldSize/(2*Math.PI),R=[0,0,-k],L=d.width/d.height,U=Math.tan(d.fovAboveCenter),H=f.$.scale([],T.up(),U),G=f.$.scale([],T.right(),U*L),Y=f.$.normalize([],f.$.add([],f.$.add([],S,H),G)),ue=[];let ae;if(new DT(A,Y).closestPointOnSphere(R,k,ue)){const he=f.$.add([],ue,R),ve=f.$.sub([],he,A);ae=Math.cos(d.fovAboveCenter)*f.$.length(ve)}else{const he=f.$.sub([],A,R),ve=f.$.sub([],R,A);f.$.normalize(ve,ve);const we=f.$.length(he)-k;ae=Math.sqrt(we*(we+2*k));const Se=Math.acos(ae/(k+we))-Math.acos(f.$.dot(S,ve));ae*=Math.cos(Se)}return 1.01*ae}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),u=xp(i.zoom);if(u>0){const d=EE(i,ko(1,i.center.lat)*i.worldSize),m=i.worldSize/(2*Math.PI),_=Math.max(i.width,i.height)/i.worldSize*Math.PI;return Fn(a,d+m*(1-Math.cos(_)),Math.pow(u,10))}return a}upVector(i,a,u){return wx(a,u,i,1)}upVectorScale(i){return{metersToTile:AT(RT(Nu(i)))}}}function mM(o){const i=o.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(o.name){case"mercator":return new ob(o);case"equirectangular":return new cy(o);case"naturalEarth":return new ME(o);case"equalEarth":return new CE(o);case"winkelTripel":return new jO(o);case"albers":return a?new fM(o):new xt(o);case"lambertConformalConic":return a?new fM(o):new SE(o);case"globe":return new pM(o)}throw new Error(`Invalid projection name: ${o.name}`)}const $O=Sp.types,HO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ab(o,i,a,u,d,m,_,b,T,S,A,k,R){const L=b?Math.min(zu,Math.round(b[0])):0,U=b?Math.min(zu,Math.round(b[1])):0;o.emplaceBack(i,a,Math.round(32*u),Math.round(32*d),m,_,(L<<1)+(T?1:0),U,16*S,16*A,256*k,256*R)}function uy(o,i,a){o.emplaceBack(i,a)}function hy(o,i,a,u,d,m,_){o.emplaceBack(i,a,u,d,m,_)}function lb(o,i,a,u,d){o.emplaceBack(i,a,u,d),o.emplaceBack(i,a,u,d),o.emplaceBack(i,a,u,d),o.emplaceBack(i,a,u,d)}function GO(o){for(const i of o.sections)if(Yn(i.text))return!0;return!1}class cl{constructor(i){this.layoutVertexArray=new ox,this.indexArray=new cs,this.programConfigurations=i,this.segments=new us,this.dynamicLayoutVertexArray=new Io,this.opacityVertexArray=new lx,this.placedSymbolArray=new jt,this.iconTransitioningVertexArray=new nu,this.globeExtVertexArray=new ax,this.zOffsetVertexArray=new up}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(i,a,u,d,m){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,UD.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,cL.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,HO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,iE.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,lL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,EO.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Pe(cl,"SymbolBuffers");class AE{constructor(i,a,u){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new u,this.segments=new us,this.collisionVertexArray=new w1,this.collisionVertexArrayExt=new Io}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,sE.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,uL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pe(AE,"CollisionBuffers");class W0{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=f.ae.identity([]),this.placementViewportMatrix=f.ae.identity([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=KD(this.zoom,a["text-size"]),this.iconSizeData=KD(this.zoom,a["icon-size"]);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==d.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(_=>cc[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new cl(new oc(this.layers,{zoom:this.zoom,lut:this.lut},i=>/^text/.test(i))),this.icon=new cl(new oc(this.layers,{zoom:this.zoom,lut:this.lut},i=>/^icon/.test(i))),this.glyphOffsetArray=new An,this.lineVertexArray=new rs,this.symbolInstances=new Mn}calculateGlyphDependencies(i,a,u,d,m){for(let _=0;_<i.length;_++){const b=i.codePointAt(_);if(void 0===b)break;if(a[b]=!0,d&&m&&b<=65535){const T=z0[i.charAt(_)];T&&(a[T.charCodeAt(0)]=!0)}}}updateFootprints(i,a){}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!XT(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(i,a,u,d){const m=this.layers[0],_=m.layout,b="globe"===this.projection.name,T=_.get("text-font"),S=_.get("text-field"),A=_.get("icon-image"),k=("constant"!==S.value.kind||S.value.value instanceof Go&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),R="constant"!==A.value.kind||!!A.value.value||Object.keys(A.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!k&&!R)return;const U=a.iconDependencies,H=a.glyphDependencies,G=a.availableImages,Y=new tr(this.zoom);for(const{feature:ue,id:ae,index:he,sourceLayerIndex:ve}of i){const we=m._featureFilter.needGeometry,Se=Lh(ue,we);if(!m._featureFilter.filter(Y,Se,u))continue;if(we||(Se.geometry=su(ue,u,d)),b&&1!==ue.type&&u.z<=5){const Ye=Se.geometry,ht=.98078528056,Dt=(dt,Nt)=>{const ut=wx(dt.x,dt.y,u,1),vt=wx(Nt.x,Nt.y,u,1);return f.$.dot(ut,vt)<ht};for(let dt=0;dt<Ye.length;dt++)Ye[dt]=vx(Ye[dt],Dt)}let Fe,Ge;if(k){const Ye=m.getValueAndResolveTokens("text-field",Se,u,G),ht=Go.factory(Ye);GO(ht)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Zn()||this.hasRTLText&&Sr.isParsed())&&(Fe=JD(ht,m,Se))}if(R){const Ye=m.getValueAndResolveTokens("icon-image",Se,u,G);Ge=Ye instanceof Qs?Ye:Qs.fromString(Ye)}if(!Fe&&!Ge)continue;const tt=this.sortFeaturesByKey?L.evaluate(Se,{},u):void 0;if(this.features.push({id:ae,text:Fe,icon:Ge,index:he,sourceLayerIndex:ve,geometry:Se.geometry,properties:ue.properties,type:$O[ue.type],sortKey:tt}),Ge&&(U[Ge.namePrimary]=!0,Ge.nameSecondary&&(U[Ge.nameSecondary]=!0)),Fe){const Ye=T.evaluate(Se,{},u).join(","),ht="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(cc.vertical)>=0;for(const Dt of Fe.sections)if(Dt.image)U[Dt.image.namePrimary]=!0;else{const dt=_t(Fe.toString()),Nt=Dt.fontStack||Ye,ut=H[Nt]=H[Nt]||{};this.calculateGlyphDependencies(Dt.text,ut,ht,this.allowVerticalPlacement,dt)}}}"line"===_.get("symbol-placement")&&(this.features=function(ue){const ae={},he={},ve=[];let we=0;function Se(Ye){ve.push(ue[Ye]),we++}function Fe(Ye,ht,Dt){const dt=he[Ye];return delete he[Ye],he[ht]=dt,ve[dt].geometry[0].pop(),ve[dt].geometry[0]=ve[dt].geometry[0].concat(Dt[0]),dt}function Ge(Ye,ht,Dt){const dt=ae[ht];return delete ae[ht],ae[Ye]=dt,ve[dt].geometry[0].shift(),ve[dt].geometry[0]=Dt[0].concat(ve[dt].geometry[0]),dt}function tt(Ye,ht,Dt){const dt=Dt?ht[0][ht[0].length-1]:ht[0][0];return`${Ye}:${dt.x}:${dt.y}`}for(let Ye=0;Ye<ue.length;Ye++){const ht=ue[Ye],Dt=ht.geometry,dt=ht.text?ht.text.toString():null;if(!dt){Se(Ye);continue}const Nt=tt(dt,Dt),ut=tt(dt,Dt,!0);if(Nt in he&&ut in ae&&he[Nt]!==ae[ut]){const vt=Ge(Nt,ut,Dt),zt=Fe(Nt,ut,ve[vt].geometry);delete ae[Nt],delete he[ut],he[tt(dt,ve[zt].geometry,!0)]=zt,ve[vt].geometry=null}else Nt in he?Fe(Nt,ut,Dt):ut in ae?Ge(Nt,ut,Dt):(Se(Ye),ae[Nt]=we-1,he[ut]=we-1)}return ve.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ue,ae)=>ue.sortKey-ae.sortKey)}update(i,a,u,d,m){const _=0!==Object.keys(i).length;if(_&&!this.stateDependentLayers.length)return;const b=_?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(i,a,b,u,d,m),this.icon.programConfigurations.updatePaintArrays(i,a,b,u,d,m)}updateZOffset(){const i=(m,_,b)=>{u+=_,u>m.length&&m.resize(u);for(let T=-_;T<0;T++)m.emplace(T+u,b)},a=(m,_,b)=>{d+=_,d>m.length&&m.resize(d);for(let T=-_;T<0;T++)m.emplace(T+d,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,numIconVertices:S}=_,A=_.zOffset,k=S>0;if((b>0||T>0)&&(i(this.text.zOffsetVertexArray,b,A),i(this.text.zOffsetVertexArray,T,A)),k){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:L}=_;R>=0&&a(this.icon.zOffsetVertexArray,S,A),L>=0&&a(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const u=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:d,y:m}of a)this.lineVertexArray.emplaceBack(d,m);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,a,u,d,m,_,b,T,S,A,k,R,L,U,H,G){const Y=i.indexArray,ue=i.layoutVertexArray,ae=i.globeExtVertexArray,he=i.segments.prepareSegment(4*a.length,ue,Y,this.canOverlap?_.sortKey:void 0),ve=this.glyphOffsetArray.length,we=he.vertexLength,Se=this.allowVerticalPlacement&&b===cc.vertical?Math.PI/2:0,Fe=_.text&&_.text.sections;for(let tt=0;tt<a.length;tt++){const{tl:Ye,tr:ht,bl:Dt,br:dt,texPrimary:Nt,texSecondary:ut,pixelOffsetTL:vt,pixelOffsetBR:zt,minFontScaleX:ct,minFontScaleY:qt,glyphOffset:Lt,isSDF:Mt,sectionIndex:In}=a[tt],_n=he.vertexLength,en=Lt[1];if(ab(ue,S.x,S.y,Ye.x,en+Ye.y,Nt.x,Nt.y,u,Mt,vt.x,vt.y,ct,qt),ab(ue,S.x,S.y,ht.x,en+ht.y,Nt.x+Nt.w,Nt.y,u,Mt,zt.x,vt.y,ct,qt),ab(ue,S.x,S.y,Dt.x,en+Dt.y,Nt.x,Nt.y+Nt.h,u,Mt,vt.x,zt.y,ct,qt),ab(ue,S.x,S.y,dt.x,en+dt.y,Nt.x+Nt.w,Nt.y+Nt.h,u,Mt,zt.x,zt.y,ct,qt),T){const{x:Ht,y:Jn,z:bn}=T.anchor,[cn,ar,fr]=T.up;hy(ae,Ht,Jn,bn,cn,ar,fr),hy(ae,Ht,Jn,bn,cn,ar,fr),hy(ae,Ht,Jn,bn,cn,ar,fr),hy(ae,Ht,Jn,bn,cn,ar,fr),lb(i.dynamicLayoutVertexArray,Ht,Jn,bn,Se)}else lb(i.dynamicLayoutVertexArray,S.x,S.y,S.z,Se);if(G){const Ht=ut||Nt;uy(i.iconTransitioningVertexArray,Ht.x,Ht.y),uy(i.iconTransitioningVertexArray,Ht.x+Ht.w,Ht.y),uy(i.iconTransitioningVertexArray,Ht.x,Ht.y+Ht.h),uy(i.iconTransitioningVertexArray,Ht.x+Ht.w,Ht.y+Ht.h)}Y.emplaceBack(_n,_n+1,_n+2),Y.emplaceBack(_n+1,_n+2,_n+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Lt[0]),tt!==a.length-1&&In===a[tt+1].sectionIndex||i.programConfigurations.populatePaintArrays(ue.length,_,_.index,{},L,U,H,Fe&&Fe[In])}const Ge=T?T.anchor:S;i.placedSymbolArray.emplaceBack(Ge.x,Ge.y,Ge.z,S.x,S.y,ve,this.glyphOffsetArray.length-ve,we,A,k,S.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],b,0,!1,0,R,0)}_commitLayoutVertex(i,a,u,d,m,_,b){i.emplaceBack(a,u,d,m,_,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(i,a,u,d,m,_,b){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),S=T.vertexLength,A=b.tileAnchorX,k=b.tileAnchorY;for(let L=0;L<4;L++)u.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,a,i.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,m,_,A,k,new $t(i.x1,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,m,_,A,k,new $t(i.x2,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,m,_,A,k,new $t(i.x2,i.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,m,_,A,k,new $t(i.x1,i.y2)),T.vertexLength+=4;const R=u.indexArray;R.emplaceBack(S,S+1),R.emplaceBack(S+1,S+2),R.emplaceBack(S+2,S+3),R.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,u,d,m,_){for(let b=d;b<m;b++){const T=u.get(b),S=this.getSymbolInstanceTextSize(i,_,a,b);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(i,a,u,d,m,_){for(let b=d;b<m;b++){const T=u.get(b),S=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new AE(jm,CO.members,nu),this.iconCollisionBox=new AE(jm,CO.members,nu);const u=Jd(this.iconSizeData,i),d=Jd(this.textSizeData,i);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,i,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(d,i,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(u,i,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(u,i,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(i,a,u,d){const m=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:d),_=Yx(this.textSizeData,i,m)/ma;return this.tilePixelRatio*_}getSymbolInstanceIconSize(i,a,u){const d=this.icon.placedSymbolArray.get(u),m=Yx(this.iconSizeData,i,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(i,a,u,d){i.emplaceBack(a,-u,-u,d),i.emplaceBack(a,u,-u,d),i.emplaceBack(a,u,u,d),i.emplaceBack(a,-u,u,d)}_updateTextDebugCollisionBoxes(i,a,u,d,m,_){for(let b=d;b<m;b++){const T=u.get(b),S=this.getSymbolInstanceTextSize(i,_,a,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,T.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(i,a,u,d,m,_){for(let b=d;b<m;b++){const T=u.get(b),S=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,T.padding,_.zOffset)}}updateCollisionDebugBuffers(i,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Jd(this.iconSizeData,i),d=Jd(this.textSizeData,i);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(d,i,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(d,i,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(u,i,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._updateIconDebugCollisionBoxes(u,i,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,u,d,m,_,b,T,S){const A={};if(a<u){const{x1:k,y1:R,x2:L,y2:U,padding:H,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:ae,tileAnchorY:he,featureIndex:ve}=i.get(a);A.textBox={x1:k,y1:R,x2:L,y2:U,padding:H,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:ae,tileAnchorY:he},A.textFeatureIndex=ve}if(d<m){const{x1:k,y1:R,x2:L,y2:U,padding:H,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:ae,tileAnchorY:he,featureIndex:ve}=i.get(d);A.verticalTextBox={x1:k,y1:R,x2:L,y2:U,padding:H,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:ae,tileAnchorY:he},A.verticalTextFeatureIndex=ve}if(_<b){const{x1:k,y1:R,x2:L,y2:U,padding:H,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:ae,tileAnchorY:he,featureIndex:ve}=i.get(_);A.iconBox={x1:k,y1:R,x2:L,y2:U,padding:H,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:ae,tileAnchorY:he},A.iconFeatureIndex=ve}if(T<S){const{x1:k,y1:R,x2:L,y2:U,padding:H,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:ae,tileAnchorY:he,featureIndex:ve}=i.get(T);A.verticalIconBox={x1:k,y1:R,x2:L,y2:U,padding:H,projectedAnchorX:G,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:ae,tileAnchorY:he},A.verticalIconFeatureIndex=ve}return A}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,a){const u=i.placedSymbolArray.get(a),d=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<d;m+=4)i.indexArray.emplaceBack(m,m+1,m+2),i.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(i),u=Math.cos(i),d=[],m=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const T=this.symbolInstances.get(b);d.push(0|Math.round(a*T.tileAnchorX+u*T.tileAnchorY)),m.push(T.featureIndex)}return _.sort((b,T)=>d[b]-d[T]||m[T]-m[b]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&_!==m&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Pe(W0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),W0.addDynamicAttributes=lb;class Uu{constructor(i,a,u,d){this.context=i,this.format=u,this.texture=i.gl.createTexture(),this.update(a,d)}update(i,a,u){const{width:d,height:m}=i,{context:_}=this,{gl:b}=_;if(b.bindTexture(b.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!a||!1!==a.premultiply)),this.useMipmap=!(!a||!a.useMipmap),u||this.size&&this.size[0]===d&&this.size[1]===m){const{x:T,y:S}=u||{x:0,y:0};if(i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap)b.texSubImage2D(b.TEXTURE_2D,0,T,S,b.RGBA,b.UNSIGNED_BYTE,i);else{let A=this.format,k=b.UNSIGNED_BYTE;this.format===b.R32F&&(A=b.RED,k=b.FLOAT),b.texSubImage2D(b.TEXTURE_2D,0,T,S,d,m,A,k,i.data)}}else if(this.size=[d,m],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap){let T=this.format;this.format===b.R8&&(T=b.RED),b.texImage2D(b.TEXTURE_2D,0,this.format,T,b.UNSIGNED_BYTE,i)}else{let T=this.format,S=this.format,A=b.UNSIGNED_BYTE,k=!1;this.format===b.DEPTH_COMPONENT&&(T=b.DEPTH_COMPONENT16,A=b.UNSIGNED_SHORT),this.format===b.DEPTH_STENCIL&&(T=b.DEPTH24_STENCIL8,A=b.UNSIGNED_INT_24_8,k=!0),this.format===b.R8&&(S=b.RED),this.format===b.R32F&&(A=b.FLOAT,S=b.RED),!this.useMipmap&&k?b.texStorage2D(b.TEXTURE_2D,1,T,d,m):b.texImage2D(b.TEXTURE_2D,0,T,d,m,0,S,A,i.data)}this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(i,a,u=!1){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!u?i===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(i,a,u,d){const{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),a!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,a),this.magFilter=a),i!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?i===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),u!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,d),this.wrapT=d)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class q0{constructor(i,a){this.context=i,this.texture=a}bind(i,a){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,i),this.minFilter=i),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapS=a)}}const Op=new Uint16Array(8184);for(let o=0;o<2046;o++){let i=o+2,a=0,u=0,d=0,m=0,_=0,b=0;for(1&i?d=m=_=32:a=u=b=32;(i>>=1)>1;){const S=a+d>>1,A=u+m>>1;1&i?(d=a,m=u,a=_,u=b):(a=d,u=m,d=_,m=b),_=S,b=A}const T=4*o;Op[T+0]=a,Op[T+1]=u,Op[T+2]=d,Op[T+3]=m}const Wh=new Uint16Array(2178),tf=new Uint8Array(1089),cb=new Uint16Array(1089);function gM(o){return 0===o?-.03125:32===o?.03125:0}var Z0=Hn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let WO=(()=>{class o{constructor(a,u,d,m){this.id=o.uniqueIdxCounter,o.uniqueIdxCounter++,this.context=a;const _=a.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||m||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=o.uniqueIdxCounter,o.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return o.uniqueIdxCounter=0,o})();class X0{constructor(i,a,u){this.func=i,this.mask=a,this.range=u}}X0.ReadOnly=!1,X0.ReadWrite=!0,X0.disabled=new X0(519,X0.ReadOnly,[0,1]);class kE{constructor(i,a,u,d,m,_){this.test=i,this.ref=a,this.mask=u,this.fail=d,this.depthFail=m,this.pass=_}}kE.disabled=new kE({func:519,mask:0},0,0,7680,7680,7680);class io{constructor(i,a,u,d){this.blendFunction=i,this.blendColor=a,this.mask=u,this.blendEquation=d}}io.Replace=[1,0,1,0],io.disabled=new io(io.Replace,Jr.transparent,[!1,!1,!1,!1]),io.unblended=new io(io.Replace,Jr.transparent,[!0,!0,!0,!0]),io.alphaBlended=new io([1,771,1,771],Jr.transparent,[!0,!0,!0,!0]),io.alphaBlendedNonPremultiplied=new io([770,771,770,771],Jr.transparent,[!0,!0,!0,!0]),io.multiply=new io([774,0,774,0],Jr.transparent,[!0,!0,!0,!0]);class Vu{constructor(i,a,u){this.enable=i,this.mode=a,this.frontFace=u}}Vu.disabled=new Vu(!1,1029,2305),Vu.backCCW=new Vu(!0,1029,2305),Vu.backCW=new Vu(!0,1029,2304),Vu.frontCW=new Vu(!0,1028,2304),Vu.frontCCW=new Vu(!0,1028,2305);var _M=Hn([{name:"a_index",type:"Int16",components:1}]);const RE={type:2,extent:Ut,loadGeometry:()=>[[new $t(0,0),new $t(Ut+1,0),new $t(Ut+1,Ut+1),new $t(0,Ut+1),new $t(0,0)]]};class tg{constructor(i,a,u,d,m){this.tileID=i,this.uid=q_(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,d&&d.style&&(this._lastUpdatedBrightness=d.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(i){const a=i+this.timeAdded;a<aa.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ip(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,a,u){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(d,m){const _={};if(!m)return _;for(const b of d){const T=b.layerIds.map(S=>m.getLayer(S)).filter(Boolean);if(0!==T.length){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(S=>T.filter(A=>A.id===S)[0]));for(const S of T)_[S.fqid]=b}}return _}(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof W0){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof W0&&m.hasRTLText){this.hasRTLText=!0,Sr.isLoading()||Sr.isLoaded()||"deferred"!==Zn()||Ir();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d],_=a.style.getOwnLayer(d);if(!_)continue;const b=_.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,b)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new mT}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(i)}const a=i.gl,u=this.imageAtlas;if(u&&!u.uploaded){const d=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new Uu(i,u.image,a.RGBA,{useMipmap:d}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Uu(i,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Uu(i,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(i,a,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,u),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const d=a.style.getBrightness();(this._lastUpdatedBrightness||d)&&(this._lastUpdatedBrightness&&d&&Math.abs(this._lastUpdatedBrightness-d)<.001||(this._lastUpdatedBrightness=d,this.updateBuckets(void 0,a)))}queryRenderedFeatures(i,a,u,d,m,_,b,T){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:b,transform:_,params:m,tileTransform:this.tileTransform},i,a,u):{}}querySourceFeatures(i,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),m=a?a.sourceLayer:"",_=d._geojsonTileLayer||d[m];if(!_)return;const b=tu(a&&a.filter),{z:T,x:S,y:A}=this.tileID.canonical,k={z:T,x:S,y:A};for(let R=0;R<_.length;R++){const L=_.feature(R);if(b.needGeometry){const G=Lh(L,!0);if(!b.filter(new tr(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!b.filter(new tr(this.tileID.overscaledZ),L))continue;const U=u.getId(L,m),H=new PO(L,T,S,A,U);H.tile=k,i.push(H)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const u=_m(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const m=this.expirationTime-a;m?this.expirationTime=u+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(i).length&&a&&this.updateBuckets(i,a)}updateBuckets(i,a){if(!this.latestFeatureIndex)return;const u=this.latestFeatureIndex.loadVTLayers(),d=a.style.listImages(),m=a.style.getBrightness();for(const _ in this.buckets){if(!a.style.hasLayer(_))continue;const b=this.buckets[_],T=b.layers[0].sourceLayer||"_geojsonTileLayer",S=u[T];let A={};if(i&&(A=i[T],!S||!A||0===Object.keys(A).length))continue;if(b.update(A,S,d,this.imageAtlas&&this.imageAtlas.patternPositions||{},m),b instanceof Gx||b instanceof Mx){const R=a.style.getOwnSourceCache(b.layers[0].source);a._terrain&&a._terrain.enabled&&R&&b.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(R.id,this.tileID)}const k=a&&a.style&&a.style.getOwnLayer(_);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<aa.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=aa.now()+i}setTexture(i,a){const u=a.context,d=u.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture&&this.texture instanceof Uu?this.texture.update(i,{useMipmap:!0}):(this.texture=new Uu(u,i,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE))}setDependencies(i,a){const u={};for(const d of a)u[d]=!0;this.dependencies[i]=u}hasDependency(i,a){for(const u of i){const d=this.dependencies[u];if(d)for(const m of a)if(d[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const u=su(RE,this.tileID.canonical,this.tileTransform)[0],d=new Ll,m=new T1;for(let _=0;_<u.length;_++){const{x:b,y:T}=u[_];d.emplaceBack(b,T),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(m),this._tileDebugBuffer=i.createVertexBuffer(d,P1.members),this._tileDebugSegments=us.simpleSegment(0,0,d.length,m.length)}_makeTileBoundsBuffers(i,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const u=su(RE,this.tileID.canonical,this.tileTransform)[0];let d,m;if(this.isRaster){const _=function(b,T){const S=Ip(b,T),A=Math.pow(2,b.z);for(let G=0;G<33;G++)for(let Y=0;Y<33;Y++){const ue=Vl((b.x+(Y+gM(Y))/32)/A),ae=fo((b.y+(G+gM(G))/32)/A),he=T.project(ue,ae),ve=33*G+Y;Wh[2*ve+0]=Math.round((he.x*S.scale-S.x)*Ut),Wh[2*ve+1]=Math.round((he.y*S.scale-S.y)*Ut)}tf.fill(0),cb.fill(0);for(let G=2045;G>=0;G--){const Y=4*G,ue=Op[Y+0],ae=Op[Y+1],he=Op[Y+2],ve=Op[Y+3],we=ue+he>>1,Se=ae+ve>>1,Fe=we+Se-ae,Ge=Se+ue-we,tt=33*ae+ue,Ye=33*ve+he,ht=33*Se+we,Dt=Math.hypot((Wh[2*tt+0]+Wh[2*Ye+0])/2-Wh[2*ht+0],(Wh[2*tt+1]+Wh[2*Ye+1])/2-Wh[2*ht+1])>=16;tf[ht]=tf[ht]||(Dt?1:0),G<1022&&(tf[ht]=tf[ht]||tf[33*(ae+Ge>>1)+(ue+Fe>>1)]||tf[33*(ve+Ge>>1)+(he+Fe>>1)])}const k=new jd,R=new cs;let L=0;function U(G,Y){const ue=33*Y+G;return 0===cb[ue]&&(k.emplaceBack(Wh[2*ue+0],Wh[2*ue+1],G*Ut/32,Y*Ut/32),cb[ue]=++L),cb[ue]-1}function H(G,Y,ue,ae,he,ve){const we=G+ue>>1,Se=Y+ae>>1;if(Math.abs(G-he)+Math.abs(Y-ve)>1&&tf[33*Se+we])H(he,ve,G,Y,we,Se),H(ue,ae,he,ve,we,Se);else{const Fe=U(G,Y),Ge=U(ue,ae),tt=U(he,ve);R.emplaceBack(Fe,Ge,tt)}}return H(0,0,32,32,32,0),H(32,32,0,0,0,32),{vertices:k,indices:R}}(this.tileID.canonical,a);d=_.vertices,m=_.indices}else{d=new jd,m=new cs;for(const{x:b,y:T}of u)d.emplaceBack(b,T,0,0);const _=M0(d.int16,void 0,4);for(let b=0;b<_.length;b+=3)m.emplaceBack(_[b],_[b+1],_[b+2])}this._tileBoundsBuffer=i.createVertexBuffer(d,Z0.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(m),this._tileBoundsSegments=us.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugBuffers(i,a){const u=a.projection;if(!u||"globe"!==u.name||a.freezeTileCoverage)return;const d=this.tileID.canonical,m=N1(JS(d,a)),_=xp(a.zoom);let b;_>0&&(b=f.ae.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,d,a,m,b,_),this._makeGlobeTileDebugTextBuffer(i,d,a,m,b,_)}_globePoint(i,a,u,d,m,_,b){let T=wx(i,a,u);if(_){const S=1<<u.z,A=ac(d.center.lng),k=Fh(d.center.lat),R=(u.x+.5)/S-A;let L=0;R>.5?L=-1:R<-.5&&(L=1);let U=(i/Ut+u.x)/S+L,H=(a/Ut+u.y)/S;U=(U-A)*d._pixelsPerMercatorPixel+A,H=(H-k)*d._pixelsPerMercatorPixel+k;const G=[U*d.worldSize,H*d.worldSize,0];f.$.transformMat4(G,G,_),T=ja(T,G,b)}return f.$.transformMat4(T,T,m)}_makeGlobeTileDebugBorderBuffer(i,a,u,d,m,_){const b=new Ll,T=new T1,S=new fa,A=(R,L,U,H,G)=>{const Y=(U-R)/(G-1),ue=(H-L)/(G-1),ae=b.length;for(let he=0;he<G;he++){const ve=R+he*Y,we=L+he*ue;b.emplaceBack(ve,we);const Se=this._globePoint(ve,we,a,u,d,m,_);S.emplaceBack(Se[0],Se[1],Se[2]),T.emplaceBack(ae+he)}},k=Ut;A(0,0,k,0,16),A(k,0,k,k,16),A(k,k,0,k,16),A(0,k,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(T),this._tileDebugBuffer=i.createVertexBuffer(b,P1.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(S,rO.members),this._tileDebugSegments=us.simpleSegment(0,0,b.length,T.length)}_makeGlobeTileDebugTextBuffer(i,a,u,d,m,_){const b=Ut/4,T=new Ll,S=new cs,A=new fa,k=25;S.reserve(32),T.reserve(k),A.reserve(k);const R=(L,U)=>k*L+U;for(let L=0;L<k;L++){const U=L*b;for(let H=0;H<k;H++){const G=H*b;T.emplaceBack(G,U);const Y=this._globePoint(G,U,a,u,d,m,_);A.emplaceBack(Y[0],Y[1],Y[2])}}for(let L=0;L<4;L++)for(let U=0;U<4;U++){const H=R(L,U),G=R(L,U+1),Y=R(L+1,U),ue=R(L+1,U+1);S.emplaceBack(H,G,Y),S.emplaceBack(Y,G,ue)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(S),this._tileDebugTextBuffer=i.createVertexBuffer(T,P1.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(A,rO.members),this._tileDebugTextSegments=us.simpleSegment(0,0,k,32)}destroy(i=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof Uu&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function PE(o,i,a){var u,d;1===o?i.header_length=a.readFixed32():2===o?i.x=a.readVarint():3===o?i.y=a.readVarint():4===o?i.z=a.readVarint():5===o&&i.layers.push((u=a,d=a.readVarint()+a.pos,u.readFields(ub,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},d)))}function mL(o,i,a){var u,d;1===o?(i.delta_filter=(u=a,d=a.readVarint()+a.pos,u.readFields(yM,{block_size:0},d)),i.filter="delta_filter"):2===o?(a.readVarint(),i.filter="zigzag_filter"):3===o?(a.readVarint(),i.filter="bitshuffle_filter"):4===o&&(a.readVarint(),i.filter="byteshuffle_filter")}function yM(o,i,a){1===o&&(i.block_size=a.readVarint())}function vM(o,i,a){1===o?(a.readVarint(),i.codec="gzip_data"):2===o?(a.readVarint(),i.codec="jpeg_image"):3===o?(a.readVarint(),i.codec="webp_image"):4===o&&(a.readVarint(),i.codec="png_image")}function xM(o,i,a){var u,d;1===o?i.first_byte=a.readFixed64():2===o?i.last_byte=a.readFixed64():3===o?i.filters.push((u=a,d=a.readVarint()+a.pos,u.readFields(mL,{},d))):4===o?i.codec=function(u,d){return u.readFields(vM,{},d)}(a,a.readVarint()+a.pos):5===o?i.deprecated_offset=a.readFloat():6===o?i.deprecated_scale=a.readFloat():7===o?i.bands.push(a.readString()):8===o?i.offset=a.readDouble():9===o&&(i.scale=a.readDouble())}function ub(o,i,a){var u,d;1===o?i.version=a.readVarint():2===o?i.name=a.readString():3===o?i.units=a.readString():4===o?i.tilesize=a.readVarint():5===o?i.buffer=a.readVarint():6===o?i.pixel_format=a.readVarint():7===o&&i.data_index.push((u=a,d=a.readVarint()+a.pos,u.readFields(xM,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},d)))}function NE(o,i,a){if(2===o)u=a,d=a.readVarint()+a.pos,u.readFields(nf,i,d);else if(3===o)throw new Error("Not implemented");var u,d}function nf(o,i,a){if(1===o){let u=0;const d=a.readVarint()+a.pos;for(;a.pos<d;)i[u++]=a.readVarint()}}class qO{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const a=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,a),a}put(i,a){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,a)}}function ZO(o,i){if(4!==i.length)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let a=i[3];for(let u=2;u>=1;u--){const d=1===u?1:0,m=2===u?1:0;for(let _=0;_<i[0];_++){const b=i[1]*_;for(let T=d;T<i[1];T++){const S=i[2]*(T+b);for(let A=m;A<i[2];A++){const k=i[3]*(A+S);for(let R=0;R<i[3];R++){const L=k+R;o[L]+=o[L-a]}}}}a*=i[u]}return o}function FE(o){for(let i=0,a=o.length;i<a;i++)o[i]=o[i]>>>1^-(1&o[i]);return o}function XO(o,i){switch(i){case"uint32":return o;case"uint16":for(let a=0;a<o.length;a+=2){const u=o[a],d=o[a+1];o[a]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,o[a+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return o;case"uint8":for(let a=0;a<o.length;a+=4){const u=o[a],d=o[a+1],m=o[a+2],_=o[a+3];o[a+0]=(192&u)>>6|(192&d)>>4|(192&m)>>2|192&_,o[a+1]=(48&u)>>4|(48&d)>>2|48&m|(48&_)<<2,o[a+2]=(12&u)>>2|12&d|(12&m)<<2|(12&_)<<4,o[a+3]=3&u|(3&d)<<2|(3&m)<<4|(3&_)<<6}return o;default:throw new Error(`Invalid pixel format, "${i}"`)}}var ga=Uint8Array,Y0=Uint16Array,ng=Int32Array,rg=new ga([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hb=new ga([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),py=new ga([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),LE=function(o,i){for(var a=new Y0(31),u=0;u<31;++u)a[u]=i+=1<<o[u-1];var d=new ng(a[30]);for(u=1;u<30;++u)for(var m=a[u];m<a[u+1];++m)d[m]=m-a[u]<<5|u;return{b:a,r:d}},BE=LE(rg,2),bM=BE.b,YO=BE.r;bM[28]=258,YO[258]=28;for(var KO=LE(hb,0).b,wM=new Y0(32768),Vs=0;Vs<32768;++Vs){var K0=(43690&Vs)>>1|(21845&Vs)<<1;wM[Vs]=((65280&(K0=(61680&(K0=(52428&K0)>>2|(13107&K0)<<2))>>4|(3855&K0)<<4))>>8|(255&K0)<<8)>>1}var J0=function(o,i,a){for(var u=o.length,d=0,m=new Y0(i);d<u;++d)o[d]&&++m[o[d]-1];var _,b=new Y0(i);for(d=1;d<i;++d)b[d]=b[d-1]+m[d-1]<<1;_=new Y0(1<<i);var T=15-i;for(d=0;d<u;++d)if(o[d])for(var S=d<<4|o[d],A=i-o[d],k=b[o[d]-1]++<<A,R=k|(1<<A)-1;k<=R;++k)_[wM[k]>>T]=S;return _},my=new ga(288);for(Vs=0;Vs<144;++Vs)my[Vs]=8;for(Vs=144;Vs<256;++Vs)my[Vs]=9;for(Vs=256;Vs<280;++Vs)my[Vs]=7;for(Vs=280;Vs<288;++Vs)my[Vs]=8;var gy=new ga(32);for(Vs=0;Vs<32;++Vs)gy[Vs]=5;var JO=J0(my,9),TM=J0(gy,5),zE=function(o){for(var i=o[0],a=1;a<o.length;++a)o[a]>i&&(i=o[a]);return i},au=function(o,i,a){var u=i/8|0;return(o[u]|o[u+1]<<8)>>(7&i)&a},UE=function(o,i){var a=i/8|0;return(o[a]|o[a+1]<<8|o[a+2]<<16)>>(7&i)},QO=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],lu=function(o,i,a){var u=new Error(i||QO[o]);if(u.code=o,Error.captureStackTrace&&Error.captureStackTrace(u,lu),!a)throw u;return u},VE=new ga(0),EM=typeof TextDecoder<"u"&&new TextDecoder;try{EM.decode(VE,{stream:!0})}catch{}const _y={gzip_data:"gzip"};class ul extends Error{constructor(i){super(i),this.name="MRTError"}}const si={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},CM={uint32:1,uint16:2,uint8:4},eR={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let jE,Q0;class ig{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const a=this.layers[i];if(!a)throw new ul(`Layer '${i}' not found`);return a}getHeaderLength(i){const a=new Uint8Array(i),u=new DataView(i);if(13!==a[0])throw new ul("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(i){const a=new Uint8Array(i),u=this.getHeaderLength(i);if(a.length<u)throw new ul(`Expected header with length >= ${u} but got buffer of length ${a.length}`);const d=new jE(a.subarray(0,u)).readFields(PE,{header_length:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new ul(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const m of d.layers)this.layers[m.name]=new tR(m,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const a=[],u=this.getLayer(i.layerName);for(let d of i.blockIndices){const m=u.dataIndex[d],_=m.first_byte-i.firstByte,b=m.last_byte-i.firstByte;if(u._blocksInProgress.has(d))continue;const T={layerName:u.name,firstByte:_,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[m.bands.length].concat(u.bandShape),buffer:u.buffer,codec:m.codec.codec,filters:m.filters.map(S=>S.filter)};u._blocksInProgress.add(d),a.push(T)}return new nR(a,()=>{a.forEach(d=>u._blocksInProgress.delete(d.blockIndex))},(d,m)=>{if(a.forEach(_=>u._blocksInProgress.delete(_.blockIndex)),d)throw d;m.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class tR{constructor({version:i,name:a,units:u,tilesize:d,pixel_format:m,buffer:_,data_index:b},T){if(this.version=i,1!==this.version)throw new ul(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=a,this.units=u,this.tileSize=d,this.buffer=_,this.pixelFormat=si[m],this.dataIndex=b,this.bandShape=[d+2*_,d+2*_,CM[this.pixelFormat]],this._decodedBlocks=new qO(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return CM[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const a=i.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,i.data)}getBlockForBand(i){let a=0;switch(typeof i){case"string":for(const[u,d]of this.dataIndex.entries()){for(const[m,_]of d.bands.entries())if(_===i)return{bandIndex:a+m,blockIndex:u,blockBandIndex:m};a+=d.bands.length}break;case"number":for(const[u,d]of this.dataIndex.entries()){if(i>=a&&i<a+d.bands.length)return{bandIndex:i,blockIndex:u,blockBandIndex:i-a};a+=d.bands.length}break;default:throw new ul(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}throw new ul(`Band not found: ${JSON.stringify(i)}`)}getDataRange(i){let a=1/0,u=-1/0;const d=[],m=new Set;for(const _ of i){const{blockIndex:b}=this.getBlockForBand(_);if(b<0)throw new ul(`Invalid band: ${JSON.stringify(_)}`);const T=this.dataIndex[b];d.includes(b)||d.push(b),m.add(b),a=Math.min(a,T.first_byte),u=Math.max(u,T.last_byte)}if(m.size>this.cacheSize)throw new ul(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:u,blockIndices:d}}hasBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0}hasDataForBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(i){const{blockIndex:a,blockBandIndex:u}=this.getBlockForBand(i),d=this._decodedBlocks.get(a.toString());if(!d)throw new ul(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[a],_=this.bandShape.reduce((S,A)=>S*A,1),b=u*_,T=d.subarray(b,b+_);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:0!==m.offset?m.offset:m.deprecated_offset,scale:0!==m.scale?m.scale:m.deprecated_scale}}}ig.setPbf=function(o){jE=o};class nR{constructor(i,a,u){this.tasks=i,this._onCancel=a,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,a){this._finalized||(this._onComplete(i,a),this._finalized=!0)}}ig.performDecoding=function(o,i){const a=new Uint8Array(o);return Promise.all(i.tasks.map(u=>{const{layerName:d,firstByte:m,lastByte:_,pixelFormat:b,blockShape:T,blockIndex:S,filters:A,codec:k}=u,R=a.subarray(m,_+1),L=new Uint32Array(T[0]*T[1]*T[2]);let U;if("gzip_data"!==k)throw new ul(`Unhandled codec: ${k}`);return U=function(H,G){if(!globalThis.DecompressionStream&&"gzip_data"===G)return Promise.resolve(((he=function(Se){31==Se[0]&&139==Se[1]&&8==Se[2]||lu(6,"invalid gzip data");var Fe=Se[3],Ge=10;4&Fe&&(Ge+=2+(Se[10]|Se[11]<<8));for(var tt=(Fe>>3&1)+(Fe>>4&1);tt>0;tt-=!Se[Ge++]);return Ge+(2&Fe)}(ae=H))+8>ae.length&&lu(6,"invalid gzip data"),function(Se,Fe,Ge,tt){var Ye=Se.length;if(!Ye||Fe.f&&!Fe.l)return Ge||new ga(0);var ht=!Ge,Dt=ht||2!=Fe.i,dt=Fe.i;ht&&(Ge=new ga(3*Ye));var Nt,ut,vt=function(mg){var o_=Ge.length;if(mg>o_){var Zh=new ga(Math.max(2*o_,mg));Zh.set(Ge),Ge=Zh}},zt=Fe.f||0,ct=Fe.p||0,qt=Fe.b||0,Lt=Fe.l,Mt=Fe.d,In=Fe.m,_n=Fe.n,en=8*Ye;do{if(!Lt){zt=au(Se,ct,1);var Ht=au(Se,ct+1,3);if(ct+=3,!Ht){var Jn=Se[(lr=4+((ct+7)/8|0))-4]|Se[lr-3]<<8,bn=lr+Jn;if(bn>Ye){dt&&lu(0);break}Dt&&vt(qt+Jn),Ge.set(Se.subarray(lr,bn),qt),Fe.b=qt+=Jn,Fe.p=ct=8*bn,Fe.f=zt;continue}if(1==Ht)Lt=JO,Mt=TM,In=9,_n=5;else if(2==Ht){var cn=au(Se,ct,31)+257,ar=au(Se,ct+10,15)+4,fr=cn+au(Se,ct+5,31)+1;ct+=14;for(var hr=new ga(fr),yr=new ga(19),Ar=0;Ar<ar;++Ar)yr[py[Ar]]=au(Se,ct+3*Ar,7);ct+=3*ar;var Cr=zE(yr),bi=(1<<Cr)-1,wi=J0(yr,Cr);for(Ar=0;Ar<fr;){var lr,ri=wi[au(Se,ct,bi)];if(ct+=15&ri,(lr=ri>>4)<16)hr[Ar++]=lr;else{var oi=0,Vi=0;for(16==lr?(Vi=3+au(Se,ct,3),ct+=2,oi=hr[Ar-1]):17==lr?(Vi=3+au(Se,ct,7),ct+=3):18==lr&&(Vi=11+au(Se,ct,127),ct+=7);Vi--;)hr[Ar++]=oi}}var Ss=hr.subarray(0,cn),Ns=hr.subarray(cn);In=zE(Ss),_n=zE(Ns),Lt=J0(Ss,In),Mt=J0(Ns,_n)}else lu(1);if(ct>en){dt&&lu(0);break}}Dt&&vt(qt+131072);for(var hs=(1<<In)-1,es=(1<<_n)-1,po=ct;;po=ct){var js=(oi=Lt[UE(Se,ct)&hs])>>4;if((ct+=15&oi)>en){dt&&lu(0);break}if(oi||lu(2),js<256)Ge[qt++]=js;else{if(256==js){po=ct,Lt=null;break}var Ro=js-254;js>264&&(Ro=au(Se,ct,(1<<($u=rg[Ar=js-257]))-1)+bM[Ar],ct+=$u);var Fi=Mt[UE(Se,ct)&es],hl=Fi>>4;if(Fi||lu(3),ct+=15&Fi,Ns=KO[hl],hl>3){var $u=hb[hl];Ns+=UE(Se,ct)&(1<<$u)-1,ct+=$u}if(ct>en){dt&&lu(0);break}Dt&&vt(qt+131072);var uc=qt+Ro;if(qt<Ns){var Nc=0-Ns,Lp=Math.min(Ns,uc);for(Nc+qt<0&&lu(3);qt<Lp;++qt)Ge[qt]=(void 0)[Nc+qt]}for(;qt<uc;++qt)Ge[qt]=Ge[qt-Ns]}}Fe.l=Lt,Fe.p=po,Fe.b=qt,Fe.f=zt,Lt&&(zt=1,Fe.m=In,Fe.d=Mt,Fe.n=_n)}while(!zt);return qt!=Ge.length&&ht?(Nt=Ge,(null==(ut=qt)||ut>Nt.length)&&(ut=Nt.length),new ga(Nt.subarray(0,ut))):Ge.subarray(0,qt)}(ae.subarray(he,-8),{i:2},new ga(((Y=ae)[(ue=Y.length)-4]|Y[ue-3]<<8|Y[ue-2]<<16|Y[ue-1]<<24)>>>0))));var Y,ue,ae,he;const ve=_y[G];if(!ve)throw new Error(`Unhandled codec: ${G}`);const we=new globalThis.DecompressionStream(ve);return new Response(new Blob([H]).stream().pipeThrough(we)).arrayBuffer().then(Se=>new Uint8Array(Se))}(R,k).then(H=>(new jE(H).readFields(NE,L),new eR[b](L.buffer))),U.then(H=>{for(let G=A.length-1;G>=0;G--)switch(A[G]){case"delta_filter":ZO(H,T);break;case"zigzag_filter":FE(H);break;case"bitshuffle_filter":XO(H,b);break;default:throw new ul(`Unhandled filter "${A[G]}"`)}return{layerName:d,blockIndex:S,data:H}}).catch(H=>{throw H})}))},ig.setPbf(ny);class rR extends tg{constructor(i,a,u,d,m){super(i,a,u,d,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,a){const u=a.context,d=u.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture&&this.texture instanceof Uu?this.texture.update(i,{useMipmap:!1,premultiply:!1}):this.texture=new Uu(u,i,d.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,a){const u=this._mrt=new ig(30),d=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=Pa(d,(m,_,b,T)=>{if(m)a(m);else try{const S=u.getHeaderLength(_);if(S>i)return void(this.request=this.fetchHeader(S,a));u.parseHeader(_),this._isHeaderLoaded=!0;let A=0;for(const k of Object.values(u.layers))A=Math.max(A,k.dataIndex[k.dataIndex.length-1].last_byte);_.byteLength>=A&&(this.entireBuffer=_),a(null,this.entireBuffer||_,b,T)}catch(S){a(S)}}),this.request}fetchBand(i,a,u){const d=this._mrt;if(!this._isHeaderLoaded||!d)return void u(new Error("Tile header is not ready"));const m=this.actor;if(!m)return void u(new Error("Can't fetch tile band without an actor"));let _;const b=(k,R)=>{_.complete(k,R),k?u(k):(this.updateTextureDescriptor(i,a),u(null,this.textureDescriptor&&this.textureDescriptor.img))},T=(k,R)=>{if(k)return u(k);const L=m.send("decodeRasterArray",{buffer:R,task:_},b,void 0,!0);this._workQueue.push(()=>{L&&L.cancel(),_.cancel()})},S=d.getLayer(i);if(!S)return void u(new Error(`Unknown sourceLayer "${i}"`));if(S.hasDataForBand(a))return this.updateTextureDescriptor(i,a),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const A=S.getDataRange([a]);if(_=d.createDecodingTask(A),!_||_.tasks.length)if(this.flushQueues(),this.entireBuffer)T(null,this.entireBuffer.slice(A.firstByte,A.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${A.firstByte}-${A.lastByte}`}}),R=Pa(k,T);this._fetchQueue.push(()=>{R.cancel(),_.cancel()})}else u(null)}updateNeeded(i,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==i)&&"errored"!==this.state}updateTextureDescriptor(i,a){if(!this._mrt)return;const u=this._mrt.getLayer(i);if(!u||!u.hasBand(a)||!u.hasDataForBand(a))return;const{bytes:d,tileSize:m,buffer:_,offset:b,scale:T}=u.getBandView(a),S=m+2*_,A={data:d,width:S,height:S},k=this.texture;k&&k instanceof Uu&&k.update(A,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:i,band:a,img:A,buffer:_,offset:b,tileSize:m,format:u.pixelFormat,mix:[T,256*T,65536*T,16777216*T]}}}class iR{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,u){const d=i.wrapped().key;void 0===this.data[d]&&(this.data[d]=[]);const m={value:a,timeout:void 0};if(void 0!==u&&(m.timeout=setTimeout(()=>{this.remove(i,m)},u)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const u=i.wrapped().key,d=void 0===a?0:this.data[u].indexOf(a),m=this.data[u][d];return this.data[u].splice(d,1),m.timeout&&clearTimeout(m.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const u in this.data)for(const d of this.data[u])i(d.value)||a.push(d);for(const u of a)this.remove(u.value.tileID,u)}}class sg extends Uf{constructor(i,a,u){super(),this.id=i,this._onlySymbols=u,a.on("data",d=>{"source"===d.dataType&&"metadata"===d.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===d.dataType&&"content"===d.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new iR(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new fL,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const a=this._tiles[i];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,a){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(i),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return kf(this._tiles).map(i=>i.tileID).sort(sR).map(i=>i.key)}getRenderableIds(i,a){const u=[];for(const d in this._tiles)this._isIdRenderable(+d,i,a)&&u.push(this._tiles[d]);return i?u.sort((d,m)=>{const _=d.tileID,b=m.tileID,T=new $t(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),S=new $t(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-b.overscaledZ||S.y-T.y||S.x-T.x}).map(d=>d.tileID.key):u.map(d=>d.tileID).sort(sR).map(d=>d.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a,u){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())&&(u||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,a){const u=this._tiles[i];u&&("loading"!==u.state&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,i,a)))}_tileLoaded(i,a,u,d){if(d)if(i.state="errored",404!==d.status)this._source.fire(new e0(d,{tile:i}));else{if(this._source.fire(new Yc("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=aa.now(),"expired"===u&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Yc("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const a=this.getRenderableIds();for(let d=0;d<a.length;d++){const m=a[d];if(i.neighboringTiles&&i.neighboringTiles[m]){const _=this.getTileByID(m);u(i,_),u(_,i)}}function u(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-d.tileID.canonical.x;const b=m.tileID.canonical.y-d.tileID.canonical.y,T=Math.pow(2,d.tileID.canonical.z),S=m.tileID.key;0===_&&0===b||Math.abs(b)>1||(Math.abs(_)>1&&(1===Math.abs(_+T)?_+=T:1===Math.abs(_-T)&&(_-=T)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,_,b),d.neighboringTiles&&d.neighboringTiles[S]&&(d.neighboringTiles[S].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,u,d){for(const m in this._tiles){let _=this._tiles[m];if(d[m]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>u)continue;let b=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const S=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[S.key],_&&_.hasData()&&(b=S)}let T=b;for(;T.overscaledZ>a;)if(T=T.scaledTo(T.overscaledZ-1),i[T.key]){d[b.key]=b;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const u=this._loadedParentTiles[i.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=i.overscaledZ-1;u>=a;u--){const d=i.scaledTo(u),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,a){a=a||this._source.tileSize;const u=Math.ceil(i.width/a)+1,d=Math.ceil(i.height/a)+1,m=Math.floor(u*d*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(b)}handleWrapJump(i){const a=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,a){const u={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),u[m.tileID.key]=m}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(i,a,u,d){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(i,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const m="batched-model"===this._source.type;let _;if(this.used||this.usedForTerrain){if(this._source.tileID)_=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new ro(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y));else if(0!==this.tileCoverLift){const S=i.clone();S.tileCoverLift=this.tileCoverLift,_=S.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:m}),this._source.minzoom<=1&&"globe"===i.projection.name&&(_.push(new ro(1,0,1,0,0)),_.push(new ro(1,0,1,1,0)),_.push(new ro(1,0,1,0,1)),_.push(new ro(1,0,1,1,1)))}else if(_=i.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:m}),this._source.hasTile){const S=this._source.hasTile.bind(this._source);_=_.filter(A=>S(A))}}else _=[];if(_.length>0&&this.castsShadows&&d&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!$E(this._source.type)){const S=i.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),A=Math.min(S,this._source.maxzoom);if(m){const k=i.extendTileCover(_,A);for(const R of k)_.push(R)}else{const k=i.extendTileCover(_,A,d);for(const R of k)this._shadowCasterTiles[R.key]=!0,_.push(R)}}const b=this._updateRetainedTiles(_);if($E(this._source.type)&&0!==_.length){const S={},A={},k=Object.keys(b);for(const L of k){const U=b[L],H=this._tiles[L];if(!H||H.fadeEndTime&&H.fadeEndTime<=aa.now())continue;const G=this.findLoadedParent(U,Math.max(U.overscaledZ-sg.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),S[G.tileID.key]=G.tileID),A[L]=U}const R=_[_.length-1].overscaledZ;for(const L in this._tiles){const U=this._tiles[L];if(b[L]||!U.hasData())continue;let H=U.tileID;for(;H.overscaledZ>R;){H=H.scaledTo(H.overscaledZ-1);const G=this._tiles[H.key];if(G&&G.hasData()&&A[H.key]){b[L]=U.tileID;break}}}for(const L in S)b[L]||(this._coveredTiles[L]=!0,b[L]=S[L])}for(const S in b)this._tiles[S].clearFadeHold();const T=function(S,A){const k=[];for(const R in S)R in A||k.push(R);return k}(this._tiles,b);for(const S of T){const A=this._tiles[S];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const a={};if(0===i.length)return a;const u={},d=i.reduce((S,A)=>Math.min(S,A.overscaledZ),1/0),m=i[0].overscaledZ,_=Math.max(m-sg.maxOverzooming,this._source.minzoom),b=Math.max(m+sg.maxUnderzooming,this._source.minzoom),T={};for(const S of i){const A=this._addTile(S);a[S.key]=S,A.hasData()||d<this._source.maxzoom&&(T[S.key]=S)}this._retainLoadedChildren(T,d,b,a);for(const S of i){let A=this._tiles[S.key];if(A.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const R=S.children(this._source.maxzoom)[0],L=this.getTile(R);if(L&&L.hasData()){a[R.key]=R;continue}}else{const R=S.children(this._source.maxzoom);if(a[R[0].key]&&a[R[1].key]&&a[R[2].key]&&a[R[3].key])continue}let k=A.wasRequested();for(let R=S.overscaledZ-1;R>=_;--R){const L=S.scaledTo(R);if(u[L.key]||(u[L.key]=!0,A=this.getTile(L),!A&&k&&(A=this._addTile(L)),A&&(a[L.key]=L,k=A.wasRequested(),A.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let u,d=this._tiles[i].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}a.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;d=m}for(const m of a)this._loadedParentTiles[m]=u}}_addTile(i){let a=this._tiles[i.key];if(a)return!0!==a.isExtraShadowCaster||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const u=!!a;if(!u){const d=this.map?this.map.painter:null,m=this._source.tileSize*i.overscaleFactor();a="raster-array"===this._source.type?new rR(i,m,this.transform.tileZoom,d,this._isRaster):new tg(i,m,this.transform.tileZoom,d,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))}return a?(a.uses++,this._tiles[i.key]=a,u||this._source.fire(new Yc("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const u=a.getExpiryTimeout();u&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},u))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&"reloading"!==a.state||"empty"===a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,a,u){const d=[],m=this.transform;if(!m)return d;const _="globe"===m.projection.name,b=ac(m.center.lng);for(const T in this._tiles){const S=this._tiles[T];if(u&&S.clearQueryDebugViz(),S.holdingForFade())continue;let A;if(_){const k=S.tileID.canonical;if(0===k.z){const R=[Math.abs(vr(b,...db(k,-1))-b),Math.abs(vr(b,...db(k,1))-b)];A=[0,2*R.indexOf(Math.min(...R))-1]}else{const R=[Math.abs(vr(b,...db(k,-1))-b),Math.abs(vr(b,...db(k,0))-b),Math.abs(vr(b,...db(k,1))-b)];A=[R.indexOf(Math.min(...R))-1]}}else A=[0];for(const k of A){const R=i.containsTile(S,m,a,k);R&&d.push(R)}}return d}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,a){const u=this.getRenderableIds(i,a).map(m=>this._tiles[m].tileID),d="globe"===this.transform.projection.name;for(const m of u)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=d?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return u}sortCoordinatesByDistance(i){const a=i.slice(),u=this.transform._camera.position,d=this.transform._camera.forward(),m={};for(const _ of a){const b=1/(1<<_.canonical.z);m[_.key]=((_.canonical.x+.5)*b+_.wrap-u[0])*d[0]+((_.canonical.y+.5)*b-u[1])*d[1]-u[2]*d[2]}return a.sort((_,b)=>m[_.key]-m[b.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if($E(this._source.type))for(const i in this._tiles){const a=this._tiles[i];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=aa.now())return!0}return!1}setFeatureState(i,a,u){this._state.updateState(i=i||"_geojsonTileLayer",a,u)}removeFeatureState(i,a,u){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,u)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,u){const d=this._tiles[i];d&&d.setDependencies(a,u)}reloadTilesForDependencies(i,a){for(const u in this._tiles)this._tiles[u].hasDependency(i,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(i,a))}_preloadTiles(i,a){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(i,a))};return void this._source.on("data",b)}const u=new Map,d=Array.isArray(i)?i:[i],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const b of d){const T=b.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of T)u.set(S.key,S);this.usedForTerrain&&b.updateElevation(!1)}$g(Array.from(u.values()),(b,T)=>{const S=new tg(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,A=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),T(A,S)})},a)}}function sR(o,i){const a=Math.abs(2*o.wrap)-+(o.wrap<0),u=Math.abs(2*i.wrap)-+(i.wrap<0);return o.overscaledZ-i.overscaledZ||u-a||i.canonical.y-o.canonical.y||i.canonical.x-o.canonical.x}function $E(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function db(o,i){const a=1<<o.z;return[o.x/a+i,(o.x+1)/a+i]}sg.maxOverzooming=10,sg.maxUnderzooming=3;const SM=()=>Q0||(Q0={layout:aE||(aE=new Pi({"line-cap":new fn(Qe.layout_line["line-cap"]),"line-join":new fn(Qe.layout_line["line-join"]),"line-miter-limit":new Pt(Qe.layout_line["line-miter-limit"]),"line-round-limit":new Pt(Qe.layout_line["line-round-limit"]),"line-sort-key":new fn(Qe.layout_line["line-sort-key"]),"line-z-offset":new fn(Qe.layout_line["line-z-offset"]),visibility:new Pt(Qe.layout_line.visibility)})),paint:$D||($D=new Pi({"line-opacity":new fn(Qe.paint_line["line-opacity"]),"line-color":new fn(Qe.paint_line["line-color"]),"line-translate":new Pt(Qe.paint_line["line-translate"]),"line-translate-anchor":new Pt(Qe.paint_line["line-translate-anchor"]),"line-width":new fn(Qe.paint_line["line-width"]),"line-gap-width":new fn(Qe.paint_line["line-gap-width"]),"line-offset":new fn(Qe.paint_line["line-offset"]),"line-blur":new fn(Qe.paint_line["line-blur"]),"line-dasharray":new fn(Qe.paint_line["line-dasharray"]),"line-pattern":new fn(Qe.paint_line["line-pattern"]),"line-gradient":new Ba(Qe.paint_line["line-gradient"]),"line-trim-offset":new Pt(Qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Pt(Qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Pt(Qe.paint_line["line-trim-color"]),"line-emissive-strength":new Pt(Qe.paint_line["line-emissive-strength"]),"line-border-width":new fn(Qe.paint_line["line-border-width"]),"line-border-color":new fn(Qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Pt(Qe.paint_line["line-occlusion-opacity"])}))},Q0);class oR extends fn{possiblyEvaluate(i,a){return a=new tr(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(i,a)}evaluate(i,a,u,d){return a=$o({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(i,a,u,d)}}let yy,fb,e_,vy;function xy(o,i){return i>0?i+2*o:o}class HE{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Na,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pe(HE,"FormatSectionOverride",{omit:["defaultValue"]});const og=()=>vy||(vy={layout:fb||(fb=new Pi({"symbol-placement":new Pt(Qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(Qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(Qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fn(Qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(Qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Pt(Qe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Pt(Qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pt(Qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(Qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(Qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new fn(Qe.layout_symbol["icon-size"]),"icon-text-fit":new fn(Qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new fn(Qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new fn(Qe.layout_symbol["icon-image"]),"icon-rotate":new fn(Qe.layout_symbol["icon-rotate"]),"icon-padding":new Pt(Qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(Qe.layout_symbol["icon-keep-upright"]),"icon-offset":new fn(Qe.layout_symbol["icon-offset"]),"icon-anchor":new fn(Qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(Qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(Qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(Qe.layout_symbol["text-rotation-alignment"]),"text-field":new fn(Qe.layout_symbol["text-field"]),"text-font":new fn(Qe.layout_symbol["text-font"]),"text-size":new fn(Qe.layout_symbol["text-size"]),"text-max-width":new fn(Qe.layout_symbol["text-max-width"]),"text-line-height":new fn(Qe.layout_symbol["text-line-height"]),"text-letter-spacing":new fn(Qe.layout_symbol["text-letter-spacing"]),"text-justify":new fn(Qe.layout_symbol["text-justify"]),"text-radial-offset":new fn(Qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(Qe.layout_symbol["text-variable-anchor"]),"text-anchor":new fn(Qe.layout_symbol["text-anchor"]),"text-max-angle":new Pt(Qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(Qe.layout_symbol["text-writing-mode"]),"text-rotate":new fn(Qe.layout_symbol["text-rotate"]),"text-padding":new Pt(Qe.layout_symbol["text-padding"]),"text-keep-upright":new Pt(Qe.layout_symbol["text-keep-upright"]),"text-transform":new fn(Qe.layout_symbol["text-transform"]),"text-offset":new fn(Qe.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(Qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pt(Qe.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(Qe.layout_symbol["text-optional"]),visibility:new Pt(Qe.layout_symbol.visibility)})),paint:e_||(e_=new Pi({"icon-opacity":new fn(Qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new fn(Qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new fn(Qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new fn(Qe.paint_symbol["text-emissive-strength"]),"icon-color":new fn(Qe.paint_symbol["icon-color"]),"icon-halo-color":new fn(Qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new fn(Qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fn(Qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(Qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(Qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new fn(Qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new fn(Qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new fn(Qe.paint_symbol["text-occlusion-opacity"]),"text-color":new fn(Qe.paint_symbol["text-color"],{runtimeType:rl,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new fn(Qe.paint_symbol["text-halo-color"]),"text-halo-width":new fn(Qe.paint_symbol["text-halo-width"]),"text-halo-blur":new fn(Qe.paint_symbol["text-halo-blur"]),"text-translate":new Pt(Qe.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(Qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Pt(Qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Pt(Qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Pt(Qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Pt(Qe.paint_symbol["icon-color-brightness-max"])}))},vy);class by extends Fl{constructor(i,a,u,d){super(i,og(),a,u,d),this._colorAdjustmentMatrix=f.ae.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==i.paint&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,a){super.recalculate(i,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const m of u)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,a,u,d){return this._saturation===i&&this._contrast===a&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=function(m,_,b,T){m=_h(m),_=Pv(_);const S=f.ae.create(),A=m/3,k=1-2*A,R=[k,A,A,0,A,k,A,0,A,A,k,0,0,0,0,1],L=.5-.5*_,U=T-b;return f.ae.multiply(S,[U,0,0,0,0,U,0,0,0,0,U,0,b,b,b,1],[_,0,0,0,0,_,0,0,0,0,_,0,L,L,L,1]),f.ae.multiply(S,S,R),S}(i,a,u,d),this._saturation=i,this._contrast=a,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,a,u,d){const m=this.layout.get(i).evaluate(a,{},u,d),_=this._unevaluatedLayout._values[i];return _.isDataDriven()||ce(_.value)||!m?m:(b=a.properties,m.replace(/{([^{}]+)}/g,(S,A)=>A in b?String(b[A]):""));var b}createBucket(i){return new W0(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of og().paint.overridableProperties){if(!by.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),u=new HE(a),d=new se(u,a.property.specification,this.scope,this.options);let m=null;m="constant"===a.value.kind||"source"===a.value.kind?new be("source",d):new _e("composite",d,a.value.zoomStops,a.value._interpolationType),this.paint._values[i]=new Ao(a.property,m,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&by.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const u=i.get("text-field"),d=og().paint.properties[a];let m=!1;const _=b=>{for(const T of b)if(d.overrides&&d.overrides.hasOverride(T))return void(m=!0)};if("constant"===u.value.kind&&u.value.value instanceof Go)_(u.value.value.sections);else if("source"===u.value.kind){const b=S=>{m||(S instanceof Kc&&rr(S.value)===Gf?_(S.value.sections):S instanceof kd?_(S.sections):S.eachChild(b))},T=u.value;T._styleExpression&&b(T._styleExpression.expression)}return m}getProgramIds(){const i=0!==this.paint.get("icon-opacity").constantOr(1),a=0!==this.paint.get("text-opacity").constantOr(1),u=[];return i&&u.push("symbolIcon"),a&&u.push("symbolSDF"),u}getDefaultProgramParams(i,a,u){return{config:new no(this,{zoom:a,lut:u}),overrideFog:!1}}}let DM,t_,GE,WE;function wy(o,i,a,u,d,m,_,b){const T=[o,i,1,a,u,1,d,m,1],S=[_,b,1],A=f.bE.adjoint([],T),[k,R,L]=f.$.transformMat3(S,S,A);return f.bE.multiply(T,T,[k,0,0,0,R,0,0,0,L])}function qE(o,i,a,u,d,m,_,b){const T=function(S,A,k,R,L,U,H,G){const Y=wy(0,0,1,0,1,1,0,1),ue=wy(S,A,k,R,L,U,H,G),ae=f.bE.adjoint([],Y);return f.bE.multiply(ue,ue,ae)}(o,i,a,u,d,m,_,b);return[T[2]/T[8]/Ut,T[5]/T[8]/Ut]}function pb(o){return[o[0],Math.min(Math.max(o[1],-Us),Us)]}class MM extends Uf{constructor(i,a,u,d){super(),this.id=i,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=a,this._dirty=!1}load(i,a){if(this._loaded=a||!1,this.fire(new Yc("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=Ad(this.map._requestManager.transformRequest(this.url,Nf.Image),(u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new e0(u)):d&&(this.image=d instanceof HTMLImageElement?aa.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new q0(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Yc("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof q0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=i[0][1],u=i[0][1];for(const m of i)m[1]>u&&(u=m[1]),m[1]<a&&(a=m[1]);const d=(u+a)/2;if(d>Us?this.onNorthPole=!0:d<-Us&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=i.map(pa.fromLngLat);this.tileID=function(_){let b=1/0,T=1/0,S=-1/0,A=-1/0;for(const H of _)b=Math.min(b,H.x),T=Math.min(T,H.y),S=Math.max(S,H.x),A=Math.max(A,H.y);const k=Math.max(S-b,A-T),R=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),L=Math.pow(2,R);let U=Math.floor((b+S)/2*L);return U>1&&(U-=1),new gp(R,U,Math.floor((T+A)/2*L))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Yc("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const G in this.tiles){const Y=this.tiles[G];"loaded"!==Y.state&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=Ip(new gp(0,0,0),this.map.transform.projection),u=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(G){const Y=G[1].x-G[0].x,ue=G[1].y-G[0].y,ae=G[2].x-G[1].x,he=G[2].y-G[1].y,ve=G[3].x-G[2].x,we=G[3].y-G[2].y,Se=G[0].x-G[3].x,Fe=G[0].y-G[3].y,Ge=Y*he-ae*ue,tt=ae*we-ve*he,Ye=ve*Fe-Se*we,ht=Se*ue-Y*Fe;return Ge>0&&tt>0&&Ye>0&&ht>0||Ge<0&&tt<0&&Ye<0&&ht<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=Ip(this.tileID,this.map.transform.projection),[m,_,b,T]=this.coordinates.map(G=>{const Y=d.projection.project(G[0],G[1]);return qr(d,Y)._round()});this.perspectiveTransform=qE(m.x,m.y,_.x,_.y,b.x,b.y,T.x,T.y);const S=this._boundsArray=new jd;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(_.x,_.y,Ut,0),S.emplaceBack(T.x,T.y,0,Ut),S.emplaceBack(b.x,b.y,Ut,Ut),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(S,Z0.members),this.boundsSegments=us.simpleSegment(0,0,4,2);const A=[],k=[pb((G=this.coordinates)[0]),pb(G[1]),pb(G[2]),pb(G[3])],[R,L,U,H]=function(G){let Y=G[0][0],ue=Y,ae=G[0][1],he=ae;for(let ve=1;ve<G.length;ve++)G[ve][0]<Y?Y=G[ve][0]:G[ve][0]>ue&&(ue=G[ve][0]),G[ve][1]<ae?ae=G[ve][1]:G[ve][1]>he&&(he=G[ve][1]);return[Y,ae,ue-Y,he-ae]}(k);var G;{const G=new jd,[Y,ue,ae,he]=function(ut){let vt=ut[0].x,zt=vt,ct=ut[0].y,qt=ct;for(let Lt=1;Lt<ut.length;Lt++)ut[Lt].x<vt?vt=ut[Lt].x:ut[Lt].x>zt&&(zt=ut[Lt].x),ut[Lt].y<ct?ct=ut[Lt].y:ut[Lt].y>qt&&(qt=ut[Lt].y);return[vt,ct,zt-vt,qt-ct]}(u),ve=ut=>[(ut.x-Y)/ae,(ut.y-ue)/he],[we,Se,Fe,Ge]=u.map(ve),tt=function(ut,vt,zt,ct,qt,Lt,Mt,In){const _n=wy(0,0,1,0,1,1,0,1),en=wy(ut,vt,zt,ct,qt,Lt,Mt,In),Ht=f.bE.adjoint([],en);return f.bE.multiply(_n,_n,Ht)}(we[0],we[1],Se[0],Se[1],Fe[0],Fe[1],Ge[0],Ge[1]);this.elevatedGlobePerspectiveTransform=qE(we[0],we[1],Se[0],Se[1],Fe[0],Fe[1],Ge[0],Ge[1]);const Ye=(ut,vt)=>{A.push(ut.lng);const zt=Math.round((ut.lng-R)/U*Ut),ct=Math.round((ut.lat-L)/H*Ut),qt=ve(vt),Lt=f.$.transformMat3([],[qt[0],qt[1],1],tt),Mt=Math.round(Lt[0]/Lt[2]*Ut),In=Math.round(Lt[1]/Lt[2]*Ut);G.emplaceBack(zt,ct,Mt,In)},ht=u[3].x-u[0].x,Dt=u[3].y-u[0].y,dt=u[2].x-u[1].x,Nt=u[2].y-u[1].y;for(let ut=0;ut<65;ut++){const vt=ut/64,zt=[u[0].x+vt*ht,u[0].y+vt*Dt],ct=[u[1].x+vt*dt,u[1].y+vt*Nt],qt=ct[0]-zt[0],Lt=ct[1]-zt[1];for(let Mt=0;Mt<65;Mt++){const In=Mt/64,_n={x:zt[0]+qt*In,y:zt[1]+Lt*In,z:0};Ye(a.projection.unproject(_n.x,_n.y),_n)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(G,Z0.members)}{this.maxLongitudeTriangleSize=0;let G=[],Y=new cs;const ue=(ae,he,ve)=>{Y.emplaceBack(ae,he,ve);const we=A[ae],Se=A[he],Fe=A[ve],Ge=Math.min(Math.min(we,Se),Fe),tt=Math.max(Math.max(we,Se),Fe)-Ge;tt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=tt),G.push(Ge+tt/2)};for(let ae=0;ae<64;ae++)for(let he=0;he<64;he++){const ve=65*ae+he,we=ve+1,Se=ve+65,Fe=Se+1;ue(ve,Se,we),ue(we,Se,Fe)}[G,Y]=function(ae,he){const ve=Array.from({length:ae.length},(Fe,Ge)=>Ge);ve.sort((Fe,Ge)=>ae[Fe]-ae[Ge]);const we=[],Se=new cs;for(let Fe=0;Fe<ve.length;Fe++){const Ge=ve[Fe];we.push(ae[Ge]);const tt=3*Ge,Ye=tt+1;Se.emplaceBack(he.uint16[tt],he.uint16[Ye],he.uint16[Ye+1])}return[we,Se]}(G,Y),this.elevatedGlobeTrianglesCenterLongitudes=G,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(Y)}this.elevatedGlobeSegments=us.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,U/Ut,0,H/Ut,0,0,L,R,0])}prepare(){const i=0!==Object.keys(this.tiles).length;if(this.tileID&&!i)return;const a=this.map.painter.context,u=a.gl;!this._dirty||this.texture instanceof q0||(this.texture?this.texture.update(this.image):(this.texture=new Uu(a,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(a)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let d=(m=i+180)+360*Math.round((u[0]-m)/360);var m;const _=new us,b=(k,R)=>{_.segments.push({vertexOffset:0,primitiveOffset:k,vertexLength:a.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=T){const k=Yg(u,0,u.length,d+T);return k===u.length||b(k,Xg(u,k+1,u.length,d+360-T)-k),_}d<u[0]&&(d+=360);const S=Xg(u,0,u.length,d-T);if(S===u.length)return b(0,u.length),_;b(0,S-0);const A=Yg(u,S+1,u.length,d+T);return A!==u.length&&b(A,u.length-A),_}}const aR=(Math.pow(256,2)-1)/16907520;class n_ extends Fl{constructor(i,a,u,d){super(i,{layout:GE||(GE=new Pi({visibility:new Pt(Qe.layout_raster.visibility)})),paint:WE||(WE=new Pi({"raster-opacity":new Pt(Qe.paint_raster["raster-opacity"]),"raster-color":new Ba(Qe.paint_raster["raster-color"]),"raster-color-mix":new Pt(Qe.paint_raster["raster-color-mix"]),"raster-color-range":new Pt(Qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Pt(Qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(Qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(Qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(Qe.paint_raster["raster-saturation"]),"raster-contrast":new Pt(Qe.paint_raster["raster-contrast"]),"raster-resampling":new Pt(Qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(Qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Pt(Qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Pt(Qe.paint_raster["raster-array-band"]),"raster-elevation":new Pt(Qe.paint_raster["raster-elevation"])}))},a,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof MM&&(i._source.onNorthPole||i._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(i){"raster-color"!==i&&"raster-color-range"!==i||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=Oo({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let AM,IM,kM,Ty,ZE;class XE extends Fl{constructor(i,a,u,d){super(i,{layout:AM||(AM=new Pi({visibility:new Pt(Qe["layout_raster-particle"].visibility)})),paint:IM||(IM=new Pi({"raster-particle-array-band":new Pt(Qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Pt(Qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ba(Qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Pt(Qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Pt(Qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Pt(Qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Pt(Qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Pt(Qe["paint_raster-particle"]["raster-particle-elevation"])}))},a,u,d),this._updateColorRamp(),this.lastInvalidatedAt=aa.now()}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){"raster-particle-color"!==i&&"raster-particle-max-speed"!==i||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===i&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Oo({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=aa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class OM extends Fl{constructor(i,a){super(i,{},a,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(i){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function YE(o,i,a){const u=[0,0,1],d=f.aw.identity([]);return f.aw.rotateY(d,d,a?-Dr(o)+Math.PI:Dr(o)),f.aw.rotateX(d,d,-Dr(i)),f.$.transformQuat(u,u,d),f.$.normalize(u,u)}function KE(o,i){const a=ag(o.projection,o.zoom,o.width,o.height),u=function(m,_,b,T,S){const A=new kr(b.lng-180*Rp,b.lat),k=new kr(b.lng+180*Rp,b.lat),R=m.project(A.lng,A.lat),L=m.project(k.lng,k.lat),U=-Math.atan2(L.y-R.y,L.x-R.x),H=pa.fromLngLat(b);H.y=vr(H.y,-1+Rp,1-Rp);const G=H.toLngLat(),Y=m.project(G.lng,G.lat),ue=pa.fromLngLat(G);ue.x+=Rp;const ae=ue.toLngLat(),he=m.project(ae.lng,ae.lat),ve=PM(he.x-Y.x,he.y-Y.y,U),we=pa.fromLngLat(G);we.y+=Rp;const Se=we.toLngLat(),Fe=m.project(Se.lng,Se.lat),Ge=PM(Fe.x-Y.x,Fe.y-Y.y,U),tt=Math.abs(ve.x)/Math.abs(Ge.y),Ye=f.ae.identity([]);f.ae.rotateZ(Ye,Ye,-U*(1-(S?0:T)));const ht=f.ae.identity([]);return f.ae.scale(ht,ht,[1,1-(1-tt)*T,1]),ht[4]=-Ge.x/Ge.y*T,f.ae.rotateZ(ht,ht,U),f.ae.multiply(ht,Ye,ht),ht}(o.projection,0,o.center,a,i),d=mb(o);return f.ae.scale(u,u,[d,d,1]),u}function mb(o){const i=o.projection,a=ag(o.projection,o.zoom,o.width,o.height),u=RM(i,o.center),d=RM(i,kr.convert(i.center));return Math.pow(2,u*a+(1-a)*d)}function ag(o,i,a,u,d=1/0){const m=o.range;if(!m)return 0;const _=Math.min(d,Math.max(a,u)),b=Math.log(_/1024)/Math.LN2;return jg(m[0]+b,m[1]+b,i)}const Rp=1/4e4;function RM(o,i){const a=vr(i.lat,-Us,Us),u=new kr(i.lng-180*Rp,a),d=new kr(i.lng+180*Rp,a),m=o.project(u.lng,a),_=o.project(d.lng,a),b=pa.fromLngLat(u),T=pa.fromLngLat(d),S=_.x-m.x,A=_.y-m.y,k=T.x-b.x,R=T.y-b.y,L=Math.sqrt((k*k+R*R)/(S*S+A*A));return Math.log(L)/Math.LN2}function PM(o,i,a){const u=Math.cos(a),d=Math.sin(a);return{x:o*u-i*d,y:o*d+i*u}}function NM(o,i,a){f.ae.identity(o),f.ae.rotateZ(o,o,Dr(i[2])),f.ae.rotateX(o,o,Dr(i[0])),f.ae.rotateY(o,o,Dr(i[1])),f.ae.scale(o,o,a),f.ae.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function gb(o,i,a,u,d,m,_,b){const T=[a[0]-i[0],a[1]-i[1],0],S=[u[0]-i[0],u[1]-i[1],0];if(f.$.length(T)<1e-12||f.$.length(S)<1e-12)return f.aw.identity(o);const A=f.$.cross([],T,S);f.$.normalize(A,A),f.$.subtract(S,u,i),T[2]=(m-d)*b,S[2]=(_-d)*b;const k=T;return f.$.cross(k,T,S),f.$.normalize(k,k),f.aw.rotationTo(o,A,k)}function JE(o,i,a=!1){const u=xp(i.zoom),d=function(m,_,b){const T=_.worldSize,S=[m[12],m[13],m[14]],A=fo(S[1]/T),k=Vl(S[0]/T),R=f.ae.identity([]),L=ko(1,A)*T,U=ko(1,0)*T*_p(A,_.zoom),H=1/Di(T);let G=U*H;if(b){const he=ag(_.projection,_.zoom,_.width,_.height,1024);G=H*_.projection.pixelSpaceConversion(_.center.lat,T,he)}const Y=mp(A,k);f.$.add(Y,Y,f.$.scale([],f.$.normalize([],Y),L*G*S[2]));const ue=function(he){const ve=[he[0],he[1],he[2]];let we=[0,1,0];const Se=f.$.cross([],we,ve);return f.$.cross(we,ve,Se),0===f.$.squaredLength(we)&&(we=[0,1,0],f.$.cross(Se,ve,we)),f.$.normalize(Se,Se),f.$.normalize(we,we),f.$.normalize(ve,ve),[Se[0],Se[1],Se[2],0,we[0],we[1],we[2],0,ve[0],ve[1],ve[2],0,he[0],he[1],he[2],1]}(Y);f.ae.scale(R,R,[G,G,G*L]),f.ae.translate(R,R,[-S[0],-S[1],-S[2]]);const ae=f.ae.multiply([],_.globeMatrix,ue);return f.ae.multiply(ae,ae,R),f.ae.multiply(ae,ae,m),ae}(o,i,a);return u>0?function(_,b,T){const S=(U,H,G)=>{const Y=f.$.length(U),ue=f.$.length(H),ae=ja(U,H,G);return f.$.scale(ae,ae,1/f.$.length(ae)*Fn(Y,ue,G))},A=S([_[0],_[1],_[2]],[b[0],b[1],b[2]],T),k=S([_[4],_[5],_[6]],[b[4],b[5],b[6]],T),R=S([_[8],_[9],_[10]],[b[8],b[9],b[10]],T),L=ja([_[12],_[13],_[14]],[b[12],b[13],b[14]],T);return[A[0],A[1],A[2],0,k[0],k[1],k[2],0,R[0],R[1],R[2],0,L[0],L[1],L[2],1]}(d,function(_,b){const T=b.worldSize,S=ko(1,0)*T*_p(b.center.lat,b.zoom)/Di(T),A=ko(1,b.center.lat)*T,k=f.ae.identity([]);return f.ae.rotateY(k,k,Dr(b.center.lng)),f.ae.rotateX(k,k,Dr(b.center.lat)),f.ae.translate(k,k,[0,0,Va]),f.ae.scale(k,k,[S,S,S*A]),f.ae.translate(k,k,[b.point.x-.5*T,b.point.y-.5*T,0]),f.ae.multiply(k,k,_),f.ae.multiply(k,b.globeMatrix,k)}(o,i),u):d}function _b(o,i,a,u){const d=Yi.projectAabbCorners(u,a);let m=Number.MAX_VALUE,_=-1;for(let S=0;S<d.length;++S){const A=d[S];A[0]=(.5*A[0]+.5)*i.width,A[1]=(.5-.5*A[1])*i.height,A[2]<m&&(_=S,m=A[2])}const b=S=>new $t(d[S][0],d[S][1]);let T;switch(_){case 0:case 6:T=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:T=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:T=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:T=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(Gd(o,T))return m}const Ey=Hn([{name:"a_pos_3f",components:3,type:"Float32"}]),FM=Hn([{name:"a_color_3f",components:3,type:"Float32"}]),LM=Hn([{name:"a_color_4f",components:4,type:"Float32"}]),lR=Hn([{name:"a_uv_2f",components:2,type:"Float32"}]),Cy=Hn([{name:"a_normal_3f",components:3,type:"Float32"}]),yb=Hn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),gL=Hn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class vb{constructor(i,a,u,d){this.message=(i?`${i}: `:"")+u,d&&(this.identifier=d),null!=a&&a.__line__&&(this.line=a.__line__)}}function QE(o,i){const a=-1===o.indexOf("://");try{return new URL(o,a&&i?"http://example.com":void 0),!0}catch{return!1}}class xb{constructor(i,a){this.feature=i,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class BM{constructor(){this.instancedDataArray=new cx,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class bb{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=i.projection,this.index=i.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(i,a){}populate(i,a,u,d){this.tileToMeter=Oc(u);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:b,index:T,sourceLayerIndex:S}of i){const A=b??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),k=Lh(_,m);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),k,u))continue;const R={id:A,sourceLayerIndex:S,index:T,geometry:m?k.geometry:su(_,u,d),properties:_.properties,type:_.type,patterns:{}},L=this.addFeature(R,R.geometry,k);L&&a.featureIndex.insert(_,R.geometry,T,S,this.index,this.instancesPerModel[L].instancedDataArray.length,Ut/32)}this.lookup=null}update(i,a,u,d){for(const m in this.instancesPerModel){const _=this.instancesPerModel[m];for(const b in i)_.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(_.features[_.idToFeaturesIndex[b]],i[b],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];for(const d of u.features){const m=this.layers[0],_=d.feature,b=this.canonical,T=m.paint.get("model-rotation").evaluate(_,{},b),S=m.paint.get("model-scale").evaluate(_,{},b),A=m.paint.get("model-translation").evaluate(_,{},b);f.$.exactEquals(d.rotation,T)&&f.$.exactEquals(d.scale,S)&&f.$.exactEquals(d.translation,A)||(this.evaluate(d,d.featureStates,u,!0),i=!0)}}return i}updateReplacement(i,a,u,d){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const m=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(XT(this.activeReplacements,m))return!1;this.activeReplacements=m;let _=!1;for(const b in this.instancesPerModel){const T=this.instancesPerModel[b],S=T.instancedDataArray;for(const A of T.features){const k=A.instancedDataOffset,R=A.instancedDataCount;for(let L=0;L<R;L++){const U=16*(L+k);let H=S.float32[U+0];H=H>Ut?H-Ut:H;const G=Math.floor(H),Y=S.float32[U+1];let ue=!1;for(const ae of this.activeReplacements)if(!yD(ae,u,QT.Model,d)&&!(ae.min.x>G||G>ae.max.x||ae.min.y>Y||Y>ae.max.y)&&(ue=vO(xD(G,Y,i.canonical,ae.footprintTileId.canonical),ae),ue))break;S.float32[U]=ue?H+Ut:H,_=_||ue}}}return _}isEmpty(){for(const i in this.instancesPerModel)if(0!==this.instancesPerModel[i].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length<0||0===u.instancedDataArray.length||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=i.createVertexBuffer(u.instancedDataArray,yb.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];0!==u.instancedDataArray.length&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris)for(const a of this.modelUris)i.removeModel(a,"")}addFeature(i,a,u){const d=this.layers[0],m=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!m)return ks(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),m;QE(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new BM);const _=this.instancesPerModel[m],b=_.instancedDataArray,T=new xb(u,b.length);for(const S of a)for(const A of S){if(A.x<0||A.x>=Ut||A.y<0||A.y>=Ut)continue;const k=(this.lookupDim-1)/Ut,R=this.lookupDim*(A.y*k|0)+A.x*k|0;if(this.lookup){if(0!==this.lookup[R])continue;this.lookup[R]=1}this.instanceCount++;const L=b.length;b.resize(L+1),_.instancesEvaluatedElevation.push(0),b.float32[16*L]=A.x,b.float32[16*L+1]=A.y}return T.instancedDataCount=_.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(i.id&&(_.idToFeaturesIndex[i.id]=_.features.length),_.features.push(T),this.evaluate(T,{},_,!1)),m}getModelUris(){return this.modelUris}evaluate(i,a,u,d){const m=this.layers[0],_=i.feature,b=this.canonical,T=i.rotation=m.paint.get("model-rotation").evaluate(_,a,b),S=i.scale=m.paint.get("model-scale").evaluate(_,a,b),A=i.translation=m.paint.get("model-translation").evaluate(_,a,b),k=m.paint.get("model-color").evaluate(_,a,b);k.a=m.paint.get("model-color-mix-intensity").evaluate(_,a,b);const R=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),NM(R,T,S);const L=Math.round(100*k.a)+k.b/1.05;for(let U=0;U<i.instancedDataCount;++U){const H=i.instancedDataOffset+U,G=16*H,Y=u.instancedDataArray.float32;let ue=0;d&&(ue=Y[G+6]-u.instancesEvaluatedElevation[H]);const ae=0|Y[G+1];Y[G]=(0|Y[G])+k.r/1.05,Y[G+1]=ae+k.g/1.05,Y[G+2]=L,Y[G+3]=1/(b.z>10?this.tileToMeter:Oc(b,ae)),Y[G+4]=A[0],Y[G+5]=A[1],Y[G+6]=A[2]+ue,Y[G+7]=R[0],Y[G+8]=R[1],Y[G+9]=R[2],Y[G+10]=R[4],Y[G+11]=R[5],Y[G+12]=R[6],Y[G+13]=R[8],Y[G+14]=R[9],Y[G+15]=R[10],u.instancesEvaluatedElevation[H]=A[2]}}}let zM,e2;Pe(bb,"ModelBucket",{omit:["layers"]}),Pe(BM,"PerModelAttributes"),Pe(xb,"ModelFeature");const lg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function wb(o,i,a,u,d,m,_,b,T,S=!1){const A=a.zoom,k=a.project(u),R=_p(u.lat,A),L=1/R;f.ae.identity(o),f.ae.translate(o,o,[k.x+_[0]*L,k.y+_[1]*L,_[2]]);let U=1,H=1;const G=a.worldSize;if(S){if("mercator"===a.projection.name){let he=0;a.elevation&&(he=a.elevation.getAtPointOrZero(new pa(k.x/G,k.y/G),0));const ve=f.aB.transformMat4([],[k.x,k.y,he,1],a.projMatrix)[3]/a.cameraToCenterDistance;U=ve,H=ve*_p(a.center.lat,A)}else if("globe"===a.projection.name){const he=JE(o,a),ve=f.ae.multiply([],a.projMatrix,he),we=[0,0,0,1];f.aB.transformMat4(we,we,ve);const Se=we[3]/a.cameraToCenterDistance,Fe=xp(A),Ge=a.projection.pixelsPerMeter(u.lat,G)*_p(u.lat,A),tt=a.projection.pixelsPerMeter(a.center.lat,G)*_p(a.center.lat,A);U=Se/Fn(Ge,TT(a.center.lat),Fe),H=Se*R/Ge,U*=tt,H*=tt}}else U=L;f.ae.scale(o,o,[U,U,H]);const Y=[...o],ue=i.orientation,ae=[];if(NM(ae,[ue[0]+d[0],ue[1]+d[1],ue[2]+d[2]],m),f.ae.multiply(o,Y,ae),b&&a.elevation){let he=0;const ve=[];if(T&&a.elevation){he=function(Fe,Ge,tt,Ye,ht){const Dt=Ge.elevation;if(!Dt)return 0;const dt=Yi.projectAabbCorners(tt,Ye),Nt=ko(1,ht.lat)*Ge.worldSize,ut=function(Jn,bn){const cn=[0,0,1],ar=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const fr of ar){const hr=Jn[fr.corners[0]],yr=Jn[fr.corners[1]],Ar=Jn[fr.corners[2]],Cr=[yr[0]-hr[0],yr[1]-hr[1],bn*(yr[2]-hr[2])],bi=f.$.cross(Cr,Cr,[Ar[0]-hr[0],Ar[1]-hr[1],bn*(Ar[2]-hr[2])]);f.$.normalize(bi,bi),fr.dotProductWithUp=f.$.dot(bi,cn)}return ar.sort((fr,hr)=>fr.dotProductWithUp-hr.dotProductWithUp),ar[0].corners}(dt,Nt),vt=dt[ut[0]],zt=dt[ut[1]],ct=dt[ut[2]],qt=dt[ut[3]],Lt=Dt.getAtPointOrZero(new pa(vt[0]/Ge.worldSize,vt[1]/Ge.worldSize),0),Mt=Dt.getAtPointOrZero(new pa(zt[0]/Ge.worldSize,zt[1]/Ge.worldSize),0),In=Dt.getAtPointOrZero(new pa(ct[0]/Ge.worldSize,ct[1]/Ge.worldSize),0),_n=Dt.getAtPointOrZero(new pa(qt[0]/Ge.worldSize,qt[1]/Ge.worldSize),0),en=(Lt+_n)/2,Ht=(Mt+In)/2;return en>Ht?Mt<In?gb(Fe,zt,qt,vt,Mt,_n,Lt,Nt):gb(Fe,ct,vt,qt,In,Lt,_n,Nt):Lt<_n?gb(Fe,vt,zt,ct,Lt,Mt,In,Nt):gb(Fe,qt,ct,zt,_n,In,Mt,Nt),Math.max(en,Ht)}(ve,a,i.aabb,o,u);const we=f.ae.fromQuat([],ve),Se=f.ae.multiply([],we,ae);f.ae.multiply(o,Y,Se)}else he=a.elevation.getAtPointOrZero(new pa(k.x/G,k.y/G),0);0!==he&&(o[14]+=he)}}function Sy(o,i,a=!1){o.uploaded||(o.gfxTexture=new Uu(i,o.image,a?i.gl.R8:i.gl.RGBA,{useMipmap:o.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function cR(o,i,a){o.indexBuffer=i.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=i.createVertexBuffer(o.vertexArray,Ey.members,!1,!0),o.normalArray&&(o.normalBuffer=i.createVertexBuffer(o.normalArray,Cy.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=i.createVertexBuffer(o.texcoordArray,lR.members,!1,!0)),o.colorArray&&(o.colorBuffer=i.createVertexBuffer(o.colorArray,(12===o.colorArray.bytesPerElement?FM:LM).members,!1,!0)),o.featureArray&&(o.pbrBuffer=i.createVertexBuffer(o.featureArray,gL.members,!0)),o.segments=us.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const u=o.material;u.pbrMetallicRoughness.baseColorTexture&&Sy(u.pbrMetallicRoughness.baseColorTexture,i),u.pbrMetallicRoughness.metallicRoughnessTexture&&Sy(u.pbrMetallicRoughness.metallicRoughnessTexture,i),u.normalTexture&&Sy(u.normalTexture,i),u.occlusionTexture&&Sy(u.occlusionTexture,i,a),u.emissionTexture&&Sy(u.emissionTexture,i)}function t2(o,i,a){if(o.meshes)for(const u of o.meshes)cR(u,i,a);if(o.children)for(const u of o.children)t2(u,i,a)}function Tb(o){if(o.meshes)for(const i of o.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(o.children)for(const i of o.children)Tb(i)}function n2(o){if(o.meshes)for(const a of o.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((i=a.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(o.children)for(const a of o.children)n2(a)}class uR{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class r2{constructor(){this.tasks={},this.taskQueue=[],Gg(["process"],this),this.invoker=new uR(this.process),this.nextId=0}add(i,a){const u=this.nextId++,d=function({type:m,isSymbolTile:_,zoom:b}){return b=b||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-b:"maybePrepare"===m&&_?400-b:500:200-b:100-b}(a);if(0===d){try{i()}finally{}return null}return this.tasks[u]={fn:i,metadata:a,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<a&&(a=m.priority,i=d)}if(null===i)return null;const u=this.taskQueue[i];return this.taskQueue.splice(i,1),u}remove(){this.invoker.remove()}}class UM{constructor(i,a,u){this.target=i,this.parent=a,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Gg(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new r2}send(i,a,u,d,m=!1,_){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=_,this.callbacks[b]=u);const T=new Set;return this.target.postMessage({id:b,type:i,hasCallback:!!u,targetMapId:d,mustQueue:m,sourceMapId:this.mapId,data:He(a,T)},T),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(i){const a=i.data,u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if("<cancel>"===a.type){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(a.mustQueue||gm()){const d=this.callbacks[u],m=this.scheduler.add(()=>this.processTask(u,a),d&&d.metadata||{type:"message"});m&&(this.cancelCallbacks[u]=m)}else this.processTask(u,a)}processTask(i,a){if(delete this.cancelCallbacks[i],"<response>"===a.type){const u=this.callbacks[i];delete this.callbacks[i],u&&(a.error?u(nt(a.error)):u(null,nt(a.data)))}else{const u=new Set,d=a.hasCallback?(_,b)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?He(_):null,data:He(b,u)},u)}:_=>{},m=nt(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,m,d);else if(this.parent.getWorkerSource){const _=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,_[0],m.source,m.scope)[_[1]](m,d)}else d(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let i2=(()=>{class o{constructor(a,u){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=q_();const d=this.workerPool.acquire(this.id);for(let m=0;m<d.length;m++){const _=new o.Actor(d[m],u,this.id);_.name=`Worker ${m}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,u,d){$g(this.actors,(m,_)=>{m.send(a,u,_)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}return o.Actor=UM,o})();var Dy={workerUrl:"",workerClass:null,workerParams:void 0};function cg(){return null!=Dy.workerClass?new Dy.workerClass:new self.Worker(Dy.workerUrl,Dy.workerParams)}const ug="mapboxgl_preloaded_worker_pool";class hg{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<hg.workerCount;)this.workers.push(new cg);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&0===this.numActive()&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ug]}numActive(){return Object.keys(this.active).length}}let dg;function Eb(){return dg||(dg=new hg),dg}hg.workerCount=2;let rf,Cb,ju,r_,s2,i_=null;function VM(){return gm()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Cb||qn.DRACO_URL}function o2(){if(gm()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(r_)return r_;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return r_=WebAssembly.validate(o)?qn.MESHOPT_SIMD_URL:qn.MESHOPT_URL,r_}const Sb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},jM={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Np={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function $M(o,i,a){const u=a.json.bufferViews.length,d=a.buffers.length;i.bufferView=u,a.json.bufferViews[u]={buffer:d,byteLength:o.byteLength},a.buffers[d]=o}const a2="KHR_draco_mesh_compression";function HM(o,i){const a=o.extensions&&o.extensions[a2];if(!a)return;const u=new ju.Decoder,d=l2(i,a.bufferView),m=new ju.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,m))throw new Error("Failed to decode Draco mesh");const _=i.json.accessors[o.indices],b=Sb[_.componentType],T=_.count*b.BYTES_PER_ELEMENT,S=ju._malloc(T);b===Uint16Array?u.GetTrianglesUInt16Array(m,T,S):u.GetTrianglesUInt32Array(m,T,S),$M(ju.memory.buffer.slice(S,S+T),_,i),ju._free(S);for(const A of Object.keys(a.attributes)){const k=u.GetAttributeByUniqueId(m,a.attributes[A]),R=i.json.accessors[o.attributes[A]],L=jM[R.componentType],U=R.count*Np[R.type]*Sb[R.componentType].BYTES_PER_ELEMENT,H=ju._malloc(U);u.GetAttributeDataArrayForAllPoints(m,k,ju[L],U,H),$M(ju.memory.buffer.slice(H,H+U),R,i),ju._free(H)}u.destroy(),m.destroy(),delete o.extensions[a2]}const Db="EXT_meshopt_compression";function hR(o,i){if(!o.extensions||!o.extensions[Db])return;const a=o.extensions[Db],u=new Uint8Array(i.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),d=new Uint8Array(a.count*a.byteStride);s2.decodeGltfBuffer(d,a.count,a.byteStride,u,a.mode,a.filter),o.buffer=i.buffers.length,o.byteOffset=0,i.buffers[o.buffer]=d.buffer,delete o.extensions[Db]}const Fp=1179937895,fg=new TextDecoder("utf8");function s_(o,i){return new URL(o,i).href}function _L(o,i,a,u){return fetch(s_(o.uri,u)).then(d=>d.arrayBuffer()).then(d=>{i.buffers[a]=d})}function l2(o,i){const a=o.json.bufferViews[i];return new Uint8Array(o.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function dR(o,i,a,u){if(o.uri){const d=s_(o.uri,u);return fetch(d).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{i.images[a]=m})}if(void 0!==o.bufferView){const d=l2(i,o.bufferView),m=new Blob([d],{type:o.mimeType});return createImageBitmap(m).then(_=>{i.images[a]=_})}}function c2(o,i=0,a){const u={json:null,images:[],buffers:[]};if(new Uint32Array(o,i,1)[0]===Fp){const A=new Uint32Array(o,i);let k=2;const R=(A[k++]>>2)-3,L=A[k++]>>2;if(k++,u.json=JSON.parse(fg.decode(A.subarray(k,k+L))),k+=L,k<R){const U=A[k++];k++;const H=i+(k<<2);u.buffers[0]=o.slice(H,H+U)}}else u.json=JSON.parse(fg.decode(new Uint8Array(o,i)));const{buffers:d,images:m,meshes:_,extensionsUsed:b,bufferViews:T}=u.json;let S=Promise.resolve();if(d){const A=[];for(let k=0;k<d.length;k++){const R=d[k];R.uri?A.push(_L(R,u,k,a)):u.buffers[k]||(u.buffers[k]=null)}S=Promise.all(A)}return S.then(()=>{const A=[],k=b&&b.includes(a2),R=b&&b.includes(Db);if(k&&A.push(function(){if(!ju)return rf||(rf=function(L){let U,H=null;function G(){U=new Uint8Array(H.buffer)}function Y(){throw new Error("Unexpected Draco error.")}const ue={a:{a:Y,d:function(ae,he,ve){return U.copyWithin(ae,he,he+ve)},c:function(ae){const he=U.length,ve=Math.max(ae>>>0,Math.ceil(1.2*he)),we=Math.ceil((ve-he)/65536);try{return H.grow(we),G(),!0}catch{return!1}},b:Y}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,ue):L.then(ae=>ae.arrayBuffer()).then(ae=>WebAssembly.instantiate(ae,ue))).then(ae=>{const{Rb:he,Qb:ve,P:we,T:Se,X:Fe,Ja:Ge,La:tt,Qa:Ye,Va:ht,Wa:Dt,eb:dt,jb:Nt,f:ut,e:vt,yb:zt,zb:ct,Ab:qt,Bb:Lt,Db:Mt,Gb:In}=ae.instance.exports;H=vt;const _n=(()=>{let en=0,Ht=0,Jn=0,bn=0;return cn=>{Jn&&(he(bn),he(en),Ht+=Jn,Jn=en=0),en||(Ht+=128,en=ve(Ht));const ar=cn.length+7&-8;let fr=en;ar>=Ht&&(Jn=ar,fr=bn=ve(ar));for(let hr=0;hr<cn.length;hr++)U[fr+hr]=cn[hr];return fr}})();return G(),ut(),{memory:vt,_free:he,_malloc:ve,Mesh:class{constructor(){this.ptr=we()}destroy(){Se(this.ptr)}},Decoder:class{constructor(){this.ptr=Ge()}destroy(){Nt(this.ptr)}DecodeArrayToMesh(en,Ht,Jn){const bn=_n(en),cn=tt(this.ptr,bn,Ht,Jn.ptr);return!!Fe(cn)}GetAttributeByUniqueId(en,Ht){return{ptr:Ye(this.ptr,en.ptr,Ht)}}GetTrianglesUInt16Array(en,Ht,Jn){ht(this.ptr,en.ptr,Ht,Jn)}GetTrianglesUInt32Array(en,Ht,Jn){Dt(this.ptr,en.ptr,Ht,Jn)}GetAttributeDataArrayForAllPoints(en,Ht,Jn,bn,cn){dt(this.ptr,en.ptr,Ht.ptr,Jn,bn,cn)}},DT_INT8:zt(),DT_UINT8:ct(),DT_INT16:qt(),DT_UINT16:Lt(),DT_UINT32:Mt(),DT_FLOAT32:In()}})}(fetch(VM())),rf.then(L=>{ju=L,rf=void 0}))}()),R&&A.push(function(){if(s2)return;const L=function(U){let H;const G=WebAssembly.instantiateStreaming(U,{}).then(ae=>{H=ae.instance,H.exports.__wasm_call_ctors()}),Y={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ue={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:G,supported:!0,decodeGltfBuffer(ae,he,ve,we,Se,Fe){!function(Ge,tt,Ye,ht,Dt,dt,Nt){const ut=Ge.exports.sbrk,vt=ht+3&-4,zt=ut(vt*Dt),ct=ut(dt.length),qt=new Uint8Array(Ge.exports.memory.buffer);qt.set(dt,ct);const Lt=tt(zt,ht,Dt,ct,dt.length);if(0===Lt&&Nt&&Nt(zt,vt,Dt),Ye.set(qt.subarray(zt,zt+ht*Dt)),ut(zt-ut(0)),0!==Lt)throw new Error(`Malformed buffer data: ${Lt}`)}(H,H.exports[ue[Se]],ae,he,ve,we,H.exports[Y[Fe]])}}}(fetch(o2()));return L.ready.then(()=>{s2=L})}()),m)for(let L=0;L<m.length;L++)A.push(dR(m[L],u,L,a));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(k&&_)for(const{primitives:L}of _)for(const U of L)HM(U,u);if(R&&_&&T)for(const L of T)hR(L,u);return u})})}function pg(o,i){const a=o.json.bufferViews[i.bufferView],u=Sb[i.componentType];return new u(o.buffers[a.buffer],(i.byteOffset||0)+(a.byteOffset||0),i.count*(a.byteStride&&a.byteStride!==Np[i.type]*u.BYTES_PER_ELEMENT?a.byteStride/u.BYTES_PER_ELEMENT:Np[i.type]))}function Mb(o,i,a,u){const d=Sb[i.componentType],m=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(d),_=o.json.bufferViews[i.bufferView],b=_.byteStride?_.byteStride/d.BYTES_PER_ELEMENT:Np[i.type],T=a.float32,S=T.length/a.capacity;for(let A=0,k=0;A<i.count*b;A+=b,k+=S)for(let R=0;R<S;R++)T[k+R]=u[A+R]*m;a._trim()}function yL(o,i,a){const u=o.indices,d=o.attributes,m={};m.indexArray=new cs;const _=i.json.accessors[u],b=_.count/3;m.indexArray.reserve(b);const T=pg(i,_);for(let R=0;R<b;R++)m.indexArray.emplaceBack(T[3*R],T[3*R+1],T[3*R+2]);m.indexArray._trim(),m.vertexArray=new cp;const S=i.json.accessors[d.POSITION];m.vertexArray.reserve(S.count);const A=pg(i,S);for(let R=0;R<S.count;R++)m.vertexArray.emplaceBack(A[3*R],A[3*R+1],A[3*R+2]);if(m.vertexArray._trim(),m.aabb=new Yi(S.min,S.max),m.centroid=function(R,L){const U=[0,0,0],H=R.length;if(H>0){for(let G=0;G<H;G++){const Y=3*R[G];U[0]+=L[Y],U[1]+=L[Y+1],U[2]+=L[Y+2]}U[0]/=H,U[1]/=H,U[2]/=H}return U}(T,A),void 0!==d.COLOR_0){const R=i.json.accessors[d.COLOR_0],L=Np[R.type],U=pg(i,R);m.colorArray=3===L?new cp:new Io,m.colorArray.resize(R.count),Mb(i,R,m.colorArray,U)}if(void 0!==d.NORMAL){m.normalArray=new cp;const R=i.json.accessors[d.NORMAL];m.normalArray.resize(R.count);const L=pg(i,R);Mb(i,R,m.normalArray,L)}if(void 0!==d.TEXCOORD_0&&a.length>0){m.texcoordArray=new E1;const R=i.json.accessors[d.TEXCOORD_0];m.texcoordArray.resize(R.count);const L=pg(i,R);Mb(i,R,m.texcoordArray,L)}if(void 0!==d._FEATURE_ID_RGBA4444){const R=i.json.accessors[d._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=pg(i,R))}void 0!==d._FEATURE_RGBA4444&&(m.featureData=new Uint32Array(pg(i,i.json.accessors[d._FEATURE_RGBA4444]).buffer));const k=o.material;return m.material=function(R,L){const{emissiveFactor:U=[0,0,0],alphaMode:H="OPAQUE",alphaCutoff:G=.5,normalTexture:Y,occlusionTexture:ue,emissiveTexture:ae,doubleSided:he}=R,{baseColorFactor:ve=[1,1,1,1],metallicFactor:we=1,roughnessFactor:Se=1,baseColorTexture:Fe,metallicRoughnessTexture:Ge}=R.pbrMetallicRoughness||{},tt=ue?L[ue.index]:void 0;if(ue&&ue.extensions&&ue.extensions.KHR_texture_transform&&tt){const Ye=ue.extensions.KHR_texture_transform;tt.offsetScale=[Ye.offset[0],Ye.offset[1],Ye.scale[0],Ye.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Jr(...ve),metallicFactor:we,roughnessFactor:Se,baseColorTexture:Fe?L[Fe.index]:void 0,metallicRoughnessTexture:Ge?L[Ge.index]:void 0},doubleSided:he,emissiveFactor:U,alphaMode:H,alphaCutoff:G,normalTexture:Y?L[Y.index]:void 0,occlusionTexture:tt,emissionTexture:ae?L[ae.index]:void 0,defined:void 0===R.defined}}(void 0!==k?i.json.materials[k]:{defined:!1},a),m}function GM(o,i,a){const{matrix:u,rotation:d,translation:m,scale:_,mesh:b,extras:T,children:S}=o,A={};if(A.matrix=u||f.ae.fromRotationTranslationScale([],d||[0,0,0,1],m||[0,0,0],_||[1,1,1]),void 0!==b){A.meshes=a[b];const k=A.anchor=[0,0];for(const R of A.meshes){const{min:L,max:U}=R.aabb;k[0]+=L[0]+U[0],k[1]+=L[1]+U[1]}k[0]=Math.floor(k[0]/A.meshes.length/2),k[1]=Math.floor(k[1]/A.meshes.length/2)}if(T&&(T.id&&(A.id=T.id),T.lights&&(A.lights=function(k){if(!k.length)return[];const R=function(Y){const ue=atob(Y),ae=new Uint8Array(ue.length);for(let he=0;he<ue.length;he++)ae[he]=ue.codePointAt(he);return ae}(k),L=[],U=R.length/24,H=new Uint16Array(R.buffer),G=new Float32Array(R.buffer);for(let Y=0;Y<U;Y++){const ue=H[2*Y*6]/30,ae=H[2*Y*6+1]/30,he=H[2*Y*6+10]/100,ve=G[6*Y+1],we=G[6*Y+2],Se=G[6*Y+3],Fe=G[6*Y+4],Ge=Se-ve,tt=Fe-we,Ye=Math.hypot(Ge,tt);L.push({pos:[ve+.5*Ge,we+.5*tt,ae],normal:[tt/Ye,-Ge/Ye,0],width:Ye,height:ue,depth:he,points:[ve,we,Se,Fe]})}return L}(T.lights))),S){const k=[];for(const R of S)k.push(GM(i.json.nodes[R],i,a));A.children=k}return A}function Ab(o){if(0===o.vertices.length||0===o.indices.length)return null;const i=new Tp(o.vertices,o.indices,8,256),[a,u]=[i.min.clone(),i.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:i,min:a,max:u}}function u2(o){if(!o.extras||!o.extras.ground)return null;const i=o.extras.ground;if(!i||!Array.isArray(i)||0===i.length)return null;const a=i[0];if(!a||!Array.isArray(a)||0===a.length)return null;const u=[];for(const _ of a){if(!Array.isArray(_)||2!==_.length)continue;const b=_[0],T=_[1];"number"==typeof b&&"number"==typeof T&&u.push(new $t(b,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let _=0;_<u.length;_++){const b=u[_],T=u[(_+1)%u.length],S=u[(_+2)%u.length];d+=(b.x-T.x)*(S.y-T.y)-(S.x-T.x)*(b.y-T.y)}d>0&&u.reverse();const m=M0(u.flatMap(_=>[_.x,_.y]),[]);return 0===m.length?null:{vertices:u,indices:m}}function qh(o,i){const a=[],u=[];let d=0;const m=[];for(const _ of o){d=a.length;const b=_.vertexArray.float32,T=_.indexArray.uint16;for(let S=0;S<_.vertexArray.length;S++)m[0]=b[3*S+0],m[1]=b[3*S+1],m[2]=b[3*S+2],f.$.transformMat4(m,m,i),a.push(new $t(m[0],m[1]));for(let S=0;S<3*_.indexArray.length;S++)u.push(T[S]+d)}if(u.length%3!=0)return null;for(let _=0;_<u.length;_+=3){const b=a[u[_+0]],T=a[u[_+1]],S=a[u[_+2]];(b.x-T.x)*(S.y-T.y)-(S.x-T.x)*(b.y-T.y)>0&&([u[_+1],u[_+2]]=[u[_+2],u[_+1]])}return{vertices:a,indices:u}}function WM(o){const a=function(T,S){const A=[];for(const k of T.json.meshes){const R=[];for(const L of k.primitives)R.push(yL(L,T,S));A.push(R)}return A}(o,function(T,S){const A=[],k=WebGL2RenderingContext;if(T.json.textures)for(const R of T.json.textures){const L={magFilter:k.LINEAR,minFilter:k.NEAREST,wrapS:k.REPEAT,wrapT:k.REPEAT};void 0!==R.sampler&&Object.assign(L,T.json.samplers[R.sampler]),A.push({image:S[R.source],sampler:L,uploaded:!1})}return A}(o,o.images)),{scenes:u,scene:d,nodes:m}=o.json,_=u?u[d||0].nodes:m,b=[];for(const T of _)b.push(GM(m[T],o,a));return function(T,S,A){const k={},R=new Set;for(let L=0;L<T.length;L++){const U=A[S[L]];if(!U.extras)continue;const H=U.extras["mapbox:footprint:version"],G=U.extras["mapbox:footprint:id"];(H||G)&&R.add(L),"1.0.0"===H&&G&&(k[G]=L)}for(let L=0;L<T.length;L++){if(R.has(L))continue;const U=T[L],H=A[S[L]];if(!H.extras)continue;let G=null;U.id in k&&(G=qh(T[k[U.id]].meshes,U.matrix)),G||(G=u2(H)),G&&(U.footprint=Ab(G))}if(R.size>0){const L=Array.from(R.values()).sort((U,H)=>U-H);for(let U=L.length-1;U>=0;U--)T.splice(L[U],1)}}(b,_,o.json.nodes),b}function fR(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const i=o.vertexArray.float32,a=o.aabb.min[0]-1,u=o.aabb.min[1]-1,d=64/(o.aabb.max[0]-a+2),m=64/(o.aabb.max[1]-u+2);for(let _=0;_<i.length;_+=3){const b=i[_+2],T=(i[_+0]-a)*d|0,S=(i[_+1]-u)*m|0;b>o.heightmap[64*S+T]&&(o.heightmap[64*S+T]=b)}}function vL(o,i){const a={};a.indexArray=new cs,a.indexArray.reserve(4*o.length),a.vertexArray=new cp,a.vertexArray.reserve(10*o.length),a.colorArray=new Io,a.vertexArray.reserve(10*o.length);let u=0;for(const _ of o){const b=Math.min(10,Math.max(4,1.3*_.height))*i,T=[-_.normal[1],_.normal[0],0],S=Math.min(.29,.1*_.width/_.depth),A=_.width-2*_.depth*i*(S+.01),k=f.$.scaleAndAdd([],_.pos,T,A/2),R=f.$.scaleAndAdd([],_.pos,T,-A/2),L=[k[0],k[1],k[2]+_.height],U=[R[0],R[1],R[2]+_.height],H=f.$.scaleAndAdd([],_.normal,T,S);f.$.scale(H,H,b);const G=f.$.scaleAndAdd([],_.normal,T,-S);f.$.scale(G,G,b),f.$.add(H,k,H),f.$.add(G,R,G),k[2]+=.1,R[2]+=.1,a.vertexArray.emplaceBack(H[0],H[1],H[2]),a.vertexArray.emplaceBack(G[0],G[1],G[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(R[0],R[1],R[2]),a.vertexArray.emplaceBack(L[0],L[1],L[2]),a.vertexArray.emplaceBack(U[0],U[1],U[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(R[0],R[1],R[2]),a.vertexArray.emplaceBack(H[0],H[1],H[2]),a.vertexArray.emplaceBack(G[0],G[1],G[2]);const Y=A/b/2;a.colorArray.emplaceBack(-Y-S,-1,Y,.8),a.colorArray.emplaceBack(Y+S,-1,Y,.8),a.colorArray.emplaceBack(-Y,0,Y,1.3),a.colorArray.emplaceBack(Y,0,Y,1.3),a.colorArray.emplaceBack(Y+S,-.8,Y,.7),a.colorArray.emplaceBack(Y+S,-.8,Y,.7),a.colorArray.emplaceBack(0,0,Y,1.3),a.colorArray.emplaceBack(0,0,Y,1.3),a.colorArray.emplaceBack(Y+S,-1.2,Y,.8),a.colorArray.emplaceBack(Y+S,-1.2,Y,.8),a.indexArray.emplaceBack(6+u,4+u,8+u),a.indexArray.emplaceBack(7+u,9+u,5+u),a.indexArray.emplaceBack(0+u,1+u,2+u),a.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const d={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=Jr.white,d.pbrMetallicRoughness=m,a.material=d,a.aabb=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const Ib=new Float32Array(262144),xo=new Uint8Array(262144);function h2(o){let i=0;if(o.meshes)for(const a of o.meshes)i=Math.max(i,a.aabb.max[2]);if(o.children)for(const a of o.children)i=Math.max(i,h2(a));return i}function d2(o,i,a){if(o.meshes)for(const u of o.meshes)u.aabb.min[0]!==1/0&&a.insert(i,u.aabb.min[0],u.aabb.min[1],u.aabb.max[0],u.aabb.max[1]);if(o.children)for(const u of o.children)d2(u,i,a)}const f2=["","wall","door","roof","window","lamp","logo"];class pR{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:i.id,geometry:[],properties:{height:h2(i)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const a=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==i&&(u.transformedAabb=Yi.applyTransformFast(u.aabb,this.node.matrix),a.encapsulate(u.transformedAabb)),i++;this.aabb=a}return this.aabb}}class Qr{constructor(i,a,u,d,m,_){this.id=a,this.modelTraits|=lg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=lg.HasMapboxMeshFeatures),d&&(this.modelTraits|=lg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const b of i)this.nodesInfo.push(new pR(b)),d2(b,_.featureIndexArray.length,_.grid),_.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,_.bucketLayerIDs.length-1,0)}updateFootprints(i,a){for(const u of this.getNodesInfo()){const d=u.node;d.footprint&&a.push({footprint:d.footprint,id:i})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const u of a){const d=u.node;this.uploaded?this.updatePbrBuffer(d):t2(d,i,!0)}for(const u of a)Tb(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let a=!1;if(!i.meshes)return a;for(const u of i.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),a=!0);return a}needsReEvaluation(i,a,u){const d=i.transform.projectionOptions,m=i.style.getBrightness(),_=this.brightness!==m;return!!(!this.uploaded||this.dirty||d.name!==this.projection.name||My(u.paint.get("model-color").value,_)||My(u.paint.get("model-color-mix-intensity").value,_)||My(u.paint.get("model-roughness").value,_)||My(u.paint.get("model-emissive-strength").value,_)||My(u.paint.get("model-height-based-emissive-strength-multiplier").value,_))&&(this.projection=d,this.brightness=m,!0)}evaluateScale(i,a){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const u=this.getNodesInfo(),d=this.id.canonical;for(const m of u){const _=m.feature;m.evaluatedScale=a.paint.get("model-scale").evaluate(_,{},d)}}evaluate(i){const a=this.getNodesInfo();for(const u of a){if(!u.node.meshes)continue;const d=u.feature,m=u.node.meshes&&u.node.meshes[0].featureData,_=u.evaluatedColor[2],b=u.evaluatedRMEA[2],T=this.id.canonical;if(u.hasTranslucentParts=!1,m){for(let S=0;S<f2.length;S++){const A=f2[S];A.length&&(d.properties.part=A);const k=i.paint.get("model-color").evaluate(d,{},T).toRenderColor(null),R=i.paint.get("model-color-mix-intensity").evaluate(d,{},T);u.evaluatedColor[S]=[k.r,k.g,k.b,R],u.evaluatedRMEA[S][0]=i.paint.get("model-roughness").evaluate(d,{},T),u.evaluatedRMEA[S][2]=i.paint.get("model-emissive-strength").evaluate(d,{},T),u.evaluatedRMEA[S][3]=k.a,u.emissionHeightBasedParams[S]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,{},T),!u.hasTranslucentParts&&k.a<1&&(u.hasTranslucentParts=!0)}delete d.properties.part,mR(u,_!==u.evaluatedColor[2]||b!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(d,{},T);u.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},T),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,a,u,d){const m=i.findDEMTileFor(u);if(m&&(m.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const _=Xd.create(i,u,m);if(!_)return;this.modelTraits&lg.HasMapboxMeshFeatures&&this.updateDEM(i,_,u,d);for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const S=T.footprint.vertices;let A=_.getElevationAt(S[0].x,S[0].y,!0,!0);for(let k=1;k<S.length;k++)A=Math.min(A,_.getElevationAt(S[k].x,S[k].y,!0,!0));T.elevation=A}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=a}}updateDEM(i,a,u,d){let m=a._dem._modifiedForSources[d];if(void 0===m&&(a._dem._modifiedForSources[d]=[],m=a._dem._modifiedForSources[d]),m.includes(u.canonical))return;const _=a._dem.dim;m.push(u.canonical);let b=!1;for(const T of this.getNodesInfo()){const S=T.node;if(!S.footprint||!S.footprint.grid)continue;const A=S.footprint.grid,k=a.tileCoordToPixel(A.min.x,A.min.y),R=a.tileCoordToPixel(A.max.x,A.max.y),L=Math.min(Math.min(_-R.y,k.x),Math.min(k.y,_-R.x));if(L<0)continue;const U=vr(L,2,5);let H=Math.max(0,k.x-U),G=Math.max(0,k.y-U),Y=Math.min(R.x+U,_-1),ue=Math.min(R.y+U,_-1);for(let we=G;we<=ue;++we)for(let Se=H;Se<=Y;++Se)xo[we*_+Se]=255;let ae=0,he=0;for(let we=0;we<A.cellsY;++we)for(let Se=0;Se<A.cellsX;++Se){if(!A.cells[we*A.cellsX+Se])continue;const Fe=a.tileCoordToPixel(A.min.x+Se/A.xScale,A.min.y+we/A.yScale),Ge=a.tileCoordToPixel(A.min.x+(Se+1)/A.xScale,A.min.y+(we+1)/A.yScale);for(let tt=Fe.y;tt<=Math.min(Ge.y+1,_-1);++tt)for(let Ye=Fe.x;Ye<=Math.min(Ge.x+1,_-1);++Ye)255===xo[tt*_+Ye]&&(xo[tt*_+Ye]=0,ae+=a.getElevationAtPixel(Ye,tt),he++)}const ve=ae/he;H=Math.max(1,k.x-U),G=Math.max(1,k.y-U),Y=Math.min(R.x+U,_-2),ue=Math.min(R.y+U,_-2),b=!0;for(let we=G;we<=ue;++we)for(let Se=H;Se<=Y;++Se)0===xo[we*_+Se]&&(Ib[we*_+Se]=a._dem.set(Se,we,ve));for(let we=1;we<U;++we){H=Math.max(1,k.x-we),G=Math.max(1,k.y-we),Y=Math.min(R.x+we,_-2),ue=Math.min(R.y+we,_-2);for(let Se=G;Se<=ue;++Se)for(let Fe=H;Fe<=Y;++Fe){const Ge=Se*_+Fe;if(255===xo[Ge]){let tt=0,Ye=0,ht=-1,Dt=-1;for(let dt=-1;dt<=1;++dt)for(let Nt=-1;Nt<=1;++Nt){const ut=(Se+dt)*_+Fe+Nt;if(xo[ut]>=we)continue;const vt=Ib[ut],zt=Math.abs(vt);zt>Ye&&(tt=vt,Ye=zt,ht=Nt,Dt=dt)}if(Ye>.1){const dt=1-(we+.5*Math.abs(ht*Dt))/U;let Nt=a._dem.get(Fe,Se)+tt*dt;const ut=a._dem.get(Fe+ht,Se+Dt),vt=a._dem.get(Fe-ht,Se-Dt,!0);(Nt-ut)*(Nt-vt)>0&&(Nt=(ut+vt)/2),Ib[Ge]=a._dem.set(Fe,Se,Nt),xo[Ge]=we}}}}}b&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=aa.now())}getNodesInfo(){return this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const a of i)Tb(a.node),n2(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(i.toUnwrapped()),d=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){const _=d[m].node;d[m].hiddenByReplacement=!!_.footprint&&!u.find(b=>b.footprint===_.footprint)}}getHeightAtTileCoord(i,a){const u=this.getNodesInfo(),d=[],m=[0,0,0],_=f.ae.identity([]);for(let b=0;b<this.nodesInfo.length;b++){const T=u[b],S=T.node.meshes[0],A=S.transformedAabb;if(i<A.min[0]||a<A.min[1]||i>A.max[0]||a>A.max[1])continue;if(!0===T.node.hidden)return{height:0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};f.ae.invert(_,T.node.matrix),m[0]=i,m[1]=a,f.$.transformMat4(m,m,_);const k=(m[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*64|0,R=64*Math.min(63,(m[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*64|0)+Math.min(63,k),L=S.heightmap[R];if(!(L<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:L,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new $t(i,a),new $t(i,a),d),d.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function My(o,i){return!o.isLightConstant&&i}function p2(o,i,a,u,d,m,_,b){let T=(61440&i|(61440&i)>>4)>>8,S=(3840&i|(3840&i)>>4)>>4,A=240&i|(240&i)>>4;a[3]>0&&(T=Fn(T,255*a[0],a[3]),S=Fn(S,255*a[1],a[3]),A=Fn(A,255*a[2],a[3]));const k=T<<8|S,R=A<<8|Math.floor(255*u[3]),L=function(we){const Se=vr(we,0,2);return Math.min(Math.round(.5*Se*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],U=vr(d[0],0,1),H=vr(d[1],0,1),G=vr(d[2],0,1),Y=vr(d[3],0,1);let ue,ae,he,ve;if(U!==H&&_!==m&&H!==U){const we=_-m;ae=1/(we*(H-U)),he=-(m+we*U)/(we*(H-U));const Se=vr(d[4],-1,1);ve=Math.pow(10,Se),ue=255*G<<8|255*Y}else ue=65535,ae=0,he=1,ve=1;if(o.emplaceBack(k,R,L,ue,ae,he,ve),b){const we=b.length;b.clear();for(let Se=0;Se<we;Se++)b.emplaceBack(k,R,L,ue,ae,he,ve)}}function mR(o,i,a){const u=o.node;let d=0;const m=a&lg.HasMeshoptCompression;for(const _ of u.meshes){if(u.lights&&u.lightMeshIndex===d||!_.featureData)continue;_.featureArray=new Oh,_.featureArray.reserve(_.featureData.length);let b=i;for(const T of _.featureData){const S=m?65535&T:T>>16&65535,A=m?T>>16&65535:65535&T,k=(15&A)<8?15&A:0,R=o.evaluatedRMEA[k],L=o.evaluatedColor[k],U=o.emissionHeightBasedParams[k];let H;if(b&&2===k&&u.lights&&(H=new Oh,H.resize(10*u.lights.length)),p2(_.featureArray,S,L,R,U,_.aabb.min[2],_.aabb.max[2],H),H&&b){b=!1;const G=u.meshes[u.lightMeshIndex];G.featureArray=H,G.featureArray._trim()}}_.featureArray._trim(),d++}}function qM(o,i,a,u){const d=1<<o.z;i.lat=fo((u/Ut+o.y)/d),i.lng=Vl((a/Ut+o.x)/d)}Pe(Qr,"Tiled3dModelBucket",{omit:["layers"]}),Pe(pR,"Tiled3dModelFeature");const m2={circle:class extends Fl{constructor(o,i,a,u){super(o,{layout:GS||(GS=new Pi({"circle-sort-key":new fn(Qe.layout_circle["circle-sort-key"]),visibility:new Pt(Qe.layout_circle.visibility)})),paint:WS||(WS=new Pi({"circle-radius":new fn(Qe.paint_circle["circle-radius"]),"circle-color":new fn(Qe.paint_circle["circle-color"]),"circle-blur":new fn(Qe.paint_circle["circle-blur"]),"circle-opacity":new fn(Qe.paint_circle["circle-opacity"]),"circle-translate":new Pt(Qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(Qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(Qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(Qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fn(Qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fn(Qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fn(Qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Pt(Qe.paint_circle["circle-emissive-strength"])}))},i,a,u)}createBucket(o){return new E0(o)}queryRadius(o){const i=o;return Wm("circle-radius",this,i)+Wm("circle-stroke-width",this,i)+S0(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,a,u,d,m,_,b){const T=ST(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return LT(o,u,m,_,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,i,a){const u=FT(this);return{config:new no(this,{zoom:i,lut:a}),defines:u,overrideFog:!1}}},heatmap:class extends Fl{createBucket(o){return new rD(o)}constructor(o,i,a,u){super(o,{layout:VT||(VT=new Pi({visibility:new Pt(Qe.layout_heatmap.visibility)})),paint:B1||(B1=new Pi({"heatmap-radius":new fn(Qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fn(Qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(Qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ba(Qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(Qe.paint_heatmap["heatmap-opacity"])}))},i,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Oo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Wm("heatmap-radius",this,o)}queryIntersectsFeature(o,i,a,u,d,m,_,b){const T=this.paint.get("heatmap-radius").evaluate(i,a);return LT(o,u,m,_,b,!0,!0,new $t(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,i,a){return"heatmap"===o?{config:new no(this,{zoom:i,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Fl{constructor(o,i,a,u){super(o,{layout:lO||(lO=new Pi({visibility:new Pt(Qe.layout_hillshade.visibility)})),paint:cO||(cO=new Pi({"hillshade-illumination-direction":new Pt(Qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pt(Qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(Qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(Qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(Qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(Qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Pt(Qe.paint_hillshade["hillshade-emissive-strength"])}))},i,a,u)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,i,a){return{overrideFog:!1}}},fill:class extends Fl{constructor(o,i,a,u){super(o,{layout:HT||(HT=new Pi({"fill-sort-key":new fn(Qe.layout_fill["fill-sort-key"]),visibility:new Pt(Qe.layout_fill.visibility)})),paint:Ax||(Ax=new Pi({"fill-antialias":new Pt(Qe.paint_fill["fill-antialias"]),"fill-opacity":new fn(Qe.paint_fill["fill-opacity"]),"fill-color":new fn(Qe.paint_fill["fill-color"]),"fill-outline-color":new fn(Qe.paint_fill["fill-outline-color"]),"fill-translate":new Pt(Qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(Qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new fn(Qe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Pt(Qe.paint_fill["fill-emissive-strength"])}))},i,a,u)}getProgramIds(){const o=this.paint.get("fill-pattern"),i=o&&o.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(o,i,a){return{config:new no(this,{zoom:i,lut:a}),overrideFog:!1}}recalculate(o,i){super.recalculate(o,i);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Mx(o)}queryRadius(){return S0(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,a,u,d,m){return!o.queryGeometry.isAboveHorizon&&ET(O1(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Fl{constructor(o,i,a,u){super(o,{layout:ND||(ND=new Pi({visibility:new Pt(Qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Pt(Qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:rE||(rE=new Pi({"fill-extrusion-opacity":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fn(Qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new fn(Qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fn(Qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fn(Qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new fn(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new fn(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new fn(Qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new Pt(Qe["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},i,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new $x(o)}queryRadius(){return S0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,i,a,u,d,m,_,b,T){const S=ST(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(i,a),k=this.paint.get("fill-extrusion-base").evaluate(i,a),R=[0,0],L=b&&m.elevation,U=m.elevation?m.elevation.exaggeration():1,H=o.tile.getBucket(this);if(L&&H instanceof $x){const he=H.centroidVertexArray,ve=T+1;ve<he.length&&(R[0]=he.geta_centroid_pos0(ve),R[1]=he.geta_centroid_pos1(ve))}if(0===R[0]&&1===R[1])return!1;"globe"===m.projection.name&&(u=PD([u],[new $t(0,0),new $t(Ut,Ut)],o.tileID.canonical).map(he=>he.polygon).flat());const G=L?b:null,[Y,ue]=(ve=u,we=k,Se=A,Fe=S,Ge=_,tt=G,Ye=R,ht=U,Dt=m.center.lat,"globe"===(he=m).projection.name?function(Nt,ut,vt,zt,ct,qt,Lt,Mt,In,_n,en){const Ht=[],Jn=[],bn=Nt.projection.upVectorScale(en,Nt.center.lat,Nt.worldSize).metersToTile,cn=[0,0,0,1],ar=[0,0,0,1],fr=(yr,Ar,Cr,bi)=>{yr[0]=Ar,yr[1]=Cr,yr[2]=bi,yr[3]=1},hr=RD();vt>0&&(vt+=hr),zt+=hr;for(const yr of ut){const Ar=[],Cr=[];for(const bi of yr){const wi=bi.x+ct.x,lr=bi.y+ct.y,ri=Nt.projection.projectTilePoint(wi,lr,en),oi=Nt.projection.upVector(en,bi.x,bi.y);let Vi=vt,Ss=zt;if(Lt){const Ns=LD(wi,lr,vt,zt,Lt,Mt,In,_n);Vi+=Ns.base,Ss+=Ns.top}0!==vt?fr(cn,ri.x+oi[0]*bn*Vi,ri.y+oi[1]*bn*Vi,ri.z+oi[2]*bn*Vi):fr(cn,ri.x,ri.y,ri.z),fr(ar,ri.x+oi[0]*bn*Ss,ri.y+oi[1]*bn*Ss,ri.z+oi[2]*bn*Ss),f.$.transformMat4(cn,cn,qt),f.$.transformMat4(ar,ar,qt),Ar.push(new qd(cn[0],cn[1],cn[2])),Cr.push(new qd(ar[0],ar[1],ar[2]))}Ht.push(Ar),Jn.push(Cr)}return[Ht,Jn]}(he,ve,we,Se,Fe,Ge,tt,Ye,ht,Dt,o.tileID.canonical):tt?function(Nt,ut,vt,zt,ct,qt,Lt,Mt,In){const _n=[],en=[],Ht=[0,0,0,1];for(const Jn of Nt){const bn=[],cn=[];for(const ar of Jn){const fr=ar.x+zt.x,hr=ar.y+zt.y,yr=LD(fr,hr,ut,vt,qt,Lt,Mt,In);Ht[0]=fr,Ht[1]=hr,Ht[2]=yr.base,Ht[3]=1,f.aB.transformMat4(Ht,Ht,ct),Ht[3]=Math.max(Ht[3],1e-5);const Ar=new qd(Ht[0]/Ht[3],Ht[1]/Ht[3],Ht[2]/Ht[3]);Ht[0]=fr,Ht[1]=hr,Ht[2]=yr.top,Ht[3]=1,f.aB.transformMat4(Ht,Ht,ct),Ht[3]=Math.max(Ht[3],1e-5);const Cr=new qd(Ht[0]/Ht[3],Ht[1]/Ht[3],Ht[2]/Ht[3]);bn.push(Ar),cn.push(Cr)}_n.push(bn),en.push(cn)}return[_n,en]}(ve,we,Se,Fe,Ge,tt,Ye,ht,Dt):function(Nt,ut,vt,zt,ct){const qt=[],Lt=[],Mt=ct[8]*ut,In=ct[9]*ut,_n=ct[10]*ut,en=ct[11]*ut,Ht=ct[8]*vt,Jn=ct[9]*vt,bn=ct[10]*vt,cn=ct[11]*vt;for(const ar of Nt){const fr=[],hr=[];for(const yr of ar){const Ar=yr.x+zt.x,Cr=yr.y+zt.y,bi=ct[0]*Ar+ct[4]*Cr+ct[12],wi=ct[1]*Ar+ct[5]*Cr+ct[13],lr=ct[2]*Ar+ct[6]*Cr+ct[14],ri=ct[3]*Ar+ct[7]*Cr+ct[15],oi=bi+Mt,Vi=wi+In,Ss=lr+_n,Ns=Math.max(ri+en,1e-5),hs=bi+Ht,es=wi+Jn,po=lr+bn,js=Math.max(ri+cn,1e-5);fr.push(new qd(oi/Ns,Vi/Ns,Ss/Ns)),hr.push(new qd(hs/js,es/js,po/js))}qt.push(fr),Lt.push(hr)}return[qt,Lt]}(ve,we,Se,Fe,Ge)),ae=o.queryGeometry;var he,ve,we,Se,Fe,Ge,tt,Ye,ht,Dt;return function(he,ve,we){let Se=1/0;ET(we,ve)&&(Se=FD(we,ve[0]));for(let Fe=0;Fe<ve.length;Fe++){const Ge=ve[Fe],tt=he[Fe];for(let Ye=0;Ye<Ge.length-1;Ye++){const ht=Ge[Ye],Dt=[ht,Ge[Ye+1],tt[Ye+1],tt[Ye],ht];Gd(we,Dt)&&(Se=Math.min(Se,FD(we,Dt)))}}return Se!==1/0&&Se}(Y,ue,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends Fl{constructor(o,i,a,u){const d=SM();super(o,d,i,a,u),d.layout&&(this.layout=new Yo(d.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Ci,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=(()=>{if(yy)return yy;const a=SM();return yy=new oR(a.paint.properties["line-width"].specification),yy.useIntegerZoom=!0,yy})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Gx(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,i,a){const u=cE(this);return{config:new no(this,{zoom:i,lut:a}),defines:u,overrideFog:!1}}queryRadius(o){const i=o,a=xy(Wm("line-width",this,i),Wm("line-gap-width",this,i)),u=Wm("line-offset",this,i);return a/2+Math.abs(u)+S0(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,a,u,d,m){if(o.queryGeometry.isAboveHorizon)return!1;const _=O1(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),b=o.pixelToTileUnitsFactor/2*xy(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),T=this.paint.get("line-offset").evaluate(i,a);return T&&(u=function(S,A){const k=[],R=new $t(0,0);for(let L=0;L<S.length;L++){const U=S[L],H=[];for(let G=0;G<U.length;G++){const Y=U[G],ue=U[G+1],ae=0===G?R:Y.sub(U[G-1])._unit()._perp(),he=G===U.length-1?R:ue.sub(Y)._unit()._perp(),ve=ae._add(he)._unit();ve._mult(1/(ve.x*he.x+ve.y*he.y)),H.push(ve._mult(A)._add(Y))}k.push(H)}return k}(u,T*o.pixelToTileUnitsFactor)),function(S,A,k){for(let R=0;R<A.length;R++){const L=A[R];if(S.length>=3)for(let U=0;U<L.length;U++)if(Bh(S,L[U]))return!0;if(VS(S,L,k))return!0}return!1}(_,u,b)}isTileClipped(){return!0}isDraped(o){const i=this.layout.get("line-z-offset");return i.isConstant()&&!i.constantOr(0)}},symbol:by,background:class extends Fl{constructor(o,i,a,u){super(o,{layout:DM||(DM=new Pi({visibility:new Pt(Qe.layout_background.visibility)})),paint:t_||(t_=new Pi({"background-color":new Pt(Qe.paint_background["background-color"]),"background-pattern":new Pt(Qe.paint_background["background-pattern"]),"background-opacity":new Pt(Qe.paint_background["background-opacity"]),"background-emissive-strength":new Pt(Qe.paint_background["background-emissive-strength"])}))},i,a,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,i,a){return{overrideFog:!1}}},raster:n_,"raster-particle":XE,sky:class extends Fl{constructor(o,i,a,u){super(o,{layout:kM||(kM=new Pi({visibility:new Pt(Qe.layout_sky.visibility)})),paint:Ty||(Ty=new Pi({"sky-type":new Pt(Qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Pt(Qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Pt(Qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Pt(Qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Pt(Qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ba(Qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Pt(Qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Pt(Qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Pt(Qe.paint_sky["sky-opacity"])}))},i,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Oo({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(o,i){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),d=!u,m=o.style.light,_=m.properties.get("position");return d&&"viewport"===m.properties.get("anchor")&&ks("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?YE(_.azimuthal,90-_.polar,i):YE(u[0],90-u[1],i)}const a=this.paint.get("sky-gradient-center");return YE(a[0],90-a[1],i)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}},slot:class extends Fl{constructor(o,i,a,u){super(o,{paint:ZE||(ZE=new Pi({}))},i,null)}},model:class extends Fl{constructor(o,i,a,u){super(o,{layout:zM||(zM=new Pi({visibility:new Pt(Qe.layout_model.visibility),"model-id":new fn(Qe.layout_model["model-id"])})),paint:e2||(e2=new Pi({"model-opacity":new Pt(Qe.paint_model["model-opacity"]),"model-rotation":new fn(Qe.paint_model["model-rotation"]),"model-scale":new fn(Qe.paint_model["model-scale"]),"model-translation":new fn(Qe.paint_model["model-translation"]),"model-color":new fn(Qe.paint_model["model-color"]),"model-color-mix-intensity":new fn(Qe.paint_model["model-color-mix-intensity"]),"model-type":new Pt(Qe.paint_model["model-type"]),"model-cast-shadows":new Pt(Qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Pt(Qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Pt(Qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new fn(Qe.paint_model["model-emissive-strength"]),"model-roughness":new fn(Qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new fn(Qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Pt(Qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Pt(Qe.paint_model["model-front-cutoff"])}))},i,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new bb(o)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof Qr?Ut-1:0}queryIntersectsFeature(o,i,a,u,d,m){if(!this.modelManager)return!1;const _=this.modelManager,b=o.tile.getBucket(this);if(!(b&&b instanceof bb))return!1;const T=b;for(const S in T.instancesPerModel){const A=T.instancesPerModel[S],k=void 0!==i.id?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(k)){const R=A.features[A.idToFeaturesIndex[k]],L=_.getModel(S,this.scope);if(!L)return!1;let U=f.ae.create();const H=new kr(0,0),G=T.canonical;let Y=Number.MAX_VALUE;for(let ue=0;ue<R.instancedDataCount;++ue){const ae=16*(R.instancedDataOffset+ue),he=A.instancedDataArray.float32,ve=[he[ae+4],he[ae+5],he[ae+6]];qM(G,H,he[ae],0|he[ae+1]),wb(U,L,m,H,R.rotation,R.scale,ve,!1,!1,!1),"globe"===m.projection.name&&(U=JE(U,m));const we=f.ae.multiply([],m.projMatrix,U),Se=o.queryGeometry,Fe=_b(Se.isPointQuery()?Se.screenBounds:Se.screenGeometry,m,we,L.aabb);null!=Fe&&(Y=Math.min(Fe,Y))}return Y!==Number.MAX_VALUE&&Y}}return!1}_handleOverridablePaintPropertyUpdate(o,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven()||"model-color"!==o&&"model-color-mix-intensity"!==o&&"model-rotation"!==o&&"model-scale"!==o&&"model-translation"!==o&&"model-emissive-strength"!==o)}_isPropertyZoomDependent(o){const i=this._transitionablePaint._values[o];return null!=i&&null!=i.value&&null!=i.value.expression&&i.value.expression instanceof _e}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(o,i,a,u){const d=o.tile,m=d.getBucket(this);let _=null,b=Number.MAX_VALUE;if(!(m&&m instanceof Qr))return{queryFeature:_,intersectionZ:b};const T=m.getNodesInfo()[i];if(T.hiddenByReplacement||!T.node.meshes||!a.filter(new tr(d.tileID.overscaledZ),T.feature,d.tileID.canonical))return{queryFeature:_,intersectionZ:b};const S=T.node,A=u.calculatePosMatrix(d.tileID.toUnwrapped(),u.worldSize),k=T.evaluatedScale;let R=0;u.elevation&&S.elevation&&(R=S.elevation*u.elevation.exaggeration()),f.ae.translate(A,A,[(S.anchor?S.anchor[0]:0)*(k[0]-1),(S.anchor?S.anchor[1]:0)*(k[1]-1),R]),f.ae.scale(A,A,k),f.ae.multiply(A,A,S.matrix);const L=o.queryGeometry,U=L.isPointQuery()?L.screenBounds:L.screenGeometry,H=function(Y){const ue=f.ae.multiply([],A,Y.matrix),ae=f.ae.multiply(ue,u.expandedFarZProjMatrix,ue);for(let he=0;he<Y.meshes.length;++he){const ve=Y.meshes[he];if(he===Y.lightMeshIndex)continue;const we=_b(U,u,ae,ve.aabb);null!=we&&(b=Math.min(we,b))}if(Y.children)for(const he of Y.children)H(he)};if(H(S),b===Number.MAX_VALUE)return{queryFeature:_,intersectionZ:b};const G=new kr(0,0);return qM(d.tileID.canonical,G,T.node.anchor[0],T.node.anchor[1]),_={type:"Feature",geometry:{type:"Point",coordinates:[G.lng,G.lat]},properties:T.feature.properties,id:T.feature.id,state:{},layer:this.serialize()},{queryFeature:_,intersectionZ:b}}},clip:class extends Fl{constructor(o,i,a,u){super(o,{layout:pD||(pD=new Pi({"clip-layer-types":new Pt(Qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Pt(Qe.layout_clip["clip-layer-scope"])})),paint:Wd||(Wd=new Pi({}))},i,a,u)}recalculate(o,i){super.recalculate(o,i)}createBucket(o){return new GT(o)}isTileClipped(){return!0}is3D(){return!0}}};Pe(nR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const g2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class kb{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(i,0,2);if(219!==a)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(1!==d)throw new Error(`Got v${d} data when expected v1.`);const m=g2[15&u];if(!m)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(i,2,1),[b]=new Uint32Array(i,4,1);return new kb(b,_,m,i)}constructor(i,a=64,u=Float64Array,d){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const m=g2.indexOf(this.ArrayType),_=2*i*this.ArrayType.BYTES_PER_ELEMENT,b=i*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+T,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+_+b+T),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+T,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=i)}add(i,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=i,this.coords[this._pos++]=a,u}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Ay(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,a,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:_,nodeSize:b}=this,T=[0,m.length-1,0],S=[];for(;T.length;){const A=T.pop()||0,k=T.pop()||0,R=T.pop()||0;if(k-R<=b){for(let G=R;G<=k;G++){const Y=_[2*G],ue=_[2*G+1];Y>=i&&Y<=u&&ue>=a&&ue<=d&&S.push(m[G])}continue}const L=R+k>>1,U=_[2*L],H=_[2*L+1];U>=i&&U<=u&&H>=a&&H<=d&&S.push(m[L]),(0===A?i<=U:a<=H)&&(T.push(R),T.push(L-1),T.push(1-A)),(0===A?u>=U:d>=H)&&(T.push(L+1),T.push(k),T.push(1-A))}return S}within(i,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:_}=this,b=[0,d.length-1,0],T=[],S=u*u;for(;b.length;){const A=b.pop()||0,k=b.pop()||0,R=b.pop()||0;if(k-R<=_){for(let G=R;G<=k;G++)XM(m[2*G],m[2*G+1],i,a)<=S&&T.push(d[G]);continue}const L=R+k>>1,U=m[2*L],H=m[2*L+1];XM(U,H,i,a)<=S&&T.push(d[L]),(0===A?i-u<=U:a-u<=H)&&(b.push(R),b.push(L-1),b.push(1-A)),(0===A?i+u>=U:a+u>=H)&&(b.push(L+1),b.push(k),b.push(1-A))}return T}}function Ay(o,i,a,u,d,m){if(d-u<=a)return;const _=u+d>>1;ZM(o,i,_,u,d,m),Ay(o,i,a,u,_-1,1-m),Ay(o,i,a,_+1,d,1-m)}function ZM(o,i,a,u,d,m){for(;d>u;){if(d-u>600){const S=d-u+1,A=a-u+1,k=Math.log(S),R=.5*Math.exp(2*k/3),L=.5*Math.sqrt(k*R*(S-R)/S)*(A-S/2<0?-1:1);ZM(o,i,a,Math.max(u,Math.floor(a-A*R/S+L)),Math.min(d,Math.floor(a+(S-A)*R/S+L)),m)}const _=i[2*a+m];let b=u,T=d;for(Iy(o,i,u,a),i[2*d+m]>_&&Iy(o,i,u,d);b<T;){for(Iy(o,i,b,T),b++,T--;i[2*b+m]<_;)b++;for(;i[2*T+m]>_;)T--}i[2*u+m]===_?Iy(o,i,u,T):(T++,Iy(o,i,T,d)),T<=a&&(u=T+1),a<=T&&(d=T-1)}}function Iy(o,i,a,u){Ob(o,a,u),Ob(i,2*a,2*u),Ob(i,2*a+1,2*u+1)}function Ob(o,i,a){const u=o[i];o[i]=o[a],o[a]=u}function XM(o,i,a,u){const d=o-a,m=i-u;return d*d+m*m}f.A=a0,f.B=Pm,f.C=Jr,f.D=Rm,f.E=Uf,f.F=Il,f.H=Ah,f.I=WO,f.J=z,f.K=I,f.L=function(o){const i=o.value;let a=[];if(!i)return a;const u=Gr(i);return"string"!==u?(a=a.concat([new vb(o.key,i,`string expected, "${u}" found`)]),a):(QE(i,!0)||(a=a.concat([new vb(o.key,i,`invalid url "${i}"`)])),a)},f.M=class{constructor(o,i,a,u){this.id=o,this.position=null!=i?new kr(i[0],i[1]):new kr(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,i){if(f.ae.multiply(o.matrix,i,o.matrix),o.meshes)for(const a of o.meshes){const u=Yi.applyTransformFast(a.aabb,o.matrix);this.aabb.encapsulate(u)}if(o.children)for(const a of o.children)this._applyTransformations(a,o.matrix)}computeBoundsAndApplyParent(){const o=f.ae.identity([]);for(const i of this.nodes)this._applyTransformations(i,o)}computeModelMatrix(o,i,a,u,d,m,_=!1){wb(this.matrix,this,o.transform,this.position,i,a,u,d,m,_)}upload(o){if(!this.uploaded){for(const i of this.nodes)t2(i,o);for(const i of this.nodes)Tb(i);this.uploaded=!0}}destroy(){for(const o of this.nodes)n2(o)}},f.N=Qe,f.O=Zo,f.P=$t,f.Q=$o,f.R=Nf,f.S=fT,f.T=Uu,f.U=Pi,f.V=vb,f.W=Pt,f.X=class{constructor(o){this.specification=o}possiblyEvaluate(o,i){return Of(o.expression.evaluate(i))}interpolate(o,i,a){return{x:Fn(o.x,i.x,a),y:Fn(o.y,i.y,a),z:Fn(o.z,i.z,a),azimuthal:Fn(o.azimuthal,i.azimuthal,a),polar:Fn(o.polar,i.polar,a)}}},f.Y=tr,f.Z=_e,f._=pa,f.a=io,f.a$=bx,f.a0=jg,f.a1=Yo,f.a2=xp,f.a3=Fn,f.a4=Ut,f.a5=a1,f.a6=class{constructor(o){this.specification=o}possiblyEvaluate(o,i){return function([a,u]){const d=Of([1,a,u]);return{x:d.x,y:d.y,z:d.z}}(o.expression.evaluate(i))}interpolate(o,i,a){return{x:Fn(o.x,i.x,a),y:Fn(o.y,i.y,a),z:Fn(o.z,i.z,a)}}},f.a7=dp,f.a8=fx,f.a9=Hd,f.aA=function(o,i,a){o[4*i+0]=a[0],o[4*i+1]=a[1],o[4*i+2]=a[2],o[4*i+3]=a[3]},f.aC=function(o,i){const{x:a,y:u}=o.point,d=zh(a,u,o.worldSize/o._pixelsPerMercatorPixel,0,0);return f.ae.multiply(d,d,vp(Nu(i)))},f.aE=Jd,f.aF=cc,f.aG=Yx,f.aH=function(o,i,a,u,d){const m=5*i+2;o.float32[m+0]=a,o.float32[m+1]=u,o.float32[m+2]=d},f.aI=lb,f.aJ=kr,f.aK=mM,f.aL=LS,f.aM=XS,f.aN=mb,f.aO=gp,f.aP=kT,f.aQ=ro,f.aR=function(o,i,a,u,d,m,_,b,T){if("globe"===T.name)return kT(o,i,new gp(a,u,d),!1);const S=Ip({z:a,x:u,y:d},T);return new Yi([(m+S.x/S.scale)*i,i*(S.y/S.scale),_],[(m+S.x2/S.scale)*i,i*(S.y2/S.scale),b])},f.aS=function(o,i,a){let u=0;for(let d=0;d<2;++d)o[d]>0&&(u+=(o[d]-0)*(o[d]-0)),i[d]<0&&(u+=(0-i[d])*(0-i[d]));return u},f.aT=Us,f.aU=DT,f.aV=x0,f.aW=function(o){const i=f.ae.identity(new Float64Array(16));f.ae.multiply(i,o.pixelMatrix,o.globeMatrix);const a=[0,zl,0],u=[0,Ul,0];return f.$.transformMat4(a,a,i),f.$.transformMat4(u,u,i),[a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!ir(o,new kr(o.center.lat,90)),u[0]>0&&u[0]<=o.width&&u[1]>0&&u[1]<=o.height&&!ir(o,new kr(o.center.lat,-90))]},f.aX=function(o,i){const{scale:a}=o.tileTransform,u=a*Ut/(o.tileSize*Math.pow(2,i.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return f.aD.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[u,u])},f.aY=ag,f.aZ=KE,f.a_=function(o){const i=KE(o,!0);return f.aD.invert([],[i[0],i[1],i[4],i[5]])},f.aa=px,f.ab=Ua,f.ac=Dr,f.ad=function(o,i,a){const u=Math.sqrt(o*o+i*i+a*a),d=u>0?Math.acos(a/u)*Cd:0;let m=0!==o||0!==i?Math.atan2(-i,-o)*Cd+90:0;return m<0&&(m+=360),[u,m,d]},f.af=X0,f.ag=Vu,f.ah=kE,f.ai=function(o,i){const a={};for(let u=0;u<i.length;u++){const d=i[u];d in o&&(a[d]=o[d])}return a},f.aj=iu,f.ak=ac,f.al=Fh,f.am=uT,f.an=function(o){t1++,t1>J_&&(o.getActor().send("enforceCacheSizeLimit",K_),t1=0)},f.ao=Uv,f.ap=class{constructor(o){this.entries={},this.scheduler=o}request(o,i,a,u){const d=this.entries[o]=this.entries[o]||{callbacks:[]};if(d.result){const[m,_]=d.result;return this.scheduler?this.scheduler.add(()=>{u(m,_)},i):u(m,_),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=a((m,_)=>{d.result=[m,_];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,_)},i):b(m,_);setTimeout(()=>delete this.entries[o],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==u),d.callbacks.length||(d.cancel(),delete this.entries[o]))}}},f.aq=function(o,i,a){const u=JSON.stringify(o.request);return o.data&&(this.deduped.entries[u]={result:[null,o.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},d=>{const m=Pa(o.request,(_,b,T,S)=>{_?d(_):b&&d(null,{vectorTile:a?void 0:new R0(new ny(b)),rawData:b,cacheControl:T,expires:S})});return()=>{m.cancel(),d()}},i)},f.ar=yT,f.as=class extends za{constructor(o){super(o),this.current=Jk}set(o,i,a){if(this.fetchUniformLocation(o,i))for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},f.at=C1,f.au=vr,f.av=hh,f.ax=gh,f.ay=ko,f.az=fo,f.b=us,f.b$=iL,f.b0=function(o){const{x:i,y:a}=o.point,{lng:u,lat:d}=o._center;return zh(i,a,o.worldSize,u,d)},f.b1=oa,f.b2=D1,f.b3=gx,f.b4=function(o){const i=Math.round((o+45+360)%360/90)%4;return If[i]},f.b5=45,f.b6=M1,f.b7=Oc,f.b8=Yi,f.b9=Of,f.bA=tg,f.bB=Ex,f.bC=function(o,i){return[Math.pow(o[0],2.2)*i,Math.pow(o[1],2.2)*i,Math.pow(o[2],2.2)*i]},f.bD=HD,f.bF=PT,f.bG=_h,f.bH=Pv,f.bI=256,f.bJ=function(o,i){const a=[0,0,0],u=N1(Nu(i.canonical));return f.$.transformMat4(a,a,u),f.$.transformMat4(a,a,o),a},f.bK=o=>({u_camera_to_center_distance:new Ua(o),u_extrude_scale:new S1(o),u_device_pixel_ratio:new Ua(o),u_matrix:new dp(o),u_inv_rot_matrix:new dp(o),u_merc_center:new Hd(o),u_tile_id:new yT(o),u_zoom_transition:new Ua(o),u_up_dir:new yT(o),u_emissive_strength:new Ua(o)}),f.bL=o=>({u_matrix:new dp(o),u_pixels_to_tile_units:new S1(o),u_device_pixel_ratio:new Ua(o),u_units_to_pixels:new Hd(o),u_dash_image:new fx(o),u_gradient_image:new fx(o),u_image_height:new Ua(o),u_texsize:new Hd(o),u_tile_units_to_pixels:new Ua(o),u_alpha_discard_threshold:new Ua(o),u_trim_offset:new Hd(o),u_trim_fade_range:new Hd(o),u_trim_color:new C1(o),u_emissive_strength:new Ua(o)}),f.bM=o=>({u_matrix:new dp(o),u_texsize:new Hd(o),u_pixels_to_tile_units:new S1(o),u_device_pixel_ratio:new Ua(o),u_image:new fx(o),u_units_to_pixels:new Hd(o),u_tile_units_to_pixels:new Ua(o),u_alpha_discard_threshold:new Ua(o),u_trim_offset:new Hd(o)}),f.bN=g0,f.bO=VD,f.bP=ma,f.bQ=Kx,f.bR=ib,f.bS=mE,f.bT=FT,f.bU=(o,i,a,u,d,m)=>{const _=o.transform,b="globe"===_.projection.name;let T;if("map"===m.paint.get("circle-pitch-alignment"))if(b){const A=PT(_.zoom,i.canonical)*_._pixelsPerMercatorPixel;T=Float32Array.from([A,0,0,A])}else T=_.calculatePixelsToTileUnitsMatrix(a);else T=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(_.projection),u_matrix:o.translatePosMatrix(i.projMatrix,a,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:aa.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:oO,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){S.u_inv_rot_matrix=u,S.u_merc_center=d,S.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],S.u_zoom_transition=xp(_.zoom);const A=d[0]*Ut,k=d[1]*Ut;S.u_up_dir=_.projection.upVector(new gp(0,0,0),A,k)}return S},f.bV=cE,f.bW=(o,i,a,u,d,m)=>{const _=o.transform;return{u_matrix:ey(o,i,a,u),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:d,u_image:0,u_tile_units_to_pixels:lE(i,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m}},f.bX=(o,i,a,u,d,m,_)=>{const b=o.transform,T=b.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:ey(o,i,a,u),u_pixels_to_tile_units:T,u_device_pixel_ratio:m,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:Wx(a)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:lE(i,o.transform),u_alpha_discard_threshold:0,u_trim_offset:_,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength")}},f.bY=dh,f.bZ=Oo,f.b_=RD,f.ba=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},f.bb=Ug,f.bc=function(o,i,a){const u=xp(a.zoom),d=o.style.map._antialias,m=i.options.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===u&&!d&&!m},f.bd=function(o){const i=o.pixelsPerMeter,a=i/ko(1,o.center.lat),u=f.ae.identity(new Float64Array(16));return f.ae.translate(u,u,[o.point.x,o.point.y,0]),f.ae.scale(u,u,[a,a,i]),Float32Array.from(u)},f.be=OT,f.bf=function(o){const i=Us-5;o=vr(o,-i,i)/i*90;const a=Math.pow(Math.abs(Math.sin(Dr(o))),3);return Math.round(a*(w0.length-1))},f.bg=function(o,i,a,u){const d=i.getNorth(),m=i.getSouth(),_=i.getWest(),b=i.getEast(),T=1<<o.z,S=b-_,A=d-m,k=S/64,R=-A/w0[a],L=[0,k,0,R,0,0,d,_,0];if(o.z>0){const U=180/u;f.bE.multiply(L,L,[U/S+1,0,0,0,U/A+1,0,-.5*U/k,.5*U/R,1])}return L[2]=T,L[5]=o.x,L[8]=o.y,L},f.bh=N1,f.bi=Nu,f.bj=function(o,i,a){const u=f.ae.identity(new Float64Array(16)),d=(i/(1<<o)-.5)*Math.PI*2;return f.ae.rotateY(u,a.globeMatrix,d),Float32Array.from(u)},f.bk=Nv,f.bl=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},f.bm=n_,f.bn=XE,f.bo=MM,f.bp=function(o,i){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let u=0;u<o.length;u++){const d=document.createElement("source");Ff(o[u])||(a.crossOrigin="Anonymous"),d.src=o[u],a.appendChild(d)}return{cancel:()=>{}}},f.bq=q0,f.br=Gg,f.bs=class{isDataAvailableAtPoint(o){const i=this._source();if(this.isUsingMockSource()||!i||o.y<0||o.y>1)return!1;const a=i.getSource().maxzoom,u=1<<a,d=Math.floor(o.x),m=Math.floor((o.x-d)*u),_=Math.floor(o.y*u),b=this.findDEMTileFor(new ro(a,d,a,m,_));return!(!b||!b.dem)}getAtPointOrZero(o,i=0){return this.getAtPoint(o,i)||0}getAtPoint(o,i,a=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const u=this._source();if(!u||o.y<0||o.y>1)return i;const d=u.getSource().maxzoom,m=1<<d,_=Math.floor(o.x),b=o.x-_,T=new ro(d,_,d,Math.floor(b*m),Math.floor(o.y*m)),S=this.findDEMTileFor(T);if(!S||!S.dem)return i;const A=S.dem,k=1<<S.tileID.canonical.z,R=(b*k-S.tileID.canonical.x)*A.dim,L=(o.y*k-S.tileID.canonical.y)*A.dim,U=Math.floor(R),H=Math.floor(L);return(a?this.exaggeration():1)*Fn(Fn(A.get(U,H),A.get(U,H+1),L-H),Fn(A.get(U+1,H),A.get(U+1,H+1),L-H),R-U)}getAtTileOffset(o,i,a){const u=1<<o.canonical.z;return this.getAtPointOrZero(new pa(o.wrap+(o.canonical.x+i/Ut)/u,(o.canonical.y+a/Ut)/u))}getAtTileOffsetFunc(o,i,a,u){return d=>{const m=this.getAtTileOffset(o,d.x,d.y),_=u.upVector(o.canonical,d.x,d.y),b=u.upVectorScale(o.canonical,i,a).metersToTile;return f.$.scale(_,_,m*b),_}}getForTilePoints(o,i,a,u){if(this.isUsingMockSource())return!1;const d=Xd.create(this,o,u);return!!d&&(i.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],a)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(o);if(!i||!i.dem)return null;const a=i.dem.tree,u=i.tileID,d=1<<o.canonical.z-u.canonical.z;let m=o.canonical.x/d-u.canonical.x,_=o.canonical.y/d-u.canonical.y,b=0;for(let T=0;T<o.canonical.z-u.canonical.z&&!a.leaves[b];T++){m*=2,_*=2;const S=2*Math.floor(_)+Math.floor(m);b=a.childOffsets[b]+S,m%=1,_%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(0===o.length)return null;let i=!1,a=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const d of o){const m=this.getMinMaxForTile(d.tileID);m&&(a=Math.min(a,m.min),u=Math.max(u,m.max),i=!0)}return i?{min:a,max:u}:null}},f.bt=P1,f.bu=AT,f.bv=Ll,f.bw=cs,f.bx=sg,f.by=i2,f.bz=Eb,f.c=WM,f.c$=function(o,i,a,u){return"custom"===o.type?new OM(o,i):new m2[o.type](o,i,a,u)},f.c0=$x,f.c1=Vh,f.c2=450,f.c3=7,f.c4=aR,f.c5=rR,f.c6=256,f.c7=JS,f.c8=vp,f.c9=Hn,f.cA=$S,f.cB=function(o,i,a=0){return f.$.fromValues(((i.x-a)*o.scale-o.x)*Ut,(i.y*o.scale-o.y)*Ut,A1(i.z,i.y))},f.cC=function(o){let i=1/0,a=1/0,u=-1/0,d=-1/0;for(const m of o)i=Math.min(i,m.x),a=Math.min(a,m.y),u=Math.max(u,m.x),d=Math.max(d,m.y);return{min:new $t(i,a),max:new $t(u,d)}},f.cD=Bh,f.cE=_x,f.cF=Va,f.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.cH=tb,f.cI=Gd,f.cJ=yD,f.cK=xD,f.cL=vO,f.cM=Jm,f.cN=kb,f.cO=function(o){return o({pluginStatus:wr,pluginURL:ur}),xr.on("pluginStateChange",o),o},f.cP=Ym,f.cQ=rb,f.cR=Lv,f.cS=ni,f.cT=_s,f.cU=vm,f.cV=i1,f.cW=Ra,f.cX=function(o){const i=o.indexOf("\x1f");return i>=0?o.slice(0,i):o},f.cY=function(o){return o.indexOf("\x1f")>=0},f.cZ=function(o){const i=o.indexOf("\x1f");return i>=0?o.slice(i+1):""},f.c_=function(o){const i=[],a=o.id;return void 0===a&&i.push({message:`layers.${a}: missing required property "id"`}),void 0===o.render&&i.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},f.ca=cp,f.cb=hp,f.cc=1,f.cd=771,f.ce=0,f.cf=MS,f.cg=function(o,i,a,u,d){return vr((o-i)/(a-i)*(d-u)+u,u,d)},f.ch=tx,f.ci=_p,f.cj=class{constructor(o,i,a,u){this.context=o,this.format=u,this.size=a,this.texture=o.gl.createTexture();const[d,m,_]=this.size,{gl:b}=o;b.bindTexture(b.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1);let T=this.format,S=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(T=b.DEPTH_COMPONENT16,S=b.UNSIGNED_SHORT),this.format===b.R8&&(u=b.RED),this.format===b.R32F&&(S=b.FLOAT,u=b.RED),b.texImage3D(b.TEXTURE_3D,0,T,d,m,_,0,u,S,i.data)}bind(o,i){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_3D,this.texture),o!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,o),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,o),this.minFilter=o),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},f.ck=JE,f.cl=[1,1,1],f.cm=Xd,f.cn=lg,f.co=nu,f.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new $t(1/0,1/0),max:new $t(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,i=!1){const a=vD(new $t(0,0),new $t(Ut,Ut),o),u=[];if(i&&!Fx(a,this._globalClipBounds))return u;for(const d of this._activeRegions){if(d.hiddenByOverlap||!Fx(a,d))continue;const m=G1(d.min,d.max,o);u.push({min:m.min,max:m.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(o){this._setSources(o.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const a=[];for(const u of i.cache.getVisibleCoordinates()){const d=i.cache.getTile(u).buckets[i.layer];d&&d.updateFootprints(u.toUnwrapped(),a)}return a},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(o){const i=o.getFootprints();if(0===i.length)return;const a=o.getOrder(),u=o.getClipMask(),d=o.getClipScope();for(const m of i){if(!m.footprint)continue;const _=vD(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:a,clipMask:u,clipScope:d})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,a)=>i.priority-a.priority||Px(i.min,a.min)||Px(i.max,a.max)||i.order-a.order||i.clipMask-a.clipMask||function(u,d){const m=(_,b)=>_+b;return u.length-d.length||u.reduce(m,"").localeCompare(d.reduce(m,""))}(i.clipScope,a.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let i=0;for(;!o&&i!==this._activeRegions.length;){const a=this._activeRegions[i],u=this._prevRegions[i];o=a.priority!==u.priority||!Nx(a,u)||a.order!==u.order||a.clipMask!==u.clipMask||!Ed(a.clipScope,u.clipScope),++i}}if(o){++this._updateTime;for(const a of this._activeRegions)a.order!==H1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const i=a=>{const u=this._activeRegions;if(a>=u.length)return a;const d=u[a].priority;for(;a<u.length&&u[a].priority===d;)++a;return a};if(this._sourceIds.length>1){let a=0,u=i(a);for(;a!==u;){let d=a;const m=a;for(;d!==u;){const _=this._activeRegions[d];_.hiddenByOverlap=!1;for(let b=0;b<m;b++){const T=this._activeRegions[b];if(!T.hiddenByOverlap&&_.order===H1&&Fx(_,T)&&(_.hiddenByOverlap=Lx(_.footprint,_.tileId,T.footprint,T.tileId),_.hiddenByOverlap))break}++d}a=u,u=i(a)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=o.length-1;i>=0;i--)this._addSource(o[i]);this._computeReplacement()}},f.cq=jd,f.cr=Z0,f.cs=T1,f.ct=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,i){const a=new Ll,u=new cs,d=[],m=o+1+2,_=i[0]+1,b=i[0]+1+(1+i.length),T=(S,A,k)=>{let R=S===m-1?S-2:0===S?S:S-1;return R+=k?24575:0,[R,A]};for(let S=0;S<m;++S)a.emplaceBack(...T(S,0,!0));for(let S=0;S<_;++S)for(let A=0;A<m;++A)a.emplaceBack(...T(A,S,(0===A||A===m-1)&&!0));for(let S=0;S<i.length;++S){const A=i[S];for(let k=0;k<m;++k)a.emplaceBack(...T(k,A,!0))}for(let S=0;S<i.length;++S){const A=u.length,k=i[S]+1+2,R=new cs;for(let H=0;H<k-1;H++){const G=H===k-2,Y=G?m*(b-i.length+S-H):m;for(let ue=0;ue<m-1;ue++){const ae=H*m+ue;0===H||G||0===ue||ue===m-2?(R.emplaceBack(ae+1,ae,ae+Y),R.emplaceBack(ae+Y,ae+Y+1,ae+1)):(u.emplaceBack(ae+1,ae,ae+Y),u.emplaceBack(ae+Y,ae+Y+1,ae+1))}}const L=us.simpleSegment(0,A,a.length,u.length-A);for(let H=0;H<R.uint16.length;H+=3)u.emplaceBack(R.uint16[H],R.uint16[H+1],R.uint16[H+2]);const U=us.simpleSegment(0,A,a.length,u.length-A);d.push({withoutSkirts:L,withSkirts:U})}return{vertices:a,indices:u,segments:d}}_createGrid(o){const i=this._fillGridMeshWithLods(64,w0);this._gridSegments=i.segments,this._gridBuffer=o.createVertexBuffer(i.vertices,P1.members),this._gridIndexBuffer=o.createIndexBuffer(i.indices,!0)}_createPoles(o){const i=new cs;for(let _=0;_<=64;_++)i.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=o.createIndexBuffer(i,!0);const a=new hp,u=new hp,d=new hp,m=new hp;this._poleSegments=[];for(let _=0,b=0;_<gx;_++){const T=360/(1<<_);a.emplaceBack(0,-Va,0,.5,0),u.emplaceBack(0,-Va,0,.5,1),d.emplaceBack(0,-Va,0,.5,.5),m.emplaceBack(0,-Va,0,.5,.5);for(let S=0;S<=64;S++){let A=S/64,k=0;const R=Fn(0,T,A),[L,U,H]=pp(NT,F1,R,Va);a.emplaceBack(L,U,H,A,k),u.emplaceBack(L,U,H,A,1-k);const G=Dr(R);A=.5+.5*Math.sin(G),k=.5+.5*Math.cos(G),d.emplaceBack(L,U,H,A,k),m.emplaceBack(L,U,H,A,1-k)}this._poleSegments.push(us.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,xs,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(u,xs,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(d,xs,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(m,xs,!1)}getGridBuffers(o,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},f.cu=function(o){return tc.has(o)},f.cv=H1,f.cw=QT,f.cx=function(o,i,a=0,u=!0){const d=new $t(a,a),m=o.sub(d),_=i.add(d),b=[m,new $t(_.x,m.y),_,new $t(m.x,_.y)];return u&&b.push(m.clone()),b},f.cy=function(o,i){const a=[];for(let u=0;u<o.length;u++){const d=hh(u-1,-1,o.length-1),m=hh(u+1,-1,o.length-1),_=o[u],b=o[m],T=o[d].sub(_).unit(),S=b.sub(_).unit(),A=S.angleWithSep(T.x,T.y),k=T.add(S).unit().mult(-1*i/Math.sin(A/2));a.push(_.add(k))}return a},f.cz=qr,f.d=Ed,f.d$=ig,f.d0=_o,f.d1=xr,f.d2=Cc,f.d3=Vg,f.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},f.d5=Ec,f.d6=BS,f.d7=mp,f.d8=function([o,i,a]){const u=Math.hypot(o,i,a),d=Math.atan2(o,a),m=.5*Math.PI-Math.acos(-i/u);return new kr(oa(d),oa(m))},f.d9=Vl,f.dA=function(){Eb().acquire(ug)},f.dB=function(){const o=dg;o&&(o.isPreloaded()&&1===o.numActive()?(o.release(ug),dg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.dC=hg,f.dD=function(o){const i=Qw();if(!i)return;const a=i.delete(Fv);o&&a.catch(o).then(()=>o())},f.dE=Dy,f.dF=VM,f.dG=function(o){Cb=aa.resolveURL(o),i_||(i_=new i2(Eb(),new Uf)),i_.broadcast("setDracoUrl",Cb)},f.dH=o2,f.dI=function(o){r_=aa.resolveURL(o),i_||(i_=new i2(Eb(),new Uf)),i_.broadcast("setMeshoptUrl",r_)},f.dJ=kf,f.dK=Pe,f.dL=bp,f.dM=Ha,f.dN=Ip,f.dO=mT,f.dP=GD,f.dQ=Xx,f.dR=jD,f.dS=Wg,f.dT=sM,f.dU=W0,f.dV=function(o,i,a,u,d,m,_,b,T,S,A){o.createArrays(),o.tilePixelRatio=Ut/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const k=o.layers[0].layout,R=o.layers[0]._unevaluatedLayout._values,L={};if("composite"===o.textSizeData.kind){const{minZoom:Y,maxZoom:ue}=o.textSizeData;L.compositeTextSizes=[R["text-size"].possiblyEvaluate(new tr(Y),b),R["text-size"].possiblyEvaluate(new tr(ue),b)]}if("composite"===o.iconSizeData.kind){const{minZoom:Y,maxZoom:ue}=o.iconSizeData;L.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new tr(Y),b),R["icon-size"].possiblyEvaluate(new tr(ue),b)]}L.layoutTextSize=R["text-size"].possiblyEvaluate(new tr(T+1),b),L.layoutIconSize=R["icon-size"].possiblyEvaluate(new tr(T+1),b),L.textMaxSize=R["text-size"].possiblyEvaluate(new tr(18),b);const U="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),H=k.get("text-size");let G=!1;for(const Y of o.features)if(Y.icon&&Y.icon.nameSecondary){G=!0;break}for(const Y of o.features){const ue=k.get("text-font").evaluate(Y,{},b).join(","),ae=H.evaluate(Y,{},b),he=L.layoutTextSize.evaluate(Y,{},b),ve=(L.layoutIconSize.evaluate(Y,{},b),{horizontal:{},vertical:void 0}),we=Y.text;let Se,Fe=[0,0];if(we){const Ye=we.toString(),ht=k.get("text-letter-spacing").evaluate(Y,{},b)*ma,Dt=k.get("text-line-height").evaluate(Y,{},b)*ma,dt=gt(Ye)?ht:0,Nt=k.get("text-anchor").evaluate(Y,{},b),ut=k.get("text-variable-anchor");if(!ut){const Lt=k.get("text-radial-offset").evaluate(Y,{},b);Fe=Lt?ib(Nt,[Lt*ma,Ap]):k.get("text-offset").evaluate(Y,{},b).map(Mt=>Mt*ma)}let vt=U?"center":k.get("text-justify").evaluate(Y,{},b);const zt="point"===k.get("symbol-placement"),ct=zt?k.get("text-max-width").evaluate(Y,{},b)*ma:1/0,qt=Lt=>{o.allowVerticalPlacement&&_t(Ye)&&(ve.vertical=tM(we,i,a,d,ue,ct,Dt,Nt,Lt,dt,Fe,cc.vertical,!0,he,ae))};if(!U&&ut){const Lt="auto"===vt?ut.map(In=>Jm(In)):[vt];let Mt=!1;for(let In=0;In<Lt.length;In++){const _n=Lt[In];if(!ve.horizontal[_n])if(Mt)ve.horizontal[_n]=ve.horizontal[0];else{const en=tM(we,i,a,d,ue,ct,Dt,"center",_n,dt,Fe,cc.horizontal,!1,he,ae);en&&(ve.horizontal[_n]=en,Mt=1===en.positionedLines.length)}}qt("left")}else{if("auto"===vt&&(vt=Jm(Nt)),zt||k.get("text-writing-mode").indexOf("horizontal")>=0||!_t(Ye)){const Lt=tM(we,i,a,d,ue,ct,Dt,Nt,vt,dt,Fe,cc.horizontal,!1,he,ae);Lt&&(ve.horizontal[vt]=Lt)}qt(zt?"left":vt)}}let Ge=!1;if(Y.icon&&Y.icon.namePrimary){const Ye=u[Y.icon.namePrimary];Ye&&(Se=gE(d[Y.icon.namePrimary],Y.icon.nameSecondary?d[Y.icon.nameSecondary]:void 0,k.get("icon-offset").evaluate(Y,{},b),k.get("icon-anchor").evaluate(Y,{},b)),Ge=Ye.sdf,void 0===o.sdfIcons?o.sdfIcons=Ye.sdf:o.sdfIcons!==Ye.sdf&&ks("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==o.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const tt=wE(ve.horizontal)||ve.vertical;o.iconsInText||(o.iconsInText=!!tt&&tt.iconsInText),(tt||Se)&&uM(o,Y,ve,Se,u,L,he,0,Fe,Ge,_,b,S,A,G)}m&&o.generateCollisionDebugBuffers(T,o.collisionBoxArray)},f.dW=Gx,f.dX=Mx,f.dY=R0,f.dZ=ny,f.d_=Z1,f.da=Hm,f.db=qn,f.dc=ir,f.dd=tD,f.de=function(o){const i=[0,0,0],a=f.ae.identity(new Float64Array(16));return f.ae.multiply(a,o.pixelMatrix,o.globeMatrix),f.$.transformMat4(i,i,a),new $t(i[0],i[1])},f.df=Ws,f.dg=vi,f.dh=function(o){const i=o.navigator?o.navigator.userAgent:null;return!!function(a){if(null==ym){const u=a.navigator?a.navigator.userAgent:null;ym=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return ym}(o)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.di=q_,f.dj=class{constructor(o,i,a){this._transformRequestFn=o,this._customAccessToken=i,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const o=function(){let i="";for(let a=0;a<10;a++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yh,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,i){return this._transformRequestFn&&this._transformRequestFn(o,i)||{url:o}}normalizeStyleURL(o,i){if(!_s(o))return o;const a=Sc(o);return a.params.push(`sdk=js-${as}`),a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeGlyphsURL(o,i){if(!_s(o))return o;const a=Sc(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeModelURL(o,i){if(!_s(o))return o;const a=Sc(o);return a.path=`/models/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeSourceURL(o,i,a,u){if(!_s(o))return o;const d=Sc(o);return d.path=`/v4/${d.authority}.json`,d.params.push("secure"),a&&d.params.push(`language=${a}`),u&&d.params.push(`worldview=${u}`),this._makeAPIURL(d,this._customAccessToken||i)}normalizeSpriteURL(o,i,a,u){const d=Sc(o);return _s(o)?(d.path=`/styles/v1${d.path}/sprite${i}${a}`,this._makeAPIURL(d,this._customAccessToken||u)):(d.path+=`${i}${a}`,Lf(d))}normalizeTileURL(o,i,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!_s(o))return o;const u=Sc(o);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||a&&"raster"!==u.authority&&512===a?"@2x":""}${n1.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${qn.RASTER_URL_PREFIX}${u.path}`:"rasterarrays"===u.authority?u.path=`/${qn.RASTERARRAYS_URL_PREFIX}${u.path}`:"3dtiles"===u.authority?u.path=`/${qn.TILES3D_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${qn.TILE_URL_VERSION}${u.path}`);const d=this._customAccessToken||function(m){for(const _ of m){const b=_.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(u.params)||qn.ACCESS_TOKEN;return qn.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,d)}canonicalizeTileURL(o,i){const a=Sc(o);if(!a.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let u="mapbox://";a.path.match(/^\/raster\/v1\//)?u+=`raster/${a.path.replace(`/${qn.RASTER_URL_PREFIX}/`,"")}`:a.path.match(/^\/rasterarrays\/v1\//)?u+=`rasterarrays/${a.path.replace(`/${qn.RASTERARRAYS_URL_PREFIX}/`,"")}`:u+=`tiles/${a.path.replace(`/${qn.TILE_URL_VERSION}/`,"")}`;let d=a.params;return i&&(d=d.filter(m=>!m.match(/^access_token=/))),d.length&&(u+=`?${d.join("&")}`),u}canonicalizeTileset(o,i){const a=!!i&&_s(i),u=[];for(const d of o.tiles||[])jr(d)?u.push(this.canonicalizeTileURL(d,a)):u.push(d);return u}_makeAPIURL(o,i){const a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Sc(qn.API_URL);if(o.protocol=u.protocol,o.authority=u.authority,"http"===o.protocol){const d=o.params.indexOf("secure");d>=0&&o.params.splice(d,1)}if("/"!==u.path&&(o.path=`${u.path}${o.path}`),!qn.REQUIRE_ACCESS_TOKEN)return Lf(o);if(i=i||qn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(d=>-1===d.indexOf("access_token")),o.params.push(`access_token=${i||""}`),Lf(o)}},f.dk=function(o,i){i?tc.add(o):tc.delete(o)},f.dl=n1,f.dm=TS,f.dn=Vv,f.dp=Bv,f.dq=zi,f.dr=wm,f.ds=function(o){tc.delete(o)},f.dt=Tm,f.du=Bf,f.dv=$g,f.dw=as,f.dx=function(o,i){K_=o,J_=i},f.dy=function(o,i,a=!1){if(wr===Un||wr===or||wr===Kn)throw new Error("setRTLTextPlugin cannot be called multiple times.");ur=aa.resolveURL(o),wr=Un,Si=i,dr(),a||Ir()},f.dz=Zn,f.e=aa,f.e0=Sp,f.e1=WT,f.e2=zg,f.e3=WD,f.e4=Uo,f.e5=Pa,f.e6=function(o){let i=0;if(new Uint32Array(o,0,1)[0]!==Fp){const a=new Uint32Array(o,0,7),[,,u,d,m,_]=a;i=a.byteLength+d+m+_+m,(u!==o.byteLength||i>=o.byteLength)&&ks("Invalid b3dm header information.")}return c2(o,i)},f.e7=function(o,i){const a=WM(o);for(const u of a){for(const d of u.meshes)fR(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(vL(u.lights,i)))}return a},f.e8=Qr,f.e9=UM,f.ea=Sr,f.eb=function(o){Kg(),Cu&&Cu.then(i=>{i.keys().then(a=>{for(let u=0;u<a.length-o;u++)i.delete(a[u])})})},f.f=e0,f.g=Yc,f.h=function(o,i){return Cc($o(o,{type:"json"}),i)},f.i=Ad,f.j=Ps,f.k=j0,f.l=function(o){return fetch(o).then(i=>i.arrayBuffer()).then(i=>c2(i,0,o))},f.m=iy,f.n=class extends vb{},f.o=Gr,f.p=_M,f.q=jf,f.r=M,f.s=F,f.t=P,f.u=Mh,f.v=ce,f.w=ks,f.x=eu,f.y=ye,f.z=de}),ts(0,function(f){function as(Me){const K=Me?Me.url.toString():void 0;return K?performance.getEntriesByName(K):[]}function _r(Me){if("number"==typeof Me||"boolean"==typeof Me||"string"==typeof Me||null==Me)return JSON.stringify(Me);if(Array.isArray(Me)){let J="[";for(const me of Me)J+=`${_r(me)},`;return`${J}]`}let K="{";for(const J of Object.keys(Me).sort())K+=`${J}:${_r(Me[J])},`;return`${K}}`}function qn(Me){let K="";for(const J of f.cG)K+=`/${_r(Me[J])}`;return K}class jr{constructor(K){this.keyCache={},this._layers={},this._layerConfigs={},K&&this.replace(K)}replace(K,J){this._layerConfigs={},this._layers={},this.update(K,[],J)}update(K,J,me){this._options=me;for(const Ce of K)this._layerConfigs[Ce.id]=Ce,(this._layers[Ce.id]=f.c$(Ce,this.scope,null,this._options)).compileFilter(),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id];for(const Ce of J)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const Ae=function(Ce,$e){const st={};for(let it=0;it<Ce.length;it++){const Et=$e&&$e[Ce[it].id]||qn(Ce[it]);$e&&($e[Ce[it].id]=Et);let Ct=st[Et];Ct||(Ct=st[Et]=[]),Ct.push(Ce[it])}const Ue=[];for(const it in st)Ue.push(st[it]);return Ue}(f.dJ(this._layerConfigs),this.keyCache);for(const Ce of Ae){const $e=Ce.map(yt=>this._layers[yt.id]),st=$e[0];if("none"===st.visibility)continue;const Ue=st.source||"";let it=this.familiesBySource[Ue];it||(it=this.familiesBySource[Ue]={});const Et=st.sourceLayer||"_geojsonTileLayer";let Ct=it[Et];Ct||(Ct=it[Et]=[]),Ct.push($e)}}}const _s=1*f.dM;class Pr{constructor(K){const J={},me=[];for(const st in K){const Ue=K[st],it=J[st]={};for(const Et in Ue.glyphs){const Ct=Ue.glyphs[+Et];if(!Ct||0===Ct.bitmap.width||0===Ct.bitmap.height)continue;const yt=Ct.metrics.localGlyph?_s:1,Nn={x:0,y:0,w:Ct.bitmap.width+2*yt,h:Ct.bitmap.height+2*yt};me.push(Nn),it[Et]=Nn}}const{w:Ae,h:Ce}=f.k(me),$e=new f.dL({width:Ae||1,height:Ce||1});for(const st in K){const Ue=K[st];for(const it in Ue.glyphs){const Et=Ue.glyphs[+it];if(!Et||0===Et.bitmap.width||0===Et.bitmap.height)continue;const Ct=J[st][it],yt=Et.metrics.localGlyph?_s:1;f.dL.copy(Et.bitmap,$e,{x:0,y:0},{x:Ct.x+yt,y:Ct.y+yt},Et.bitmap)}}this.image=$e,this.positions=J}}f.dK(Pr,"GlyphAtlas");class ei{constructor(K){this.tileID=new f.aQ(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.lut=K.lut,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.scope=K.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.promoteId=K.promoteId,this.isSymbolTile=K.isSymbolTile,this.tileTransform=f.dN(K.tileID.canonical,K.projection),this.projection=K.projection,this.brightness=K.brightness,this.extraShadowCaster=!!K.extraShadowCaster,this.tessellationStep=K.tessellationStep}parse(K,J,me,Ae,Ce){this.status="parsing",this.data=K,this.collisionBoxArray=new f.dO;const $e=new f.dP(Object.keys(K.layers).sort()),st=new f.dQ(this.tileID,this.promoteId);st.bucketLayerIDs=[];const Ue={},it=new f.dR(256,256),Et={featureIndex:st,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:it,availableImages:me,brightness:this.brightness},Ct=J.familiesBySource[this.source];for(const yn in Ct){const Qi=K.layers[yn];if(!Qi)continue;let Yr=!1,Ur=!1,Kr=!1;for(const jo of Ct[yn])"symbol"===jo[0].type?Yr=!0:Ur=!0,jo[0].is3D()&&"model"!==jo[0].type&&(Kr=!0);if(this.extraShadowCaster&&!Kr||!0===this.isSymbolTile&&!Yr||!1===this.isSymbolTile&&!Ur)continue;1===Qi.version&&f.w(`Vector tile source "${this.source}" layer "${yn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const zs=$e.encode(yn),uo=[];for(let jo=0;jo<Qi.length;jo++){const Oa=Qi.feature(jo),bd=st.getId(Oa,yn);uo.push({feature:Oa,id:bd,index:jo,sourceLayerIndex:zs})}for(const jo of Ct[yn]){const Oa=jo[0];(!this.extraShadowCaster||Oa.is3D()&&"model"!==Oa.type)&&(void 0!==this.isSymbolTile&&"symbol"===Oa.type!==this.isSymbolTile||Oa.minzoom&&this.zoom<Math.floor(Oa.minzoom)||Oa.maxzoom&&this.zoom>=Oa.maxzoom||"none"!==Oa.visibility&&(Is(jo,this.zoom,Et.brightness,me),(Ue[Oa.id]=Oa.createBucket({index:st.bucketLayerIDs.length,layers:jo,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zs,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(uo,Et,this.tileID.canonical,this.tileTransform),st.bucketLayerIDs.push(jo.map(bd=>bd.id))))}}let yt,Nn,Qn,$r;it.trim();const gr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},zr=()=>{if(yt)return this.status="done",Ce(yt);if(this.extraShadowCaster)this.status="done",Ce(null,{buckets:f.dJ(Ue).filter(yn=>!yn.isEmpty()),featureIndex:st,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Et.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Nn&&Qn&&$r){const yn=new Pr(Nn),Qi=new f.dT(Qn,$r,this.lut);for(const Yr in Ue){const Ur=Ue[Yr];Ur instanceof f.dU?(Is(Ur.layers,this.zoom,Et.brightness,me),f.dV(Ur,Nn,yn.positions,Qn,Qi.iconPositions,this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Ur.hasPattern&&(Ur instanceof f.dW||Ur instanceof f.dX||Ur instanceof f.c0)&&(Is(Ur.layers,this.zoom,Et.brightness,me),Ur.addFeatures(Et,this.tileID.canonical,Qi.patternPositions,me,this.tileTransform,this.brightness))}this.status="done",Ce(null,{buckets:f.dJ(Ue).filter(Yr=>!Yr.isEmpty()),featureIndex:st,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yn.image,lineAtlas:it,imageAtlas:Qi,brightness:Et.brightness})}};if(!this.extraShadowCaster){const yn=f.dS(Et.glyphDependencies,Ur=>Object.keys(Ur).map(Number));Object.keys(yn).length?Ae.send("getGlyphs",{uid:this.uid,stacks:yn,scope:this.scope},(Ur,Kr)=>{yt||(yt=Ur,Nn=Kr,zr())},void 0,!1,gr):Nn={};const Qi=Object.keys(Et.iconDependencies);Qi.length?Ae.send("getImages",{icons:Qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ur,Kr)=>{yt||(yt=Ur,Qn=Kr,zr())},void 0,!1,gr):Qn={};const Yr=Object.keys(Et.patternDependencies);Yr.length?Ae.send("getImages",{icons:Yr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ur,Kr)=>{yt||(yt=Ur,$r=Kr,zr())},void 0,!1,gr):$r={}}zr()}}function Is(Me,K,J,me){const Ae=new f.Y(K,{brightness:J});for(const Ce of Me)Ce.recalculate(Ae,me)}class vi extends f.E{constructor(K,J,me,Ae,Ce,$e){super(),this.actor=K,this.layerIndex=J,this.availableImages=me,this.loadVectorData=Ce||f.aq,this.loading={},this.loaded={},this.deduped=new f.ap(K.scheduler),this.isSpriteLoaded=Ae,this.scheduler=K.scheduler,this.brightness=$e}loadTile(K,J){const me=K.uid,Ae=K&&K.request,Ce=Ae&&Ae.collectResourceTiming,$e=this.loading[me]=new ei(K);$e.abort=this.loadVectorData(K,(st,Ue)=>{const it=!this.loading[me];if(delete this.loading[me],it||st||!Ue)return $e.status="done",it||(this.loaded[me]=$e),J(st);const Et=Ue.rawData,Ct={};Ue.expires&&(Ct.expires=Ue.expires),Ue.cacheControl&&(Ct.cacheControl=Ue.cacheControl),$e.vectorTile=Ue.vectorTile||new f.dY(new f.dZ(Et));const yt=()=>{$e.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,(Nn,Qn)=>{if(Nn||!Qn)return J(Nn);const $r={};if(Ce){const gr=as(Ae);gr.length>0&&($r.resourceTiming=JSON.parse(JSON.stringify(gr)))}J(null,f.Q({rawTileData:Et.slice(0)},Qn,Ct,$r))})};this.isSpriteLoaded?yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yt,{type:"parseTile",isSymbolTile:K.isSymbolTile,zoom:K.tileZoom}):yt()}),this.loaded=this.loaded||{},this.loaded[me]=$e})}reloadTile(K,J){const me=this.loaded,Ae=K.uid;if(me&&me[Ae]){const Ce=me[Ae];Ce.showCollisionBoxes=K.showCollisionBoxes,Ce.projection=K.projection,Ce.brightness=K.brightness,Ce.tileTransform=f.dN(K.tileID.canonical,K.projection),Ce.extraShadowCaster=K.extraShadowCaster,Ce.lut=K.lut;const $e=(st,Ue)=>{const it=Ce.reloadCallback;it&&(delete Ce.reloadCallback,Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,it)),J(st,Ue)};"parsing"===Ce.status?Ce.reloadCallback=$e:"done"===Ce.status&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,$e):$e())}else J(null,void 0)}abortTile(K,J){const me=K.uid,Ae=this.loading[me];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[me]),J()}removeTile(K,J){const me=this.loaded,Ae=K.uid;me&&me[Ae]&&delete me[Ae],J()}}class Ws{loadTile(K,J){const{uid:me,encoding:Ae,rawImageData:Ce,padding:$e}=K,st=ImageBitmap&&Ce instanceof ImageBitmap?this.getImageData(Ce,$e):Ce;J(null,new f.d_(me,st,Ae,$e<1))}getImageData(K,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(K.width,K.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=K.width,this.offscreenCanvas.height=K.height,this.offscreenCanvasContext.drawImage(K,0,0,K.width,K.height);const me=this.offscreenCanvasContext.getImageData(-J,-J,K.width+2*J,K.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}f.d$.setPbf(f.dZ);class bc{decodeRasterArray({task:K,buffer:J},me){f.d$.performDecoding(J,K).then(Ae=>{me(null,Ae)},Ae=>{me(Ae)})}}const Uo=f.e0.prototype.toGeoJSON;let xi=class{constructor(Me){this._feature=Me,this.extent=f.a4,this.type=Me.type,this.properties=Me.tags,"id"in Me&&!isNaN(Me.id)&&(this.id=parseInt(Me.id,10))}loadGeometry(){if(1===this._feature.type){const Me=[];for(const K of this._feature.geometry)Me.push([new f.P(K[0],K[1])]);return Me}{const Me=[];for(const K of this._feature.geometry){const J=[];for(const me of K)J.push(new f.P(me[0],me[1]));Me.push(J)}return Me}}toGeoJSON(Me,K,J){return Uo.call(this,Me,K,J)}},Ai=class{constructor(Me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.a4,this.length=Me.length,this._features=Me}feature(Me){return new xi(this._features[Me])}};const Ks=64/4096,sa=128;class ah{constructor(){this.features=new Map}clear(){this.features.clear()}load(K=[],J){for(const me of K){const Ae=me.id;if(null==Ae)continue;let Ce=this.features.get(Ae);Ce&&this.updateCache(Ce,J),me.geometry?(Ce=ci(me),this.updateCache(Ce,J),this.features.set(Ae,Ce)):this.features.delete(Ae),this.updateCache(Ce,J)}}updateCache(K,J){for(const{canonical:me,uid:Ae}of Object.values(J)){const{z:Ce,x:$e,y:st}=me;vu(K,Math.pow(2,Ce),$e,st)&&delete J[Ae]}}getTile(K,J,me){const Ae=Math.pow(2,K),Ce=[];for(const $e of this.features.values())vu($e,Ae,J,me)&&Ce.push(Ef($e,Ae,J,me));return{features:Ce}}getFeatures(){return[...this.features.values()]}}function vu({minX:Me,minY:K,maxX:J,maxY:me},Ae,Ce,$e){return Me<(Ce+1+Ks)/Ae&&K<($e+1+Ks)/Ae&&J>(Ce-Ks)/Ae&&me>($e-Ks)/Ae}function ci(Me){const{id:K,geometry:J,properties:me}=Me;if(!J)return;if("GeometryCollection"===J.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ae,coordinates:Ce}=J,$e={id:K,type:1,geometry:[],tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},st=$e.geometry;if("Point"===Ae)Xr(Ce,st,$e);else if("MultiPoint"===Ae)for(const Ue of Ce)Xr(Ue,st,$e);else if("LineString"===Ae)$e.type=2,Ya(Ce,st,$e);else if("MultiLineString"===Ae)$e.type=2,xu(Ce,st,$e);else if("Polygon"===Ae)$e.type=3,xu(Ce,st,$e,!0);else{if("MultiPolygon"!==Ae)throw new Error("Input data is not a valid GeoJSON object.");$e.type=3;for(const Ue of Ce)xu(Ue,st,$e,!0)}return $e}function Xr([Me,K],J,me){const Ae=f.ak(Me);let Ce=f.al(K);Ce=Ce<0?0:Ce>1?1:Ce,J.push(Ae,Ce),me.minX=Math.min(me.minX,Ae),me.minY=Math.min(me.minY,Ce),me.maxX=Math.max(me.maxX,Ae),me.maxY=Math.max(me.maxY,Ce)}function Ya(Me,K,J,me=!1,Ae=!1){const Ce=[];for(const $e of Me)Xr($e,Ce,J);K.push(Ce),me&&function($e,st){let Ue=0;for(let it=0,Et=$e.length,Ct=Et-2;it<Et;Ct=it,it+=2)Ue+=($e[it]-$e[Ct])*($e[it+1]+$e[Ct+1]);if(Ue>0===st)for(let it=0,Et=$e.length;it<Et/2;it+=2){const Ct=$e[it],yt=$e[it+1];$e[it]=$e[Et-2-it],$e[it+1]=$e[Et-1-it],$e[Et-2-it]=Ct,$e[Et-1-it]=yt}}(Ce,Ae)}function xu(Me,K,J,me=!1){for(let Ae=0;Ae<Me.length;Ae++)Ya(Me[Ae],K,J,me,0===Ae)}function Ef(Me,K,J,me){const{id:Ae,type:Ce,geometry:$e,tags:st}=Me,Ue=[];if(1===Ce)!function(it,Et,Ct,yt,Nn){for(let Qn=0;Qn<it.length;Qn+=2){const $r=Math.round(f.a4*(it[Qn+0]*Et-Ct)),gr=Math.round(f.a4*(it[Qn+1]*Et-yt));Nn.push([$r,gr])}}($e,K,J,me,Ue);else for(const it of $e)bu(it,K,J,me,Ue);return{id:Ae,type:Ce,geometry:Ue,tags:st}}function bu(Me,K,J,me,Ae){const Ce=-sa,$e=f.a4+sa;let st;for(let Ue=0;Ue<Me.length-2;Ue+=2){let it=Math.round(f.a4*(Me[Ue+0]*K-J)),Et=Math.round(f.a4*(Me[Ue+1]*K-me)),Ct=Math.round(f.a4*(Me[Ue+2]*K-J)),yt=Math.round(f.a4*(Me[Ue+3]*K-me));const Nn=Ct-it,Qn=yt-Et;it<Ce&&Ct<Ce||(it<Ce?(Et+=Math.round(Qn*((Ce-it)/Nn)),it=Ce):Ct<Ce&&(yt=Et+Math.round(Qn*((Ce-it)/Nn)),Ct=Ce),Et<Ce&&yt<Ce||(Et<Ce?(it+=Math.round(Nn*((Ce-Et)/Qn)),Et=Ce):yt<Ce&&(Ct=it+Math.round(Nn*((Ce-Et)/Qn)),yt=Ce),it>=$e&&Ct>=$e||(it>=$e?(Et+=Math.round(Qn*(($e-it)/Nn)),it=$e):Ct>=$e&&(yt=Et+Math.round(Qn*(($e-it)/Nn)),Ct=$e),Et>=$e&&yt>=$e||(Et>=$e?(it+=Math.round(Nn*(($e-Et)/Qn)),Et=$e):yt>=$e&&(Ct=it+Math.round(Nn*(($e-Et)/Qn)),yt=$e),st&&it===st[st.length-1][0]&&Et===st[st.length-1][1]||(st=[[it,Et]],Ae.push(st)),st.push([Ct,yt])))))}}var ui={exports:{}},wc=f.e2,Ka=f.e1.VectorTileFeature,am=lh;function lh(Me,K){this.options=K||{},this.features=Me,this.length=Me.length}function Wc(Me,K){this.id="number"==typeof Me.id?Me.id:void 0,this.type=Me.type,this.rawGeometry=1===Me.type?[Me.geometry]:Me.geometry,this.properties=Me.tags,this.extent=K||4096}lh.prototype.feature=function(Me){return new Wc(this.features[Me],this.options.extent)},Wc.prototype.loadGeometry=function(){var Me=this.rawGeometry;this.geometry=[];for(var K=0;K<Me.length;K++){for(var J=Me[K],me=[],Ae=0;Ae<J.length;Ae++)me.push(new wc(J[Ae][0],J[Ae][1]));this.geometry.push(me)}return this.geometry},Wc.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Me=this.geometry,K=1/0,J=-1/0,me=1/0,Ae=-1/0,Ce=0;Ce<Me.length;Ce++)for(var $e=Me[Ce],st=0;st<$e.length;st++){var Ue=$e[st];K=Math.min(K,Ue.x),J=Math.max(J,Ue.x),me=Math.min(me,Ue.y),Ae=Math.max(Ae,Ue.y)}return[K,me,J,Ae]},Wc.prototype.toGeoJSON=Ka.prototype.toGeoJSON;var ii=f.e3,Jl=am;function co(Me){var K=new ii;return function(J,me){for(var Ae in J.layers)me.writeMessage(3,Rg,J.layers[Ae])}(Me,K),K.finish()}function Rg(Me,K){var J;K.writeVarintField(15,Me.version||1),K.writeStringField(1,Me.name||""),K.writeVarintField(5,Me.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(J=0;J<Me.length;J++)me.feature=Me.feature(J),K.writeMessage(2,Pg,me);var Ae=me.keys;for(J=0;J<Ae.length;J++)K.writeStringField(3,Ae[J]);var Ce=me.values;for(J=0;J<Ce.length;J++)K.writeMessage(4,wt,Ce[J])}function Pg(Me,K){var J=Me.feature;void 0!==J.id&&K.writeVarintField(1,J.id),K.writeMessage(2,_d,Me),K.writeVarintField(3,J.type),K.writeMessage(4,Li,J)}function _d(Me,K){var J=Me.feature,me=Me.keys,Ae=Me.values,Ce=Me.keycache,$e=Me.valuecache;for(var st in J.properties){var Ue=J.properties[st],it=Ce[st];if(null!==Ue){void 0===it&&(me.push(st),Ce[st]=it=me.length-1),K.writeVarint(it);var Et=typeof Ue;"string"!==Et&&"boolean"!==Et&&"number"!==Et&&(Ue=JSON.stringify(Ue));var Ct=Et+":"+Ue,yt=$e[Ct];void 0===yt&&(Ae.push(Ue),$e[Ct]=yt=Ae.length-1),K.writeVarint(yt)}}}function nr(Me,K){return(K<<3)+(7&Me)}function yd(Me){return Me<<1^Me>>31}function Li(Me,K){for(var J=Me.loadGeometry(),me=Me.type,Ae=0,Ce=0,$e=J.length,st=0;st<$e;st++){var Ue=J[st],it=1;1===me&&(it=Ue.length),K.writeVarint(nr(1,it));for(var Et=3===me?Ue.length-1:Ue.length,Ct=0;Ct<Et;Ct++){1===Ct&&1!==me&&K.writeVarint(nr(2,Et-1));var yt=Ue[Ct].x-Ae,Nn=Ue[Ct].y-Ce;K.writeVarint(yd(yt)),K.writeVarint(yd(Nn)),Ae+=yt,Ce+=Nn}3===me&&K.writeVarint(nr(7,1))}}function wt(Me,K){var J=typeof Me;"string"===J?K.writeStringField(1,Me):"boolean"===J?K.writeBooleanField(7,Me):"number"===J&&(Me%1!=0?K.writeDoubleField(3,Me):Me<0?K.writeSVarintField(6,Me):K.writeVarintField(5,Me))}ui.exports=co,ui.exports.fromVectorTileJs=co,ui.exports.fromGeojsonVt=function(Me,K){K=K||{};var J={};for(var me in Me)J[me]=new Jl(Me[me].features,K),J[me].name=me,J[me].version=K.version,J[me].extent=K.extent;return co({layers:J})},ui.exports.GeoJSONWrapper=Jl;var Rt=f.e4(ui.exports);const an={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Me=>Me},pn=Math.fround||(cr=new Float32Array(1),Me=>(cr[0]=+Me,cr[0]));var cr;const hn=3,ns=5,Bi=6;class mn{constructor(K){this.options=Object.assign(Object.create(an),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:J,minZoom:me,maxZoom:Ae}=this.options;J&&console.time("total time");const Ce=`prepare ${K.length} points`;J&&console.time(Ce),this.points=K;const $e=[];for(let Ue=0;Ue<K.length;Ue++){const it=K[Ue];if(!it.geometry)continue;const[Et,Ct]=it.geometry.coordinates,yt=pn(Js(Et)),Nn=pn(Ma(Ct));$e.push(yt,Nn,1/0,Ue,-1,1),this.options.reduce&&$e.push(0)}let st=this.trees[Ae+1]=this._createTree($e);J&&console.timeEnd(Ce);for(let Ue=Ae;Ue>=me;Ue--){const it=+Date.now();st=this.trees[Ue]=this._createTree(this._cluster(st,Ue)),J&&console.log("z%d: %d clusters in %dms",Ue,st.numItems,+Date.now()-it)}return J&&console.timeEnd("total time"),this}getClusters(K,J){let me=((K[0]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,K[1]));let Ce=180===K[2]?180:((K[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)me=-180,Ce=180;else if(me>Ce){const Ct=this.getClusters([me,Ae,180,$e],J),yt=this.getClusters([-180,Ae,Ce,$e],J);return Ct.concat(yt)}const st=this.trees[this._limitZoom(J)],Ue=st.range(Js(me),Ma($e),Js(Ce),Ma(Ae)),it=st.data,Et=[];for(const Ct of Ue){const yt=this.stride*Ct;Et.push(it[yt+ns]>1?dn(it,yt,this.clusterProps):this.points[it[yt+hn]])}return Et}getChildren(K){const J=this._getOriginId(K),me=this._getOriginZoom(K),Ae="No cluster with the specified id.",Ce=this.trees[me];if(!Ce)throw new Error(Ae);const $e=Ce.data;if(J*this.stride>=$e.length)throw new Error(Ae);const st=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Ue=Ce.within($e[J*this.stride],$e[J*this.stride+1],st),it=[];for(const Et of Ue){const Ct=Et*this.stride;$e[Ct+4]===K&&it.push($e[Ct+ns]>1?dn($e,Ct,this.clusterProps):this.points[$e[Ct+hn]])}if(0===it.length)throw new Error(Ae);return it}getLeaves(K,J,me){const Ae=[];return this._appendLeaves(Ae,K,J=J||10,me=me||0,0),Ae}getTile(K,J,me){const Ae=this.trees[this._limitZoom(K)],Ce=Math.pow(2,K),{extent:$e,radius:st}=this.options,Ue=st/$e,it=(me-Ue)/Ce,Et=(me+1+Ue)/Ce,Ct={features:[]};return this._addTileFeatures(Ae.range((J-Ue)/Ce,it,(J+1+Ue)/Ce,Et),Ae.data,J,me,Ce,Ct),0===J&&this._addTileFeatures(Ae.range(1-Ue/Ce,it,1,Et),Ae.data,Ce,me,Ce,Ct),J===Ce-1&&this._addTileFeatures(Ae.range(0,it,Ue/Ce,Et),Ae.data,-1,me,Ce,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(K){let J=this._getOriginZoom(K)-1;for(;J<=this.options.maxZoom;){const me=this.getChildren(K);if(J++,1!==me.length)break;K=me[0].properties.cluster_id}return J}_appendLeaves(K,J,me,Ae,Ce){const $e=this.getChildren(J);for(const st of $e){const Ue=st.properties;if(Ue&&Ue.cluster?Ce+Ue.point_count<=Ae?Ce+=Ue.point_count:Ce=this._appendLeaves(K,Ue.cluster_id,me,Ae,Ce):Ce<Ae?Ce++:K.push(st),K.length===me)break}return Ce}_createTree(K){const J=new f.cN(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<K.length;me+=this.stride)J.add(K[me],K[me+1]);return J.finish(),J.data=K,J}_addTileFeatures(K,J,me,Ae,Ce,$e){for(const st of K){const Ue=st*this.stride,it=J[Ue+ns]>1;let Et,Ct,yt;if(it)Et=Ja(J,Ue,this.clusterProps),Ct=J[Ue],yt=J[Ue+1];else{const $r=this.points[J[Ue+hn]];Et=$r.properties;const[gr,zr]=$r.geometry.coordinates;Ct=Js(gr),yt=Ma(zr)}const Nn={type:1,geometry:[[Math.round(this.options.extent*(Ct*Ce-me)),Math.round(this.options.extent*(yt*Ce-Ae))]],tags:Et};let Qn;Qn=it||this.options.generateId?J[Ue+hn]:this.points[J[Ue+hn]].id,void 0!==Qn&&(Nn.id=Qn),$e.features.push(Nn)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,J){const{radius:me,extent:Ae,reduce:Ce,minPoints:$e}=this.options,st=me/(Ae*Math.pow(2,J)),Ue=K.data,it=[],Et=this.stride;for(let Ct=0;Ct<Ue.length;Ct+=Et){if(Ue[Ct+2]<=J)continue;Ue[Ct+2]=J;const yt=Ue[Ct],Nn=Ue[Ct+1],Qn=K.within(Ue[Ct],Ue[Ct+1],st),$r=Ue[Ct+ns];let gr=$r;for(const zr of Qn){const yn=zr*Et;Ue[yn+2]>J&&(gr+=Ue[yn+ns])}if(gr>$r&&gr>=$e){let zr,yn=yt*$r,Qi=Nn*$r,Yr=-1;const Ur=(Ct/Et<<5)+(J+1)+this.points.length;for(const Kr of Qn){const zs=Kr*Et;if(Ue[zs+2]<=J)continue;Ue[zs+2]=J;const uo=Ue[zs+ns];yn+=Ue[zs]*uo,Qi+=Ue[zs+1]*uo,Ue[zs+4]=Ur,Ce&&(zr||(zr=this._map(Ue,Ct,!0),Yr=this.clusterProps.length,this.clusterProps.push(zr)),Ce(zr,this._map(Ue,zs)))}Ue[Ct+4]=Ur,it.push(yn/gr,Qi/gr,1/0,Ur,-1,gr),Ce&&it.push(Yr)}else{for(let zr=0;zr<Et;zr++)it.push(Ue[Ct+zr]);if(gr>1)for(const zr of Qn){const yn=zr*Et;if(!(Ue[yn+2]<=J)){Ue[yn+2]=J;for(let Qi=0;Qi<Et;Qi++)it.push(Ue[yn+Qi])}}}}return it}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,J,me){if(K[J+ns]>1){const $e=this.clusterProps[K[J+Bi]];return me?Object.assign({},$e):$e}const Ae=this.points[K[J+hn]].properties,Ce=this.options.map(Ae);return me&&Ce===Ae?Object.assign({},Ce):Ce}}function dn(Me,K,J){return{type:"Feature",id:Me[K+hn],properties:Ja(Me,K,J),geometry:{type:"Point",coordinates:[(me=Me[K],360*(me-.5)),Qa(Me[K+1])]}};var me}function Ja(Me,K,J){const me=Me[K+ns],Ae=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ce=Me[K+Bi],$e=-1===Ce?{}:Object.assign({},J[Ce]);return Object.assign($e,{cluster:!0,cluster_id:Me[K+hn],point_count:me,point_count_abbreviated:Ae})}function Js(Me){return Me/360+.5}function Ma(Me){const K=Math.sin(Me*Math.PI/180),J=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return J<0?0:J>1?1:J}function Qa(Me){const K=(180-360*Me)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function qs(Me,K,J,me){let Ae=me;const Ce=K+(J-K>>1);let $e,st=J-K;const Ue=Me[K],it=Me[K+1],Et=Me[J],Ct=Me[J+1];for(let yt=K+3;yt<J;yt+=3){const Nn=qc(Me[yt],Me[yt+1],Ue,it,Et,Ct);if(Nn>Ae)$e=yt,Ae=Nn;else if(Nn===Ae){const Qn=Math.abs(yt-Ce);Qn<st&&($e=yt,st=Qn)}}Ae>me&&($e-K>3&&qs(Me,K,$e,me),Me[$e+2]=Ae,J-$e>3&&qs(Me,$e,J,me))}function qc(Me,K,J,me,Ae,Ce){let $e=Ae-J,st=Ce-me;if(0!==$e||0!==st){const Ue=((Me-J)*$e+(K-me)*st)/($e*$e+st*st);Ue>1?(J=Ae,me=Ce):Ue>0&&(J+=$e*Ue,me+=st*Ue)}return $e=Me-J,st=K-me,$e*$e+st*st}function ji(Me,K,J,me){const Ae={id:Me??null,type:K,geometry:J,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===K||"MultiPoint"===K||"LineString"===K)el(Ae,J);else if("Polygon"===K)el(Ae,J[0]);else if("MultiLineString"===K)for(const Ce of J)el(Ae,Ce);else if("MultiPolygon"===K)for(const Ce of J)el(Ae,Ce[0]);return Ae}function el(Me,K){for(let J=0;J<K.length;J+=3)Me.minX=Math.min(Me.minX,K[J]),Me.minY=Math.min(Me.minY,K[J+1]),Me.maxX=Math.max(Me.maxX,K[J]),Me.maxY=Math.max(Me.maxY,K[J+1])}function ch(Me,K,J,me){if(!K.geometry)return;const Ae=K.geometry.coordinates;if(Ae&&0===Ae.length)return;const Ce=K.geometry.type,$e=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let st=[],Ue=K.id;if(J.promoteId?Ue=K.properties[J.promoteId]:J.generateId&&(Ue=me||0),"Point"===Ce)vd(Ae,st);else if("MultiPoint"===Ce)for(const it of Ae)vd(it,st);else if("LineString"===Ce)Zc(Ae,st,$e,!1);else if("MultiLineString"===Ce){if(J.lineMetrics){for(const it of Ae)st=[],Zc(it,st,$e,!1),Me.push(ji(Ue,"LineString",st,K.properties));return}Ql(Ae,st,$e,!1)}else if("Polygon"===Ce)Ql(Ae,st,$e,!0);else{if("MultiPolygon"!==Ce){if("GeometryCollection"===Ce){for(const it of K.geometry.geometries)ch(Me,{id:Ue,geometry:it,properties:K.properties},J,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const it of Ae){const Et=[];Ql(it,Et,$e,!0),st.push(Et)}}Me.push(ji(Ue,Ce,st,K.properties))}function vd(Me,K){K.push(Aa(Me[0]),Ia(Me[1]),0)}function Zc(Me,K,J,me){let Ae,Ce,$e=0;for(let Ue=0;Ue<Me.length;Ue++){const it=Aa(Me[Ue][0]),Et=Ia(Me[Ue][1]);K.push(it,Et,0),Ue>0&&($e+=me?(Ae*Et-it*Ce)/2:Math.sqrt(Math.pow(it-Ae,2)+Math.pow(Et-Ce,2))),Ae=it,Ce=Et}const st=K.length-3;K[2]=1,qs(K,0,st,J),K[st+2]=1,K.size=Math.abs($e),K.start=0,K.end=K.size}function Ql(Me,K,J,me){for(let Ae=0;Ae<Me.length;Ae++){const Ce=[];Zc(Me[Ae],Ce,J,me),K.push(Ce)}}function Aa(Me){return Me/360+.5}function Ia(Me){const K=Math.sin(Me*Math.PI/180),J=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return J<0?0:J>1?1:J}function sr(Me,K,J,me,Ae,Ce,$e,st){if(me/=K,Ce>=(J/=K)&&$e<me)return Me;if($e<J||Ce>=me)return null;const Ue=[];for(const it of Me){const Et=it.geometry;let Ct=it.type;const yt=0===Ae?it.minX:it.minY,Nn=0===Ae?it.maxX:it.maxY;if(yt>=J&&Nn<me){Ue.push(it);continue}if(Nn<J||yt>=me)continue;let Qn=[];if("Point"===Ct||"MultiPoint"===Ct)Cf(Et,Qn,J,me,Ae);else if("LineString"===Ct)So(Et,Qn,J,me,Ae,!1,st.lineMetrics);else if("MultiLineString"===Ct)wu(Et,Qn,J,me,Ae,!1);else if("Polygon"===Ct)wu(Et,Qn,J,me,Ae,!0);else if("MultiPolygon"===Ct)for(const $r of Et){const gr=[];wu($r,gr,J,me,Ae,!0),gr.length&&Qn.push(gr)}if(Qn.length){if(st.lineMetrics&&"LineString"===Ct){for(const $r of Qn)Ue.push(ji(it.id,Ct,$r,it.tags));continue}"LineString"!==Ct&&"MultiLineString"!==Ct||(1===Qn.length?(Ct="LineString",Qn=Qn[0]):Ct="MultiLineString"),"Point"!==Ct&&"MultiPoint"!==Ct||(Ct=3===Qn.length?"Point":"MultiPoint"),Ue.push(ji(it.id,Ct,Qn,it.tags))}}return Ue.length?Ue:null}function Cf(Me,K,J,me,Ae){for(let Ce=0;Ce<Me.length;Ce+=3){const $e=Me[Ce+Ae];$e>=J&&$e<=me&&ka(K,Me[Ce],Me[Ce+1],Me[Ce+2])}}function So(Me,K,J,me,Ae,Ce,$e){let st=Tc(Me);const Ue=0===Ae?Sf:xd;let it,Et,Ct=Me.start;for(let gr=0;gr<Me.length-3;gr+=3){const zr=Me[gr],yn=Me[gr+1],Qi=Me[gr+2],Yr=Me[gr+3],Ur=Me[gr+4],Kr=0===Ae?zr:yn,zs=0===Ae?Yr:Ur;let uo=!1;$e&&(it=Math.sqrt(Math.pow(zr-Yr,2)+Math.pow(yn-Ur,2))),Kr<J?zs>J&&(Et=Ue(st,zr,yn,Yr,Ur,J),$e&&(st.start=Ct+it*Et)):Kr>me?zs<me&&(Et=Ue(st,zr,yn,Yr,Ur,me),$e&&(st.start=Ct+it*Et)):ka(st,zr,yn,Qi),zs<J&&Kr>=J&&(Et=Ue(st,zr,yn,Yr,Ur,J),uo=!0),zs>me&&Kr<=me&&(Et=Ue(st,zr,yn,Yr,Ur,me),uo=!0),!Ce&&uo&&($e&&(st.end=Ct+it*Et),K.push(st),st=Tc(Me)),$e&&(Ct+=it)}let yt=Me.length-3;const Nn=Me[yt],Qn=Me[yt+1],$r=0===Ae?Nn:Qn;$r>=J&&$r<=me&&ka(st,Nn,Qn,Me[yt+2]),yt=st.length-3,Ce&&yt>=3&&(st[yt]!==st[0]||st[yt+1]!==st[1])&&ka(st,st[0],st[1],st[2]),st.length&&K.push(st)}function Tc(Me){const K=[];return K.size=Me.size,K.start=Me.start,K.end=Me.end,K}function wu(Me,K,J,me,Ae,Ce){for(const $e of Me)So($e,K,J,me,Ae,Ce,!1)}function ka(Me,K,J,me){Me.push(K,J,me)}function Sf(Me,K,J,me,Ae,Ce){const $e=(Ce-K)/(me-K);return ka(Me,Ce,J+(Ae-J)*$e,1),$e}function xd(Me,K,J,me,Ae,Ce){const $e=(Ce-J)/(Ae-J);return ka(Me,K+(me-K)*$e,Ce,1),$e}function Df(Me,K){const J=[];for(let me=0;me<Me.length;me++){const Ae=Me[me],Ce=Ae.type;let $e;if("Point"===Ce||"MultiPoint"===Ce||"LineString"===Ce)$e=Tu(Ae.geometry,K);else if("MultiLineString"===Ce||"Polygon"===Ce){$e=[];for(const st of Ae.geometry)$e.push(Tu(st,K))}else if("MultiPolygon"===Ce){$e=[];for(const st of Ae.geometry){const Ue=[];for(const it of st)Ue.push(Tu(it,K));$e.push(Ue)}}J.push(ji(Ae.id,Ce,$e,Ae.tags))}return J}function Tu(Me,K){const J=[];J.size=Me.size,void 0!==Me.start&&(J.start=Me.start,J.end=Me.end);for(let me=0;me<Me.length;me+=3)J.push(Me[me]+K,Me[me+1],Me[me+2]);return J}function tl(Me,K){if(Me.transformed)return Me;const J=1<<Me.z,me=Me.x,Ae=Me.y;for(const Ce of Me.features){const $e=Ce.geometry,st=Ce.type;if(Ce.geometry=[],1===st)for(let Ue=0;Ue<$e.length;Ue+=2)Ce.geometry.push(Mf($e[Ue],$e[Ue+1],K,J,me,Ae));else for(let Ue=0;Ue<$e.length;Ue++){const it=[];for(let Et=0;Et<$e[Ue].length;Et+=2)it.push(Mf($e[Ue][Et],$e[Ue][Et+1],K,J,me,Ae));Ce.geometry.push(it)}}return Me.transformed=!0,Me}function Mf(Me,K,J,me,Ae,Ce){return[Math.round(J*(Me*me-Ae)),Math.round(J*(K*me-Ce))]}function Eu(Me,K,J,me,Ae){const Ce=K===Ae.maxZoom?0:Ae.tolerance/((1<<K)*Ae.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:Me.length,source:null,x:J,y:me,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const st of Me)$i($e,st,Ce,Ae);return $e}function $i(Me,K,J,me){const Ae=K.geometry,Ce=K.type,$e=[];if(Me.minX=Math.min(Me.minX,K.minX),Me.minY=Math.min(Me.minY,K.minY),Me.maxX=Math.max(Me.maxX,K.maxX),Me.maxY=Math.max(Me.maxY,K.maxY),"Point"===Ce||"MultiPoint"===Ce)for(let st=0;st<Ae.length;st+=3)$e.push(Ae[st],Ae[st+1]),Me.numPoints++,Me.numSimplified++;else if("LineString"===Ce)Dl($e,Ae,Me,J,!1,!1);else if("MultiLineString"===Ce||"Polygon"===Ce)for(let st=0;st<Ae.length;st++)Dl($e,Ae[st],Me,J,"Polygon"===Ce,0===st);else if("MultiPolygon"===Ce)for(let st=0;st<Ae.length;st++){const Ue=Ae[st];for(let it=0;it<Ue.length;it++)Dl($e,Ue[it],Me,J,!0,0===it)}if($e.length){let st=K.tags||null;if("LineString"===Ce&&me.lineMetrics){st={};for(const it in K.tags)st[it]=K.tags[it];st.mapbox_clip_start=Ae.start/Ae.size,st.mapbox_clip_end=Ae.end/Ae.size}const Ue={geometry:$e,type:"Polygon"===Ce||"MultiPolygon"===Ce?3:"LineString"===Ce||"MultiLineString"===Ce?2:1,tags:st};null!==K.id&&(Ue.id=K.id),Me.features.push(Ue)}}function Dl(Me,K,J,me,Ae,Ce){const $e=me*me;if(me>0&&K.size<(Ae?$e:me))return void(J.numPoints+=K.length/3);const st=[];for(let Ue=0;Ue<K.length;Ue+=3)(0===me||K[Ue+2]>$e)&&(J.numSimplified++,st.push(K[Ue],K[Ue+1])),J.numPoints++;Ae&&function(Ue,it){let Et=0;for(let Ct=0,yt=Ue.length,Nn=yt-2;Ct<yt;Nn=Ct,Ct+=2)Et+=(Ue[Ct]-Ue[Nn])*(Ue[Ct+1]+Ue[Nn+1]);if(Et>0===it)for(let Ct=0,yt=Ue.length;Ct<yt/2;Ct+=2){const Nn=Ue[Ct],Qn=Ue[Ct+1];Ue[Ct]=Ue[yt-2-Ct],Ue[Ct+1]=Ue[yt-1-Ct],Ue[yt-2-Ct]=Nn,Ue[yt-1-Ct]=Qn}}(st,Ce),Me.push(st)}const z_={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ec{constructor(K,J){const me=(J=this.options=function(Ce,$e){for(const st in $e)Ce[st]=$e[st];return Ce}(Object.create(z_),J)).debug;if(me&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ae=function(Ce,$e){const st=[];if("FeatureCollection"===Ce.type)for(let Ue=0;Ue<Ce.features.length;Ue++)ch(st,Ce.features[Ue],$e,Ue);else ch(st,"Feature"===Ce.type?Ce:{geometry:Ce},$e);return st}(K,J);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ae=function(Ce,$e){const st=$e.buffer/$e.extent;let Ue=Ce;const it=sr(Ce,1,-1-st,st,0,-1,2,$e),Et=sr(Ce,1,1-st,2+st,0,-1,2,$e);return(it||Et)&&(Ue=sr(Ce,1,-st,1+st,0,-1,2,$e)||[],it&&(Ue=Df(it,1).concat(Ue)),Et&&(Ue=Ue.concat(Df(Et,-1)))),Ue}(Ae,J),Ae.length&&this.splitTile(Ae,0,0,0),me&&(Ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,J,me,Ae,Ce,$e,st){const Ue=[K,J,me,Ae],it=this.options,Et=it.debug;for(;Ue.length;){Ae=Ue.pop(),me=Ue.pop(),J=Ue.pop(),K=Ue.pop();const Ct=1<<J,yt=Do(J,me,Ae);let Nn=this.tiles[yt];if(!Nn&&(Et>1&&console.time("creation"),Nn=this.tiles[yt]=Eu(K,J,me,Ae,it),this.tileCoords.push({z:J,x:me,y:Ae}),Et)){Et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,me,Ae,Nn.numFeatures,Nn.numPoints,Nn.numSimplified),console.timeEnd("creation"));const uo=`z${J}`;this.stats[uo]=(this.stats[uo]||0)+1,this.total++}if(Nn.source=K,null==Ce){if(J===it.indexMaxZoom||Nn.numPoints<=it.indexMaxPoints)continue}else{if(J===it.maxZoom||J===Ce)continue;if(null!=Ce){const uo=Ce-J;if(me!==$e>>uo||Ae!==st>>uo)continue}}if(Nn.source=null,0===K.length)continue;Et>1&&console.time("clipping");const Qn=.5*it.buffer/it.extent,$r=.5-Qn,gr=.5+Qn,zr=1+Qn;let yn=null,Qi=null,Yr=null,Ur=null,Kr=sr(K,Ct,me-Qn,me+gr,0,Nn.minX,Nn.maxX,it),zs=sr(K,Ct,me+$r,me+zr,0,Nn.minX,Nn.maxX,it);K=null,Kr&&(yn=sr(Kr,Ct,Ae-Qn,Ae+gr,1,Nn.minY,Nn.maxY,it),Qi=sr(Kr,Ct,Ae+$r,Ae+zr,1,Nn.minY,Nn.maxY,it),Kr=null),zs&&(Yr=sr(zs,Ct,Ae-Qn,Ae+gr,1,Nn.minY,Nn.maxY,it),Ur=sr(zs,Ct,Ae+$r,Ae+zr,1,Nn.minY,Nn.maxY,it),zs=null),Et>1&&console.timeEnd("clipping"),Ue.push(yn||[],J+1,2*me,2*Ae),Ue.push(Qi||[],J+1,2*me,2*Ae+1),Ue.push(Yr||[],J+1,2*me+1,2*Ae),Ue.push(Ur||[],J+1,2*me+1,2*Ae+1)}}getTile(K,J,me){K=+K,J=+J,me=+me;const Ae=this.options,{extent:Ce,debug:$e}=Ae;if(K<0||K>24)return null;const st=1<<K,Ue=Do(K,J=J+st&st-1,me);if(this.tiles[Ue])return tl(this.tiles[Ue],Ce);$e>1&&console.log("drilling down to z%d-%d-%d",K,J,me);let it,Et=K,Ct=J,yt=me;for(;!it&&Et>0;)Et--,Ct>>=1,yt>>=1,it=this.tiles[Do(Et,Ct,yt)];return it&&it.source?($e>1&&(console.log("found parent tile z%d-%d-%d",Et,Ct,yt),console.time("drilling down")),this.splitTile(it.source,Et,Ct,yt,K,J,me),$e>1&&console.timeEnd("drilling down"),this.tiles[Ue]?tl(this.tiles[Ue],Ce):null):null}}function Do(Me,K,J){return 32*((1<<Me)*J+K)+Me}function Ii(Me,K){const J=Me.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);const me=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!me)return K(null,null);const Ae=new Ai(me.features);let Ce=Rt(Ae);0===Ce.byteOffset&&Ce.byteLength===Ce.buffer.byteLength||(Ce=new Uint8Array(Ce)),K(null,{vectorTile:Ae,rawData:Ce.buffer})}class uh extends vi{constructor(K,J,me,Ae,Ce,$e){super(K,J,me,Ae,Ii,$e),Ce&&(this.loadGeoJSON=Ce),this._dynamicIndex=new ah}loadData(K,J){const me=K&&K.request,Ae=me&&me.collectResourceTiming;this.loadGeoJSON(K,(Ce,$e)=>{if(Ce||!$e)return J(Ce);if("object"!=typeof $e)return J(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));{try{if(K.filter){const Ue=f.z(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ue.result)throw new Error(Ue.value.map(it=>`${it.key}: ${it.message}`).join(", "));$e.features=$e.features.filter(it=>Ue.value.evaluate({zoom:0},it))}K.dynamic?("Feature"===$e.type&&($e={type:"FeatureCollection",features:[$e]}),K.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load($e.features,this.loaded),K.cluster&&($e.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=K.cluster?new mn(function({superclusterOptions:Ue,clusterProperties:it}){if(!it||!Ue)return Ue;const Et={},Ct={},yt={accumulated:null,zoom:0},Nn={properties:null},Qn=Object.keys(it);for(const $r of Qn){const[gr,zr]=it[$r],yn=f.z(zr),Qi=f.z("string"==typeof gr?[gr,["accumulated"],["get",$r]]:gr);Et[$r]=yn.value,Ct[$r]=Qi.value}return Ue.map=$r=>{Nn.properties=$r;const gr={};for(const zr of Qn)gr[zr]=Et[zr].evaluate(yt,Nn);return gr},Ue.reduce=($r,gr)=>{Nn.properties=gr;for(const zr of Qn)yt.accumulated=$r[zr],$r[zr]=Ct[zr].evaluate(yt,Nn)},Ue}(K)).load($e.features):K.dynamic?this._dynamicIndex:new ec(Ue=$e,K.geojsonVtOptions)}catch(Ue){return J(Ue)}const st={};if(Ae){const Ue=as(me);Ue&&(st.resourceTiming={},st.resourceTiming[K.source]=JSON.parse(JSON.stringify(Ue)))}J(null,st)}var Ue})}reloadTile(K,J){const me=this.loaded;return me&&me[K.uid]?K.partial?J(null,void 0):super.reloadTile(K,J):this.loadTile(K,J)}loadGeoJSON(K,J){if(K.request)f.h(K.request,J);else{if("string"!=typeof K.data)return J(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse(K.data))}catch{return J(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(K,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(K.clusterId))}catch(me){J(me)}}getClusterChildren(K,J){try{J(null,this._geoJSONIndex.getChildren(K.clusterId))}catch(me){J(me)}}getClusterLeaves(K,J){try{J(null,this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset))}catch(me){J(me)}}}class Vo{constructor(K,J){this.tileID=new f.aQ(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=K.projection,this.brightness=J}parse(K,J,me,Ae){this.status="parsing";const Ce=new f.aQ(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),$e={},st=J.familiesBySource[me.source],Ue=new f.dQ(Ce,me.promoteId);return Ue.bucketLayerIDs=[],Ue.is3DTile=!0,f.e6(K).then(it=>{if(!it)return Ae(new Error("Could not parse tile"));const Et=f.e7(it,1/f.b7(me.tileID.canonical)),Ct=it.json.extensionsUsed&&it.json.extensionsUsed.includes("MAPBOX_mesh_features")||it.json.asset.extras&&it.json.asset.extras.MAPBOX_mesh_features,yt=it.json.extensionsUsed&&it.json.extensionsUsed.includes("EXT_meshopt_compression"),Nn=new f.Y(this.zoom,{brightness:this.brightness});for(const Qn in st)for(const $r of st[Qn]){const gr=$r[0];Ue.bucketLayerIDs.push($r.map(yn=>yn.id)),gr.recalculate(Nn,[]);const zr=new f.e8(Et,Ce,Ct,yt,this.brightness,Ue);Ct||(zr.needsUpload=!0),$e[gr.fqid]=zr,zr.evaluate(gr)}this.status="done",Ae(null,{buckets:$e,featureIndex:Ue})}).catch(it=>Ae(new Error(it.message)))}}class Bs{constructor(K,J,me,Ae,Ce,$e){this.actor=K,this.layerIndex=J,this.brightness=$e,this.loading={},this.loaded={}}loadTile(K,J){const me=K.uid,Ae=this.loading[me]=new Vo(K,this.brightness);f.e5(K.request,(Ce,$e)=>{const st=!this.loading[me];return delete this.loading[me],st||Ce?(Ae.status="done",st||(this.loaded[me]=Ae),J(Ce)):$e&&0!==$e.byteLength?void Ae.parse($e,this.layerIndex,K,(Ue,it)=>{Ae.status="done",this.loaded=this.loaded||{},this.loaded[me]=Ae,Ue||!it?J(Ue):J(null,it)}):(Ae.status="done",this.loaded[me]=Ae,J())})}reloadTile(K,J){const me=this.loaded,Ae=K.uid;if(me&&me[Ae]){const Ce=me[Ae];Ce.projection=K.projection,Ce.brightness=K.brightness;const $e=(st,Ue)=>{Ce.reloadCallback&&(delete Ce.reloadCallback,this.loadTile(K,J)),J(st,Ue)};"parsing"===Ce.status?Ce.reloadCallback=$e:"done"===Ce.status&&this.loadTile(K,J)}}abortTile(K,J){const me=K.uid;this.loading[me]&&delete this.loading[me],J()}removeTile(K,J){const me=this.loaded,Ae=K.uid;me&&me[Ae]&&delete me[Ae],J()}}class ys{constructor(K){this.self=K,this.actor=new f.e9(K,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.aK({name:"mercator"}),this.workerSourceTypes={vector:vi,geojson:uh,"batched-model":Bs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(J,me)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=me},this.self.registerRTLTextPlugin=J=>{if(f.ea.isParsed())throw new Error("RTL text plugin already registered.");f.ea.applyArabicShaping=J.applyArabicShaping,f.ea.processBidirectionalText=J.processBidirectionalText,f.ea.processStyledBidirectionalText=J.processStyledBidirectionalText}}clearCaches(K,J,me){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],delete this.rasterArrayWorkerSource,me()}checkIfReady(K,J,me){me()}setReferrer(K,J){this.referrer=J}spriteLoaded(K,{scope:J,isLoaded:me}){if(this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),this.isSpriteLoaded[K][J]=me,this.workerSources[K]&&this.workerSources[K][J])for(const Ae in this.workerSources[K][J]){const Ce=this.workerSources[K][J][Ae];for(const $e in Ce){const st=Ce[$e];st instanceof vi&&(st.isSpriteLoaded=me,st.fire(new f.g("isSpriteLoaded")))}}}setImages(K,{scope:J,images:me},Ae){if(this.availableImages[K]||(this.availableImages[K]={}),this.availableImages[K][J]=me,this.workerSources[K]&&this.workerSources[K][J]){for(const Ce in this.workerSources[K][J]){const $e=this.workerSources[K][J][Ce];for(const st in $e)$e[st].availableImages=me}Ae()}else Ae()}setProjection(K,J){this.projections[K]=f.aK(J)}setBrightness(K,J,me){this.brightness=J,me()}setLayers(K,J,me){this.getLayerIndex(K,J.scope).replace(J.layers,J.options),me()}updateLayers(K,J,me){this.getLayerIndex(K,J.scope).update(J.layers,J.removedIds,J.options),me()}loadTile(K,J,me){J.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,J.type,J.source,J.scope).loadTile(J,me)}loadDEMTile(K,J,me){this.getDEMWorkerSource(K,J.source,J.scope).loadTile(J,me)}decodeRasterArray(K,J,me){this.getRasterArrayWorkerSource().decodeRasterArray(J,me)}reloadTile(K,J,me){J.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,J.type,J.source,J.scope).reloadTile(J,me)}abortTile(K,J,me){this.getWorkerSource(K,J.type,J.source,J.scope).abortTile(J,me)}removeTile(K,J,me){this.getWorkerSource(K,J.type,J.source,J.scope).removeTile(J,me)}removeSource(K,J,me){if(!(this.workerSources[K]&&this.workerSources[K][J.scope]&&this.workerSources[K][J.scope][J.type]&&this.workerSources[K][J.scope][J.type][J.source]))return;const Ae=this.workerSources[K][J.scope][J.type][J.source];delete this.workerSources[K][J.scope][J.type][J.source],void 0!==Ae.removeSource?Ae.removeSource(J,me):me()}loadWorkerSource(K,J,me){try{this.self.importScripts(J.url),me()}catch(Ae){me(Ae.toString())}}syncRTLPluginState(K,J,me){try{f.ea.setState(J);const Ae=f.ea.getPluginURL();if(f.ea.isLoaded()&&!f.ea.isParsed()&&null!=Ae){this.self.importScripts(Ae);const Ce=f.ea.isParsed();me(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ae}`),Ce)}}catch(Ae){me(Ae.toString())}}setDracoUrl(K,J){this.dracoUrl=J}getAvailableImages(K,J){this.availableImages[K]||(this.availableImages[K]={});let me=this.availableImages[K][J];return me||(me=[]),me}getLayerIndex(K,J){this.layerIndexes[K]||(this.layerIndexes[K]={});let me=this.layerIndexes[K][J];return me||(me=this.layerIndexes[K][J]=new jr,me.scope=J),me}getWorkerSource(K,J,me,Ae){return this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][Ae]||(this.workerSources[K][Ae]={}),this.workerSources[K][Ae][J]||(this.workerSources[K][Ae][J]={}),this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),this.workerSources[K][Ae][J][me]||(this.workerSources[K][Ae][J][me]=new this.workerSourceTypes[J]({send:(Ce,$e,st,Ue,it,Et)=>{this.actor.send(Ce,$e,st,K,it,Et)},scheduler:this.actor.scheduler},this.getLayerIndex(K,Ae),this.getAvailableImages(K,Ae),this.isSpriteLoaded[K][Ae],void 0,this.brightness)),this.workerSources[K][Ae][J][me]}getDEMWorkerSource(K,J,me){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][me]||(this.demWorkerSources[K][me]={}),this.demWorkerSources[K][me][J]||(this.demWorkerSources[K][me][J]=new Ws),this.demWorkerSources[K][me][J]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new bc),this.rasterArrayWorkerSource}enforceCacheSizeLimit(K,J){f.eb(J)}getWorkerPerformanceMetrics(K,J,me){me(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ys(self)),ys}),ts(0,function(f){var as=_r;function _r(y){return c=y,!(typeof window>"u"||typeof document>"u"||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,C=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(C);try{w=new Worker(M),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(M),v}()||!function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===v.width}()||(void 0===qn[p=c&&c.failIfMajorPerformanceCaveat]&&(qn[p]=function(v){var w,M,I,P,C=(M=v,I=document.createElement("canvas"),(P=Object.create(_r.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,I.getContext("webgl2",P));if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),!0===C.getShaderParameter(w,C.COMPILE_STATUS))}(p)),!qn[p]||document.documentMode));var c,p}var qn={};function jr(y,c,p){const v=document.createElement(y);return null!=c&&(v.className=c),p&&p.appendChild(v),v}function _s(y,c,p){const v=document.createElementNS("http://www.w3.org/2000/svg",y);for(const w of Object.keys(c))v.setAttributeNS(null,w,String(c[w]));return p&&p.appendChild(v),v}_r.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Pr=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ei=Pr&&void 0!==Pr.userSelect?"userSelect":"WebkitUserSelect";let Is;function vi(){Pr&&ei&&(Is=Pr[ei],Pr[ei]="none")}function Ws(){Pr&&ei&&(Pr[ei]=Is)}function bc(y){y.preventDefault(),y.stopPropagation(),window.removeEventListener("click",bc,!0)}function Uo(){window.addEventListener("click",bc,!0),window.setTimeout(()=>{window.removeEventListener("click",bc,!0)},0)}function xi(y,c){const p=y.getBoundingClientRect();return sa(y,p,c)}function Ai(y,c){const p=y.getBoundingClientRect(),v=[];for(let w=0;w<c.length;w++)v.push(sa(y,p,c[w]));return v}function Ks(y){return void 0!==window.InstallTrigger&&2===y.button&&y.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function sa(y,c,p){const v=y.offsetWidth===c.width?1:y.offsetWidth/c.width;return new f.P((p.clientX-c.left)*v,(p.clientY-c.top)*v)}class ah{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(c,p){this._updatedSourceCaches[c]=p,this.setDirty()}discardSourceCacheUpdate(c){delete this._updatedSourceCaches[c]}updateLayer(c){const p=c.scope;this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._updatedLayers[p].add(c.id),this.setDirty()}removeLayer(c){const p=c.scope;this._removedLayers[p]=this._removedLayers[p]||{},this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._removedLayers[p][c.id]=c,this._updatedLayers[p].delete(c.id),this._updatedPaintProps.delete(c.fqid),this.setDirty()}getRemovedLayer(c){return this._removedLayers[c.scope]?this._removedLayers[c.scope][c.id]:null}discardLayerRemoval(c){this._removedLayers[c.scope]&&delete this._removedLayers[c.scope][c.id]}getLayerUpdatesByScope(){const c={};for(const p in this._updatedLayers)c[p]=c[p]||{},c[p].updatedIds=Array.from(this._updatedLayers[p].values());for(const p in this._removedLayers)c[p]=c[p]||{},c[p].removedIds=Object.keys(this._removedLayers[p]);return c}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(c){this._updatedPaintProps.add(c.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(c){this._updatedImages.add(c),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const vu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ci{constructor(c,p,v,w,C,M){this.length=p.length,this.attributes=v,this.itemSize=p.bytesPerElement,this.dynamicDraw=w,this.instanceCount=M,this.context=c;const I=c.gl;this.buffer=I.createBuffer(),c.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||C||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,p){for(let v=0;v<this.attributes.length;v++){const w=p.attributes[this.attributes[v].name];void 0!==w&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,p,v){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],M=p.attributes[C.name];void 0!==M&&c.vertexAttribPointer(M,C.components,c[vu[C.type]],!1,this.itemSize,C.offset+this.itemSize*(v||0))}}setVertexAttribDivisor(c,p,v){for(let w=0;w<this.attributes.length;w++){const C=p.attributes[this.attributes[w].name];void 0!==C&&this.instanceCount&&this.instanceCount>0&&c.vertexAttribDivisor(C,v)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xr{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ya extends Xr{getDefault(){return f.C.transparent}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class xu extends Xr{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Ef extends Xr{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class bu extends Xr{getDefault(){return[!0,!0,!0,!0]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class ui extends Xr{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class wc extends Xr{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Ka extends Xr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class am extends Xr{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class lh extends Xr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}}class Wc extends Xr{getDefault(){return[0,1]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class ii extends Xr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}}class Jl extends Xr{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class co extends Xr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}}class Rg extends Xr{getDefault(){const c=this.gl;return[c.ONE,c.ZERO,c.ONE,c.ZERO]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.blendFuncSeparate(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Pg extends Xr{getDefault(){return f.C.transparent}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class _d extends Xr{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(c,c),this.current=c,this.dirty=!1)}}class nr extends Xr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}}class yd extends Xr{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Li extends Xr{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let wt=class extends Xr{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class Rt extends Xr{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class an extends Xr{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class pn extends Xr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class cr extends Xr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class hn extends Xr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class ns extends Xr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Bi extends Xr{getDefault(){return null}set(c){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class mn extends Xr{getDefault(){return null}set(c){this.gl&&(c!==this.current||this.dirty)&&(this.gl.bindVertexArray(c),this.current=c,this.dirty=!1)}}class dn extends Xr{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Ja extends Xr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Js extends Xr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Ma extends Xr{constructor(c,p){super(c),this.context=c,this.parent=p}getDefault(){return null}}class Qa extends Ma{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class qs extends Ma{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class qc extends Ma{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,this.attachment(),p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class ji extends qs{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class el{constructor(c,p,v,w,C){this.context=c,this.width=p,this.height=v;const M=this.framebuffer=c.gl.createFramebuffer();w&&(this.colorAttachment=new Qa(c,M)),C&&(this.depthAttachmentType=C,this.depthAttachment="renderbuffer"===C?new qs(c,M):new qc(c,M))}destroy(){const c=this.context.gl;if(this.colorAttachment){const p=this.colorAttachment.get();p&&c.deleteTexture(p)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const p=this.depthAttachment.get();p&&c.deleteRenderbuffer(p)}else{const p=this.depthAttachment.get();p&&c.deleteTexture(p)}c.deleteFramebuffer(this.framebuffer)}}class ch{constructor(c,p){this.gl=c,this.clearColor=new Ya(this),this.clearDepth=new xu(this),this.clearStencil=new Ef(this),this.colorMask=new bu(this),this.depthMask=new ui(this),this.stencilMask=new wc(this),this.stencilFunc=new Ka(this),this.stencilOp=new am(this),this.stencilTest=new lh(this),this.depthRange=new Wc(this),this.depthTest=new ii(this),this.depthFunc=new Jl(this),this.blend=new co(this),this.blendFunc=new Rg(this),this.blendColor=new Pg(this),this.blendEquation=new _d(this),this.cullFace=new nr(this),this.cullFaceSide=new yd(this),this.frontFace=new Li(this),this.program=new wt(this),this.activeTexture=new Rt(this),this.viewport=new an(this),this.bindFramebuffer=new pn(this),this.bindRenderbuffer=new cr(this),this.bindTexture=new hn(this),this.bindVertexBuffer=new ns(this),this.bindElementBuffer=new Bi(this),this.bindVertexArrayOES=new mn(this),this.pixelStoreUnpack=new dn(this),this.pixelStoreUnpackPremultiplyAlpha=new Ja(this),this.pixelStoreUnpackFlipY=new Js(this),this.options=p?{...p}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=c.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),this.maxPointSize=c.getParameter(c.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,p,v){return new f.I(this,c,p,v)}createVertexBuffer(c,p,v,w,C){return new ci(this,c,p,v,w,C)}createRenderbuffer(c,p,v){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,c,p,v),this.bindRenderbuffer.set(null),C}createFramebuffer(c,p,v,w){return new el(this,c,p,v,w)}clear({color:c,depth:p,stencil:v,colorMask:w}){const C=this.gl;let M=0;c&&(M|=C.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set(w||[!0,!0,!0,!0])),void 0!==p&&(M|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),void 0!==v&&(M|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),C.clear(M)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){f.d(c.blendFunction,f.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor),c.blendEquation?this.blendEquation.set(c.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(c.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class vd{constructor(c,p,v,w){const C={width:v[0],height:v[1],data:null},M=c.gl;this.targetColorTexture=new f.T(c,C,M.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new f.T(c,C,M.RGBA,{useMipmap:!1}),this.context=c,this.updateParticleTexture(p,w),this.lastInvalidatedAt=0}updateParticleTexture(c,p){if(this.particleTextureDimension===p.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const v=this.context.gl,w=p.width*p.height;this.particleTexture0=new f.T(this.context,p,v.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new f.T(this.context,p,v.RGBA,{premultiply:!1,useMipmap:!1});const C=new f.S;C.reserve(w);for(let M=0;M<w;M++)C.emplaceBack(M);this.particleIndexBuffer=this.context.createVertexBuffer(C,f.p.members,!0),this.particleSegment=f.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=p.width}update(c){return!(this.lastInvalidatedAt<c&&(this.lastInvalidatedAt=f.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Zc extends f.E{constructor(c){super(),this.requestManager=c,this.models={"":{}},this.numModelsLoading={}}loadModel(c,p){return f.l(this.requestManager.transformRequest(p,f.R.Model).url).then(v=>{if(!v)return;const w=f.c(v),C=new f.M(c,void 0,void 0,w);return C.computeBoundsAndApplyParent(),C}).catch(v=>{if(v&&404===v.status)return null;this.fire(new f.f(new Error(`Could not load model ${c} from ${p}: ${v.message}`)))})}load(c,p){this.models[p]||(this.models[p]={});const v=Object.keys(c);this.numModelsLoading[p]=(this.numModelsLoading[p]||0)+v.length;const w=[];for(const C of v)w.push(this.loadModel(C,c[C]));Promise.allSettled(w).then(C=>{for(let M=0;M<C.length;M++){const{status:I,value:P}=C[M];"fulfilled"===I&&P&&(this.models[p][v[M]]={model:P,numReferences:1})}this.numModelsLoading[p]-=v.length,this.fire(new f.g("data",{dataType:"style"}))}).catch(C=>{this.fire(new f.f(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const c in this.numModelsLoading)if(this.numModelsLoading[c]>0)return!1;return!0}hasModel(c,p){return!!this.getModel(c,p)}getModel(c,p){return this.models[p]||(this.models[p]={}),this.models[p][c]?this.models[p][c].model:void 0}addModel(c,p,v){this.models[v]||(this.models[v]={}),this.hasModel(c,v)&&this.models[v][c].numReferences++,this.load({[c]:this.requestManager.normalizeModelURL(p)},v)}addModels(c,p){this.models[p]||(this.models[p]={});const v={};for(const w in c)this.models[p][w]={},v[w]=this.requestManager.normalizeModelURL(c[w]);this.load(v,p)}addModelsFromBucket(c,p){this.models[p]||(this.models[p]={});const v={};for(const w of c)this.hasModel(w,p)?this.models[p][w].numReferences++:v[w]=this.requestManager.normalizeModelURL(w);this.load(v,p)}removeModel(c,p){if(this.models[p]&&this.models[p][c]&&(this.models[p][c].numReferences--,0===this.models[p][c].numReferences)){const v=this.models[p][c].model;delete this.models[p][c],v.destroy()}}listModels(c){return this.models[c]||(this.models[c]={}),Object.keys(this.models[c])}upload(c,p){this.models[p]||(this.models[p]={});for(const v in this.models[p])this.models[p][v].model&&this.models[p][v].model.upload(c.context)}}function Ql(y){const{userImage:c}=y;return!!(c&&c.render&&c.render())&&(y.data.replace(new Uint8Array(c.data.buffer)),!0)}class Aa extends f.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(c){this.images[c]={},this.loaded[c]=!1,this.updatedImages[c]={},this.patterns[c]={},this.callbackDispatchedThisFrame[c]={},this.atlasImage[c]=new f.j({width:1,height:1})}isLoaded(){for(const c in this.loaded)if(!this.loaded[c])return!1;return!0}setLoaded(c,p){if(this.loaded[p]!==c&&(this.loaded[p]=c,c)){for(const{ids:v,callback:w}of this.requestors)this._notify(v,p,w);this.requestors=[]}}hasImage(c,p){return!!this.getImage(c,p)}getImage(c,p){return this.images[p][c]}addImage(c,p,v){this._validate(c,v)&&(this.images[p][c]=v)}_validate(c,p){let v=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new f.f(new Error(`Image "${c}" has invalid "stretchX" value`))),v=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new f.f(new Error(`Image "${c}" has invalid "stretchY" value`))),v=!1),this._validateContent(p.content,p)||(this.fire(new f.f(new Error(`Image "${c}" has invalid "content" value`))),v=!1),v}_validateStretch(c,p){if(!c)return!0;let v=0;for(const w of c){if(w[0]<v||w[1]<w[0]||p<w[1])return!1;v=w[1]}return!0}_validateContent(c,p){return!(c&&(4!==c.length||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,p,v){v.version=this.images[p][c].version+1,this.images[p][c]=v,this.updatedImages[p][c]=!0}removeImage(c,p){const v=this.images[p][c];delete this.images[p][c],delete this.patterns[p][c],v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(c){return Object.keys(this.images[c])}getImages(c,p,v){let w=!0;const C=!!this.loaded[p];if(!C)for(const M of c)this.images[p][M]||(w=!1);C||w?this._notify(c,p,v):this.requestors.push({ids:c,scope:p,callback:v})}getUpdatedImages(c){return this.updatedImages[c]}_notify(c,p,v){const w={};for(const C of c){this.images[p][C]||this.fire(new f.g("styleimagemissing",{id:C}));const M=this.images[p][C];M?w[C]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!(!M.userImage||!M.userImage.render)}:f.w(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}v(null,w)}getPixelSize(c){const{width:p,height:v}=this.atlasImage[c];return{width:p,height:v}}getPattern(c,p,v){const w=this.patterns[p][c],C=this.getImage(c,p);if(!C)return null;if(w&&w.position.version===C.version)return w.position;if(w)w.position.version=C.version;else{const M={w:C.data.width+2,h:C.data.height+2,x:0,y:0},I=new f.m(M,C);this.patterns[p][c]={bin:M,position:I}}return this._updatePatternAtlas(p,v),this.patterns[p][c].position}bind(c,p){const v=c.gl;let w=this.atlasTexture[p];w?this.dirty&&(w.update(this.atlasImage[p]),this.dirty=!1):(w=new f.T(c,this.atlasImage[p],v.RGBA),this.atlasTexture[p]=w),w.bind(v.LINEAR,v.CLAMP_TO_EDGE)}_updatePatternAtlas(c,p){const v=[];for(const I in this.patterns[c])v.push(this.patterns[c][I].bin);const{w,h:C}=f.k(v),M=this.atlasImage[c];M.resize({width:w||1,height:C||1});for(const I in this.patterns[c]){const{bin:P}=this.patterns[c][I],F=P.x+1,z=P.y+1,j=this.images[c][I].data,q=j.width,Z=j.height;f.j.copy(j,M,{x:0,y:0},{x:F,y:z},{width:q,height:Z},p),f.j.copy(j,M,{x:0,y:Z-1},{x:F,y:z-1},{width:q,height:1},p),f.j.copy(j,M,{x:0,y:0},{x:F,y:z+Z},{width:q,height:1},p),f.j.copy(j,M,{x:q-1,y:0},{x:F-1,y:z},{width:1,height:Z},p),f.j.copy(j,M,{x:0,y:0},{x:F+q,y:z},{width:1,height:Z},p)}this.dirty=!0}beginFrame(){for(const c in this.images)this.callbackDispatchedThisFrame[c]={}}dispatchRenderCallbacks(c,p){for(const v of c){if(this.callbackDispatchedThisFrame[p][v])continue;this.callbackDispatchedThisFrame[p][v]=!0;const w=this.images[p][v];Ql(w)&&this.updateImage(v,p,w)}}}function Ia(y){const c=y.key,p=y.value,v=y.valueSpec||{},w=y.objectElementValidators||{},C=y.style,M=y.styleSpec;let I=[];const P=f.o(p);if("object"!==P)return[new f.V(c,p,`object expected, ${P} found`)];for(const F in p){const z=F.split(".")[0];let j;w[z]?j=w[z]:v[z]?j=Bs:w["*"]?j=w["*"]:v["*"]&&(j=Bs),j?I=I.concat(j({key:(c&&`${c}.`)+F,value:p[F],valueSpec:v[z]||v["*"],style:C,styleSpec:M,object:p,objectKey:F},p)):I.push(new f.n(c,p[F],`unknown property "${F}"`))}for(const F in v)w[F]||v[F].required&&void 0===v[F].default&&void 0===p[F]&&I.push(new f.V(c,p,`missing required property "${F}"`));return I}function sr(y){const c=y.value,p=y.valueSpec,v=y.style,w=y.styleSpec,C=y.key,M=y.arrayElementValidator||Bs;if("array"!==f.o(c))return[new f.V(C,c,`array expected, ${f.o(c)} found`)];if(p.length&&c.length!==p.length)return[new f.V(C,c,`array length ${p.length} expected, length ${c.length} found`)];if(p["min-length"]&&c.length<p["min-length"])return[new f.V(C,c,`array length at least ${p["min-length"]} expected, length ${c.length} found`)];let I={type:p.value,values:p.values,minimum:p.minimum,maximum:p.maximum,function:void 0};w.$version<7&&(I.function=p.function),"object"===f.o(p.value)&&(I=p.value);let P=[];for(let F=0;F<c.length;F++)P=P.concat(M({array:c,arrayIndex:F,value:c[F],valueSpec:I,style:v,styleSpec:w,key:`${C}[${F}]`},!0));return P}function Cf(y){const c=y.key,p=y.value,v=y.valueSpec;let w=f.o(p);if("number"===w&&p!=p&&(w="NaN"),"number"!==w)return[new f.V(c,p,`number expected, ${w} found`)];if("minimum"in v){let C=v.minimum;if("array"===f.o(v.minimum)&&(C=v.minimum[y.arrayIndex]),p<C)return[new f.V(c,p,`${p} is less than the minimum value ${C}`)]}if("maximum"in v){let C=v.maximum;if("array"===f.o(v.maximum)&&(C=v.maximum[y.arrayIndex]),p>C)return[new f.V(c,p,`${p} is greater than the maximum value ${C}`)]}return[]}function So(y){const c=y.valueSpec,p=f.u(y.value.type);let v,w,C,M={};const I="categorical"!==p&&void 0===y.value.property,P=!I,F="array"===f.o(y.value.stops)&&"array"===f.o(y.value.stops[0])&&"object"===f.o(y.value.stops[0][0]),z=Ia({key:y.key,value:y.value,valueSpec:y.styleSpec.function,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{stops:function(Z){if("identity"===p)return[new f.V(Z.key,Z.value,'identity function may not have a "stops" property')];let ne=[];const re=Z.value;return ne=ne.concat(sr({key:Z.key,value:re,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:j})),"array"===f.o(re)&&0===re.length&&ne.push(new f.V(Z.key,re,"array must have at least one stop")),ne},default:function(Z){return Bs({key:Z.key,value:Z.value,valueSpec:c,style:Z.style,styleSpec:Z.styleSpec})}}});return"identity"===p&&I&&z.push(new f.V(y.key,y.value,'missing required property "property"')),"identity"===p||y.value.stops||z.push(new f.V(y.key,y.value,'missing required property "stops"')),"exponential"===p&&y.valueSpec.expression&&!f.s(y.valueSpec)&&z.push(new f.V(y.key,y.value,"exponential functions not supported")),y.styleSpec.$version>=8&&(P&&!f.r(y.valueSpec)?z.push(new f.V(y.key,y.value,"property functions not supported")):I&&!f.t(y.valueSpec)&&z.push(new f.V(y.key,y.value,"zoom functions not supported"))),"categorical"!==p&&!F||void 0!==y.value.property||z.push(new f.V(y.key,y.value,'"property" property is required')),z;function j(Z){let ne=[];const re=Z.value,ie=Z.key;if("array"!==f.o(re))return[new f.V(ie,re,`array expected, ${f.o(re)} found`)];if(2!==re.length)return[new f.V(ie,re,`array length 2 expected, length ${re.length} found`)];if(F){if("object"!==f.o(re[0]))return[new f.V(ie,re,`object expected, ${f.o(re[0])} found`)];if(void 0===re[0].zoom)return[new f.V(ie,re,"object stop key must have zoom")];if(void 0===re[0].value)return[new f.V(ie,re,"object stop key must have value")];const Q=f.u(re[0].zoom);if("number"!=typeof Q)return[new f.V(ie,re[0].zoom,"stop zoom values must be numbers")];if(C&&C>Q)return[new f.V(ie,re[0].zoom,"stop zoom values must appear in ascending order")];Q!==C&&(C=Q,w=void 0,M={}),ne=ne.concat(Ia({key:`${ie}[0]`,value:re[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Cf,value:q}}))}else ne=ne.concat(q({key:`${ie}[0]`,value:re[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},re));return f.v(f.x(re[1]))?ne.concat([new f.V(`${ie}[1]`,re[1],"expressions are not allowed in function stops.")]):ne.concat(Bs({key:`${ie}[1]`,value:re[1],valueSpec:c,style:Z.style,styleSpec:Z.styleSpec}))}function q(Z,ne){const re=f.o(Z.value),ie=f.u(Z.value),Q=null!==Z.value?Z.value:ne;if(v){if(re!==v)return[new f.V(Z.key,Q,`${re} stop domain type must match previous stop domain type ${v}`)]}else v=re;if("number"!==re&&"string"!==re&&"boolean"!==re&&"number"!=typeof ie&&"string"!=typeof ie&&"boolean"!=typeof ie)return[new f.V(Z.key,Q,"stop domain value must be a number, string, or boolean")];if("number"!==re&&"categorical"!==p){let se=`number expected, ${re} found`;return f.r(c)&&void 0===p&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new f.V(Z.key,Q,se)]}return"categorical"!==p||"number"!==re||"number"==typeof ie&&isFinite(ie)&&Math.floor(ie)===ie?"categorical"!==p&&"number"===re&&"number"==typeof ie&&"number"==typeof w&&void 0!==w&&ie<w?[new f.V(Z.key,Q,"stop domain values must appear in ascending order")]:(w=ie,"categorical"===p&&ie in M?[new f.V(Z.key,Q,"stop domain values must be unique")]:(M[ie]=!0,[])):[new f.V(Z.key,Q,`integer expected, found ${String(ie)}`)]}}function Tc(y){const c=("property"===y.expressionContext?f.y:f.z)(f.x(y.value),y.valueSpec);if("error"===c.result)return c.value.map(v=>new f.V(`${y.key}${v.key}`,y.value,v.message));const p=c.value.expression||c.value._styleExpression.expression;if("property"===y.expressionContext&&"text-font"===y.propertyKey&&!p.outputDefined())return[new f.V(y.key,y.value,`Invalid data expression for "${y.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===y.expressionContext&&"layout"===y.propertyType&&!f.A(p))return[new f.V(y.key,y.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===y.expressionContext)return wu(p,y);if(y.expressionContext&&0===y.expressionContext.indexOf("cluster")){if(!f.B(p,["zoom","feature-state"]))return[new f.V(y.key,y.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===y.expressionContext&&!f.D(p))return[new f.V(y.key,y.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wu(y,c){const p=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(c.valueSpec&&c.valueSpec.expression)for(const w of c.valueSpec.expression.parameters)p.delete(w);if(0===p.size)return[];const v=[];return y instanceof f.F&&p.has(y.name)?[new f.V(c.key,c.value,`["${y.name}"] expression is not supported in a filter for a ${c.object.type} layer with id: ${c.object.id}`)]:(y.eachChild(w=>{v.push(...wu(w,c))}),v)}function ka(y){const c=y.key,p=y.value,v=y.valueSpec,w=[];return Array.isArray(v.values)?-1===v.values.indexOf(f.u(p))&&w.push(new f.V(c,p,`expected one of [${v.values.join(", ")}], ${JSON.stringify(p)} found`)):-1===Object.keys(v.values).indexOf(f.u(p))&&w.push(new f.V(c,p,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(p)} found`)),w}function Sf(y){return f.H(f.x(y.value))?Tc(f.q({},y,{expressionContext:"filter",valueSpec:y.styleSpec[`filter_${y.layerType||"fill"}`]})):xd(y)}function xd(y){const c=y.value,p=y.key;if("array"!==f.o(c))return[new f.V(p,c,`array expected, ${f.o(c)} found`)];const v=y.styleSpec;let w,C=[];if(c.length<1)return[new f.V(p,c,"filter array must have at least 1 element")];switch(C=C.concat(ka({key:`${p}[0]`,value:c[0],valueSpec:v.filter_operator,style:y.style,styleSpec:y.styleSpec})),f.u(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&"$type"===f.u(c[1])&&C.push(new f.V(p,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":3!==c.length&&C.push(new f.V(p,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(w=f.o(c[1]),"string"!==w&&C.push(new f.V(`${p}[1]`,c[1],`string expected, ${w} found`)));for(let M=2;M<c.length;M++)w=f.o(c[M]),"$type"===f.u(c[1])?C=C.concat(ka({key:`${p}[${M}]`,value:c[M],valueSpec:v.geometry_type,style:y.style,styleSpec:y.styleSpec})):"string"!==w&&"number"!==w&&"boolean"!==w&&C.push(new f.V(`${p}[${M}]`,c[M],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let M=1;M<c.length;M++)C=C.concat(xd({key:`${p}[${M}]`,value:c[M],style:y.style,styleSpec:y.styleSpec}));break;case"has":case"!has":w=f.o(c[1]),2!==c.length?C.push(new f.V(p,c,`filter array for "${c[0]}" operator must have 2 elements`)):"string"!==w&&C.push(new f.V(`${p}[1]`,c[1],`string expected, ${w} found`))}return C}function Df(y,c){const p=y.key,v=y.style,w=y.layer,C=y.styleSpec,M=y.value,I=y.objectKey,P=C[`${c}_${y.layerType}`];if(!P)return[];const F=I.match(/^(.*)-transition$/);if("paint"===c&&F&&P[F[1]]&&P[F[1]].transition)return Bs({key:p,value:M,valueSpec:C.transition,style:v,styleSpec:C});const z=y.valueSpec||P[I];if(!z)return[new f.n(p,M,`unknown property "${I}"`)];let j;if("string"===f.o(M)&&f.r(z)&&!z.tokens&&(j=/^{([^}]+)}$/.exec(M))){const Z=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new f.V(p,M,`"${I}" does not support interpolation syntax\nUse an identity property function instead: ${Z}.`)]}const q=[];if("symbol"===y.layerType)"text-field"!==I||!v||v.glyphs||v.imports||q.push(new f.V(p,M,'use of "text-field" requires a style "glyphs" property')),"text-font"===I&&f.J(f.x(M))&&"identity"===f.u(M.type)&&q.push(new f.V(p,M,'"text-font" does not support identity functions'));else if("model"===y.layerType&&"paint"===c&&w&&w.layout&&w.layout.hasOwnProperty("model-id")&&f.r(z)&&(f.K(z)||f.t(z))){const Z=f.y(f.x(M),z),ne=Z.value.expression||Z.value._styleExpression.expression;ne&&!f.B(ne,["measure-light"])&&("model-emissive-strength"===I&&f.D(ne)&&f.A(ne)||q.push(new f.V(p,M,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Bs({key:y.key,value:M,valueSpec:z,style:v,styleSpec:C,expressionContext:"property",propertyType:c,propertyKey:I}))}function Tu(y){return Df(y,"paint")}function tl(y){return Df(y,"layout")}function Mf(y){let c=[];const p=y.value,v=y.key,w=y.style,C=y.styleSpec;p.type||p.ref||c.push(new f.V(v,p,'either "type" or "ref" is required'));let M=f.u(p.type);const I=f.u(p.ref);if(p.id){const P=f.u(p.id);for(let F=0;F<y.arrayIndex;F++){const z=w.layers[F];f.u(z.id)===P&&c.push(new f.V(v,p.id,`duplicate layer id "${p.id}", previously used at line ${z.id.__line__}`))}}if("ref"in p){let P;["type","source","source-layer","filter","layout"].forEach(F=>{F in p&&c.push(new f.V(v,p[F],`"${F}" is prohibited for ref layers`))}),w.layers.forEach(F=>{f.u(F.id)===I&&(P=F)}),P?P.ref?c.push(new f.V(v,p.ref,"ref cannot reference another ref layer")):M=f.u(P.type):"string"==typeof I&&c.push(new f.V(v,p.ref,`ref layer "${I}" not found`))}else if("background"!==M&&"sky"!==M&&"slot"!==M)if(p.source){const P=w.sources&&w.sources[p.source],F=P&&f.u(P.type);P?"vector"===F&&"raster"===M?c.push(new f.V(v,p.source,`layer "${p.id}" requires a raster source`)):"raster"===F&&"raster"!==M?c.push(new f.V(v,p.source,`layer "${p.id}" requires a vector source`)):"vector"!==F||p["source-layer"]?"raster-dem"===F&&"hillshade"!==M?c.push(new f.V(v,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==F||["raster","raster-particle"].includes(M)?"line"!==M||!p.paint||!p.paint["line-gradient"]&&!p.paint["line-trim-offset"]||"geojson"===F&&P.lineMetrics?"raster-particle"===M&&"raster-array"!==F&&c.push(new f.V(v,p.source,`layer "${p.id}" requires a 'raster-array' source.`)):c.push(new f.V(v,p,`layer "${p.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new f.V(v,p.source,"raster-array source can only be used with layer type 'raster'.")):c.push(new f.V(v,p,`layer "${p.id}" must specify a "source-layer"`)):c.push(new f.V(v,p.source,`source "${p.source}" not found`))}else c.push(new f.V(v,p,'missing required property "source"'));return c=c.concat(Ia({key:v,value:p,valueSpec:C.layer,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bs({key:`${v}.type`,value:p.type,valueSpec:C.layer.type,style:y.style,styleSpec:y.styleSpec,object:p,objectKey:"type"}),filter:P=>Sf(f.q({layerType:M},P)),layout:P=>Ia({layer:p,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":F=>tl(f.q({layerType:M},F))}}),paint:P=>Ia({layer:p,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":F=>Tu(f.q({layerType:M,layer:p},F))}})}})),c}function Eu(y){const c=y.value,p=y.key,v=f.o(c);return"string"!==v?[new f.V(p,c,`string expected, ${v} found`)]:[]}const $i={promoteId:function({key:y,value:c}){if("string"===f.o(c))return Eu({key:y,value:c});{const p=[];for(const v in c)p.push(...Eu({key:`${y}.${v}`,value:c[v]}));return p}}};function Dl(y){const c=y.value,p=y.key,v=y.styleSpec,w=y.style;if(!c.type)return[new f.V(p,c,'"type" is required')];const C=f.u(c.type);let M=[];switch(["vector","raster","raster-dem","raster-array"].includes(C)&&(c.url||c.tiles||M.push(new f.n(p,c,'Either "url" or "tiles" is required.'))),C){case"vector":case"raster":case"raster-dem":case"raster-array":return M=M.concat(Ia({key:p,value:c,valueSpec:v[`source_${C.replace("-","_")}`],style:y.style,styleSpec:v,objectElementValidators:$i})),M;case"geojson":if(M=Ia({key:p,value:c,valueSpec:v.source_geojson,style:w,styleSpec:v,objectElementValidators:$i}),c.cluster)for(const I in c.clusterProperties){const[P,F]=c.clusterProperties[I],z="string"==typeof P?[P,["accumulated"],["get",I]]:P;M.push(...Tc({key:`${p}.${I}.map`,value:F,expressionContext:"cluster-map"})),M.push(...Tc({key:`${p}.${I}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return M;case"video":return Ia({key:p,value:c,valueSpec:v.source_video,style:w,styleSpec:v});case"image":return Ia({key:p,value:c,valueSpec:v.source_image,style:w,styleSpec:v});case"canvas":return[new f.V(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ka({key:`${p}.type`,value:c.type,valueSpec:{values:z_(v)},style:w,styleSpec:v})}}function z_(y){return y.source.reduce((c,p)=>{const v=y[p];return"enum"===v.type.type&&(c=c.concat(Object.keys(v.type.values))),c},[])}function ec(y){const c=y.value,p=y.styleSpec,v=p.light,w=y.style;let C=[];const M=f.o(c);if(void 0===c)return C;if("object"!==M)return C=C.concat([new f.V("light",c,`object expected, ${M} found`)]),C;for(const I in c){const P=I.match(/^(.*)-transition$/);C=C.concat(P&&v[P[1]]&&v[P[1]].transition?Bs({key:I,value:c[I],valueSpec:p.transition,style:w,styleSpec:p}):v[I]?Bs({key:I,value:c[I],valueSpec:v[I],style:w,styleSpec:p}):[new f.V(I,c[I],`unknown property "${I}"`)])}return C}function Do(y){const c=y.value;let p=[];if(!c)return p;const v=f.o(c);if("object"!==v)return p=p.concat([new f.V("light-3d",c,`object expected, ${v} found`)]),p;const w=y.styleSpec,C=w["light-3d"],M=y.key,I=y.style,P=y.style.lights;for(const j of["type","id"])if(!(j in c))return p=p.concat([new f.V("light-3d",c,`missing property ${j} on light`)]),p;if(c.type&&P)for(let j=0;j<y.arrayIndex;j++){const q=f.u(c.type),Z=P[j];f.u(Z.type)===q&&p.push(new f.V(M,c.id,`duplicate light type "${c.type}", previously defined at line ${Z.id.__line__}`))}const F=`properties_light_${c.type}`;if(!(F in w))return p=p.concat([new f.V("light-3d",c,`Invalid light type ${c.type}`)]),p;const z=w[F];for(const j in c)if("properties"===j){const q=c[j],Z=f.o(q);if("object"!==Z)return p=p.concat([new f.V("properties",q,`object expected, ${Z} found`)]),p;for(const ne in q)p=p.concat(z[ne]?Bs({key:ne,value:q[ne],valueSpec:z[ne],style:I,styleSpec:w}):[new f.n(y.key,q[ne],`unknown property "${ne}"`)])}else{const q=j.match(/^(.*)-transition$/);p=p.concat(q&&C[q[1]]&&C[q[1]].transition?Bs({key:j,value:c[j],valueSpec:w.transition,style:I,styleSpec:w}):C[j]?Bs({key:j,value:c[j],valueSpec:C[j],style:I,styleSpec:w}):[new f.n(j,c[j],`unknown property "${j}"`)])}return p}function Ii(y){const c=y.value,p=y.key,v=y.style,w=y.styleSpec,C=w.terrain;let M=[];const I=f.o(c);if(void 0===c||"null"===I)return M;if("object"!==I)return M=M.concat([new f.V("terrain",c,`object expected, ${I} found`)]),M;for(const P in c){const F=P.match(/^(.*)-transition$/);M=M.concat(F&&C[F[1]]&&C[F[1]].transition?Bs({key:P,value:c[P],valueSpec:w.transition,style:v,styleSpec:w}):C[P]?Bs({key:P,value:c[P],valueSpec:C[P],style:v,styleSpec:w}):[new f.n(P,c[P],`unknown property "${P}"`)])}if(c.source){const P=v.sources&&v.sources[c.source],F=P&&f.u(P.type);P?"raster-dem"!==F&&M.push(new f.V(p,c.source,`terrain cannot be used with a source of type ${String(F)}, it only be used with a "raster-dem" source type`)):M.push(new f.V(p,c.source,`source "${c.source}" not found`))}else M.push(new f.V(p,c,'terrain is missing required property "source"'));return M}function uh(y){const c=y.value,p=y.style,v=y.styleSpec,w=v.fog;let C=[];const M=f.o(c);if(void 0===c)return C;if("object"!==M)return C=C.concat([new f.V("fog",c,`object expected, ${M} found`)]),C;for(const I in c){const P=I.match(/^(.*)-transition$/);C=C.concat(P&&w[P[1]]&&w[P[1]].transition?Bs({key:I,value:c[I],valueSpec:v.transition,style:p,styleSpec:v}):w[I]?Bs({key:I,value:c[I],valueSpec:w[I],style:p,styleSpec:v}):[new f.n(I,c[I],`unknown property "${I}"`)])}return C}const Vo={"*":()=>[],array:sr,boolean:function(y){const c=y.value,p=y.key,v=f.o(c);return"boolean"!==v?[new f.V(p,c,`boolean expected, ${v} found`)]:[]},number:Cf,color:function(y){const c=y.key,p=y.value,v=f.o(p);return"string"!==v?[new f.V(c,p,`color expected, ${v} found`)]:null===f.G(p)?[new f.V(c,p,`color expected, "${p}" found`)]:[]},enum:ka,filter:Sf,function:So,layer:Mf,object:Ia,source:Dl,model:f.L,light:ec,"light-3d":Do,terrain:Ii,fog:uh,string:Eu,formatted:function(y){return 0===Eu(y).length?[]:Tc(y)},resolvedImage:function(y){return 0===Eu(y).length?[]:Tc(y)},projection:function(y){const c=y.value,p=y.styleSpec,v=p.projection,w=y.style;let C=[];const M=f.o(c);if("object"===M)for(const I in c)C=C.concat(Bs({key:I,value:c[I],valueSpec:v[I],style:w,styleSpec:p}));else"string"!==M&&(C=C.concat([new f.V("projection",c,`object or string expected, ${M} found`)]));return C},import:function(y){const{value:c,styleSpec:p}=y,{data:v,...w}=c;Object.defineProperty(w,"__line__",{value:c.__line__,enumerable:!1});let C=Ia(f.q({},y,{value:w,valueSpec:p.import}));return""===f.u(w.id)&&C.push(new f.V(`${y.key}.id`,w,"import id can't be an empty string")),v&&(C=C.concat(Me(v,p,{key:`${y.key}.data`}))),C}};function Bs(y,c=!1){const p=y.value,v=y.valueSpec,w=y.styleSpec;if(v.expression&&f.J(f.u(p)))return So(y);if(v.expression&&f.v(f.x(p)))return Tc(y);if(v.type&&Vo[v.type]){const C=Vo[v.type](y);return!0===c&&C.length>0&&"array"===f.o(y.value)?Tc(y):C}return Ia(f.q({},y,{valueSpec:v.type?w[v.type]:v}))}function ys(y){const c=y.value,p=y.key,v=Eu(y);return v.length||(-1===c.indexOf("{fontstack}")&&v.push(new f.V(p,c,'"glyphs" url must include a "{fontstack}" token')),-1===c.indexOf("{range}")&&v.push(new f.V(p,c,'"glyphs" url must include a "{range}" token'))),v}function Me(y,c=f.N,p={}){return Bs({key:p.key||"",value:y,valueSpec:c.$root,styleSpec:c,style:y,objectElementValidators:{glyphs:ys,"*":()=>[]}})}function K(y,c=f.N){return yt(Me(y,c))}const J=y=>yt(Dl(y)),me=y=>yt(ec(y)),Ae=y=>yt(Do(y)),Ce=y=>yt(Ii(y)),$e=y=>yt(uh(y)),st=y=>yt(Mf(y)),Ue=y=>yt(Sf(y)),it=y=>yt(Tu(y)),Et=y=>yt(tl(y)),Ct=y=>yt(f.L(y));function yt(y){return y.slice().sort((c,p)=>c.line&&p.line?c.line-p.line:0)}function Nn(y,c){let p=!1;if(c&&c.length)for(const v of c)v instanceof f.n?f.w(v.message):(y.fire(new f.f(new Error(v.message))),p=!0);return p}let Qn;class $r extends f.E{constructor(c,p="flat"){super(),this._transitionable=new f.O(Qn||(Qn=new f.U({anchor:new f.W(f.N.light.anchor),position:new f.X(f.N.light.position),color:new f.W(f.N.light.color),intensity:new f.W(f.N.light.intensity)}))),this.setLight(c,p),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,p,v={}){this._validate(me,c,v)||(this._transitionable.setTransitionOrValue(c),this.id=p)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,v){return(!v||!1!==v.validate)&&Nn(this,c.call(K,f.Q({value:p,style:{glyphs:!0,sprite:!0},styleSpec:f.N})))}}const gr=new f.U({source:new f.W(f.N.terrain.source),exaggeration:new f.W(f.N.terrain.exaggeration)});let zr=class extends f.E{constructor(y,c,p,v){super(),this.scope=p,this._transitionable=new f.O(gr,p,v),this._transitionable.setTransitionOrValue(y,v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(y,c){this._transitionable.setTransitionOrValue(y,c)}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}getExaggeration(y){return this._transitioning.possiblyEvaluate(new f.Y(y)).get("exaggeration")}isZoomDependent(){const y=this._transitionable._values.exaggeration;return null!=y&&null!=y.value&&null!=y.value.expression&&y.value.expression instanceof f.Z}};const yn=45,Qi=65,Yr=.05;function Ur(y,c,p,v){const w=f.a0(yn,Qi,p),[C,M]=Kr(y,v);let I=1-Math.min(1,Math.exp((c-C)/(M-C)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*w*y.alpha}function Kr(y,c){const p=.5/Math.tan(.5*c);return[y.range[0]+p,y.range[1]+p]}function zs(y,c,p,v,w){const C=f.$.transformMat4([],[c,p,v],w.mercatorFogMatrix);return Ur(y,f.$.length(C),w.pitch,w._fov)}function uo(y,c,p,v,w,C,M){const I=[[p,v,0],[w,v,0],[w,C,0],[p,C,0]];let P=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(const z of I){const j=f.$.transformMat4([],z,c),q=f.$.length(j);P=Math.min(P,q),F=Math.max(F,q)}return[Ur(y,P,M.pitch,M._fov),Ur(y,F,M.pitch,M._fov)]}const jo=new f.U({range:new f.W(f.N.fog.range),color:new f.W(f.N.fog.color),"high-color":new f.W(f.N.fog["high-color"]),"space-color":new f.W(f.N.fog["space-color"]),"horizon-blend":new f.W(f.N.fog["horizon-blend"]),"star-intensity":new f.W(f.N.fog["star-intensity"]),"vertical-range":new f.W(f.N.fog["vertical-range"])});class Oa extends f.E{constructor(c,p,v,w){super(),this._transitionable=new f.O(jo,v,new Map(w)),this.set(c,w),this._transitioning=this._transitionable.untransitioned(),this._transform=p,this.properties=new f.a1(jo),this.scope=v}get state(){const c=this._transform,p="globe"===c.projection.name,v=f.a2(c.zoom),w=this.properties.get("range"),C=[.5,3];return{range:p?[f.a3(C[0],w[0],v),f.a3(C[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,p,v={}){if(this._validate($e,c,v))return;const w=f.Q({},c);for(const C of Object.keys(f.N.fog))void 0===w[C]&&(w[C]=f.N.fog[C].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,p)}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:f.a0(yn,Qi,c))*p.a}getOpacityAtLatLng(c,p){return this._transform.projection.supportsFog?function(v,w,C){const M=f._.fromLngLat(w),I=C.elevation?C.elevation.getAtPointOrZero(M):0;return zs(v,M.x,M.y,I,C)}(this.state,c,p):0}getOpacityForTile(c){if(!this._transform.projection.supportsFog)return[1,1];const p=this._transform.calculateFogTileMatrix(c.toUnwrapped());return uo(this.state,p,0,0,f.a4,f.a4,this._transform)}getOpacityForBounds(c,p,v,w,C){return this._transform.projection.supportsFog?uo(this.state,c,p,v,w,C,this._transform):[1,1]}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Kr(this.state,c):[0,1]}isVisibleOnFrustum(c){if(!this._transform.projection.supportsFog)return!1;const p=[4,5,6,7];for(const v of p){const w=c.points[v];let C;if(w[2]>=0)C=w;else{const M=c.points[v-4];C=f.a5(M,w,M[2]/(M[2]-w[2]))}if(zs(this.state,C[0],C[1],0,this._transform)>=Yr)return!0}return!1}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,v){return(!v||!1!==v.validate)&&Nn(this,c.call(K,f.Q({value:p,style:{glyphs:!0,sprite:!0},styleSpec:f.N})))}}class bd extends f.E{constructor(c,p,v,w){super(),this.scope=v,this._options=c,this.properties=new f.a1(p),this._transitionable=new f.O(p,v,new Map(w)),this._transitionable.setTransitionOrValue(c.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(c){this._transitionable.setTransitionOrValue(this._options.properties,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(c,p){this._options=c,this._transitionable.setTransitionOrValue(c.properties,p)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}let lm,cm;var um="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",br="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Ng="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",wd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Cv="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",U_="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",V_="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Sv="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Dv="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",j_="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",$_="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const hm=[];Af(um,hm),Af(Ng,hm),Af(br,hm);const Fg={"_prelude_fog.vertex.glsl":U_,"_prelude_terrain.vertex.glsl":Cv,"_prelude_shadow.vertex.glsl":j_,"_prelude_fog.fragment.glsl":V_,"_prelude_shadow.fragment.glsl":$_,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Sv,"_prelude_raster_particle.glsl":Dv},Lg={};Nr("",Cv),Nr(V_,U_),Nr($_,j_),Nr(Sv,""),Nr(Dv,"");const Bg=Nr(br,Ng),Mv=um;var Xw={background:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Nr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nr('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Nr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Nr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Nr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Nr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Nr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Nr('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Nr("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Nr("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Nr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Nr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Nr('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Nr('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;\n#endif\n}'),symbolSDF:Nr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Nr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Nr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Nr('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',wd),skyboxGradient:Nr('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',wd),skyboxCapture:Nr("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Nr('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Nr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Nr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Nr("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),occlusion:Nr("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Af(y,c){const p=y.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let v of p)if(v=v.trim(),"#"===v[0]&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const C of w)c.includes(C)||c.push(C)}}function Nr(y,c){const p=/#include\s+"([^"]+)"/g,v=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=c.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map(F=>{const z=F.split(" ");return z[z.length-1]}),w=[...new Set(w)]);const C={},M=[],I=[];if(y=y.replace(p,(F,z)=>(I.push(z),"")),(c=c.replace(p,(F,z)=>(M.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...hm];Af(y,P),Af(c,P);for(const F of[...M,...I])Fg[F]||console.error(`Undefined include: ${F}`),Lg[F]||(Lg[F]=[],Af(Fg[F],Lg[F])),P=[...P,...Lg[F]];return{fragmentSource:y=y.replace(v,(F,z,j,q,Z)=>(C[Z]=!0,"define"===z?`\n#ifndef HAS_UNIFORM_u_${Z}\nin ${j} ${q} ${Z};\n#else\nuniform ${j} ${q} u_${Z};\n#endif\n`:"initialize"===z?`\n#ifdef HAS_UNIFORM_u_${Z}\n    ${j} ${q} ${Z} = u_${Z};\n#endif\n`:"define-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${Z}\n    in ${j} ${q} ${Z};\n#endif\n`:"initialize-attribute"===z?"":void 0)),vertexSource:c=c.replace(v,(F,z,j,q,Z)=>{const ne="float"===q?"vec2":q,re=Z.match(/color/)?"color":ne;return"define-attribute-vertex-shader-only"===z?`\n#ifdef HAS_ATTRIBUTE_a_${Z}\nin ${j} ${q} a_${Z};\n#endif\n`:C[Z]?"define"===z?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nin ${j} ${ne} a_${Z};\nout ${j} ${q} ${Z};\n#else\nuniform ${j} ${q} u_${Z};\n#endif\n`:"initialize"===z?"vec4"===re?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = a_${Z};\n#else\n    ${j} ${q} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = unpack_mix_${re}(a_${Z}, u_${Z}_t);\n#else\n    ${j} ${q} ${Z} = u_${Z};\n#endif\n`:"define-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${Z}\n    in ${j} ${q} a_${Z};\n    out ${j} ${q} ${Z};\n#endif\n`:"initialize-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${Z}\n    ${Z} = a_${Z};\n#endif\n`:void 0:"define"===z?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nin ${j} ${ne} a_${Z};\n#else\nuniform ${j} ${q} u_${Z};\n#endif\n`:"define-instanced"===z?"mat4"===re?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${Z}0;\nin vec4 a_${Z}1;\nin vec4 a_${Z}2;\nin vec4 a_${Z}3;\n#else\nuniform ${j} ${q} u_${Z};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${j} ${ne} a_${Z};\n#else\nuniform ${j} ${q} u_${Z};\n#endif\n`:"initialize-attribute-custom"===z?`\n#ifdef HAS_ATTRIBUTE_a_${Z}\n    ${j} ${q} ${Z} = a_${Z};\n#endif\n`:"vec4"===re?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${j} ${q} ${Z} = a_${Z};\n#else\n    ${j} ${q} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${j} ${q} ${Z} = unpack_mix_${re}(a_${Z}, u_${Z}_t);\n#else\n    ${j} ${q} ${Z} = u_${Z};\n#endif\n`}),staticAttributes:w,usedDefines:P,vertexIncludes:M,fragmentIncludes:I}}class Yw{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,p,v,w,C,M,I,P){this.context=c;let F=this.boundPaintVertexBuffers.length!==w.length;for(let j=0;!F&&j<w.length;j++)this.boundPaintVertexBuffers[j]!==w[j]&&(F=!0);let z=this.boundDynamicVertexBuffers.length!==I.length;for(let j=0;!z&&j<I.length;j++)this.boundDynamicVertexBuffers[j]!==I[j]&&(z=!0);if(!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==v||F||z||this.boundIndexBuffer!==C||this.boundVertexOffset!==M)this.freshBind(p,v,w,C,M,I,P);else{c.bindVertexArrayOES.set(this.vao);for(const j of I)j&&(j.bind(),P&&j.instanceCount&&j.setVertexAttribDivisor(c.gl,p,P));C&&C.dynamicDraw&&C.bind()}}freshBind(c,p,v,w,C,M,I){const P=c.numAttributes,F=this.context,z=F.gl;this.vao&&this.destroy(),this.vao=F.gl.createVertexArray(),F.bindVertexArrayOES.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=M,p.enableAttributes(z,c),p.bind(),p.setVertexAttribPointers(z,c,C);for(const j of v)j.enableAttributes(z,c),j.bind(),j.setVertexAttribPointers(z,c,C);for(const j of M)j&&(j.enableAttributes(z,c),j.bind(),j.setVertexAttribPointers(z,c,C),I&&j.instanceCount&&j.setVertexAttribDivisor(z,c,I));w&&w.bind(),F.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Av(y,c){const p=Math.pow(2,c.canonical.z),v=c.canonical.y;return[new f._(0,v/p).toLngLat().lat,new f._(0,(v+1)/p).toLngLat().lat]}function Iv(y,c,p,v,w,C,M){const I=y.context,P=I.gl,F=p.hillshadeFBO;if(!F)return;y.prepareDrawTile();const z=y.isTileAffectedByFog(c),j=y.getOrCreateProgram("hillshade",{overrideFog:z});I.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,F.colorAttachment.get());const q=((ie,Q,se,ce)=>{const de=se.paint.get("hillshade-shadow-color"),be=se.paint.get("hillshade-highlight-color"),_e=se.paint.get("hillshade-accent-color"),ye=se.paint.get("hillshade-emissive-strength");let De=f.ac(se.paint.get("hillshade-illumination-direction"));if("viewport"===se.paint.get("hillshade-illumination-anchor"))De-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const Be=ie.style.directionalLight.properties.get("direction"),ke=f.ad(Be.x,Be.y,Be.z);De=f.ac(ke[1])}const Ee=!ie.options.moving;return{u_matrix:ce||ie.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:Av(0,Q.tileID),u_light:[se.paint.get("hillshade-exaggeration"),De],u_shadow:de.toRenderColor(se.lut),u_highlight:be.toRenderColor(se.lut),u_emissive_strength:ye,u_accent:_e.toRenderColor(se.lut)}})(y,p,v,y.terrain?c.projMatrix:null);y.uploadCommonUniforms(I,j,c.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:ne,tileBoundsSegments:re}=y.getTileBoundsBuffers(p);j.draw(y,P.TRIANGLES,w,C,M,f.ag.disabled,q,v.id,Z,ne,re)}function H_(y,c,p){if(!c.needsDEMTextureUpload)return;const v=y.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||y.getTileTexture(p.stride);const C=p.getPixels();c.demTexture?c.demTexture.update(C,{premultiply:!1}):c.demTexture=new f.T(v,C,w.R32F,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Kw(y,c,p){const v=y.context,w=v.gl;if(!c.dem)return;const C=c.dem;if(v.activeTexture.set(w.TEXTURE1),H_(y,c,C),!c.demTexture)return;c.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const M=C.dim;v.activeTexture.set(w.TEXTURE0);let I=c.hillshadeFBO;if(!I){const q=new f.T(v,{width:M,height:M,data:null},w.RGBA);q.bind(w.LINEAR,w.CLAMP_TO_EDGE),I=c.hillshadeFBO=v.createFramebuffer(M,M,!0,"renderbuffer"),I.colorAttachment.set(q.texture)}v.bindFramebuffer.set(I.framebuffer),v.viewport.set([0,0,M,M]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:F,tileBoundsSegments:z}=y.getMercatorTileBoundsBuffers(),j=[];y.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),y.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(y,w.TRIANGLES,f.af.disabled,f.ah.disabled,f.a.unblended,f.ag.disabled,((q,Z)=>{const ne=Z.stride,re=f.ae.create();return f.ae.ortho(re,0,f.a4,-f.a4,0,0,1),f.ae.translate(re,re,[0,-f.a4,0]),{u_matrix:re,u_image:1,u_dimension:[ne,ne],u_zoom:q.overscaledZ}})(c.tileID,C),p.id,P,F,z),c.needsHillshadePrepare=!1}function G_(y,c,p,v,w){const C=function(I,P){if(I)return w(I);if(P){if(y.url&&P.tiles&&y.tiles&&delete y.tiles,P.variants){if(!Array.isArray(P.variants))return w(new Error("variants must be an array"));for(const z of P.variants){if(null==z||"object"!=typeof z||z.constructor!==Object)return w(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return w(new Error("capabilities must be an array"));if(1===z.capabilities.length&&"meshopt"===z.capabilities[0]){P=f.Q(P,z);break}}}const F=f.ai(f.Q(P,y),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(F.vectorLayers=P.vector_layers,F.vectorLayerIds=F.vectorLayers.map(z=>z.id)),P.raster_layers&&(F.rasterLayers=P.raster_layers,F.rasterLayerIds=F.rasterLayers.map(z=>z.id)),F.tiles=c.canonicalizeTileset(F,y.url),w(null,F)}},M=function(I,P,F){if(!I)return null;if(!P&&!F)return I;F=F||I.worldview_default;const z=Object.values(I.language||{});if(0===z.length)return null;const j=Object.values(I.worldview||{});if(0===j.length)return null;const q=z.every(ne=>ne===P),Z=j.every(ne=>ne===F);return q&&Z?I:P in(I.language_options||{})||F in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(y.data,p,v);return M?f.e.frame(()=>C(null,M)):y.url?f.h(c.transformRequest(c.normalizeSourceURL(y.url,null,p,v),f.R.Source),C):f.e.frame(()=>{const{data:I,...P}=y;C(null,P)})}class dm{constructor(c,p,v){this.bounds=f.aj.convert(this.validateBounds(c)),this.minzoom=p||0,this.maxzoom=v||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const p=Math.pow(2,c.z),v=Math.floor(f.ak(this.bounds.getWest())*p),w=Math.floor(f.al(this.bounds.getNorth())*p),C=Math.ceil(f.ak(this.bounds.getEast())*p),M=Math.ceil(f.al(this.bounds.getSouth())*p);return c.x>=v&&c.x<C&&c.y>=w&&c.y<M}}class Ml extends f.E{constructor(c,p,v,w){super(),this.id=c,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.Q({type:"raster"},p),f.Q(this,f.ai(p,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new f.g("dataloading",{dataType:"source"})),this._tileJSONRequest=G_(this._options,this.map._requestManager,null,null,(p,v)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new f.f(p)):v&&(f.Q(this,v),v.bounds&&(this.tileBounds=new dm(v.bounds,this.minzoom,this.maxzoom)),f.ao(v.tiles),this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))),c&&c(p)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=f.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(c){this.cancelTileJSONRequest()}serialize(){return f.Q({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,p){const v=f.e.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);c.request=f.i(this.map._requestManager.transformRequest(w,f.R.Tile),(C,M,I,P)=>(delete c.request,c.aborted?(c.state="unloaded",p(null)):C?(c.state="errored",p(C)):M?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:I,expires:P}),c.setTexture(M,this.map.painter),c.state="loaded",f.an(this.dispatcher),void p(null)):p(null)))}abortTile(c,p){c.request&&(c.request.cancel(),delete c.request),p&&p()}unloadTile(c,p){c.texture&&c.texture instanceof f.T?(c.destroy(!0),c.texture&&c.texture instanceof f.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),p&&p()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class kv extends f.E{constructor(c,p,v,w){if(super(),this.id=c,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.Q(this,f.ai(p,["url","scheme","tileSize","promoteId"])),this._options=f.Q({type:"vector"},p),this._collectResourceTiming=!!p.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new f.ap}load(c){this._loaded=!1,this.fire(new f.g("dataloading",{dataType:"source"}));const p=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=G_(this._options,this.map._requestManager,p,v,(w,C)=>{this._tileJSONRequest=null,this._loaded=!0,w?(p&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${p}`),v&&2!==v.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new f.f(w))):C&&(f.Q(this,C),C.bounds&&(this.tileBounds=new dm(C.bounds,this.minzoom,this.maxzoom)),f.ao(C.tiles,this.map._requestManager._customAccessToken),this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))),c&&c(w)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=f.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(c){this.cancelTileJSONRequest()}serialize(){return f.Q({},this._options)}loadTile(c,p){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w=this.map._requestManager.transformRequest(v,f.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,M={request:w,data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,lut:C?{image:C.image.clone()}:null,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:f.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(M.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=p:c.request=c.actor.send("reloadTile",M,I.bind(this));else if(c.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",M,I.bind(this),void 0,!0);else{const P=f.aq.call({deduped:this._deduped},M,(F,z)=>{F||!z?I.call(this,F):(M.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},c.actor&&c.actor.send("loadTile",M,I.bind(this),void 0,!0))},!0);c.request={cancel:P}}function I(P,F){return delete c.request,c.aborted?p(null):P&&404!==P.status?p(P):(F&&F.resourceTiming&&(c.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&c.setExpiryData(F),c.loadVectorData(F,this.map.painter),f.an(this.dispatcher),p(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(c,p){c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Jw=(y,c,p)=>({u_matrix:y,u_image0:0,u_skirt_height:c,u_ground_shadow_factor:p}),W_=(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:p,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_frustum_tl:M,u_frustum_tr:I,u_frustum_br:P,u_frustum_bl:F,u_globe_pos:z,u_globe_radius:j,u_viewport:q,u_grid_matrix:re?Float32Array.from(re):new Float32Array(9),u_skirt_height:Z,u_far_z_cutoff:ne});class zg{constructor(c=0,p=0,v=0,w=0){if(isNaN(c)||c<0||isNaN(p)||p<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=p,this.left=v,this.right=w}interpolate(c,p,v){return null!=p.top&&null!=c.top&&(this.top=f.a3(c.top,p.top,v)),null!=p.bottom&&null!=c.bottom&&(this.bottom=f.a3(c.bottom,p.bottom,v)),null!=p.left&&null!=c.left&&(this.left=f.a3(c.left,p.left,v)),null!=p.right&&null!=c.right&&(this.right=f.a3(c.right,p.right,v)),this}getCenter(c,p){const v=f.au((this.left+c-this.right)/2,0,c),w=f.au((this.top+p-this.bottom)/2,0,p);return new f.P(v,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new zg(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Td(y,c){const p=f.ax(y,3);f.ae.fromQuat(y,c),f.aA(y,3,p)}function $t(y,c){const p=f.aw.identity([]);return f.aw.rotateZ(p,p,-c),f.aw.rotateX(p,p,-y),p}function Ed(y,c){const p=[y[0],y[1],0],v=[c[0],c[1],0];if(f.$.length(p)>=1e-15){const M=f.$.normalize([],p);f.$.scale(v,M,f.$.dot(v,M)),c[0]=v[0],c[1]=v[1]}const w=f.$.cross([],c,y);if(f.$.len(w)<1e-15)return null;const C=Math.atan2(-w[1],w[0]);return $t(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),C)}class fm{constructor(c,p){this.position=c,this.orientation=p}get position(){return this._position}set position(c){if(c){const p=c instanceof f._?c:new f._(c[0],c[1],c[2]);this._renderWorldCopies&&(p.x=f.av(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(c,p){if(this.orientation=null,!this.position)return;const v=this.position,w=this._elevation?this._elevation.getAtPointOrZero(f._.fromLngLat(c)):0,C=f._.fromLngLat(c,w),M=[C.x-v.x,C.y-v.y,C.z-v.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=Ed(M,p)}setPitchBearing(c,p){this.orientation=$t(f.ac(c),f.ac(-p))}}class Cd{constructor(c,p){this._transform=f.ae.identity([]),this.orientation=p,this.position=c}get mercatorPosition(){const c=this.position;return new f._(c[0],c[1],c[2])}get position(){const c=f.ax(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var p;c&&f.aA(this._transform,3,[(p=c)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||f.aw.identity([]),c&&Td(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,p){this._orientation=$t(c,p),Td(this._transform,this._orientation)}forward(){const c=f.ax(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=f.ax(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=f.ax(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,p){const v=new Float64Array(16);return f.ae.invert(v,this.getWorldToCamera(c,p)),v}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(c,p,v){const w=this.position;f.$.scale(w,w,-c);const C=new Float64Array(16);return f.ae.fromScaling(C,[v,v,v]),f.ae.translate(C,C,w),C[10]*=p,C}getWorldToCamera(c,p){const v=new Float64Array(16),w=new Float64Array(4),C=this.position;return f.aw.conjugate(w,this._orientation),f.$.scale(C,C,-c),f.ae.fromQuat(v,w),f.ae.translate(v,v,C),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=p,v[9]*=p,v[10]*=p,v[11]*=p,v}getCameraToClipPerspective(c,p,v,w){const C=new Float64Array(16);return f.ae.perspective(C,c,p,v,w),C}getCameraToClipOrthographic(c,p,v,w,C,M){const I=new Float64Array(16);return f.ae.ortho(I,c,p,v,w,C,M),I}getDistanceToElevation(c,p=!1){const v=0===c?0:f.ay(c,p?f.az(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new Cd([...this.position],[...this.orientation])}}const Dr={unknown:0,flipRequired:1,flipNotRequired:2},oa=Math.tan(85*Math.PI/180);function If(y,c,p,v,w,C,M){const I=f.ae.create();if(p)if("globe"===C.name){const P=f.aC(w,c);f.ae.multiply(I,I,P)}else{const P=f.aD.invert([],M);I[0]=P[0],I[1]=P[1],I[4]=P[2],I[5]=P[3],v||f.ae.rotateZ(I,I,w.angle)}else f.ae.multiply(I,w.labelPlaneMatrix,y);return I}function Ug(y,c,p,v,w,C,M){const I=If(y,c,p,v,w,C,M);return"globe"===C.name&&p||(I[2]=I[6]=I[10]=I[14]=0),I}function Vg(y,c,p,v,w,C,M){if(p){if("globe"===C.name){const I=If(y,c,p,v,w,C,M);return f.ae.invert(I,I),f.ae.multiply(I,y,I),I}{const I=f.ae.clone(y),P=f.ae.identity([]);return P[0]=M[0],P[1]=M[1],P[4]=M[2],P[5]=M[3],f.ae.multiply(I,I,P),v||f.ae.rotateZ(I,I,-w.angle),I}}return w.glCoordMatrix}function Ec(y,c,p,v){const w=[y,c,p,1];p?f.aB.transformMat4(w,w,v):Hg(w,w,v);const C=w[3];return w[0]/=C,w[1]/=C,w[2]/=C,w}function vr(y,c){return Math.min(.5+y/c*.5,1.5)}function jg(y,c){const p=y[0]/y[3],v=y[1]/y[3];return p>=-c[0]&&p<=c[0]&&v>=-c[1]&&v<=c[1]}function hh(y,c,p,v,w,C,M,I,P,F){const z=p.transform,j=v?y.textSizeData:y.iconSizeData,q=f.aE(j,p.transform.zoom),Z="globe"===z.projection.name,ne=[256/p.width*2+1,256/p.height*2+1],re=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;re.clear();let ie=null;Z&&(ie=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const Q=y.lineVertexArray,se=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,ce=p.transform.width/p.transform.height;let de,be=!1;for(let _e=0;_e<se.length;_e++){const ye=se.get(_e),{numGlyphs:De,writingMode:Ee}=ye;if(Ee!==f.aF.vertical||be||de===f.aF.horizontal||(be=!0),de=Ee,(ye.hidden||Ee===f.aF.vertical)&&!be){dh(De,re);continue}be=!1;const Be=new f.P(ye.tileAnchorX,ye.tileAnchorY);let{x:ke,y:pe,z:Je}=z.projection.projectTilePoint(Be.x,Be.y,F.canonical);if(P){const[Wt,Vt,bt]=P(Be);ke+=Wt,pe+=Vt,Je+=bt}const Ke=[ke,pe,Je,1];if(f.aB.transformMat4(Ke,Ke,c),!jg(Ke,ne)){dh(De,re);continue}const Pe=Ke[3],pt=vr(p.transform.getCameraToCenterDistance(z.projection),Pe),mt=f.aG(j,q,ye),He=M?mt/pt:mt*pt,nt=Ec(ke,pe,Je,w);if(nt[3]<=0){dh(De,re);continue}let Oe={};const _t=M?null:P,gt=$o(ye,He,!1,I,c,w,C,y.glyphOffsetArray,Q,re,ie,nt,Be,Oe,ce,_t,z.projection,F,M);be=gt.useVertical,_t&&gt.needsFlipping&&(Oe={}),(gt.notEnoughRoom||be||gt.needsFlipping&&$o(ye,He,!0,I,c,w,C,y.glyphOffsetArray,Q,re,ie,nt,Be,Oe,ce,_t,z.projection,F,M).notEnoughRoom)&&dh(De,re)}v?(y.text.dynamicLayoutVertexBuffer.updateData(re),ie&&y.text.globeExtVertexBuffer&&y.text.globeExtVertexBuffer.updateData(ie)):(y.icon.dynamicLayoutVertexBuffer.updateData(re),ie&&y.icon.globeExtVertexBuffer&&y.icon.globeExtVertexBuffer.updateData(ie))}function $g(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re){const{lineStartIndex:ie,glyphStartIndex:Q,segment:se}=I,ce=Q+I.numGlyphs,de=ie+I.lineLength,be=c.getoffsetX(Q),_e=c.getoffsetX(ce-1),ye=pm(y*be,p,v,w,C,M,se,ie,de,P,F,z,j,q,!0,Z,ne,re);if(!ye)return null;const De=pm(y*_e,p,v,w,C,M,se,ie,de,P,F,z,j,q,!0,Z,ne,re);return De?{first:ye,last:De}:null}function kf(y,c,p,v){return y===f.aF.horizontal&&Math.abs(v)>Math.abs(p)?{useVertical:!0}:y===f.aF.vertical?v>0?{needsFlipping:!0}:null:c!==Dr.unknown&&(0===(w=p)||Math.abs(v/w)>oa)?c===Dr.flipRequired?{needsFlipping:!0}:null:p<0?{needsFlipping:!0}:null;var w}function $o(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie,Q,se){const ce=c/24,de=y.lineOffsetX*ce,be=y.lineOffsetY*ce,{lineStartIndex:_e,glyphStartIndex:ye,numGlyphs:De,segment:Ee,writingMode:Be,flipState:ke}=y,pe=_e+y.lineLength,Je=Ke=>{if(z){const[He,nt,Oe]=Ke.up,_t=F.length;f.aH(z,_t+0,He,nt,Oe),f.aH(z,_t+1,He,nt,Oe),f.aH(z,_t+2,He,nt,Oe),f.aH(z,_t+3,He,nt,Oe)}const[Pe,pt,mt]=Ke.point;f.aI(F,Pe,pt,mt,Ke.angle)};if(De>1){const Ke=$g(ce,I,de,be,p,j,q,y,P,C,Z,re,!1,ie,Q,se);if(!Ke)return{notEnoughRoom:!0};if(v&&!p){let[Pe,pt,mt]=Ke.first.point,[He,nt,Oe]=Ke.last.point;[Pe,pt]=Ec(Pe,pt,mt,M),[He,nt]=Ec(He,nt,Oe,M);const _t=kf(Be,ke,(He-Pe)*ne,nt-pt);if(y.flipState=_t&&_t.needsFlipping?Dr.flipRequired:Dr.flipNotRequired,_t)return _t}Je(Ke.first);for(let Pe=ye+1;Pe<ye+De-1;Pe++){const pt=pm(ce*I.getoffsetX(Pe),de,be,p,j,q,Ee,_e,pe,P,C,Z,re,!1,!1,ie,Q,se);if(!pt)return F.length-=4*(Pe-ye),{notEnoughRoom:!0};Je(pt)}Je(Ke.last)}else{if(v&&!p){const Pe=Ec(q.x,q.y,0,w),pt=_e+Ee+1,mt=new f.P(P.getx(pt),P.gety(pt)),He=Ec(mt.x,mt.y,0,w),nt=He[3]>0?He:q_(q,mt,Pe,1,w,void 0,ie,Q.canonical),Oe=kf(Be,ke,(nt[0]-Pe[0])*ne,nt[1]-Pe[1]);if(y.flipState=Oe&&Oe.needsFlipping?Dr.flipRequired:Dr.flipNotRequired,Oe)return Oe}const Ke=pm(ce*I.getoffsetX(ye),de,be,p,j,q,Ee,_e,pe,P,C,Z,re,!1,!1,ie,Q,se);if(!Ke)return{notEnoughRoom:!0};Je(Ke)}return{}}function Ov(y,c,p,v,w){const{x:C,y:M,z:I}=v.projectTilePoint(y.x,y.y,c);if(!w)return Ec(C,M,I,p);const[P,F,z]=w(y);return Ec(C+P,M+F,I+z,p)}function q_(y,c,p,v,w,C,M,I){const P=Ov(y.sub(c)._unit()._add(y),I,w,M,C);return f.$.sub(P,p,P),f.$.normalize(P,P),f.$.scaleAndAdd(P,p,P,v)}function pm(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie,Q){const se=v?y-c:y+c;let ce=se>0?1:-1,de=0;v&&(ce*=-1,de=Math.PI),ce<0&&(de+=Math.PI);let be=I+M+(ce>0?0:1)|0,_e=w,ye=w,De=0,Ee=0;const Be=Math.abs(se),ke=[],pe=[];let Je=C,Ke=Je;const Pe=()=>q_(Ke,Je,ye,Be-De+1,z,q,re,ie.canonical);for(;De+Ee<=Be;){if(be+=ce,be<I||be>=P)return null;if(ye=_e,Ke=Je,ke.push(ye),Z&&pe.push(Ke),Je=new f.P(F.getx(be),F.gety(be)),_e=j[be],!_e){const Vt=Ov(Je,ie.canonical,z,re,q);_e=Vt[3]>0?j[be]=Vt:Pe()}De+=Ee,Ee=f.$.distance(ye,_e)}ne&&q&&(j[be]&&(_e=Pe(),Ee=f.$.distance(ye,_e)),j[be]=_e);const pt=(Be-De)/Ee,mt=Je.sub(Ke)._mult(pt)._add(Ke),He=f.$.sub([],_e,ye),nt=f.$.scaleAndAdd([],ye,He,pt);let Oe=[0,0,1],_t=He[0],gt=He[1];if(Q&&(Oe=re.upVector(ie.canonical,mt.x,mt.y),0!==Oe[0]||0!==Oe[1]||1!==Oe[2])){const Vt=[Oe[2],0,-Oe[0]],bt=f.$.cross([],Oe,Vt);f.$.normalize(Vt,Vt),f.$.normalize(bt,bt),_t=f.$.dot(He,Vt),gt=f.$.dot(He,bt)}if(p){const Vt=f.$.cross([],Oe,He);f.$.normalize(Vt,Vt),f.$.scaleAndAdd(nt,nt,Vt,p*ce)}const Wt=de+Math.atan2(gt,_t);return ke.push(nt),Z&&pe.push(mt),{point:nt,angle:Wt,path:ke,tilePath:pe,up:Oe}}function dh(y,c){const p=c.length,v=p+4*y;c.resize(v),c.float32.fill(-1/0,4*p,4*v)}function Hg(y,c,p){const v=c[0],w=c[1];return y[0]=p[0]*v+p[4]*w+p[12],y[1]=p[1]*v+p[5]*w+p[13],y[3]=p[3]*v+p[7]*w+p[15],y}const Gg=(y,c,p)=>(1-p)*y+p*c,mm=y=>y*y*y*y*y;class Wg{constructor(c,p,v,w,C,M,I){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=c||0,this._maxZoom=p||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(M),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new f.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new zg,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Cd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const c=new Wg(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(c,p=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||v)&&this._updateCameraOnTerrain(),(c||v)&&this._constrainCamera(p),this._calcMatrices()}getProjection(){return f.ai(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=f.aK(this.projectionOptions);const v=this.getProjection(),w=!f.d(p,v);return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setOrthographicProjectionAtLowPitch(c){return this._orthographicProjectionAtLowPitch!==c&&(this._orthographicProjectionAtLowPitch=c,this._calcMatrices(),!0)}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=f.aK({name:"mercator"});const p=c!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return f.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.P(this.width,this.height)}get bearing(){return f.av(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const p=-c*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=f.aD.create(),f.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const p=f.au(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=f.ac(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const p=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(c){this._tileCoverLift!==c&&(this._tileCoverLift=c)}_updateCameraOnTerrain(){const c=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,p=this.elevation&&c===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||c===Number.NEGATIVE_INFINITY&&(!p||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const v=this._elevation;p||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&v.exaggeration()&&this._centerAltitudeValidForExaggeration!==v.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*v.exaggeration(),this._centerAltitudeValidForExaggeration=v.exaggeration()):(this._centerAltitude=c||0,this._centerAltitudeValidForExaggeration=v.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,C=0;for(let M=0;M<p.length;M++){const I=new f.P(p[M][0]*this.width,v+p[M][1]*(this.height-v)),P=c.pointCoordinate(I);if(!P)continue;const F=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);w+=P[3]*F,C+=F}return 0===C?NaN:w/C}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*p,w=this._mercatorZfromZoom(c),C=this._mercatorZfromZoom(this._maxZoom),M=Math.max(w-v,C);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let v;v=c.z<this._camera.position[2]?[p.x,p.y,p.z]:[c.x,c.y,c.z];const w=f.$.length(f.$.sub([],this._camera.position,v));return f.au(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let p=!1;if(c.orientation&&!f.aw.exactEquals(c.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(c.orientation)),c.position){const v=[c.position.x,c.position.y,c.position.z];f.$.exactEquals(v,this._camera.position)||(this._setCameraPosition(v),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,p=new fm;return p.position=new f._(c[0],c[1],c[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(c){if(!f.aw.length(c))return!1;f.aw.normalize(c,c);const p=f.$.transformQuat([],[0,0,-1],c),v=f.$.transformQuat([],[0,-1,0],c);if(v[2]<0)return!1;const w=Ed(p,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(c){const p=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;c[2]=f.au(c[2],w/v,w/p),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,p,v){this._unmodified=!1,this._edgeInsets.interpolate(c,p,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const p=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(c){const p=[new f.aL(0,c)];if(this.renderWorldCopies){const v=this.pointCoordinate(new f.P(0,0)),w=this.pointCoordinate(new f.P(this.width,0)),C=this.pointCoordinate(new f.P(this.width,this.height)),M=this.pointCoordinate(new f.P(0,this.height)),I=Math.floor(Math.min(v.x,w.x,C.x,M.x)),P=Math.floor(Math.max(v.x,w.x,C.x,M.x)),F=1;for(let z=I-F;z<=P+F;z++)0!==z&&p.push(new f.aL(z,c))}return p}isLODDisabled(c){return(!c||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(c,p,v){let w=[];const C=void 0!==v,M=!C;if(M&&this.zoom<p||C&&0===v[0]&&0===v[1])return w;const I=new Set,P=(z,j,q,Z,ne)=>{const re=f.b2(j,z,q,Z,ne);I.has(re)||(w.push(new f.aQ(z,j,q,Z,ne)),I.add(re))};for(let z=0;z<c.length;z++){const j=c[z];if(M&&j.canonical.z!==p)continue;const q=j.canonical,Z=j.overscaledZ,ne=j.wrap,re=1<<q.z,ie=q.x+1<re,Q=q.x>0,se=q.y+1<re,ce=q.y>0,de=j.wrap-(Q?0:1),be=j.wrap+(ie?0:1),_e=Q?q.x-1:re-1,ye=ie?q.x+1:0;if(C)v[0]<0?(P(Z,be,q.z,ye,q.y),v[1]<0&&se&&(P(Z,ne,q.z,q.x,q.y+1),P(Z,be,q.z,ye,q.y+1)),v[1]>0&&ce&&(P(Z,ne,q.z,q.x,q.y-1),P(Z,be,q.z,ye,q.y-1))):v[0]>0?(P(Z,de,q.z,_e,q.y),v[1]<0&&se&&(P(Z,ne,q.z,q.x,q.y+1),P(Z,de,q.z,_e,q.y+1)),v[1]>0&&ce&&(P(Z,ne,q.z,q.x,q.y-1),P(Z,de,q.z,_e,q.y-1))):v[1]<0&&se?P(Z,ne,q.z,q.x,q.y+1):ce&&P(Z,ne,q.z,q.x,q.y-1);else{const De=j.visibleQuadrants;1&De&&(P(Z,de,q.z,_e,q.y),ce&&(P(Z,ne,q.z,q.x,q.y-1),P(Z,de,q.z,_e,q.y-1))),2&De&&(P(Z,be,q.z,ye,q.y),ce&&(P(Z,ne,q.z,q.x,q.y-1),P(Z,be,q.z,ye,q.y-1))),4&De&&(P(Z,de,q.z,_e,q.y),se&&(P(Z,ne,q.z,q.x,q.y+1),P(Z,de,q.z,_e,q.y+1))),8&De&&(P(Z,be,q.z,ye,q.y),se&&(P(Z,ne,q.z,q.x,q.y+1),P(Z,be,q.z,ye,q.y+1)))}}const F=[];for(const z of w)w.some(j=>z.isChildOf(j))||F.push(z);if(w=F.filter(z=>!c.some(j=>!!(z.overscaledZ<p&&j.isChildOf(z))||z.equals(j)||z.isChildOf(j))),M){const z=1<<p,j="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[z*j.x,z*j.y],Z=4,ne=Z*Z;w=w.filter(re=>{const ie=re.canonical.x+.5-q[0],Q=re.canonical.y+.5-q[1];return ie*ie+Q*Q<ne})}return w}coveringTiles(c){let p=this.coveringZoomLevel(c);const v=p,w=this.elevation&&this.elevation.exaggeration(),C=w&&!c.isTerrainDEM,M="mercator"===this.projection.name;if(void 0!==c.minzoom&&p<c.minzoom)return[];void 0!==c.maxzoom&&p>c.maxzoom&&(p=c.maxzoom);const I=this.locationCoordinate(this.center),P=this.center.lat,F=1<<p,z=[F*I.x,F*I.y,0],j="globe"===this.projection.name,q=!j,Z=f.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,q),ne=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=F*f.ay(1,this.center.lat),ie=this._camera.position[2]/f.ay(1,this.center.lat),Q=[F*ne.x,F*ne.y,ie*(q?1:re)],se=j||w,ce=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),de=this.isLODDisabled(!0)?p:0;let be;if(this._elevation&&c.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const He=this._elevation.getMinMaxForVisibleTiles();be=He?He.max:this._centerAltitude}else be=this._centerAltitude;const _e=c.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,ye=this.projection.isReprojectedInTileSpace?f.aN(this):1,De=He=>{const Oe=new f._(He.x+25e-6,He.y,He.z),_t=new f._(He.x,He.y+25e-6,He.z),gt=He.toLngLat(),Wt=Oe.toLngLat(),Vt=_t.toLngLat(),bt=this.locationCoordinate(gt),Qt=this.locationCoordinate(Wt),Pn=this.locationCoordinate(Vt),Yn=Math.hypot(Qt.x-bt.x,Qt.y-bt.y),Un=Math.hypot(Pn.x-bt.x,Pn.y-bt.y);return Math.sqrt(Yn*Un)*ye/25e-6},Ee=He=>{const nt=be,Oe=_e;return{aabb:f.aR(this,F,0,0,0,He,Oe,nt,this.projection),zoom:0,x:0,y:0,minZ:Oe,maxZ:nt,wrap:He,fullyVisible:!1}},Be=[];let ke=[];const pe=p,Je=c.reparseOverscaled?v:p,Ke=(ie-this._centerAltitude)*re,Pe=He=>{if(!this._elevation||!He.tileID||!M)return;const nt=this._elevation.getMinMaxForTile(He.tileID),Oe=He.aabb;nt?(Oe.min[2]=nt.min,Oe.max[2]=nt.max,Oe.center[2]=(Oe.min[2]+Oe.max[2])/2):(He.shouldSplit=mt(He),He.shouldSplit||(Oe.min[2]=Oe.max[2]=Oe.center[2]=this._centerAltitude))},pt=(He,nt)=>{if(.707*nt<He)return 1;const Oe=nt/He;return Oe/(1.4144271570014144+(Math.pow(1.1,Oe-1.4144271570014144+1)-1)/(1.1-1)-1)},mt=He=>{if(He.zoom<de)return!0;if(He.zoom===pe)return!1;if(null!=He.shouldSplit)return He.shouldSplit;const nt=He.aabb.distanceX(Q),Oe=He.aabb.distanceY(Q);let _t=Ke,gt=1;if(j){_t=He.aabb.distanceZ(Q);const Un=Math.pow(2,He.zoom),or=f.az((He.y+1)/Un),Kn=f.az(He.y/Un),Si=Math.min(Math.max(P,or),Kn),wr=f.b6(Si)/f.b6(P);if(gt=Si===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,wr/this._mercatorScaleRatio),this.zoom<=f.b3&&He.zoom===pe-1&&wr>=.9)return!0}else if(C&&(_t=He.aabb.distanceZ(Q)*re),this.projection.isReprojectedInTileSpace&&v<=5){const Un=Math.pow(2,He.zoom),or=De(new f._((He.x+.5)/Un,(He.y+.5)/Un));gt=or>.85?1:or}if(!M){const Un=Math.sqrt(nt*nt+Oe*Oe+_t*_t);let or=(1<<pe-He.zoom)*ce*gt;return or*=pt(Math.max(_t,Ke),Un),Un<or}let Wt=Number.MAX_VALUE,Vt=0;const bt=He.aabb.getCorners(),Qt=[];for(const Un of bt){f.$.sub(Qt,Un,Q),j||(C?Qt[2]*=re:Qt[2]=Ke);const or=f.$.dot(Qt,this._camera.forward());or<Wt&&(Wt=or,Vt=Math.abs(Qt[2]))}let Pn=(1<<pe-He.zoom)*ce*gt;if(Pn*=pt(Math.max(Vt,Ke),Wt),Wt<Pn)return!0;const Yn=He.aabb.closestPoint(z);return Yn[0]===z[0]&&Yn[1]===z[1]};if(this.renderWorldCopies)for(let He=1;He<=3;He++)Be.push(Ee(-He)),Be.push(Ee(He));for(Be.push(Ee(0));Be.length>0;){const He=Be.pop(),nt=He.x,Oe=He.y;let _t=He.fullyVisible;const gt=()=>"globe"===this.projection.name&&(0===He.y||He.y===(1<<He.zoom)-1);if(!_t){let Wt=se?He.aabb.intersects(Z):He.aabb.intersectsFlat(Z);if(0===Wt&&gt()){const Vt=new f.aO(He.zoom,nt,Oe);Wt=f.aP(this,F,Vt,!0).intersects(Z)}if(0===Wt)continue;_t=2===Wt}if(He.zoom!==pe&&mt(He))for(let Wt=0;Wt<4;Wt++){const Vt=(nt<<1)+Wt%2,bt=(Oe<<1)+(Wt>>1),Qt={aabb:M?He.aabb.quadrant(Wt):f.aR(this,F,He.zoom+1,Vt,bt,He.wrap,He.minZ,He.maxZ,this.projection),zoom:He.zoom+1,x:Vt,y:bt,wrap:He.wrap,fullyVisible:_t,tileID:void 0,shouldSplit:void 0,minZ:He.minZ,maxZ:He.maxZ};C&&!j&&(Qt.tileID=new f.aQ(He.zoom+1===pe?Je:He.zoom+1,He.wrap,He.zoom+1,Vt,bt),Pe(Qt)),Be.push(Qt)}else{const Wt=He.zoom===pe?Je:He.zoom;if(c.minzoom&&c.minzoom>Wt)continue;let Vt=0;if(!_t){let Yn=se?He.aabb.intersectsPrecise(Z):He.aabb.intersectsPreciseFlat(Z);if(0===Yn&&gt()){const Un=new f.aO(He.zoom,nt,Oe);Yn=f.aP(this,F,Un,!0).intersectsPrecise(Z)}if(0===Yn)continue;if(c.calculateQuadrantVisibility)if(Z.containsPoint(He.aabb.center))Vt=15;else for(let Un=0;Un<4;Un++)0!==He.aabb.quadrant(Un).intersects(Z)&&(Vt|=1<<Un)}const bt=z[0]-(.5+nt+(He.wrap<<He.zoom))*(1<<p-He.zoom),Qt=z[1]-.5-Oe,Pn=He.tileID?He.tileID:new f.aQ(Wt,He.wrap,He.zoom,nt,Oe);c.calculateQuadrantVisibility&&(Pn.visibleQuadrants=Vt),ke.push({tileID:Pn,distanceSq:bt*bt+Qt*Qt})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,nt=this.horizonLineFromTop();ke=ke.filter(Oe=>{const _t=[0,0,0,1],gt=[f.a4,f.a4,0,1],Wt=this.calculateFogTileMatrix(Oe.tileID.toUnwrapped());f.aB.transformMat4(_t,_t,Wt),f.aB.transformMat4(gt,gt,Wt);const Vt=f.aB.min([],_t,gt),bt=f.aB.max([],_t,gt),Qt=f.aS(Vt,bt);if(0===Qt)return!0;let Pn=!1;const Yn=this._elevation;if(Yn&&Qt>He&&0!==nt){const Un=this.calculateProjMatrix(Oe.tileID.toUnwrapped());let or;c.isTerrainDEM||(or=Yn.getMinMaxForTile(Oe.tileID)),or||(or={min:_e,max:be});const Kn=f.b4(this.rotation),Si=[Kn[0]*f.a4,Kn[1]*f.a4,or.max];f.$.transformMat4(Si,Si,Un),Pn=(1-Si[1])*this.height*.5<nt}return Qt<He||Pn})}return ke.sort((He,nt)=>He.distanceSq-nt.distanceSq).map(He=>He.tileID)}resize(c,p){this.width=c,this.height=p,this.pixelsToGLUnits=[2/c,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const p=f.au(c.lat,-f.aT,f.aT),v=this.projection.project(c.lng,p);return new f.P(v.x*this.worldSize,v.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/f.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,p){let v,w;const C=this.centerPoint;if("globe"===this.projection.name){const I=this.worldSize;v=(p.x-C.x)/I,w=(p.y-C.y)/I}else{const I=this.pointCoordinate(p),P=this.pointCoordinate(C);v=I.x-P.x,w=I.y-P.y}const M=this.locationCoordinate(c);this.setLocation(new f._(M.x-v,M.y-w))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,p){const v=p?f.ay(p,c.lat):void 0,w=this.projection.project(c.lng,c.lat);return new f._(w.x,w.y,v)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,p){const v=p??this._centerAltitude,w=[c.x,c.y,0,1],C=[c.x,c.y,1,1];f.aB.transformMat4(w,w,this.pixelMatrixInverse),f.aB.transformMat4(C,C,this.pixelMatrixInverse);const M=C[3];f.aB.scale(w,w,1/w[3]),f.aB.scale(C,C,1/M);const I=w[2],P=C[2];return{p0:w,p1:C,t:I===P?0:(v-I)/(P-I)}}screenPointToMercatorRay(c){const p=[c.x,c.y,0,1],v=[c.x,c.y,1,1];return f.aB.transformMat4(p,p,this.pixelMatrixInverse),f.aB.transformMat4(v,v,this.pixelMatrixInverse),f.aB.scale(p,p,1/p[3]),f.aB.scale(v,v,1/v[3]),p[2]=f.ay(p[2],this._center.lat)*this.worldSize,v[2]=f.ay(v[2],this._center.lat)*this.worldSize,f.aB.scale(p,p,1/this.worldSize),f.aB.scale(v,v,1/this.worldSize),new f.aU([p[0],p[1],p[2]],f.$.normalize([],f.$.sub([],v,p)))}rayIntersectionCoordinate(c){const{p0:p,p1:v,t:w}=c,C=f.ay(p[2],this._center.lat),M=f.ay(v[2],this._center.lat);return new f._(f.a3(p[0],v[0],w)/this.worldSize,f.a3(p[1],v[1],w)/this.worldSize,f.a3(C,M,w))}pointCoordinate(c,p=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,p)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let p=this.projection.pointCoordinate3D(this,c.x,c.y);if(p)return new f._(p[0],p[1],p[2]);let v=0,w=this.horizonLineFromTop();if(c.y>w)return this.pointCoordinate(c);const C=.02*w,M=c.clone();for(let I=0;I<10&&w-v>C;I++){M.y=f.a3(v,w,.66);const P=this.projection.pointCoordinate3D(this,M.x,M.y);P?(w=M.y,p=P):v=M.y}return p?new f._(p[0],p[1],p[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=f.aV)return!this.isPointAboveHorizon(c);const p=this.pointCoordinate(c);return p.y>=0&&p.y<=1}_coordinatePoint(c,p){const v=p&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,w=[c.x*this.worldSize,c.y*this.worldSize,v+c.toAltitude(),1];return f.aB.transformMat4(w,w,this.pixelMatrix),w[3]>0?new f.P(w[0]/w[3],w[1]/w[3]):new f.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:p}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,C=this.pointLocation3D(new f.P(p,c)),M=this.pointLocation3D(new f.P(w,c)),I=this.pointLocation3D(new f.P(w,v)),P=this.pointLocation3D(new f.P(p,v));let F=Math.min(C.lng,M.lng,I.lng,P.lng),z=Math.max(C.lng,M.lng,I.lng,P.lng),j=Math.min(C.lat,M.lat,I.lat,P.lat),q=Math.max(C.lat,M.lat,I.lat,P.lat);const Z=Math.pow(2,-this.zoom)/16*270,ne="globe"===this.projection.name?1:4,re=(ie,Q,se,ce,de)=>{const be=(ie+se)/2,_e=(Q+ce)/2,ye=new f.P(be,_e),{lng:De,lat:Ee}=this.pointLocation3D(ye),Be=Math.max(0,F-De,j-Ee,De-z,Ee-q);F=Math.min(F,De),z=Math.max(z,De),j=Math.min(j,Ee),q=Math.max(q,Ee),(de<ne||Be>Z)&&(re(ie,Q,be,_e,de+1),re(be,_e,se,ce,de+1))};if(re(p,c,w,c,1),re(w,c,w,v,1),re(w,v,p,v,1),re(p,v,p,c,1),"globe"===this.projection.name){const[ie,Q]=f.aW(this);ie?(q=90,z=180,F=-180):Q&&(j=-90,z=180,F=-180)}return new f.aj(new f.aJ(F,j),new f.aJ(z,q))}_getBoundsRectangular(c,p){const{top:v,left:w}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,I=new f.P(w,v),P=new f.P(M,v),F=new f.P(M,C),z=new f.P(w,C);let j=this.pointCoordinate(I,c),q=this.pointCoordinate(P,c);const Z=this.pointCoordinate(F,p),ne=this.pointCoordinate(z,p),re=(ie,Q)=>(Q.y-ie.y)/(Q.x-ie.x);return j.y>1&&q.y>=0?j=new f._((1-ne.y)/re(ne,j)+ne.x,1):j.y<0&&q.y<=1&&(j=new f._(-ne.y/re(ne,j)+ne.x,0)),q.y>1&&j.y>=0?q=new f._((1-Z.y)/re(Z,q)+Z.x,1):q.y<0&&j.y<=1&&(q=new f._(-Z.y/re(Z,q)+Z.x,0)),(new f.aj).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const p=c.visibleDemTiles.reduce((v,w)=>{if(w.dem){const C=w.dem.tree;v.min=Math.min(v.min,C.minimums[0]),v.max=Math.max(v.max,C.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(p.min*c.exaggeration(),p.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,v=this.height/2-p*(1-this._horizonShift);return c?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-f.aT,this.maxLat=f.aT,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.ak(this.minLng)*this.tileSize,this.worldMaxX=f.ak(this.maxLng)*this.tileSize,this.worldMinY=f.al(this.maxLat)*this.tileSize,this.worldMaxY=f.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,p){return this.projection.createTileMatrix(this,p,c)}calculateDistanceTileData(c){const p=c.key,v=this._distanceTileDataCache;if(v[p])return v[p];const w=c.canonical,C=1/this.height,M=this.cameraWorldSize,I=M/this.zoomScale(w.z),P=(w.x+Math.pow(2,w.z)*c.wrap)*I,F=w.y*I,z=this.point;z.x*=M/this.worldSize,z.y*=M/this.worldSize;const j=this.angle,q=Math.sin(-j),Z=-Math.cos(-j);return v[p]={bearing:[q,Z],center:[(z.x-P)*C,(z.y-F)*C],scale:I/f.a4*C},v[p]}calculateFogTileMatrix(c){const p=c.key,v=this._fogTileMatrixCache;if(v[p])return v[p];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return f.ae.multiply(w,this.worldToFogMatrix,w),v[p]=new Float32Array(w),v[p]}calculateProjMatrix(c,p=!1,v=!1){const w=c.key;let C;if(C=v?this._expandedProjMatrixCache:p?this._alignedProjMatrixCache:this._projMatrixCache,C[w])return C[w];const M=this.calculatePosMatrix(c,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:v?this.expandedFarZProjMatrix:p?this.alignedProjMatrix:this.projMatrix,f.ae.multiply(M,I,M),C[w]=new Float32Array(M),C[w]}calculatePixelsToTileUnitsMatrix(c){const p=c.tileID.key,v=this._pixelsToTileUnitsCache;if(v[p])return v[p];const w=f.aX(c,this);return v[p]=w,v[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,p=f.ae.fromScaling([],[c,c,c]);return f.ae.multiply(p,p,this.globeMatrix),p}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const p=f.ay(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(p),w=this._camera.forward(),C=f.ay(1,this._center.lat);v[2]/=C,w[2]/=C,f.$.normalize(w,w);const M=c.raycast(v,w,c.exaggeration());if(M){const I=f.$.scaleAndAdd([],v,w,M),P=new f._(I[0],I[1],f.ay(I[2],f.az(I[1]))),F=(P.z+f.$.length([P.x-v[0],P.y-v[1],P.z-v[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const p=this._elevation,v=f.ay(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),C=p.getAtPointOrZero(new f._(...w)),M=this.pixelsPerMeter/this.worldSize*C,I=this._minimumHeightOverTerrain(),P=w[2]-M;if(P<=I)if(P<0||c){const F=this.locationCoordinate(this._center,this._centerAltitude),z=[w[0],w[1],F.z-w[2]],j=f.$.length(z);z[2]-=(I-P)/this._pixelsPerMercatorPixel;const q=f.$.length(z);if(0===q)return;f.$.scale(z,z,j/q*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],F.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const q=this.center;return q.lat=f.au(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(q.lng=f.au(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const p=this._unmodified,{x:v,y:w}=this.point;let C=0,M=v,I=w;const P=this.width/2,F=this.height/2,z=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(w-F<z&&(I=z+F),w+F>j&&(I=j-F),j-z<this.height&&(C=Math.max(C,this.height/(j-z)),I=(j+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,ne=this.worldSize/2-(q+Z)/2;M=(v+ne+this.worldSize)%this.worldSize-ne,M-P<q&&(M=q+P),M+P>Z&&(M=Z-P),Z-q<this.width&&(C=Math.max(C,this.width/(Z-q)),M=(Z+q)/2)}M===v&&I===w||(this.center=this.unproject(new f.P(M,I))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,p="globe"===this.projection.name,v=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=f.ay(1,this.center.lat)/f.ay(1,f.b5));const w=f.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C="meters"===this.projection.zAxisUnit?v:1,M=this._camera.getWorldToCamera(this.worldSize,C);let I;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-c.x/this.width,P[9]=2*c.y/this.height,this.isOrthographic){let Ee=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Be=Ee*this.aspect,ke=-Be,pe=-Ee;Be-=c.x,ke-=c.x,Ee+=c.y,pe+=c.y,I=this._camera.getCameraToClipOrthographic(ke,Be,pe,Ee,this._nearZ,this._farZ),((Je,Ke,Pe,pt)=>{for(let mt=0;mt<16;mt++)Je[mt]=Gg(Ke[mt],Pe[mt],pt)})(I,I,P,mm(this.pitch>=15?1:this.pitch/15))}else I=P;const F=f.ae.mul([],P,M);let z=f.ae.mul([],I,M);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),Be=f.ae.identity([]);f.ae.translate(Be,Be,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),f.ae.multiply(Be,Be,f.aZ(this)),f.ae.translate(Be,Be,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),f.ae.multiply(z,z,Be),f.ae.multiply(F,F,Be),this.inverseAdjustmentMatrix=f.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=f.ae.scale([],z,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=z,this.invProjMatrix=f.ae.invert(new Float64Array(16),this.projMatrix),p){const Ee=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ee[8]=2*-c.x/this.width,Ee[9]=2*c.y/this.height,this.expandedFarZProjMatrix=f.ae.mul([],Ee,M)}else this.expandedFarZProjMatrix=this.projMatrix;const j=f.ae.invert([],I);this.frustumCorners=f.a$.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=f.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!p);const q=new Float32Array(16);f.ae.identity(q),f.ae.scale(q,q,[1,-1,1]),f.ae.rotateX(q,q,this._pitch),f.ae.rotateZ(q,q,this.angle);const Z=f.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=f.ae.clone(Z);const ne=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Z[8]=2*-c.x/this.width,Z[9]=2*(c.y+ne)/this.height,this.skyboxMatrix=f.ae.multiply(q,Z,q);const re=this.point,ie=re.x,Q=re.y,se=this.width%2/2,ce=this.height%2/2,de=Math.cos(this.angle),be=Math.sin(this.angle),_e=ie-Math.round(ie)+de*se+be*ce,ye=Q-Math.round(Q)+de*ce+be*se,De=new Float64Array(z);if(f.ae.translate(De,De,[_e>.5?_e-1:_e,ye>.5?ye-1:ye,0]),this.alignedProjMatrix=De,z=f.ae.create(),f.ae.scale(z,z,[this.width/2,-this.height/2,1]),f.ae.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=f.ae.create(),f.ae.scale(z,z,[1,-1,1]),f.ae.translate(z,z,[-1,-1,0]),f.ae.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=f.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,F),this._calcFogMatrices(),this._distanceTileDataCache={},z=f.ae.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=f.b0(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=f.$.transformMat4(Ee,Ee,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,p=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,C=[c,c,p];f.$.scale(C,C,w),f.$.scale(v,v,-1),f.$.multiply(v,v,C);const M=f.ae.create();f.ae.translate(M,M,v),f.ae.scale(M,M,C),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,p,w)}_computeCameraPosition(c){const p=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-c/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*C,w.y/this.worldSize-v[1]*C,c/this.worldSize*this._centerAltitude-v[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=c[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(C=Math.min((p-v)/w,1)),this._camera.position=f.$.scaleAndAdd([],this._camera.position,c,C),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,p=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),C=f.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.ac(this._maxPitch)),I=Math.max((c[2]-C)/Math.cos(v),M),P=this._zoomFromMercatorZ(I);f.$.scaleAndAdd(c,c,p,I),this._pitch=f.au(v,f.ac(this.minPitch),f.ac(this.maxPitch)),this.angle=f.av(w,-Math.PI,Math.PI),this._setZoom(f.au(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f._(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let p=0,v=f.aV,w=0,C=1/0;for(;v-p>1e-6&&v>p;){const M=p+.5*(v-p),I=this.tileSize*Math.pow(2,M),P=this.getCameraToCenterDistance(this.projection,M,I),F=this.scaleZoom(P/(c*this.tileSize)),z=Math.abs(M-F);z<C&&(C=z,w=M),M<F?p=M:v=M}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,p){const v=Math.min(c.x,p.x),w=Math.max(c.x,p.x),C=Math.min(c.y,p.y),M=Math.max(c.y,p.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const I=[new f.P(v,C),new f.P(w,M),new f.P(v,M),new f.P(w,C)],P=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const z of I){const j=this.pointRayIntersection(z);if(j.t<0)return!0;const q=this.rayIntersectionCoordinate(j);if(q.x<P||q.y<0||q.x>F||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.P(0,0),new f.P(this.width,this.height))}zoomDeltaToMovement(c,p){const v=f.$.length(f.$.sub([],this._camera.position,c)),w=this._zoomFromMercatorZ(v)+p;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const c=function([p,v,w],C){const M=[p,v,w,1];f.aB.transformMat4(M,M,C);const I=M[3]=Math.max(M[3],1e-6);return M[0]/=I,M[1]/=I,M[2]/=I,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new f.P(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.P(0,c))}}getCameraToCenterDistance(c,p=this.zoom,v=this.worldSize){const w=f.aY(c,p,this.width,this.height,1024),C=c.pixelSpaceConversion(this.center.lat,v,w);let M=.5/Math.tan(.5*this._fov)*this.height*C;return this.isOrthographic&&(M=Gg(1,M,mm(this.pitch>=15?1:this.pitch/15))),M}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&f.ae.multiply(c,c,this.globeMatrix),c}getFrustum(c){return f.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,"meters"===this.projection.zAxisUnit)}}const _o={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Ra=(y,c)=>{if(c>0&&y.terrain&&f.w("Cutoff is currently disabled on terrain"),c<=0||y.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const p=y.transform,v=Math.max(Math.abs(p._zoom-(y.minCutoffZoom-1)),1),w=p.isLODDisabled(!1)?f.a0(60,45,p.pitch):f.a0(30,15,p.pitch),C=p._farZ-p._nearZ,M=c*p.height,I=((1-(P=w))*p.cameraToCenterDistance+P*(p._farZ+M))*v;var P;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[p._nearZ,p._farZ,(I-p._nearZ)/C,(I-M-p._nearZ)/C]}}},Ho={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class ks{constructor(c,p){this.aabb=c,this.lastCascade=p}}class fh{add(c,p){const v=this.receivers[c.key];void 0!==v?(v.aabb.min[0]=Math.min(v.aabb.min[0],p.min[0]),v.aabb.min[1]=Math.min(v.aabb.min[1],p.min[1]),v.aabb.min[2]=Math.min(v.aabb.min[2],p.min[2]),v.aabb.max[0]=Math.max(v.aabb.max[0],p.max[0]),v.aabb.max[1]=Math.max(v.aabb.max[1],p.max[1]),v.aabb.max[2]=Math.max(v.aabb.max[2],p.max[2])):this.receivers[c.key]=new ks(p,null)}clear(){this.receivers={}}get(c){return this.receivers[c.key]}computeRequiredCascades(c,p,v){const w=f.b8.fromPoints(c.points);let C=0;for(const M in this.receivers){const I=this.receivers[M];if(!I||!w.intersectsAabb(I.aabb))continue;I.aabb.min=w.closestPoint(I.aabb.min),I.aabb.max=w.closestPoint(I.aabb.max);const P=I.aabb.getCorners();for(let F=0;F<v.length;F++){let z=!0;for(const j of P){const q=[j[0]*p,j[1]*p,j[2]];if(f.$.transformMat4(q,q,v[F].matrix),q[0]<-1||q[0]>1||q[1]<-1||q[1]>1){z=!1;break}}if(I.lastCascade=F,C=Math.max(C,F),z)break}}return C+1}}class Z_{constructor(c){this.painter=c,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new fh,this._depthMode=new f.af(c.context.gl.LEQUAL,f.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,c.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),c.tp.registerParameter(Ho,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),c.tp.registerParameter(Ho,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),c.tp.registerParameter(Ho,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),c.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const c of this._cascades)c.texture.destroy(),c.framebuffer.destroy();this._cascades=[]}updateShadowParameters(c,p){const v=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!p||!p.properties)return;const w=p.properties.get("shadow-intensity");if(!p.shadowsEnabled()||w<=0||(this._shadowLayerCount=v.style.order.reduce((ne,re)=>{const ie=v.style._mergedLayers[re];return ne+(ie.hasShadowPass()&&!ie.isHidden(c.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const C=v.context,M=Ho.shadowMapResolution,I=Ho.shadowMapResolution;if(0===this._cascades.length||Ho.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ne=0;ne<Ho.cascadeCount;++ne){const re=v._shadowMapDebug,ie=C.gl,Q=C.createFramebuffer(M,I,re,"texture"),se=new f.T(C,{width:M,height:I,data:null},ie.DEPTH_COMPONENT);if(Q.depthAttachment.set(se.texture),re){const ce=new f.T(C,{width:M,height:I,data:null},ie.RGBA);Q.colorAttachment.set(ce.texture)}this._cascades.push({framebuffer:Q,texture:se,matrix:[],far:0,boundingSphereRadius:0,frustum:new f.aM,scale:0})}}this.shadowDirection=gm(p);let P=0;if(c.elevation){const ne=c.elevation,re=[1e4,-1e4];ne.visibleDemTiles.filter(ie=>ie.dem).forEach(ie=>{const Q=ie.dem.tree;re[0]=Math.min(re[0],Q.minimums[0]),re[1]=Math.max(re[1],Q.maximums[0])}),1e4!==re[0]&&(P=(re[1]-re[0])*ne.exaggeration())}const F=1.5*c.cameraToCenterDistance,z=3*F,j=new Float64Array(16);for(let ne=0;ne<this._cascades.length;++ne){const re=this._cascades[ne];let ie=c.height/50,Q=1;1===Ho.cascadeCount?Q=z:0===ne?Q=F:(ie=F,Q=z);const[se,ce]=Rv(c,this.shadowDirection,ie,Q,Ho.shadowMapResolution,P);re.scale=c.scale,re.matrix=se,re.boundingSphereRadius=ce,f.ae.invert(j,re.matrix),re.frustum=f.aM.fromInvProjectionMatrix(j,1,0,!0),re.far=Q}const q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[q].far,this._cascades[q].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ho.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ho.shadowMapResolution,this._uniformValues.u_shadowmap_0=_o.ShadowMap0,this._uniformValues.u_shadowmap_1=_o.ShadowMap0+1,this._groundShadowTiles=v.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Z=v.transform.elevation;for(const ne of this._groundShadowTiles){let re={min:0,max:0};if(Z){const ie=Z.getMinMaxForTile(ne);ie&&(re=ie)}this.addShadowReceiver(ne.toUnwrapped(),re.min,re.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(c){this._enabled=c}drawShadowPass(c,p){if(!this.enabled)return;const v=this.painter,w=v.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(v.transform.getFrustum(0),v.transform.worldSize,this._cascades),w.viewport.set([0,0,Ho.shadowMapResolution,Ho.shadowMapResolution]);for(let C=0;C<this._numCascadesToRender;++C){v.currentShadowCascade=C,w.bindFramebuffer.set(this._cascades[C].framebuffer.framebuffer),w.clear({color:f.C.white,depth:1});for(const M of c.order){const I=c._mergedLayers[M];if(!I.hasShadowPass()||I.isHidden(v.transform.zoom))continue;const P=c.getLayerSourceCache(I),F=P?p[P.id]:void 0;("model"===I.type||F&&F.length)&&v.renderLayer(v,P,I,F)}}v.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const c=this.painter,p=c.style,v=c.context,w=p.directionalLight,C=p.ambientLight;if(!w||!C)return;const M=[],I=Ra(c,c.longestCutoffRange);I.shouldRenderCutoff&&M.push("RENDER_CUTOFF");const P=_m(p,w,C),F=new f.af(v.gl.LEQUAL,f.af.ReadOnly,c.depthRangeFor3D);for(const z of this._groundShadowTiles){const j=z.toUnwrapped(),q=c.isTileAffectedByFog(z),Z=c.getOrCreateProgram("groundShadow",{defines:M,overrideFog:q});this.setupShadows(j,Z),c.uploadCommonUniforms(v,Z,j,null,I);const ne={u_matrix:c.transform.calculateProjMatrix(j),u_ground_shadow_factor:P};Z.draw(c,v.gl.TRIANGLES,F,f.ah.disabled,f.a.multiply,f.ag.disabled,ne,"ground_shadow",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments,{},c.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?f.a.unblended:f.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(c){const p=this.painter.transform,v=p.calculatePosMatrix(c,p.worldSize);return f.ae.multiply(v,this._cascades[this.painter.currentShadowCascade].matrix,v),Float32Array.from(v)}calculateShadowPassMatrixFromMatrix(c){return f.ae.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}setupShadows(c,p,v,w=0){if(!this.enabled)return;const C=this.painter.transform,M=this.painter.context,I=M.gl,P=this._uniformValues,F=new Float64Array(16),z=C.calculatePosMatrix(c,C.worldSize);for(let j=0;j<this._cascades.length;j++)f.ae.multiply(F,this._cascades[j].matrix,z),P[0===j?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(F),M.activeTexture.set(I.TEXTURE0+_o.ShadowMap0+j),this._cascades[j].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!v,this.useNormalOffset){const j=f.b7(c.canonical),q=2/C.tileSize*f.a4/Ho.shadowMapResolution,Z=q*this._cascades[0].boundingSphereRadius,ne=q*this._cascades[this._cascades.length-1].boundingSphereRadius,re=("vector-tile"===v?1:3)/Math.pow(2,w-c.canonical.z-(1-C.zoom+Math.floor(C.zoom)));P.u_shadow_normal_offset=[j,Z*re,ne*re],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(M,P)}setupShadowsFromMatrix(c,p,v=!1){if(!this.enabled)return;const w=this.painter.context,C=w.gl,M=this._uniformValues,I=new Float64Array(16);for(let P=0;P<Ho.cascadeCount;P++)f.ae.multiply(I,this._cascades[P].matrix,c),M[0===P?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),w.activeTexture.set(C.TEXTURE0+_o.ShadowMap0+P),this._cascades[P].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=v,v){const P=Ho.normalOffset;M.u_shadow_normal_offset=[1,P,P],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(w,M)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(c,p,v,w){if(w[2]>=0)return{};const C=function(P,F,z){const j=z/(1<<P.canonical.z);return new f.b8([P.canonical.x*j+P.wrap*z,P.canonical.y*j+P.wrap*z,0],[(P.canonical.x+1)*j+P.wrap*z,(P.canonical.y+1)*j+P.wrap*z,F])}(c,p,v).getCorners(),M=p/-w[2];w[0]<0?(f.$.add(C[0],C[0],[w[0]*M,0,0]),f.$.add(C[3],C[3],[w[0]*M,0,0])):w[0]>0&&(f.$.add(C[1],C[1],[w[0]*M,0,0]),f.$.add(C[2],C[2],[w[0]*M,0,0])),w[1]<0?(f.$.add(C[0],C[0],[0,w[1]*M,0]),f.$.add(C[1],C[1],[0,w[1]*M,0])):w[1]>0&&(f.$.add(C[2],C[2],[0,w[1]*M,0]),f.$.add(C[3],C[3],[0,w[1]*M,0]));const I={};return I.vertices=C,I.planes=[Of(C[1],C[0],C[4]),Of(C[2],C[1],C[5]),Of(C[3],C[2],C[6]),Of(C[0],C[3],C[7])],I}addShadowReceiver(c,p,v){this._receivers.add(c,f.b8.fromTileIdAndHeight(c,p,v))}getMaxCascadeForTile(c){const p=this._receivers.get(c);return p&&p.lastCascade?p.lastCascade:0}}function Of(y,c,p){const v=f.$.sub([],p,c),w=f.$.sub([],y,c),C=f.$.cross([],v,w),M=f.$.length(C);return 0===M?[0,0,1,0]:(f.$.scale(C,C,1/M),[C[0],C[1],C[2],-f.$.dot(C,c)])}function gm(y){const c=y.properties.get("direction"),p=f.ad(c.x,c.y,c.z);p[2]=f.au(p[2],0,75);const v=f.b9([p[0],p[1],p[2]]);return f.$.fromValues(v.x,v.y,v.z)}function _m(y,c,p){const v=c.properties.get("color"),w=c.properties.get("intensity"),C=c.properties.get("direction"),M=[C.x,C.y,C.z],I=p.properties.get("color"),P=p.properties.get("intensity"),F=Math.max(f.$.dot([0,0,1],M),0),z=[0,0,0];f.$.scale(z,I.toRenderColor(y.getLut(c.scope)).toArray01Linear().slice(0,3),P);const j=[0,0,0];return f.$.scale(j,v.toRenderColor(y.getLut(p.scope)).toArray01Linear().slice(0,3),F*w),f.ba([z[0]>0?z[0]/(z[0]+j[0]):0,z[1]>0?z[1]/(z[1]+j[1]):0,z[2]>0?z[2]/(z[2]+j[2]):0])}function Rv(y,c,p,v,w,C){const M=y.zoom,I=y.scale,P=y.worldSize,F=1/P,z=y.aspect,j=Math.sqrt(1+z*z)*Math.tan(.5*y.fovX),q=j*j,Z=v-p,ne=v+p;let re,ie;q>Z/ne?(re=v,ie=v*j):(re=.5*ne*(1+q),ie=.5*Math.sqrt(Z*Z+2*(v*v+p*p)*q+ne*ne*q*q));const Q=y.projection.pixelsPerMeter(y.center.lat,P),se=y._camera.getCameraToWorldMercator(),ce=[0,0,-re*F];f.$.transformMat4(ce,ce,se);let de=ie*F;const be=y._edgeInsets;if(!(0===be.left&&0===be.top&&0===be.right&&0===be.bottom||be.left===be.right&&be.top===be.bottom)){const _t=y._camera.getWorldToCamera(y.worldSize,"meters"===y.projection.zAxisUnit?Q:1),gt=y._camera.getCameraToClipPerspective(y._fov,y.width/y.height,p,v);gt[8]=2*-y.centerOffset.x/y.width,gt[9]=2*y.centerOffset.y/y.height;const Wt=new Float64Array(16);f.ae.mul(Wt,gt,_t);const Vt=new Float64Array(16);f.ae.invert(Vt,Wt);const bt=f.aM.fromInvProjectionMatrix(Vt,P,M,!0);for(const Qt of bt.points){const Pn=((_e=Qt)[0]/=I,_e[1]/=I,_e[2]=f.ay(_e[2],y._center.lat),_e);de=Math.max(de,f.$.len(f.$.subtract([],ce,Pn)))}}var _e;de*=w/(w-1);const ye=Math.acos(c[2]),De=Math.atan2(-c[0],-c[1]),Ee=new Cd;Ee.position=ce,Ee.setPitchBearing(ye,De);const Be=Ee.getWorldToCamera(P,Q),ke=de*P,pe=Math.min(y._mercatorZfromZoom(17)*P*-2,-2*ke),Je=Ee.getCameraToClipOrthographic(-ke,ke,-ke,ke,pe,(ke+C*Q)/c[2]),Ke=new Float64Array(16);f.ae.multiply(Ke,Je,Be);const Pe=f.$.fromValues(Math.floor(1e6*ce[0])/1e6*P,Math.floor(1e6*ce[1])/1e6*P,0),pt=.5*w,mt=[0,0,0];f.$.transformMat4(mt,Pe,Ke),f.$.scale(mt,mt,pt);const He=[Math.floor(mt[0]),Math.floor(mt[1]),Math.floor(mt[2])],nt=[0,0,0];f.$.sub(nt,mt,He),f.$.scale(nt,nt,-1/pt);const Oe=new Float64Array(16);return f.ae.identity(Oe),f.ae.translate(Oe,Oe,nt),f.ae.multiply(Ke,Oe,Ke),[Ke,ke]}function Rf(y,c){return null!=y&&null!=c&&!(!y.hasData()||!c.hasData())&&null!=y.demTexture&&null!=c.demTexture&&y.tileID.key!==c.tileID.key}const ph=new class{constructor(){this.operations={}}newMorphing(y,c,p,v,w){if(y in this.operations){const C=this.operations[y];C.to.tileID.key!==p.tileID.key&&(C.queued=p)}else this.operations[y]={startTime:v,phase:0,duration:w,from:c,to:p,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const c=this.operations[y];return{from:c.from,to:c.to,phase:c.phase}}update(y){for(const c in this.operations){const p=this.operations[c];for(p.phase=(y-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,y)){delete this.operations[c];break}}}_nextOp(y,c){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=c,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},qg={0:null,1:"TERRAIN_VERTEX_MORPHING"};function mh(y,c,p){if(0===c)return 0;const v=c<1&&514===p?.25/c:1;return 6*Math.pow(1.5,22-y)*Math.max(c,1)*v}function Zg(y,c){const p=1<<y.z;return!c&&(0===y.x||y.x===p-1)||0===y.y||y.y===p-1}const ym=y=>({u_matrix:y});function X_(y,c,p,v,w){if(w>0){const C=f.e.now(),M=(C-y.timeAdded)/w,I=c?(C-c.timeAdded)/w:-1,P=p.getSource(),F=v.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),z=!c||Math.abs(c.tileID.overscaledZ-F)>Math.abs(y.tileID.overscaledZ-F),j=z&&y.refreshedUponExpiration?1:f.au(z?M:1-I,0,1);return y.refreshedUponExpiration&&M>=1&&(y.refreshedUponExpiration=!1),c?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class gh extends Ml{constructor(c,p,v,w){super(c,p,v,w),this.type="raster-array",this.maxzoom=22,this._options=f.Q({type:"raster-array"},p)}triggerRepaint(c){const p=this.map.painter._terrain,v=this.map.style.getSourceCache(this.id);p&&p.enabled&&v&&p._clearRenderCacheForTile(v.id,c.tileID),this.map.triggerRepaint()}loadTile(c,p){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(v,f.R.Tile);c.requestParams=w,c.actor||(c.actor=this.dispatcher.getActor()),c.request=c.fetchHeader(void 0,(C,M,I,P)=>(delete c.request,c.aborted?(c.state="unloaded",p(null)):C?20===C.code?void 0:(c.state="errored",p(C)):(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:I,expires:P}),c.state="empty",void p(null))))}unloadTile(c,p){const v=c.texture;v&&v instanceof f.T?(c.destroy(!0),this.map.painter.saveTileTexture(v)):(c.destroy(),c.flushQueues(),c._isHeaderLoaded=!1,delete c._mrt,delete c.textureDescriptor),c.fbo&&(c.fbo.destroy(),delete c.fbo),delete c.request,delete c.requestParams,delete c.neighboringTiles,c.state="unloaded"}prepareTile(c,p,v){c._isHeaderLoaded&&("empty"!==c.state&&(c.state="reloading"),c.fetchBand(p,v,(w,C)=>{if(w)return c.state="errored",this.fire(new f.f(w)),void this.triggerRepaint(c);C&&(c.setTexture(C,this.map.painter),c.state="loaded",this.triggerRepaint(c))}))}getInitialBand(c){if(!this.rasterLayers)return 0;const p=this.rasterLayers.find(({id:C})=>C===c),v=p&&p.fields,w=v&&v.bands&&v.bands;return w?w[0]:0}getTextureDescriptor(c,p,v){if(!c)return;const w=p.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!w)return;let C=null;p instanceof f.bm?C=p.paint.get("raster-array-band"):p instanceof f.bn&&(C=p.paint.get("raster-particle-array-band"));const M=C||this.getInitialBand(w);if(null!=M)if(c.textureDescriptor){if(!c.updateNeeded(w,M)||v)return Object.assign({},c.textureDescriptor,{texture:c.texture})}else this.prepareTile(c,w,M)}}const Xg={vector:kv,raster:Ml,"raster-dem":class extends Ml{constructor(y,c,p,v){super(y,c,p,v),this.type="raster-dem",this.maxzoom=22,this._options=f.Q({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(y,c){const p=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,C){w&&(y.state="errored",c(w)),C&&(y.dem=C,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",c(null))}y.request=f.i(this.map._requestManager.transformRequest(p,f.R.Tile),function(w,C,M,I){if(delete y.request,y.aborted)y.state="unloaded",c(null);else if(w)y.state="errored",c(w);else if(C){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:M,expires:I});const P=ImageBitmap&&C instanceof ImageBitmap&&f.bk(),F=1-(C.width-f.bl(C.width))/2;F<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const z=P?C:f.e.getImageData(C,F),j={uid:y.uid,coord:y.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:F};y.actor&&"expired"!==y.state||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",j,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(y){const c=y.canonical,p=Math.pow(2,c.z),v=(c.x-1+p)%p,w=0===c.x?y.wrap-1:y.wrap,C=(c.x+1+p)%p,M=c.x+1===p?y.wrap+1:y.wrap,I={};return I[new f.aQ(y.overscaledZ,w,c.z,v,c.y).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,M,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(I[new f.aQ(y.overscaledZ,w,c.z,v,c.y-1).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,y.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,M,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<p&&(I[new f.aQ(y.overscaledZ,w,c.z,v,c.y+1).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,y.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},I[new f.aQ(y.overscaledZ,M,c.z,C,c.y+1).key]={backfilled:!1}),I}},"raster-array":gh,geojson:class extends f.E{constructor(y,c,p,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(v),this._data=c.data,this._options=f.Q({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),void 0!==c.minzoom&&(this.minzoom=c.minzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const w=f.a4/this.tileSize;this.workerOptions=f.Q({source:this.id,scope:this.scope,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*w,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*w,extent:f.a4,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:f.a4,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*w,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter,dynamic:c.dynamic},c.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}updateData(y){if(!this._options.dynamic)return this.fire(new f.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof y&&("Feature"===y.type&&(y={type:"FeatureCollection",features:[y]}),"FeatureCollection"!==y.type))return this.fire(new f.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof y&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const c=new Map;for(const p of this._data.features)c.set(p.id,p);for(const p of y.features)c.set(p.id,p);this._data.features=[...c.values()]}else this._data=y;return this._updateWorkerData(!0),this}getClusterExpansionZoom(y,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id,scope:this.scope},c),this}getClusterChildren(y,c){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id,scope:this.scope},c),this}getClusterLeaves(y,c,p,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:y,limit:c,offset:p},v),this}_updateWorkerData(y=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.g("dataloading",{dataType:"source"})),this._loaded=!1;const c=f.Q({append:y},this.workerOptions);c.scope=this.scope;const p=this._data;"string"==typeof p?(c.request=this.map._requestManager.transformRequest(f.e.resolveURL(p),f.R.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(p),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(v,w)=>{if(this._loaded=!0,this._pendingLoad=null,v)this.fire(new f.f(v));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(C.resourceTiming=w.resourceTiming[this.id]),y&&(this._partialReload=!0),this.fire(new f.g("data",C)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(y),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(y,c){const p=y.actor?"reloadTile":"loadTile";y.actor=this.actor;const v=this.map.style?this.map.style.getLut(this.scope):null,w=this._partialReload,C={type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v?{image:v.image.clone()}:null,scope:this.scope,pixelRatio:f.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:w};y.request=this.actor.send(p,C,(M,I)=>w&&!I?(y.state="loaded",c(null)):(delete y.request,y.destroy(),y.aborted?c(null):M?c(M):(y.loadVectorData(I,this.map.painter,"reloadTile"===p),c(null))),void 0,"loadTile"===p)}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y,c){this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id,scope:this.scope}),y.destroy()}onRemove(y){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends f.bo{constructor(y,c,p,v){super(y,c,p,v),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const c of y.urls)this.urls.push(this.map._requestManager.transformRequest(c,f.R.Source).url);f.bp(this.urls,(c,p)=>{this._loaded=!0,c?this.fire(new f.f(c)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const c=this.video.seekable;y<c.start(0)||y>c.end(0)?this.fire(new f.f(new f.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const y=this.map.painter.context,c=y.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new f.T(y,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:f.bo,model:class extends f.E{constructor(y,c,p,v){super(),this.id=y,this.type="model",this.models=[],this._loaded=!1,this._options=c}load(){const y=[];for(const c in this._options.models){const p=this._options.models[c],v=f.l(this.map._requestManager.transformRequest(p.uri,f.R.Model).url).then(w=>{if(!w)return;const C=f.c(w),M=new f.M(c,p.position,p.orientation,C);M.computeBoundsAndApplyParent(),this.models.push(M)}).catch(w=>{this.fire(new f.f(new Error(`Could not load model ${c} from ${p.uri}: ${w.message}`)))});y.push(v)}return Promise.allSettled(y).then(()=>{this._loaded=!0,this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this.fire(new f.f(new Error(`Could not load models: ${c.message}`)))})}onAdd(y){this.map=y,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(y,c){}serialize(){return{type:"model"}}},"batched-model":class extends f.E{constructor(y,c,p,v){super(),this.type="batched-model",this.id=y,this.tileSize=512,this._options=c,this.tiles=this._options.tiles,this.maxzoom=c.maxzoom||19,this.minzoom=c.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=p,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(v)}onAdd(y){this.map=y,this.load()}load(y){this._loaded=!1,this.fire(new f.g("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=G_(this._options,this.map._requestManager,c,p,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&2!==p.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new f.f(v))):w&&(f.Q(this,w),w.bounds&&(this.tileBounds=new dm(w.bounds,this.minzoom,this.maxzoom)),f.ao(w.tiles,this.map._requestManager._customAccessToken),this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))),y&&y(v)})}hasTransition(){return!1}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loaded(){return this._loaded}loadTile(y,c){const p=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(p,f.R.Tile),data:void 0,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,tileSize:this.tileSize*y.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:y.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(y.actor&&"expired"!==y.state)if("loading"===y.state)y.reloadCallback=c;else{if(y.buckets){const C=Object.values(y.buckets);for(const M of C)M.dirty=!0;return void(y.state="loaded")}y.request=y.actor.send("reloadTile",v,w.bind(this))}else y.actor=this.dispatcher.getActor(),y.request=y.actor.send("loadTile",v,w.bind(this),void 0,!0);function w(C,M){return y.aborted?c(null):C&&404!==C.status?c(C):(M&&(M.resourceTiming&&(y.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&y.setExpiryData(M),y.buckets={...y.buckets,...M.buckets},M.featureIndex&&(y.latestFeatureIndex=M.featureIndex)),y.state="loaded",void c(null))}}serialize(){return f.Q({},this._options)}},canvas:class extends f.bo{constructor(y,c,p,v){super(y,c,p,v),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(C=>"number"!=typeof C))||this.fire(new f.f(new f.V(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.f(new f.V(`sources.${y}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new f.f(new f.V(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof HTMLCanvasElement||this.fire(new f.f(new f.V(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.f(new f.V(`sources.${y}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(y){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?!y&&!this._playing||this.texture instanceof f.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.T(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends f.E{constructor(y,c,p,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=c,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new dm(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),f.Q(this,f.ai(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this.map=y,this._loaded=!1,this.fire(new f.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:c,y:p,z:v}=y.canonical;return this._implementation.hasTile({x:c,y:p,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,c){const{x:p,y:v,z:w}=y.tileID.canonical,C=new AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:p,y:v,z:w},{signal:C.signal})).then(function(M){return delete y.request,y.aborted?(y.state="unloaded",c(null)):void 0===M?(y.state="errored",c(null)):null===M?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",c(null)):(I=M)instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement?(this.loadTileData(y,M),y.state="loaded",void c(null)):(y.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var I}.bind(this)).catch(M=>{20!==M.code&&(y.state="errored",c(M))}),y.request.cancel=()=>C.abort()}loadTileData(y,c){y.setTexture(c,this.map.painter)}unloadTile(y,c){if(y.texture&&y.texture instanceof f.T?(y.destroy(!0),y.texture&&y.texture instanceof f.T&&this.map.painter.saveTileTexture(y.texture)):y.destroy(),this._implementation.unloadTile){const{x:p,y:v,z:w}=y.tileID.canonical;this._implementation.unloadTile({x:p,y:v,z:w})}c&&c()}abortTile(y,c){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),c&&c()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z}))}_clearTiles(){const y=f.am(this.id,this.scope);this.map.style.clearSource(y)}_update(){this.fire(new f.g("data",{dataType:"source",sourceDataType:"content"}))}}},Yg=function(y,c,p,v){const w=new Xg[c.type](y,c,p,v);if(w.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${w.id}`);return f.br(["load","abort","unload","serialize","prepare"],w),w};class Pv extends f.bx{constructor(c){const p={type:"raster-dem",maxzoom:c.transform.maxZoom},v=new f.by(f.bz(),null),w=Yg("mock-dem",p,v,c.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,p){c.state="loaded",p(null)}}class _h extends f.bx{constructor(c){const p=Yg("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new f.by(f.bz(),null),c.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,p,v){if(c.freezeTileCoverage)return;this.transform=c;const w=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,M)=>{if(C[M.key]="",!this._tiles[M.key]){const I=new f.bA(M,this._source.tileSize*M.overscaleFactor(),c.tileZoom);I.state="loaded",this._tiles[M.key]=I}return C},{});for(const C in this._tiles)C in w||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(c){const p=this.proxyCachedFBO[c];if(void 0!==p){const v=Object.values(p);this.renderCachePool.push(...v),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Nv extends f.aQ{constructor(c,p,v){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=p,this.projMatrix=v}}class aa extends f.bs{constructor(c,p){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},c.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,C]=function(P){const F=new f.bv,z=new f.bw,j=131;F.reserve(17161),z.reserve(33800);const q=f.a4/128,Z=f.a4+q/2,ne=Z+q;for(let ie=-q;ie<ne;ie+=q)for(let Q=-q;Q<ne;Q+=q){const se=Q<0||Q>Z||ie<0||ie>Z?24575:0,ce=f.au(Math.round(Q),0,f.a4),de=f.au(Math.round(ie),0,f.a4);F.emplaceBack(ce+se,de)}const re=(ie,Q)=>{const se=Q*j+ie;z.emplaceBack(se+1,se,se+j),z.emplaceBack(se+j,se+j+1,se+1)};for(let ie=1;ie<129;ie++)for(let Q=1;Q<129;Q++)re(Q,ie);return[0,129].forEach(ie=>{for(let Q=0;Q<130;Q++)re(Q,ie),re(ie,Q)}),[F,z,32768]}(),M=c.context;this.gridBuffer=M.createVertexBuffer(v,f.bt.members),this.gridIndexBuffer=M.createIndexBuffer(w),this.gridSegments=f.b.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=f.b.simpleSegment(0,0,v.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _h(p.map),this.orthoMatrix=f.ae.create(),f.ae.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,f.a4,0,f.a4,0,1);const I=M.gl;this._overlapStencilMode=new f.ah({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Pv(p.map),this._pendingGroundEffectLayers=[]}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),this._style=c,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,p,v){if(c&&c.terrain){this._style!==c&&(this.style=c,this._evaluationZoom=void 0);const w=c.terrain.properties,C=0===c.terrain.drapeRenderMode,M=c.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=f.e.now();const I=c.terrain&&c.terrain.scope,P=w.get("source"),F=C?this._mockSourceCache:c.getSourceCache(P,I);if(!F)return void f.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=F,this._exaggeration=M?this.calculateExaggeration(p):w.get("exaggeration"),!p.projection.requiresDraping&&M&&0===this._exaggeration)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&f.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(p,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),p.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0,this._previousZoom=p.zoom}else this._disable()}calculateExaggeration(c){const p=this._previousCameraAltitude,v=c.getFreeCameraOptions().position.z/c.pixelsPerMeter*c.worldSize;this._previousCameraAltitude=v;const w=null!=p?v-p:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const C=c.zoom,M=this._style.terrain;if(!this._previousUpdateTimestamp)return M.getExaggeration(C);let I=C-this._previousZoom;const P=this._previousUpdateTimestamp;let F=C;null!=this._evaluationZoom&&(F=this._evaluationZoom,Math.abs(C-F)>.5&&(I=.5*(C-F+I)),I*w<0&&(F+=I)),this._evaluationZoom=F;const z=M.getExaggeration(F),j=z===M.getExaggeration(Math.max(0,F-.1));if(j&&Math.abs(z-this._exaggeration)<.01)return z;let q=Math.min(.1,.00375*(this._updateTimestamp-P));return(j||z<.1||Math.abs(I)<1e-4)&&(q=Math.min(.2,4*q)),f.a3(this._exaggeration,z,q)}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._mergedSourceCaches)this._style._mergedSourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(f._.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=p.getIds().map(P=>{const F=p.getTileByID(P).tileID;return F.projMatrix=v.calculateProjMatrix(F.toUnwrapped()),F});!function(P,F){const z=F.transform.pointCoordinate(F.transform.getCameraPoint()),j=new f.P(z.x,z.y);P.sort((q,Z)=>{if(Z.overscaledZ-q.overscaledZ)return Z.overscaledZ-q.overscaledZ;const ne=new f.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),re=new f.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),ie=j.mult(1<<q.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(ne)-ie.distSqr(re)})}(w,this.painter);const C=this.proxyToSource||{};this.proxyToSource={},w.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const M=this._style._mergedSourceCaches;for(const P in M){const F=M[P];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,c[P],C),F.usedForTerrain))continue;const z=c[P];F.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[p.id]=w.map(P=>new Nv(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const F=this.terrainTileForTile[P.key];if(!F)continue;const z=F.tileID.key;z in I||(this._visibleDemTiles.push(F),I[z]=z)}}_assignTerrainTiles(c){this._initializing||c.forEach(p=>{if(this.terrainTileForTile[p.key])return;const v=this._findTileCoveringTileID(p,this.sourceCache);v&&(this.terrainTileForTile[p.key]=v)})}_prepareDEMTextures(){const c=this.painter.context,p=c.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],C=w.dem;!C||w.demTexture&&!w.needsDEMTextureUpload||(c.activeTexture.set(p.TEXTURE1),H_(this.painter,w,C))}}_prepareDemTileUniforms(c,p,v,w){if(!p||null==p.demTexture)return!1;const C=c.tileID.canonical,M=Math.pow(2,p.tileID.canonical.z-C.z),I=w||"";return v[`u_dem_tl${I}`]=[C.x*M%1,C.y*M%1],v[`u_dem_scale${I}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let c=0;const p=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const C=w.dem.tree.minimums[0];return C>0&&c++,v+C},0);return c?p/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,p=c.gl;c.activeTexture.set(p.TEXTURE2);const v=this._getLoadedAreaMinimum(),[w,C]=(()=>{const I=new f.bB({width:1,height:1},new Float32Array([v]));return[p.R32F,I]})();this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(C,{premultiply:!1}):M=this._emptyDEMTexture=new f.T(c,C,w,{premultiply:!1}),M}setupElevationDraw(c,p,v){const w=this.painter.context,C=w.gl,M={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};M.u_exaggeration=this.exaggeration();let I=null,P=null,F=1;if(v&&v.morphing&&this._useVertexMorphing){const Z=v.morphing.srcDemTile,ne=v.morphing.dstDemTile;F=v.morphing.phase,Z&&ne&&(this._prepareDemTileUniforms(c,Z,M,"_prev")&&(P=Z),this._prepareDemTileUniforms(c,ne,M)&&(I=ne))}const z=Z=>Z&&Z.demTexture&&this.painter.linearFloatFilteringSupported()?C.LINEAR:C.NEAREST;let j=null;var q;if(this.enabled?P&&I?(j=I.demTexture,w.activeTexture.set(C.TEXTURE4),P.demTexture.bind(z(P),C.CLAMP_TO_EDGE),M.u_dem_lerp=F):(I=this.terrainTileForTile[c.tileID.key],j=this._prepareDemTileUniforms(c,I,M)?I.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,w.activeTexture.set(C.TEXTURE2),j&&(M.u_dem_size=1===(q=j).size[0]?1:q.size[0]-2,j.bind(z(I),C.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(v&&v.useDepthForOcclusion,p,M),v&&v.useMeterToDem&&I){const Z=(1<<I.tileID.canonical.z)*f.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=Z}if(v&&v.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),p.setTerrainUniformValues(w,M),"globe"===this.painter.transform.projection.name){const Z=this.globeUniformValues(this.painter.transform,c.tileID.canonical,v&&v.useDenormalizedUpVectorScale);p.setGlobeUniformValues(w,Z)}}globeUniformValues(c,p,v){const w=c.projection;return{u_tile_tl_up:w.upVector(p,0,0),u_tile_tr_up:w.upVector(p,f.a4,0),u_tile_br_up:w.upVector(p,f.a4,f.a4),u_tile_bl_up:w.upVector(p,0,f.a4),u_tile_up_scale:v?f.bu(1):w.upVectorScale(p,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const p=this.painter,v=this.painter.context;0!==c.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,C,M,I,P){if("globe"===w.transform.projection.name)!function(F,z,j,q,Z){const ne=F.context,re=ne.gl;let ie,Q;const se=F.transform,ce=f.bc(F,ne,se),de=(Je,Ke)=>{if(Q===Ke)return;const Pe=[qg[Ke],"PROJECTION_GLOBE_VIEW"];ce&&Pe.push("CUSTOM_ANTIALIASING");const pt=F.isTileAffectedByFog(Je);ie=F.getOrCreateProgram("globeRaster",{defines:Pe,overrideFog:pt}),Q=Ke},be=F.colorModeForRenderPass(),_e=new f.af(re.LEQUAL,f.af.ReadWrite,F.depthRangeFor3D);ph.update(Z);const ye=f.bd(se),De=[f.ak(se.center.lng),f.al(se.center.lat)],Ee=F.globeSharedBuffers,Be=[se.width*f.e.devicePixelRatio,se.height*f.e.devicePixelRatio],ke=Float32Array.from(se.globeMatrix),pe={useDenormalizedUpVectorScale:!0};{const Je=F.transform,Ke=mh(Je.zoom,z.exaggeration(),z.sourceCache._source.tileSize);Q=-1;const Pe=re.TRIANGLES;for(const pt of q){const mt=j.getTile(pt),He=f.ah.disabled,nt=z.prevTerrainTileForTile[pt.key],Oe=z.terrainTileForTile[pt.key];Rf(nt,Oe)&&ph.newMorphing(pt.key,nt,Oe,Z,250),ne.activeTexture.set(re.TEXTURE0),mt.texture&&mt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);const _t=ph.getMorphValuesForProxy(pt.key),gt=_t?1:0;_t&&f.q(pe,{morphing:{srcDemTile:_t.from,dstDemTile:_t.to,phase:f.bb(_t.phase)}});const Wt=f.be(pt.canonical),Vt=f.bf(Wt.getCenter().lat),bt=f.bg(pt.canonical,Wt,Vt,Je.worldSize/Je._pixelsPerMercatorPixel),Qt=f.bh(f.bi(pt.canonical)),Pn=W_(Je.expandedFarZProjMatrix,ke,ye,Qt,f.a2(Je.zoom),De,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,Be,Ke,Je._farZ,bt);if(de(pt,gt),ie&&(z.setupElevationDraw(mt,ie,pe),F.uploadCommonUniforms(ne,ie,pt.toUnwrapped()),Ee)){const[Yn,Un,or]=Ee.getGridBuffers(Vt,0!==Ke);ie.draw(F,Pe,_e,He,be,f.ag.backCCW,Pn,"globe_raster",Yn,Un,or)}}}if(Ee&&(F.renderDefaultNorthPole||F.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&Je.push("CUSTOM_ANTIALIASING"),ie=F.getOrCreateProgram("globeRaster",{defines:Je});for(const Ke of q){const{x:Pe,y:pt,z:mt}=Ke.canonical,He=0===pt,nt=pt===(1<<mt)-1,[Oe,_t,gt,Wt]=Ee.getPoleBuffers(mt,!1);if(Wt&&(He||nt)){const Vt=j.getTile(Ke);ne.activeTexture.set(re.TEXTURE0),Vt.texture&&Vt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);let bt=f.bj(mt,Pe,se);const Qt=f.bh(f.bi(Ke.canonical)),Pn=(Yn,Un)=>Yn.draw(F,re.TRIANGLES,_e,f.ah.disabled,be,f.ag.disabled,W_(se.expandedFarZProjMatrix,bt,bt,Qt,0,De,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Be,0,se._farZ),"globe_pole_raster",Un,gt,Wt);z.setupElevationDraw(Vt,ie,pe),F.uploadCommonUniforms(ne,ie,Ke.toUnwrapped()),He&&F.renderDefaultNorthPole&&Pn(ie,Oe),nt&&F.renderDefaultSouthPole&&(bt=f.ae.scale(f.ae.create(),bt,[1,-1,1]),Pn(ie,_t))}}}}(w,C,M,I,P);else{const F=w.context,z=F.gl;let j,q;const Z=w.shadowRenderer,ne=Ra(w,w.longestCutoffRange),re=be=>{if(q===be)return;const _e=[];_e.push(qg[be]),ne.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),j=w.getOrCreateProgram("terrainRaster",{defines:_e}),q=be},ie=w.colorModeForRenderPass(),Q=new f.af(z.LEQUAL,f.af.ReadWrite,w.depthRangeFor3D);ph.update(P);const se=w.transform,ce=mh(se.zoom,C.exaggeration(),C.sourceCache._source.tileSize);let de=[0,0,0];if(Z){const be=w.style.directionalLight,_e=w.style.ambientLight;be&&_e&&(de=_m(w.style,be,_e))}{q=-1;const be=z.TRIANGLES,[_e,ye]=[C.gridIndexBuffer,C.gridSegments];for(const De of I){const Ee=M.getTile(De),Be=f.ah.disabled,ke=C.prevTerrainTileForTile[De.key],pe=C.terrainTileForTile[De.key];Rf(ke,pe)&&ph.newMorphing(De.key,ke,pe,P,250),F.activeTexture.set(z.TEXTURE0),Ee.texture&&Ee.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Je=ph.getMorphValuesForProxy(De.key),Ke=Je?1:0;let Pe;Je&&(Pe={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:f.bb(Je.phase)}});const pt=Jw(De.projMatrix,Zg(De.canonical,se.renderWorldCopies)?ce/10:ce,de);if(re(Ke),!j)continue;C.setupElevationDraw(Ee,j,Pe);const mt=De.toUnwrapped();Z&&Z.setupShadows(mt,j),w.uploadCommonUniforms(F,j,mt,null,ne),j.draw(w,be,Q,Be,ie,f.ag.backCCW,pt,"terrain_raster",C.gridBuffer,_e,ye)}}}}(p,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const p=this.painter,v=this.painter.context,w=this.proxySourceCache,C=this.proxiedCoords[w.id],M=this._drapedRenderBatches.shift(),I=p.style.order,P=[];let F=0;for(const z of C){const j=w.getTileByID(z.proxyTileKey),q=w.proxyCachedFBO[z.key]?w.proxyCachedFBO[z.key][c]:void 0,Z=void 0!==q?w.renderCache[q]:this.pool[F++],ne=void 0!==q;if(j.texture=Z.tex,ne&&!Z.dirty){P.push(j.tileID);continue}let re;v.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(v.clear({color:f.C.transparent,stencil:0}),Z.dirty=!1);for(let ie=M.start;ie<=M.end;++ie){const Q=p.style._mergedLayers[I[ie]];if(Q.isHidden(p.transform.zoom))continue;const se=p.style.getLayerSourceCache(Q),ce=se?this.proxyToSource[z.key][se.id]:[z];if(!ce)continue;const de=ce;v.viewport.set([0,0,Z.fb.width,Z.fb.height]),re!==(se?se.id:null)&&(this._setupStencil(Z,ce,Q,se),re=se?se.id:null),p.renderLayer(p,se,Q,de)}if(0===this._drapedRenderBatches.length)for(const ie of this._pendingGroundEffectLayers){const Q=p.style._mergedLayers[I[ie]];if(Q.isHidden(p.transform.zoom))continue;const se=p.style.getLayerSourceCache(Q),ce=se?this.proxyToSource[z.key][se.id]:[z];if(!ce)continue;const de=ce;v.viewport.set([0,0,Z.fb.width,Z.fb.height]),re!==(se?se.id:null)&&(this._setupStencil(Z,ce,Q,se),re=se?se.id:null),p.renderLayer(p,se,Q,de)}this.renderedToTile?(Z.dirty=!0,P.push(j.tileID)):ne||--F,5===F&&(F=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,p.width,p.height]),M.end+1}postRender(){}isLayerOrderingCorrect(c){const p=c.order.length;let v=-1,w=p;for(let C=0;C<p;++C)this._style.isLayerDraped(c._mergedLayers[c.order[C]])?v=Math.max(v,C):w=Math.min(w,C);return w>v}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{c=Math.min(c,p.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,p,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const M=C.tileID,I=1<<M.overscaledZ,{x:P,y:F}=M.canonical,z=P/I,j=(P+1)/I,q=F/I,Z=(F+1)/I;return{minx:z,miny:q,maxx:j,maxy:Z,t:C.dem.tree.raycastRoot(z,q,j,Z,c,p,v),tile:C}});w.sort((C,M)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const C of w){if(null==C.t)return null;const M=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,c,p,v);if(null!=M)return M}return null}_createFBO(){const c=this.painter.context,p=c.gl,v=this.drapeBufferSize;c.activeTexture.set(p.TEXTURE0);const w=new f.T(c,{width:v[0],height:v[1],data:null},p.RGBA);w.bind(p.LINEAR,p.CLAMP_TO_EDGE);const C=c.createFramebuffer(v[0],v[1],!0,null);return C.colorAttachment.set(w.texture),C.depthAttachment=new ji(c,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:C,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const p=this._style._mergedLayers[c],v=p.isHidden(this.painter.transform.zoom);return"custom"===p.type?!v&&p.shouldRedrape():!v&&p.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const v of this._style.getSources())if(v instanceof kv){c=!0;break}if(!c)return;const p={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],C=this._style.getLayerSourceCache(w);if(C&&!p[C.id]&&!w.isHidden(this.painter.transform.zoom)&&"line"===w.type&&w.widthExpression()instanceof f.Z){p[C.id]=!0;for(const M of this.proxyCoords){const I=this.proxyToSource[M.key][C.id];if(I)for(const P of I)this._clearRenderCacheForTile(C.id,P)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const v in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[v]._source instanceof Ml){c=!0;break}if(!c)return;const p={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],C=this._style.getLayerSourceCache(w);if(!C||p[C.id]||w.isHidden(this.painter.transform.zoom)||"raster"!==w.type)continue;const M=w.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const P=this.proxyToSource[I.key][C.id];if(P)for(const F of P){const z=X_(C.getTile(F),C.findLoadedParent(F,0),C,this.painter.transform,M);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(C.id,F)}}}}_setupDrapedRenderBatches(){const c=this._style.order,p=c.length;if(0===p)return;const v=[];this._pendingGroundEffectLayers=[];let w,C=0,M=this._style._mergedLayers[c[C]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++C<p;)M=this._style._mergedLayers[c[C]];for(;C<p;++C){const I=this._style._mergedLayers[c[C]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?void 0===w&&(w=C):("fill-extrusion"===I.type&&this._pendingGroundEffectLayers.push(C),void 0!==w&&(v.push({start:w,end:C-1}),w=void 0)))}if(void 0!==w&&v.push({start:w,end:C-1}),0!==v.length){const I=v[v.length-1];this._pendingGroundEffectLayers.every(P=>P>I.end)||f.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=v}_setupRenderCache(c){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const M=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let I=0;I<M.length;++I){const P=Object.values(M[I]);p.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let M=v.length-1;M>=0;M--){const I=v[M];if(p.getTileByID(I.key),void 0!==p.proxyCachedFBO[I.key]){const P=c[I.key],F=this.proxyToSource[I.key];let z=0;for(const j in F){const q=F[j],Z=P[j];if(!Z||Z.length!==q.length||q.some((ne,re)=>ne!==Z[re]||w[j]&&w[j].hasOwnProperty(ne.key))){z=-1;break}++z}for(const j in p.proxyCachedFBO[I.key])p.renderCache[p.proxyCachedFBO[I.key][j]].dirty=z<0||z!==Object.values(P).length}}const C=[...this._drapedRenderBatches];C.sort((M,I)=>I.end-I.start-(M.end-M.start));for(const M of C)for(const I of v){if(p.proxyCachedFBO[I.key])continue;let P=p.renderCachePool.pop();void 0===P&&p.renderCache.length<50&&(P=p.renderCache.length,p.renderCache.push(this._createFBO())),void 0!==P&&(p.proxyCachedFBO[I.key]={},p.proxyCachedFBO[I.key][M.start]=P,p.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(c,p,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,M=C.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let I;if(v.isTileClipped())I=p.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):f.ah.disabled}_renderTileClippingMasks(c,p){const v=this.painter,w=this.painter.context,C=w.gl;v._tileClippingMaskIDs={},w.setColorMode(f.a.disabled),w.setDepthMode(f.af.disabled);const M=v.getOrCreateProgram("clippingMask");for(const I of c){const P=v._tileClippingMaskIDs[I.key]=--p;M.draw(v,C.TRIANGLES,f.af.disabled,new f.ah({func:C.ALWAYS,mask:0},P,255,C.KEEP,C.KEEP,C.REPLACE),f.a.disabled,f.ag.disabled,ym(I.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(c){const p=this.painter.transform;if(c.x<0||c.x>p.width||c.y<0||c.y>p.height)return null;const v=[c.x,c.y,1,1];f.aB.transformMat4(v,v,p.pixelMatrixInverse),f.aB.scale(v,v,1/v[3]),v[0]/=p.worldSize,v[1]/=p.worldSize;const w=p._camera.position,C=f.ay(1,p.center.lat),M=[w[0],w[1],w[2]/C,0],I=f.$.subtract([],v.slice(0,3),M);f.$.normalize(I,I);const P=this.raycast(M,I,this._exaggeration);return null!==P&&P?(f.$.scaleAndAdd(M,M,I,P),M[3]=M[2],M[2]*=C,M):null}_setupProxiedCoordsForOrtho(c,p,v){if(c.getSource()instanceof f.bo)return this._setupProxiedCoordsForImageSource(c,p,v);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords;for(let P=0;P<C.length;P++){const F=C[P],z=this._findTileCoveringTileID(F,c);if(z){const j=this._createProxiedId(F,z,v[F.key]&&v[F.key][c.id]);w.push(j),this.proxyToSource[F.key][c.id]=[j]}}let M=!1;const I=new Set;for(let P=0;P<p.length;P++){const F=c.getTile(p[P]);if(!F||!F.hasData())continue;const z=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==F.tileID.canonical.z){const j=this.proxyToSource[z.tileID.key][c.id],q=this._createProxiedId(z.tileID,F,v[z.tileID.key]&&v[z.tileID.key][c.id]);j?j.splice(j.length-1,0,q):this.proxyToSource[z.tileID.key][c.id]=[q];const Z=this.proxyToSource[z.tileID.key][c.id];I.has(Z)||I.add(Z),w.push(q),M=!0}}if(this._sourceTilesOverlap[c.id]=M,M&&this._debugParams.sortTilesHiZFirst)for(const P of I)P.sort((F,z)=>z.overscaledZ-F.overscaledZ)}_setupProxiedCoordsForImageSource(c,p,v){if(!c.getSource().loaded())return;const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords,M=c.getSource(),I=M.tileID;if(!I)return;const P=new f.P(I.x,I.y)._div(1<<I.z),F=M.coordinates.map(f._.fromLngLat).reduce((j,q)=>(j.min.x=Math.min(j.min.x,q.x-P.x),j.min.y=Math.min(j.min.y,q.y-P.y),j.max.x=Math.max(j.max.x,q.x-P.x),j.max.y=Math.max(j.max.y,q.y-P.y),j),{min:new f.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(j,q)=>{const Z=j.wrap+j.canonical.x/(1<<j.canonical.z),ne=j.canonical.y/(1<<j.canonical.z),re=f.a4/(1<<j.canonical.z),ie=q.wrap+q.canonical.x/(1<<q.canonical.z),Q=q.canonical.y/(1<<q.canonical.z);return Z+re<ie+F.min.x||Z>ie+F.max.x||ne+re<Q+F.min.y||ne>Q+F.max.y};for(let j=0;j<C.length;j++){const q=C[j];for(let Z=0;Z<p.length;Z++){const ne=c.getTile(p[Z]);if(!ne||!ne.hasData()||z(q,ne.tileID))continue;const re=this._createProxiedId(q,ne,v[q.key]&&v[q.key][c.id]),ie=this.proxyToSource[q.key][c.id];ie?ie.push(re):this.proxyToSource[q.key][c.id]=[re],w.push(re)}}}_createProxiedId(c,p,v){let w=this.orthoMatrix;if(v){const C=v.find(M=>M.key===p.tileID.key);if(C)return C}if(p.tileID.key!==c.key){const C=c.canonical.z-p.tileID.canonical.z;let M,I,P;w=f.ae.create();const F=p.tileID.wrap-c.wrap<<c.overscaledZ;C>0?(M=f.a4>>C,I=M*((p.tileID.canonical.x<<C)-c.canonical.x+F),P=M*((p.tileID.canonical.y<<C)-c.canonical.y)):(M=f.a4<<-C,I=f.a4*(p.tileID.canonical.x-(c.canonical.x+F<<-C)),P=f.a4*(p.tileID.canonical.y-(c.canonical.y<<-C))),f.ae.ortho(w,0,M,0,M,0,1),f.ae.translate(w,w,[I,P,0])}return new Nv(p.tileID,c.key,w)}_findTileCoveringTileID(c,p){let v=p.getTile(c);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[p.id],C=w[c.key];if(v=C?p.getTileByID(C):null,v&&v.hasData()||null===C)return v;let M=v?v.tileID:c,I=M.overscaledZ;const P=p.getSource().minzoom,F=[];if(!C){const j=p.getSource().maxzoom;if(c.canonical.z>=j){const q=c.canonical.z-j;p.getSource().reparseOverscaled?(I=Math.max(c.canonical.z+2,p.transform.tileZoom),M=new f.aQ(I,c.wrap,j,c.canonical.x>>q,c.canonical.y>>q)):0!==q&&(I=j,M=new f.aQ(I,c.wrap,j,c.canonical.x>>q,c.canonical.y>>q))}M.key!==c.key&&(F.push(M.key),v=p.getTile(M))}const z=j=>{F.forEach(q=>{w[q]=j}),F.length=0};for(I-=1;I>=P&&(!v||!v.hasData());I--){v&&z(v.tileID.key);const j=M.calculateScaledKey(I);if(v=p.getTileByID(j),v&&v.hasData())break;const q=w[j];if(null===q)break;void 0===q?F.push(j):v=p.getTileByID(q)}return z(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,p){let v=this._tilesDirty[c];v||(v=this._tilesDirty[c]={}),v[p.key]=!0}}function Y_(y,c,p){const v=function(I,P,F){const z=f.$.dot(P,I),j=f.$.dot(F,[.2126,.7152,.0722]),q=(ne,re,ie)=>(1-ie)*ne+ie*re,Z=q(1-.3*Math.min(j,1),1,Math.min(z+1,1));return q(.92,1,Math.asin(f.au(P[2],-1,1))/Math.PI+.5)*Z}(y,[0,0,1],c),w=[0,0,0];f.$.scale(w,p.slice(0,3),v);const C=[0,0,0];f.$.scale(C,c.slice(0,3),y[2]);const M=[0,0,0];return f.$.add(M,w,C),f.ba(M)}const vm=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Fv=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class K_{static cacheKey(c,p,v,w){let C=`${p}${w?w.cacheKey:""}`;for(const M of v)c.usedDefines.includes(M)&&(C+=`/${M}`);return C}constructor(c,p,v,w,C,M){const I=c.gl;this.program=I.createProgram(),this.configuration=w,this.name=p,this.fixedDefines=[...M];const P=w?w.getBinderAttributes():[],F=(v.staticAttributes||[]).concat(P);let z=w?w.defines():[];z=z.concat(M.map(ie=>`#define ${ie}`));const j="#version 300 es\n";let q=j+z.concat("precision mediump float;",Mv,Bg.fragmentSource).join("\n");for(const ie of v.fragmentIncludes)q+=`\n${Fg[ie]}`;q+=`\n${v.fragmentSource}`;let Z=j+z.concat("precision highp float;",Mv,Bg.vertexSource).join("\n");for(const ie of v.vertexIncludes)Z+=`\n${Fg[ie]}`;Z+=`\n${v.vertexSource}`;const ne=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ne,q),I.compileShader(ne),I.attachShader(this.program,ne);const re=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(re,Z),I.compileShader(re),I.attachShader(this.program,re),this.attributes={},this.numAttributes=F.length;for(let ie=0;ie<this.numAttributes;ie++)if(F[ie]){const Q=F[ie].startsWith("a_")?F[ie]:`a_${F[ie]}`;I.bindAttribLocation(this.program,ie,Q),this.attributes[Q]=ie}I.linkProgram(this.program),I.deleteShader(re),I.deleteShader(ne),this.fixedUniforms=C(c),this.binderUniforms=w?w.getUniforms(c):[],(M.includes("TERRAIN")||-1!==p.indexOf("symbol")||-1!==p.indexOf("circle"))&&(this.terrainUniforms={u_dem:new f.a8(ie=c),u_dem_prev:new f.a8(ie),u_dem_tl:new f.a9(ie),u_dem_scale:new f.ab(ie),u_dem_tl_prev:new f.a9(ie),u_dem_scale_prev:new f.ab(ie),u_dem_size:new f.ab(ie),u_dem_lerp:new f.ab(ie),u_exaggeration:new f.ab(ie),u_depth:new f.a8(ie),u_depth_size_inv:new f.a9(ie),u_depth_range_unpack:new f.a9(ie),u_occluder_half_size:new f.ab(ie),u_occlusion_depth_offset:new f.ab(ie),u_meter_to_dem:new f.ab(ie),u_label_plane_matrix_inv:new f.a7(ie)}),M.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new f.ar(ie),u_tile_tr_up:new f.ar(ie),u_tile_br_up:new f.ar(ie),u_tile_bl_up:new f.ar(ie),u_tile_up_scale:new f.ab(ie)}))(c)),M.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new f.a7(ie),u_fog_range:new f.a9(ie),u_fog_color:new f.at(ie),u_fog_horizon_blend:new f.ab(ie),u_fog_vertical_limit:new f.a9(ie),u_fog_temporal_offset:new f.ab(ie),u_frustum_tl:new f.ar(ie),u_frustum_tr:new f.ar(ie),u_frustum_br:new f.ar(ie),u_frustum_bl:new f.ar(ie),u_globe_pos:new f.ar(ie),u_globe_radius:new f.ab(ie),u_globe_transition:new f.ab(ie),u_is_globe:new f.a8(ie),u_viewport:new f.a9(ie)}))(c)),M.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new f.at(ie)}))(c)),M.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new f.ar(ie),u_lighting_directional_dir:new f.ar(ie),u_lighting_directional_color:new f.ar(ie),u_ground_radiance:new f.ar(ie)}))(c)),M.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new f.a7(ie),u_light_matrix_1:new f.a7(ie),u_fade_range:new f.a9(ie),u_shadow_normal_offset:new f.ar(ie),u_shadow_intensity:new f.ab(ie),u_shadow_texel_size:new f.ab(ie),u_shadow_map_resolution:new f.ab(ie),u_shadow_direction:new f.ar(ie),u_shadow_bias:new f.ar(ie),u_shadowmap_0:new f.a8(ie),u_shadowmap_1:new f.a8(ie)}))(c))}var ie}setTerrainUniformValues(c,p){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w]&&v[w].set(this.program,w,p[w])}}setGlobeUniformValues(c,p){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w]&&v[w].set(this.program,w,p[w])}}setFogUniformValues(c,p){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w].set(this.program,w,p[w])}}setCutoffUniformValues(c,p){if(!this.cutoffUniforms)return;const v=this.cutoffUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w].set(this.program,w,p[w])}}setLightsUniformValues(c,p){if(!this.lightsUniforms)return;const v=this.lightsUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in p)v[w].set(this.program,w,p[w])}}setShadowUniformValues(c,p){if(this.failedToCreate||!this.shadowUniforms)return;const v=this.shadowUniforms;c.program.set(this.program);for(const w in p)v[w].set(this.program,w,p[w])}_drawDebugWireframe(c,p,v,w,C,M,I,P,F,z){const j=c.options.wireframe;if(!1===j.terrain&&!1===j.layers2D&&!1===j.layers3D)return;const q=c.context;if(!(j.terrain&&("terrainRaster"===this.name||"globeRaster"===this.name)||!(!j.layers2D||c._terrain&&c._terrain.renderingToTexture)&&vm.includes(this.name)||j.layers3D&&Fv.includes(this.name)))return;const Z=q.gl,ne=c.wireframeDebugCache.getLinesFromTrianglesBuffer(c.frameCounter,C,q);if(!ne)return;const re=[...this.fixedDefines];re.push("DEBUG_WIREFRAME");const ie=c.getOrCreateProgram(this.name,{config:this.configuration,defines:re});q.program.set(ie.program);const Q=(de,be,_e)=>{if(be[de]&&_e[de])for(const ye in be[de])_e[de][ye]&&_e[de][ye].set(_e.program,ye,be[de][ye].current)};F&&F.setUniforms(ie.program,q,ie.binderUniforms,I,{zoom:P}),Q("fixedUniforms",this,ie),Q("terrainUniforms",this,ie),Q("globeUniforms",this,ie),Q("fogUniforms",this,ie),Q("lightsUniforms",this,ie),Q("shadowUniforms",this,ie),ne.bind(),q.setColorMode(new f.a([Z.ONE,Z.ONE_MINUS_SRC_ALPHA,Z.ZERO,Z.ONE],f.C.transparent,[!0,!0,!0,!1])),q.setDepthMode(new f.af(p.func===Z.LESS?Z.LEQUAL:p.func,f.af.ReadOnly,p.range)),q.setStencilMode(f.ah.disabled);const se=3*M.primitiveLength*2,ce=3*M.primitiveOffset*2*2;z&&z>1?Z.drawElementsInstanced(Z.LINES,se,Z.UNSIGNED_SHORT,ce,z):Z.drawElements(Z.LINES,se,Z.UNSIGNED_SHORT,ce),C.bind(),q.program.set(this.program),q.setDepthMode(p),q.setStencilMode(v),q.setColorMode(w)}draw(c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie){const Q=c.context,se=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(v),Q.setStencilMode(w),Q.setColorMode(C),Q.setCullFace(M);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,I[be]);ne&&ne.setUniforms(this.program,Q,this.binderUniforms,q,{zoom:Z});const ce={[se.POINTS]:1,[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[p],de=ie&&ie>0?1:void 0;for(const be of j.get()){const _e=be.vaos||(be.vaos={});(_e[P]||(_e[P]=new Yw)).bind(Q,this,F,ne?ne.getPaintVertexBuffers():[],z,be.vertexOffset,re||[],de),ie&&ie>1?se.drawElementsInstanced(p,be.primitiveLength*ce,se.UNSIGNED_SHORT,be.primitiveOffset*ce*2,ie):z?se.drawElements(p,be.primitiveLength*ce,se.UNSIGNED_SHORT,be.primitiveOffset*ce*2):se.drawArrays(p,be.vertexOffset,be.vertexLength),p===se.TRIANGLES&&z&&this._drawDebugWireframe(c,v,w,C,z,be,q,Z,ne,ie)}}}function J_(y,c){const p=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,y.transform.tileZoom)/p,w=v*(c.tileID.canonical.x+c.tileID.wrap*p),C=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture?c.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/f.bD(c,1,y.transform.tileZoom),u_pixel_coord_upper:[w>>16,C>>16],u_pixel_coord_lower:[65535&w,65535&C]}}const Q_=f.ae.create(),Cu=(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie,Q)=>{const se=c.style.light,ce=se.properties.get("position"),de=[ce.x,ce.y,ce.z],be=f.bE.create();"viewport"===se.properties.get("anchor")&&(f.bE.fromRotation(be,-c.transform.angle),f.$.transformMat3(de,de,be));const _e=se.properties.get("color"),ye=c.transform,De={u_matrix:y,u_lightpos:de,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+p,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Q_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:C,u_alignment:M,u_width_scale:I,u_flood_light_color:Z,u_vertical_scale:ne,u_flood_light_intensity:re,u_ground_shadow_factor:ie,u_emissive_strength:Q};return"globe"===ye.projection.name&&(De.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],De.u_zoom_transition=z,De.u_inv_rot_matrix=q,De.u_merc_center=j,De.u_up_dir=ye.projection.upVector(new f.aO(0,0,0),j[0]*f.a4,j[1]*f.a4),De.u_height_lift=F),De},e1=(y,c,p,v,w)=>({u_matrix:y,u_edge_radius:c,u_alignment:p,u_width_scale:v,u_vertical_scale:w}),Qw=(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re)=>{const ie=Cu(y,c,p,v,w,C,M,I,P,z,j,q,Z,ne,re,1,[0,0,0],0),Q={u_height_factor:-Math.pow(2,P.overscaledZ)/F.tileSize/8};return f.Q(ie,J_(c,F),Q)},Kg=(y,c)=>({u_matrix:y,u_emissive_strength:c}),t1=(y,c,p,v)=>f.Q(Kg(y,c),J_(p,v)),n1=(y,c,p)=>({u_matrix:y,u_world:p,u_emissive_strength:c}),Jg=(y,c,p,v,w)=>f.Q(t1(y,c,p,v),{u_world:w}),xm=(y,c,p,v)=>{const w=f.a4/p.tileSize;return{u_matrix:y,u_camera_to_center_distance:c.getCameraToCenterDistance(v),u_extrude_scale:[c.pixelsToGLUnits[0]/w,c.pixelsToGLUnits[1]/w]}},bm=(y,c,p=1)=>({u_matrix:y,u_color:c.toRenderColor(null),u_overlay:0,u_overlay_scale:p}),Jt=f.ae.create(),Sd=(y,c,p,v,w,C,M)=>{const I=y.transform,P="globe"===I.projection.name,F=P?f.bF(I.zoom,c.canonical)*I._pixelsPerMercatorPixel:f.bD(p,1,C),z={u_matrix:c.projMatrix,u_extrude_scale:F,u_intensity:M,u_inv_rot_matrix:Jt,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){z.u_inv_rot_matrix=v,z.u_merc_center=w,z.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],z.u_zoom_transition=f.a2(I.zoom);const j=w[0]*f.a4,q=w[1]*f.a4;z.u_up_dir=I.projection.upVector(new f.aO(0,0,0),j,q)}return z};function Pf(y,[c,p,v,w],[C,M]){if(C===M)return[0,0,0,0];const I=255*(y-1)/(y*(M-C));return[c*I,p*I,v*I,w*I]}function Nf(y,c,[p,v]){return p===v?0:.5/y+(c-p)*(y-1)/(y*(v-p))}const r1=(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie,Q,se,ce,de)=>({u_matrix:y,u_normalize_matrix:c,u_globe_matrix:p,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:C,u_scale_parent:F,u_fade_t:z.mix,u_opacity:z.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:f.bG(j.paint.get("raster-saturation")),u_contrast_factor:f.bH(j.paint.get("raster-contrast")),u_spin_weights:Lv(j.paint.get("raster-hue-rotate")),u_perspective_transform:q,u_raster_elevation:Z,u_zoom_transition:M,u_merc_center:I,u_cutoff_params:P,u_colorization_mix:Pf(f.bI,re,Q),u_colorization_offset:Nf(f.bI,ie,Q),u_color_ramp:ne,u_texture_offset:[ce/(se+2*ce),se/(se+2*ce)],u_texture_res:[se+2*ce,se+2*ce],u_emissive_strength:de});function Lv(y){y*=Math.PI/180;const c=Math.sin(y),p=Math.cos(y);return[(2*p+1)/3,(-Math.sqrt(3)*c-p+1)/3,(Math.sqrt(3)*c-p+1)/3]}const Cc=.05,Pa=(y,c,p,v,w,C,M,I,P,F,z,j)=>({u_matrix:y,u_normalize_matrix:c,u_globe_matrix:p,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:C,u_scale_parent:F,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:M,u_merc_center:I,u_cutoff_params:P}),Ff=(y,c,p,v,w,C,M,I,P,F)=>({u_particle_texture:y,u_particle_texture_side_len:c,u_tile_offset:p,u_velocity:v,u_color_ramp:C,u_velocity_res:w,u_max_speed:M,u_uv_offset:I,u_data_scale:[255*P[0],255*P[1]],u_data_offset:F,u_particle_pos_scale:1.1,u_particle_pos_offset:[Cc,Cc]}),Dd=(y,c,p,v,w,C,M,I,P,F)=>({u_particle_texture:y,u_particle_texture_side_len:c,u_velocity:p,u_velocity_res:v,u_max_speed:w,u_speed_factor:C,u_reset_rate:M,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*P[0],255*P[1]],u_data_offset:F,u_particle_pos_scale:1.1,u_particle_pos_offset:[Cc,Cc]}),Xc=f.ae.create(),Md=(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie,Q)=>{const se=w.transform,ce={u_is_size_zoom_constant:+("constant"===y||"source"===y),u_is_size_feature_constant:+("constant"===y||"camera"===y),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:se.getCameraToCenterDistance(re),u_rotate_symbol:+p,u_aspect_ratio:se.width/se.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:M,u_coord_matrix:I,u_is_text:+P,u_pitch_with_map:+v,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Xc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Xc,u_up_vector:[0,-1,0],u_color_adj_mat:ie,u_icon_transition:Q||0};return"globe"===re.name&&(ce.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],ce.u_zoom_transition=j,ce.u_inv_rot_matrix=Z,ce.u_merc_center=q,ce.u_camera_forward=se._camera.forward(),ce.u_ecef_origin=f.bJ(se.globeMatrix,z.toUnwrapped()),ce.u_tile_matrix=Float32Array.from(se.globeMatrix),ce.u_up_vector=ne),ce},Ad=(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie)=>f.Q(Md(y,c,p,v,w,C,M,I,P,F,j,q,Z,ne,re,ie),{u_gamma_scale:v?w.transform.getCameraToCenterDistance(ie)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:f.e.devicePixelRatio,u_is_halo:+z,undefined:void 0}),yh=(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re)=>f.Q(Ad(y,c,p,v,w,C,M,I,!0,P,!0,z,j,q,Z,ne,re),{u_texsize_icon:F,u_texture_icon:1}),Bv=(y,c,p,v)=>({u_matrix:y,u_emissive_strength:c,u_opacity:p,u_color:v}),ls=(y,c,p,v,w,C,M,I)=>f.Q(function(P,F,z,j,q){const{width:Z,height:ne}=j.imageManager.getPixelSize(F),re=Math.pow(2,q.tileID.overscaledZ),ie=q.tileSize*Math.pow(2,j.transform.tileZoom)/re,Q=ie*(q.tileID.canonical.x+q.tileID.wrap*re),se=ie*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[Z,ne],u_pattern_size:z.displaySize,u_tile_units_to_pixels:1/f.bD(q,1,j.transform.tileZoom),u_pixel_coord_upper:[Q>>16,se>>16],u_pixel_coord_lower:[65535&Q,65535&se]}}(0,C,M,v,I),{u_matrix:y,u_emissive_strength:c,u_opacity:p}),Sc=new Float32Array(f.ae.identity([])),Lf=(y,c,p,v,w,C,M,I,P,F,z,j,q,Z=[0,0,0],ne)=>{const re=w.style.light,ie=re.properties.get("position"),Q=[-ie.x,-ie.y,ie.z],se=f.bE.create();"viewport"===re.properties.get("anchor")&&(f.bE.fromRotation(se,-w.transform.angle),f.$.transformMat3(Q,Q,se));const ce="MASK"===z.alphaMode,de=re.properties.get("color").toRenderColor(null),be=q.paint.get("model-ambient-occlusion-intensity"),_e=q.paint.get("model-color").constantOr(f.C.white).toRenderColor(null),ye=q.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:y,u_lighting_matrix:c,u_normal_matrix:p,u_node_matrix:v||Sc,u_lightpos:Q,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:Z,u_opacity:C,u_baseTextureIsAlpha:0,u_alphaMask:+ce,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[M.r,M.g,M.b,M.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:P,u_roughnessFactor:F,u_baseColorTexture:_o.BaseColor,u_metallicRoughnessTexture:_o.MetallicRoughness,u_normalTexture:_o.Normal,u_occlusionTexture:_o.Occlusion,u_emissionTexture:_o.Emission,u_lutTexture:_o.LUT,u_color_mix:[_e.r,_e.g,_e.b,ye],u_aoIntensity:be,u_emissive_strength:j,u_occlusionTextureTransform:ne||[0,0,0,0]}},Hi=(y,c=Sc,p=Sc)=>({u_matrix:y,u_instance:c,u_node_matrix:p}),zv={fillExtrusion:y=>({u_matrix:new f.a7(y),u_lightpos:new f.ar(y),u_lightintensity:new f.ab(y),u_lightcolor:new f.ar(y),u_vertical_gradient:new f.ab(y),u_opacity:new f.ab(y),u_edge_radius:new f.ab(y),u_alignment:new f.ab(y),u_width_scale:new f.ab(y),u_ao:new f.a9(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_up_dir:new f.ar(y),u_height_lift:new f.ab(y),u_flood_light_color:new f.ar(y),u_vertical_scale:new f.ab(y),u_flood_light_intensity:new f.ab(y),u_ground_shadow_factor:new f.ar(y),u_emissive_strength:new f.ab(y)}),fillExtrusionDepth:y=>({u_matrix:new f.a7(y),u_edge_radius:new f.ab(y),u_alignment:new f.ab(y),u_width_scale:new f.ab(y),u_vertical_scale:new f.ab(y)}),fillExtrusionPattern:y=>({u_matrix:new f.a7(y),u_lightpos:new f.ar(y),u_lightintensity:new f.ab(y),u_lightcolor:new f.ar(y),u_vertical_gradient:new f.ab(y),u_height_factor:new f.ab(y),u_edge_radius:new f.ab(y),u_alignment:new f.ab(y),u_width_scale:new f.ab(y),u_ao:new f.a9(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_up_dir:new f.ar(y),u_height_lift:new f.ab(y),u_image:new f.a8(y),u_texsize:new f.a9(y),u_pixel_coord_upper:new f.a9(y),u_pixel_coord_lower:new f.a9(y),u_tile_units_to_pixels:new f.ab(y),u_opacity:new f.ab(y)}),fillExtrusionGroundEffect:y=>({u_matrix:new f.a7(y),u_opacity:new f.ab(y),u_ao_pass:new f.ab(y),u_meter_to_tile:new f.ab(y),u_ao:new f.a9(y),u_flood_light_intensity:new f.ab(y),u_flood_light_color:new f.ar(y),u_attenuation:new f.ab(y),u_edge_radius:new f.ab(y),u_fb:new f.a8(y),u_fb_size:new f.ab(y)}),fill:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y)}),fillPattern:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_image:new f.a8(y),u_texsize:new f.a9(y),u_pixel_coord_upper:new f.a9(y),u_pixel_coord_lower:new f.a9(y),u_tile_units_to_pixels:new f.ab(y)}),fillOutline:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_world:new f.a9(y)}),fillOutlinePattern:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_world:new f.a9(y),u_image:new f.a8(y),u_texsize:new f.a9(y),u_pixel_coord_upper:new f.a9(y),u_pixel_coord_lower:new f.a9(y),u_tile_units_to_pixels:new f.ab(y)}),circle:f.bK,collisionBox:y=>({u_matrix:new f.a7(y),u_camera_to_center_distance:new f.ab(y),u_extrude_scale:new f.a9(y)}),collisionCircle:y=>({u_matrix:new f.a7(y),u_inv_matrix:new f.a7(y),u_camera_to_center_distance:new f.ab(y),u_viewport_size:new f.a9(y)}),debug:y=>({u_color:new f.aa(y),u_matrix:new f.a7(y),u_overlay:new f.a8(y),u_overlay_scale:new f.ab(y)}),clippingMask:y=>({u_matrix:new f.a7(y)}),heatmap:y=>({u_extrude_scale:new f.ab(y),u_intensity:new f.ab(y),u_matrix:new f.a7(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_up_dir:new f.ar(y)}),heatmapTexture:y=>({u_image:new f.a8(y),u_color_ramp:new f.a8(y),u_opacity:new f.ab(y)}),hillshade:y=>({u_matrix:new f.a7(y),u_image:new f.a8(y),u_latrange:new f.a9(y),u_light:new f.a9(y),u_shadow:new f.aa(y),u_highlight:new f.aa(y),u_emissive_strength:new f.ab(y),u_accent:new f.aa(y)}),hillshadePrepare:y=>({u_matrix:new f.a7(y),u_image:new f.a8(y),u_dimension:new f.a9(y),u_zoom:new f.ab(y)}),line:f.bL,linePattern:f.bM,raster:y=>({u_matrix:new f.a7(y),u_normalize_matrix:new f.a7(y),u_globe_matrix:new f.a7(y),u_merc_matrix:new f.a7(y),u_grid_matrix:new f.as(y),u_tl_parent:new f.a9(y),u_scale_parent:new f.ab(y),u_fade_t:new f.ab(y),u_opacity:new f.ab(y),u_image0:new f.a8(y),u_image1:new f.a8(y),u_brightness_low:new f.ab(y),u_brightness_high:new f.ab(y),u_saturation_factor:new f.ab(y),u_contrast_factor:new f.ab(y),u_spin_weights:new f.ar(y),u_perspective_transform:new f.a9(y),u_raster_elevation:new f.ab(y),u_zoom_transition:new f.ab(y),u_merc_center:new f.a9(y),u_cutoff_params:new f.at(y),u_colorization_mix:new f.at(y),u_colorization_offset:new f.ab(y),u_color_ramp:new f.a8(y),u_texture_offset:new f.a9(y),u_texture_res:new f.a9(y),u_emissive_strength:new f.ab(y)}),rasterParticle:y=>({u_matrix:new f.a7(y),u_normalize_matrix:new f.a7(y),u_globe_matrix:new f.a7(y),u_merc_matrix:new f.a7(y),u_grid_matrix:new f.as(y),u_tl_parent:new f.a9(y),u_scale_parent:new f.ab(y),u_fade_t:new f.ab(y),u_opacity:new f.ab(y),u_image0:new f.a8(y),u_image1:new f.a8(y),u_raster_elevation:new f.ab(y),u_zoom_transition:new f.ab(y),u_merc_center:new f.a9(y),u_cutoff_params:new f.at(y)}),rasterParticleTexture:y=>({u_texture:new f.a8(y),u_opacity:new f.ab(y)}),rasterParticleDraw:y=>({u_particle_texture:new f.a8(y),u_particle_texture_side_len:new f.ab(y),u_tile_offset:new f.a9(y),u_velocity:new f.a8(y),u_color_ramp:new f.a8(y),u_velocity_res:new f.a9(y),u_max_speed:new f.ab(y),u_uv_offset:new f.a9(y),u_data_scale:new f.a9(y),u_data_offset:new f.ab(y),u_particle_pos_scale:new f.ab(y),u_particle_pos_offset:new f.a9(y)}),rasterParticleUpdate:y=>({u_particle_texture:new f.a8(y),u_particle_texture_side_len:new f.ab(y),u_velocity:new f.a8(y),u_velocity_res:new f.a9(y),u_max_speed:new f.ab(y),u_speed_factor:new f.ab(y),u_reset_rate:new f.ab(y),u_rand_seed:new f.ab(y),u_uv_offset:new f.a9(y),u_data_scale:new f.a9(y),u_data_offset:new f.ab(y),u_particle_pos_scale:new f.ab(y),u_particle_pos_offset:new f.a9(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new f.a8(y),u_is_size_feature_constant:new f.a8(y),u_size_t:new f.ab(y),u_size:new f.ab(y),u_camera_to_center_distance:new f.ab(y),u_rotate_symbol:new f.a8(y),u_aspect_ratio:new f.ab(y),u_fade_change:new f.ab(y),u_matrix:new f.a7(y),u_label_plane_matrix:new f.a7(y),u_coord_matrix:new f.a7(y),u_is_text:new f.a8(y),u_pitch_with_map:new f.a8(y),u_texsize:new f.a9(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_camera_forward:new f.ar(y),u_tile_matrix:new f.a7(y),u_up_vector:new f.ar(y),u_ecef_origin:new f.ar(y),u_texture:new f.a8(y),u_icon_transition:new f.ab(y),u_color_adj_mat:new f.a7(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new f.a8(y),u_is_size_feature_constant:new f.a8(y),u_size_t:new f.ab(y),u_size:new f.ab(y),u_camera_to_center_distance:new f.ab(y),u_rotate_symbol:new f.a8(y),u_aspect_ratio:new f.ab(y),u_fade_change:new f.ab(y),u_matrix:new f.a7(y),u_label_plane_matrix:new f.a7(y),u_coord_matrix:new f.a7(y),u_is_text:new f.a8(y),u_pitch_with_map:new f.a8(y),u_texsize:new f.a9(y),u_texture:new f.a8(y),u_gamma_scale:new f.ab(y),u_device_pixel_ratio:new f.ab(y),u_tile_id:new f.ar(y),u_zoom_transition:new f.ab(y),u_inv_rot_matrix:new f.a7(y),u_merc_center:new f.a9(y),u_camera_forward:new f.ar(y),u_tile_matrix:new f.a7(y),u_up_vector:new f.ar(y),u_ecef_origin:new f.ar(y),u_is_halo:new f.a8(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new f.a8(y),u_is_size_feature_constant:new f.a8(y),u_size_t:new f.ab(y),u_size:new f.ab(y),u_camera_to_center_distance:new f.ab(y),u_rotate_symbol:new f.a8(y),u_aspect_ratio:new f.ab(y),u_fade_change:new f.ab(y),u_matrix:new f.a7(y),u_label_plane_matrix:new f.a7(y),u_coord_matrix:new f.a7(y),u_is_text:new f.a8(y),u_pitch_with_map:new f.a8(y),u_texsize:new f.a9(y),u_texsize_icon:new f.a9(y),u_texture:new f.a8(y),u_texture_icon:new f.a8(y),u_gamma_scale:new f.ab(y),u_device_pixel_ratio:new f.ab(y),u_is_halo:new f.a8(y)}),background:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_opacity:new f.ab(y),u_color:new f.aa(y)}),backgroundPattern:y=>({u_matrix:new f.a7(y),u_emissive_strength:new f.ab(y),u_opacity:new f.ab(y),u_image:new f.a8(y),u_pattern_tl:new f.a9(y),u_pattern_br:new f.a9(y),u_texsize:new f.a9(y),u_pattern_size:new f.a9(y),u_pixel_coord_upper:new f.a9(y),u_pixel_coord_lower:new f.a9(y),u_tile_units_to_pixels:new f.ab(y)}),terrainRaster:y=>({u_matrix:new f.a7(y),u_image0:new f.a8(y),u_skirt_height:new f.ab(y),u_ground_shadow_factor:new f.ar(y)}),skybox:y=>({u_matrix:new f.a7(y),u_sun_direction:new f.ar(y),u_cubemap:new f.a8(y),u_opacity:new f.ab(y),u_temporal_offset:new f.ab(y)}),skyboxGradient:y=>({u_matrix:new f.a7(y),u_color_ramp:new f.a8(y),u_center_direction:new f.ar(y),u_radius:new f.ab(y),u_opacity:new f.ab(y),u_temporal_offset:new f.ab(y)}),skyboxCapture:y=>({u_matrix_3f:new f.as(y),u_sun_direction:new f.ar(y),u_sun_intensity:new f.ab(y),u_color_tint_r:new f.at(y),u_color_tint_m:new f.at(y),u_luminance:new f.ab(y)}),globeRaster:y=>({u_proj_matrix:new f.a7(y),u_globe_matrix:new f.a7(y),u_normalize_matrix:new f.a7(y),u_merc_matrix:new f.a7(y),u_zoom_transition:new f.ab(y),u_merc_center:new f.a9(y),u_image0:new f.a8(y),u_grid_matrix:new f.as(y),u_skirt_height:new f.ab(y),u_far_z_cutoff:new f.ab(y),u_frustum_tl:new f.ar(y),u_frustum_tr:new f.ar(y),u_frustum_br:new f.ar(y),u_frustum_bl:new f.ar(y),u_globe_pos:new f.ar(y),u_globe_radius:new f.ab(y),u_viewport:new f.a9(y)}),globeAtmosphere:y=>({u_frustum_tl:new f.ar(y),u_frustum_tr:new f.ar(y),u_frustum_br:new f.ar(y),u_frustum_bl:new f.ar(y),u_horizon:new f.ab(y),u_transition:new f.ab(y),u_fadeout_range:new f.ab(y),u_color:new f.at(y),u_high_color:new f.at(y),u_space_color:new f.at(y),u_temporal_offset:new f.ab(y),u_horizon_angle:new f.ab(y)}),model:y=>({u_matrix:new f.a7(y),u_lighting_matrix:new f.a7(y),u_normal_matrix:new f.a7(y),u_node_matrix:new f.a7(y),u_lightpos:new f.ar(y),u_lightintensity:new f.ab(y),u_lightcolor:new f.ar(y),u_camera_pos:new f.ar(y),u_opacity:new f.ab(y),u_baseColorFactor:new f.at(y),u_emissiveFactor:new f.at(y),u_metallicFactor:new f.ab(y),u_roughnessFactor:new f.ab(y),u_baseTextureIsAlpha:new f.a8(y),u_alphaMask:new f.a8(y),u_alphaCutoff:new f.ab(y),u_baseColorTexture:new f.a8(y),u_metallicRoughnessTexture:new f.a8(y),u_normalTexture:new f.a8(y),u_occlusionTexture:new f.a8(y),u_emissionTexture:new f.a8(y),u_lutTexture:new f.a8(y),u_color_mix:new f.at(y),u_aoIntensity:new f.ab(y),u_emissive_strength:new f.ab(y),u_occlusionTextureTransform:new f.at(y)}),modelDepth:y=>({u_matrix:new f.a7(y),u_instance:new f.a7(y),u_node_matrix:new f.a7(y)}),groundShadow:y=>({u_matrix:new f.a7(y),u_ground_shadow_factor:new f.ar(y)}),stars:y=>({u_matrix:new f.a7(y),u_up:new f.ar(y),u_right:new f.ar(y),u_intensity_multiplier:new f.ab(y)}),occlusion:y=>({u_matrix:new f.a7(y),u_anchorPos:new f.ar(y),u_screenSizePx:new f.a9(y),u_occluderSizePx:new f.a9(y),u_color:new f.at(y)})};function Ts(y,c,p){const v=c.createTileMatrix(y,y.worldSize,p.toUnwrapped());return f.ae.multiply(new Float32Array(16),y.projMatrix,v)}function Qg(y,c,p){if(c.projection.name===p.projection.name)return y.projMatrix;const v=p.clone();return v.setProjection(c.projection),Ts(v,c.getProjection(),y)}function Uv(y,c,p){return c.name===p.projection.name?y.projMatrix:Ts(p,c,y)}let Bf;function zi(y,c,p,v,w,C,M){const I=y.context,P=I.gl,F=y.transform,z=y.getOrCreateProgram("collisionBox"),j=[];let q=0,Z=0;for(let de=0;de<v.length;de++){const be=v[de],_e=c.getTile(be),ye=_e.getBucket(p);if(!ye)continue;const De=Qg(be,ye,F);let Ee=De;0===w[0]&&0===w[1]||(Ee=y.translatePosMatrix(De,_e,w,C));const Be=M?ye.textCollisionBox:ye.iconCollisionBox,ke=ye.collisionCircleArray;if(ke.length>0){const pe=f.ae.create(),Je=Ee;f.ae.mul(pe,ye.placementInvProjMatrix,F.glCoordMatrix),f.ae.mul(pe,pe,ye.placementViewportMatrix),j.push({circleArray:ke,circleOffset:Z,transform:Je,invTransform:pe,projection:ye.getProjection()}),q+=ke.length/4,Z=q}Be&&(y.terrain&&y.terrain.setupElevationDraw(_e,z),z.draw(y,P.LINES,f.af.disabled,f.ah.disabled,y.colorModeForRenderPass(),f.ag.disabled,xm(Ee,F,_e,ye.getProjection()),p.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,F.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!M||!j.length)return;const ne=y.getOrCreateProgram("collisionCircle"),re=new f.bN;re.resize(4*q),re._trim();let ie=0;for(const de of j)for(let be=0;be<de.circleArray.length/4;be++){const _e=4*be,ye=de.circleArray[_e+0],De=de.circleArray[_e+1],Ee=de.circleArray[_e+2],Be=de.circleArray[_e+3];re.emplace(ie++,ye,De,Ee,Be,0),re.emplace(ie++,ye,De,Ee,Be,1),re.emplace(ie++,ye,De,Ee,Be,2),re.emplace(ie++,ye,De,Ee,Be,3)}(!Bf||Bf.length<2*q)&&(Bf=function(de){const be=2*de,_e=new f.bw;_e.resize(be),_e._trim();for(let ye=0;ye<be;ye++){const De=6*ye;_e.uint16[De+0]=4*ye+0,_e.uint16[De+1]=4*ye+1,_e.uint16[De+2]=4*ye+2,_e.uint16[De+3]=4*ye+2,_e.uint16[De+4]=4*ye+3,_e.uint16[De+5]=4*ye+0}return _e}(q));const Q=I.createIndexBuffer(Bf,!0),se=I.createVertexBuffer(re,f.bO.members,!0);for(const de of j){const be={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(ce=F).getCameraToCenterDistance(de.projection),u_viewport_size:[ce.width,ce.height]};ne.draw(y,P.TRIANGLES,f.af.disabled,f.ah.disabled,y.colorModeForRenderPass(),f.ag.disabled,be,p.id,se,Q,f.b.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,F.zoom)}var ce;se.destroy(),Q.destroy()}const Tr=f.ae.create();function wm(y){const c=y._camera.getWorldToCamera(y.worldSize,1),p=f.ae.multiply([],c,y.globeMatrix);f.ae.invert(p,p);const v=[0,0,0],w=[0,1,0,0];return f.aB.transformMat4(w,w,p),v[0]=w[0],v[1]=w[1],v[2]=w[2],f.$.normalize(v,v),v}function nl({width:y,height:c,anchor:p,textOffset:v,textScale:w},C){const{horizontalAlign:M,verticalAlign:I}=f.bS(p),P=-(M-.5)*y,F=-(I-.5)*c,z=f.bR(p,v);return new f.P((P/w+z[0])*C,(F/w+z[1])*C)}function TS(y,c,p,v,w,C,M,I,P,F,z){const j=y.text.placedSymbolArray,q=y.text.dynamicLayoutVertexArray,Z=y.icon.dynamicLayoutVertexArray,ne={},re=y.getProjection(),ie=Uv(I,re,C),Q=C.elevation,se=re.upVectorScale(I.canonical,C.center.lat,C.worldSize).metersToTile;q.clear();for(let ce=0;ce<j.length;ce++){const de=j.get(ce),{tileAnchorX:be,tileAnchorY:_e,numGlyphs:ye}=de,De=de.hidden||!de.crossTileID||y.allowVerticalPlacement&&!de.placedOrientation?null:v[de.crossTileID];if(De){let Ee=0,Be=0,ke=0;if(Q){const Oe=Q?Q.getAtTileOffset(I,be,_e):0,[_t,gt,Wt]=re.upVector(I.canonical,be,_e);Ee=Oe*_t*se,Be=Oe*gt*se,ke=Oe*Wt*se}let[pe,Je,Ke,Pe]=Ec(de.projectedAnchorX+Ee,de.projectedAnchorY+Be,de.projectedAnchorZ+ke,p?ie:M);const pt=vr(C.getCameraToCenterDistance(re),Pe);let mt=w.evaluateSizeForFeature(y.textSizeData,F,de)*pt/f.bP;p&&(mt*=y.tilePixelRatio/P);const He=nl(De,mt);p?(({x:pe,y:Je,z:Ke}=re.projectTilePoint(be+He.x,_e+He.y,I.canonical)),[pe,Je,Ke]=Ec(pe+Ee,Je+Be,Ke+ke,M)):(c&&He._rotate(-C.angle),pe+=He.x,Je+=He.y,Ke=0);const nt=y.allowVerticalPlacement&&de.placedOrientation===f.aF.vertical?Math.PI/2:0;for(let Oe=0;Oe<ye;Oe++)f.aI(q,pe,Je,Ke,nt);z&&de.associatedIconIndex>=0&&(ne[de.associatedIconIndex]={x:pe,y:Je,z:Ke,angle:nt})}else dh(ye,q)}if(z){Z.clear();const ce=y.icon.placedSymbolArray;for(let de=0;de<ce.length;de++){const be=ce.get(de),{numGlyphs:_e}=be,ye=ne[de];if(be.hidden||!ye)dh(_e,Z);else{const{x:De,y:Ee,z:Be,angle:ke}=ye;for(let pe=0;pe<_e;pe++)f.aI(Z,De,Ee,Be,ke)}}y.icon.dynamicLayoutVertexBuffer.updateData(Z)}y.text.dynamicLayoutVertexBuffer.updateData(q)}function Tm(y,c,p,v,w,C,M={}){const I=p.paint.get("icon-translate"),P=p.paint.get("text-translate"),F=p.paint.get("icon-translate-anchor"),z=p.paint.get("text-translate-anchor"),j=p.layout.get("icon-rotation-alignment"),q=p.layout.get("text-rotation-alignment"),Z=p.layout.get("icon-pitch-alignment"),ne=p.layout.get("text-pitch-alignment"),re=p.layout.get("icon-keep-upright"),ie=p.layout.get("text-keep-upright"),Q=p.paint.get("icon-color-saturation"),se=p.paint.get("icon-color-contrast"),ce=p.paint.get("icon-color-brightness-min"),de=p.paint.get("icon-color-brightness-max");p.paint.get("icon-occlusion-opacity").constantOr(0),p.paint.get("text-occlusion-opacity").constantOr(0);const be=y.context,_e=be.gl,ye=y.transform,De="map"===j,Ee="map"===q,Be="map"===Z,ke="map"===ne,pe=void 0!==p.layout.get("symbol-sort-key").constantOr(1);let Je=!1;const Ke=y.depthModeForSublayer(0,f.af.ReadOnly),Pe=[f.ak(ye.center.lng),f.al(ye.center.lat)],pt=p.layout.get("text-variable-anchor"),mt="globe"===ye.projection.name,He=[],nt=[0,-1,0];for(const Oe of v){const _t=c.getTile(Oe),gt=_t.getBucket(p);if(!gt||"mercator"===gt.projection.name&&mt||gt.fullyClipped)continue;const Wt="globe"===gt.projection.name,Vt=Wt?f.a2(ye.zoom):0,bt=Uv(Oe,gt.getProjection(),ye),Qt=ye.calculatePixelsToTileUnitsMatrix(_t),Pn=pt&&gt.hasTextData(),Yn=gt.hasIconTextFit()&&Pn&&gt.hasIconData(),Un=gt.getProjection().createInversionMatrix(ye,Oe.canonical),or=Ir=>{ye.depthOcclusionForSymbolsAndCircles&&(p.hasInitialOcclusionOpacityProperties||y.terrain)&&(Ir.push("DEPTH_D24"),Ir.push("DEPTH_OCCLUSION"))},Kn=()=>{const Ir=De&&"point"!==p.layout.get("symbol-placement"),Sr=[];or(Sr);const tr=Ir||Yn,vs=p.paint.get("icon-image-cross-fade").constantOr(0);y.terrainRenderModeElevated()&&Be&&Sr.push("PITCH_WITH_MAP_TERRAIN"),Wt&&(Sr.push("PROJECTION_GLOBE_VIEW"),tr&&Sr.push("PROJECTED_POS_ON_VIEWPORT")),vs>0&&Sr.push("ICON_TRANSITION"),gt.icon.zOffsetVertexBuffer&&Sr.push("Z_OFFSET"),0===Q&&0===se&&0===ce&&1===de||Sr.push("COLOR_ADJUSTMENT");const Es=gt.icon.programConfigurations.get(p.id),Zo=y.getOrCreateProgram(gt.sdfIcons?"symbolSDF":"symbolIcon",{config:Es,defines:Sr});let yo;const Xo=_t.imageAtlasTexture?_t.imageAtlasTexture.size:[0,0],da=gt.iconSizeData,Ao=f.aE(da,ye.zoom),Yo=Be||0!==ye.pitch,Pt=If(bt,_t.tileID.canonical,Be,De,ye,gt.getProjection(),Qt),fn=Vg(bt,_t.tileID.canonical,Be,De,ye,gt.getProjection(),Qt),Ba=y.translatePosMatrix(fn,_t,I,F,!0),Pi=y.translatePosMatrix(bt,_t,I,F),Qe=tr?Tr:Pt,Mh=De&&!Be&&!Ir;let eu=nt;!mt&&!ye.mercatorFromTransition||De||(eu=wm(ye));const Ah=Wt?eu:nt;if(gt.sdfIcons&&!gt.iconsInText)yo=Ad(da.kind,Ao,Mh,Be,y,Pi,Qe,Ba,!1,Xo,!0,Oe,Vt,Pe,Un,Ah,gt.getProjection());else{const lp=p.getColorAdjustmentMatrix(Q,se,ce,de);yo=Md(da.kind,Ao,Mh,Be,y,Pi,Qe,Ba,!1,Xo,Oe,Vt,Pe,Un,Ah,gt.getProjection(),lp,vs)}const tu=_t.imageAtlasTexture?_t.imageAtlasTexture:null,Um=1!==p.layout.get("icon-size").constantOr(0)||gt.iconsNeedLinear,v1=gt.sdfIcons||y.options.rotating||y.options.zooming||Um||Yo?_e.LINEAR:_e.NEAREST,Ud=gt.sdfIcons&&0!==p.paint.get("icon-halo-width").constantOr(1),nx=y.terrain&&Be&&Ir?f.ae.invert(f.ae.create(),Pt):Tr;if(Ir&&gt.icon){const lp=ye.elevation,p0=lp?lp.getAtTileOffsetFunc(Oe,ye.center.lat,ye.worldSize,gt.getProjection()):null,Vd=Ug(bt,_t.tileID.canonical,Be,De,ye,gt.getProjection(),Qt);hh(gt,bt,y,!1,Vd,fn,Be,re,p0,Oe)}return{program:Zo,buffers:gt.icon,uniformValues:yo,atlasTexture:tu,atlasTextureIcon:null,atlasInterpolation:v1,atlasInterpolationIcon:null,isSDF:gt.sdfIcons,hasHalo:Ud,tile:_t,labelPlaneMatrixInv:nx}},Si=()=>{const Ir=Ee&&"point"!==p.layout.get("symbol-placement"),Sr=[],tr=Ir||pt||Yn;y.terrainRenderModeElevated()&&ke&&Sr.push("PITCH_WITH_MAP_TERRAIN"),Wt&&(Sr.push("PROJECTION_GLOBE_VIEW"),tr&&Sr.push("PROJECTED_POS_ON_VIEWPORT")),gt.text.zOffsetVertexBuffer&&Sr.push("Z_OFFSET"),or(Sr);const vs=gt.text.programConfigurations.get(p.id),Es=y.getOrCreateProgram(gt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:vs,defines:Sr});let Zo,yo=[0,0],Xo=null;const da=gt.textSizeData;gt.iconsInText&&(yo=_t.imageAtlasTexture?_t.imageAtlasTexture.size:[0,0],Xo=_t.imageAtlasTexture?_t.imageAtlasTexture:null,Zo=ke||0!==ye.pitch||y.options.rotating||y.options.zooming||"composite"===da.kind||"camera"===da.kind?_e.LINEAR:_e.NEAREST);const Ao=_t.glyphAtlasTexture?_t.glyphAtlasTexture.size:[0,0],Yo=f.aE(da,ye.zoom),Pt=If(bt,_t.tileID.canonical,ke,Ee,ye,gt.getProjection(),Qt),fn=Vg(bt,_t.tileID.canonical,ke,Ee,ye,gt.getProjection(),Qt),Ba=y.translatePosMatrix(fn,_t,P,z,!0),Pi=y.translatePosMatrix(bt,_t,P,z),Qe=tr?Tr:Pt,Mh=Ee&&!ke&&!Ir;let eu=nt;!mt&&!ye.mercatorFromTransition||Ee||(eu=wm(ye));const Ah=Wt?eu:nt;let tu;tu=gt.iconsInText?yh(da.kind,Yo,Mh,ke,y,Pi,Qe,Ba,Ao,yo,Oe,Vt,Pe,Un,Ah,gt.getProjection()):Ad(da.kind,Yo,Mh,ke,y,Pi,Qe,Ba,!0,Ao,!0,Oe,Vt,Pe,Un,Ah,gt.getProjection());const Um=_t.glyphAtlasTexture?_t.glyphAtlasTexture:null,v1=_e.LINEAR,Ud=0!==p.paint.get("text-halo-width").constantOr(1),nx=y.terrain&&ke&&Ir?f.ae.invert(f.ae.create(),Pt):Tr;if(Ir&&gt.text){const lp=ye.elevation,p0=lp?lp.getAtTileOffsetFunc(Oe,ye.center.lat,ye.worldSize,gt.getProjection()):null,Vd=Ug(bt,_t.tileID.canonical,ke,Ee,ye,gt.getProjection(),Qt);hh(gt,bt,y,!0,Vd,fn,ke,ie,p0,Oe)}return{program:Es,buffers:gt.text,uniformValues:tu,atlasTexture:Um,atlasTextureIcon:Xo,atlasInterpolation:v1,atlasInterpolationIcon:Zo,isSDF:!0,hasHalo:Ud,tile:_t,labelPlaneMatrixInv:nx}},wr=gt.icon.segments.get().length,ur=gt.text.segments.get().length,ni=wr&&!M.onlyText?Kn():null,dr=ur&&!M.onlyIcons?Si():null,xr=p.paint.get("icon-opacity").constantOr(1),Zn=p.paint.get("text-opacity").constantOr(1);if(pe&&gt.canOverlap){Je=!0;const Ir=xr&&!M.onlyText?gt.icon.segments.get():[],Sr=Zn&&!M.onlyIcons?gt.text.segments.get():[];for(const tr of Ir)He.push({segments:new f.b([tr]),sortKey:tr.sortKey,state:ni});for(const tr of Sr)He.push({segments:new f.b([tr]),sortKey:tr.sortKey,state:dr})}else M.onlyText||He.push({segments:xr?gt.icon.segments:new f.b([]),sortKey:0,state:ni}),M.onlyIcons||He.push({segments:Zn?gt.text.segments:new f.b([]),sortKey:0,state:dr})}Je&&He.sort((Oe,_t)=>Oe.sortKey-_t.sortKey);for(const Oe of He){const _t=Oe.state;if(_t)if(y.terrain?y.terrain.setupElevationDraw(_t.tile,_t.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:_t.labelPlaneMatrixInv}):y.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,_t.program),be.activeTexture.set(_e.TEXTURE0),_t.atlasTexture&&_t.atlasTexture.bind(_t.atlasInterpolation,_e.CLAMP_TO_EDGE,!0),_t.atlasTextureIcon&&(be.activeTexture.set(_e.TEXTURE1),_t.atlasTextureIcon&&_t.atlasTextureIcon.bind(_t.atlasInterpolationIcon,_e.CLAMP_TO_EDGE,!0)),y.uploadCommonLightUniforms(y.context,_t.program),_t.hasHalo){const gt=_t.uniformValues;gt.u_is_halo=1,Vv(_t.buffers,Oe.segments,p,y,_t.program,Ke,w,C,gt,2),gt.u_is_halo=0}else{if(_t.isSDF){const gt=_t.uniformValues;_t.hasHalo&&(gt.u_is_halo=1,Vv(_t.buffers,Oe.segments,p,y,_t.program,Ke,w,C,gt,1)),gt.u_is_halo=0}Vv(_t.buffers,Oe.segments,p,y,_t.program,Ke,w,C,_t.uniformValues,1)}}}function Vv(y,c,p,v,w,C,M,I,P,F){const z=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.iconTransitioningVertexBuffer,y.globeExtVertexBuffer,y.zOffsetVertexBuffer];w.draw(v,v.context.gl.TRIANGLES,C,M,I,f.ag.disabled,P,p.id,y.layoutVertexBuffer,y.indexBuffer,c,p.paint,v.transform.zoom,y.programConfigurations.get(p.id),z,F)}function tc(y,c,p,v,w,C,M){const I=y.context.gl,P=p.paint.get("fill-pattern"),F=P&&P.constantOr(1);let z,j,q,Z,ne;M?(j=F&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=I.LINES):(j=F?"fillPattern":"fill",z=I.TRIANGLES);for(const re of v){const ie=c.getTile(re);if(F&&!ie.patternsLoaded())continue;const Q=ie.getBucket(p);if(!Q)continue;y.prepareDrawTile();const se=Q.programConfigurations.get(p.id),ce=y.isTileAffectedByFog(re),de=y.getOrCreateProgram(j,{config:se,overrideFog:ce});F&&(y.context.activeTexture.set(I.TEXTURE0),ie.imageAtlasTexture&&ie.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),se.updatePaintBuffers());const be=P.constantOr(null);if(be&&ie.imageAtlas){const De=ie.imageAtlas.patternPositions[be.toString()];De&&se.setConstantPatternPositions(De)}const _e=y.translatePosMatrix(re.projMatrix,ie,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor")),ye=p.paint.get("fill-emissive-strength");if(M){Z=Q.indexBuffer2,ne=Q.segments2;const De=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];q="fillOutlinePattern"===j&&F?Jg(_e,ye,y,ie,De):n1(_e,ye,De)}else Z=Q.indexBuffer,ne=Q.segments,q=F?t1(_e,ye,y,ie):Kg(_e,ye);y.uploadCommonUniforms(y.context,de,re.toUnwrapped()),de.draw(y,z,w,y.stencilModeForClipping(re),C,f.ag.disabled,q,p.id,Q.layoutVertexBuffer,Z,ne,p.paint,y.transform.zoom,se,void 0)}}function zf(y,c,p,v,w,C,M,I){p.resetLayerRenderingStats(y);const P=y.context,F=P.gl,z=y.transform,j=p.paint.get("fill-extrusion-pattern"),q=j.constantOr(1),Z=p.paint.get("fill-extrusion-opacity"),ne=y.style.enable3dLights(),re=p.paint.get(ne&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),re],Q=p.layout.get("fill-extrusion-edge-radius"),se=Q>0&&!p.paint.get("fill-extrusion-rounded-roof"),ce=se?0:Q,de="globe"===z.projection.name?f.b_():0,be="globe"===z.projection.name,_e=be?f.a2(z.zoom):0,ye=[f.ak(z.center.lng),f.al(z.center.lat)],De=p.paint.get("fill-extrusion-flood-light-color").toRenderColor(p.lut).toArray01().slice(0,3),Ee=p.paint.get("fill-extrusion-flood-light-intensity"),Be=p.paint.get("fill-extrusion-vertical-scale"),ke=0!==p.paint.get("fill-extrusion-line-width").constantOr(1),pe=Ra(y,p.paint.get("fill-extrusion-cutoff-fade-range")),Je=p.paint.get("fill-extrusion-emissive-strength"),Ke=[];be&&Ke.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&Ke.push("FAUX_AO"),se&&Ke.push("ZERO_ROOF_RADIUS"),I&&Ke.push("HAS_CENTROID"),Ee>0&&Ke.push("FLOOD_LIGHT"),pe.shouldRenderCutoff&&Ke.push("RENDER_CUTOFF"),ke&&Ke.push("RENDER_WALL_MODE");const Pe=(()=>{const Wt=p.paint.get("fill-extrusion-line-alignment");switch(Wt){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return f.w(`Unsupported value for fill-extrusion-line-alignment: ${Wt}`),0}})();let pt;const mt="shadow"===y.renderPass,He=y.shadowRenderer,nt=mt&&!!He;y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!0);let Oe=[0,0,0];if(He){const Wt=y.style.directionalLight,Vt=y.style.ambientLight;Wt&&Vt&&(Oe=_m(y.style,Wt,Vt)),pt=Ke.concat(["SHADOWS_SINGLE_CASCADE"])}const _t=nt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",gt=p.getLayerRenderingStats();for(const Wt of v){const Vt=c.getTile(Wt),bt=Vt.getBucket(p);if(!bt||bt.projection.name!==z.projection.name)continue;let Qt=!1;He&&(Qt=0===He.getMaxCascadeForTile(Wt.toUnwrapped()));const Pn=y.isTileAffectedByFog(Wt),Yn=bt.programConfigurations.get(p.id),Un=y.getOrCreateProgram(_t,{config:Yn,defines:Qt?pt:Ke,overrideFog:Pn});if(y.terrain&&y.terrain.setupElevationDraw(Vt,Un,{useMeterToDem:!0}),!bt.centroidVertexBuffer){const dr=Un.attributes.a_centroid_pos;void 0!==dr&&F.vertexAttrib2f(dr,0,0)}!mt&&He&&He.setupShadows(Vt.tileID.toUnwrapped(),Un,"vector-tile",Vt.tileID.overscaledZ),q&&(y.context.activeTexture.set(F.TEXTURE0),Vt.imageAtlasTexture&&Vt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Yn.updatePaintBuffers());const or=j.constantOr(null);if(or&&Vt.imageAtlas){const dr=Vt.imageAtlas.patternPositions[or.toString()];dr&&Yn.setConstantPatternPositions(dr)}const Kn=p.paint.get("fill-extrusion-vertical-gradient"),Si=1/bt.tileToMeter;let wr;if(mt&&He){if(Yc(Vt.tileID,bt,y))continue;const dr=He.calculateShadowPassMatrixFromTile(Vt.tileID.toUnwrapped());wr=e1(dr,ce,Pe,Si,Be)}else{const dr=y.translatePosMatrix(Wt.expandedProjMatrix,Vt,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),xr=z.projection.createInversionMatrix(z,Wt.canonical);wr=q?Qw(dr,y,Kn,Z,ie,ce,Pe,Si,Wt,Vt,de,_e,ye,xr,De,Be):Cu(dr,y,Kn,Z,ie,ce,Pe,Si,Wt,de,_e,ye,xr,De,Be,Ee,Oe,Je)}y.uploadCommonUniforms(P,Un,Wt.toUnwrapped(),null,pe);let ur=bt.segments;if("mercator"===z.projection.name&&!mt&&(ur=bt.getVisibleSegments(Vt.tileID,y.terrain,y.transform.getFrustum(0)),!ur.get().length))continue;if(gt)if(mt)for(const dr of ur.get())gt.numRenderedVerticesInShadowPass+=dr.primitiveLength;else for(const dr of ur.get())gt.numRenderedVerticesInTransparentPass+=dr.primitiveLength;const ni=[];(y.terrain||I)&&ni.push(bt.centroidVertexBuffer),be&&ni.push(bt.layoutVertexExtBuffer),ke&&ni.push(bt.wallVertexBuffer),Un.draw(y,P.gl.TRIANGLES,w,C,M,f.ag.backCCW,wr,p.id,bt.layoutVertexBuffer,bt.indexBuffer,ur,p.paint,y.transform.zoom,Yn,ni)}y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!1)}function Em(y,c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie,Q,se){const ce=y.context,de=ce.gl,be=y.transform,_e=y.transform.zoom,ye=[],De=Ra(y,p.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===F?(ye.push("CLEAR_SUBPASS"),se&&(ye.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(de.TEXTURE0),se.bind(de.LINEAR,de.CLAMP_TO_EDGE))):"sdf"===F&&ye.push("SDF_SUBPASS"),ie&&ye.push("HAS_CENTROID"),De.shouldRenderCutoff&&ye.push("RENDER_CUTOFF");const Ee=p.layout.get("fill-extrusion-edge-radius"),Be=(ke,pe,Je,Ke,Pe)=>{const pt=pe.programConfigurations.get(p.id),mt=y.isTileAffectedByFog(ke),He=y.getOrCreateProgram("fillExtrusionGroundEffect",{config:pt,defines:ye,overrideFog:mt}),nt=((_t,gt,Wt,Vt,bt,Qt,Pn,Yn,Un,or,Kn)=>({u_matrix:gt,u_opacity:Wt,u_ao_pass:Vt?1:0,u_meter_to_tile:bt,u_ao:Qt,u_flood_light_intensity:Pn,u_flood_light_color:Yn,u_attenuation:Un,u_edge_radius:or,u_fb:0,u_fb_size:Kn}))(0,Ke,z,P,Pe,[j,q*Pe],Z,ne,re,_e>=17?0:Ee*Pe,se?se.size[0]:0),Oe=[];ie&&Oe.push(pe.hiddenByLandmarkVertexBuffer),y.uploadCommonUniforms(ce,He,ke.toUnwrapped(),null,De),He.draw(y,ce.gl.TRIANGLES,w,C,M,I,nt,p.id,pe.vertexBuffer,pe.indexBuffer,Je,p.paint,_e,pt,Oe)};for(const ke of v){const pe=c.getTile(ke),Je=pe.getBucket(p);if(!Je||Je.projection.name!==be.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const Ke=Je.groundEffect,Pe=1/Je.tileToMeter;{const pt=y.translatePosMatrix(ke.projMatrix,pe,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),mt=Ke.getDefaultSegment();Be(ke,Ke,mt,pt,Pe)}if(Q)for(let pt=0;pt<4;pt++){const mt=f.b$[pt](ke),He=c.getTile(mt);if(!He)continue;const nt=He.getBucket(p);if(!nt||nt.projection.name!==be.projection.name||!nt.groundEffect||nt.groundEffect&&!nt.groundEffect.hasData())continue;const Oe=nt.groundEffect;let _t,gt;0===pt?(_t=[-f.a4,0,0],gt=1):1===pt?(_t=[f.a4,0,0],gt=0):2===pt?(_t=[0,-f.a4,0],gt=3):(_t=[0,f.a4,0],gt=2);const Wt=Oe.regionSegments[gt];if(!Wt)continue;const Vt=new Float32Array(16);f.ae.translate(Vt,ke.projMatrix,_t),Be(ke,Oe,Wt,y.translatePosMatrix(Vt,pe,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Pe)}}}function ES(y,c,p,v,w,C,M){0===v.centroidVertexArray.length&&v.createCentroidsBuffer();const I=C?C.findDEMTileFor(p):null;if(!(I&&I.dem||M))return;const P=Q=>new f.P(Math.ceil((Q+f.c2)*f.c3),0),F=Q=>{const se=c.getSource().minzoom,ce=be=>{const _e=c.getTileByID(be);if(_e&&_e.hasData())return _e.getBucket(w)},de=[0,-1,1];for(const be of de){if(Q.overscaledZ+be<se)continue;const _e=ce(Q.calculateScaledKey(Q.overscaledZ+be));if(_e)return _e}},z=[0,0,0],j=(Q,se)=>(z[0]=Math.min(Q.min.y,se.min.y),z[1]=Math.max(Q.max.y,se.max.y),z[2]=f.a4-se.min.x>Q.max.x?se.min.x-f.a4:Q.max.x,z),q=(Q,se)=>(z[0]=Math.min(Q.min.x,se.min.x),z[1]=Math.max(Q.max.x,se.max.x),z[2]=f.a4-se.min.y>Q.max.y?se.min.y-f.a4:Q.max.y,z),Z=[(Q,se)=>j(Q,se),(Q,se)=>j(se,Q),(Q,se)=>q(Q,se),(Q,se)=>q(se,Q)],ne=(Q,se,ce,de,be,_e,ye)=>{if(!C)return 0;const De=[[_e?ce:Q,_e?Q:ce,0],[_e?ce:se,_e?se:ce,0]],Ee=ye<0?f.a4+ye:ye,Be=[_e?Ee:(Q+se)/2,_e?(Q+se)/2:Ee,0];return 0===ce&&ye<0||0!==ce&&ye>0?C.getForTilePoints(be,[Be],!0,de):De.push(Be),C.getForTilePoints(p,De,!0,I),Math.max(De[0][2],De[1][2],Be[2])/C.exaggeration()};for(let Q=0;Q<4;Q++){const se=v.borderFeatureIndices[Q];if(0===se.length)continue;const ce=f.b$[Q](p),de=F(ce);if(!(de&&de instanceof f.c0)||v.borderDoneWithNeighborZ[Q]===de.canonical.z)continue;0===de.centroidVertexArray.length&&de.createCentroidsBuffer();const be=C?C.findDEMTileFor(ce):null;if(!(be&&be.dem||M))continue;const _e=(Q<2?1:5)-Q,ye=de.borderDoneWithNeighborZ[_e]!==v.canonical.z,De=de.borderFeatureIndices[_e];let Ee=0;if(v.canonical.z!==de.canonical.z){for(const Be of se)v.showCentroid(v.featuresOnBorder[Be]);if(ye)for(const Be of De)de.showCentroid(de.featuresOnBorder[Be]);v.borderDoneWithNeighborZ[Q]=de.canonical.z,de.borderDoneWithNeighborZ[_e]=v.canonical.z}for(const Be of se){const ke=v.featuresOnBorder[Be],pe=v.centroidData[ke.centroidDataIndex],Je=ke.borders[Q];let Ke;for(;Ee<De.length;){Ke=de.featuresOnBorder[De[Ee]];const Pe=Ke.borders[_e];if(Pe[1]>Je[0]+3||Pe[0]>Je[0]-3)break;de.showCentroid(Ke),Ee++}if(Ke&&Ee<De.length){const Pe=Ee;let pt=0;for(;!(Ke.borders[_e][0]>Je[1]-3)&&(pt++,++Ee!==De.length);)Ke=de.featuresOnBorder[De[Ee]];if(Ke=de.featuresOnBorder[De[Pe]],pt>1){const nt=Ke.borders[_e];Math.abs(Je[0]-nt[0])<3&&Math.abs(Je[1]-nt[1])<3&&(pt=1,Ee=Pe+1)}else if(0===pt){v.showCentroid(ke);continue}const mt=de.centroidData[Ke.centroidDataIndex];M&&1===pt&&(((re=pe).flags|(ie=mt).flags)&f.c1?(re.flags|=f.c1,ie.flags|=f.c1):(re.flags&=~f.c1,ie.flags&=~f.c1));const He=ke.intersectsCount()>1||Ke.intersectsCount()>1;if(pt>1)Ee=Pe,pe.centroidXY=mt.centroidXY=new f.P(0,0);else if(be&&be.dem&&!He){const nt=Z[Q](pe,mt),Oe=Q%2?f.a4-1:0,_t=ne(nt[0],Math.min(f.a4-1,nt[1]),Oe,be,ce,Q<2,nt[2]);pe.centroidXY=mt.centroidXY=P(_t)}else He?pe.centroidXY=mt.centroidXY=new f.P(0,0):(pe.centroidXY=v.encodeBorderCentroid(ke),mt.centroidXY=de.encodeBorderCentroid(Ke));v.writeCentroidToBuffer(pe),de.writeCentroidToBuffer(mt)}else v.showCentroid(ke)}v.borderDoneWithNeighborZ[Q]=de.canonical.z,de.borderDoneWithNeighborZ[_e]=v.canonical.z}var re,ie;(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(y)}const eT=[1,0,0],tT=[0,1,0],i1=[0,0,1];function Yc(y,c,p){const v=p.transform,w=p.shadowRenderer;if(!w)return!0;const C=y.toUnwrapped(),M=v.tileSize*w._cascades[p.currentShadowCascade].scale;let I=c.maxHeight;if(v.elevation){const re=v.elevation.getMinMaxForTile(y);re&&(I+=re.max)}const P=[...w.shadowDirection];P[2]=-P[2];const F=w.computeSimplifiedTileShadowVolume(C,I,M,P);if(!F)return!1;const z=[eT,tT,i1,P,[P[0],0,P[2]],[0,P[1],P[2]]],j="globe"===v.projection.name,q=v.scaleZoom(M),Z=f.aM.fromInvProjectionMatrix(v.invProjMatrix,v.worldSize,q,!j),ne=w.getCurrentCascadeFrustum();return 0===Z.intersectsPrecise(F.vertices,F.planes,z)||0===ne.intersectsPrecise(F.vertices,F.planes,z)}function e0(y){return[y[0]*f.c4,y[1]*f.c4,y[2]*f.c4,0]}function la(y,c,p,v,w,C,M,I,P){const F=v.getSource(),z=p.globeSharedBuffers;if(!z)return;let j,q,Z;if(c&&(j=v.getTile(c)),F instanceof f.bo?(q=F.texture,Z=f.bj(0,0,p.transform)):j&&c&&(q=j.texture,Z=f.bj(c.canonical.z,c.canonical.x,p.transform)),!q||!Z)return;y||(Z=f.ae.scale(f.ae.create(),Z,[1,-1,1]));const ne=p.context,re=ne.gl,ie="nearest"===w.paint.get("raster-resampling")?re.NEAREST:re.LINEAR,Q=p.colorModeForDrapableLayerRenderPass(C),se=M.defines;se.push("GLOBE_POLES");const ce=new f.af(re.LEQUAL,f.af.ReadWrite,p.depthRangeFor3D),de=Float32Array.from(p.transform.expandedFarZProjMatrix),be=Float32Array.from(f.bh(f.bi(new f.aO(0,0,0))));p.terrain&&p.terrain.prepareDrawTile(),ne.activeTexture.set(re.TEXTURE0),q.bind(ie,re.CLAMP_TO_EDGE),ne.activeTexture.set(re.TEXTURE1),q.bind(ie,re.CLAMP_TO_EDGE),q.useMipmap&&ne.extTextureFilterAnisotropic&&p.transform.pitch>20&&re.texParameterf(re.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);const[_e,ye,De,Ee]=c?z.getPoleBuffers(c.canonical.z,!1):z.getPoleBuffers(0,!0),Be=w.paint.get("raster-elevation");let ke;y?(ke=_e,p.renderDefaultNorthPole=0!==Be):(ke=ye,p.renderDefaultSouthPole=0!==Be);const pe=e0(M.mix),Je=(Pe=de,pt=be,mt=Z,He=f.a2(p.transform.zoom),Oe=w,gt=Be,Vt=pe,bt=M.offset,Qt=M.range,Pn=C,r1(Pe,pt,mt,new Float32Array(16),new Float32Array(9),[0,0],He,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Oe,[0,0],gt,2,Vt,bt,Qt,1,0,Pn)),Ke=p.getOrCreateProgram("raster",{defines:se});var Pe,pt,mt,He,Oe,gt,Vt,bt,Qt,Pn;p.uploadCommonUniforms(ne,Ke,null),Ke.draw(p,re.TRIANGLES,ce,P,Q,I,Je,w.id,ke,De,Ee)}function Er(y){const c=y._nearZ,p=y.projection.farthestPixelDistance(y),v=p-c,w=.2*y.height,C=c+w;return[c,p,(C-w-c)/v,(C-c)/v]}function Uf(y,c,p,v){if(y)return c instanceof gh&&y instanceof f.c5?c.getTextureDescriptor(y,p,!0):{texture:y.texture,mix:e0(v.mix),offset:v.offset,buffer:0,tileSize:1}}function nT(y,c,p){if(!y)return null;const v=c.getTextureDescriptor(y,p,!0);if(!v)return null;let{texture:w,mix:C,offset:M,tileSize:I,buffer:P,format:F}=v;if(!w||!F)return null;let z=!1;return"uint32"===F&&(z=!0,C[3]=0,C=Pf(f.c6,C,[0,p.paint.get("raster-particle-max-speed")]),M=Nf(f.c6,M,[0,p.paint.get("raster-particle-max-speed")])),{texture:w,textureOffset:[P/(I+2*P),I/(I+2*P)],tileSize:I,scalarData:z,scale:C,offset:M,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[F]]}}function s1(y){const c=y._nearZ,p=y.projection.farthestPixelDistance(y),v=p-c,w=.2*y.height,C=c+w;return[c,p,(C-w-c)/v,(C-c)/v]}const jv=new f.C(1,0,0,1),o1=new f.C(0,1,0,1),sn=new f.C(0,0,1,1),Jr=new f.C(1,0,1,1),Ui=new f.C(0,1,1,1);function Fn(y,c,p,v,w,C,M){const I=y.context,P=y.transform,F=I.gl,z="globe"===P.projection.name,j=z?["PROJECTION_GLOBE_VIEW"]:[];let q=f.ae.clone(p.projMatrix);if(z&&f.a2(P.zoom)>0){const pe=f.c7(p.canonical,P),Je=f.c8(pe);q=f.ae.multiply(new Float32Array(16),P.globeMatrix,Je),f.ae.multiply(q,P.projMatrix,q)}const Z=f.ae.create();Z[12]+=2*w/(f.e.devicePixelRatio*P.width),Z[13]+=2*C/(f.e.devicePixelRatio*P.height),f.ae.multiply(q,Z,q);const ne=y.getOrCreateProgram("debug",{defines:j}),re=c.getTileByID(p.key);y.terrain&&y.terrain.setupElevationDraw(re,ne);const ie=f.af.disabled,Q=f.ah.disabled,se=y.colorModeForRenderPass();I.activeTexture.set(F.TEXTURE0),y.emptyTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),z?re._makeGlobeTileDebugBuffers(y.context,P):re._makeDebugTileBoundsBuffers(y.context,P.projection);const de=re._tileDebugBuffer||y.debugBuffer,be=re._tileDebugIndexBuffer||y.debugIndexBuffer,_e=re._tileDebugSegments||y.debugSegments;if(ne.draw(y,F.LINE_STRIP,ie,Q,se,f.ag.disabled,bm(q,v),"$debug",de,be,_e,null,null,null,[re._globeTileDebugBorderBuffer]),M){const pe=re.latestRawTileData,Je=Math.floor((pe&&pe.byteLength||0)/1024);let Ke=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Ke+=` => ${p.overscaledZ}`),Ke+=` ${re.state}`,Ke+=` ${Je}kb`,function(Pe,pt){Pe.initDebugOverlayCanvas();const mt=Pe.debugOverlayCanvas,He=Pe.context.gl,nt=Pe.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,mt.width,mt.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(pt,5,5),nt.strokeText(pt,5,5),Pe.debugOverlayTexture.update(mt),Pe.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(y,Ke)}const ye=c.getTile(p).tileSize,De=512/Math.min(ye,512)*(p.overscaledZ/P.zoom)*.5,Ee=re._tileDebugTextBuffer||y.debugBuffer,Be=re._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,ke=re._tileDebugTextSegments||y.debugSegments;ne.draw(y,F.TRIANGLES,ie,Q,f.a.alphaBlended,f.ag.disabled,bm(q,f.C.transparent,De),"$debug",Ee,Be,ke,null,null,null,[re._globeTileDebugTextBuffer])}function a1(y,c,p,v){jf(y,0,c+p/2,y.transform.width,p,v)}function Vf(y,c,p,v){jf(y,c-p/2,0,p,y.transform.height,v)}function jf(y,c,p,v,w,C){const M=y.context,I=M.gl;I.enable(I.SCISSOR_TEST),I.scissor(c*f.e.devicePixelRatio,p*f.e.devicePixelRatio,v*f.e.devicePixelRatio,w*f.e.devicePixelRatio),M.clear({color:C}),I.disable(I.SCISSOR_TEST)}const Al=f.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$f}=Al;function Na(y,c,p,v){y.emplaceBack(c,p,v)}class ln{constructor(c){this.vertexArray=new f.ca,this.indices=new f.bw,Na(this.vertexArray,-1,-1,1),Na(this.vertexArray,1,-1,1),Na(this.vertexArray,-1,1,1),Na(this.vertexArray,1,1,1),Na(this.vertexArray,-1,-1,-1),Na(this.vertexArray,1,-1,-1),Na(this.vertexArray,-1,1,-1),Na(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,$f),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=f.b.simpleSegment(0,0,36,12)}}function Fr(y,c,p,v,w,C){const M=y.context.gl,I=c.paint.get("sky-atmosphere-color"),P=c.paint.get("sky-atmosphere-halo-color"),F=c.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:f.bE.fromMat4(f.bE.create(),v),u_sun_direction:w,u_sun_intensity:F,u_color_tint_r:[(ne=I).r,ne.g,ne.b,ne.a],u_color_tint_m:[(re=P).r,re.g,re.b,re.a],u_luminance:5e-5};var ne,re;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+C,c.skyboxTexture,0),p.draw(y,M.TRIANGLES,f.af.disabled,f.ah.disabled,f.a.unblended,f.ag.frontCW,z,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Gt=f.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class rl{constructor(c){const p=new f.cb;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const v=new f.bw;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(p,Gt.members),this.indexBuffer=c.createIndexBuffer(v),this.segments=f.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const vh=f.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Hr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Hf{constructor(c){this.colorModeAlphaBlendedWriteRGB=new f.a([f.cc,f.cd,f.cc,f.cd],f.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new f.a([f.cc,f.ce,f.cc,f.ce],f.C.transparent,[!1,!1,!1,!0]),this.params=new Hr,this.updateNeeded=!0,c.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),c.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),c.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),c.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(c){const p=c.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new rl(p);const v=this.params.sizeRange,w=this.params.intensityRange,C=function(z){const j=f.ch(30),q=[];for(let Z=0;Z<z;++Z){const ne=2*Math.PI*j(),re=Math.acos(1-2*j())-.5*Math.PI;q.push(f.$.fromValues(Math.cos(re)*Math.cos(ne),Math.cos(re)*Math.sin(ne),Math.sin(re)))}return q}(this.params.starsCount),M=f.ch(300),I=new f.cf,P=new f.bw;let F=0;for(let z=0;z<C.length;++z){const j=f.$.scale([],C[z],200),q=Math.max(0,1+.01*v*(1*M()-.5)),Z=Math.max(0,1+.01*w*(1*M()-.5));I.emplaceBack(j[0],j[1],j[2],-1,-1,q,Z),I.emplaceBack(j[0],j[1],j[2],1,-1,q,Z),I.emplaceBack(j[0],j[1],j[2],1,1,q,Z),I.emplaceBack(j[0],j[1],j[2],-1,1,q,Z),P.emplaceBack(F+0,F+1,F+2),P.emplaceBack(F+0,F+2,F+3),F+=4}this.starsVx=p.createVertexBuffer(I,vh.members),this.starsIdx=p.createIndexBuffer(P),this.starsSegments=f.b.simpleSegment(0,0,I.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(c,p){const v=c.context,w=v.gl,C=c.transform,M=new f.af(w.LEQUAL,f.af.ReadOnly,[0,1]),I=f.a2(C.zoom),P=c.style.getLut(p.scope),F=p.properties.get("color").toRenderColor(P).toArray01(),z=p.properties.get("high-color").toRenderColor(P).toArray01(),j=p.properties.get("space-color").toRenderColor(P).toArray01PremultipliedAlpha(),q=5e-4,Z=f.cg(p.properties.get("horizon-blend"),0,1,q,.25),ne=f.bc(c,v,C)&&Z===q?C.worldSize/(2*Math.PI*1.025)-1:C.globeRadius,re=c.frameCounter/1e3%1,ie=f.$.length(C.globeCenterInViewSpace),Q=Math.sqrt(Math.pow(ie,2)-Math.pow(ne,2)),se=Math.acos(Q/ie),ce=de=>{const be="globe"===C.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];de&&be.push("ALPHA_PASS");const _e=c.getOrCreateProgram("globeAtmosphere",{defines:be}),ye=((Ee,Be,ke,pe,Je,Ke,Pe,pt,mt,He,nt,Oe)=>({u_frustum_tl:Ee,u_frustum_tr:Be,u_frustum_br:ke,u_frustum_bl:pe,u_horizon:Je,u_transition:Ke,u_fadeout_range:Pe,u_color:pt,u_high_color:mt,u_space_color:He,u_temporal_offset:nt,u_horizon_angle:Oe}))(C.frustumCorners.TL,C.frustumCorners.TR,C.frustumCorners.BR,C.frustumCorners.BL,C.frustumCorners.horizon,I,Z,F,z,j,re,se);c.uploadCommonUniforms(v,_e);const De=this.atmosphereBuffer;De&&_e.draw(c,w.TRIANGLES,M,f.ah.disabled,de?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,f.ag.backCW,ye,de?"atmosphere_glow_alpha":"atmosphere_glow",De.vertexBuffer,De.indexBuffer,De.segments)};ce(!1),ce(!0)}drawStars(c,p){const v=f.au(p.properties.get("star-intensity"),0,1);if(0===v)return;const w=c.context,C=w.gl,M=c.transform,I=c.getOrCreateProgram("stars"),P=f.aw.identity([]);f.aw.rotateX(P,P,-M._pitch),f.aw.rotateZ(P,P,-M.angle),f.aw.rotateX(P,P,f.ac(M._center.lat)),f.aw.rotateY(P,P,-f.ac(M._center.lng));const F=f.ae.fromQuat(new Float32Array(16),P),z=f.ae.multiply([],M.starsProjMatrix,F),j=f.bE.fromMat4([],F),q=f.bE.invert([],j),Z=[0,1,0];f.$.transformMat3(Z,Z,q),f.$.scale(Z,Z,this.params.sizeMultiplier);const ne=[1,0,0];f.$.transformMat3(ne,ne,q),f.$.scale(ne,ne,this.params.sizeMultiplier);const re=(ie=Z,Q=ne,se=v,{u_matrix:Float32Array.from(z),u_up:ie,u_right:Q,u_intensity_multiplier:se});var ie,Q,se;c.uploadCommonUniforms(w,I),this.starsVx&&this.starsIdx&&I.draw(c,C.TRIANGLES,f.af.disabled,f.ah.disabled,this.colorModeAlphaBlendedWriteRGB,f.ag.disabled,re,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Gf(y,c){const p=[...y],v=c.cameraWorldSizeForFog/c.worldSize,w=f.ae.identity([]);return f.ae.scale(w,w,[v,v,1]),f.ae.multiply(p,w,p),f.ae.multiply(p,c.worldToFogMatrix,p),p}function Su(y,c,p,v,w){const C=p.material,M=v.context,{baseColorTexture:I,metallicRoughnessTexture:P}=C.pbrMetallicRoughness,{normalTexture:F,occlusionTexture:z,emissionTexture:j}=C;function q(Z,ne,re){if(Z&&(y.push(ne),M.activeTexture.set(M.gl.TEXTURE0+re),Z.gfxTexture)){const{minFilter:ie,magFilter:Q,wrapS:se,wrapT:ce}=Z.sampler;Z.gfxTexture.bindExtraParam(ie,Q,se,ce)}}q(I,"HAS_TEXTURE_u_baseColorTexture",_o.BaseColor),q(P,"HAS_TEXTURE_u_metallicRoughnessTexture",_o.MetallicRoughness),q(F,"HAS_TEXTURE_u_normalTexture",_o.Normal),q(z,"HAS_TEXTURE_u_occlusionTexture",_o.Occlusion),q(j,"HAS_TEXTURE_u_emissionTexture",_o.Emission),w&&(w.texture||(w.texture=new f.cj(v.context,w.image,[w.image.height,w.image.height,w.image.height],M.gl.RGBA)),M.activeTexture.set(M.gl.TEXTURE0+_o.LUT),w.texture&&w.texture.bind(M.gl.LINEAR,M.gl.CLAMP_TO_EDGE),y.push("APPLY_LUT_ON_GPU")),p.texcoordBuffer&&(y.push("HAS_ATTRIBUTE_a_uv_2f"),c.push(p.texcoordBuffer)),p.colorBuffer&&(y.push(12===p.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),c.push(p.colorBuffer)),p.normalBuffer&&(y.push("HAS_ATTRIBUTE_a_normal_3f"),c.push(p.normalBuffer)),p.pbrBuffer&&(y.push("HAS_ATTRIBUTE_a_pbr"),y.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),c.push(p.pbrBuffer)),"OPAQUE"!==C.alphaMode&&"MASK"!==C.alphaMode||y.push("UNPREMULT_TEXTURE_IN_SHADER"),C.defined||y.push("DIFFUSE_SHADED"),y.push("USE_STANDARD_DERIVATIVES")}function ca(y,c,p,v,w,C){const M=p.paint.get("model-opacity"),I=c.context,P=new f.af(c.context.gl.LEQUAL,f.af.ReadWrite,c.depthRangeFor3D),F=c.transform,z=y.mesh,j=z.material,q=j.pbrMetallicRoughness,Z=c.style.fog;let ne;ne="pixels"===c.transform.projection.zAxisUnit?[...y.nodeModelMatrix]:f.ae.multiply([],v.zScaleMatrix,y.nodeModelMatrix),f.ae.multiply(ne,v.negCameraPosMatrix,ne);const re=f.ae.invert([],ne);f.ae.transpose(re,re);const ie=p.paint.get("model-emissive-strength").constantOr(0),Q=Lf(new Float32Array(y.worldViewProjection),new Float32Array(ne),new Float32Array(re),null,c,M,q.baseColorFactor.toRenderColor(null),j.emissiveFactor,q.metallicFactor,q.roughnessFactor,j,ie,p),se={defines:[]},ce=[];Su(se.defines,ce,z,c,p.lut);const de=c.shadowRenderer;de&&(de.useNormalOffset=!1);let be=null;if(Z){const De=Gf(y.nodeModelMatrix,c.transform);if(be=new Float32Array(De),"globe"!==F.projection.name){const Ee=z.aabb.min,Be=z.aabb.max,[ke,pe]=Z.getOpacityForBounds(De,Ee[0],Ee[1],Be[0],Be[1]);se.overrideFog=ke>=Yr||pe>=Yr}}const _e=Ra(c,p.paint.get("model-cutoff-fade-range"));_e.shouldRenderCutoff&&se.defines.push("RENDER_CUTOFF");const ye=c.getOrCreateProgram("model",se);c.uploadCommonUniforms(I,ye,null,be,_e),"shadow"!==c.renderPass&&de&&de.setupShadowsFromMatrix(y.nodeModelMatrix,ye),ye.draw(c,I.gl.TRIANGLES,P,w,C,z.material.doubleSided?f.ag.disabled:f.ag.backCCW,Q,p.id,z.vertexBuffer,z.indexBuffer,z.segments,p.paint,c.transform.zoom,void 0,ce)}function Os(y,c,p,v,w,C,M){let I;I="globe"===y.projection.name?f.ck(p,y):[...p],f.ae.multiply(I,I,c.matrix);const P=f.ae.multiply([],v,I);if(c.meshes)for(const F of c.meshes){if("BLEND"!==F.material.alphaMode){M.push({mesh:F,depth:0,modelIndex:w,worldViewProjection:P,nodeModelMatrix:I});continue}const z=f.$.transformMat4([],F.centroid,P);z[2]>0&&C.push({mesh:F,depth:z[2],modelIndex:w,worldViewProjection:P,nodeModelMatrix:I})}if(c.children)for(const F of c.children)Os(y,F,p,v,w,C,M)}function $v(y,c,p,v){const w=p.shadowRenderer;if(!w)return;const C=w.getShadowPassDepthMode(),M=w.getShadowPassColorMode(),I=w.calculateShadowPassMatrixFromMatrix(c),P=Hi(I);p.getOrCreateProgram("modelDepth",{defines:p._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(p,p.context.gl.TRIANGLES,C,f.ah.disabled,M,f.ag.backCCW,P,v.id,y.vertexBuffer,y.indexBuffer,y.segments,v.paint,p.transform.zoom,void 0,void 0)}function t0(y,c,p){const v=c.updateZoomBasedPaintProperties(),w=function(C,M,I){let P,F,z,j=C.terrain?C.terrain.exaggeration():0;if(C.terrain&&j>0){const q=C.terrain,Z=q.findDEMTileFor(I);Z&&Z.dem?P=f.cm.create(q,I,Z):j=0}if(0===j&&(M.terrainElevationMin=0,M.terrainElevationMax=0),j===M.validForExaggeration&&(0===j||P&&P._demTile&&P._demTile.tileID===M.validForDEMTile.id&&P._dem._timestamp===M.validForDEMTile.timestamp))return!1;for(const q in M.instancesPerModel){const Z=M.instancesPerModel[q];for(let ne=0;ne<Z.instancedDataArray.length;++ne){const re=(P?j*P.getElevationAt(0|Z.instancedDataArray.float32[16*ne],0|Z.instancedDataArray.float32[16*ne+1],!0,!0):0)+Z.instancesEvaluatedElevation[ne];Z.instancedDataArray.float32[16*ne+6]=re,F=F?Math.min(M.terrainElevationMin,re):re,z=z?Math.max(M.terrainElevationMax,re):re}}return M.terrainElevationMin=F||0,M.terrainElevationMax=z||0,M.validForExaggeration=j,M.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(y,c,p);(v||w)&&(c.uploaded=!1,c.upload(y.context))}const il={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new f.b8([0,0,0],[f.a4,f.a4,0])};function Du(y,c){const p=1<<y.canonical.z,v=c.getFreeCameraOptions().position,w=c.elevation,C=y.canonical.x/p,M=(y.canonical.x+1)/p,I=y.canonical.y/p,P=(y.canonical.y+1)/p;let F=c._centerAltitude;if(w){const Z=w.getMinMaxForTile(y);Z&&Z.max>F&&(F=Z.max)}const z=f.au(v.x,C,M)-v.x,j=f.au(v.y,I,P)-v.y,q=f.ay(F,c.center.lat)-v.z;return c._zoomFromMercatorZ(Math.sqrt(z*z+j*j+q*q))}function Wf(y,c,p,v,w,C,M){const I=y.context,P="shadow"===y.renderPass,F=y.shadowRenderer,z=P&&F?F.getShadowPassDepthMode():new f.af(I.gl.LEQUAL,f.af.ReadWrite,y.depthRangeFor3D),j=y.isTileAffectedByFog(C);if(p.meshes)for(const q of p.meshes){const Z=["MODEL_POSITION_ON_GPU"],ne=[];let re,ie,Q;v.instancedDataArray.length>20&&Z.push("INSTANCED_ARRAYS");const se=Ra(y,c.paint.get("model-cutoff-fade-range"));if(se.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),P&&F)re=y.getOrCreateProgram("modelDepth",{defines:Z}),ie=Hi(M.shadowTileMatrix,M.shadowTileMatrix,Float32Array.from(p.matrix)),Q=F.getShadowPassColorMode();else{Su(Z,ne,q,y,c.lut),re=y.getOrCreateProgram("model",{defines:Z,overrideFog:j});const de=q.material,be=de.pbrMetallicRoughness,_e=c.paint.get("model-opacity"),ye=c.paint.get("model-emissive-strength").constantOr(0);ie=Lf(C.expandedProjMatrix,Float32Array.from(p.matrix),new Float32Array(16),null,y,_e,be.baseColorFactor.toRenderColor(null),de.emissiveFactor,be.metallicFactor,be.roughnessFactor,de,ye,c,w),F&&(M.shadowUniformsInitialized?re.setShadowUniformValues(I,F.getShadowUniformValues()):(F.setupShadows(C.toUnwrapped(),re,"model-tile",C.overscaledZ),M.shadowUniformsInitialized=!0)),Q=se.shouldRenderCutoff||_e<1||"OPAQUE"!==de.alphaMode?f.a.alphaBlended:f.a.unblended}y.uploadCommonUniforms(I,re,C.toUnwrapped(),null,se);const ce=q.material.doubleSided?f.ag.disabled:f.ag.backCCW;if(v.instancedDataArray.length>20)ne.push(v.instancedDataBuffer),re.draw(y,I.gl.TRIANGLES,z,f.ah.disabled,Q,ce,ie,c.id,q.vertexBuffer,q.indexBuffer,q.segments,c.paint,y.transform.zoom,void 0,ne,v.instancedDataArray.length);else{const de=P?"u_instance":"u_normal_matrix";for(let be=0;be<v.instancedDataArray.length;++be)ie[de]=new Float32Array(v.instancedDataArray.arrayBuffer,64*be,16),re.draw(y,I.gl.TRIANGLES,z,f.ah.disabled,Q,ce,ie,c.id,q.vertexBuffer,q.indexBuffer,q.segments,c.paint,y.transform.zoom,void 0,ne)}}if(p.children)for(const q of p.children)Wf(y,c,q,v,w,C,M)}const qf=[1,-1,1];function Go(y,c,p,v){if(!p.modelManager)return!0;const w=p.modelManager;if(!p.shadowRenderer)return!0;const C=p.shadowRenderer,M=c.aabb;let I=!0,P=y.maxHeight;if(0===P){let z=0;for(const j in y.instancesPerModel){const q=w.getModel(j,v);q?z=Math.max(z,Math.max(Math.max(q.aabb.max[0],q.aabb.max[1]),q.aabb.max[2])):I=!1}P=y.maxScale*z*1.41+y.maxVerticalOffset,I&&(y.maxHeight=P)}M.max[2]=P,M.min[2]+=y.terrainElevationMin,M.max[2]+=y.terrainElevationMax,f.$.transformMat4(M.min,M.min,c.tileMatrix),f.$.transformMat4(M.max,M.max,c.tileMatrix);const F=M.intersects(C.getCurrentCascadeFrustum());return 0===p.currentShadowCascade&&(y.isInsideFirstShadowMapFrustum=2===F),0===F}function Qs(y,c){const p=y.uniformValues.u_cutoff_params[0],v=y.uniformValues.u_cutoff_params[1],w=y.uniformValues.u_cutoff_params[2],C=y.uniformValues.u_cutoff_params[3];return v===p||C===w?1:f.au(((c-p)/(v-p)-w)/(C-w),0,1)}function Zf(y,c,p,v){if(c.pitch<20)return 1;const w=c.getWorldToCameraMatrix(),C=f.ae.multiply([],w,y),M=[...p.min,1];let I=f.aB.transformMat4([],M,C),P=I,F=I;M[1]=p.max[1],I=f.aB.transformMat4([],M,C),P=I[1]<P[1]?I:P,F=I[1]>F[1]?I:F,M[0]=p.max[0],I=f.aB.transformMat4([],M,C),P=I[1]<P[1]?I:P,F=I[1]>F[1]?I:F,M[1]=p.min[1],I=f.aB.transformMat4([],M,C),P=I[1]<P[1]?I:P,F=I[1]>F[1]?I:F;const z=f.au(v[0],0,1),j=100*c.pixelsPerMeter*f.au(v[1],0,1),q=f.au(v[2],0,1),Z=f.$.lerp([],P,F,z),ne=Math.tan(.5*c.fovX),re=-Z[2]*ne;if(0===j)return Z[1]<-Math.abs(re)?q:1;const ie=(-Math.abs(re)-Z[1])/j,Q=(ce,de,be)=>(1-be)*ce+be*de,se=f.au(Q(1,q,ie),q,1);return Q(1,se,f.au((c.pitch-20)/20,0,1))}class Id{}class rr{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(c,p,v){{const j=this._storage.get(p.id);if(j)return j.lastUsedFrameIdx=c,j.buf}const w=v.gl,C=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),M=new ArrayBuffer(C),I=new Int16Array(M);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(M));const P=new f.co;for(let j=0;j<C/2;j+=3){const q=I[j],Z=I[j+1],ne=I[j+2];P.emplaceBack(q,Z),P.emplaceBack(Z,ne),P.emplaceBack(ne,q)}const F=v.bindVertexArrayOES.current,z=new Id;return z.buf=new f.I(v,P),z.lastUsedFrameIdx=c,this._storage.set(p.id,z),v.bindVertexArrayOES.set(F),z.buf}update(c){for(const[p,v]of this._storage)c-v.lastUsedFrameIdx>30&&(v.buf.destroy(),this._storage.delete(p))}destroy(){for(const[c,p]of this._storage)p.buf.destroy(),this._storage.delete(c)}}class ti{constructor(c){this.occluderSize=30,this.depthOffset=-1e-4,c.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),c.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Kc={symbol:function(y,c,p,v,w){if("translucent"!==y.renderPass)return;const C=f.ah.disabled,M=y.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(F,z,j,q,Z,ne,re){const ie=z.transform,Q="map"===Z,se="map"===ne;for(const ce of F){const de=q.getTile(ce),be=de.getBucket(j);if(!be||!be.text||!be.text.segments.get().length)continue;const _e=f.aE(be.textSizeData,ie.zoom),ye=Uv(ce,be.getProjection(),ie),De=ie.calculatePixelsToTileUnitsMatrix(de),Ee=If(ye,de.tileID.canonical,se,Q,ie,be.getProjection(),De),Be=be.hasIconTextFit()&&be.hasIconData();if(_e){const ke=Math.pow(2,ie.zoom-de.tileID.overscaledZ);TS(be,Q,se,re,f.bQ,ie,Ee,ce,ke,_e,Be)}}}(v,y,p,c,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),w);const I=0!==p.paint.get("icon-opacity").constantOr(1),P=0!==p.paint.get("text-opacity").constantOr(1);void 0!==p.layout.get("symbol-sort-key").constantOr(1)&&(I||P)?Tm(y,c,p,v,C,M):(I&&Tm(y,c,p,v,C,M,{onlyIcons:!0}),P&&Tm(y,c,p,v,C,M,{onlyText:!0})),c.map.showCollisionBoxes&&(zi(y,c,p,v,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),zi(y,c,p,v,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(y,c,p,v){if("translucent"!==y.renderPass)return;const w=p.paint.get("circle-opacity"),C=p.paint.get("circle-stroke-width"),M=p.paint.get("circle-stroke-opacity"),I=void 0!==p.layout.get("circle-sort-key").constantOr(1),P=p.paint.get("circle-emissive-strength");if(0===w.constantOr(1)&&(0===C.constantOr(1)||0===M.constantOr(1)))return;const F=y.context,z=F.gl,j=y.transform,q=y.depthModeForSublayer(0,f.af.ReadOnly),Z=f.ah.disabled,ne=y.colorModeForDrapableLayerRenderPass(P),re="globe"===j.projection.name,ie=[f.ak(j.center.lng),f.al(j.center.lat)],Q=[];for(let ce=0;ce<v.length;ce++){const de=v[ce],be=c.getTile(de),_e=be.getBucket(p);if(!_e||_e.projection.name!==j.projection.name)continue;const ye=_e.programConfigurations.get(p.id),De=f.bT(p),Ee=y.isTileAffectedByFog(de);re&&De.push("PROJECTION_GLOBE_VIEW"),De.push("DEPTH_D24"),y.terrain&&j.depthOcclusionForSymbolsAndCircles&&De.push("DEPTH_OCCLUSION");const Be=y.getOrCreateProgram("circle",{config:ye,defines:De,overrideFog:Ee}),ke=_e.layoutVertexBuffer,pe=_e.globeExtVertexBuffer,Je=_e.indexBuffer,Ke=j.projection.createInversionMatrix(j,de.canonical),Pe={programConfiguration:ye,program:Be,layoutVertexBuffer:ke,globeExtVertexBuffer:pe,indexBuffer:Je,uniformValues:f.bU(y,de,be,Ke,ie,p),tile:be};if(I){const pt=_e.segments.get();for(const mt of pt)Q.push({segments:new f.b([mt]),sortKey:mt.sortKey,state:Pe})}else Q.push({segments:_e.segments,sortKey:0,state:Pe})}I&&Q.sort((ce,de)=>ce.sortKey-de.sortKey);const se={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const ce of Q){const{programConfiguration:de,program:be,layoutVertexBuffer:_e,globeExtVertexBuffer:ye,indexBuffer:De,uniformValues:Ee,tile:Be}=ce.state,ke=ce.segments;y.terrain&&y.terrain.setupElevationDraw(Be,be,se),y.uploadCommonUniforms(F,be,Be.tileID.toUnwrapped()),be.draw(y,z.TRIANGLES,q,Z,ne,f.ag.disabled,Ee,p.id,_e,De,ke,p.paint,j.zoom,de,[ye])}},heatmap:function(y,c,p,v){if(0!==p.paint.get("heatmap-opacity"))if("offscreen"===y.renderPass){const w=y.context,C=w.gl,M=f.ah.disabled,I=new f.a([C.ONE,C.ONE,C.ONE,C.ONE],f.C.transparent,[!0,!0,!0,!0]);(function(Z,ne,re,ie){const Q=Z.gl,se=ne.width*ie,ce=ne.height*ie;Z.activeTexture.set(Q.TEXTURE1),Z.viewport.set([0,0,se,ce]);let de=re.heatmapFbo;if(!de||de&&(de.width!==se||de.height!==ce)){de&&de.destroy();const be=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,be),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),de=re.heatmapFbo=Z.createFramebuffer(se,ce,!0,null),function(_e,ye,De,Ee,Be,ke){const pe=_e.gl;pe.texImage2D(pe.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?pe.RGBA16F:pe.RGBA,Be,ke,0,pe.RGBA,_e.extRenderToTextureHalfFloat?pe.HALF_FLOAT:pe.UNSIGNED_BYTE,null),Ee.colorAttachment.set(De)}(Z,0,be,de,se,ce)}else Q.bindTexture(Q.TEXTURE_2D,de.colorAttachment.get()),Z.bindFramebuffer.set(de.framebuffer)})(w,y,p,"globe"===y.transform.projection.name?.5:.25),w.clear({color:f.C.transparent});const P=y.transform,F="globe"===P.projection.name,z=F?["PROJECTION_GLOBE_VIEW"]:[],j=F?f.ag.frontCCW:f.ag.disabled,q=[f.ak(P.center.lng),f.al(P.center.lat)];for(let Z=0;Z<v.length;Z++){const ne=v[Z];if(c.hasRenderableParent(ne))continue;const re=c.getTile(ne),ie=re.getBucket(p);if(!ie||ie.projection.name!==P.projection.name)continue;const Q=y.isTileAffectedByFog(ne),se=ie.programConfigurations.get(p.id),ce=y.getOrCreateProgram("heatmap",{config:se,defines:z,overrideFog:Q}),{zoom:de}=y.transform;y.terrain&&y.terrain.setupElevationDraw(re,ce),y.uploadCommonUniforms(w,ce,ne.toUnwrapped());const be=P.projection.createInversionMatrix(P,ne.canonical);ce.draw(y,C.TRIANGLES,f.af.disabled,M,I,j,Sd(y,ne,re,be,q,de,p.paint.get("heatmap-intensity")),p.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,p.paint,y.transform.zoom,se,F?[ie.globeExtVertexBuffer]:null)}w.viewport.set([0,0,y.width,y.height])}else"translucent"===y.renderPass&&(y.context.setColorMode(y.colorModeForRenderPass()),function(w,C){const M=w.context,I=M.gl,P=C.heatmapFbo;if(!P)return;M.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get()),M.activeTexture.set(I.TEXTURE1);let F=C.colorRampTexture;F||(F=C.colorRampTexture=new f.T(M,C.colorRamp,I.RGBA)),F.bind(I.LINEAR,I.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,I.TRIANGLES,f.af.disabled,f.ah.disabled,w.colorModeForRenderPass(),f.ag.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(y,p))},line:function(y,c,p,v){if("translucent"!==y.renderPass)return;const w=p.paint.get("line-opacity"),C=p.paint.get("line-width");if(0===w.constantOr(1)||0===C.constantOr(1))return;const M=p.paint.get("line-emissive-strength"),I=p.paint.get("line-occlusion-opacity"),P=y.context,F=P.gl,z=p.layout.get("line-z-offset"),j=!z.isConstant()||!!z.constantOr(0),q=j?new f.af(y.depthOcclusion?F.GREATER:F.LEQUAL,f.af.ReadOnly,y.depthRangeFor3D):y.depthModeForSublayer(0,f.af.ReadOnly),Z=y.colorModeForDrapableLayerRenderPass(M),ne=y.terrain&&y.terrain.renderingToTexture,re=ne?1:f.e.devicePixelRatio,ie=p.paint.get("line-dasharray"),Q=ie.constantOr(1),se=p.layout.get("line-cap"),ce=ie.constantOr(null),de=se.constantOr(null),be=p.paint.get("line-pattern"),_e=be.constantOr(1),ye=be.constantOr(null),De=p.paint.get("line-opacity").constantOr(1);let Ee=!_e&&1!==De||y.depthOcclusion&&I>0&&I<1;const Be=p.paint.get("line-gradient"),ke=_e?"linePattern":"line",pe=f.bV(p);let Je;if(ne&&y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(Ee=!1),0!==I&&y.depthOcclusion){const Pe=p.paint._values["line-opacity"];Pe&&Pe.value&&"constant"===Pe.value.kind?Je=Pe.value:f.w(`Occlusion opacity for layer ${p.id} is supported only when line-opacity isn't data-driven.`)}if(j&&(y.forceTerrainMode=!0),!j&&0!==I&&y.terrain&&!ne)return void f.w(`Occlusion opacity for layer ${p.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Ke=Ee&&j?y.stencilModeFor3D():f.ah.disabled;for(const Pe of v){const pt=c.getTile(Pe);if(_e&&!pt.patternsLoaded())continue;const mt=pt.getBucket(p);if(!mt)continue;y.prepareDrawTile();const He=mt.programConfigurations.get(p.id),nt=y.isTileAffectedByFog(Pe),Oe=y.getOrCreateProgram(ke,{config:He,defines:j?[...pe,"ELEVATED"]:pe,overrideFog:nt});if(ye&&pt.imageAtlas){const Qt=pt.imageAtlas.patternPositions[ye.toString()];Qt&&He.setConstantPatternPositions(Qt)}if(!_e&&ce&&de&&pt.lineAtlas){const Qt=pt.lineAtlas.getDash(ce,de);Qt&&He.setConstantPatternPositions(Qt)}let[_t,gt]=p.paint.get("line-trim-offset");("round"===de||"square"===de)&&_t!==gt&&(0===_t&&(_t-=1),1===gt&&(gt+=1));const Wt=ne?Pe.projMatrix:null,Vt=_e?f.bW(y,pt,p,Wt,re,[_t,gt]):f.bX(y,pt,p,Wt,mt.lineClipsArray.length,re,[_t,gt]);if(Be){const Qt=mt.gradients[p.id];let Pn=Qt.texture;if(p.gradientVersion!==Qt.version){let Yn=256;if(p.stepInterpolant){const Un=c.getSource().maxzoom,or=Pe.canonical.z===Un?Math.ceil(1<<y.transform.maxZoom-Pe.canonical.z):1;Yn=f.au(f.bY(mt.maxLineLength/f.a4*1024*or),256,P.maxTextureSize)}Qt.gradient=f.bZ({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:Yn,image:Qt.gradient||void 0,clips:mt.lineClipsArray}),Qt.texture?Qt.texture.update(Qt.gradient):Qt.texture=new f.T(P,Qt.gradient,F.RGBA),Qt.version=p.gradientVersion,Pn=Qt.texture}P.activeTexture.set(F.TEXTURE1),Pn.bind(p.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}Q&&(P.activeTexture.set(F.TEXTURE0),pt.lineAtlasTexture&&pt.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),He.updatePaintBuffers()),_e&&(P.activeTexture.set(F.TEXTURE0),pt.imageAtlasTexture&&pt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),He.updatePaintBuffers()),j&&y.terrain.setupElevationDraw(pt,Oe),y.uploadCommonUniforms(P,Oe,Pe.toUnwrapped());const bt=Qt=>{null!=Je&&(Je.value=De*I),Oe.draw(y,F.TRIANGLES,q,Qt,Z,f.ag.disabled,Vt,p.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,p.paint,y.transform.zoom,He,[mt.layoutVertexBuffer2,mt.patternVertexBuffer,mt.zOffsetVertexBuffer]),null!=Je&&(Je.value=De)};if(Ee&&!j){const Qt=y.stencilModeForClipping(Pe).ref;0===Qt&&ne&&P.clear({stencil:0});const Pn={func:F.EQUAL,mask:255};Vt.u_alpha_discard_threshold=.8,bt(new f.ah(Pn,Qt,255,F.KEEP,F.KEEP,F.INVERT)),Vt.u_alpha_discard_threshold=0,bt(new f.ah(Pn,Qt,255,F.KEEP,F.KEEP,F.KEEP))}else Ee&&j&&(Vt.u_alpha_discard_threshold=.001),bt(j?Ke:y.stencilModeForClipping(Pe))}Ee&&(y.resetStencilClippingMasks(),ne&&P.clear({stencil:0})),0===I||y.depthOcclusion||ne||y.layersWithOcclusionOpacity.push(y.currentLayer),j&&(y.forceTerrainMode=!1)},fill:function(y,c,p,v){const w=p.paint.get("fill-color"),C=p.paint.get("fill-opacity");if(0===C.constantOr(1))return;const M=p.paint.get("fill-emissive-strength"),I=y.colorModeForDrapableLayerRenderPass(M),P=p.paint.get("fill-pattern"),F=y.opaquePassEnabledForLayer()&&!P.constantOr(1)&&1===w.constantOr(f.C.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(y.renderPass===F){const z=y.depthModeForSublayer(1,"opaque"===y.renderPass?f.af.ReadWrite:f.af.ReadOnly);tc(y,c,p,v,z,I,!1)}if("translucent"===y.renderPass&&p.paint.get("fill-antialias")){const z=y.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,f.af.ReadOnly);tc(y,c,p,v,z,I,!0)}},"fill-extrusion":function(y,c,p,v){const w=p.paint.get("fill-extrusion-opacity"),C=y.context,M=C.gl,I=y.terrain,P=I&&I.renderingToTexture;if(0===w)return;const F=y.conflationActive&&y.style.isLayerClipped(p,c.getSource()),z=y.style.order.indexOf(p.fqid);if(F&&function(j,q,Z,ne,re){for(const ie of ne){const Q=q.getTile(ie).getBucket(Z);Q&&(Q.updateReplacement(ie,j.replacementSource,re),Q.uploadCentroid(j.context))}}(y,c,p,v,z),I||F)for(const j of v){const q=c.getTile(j).getBucket(p);q&&ES(y.context,c,j,q,p,I,F)}if("shadow"===y.renderPass&&y.shadowRenderer){const j=y.shadowRenderer;if(I&&w<.65&&p._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof f.Z)return;const q=j.getShadowPassDepthMode(),Z=j.getShadowPassColorMode();zf(y,c,p,v,q,f.ah.disabled,Z,F)}else if("translucent"===y.renderPass){const j=!p.paint.get("fill-extrusion-pattern").constantOr(1),q=p.paint.get("fill-extrusion-color").constantOr(f.C.white);if(!P&&0!==q.a){const Z=new f.af(y.context.gl.LEQUAL,f.af.ReadWrite,y.depthRangeFor3D);1===w&&j?zf(y,c,p,v,Z,f.ah.disabled,f.a.unblended,F):(zf(y,c,p,v,Z,f.ah.disabled,f.a.disabled,F),zf(y,c,p,v,Z,y.stencilModeFor3D(),y.colorModeForRenderPass(),F),y.resetStencilClippingMasks())}if(y.style.enable3dLights()&&j&&(!I&&"globe"!==y.transform.projection.name||P)){const Z=p.paint.get("fill-extrusion-opacity"),ne=p.paint.get("fill-extrusion-ambient-occlusion-intensity"),re=p.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=p.paint.get("fill-extrusion-flood-light-intensity"),Q=p.paint.get("fill-extrusion-flood-light-color").toRenderColor(p.lut).toArray01().slice(0,3),se=ne>0&&re>0,ce=ie>0,de=(_e,ye,De)=>(1-De)*_e+De*ye,be=_e=>{const ye=y.depthModeForSublayer(1,f.af.ReadOnly,M.LEQUAL,!0),De=p.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=de(.1,3,De),Be=y._showOverdrawInspector;if(!Be){const ke=new f.ah({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),pe=new f.a([M.ONE,M.ONE,M.ONE,M.ONE],f.C.transparent,[!1,!1,!1,!0],M.MIN);Em(y,c,p,v,ye,ke,pe,f.ag.disabled,_e,"sdf",Z,ne,re,ie,Q,Ee,F,!1)}{const ke=Be?f.ah.disabled:new f.ah({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),pe=Be?y.colorModeForRenderPass():new f.a([M.ONE_MINUS_DST_ALPHA,M.DST_ALPHA,M.ONE,M.ONE],f.C.transparent,[!0,!0,!0,!0]);Em(y,c,p,v,ye,ke,pe,f.ag.disabled,_e,"color",Z,ne,re,ie,Q,Ee,F,!1)}};if(P){const _e=(ye,De,Ee)=>{const Be=y.depthModeForSublayer(1,f.af.ReadOnly,M.LEQUAL,!1),ke=p.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),pe=de(.1,3,ke);{const Je=new f.a([M.ONE,M.ONE,M.ONE,M.ONE],f.C.transparent,[!1,!1,!1,!0]);Em(y,c,p,v,Be,f.ah.disabled,Je,f.ag.disabled,ye,"clear",Z,ne,re,ie,Q,pe,F,De)}{const Je=new f.ah({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),Ke=new f.a([M.ONE,M.ONE,M.ONE,M.ONE],f.C.transparent,[!1,!1,!1,!0],M.MIN);Em(y,c,p,v,Be,Je,Ke,f.ag.disabled,ye,"sdf",Z,ne,re,ie,Q,pe,F,De)}{const Je=ye?M.ZERO:M.ONE_MINUS_DST_ALPHA,Ke=new f.ah({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),Pe=new f.a([Je,M.DST_ALPHA,M.ONE_MINUS_DST_ALPHA,M.ZERO],f.C.transparent,[!0,!0,!0,!0]);Em(y,c,p,v,Be,Ke,Pe,f.ag.disabled,ye,"color",Z,ne,re,ie,Q,pe,F,De)}{const Je=new f.a([M.ONE,M.ONE,M.ONE,ye?M.ZERO:M.ONE],f.C.transparent,[!1,!1,!1,!0],ye?M.FUNC_ADD:M.MAX);Em(y,c,p,v,Be,f.ah.disabled,Je,f.ag.disabled,ye,"clear",Z,ne,re,ie,Q,pe,F,De,Ee)}};if(se||ce){let ye;if(y.prepareDrawTile(),I){const De=I.drapeBufferSize[0],Ee=I.drapeBufferSize[1];ye=I.framebufferCopyTexture,ye&&(!ye||ye.size[0]===De&&ye.size[1]===Ee)||(ye&&ye.destroy(),ye=I.framebufferCopyTexture=new f.T(C,new f.j({width:De,height:Ee}),M.RGBA)),ye.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexImage2D(M.TEXTURE_2D,0,M.RGBA,0,0,De,Ee,0)}se&&_e(!0,!1,ye),ce&&_e(!1,!0,ye)}}else se&&be(!0),ce&&be(!1),(se||ce)&&y.resetStencilClippingMasks()}}},hillshade:function(y,c,p,v){if("offscreen"!==y.renderPass&&"translucent"!==y.renderPass||y.style.disableElevatedTerrain)return;const w=y.context,C=y.terrain&&y.terrain.renderingToTexture,[M,I]="translucent"!==y.renderPass||C?[{},v]:y.stencilConfigForOverlap(v);for(const P of I){const F=c.getTile(P);if(F.needsHillshadePrepare&&"offscreen"===y.renderPass)Kw(y,F,p);else if("translucent"===y.renderPass){const z=y.depthModeForSublayer(0,f.af.ReadOnly),j=p.paint.get("hillshade-emissive-strength"),q=y.colorModeForDrapableLayerRenderPass(j),Z=C&&y.terrain?y.terrain.stencilModeForRTTOverlap(P):M[P.overscaledZ];Iv(y,P,F,p,z,Z,q)}}w.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,c,p,v,w,C){if("translucent"!==y.renderPass||0===p.paint.get("raster-opacity"))return;const M="globe"===y.transform.projection.name,I=0!==p.paint.get("raster-elevation"),P=I&&M;if(y.renderElevatedRasterBackface&&!P)return;const F=y.context,z=F.gl,j=c.getSource(),q=function(_e,ye,De,Ee){const Be=ye.paint.get("raster-color"),ke="raster-array"===_e.type,pe=[],Je=ye.paint.get("raster-resampling"),Ke=ye.paint.get("raster-color-mix");let Pe=ye.paint.get("raster-color-range");const pt=[Ke[0],Ke[1],Ke[2],0],mt=Ke[3];let He="nearest"===Je?Ee.NEAREST:Ee.LINEAR;if(ke&&(pe.push("RASTER_ARRAY"),Be||pe.push("RASTER_COLOR"),"linear"===Je&&pe.push("RASTER_ARRAY_LINEAR"),He=Ee.NEAREST,!Pe&&_e.rasterLayers)){const nt=_e.rasterLayers.find(({id:Oe})=>Oe===ye.sourceLayer);nt&&nt.fields&&nt.fields.range&&(Pe=nt.fields.range)}if(Pe=Pe||[0,1],Be){pe.push("RASTER_COLOR"),De.activeTexture.set(Ee.TEXTURE2),ye.updateColorRamp(Pe);let nt=ye.colorRampTexture;nt||(nt=ye.colorRampTexture=new f.T(De,ye.colorRamp,Ee.RGBA)),nt.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}return{mix:pt,range:Pe,offset:mt,defines:pe,resampling:He}}(j,p,F,z);if(j instanceof f.bo&&!v.length&&!M)return;const Z=p.paint.get("raster-emissive-strength"),ne=y.colorModeForDrapableLayerRenderPass(Z),re=y.terrain&&y.terrain.renderingToTexture,ie=!y.options.moving,Q="nearest"===p.paint.get("raster-resampling")?z.NEAREST:z.LINEAR;if(j instanceof f.bo&&!v.length&&(j.onNorthPole||j.onSouthPole)){const _e=I?y.stencilModeFor3D():f.ah.disabled;return void la(!!j.onNorthPole,null,y,c,p,Z,q,f.ag.disabled,_e)}if(!v.length)return;const[se,ce]=j instanceof f.bo||re?[{},v]:y.stencilConfigForOverlap(v),de=ce[ce.length-1].overscaledZ;P&&q.defines.push("PROJECTION_GLOBE_VIEW"),I&&q.defines.push("RENDER_CUTOFF");const be=(_e,ye,De)=>{for(const Ee of _e){const Be=Ee.toUnwrapped(),ke=c.getTile(Ee);if(re&&(!ke||!ke.hasData()))continue;F.activeTexture.set(z.TEXTURE0);const pe=Uf(ke,j,p,q);if(!pe||!pe.texture)continue;const{texture:Je,mix:Ke,offset:Pe,tileSize:pt,buffer:mt}=pe;let He,nt;re?(He=f.af.disabled,nt=Ee.projMatrix):I?(He=new f.af(z.LEQUAL,f.af.ReadWrite,y.depthRangeFor3D),nt=M?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(Be,ie)):(He=y.depthModeForSublayer(Ee.overscaledZ-de,1===p.paint.get("raster-opacity")?f.af.ReadWrite:f.af.ReadOnly,z.LESS),nt=y.transform.calculateProjMatrix(Be,ie));const Oe=y.terrain&&re?y.terrain.stencilModeForRTTOverlap(Ee):se[Ee.overscaledZ],_t=C?0:p.paint.get("raster-fade-duration");ke.registerFadeDuration(_t);const gt=c.findLoadedParent(Ee,0),Wt=X_(ke,gt,c,y.transform,_t);let Vt,bt;y.terrain&&y.terrain.prepareDrawTile(),F.activeTexture.set(z.TEXTURE0),Je.bind(Q,z.CLAMP_TO_EDGE),F.activeTexture.set(z.TEXTURE1),gt?(gt.texture&&gt.texture.bind(Q,z.CLAMP_TO_EDGE),Vt=Math.pow(2,gt.tileID.overscaledZ-ke.tileID.overscaledZ),bt=[ke.tileID.canonical.x*Vt%1,ke.tileID.canonical.y*Vt%1]):Je.bind(Q,z.CLAMP_TO_EDGE),Je.useMipmap&&F.extTextureFilterAnisotropic&&y.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const Qt=y.transform;let Pn;const Yn=I?Er(Qt):[0,0,0,0];let Un,or,Kn,Si,wr,ur=0;if(P&&j instanceof f.bo&&j.coordinates.length>3)Un=Float32Array.from(f.bh(f.bi(new f.aO(0,0,0)))),or=Float32Array.from(Qt.globeMatrix),Kn=Float32Array.from(f.bd(Qt)),Si=[f.ak(Qt.center.lng),f.al(Qt.center.lat)],Pn=j.elevatedGlobePerspectiveTransform,wr=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){const Zn=f.be(Ee.canonical);ur=f.bf(Zn.getCenter().lat),Un=Float32Array.from(f.bh(f.bi(Ee.canonical))),or=Float32Array.from(Qt.globeMatrix),Kn=Float32Array.from(f.bd(Qt)),Si=[f.ak(Qt.center.lng),f.al(Qt.center.lat)],Pn=[0,0],wr=Float32Array.from(f.bg(Ee.canonical,Zn,ur,Qt.worldSize/Qt._pixelsPerMercatorPixel))}else Pn=j instanceof f.bo?j.perspectiveTransform:[0,0],Un=new Float32Array(16),or=new Float32Array(9),Kn=new Float32Array(16),Si=[0,0],wr=new Float32Array(9);const ni=r1(nt,Un,or,Kn,wr,bt||[0,0],f.a2(y.transform.zoom),Si,Yn,Vt||1,Wt,p,Pn,I?p.paint.get("raster-elevation"):0,2,Ke,Pe,q.range,pt,mt,Z),dr=y.isTileAffectedByFog(Ee),xr=y.getOrCreateProgram("raster",{defines:q.defines,overrideFog:dr});if(y.uploadCommonUniforms(F,xr,Be),j instanceof f.bo){const Zn=j.elevatedGlobeVertexBuffer,Ir=j.elevatedGlobeIndexBuffer;if(re||!M)j.boundsBuffer&&j.boundsSegments&&xr.draw(y,z.TRIANGLES,He,f.ah.disabled,ne,f.ag.disabled,ni,p.id,j.boundsBuffer,y.quadTriangleIndexBuffer,j.boundsSegments);else if(Zn&&Ir){const Sr=Qt.zoom<=f.b3?j.elevatedGlobeSegments:j.getSegmentsForLongitude(Qt.center.lng);Sr&&xr.draw(y,z.TRIANGLES,He,f.ah.disabled,ne,ye,ni,p.id,Zn,Ir,Sr)}}else if(P){He=new f.af(z.LEQUAL,f.af.ReadOnly,y.depthRangeFor3D);const Zn=y.globeSharedBuffers;if(Zn){const[Ir,Sr,tr]=Zn.getGridBuffers(ur,!1);xr.draw(y,z.TRIANGLES,He,De||Oe,y.colorModeForRenderPass(),ye,ni,p.id,Ir,Sr,tr)}}else{const{tileBoundsBuffer:Zn,tileBoundsIndexBuffer:Ir,tileBoundsSegments:Sr}=y.getTileBoundsBuffers(ke);xr.draw(y,z.TRIANGLES,He,Oe,ne,f.ag.disabled,ni,p.id,Zn,Ir,Sr)}}if(!(j instanceof f.bo)&&P)for(const Ee of _e){const Be=Ee.canonical.y===(1<<Ee.canonical.z)-1;0===Ee.canonical.y&&la(!0,Ee,y,c,p,Z,q,ye,De||f.ah.disabled),Be&&la(!1,Ee,y,c,p,Z,q,ye===f.ag.frontCW?f.ag.backCW:f.ag.frontCW,De||f.ah.disabled)}};P?be(ce,y.renderElevatedRasterBackface?f.ag.backCW:f.ag.frontCW,y.stencilModeFor3D()):be(ce,f.ag.disabled,void 0),y.resetStencilClippingMasks()},"raster-particle":function(y,c,p,v,w,C){"offscreen"===y.renderPass&&function(M,I,P,F){if(!F.length)return;const z=M.context,j=z.gl,q=I.getSource();if(!(q instanceof gh))return;const Z=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count")));let ne=P.particlePositionRGBAImage;if(!ne||ne.width!==Z){const ce=function(de){const be=de*de,_e=new Uint8Array(4*be),ye=function(Ee){return Ee|=0,Ee=Math.imul(2747636419^Ee,2654435769),Ee=Math.imul(Ee^Ee>>>16,2654435769),((Ee=Math.imul(Ee^Ee>>>16,2654435769))>>>0)/4294967296},De=1/1.1;for(let Ee=0;Ee<be;Ee++){const Be=De*(ye(2*Ee+0)+Cc),ke=De*(ye(2*Ee+1)+Cc),pe=255*Be%1,Je=255*ke%1,Ke=pe,Pe=ke-Je/255,pt=Je;_e[4*Ee+0]=255*(Be-pe/255),_e[4*Ee+1]=255*Ke,_e[4*Ee+2]=255*Pe,_e[4*Ee+3]=255*pt}return _e}(Z);ne=P.particlePositionRGBAImage=new f.j({width:Z,height:Z},ce)}let re=P.particleFramebuffer;re?re.width!==Z&&(re.destroy(),re=P.particleFramebuffer=z.createFramebuffer(Z,Z,!0,null)):re=P.particleFramebuffer=z.createFramebuffer(Z,Z,!0,null);const ie=[];for(const ce of F){const de=I.getTile(ce);if(!(de instanceof f.c5))continue;const be=nT(de,q,P);if(!be)continue;const _e=[de.tileSize,de.tileSize];let ye=P.tileFramebuffer;ye||(ye=P.tileFramebuffer=z.createFramebuffer(_e[0],_e[1],!0,null));let De=de.rasterParticleState;De||(De=de.rasterParticleState=new vd(z,ce,_e,ne));const Ee=De.update(P.lastInvalidatedAt);De.particleTextureDimension!==Z&&De.updateParticleTexture(ce,ne);const Be=De.targetColorTexture;De.targetColorTexture=De.backgroundColorTexture,De.backgroundColorTexture=Be;const ke=De.particleTexture0;De.particleTexture0=De.particleTexture1,De.particleTexture1=ke,ie.push([ce,be,De,Ee])}if(0===ie.length)return;const Q=f.e.now(),se=P.previousDrawTimestamp?.001*(Q-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=Q,P.hasColorMap()){z.activeTexture.set(j.TEXTURE0+2);let ce=P.colorRampTexture;ce||(ce=P.colorRampTexture=new f.T(z,P.colorRamp,j.RGBA)),ce.bind(j.LINEAR,j.CLAMP_TO_EDGE)}z.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(ce,de,be){const _e=ce.context,ye=_e.gl,De=de.tileFramebuffer;_e.activeTexture.set(ye.TEXTURE0);const Ee={u_texture:0,u_opacity:1.05*(ke=de.paint.get("raster-particle-fade-opacity-factor"))/(ke+.05)},Be=ce.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ke;for(const pe of be){const[,,Je,Ke]=pe;De.colorAttachment.set(Je.targetColorTexture.texture),_e.viewport.set([0,0,De.width,De.height]),_e.clear({color:f.C.transparent}),Ke&&(Je.backgroundColorTexture.bind(ye.NEAREST,ye.CLAMP_TO_EDGE),Be.draw(ce,ye.TRIANGLES,f.af.disabled,f.ah.disabled,f.a.alphaBlended,f.ag.disabled,Ee,de.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments))}}(M,P,ie),function(ce,de,be,_e){const ye=ce.context,De=ye.gl,Ee=be.tileFramebuffer,Be="globe"===ce.transform.projection.name,ke=be.paint.get("raster-particle-max-speed");for(const pe of _e){const[Je,Ke,Pe]=pe;ye.activeTexture.set(De.TEXTURE0+0),Ke.texture.bind(De.LINEAR,De.CLAMP_TO_EDGE),Ee.colorAttachment.set(Pe.targetColorTexture.texture);const pt=ce.getOrCreateProgram("rasterParticleDraw",{defines:Ke.defines,overrideFog:!1});ye.activeTexture.set(De.TEXTURE0+1);const mt=Ke.scalarData?[]:[0,1,2,3].map(Oe=>f.b$[Oe](Je));mt.push(Je);const He=Je.canonical.x,nt=Je.canonical.y;for(const Oe of mt){const _t=de.getTile(Be?Oe.wrapped():Oe);if(!_t)continue;const gt=_t.rasterParticleState;if(!gt)continue;const Wt=Oe.canonical.x+(1<<Oe.canonical.z)*(Oe.wrap-Je.wrap),Vt=Oe.canonical.y;gt.particleTexture0.bind(De.NEAREST,De.CLAMP_TO_EDGE);const bt=Ff(1,gt.particleTexture0.size[0],[Wt-He,Vt-nt],0,Ke.texture.size,2,ke,Ke.textureOffset,Ke.scale,Ke.offset);pt.draw(ce,De.POINTS,f.af.disabled,f.ah.disabled,f.a.alphaBlended,f.ag.disabled,bt,be.id,gt.particleIndexBuffer,void 0,gt.particleSegment)}}}(M,I,P,ie),z.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(ce,de,be,_e){const ye=ce.context,De=ye.gl,Ee=de.paint.get("raster-particle-max-speed"),Be=_e*de.paint.get("raster-particle-speed-factor")*.15,ke=(Je=.01+1*de.paint.get("raster-particle-reset-rate-factor"),Math.pow(Je,6)),pe=de.particleFramebuffer;var Je;ye.viewport.set([0,0,pe.width,pe.height]);for(const Je of be){const[,Ke,Pe]=Je;ye.activeTexture.set(De.TEXTURE0+0),Ke.texture.bind(De.LINEAR,De.CLAMP_TO_EDGE),ye.activeTexture.set(De.TEXTURE0+1);const pt=Pe.particleTexture0;pt.bind(De.NEAREST,De.CLAMP_TO_EDGE);const mt=Dd(1,pt.size[0],0,Ke.texture.size,Ee,Be,ke,Ke.textureOffset,Ke.scale,Ke.offset);pe.colorAttachment.set(Pe.particleTexture1.texture),ye.clear({color:f.C.transparent}),ce.getOrCreateProgram("rasterParticleUpdate",{defines:Ke.defines}).draw(ce,De.TRIANGLES,f.af.disabled,f.ah.disabled,f.a.unblended,f.ag.disabled,mt,de.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments)}}(M,P,ie,se)}(y,c,p,v),"translucent"===y.renderPass&&(function(M,I,P,F,z){const j=M.context,q=j.gl,Z=I.getSource().tileSize,ne=5*(1-f.a0(f.aV,f.aV+1,M.transform.zoom))*Z+P.paint.get("raster-particle-elevation"),re=!M.options.moving,ie="globe"===M.transform.projection.name;if(!F.length)return;const[Q,se]=M.stencilConfigForOverlap(F),ce=[];ie&&ce.push("PROJECTION_GLOBE_VIEW");const de=M.stencilModeFor3D();for(const be of se){const _e=be.toUnwrapped(),ye=I.getTile(be);if(!ye.rasterParticleState)continue;const De=ye.rasterParticleState,Ee=100;ye.registerFadeDuration(Ee);const Be=I.findLoadedParent(be,0),ke=X_(ye,Be,I,M.transform,Ee);let pe,Je;M.terrain&&M.terrain.prepareDrawTile(),j.activeTexture.set(q.TEXTURE0),De.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),j.activeTexture.set(q.TEXTURE1),Be&&Be.rasterParticleState?(Be.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),pe=Math.pow(2,Be.tileID.overscaledZ-ye.tileID.overscaledZ),Je=[ye.tileID.canonical.x*pe%1,ye.tileID.canonical.y*pe%1]):De.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const Ke=ie?Float32Array.from(M.transform.expandedFarZProjMatrix):M.transform.calculateProjMatrix(_e,re),Pe=M.transform,pt=s1(Pe),mt=f.be(be.canonical),He=f.bf(mt.getCenter().lat);let nt,Oe,_t,gt,Wt;ie?(nt=Float32Array.from(f.bh(f.bi(be.canonical))),Oe=Float32Array.from(Pe.globeMatrix),_t=Float32Array.from(f.bd(Pe)),gt=[f.ak(Pe.center.lng),f.al(Pe.center.lat)],Wt=Float32Array.from(f.bg(be.canonical,mt,He,Pe.worldSize/Pe._pixelsPerMercatorPixel))):(nt=new Float32Array(16),Oe=new Float32Array(9),_t=new Float32Array(16),gt=[0,0],Wt=new Float32Array(9));const Vt=Pa(Ke,nt,Oe,_t,Wt,Je||[0,0],f.a2(M.transform.zoom),gt,pt,pe||1,ke,ne),bt=M.isTileAffectedByFog(be),Qt=M.getOrCreateProgram("rasterParticle",{defines:ce,overrideFog:bt});if(M.uploadCommonUniforms(j,Qt,_e),ie){const Pn=new f.af(q.LEQUAL,f.af.ReadOnly,M.depthRangeFor3D),Yn=0,Un=M.globeSharedBuffers;if(Un){const[or,Kn,Si]=Un.getGridBuffers(He,0!==Yn);Qt.draw(M,q.TRIANGLES,Pn,de,f.a.alphaBlended,M.renderElevatedRasterBackface?f.ag.frontCCW:f.ag.backCCW,Vt,P.id,or,Kn,Si)}}else{const Pn=M.depthModeForSublayer(0,f.af.ReadOnly),Yn=Q[be.overscaledZ],{tileBoundsBuffer:Un,tileBoundsIndexBuffer:or,tileBoundsSegments:Kn}=M.getTileBoundsBuffers(ye);Qt.draw(M,q.TRIANGLES,Pn,Yn,f.a.alphaBlended,f.ag.disabled,Vt,P.id,Un,or,Kn)}}M.resetStencilClippingMasks()}(y,c,p,v),y.style.map.triggerRepaint())},background:function(y,c,p,v){const w=p.paint.get("background-color"),C=p.paint.get("background-opacity"),M=p.paint.get("background-emissive-strength");if(0===C)return;const I=y.context,P=I.gl,F=y.transform,z=F.tileSize,j=p.paint.get("background-pattern");let q;if(void 0!==j&&(null===j||(q=y.imageManager.getPattern(j.toString(),p.scope,y.style.getLut(p.scope)),!q)))return;const Z=!j&&1===w.a&&1===C&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==Z)return;const ne=f.ah.disabled,re=y.depthModeForSublayer(0,"opaque"===Z?f.af.ReadWrite:f.af.ReadOnly),ie=y.colorModeForDrapableLayerRenderPass(M),Q=j?"backgroundPattern":"background";let se,ce=v;ce||(se=y.getBackgroundTiles(),ce=Object.values(se).map(de=>de.tileID)),j&&(I.activeTexture.set(P.TEXTURE0),y.imageManager.bind(y.context,p.scope));for(const de of ce){const be=y.isTileAffectedByFog(de),_e=y.getOrCreateProgram(Q,{overrideFog:be}),ye=de.toUnwrapped(),De=v?de.projMatrix:y.transform.calculateProjMatrix(ye);y.prepareDrawTile();const Ee=c?c.getTile(de):se?se[de.key]:new f.bA(de,z,F.zoom,y),Be=j?ls(De,M,C,y,0,p.scope,q,{tileID:de,tileSize:z}):Bv(De,M,C,w.toRenderColor(p.lut));y.uploadCommonUniforms(I,_e,ye);const{tileBoundsBuffer:ke,tileBoundsIndexBuffer:pe,tileBoundsSegments:Je}=y.getTileBoundsBuffers(Ee);_e.draw(y,P.TRIANGLES,re,ne,ie,f.ag.disabled,Be,p.id,ke,pe,Je)}},sky:function(y,c,p){const v=y._atmosphere?f.a2(y.transform.zoom):1,w=p.paint.get("sky-opacity")*v;if(0===w)return;const C=y.context,M=p.paint.get("sky-type"),I=new f.af(C.gl.LEQUAL,f.af.ReadOnly,[0,1]),P=y.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===y.renderPass?p.needsSkyboxCapture(y)&&(function(F,z,j,q){const Z=F.context,ne=Z.gl;let re=z.skyboxFbo;if(!re){re=z.skyboxFbo=Z.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new ln(Z),z.skyboxTexture=Z.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,z.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ce=0;ce<6;++ce)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(re.framebuffer),Z.viewport.set([0,0,32,32]);const ie=z.getCenter(F,!0),Q=F.getOrCreateProgram("skyboxCapture"),se=new Float64Array(16);f.ae.identity(se),f.ae.rotateY(se,se,.5*-Math.PI),Fr(F,z,Q,se,ie,0),f.ae.identity(se),f.ae.rotateY(se,se,.5*Math.PI),Fr(F,z,Q,se,ie,1),f.ae.identity(se),f.ae.rotateX(se,se,.5*-Math.PI),Fr(F,z,Q,se,ie,2),f.ae.identity(se),f.ae.rotateX(se,se,.5*Math.PI),Fr(F,z,Q,se,ie,3),f.ae.identity(se),Fr(F,z,Q,se,ie,4),f.ae.identity(se),f.ae.rotateY(se,se,Math.PI),Fr(F,z,Q,se,ie,5),Z.viewport.set([0,0,F.width,F.height])}(y,p),p.markSkyboxValid(y)):"sky"===y.renderPass&&function(F,z,j,q,Z){const ne=F.context,re=ne.gl,ie=F.transform,Q=F.getOrCreateProgram("skybox");ne.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,z.skyboxTexture);const se=((ce,de,be,_e,ye)=>({u_matrix:ce,u_sun_direction:de,u_cubemap:0,u_opacity:_e,u_temporal_offset:ye}))(ie.skyboxMatrix,z.getCenter(F,!1),0,q,Z);F.uploadCommonUniforms(ne,Q),Q.draw(F,re.TRIANGLES,j,f.ah.disabled,F.colorModeForRenderPass(),f.ag.backCW,se,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(y,p,I,w,P):"gradient"===M&&"sky"===y.renderPass&&function(F,z,j,q,Z){const ne=F.context,re=ne.gl,ie=F.transform,Q=F.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new ln(ne)),ne.activeTexture.set(re.TEXTURE0);let se=z.colorRampTexture;se||(se=z.colorRampTexture=new f.T(ne,z.colorRamp,re.RGBA)),se.bind(re.LINEAR,re.CLAMP_TO_EDGE);const ce=(de=ie.skyboxMatrix,be=z.getCenter(F,!1),_e=z.paint.get("sky-gradient-radius"),ye=q,De=Z,{u_matrix:de,u_color_ramp:0,u_center_direction:be,u_radius:f.ac(_e),u_opacity:ye,u_temporal_offset:De});var de,be,_e,ye,De;F.uploadCommonUniforms(ne,Q),Q.draw(F,re.TRIANGLES,j,f.ah.disabled,F.colorModeForRenderPass(),f.ag.backCW,ce,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(y,p,I,w,P)},debug:function(y,c,p,v,w,C){for(let M=0;M<p.length;M++)if(w){const F=new f.C(.8*v.r,.8*v.g,.8*v.b,1);Fn(y,c,p[M],v,-1,-1,C),Fn(y,c,p[M],v,-1,1,C),Fn(y,c,p[M],v,1,1,C),Fn(y,c,p[M],v,1,-1,C),Fn(y,c,p[M],F,0,0,C)}else Fn(y,c,p[M],v,0,0,C)},custom:function(y,c,p,v){const w=y.context,C=p.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||"offscreen"===y.renderPass)&&p.isDraped(c)){if("offscreen"===y.renderPass){const M=C.prerender;if(M){if(y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),"globe"===y.transform.projection.name){const I=y.transform.pointMerc;M.call(C,w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),f.a2(y.transform.zoom),[I.x,I.y],y.transform.pixelsPerMeterRatio)}else M.call(C,w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState()}}else if("translucent"===y.renderPass){if(y.terrain&&y.terrain.renderingToTexture){const I=C.renderToTile;if(I){const P=v[0].canonical,F=new f._(P.x+v[0].wrap*(1<<P.z),P.y,P.z);w.setDepthMode(f.af.disabled),w.setStencilMode(f.ah.disabled),w.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),I.call(C,w.gl,F),w.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),w.setStencilMode(f.ah.disabled);const M="3d"===C.renderingMode?new f.af(y.context.gl.LEQUAL,f.af.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,f.af.ReadOnly);if(w.setDepthMode(M),"globe"===y.transform.projection.name){const I=y.transform.pointMerc;C.render(w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),f.a2(y.transform.zoom),[I.x,I.y],y.transform.pixelsPerMeterRatio)}else C.render(w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState(),w.bindFramebuffer.set(null)}}else f.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(y,c,p,v){if("opaque"===y.renderPass)return;const w=p.paint.get("model-opacity");if(0===w)return;const C=p.paint.get("model-cast-shadows");if("shadow"===y.renderPass&&(!C||y.terrain&&w<.65&&p._transitionablePaint._values["model-opacity"].value.expression instanceof f.Z))return;const M=y.shadowRenderer,I=p.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,I||(M.enabled=!1));const P=()=>{M&&(M.useNormalOffset=!0,I||(M.enabled=!0))},F=c.getSource();if("light-beam"===y.renderPass&&"batched-model"!==F.type)return;if("vector"===F.type||"geojson"===F.type)return function(Q,se,ce,de,be){const _e=Q.transform;if("mercator"!==_e.projection.name)return void f.w(`Drawing 3D models for ${_e.projection.name} projection is not yet implemented`);const ye=_e.getFreeCameraOptions().position;if(!Q.modelManager)return;const De=Q.modelManager;ce.modelManager=De;const Ee=Q.shadowRenderer;if(!ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Be=ce._unevaluatedLayout._values["model-id"],ke={...ce.layout.get("model-id").parameters},pe=Q.style.order.indexOf(ce.fqid);for(const Je of de){const Ke=se.getTile(Je).getBucket(ce);if(!Ke||Ke.projection.name!==_e.projection.name)continue;const Pe=Ke.getModelUris();Pe&&!Ke.modelsRequested&&(De.addModelsFromBucket(Pe,be),Ke.modelsRequested=!0);const pt=Du(Je,_e);ke.zoom=pt;const mt=Be.possiblyEvaluate(ke);if(t0(Q,Ke,Je),il.shadowUniformsInitialized=!1,il.useSingleShadowCascade=!!Ee&&0===Ee.getMaxCascadeForTile(Je.toUnwrapped()),"shadow"===Q.renderPass&&Ee){if(1===Q.currentShadowCascade&&Ke.isInsideFirstShadowMapFrustum)continue;const Oe=_e.calculatePosMatrix(Je.toUnwrapped(),_e.worldSize);if(il.tileMatrix.set(Oe),il.shadowTileMatrix=Float32Array.from(Ee.calculateShadowPassMatrixFromMatrix(Oe)),il.aabb.min.fill(0),il.aabb.max[0]=il.aabb.max[1]=f.a4,il.aabb.max[2]=0,Go(Ke,il,Q,ce.scope))continue}const He=1<<Je.canonical.z,nt=[((ye.x-Je.wrap)*He-Je.canonical.x)*f.a4,(ye.y*He-Je.canonical.y)*f.a4,ye.z*He*f.a4];Q.conflationActive&&Object.keys(Ke.instancesPerModel).length>0&&Q.style.isLayerClipped(ce,se.getSource())&&Ke.updateReplacement(Je,Q.replacementSource,pe,be)&&(Ke.uploaded=!1,Ke.upload(Q.context));for(let Oe in Ke.instancesPerModel){const _t=Ke.instancesPerModel[Oe];_t.features.length>0&&(Oe=mt.evaluate(_t.features[0].feature,{}));const gt=De.getModel(Oe,be);if(gt&&gt.uploaded)for(const Wt of gt.nodes)Wf(Q,ce,Wt,_t,nt,Je,il)}}}(y,c,p,v,"vector"===F.type?p.scope:""),void P();if(!F.loaded())return;if("batched-model"===F.type)return function(Q,se,ce,de){ce.resetLayerRenderingStats(Q);const be=Q.context,_e=Q.transform,ye=Q.style.fog,De=Q.shadowRenderer;if("mercator"!==_e.projection.name)return void f.w(`Drawing 3D landmark models for ${_e.projection.name} projection is not yet implemented`);const Ee=Q.transform.getFreeCameraOptions().position,Be=f.$.scale([],[Ee.x,Ee.y,Ee.z],Q.transform.worldSize);f.$.negate(Be,Be);const ke=f.ae.identity([]),pe=f.ci(_e.center.lat,_e.zoom),Je=f.ae.fromScaling([],[1,1,1/pe]);f.ae.translate(ke,ke,Be);const Ke=ce.paint.get("model-opacity"),Pe=new f.af(be.gl.LEQUAL,f.af.ReadWrite,Q.depthRangeFor3D),pt=new f.af(be.gl.LEQUAL,f.af.ReadOnly,Q.depthRangeFor3D),mt=new f.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),He="shadow"===Q.renderPass,nt=He&&De?De.getCurrentCascadeFrustum():_e.getFrustum(_e.scaleZoom(_e.worldSize)),Oe=ce.paint.get("model-front-cutoff"),_t=Oe[2]<1,gt=Ra(Q,ce.paint.get("model-cutoff-fade-range")),Wt=ce.getLayerRenderingStats();(function(Vt,bt,Qt,Pn){const Yn=Vt.terrain?Vt.terrain.exaggeration():0,Un=Vt.transform.zoom;for(const or of Pn){const Kn=bt.getTile(or).getBucket(Qt);Kn&&(Vt.conflationActive&&Kn.updateReplacement(or,Vt.replacementSource),Kn.evaluateScale(Vt,Qt),Vt.terrain&&Yn>0&&Kn.elevationUpdate(Vt.terrain,Yn,or,Qt.source),Kn.needsReEvaluation(Vt,Un,Qt)&&Kn.evaluate(Qt))}})(Q,se,ce,de),function(){let Vt,bt,Qt;_t?(Vt=de.length-1,bt=-1,Qt=-1):(Vt=0,bt=de.length,Qt=1);for(let Pn=Vt;Pn!==bt;Pn+=Qt){const Yn=de[Pn],Un=se.getTile(Yn).getBucket(ce);if(!Un||!Un.uploaded)continue;let or=!1;De&&(or=0===De.getMaxCascadeForTile(Yn.toUnwrapped()));const Kn=_e.calculatePosMatrix(Yn.toUnwrapped(),_e.worldSize),Si=Un.modelTraits,wr=[];for(const ur of Un.getNodesInfo()){if(ur.hiddenByReplacement||!ur.node.meshes)continue;const ni=ur.node;let dr=0;Q.terrain&&ni.elevation&&(dr=ni.elevation*Q.terrain.exaggeration());const xr=ur.evaluatedScale;if(xr[0]<=1&&xr[1]<=1&&xr[2]<=1&&0===(()=>{const Xo=ur.aabb;return mt.min=[...Xo.min],mt.max=[...Xo.max],mt.min[2]+=dr,mt.max[2]+=dr,f.$.transformMat4(mt.min,mt.min,Kn),f.$.transformMat4(mt.max,mt.max,Kn),mt})().intersects(nt))continue;const Zn=[...Kn],Ir=ni.anchor?ni.anchor[0]:0,Sr=ni.anchor?ni.anchor[1]:0;f.ae.translate(Zn,Zn,[Ir*(xr[0]-1),Sr*(xr[1]-1),dr]),f.$.exactEquals(xr,f.cl)||f.ae.scale(Zn,Zn,xr);const tr=f.ae.multiply([],Zn,ni.matrix),vs=f.ae.multiply([],_e.expandedFarZProjMatrix,tr),Es=f.ae.multiply([],_e.expandedFarZProjMatrix,Zn),Zo=f.aB.transformMat4([],[Ir,Sr,dr,1],vs)[2];ni.hidden=!1;let yo=Ke;He||(_t&&(yo*=Zf(Zn,_e,ur.aabb,Oe)),yo*=Qs(gt,Zo)),0!==yo?wr.push({nodeInfo:ur,depth:Zo,opacity:yo,wvpForNode:vs,wvpForTile:Es,nodeModelMatrix:tr,tileModelMatrix:Zn}):ni.hidden=!0}He||wr.sort((ur,ni)=>!_t||1===ur.opacity&&1===ni.opacity?ur.depth<ni.depth?-1:1:1===ur.opacity?-1:1===ni.opacity?1:ur.depth>ni.depth?-1:1);for(const ur of wr){const ni=ur.nodeInfo,dr=ni.node;let xr=f.ae.multiply([],Je,ur.tileModelMatrix);f.ae.multiply(xr,ke,xr);const Zn=f.ae.invert([],xr);f.ae.transpose(Zn,Zn),f.ae.scale(Zn,Zn,qf),xr=f.ae.multiply(xr,xr,dr.matrix);const Ir="light-beam"===Q.renderPass,Sr=Si&f.cn.HasMapboxMeshFeatures,tr=Sr?0:ni.evaluatedRMEA[0][2];for(let vs=0;vs<dr.meshes.length;++vs){const Es=dr.meshes[vs],Zo=vs===dr.lightMeshIndex;let yo=ur.wvpForNode;if(Zo){if(!Ir&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}yo=ur.wvpForTile}else if(Ir)continue;const Xo={defines:[]},da=[];if(Su(Xo.defines,da,Es,Q,ce.lut),Sr||Xo.defines.push("DIFFUSE_SHADED"),or&&Xo.defines.push("SHADOWS_SINGLE_CASCADE"),Wt&&(He?Wt.numRenderedVerticesInShadowPass+=Es.vertexArray.length:Wt.numRenderedVerticesInTransparentPass+=Es.vertexArray.length),He){$v(Es,ur.nodeModelMatrix,Q,ce);continue}let Ao=null;if(ye){const Qe=Gf(ur.nodeModelMatrix,Q.transform);if(Ao=new Float32Array(Qe),"globe"!==_e.projection.name){const Mh=Es.aabb.min,eu=Es.aabb.max,[Ah,tu]=ye.getOpacityForBounds(Qe,Mh[0],Mh[1],eu[0],eu[1]);Xo.overrideFog=Ah>=Yr||tu>=Yr}}const Yo=Es.material;let Pt;Yo.occlusionTexture&&Yo.occlusionTexture.offsetScale&&(Pt=Yo.occlusionTexture.offsetScale,Xo.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!He&&De&&(De.useNormalOffset=!!Es.normalBuffer);const fn=Q.getOrCreateProgram("model",Xo);!He&&De&&De.setupShadowsFromMatrix(ur.tileModelMatrix,fn,De.useNormalOffset),Q.uploadCommonUniforms(be,fn,null,Ao);const Ba=Yo.pbrMetallicRoughness;Ba.metallicFactor=.9,Ba.roughnessFactor=.5;const Pi=Lf(new Float32Array(yo),new Float32Array(xr),new Float32Array(Zn),new Float32Array(dr.matrix),Q,ur.opacity,Ba.baseColorFactor.toRenderColor(null),Yo.emissiveFactor,Ba.metallicFactor,Ba.roughnessFactor,Yo,tr,ce,[0,0,0],Pt);!Zo&&(ni.hasTranslucentParts||ur.opacity<1)&&fn.draw(Q,be.gl.TRIANGLES,Pe,f.ah.disabled,f.a.disabled,f.ag.backCCW,Pi,ce.id,Es.vertexBuffer,Es.indexBuffer,Es.segments,ce.paint,Q.transform.zoom,void 0,da),fn.draw(Q,be.gl.TRIANGLES,Zo?pt:Pe,f.ah.disabled,Zo||ur.opacity<1||ni.hasTranslucentParts?f.a.alphaBlended:f.a.unblended,f.ag.backCCW,Pi,ce.id,Es.vertexBuffer,Es.indexBuffer,Es.segments,ce.paint,Q.transform.zoom,void 0,da)}}}}()}(y,c,p,v),void P();if("model"!==F.type)return;const z=F.getModels(),j=[],q=y.transform.getFreeCameraOptions().position,Z=f.$.scale([],[q.x,q.y,q.z],y.transform.worldSize);f.$.negate(Z,Z);const ne=[],re=[];let ie=0;for(const Q of z){const se=p.paint.get("model-rotation").constantOr(null),ce=p.paint.get("model-scale").constantOr(null),de=p.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(y,se,ce,de,!0,!0,!1);const be=f.ae.identity([]),_e=f.ci(Q.position.lat,y.transform.zoom),ye=f.ae.fromScaling([],[1,1,1/_e]);f.ae.translate(be,be,Z),j.push({zScaleMatrix:ye,negCameraPosMatrix:be});for(const De of Q.nodes)Os(y.transform,De,Q.matrix,y.transform.expandedFarZProjMatrix,ie,ne,re);ie++}if(ne.sort((Q,se)=>se.depth-Q.depth),"shadow"!==y.renderPass){if(1===w)for(const Q of re)ca(Q,y,p,j[Q.modelIndex],f.ah.disabled,y.colorModeForRenderPass());else{for(const Q of re)ca(Q,y,p,j[Q.modelIndex],f.ah.disabled,f.a.disabled);for(const Q of re)ca(Q,y,p,j[Q.modelIndex],y.stencilModeFor3D(),y.colorModeForRenderPass());y.resetStencilClippingMasks()}for(const Q of ne)ca(Q,y,p,j[Q.modelIndex],f.ah.disabled,y.colorModeForRenderPass());P()}else{for(const Q of re)$v(Q.mesh,Q.nodeModelMatrix,y,p);for(const Q of ne)$v(Q.mesh,Q.nodeModelMatrix,y,p);P()}}},eo={model:function(y,c,p){const v=c.getSource();if(!v.loaded())return;if("vector"===v.type||"geojson"===v.type)return void(p.modelManager&&p.modelManager.upload(p,"vector"===v.type?y.scope:""));if("batched-model"===v.type||"model"!==v.type)return;const w=v.getModels();for(const C of w)C.upload(p.context)},raster:function(y,c,p){const v=c.getSource();if(!(v instanceof gh&&v.loaded()))return;const w=y.sourceLayer||v.rasterLayerIds&&v.rasterLayerIds[0];if(!w)return;const C=y.paint.get("raster-array-band")||v.getInitialBand(w);if(null==C)return;const M=c.getIds().map(I=>c.getTileByID(I));for(const I of M)I.updateNeeded(w,C)&&v.prepareTile(I,w,C)},"raster-particle":function(y,c,p){const v=c.getSource();if(!(v instanceof gh&&v.loaded()))return;const w=y.sourceLayer||v.rasterLayerIds&&v.rasterLayerIds[0];if(!w)return;const C=y.paint.get("raster-particle-array-band")||v.getInitialBand(w);if(null==C)return;const M=c.getIds().map(I=>c.getTileByID(I));for(const I of M)I.updateNeeded(w,C)&&v.prepareTile(I,w,C)}};class l1{constructor(c,p,v,w){this.context=new ch(c,p),this.transform=v,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=f.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const I of C)this._debugParams.enabledLayers[I]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const I of C)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],I);this.occlusionParams=new ti(w),this.setup(),this.numSublayers=f.bx.maxUnderzooming+f.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new f.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Z_(this),this._wireframeDebugCache=new rr,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new f.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new f.T(this.context,M,c.RGBA)}updateTerrain(c,p){const v=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new aa(this,c));const w=this._terrain;this.transform.elevation=v?w:null,w.update(c,this.transform,p),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(c){const p=c.fog;if(!p||"globe"===this.transform.projection.name||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=p.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const C=v+.78*(w-v);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(c){c&&!this._terrain&&(this._terrain=new aa(this,this.style)),this._forceTerrainMode=c}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(c,p){if(this.width=c*f.e.devicePixelRatio,this.height=p*f.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._mergedLayers[v].resize()}setup(){const c=this.context,p=new f.bv;p.emplaceBack(0,0),p.emplaceBack(f.a4,0),p.emplaceBack(0,f.a4),p.emplaceBack(f.a4,f.a4),this.tileExtentBuffer=c.createVertexBuffer(p,f.bt.members),this.tileExtentSegments=f.b.simpleSegment(0,0,4,2);const v=new f.bv;v.emplaceBack(0,0),v.emplaceBack(f.a4,0),v.emplaceBack(0,f.a4),v.emplaceBack(f.a4,f.a4),this.debugBuffer=c.createVertexBuffer(v,f.bt.members),this.debugSegments=f.b.simpleSegment(0,0,4,5);const w=new f.bv;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(w,f.bt.members),this.viewportSegments=f.b.simpleSegment(0,0,4,2);const C=new f.cq;C.emplaceBack(0,0,0,0),C.emplaceBack(f.a4,0,f.a4,0),C.emplaceBack(0,f.a4,0,f.a4),C.emplaceBack(f.a4,f.a4,f.a4,f.a4),this.mercatorBoundsBuffer=c.createVertexBuffer(C,f.cr.members),this.mercatorBoundsSegments=f.b.simpleSegment(0,0,4,2);const M=new f.bw;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(M);const I=new f.cs;for(const F of[0,1,3,2,0])I.emplaceBack(F);this.debugIndexBuffer=c.createIndexBuffer(I),this.emptyTexture=new f.T(c,new f.j({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=f.ae.create();const P=this.context.gl;this.stencilClearMode=new f.ah({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,c.TRIANGLES,f.af.disabled,this.stencilClearMode,f.a.disabled,f.ag.disabled,ym(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,p,v){if(!p||this.currentStencilSource===p.id||!c.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const P of v)if(void 0===this._tileClippingMaskIDs[P.key]){I=!0;break}if(!I)return}this.currentStencilSource=p.id;const w=this.context,C=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(f.a.disabled),w.setDepthMode(f.af.disabled);const M=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of v){const P=p.getTile(I),F=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:j,tileBoundsSegments:q}=this.getTileBoundsBuffers(P);M.draw(this,C.TRIANGLES,f.af.disabled,new f.ah({func:C.ALWAYS,mask:0},F,255,C.KEEP,C.KEEP,C.REPLACE),f.a.disabled,f.ag.disabled,ym(I.projMatrix),"$clipping",z,j,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,p=this.context.gl;return new f.ah({func:p.NOTEQUAL,mask:255},c,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const p=this.context.gl;return new f.ah({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(c){const p=this.context.gl,v=c.sort((M,I)=>I.overscaledZ-M.overscaledZ),w=v[v.length-1].overscaledZ,C=v[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const M={};for(let I=0;I<C;I++)M[I+w]=new f.ah({func:p.GEQUAL,mask:255},I+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=C,[M,v]}return[{[w]:f.ah.disabled},v]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new f.a([c.CONSTANT_COLOR,c.ONE,c.CONSTANT_COLOR,c.ONE],new f.C(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.a.unblended:f.a.alphaBlended}colorModeForDrapableLayerRenderPass(c){const p=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&"translucent"===this.renderPass?new f.a([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.CONSTANT_ALPHA,p.ONE_MINUS_SRC_ALPHA],new f.C(0,0,0,void 0===c?0:c),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(c,p,v,w=!1){if(this.depthOcclusion)return new f.af(this.context.gl.GREATER,f.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!w)return f.af.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new f.af(v||this.context.gl.LEQUAL,p,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const c=this.context.gl,p=Math.ceil(this.width),v=Math.ceil(this.height),w=this.context.bindFramebuffer.get(),C=c.getParameter(c.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===p&&this.depthFBO.height===v||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==p&&0!==v&&(this.depthFBO=new el(this.context,p,v,!1,"texture"),this.depthTexture=new f.T(this.context,{width:p,height:v,data:null},c.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(w),c.bindTexture(c.TEXTURE_2D,C),this.depthFBO&&(c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.bindFramebuffer(c.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),c.blitFramebuffer(0,0,p,v,0,0,p,v,c.DEPTH_BUFFER_BIT,c.NEAREST),c.bindFramebuffer(c.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((c,p)=>c+p/this._fpsHistory.length,0))}render(c,p){const v=f.e.now();this._dt=v-this._timeStamp,this._timeStamp=v,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=c.map.repaint,this.style=c,this.options=p;const w=this.style._mergedLayers,C=this.style.order.filter(ke=>{const pe=w[ke];return!(pe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[pe.type]});let M=!1,I=!1;for(const ke of C){const pe=w[ke];"circle"===pe.type&&(M=!0),"symbol"===pe.type&&(pe.hasInitialOcclusionOpacityProperties?I=!0:M=!0)}const P=C.map(ke=>w[ke]),F=this.style._mergedSourceCaches;this.imageManager=c.imageManager,this.modelManager=c.modelManager,this.symbolFadeChange=c.placement.symbolFadeChange(f.e.now()),this.imageManager.beginFrame();let z=0,j=!1;for(const ke in F){const pe=F[ke];pe.used&&(pe.prepare(this.context),pe.getSource().usedInConflation&&++z)}let q=!1;for(const ke of P)ke.isHidden(this.transform.zoom)||("clip"===ke.type&&(q=!0),this.prepareLayer(ke));const Z={},ne={},re={},ie={},Q={};for(const ke in F){const pe=F[ke];Z[ke]=pe.getVisibleCoordinates(),ne[ke]=Z[ke].slice().reverse(),re[ke]=pe.getVisibleCoordinates(!0).reverse(),ie[ke]=pe.getShadowCasterCoordinates(),Q[ke]=pe.sortCoordinatesByDistance(Z[ke])}const se=ke=>{const pe=this.style.getLayerSourceCache(ke);return pe&&pe.used?pe.getSource():null};if(z||q){const ke=[],pe=[];let Je=0;for(const Ke of P)this.isSourceForClippingOrConflation(Ke,se(Ke))&&(ke.push(Ke),pe.push(Je)),Je++;if(ke&&(q||ke.length>1)){const Ke=[];for(let Pe=0;Pe<ke.length;Pe++){const pt=ke[Pe],mt=pe[Pe],He=this.style.getLayerSourceCache(pt);if(!He||!He.used||!He.getSource().usedInConflation&&"clip"!==pt.type)continue;let nt=f.cv,Oe=f.cw.None;const _t=[];if("clip"===pt.type){nt=mt;for(const gt of pt.layout.get("clip-layer-types"))Oe|="model"===gt?f.cw.Model:"symbol"===gt?f.cw.Symbol:f.cw.FillExtrusion;for(const gt of pt.layout.get("clip-layer-scope"))_t.push(gt)}Ke.push({layer:pt.fqid,cache:He,order:nt,clipMask:Oe,clipScope:_t})}this.replacementSource.setSources(Ke),j=!0}}j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ke=0;ke<P.length;ke++){const pe=P[ke],Je=pe.cutoffRange();if(this.longestCutoffRange=Math.max(Je,this.longestCutoffRange),Je>0){const Ke=se(pe);Ke&&(this.minCutoffZoom=Math.max(Ke.minzoom,this.minCutoffZoom)),pe.minzoom&&(this.minCutoffZoom=Math.max(pe.minzoom,this.minCutoffZoom))}pe.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ke),this._lastOcclusionLayer=ke)}const ce=this.style&&this.style.fog;ce?(this._fogVisible=0!==ce.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(re),this.opaquePassCutoff=0);const de=this._shadowRenderer;if(de){de.updateShadowParameters(this.transform,this.style.directionalLight);for(const ke in F)for(const pe of Z[ke]){let Je={min:0,max:0};this.terrain&&(Je=this.terrain.getMinMaxForTile(pe)||Je),de.addShadowReceiver(pe.toUnwrapped(),Je.min,Je.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Hf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!f.cu(this.context.gl))return;this.renderPass="offscreen";for(const ke of P){const pe=c.getLayerSourceCache(ke);if(!ke.hasOffscreenPass()||ke.isHidden(this.transform.zoom))continue;const Je=pe?ne[pe.id]:void 0;("custom"===ke.type||"raster"===ke.type||"raster-particle"===ke.type||ke.isSky()||Je&&Je.length)&&this.renderLayer(this,pe,ke,Je)}this.depthRangeFor3D=[0,1-(P.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const be="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),_e=(()=>{if(p.showOverdrawInspector)return f.C.black;const ke=this.style.fog;if(ke&&this.transform.projection.supportsFog){const pe=this.style.getLut(ke.scope);if(!be){const Je=ke.properties.get("color").toRenderColor(pe).toArray01();return new f.C(...Je)}if(be){const Je=ke.properties.get("space-color").toRenderColor(pe).toArray01();return new f.C(...Je)}}return f.C.transparent})();if(this.context.clear({color:_e,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const ke=P[this.currentLayer],pe=c.getLayerSourceCache(ke);if(ke.isSky())continue;const Je=pe?(ke.is3D()?Q:ne)[pe.id]:void 0;this._renderTileClippingMasks(ke,pe,Je),this.renderLayer(this,pe,ke,Je)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||f.a2(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const ke=P[this.currentLayer],pe=c.getLayerSourceCache(ke);ke.isSky()&&this.renderLayer(this,pe,ke,pe?ne[pe.id]:void 0)}function ye(ke,pe){let Je;return pe&&(Je=("symbol"===ke.type?re:ke.is3D()?Q:ne)[pe.id]),Je}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const ke=P[this.currentLayer];if("raster"===ke.type||"raster-particle"===ke.type){const pe=c.getLayerSourceCache(ke);this.renderLayer(this,pe,ke,ye(ke,pe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let De=0;de&&(De=de.getShadowCastingLayerCount());let Ee=!1,Be=-1;for(let ke=0;ke<C.length;++ke){const pe=P[ke];pe.isHidden(this.transform.zoom)||pe.is3D()&&(Be=ke)}for(I&&-1===Be&&(M=!0);this.currentLayer<C.length;){const ke=P[this.currentLayer],pe=c.getLayerSourceCache(ke);if(ke.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ke)){if(ke.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(M&&!Ee&&this.terrain&&!this.transform.isOrthographic&&(Ee=!0,this.blitDepth()),I&&-1!==Be&&this.currentLayer===Be+1&&!this.transform.isOrthographic&&this.blitDepth(),ke.is3D()||this.terrain||this._renderTileClippingMasks(ke,pe,pe?Z[pe.id]:void 0),this.renderLayer(this,pe,ke,ye(ke,pe)),!this.terrain&&de&&De>0&&ke.hasShadowPass()&&0==--De&&(de.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Je=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Je;this.currentLayer++){const Ke=P[this.currentLayer];if(!Ke.hasLightBeamPass())continue;const Pe=c.getLayerSourceCache(Ke);this.renderLayer(this,Pe,Ke,Pe?ne[Pe.id]:void 0)}this.currentLayer=Je,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Je=this.currentLayer;this.depthOcclusion=!0;for(const Ke of this.layersWithOcclusionOpacity){this.currentLayer=Ke;const Pe=P[this.currentLayer],pt=c.getLayerSourceCache(Pe),mt=pt?ne[pt.id]:void 0;Pe.is3D()||this.terrain||this._renderTileClippingMasks(Pe,pt,pt?Z[pt.id]:void 0),this.renderLayer(this,pt,Pe,mt)}this.depthOcclusion=!1,this.currentLayer=Je,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ke=null;P.forEach(pe=>{const Je=c.getLayerSourceCache(pe);Je&&!pe.isHidden(this.transform.zoom)&&Je.getVisibleCoordinates().length&&(!ke||ke.getSource().maxzoom<Je.getSource().maxzoom)&&(ke=Je)}),ke&&this.options.showTileBoundaries&&Kc.debug(this,ke,ke.getVisibleCoordinates(),f.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Kc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new f.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ke){const pe=ke.transform.padding;a1(ke,ke.transform.height-(pe.top||0),3,jv),a1(ke,pe.bottom||0,3,o1),Vf(ke,pe.left||0,3,sn),Vf(ke,ke.transform.width-(pe.right||0),3,Jr);const Je=ke.transform.centerPoint;var Ke,Pe,pt,mt;jf(Ke=ke,(Pe=Je.x)-1,(pt=ke.transform.height-Je.y)-10,2,20,mt=Ui),jf(Ke,Pe-10,pt-1,20,2,mt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(c){this.gpuTimingStart(c);const{unsupportedLayers:p}=this.transform.projection,v=!p||!p.includes(c.type);if(eo[c.type]&&(v||this.terrain&&"custom"===c.type)){const w=this.style.getLayerSourceCache(c);eo[c.type](c,w,this)}this.gpuTimingEnd()}renderLayer(c,p,v,w){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||"model"===v.type||"raster"===v.type||"raster-particle"===v.type||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes(v.type)&&(!c.terrain||"custom"!==v.type)||"clip"===v.type||Kc[v.type](c,p,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery,v=this.context.gl;let w=this.gpuTimers[c.id];w||(w=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:v.createQuery()}),w.calls++,v.beginQuery(p.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,p=this.context.gl,v=p.createQuery();this.deferredRenderGpuTimeQueries.push(v),p.beginQuery(c.TIME_ELAPSED_EXT,v)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const p={};for(const v in c){const w=c[v],C=this.context.extTimerQuery,M=C.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;C.deleteQueryEXT(w.query),p[v]=M}return p}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.extTimerQuery,v=this.context.gl;let w=0;for(const C of c)w+=p.getQueryParameter(C,v.QUERY_RESULT)/1e6,p.deleteQueryEXT(C);return w}translatePosMatrix(c,p,v,w,C){if(!v[0]&&!v[1])return c;const M=C?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(M){const F=Math.sin(M),z=Math.cos(M);v=[v[0]*z-v[1]*F,v[0]*F+v[1]*z]}const I=[C?v[0]:f.bD(p,v[0],this.transform.zoom),C?v[1]:f.bD(p,v[1],this.transform.zoom),0],P=new Float32Array(16);return f.ae.translate(P,c,I),P}saveTileTexture(c){const p=c.size[0],v=this._tileTextures[p];v?v.push(c):this._tileTextures[p]=[c]}getTileTexture(c){const p=this._tileTextures[c];return p&&p.length>0?p.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(c,p,v){const w=void 0===v?this.terrain&&this.terrain.renderingToTexture:v,C=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===c||"terrainRaster"===c?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||C.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||C.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?C.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):C.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&C.push("GLOBE"),!this._fogVisible||w||void 0!==p&&!p||C.push("FOG","FOG_DITHERING"),w&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(c,p){this.cache=this.cache||{};const v=p&&p.defines||[],w=p&&p.config,C=this.currentGlobalDefines(c,p&&p.overrideFog,p&&p.overrideRtt).concat(v),M=K_.cacheKey(Xw[c],c,C,w);return this.cache[M]||(this.cache[M]=new K_(this.context,c,Xw[c],w,zv[c],C)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(c,p){if(this.style.enable3dLights()){const v=this.style.directionalLight,w=this.style.ambientLight;if(v&&w){const C=((M,I,P)=>{const F=M.properties.get("direction"),z=M.properties.get("color").toRenderColor(P.getLut(M.scope)).toArray01(),j=M.properties.get("intensity"),q=I.properties.get("color").toRenderColor(P.getLut(I.scope)).toArray01(),Z=I.properties.get("intensity"),ne=[F.x,F.y,F.z],re=f.bC(q,Z),ie=f.bC(z,j);return{u_lighting_ambient_color:re,u_lighting_directional_dir:ne,u_lighting_directional_color:ie,u_ground_radiance:Y_(ne,ie,re)}})(v,w,this.style);p.setLightsUniformValues(c,C)}}}uploadCommonUniforms(c,p,v,w,C){if(this.uploadCommonLightUniforms(c,p),this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const I=M.getOpacity(this.transform.pitch),P=((F,z,j,q,Z,ne,re,ie,Q,se,ce,de)=>{const be=F.transform,_e=z.properties.get("color").toRenderColor(F.style.getLut(z.scope)).toArray01();_e[3]=q;const ye=F.frameCounter/1e3%1,[De,Ee]=z.properties.get("vertical-range");return{u_fog_matrix:j?be.calculateFogTileMatrix(j):de||F.identityMat,u_fog_range:z.getFovAdjustedRange(be._fov),u_fog_color:_e,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(De,Ee),Ee],u_fog_temporal_offset:ye,u_frustum_tl:Z,u_frustum_tr:ne,u_frustum_br:re,u_frustum_bl:ie,u_globe_pos:Q,u_globe_radius:se,u_viewport:ce,u_globe_transition:f.a2(be.zoom),u_is_globe:+("globe"===be.projection.name)}})(this,M,v,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*f.e.devicePixelRatio,this.transform.height*f.e.devicePixelRatio],w);p.setFogUniformValues(c,P)}C&&p.setCutoffUniformValues(c,C.uniformValues)}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,p=c.createTexture();return c.bindTexture(c.TEXTURE_2D,p),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,p=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)p[w.key]=c[w.key]||new f.bA(w,512,this.transform.tileZoom,this);return p}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(c,p){return!(!c.is3D()||c.minzoom&&c.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||"building"!==c.sourceLayer)&&"clip"!==c.type&&(!p||"batched-model"!==p.type))}isTileAffectedByFog(c){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let p=this._cachedTileFogOpacities[c.key];return p||(this._cachedTileFogOpacities[c.key]=p=this.style.fog.getOpacityForTile(c)),p[0]>=Yr||p[1]>=Yr}setupDepthForOcclusion(c,p,v){const w=this.context,C=w.gl,M=!!v;var I;v||(v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),w.activeTexture.set(C.TEXTURE3),c&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),v.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],v.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],v.u_occluder_half_size=.5*this.occlusionParams.occluderSize,v.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),w.activeTexture.set(C.TEXTURE0),M||p.setTerrainUniformValues(w,v)}}class nc{constructor(c,p,v,w){this.screenBounds=c,this.cameraPoint=p,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(c,p){let v,w;if(c instanceof f.P||"number"==typeof c[0]){const C=f.P.convert(c);v=[C],w=p.isPointAboveHorizon(C)}else{const C=f.P.convert(c[0]),M=f.P.convert(c[1]);v=[C,M],w=f.cx(C,M).every(I=>p.isPointAboveHorizon(I))}return new nc(v,p.getCameraPoint(),w,p)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return f.cx(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const p=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new f.P(1,1)):this.screenBounds[1],w=f.cx(p,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(w[3]=this.cameraPoint)),f.cy(w,c)}bufferedCameraGeometryGlobe(c){const p=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new f.P(1,1)):this.screenBounds[1],w=f.cx(p,v,c),C=this.cameraPoint.clone();switch(3*((C.y>p.y)+(C.y>v.y))+((C.x>p.x)+(C.x>v.x))){case 0:w[0]=C,w[4]=C.clone();break;case 1:w.splice(1,0,C);break;case 2:w[1]=C;break;case 3:w.splice(4,0,C);break;case 5:w.splice(2,0,C);break;case 6:w[3]=C;break;case 7:w.splice(3,0,C);break;case 8:w[2]=C}return w}containsTile(c,p,v,w=0){const C=c.queryPadding/p._pixelsPerMercatorPixel+1,M=v?this._bufferedCameraMercator(C,p):this._bufferedScreenMercator(C,p);let I=c.tileID.wrap+(M.unwrapped?w:0);const P=M.polygon.map(ie=>f.cz(c.tileTransform,ie,I));if(!f.cA(P,0,0,f.a4,f.a4))return;I=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const F=this.screenGeometryMercator.polygon.map(ie=>f.cB(c.tileTransform,ie,I)),z=F.map(ie=>new f.P(ie[0],ie[1])),j=p.getFreeCameraOptions().position||new f._(0,0,0),q=f.cB(c.tileTransform,j,I),Z=F.map(ie=>{const Q=f.$.sub(ie,ie,q);return f.$.normalize(Q,Q),new f.aU(q,Q)}),ne=f.bD(c,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:Z,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(re=f.cC(P),re.min.x=f.au(re.min.x,0,f.a4),re.min.y=f.au(re.min.y,0,f.a4),re.max.x=f.au(re.max.x,0,f.a4),re.max.y=f.au(re.max.y,0,f.a4),re),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:ne};var re}_bufferedScreenMercator(c,p){const v=Gr(c);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w="globe"===p.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),p):{polygon:this.bufferedScreenGeometry(c).map(C=>p.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(c,p){const v=Gr(c);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w="globe"===p.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),p):{polygon:this.bufferedCameraGeometry(c).map(C=>p.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(c,p){const v=function(C,M){const I=f.ae.multiply([],M.pixelMatrix,M.globeMatrix),P=[0,-f.cF,0,1],F=[0,f.cF,0,1],z=[0,0,0,1];f.aB.transformMat4(P,P,I),f.aB.transformMat4(F,F,I),f.aB.transformMat4(z,z,I);const j=new f.P(P[0]/P[3],P[1]/P[3]),q=new f.P(F[0]/F[3],F[1]/F[3]),Z=f.cD(C,j)&&P[3]<z[3],ne=f.cD(C,q)&&F[3]<z[3];if(!Z&&!ne)return null;const re=function(ye,De,Ee){for(let Be=1;Be<ye.length;Be++){const ke=Dc(De.pointCoordinate3D(ye[Be-1]).x),pe=Dc(De.pointCoordinate3D(ye[Be]).x);if(Ee<0){if(ke<pe)return{idx:Be,t:-ke/(pe-1-ke)}}else if(pe<ke)return{idx:Be,t:(1-ke)/(pe+1-ke)}}return null}(C,M,Z?-1:1);if(!re)return null;const{idx:ie,t:Q}=re;let se=ie>1?kd(C.slice(0,ie),M):[],ce=ie<C.length?kd(C.slice(ie),M):[];se=se.map(ye=>new f.P(Dc(ye.x),ye.y)),ce=ce.map(ye=>new f.P(Dc(ye.x),ye.y));const de=[...se];0===de.length&&de.push(ce[ce.length-1]);const be=f.a3(de[de.length-1].y,(0===ce.length?se[0]:ce[0]).y,Q);let _e;return _e=Z?[new f.P(0,be),new f.P(0,0),new f.P(1,0),new f.P(1,be)]:[new f.P(1,be),new f.P(1,1),new f.P(0,1),new f.P(0,be)],de.push(..._e),0===ce.length?de.push(se[0]):de.push(...ce),{polygon:de.map(ye=>new f._(ye.x,ye.y)),unwrapped:!1}}(c,p);if(v)return v;const w=function(C,M){let I=!1,P=-1/0,F=0;for(let j=0;j<C.length-1;j++)C[j].x>P&&(P=C[j].x,F=j);for(let j=0;j<C.length-1;j++){const q=(F+j)%(C.length-1),Z=C[q],ne=C[q+1];Math.abs(Z.x-ne.x)>.5&&(Z.x<ne.x?(Z.x+=1,0===q&&(C[C.length-1].x+=1)):(ne.x+=1,q+1===C.length-1&&(C[0].x+=1)),I=!0)}const z=f.ak(M.center.lng);return I&&z<Math.abs(z-1)&&C.forEach(j=>{j.x-=1}),{polygon:C,unwrapped:I}}(kd(c,p).map(C=>new f.P(Dc(C.x),C.y)),p);return{polygon:w.polygon.map(C=>new f._(C.x,C.y)),unwrapped:w.unwrapped}}}function kd(y,c){return f.cE(y,p=>{const v=c.pointCoordinate3D(p);p.x=v.x,p.y=v.y},1/256)}function Dc(y){return y<0?1+y%1:y%1}function Gr(y){return 100*y|0}function c1(y,c){const p=f.ae.identity([]);return f.ae.scale(p,p,[.5*y.width,.5*-y.height,1]),f.ae.translate(p,p,[1,-1,0]),f.ae.multiply(p,p,y.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(p)}function Jc(y,c,p,v,w,C,M,I=!1){const P=y.tilesIn(v,M,I);P.sort(n0);const F=[];for(const j of P)F.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(c,p,y._state,j,w,C,c1(y.transform,j.tile.tileID),I)});const z=function(j){const q={},Z={};for(const ne of j){const re=ne.queryResults,ie=ne.wrappedTileID,Q=Z[ie]=Z[ie]||{};for(const se in re){const ce=re[se],de=Q[se]=Q[se]||{},be=q[se]=q[se]||[];for(const _e of ce)de[_e.featureIndex]||(de[_e.featureIndex]=!0,be.push(_e))}}return q}(F);for(const j in z)z[j].forEach(q=>{const Z=q.feature,ne=Z.layer;ne&&"background"!==ne.type&&"sky"!==ne.type&&"slot"!==ne.type&&(Z.source=ne.source,ne["source-layer"]&&(Z.sourceLayer=ne["source-layer"]),Z.state=void 0!==Z.id?y.getFeatureState(ne["source-layer"],Z.id):{})});return z}function sl(y,c){const p=y.getRenderableIds().map(C=>y.getTileByID(C)),v=[],w={};for(let C=0;C<p.length;C++){const M=p[C],I=M.tileID.canonical.key;w[I]||(w[I]=!0,M.querySourceFeatures(v,c))}return v}function n0(y,c){const p=y.tileID,v=c.tileID;return p.overscaledZ-v.overscaledZ||p.canonical.y-v.canonical.y||p.wrap-v.wrap||p.canonical.x-v.canonical.x}class Il{constructor(c){this.style=c,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const c=!1,p=!1;for(const v in this.style._mergedLayers){const w=this.style._mergedLayers[v];if("fill-extrusion"===w.type)this.layers.push({layer:w,visible:c,visibilityChanged:p});else if("model"===w.type){const C=this.style.getLayerSource(w);C&&"batched-model"===C.type&&this.layers.push({layer:w,visible:c,visibilityChanged:p})}}}onNewFrame(c){this.layersGotHidden=!1;for(const p of this.layers){const v=p.layer;let w=!1;"fill-extrusion"===v.type?w=!v.isHidden(c)&&v.paint.get("fill-extrusion-opacity")>0:"model"===v.type&&(w=!v.isHidden(c)&&v.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!w&&p.visible,p.visible=w}}updateZOffset(c,p){this.currentBuildingBuckets=[];for(const w of this.layers){const C=w.layer,M=this.style.getLayerSourceCache(C);let I=1;"fill-extrusion"===C.type&&(I=w.visible?C.paint.get("fill-extrusion-vertical-scale"):0);let P=M?M.getTile(p):null;if(!P&&M&&p.canonical.z>M.getSource().minzoom){let F=p.scaledTo(Math.min(M.getSource().maxzoom,p.overscaledZ-1));for(;F.overscaledZ>=M.getSource().minzoom&&(P=M.getTile(F),!P&&0!==F.overscaledZ);)F=F.scaledTo(F.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(C):null,tileID:P?P.tileID:p,verticalScale:I})}c.hasAnyZOffset=!1;let v=!1;for(let w=0;w<c.symbolInstances.length;w++){const C=c.symbolInstances.get(w),M=C.zOffset,I=this._getHeightAtTileOffset(p,C.tileAnchorX,C.tileAnchorY);C.zOffset=I!==Number.NEGATIVE_INFINITY?I:M,v||M===C.zOffset||(v=!0),c.hasAnyZOffset||0===C.zOffset||(c.hasAnyZOffset=!0)}v&&(c.zOffsetBuffersNeedUpload=!0,c.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(c,p,v,w){let C=p,M=v;if(c.canonical.z!==w.canonical.z){const I=w.canonical,P=1/(1<<c.canonical.z-I.z);C=(p+c.canonical.x*f.a4)*P-I.x*f.a4|0,M=(v+c.canonical.y*f.a4)*P-I.y*f.a4|0}return{tileX:C,tileY:M}}_getHeightAtTileOffset(c,p,v){let w,C;for(let M=0;M<this.layers.length;++M){if("fill-extrusion"!==this.layers[M].layer.type)continue;const{bucket:I,tileID:P,verticalScale:F}=this.currentBuildingBuckets[M];if(!I)continue;const{tileX:z,tileY:j}=this._mapCoordToOverlappingTile(c,p,v,P),q=I.getHeightAtTileCoord(z,j);q&&void 0!==q.height&&(q.hidden?w=q.height:C=Math.max(q.height*F,C||0))}if(void 0!==C)return C;for(let M=0;M<this.layers.length;++M){const I=this.layers[M];if("model"!==I.layer.type||!I.visible)continue;const{bucket:P,tileID:F}=this.currentBuildingBuckets[M];if(!P)continue;const{tileX:z,tileY:j}=this._mapCoordToOverlappingTile(c,p,v,F),q=P.getHeightAtTileCoord(z,j);if(q&&!q.hidden)return void 0===q.height&&void 0!==w?Math.min(q.maxHeight,w)*q.verticalScale:q.height?q.height*q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function CS(y,c){const p={};for(const v in y)"ref"!==v&&(p[v]=y[v]);return f.cG.forEach(v=>{v in c&&(p[v]=c[v])}),p}function Mu(y){y=y.slice();const c=Object.create(null);for(let p=0;p<y.length;p++)c[y[p].id]=y[p];for(let p=0;p<y.length;p++)"ref"in y[p]&&(y[p]=CS(y[p],c[y[p].ref]));return y}const Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Au(y,c,p){p.push({command:Wr.addSource,args:[y,c[y]]})}function Hv(y,c,p){c.push({command:Wr.removeSource,args:[y]}),p[y]=!0}function rT(y,c,p,v){Hv(y,p,v),Au(y,c,p)}function Cm(y,c,p){let v;for(v in y[p])if(y[p].hasOwnProperty(v)&&"data"!==v&&!f.d(y[p][v],c[p][v]))return!1;for(v in c[p])if(c[p].hasOwnProperty(v)&&"data"!==v&&!f.d(y[p][v],c[p][v]))return!1;return!0}function Iu(y,c,p,v,w,C){let M;for(M in c=c||{},y=y||{})y.hasOwnProperty(M)&&(f.d(y[M],c[M])||p.push({command:C,args:[v,M,c[M],w]}));for(M in c)c.hasOwnProperty(M)&&!y.hasOwnProperty(M)&&(f.d(y[M],c[M])||p.push({command:C,args:[v,M,c[M],w]}))}function ku(y){return y.id}function Ou(y,c){return y[c.id]=c,y}class Ru{constructor(c,p){this.reset(c,p)}reset(c,p){this.points=c||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=f.au(c,0,1);let p=1,v=this._distances[p];const w=c*this.paddedLength+this.padding;for(;v<w&&p<this._distances.length;)v=this._distances[++p];const C=p-1,M=this._distances[C],I=v-M,P=I>0?(w-M)/I:0;return this.points[C].mult(1-P).add(this.points[p].mult(P))}}class Sm{constructor(c,p,v){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/v),this.yCellCount=Math.ceil(p/v);for(let M=0;M<this.xCellCount*this.yCellCount;M++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=p,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,p,v,w,C){this._forEachCell(p,v,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(c,p,v,w){this._forEachCell(p-w,v-w,p+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(p),this.circles.push(v),this.circles.push(w)}_insertBoxCell(c,p,v,w,C,M){this.boxCells[C].push(M)}_insertCircleCell(c,p,v,w,C,M){this.circleCells[C].push(M)}_query(c,p,v,w,C,M){if(v<0||c>this.width||w<0||p>this.height)return!C&&[];const I=[];if(c<=0&&p<=0&&this.width<=v&&this.height<=w){if(C)return!0;for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const F=this.circles[3*P],z=this.circles[3*P+1],j=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:F-j,y1:z-j,x2:F+j,y2:z+j})}return M?I.filter(M):I}return this._forEachCell(c,p,v,w,this._queryCell,I,{hitTest:C,seenUids:{box:{},circle:{}}},M),C?I.length>0:I}_queryCircle(c,p,v,w,C){const M=c-v,I=c+v,P=p-v,F=p+v;if(I<0||M>this.width||F<0||P>this.height)return!w&&[];const z=[];return this._forEachCell(M,P,I,F,this._queryCellCircle,z,{hitTest:w,circle:{x:c,y:p,radius:v},seenUids:{box:{},circle:{}}},C),w?z.length>0:z}query(c,p,v,w,C){return this._query(c,p,v,w,!1,C)}hitTest(c,p,v,w,C){return this._query(c,p,v,w,!0,C)}hitTestCircle(c,p,v,w){return this._queryCircle(c,p,v,!0,w)}_queryCell(c,p,v,w,C,M,I,P){const F=I.seenUids,z=this.boxCells[C];if(null!==z){const q=this.bboxes;for(const Z of z)if(!F.box[Z]){F.box[Z]=!0;const ne=4*Z;if(c<=q[ne+2]&&p<=q[ne+3]&&v>=q[ne+0]&&w>=q[ne+1]&&(!P||P(this.boxKeys[Z]))){if(I.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[Z],x1:q[ne],y1:q[ne+1],x2:q[ne+2],y2:q[ne+3]})}}}const j=this.circleCells[C];if(null!==j){const q=this.circles;for(const Z of j)if(!F.circle[Z]){F.circle[Z]=!0;const ne=3*Z;if(this._circleAndRectCollide(q[ne],q[ne+1],q[ne+2],c,p,v,w)&&(!P||P(this.circleKeys[Z]))){if(I.hitTest)return M.push(!0),!0;{const re=q[ne],ie=q[ne+1],Q=q[ne+2];M.push({key:this.circleKeys[Z],x1:re-Q,y1:ie-Q,x2:re+Q,y2:ie+Q})}}}}}_queryCellCircle(c,p,v,w,C,M,I,P){const F=I.circle,z=I.seenUids,j=this.boxCells[C];if(null!==j){const Z=this.bboxes;for(const ne of j)if(!z.box[ne]){z.box[ne]=!0;const re=4*ne;if(this._circleAndRectCollide(F.x,F.y,F.radius,Z[re+0],Z[re+1],Z[re+2],Z[re+3])&&(!P||P(this.boxKeys[ne])))return M.push(!0),!0}}const q=this.circleCells[C];if(null!==q){const Z=this.circles;for(const ne of q)if(!z.circle[ne]){z.circle[ne]=!0;const re=3*ne;if(this._circlesCollide(Z[re],Z[re+1],Z[re+2],F.x,F.y,F.radius)&&(!P||P(this.circleKeys[ne])))return M.push(!0),!0}}}_forEachCell(c,p,v,w,C,M,I,P){const F=this._convertToXCellCoord(c),z=this._convertToYCellCoord(p),j=this._convertToXCellCoord(v),q=this._convertToYCellCoord(w);for(let Z=F;Z<=j;Z++)for(let ne=z;ne<=q;ne++)if(C.call(this,c,p,v,w,this.xCellCount*ne+Z,M,I,P))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,p,v,w,C,M){const I=w-c,P=C-p,F=v+M;return F*F>I*I+P*P}_circleAndRectCollide(c,p,v,w,C,M,I){const P=(M-w)/2,F=Math.abs(c-(w+P));if(F>P+v)return!1;const z=(I-C)/2,j=Math.abs(p-(C+z));if(j>z+v)return!1;if(F<=P||j<=z)return!0;const q=F-P,Z=j-z;return q*q+Z*Z<=v*v}}const Dn=100;class Gv{constructor(c,p,v=new Sm(c.width+200,c.height+200,25),w=new Sm(c.width+200,c.height+200,25)){this.transform=c,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Dn,this.screenBottomBoundary=c.height+Dn,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=p}placeCollisionBox(c,p,v,w,C,M,I,P){let F=v.projectedAnchorX,z=v.projectedAnchorY,j=v.projectedAnchorZ;const q=v.elevation,Z=v.tileID,ne=c.getProjection();if(q&&Z){const[_e,ye,De]=ne.upVector(Z.canonical,v.tileAnchorX,v.tileAnchorY),Ee=ne.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=_e*q*Ee,z+=ye*q*Ee,j+=De*q*Ee}const re=this.projectAndGetPerspectiveRatio(I,F,z,j,v.tileID,"globe"===ne.name||!!q||this.transform.pitch>0,ne),ie=M*re.perspectiveRatio,Q=(v.x1*p+w.x-v.padding)*ie+re.point.x,se=(v.y1*p+w.y-v.padding)*ie+re.point.y,ce=(v.x2*p+w.x+v.padding)*ie+re.point.x,de=(v.y2*p+w.y+v.padding)*ie+re.point.y,be=re.perspectiveRatio<=.55||re.occluded;return!this.isInsideGrid(Q,se,ce,de)||!C&&this.grid.hitTest(Q,se,ce,de,P)||be?{box:[],offscreen:!1,occluded:re.occluded}:{box:[Q,se,ce,de],offscreen:this.isOffscreen(Q,se,ce,de),occluded:!1}}placeCollisionCircles(c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re){const ie=[],Q=this.transform.elevation,se=c.getProjection(),ce=Q?Q.getAtTileOffsetFunc(re,this.transform.center.lat,this.transform.worldSize,se):null,de=new f.P(v.tileAnchorX,v.tileAnchorY);let{x:be,y:_e,z:ye}=se.projectTilePoint(de.x,de.y,re.canonical);if(ce){const[mt,He,nt]=ce(de);be+=mt,_e+=He,ye+=nt}const De="globe"===se.name,Ee=this.projectAndGetPerspectiveRatio(I,be,_e,ye,re,De||!!Q||this.transform.pitch>0,se),{perspectiveRatio:Be}=Ee,ke=(j?M/Be:M*Be)/f.bP,pe=Ec(be,_e,ye,P),Je=Ee.signedDistanceFromCamera>0?$g(ke,C,v.lineOffsetX*ke,v.lineOffsetY*ke,!1,pe,de,v,w,P,{},Q&&!j?ce:null,j&&!!Q,se,re,j):null;let Ke=!1,Pe=!1,pt=!0;if(Je&&!Ee.occluded){const mt=.5*Z*Be+ne,He=new f.P(-100,-100),nt=new f.P(this.screenRightBoundary,this.screenBottomBoundary),Oe=new Ru,{first:_t,last:gt}=Je,Wt=_t.path.length;let Vt=[];for(let Pn=Wt-1;Pn>=1;Pn--)Vt.push(_t.path[Pn]);for(let Pn=1;Pn<gt.path.length;Pn++)Vt.push(gt.path[Pn]);const bt=2.5*mt;F&&(Vt=Vt.map(([Pn,Yn,Un],or)=>(ce&&!De&&(Un=ce(or<Wt-1?_t.tilePath[Wt-1-or]:gt.tilePath[or-Wt+2])[2]),Ec(Pn,Yn,Un,F))),Vt.some(Pn=>Pn[3]<=0)&&(Vt=[]));let Qt=[];if(Vt.length>0){let Pn=1/0,Yn=-1/0,Un=1/0,or=-1/0;for(const Kn of Vt)Pn=Math.min(Pn,Kn[0]),Un=Math.min(Un,Kn[1]),Yn=Math.max(Yn,Kn[0]),or=Math.max(or,Kn[1]);Yn>=He.x&&Pn<=nt.x&&or>=He.y&&Un<=nt.y&&(Qt=[Vt.map(Kn=>new f.P(Kn[0],Kn[1]))],(Pn<He.x||Yn>nt.x||Un<He.y||or>nt.y)&&(Qt=f.cH(Qt,He.x,He.y,nt.x,nt.y)))}for(const Pn of Qt){Oe.reset(Pn,.25*mt);let Yn=0;Yn=Oe.length<=.5*mt?1:Math.ceil(Oe.paddedLength/bt)+1;for(let Un=0;Un<Yn;Un++){const or=Un/Math.max(Yn-1,1),Kn=Oe.lerp(or),Si=Kn.x+Dn,wr=Kn.y+Dn;ie.push(Si,wr,mt,0);const ur=Si-mt,ni=wr-mt,dr=Si+mt,xr=wr+mt;if(pt=pt&&this.isOffscreen(ur,ni,dr,xr),Pe=Pe||this.isInsideGrid(ur,ni,dr,xr),!p&&this.grid.hitTestCircle(Si,wr,mt,q)&&(Ke=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ke,occluded:!1}}}}return{circles:!z&&Ke||!Pe?[]:ie,offscreen:pt,collisionDetected:Ke,occluded:Ee.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const p=[];let v=1/0,w=1/0,C=-1/0,M=-1/0;for(const z of c){const j=new f.P(z.x+Dn,z.y+Dn);v=Math.min(v,j.x),w=Math.min(w,j.y),C=Math.max(C,j.x),M=Math.max(M,j.y),p.push(j)}const I=this.grid.query(v,w,C,M).concat(this.ignoredGrid.query(v,w,C,M)),P={},F={};for(const z of I){const j=z.key;if(void 0===P[j.bucketInstanceId]&&(P[j.bucketInstanceId]={}),P[j.bucketInstanceId][j.featureIndex])continue;const q=[new f.P(z.x1,z.y1),new f.P(z.x2,z.y1),new f.P(z.x2,z.y2),new f.P(z.x1,z.y2)];f.cI(p,q)&&(P[j.bucketInstanceId][j.featureIndex]=!0,void 0===F[j.bucketInstanceId]&&(F[j.bucketInstanceId]=[]),F[j.bucketInstanceId].push(j.featureIndex))}return F}insertCollisionBox(c,p,v,w,C){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:C},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,p,v,w,C){const M=p?this.ignoredGrid:this.grid,I={bucketInstanceId:v,featureIndex:w,collisionGroupID:C};for(let P=0;P<c.length;P+=4)M.insertCircle(I,c[P],c[P+1],c[P+2])}projectAndGetPerspectiveRatio(c,p,v,w,C,M,I){const P=[p,v,w,1];let F=!1;w||this.transform.pitch>0?(f.aB.transformMat4(P,P,c),this.fogState&&C&&"globe"!==I.name&&(F=function(q,Z,ne,re,ie,Q){const se=Q.calculateFogTileMatrix(ie),ce=[Z,ne,re];return f.$.transformMat4(ce,ce,se),Ur(q,f.$.length(ce),Q.pitch,Q._fov)}(this.fogState,p,v,w,C.toUnwrapped(),this.transform)>.9)):Hg(P,P,c);const z=P[3];return{point:new f.P((P[0]/z+1)/2*this.transform.width+Dn,(-P[1]/z+1)/2*this.transform.height+Dn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/z*.5,1.5),signedDistanceFromCamera:z,occluded:M&&P[2]>z||F}}isOffscreen(c,p,v,w){return v<Dn||c>=this.screenRightBoundary||w<Dn||p>this.screenBottomBoundary}isInsideGrid(c,p,v,w){return v>=0&&c<this.gridRightBoundary&&w>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const c=f.ae.identity([]);return f.ae.translate(c,c,[-100,-100,0]),c}}class Xe{constructor(c,p,v,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?p:-p))):w&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class xh{constructor(c,p,v,w,C,M=!1){this.text=new Xe(c?c.text:null,p,v,C),this.icon=new Xe(c?c.icon:null,p,w,C),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xf{constructor(c,p,v,w=!1){this.text=c,this.icon=p,this.skipFade=v,this.clipped=w}}class Dm{constructor(){this.invProjMatrix=f.ae.create(),this.viewportMatrix=f.ae.create(),this.circles=[]}}class u1{constructor(c,p,v,w,C){this.bucketInstanceId=c,this.featureIndex=p,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=C}}class Wv{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const p=++this.maxGroupID;this.collisionGroups[c]={ID:p,predicate:v=>v.collisionGroupID===p}}return this.collisionGroups[c]}}function h1(y,c,p,v,w){const{horizontalAlign:C,verticalAlign:M}=f.bS(y),I=-(C-.5)*c,P=-(M-.5)*p,F=f.bR(y,v);return new f.P(I+F[0]*w,P+F[1]*w)}function r0(y,c,p,v,w){const C=new f.P(y,c);return p&&C._rotate(v?w:-w),C}class Mm{constructor(c,p,v,w,C,M){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Gv(this.transform,C),this.buildingIndex=M,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Wv(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,p,v,w){const C=v.getBucket(p),M=v.latestFeatureIndex;if(!C||!M||p.fqid!==C.layerIds[0])return;const I=C.layers[0].layout,P=v.collisionBoxArray,F=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),z=v.tileSize/f.a4,j=v.tileID.toUnwrapped();this.transform.setProjection(C.projection);const q=(Z=v.tileID,ne=C.getProjection(),re=this.transform,ne.name===this.projection?re.calculateProjMatrix(Z.toUnwrapped()):Ts(re,ne,Z));var Z,ne,re;const ie="map"===I.get("text-pitch-alignment"),Q="map"===I.get("text-rotation-alignment");p.compileFilter();const se=p.dynamicFilter(),ce=p.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(v),be=Ug(q,v.tileID.canonical,ie,Q,this.transform,C.getProjection(),de);let _e=null;if(ie){const Ee=Vg(q,v.tileID.canonical,ie,Q,this.transform,C.getProjection(),de);_e=f.ae.multiply([],this.transform.labelPlaneMatrix,Ee)}let ye=null;se&&v.latestFeatureIndex&&(ye={unwrappedTileID:j,dynamicFilter:se,dynamicFilterNeedsFeature:ce,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new u1(C.bucketInstanceId,M,C.sourceLayerIndex,C.index,v.tileID);const De={bucket:C,layout:I,posMatrix:q,textLabelPlaneMatrix:be,labelToScreenMatrix:_e,clippingData:ye,scale:F,textPixelRatio:z,holdingForFade:v.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:f.aE(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.aE(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const Ee of C.sortKeyRanges){const{sortKey:Be,symbolInstanceStart:ke,symbolInstanceEnd:pe}=Ee;c.push({sortKey:Be,symbolInstanceStart:ke,symbolInstanceEnd:pe,parameters:De})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:De})}attemptAnchorPlacement(c,p,v,w,C,M,I,P,F,z,j,q,Z,ne,re,ie,Q,se){const{textOffset0:ce,textOffset1:de,crossTileID:be}=q,_e=[ce,de],ye=h1(c,v,w,_e,C),De=this.collisionIndex.placeCollisionBox(ne,C,p,r0(ye.x,ye.y,M,I,this.transform.angle),j,P,F,z.predicate);if(ie){const Ee=ne.getSymbolInstanceIconSize(se,this.transform.zoom,q.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ne,Ee,ie,r0(ye.x,ye.y,M,I,this.transform.angle),j,P,F,z.predicate).box.length)return}if(De.box.length>0){let Ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Ee=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:_e,width:v,height:w,anchor:c,textScale:C,prevAnchor:Ee},this.markUsedJustification(ne,c,q,re),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,re,q),this.placedOrientations[be]=re),{shift:ye,placedGlyphBoxes:De}}}placeLayerBucketPart(c,p,v,w){const{bucket:C,layout:M,posMatrix:I,textLabelPlaneMatrix:P,labelToScreenMatrix:F,clippingData:z,textPixelRatio:j,holdingForFade:q,collisionBoxArray:Z,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:re,collisionGroup:ie}=c.parameters,Q=M.get("text-optional"),se=M.get("icon-optional"),ce=M.get("text-allow-overlap"),de=M.get("icon-allow-overlap"),be="map"===M.get("text-rotation-alignment"),_e="map"===M.get("text-pitch-alignment"),ye="viewport-y"===M.get("symbol-z-order"),De=M.get("symbol-z-elevate");this.transform.setProjection(C.projection);let Ee=ce&&(de||!C.hasIconData()||se),Be=de&&(ce||!C.hasTextData()||Q);!C.collisionArrays&&Z&&C.deserializeCollisionBoxes(Z),v&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,Z);const ke=(pe,Je,Ke)=>{const{crossTileID:Pe,numVerticalGlyphVertices:pt}=pe;if(z){const dr={zoom:this.transform.zoom,pitch:this.transform.pitch};let xr=null;if(z.dynamicFilterNeedsFeature){const Zn=this.retainedQueryData[C.bucketInstanceId];xr=z.featureIndex.loadFeature({featureIndex:pe.featureIndex,bucketIndex:Zn.bucketIndex,sourceLayerIndex:Zn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(dr,xr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new f.P(pe.tileAnchorX,pe.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Pe]=new Xf(!1,!1,!1,!0),void p.add(Pe)}if(p.has(Pe))return;if(q)return void(this.placements[Pe]=new Xf(!1,!1,!1));let mt=!1,He=!1,nt=!0,Oe=!1,_t=!1,gt=null,Wt={box:null,offscreen:null,occluded:null},Vt={box:null,offscreen:null,occluded:null},bt=null,Qt=null,Pn=null,Yn=0,Un=0,or=0;Ke.textFeatureIndex?Yn=Ke.textFeatureIndex:pe.useRuntimeCollisionCircles&&(Yn=pe.featureIndex),Ke.verticalTextFeatureIndex&&(Un=Ke.verticalTextFeatureIndex);const Kn=dr=>{dr.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const xr=this.transform.elevation;dr.elevation=pe.zOffset+(xr?xr.getAtTileOffset(dr.tileID,dr.tileAnchorX,dr.tileAnchorY):0)},Si=Ke.textBox;if(Si){Kn(Si);const dr=Zn=>{let Ir=f.aF.horizontal;if(C.allowVerticalPlacement&&!Zn&&this.prevPlacement){const Sr=this.prevPlacement.placedOrientations[Pe];Sr&&(this.placedOrientations[Pe]=Sr,Ir=Sr,this.markUsedOrientation(C,Ir,pe))}return Ir},xr=(Zn,Ir)=>{if(C.allowVerticalPlacement&&pt>0&&Ke.verticalTextBox){for(const Sr of C.writingModes)if(Sr===f.aF.vertical?(Wt=Ir(),Vt=Wt):Wt=Zn(),Wt&&Wt.box&&Wt.box.length)break}else Wt=Zn()};if(M.get("text-variable-anchor")){let Zn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pe]){const tr=this.prevPlacement.variableOffsets[Pe];Zn.indexOf(tr.anchor)>0&&(Zn=Zn.filter(vs=>vs!==tr.anchor),Zn.unshift(tr.anchor))}const Ir=(tr,vs,Es)=>{const Zo=C.getSymbolInstanceTextSize(ne,pe,this.transform.zoom,Je),yo=(tr.x2-tr.x1)*Zo+2*tr.padding,Xo=(tr.y2-tr.y1)*Zo+2*tr.padding,da=pe.hasIconTextFit&&!de?vs:null;da&&Kn(da);let Ao={box:[],offscreen:!1,occluded:!1};const Yo=ce?2*Zn.length:Zn.length;for(let Pt=0;Pt<Yo;++Pt){const fn=this.attemptAnchorPlacement(Zn[Pt%Zn.length],tr,yo,Xo,Zo,be,_e,j,I,ie,Pt>=Zn.length,pe,Je,C,Es,da,ne,re);if(fn&&(Ao=fn.placedGlyphBoxes,Ao&&Ao.box&&Ao.box.length)){mt=!0,gt=fn.shift;break}}return Ao};xr(()=>Ir(Si,Ke.iconBox,f.aF.horizontal),()=>{const tr=Ke.verticalTextBox;return tr&&Kn(tr),C.allowVerticalPlacement&&!(Wt&&Wt.box&&Wt.box.length)&&pt>0&&tr?Ir(tr,Ke.verticalIconBox,f.aF.vertical):{box:null,offscreen:null,occluded:null}}),Wt&&(mt=Wt.box,nt=Wt.offscreen,Oe=Wt.occluded);const Sr=dr(!(!Wt||!Wt.box));if(!mt&&this.prevPlacement){const tr=this.prevPlacement.variableOffsets[Pe];tr&&(this.variableOffsets[Pe]=tr,this.markUsedJustification(C,tr.anchor,pe,Sr))}}else{const Zn=(Ir,Sr)=>{const tr=C.getSymbolInstanceTextSize(ne,pe,this.transform.zoom,Je),vs=this.collisionIndex.placeCollisionBox(C,tr,Ir,new f.P(0,0),ce,j,I,ie.predicate);return vs&&vs.box&&vs.box.length&&(this.markUsedOrientation(C,Sr,pe),this.placedOrientations[Pe]=Sr),vs};xr(()=>Zn(Si,f.aF.horizontal),()=>{const Ir=Ke.verticalTextBox;return C.allowVerticalPlacement&&pt>0&&Ir?(Kn(Ir),Zn(Ir,f.aF.vertical)):{box:null,offscreen:null,occluded:null}}),dr(!!(Wt&&Wt.box&&Wt.box.length))}}if(bt=Wt,mt=bt&&bt.box&&bt.box.length>0,nt=bt&&bt.offscreen,Oe=bt&&bt.occluded,pe.useRuntimeCollisionCircles){const dr=C.text.placedSymbolArray.get(pe.centerJustifiedTextSymbolIndex>=0?pe.centerJustifiedTextSymbolIndex:pe.verticalPlacedTextSymbolIndex),xr=f.aG(C.textSizeData,ne,dr),Zn=M.get("text-padding");Qt=this.collisionIndex.placeCollisionCircles(C,ce,dr,C.lineVertexArray,C.glyphOffsetArray,xr,I,P,F,v,_e,ie.predicate,pe.collisionCircleDiameter*xr/f.bP,Zn,this.retainedQueryData[C.bucketInstanceId].tileID),mt=ce||Qt.circles.length>0&&!Qt.collisionDetected,nt=nt&&Qt.offscreen,Oe=Qt.occluded}if(Ke.iconFeatureIndex&&(or=Ke.iconFeatureIndex),Ke.iconBox){const dr=xr=>{Kn(xr);const Zn=pe.hasIconTextFit&&gt?r0(gt.x,gt.y,be,_e,this.transform.angle):new f.P(0,0),Ir=C.getSymbolInstanceIconSize(re,this.transform.zoom,pe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Ir,xr,Zn,de,j,I,ie.predicate)};Vt&&Vt.box&&Vt.box.length&&Ke.verticalIconBox?(Pn=dr(Ke.verticalIconBox),He=Pn.box.length>0):(Pn=dr(Ke.iconBox),He=Pn.box.length>0),nt=nt&&Pn.offscreen,_t=Pn.occluded}const wr=Q||0===pe.numHorizontalGlyphVertices&&0===pt,ur=se||0===pe.numIconVertices;if(wr||ur?ur?wr||(He=He&&mt):mt=He&&mt:He=mt=He&&mt,mt&&bt&&bt.box&&this.collisionIndex.insertCollisionBox(bt.box,M.get("text-ignore-placement"),C.bucketInstanceId,Vt&&Vt.box&&Un?Un:Yn,ie.ID),He&&Pn&&this.collisionIndex.insertCollisionBox(Pn.box,M.get("icon-ignore-placement"),C.bucketInstanceId,or,ie.ID),Qt&&(mt&&this.collisionIndex.insertCollisionCircles(Qt.circles,M.get("text-ignore-placement"),C.bucketInstanceId,Yn,ie.ID),v)){const dr=C.bucketInstanceId;let xr=this.collisionCircleArrays[dr];void 0===xr&&(xr=this.collisionCircleArrays[dr]=new Dm);for(let Zn=0;Zn<Qt.circles.length;Zn+=4)xr.circles.push(Qt.circles[Zn+0]),xr.circles.push(Qt.circles[Zn+1]),xr.circles.push(Qt.circles[Zn+2]),xr.circles.push(Qt.collisionDetected?1:0)}const ni="globe"!==C.projection.name;Ee=Ee&&(ni||!Oe),Be=Be&&(ni||!_t),this.placements[Pe]=new Xf(mt||Ee,He||Be,nt||C.justReloaded),p.add(Pe)};if(De&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,this.retainedQueryData[C.bucketInstanceId].tileID),C.updateZOffset()),ye){const pe=C.getSortedSymbolIndexes(this.transform.angle);for(let Je=pe.length-1;Je>=0;--Je){const Ke=pe[Je];ke(C.symbolInstances.get(Ke),Ke,C.collisionArrays[Ke])}C.hasAnyZOffset&&f.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){const pe=C.getSortedIndexesByZOffset();for(let Je=0;Je<pe.length;++Je){const Ke=pe[Je];ke(C.symbolInstances.get(Ke),Ke,C.collisionArrays[Ke])}}else for(let pe=c.symbolInstanceStart;pe<c.symbolInstanceEnd;pe++)ke(C.symbolInstances.get(pe),pe,C.collisionArrays[pe]);if(v&&C.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[C.bucketInstanceId];f.ae.invert(pe.invProjMatrix,I),pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(c,p,v,w){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:P,crossTileID:F}=v,z=f.cM(p),j=w===f.aF.vertical?P:"left"===z?C:"center"===z?M:"right"===z?I:-1;C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=j>=0&&C!==j?0:F),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=j>=0&&M!==j?0:F),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=j>=0&&I!==j?0:F),P>=0&&(c.text.placedSymbolArray.get(P).crossTileID=j>=0&&P!==j?0:F)}markUsedOrientation(c,p,v){const w=p===f.aF.horizontal||p===f.aF.horizontalOnly?p:0,C=p===f.aF.vertical?p:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:F}=v,z=c.text.placedSymbolArray;M>=0&&(z.get(M).placedOrientation=w),I>=0&&(z.get(I).placedOrientation=w),P>=0&&(z.get(P).placedOrientation=w),F>=0&&(z.get(F).placedOrientation=C)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let v=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const w=p?p.symbolFadeChange(c):1,C=p?p.opacities:{},M=p?p.variableOffsets:{},I=p?p.placedOrientations:{};for(const P in this.placements){const F=this.placements[P],z=C[P];z?(this.opacities[P]=new xh(z,w,F.text,F.icon,null,F.clipped),v=v||F.text!==z.text.placed||F.icon!==z.icon.placed):(this.opacities[P]=new xh(null,w,F.text,F.icon,F.skipFade,F.clipped),v=v||F.text||F.icon)}for(const P in C){const F=C[P];if(!this.opacities[P]){const z=new xh(F,w,!1,!1);z.isHidden()||(this.opacities[P]=z,v=v||F.text.placed||F.icon.placed)}}for(const P in M)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=M[P]);for(const P in I)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=I[P]);v?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:c)}updateLayerOpacities(c,p,v,w){const C=new Set;for(const M of p){const I=M.getBucket(c);I&&M.latestFeatureIndex&&c.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,C,M.collisionBoxArray,v,w,M.tileID,c.scope),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,M.tileID),I.updateZOffset()))}}updateBucketOpacities(c,p,v,w,C,M,I){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const P=c.layers[0].layout,F=!!c.layers[0].dynamicFilter(),z=new xh(null,0,!1,!1,!0),j=P.get("text-allow-overlap"),q=P.get("icon-allow-overlap"),Z=P.get("text-variable-anchor"),ne="map"===P.get("text-rotation-alignment"),re="map"===P.get("text-pitch-alignment"),ie=new xh(null,0,j&&(q||!c.hasIconData()||P.get("icon-optional")),q&&(j||!c.hasTextData()||P.get("text-optional")),!0);!c.collisionArrays&&v&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(v);const Q=(ce,de,be)=>{for(let _e=0;_e<de/4;_e++)ce.opacityVertexArray.emplaceBack(be)};let se=0;C&&c.updateReplacement(M,C);for(let ce=0;ce<c.symbolInstances.length;ce++){const de=c.symbolInstances.get(ce),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:_e,crossTileID:ye,numIconVertices:De,tileAnchorX:Ee,tileAnchorY:Be}=de,ke=p.has(ye);let pe=this.opacities[ye];ke?pe=z:pe||(pe=ie,this.opacities[ye]=pe),p.add(ye);const Je=be>0||_e>0,Ke=De>0,Pe=this.placedOrientations[ye],pt=Pe===f.aF.vertical,mt=Pe===f.aF.horizontal||Pe===f.aF.horizontalOnly;!Je&&!Ke||pe.isHidden()||se++;let He=!1;if((Je||Ke)&&C)for(const nt of c.activeReplacements){if(f.cJ(nt,w,f.cw.Symbol,I)||nt.min.x>Ee||Ee>nt.max.x||nt.min.y>Be||Be>nt.max.y)continue;const Oe=f.cK(Ee,Be,M.canonical,nt.footprintTileId.canonical);if(He=f.cL(Oe,nt),He)break}if(Je){const nt=He?Mc:ua(pe.text);Q(c.text,be,pt?Mc:nt),Q(c.text,_e,mt?Mc:nt);const Oe=pe.text.isHidden(),{leftJustifiedTextSymbolIndex:_t,centerJustifiedTextSymbolIndex:gt,rightJustifiedTextSymbolIndex:Wt,verticalPlacedTextSymbolIndex:Vt}=de,bt=c.text.placedSymbolArray,Qt=Oe||pt?1:0;_t>=0&&(bt.get(_t).hidden=Qt),gt>=0&&(bt.get(gt).hidden=Qt),Wt>=0&&(bt.get(Wt).hidden=Qt),Vt>=0&&(bt.get(Vt).hidden=Oe||mt?1:0);const Pn=this.variableOffsets[ye];Pn&&this.markUsedJustification(c,Pn.anchor,de,Pe);const Yn=this.placedOrientations[ye];Yn&&(this.markUsedJustification(c,"left",de,Yn),this.markUsedOrientation(c,Yn,de))}if(Ke){const nt=He?Mc:ua(pe.icon),{placedIconSymbolIndex:Oe,verticalPlacedIconSymbolIndex:_t}=de,gt=c.icon.placedSymbolArray,Wt=pe.icon.isHidden()?1:0;Oe>=0&&(Q(c.icon,De,pt?Mc:nt),gt.get(Oe).hidden=Wt),_t>=0&&(Q(c.icon,de.numVerticalIconVertices,mt?Mc:nt),gt.get(_t).hidden=Wt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const nt=c.collisionArrays[ce];if(nt){let Oe=new f.P(0,0),_t=!0;if(nt.textBox||nt.verticalTextBox){if(Z){const Wt=this.variableOffsets[ye];Wt?(Oe=h1(Wt.anchor,Wt.width,Wt.height,Wt.textOffset,Wt.textScale),ne&&Oe._rotate(re?this.transform.angle:-this.transform.angle)):_t=!1}F&&(_t=!pe.clipped),nt.textBox&&Qc(c.textCollisionBox.collisionVertexArray,pe.text.placed,!_t||pt,Oe.x,Oe.y),nt.verticalTextBox&&Qc(c.textCollisionBox.collisionVertexArray,pe.text.placed,!_t||mt,Oe.x,Oe.y)}const gt=_t&&!(mt||!nt.verticalIconBox);nt.iconBox&&Qc(c.iconCollisionBox.collisionVertexArray,pe.icon.placed,gt,de.hasIconTextFit?Oe.x:0,de.hasIconTextFit?Oe.y:0),nt.verticalIconBox&&Qc(c.iconCollisionBox.collisionVertexArray,pe.icon.placed,!gt,de.hasIconTextFit?Oe.x:0,de.hasIconTextFit?Oe.y:0)}}}if(c.fullyClipped=0===se,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ce.invProjMatrix,c.placementViewportMatrix=ce.viewportMatrix,c.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,p){const v=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*v>c}setStale(){this.stale=!0}}function Qc(y,c,p,v,w){y.emplaceBack(c?1:0,p?1:0,v||0,w||0),y.emplaceBack(c?1:0,p?1:0,v||0,w||0),y.emplaceBack(c?1:0,p?1:0,v||0,w||0),y.emplaceBack(c?1:0,p?1:0,v||0,w||0)}const Od=Math.pow(2,25),qv=Math.pow(2,24),bh=Math.pow(2,17),Am=Math.pow(2,16),Mo=Math.pow(2,9),Rd=Math.pow(2,8),s0=Math.pow(2,1);function ua(y){if(0===y.opacity&&!y.placed)return 0;if(1===y.opacity&&y.placed)return 4294967295;const c=y.placed?1:0,p=Math.floor(127*y.opacity);return p*Od+c*qv+p*bh+c*Am+p*Mo+c*Rd+p*s0+c}const Mc=0;class Ut{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,p,v,w,C){const M=this._bucketParts;for(;this._currentTileIndex<c.length;)if(p.getBucketParts(M,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((I,P)=>I.sortKey-P.sortKey));this._currentPartIndex<M.length;){const I=M[this._currentPartIndex];if(p.placeLayerBucketPart(I,this._seenCrossTileIDs,v,0===I.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class iT{constructor(c,p,v,w,C,M,I,P,F){this.placement=new Mm(c,C,M,I,P,F),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(c,p,v,w){const C=f.e.now(),M=()=>{const I=f.e.now()-C;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=p[c[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=P)&&(!I.maxzoom||I.maxzoom>P)){const F=I,z=F.layout.get("symbol-z-elevate"),j=this._inProgressLayer=this._inProgressLayer||new Ut(F),q=f.am(I.source,I.scope);if(j.continuePlacement(z?w[q]:v[q],this.placement,this._showCollisionBoxes,I,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Yf=512/f.a4/2;class Zv{constructor(c,p,v){this.tileID=c,this.bucketInstanceId=v,this.index=new f.cN(p.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=c.canonical.x*f.a4,C=c.canonical.y*f.a4;for(let M=0;M<p.length;M++){const{key:I,crossTileID:P,tileAnchorX:F,tileAnchorY:z}=p.get(M),j=Math.floor((w+F)*Yf),q=Math.floor((C+z)*Yf);this.index.add(j,q),this.keys.push(I),this.crossTileIDs.push(P)}this.index.finish()}findMatches(c,p,v){const w=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),C=Yf/Math.pow(2,p.canonical.z-this.tileID.canonical.z),M=p.canonical.x*f.a4,I=p.canonical.y*f.a4;for(let P=0;P<c.length;P++){const F=c.get(P);if(F.crossTileID)continue;const{key:z,tileAnchorX:j,tileAnchorY:q}=F,Z=Math.floor((M+j)*C),ne=Math.floor((I+q)*C),re=this.index.range(Z-w,ne-w,Z+w,ne+w);for(const ie of re){const Q=this.crossTileIDs[ie];if(this.keys[ie]===z&&!v.has(Q)){v.add(Q),F.crossTileID=Q;break}}}}}class ol{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const p=Math.round((c-this.lng)/360);if(0!==p)for(const v in this.indexes){const w=this.indexes[v],C={};for(const M in w){const I=w[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+p),C[I.tileID.key]=I}this.indexes[v]=C}this.lng=c}addBucket(c,p,v){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let C=0;C<p.symbolInstances.length;C++)p.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const w=this.usedCrossTileIDs[c.overscaledZ];for(const C in this.indexes){const M=this.indexes[C];if(Number(C)>c.overscaledZ)for(const I in M){const P=M[I];P.tileID.isChildOf(c)&&P.findMatches(p.symbolInstances,c,w)}else{const I=M[c.scaledTo(Number(C)).key];I&&I.findMatches(p.symbolInstances,c,w)}}for(let C=0;C<p.symbolInstances.length;C++){const M=p.symbolInstances.get(C);M.crossTileID||(M.crossTileID=v.generate(),w.add(M.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Zv(c,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(c,p){for(const v of p.crossTileIDs)this.usedCrossTileIDs[c].delete(v)}removeStaleBuckets(c){let p=!1;for(const v in this.indexes){const w=this.indexes[v];for(const C in w)c[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[C]),delete w[C],p=!0)}return p}}class al{constructor(){this.layerIndexes={},this.crossTileIDs=new ol,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,p,v,w){let C=this.layerIndexes[c.fqid];void 0===C&&(C=this.layerIndexes[c.fqid]=new Kf);let M=!1;const I={};"globe"!==w.name&&C.handleWrapJump(v);for(const P of p){const F=P.getBucket(c);F&&c.fqid===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(P.tileID,F,this.crossTileIDs)&&(M=!0),I[F.bucketInstanceId]=!0)}return C.removeStaleBuckets(I)&&(M=!0),M}pruneUnusedLayers(c){const p={};c.forEach(v=>{p[v]=!0});for(const v in this.layerIndexes)p[v]||delete this.layerIndexes[v]}}const Xv=new f.U({data:new f.W(f.N.colorTheme.data)}),ll=(y,c)=>Nn(y,c&&c.filter(p=>"source.canvas"!==p.identifier)),kl=f.ai(Wr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),mi=f.ai(Wr,["setCenter","setZoom","setBearing","setPitch"]),rc={version:8,layers:[],sources:{}},d1={duration:300,delay:0};class Fa extends f.E{constructor(c,p={}){super(),this.map=c,this.scope=p.scope||"",this.globalId=null,this.fragments=[],this.importDepth=p.importDepth||0,this.importsCache=p.importsCache||new Map,this.resolvedImports=p.resolvedImports||new Set,this.transition=f.Q({},d1),this._buildingIndex=new Il(this),this.crossTileSymbolIndex=new al,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=p.styleChanges||new ah,this.dispatcher=p.dispatcher?p.dispatcher:new f.by(f.bz(),this),p.imageManager?this.imageManager=p.imageManager:(this.imageManager=new Aa,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=p.glyphManager?p.glyphManager:new f.cP(c._requestManager,p.localFontFamily?f.cQ.all:p.localIdeographFontFamily?f.cQ.ideographs:f.cQ.none,p.localFontFamily||p.localIdeographFontFamily),p.modelManager?this.modelManager=p.modelManager:(this.modelManager=new Zc(c._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=p.configOptions?p.configOptions:new Map,this._configDependentLayers=p.configDependentLayers?p.configDependentLayers:new Set,this._config=p.config,this._initialConfig=p.initialConfig,this.dispatcher.broadcast("setReferrer",f.cR());const v=this;this._rtlTextPluginCallback=Fa.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,M)=>{if(f.cS(C),M&&M.every(I=>I))for(const I in v._sourceCaches){const P=v._sourceCaches[I],F=P.getSource().type;"vector"!==F&&"geojson"!==F||P.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const C=this.getOwnSource(w.sourceId);if(C&&C.vectorLayerIds)for(const M in this._layers){const I=this._layers[M];I.source===C.id&&this._validateLayer(I)}})}load(c){return c?("string"==typeof c?this.loadURL(c):this.loadJSON(c),this):this}_getGlobalId(c){if(!c)return null;if("string"==typeof c){if(f.cT(c))return c;const p=f.cU(c);if(!p.startsWith("http"))try{return new URL(p,location.href).toString()}catch{return p}return p}return`json://${f.cV(JSON.stringify(c))}`}_diffStyle(c,p,v){this.globalId=this._getGlobalId(c);const w=(C,M)=>{try{M(null,this.setState(C,v))}catch(I){M(I,!1)}};if("string"==typeof c){const C=this.map._requestManager.normalizeStyleURL(c),M=this.map._requestManager.transformRequest(C,f.R.Style);f.h(M,(I,P)=>{I?this.fire(new f.f(I)):P&&w(P,p)})}else"object"==typeof c&&w(c,p)}loadURL(c,p={}){this.fire(new f.g("dataloading",{dataType:"style"}));const v="boolean"==typeof p.validate?p.validate:!f.cT(c);this.globalId=this._getGlobalId(c),c=this.map._requestManager.normalizeStyleURL(c,p.accessToken),this.resolvedImports.add(c);const w=this.importsCache.get(c);if(w)return this._load(w,v);const C=this.map._requestManager.transformRequest(c,f.R.Style);this._request=f.h(C,(M,I)=>{if(this._request=null,M)this.fire(new f.f(M));else if(I)return this.importsCache.set(c,I),this._load(I,v)})}loadJSON(c,p={}){this.fire(new f.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(c),this._request=f.e.frame(()=>{this._request=null,this._load(c,!1!==p.validate)})}loadEmpty(){this.fire(new f.g("dataloading",{dataType:"style"})),this._load(rc,!1)}_loadImports(c,p,v){if(this.importDepth>=4)return f.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const w=[];for(const C of c){const M=this._createFragmentStyle(C),I=new Promise(z=>{M.once("style.import.load",z),M.once("error",z)}).then(()=>this.mergeAll());if(w.push(I),this.resolvedImports.has(C.url)){M.loadEmpty();continue}const P=C.data||this.importsCache.get(C.url);P?(M.loadJSON(P,{validate:p}),this._isInternalStyle(P)&&(M.globalId=null)):C.url?M.loadURL(C.url,{validate:p}):M.loadEmpty();const F={style:M,id:C.id,config:C.config};if(v){const z=this.fragments.findIndex(({id:j})=>j===v);this.fragments=this.fragments.slice(0,z).concat(F).concat(this.fragments.slice(z))}else this.fragments.push(F)}return Promise.allSettled(w)}getImportGlobalIds(c=this,p=new Set){for(const v of c.fragments)v.style.globalId&&p.add(v.style.globalId),this.getImportGlobalIds(v.style,p);return[...p.values()]}_createFragmentStyle(c){const p=this.scope?f.am(c.id,this.scope):c.id;let v;const w=this._initialConfig&&this._initialConfig[p];(c.config||w)&&(v=f.Q({},c.config,w));const C=new Fa(this.map,{scope:p,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:v,configOptions:this.options,configDependentLayers:this._configDependentLayers});return C.setEventedParent(this.map,{style:C}),C}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(c){return this.isRootStyle()&&(c.fragment||!!c.schema&&!1!==c.fragment)}_load(c,p){const v=c.schema;if(this._isInternalStyle(c)){const M=f.Q({},rc,{imports:[{id:"basemap",data:c,url:""}]});return void this._load(M,p)}if(this.updateConfig(this._config,v),p&&ll(this,K(c)))return;this._loaded=!0,this.stylesheet=f.cW(c);const w=()=>{for(const F in c.sources)this.addSource(F,c.sources[F],{validate:!1,isInitialLoad:!0});c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(c.glyphs,this.scope);const M=Mu(this.stylesheet.layers);if(this._order=M.map(F=>F.id),this.stylesheet.light&&f.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const F=this.stylesheet.lights[0];this.light=new $r(F.properties,F.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new $r(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const F of M){const z=f.c$(F,this.scope,this._styleColorTheme.lut,this.options);0!==z.configDependencies.size&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize();const j=this.getOwnLayerSourceCache(z),q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&z.canCastShadows()&&q&&(j.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new f.g("data",{dataType:"style"}));const P=this.isRootStyle();c.imports?this._loadImports(c.imports,p).then(()=>{this._reloadImports(),this.fire(new f.g(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new f.g(P?"style.load":"style.import.load")))},C=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=C,C){const M=this._evaluateColorThemeData(C);this._loadColorTheme(M).then(()=>{w()}).catch(I=>{f.w(`Couldn't load color theme from the stylesheet: ${I}`),w()})}else this._styleColorTheme.lut=null,w()}isRootStyle(){return 0===this.importDepth}mergeAll(){let c,p,v,w,C,M,I,P;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(z=>{if(z.stylesheet){if(null!=z.light&&(c=z.light),z.stylesheet.lights)for(const j of z.stylesheet.lights)"ambient"===j.type&&null!=z.ambientLight&&(p=z.ambientLight),"directional"===j.type&&null!=z.directionalLight&&(v=z.directionalLight);w=this._prioritizeTerrain(w,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&null!=z.fog&&(C=z.fog),null!=z.stylesheet.camera&&(P=z.stylesheet.camera),null!=z.stylesheet.projection&&(M=z.stylesheet.projection),null!=z.stylesheet.transition&&(I=z.stylesheet.transition),F[z.scope]=z._styleColorTheme}}),this.light=c,this.ambientLight=p,this.directionalLight=v,this.fog=C,this._styleColorThemeForScope=F,null===w?delete this.terrain:this.terrain=w,this.camera=P||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=f.Q({},d1,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(c){const p=v=>{for(const w of v.fragments)p(w.style);c(v)};p(this)}_prioritizeTerrain(c,p,v){const w=c&&0===c.drapeRenderMode;return null===v?p&&0===p.drapeRenderMode?p:w?c:null:null!=p&&(!c||w||p&&1===p.drapeRenderMode)?p:c}mergeTerrain(){let c;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(p=>{c=this._prioritizeTerrain(c,p.terrain,p.stylesheet.terrain)}),null===c?delete this.terrain:this.terrain=c}mergeProjection(){let c;this.forEachFragmentStyle(p=>{null!=p.stylesheet.projection&&(c=p.stylesheet.projection)}),this.projection=c||{name:"mercator"}}mergeSources(){const c={},p={},v={};this.forEachFragmentStyle(w=>{for(const C in w._sourceCaches){const M=f.am(C,w.scope);c[M]=w._sourceCaches[C]}for(const C in w._otherSourceCaches){const M=f.am(C,w.scope);p[M]=w._otherSourceCaches[C]}for(const C in w._symbolSourceCaches){const M=f.am(C,w.scope);v[M]=w._symbolSourceCaches[C]}}),this._mergedSourceCaches=c,this._mergedOtherSourceCaches=p,this._mergedSymbolSourceCaches=v}mergeLayers(){const c={},p=[],v={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(M=>{for(const I of M._order){const P=M._layers[I];if("slot"===P.type){const F=f.cX(I);if(c[F])continue;c[F]=[]}P.slot&&c[P.slot]?c[P.slot].push(P):p.push(P)}}),this._mergedOrder=[],this._clipLayerIndices=[];let w=0;const C=(M=[])=>{for(const I of M)if("slot"===I.type){const P=f.cX(I.id);c[P]&&C(c[P]),this._mergedSlots.push(P)}else{const P=f.am(I.id,I.scope);this._mergedOrder.push(P),v[P]=I,I.is3D()&&(this._has3DLayers=!0),"circle"===I.type&&(this._hasCircleLayers=!0),"symbol"===I.type&&(this._hasSymbolLayers=!0),"clip"===I.type&&this._clipLayerIndices.push(w),w++}};C(p),this._mergedOrder.sort((M,I)=>{const P=v[M],F=v[I];return P.hasInitialOcclusionOpacityProperties?F.is3D()?1:0:P.is3D()&&F.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=v,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(c){return this.stylesheet.camera=f.Q({},this.stylesheet.camera,c),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(c){return c.data?function(p,v,w){const C=f.Q({},v);for(const I of Object.keys(f.N.colorTheme))void 0===C[I]&&(C[I]=f.N.colorTheme[I].default);const M=new f.O(Xv,p,new Map(w));return M.setTransitionOrValue(C,w),M.untransitioned().possiblyEvaluate(new f.Y(0))}(this.scope,c,this.options).get("data"):null}_loadColorTheme(c){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const p=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((v,w)=>{const C="data:image/png;base64,";if(!c||0===c.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void v();let M=c;M.startsWith(C)||(M=C+M);const I="mapbox-reserved-lut",P=new Image;P.src=M,P.onerror=()=>{this._styleColorTheme.lutLoading=!1,w(new Error("Failed to load image data"))},P.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==p)return void v();this._styleColorTheme.lutLoading=!1;const{width:F,height:z,data:j}=f.e.getImageData(P);if(z>32)return void w(new Error("The height of the image must be less than or equal to 32 pixels."));if(F!==z*z)return void w(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new f.j({width:F,height:z},j),pixelRatio:1,sdf:!1,version:0});const q=this.imageManager.getImage(I,this.scope);q?(this._styleColorTheme.lut={image:q.data,data:c},v()):w(new Error("Missing LUT image."))}})}getLut(c){const p=this._styleColorThemeForScope[c];return p?p.lut:null}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(c){this._spriteRequest=function(p,v,w){let C,M,I;const P=f.e.devicePixelRatio>1?"@2x":"";let F=f.h(v.transformRequest(v.normalizeSpriteURL(p,P,".json"),f.R.SpriteJSON),(q,Z)=>{F=null,I||(I=q,C=Z,j())}),z=f.i(v.transformRequest(v.normalizeSpriteURL(p,P,".png"),f.R.SpriteImage),(q,Z)=>{z=null,I||(I=q,M=Z,j())});function j(){if(I)w(I);else if(C&&M){const q=f.e.getImageData(M),Z={};for(const ne in C){const{width:re,height:ie,x:Q,y:se,sdf:ce,pixelRatio:de,stretchX:be,stretchY:_e,content:ye}=C[ne],De=new f.j({width:re,height:ie});f.j.copy(q,De,{x:Q,y:se},{x:0,y:0},{width:re,height:ie},null),Z[ne]={data:De,pixelRatio:de,sdf:ce,stretchX:be,stretchY:_e,content:ye}}w(null,Z)}}return{cancel(){F&&(F.cancel(),F=null),z&&(z.cancel(),z=null)}}}(c,this.map._requestManager,(p,v)=>{if(this._spriteRequest=null,p)this.fire(new f.f(p));else if(v)for(const w in v)this.imageManager.addImage(w,this.scope,v[w]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new f.g("data",{dataType:"style"}))})}_validateLayer(c){const p=this.getOwnSource(c.source);if(!p)return;const v=c.sourceLayer;v&&("geojson"===p.type||p.vectorLayerIds&&-1===p.vectorLayerIds.indexOf(v))&&this.fire(new f.f(new Error(`Source layer "${v}" does not exist on source "${p.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:c}of this.fragments)if(!c.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((c,p)=>{const v=this.fragments[p];return v&&v.style&&(c.data=v.style.serialize()),c})}_serializeSources(){const c={};for(const p in this._sourceCaches){const v=this._sourceCaches[p].getSource();c[v.id]||(c[v.id]=v.serialize())}return c}_serializeLayers(c){const p=[];for(const v of c){const w=this._layers[v];w&&"custom"!==w.type&&p.push(w.serialize())}return p}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(c){return!!this.terrain&&c.isDraped(this.getLayerSourceCache(c))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(c){const p=this.getOwnLayer(c);if(p)return p;this.fire(new f.f(new Error(`The layer '${c}' does not exist in the map's style.`)))}_checkSource(c){const p=this.getOwnSource(c);if(p)return p;this.fire(new f.f(new Error(`The source '${c}' does not exist in the map's style.`)))}precompilePrograms(c,p){const v=this.map.painter;if(v)for(let w=c.minzoom||0;w<(c.maxzoom||25.5);w++){const C=c.getProgramIds();if(C)for(const M of C){const I=c.getDefaultProgramParams(M,p.zoom,this._styleColorTheme.lut);I&&(v.style=this,this.fog&&(v._fogVisible=!0,I.overrideFog=!0,v.getOrCreateProgram(M,I)),v._fogVisible=!1,I.overrideFog=!1,v.getOrCreateProgram(M,I),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(I.overrideRtt=!0,v.getOrCreateProgram(M,I)))}}}update(c){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c);const p=this.calculateLightsBrightness();c.brightness=p||0,p!==this._brightness&&(this._brightness=p,this.dispatcher.broadcast("setBrightness",p));const v=this._changes.isDirty();let w=!1;if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const I in M){const{updatedIds:P,removedIds:F}=M[I];(P||F)&&(this._updateWorkerLayers(I,P,F),w=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(c),this.light&&this.light.updateTransitions(c),this.ambientLight&&this.ambientLight.updateTransitions(c),this.directionalLight&&this.directionalLight.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._changes.reset()}const C={};for(const M in this._mergedSourceCaches){const I=this._mergedSourceCaches[M];C[M]=I.used,I.used=!1,I.tileCoverLift=0}for(const M of this._mergedOrder){const I=this._mergedLayers[M];if(I.recalculate(c,this._availableImages),!I.isHidden(c.zoom)){const P=this.getLayerSourceCache(I);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,c)}):this.precompilePrograms(I,c))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&w&&this.mergeLayers();for(const M in C){const I=this._mergedSourceCaches[M];C[M]!==I.used&&I.getSource().fire(new f.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),v&&this.fire(new f.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=this._changes.getUpdatedImages();if(c.length){for(const p in this._sourceCaches)this._sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changes.resetUpdatedImages()}}_updateWorkerLayers(c,p,v){const w=this.getFragmentStyle(c);w&&this.dispatcher.broadcast("updateLayers",{layers:p?w._serializeLayers(p):[],scope:c,removedIds:v||[],options:w.options})}setState(c,p){if(this._checkLoaded(),ll(this,K(c)))return!1;(c=f.cW(c)).layers=Mu(c.layers);const v=function(M,I){if(!M)return[{command:Wr.setStyle,args:[I]}];let P=[];try{if(!f.d(M.version,I.version))return[{command:Wr.setStyle,args:[I]}];if(f.d(M.center,I.center)||P.push({command:Wr.setCenter,args:[I.center]}),f.d(M.zoom,I.zoom)||P.push({command:Wr.setZoom,args:[I.zoom]}),f.d(M.bearing,I.bearing)||P.push({command:Wr.setBearing,args:[I.bearing]}),f.d(M.pitch,I.pitch)||P.push({command:Wr.setPitch,args:[I.pitch]}),f.d(M.sprite,I.sprite)||P.push({command:Wr.setSprite,args:[I.sprite]}),f.d(M.glyphs,I.glyphs)||P.push({command:Wr.setGlyphs,args:[I.glyphs]}),f.d(M.imports,I.imports)||function(Z=[],ne=[],re){ne=ne||[];const ie=(Z=Z||[]).map(ku),Q=ne.map(ku),se=Z.reduce(Ou,{}),ce=ne.reduce(Ou,{}),de=ie.slice();let be,_e,ye,De;for(be=0,_e=0;be<ie.length;be++)ye=ie[be],ce.hasOwnProperty(ye)?_e++:(re.push({command:Wr.removeImport,args:[ye]}),de.splice(de.indexOf(ye,_e),1));for(be=0,_e=0;be<Q.length;be++)ye=Q[Q.length-1-be],de[de.length-1-be]!==ye&&(se.hasOwnProperty(ye)?(re.push({command:Wr.removeImport,args:[ye]}),de.splice(de.lastIndexOf(ye,de.length-_e),1)):_e++,De=de[de.length-be],re.push({command:Wr.addImport,args:[ce[ye],De]}),de.splice(de.length-be,0,ye));for(const Ee of ne){const Be=se[Ee.id];Be&&!f.d(Be,Ee)&&re.push({command:Wr.updateImport,args:[Ee.id,Ee]})}}(M.imports,I.imports,P),f.d(M.transition,I.transition)||P.push({command:Wr.setTransition,args:[I.transition]}),f.d(M.light,I.light)||P.push({command:Wr.setLight,args:[I.light]}),f.d(M.fog,I.fog)||P.push({command:Wr.setFog,args:[I.fog]}),f.d(M.projection,I.projection)||P.push({command:Wr.setProjection,args:[I.projection]}),f.d(M.lights,I.lights)||P.push({command:Wr.setLights,args:[I.lights]}),f.d(M.camera,I.camera)||P.push({command:Wr.setCamera,args:[I.camera]}),!f.d(M["color-theme"],I["color-theme"]))return[{command:Wr.setStyle,args:[I]}];const F={},z=[];!function(Z,ne,re,ie){let Q;for(Q in ne=ne||{},Z=Z||{})Z.hasOwnProperty(Q)&&(ne.hasOwnProperty(Q)||Hv(Q,re,ie));for(Q in ne){if(!ne.hasOwnProperty(Q))continue;const se=ne[Q];Z.hasOwnProperty(Q)?f.d(Z[Q],se)||("geojson"===Z[Q].type&&"geojson"===se.type&&Cm(Z,ne,Q)?re.push({command:Wr.setGeoJSONSourceData,args:[Q,se.data]}):rT(Q,ne,re,ie)):Au(Q,ne,re)}}(M.sources,I.sources,z,F);const j=[];M.layers&&M.layers.forEach(Z=>{Z.source&&F[Z.source]?P.push({command:Wr.removeLayer,args:[Z.id]}):j.push(Z)});let q=M.terrain;q&&F[q.source]&&(P.push({command:Wr.setTerrain,args:[void 0]}),q=void 0),P=P.concat(z),f.d(q,I.terrain)||P.push({command:Wr.setTerrain,args:[I.terrain]}),function(Z,ne,re){ne=ne||[];const ie=(Z=Z||[]).map(ku),Q=ne.map(ku),se=Z.reduce(Ou,{}),ce=ne.reduce(Ou,{}),de=ie.slice(),be=Object.create(null);let _e,ye,De,Ee,Be,ke,pe;for(_e=0,ye=0;_e<ie.length;_e++)De=ie[_e],ce.hasOwnProperty(De)?ye++:(re.push({command:Wr.removeLayer,args:[De]}),de.splice(de.indexOf(De,ye),1));for(_e=0,ye=0;_e<Q.length;_e++)De=Q[Q.length-1-_e],de[de.length-1-_e]!==De&&(se.hasOwnProperty(De)?(re.push({command:Wr.removeLayer,args:[De]}),de.splice(de.lastIndexOf(De,de.length-ye),1)):ye++,ke=de[de.length-_e],re.push({command:Wr.addLayer,args:[ce[De],ke]}),de.splice(de.length-_e,0,De),be[De]=!0);for(_e=0;_e<Q.length;_e++)if(De=Q[_e],Ee=se[De],Be=ce[De],!be[De]&&!f.d(Ee,Be))if(f.d(Ee.source,Be.source)&&f.d(Ee["source-layer"],Be["source-layer"])&&f.d(Ee.type,Be.type)){for(pe in Iu(Ee.layout,Be.layout,re,De,null,Wr.setLayoutProperty),Iu(Ee.paint,Be.paint,re,De,null,Wr.setPaintProperty),f.d(Ee.slot,Be.slot)||re.push({command:Wr.setSlot,args:[De,Be.slot]}),f.d(Ee.filter,Be.filter)||re.push({command:Wr.setFilter,args:[De,Be.filter]}),f.d(Ee.minzoom,Be.minzoom)&&f.d(Ee.maxzoom,Be.maxzoom)||re.push({command:Wr.setLayerZoomRange,args:[De,Be.minzoom,Be.maxzoom]}),Ee)Ee.hasOwnProperty(pe)&&"layout"!==pe&&"paint"!==pe&&"filter"!==pe&&"metadata"!==pe&&"minzoom"!==pe&&"maxzoom"!==pe&&"slot"!==pe&&(0===pe.indexOf("paint.")?Iu(Ee[pe],Be[pe],re,De,pe.slice(6),Wr.setPaintProperty):f.d(Ee[pe],Be[pe])||re.push({command:Wr.setLayerProperty,args:[De,pe,Be[pe]]}));for(pe in Be)Be.hasOwnProperty(pe)&&!Ee.hasOwnProperty(pe)&&"layout"!==pe&&"paint"!==pe&&"filter"!==pe&&"metadata"!==pe&&"minzoom"!==pe&&"maxzoom"!==pe&&"slot"!==pe&&(0===pe.indexOf("paint.")?Iu(Ee[pe],Be[pe],re,De,pe.slice(6),Wr.setPaintProperty):f.d(Ee[pe],Be[pe])||re.push({command:Wr.setLayerProperty,args:[De,pe,Be[pe]]}))}else re.push({command:Wr.removeLayer,args:[De]}),ke=de[de.lastIndexOf(De)+1],re.push({command:Wr.addLayer,args:[Be,ke]})}(j,I.layers,P)}catch(F){console.warn("Unable to compute style diff:",F),P=[{command:Wr.setStyle,args:[I]}]}return P}(this.serialize(),c).filter(M=>!(M.command in mi));if(0===v.length)return!1;const w=v.filter(M=>!(M.command in kl));if(w.length>0)throw new Error(`Unimplemented: ${w.map(M=>M.command).join(", ")}.`);const C=[];return v.forEach(M=>{C.push(this[M.command].apply(this,M.args))}),p&&Promise.all(C).then(p),this.stylesheet=c,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(c,p){return this.getImage(c)?this.fire(new f.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,this.scope,p),this._afterImageUpdated(c),this)}updateImage(c,p){this.imageManager.updateImage(c,this.scope,p)}getImage(c){return this.imageManager.getImage(c,this.scope)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c,this.scope),this._afterImageUpdated(c),this):this.fire(new f.f(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(c),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new f.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(c,p,v={}){return this._checkLoaded(),this._validate(Ct,`models.${c}`,p,null,v)||(this.modelManager.addModel(c,p,this.scope),this._changes.setDirty()),this}hasModel(c){return this.modelManager.hasModel(c,this.scope)}removeModel(c){return this.hasModel(c)?(this.modelManager.removeModel(c,this.scope),this):this.fire(new f.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(c,p,v={}){if(this._checkLoaded(),void 0!==this.getOwnSource(c))throw new Error(`There is already a source with ID "${c}".`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(J,`sources.${c}`,p,null,v))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const w=Yg(c,p,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const C=M=>{const I=(M?"symbol:":"other:")+w.id,P=f.am(I,this.scope),F=this._sourceCaches[I]=new f.bx(P,w,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=F,F.onAdd(this.map)};C(!1),"vector"!==p.type&&"geojson"!==p.type||C(!0),w.onAdd&&w.onAdd(this.map),v.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(c){this._checkLoaded();const p=this.getOwnSource(c);if(!p)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===c)return this.fire(new f.f(new Error(`Source "${c}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===c)return this.fire(new f.f(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const v=this.getOwnSourceCaches(c);for(const w of v){const C=f.cX(w.id);delete this._sourceCaches[C],this._changes.discardSourceCacheUpdate(w.id),w.fire(new f.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],this.mergeSources(),p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(c,p){this._checkLoaded(),this.getOwnSource(c).setData(p),this._changes.setDirty()}getOwnSource(c){const p=this.getOwnSourceCache(c);return p&&p.getSource()}getOwnSources(){const c=[];for(const p in this._otherSourceCaches){const v=this.getOwnSourceCache(p);v&&c.push(v.getSource())}return c}areTilesLoaded(){const c=this._mergedSourceCaches;for(const p in c){const v=c[p]._tiles;for(const w in v){const C=v[w];if("loaded"!==C.state&&"errored"!==C.state)return!1}}return!0}setLights(c){if(this._checkLoaded(),!c)return delete this.ambientLight,void delete this.directionalLight;const p=this._getTransitionParameters();for(const w of c){if(this._validate(Ae,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const C=this.ambientLight;C.set(w),C.updateTransitions(p)}else this.ambientLight=new bd(w,lm||(lm=new f.U({color:new f.W(f.N.properties_light_ambient.color),intensity:new f.W(f.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const C=this.directionalLight;C.set(w),C.updateTransitions(p)}else this.directionalLight=new bd(w,cm||(cm=new f.U({direction:new f.a6(f.N.properties_light_directional.direction),color:new f.W(f.N.properties_light_directional.color),intensity:new f.W(f.N.properties_light_directional.intensity),"cast-shadows":new f.W(f.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new f.W(f.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const v=new f.Y(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const c=this.directionalLight,p=this.ambientLight;if(!c||!p)return;const v=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),w=c.properties.get("color").toRenderColor(null).toArray01(),C=c.properties.get("intensity"),M=c.properties.get("direction"),I=1-f.ad(M.x,M.y,M.z)[2]/90,P=v(w)*C*I,F=p.properties.get("color").toRenderColor(null).toArray01(),z=p.properties.get("intensity");return(P+v(F)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const c=[];return this.directionalLight&&c.push(this.directionalLight.get()),this.ambientLight&&c.push(this.ambientLight.get()),c}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(c){if(!c)return this;if(f.cY(c)){const p=f.cZ(c),v=this.fragments.find(({id:C})=>C===p);if(!v)throw new Error(`Style import not found: ${c}`);const w=f.cX(c);return v.style.getFragmentStyle(w)}{const p=this.fragments.find(({id:v})=>v===c);if(!p)throw new Error(`Style import not found: ${c}`);return p.style}}getConfigProperty(c,p){const v=this.getFragmentStyle(c);if(!v)return null;const w=f.am(p,v.scope),C=v.options.get(w),M=C?C.value||C.default:null;return M?M.serialize():null}setConfigProperty(c,p,v){const w=this.getFragmentStyle(c);if(!w)return;const C=w.stylesheet.schema;if(!C||!C[p])return;const M=f.z(v);if("success"!==M.result)return void ll(this,M.value);const I=M.value.expression,P=f.am(p,w.scope),F=w.options.get(P);if(!F)return;let z;const{minValue:j,maxValue:q,stepValue:Z,type:ne,values:re}=C[p],ie=f.z(C[p].default);"success"===ie.result&&(z=ie.value.expression),z?(this.options.set(P,{...F,value:I,default:z,minValue:j,maxValue:q,stepValue:Z,type:ne,values:re}),this.updateConfigDependencies(p)):this.fire(new f.f(new Error(`No schema defined for the config option "${p}" in the "${c}" fragment.`)))}getConfig(c){const p=this.getFragmentStyle(c);if(!p)return null;const v=p.stylesheet.schema;if(!v)return null;const w={};for(const C in v){const M=f.am(C,p.scope),I=p.options.get(M),P=I?I.value||I.default:null;w[C]=P?P.serialize():null}return w}setConfig(c,p){const v=this.getFragmentStyle(c);v&&(v.updateConfig(p,v.stylesheet.schema),this.updateConfigDependencies())}getSchema(c){const p=this.getFragmentStyle(c);return p?p.stylesheet.schema:null}setSchema(c,p){const v=this.getFragmentStyle(c);v&&(v.stylesheet.schema=p,v.updateConfig(v._config,p),this.updateConfigDependencies())}updateConfig(c,p){if(this._config=c,c||p)if(p)for(const v in p){let w,C;const M=f.z(p[v].default);if("success"===M.result&&(w=M.value.expression),c&&void 0!==c[v]){const q=f.z(c[v]);"success"===q.result&&(C=q.value.expression)}const{minValue:I,maxValue:P,stepValue:F,type:z,values:j}=p[v];if(w){const q=f.am(v,this.scope);this.options.set(q,{default:w,value:C,minValue:I,maxValue:P,stepValue:F,type:z,values:j})}else this.fire(new f.f(new Error(`No schema defined for config option "${v}".`)))}else this.fire(new f.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(c){for(const p of this._configDependentLayers){const v=this.getLayer(p);if(v){if(c&&!v.configDependencies.has(c))continue;v.possiblyEvaluateVisibility(),this._updateLayer(v)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(p=>{if(p._styleColorTheme.colorTheme){const v=p._evaluateColorThemeData(p._styleColorTheme.colorTheme);(!p._styleColorTheme.lut&&""!==v||p._styleColorTheme.lut&&v!==p._styleColorTheme.lut.data)&&p.setColorTheme(p._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(c,p,v={}){this._checkLoaded();const w=c.id;if(this._layers[w])return void this.fire(new f.f(new Error(`Layer with id "${w}" already exists on this map`)));let C;if("custom"===c.type){if(ll(this,f.c_(c)))return;C=f.c$(c,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof c.source&&(this.addSource(w,c.source),c=f.cW(c),c=f.Q(c,{source:w})),this._validate(st,`layers.${w}`,c,{arrayIndex:-1},v))return;C=f.c$(c,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize()}0!==C.configDependencies.size&&this._configDependentLayers.add(C.fqid);let M=this._order.length;if(p){const z=this._order.indexOf(p);if(-1===z)return void this.fire(new f.f(new Error(`Layer with id "${p}" does not exist on this map.`)));C.slot===this._layers[p].slot?M=z:f.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,w),this._layerOrderChanged=!0,this._layers[w]=C;const I=this.getOwnLayerSourceCache(C),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&C.canCastShadows()&&P&&(I.castsShadows=!0);const F=this._changes.getRemovedLayer(C);if(F&&C.source&&I&&"custom"!==C.type){this._changes.discardLayerRemoval(C);const z=f.am(C.source,C.scope);F.type!==C.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),I.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),C.scope=this.scope,this.mergeLayers()}moveLayer(c,p){this._checkLoaded();const v=this._checkLayer(c);if(!v||c===p)return;const w=this._order.indexOf(c);this._order.splice(w,1);let C=this._order.length;if(p){const M=this._order.indexOf(p);if(-1===M)return void this.fire(new f.f(new Error(`Layer with id "${p}" does not exist on this map.`)));v.slot===this._layers[p].slot?C=M:f.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,c),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(c){this._checkLoaded();const p=this._checkLayer(c);if(!p)return;p.setEventedParent(null);const v=this._order.indexOf(c);this._order.splice(v,1),delete this._layers[c],delete this._serializedLayers[c],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(p.fqid),this._changes.removeLayer(p);const w=this.getOwnLayerSourceCache(p);if(w&&w.castsShadows){let C=!1;for(const M in this._layers)if(this._layers[M].source===p.source&&this._layers[M].canCastShadows()){C=!0;break}w.castsShadows=C}p.onRemove&&p.onRemove(this.map),this.mergeLayers()}getOwnLayer(c){return this._layers[c]}hasLayer(c){return c in this._mergedLayers}hasLayerType(c){for(const p in this._layers)if(this._layers[p].type===c)return!0;return!1}setLayerZoomRange(c,p,v){this._checkLoaded();const w=this._checkLayer(c);w&&(w.minzoom===p&&w.maxzoom===v||(null!=p&&(w.minzoom=p),null!=v&&(w.maxzoom=v),this._updateLayer(w)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(c,p){this._checkLoaded();const v=this._checkLayer(c);v&&v.slot!==p&&(v.slot=p,this._updateLayer(v))}setFilter(c,p,v={}){this._checkLoaded();const w=this._checkLayer(c);if(w&&!f.d(w.filter,p))return null==p?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(Ue,`layers.${w.id}.filter`,p,{layerType:w.type},v)||(w.filter=f.cW(p),this._updateLayer(w)))}getFilter(c){const p=this._checkLayer(c);if(p)return f.cW(p.filter)}setLayoutProperty(c,p,v,w={}){this._checkLoaded();const C=this._checkLayer(c);if(C&&!f.d(C.getLayoutProperty(p),v)){if(null!=v&&(!w||!1!==w.validate)&&ll(C,Et.call(K,{key:`layers.${c}.layout.${p}`,layerType:C.type,objectKey:p,value:v,styleSpec:f.N,style:{glyphs:!0,sprite:!0}})))return;C.setLayoutProperty(p,v),0!==C.configDependencies.size&&this._configDependentLayers.add(C.fqid),this._updateLayer(C)}}getLayoutProperty(c,p){const v=this._checkLayer(c);if(v)return v.getLayoutProperty(p)}setPaintProperty(c,p,v,w={}){this._checkLoaded();const C=this._checkLayer(c);if(!C||f.d(C.getPaintProperty(p),v)||null!=v&&(!w||!1!==w.validate)&&ll(C,it.call(K,{key:`layers.${c}.paint.${p}`,layerType:C.type,objectKey:p,value:v,styleSpec:f.N})))return;const M=C.setPaintProperty(p,v);0!==C.configDependencies.size&&this._configDependentLayers.add(C.fqid),M&&this._updateLayer(C),this._changes.updatePaintProperties(C)}getPaintProperty(c,p){const v=this._checkLayer(c);if(v)return v.getPaintProperty(p)}setFeatureState(c,p){this._checkLoaded();const v=c.source,w=c.sourceLayer,C=this._checkSource(v);if(!C)return;const M=C.type;if("geojson"===M&&w)return void this.fire(new f.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!w)return void this.fire(new f.f(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new f.f(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(v);for(const P of I)P.setFeatureState(w,c.id,p)}removeFeatureState(c,p){this._checkLoaded();const v=c.source,w=this._checkSource(v);if(!w)return;const C=w.type,M="vector"===C?c.sourceLayer:void 0;if("vector"===C&&!M)return void this.fire(new f.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new f.f(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(v);for(const P of I)P.removeFeatureState(M,c.id,p)}getFeatureState(c){this._checkLoaded();const p=c.source,v=c.sourceLayer,w=this._checkSource(p);if(w){if("vector"!==w.type||v)return void 0===c.id&&this.fire(new f.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(p)[0].getFeatureState(v,c.id);this.fire(new f.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(c){return this.stylesheet.transition=f.Q({},this.stylesheet.transition,c),this.transition=this.stylesheet.transition,this}getTransition(){return f.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const c=this.getTerrain(),p=c&&this.terrain&&this.terrain.scope===this.scope?c:this.stylesheet.terrain;return f.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:p,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},v=>void 0!==v)}_updateLayer(c){this._changes.updateLayer(c);const p=this.getLayerSourceCache(c),v=f.am(c.source,c.scope),w=this._changes.getUpdatedSourceCaches();c.source&&!w[v]&&p&&"raster"!==p.getSource().type&&(this._changes.updateSourceCache(v,"reload"),p.pause()),c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const p=I=>"fill-extrusion"===this._mergedLayers[I].type||"model"===this._mergedLayers[I].type,v=this.order,w={},C=[];for(let I=v.length-1;I>=0;I--){const P=v[I];if(p(P)){w[P]=I;for(const F of c){const z=F[P];if(z)for(const j of z)C.push(j)}}}C.sort((I,P)=>P.intersectionZ-I.intersectionZ);const M=[];for(let I=v.length-1;I>=0;I--){const P=v[I];if(p(P))for(let F=C.length-1;F>=0;F--){const z=C[F].feature;if(z.layer&&w[z.layer.id]<I)break;M.push(z),C.pop()}else for(const F of c){const z=F[P];if(z)for(const j of z)M.push(j.feature)}}return M}queryRenderedFeatures(c,p,v){p&&p.filter&&this._validate(Ue,"queryRenderedFeatures.filter",p.filter,null,p),p.scope=this.scope,p.availableImages=this._availableImages,p.serializedLayers=this._serializedLayers;const w={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new f.f(new Error("parameters.layers must be an Array."))),[];for(const F of p.layers){const z=this._mergedLayers[F];if(!z)return this.fire(new f.f(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];w[z.source]=!0}}const C=[],M=p.serializedLayers||{},I=p&&p.layers?p.layers.some(F=>{const z=this.getLayer(F);return z&&z.is3D()}):this.has3DLayers(),P=nc.createFromScreenPoints(c,v);for(const F in this._mergedSourceCaches){const z=this._mergedSourceCaches[F].getSource();if(!z||z.scope!==p.scope)continue;const j=this._mergedSourceCaches[F].getSource().id;p.layers&&!w[j]||C.push(Jc(this._mergedSourceCaches[F],this._mergedLayers,M,P,p,v,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(F,z,j,q,Z,ne,re){const ie={},Q=ne.queryRenderedSymbols(q),se=[];for(const ce of Object.keys(Q).map(Number))se.push(re[ce]);se.sort(n0);for(const ce of se){const de=ce.featureIndex.lookupSymbolFeatures(Q[ce.bucketInstanceId],z,ce.bucketIndex,ce.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,F);for(const be in de){const _e=ie[be]=ie[be]||[],ye=de[be];ye.sort((De,Ee)=>{const Be=ce.featureSortOrder;if(Be){const ke=Be.indexOf(De.featureIndex);return Be.indexOf(Ee.featureIndex)-ke}return Ee.featureIndex-De.featureIndex});for(const De of ye)_e.push(De)}}for(const ce in ie)ie[ce].forEach(de=>{const be=de.feature,_e=j(F[ce]);if(!_e)return;const ye=_e.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=ye});return ie}(this._mergedLayers,M,this.getLayerSourceCache.bind(this),P.screenGeometry,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(c,p){p&&p.filter&&this._validate(Ue,"querySourceFeatures.filter",p.filter,null,p);const v=this.getOwnSourceCaches(c);let w=[];for(const C of v)w=w.concat(sl(C,p));return w}addSourceType(c,p,v){return Fa.getSourceType(c)?v(new Error(`A source type called "${c}" already exists.`)):(Fa.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},v):v(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(c,p,v={}){this._checkLoaded();const w=this.light.getLight();let C=!1;for(const I in c)if(!f.d(c[I],w[I])){C=!0;break}if(!C)return;const M=this._getTransitionParameters();this.light.setLight(c,p,v),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=f.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&f.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(c,p=1){if(this._checkLoaded(),!c)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===p&&delete this.terrain,null===c?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let v=c;const w=null==c.source;if(1===p){if(this.disableElevatedTerrain)return;if("object"==typeof v.source){const I="terrain-dem-src";this.addSource(I,v.source),v=f.cW(v),v=f.Q(v,{source:I})}const C=f.Q({},v),M={};if(this.terrain&&w){C.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(M.style=I.serialize())}if(this._validate(Ce,"terrain",C,M))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&p!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,p),this.fire(new f.g("data",{dataType:"style"}))}else{const C=this.terrain,M=C.get();for(const I of Object.keys(f.N.terrain))!v.hasOwnProperty(I)&&f.N.terrain[I].default&&(v[I]=f.N.terrain[I].default);for(const I in c)if(!f.d(c[I],M[I])){C.set(c,this.options),this.stylesheet.terrain=c;const P=this._getTransitionParameters({duration:0});C.updateTransitions(P),this.fire(new f.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const p=this.fog=new Oa(c,this.map.transform,this.scope,this.options);this.stylesheet.fog=p.get();const v=this._getTransitionParameters({duration:0});p.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog;if(!f.d(p.get(),c)){p.set(c,this.options),this.stylesheet.fog=p.get();const v=this._getTransitionParameters({duration:0});p.updateTransitions(v)}}else this._createFog(c);this._markersNeedUpdate=!0}setColorTheme(c){this._checkLoaded();const p=()=>{for(const w in this._layers)this._layers[w].lut=this._styleColorTheme.lut;for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()};if(this._styleColorTheme.colorTheme=c,!c)return this._styleColorTheme.lut=null,void p();const v=this._evaluateColorThemeData(c);this._loadColorTheme(v).then(()=>{this.fire(new f.g("colorthemeset")),p()}).catch(w=>{f.w(`Couldn't set color theme: ${w}`)})}_getTransitionParameters(c){return{now:f.e.now(),transition:f.Q(this.transition,c)}}updateDrapeFirstLayers(){if(!this.terrain)return;const c=[],p=[];for(const v of this._mergedOrder)this.isLayerDraped(this._mergedLayers[v])?c.push(v):p.push(v);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...p)}_createTerrain(c,p){const v=this.terrain=new zr(c,p,this.scope,this.options);1===p&&(this.stylesheet.terrain=c),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const c in this._layers){const p=this._layers[c];"fill-extrusion"===p.type&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const p=this._layers[c];"symbol"===p.type&&this._updateLayer(p)}}_validate(c,p,v,w,C={}){if(C&&!1===C.validate)return!1;const M=f.Q({},this.serialize());return ll(this,c.call(K,f.Q({key:p,style:M,value:v,styleSpec:f.N},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._mergedLayers)this._mergedLayers[c].setEventedParent(null);for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles(),this._mergedSourceCaches[c].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(c){const p=this.getSourceCaches(c);for(const v of p)v.clearTiles()}clearSources(){for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles()}reloadSource(c){const p=this.getSourceCaches(c);for(const v of p)v.resume(),v.reload()}reloadSources(){for(const c of this.getSources())c.reload&&c.reload()}updateSources(c){let p;this.directionalLight&&(p=gm(this.directionalLight));for(const v in this._mergedSourceCaches)this._mergedSourceCaches[v].update(c,void 0,void 0,p)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const p=this._sourceCaches[c];p.resume(),p.reload()}}_updatePlacement(c,p,v,w,C,M,I=!1){let P=!1,F=!1;const z={},j={};for(const q of this._mergedOrder){const Z=this._mergedLayers[q];if("symbol"!==Z.type)continue;const ne=f.am(Z.source,Z.scope);let re=z[ne];if(!re){const Q=this.getLayerSourceCache(Z);if(!Q)continue;const se=Q.getRenderableIds(!0).map(ce=>Q.getTileByID(ce));j[ne]=se.slice(),re=z[ne]=se.sort((ce,de)=>de.tileID.overscaledZ-ce.tileID.overscaledZ||(ce.tileID.isLessThan(de.tileID)?-1:1))}const ie=this.crossTileSymbolIndex.addLayer(Z,re,p.center.lng,p.projection);P=P||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||0===w,this._layerOrderChanged&&this.fire(new f.g("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.e.now(),p.zoom))&&(this.pauseablePlacement=new iT(p,this._mergedOrder,I,v,w,C,this.placement,this.fog&&p.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.e.now()),F=!0),P&&this.pauseablePlacement.placement.setStale()),F||P){this._buildingIndex.onNewFrame(p.zoom);for(let q=0;q<this._mergedOrder.length;q++){const Z=this._mergedLayers[this._mergedOrder[q]];if("symbol"!==Z.type)continue;const ne=this.isLayerClipped(Z)&&this._clipLayerIndices.some(re=>q<re);this.placement.updateLayerOpacities(Z,z[f.am(Z.source,Z.scope)],q,ne?M:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.e.now())}}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}addImport(c,p){this._checkLoaded();const v=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==v.findIndex(({id:C})=>C===c.id))return void this.fire(new f.f(new Error(`Import with id '${c.id}' already exists in the map's style.`)));if(!p)return v.push(c),this._loadImports([c],!0);const w=v.findIndex(({id:C})=>C===p);return-1===w&&this.fire(new f.f(new Error(`Import with id "${p}" does not exist on this map.`))),this.stylesheet.imports=v.slice(0,w).concat(c).concat(v.slice(w)),this._loadImports([c],!0,p)}updateImport(c,p){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(c);return-1===w?this:"string"==typeof p?(this.setImportUrl(c,p),this):(p.url&&p.url!==v[w].url&&this.setImportUrl(c,p.url),f.d(p.config,v[w].config)||this.setImportConfig(c,p.config),f.d(p.data,v[w].data)||this.setImportData(c,p.data),this)}moveImport(c,p){this._checkLoaded();let v=this.stylesheet.imports||[];const w=this.getImportIndex(c);if(-1===w)return this;const C=this.getImportIndex(p);if(-1===C)return this;const M=v[w],I=this.fragments[w];return v=v.filter(({id:P})=>P!==c),this.fragments=this.fragments.filter(({id:P})=>P!==c),this.stylesheet.imports=v.slice(0,C).concat(M).concat(v.slice(C)),this.fragments=this.fragments.slice(0,C).concat(I).concat(this.fragments.slice(C)),this.mergeLayers(),this}setImportUrl(c,p){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(c);if(-1===w)return this;v[w].url=p;const C=this.fragments[w];return C.style=this._createFragmentStyle(v[w]),C.style.on("style.import.load",()=>this.mergeAll()),C.style.loadURL(p),this}setImportData(c,p){this._checkLoaded();const v=this.getImportIndex(c),w=this.stylesheet.imports||[];return-1===v?this:p?(this.fragments[v].style.setState(p),this._reloadImports(),this):(delete w[v].data,this.setImportUrl(c,w[v].url))}setImportConfig(c,p){this._checkLoaded();const v=this.getImportIndex(c),w=this.stylesheet.imports||[];if(-1===v)return this;p?w[v].config=p:delete w[v].config;const C=this.fragments[v],M=C.style.stylesheet&&C.style.stylesheet.schema;return C.config=p,C.style.updateConfig(p,M),this.updateConfigDependencies(),this}removeImport(c){this._checkLoaded();const p=this.stylesheet.imports||[],v=this.getImportIndex(c);-1!==v&&(p.splice(v,1),this.fragments[v].style._remove(),this.fragments.splice(v,1),this._reloadImports())}getImportIndex(c){const p=(this.stylesheet.imports||[]).findIndex(v=>v.id===c);return-1===p&&this.fire(new f.f(new Error(`Import '${c}' does not exist in the map's style and cannot be updated.`))),p}getLayer(c){return this._mergedLayers[c]}getSources(){const c=[];for(const p in this._mergedOtherSourceCaches){const v=this._mergedOtherSourceCaches[p];v&&c.push(v.getSource())}return c}getSource(c,p){const v=this.getSourceCache(c,p);return v&&v.getSource()}getLayerSource(c){const p=this.getLayerSourceCache(c);return p&&p.getSource()}getSourceCache(c,p){const v=f.am(c,p);return this._mergedOtherSourceCaches[v]}getLayerSourceCache(c){const p=f.am(c.source,c.scope);return"symbol"===c.type?this._mergedSymbolSourceCaches[p]:this._mergedOtherSourceCaches[p]}getSourceCaches(c){if(null==c)return Object.values(this._mergedSourceCaches);const p=[];return this._mergedOtherSourceCaches[c]&&p.push(this._mergedOtherSourceCaches[c]),this._mergedSymbolSourceCaches[c]&&p.push(this._mergedSymbolSourceCaches[c]),p}updateSourceCaches(){const c=this._changes.getUpdatedSourceCaches();for(const p in c){const v=c[p];"reload"===v?this.reloadSource(p):"clear"===v&&this.clearSource(p)}}updateLayers(c){const p=this._changes.getUpdatedPaintProperties();for(const v of p){const w=this.getLayer(v);w&&w.updateTransitions(c)}}getImages(c,p,v){this.imageManager.getImages(p.icons,p.scope,v),this._updateTilesForChangedImages();const w=C=>{C&&C.setDependencies(p.tileID.key,p.type,p.icons)};w(this._otherSourceCaches[p.source]),w(this._symbolSourceCaches[p.source])}getGlyphs(c,p,v){this.glyphManager.getGlyphs(p.stacks,p.scope,v)}getResource(c,p,v){return f.d2(p,v)}getOwnSourceCache(c){return this._otherSourceCaches[c]}getOwnLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}getOwnSourceCaches(c){const p=[];return this._otherSourceCaches[c]&&p.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&p.push(this._symbolSourceCaches[c]),p}_isSourceCacheLoaded(c){const p=this.getOwnSourceCaches(c);return 0===p.length?(this.fire(new f.f(new Error(`There is no source with ID '${c}'`))),!1):p.every(v=>v.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(c,p){if(0===this._clipLayerIndices.length&&"fill-extrusion"!==c.type)return!1;const v="fill-extrusion"===c.type&&"building"===c.sourceLayer;let w=0;if(c.is3D()){if(v||p&&"batched-model"===p.type)return!0;"model"===c.type&&(w=f.cw.Model)}else"symbol"===c.type&&(w=f.cw.Symbol);for(const C of this._clipLayerIndices){const M=this._mergedLayers[this._mergedOrder[C]];if(!M)continue;const I=[];for(const P of M.layout.get("clip-layer-types"))I.push("model"===P?f.cw.Model:"symbol"===P?f.cw.Symbol:f.cw.FillExtrusion);for(const P of I)if(w&P)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(c=>{c.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Im(y,c){let p=!1,v=null;const w=()=>{v=null,p&&(y(),v=setTimeout(w,c),p=!1)};return()=>(p=!0,v||w(),v)}Fa.getSourceType=function(y){return Xg[y]},Fa.setSourceType=function(y,c){Xg[y]=c},Fa.registerForPluginStateChange=f.cO;class km{constructor(c){this._hashName=c&&encodeURIComponent(c),f.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Im(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const p=Ol(c);if(this._hashName){const v=this._hashName;let w=!1;const C=location.hash.slice(1).split("&").map(M=>{const I=M.split("=")[0];return I===v?(w=!0,`${I}=${p}`):M}).filter(M=>M);return w||C.push(`${v}=${p}`),`#${C.join("&")}`}return`#${p}`}_getCurrentHash(){const c=location.hash.replace("#","");if(this._hashName){let p;return c.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(p=v)}),(p&&p[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(v=>isNaN(v))){const v=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(p[3]||0):c.getBearing();return c.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:v,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ol(y,c){const p=y.getCenter(),v=Math.round(100*y.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),M=Math.round(p.lng*C)/C,I=Math.round(p.lat*C)/C,P=y.getBearing(),F=y.getPitch();let z=c?`/${M}/${I}/${v}`:`${v}/${I}/${M}`;return(P||F)&&(z+="/"+Math.round(10*P)/10),F&&(z+=`/${Math.round(F)}`),z}const Rl={linearity:.3,easing:f.d3(0,0,.3,1)},sT=f.Q({deceleration:2500,maxSpeed:1400},Rl),f1=f.Q({deceleration:20,maxSpeed:1400},Rl),Yv=f.Q({deceleration:1e3,maxSpeed:360},Rl),Kv=f.Q({deceleration:1e3,maxSpeed:90},Rl);class Jf{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.e.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,p=f.e.now();for(;c.length>0&&p-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const p={zoom:0,bearing:0,pitch:0,pan:new f.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)p.zoom+=C.zoomDelta||0,p.bearing+=C.bearingDelta||0,p.pitch+=C.pitchDelta||0,C.panDelta&&p.pan._add(C.panDelta),C.around&&(p.around=C.around),C.pinchAround&&(p.pinchAround=C.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(p.pan.mag()){const C=wh(p.pan.mag(),v,f.Q({},sT,c||{}));w.offset=p.pan.mult(C.amount/p.pan.mag()),w.center=this._map.transform.center,Om(w,C)}if(p.zoom){const C=wh(p.zoom,v,f1);w.zoom=this._map.transform.zoom+C.amount,Om(w,C)}if(p.bearing){const C=wh(p.bearing,v,Yv);w.bearing=this._map.transform.bearing+f.au(C.amount,-179,179),Om(w,C)}if(p.pitch){const C=wh(p.pitch,v,Kv);w.pitch=this._map.transform.pitch+C.amount,Om(w,C)}if(w.zoom||w.bearing){const C=void 0===p.pinchAround?p.around:p.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Om(y,c){(!y.duration||y.duration<c.duration)&&(y.duration=c.duration,y.easing=c.easing)}function wh(y,c,p){const{maxSpeed:v,linearity:w,deceleration:C}=p,M=f.au(y*w/(c/1e3),-v,v),I=Math.abs(M)/(C*w);return{easing:p.easing,duration:1e3*I,amount:M*(I/2)}}class Pl extends f.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,v,w={}){const C=xi(p.getCanvasContainer(),v),M=p.unproject(C);super(c,f.Q({point:C,lngLat:M,originalEvent:v},w)),this._defaultPrevented=!1,this.target=p}}class Pd extends f.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,v){const w="touchend"===c?v.changedTouches:v.touches,C=Ai(p.getCanvasContainer(),w),M=C.map(P=>p.unproject(P)),I=C.reduce((P,F,z,j)=>P.add(F.div(j.length)),new f.P(0,0));super(c,{points:C,point:I,lngLats:M,lngLat:p.unproject(I),originalEvent:v}),this._defaultPrevented=!1}}class p1 extends f.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p){super("wheel",{originalEvent:p}),this._defaultPrevented=!1}}class o0{constructor(c,p){this._map=c,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new p1(this._map,c))}mousedown(c,p){return this._mousedownPos=p,this._firePreventable(new Pl(c.type,this._map,c))}mouseup(c){this._map.fire(new Pl(c.type,this._map,c))}preclick(c){const p=f.Q({},c);p.type="preclick",this._map.fire(new Pl(p.type,this._map,p))}click(c,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Pl(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Pl(c.type,this._map,c))}mouseover(c){this._map.fire(new Pl(c.type,this._map,c))}mouseout(c){this._map.fire(new Pl(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Pd(c.type,this._map,c))}touchmove(c){this._map.fire(new Pd(c.type,this._map,c))}touchend(c){this._map.fire(new Pd(c.type,this._map,c))}touchcancel(c){this._map.fire(new Pd(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nl{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Pl(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Pl(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nd{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,p){this.isEnabled()&&c.shiftKey&&0===c.button&&(vi(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(c,p){if(!this._active)return;const v=p,w=this._startPos,C=this._lastPos;if(!w||!C||C.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=jr("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const M=Math.min(w.x,v.x),I=Math.max(w.x,v.x),P=Math.min(w.y,v.y),F=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${P}px)`,this._box.style.width=I-M+"px",this._box.style.height=F-P+"px")})}mouseupWindow(c,p){if(!this._active)return;const v=this._startPos,w=p;if(v&&0===c.button){if(this.reset(),Uo(),v.x!==w.x||v.y!==w.y)return this._map.fire(new f.g("boxzoomend",{originalEvent:c})),{cameraAnimation:C=>C.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ws(),delete this._startPos,delete this._lastPos}_fireEvent(c,p){return this._map.fire(new f.g(c,{originalEvent:p}))}}function Qf(y,c){const p={};for(let v=0;v<y.length;v++)p[y[v].identifier]=c[v];return p}class Jv{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,p,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const C=new f.P(0,0);for(const M of w)C._add(M);return C.div(w.length)}(p),this.touches=Qf(v,p)))}touchmove(c,p,v){if(this.aborted||!this.centroid)return;const w=Qf(v,p);for(const C in this.touches){const M=w[C];(!M||M.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(c,p,v){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Th{constructor(c){this.singleTap=new Jv(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,p,v){this.singleTap.touchstart(c,p,v)}touchmove(c,p,v){this.singleTap.touchmove(c,p,v)}touchend(c,p,v){const w=this.singleTap.touchend(c,p,v);if(w){const C=c.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(w)<30;if(C&&M||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Rm{constructor(){this._zoomIn=new Th({numTouches:1,numTaps:2}),this._zoomOut=new Th({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,p,v){this._zoomIn.touchstart(c,p,v),this._zoomOut.touchstart(c,p,v)}touchmove(c,p,v){this._zoomIn.touchmove(c,p,v),this._zoomOut.touchmove(c,p,v)}touchend(c,p,v){const w=this._zoomIn.touchend(c,p,v),C=this._zoomOut.touchend(c,p,v);return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(w)},{originalEvent:c})}):C?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(C)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const a0={0:1,2:2};class ep{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,p){return!1}_move(c,p){return{}}mousedown(c,p){if(this._lastPoint)return;const v=Ks(c);this._correctButton(c,v)&&(this._lastPoint=p,this._eventButton=v)}mousemoveWindow(c,p){const v=this._lastPoint;if(v)if(c.preventDefault(),null!=this._eventButton&&function(w,C){const M=a0[C];return void 0===w.buttons||(w.buttons&M)!==M}(c,this._eventButton))this.reset();else if(this._moved||!(p.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(v,p)}mouseupWindow(c){this._lastPoint&&Ks(c)===this._eventButton&&(this._moved&&Uo(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pm extends ep{mousedown(c,p){super.mousedown(c,p),this._lastPoint&&(this._active=!0)}_correctButton(c,p){return 0===p&&!c.ctrlKey}_move(c,p){return{around:p,panDelta:p.sub(c)}}}class Nm extends ep{_correctButton(c,p){return 0===p&&c.ctrlKey||2===p}_move(c,p){const v=.8*(p.x-c.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(c){c.preventDefault()}}class l0 extends ep{_correctButton(c,p){return 0===p&&c.ctrlKey||2===p}_move(c,p){const v=-.5*(p.y-c.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(c){c.preventDefault()}}class ki{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),f.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.P(0,0)}touchstart(c,p,v){return this._calculateTransform(c,p,v)}touchmove(c,p,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length&&!f.d4())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,p,v)}}touchend(c,p,v){this._calculateTransform(c,p,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,p,v){v.length>0&&(this._active=!0);const w=Qf(v,p),C=new f.P(0,0),M=new f.P(0,0);let I=0;for(const F in w){const z=w[F],j=this._touches[F];j&&(C._add(z),M._add(z.sub(j)),I++,w[F]=z)}if(this._touches=w,I<this._minTouches||!M.mag())return;const P=M.div(I);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(I),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=jr("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Fm{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,p,v){return{}}touchstart(c,p,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([p[0],p[1]]))}touchmove(c,p,v){const w=this._firstTwoTouches;if(!w)return;c.preventDefault();const[C,M]=w,I=Fd(v,p,C),P=Fd(v,p,M);if(!I||!P)return;const F=this._aroundCenter?null:I.add(P).div(2);return this._move([I,P],F,c)}touchend(c,p,v){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,M=Fd(v,p,w),I=Fd(v,p,C);M&&I||(this._active&&Uo(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fd(y,c,p){for(let v=0;v<y.length;v++)if(y[v].identifier===p)return c[v]}function Ci(y,c){return Math.log(y/c)/Math.LN2}class m1 extends Fm{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,p){const v=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Ci(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ci(this._distance,v),pinchAround:p}}}function gn(y,c){return 180*y.angleWith(c)/Math.PI}class La extends Fm{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,p){const v=this._vector;if(this._vector=c[0].sub(c[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:gn(this._vector,v),pinchAround:p}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const p=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=gn(c,v);return Math.abs(w)<p}}function Vr(y){return Math.abs(y.y)>Math.abs(y.x)}class ho extends Fm{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Vr(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,p,v){const w=this._lastPoints;if(!w)return;const C=c[0].sub(w[0]),M=c[1].sub(w[1]);return this._map._cooperativeGestures&&!f.d4()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(C,M,v.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+M.y)/2*-.5})}gestureBeginsVertically(c,p,v){if(void 0!==this._valid)return this._valid;const w=c.mag()>=2,C=p.mag()>=2;if(!w&&!C)return;if(!w||!C)return null==this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const M=c.y>0==p.y>0;return Vr(c)&&Vr(p)&&M}}const Wo={panStep:100,bearingStep:15,pitchStep:10};class Eh{constructor(){const c=Wo;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let p=0,v=0,w=0,C=0,M=0;switch(c.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),C=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),C=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),M=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:I=>{const P=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:ha,zoom:p?Math.round(P)+p*(c.shiftKey?2:1):P,bearing:I.getBearing()+v*this._bearingStep,pitch:I.getPitch()+w*this._pitchStep,offset:[-C*this._panStep,-M*this._panStep],center:I.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ha(y){return y*(2-y)}const Lm=4.000244140625,c0=1/450;class tp{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._handler=p,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=c0,f.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||f.d4()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const v=f.e.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==p&&p%Lm==0?this._type="wheel":0!==p&&Math.abs(p)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=p,this._timeout=window.setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),c.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=c,this._delta-=p,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=xi(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const F="wheel"===this._type&&Math.abs(this._delta)>Lm?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&0!==z&&(z=1/z);const j=p(),q=Math.pow(2,j),Z="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(Z*z))),"wheel"===this._type&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:p(),w=this._startZoom,C=this._easing;let M,I=!1;if("wheel"===this._type&&w&&C){const F=Math.min((f.e.now()-this._lastWheelEventTime)/200,1),z=C(F);M=f.a3(w,v,z),F<1?this._frameId||(this._frameId=!0):I=!0}else M=v,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=M-p();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let p=f.d5;if(this._prevEase){const v=this._prevEase,w=(f.e.now()-v.start)/v.duration,C=v.easing(w+.01)-v.easing(w),M=.27/Math.sqrt(C*C+1e-4)*.01,I=Math.sqrt(.0729-M*M);p=f.d3(M,I,.25,1)}return this._prevEase={start:f.e.now(),duration:c,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=jr("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class g1{constructor(c,p){this._clickZoom=c,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Qv{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,p){return c.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(c.shiftKey?-1:1),around:v.unproject(p)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class np{constructor(){this._tap=new Th({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,p,v){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=p[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(c,p,v))}touchmove(c,p,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=p[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,p,v)}touchend(c,p,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(c,p,v)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oT{constructor(c,p,v){this._el=c,this._mousePan=p,this._touchPan=v}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ld{constructor(c,p,v){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=p,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rp{constructor(c,p,v,w){this._el=c,this._touchZoom=p,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ch=y=>y.zoom||y.drag||y.pitch||y.rotate;class ic extends f.g{}class Bm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,p){const v=f.$.sub([],p,c);this.radius=f.$.length(v[2]<0?f.$.div([],v,this.constants):[v[0],v[1],0])}projectRay(c){f.$.div(c,c,this.constants),f.$.normalize(c,c),f.$.mul(c,c,this.constants);const p=f.$.scale([],c,this.radius);if(p[2]>0){const v=f.$.scale([],[0,0,1],f.$.dot(p,[0,0,1])),w=f.$.scale([],f.$.normalize([],[p[0],p[1],0]),this.radius),C=f.$.add([],p,f.$.scale([],f.$.sub([],f.$.add([],w,v),p),2));p[0]=C[0],p[1]=C[1]}return p}}function Bd(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class ip{constructor(c,p){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Jf(c),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Bm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),f.br(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,C,M]of this._listeners){const I=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(C,I,M)}}destroy(){for(const[c,p,v]of this._listeners){const w=c===document?this.handleWindowEvent:this.handleEvent;c.removeEventListener(p,w,v)}}_addDefaultHandlers(c){const p=this._map,v=p.getCanvasContainer();this._add("mapEvent",new o0(p,c));const w=p.boxZoom=new Nd(p,c);this._add("boxZoom",w);const C=new Rm,M=new Qv;p.doubleClickZoom=new g1(M,C),this._add("tapZoom",C),this._add("clickZoom",M);const I=new np;this._add("tapDragZoom",I);const P=p.touchPitch=new ho(p);this._add("touchPitch",P);const F=new Nm(c),z=new l0(c);p.dragRotate=new Ld(c,F,z),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const j=new Pm(c),q=new ki(p,c);p.dragPan=new oT(v,j,q),this._add("mousePan",j),this._add("touchPan",q,["touchZoom","touchRotate"]);const Z=new La,ne=new m1;p.touchZoomRotate=new rp(v,ne,Z,I),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Nl(p));const re=p.scrollZoom=new tp(p,this);this._add("scrollZoom",re,["mousePan"]);const ie=p.keyboard=new Eh;this._add("keyboard",ie);for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[Q]&&p[Q].enable(c[Q])}_add(c,p,v){this._handlers.push({handlerName:c,handler:p,allowed:v}),this._handlersById[c]=p}stop(c){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ch(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,p,v){for(const w in c)if(w!==v&&(!p||p.indexOf(w)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const p=[];for(const v of c)this._el.contains(v.target)&&p.push(v);return p}handleEvent(c,p){this._updatingCamera=!0;const v="renderFrame"===c.type,w=v?void 0:c,C={needsRenderFrame:!1},M={},I={},P=c.touches?this._getMapTouches(c.touches):void 0,F=P?Ai(this._el,P):v?void 0:xi(this._el,c);for(const{handlerName:q,handler:Z,allowed:ne}of this._handlers){if(!Z.isEnabled())continue;let re;this._blockedByActive(I,ne,q)?Z.reset():Z[p||c.type]&&(re=Z[p||c.type](c,F,P),this.mergeHandlerResult(C,M,re,q,w),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||Z.isActive())&&(I[q]=Z)}const z={};for(const q in this._previousActiveHandlers)I[q]||(z[q]=w);this._previousActiveHandlers=I,(Object.keys(z).length||Bd(C))&&(this._changes.push([C,M,z]),this._triggerRenderFrame()),(Object.keys(I).length||Bd(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=C;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(c,p,v,w,C){if(!v)return;f.Q(c,v);const M={handlerName:w,originalEvent:v.originalEvent||C};void 0!==v.zoomDelta&&(p.zoom=M),void 0!==v.panDelta&&(p.drag=M),void 0!==v.pitchDelta&&(p.pitch=M),void 0!==v.bearingDelta&&(p.rotate=M)}_applyChanges(){const c={},p={},v={};for(const[w,C,M]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new f.P(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(c.around=w.around),void 0!==w.aroundCoord&&(c.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),f.Q(p,C),f.Q(v,M);this._updateMapTransform(c,p,v),this._changes=[]}_updateMapTransform(c,p,v){const w=this._map,C=w.transform,M=se=>[se.x,se.y,se.z];if((se=>{const ce=this._eventsInProgress.drag;return ce&&!this._handlersById[ce.handlerName].isActive()})()&&!Bd(c)){const se=C.zoom;C.cameraElevationReference="sea",null!=this._originalZoom&&C._orthographicProjectionAtLowPitch&&"globe"!==C.projection.name&&0===C.pitch?(C.cameraElevationReference="ground",C.zoom=this._originalZoom):(C.recenterOnTerrain(),C.cameraElevationReference="ground"),se!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&w._stop(!0),!Bd(c))return void this._fireEvents(p,v,!0);let{panDelta:I,zoomDelta:P,bearingDelta:F,pitchDelta:z,around:j,aroundCoord:q,pinchAround:Z}=c;C._isCameraConstrained&&(P>0&&(P=0),C._isCameraConstrained=!1),void 0!==Z&&(j=Z),(P||(se=>p.drag&&!this._eventsInProgress.drag)())&&j&&(this._dragOrigin=M(C.pointCoordinate3D(j)),this._originalZoom=C.zoom,this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",w._stop(!0),j=j||w.transform.centerPoint,F&&(C.bearing+=F),z&&(C.pitch+=z),C._updateCameraState();const ne=[0,0,0];if(I)if("mercator"===C.projection.name){const se=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(j).dir),ce=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(j.sub(I)).dir);ne[0]=ce[0]-se[0],ne[1]=ce[1]-se[1]}else{const se=C.pointCoordinate(j);if("globe"===C.projection.name){I=I.rotate(-C.angle);const ce=C._pixelsPerMercatorPixel/C.worldSize;ne[0]=-I.x*f.d6(f.az(se.y))*ce,ne[1]=-I.y*f.d6(C.center.lat)*ce}else{const ce=C.pointCoordinate(j.sub(I));se&&ce&&(ne[0]=ce.x-se.x,ne[1]=ce.y-se.y)}}const re=C.zoom,ie=[0,0,0];if(P){const se=M(q||C.pointCoordinate3D(j)),ce={dir:f.$.normalize([],f.$.sub([],se,C._camera.position))};if(ce.dir[2]<0){const de=C.zoomDeltaToMovement(se,P);f.$.scale(ie,ce.dir,de)}}const Q=f.$.add(ne,ne,ie);C._translateCameraConstrained(Q),P&&Math.abs(C.zoom-re)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(p,v,!0)}_fireEvents(c,p,v){const w=Ch(this._eventsInProgress),C=Ch(c),M={};for(const z in c){const{originalEvent:j}=c[z];this._eventsInProgress[z]||(M[`${z}start`]=j),this._eventsInProgress[z]=c[z]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const z in M)this._fireEvent(z,M[z]);C&&this._fireEvent("move",C.originalEvent);for(const z in c){const{originalEvent:j}=c[z];this._fireEvent(z,j)}const I={};let P;for(const z in this._eventsInProgress){const{handlerName:j,originalEvent:q}=this._eventsInProgress[z];this._handlersById[j].isActive()||(delete this._eventsInProgress[z],P=p[j]||q,I[`${z}end`]=P)}for(const z in I)this._fireEvent(z,I[z]);const F=Ch(this._eventsInProgress);if(v&&(w||C)&&!F){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=q=>0!==q&&-this._bearingSnap<q&&q<this._bearingSnap;z?(j(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:P})):(this._map.fire(new f.g("moveend",{originalEvent:P})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,p){this._map.fire(new f.g(c,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new ic("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const zm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class u0 extends f.E{constructor(c,p){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,this._respectPrefersReducedMotion=!1!==p.respectPrefersReducedMotion,f.br(["_renderFrameCallback"],this)}getCenter(){return new f.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(c,p){return this.jumpTo({center:c},p)}panBy(c,p,v){return c=f.P.convert(c).mult(-1),this.panTo(this.transform.center,f.Q({offset:c},p),v)}panTo(c,p,v){return this.easeTo(f.Q({center:c},p),v)}getZoom(){return this.transform.zoom}setZoom(c,p){return this.jumpTo({zoom:c},p),this}zoomTo(c,p,v){return this.easeTo(f.Q({zoom:c},p),v)}zoomIn(c,p){return this.zoomTo(this.getZoom()+1,c,p),this}zoomOut(c,p){return this.zoomTo(this.getZoom()-1,c,p),this}getBearing(){return this.transform.bearing}setBearing(c,p){return this.jumpTo({bearing:c},p),this}getPadding(){return this.transform.padding}setPadding(c,p){return this.jumpTo({padding:c},p),this}rotateTo(c,p,v){return this.easeTo(f.Q({bearing:c},p),v)}resetNorth(c,p){return this.rotateTo(0,f.Q({duration:1e3},c),p),this}resetNorthPitch(c,p){return this.easeTo(f.Q({bearing:0,pitch:0,duration:1e3},c),p),this}snapToNorth(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this}getPitch(){return this.transform.pitch}setPitch(c,p){return this.jumpTo({pitch:c},p),this}cameraForBounds(c,p){c=f.aj.convert(c);const v=p&&p.bearing||0,w=p&&p.pitch||0,C=c.getNorthWest(),M=c.getSouthEast();return this._cameraForBounds(this.transform,C,M,v,w,p)}_extendPadding(c){const p={top:0,right:0,bottom:0,left:0};return null==c?f.Q({},p,this.transform.padding):"number"==typeof c?{top:c,bottom:c,right:c,left:c}:f.Q({},p,c)}_extendCameraOptions(c){return(c=f.Q({offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=this._extendPadding(c.padding),c}_minimumAABBFrustumDistance(c,p){const v=p.max[0]-p.min[0],w=p.max[1]-p.min[1];return v/w>c.aspect?v/(2*Math.tan(.5*c.fovX)*c.aspect):w/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,p,v,w,C,M){const I=c.clone(),P=this._extendCameraOptions(M);I.bearing=w,I.pitch=C;const F=f.aJ.convert(p),z=f.aJ.convert(v),j=.5*(F.lat+z.lat),q=.5*(F.lng+z.lng),Z=f.d7(j,q),ne=f.$.normalize([],Z),re=f.$.normalize([],f.$.cross([],ne,[0,1,0])),ie=f.$.cross([],re,ne),Q=[re[0],re[1],re[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],0,0,0,0,1],se=[Z,f.d7(F.lat,F.lng),f.d7(z.lat,F.lng),f.d7(z.lat,z.lng),f.d7(F.lat,z.lng),f.d7(j,F.lng),f.d7(j,z.lng),f.d7(F.lat,q),f.d7(z.lat,q)];let ce=f.b8.fromPoints(se.map(Oe=>[f.$.dot(re,Oe),f.$.dot(ie,Oe),f.$.dot(ne,Oe)]));const de=f.$.transformMat4([],ce.center,Q);0===f.$.squaredLength(de)&&f.$.set(de,0,0,1),f.$.normalize(de,de),f.$.scale(de,de,f.cF),I.center=f.d8(de);const be=I.getWorldToCameraMatrix(),_e=f.ae.invert(new Float64Array(16),be);ce=f.b8.applyTransform(ce,f.ae.multiply([],be,Q));const ye=this._extendAABB(ce,I,P,w);if(!ye)return void f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=ye,f.$.transformMat4(de,de,be);const De=.5*(ce.max[2]-ce.min[2]),Ee=this._minimumAABBFrustumDistance(I,ce),Be=f.$.scale([],[0,0,1],De),ke=f.$.add(Be,de,Be),pe=Ee+(0===I.pitch?0:f.$.distance(de,ke)),Je=I.globeCenterInViewSpace,Ke=f.$.sub([],de,[Je[0],Je[1],Je[2]]);f.$.normalize(Ke,Ke),f.$.scale(Ke,Ke,pe);const Pe=f.$.add([],de,Ke);f.$.transformMat4(Pe,Pe,_e);const pt=f.da/f.cF,mt=f.$.length(Pe),He=f.ay(Math.max(mt*pt-f.da,Number.EPSILON),0),nt=Math.min(I.zoomFromMercatorZAdjusted(He),P.maxZoom);return nt>.5*(f.b3+f.aV)?(I.setProjection({name:"mercator"}),I.zoom=nt,this._cameraForBounds(I,p,v,w,C,M)):{center:I.center,zoom:nt,bearing:w,pitch:C}}_extendAABB(c,p,v,w){const C=.5*((v.padding.left||0)+(v.padding.right||0)),M=.5*((v.padding.top||0)+(v.padding.bottom||0)),I=M,P=C,F=C,z=M,j=p.width-(P+F),q=p.height-(I+z),Z=f.$.sub([],c.max,c.min),ne=Math.min(j/Z[0],q/Z[1]),re=Math.min(p.scaleZoom(p.scale*ne),v.maxZoom);if(isNaN(re))return null;const ie=p.scale/p.zoomScale(re),Q=new f.b8([c.min[0]-P*ie,c.min[1]-z*ie,c.min[2]],[c.max[0]+F*ie,c.max[1]+I*ie,c.max[2]]),se=("number"==typeof v.offset.x&&"number"==typeof v.offset.y?new f.P(v.offset.x,v.offset.y):f.P.convert(v.offset)).rotate(-f.ac(w));return Q.center[0]-=se.x*ie,Q.center[1]+=se.y*ie,Q}queryTerrainElevation(c,p){const v=this.transform.elevation;return v?(p=f.Q({},{exaggerated:!0},p),v.getAtPoint(f._.fromLngLat(c),null,p.exaggerated)):null}_cameraForBounds(c,p,v,w,C,M){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,p,v,w,C,M);const I=c.clone(),P=this._extendCameraOptions(M);I.bearing=w,I.pitch=C;const F=f.aJ.convert(p),z=f.aJ.convert(v),j=new f.aJ(F.lng,z.lat),q=new f.aJ(z.lng,F.lat),Z=I.project(F),ne=I.project(z),re=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(z),Q=this.queryTerrainElevation(j),se=this.queryTerrainElevation(q),ce=[[Z.x,Z.y,Math.min(re||0,ie||0,Q||0,se||0)],[ne.x,ne.y,Math.max(re||0,ie||0,Q||0,se||0)]];let de=f.b8.fromPoints(ce);const be=I.getWorldToCameraMatrix(),_e=f.ae.invert(new Float64Array(16),be);de=f.b8.applyTransform(de,be);const ye=this._extendAABB(de,I,P,w);if(!ye)return void f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=ye;const De=.5*f.$.sub([],de.max,de.min)[2],Ee=this._minimumAABBFrustumDistance(I,de),Be=[0,0,1,0];f.aB.transformMat4(Be,Be,be),f.aB.normalize(Be,Be);const ke=f.$.scale([],Be,Ee+De),pe=f.$.add([],de.center,ke);f.$.transformMat4(de.center,de.center,_e),f.$.transformMat4(pe,pe,_e);const Je=[de.center[0],de.center[1],pe[2]*I.pixelsPerMeter];f.$.scale(Je,Je,1/I.worldSize);const Ke=f.d9(Je[0]),Pe=f.az(Je[1]),pt=Math.min(I._zoomFromMercatorZ(Je[2]),P.maxZoom),mt=new f.aJ(Ke,Pe);return I.mercatorFromTransition&&pt<.5*(f.b3+f.aV)?(I.setProjection({name:"globe"}),I.zoom=pt,this._cameraForBounds(I,p,v,w,C,M)):{center:mt,zoom:pt,bearing:w,pitch:C}}fitBounds(c,p,v){const w=this.cameraForBounds(c,p);return this._fitInternal(w,p,v)}fitScreenCoordinates(c,p,v,w,C){const M=f.P.convert(c),I=f.P.convert(p),P=new f.P(Math.min(M.x,I.x),Math.min(M.y,I.y)),F=new f.P(Math.max(M.x,I.x),Math.max(M.y,I.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(M,I))return this;const z=this.transform.pointLocation3D(P),j=this.transform.pointLocation3D(F),q=this.transform.pointLocation3D(new f.P(P.x,F.y)),Z=this.transform.pointLocation3D(new f.P(F.x,P.y)),ne=[Math.min(z.lng,j.lng,q.lng,Z.lng),Math.min(z.lat,j.lat,q.lat,Z.lat)],re=[Math.max(z.lng,j.lng,q.lng,Z.lng),Math.max(z.lat,j.lat,q.lat,Z.lat)],ie=w&&w.pitch?w.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,ne,re,v,ie,w);return this._fitInternal(Q,w,C)}_fitInternal(c,p,v){return c?(p=f.Q(c,p)).linear?this.easeTo(p,v):this.flyTo(p,v):this}jumpTo(c,p){this.stop();const v=c.preloadOnly?this.transform.clone():this.transform;let w=!1,C=!1,M=!1;if("zoom"in c&&v.zoom!==+c.zoom&&(w=!0,v.zoom=+c.zoom),void 0!==c.center&&(v.center=f.aJ.convert(c.center)),"bearing"in c&&v.bearing!==+c.bearing&&(C=!0,v.bearing=+c.bearing),"pitch"in c&&v.pitch!==+c.pitch&&(M=!0,v.pitch=+c.pitch),null!=c.padding){const I="number"==typeof c.padding?this._extendPadding(c.padding):c.padding;v.isPaddingEqual(I)||(v.padding=I)}return c.preloadOnly?(this._preloadTiles(v),this):(this.fire(new f.g("movestart",p)).fire(new f.g("move",p)),w&&this.fire(new f.g("zoomstart",p)).fire(new f.g("zoom",p)).fire(new f.g("zoomend",p)),C&&this.fire(new f.g("rotatestart",p)).fire(new f.g("rotate",p)).fire(new f.g("rotateend",p)),M&&this.fire(new f.g("pitchstart",p)).fire(new f.g("pitch",p)).fire(new f.g("pitchend",p)),this.fire(new f.g("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.w(zm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,p){const v=this.transform;if(!v.projection.supportsFreeCamera)return f.w(zm),this;this.stop();const w=v.zoom,C=v.pitch,M=v.bearing;v.setFreeCameraOptions(c);const I=w!==v.zoom,P=C!==v.pitch,F=M!==v.bearing;return this.fire(new f.g("movestart",p)).fire(new f.g("move",p)),I&&this.fire(new f.g("zoomstart",p)).fire(new f.g("zoom",p)).fire(new f.g("zoomend",p)),F&&this.fire(new f.g("rotatestart",p)).fire(new f.g("rotate",p)).fire(new f.g("rotateend",p)),P&&this.fire(new f.g("pitchstart",p)).fire(new f.g("pitch",p)).fire(new f.g("pitchend",p)),this.fire(new f.g("moveend",p)),this}easeTo(c,p){this._stop(!1,c.easeId),(!1===(c=f.Q({offset:[0,0],duration:500,easing:f.d5},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const v=this.transform,w=this.getZoom(),C=this.getBearing(),M=this.getPitch(),I=this.getPadding(),P="zoom"in c?+c.zoom:w,F="bearing"in c?this._normalizeBearing(c.bearing,C):C,z="pitch"in c?+c.pitch:M,j=this._extendPadding(c.padding),q=f.P.convert(c.offset);let Z,ne,re;if("globe"===v.projection.name){const Ee=f._.fromLngLat(v.center),Be=q.rotate(-v.angle);Ee.x+=Be.x/v.worldSize,Ee.y+=Be.y/v.worldSize;const ke=Ee.toLngLat(),pe=f.aJ.convert(c.center||ke);this._normalizeCenter(pe),Z=v.centerPoint.add(Be),ne=new f.P(Ee.x,Ee.y).mult(v.worldSize),re=new f.P(f.ak(pe.lng),f.al(pe.lat)).mult(v.worldSize).sub(ne)}else{Z=v.centerPoint.add(q);const Ee=v.pointLocation(Z),Be=f.aJ.convert(c.center||Ee);this._normalizeCenter(Be),ne=v.project(Ee),re=v.project(Be).sub(ne)}const ie=v.zoomScale(P-w);let Q,se;c.around&&(Q=f.aJ.convert(c.around),se=v.locationPoint(Q));const ce=this._zooming||P!==w,de=this._rotating||C!==F,be=this._pitching||z!==M,_e=!v.isPaddingEqual(j),ye=Ee=>Be=>{if(ce&&(Ee.zoom=f.a3(w,P,Be)),de&&(Ee.bearing=f.a3(C,F,Be)),be&&(Ee.pitch=f.a3(M,z,Be)),_e&&(Ee.interpolatePadding(I,j,Be),Z=Ee.centerPoint.add(q)),Q)Ee.setLocationAtPoint(Q,se);else{const ke=Ee.zoomScale(Ee.zoom-w),pe=P>w?Math.min(2,ie):Math.max(.5,ie),Je=Math.pow(pe,1-Be),Ke=Ee.unproject(ne.add(re.mult(Be*Je)).mult(ke));Ee.setLocationAtPoint(Ee.renderWorldCopies?Ke.wrap():Ke,Z)}return c.preloadOnly||this._fireMoveEvents(p),Ee};if(c.preloadOnly){const Ee=this._emulate(ye,c.duration,v);return this._preloadTiles(Ee),this}const De={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=de,this._pitching=be,this._padding=_e,this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,De),this._ease(ye(v),Ee=>{"sea"===v.cameraElevationReference&&v.recenterOnTerrain(),this._afterEase(p,Ee)},c),this}_prepareEase(c,p,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),p||v.moving||this.fire(new f.g("movestart",c)),this._zooming&&!v.zooming&&this.fire(new f.g("zoomstart",c)),this._rotating&&!v.rotating&&this.fire(new f.g("rotatestart",c)),this._pitching&&!v.pitching&&this.fire(new f.g("pitchstart",c))}_fireMoveEvents(c){this.fire(new f.g("move",c)),this._zooming&&this.fire(new f.g("zoom",c)),this._rotating&&this.fire(new f.g("rotate",c)),this._pitching&&this.fire(new f.g("pitch",c))}_afterEase(c,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new f.g("zoomend",c)),w&&this.fire(new f.g("rotateend",c)),C&&this.fire(new f.g("pitchend",c)),this.fire(new f.g("moveend",c))}flyTo(c,p){if(this._prefersReducedMotion(c)){const nt=f.ai(c,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(nt,p)}this.stop(),c=f.Q({offset:[0,0],speed:1.2,curve:1.42,easing:f.d5},c);const v=this.transform,w=this.getZoom(),C=this.getBearing(),M=this.getPitch(),I=this.getPadding(),P="zoom"in c?f.au(+c.zoom,v.minZoom,v.maxZoom):w,F="bearing"in c?this._normalizeBearing(c.bearing,C):C,z="pitch"in c?+c.pitch:M,j=this._extendPadding(c.padding),q=v.zoomScale(P-w),Z=f.P.convert(c.offset);let ne=v.centerPoint.add(Z);const re=v.pointLocation(ne),ie=f.aJ.convert(c.center||re);this._normalizeCenter(ie);const Q=v.project(re),se=v.project(ie).sub(Q);let ce=c.curve;const de=Math.max(v.width,v.height),be=de/q,_e=se.mag();if("minZoom"in c){const nt=f.au(Math.min(c.minZoom,w,P),v.minZoom,v.maxZoom),Oe=de/v.zoomScale(nt-w);ce=Math.sqrt(Oe/_e*2)}const ye=ce*ce;function De(nt){const Oe=(be*be-de*de+(nt?-1:1)*ye*ye*_e*_e)/(2*(nt?be:de)*ye*_e);return Math.log(Math.sqrt(Oe*Oe+1)-Oe)}function Ee(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function Be(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const ke=De(0);let pe=function(nt){return Be(ke)/Be(ke+ce*nt)},Je=function(nt){return de*((Be(ke)*(Ee(Oe=ke+ce*nt)/Be(Oe))-Ee(ke))/ye)/_e;var Oe},Ke=(De(1)-ke)/ce;if(Math.abs(_e)<1e-6||!isFinite(Ke)){if(Math.abs(de-be)<1e-6)return this.easeTo(c,p);const nt=be<de?-1:1;Ke=Math.abs(Math.log(be/de))/ce,Je=function(){return 0},pe=function(Oe){return Math.exp(nt*ce*Oe)}}c.duration="duration"in c?+c.duration:1e3*Ke/("screenSpeed"in c?+c.screenSpeed/ce:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Pe=C!==F,pt=z!==M,mt=!v.isPaddingEqual(j),He=nt=>Oe=>{const _t=Oe*Ke,gt=1/pe(_t);nt.zoom=1===Oe?P:w+nt.scaleZoom(gt),Pe&&(nt.bearing=f.a3(C,F,Oe)),pt&&(nt.pitch=f.a3(M,z,Oe)),mt&&(nt.interpolatePadding(I,j,Oe),ne=nt.centerPoint.add(Z));const Wt=1===Oe?ie:nt.unproject(Q.add(se.mult(Je(_t))).mult(gt));return nt.setLocationAtPoint(nt.renderWorldCopies?Wt.wrap():Wt,ne),nt._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(p),nt};if(c.preloadOnly){const nt=this._emulate(He,c.duration,v);return this._preloadTiles(nt),this}return this._zooming=!0,this._rotating=Pe,this._pitching=pt,this._padding=mt,this._prepareEase(p,!1),this._ease(He(v),()=>this._afterEase(p),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(c){}_cancelRenderFrame(c){}_stop(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,p)}if(!c){const v=this.handlers;v&&v.stop(!1)}return this}_ease(c,p,v){!1===v.animate||0===v.duration?(c(1),p()):(this._easeStart=f.e.now(),this._easeOptions=v,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((f.e.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,p){c=f.av(c,-180,180);const v=Math.abs(c-p);return Math.abs(c-360-p)<v&&(c-=360),Math.abs(c+360-p)<v&&(c+=360),c}_normalizeCenter(c){const p=this.transform;if(p.maxBounds||"globe"!==p.projection.name&&!p.renderWorldCopies)return;const v=c.lng-p.center.lng;c.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&f.e.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,p,v){const w=Math.ceil(15*p/1e3),C=[],M=c(v.clone());for(let I=0;I<=w;I++){const P=M(I/w);C.push(P.clone())}return C}_preloadTiles(c,p){}}class Ac{constructor(c={}){this.options=c,f.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const p=this.options&&this.options.compact,v=c._getUIString("AttributionControl.ToggleAttribution");this._map=c,this._container=jr("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=jr("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",v);const w=jr("span","mapboxgl-ctrl-icon",this._compactButton);return w.setAttribute("aria-hidden","true"),w.setAttribute("title",v),this._innerContainer=jr("div","mapboxgl-ctrl-attrib-inner",this._container),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===p&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.db.ACCESS_TOKEN}];if(c){const v=p.reduce((w,C,M)=>(C.value&&(w+=`${C.key}=${C.value}${M<p.length-1?"&":""}`),w),"?");c.href=`${f.db.FEEDBACK_URL}/${v}#${Ol(this._map,!0)}`,c.rel="noopener nofollow"}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const p=this._map.style._mergedSourceCaches;for(const w in p){const C=p[w];if(C.used){const M=C.getSource();M.attribution&&c.indexOf(M.attribution)<0&&c.push(M.attribution)}}c.sort((w,C)=>w.length-C.length),c=c.filter((w,C)=>{for(let M=C+1;M<c.length;M++)if(c[M].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const v=c.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,c.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class h0{constructor(){f.br(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=jr("div","mapboxgl-ctrl");const p=jr("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const p in c){const v=c[p].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const p=c[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class sp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const p=++this._id;return this._queue.push({callback:c,id:p,cancelled:!1}),p}remove(c){const p=this._currentlyRunning,v=p?this._queue.concat(p):this._queue;for(const w of v)if(w.id===c)return void(w.cancelled=!0)}run(c=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const v of p)if(!v.cancelled&&(v.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Sh(y,c,p){if(y=new f.aJ(y.lng,y.lat),c){const v=new f.aJ(y.lng-360,y.lat),w=new f.aJ(y.lng+360,y.lat),C=360*Math.ceil(Math.abs(y.lng-p.center.lng)/360),M=p.locationPoint(y).distSqr(c),I=c.x<0||c.y<0||c.x>p.width||c.y>p.height;p.locationPoint(v).distSqr(c)<M&&(I||Math.abs(v.lng-p.center.lng)<C)?y=v:p.locationPoint(w).distSqr(c)<M&&(I||Math.abs(w.lng-p.center.lng)<C)&&(y=w)}for(;Math.abs(y.lng-p.center.lng)>180;){const v=p.locationPoint(y);if(v.x>=0&&v.y>=0&&v.x<=p.width&&v.y<=p.height)break;y.lng>p.center.lng?y.lng-=360:y.lng+=360}return y}const d0={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class op extends f.E{constructor(c,p){if(super(),(c instanceof HTMLElement||p)&&(c=f.Q({element:c},p)),f.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=f.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=jr("div");const C=41,M=27,I=_s("svg",{display:"block",height:C*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${C}`},this._element),P=_s("radialGradient",{id:"shadowGradient"},_s("defs",{},I));_s("stop",{offset:"10%","stop-opacity":.4},P),_s("stop",{offset:"100%","stop-opacity":.05},P),_s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),_s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),_s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),_s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=f.P.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",C=>{C.preventDefault()}),this._element.addEventListener("mousedown",C=>{C.preventDefault()});const v=this._element.classList;for(const C in d0)v.remove(`mapboxgl-marker-anchor-${C}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`);const w=c&&c.className?c.className.trim().split(/\s+/):[];v.add(...w),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=f.aJ.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const p=c.code,v=c.charCode||c.keyCode;"Space"!==p&&"Enter"!==p&&32!==v&&13!==v||this.togglePopup()}_onMapClick(c){const p=c.originalEvent.target,v=this._element;this._popup&&(p===v||v.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,p=this._pos;if(!c||!p)return!1;const v=c.unproject(p),w=c.getFreeCameraOptions();if(!w.position)return!1;const C=w.position.toLngLat();return C.distanceTo(v)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const p=this._pos;if(!p||p.x<0||p.x>c.transform.width||p.y<0||p.y>c.transform.height)return void this._clearFadeTimer();const v=c.unproject(p);let w;c._showingGlobe()&&f.dc(c.transform,this._lngLat)?w=0:(w=1-c._queryFogOpacity(v),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${d0[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${p.x}px,${p.y}px)\n        `}_calculateXYTransform(){const c=this._pos,p=this._map,v=this.getPitchAlignment();if(!p||!c||"map"!==v)return"";if(!p._showingGlobe()){const P=p.getPitch();return P?`rotateX(${P}deg)`:""}const w=f.b1(f.dd(p.transform,this._lngLat)),C=c.sub(f.de(p.transform)),M=Math.abs(C.x)+Math.abs(C.y);if(0===M)return"";const I=w/M;return`rotateX(${-C.y*I}deg) rotateY(${C.x*I}deg)`}_calculateZTransform(){const c=this._pos,p=this._map;if(!p||!c)return"";let v=0;const w=this.getRotationAlignment();if("map"===w)if(p._showingGlobe()){const C=p.project(new f.aJ(this._lngLat.lng,this._lngLat.lat+.001)),M=p.project(new f.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);v=f.b1(Math.atan2(M.y,M.x))-90}else v=-p.getBearing();else if("horizon"===w){const C=f.a0(4,6,p.getZoom()),M=f.de(p.transform);M.y+=C*p.transform.height;const I=c.sub(M),P=f.b1(Math.atan2(I.y,I.x));v=(P>90?P-270:P+90)*(1-C)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(c){cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=Sh(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat),!0===c?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=f.P.convert(c),this._update(),this}addClassName(c){return this._element.classList.add(c),this}removeClassName(c){return this._element.classList.remove(c),this}toggleClassName(c){return this._element.classList.toggle(c)}_onMove(c){const p=this._map;if(!p)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const C=this._clickTolerance||p._clickTolerance;if(c.point.dist(v)<C)return;this._isDragging=!0}this._pos=c.point.sub(w),this._lngLat=p.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.g("dragstart"))),this.fire(new f.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.g("dragend")),this._state="inactive"}_addDragHandler(c){const p=this._map,v=this._pos;p&&v&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(v),this._pointerdownPos=c.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const p=this._map;return p&&(c?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Pu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zd(y=new f.P(0,0),c="bottom"){if("number"==typeof y){const p=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(c){case"top":return new f.P(0,y);case"top-left":return new f.P(p,p);case"top-right":return new f.P(-p,p);case"bottom":return new f.P(0,-y);case"bottom-left":return new f.P(p,-p);case"bottom-right":return new f.P(-p,-p);case"left":return new f.P(y,0);case"right":return new f.P(-y,0)}return new f.P(0,0)}return y instanceof f.P||Array.isArray(y)?f.P.convert(y):f.P.convert(y[c]||[0,0])}class _1{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const p=f.bb((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,p,v){this._start=this.getValue(p),this._end=c,this._startTime=p,this._endTime=p+v}}const aT={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class lT{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const ex={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Dh={showCompass:!0,showZoom:!0,visualizePitch:!1};class y1{constructor(c,p,v=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new Nm({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,v&&(this.mousePitch=new l0({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),f.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(c,p){this.mouseRotate.mousedown(c,p),this.mousePitch&&this.mousePitch.mousedown(c,p),vi()}move(c,p){const v=this.map,w=this.mouseRotate.mousemoveWindow(c,p),C=w&&w.bearingDelta;if(C&&v.setBearing(v.getBearing()+C),this.mousePitch){const M=this.mousePitch.mousemoveWindow(c,p),I=M&&M.pitchDelta;I&&v.setPitch(v.getPitch()+I)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ws(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(f.Q({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),xi(this.element,c)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,xi(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ai(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=Ai(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const tx={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ap={maxWidth:100,unit:"metric"},f0={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:f.dw,supported:as,setRTLTextPlugin:f.dy,getRTLTextPluginStatus:f.dz,Map:class extends u0{constructor(y){f.df.mark(f.dg.create);const c=y;if(null!=(y=f.Q({},ex,y)).minZoom&&null!=y.maxZoom&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=y.minPitch&&null!=y.maxPitch&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=y.minPitch&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=y.maxPitch&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&f.dh(window)&&(y.antialias=!1,f.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Wg(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._repaint=!!y.repaint,this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new sp,this._domRenderTaskQueue=new sp,this._controls=[],this._markers=[],this._popups=[],this._mapId=f.di(),this._locale=f.Q({},aT,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._tessellationStep=y.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=y.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _1(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new f.dj(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,this._contextCreateOptions=y.contextCreateOptions?{...y.contextCreateOptions}:{},"string"==typeof y.container){const p=document.getElementById(y.container);if(!p)throw new Error(`Container '${y.container.toString()}' not found.`);this._container=p}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&f.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),f.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new lT),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ip(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,(y.style||!y.testMode)&&this.setStyle(y.style||f.db.DEFAULT_STYLE,{config:y.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),y.hash&&(this._hash=new km("string"==typeof y.hash&&y.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==c.center&&null==c.zoom||(this.transform._unmodified=!1),this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch});const p=y.bounds;p&&(this.resize(),this.fitBounds(p,f.Q({},y.fitBoundsOptions,{duration:0})))}this.resize(),y.attributionControl&&this.addControl(new Ac({customAttribution:y.customAttribution})),this._logoControl=new h0,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",p=>{this._update("style"===p.dataType),this.fire(new f.g(`${p.dataType}data`,p))}),this.on("dataloading",p=>{this.fire(new f.g(`${p.dataType}dataloading`,p))})}_getMapId(){return this._mapId}addControl(y,c){if(void 0===c&&(c=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new f.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[c];return-1!==c.indexOf("bottom")?v.insertBefore(p,v.firstChild):v.appendChild(p),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new f.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(y);return c>-1&&this._controls.splice(c,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new f.g("movestart",y)).fire(new f.g("move",y)),this.fire(new f.g("resize",y)),c&&this.fire(new f.g("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(f.aj.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new f.g("zoomstart")).fire(new f.g("zoom")).fire(new f.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new f.g("zoomstart")).fire(new f.g("zoom")).fire(new f.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new f.g("pitchstart")).fire(new f.g("pitch")).fire(new f.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new f.g("pitchstart")).fire(new f.g("pitch")).fire(new f.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return"auto"===y?navigator.language:Array.isArray(y)?0===y.length?void 0:y.map(c=>"auto"===c?navigator.language:c):y}setLanguage(y){const c=this._parseLanguage(y);if(!this.style||c===this._language)return this;this._language=c,this.style.reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(y){return this._lazyInitEmptyStyle(),y?"string"==typeof y&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const y=this.transform,c=y.projection.name;let p;"globe"===c&&y.zoom>=f.aV?(y.setMercatorFromTransition(),p=!0):"mercator"===c&&y.zoom<f.aV&&(y.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,c){return this._updateProjection(y||c||{name:"mercator"})}_updateProjection(y){let c;return c="globe"===y.name&&this.transform.zoom>=f.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),c&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(y){return this.transform.locationPoint3D(f.aJ.convert(y))}unproject(y){return this.transform.pointLocation3D(f.P.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,c,p){if("mouseenter"===y||"mouseover"===y){let v=!1;const w=M=>{const I=c.filter(F=>this.getLayer(F)),P=I.length?this.queryRenderedFeatures(M.point,{layers:I}):[];P.length?v||(v=!0,p.call(this,new Pl(y,this,M.originalEvent,{features:P}))):v=!1},C=()=>{v=!1};return{layers:new Set(c),listener:p,delegates:{mousemove:w,mouseout:C}}}if("mouseleave"===y||"mouseout"===y){let v=!1;const w=M=>{const I=c.filter(P=>this.getLayer(P));(I.length?this.queryRenderedFeatures(M.point,{layers:I}):[]).length?v=!0:v&&(v=!1,p.call(this,new Pl(y,this,M.originalEvent)))},C=M=>{v&&(v=!1,p.call(this,new Pl(y,this,M.originalEvent)))};return{layers:new Set(c),listener:p,delegates:{mousemove:w,mouseout:C}}}{const v=w=>{const C=c.filter(I=>this.getLayer(I)),M=C.length?this.queryRenderedFeatures(w.point,{layers:C}):[];M.length&&(w.features=M,p.call(this,w),delete w.features)};return{layers:new Set(c),listener:p,delegates:{[y]:v}}}}on(y,c,p){if("function"==typeof c||void 0===p)return super.on(y,c);if(Array.isArray(c)||(c=[c]),c)for(const w of c)if(!this._isValidId(w))return this;const v=this._createDelegatedListener(y,c,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(y,c,p){if("function"==typeof c||void 0===p)return super.once(y,c);if(Array.isArray(c)||(c=[c]),c)for(const w of c)if(!this._isValidId(w))return this;const v=this._createDelegatedListener(y,c,p);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(y,c,p){if("function"==typeof c||void 0===p)return super.off(y,c);const v=new Set(Array.isArray(c)?c:[c]);for(const M of v)if(!this._isValidId(M))return this;const w=(M,I)=>{if(M.size!==I.size)return!1;for(const P of M)if(!I.has(P))return!1;return!0},C=this._delegatedListeners?this._delegatedListeners[y]:void 0;return C&&(M=>{for(let I=0;I<M.length;I++){const P=M[I];if(P.listener===p&&w(P.layers,v)){for(const F in P.delegates)this.off(F,P.delegates[F]);return M.splice(I,1),this}}})(C),this}queryRenderedFeatures(y,c){if(!this.style)return[];if(void 0!==c||void 0===y||y instanceof f.P||Array.isArray(y)||(c=y,y=void 0),y=y||[[0,0],[this.transform.width,this.transform.height]],(c=c||{}).layers&&Array.isArray(c.layers))for(const p of c.layers)if(!this._isValidId(p))return[];return this.style.queryRenderedFeatures(y,c,this.transform)}querySourceFeatures(y,c){return this._isValidId(y)?this.style.querySourceFeatures(y,c):[]}isPointOnSurface(y){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&f.w(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(f.P.convert(y))}setStyle(y,c){return c=f.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c),this.style&&y&&!1!==c.diff&&c.localFontFamily===this._localFontFamily&&c.localIdeographFontFamily===this._localIdeographFontFamily&&!c.config?(this.style._diffStyle(y,(p,v)=>{p?(f.w(`Unable to perform style diff: ${String(p.message||p.error||p)}. Rebuilding the style from scratch.`),this._updateStyle(y,c)):v&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(y,c))}_getUIString(y){const c=this._locale[y];if(null==c)throw new Error(`Missing UI string '${y}'`);return c}_updateStyle(y,c){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y){const p=f.Q({},c);c&&c.config&&(p.initialConfig=c.config,delete p.config),this.style=new Fa(this,p).load(y),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Fa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.w("There is no style added to the map."),!1)}_isValidId(y){return null==y?(this.fire(new f.f(new Error("IDs can't be empty."))),!1):!f.cY(y)||(this.fire(new f.f(new Error(`IDs can't contain special symbols: "${y}".`))),!1)}addSource(y,c){return this._isValidId(y)?(this._lazyInitEmptyStyle(),this.style.addSource(y,c),this._update(!0)):this}isSourceLoaded(y){return!!this._isValidId(y)&&!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(y,c,p){this._lazyInitEmptyStyle(),this.style.addSourceType(y,c,p)}removeSource(y){return this._isValidId(y)?(this.style.removeSource(y),this._updateTerrain(),this._update(!0)):this}getSource(y){return this._isValidId(y)?this.style.getOwnSource(y):null}addImage(y,c,{pixelRatio:p=1,sdf:v=!1,stretchX:w,stretchY:C,content:M}={}){if(this._lazyInitEmptyStyle(),c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap){const{width:I,height:P,data:F}=f.e.getImageData(c);this.style.addImage(y,{data:new f.j({width:I,height:P},F),pixelRatio:p,stretchX:w,stretchY:C,content:M,sdf:v,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new f.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:P}=c,F=c;this.style.addImage(y,{data:new f.j({width:I,height:P},new Uint8Array(F.data)),pixelRatio:p,stretchX:w,stretchY:C,content:M,sdf:v,version:0,userImage:F}),F.onAdd&&F.onAdd(this,y)}}updateImage(y,c){this._lazyInitEmptyStyle();const p=this.style.getImage(y);if(!p)return void this.fire(new f.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap?f.e.getImageData(c):c,{width:w,height:C,data:M}=v;if(void 0===w||void 0===C)return void this.fire(new f.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==p.data.width||C!==p.data.height)return void this.fire(new f.f(new Error(`The width and height of the updated image (${w}, ${C})\n                must be that same as the previous version of the image\n                (${p.data.width}, ${p.data.height})`)));const I=!(c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap);p.data.replace(M,I),this.style.updateImage(y,p)}hasImage(y){return y?!!this.style&&!!this.style.getImage(y):(this.fire(new f.f(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,c){f.i(this._requestManager.transformRequest(y,f.R.Image),(p,v)=>{c(p,v instanceof HTMLImageElement?f.e.getImageData(v):v)})}listImages(){return this.style.listImages()}addModel(y,c){this._lazyInitEmptyStyle(),this.style.addModel(y,c)}hasModel(y){return y?this.style.hasModel(y):(this.fire(new f.f(new Error("Missing required model id"))),!1)}removeModel(y){this.style.removeModel(y)}listModels(){return this.style.listModels()}addLayer(y,c){return this._isValidId(y.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(y,c),this._update(!0)):this}getSlot(y){const c=this.getLayer(y);return c&&c.slot||null}setSlot(y,c){return this.style.setSlot(y,c),this.style.mergeLayers(),this._update(!0)}addImport(y,c){return this.style.addImport(y,c),this}updateImport(y,c){return"string"!=typeof c&&c.id!==y?(this.removeImport(y),this.addImport(c)):(this.style.updateImport(y,c),this._update(!0))}removeImport(y){return this.style.removeImport(y),this}moveImport(y,c){return this.style.moveImport(y,c),this._update(!0)}moveLayer(y,c){return this._isValidId(y)?(this.style.moveLayer(y,c),this._update(!0)):this}removeLayer(y){return this._isValidId(y)?(this.style.removeLayer(y),this._update(!0)):this}getLayer(y){if(!this._isValidId(y))return null;const c=this.style.getOwnLayer(y);return c?"custom"===c.type?c.implementation:c.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(y,c,p){return this._isValidId(y)?(this.style.setLayerZoomRange(y,c,p),this._update(!0)):this}setFilter(y,c,p={}){return this._isValidId(y)?(this.style.setFilter(y,c,p),this._update(!0)):this}getFilter(y){return this._isValidId(y)?this.style.getFilter(y):null}setPaintProperty(y,c,p,v={}){return this._isValidId(y)?(this.style.setPaintProperty(y,c,p,v),this._update(!0)):this}getPaintProperty(y,c){return this._isValidId(y)?this.style.getPaintProperty(y,c):null}setLayoutProperty(y,c,p,v={}){return this._isValidId(y)?(this.style.setLayoutProperty(y,c,p,v),this._update(!0)):this}getLayoutProperty(y,c){return this._isValidId(y)?this.style.getLayoutProperty(y,c):null}getSchema(y){return this.style.getSchema(y)}setSchema(y,c){return this.style.setSchema(y,c),this._update(!0)}getConfig(y){return this.style.getConfig(y)}setConfig(y,c){return this.style.setConfig(y,c),this._update(!0)}getConfigProperty(y,c){return this.style.getConfigProperty(y,c)}setConfigProperty(y,c,p){return this.style.setConfigProperty(y,c,p),this._update(!0)}setLights(y){if(this._lazyInitEmptyStyle(),y&&1===y.length&&"flat"===y[0].type){const c=y[0];c.properties?this.style.setFlatLight(c.properties,c.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(y),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const y=this.style.getLights()||[];return 0===y.length&&y.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),y}setLight(y,c={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:y}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(y){return this._lazyInitEmptyStyle(),this.style.setColorTheme(y),this._update(!0)}setCamera(y){return this.style.setCamera(y),this._triggerCameraUpdate(y)}_triggerCameraUpdate(y){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===y["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.aJ.convert(y),this.transform):0}setFeatureState(y,c){return this._isValidId(y.source)?(this.style.setFeatureState(y,c),this._update()):this}removeFeatureState(y,c){return this._isValidId(y.source)?(this.style.removeFeatureState(y,c),this._update()):this}getFeatureState(y){return this._isValidId(y.source)?this.style.getFeatureState(y):null}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let p,v,w,C=this._container;for(;C&&(!v||!w);){const M=window.getComputedStyle(C).transform;M&&"none"!==M&&(p=M.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&"0"!==p[0]&&"1"!==p[0]&&(v=p[0]),p[3]&&"0"!==p[3]&&"1"!==p[3]&&(w=p[3])),C=C.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=w?Math.abs(c/w):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=jr("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=jr("div","mapboxgl-canvas-container",y);this._canvas=jr("canvas","mapboxgl-canvas",c),this._interactive&&(c.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=jr("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=jr("div",`mapboxgl-ctrl-${w}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,c){const p=f.e.devicePixelRatio||1;this._canvas.width=p*Math.ceil(y),this._canvas.height=p*Math.ceil(c),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${c}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const c=this._markers.indexOf(y);-1!==c&&this._markers.splice(c,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const c=this._popups.indexOf(y);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const y=f.Q({},as.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._canvas.getContext("webgl2",y);c?(f.dk(c,!0),this.painter=new l1(c,this._contextCreateOptions,this.transform,this._tp),this.on("data",p=>{"source"===p.dataType&&this.painter.setTileLoadedFlag(!0)}),f.dl.testSupport(c)):this.fire(new f.f(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.g("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new f.g("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let c;this.fire(new f.g("renderstart")),++this._frameId;const p=this.painter.context.extTimerQuery,v=f.e.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(c=w.createQuery(),w.beginQuery(p.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,z=this.transform.pitch,j=f.e.now(),q=new f.Y(F,{now:j,fadeDuration:C,pitch:z,transition:this.style.transition});this.style.update(q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(v),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(v);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,this.painter.replacementSource);if(I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,f.df.mark(f.dg.load),this.fire(new f.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const F=f.e.now()-v;w.endQuery(p.TIME_ELAPSED_EXT),setTimeout(()=>{const z=w.getQueryParameter(c,w.QUERY_RESULT)/1e6;w.deleteQuery(c),this.fire(new f.g("gpu-timing-frame",{cpuTime:F,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(F);this.fire(new f.g("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const F=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(F);this.fire(new f.g("gpu-timing-deferred-render",{gpuTime:z}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(P||this._repaint)this.triggerRepaint();else{const F=this.idle();if(F&&(M=this._updateAverageElevation(v,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new f.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new f.g("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,f.df.mark(f.dg.fullLoad),this._performanceMetricsCollection&&f.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const c of this._markers)y&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!y||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(y,c=!1){const p=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&p(0);const v=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(v||(c||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const w=this.transform.averageElevation;let C=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=y;const M=Math.abs(w-C);if(M>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(C),p(C);this._averageElevation.easeTo(C,y,300)}else if(M>1e-4)return this._averageElevation.jumpTo(C),p(C)}return!!this._averageElevation.isEasing(y)&&p(this._averageElevation.getValue(y))}_authenticate(){f.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,y=>{if(y&&(y.message===f.dp||401===y.status)){const c=this.painter.context.gl;f.dk(c,!1),this._logoControl instanceof h0&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&f.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const p=this.painter.context.gl,v=p.createFramebuffer();function w(C){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,C,0);const M=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,M),M}return p.bindFramebuffer(p.FRAMEBUFFER,v),this._canvasPixelComparison(w(y),c.canvasCopies.map(w),c.timeStamps)}_canvasPixelComparison(y,c,p){let v=p[1]-p[0];const w=y.length/4;for(let C=0;C<c.length;C++){const M=c[C];let I=0;for(let P=0;P<M.length;P+=4)M[P]===y[P]&&M[P+1]===y[P+1]&&M[P+2]===y[P+2]&&M[P+3]===y[P+3]&&(I+=1);v+=(p[C+2]-p[C+1])*(1-I/w)}return v}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),f.ds(this.painter.context.gl),f.dt.remove(),f.du.remove(),this._removed=!0,this.fire(new f.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=f.e.frame(c=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(c)}))}_preloadTiles(y){const c=this.style?this.style.getSourceCaches():[];return f.dv(c,(p,v)=>p._preloadTiles(y,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(y){this._showParseStatus!==y&&(this._showParseStatus=y,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(y){this._showLayers2DWireframe!==y&&(this._showLayers2DWireframe=y,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(y){this._showLayers3DWireframe!==y&&(this._showLayers3DWireframe=y,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,this._tp.refreshUI(),y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,this._tp.refreshUI(),y&&this._update())}_setCacheLimits(y,c){f.dx(y,c)}get version(){return f.dw}},NavigationControl:class{constructor(y={}){this.options=f.Q({},Dh,y),this._container=jr("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(f.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),jr("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),jr("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:c}):p.resetNorth({},{originalEvent:c}))}),this._compassIcon=jr("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const c=y.getZoom(),p=c===y.getMaxZoom(),v=c===y.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new y1(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,c){const p=jr("button",y,this._container);return p.type="button",p.addEventListener("click",c),p}_setButtonTitle(y,c){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${c}`);y.setAttribute("aria-label",p),y.firstElementChild&&y.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends f.E{constructor(y={}){super();const c=navigator.geolocation;this.options=f.Q({geolocation:c},tx,y),f.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Im(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=jr("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const c=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,y(p)};void 0!==this._supportsGeolocation?y(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(p=>c("denied"!==p.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(y){const c=this._map.getMaxBounds(),p=y.coords;return!!c&&(p.longitude<c.getWest()||p.longitude>c.getEast()||p.latitude<c.getSouth()||p.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new f.g("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(y),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(y),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new f.g("geolocate",y)),this._finish()}}_updateCamera(y){const c=new f.aJ(y.coords.longitude,y.coords.latitude),p=y.coords.accuracy,v=this._map.getBearing(),w=f.Q({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(p),w,{geolocateSource:!0})}_updateMarker(y){if(y){const c=new f.aJ(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,c=f.ay(1,y._center.lat)*y.worldSize,p=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(1===y.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===y.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new f.g("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=jr("button","mapboxgl-ctrl-geolocate",this._container),jr("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===y){f.w("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=jr("div","mapboxgl-user-location"),this._dotElement.appendChild(jr("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(jr("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new op({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=jr("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new op({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.g("trackuserlocationend")))})}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:!0===y.absolute&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&y()}).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ac,ScaleControl:class{constructor(y={}){this.options=f.Q({},ap,y),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),f.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,c=this._map,p=c._containerHeight/2,v=c._containerWidth/2-y/2,w=c.unproject([v,p]),C=c.unproject([v+y,p]),M=w.distanceTo(C);if("imperial"===this.options.unit){const I=3.2808*M;I>5280?this._setScale(y,I/5280,"mile"):this._setScale(y,I,"foot")}else"nautical"===this.options.unit?this._setScale(y,M/1852,"nautical-mile"):M>=1e3?this._setScale(y,M/1e3,"kilometer"):this._setScale(y,M,"meter")}_setScale(y,c,p){this._map._requestDomTask(()=>{const v=function(C){const M=Math.pow(10,`${Math.floor(C)}`.length-1);let I=C/M;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(P){const F=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*F)/F}(I),M*I}(c),w=v/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==p?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:p}).format(v):`${v}&nbsp;${f0[p]}`,this._container.style.width=y*w+"px"})}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=jr("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y={}){this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:f.w("Full screen control 'container' must be a DOM element.")),f.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=jr("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=jr("button","mapboxgl-ctrl-fullscreen",this._controlContainer);jr("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.E{constructor(y){super(),this.options=f.Q(Object.create(Pu),y),f.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new f.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new f.g("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=f.aJ.convert(y),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const c=document.createDocumentFragment(),p=document.createElement("body");let v;for(p.innerHTML=y;v=p.firstChild,v;)c.appendChild(v);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=jr("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(y),this.options.closeButton){const p=this._closeButton=jr("button","mapboxgl-popup-close-button",c);p.type="button",p.setAttribute("aria-label","Close popup"),p.setAttribute("aria-hidden","true"),p.innerHTML="&#215;",p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let c;return this._classList.delete(y)?c=!1:(this._classList.add(y),c=!0),this._updateClassList(),c}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const c=this._map,p=this._container,v=this._pos;if(!c||!p||!v)return"bottom";const w=p.offsetWidth,C=p.offsetHeight,M=v.x<w/2,I=v.x>c.transform.width-w/2;if(v.y+y<C)return M?"top-left":I?"top-right":"top";if(v.y>c.transform.height-C){if(M)return"bottom-left";if(I)return"bottom-right"}return M?"left":I?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),y.className=c.join(" ")}_update(y){const c=this._map,p=this._content;if(!c||!this._lngLat&&!this._trackPointer||!p)return;let v=this._container;if(v||(v=this._container=jr("div","mapboxgl-popup",c.getContainer()),this._tip=jr("div","mapboxgl-popup-tip",v),v.appendChild(p)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sh(this._lngLat,this._pos,c.transform)),!this._trackPointer||y){const w=this._pos=this._trackPointer&&y instanceof f.P?y:c.project(this._lngLat),C=zd(this.options.offset),M=this._anchor=this._getAnchor(C.y),I=zd(this.options.offset,M),P=w.add(I).round();c._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${d0[M]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&c._showingGlobe()){const w=f.dc(c.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(qo);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:op,Style:Fa,LngLat:f.aJ,LngLatBounds:f.aj,Point:f.P,MercatorCoordinate:f._,FreeCameraOptions:fm,Evented:f.E,config:f.db,prewarm:f.dA,clearPrewarmedResources:f.dB,get accessToken(){return f.db.ACCESS_TOKEN},set accessToken(y){f.db.ACCESS_TOKEN=y},get baseApiUrl(){return f.db.API_URL},set baseApiUrl(y){f.db.API_URL=y},get workerCount(){return f.dC.workerCount},set workerCount(y){f.dC.workerCount=y},get maxParallelImageRequests(){return f.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){f.db.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){f.dD(y)},get workerUrl(){return f.dE.workerUrl},set workerUrl(y){f.dE.workerUrl=y},get workerClass(){return f.dE.workerClass},set workerClass(y){f.dE.workerClass=y},get workerParams(){return f.dE.workerParams},set workerParams(y){f.dE.workerParams=y},get dracoUrl(){return f.dF()},set dracoUrl(y){f.dG(y)},get meshoptUrl(){return f.dH()},set meshoptUrl(y){f.dI(y)},setNow:f.e.setNow,restoreNow:f.e.restoreNow}}),yu}()},73:()=>{"use strict";const oh=":";Error;const nr=function(wt,...Rt){if(nr.translate){const pn=nr.translate(wt,Rt);wt=pn[0],Rt=pn[1]}let an=Li(wt[0],wt.raw[0]);for(let pn=1;pn<wt.length;pn++)an+=Rt[pn-1]+Li(wt[pn],wt.raw[pn]);return an},yd=":";function Li(wt,Rt){return Rt.charAt(0)===yd?wt.substring(function wc(wt,Rt){for(let an=1,pn=1;an<wt.length;an++,pn++)if("\\"===Rt[pn])pn++;else if(wt[an]===oh)return an;throw new Error(`Unterminated $localize metadata block in "${Rt}".`)}(wt,Rt)+1):wt}globalThis.$localize=nr}},oh=>{var _u=yu=>oh(oh.s=yu);_u(73),_u(400)}]);